diff --git a/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java b/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java
index 2707f539bc..031d6343d6 100644
--- a/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java
+++ b/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java
@@ -156,12 +156,16 @@ public long open(DataSpec dataSpec) throws HttpDataSourceException {
     Request request = makeRequest(dataSpec);
     Response response;
     ResponseBody responseBody;
+
+    transferStarted(dataSpec);
+
     try {
       this.response = callFactory.newCall(request).execute();
       response = this.response;
       responseBody = Assertions.checkNotNull(response.body());
       responseByteStream = responseBody.byteStream();
     } catch (IOException e) {
+      transferEnded();
       throw new HttpDataSourceException(
           "Unable to connect to " + dataSpec.uri, e, dataSpec, HttpDataSourceException.TYPE_OPEN);
     }
@@ -170,6 +174,8 @@ public long open(DataSpec dataSpec) throws HttpDataSourceException {
 
     // Check for a valid response code.
     if (!response.isSuccessful()) {
+      transferEnded();
+
       Map<String, List<String>> headers = response.headers().toMultimap();
       closeConnectionQuietly();
       InvalidResponseCodeException exception = new InvalidResponseCodeException(
@@ -184,6 +190,8 @@ public long open(DataSpec dataSpec) throws HttpDataSourceException {
     MediaType mediaType = responseBody.contentType();
     String contentType = mediaType != null ? mediaType.toString() : "";
     if (contentTypePredicate != null && !contentTypePredicate.evaluate(contentType)) {
+      transferEnded();
+
       closeConnectionQuietly();
       throw new InvalidContentTypeException(contentType, dataSpec);
     }
@@ -202,7 +210,6 @@ public long open(DataSpec dataSpec) throws HttpDataSourceException {
     }
 
     opened = true;
-    transferStarted(dataSpec);
 
     return bytesToRead;
   }
@@ -386,4 +393,4 @@ private void closeConnectionQuietly() {
     responseByteStream = null;
   }
 
-}
+}
\ No newline at end of file
