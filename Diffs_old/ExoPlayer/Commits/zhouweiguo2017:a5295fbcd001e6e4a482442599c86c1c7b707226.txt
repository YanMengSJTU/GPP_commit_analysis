diff --git a/library/core/src/androidTest/java/com/google/android/exoplayer2/extractor/ts/TsExtractorTest.java b/library/core/src/androidTest/java/com/google/android/exoplayer2/extractor/ts/TsExtractorTest.java
index efd653b8d9..09716a6366 100644
--- a/library/core/src/androidTest/java/com/google/android/exoplayer2/extractor/ts/TsExtractorTest.java
+++ b/library/core/src/androidTest/java/com/google/android/exoplayer2/extractor/ts/TsExtractorTest.java
@@ -159,7 +159,7 @@ public TsPayloadReader createPayloadReader(int streamType, EsInfo esInfo) {
         esReader = new CustomEsReader(esInfo.language);
         return new PesReader(esReader);
       } else {
-        return defaultFactory.createPayloadReader(streamType, esInfo);
+        return defaultFactory.createPayloadReader(streamType, esInfo, null);
       }
     }
 
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/C.java b/library/core/src/main/java/com/google/android/exoplayer2/C.java
index 30062fe63d..c93d7028e0 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/C.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/C.java
@@ -820,7 +820,7 @@ public static final void decryptSampleAes(byte[] buffer, int bufferSize, byte[]
         System.arraycopy(buffer, offset, temp_iv, 0, C.AES_BLOCK_LENGTH_BYTES);
 
         byte[] encryptData = new byte[encryptSize];
-        System.arraycopy(buffer, ptr, encryptData, 0, encryptSize);
+        System.arraycopy(buffer, offset, encryptData, 0, encryptSize);
         byte[] decrypted = AES_CBC(encryptData, encrytionKey, packet_iv, false);
         Assertions.checkArgument(decrypted.length % C.AES_BLOCK_LENGTH_BYTES == 0);
         Assertions.checkArgument(decrypted.length == encryptSize);
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/extractor/ts/TsExtractor.java b/library/core/src/main/java/com/google/android/exoplayer2/extractor/ts/TsExtractor.java
index 4e608c2e0c..ef7f97ecc2 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/extractor/ts/TsExtractor.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/extractor/ts/TsExtractor.java
@@ -473,7 +473,7 @@ public void consume(ParsableByteArray sectionData) {
         }
 
         TsPayloadReader reader = mode == MODE_HLS && streamType == TS_STREAM_TYPE_ID3 ? id3Reader
-            : payloadReaderFactory.createPayloadReader(streamType, esInfo);
+            : payloadReaderFactory.createPayloadReader(streamType, esInfo, null);
         if (mode != MODE_HLS
             || elementaryPid < trackIdToPidScratch.get(trackId, MAX_PID_PLUS_ONE)) {
           trackIdToPidScratch.put(trackId, elementaryPid);
