diff --git a/library/src/androidTest/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpanTest.java b/library/src/androidTest/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpanTest.java
index 3ec2484d3c..588df4e136 100644
--- a/library/src/androidTest/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpanTest.java
+++ b/library/src/androidTest/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpanTest.java
@@ -84,7 +84,12 @@ public void testUpgradeFileName() throws Exception {
     File v1File = createTestFile("asd\u00aa.5.6.v1.exo");
 
     for (File file : cacheDir.listFiles()) {
-      SimpleCacheSpan.createCacheEntry(file, index);
+      SimpleCacheSpan cacheEntry = SimpleCacheSpan.createCacheEntry(file, index);
+      if (file.equals(wrongEscapedV2file)) {
+        assertNull(cacheEntry);
+      } else {
+        assertNotNull(cacheEntry);
+      }
     }
 
     assertTrue(v3file.exists());
diff --git a/library/src/main/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpan.java b/library/src/main/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpan.java
index d672ac244e..c9817b33e3 100644
--- a/library/src/main/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpan.java
+++ b/library/src/main/java/com/google/android/exoplayer/upstream/cache/SimpleCacheSpan.java
@@ -67,6 +67,7 @@ public static SimpleCacheSpan createCacheEntry(File file, CachedContentIndex ind
       if (file == null) {
         return null;
       }
+      name = file.getName();
     }
 
     Matcher matcher = CACHE_FILE_PATTERN_V3.matcher(name);
