diff --git a/demo/src/main/AndroidManifest.xml b/demo/src/main/AndroidManifest.xml
index f94535a83f..8737b25a7a 100644
--- a/demo/src/main/AndroidManifest.xml
+++ b/demo/src/main/AndroidManifest.xml
@@ -16,8 +16,8 @@
 
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
     package="com.google.android.exoplayer.demo"
-    android:versionCode="1202"
-    android:versionName="1.2.2"
+    android:versionCode="1203"
+    android:versionName="1.2.3"
     android:theme="@style/RootTheme">
 
   <uses-permission android:name="android.permission.INTERNET"/>
diff --git a/library/src/main/java/com/google/android/exoplayer/ExoPlayerLibraryInfo.java b/library/src/main/java/com/google/android/exoplayer/ExoPlayerLibraryInfo.java
index fdcd940e14..e2e620d1ff 100644
--- a/library/src/main/java/com/google/android/exoplayer/ExoPlayerLibraryInfo.java
+++ b/library/src/main/java/com/google/android/exoplayer/ExoPlayerLibraryInfo.java
@@ -26,7 +26,7 @@ private ExoPlayerLibraryInfo() {}
   /**
    * The version of the library, expressed as a string.
    */
-  public static final String VERSION = "1.2.2";
+  public static final String VERSION = "1.2.3";
 
   /**
    * The version of the library, expressed as an integer.
@@ -34,7 +34,7 @@ private ExoPlayerLibraryInfo() {}
    * Three digits are used for each component of {@link #VERSION}. For example "1.2.3" has the
    * corresponding integer version 001002003.
    */
-  public static final int VERSION_INT = 001002002;
+  public static final int VERSION_INT = 001002003;
 
   /**
    * Whether the library was compiled with {@link com.google.android.exoplayer.util.Assertions}
diff --git a/library/src/main/java/com/google/android/exoplayer/hls/HlsSampleSource.java b/library/src/main/java/com/google/android/exoplayer/hls/HlsSampleSource.java
index b8fffd4c11..9db6c4ccc0 100644
--- a/library/src/main/java/com/google/android/exoplayer/hls/HlsSampleSource.java
+++ b/library/src/main/java/com/google/android/exoplayer/hls/HlsSampleSource.java
@@ -164,7 +164,7 @@ public boolean continueBuffering(long playbackPositionUs) throws IOException {
     if (!extractors.isEmpty()) {
       discardSamplesForDisabledTracks(extractors.getFirst(), downstreamPositionUs);
     }
-    return continueBufferingInternal();
+    return loadingFinished || continueBufferingInternal();
   }
 
   private boolean continueBufferingInternal() throws IOException {
diff --git a/library/src/main/java/com/google/android/exoplayer/mp4/Mp4Util.java b/library/src/main/java/com/google/android/exoplayer/mp4/Mp4Util.java
index e593858f8b..ea41e3a2cf 100644
--- a/library/src/main/java/com/google/android/exoplayer/mp4/Mp4Util.java
+++ b/library/src/main/java/com/google/android/exoplayer/mp4/Mp4Util.java
@@ -171,6 +171,9 @@ public static int findNalUnit(byte[] data, int startOffset, int endOffset, int t
         // loop advance the index by three.
       } else if (data[i - 2] == 0 && data[i - 1] == 0 && data[i] == 1
           && matchesType(data, i + 1, type)) {
+        if (prefixFlags != null) {
+          clearPrefixFlags(prefixFlags);
+        }
         return i - 2;
       } else {
         // There isn't a NAL prefix here, but there might be at the next position. We should
