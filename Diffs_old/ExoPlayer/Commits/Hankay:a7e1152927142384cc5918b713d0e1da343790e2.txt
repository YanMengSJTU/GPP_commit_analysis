diff --git a/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlNode.java b/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlNode.java
index 0a2e1087d8..d13fbff01f 100644
--- a/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlNode.java
+++ b/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlNode.java
@@ -204,7 +204,7 @@ private void traverseForText(long timeUs,  boolean descendsPNode,
       for (Entry<String, SpannableStringBuilder> entry : regionOutputs.entrySet()) {
         nodeStartsByRegion.put(entry.getKey(), entry.getValue().length());
       }
-      for (int i = 0; i < getChildCount(); ++i) {
+      for (int i = 0; i < getChildCount(); i++) {
         getChild(i).traverseForText(timeUs, descendsPNode || isPNode, resolvedRegionId,
             regionOutputs);
       }
diff --git a/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlParser.java b/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlParser.java
index 20ad7f9995..ff04140907 100644
--- a/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlParser.java
+++ b/library/src/main/java/com/google/android/exoplayer/text/ttml/TtmlParser.java
@@ -125,7 +125,7 @@ public TtmlSubtitle parse(byte[] bytes, int offset, int length) throws ParserExc
               parseHeader(xmlParser, globalStyles, regionMap);
             } else {
               try {
-                TtmlNode node = parseNode(xmlParser, parent);
+                TtmlNode node = parseNode(xmlParser, parent, regionMap);
                 nodeStack.addLast(node);
                 if (parent != null) {
                   parent.addChild(node);
@@ -304,7 +304,8 @@ private TtmlStyle createIfNull(TtmlStyle style) {
     return style == null ? new TtmlStyle() : style;
   }
 
-  private TtmlNode parseNode(XmlPullParser parser, TtmlNode parent) throws ParserException {
+  private TtmlNode parseNode(XmlPullParser parser, TtmlNode parent,
+      Map<String, TtmlRegion> regionMap) throws ParserException {
     long duration = 0;
     long startTime = TtmlNode.UNDEFINED_TIME;
     long endTime = TtmlNode.UNDEFINED_TIME;
@@ -330,7 +331,9 @@ private TtmlNode parseNode(XmlPullParser parser, TtmlNode parent) throws ParserE
         if (ids.length > 0) {
           styleIds = ids;
         }
-      } else if (ATTR_REGION.equals(attr)) {
+      } else if (ATTR_REGION.equals(attr) && regionMap.containsKey(value)) {
+        // If the region has not been correctly declared or does not define a position, we use the
+        // anonymous region.
         regionId = value;
       } else {
         // Do nothing.
