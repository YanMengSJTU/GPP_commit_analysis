diff --git a/build.gradle b/build.gradle
index 9f9081a945..313585f0a0 100644
--- a/build.gradle
+++ b/build.gradle
@@ -17,7 +17,7 @@ buildscript {
         google()
     }
     dependencies {
-        classpath 'com.android.tools.build:gradle:3.0.1'
+        classpath 'com.android.tools.build:gradle:3.1.0'
         classpath 'com.novoda:bintray-release:0.5.0'
     }
     // Workaround for the following test coverage issue. Remove when fixed:
diff --git a/constants.gradle b/constants.gradle
index 3e75567231..4619801390 100644
--- a/constants.gradle
+++ b/constants.gradle
@@ -22,7 +22,7 @@ project.ext {
     minSdkVersion = 14
     targetSdkVersion = 27
     compileSdkVersion = 27
-    buildToolsVersion = '26.0.2'
+    buildToolsVersion = '27.0.3'
     testSupportLibraryVersion = '0.5'
     supportLibraryVersion = '27.0.0'
     playServicesLibraryVersion = '11.4.2'
diff --git a/core_settings.gradle b/core_settings.gradle
index c4914e3040..d1102bcbd6 100644
--- a/core_settings.gradle
+++ b/core_settings.gradle
@@ -17,45 +17,45 @@ if (gradle.ext.has('exoplayerModulePrefix')) {
     modulePrefix += gradle.ext.exoplayerModulePrefix
 }
 
-include modulePrefix + 'library'
+//include modulePrefix + 'library'
 include modulePrefix + 'library-core'
-include modulePrefix + 'library-dash'
+//include modulePrefix + 'library-dash'
 include modulePrefix + 'library-hls'
-include modulePrefix + 'library-smoothstreaming'
+//include modulePrefix + 'library-smoothstreaming'
 include modulePrefix + 'library-ui'
-include modulePrefix + 'testutils'
-include modulePrefix + 'testutils-robolectric'
-include modulePrefix + 'extension-ffmpeg'
-include modulePrefix + 'extension-flac'
-include modulePrefix + 'extension-gvr'
-include modulePrefix + 'extension-ima'
-include modulePrefix + 'extension-cast'
-include modulePrefix + 'extension-mediasession'
-include modulePrefix + 'extension-okhttp'
-include modulePrefix + 'extension-opus'
-include modulePrefix + 'extension-vp9'
-include modulePrefix + 'extension-rtmp'
-include modulePrefix + 'extension-leanback'
+//include modulePrefix + 'testutils'
+//include modulePrefix + 'testutils-robolectric'
+//include modulePrefix + 'extension-ffmpeg'
+//include modulePrefix + 'extension-flac'
+//include modulePrefix + 'extension-gvr'
+//include modulePrefix + 'extension-ima'
+//include modulePrefix + 'extension-cast'
+//include modulePrefix + 'extension-mediasession'
+//include modulePrefix + 'extension-okhttp'
+//include modulePrefix + 'extension-opus'
+//include modulePrefix + 'extension-vp9'
+//include modulePrefix + 'extension-rtmp'
+//include modulePrefix + 'extension-leanback'
 
-project(modulePrefix + 'library').projectDir = new File(rootDir, 'library/all')
+//project(modulePrefix + 'library').projectDir = new File(rootDir, 'library/all')
 project(modulePrefix + 'library-core').projectDir = new File(rootDir, 'library/core')
-project(modulePrefix + 'library-dash').projectDir = new File(rootDir, 'library/dash')
+//project(modulePrefix + 'library-dash').projectDir = new File(rootDir, 'library/dash')
 project(modulePrefix + 'library-hls').projectDir = new File(rootDir, 'library/hls')
-project(modulePrefix + 'library-smoothstreaming').projectDir = new File(rootDir, 'library/smoothstreaming')
+//project(modulePrefix + 'library-smoothstreaming').projectDir = new File(rootDir, 'library/smoothstreaming')
 project(modulePrefix + 'library-ui').projectDir = new File(rootDir, 'library/ui')
-project(modulePrefix + 'testutils').projectDir = new File(rootDir, 'testutils')
-project(modulePrefix + 'testutils-robolectric').projectDir = new File(rootDir, 'testutils_robolectric')
-project(modulePrefix + 'extension-ffmpeg').projectDir = new File(rootDir, 'extensions/ffmpeg')
-project(modulePrefix + 'extension-flac').projectDir = new File(rootDir, 'extensions/flac')
-project(modulePrefix + 'extension-gvr').projectDir = new File(rootDir, 'extensions/gvr')
-project(modulePrefix + 'extension-ima').projectDir = new File(rootDir, 'extensions/ima')
-project(modulePrefix + 'extension-cast').projectDir = new File(rootDir, 'extensions/cast')
-project(modulePrefix + 'extension-mediasession').projectDir = new File(rootDir, 'extensions/mediasession')
-project(modulePrefix + 'extension-okhttp').projectDir = new File(rootDir, 'extensions/okhttp')
-project(modulePrefix + 'extension-opus').projectDir = new File(rootDir, 'extensions/opus')
-project(modulePrefix + 'extension-vp9').projectDir = new File(rootDir, 'extensions/vp9')
-project(modulePrefix + 'extension-rtmp').projectDir = new File(rootDir, 'extensions/rtmp')
-project(modulePrefix + 'extension-leanback').projectDir = new File(rootDir, 'extensions/leanback')
+//project(modulePrefix + 'testutils').projectDir = new File(rootDir, 'testutils')
+//project(modulePrefix + 'testutils-robolectric').projectDir = new File(rootDir, 'testutils_robolectric')
+//project(modulePrefix + 'extension-ffmpeg').projectDir = new File(rootDir, 'extensions/ffmpeg')
+//project(modulePrefix + 'extension-flac').projectDir = new File(rootDir, 'extensions/flac')
+//project(modulePrefix + 'extension-gvr').projectDir = new File(rootDir, 'extensions/gvr')
+//project(modulePrefix + 'extension-ima').projectDir = new File(rootDir, 'extensions/ima')
+//project(modulePrefix + 'extension-cast').projectDir = new File(rootDir, 'extensions/cast')
+//project(modulePrefix + 'extension-mediasession').projectDir = new File(rootDir, 'extensions/mediasession')
+//project(modulePrefix + 'extension-okhttp').projectDir = new File(rootDir, 'extensions/okhttp')
+//project(modulePrefix + 'extension-opus').projectDir = new File(rootDir, 'extensions/opus')
+//project(modulePrefix + 'extension-vp9').projectDir = new File(rootDir, 'extensions/vp9')
+//project(modulePrefix + 'extension-rtmp').projectDir = new File(rootDir, 'extensions/rtmp')
+//project(modulePrefix + 'extension-leanback').projectDir = new File(rootDir, 'extensions/leanback')
 
 if (gradle.ext.has('exoplayerIncludeCronetExtension')
         && gradle.ext.exoplayerIncludeCronetExtension) {
diff --git a/javadoc_library.gradle b/javadoc_library.gradle
index ea193e661c..0dd90747e0 100644
--- a/javadoc_library.gradle
+++ b/javadoc_library.gradle
@@ -20,8 +20,12 @@ android.libraryVariants.all { variant ->
         description = "Generates Javadoc for the ${javadocTitle}."
         title = "ExoPlayer ${javadocTitle}"
         source = variant.javaCompile.source
-        classpath = files(variant.javaCompile.classpath.files,
-	                  project.android.getBootClasspath())
+        doFirst {
+            classpath =
+                files(
+                    variant.javaCompile.classpath.files,
+                    project.android.getBootClasspath())
+        }
         options {
             links "http://docs.oracle.com/javase/7/docs/api/"
             linksOffline "https://developer.android.com/reference",
diff --git a/library/hls/build.gradle b/library/hls/build.gradle
index c2268a3007..8072844bbb 100644
--- a/library/hls/build.gradle
+++ b/library/hls/build.gradle
@@ -35,7 +35,7 @@ android {
 dependencies {
     implementation 'com.android.support:support-annotations:' + supportLibraryVersion
     implementation project(modulePrefix + 'library-core')
-    testImplementation project(modulePrefix + 'testutils-robolectric')
+//    testImplementation project(modulePrefix + 'testutils-robolectric')
 }
 
 ext {
