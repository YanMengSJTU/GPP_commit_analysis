diff --git a/DaoCore/src/de/greenrobot/dao/AbstractConnectionManager.java b/DaoCore/src/de/greenrobot/dao/AbstractConnectionManager.java
index 0838f133..c21eae36 100644
--- a/DaoCore/src/de/greenrobot/dao/AbstractConnectionManager.java
+++ b/DaoCore/src/de/greenrobot/dao/AbstractConnectionManager.java
@@ -35,7 +35,7 @@ public Connection getConnection() throws SQLException
 			onOpen( connection );
 		}
 		
-		int currentVersion = getCurrentVersion();
+		int currentVersion = getCurrentVersion( connection );
 		if ( !hasTables( connection ) )
 		{
 			onCreate( connection );
@@ -44,6 +44,7 @@ else if ( isUpgradable( currentVersion ) )
 		{
 			onUpgrade( connection, currentVersion, newVersion );
 		}
+		setCurrentVersion( connection, newVersion );
 		
 		return connection;
 	}
@@ -62,6 +63,7 @@ private boolean hasTables( Connection connection ) throws SQLException
 		if ( isOpen( connection ) )
 		{
 			DatabaseMetaData metadata = connection.getMetaData();
+			metadata.getDatabaseMajorVersion()
 			String[] types = { "TABLE" };
 			ResultSet resultSet = metadata.getTables( null, null, "%", types );
 			result = resultSet.next();
@@ -71,9 +73,35 @@ private boolean hasTables( Connection connection ) throws SQLException
 	}
 	
 	// FIXME must return the current version from the database not the newVersion
-	private int getCurrentVersion()
+	private int getCurrentVersion( Connection connection )
 	{
-		return newVersion;
+		int version = newVersion;
+		try
+		{
+			ResultSet resultSet = JDBCUtils.query( connection, "PRAGMA user_version" );
+			if ( resultSet.next() )
+			{
+				version = resultSet.getInt( 1 );
+			}
+		}
+		catch ( SQLException e )
+		{
+			e.printStackTrace();
+		}
+		return version;
+	}
+	
+	private void setCurrentVersion( Connection connection, int version )
+	{
+		try
+		{
+			JDBCUtils.execute( connection, "PRAGMA user_version", new Object[]{ version } );
+			this.newVersion = version;
+		}
+		catch ( SQLException e )
+		{
+			e.printStackTrace();
+		}
 	}
 
 	private boolean isUpgradable( int currentVersion )
