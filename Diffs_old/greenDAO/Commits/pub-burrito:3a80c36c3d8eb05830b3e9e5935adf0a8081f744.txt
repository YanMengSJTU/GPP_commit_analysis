diff --git a/DaoCore/src/de/greenrobot/platform/android/util/SQLiteUtil.java b/DaoCore/src/de/greenrobot/platform/android/util/SQLiteUtil.java
deleted file mode 100644
index 529f88bf..00000000
--- a/DaoCore/src/de/greenrobot/platform/android/util/SQLiteUtil.java
+++ /dev/null
@@ -1,29 +0,0 @@
-package de.greenrobot.platform.android.util;
-
-import java.sql.Connection;
-import java.sql.SQLException;
-
-import android.content.Context;
-import android.database.sqlite.SQLiteDatabase;
-
-public class SQLiteUtil
-{	
-	public static SQLiteDatabase from(Connection connection, Context context)
-	{
-		SQLiteDatabase db = null;
-		if (connection != null)
-		{
-			try
-			{
-				String dbname = connection.getCatalog();
-				db = context.openOrCreateDatabase(dbname, 0, null);
-			}
-			catch ( SQLException e )
-			{
-				throw new RuntimeException( "can not get database name", e );
-			}
-		}
-		return db;
-	}
-	
-}
diff --git a/DaoGenerator/src-template/content-provider.ftl b/DaoGenerator/src-template/content-provider.ftl
index e7e3d644..a867e139 100644
--- a/DaoGenerator/src-template/content-provider.ftl
+++ b/DaoGenerator/src-template/content-provider.ftl
@@ -1,7 +1,5 @@
 package ${contentProvider.javaPackage};
 
-import java.sql.Connection;
-
 import android.content.ContentProvider;
 import android.content.ContentResolver;
 import android.content.ContentValues;
@@ -12,7 +10,6 @@ import android.database.sqlite.SQLiteQueryBuilder;
 import android.net.Uri;
 
 import de.greenrobot.dao.DaoLog;
-import de.greenrobot.platform.android.util.SQLiteUtil;
 
 import ${entity.javaPackageDao}.${entity.classNameDao};
 
@@ -24,7 +21,7 @@ import ${entity.javaPackageDao}.${entity.classNameDao};
             android:authorities="${contentProvider.authority}"/>
     */
 
-    public class ${contentProvider.className} extends ContentProvider {
+public class ${contentProvider.className} extends ContentProvider {
 
     public static final String AUTHORITY = "${contentProvider.authority}";
     public static final String BASE_PATH = "${contentProvider.basePath}";
@@ -54,7 +51,7 @@ import ${entity.javaPackageDao}.${entity.classNameDao};
     * This must be set from outside, it's recommended to do this inside your Application object.
     * Subject to change (static isn't nice).
     */
-    public static Connection connection;
+    public static SQLiteDatabase db;
 
     @Override
     public boolean onCreate() {
@@ -66,10 +63,10 @@ import ${entity.javaPackageDao}.${entity.classNameDao};
     }
 
     protected SQLiteDatabase getDatabase() {
-    	if(connection == null) {
-    		throw new IllegalStateException("Connection must be set during content provider is active");
+    	if(db == null) {
+    		db = getContext().openOrCreateDatabase( "greendao-unittest-db.temp", 0, null );
     	}
-    	return SQLiteUtil.from(connection, getContext());
+    	return db;
     }
 
 <#--
diff --git a/DaoGenerator/src/de/greenrobot/daogenerator/DaoGenerator.java b/DaoGenerator/src/de/greenrobot/daogenerator/DaoGenerator.java
index 3026d970..80da7ea3 100644
--- a/DaoGenerator/src/de/greenrobot/daogenerator/DaoGenerator.java
+++ b/DaoGenerator/src/de/greenrobot/daogenerator/DaoGenerator.java
@@ -110,8 +110,8 @@ public void generateAll(Schema schema, String outDir, String outDirTest) throws
                 if (!javaFilename.exists()) {
                     generate(templateDaoUnitTest, outDirTestFile, javaPackageTest, classNameTest, schema, entity);
                 } else {
-                	javaFilename.delete();
-                	generate(templateDaoUnitTest, outDirTestFile, javaPackageTest, classNameTest, schema, entity);
+//                	javaFilename.delete();
+//                	generate(templateDaoUnitTest, outDirTestFile, javaPackageTest, classNameTest, schema, entity);
                     System.out.println("Skipped " + javaFilename.getCanonicalPath());
                 }
             }
diff --git a/DaoTest/src-gen/de/greenrobot/daotest/SimpleEntityContentProvider.java b/DaoTest/src-gen/de/greenrobot/daotest/SimpleEntityContentProvider.java
index aa17849a..ed841f1e 100644
--- a/DaoTest/src-gen/de/greenrobot/daotest/SimpleEntityContentProvider.java
+++ b/DaoTest/src-gen/de/greenrobot/daotest/SimpleEntityContentProvider.java
@@ -1,7 +1,5 @@
 package de.greenrobot.daotest;
 
-import java.sql.Connection;
-
 import android.content.ContentProvider;
 import android.content.ContentResolver;
 import android.content.ContentValues;
@@ -12,7 +10,6 @@
 import android.net.Uri;
 
 import de.greenrobot.dao.DaoLog;
-import de.greenrobot.platform.android.util.SQLiteUtil;
 
 import de.greenrobot.daotest.SimpleEntityDao;
 
@@ -24,7 +21,7 @@
             android:authorities="de.greenrobot.daotest.provider"/>
     */
 
-    public class SimpleEntityContentProvider extends ContentProvider {
+public class SimpleEntityContentProvider extends ContentProvider {
 
     public static final String AUTHORITY = "de.greenrobot.daotest.provider";
     public static final String BASE_PATH = "";
@@ -53,7 +50,7 @@
     * This must be set from outside, it's recommended to do this inside your Application object.
     * Subject to change (static isn't nice).
     */
-    public static Connection connection;
+    public static SQLiteDatabase db;
 
     @Override
     public boolean onCreate() {
@@ -65,10 +62,10 @@ public boolean onCreate() {
     }
 
     protected SQLiteDatabase getDatabase() {
-    	if(connection == null) {
-    		throw new IllegalStateException("Connection must be set during content provider is active");
+    	if(db == null) {
+    		db = getContext().openOrCreateDatabase( "greendao-unittest-db.temp", 0, null );
     	}
-    	return SQLiteUtil.from(connection, getContext());
+    	return db;
     }
 
     @Override
diff --git a/DaoTest/src/de/greenrobot/daotest/contentprovider/SimpleEntityContentProviderTest.java b/DaoTest/src/de/greenrobot/daotest/contentprovider/SimpleEntityContentProviderTest.java
index ef319e62..3de5d1a7 100644
--- a/DaoTest/src/de/greenrobot/daotest/contentprovider/SimpleEntityContentProviderTest.java
+++ b/DaoTest/src/de/greenrobot/daotest/contentprovider/SimpleEntityContentProviderTest.java
@@ -36,12 +36,6 @@ public SimpleEntityContentProviderTest() {
         super(DaoMaster.class);
     }
 
-    @Override
-    protected void setUp() throws Exception {
-        super.setUp();
-        SimpleEntityContentProvider.connection = connection;
-    }
-
     public void testQuery() throws SQLException {
         SimpleEntity entity = new SimpleEntity();
         entity.setSimpleString("hello");
diff --git a/DaoTest/src/de/greenrobot/daotest/query/CountQueryThreadLocalTest.java b/DaoTest/src/de/greenrobot/daotest/query/CountQueryThreadLocalTest.java
index 457a7d78..a2f1e446 100644
--- a/DaoTest/src/de/greenrobot/daotest/query/CountQueryThreadLocalTest.java
+++ b/DaoTest/src/de/greenrobot/daotest/query/CountQueryThreadLocalTest.java
@@ -73,16 +73,16 @@ private void createQueryFromOtherThread() throws InterruptedException {
 
             @Override
             public void run() {
-                QueryBuilder<TestEntity> builder = dao.queryBuilder();
                 try
 				{
+                	QueryBuilder<TestEntity> builder = dao.queryBuilder();
 					builder.where(Properties.SimpleInteger.eq(getSimpleInteger(1)));
+					queryFromOtherThread = builder.buildCount();
 				}
 				catch ( DaoException e )
 				{
 					e.printStackTrace();
 				}
-                queryFromOtherThread = builder.buildCount();
             }
         };
         thread.start();
