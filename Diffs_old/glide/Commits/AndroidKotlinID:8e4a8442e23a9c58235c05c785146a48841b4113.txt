diff --git a/annotation/compiler/build.gradle b/annotation/compiler/build.gradle
index 8ff91d3cb..22a02a63a 100644
--- a/annotation/compiler/build.gradle
+++ b/annotation/compiler/build.gradle
@@ -74,10 +74,17 @@ task proguard(type: ProGuardTask, dependsOn: tasks.jarjar) {
     libraryjars "${System.getProperty('java.home')}/lib/rt.jar"
 }
 
-// Create the standard jar artifact based on our compiled, repackaged and proguarded jar.
+// Replace the contents of the standard jar task with those from our our compiled, repackaged and
+// proguarded jar. Replacing the task itself is possible and looks simpler, but requires
+// reconstructing the task dependency chain and is more complex in practice.
 jar {
     dependsOn proguard
     from zipTree(proguardedJar)
+    exclude { entry ->
+        sourceSets.main.output.files*.absolutePath.any {
+            entry.file.absolutePath.startsWith it
+        }
+    }
 }
 
 apply from: "${rootProject.projectDir}/scripts/upload.gradle"
diff --git a/build.gradle b/build.gradle
index 3d157c29f..a0f6158a8 100644
--- a/build.gradle
+++ b/build.gradle
@@ -26,6 +26,11 @@ subprojects {
         sourceCompatibility = 1.7
         targetCompatibility = 1.7
     }
+
+    // Avoid issues like #2452.
+    tasks.withType(Jar) {
+        duplicatesStrategy = DuplicatesStrategy.FAIL
+    }
 }
 
 subprojects { project ->
