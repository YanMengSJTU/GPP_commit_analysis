diff --git a/.gitignore b/.gitignore
index 34d15a4f..b4a84980 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,19 +1,22 @@
+*.aar
+*.apk
+*.iml
+*.orig
+*.pyc
+*.swp
 .DS_Store
 .git.bak/
-.idea/workspace.xml
-.idea/uiDesigner.xml
+.gradle/
+.idea/
 ant_build/
 bin/
-gen/
-out/
-tmp/
+build/
 classes/
+gen-external-apklibs/
+gen/
 local.properties
+out/
+proguard_logs/
 target/
-*.orig
-*.iml
-**/*.iml
-mopub-sdk/mopub-sdk.iml
-mopub-sample/mopub-sample.iml
-robotium-sample/robotium-sample.iml
+tmp/
 
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 0c3bb146..fcbca267 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -1,4 +1,48 @@
-## Version 2.3 (Jul 17, 2014)
+## Version 3.2.0 (October 17, 2014)
+
+  - **Updated SDK License** Visit [http://www.mopub.com/legal/sdk-license-agreement/](http://www.mopub.com/legal/sdk-license-agreement/) for details.
+  - **Bug Fixes**
+
+## Version 3.1.0 (October 9, 2014)
+
+  - **Updated Facebook SDK Compatibility to 3.18.1**
+  Provided Custom Events for Facebook Banners, Interstitials and Native Ads (included
+  in the extras/ folder) are now compatible with the latest SDK release from Facebook (3.18.1).
+  - **Updated API for Native Ads Custom Event writers**
+  If you are mediating Facebook or InMobi native ads, this change requires you to copy
+  FacebookNative.java and InMobiNative.java custom events from the extras/ folder to
+  com.mopub.nativeads package for compatibility.
+
+## Version 3.0.0 (September 30, 2014)
+
+  - **Location Settings are now SDK-wide**
+    - Calls to `MoPubView#setLocationAwareness` and `MoPubInterstial#setLocationAwareness` are
+    deprecated in favor of `MoPub#setLocationAwareness`
+    - Calls to `MoPubView#setLocationPrecision` and `MoPubInterstitial#setLocationPrecision` are
+    deprecated in favor of `MoPub#setLocationPrecision`
+    - Calls to any of these methods have the effect of setting location awareness and precision
+    globally for the SDK
+  - **Build target SDK is now API Level 19.** If you are building the MoPub SDK from source,
+  modify your dependencies to reference Android 4.4.2, API Level 19. This does not affect the
+  minimum device API level, which remains at API Level 9.
+  - **Source-level support for Gradle projects.** The SDK source now includes a build.gradle file
+   you can use to build source as part of your Gradle project.
+  - **The SDK now uses Play Services 5.0.89**
+  - **Bug fixes:**
+    - Millennial Interstitial caching now properly handles request failures
+    - Fixed bug preventing native ads from loading after a request failure
+
+## Version 2.4.0 (August 28, 2014)
+
+  - **Minimum Android version now at API Level 9.** To use the new SDK, your app must run on Android 2.3.1 (Version 9, Gingerbread) or higher.
+  - **Simplified APIs for inserting native ads.** See [Native Ads Integration](https://github.com/mopub/mopub-android-sdk/wiki/Native-Ads-Integration) for details.
+  - **Automatic ad caching for smooth scrolling.** For native ads, the SDK will now automatically pre-load ads, resulting in smoother scrolling.
+  - **Performance improvements** The SDK now makes more efficient use of memory for image caching and avoids allocating temporary objects while scrolling, resulting in fewer garbage collections.
+  - **Sample app improvements.** An improved sample app allows saving ad unit IDs for testing.
+  - **Bug fixes:**
+    - Banner auto-refresh is now properly re-enabled when resuming your app.
+
+## Version 2.3 (July 17, 2014)
 
   - **Improved impression tracking for Native Ads** Impression tracking for native ads is now more accurate and more efficient.
   - **Streamlined Maven Build and Dependencies** MoPub's Android SDK now depends on the Android v4 Support Library shipped with the Android Build tools. The MoPub Sample App also depends on Google Play Services to use the Android Advertising ID. We recommend building against Play Services in your app as well. For integration instructions, see the [wiki](https://github.com/mopub/mopub-android-sdk/wiki/Getting-Started).
@@ -7,7 +51,7 @@
   - Fixed intermittent NullPointerException in MoPubNative#requestNativeAd; fixes [Github issue #97] (https://github.com/mopub/mopub-android-sdk/issues/97)
   - Fixed an issue where MRAID interstitials could be not be closed.
 
-## Version 2.2 (Jun 19, 2014)
+## Version 2.2 (June 19, 2014)
 
   - **Native ads mediation** release; integration instructions and documentation are available on the [GitHub wiki](https://github.com/mopub/mopub-android-sdk/wiki/Integrating-Native-Third-Party-Ad-Networks). Added custom event native implementations to the native extras directory of the SDK (`/extras/src/com/mopub/nativeads`), with initial support for the following networks:
   	- Facebook Audience Network (`FacebookNative.java`)
@@ -25,7 +69,7 @@
     - Added support for companion banners (shown upon video completion)
   - Added Logcat warnings (and Toasts for debug builds) in cases where all necessary Activity permissions haven't been added to the `AndroidManifest`
 
-## Version 2.0 (Apr 22, 2014)
+## Version 2.0 (April 22, 2014)
 
   - **Native Ads** public release; integration instructions and documentation available on the [GitHub wiki](https://github.com/mopub/mopub-android-sdk/wiki/Native-Ads-Integration)
   - Changed minimum supported Android version to Froyo (Android 2.2, API level 8)
@@ -46,7 +90,7 @@
   - Upgraded the bundled `android-support-v4` library to r19.1.
       - **Note for Maven users:** Newer versions of the `android-support-v4` artifact are unavailable on Maven central, so we have included a small script to update the version in your local artifact repository. Please navigate to the `mopub-sdk` directory, and run `scripts/mavenize_support_library`.
       
-###### Version 2.0.1 (Apr 30, 2014)
+###### Version 2.0.1 (April 30, 2014)
 
   - Fixed cases where VAST Video Interstitials were failing to fire `InterstitialAdListener` callbacks; fixes [GitHub issue #78](https://github.com/mopub/mopub-android-sdk/issues/78)
   - Simplified click tracking logic for HTML ads
@@ -66,7 +110,7 @@
   - All `WebView`s are removed from their parents before `destroy()`; fixes [GitHub issue #38](https://github.com/mopub/mopub-android-sdk/issues/38)
   - Removed previously-deprecated `HTML5AdView`
   
-### Version 1.17.3 (Mar 19, 2014)
+### Version 1.17.3 (March 19, 2014)
 
   - Added safeguards to prevent two different `MoPubInterstitial` objects from listening in on one other's lifecycle callbacks
   - Disabled Javascript loading into `destroy()`ed `WebView`s; fixes [GitHub issue #62](https://github.com/mopub/mopub-android-sdk/issues/62)
@@ -74,27 +118,27 @@
   - MRAID ads that utilize `mraid.open()` now correctly record a click event
   - Added missing `FLAG_ACTIVITY_NEW_TASK` to `VastVideoView`'s intent creation; fixes part of [GitHub issue #56](https://github.com/mopub/mopub-android-sdk/issues/56)
   
-###### Version 1.17.3.1 (Mar 24, 2014)
+###### Version 1.17.3.1 (March 24, 2014)
 
   - Restricted use of methods and fields that require API 4+ (`WebView#removeJavascriptInterface` and `ConnectivityManager`'s connection types)
   
-### Version 1.17.2 (Feb 20, 2014)
+### Version 1.17.2 (February 20, 2014)
 
   - Updated InMobi custom events to support InMobi SDK 4.0.3+ only
   - MRAID viewable property now correctly updates on viewability change
   - `MraidView` properly handles null schemes; fixes [GitHub issue #63](https://github.com/mopub/mopub-android-sdk/pull/63)
   - Internal disk LRU cache correctly hashes keys when checking for existing files
   
-### Version 1.17.1 (Jan 23, 2014)
+### Version 1.17.1 (January 23, 2014)
 
   - Added custom events for Google Play Services. `GooglePlayServicesBanner` and `GooglePlayServicesInterstitial` can be found in the extras directory of the SDK (`/extras/src/com/mopub/mobileads`)
   - Resolved issues with missing annotations on `addJavascriptInterface` when `targetSdkVersion` is set to API level 17 or above
   - Updated MoPub sample application to allow in-app text entry of ad unit IDs
     
-###### Version 1.17.1.1 (Feb 5, 2014)
+###### Version 1.17.1.1 (February 5, 2014)
   - Fixed bug that caused clicks to not be recorded in the MoPub UI (introduced in 1.17.1)
   
-## Version 1.16 (Oct 16, 2013)
+## Version 1.16 (October 16, 2013)
 
   - Improved creative controls
     - Creative flagging
@@ -108,7 +152,7 @@
   - Simplified internal construction and handling of `WebView`s by removing `WebViewPool` and its subclasses
   - Updated mraid.getVersion() to return 2.0
 
-## Version 1.15 (Aug 21, 2013)
+## Version 1.15 (August 21, 2013)
 
 Includes support for ads in the MRAID 2.0 format. MRAID 2.0 allows advertisers to create ads with rich media functionality, including adding calendar events, storing pictures and playing videos in the native video player. To learn more about MRAID 2.0, read our [help article](http://j.mp/16MKSci).
 
@@ -124,7 +168,7 @@ To correctly display ads that ask the user to save a picture (storePicture ads),
 To allow users to play videos using the native video player:  
 * Declare activity `com.mopub.mobileads.MraidVideoPlayerActivity`. This activity is required to support playing videos in the native player and we strongly recommend adding it.
  
-### Version 1.15.2 (Sep 11, 2013) 
+### Version 1.15.2 (September 11, 2013) 
   - Allowed Facebook Support to be disabled optionally with `setFacebookSupported(false)`: 
   	- Use `MoPubInterstitial.setFacebookSupported(false);` for interstitials 
   	- Use `MoPubView.setFacebookSupported(false);` for banners 
@@ -138,19 +182,19 @@ To allow users to play videos using the native video player:
   - Fixed MRAID 2.0 `storePicture` command's messaging when a picture either fails to download or fails to save to device 
   - Expanded MRAID 2.0 `createCalendarEvent` command to support both minute- and second-level granularity  
 
-###### Version 1.15.2.1 (Sep 13, 2013)
+###### Version 1.15.2.1 (September 13, 2013)
   - Made the SDK more resilient to creatives that improperly use the `mopubnativebrowser://` scheme; fixes [GitHub issue #36](https://github.com/mopub/mopub-android-sdk/issues/36)
    
-###### Version 1.15.2.2 (Sep 20, 2013)
+###### Version 1.15.2.2 (September 20, 2013)
   - Removed `WebSettings.setPluginsEnabled()` so the SDK builds against Android API 18; fixes [GitHub issue #28](https://github.com/mopub/mopub-android-sdk/issues/28)
   - AdMob banners are now removed from the view hierarchy before they are destroyed; fixes the reopened [GitHub issue #23](https://github.com/mopub/mopub-android-sdk/issues/23)
   - Prevent ads from launching system features, such as a browser view, until the user has interacted with the ad.
  
-### Version 1.15.1 (Aug 27, 2013)
+### Version 1.15.1 (August 27, 2013)
   - Updated documentation to remove the requirement for certain AndroidManifest permissions
   - Fixed minor bug with MRAID 2.0 `storePicture` command where the user sees a false download completed message
   
-###### Version 1.15.1.1 (Sep 4, 2013)
+###### Version 1.15.1.1 (September 4, 2013)
   - Made the SDK more resilient to unexpected Flash creatives
 
 ## Version 1.14 (May 28, 2013)
@@ -252,4 +296,3 @@ To allow users to play videos using the native video player:
   - Added support for custom events
   - Added network connectivity check before loading an ad
   - Added `OnAdPresentedOverlay` listener methods
-  - Removed unnecessary permissions from the library's manifest
diff --git a/LICENSE b/LICENSE
index 59adcf75..3b96cb9a 100644
--- a/LICENSE
+++ b/LICENSE
@@ -1,10 +1 @@
-Copyright (c) 2010-2013 MoPub Inc.
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
-
-* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
-* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
-* Neither the name of MoPub nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+The MoPub SDK License can be found at [http://www.mopub.com/legal/sdk-license-agreement/](http://www.mopub.com/legal/sdk-license-agreement/).
diff --git a/README.md b/README.md
index 4ddf8eb7..658332a2 100644
--- a/README.md
+++ b/README.md
@@ -27,29 +27,14 @@ Integration instructions are available on the [wiki](https://github.com/mopub/mo
 
 Please view the [changelog](https://github.com/mopub/mopub-android-sdk/blob/master/CHANGELOG.md) for details.
 
-  - **Improved impression tracking for Native Ads** Impression tracking for native ads is now more accurate and more efficient.
+  - **Updated SDK License**
 
-  - **Streamlined Maven Build and Dependencies** MoPub's Android SDK now depends on the Android v4 Support Library shipped with the Android Build tools. The MoPub Sample App also depends on Google Play Services to use the Android Advertising ID. We recommend building against Play Services in your app as well. For integration instructions, see the [wiki](https://github.com/mopub/mopub-android-sdk/wiki/Getting-Started).
-
-  - **Updated Third-Party Network Compatibility** MoPub's provided Custom Events (included in the extras/ folder) are now compatible with the latest SDK releases from Millennial Media (5.3.0), Vungle (3.1.0), and InMobi (4.4.1), Google Play Services (5.0.77).
-
-  - Bug fixes
+  - **Bug Fixes**
 
 ## Requirements
 
-Android 2.2 and up
+Android 2.3.1 (API Version 9) and up
 
 ## License
 
-The MoPub Android SDK is open sourced under the New BSD license:
-
-Copyright (c) 2010-2013 MoPub Inc.
-All rights reserved.
-
-Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
-
-* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
-* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
-* Neither the name of MoPub nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
-
-THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+We have launched a new license as of version 3.2.0. To view the full license, visit [http://www.mopub.com/legal/sdk-license-agreement/](http://www.mopub.com/legal/sdk-license-agreement/).
diff --git a/build.gradle b/build.gradle
new file mode 100644
index 00000000..a61d8f91
--- /dev/null
+++ b/build.gradle
@@ -0,0 +1,14 @@
+buildscript {
+    repositories {   
+        mavenCentral()
+    }
+
+    dependencies {
+        classpath 'com.android.tools.build:gradle:0.12.1+'
+        classpath 'org.robolectric:robolectric-gradle-plugin:0.12.+'
+    }
+}
+
+task wrapper(type: Wrapper) {
+    gradleVersion = '1.12'
+}
diff --git a/extras/src/com/mopub/mobileads/AdColonyInterstitial.java b/extras/src/com/mopub/mobileads/AdColonyInterstitial.java
index 3ed00d2a..6b542709 100644
--- a/extras/src/com/mopub/mobileads/AdColonyInterstitial.java
+++ b/extras/src/com/mopub/mobileads/AdColonyInterstitial.java
@@ -1,49 +1,19 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.os.Handler;
 import android.util.Log;
+
 import com.jirbo.adcolony.AdColony;
 import com.jirbo.adcolony.AdColonyAd;
 import com.jirbo.adcolony.AdColonyAdListener;
 import com.jirbo.adcolony.AdColonyVideoAd;
 import com.mopub.common.util.Json;
 
-import java.util.*;
-import java.util.concurrent.*;
+import java.util.Map;
+import java.util.concurrent.ScheduledThreadPoolExecutor;
+import java.util.concurrent.TimeUnit;
 
 import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR;
 
diff --git a/extras/src/com/mopub/mobileads/FacebookBanner.java b/extras/src/com/mopub/mobileads/FacebookBanner.java
index 2a44a811..d58000f6 100644
--- a/extras/src/com/mopub/mobileads/FacebookBanner.java
+++ b/extras/src/com/mopub/mobileads/FacebookBanner.java
@@ -13,7 +13,7 @@
 import java.util.Map;
 
 /**
- * Tested with Facebook SDK 3.14.1.
+ * Tested with Facebook SDK 3.18.1.
  */
 public class FacebookBanner extends CustomEventBanner implements AdListener {
     private static final String PLACEMENT_ID_KEY = "placement_id";
diff --git a/extras/src/com/mopub/mobileads/FacebookInterstitial.java b/extras/src/com/mopub/mobileads/FacebookInterstitial.java
index 2f7593dc..d6dde364 100644
--- a/extras/src/com/mopub/mobileads/FacebookInterstitial.java
+++ b/extras/src/com/mopub/mobileads/FacebookInterstitial.java
@@ -16,7 +16,7 @@
 import static com.mopub.mobileads.MoPubErrorCode.UNSPECIFIED;
 
 /**
- * Tested with Facebook SDK 3.14.1.
+ * Tested with Facebook SDK 3.18.1.
  */
 public class FacebookInterstitial extends CustomEventInterstitial implements InterstitialAdListener {
     private static final String PLACEMENT_ID_KEY = "placement_id";
diff --git a/extras/src/com/mopub/mobileads/GooglePlayServicesBanner.java b/extras/src/com/mopub/mobileads/GooglePlayServicesBanner.java
index f5a26c6a..a71e120c 100644
--- a/extras/src/com/mopub/mobileads/GooglePlayServicesBanner.java
+++ b/extras/src/com/mopub/mobileads/GooglePlayServicesBanner.java
@@ -19,7 +19,7 @@
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_NO_FILL;
 
 /*
- * Compatible with version 5.0.77 of the Google Play Services SDK.
+ * Compatible with version 5.0.89 of the Google Play Services SDK.
  */
 
 // Note: AdMob ads will now use this class as Google has deprecated the AdMob SDK.
@@ -43,7 +43,6 @@ protected void loadBanner(
             final Map<String, Object> localExtras,
             final Map<String, String> serverExtras) {
         mBannerListener = customEventBannerListener;
-
         final String adUnitId;
         final int adWidth;
         final int adHeight;
@@ -71,7 +70,12 @@ protected void loadBanner(
 
         final AdRequest adRequest = new AdRequest.Builder().build();
 
-        mGoogleAdView.loadAd(adRequest);
+        try {
+            mGoogleAdView.loadAd(adRequest);
+        } catch (NoClassDefFoundError e) {
+            // This can be thrown by Play Services on Honeycomb.
+            mBannerListener.onBannerFailed(NETWORK_NO_FILL);
+        }
     }
 
     @Override
diff --git a/extras/src/com/mopub/mobileads/GooglePlayServicesInterstitial.java b/extras/src/com/mopub/mobileads/GooglePlayServicesInterstitial.java
index 84d433e5..24146033 100644
--- a/extras/src/com/mopub/mobileads/GooglePlayServicesInterstitial.java
+++ b/extras/src/com/mopub/mobileads/GooglePlayServicesInterstitial.java
@@ -13,7 +13,7 @@
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_NO_FILL;
 
 /*
- * Compatible with version 5.0.77 of the Google Play Services SDK.
+ * Compatible with version 5.0.89 of the Google Play Services SDK.
  */
 
 // Note: AdMob ads will now use this class as Google has deprecated the AdMob SDK.
@@ -35,7 +35,6 @@ protected void loadInterstitial(
             final Map<String, Object> localExtras,
             final Map<String, String> serverExtras) {
         mInterstitialListener = customEventInterstitialListener;
-
         final String adUnitId;
 
         if (extrasAreValid(serverExtras)) {
@@ -51,7 +50,12 @@ protected void loadInterstitial(
 
         final AdRequest adRequest = new AdRequest.Builder().build();
 
-        mGoogleInterstitialAd.loadAd(adRequest);
+        try {
+            mGoogleInterstitialAd.loadAd(adRequest);
+        } catch (NoClassDefFoundError e) {
+            // This can be thrown by Play Services on Honeycomb.
+            mInterstitialListener.onInterstitialFailed(NETWORK_NO_FILL);
+        }
     }
 
     @Override
diff --git a/extras/src/com/mopub/mobileads/MillennialBanner.java b/extras/src/com/mopub/mobileads/MillennialBanner.java
index cd49d93f..ac1c4fe6 100644
--- a/extras/src/com/mopub/mobileads/MillennialBanner.java
+++ b/extras/src/com/mopub/mobileads/MillennialBanner.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2011, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- * * Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- * * Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- * * Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
@@ -98,7 +66,11 @@ protected void loadBanner(final Context context, final CustomEventBannerListener
 
     @Override
     protected void onInvalidate() {
-        mMillennialAdView.setListener(null);
+        // mMillennialAdView can be null if loadBanner terminated prematurely (i.e. the associated
+        // serverExtras are invalid).
+        if (mMillennialAdView != null) {
+            mMillennialAdView.setListener(null);
+        }
     }
 
     private boolean extrasAreValid(final Map<String, String> serverExtras) {
diff --git a/extras/src/com/mopub/mobileads/MillennialInterstitial.java b/extras/src/com/mopub/mobileads/MillennialInterstitial.java
index 4100951b..474d2203 100644
--- a/extras/src/com/mopub/mobileads/MillennialInterstitial.java
+++ b/extras/src/com/mopub/mobileads/MillennialInterstitial.java
@@ -1,41 +1,15 @@
-/*
- * Copyright (c) 2011, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- * * Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- * * Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- * * Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.location.Location;
 import android.util.Log;
-import com.millennialmedia.android.*;
+
+import com.millennialmedia.android.MMAd;
+import com.millennialmedia.android.MMException;
+import com.millennialmedia.android.MMInterstitial;
+import com.millennialmedia.android.MMRequest;
+import com.millennialmedia.android.MMSDK;
+import com.millennialmedia.android.RequestListener;
 
 import java.util.Map;
 
@@ -73,15 +47,9 @@ protected void loadInterstitial(final Context context, final CustomEventIntersti
 
         mMillennialInterstitial = new MMInterstitial(context);
         mMillennialInterstitial.setListener(new MillennialInterstitialRequestListener());
-
-        if (mMillennialInterstitial.isAdAvailable()) {
-            Log.d("MoPub", "Millennial interstitial ad already loaded.");
-            mInterstitialListener.onInterstitialLoaded();
-        } else {
-            mMillennialInterstitial.setMMRequest(new MMRequest());
-            mMillennialInterstitial.setApid(apid);
-            mMillennialInterstitial.fetch();
-        }
+        mMillennialInterstitial.setMMRequest(new MMRequest());
+        mMillennialInterstitial.setApid(apid);
+        mMillennialInterstitial.fetch();
     }
 
     @Override
@@ -95,7 +63,11 @@ protected void showInterstitial() {
 
     @Override
     protected void onInvalidate() {
-        mMillennialInterstitial.setListener(null);
+        // mMillennialInterstitial can be null if loadInterstitial terminated prematurely (i.e.
+        // the associated serverExtras are invalid).
+        if (mMillennialInterstitial != null) {
+            mMillennialInterstitial.setListener(null);
+        }
     }
 
     private boolean extrasAreValid(Map<String, String> serverExtras) {
@@ -123,15 +95,23 @@ public void requestCompleted(final MMAd mmAd) {
                 Log.d("MoPub", "Millennial interstitial ad loaded successfully.");
                 mInterstitialListener.onInterstitialLoaded();
             } else {
-                Log.d("MoPub", "Millennial interstitial ad failed to load.");
+                Log.d("MoPub", "Millennial interstitial request completed, but no ad was available.");
                 mInterstitialListener.onInterstitialFailed(NETWORK_INVALID_STATE);
             }
         }
 
         @Override
         public void requestFailed(final MMAd mmAd, final MMException e) {
-            Log.d("MoPub", "Millennial interstitial ad failed to load.");
-            mInterstitialListener.onInterstitialFailed(NETWORK_NO_FILL);
+            if (mMillennialInterstitial == null || e == null) {
+                mInterstitialListener.onInterstitialFailed(NETWORK_INVALID_STATE);
+            } else if (e.getCode() == MMException.CACHE_NOT_EMPTY && mMillennialInterstitial.isAdAvailable()) {
+                // requestFailed can be due to an ad already loaded or an ad failed to load.
+                Log.d("MoPub", "Millennial interstitial loaded successfully from cache.");
+                mInterstitialListener.onInterstitialLoaded();
+            } else {
+                Log.d("MoPub", "Millennial interstitial ad failed to load.");
+                mInterstitialListener.onInterstitialFailed(NETWORK_NO_FILL);
+            }
         }
 
         @Override
diff --git a/extras/src/com/mopub/mobileads/VungleInterstitial.java b/extras/src/com/mopub/mobileads/VungleInterstitial.java
index 03cdb10b..b662a2b7 100644
--- a/extras/src/com/mopub/mobileads/VungleInterstitial.java
+++ b/extras/src/com/mopub/mobileads/VungleInterstitial.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
diff --git a/extras/src/com/mopub/nativeads/FacebookNative.java b/extras/src/com/mopub/nativeads/FacebookNative.java
index 952783cb..868610b5 100644
--- a/extras/src/com/mopub/nativeads/FacebookNative.java
+++ b/extras/src/com/mopub/nativeads/FacebookNative.java
@@ -6,24 +6,20 @@
 import com.facebook.ads.Ad;
 import com.facebook.ads.AdError;
 import com.facebook.ads.AdListener;
+import com.facebook.ads.ImpressionListener;
 import com.facebook.ads.NativeAd;
 import com.facebook.ads.NativeAd.Rating;
 
-import java.lang.ref.WeakReference;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.Map;
 
 /*
- * Tested with Facebook SDK 3.14.1
+ * Tested with Facebook SDK 3.18.1
  */
-public class FacebookNative extends CustomEventNative implements AdListener {
+public class FacebookNative extends CustomEventNative {
     private static final String PLACEMENT_ID_KEY = "placement_id";
 
-    private Context mContext;
-    private NativeAd mNativeAd;
-    private CustomEventNativeListener mCustomEventNativeListener;
-
     // CustomEventNative implementation
     @Override
     protected void loadNativeAd(final Context context,
@@ -31,8 +27,6 @@ protected void loadNativeAd(final Context context,
             final Map<String, Object> localExtras,
             final Map<String, String> serverExtras) {
 
-        mContext = context.getApplicationContext();
-
         final String placementId;
         if (extrasAreValid(serverExtras)) {
             placementId = serverExtras.get(PLACEMENT_ID_KEY);
@@ -41,63 +35,10 @@ protected void loadNativeAd(final Context context,
             return;
         }
 
-        mCustomEventNativeListener = customEventNativeListener;
-
-        mNativeAd = new NativeAd(context, placementId);
-        mNativeAd.setAdListener(this);
-        mNativeAd.loadAd();
-    }
-
-    // AdListener implementation
-    @Override
-    public void onAdLoaded(final Ad ad) {
-        // This identity check is from Facebook's Native API sample code:
-        // https://developers.facebook.com/docs/audience-network/android/native-api
-        if (!mNativeAd.equals(ad) || !mNativeAd.isAdLoaded()) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
-            return;
-        }
-
         final FacebookForwardingNativeAd facebookForwardingNativeAd =
-                new FacebookForwardingNativeAd(mNativeAd);
-
-        final List<String> imageUrls = new ArrayList<String>();
-        final String mainImageUrl = facebookForwardingNativeAd.getMainImageUrl();
-        if (mainImageUrl != null) {
-            imageUrls.add(facebookForwardingNativeAd.getMainImageUrl());
-        }
-        final String iconUrl = facebookForwardingNativeAd.getIconImageUrl();
-        if (iconUrl != null) {
-            imageUrls.add(facebookForwardingNativeAd.getIconImageUrl());
-        }
-
-        preCacheImages(mContext, imageUrls, new ImageListener() {
-            @Override
-            public void onImagesCached() {
-                mCustomEventNativeListener.onNativeAdLoaded(facebookForwardingNativeAd);
-            }
-
-            @Override
-            public void onImagesFailedToCache(NativeErrorCode errorCode) {
-                mCustomEventNativeListener.onNativeAdFailed(errorCode);
-            }
-        });
-    }
-
-    @Override
-    public void onError(final Ad ad, final AdError error) {
-        if (error == AdError.NO_FILL) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_NO_FILL);
-        } else if (error == AdError.INTERNAL_ERROR) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
-        } else {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.UNSPECIFIED);
-        }
-    }
-
-    @Override
-    public void onAdClicked(final Ad ad) {
-        // not used
+                new FacebookForwardingNativeAd(context,
+                        new NativeAd(context, placementId), customEventNativeListener);
+        facebookForwardingNativeAd.loadAd();
     }
 
     private boolean extrasAreValid(final Map<String, String> serverExtras) {
@@ -105,45 +46,109 @@ private boolean extrasAreValid(final Map<String, String> serverExtras) {
         return (placementId != null && placementId.length() > 0);
     }
 
-    static class FacebookForwardingNativeAd extends BaseForwardingNativeAd {
+    static class FacebookForwardingNativeAd extends BaseForwardingNativeAd implements AdListener, ImpressionListener {
         private static final String SOCIAL_CONTEXT_FOR_AD = "socialContextForAd";
-        private static final String APP_RATING_FOR_AD = "appRatingForAd";
-        private static final int IMPRESSION_MIN_TIME_VIEWED = 0;
 
+        private final Context mContext;
         private final NativeAd mNativeAd;
+        private final CustomEventNativeListener mCustomEventNativeListener;
 
-        FacebookForwardingNativeAd(final NativeAd nativeAd) {
-            if (nativeAd == null) {
-                throw new IllegalArgumentException("Facebook NativeAd cannot be null");
-            }
-
+        FacebookForwardingNativeAd(final Context context,
+                final NativeAd nativeAd,
+                final CustomEventNativeListener customEventNativeListener) {
+            mContext = context.getApplicationContext();
             mNativeAd = nativeAd;
+            mCustomEventNativeListener = customEventNativeListener;
+        }
 
-            setTitle(nativeAd.getAdTitle());
-            setText(nativeAd.getAdBody());
+        void loadAd() {
+            mNativeAd.setAdListener(this);
+            mNativeAd.setImpressionListener(this);
+            mNativeAd.loadAd();
+        }
 
-            NativeAd.Image coverImage = nativeAd.getAdCoverImage();
+        // AdListener
+        @Override
+        public void onAdLoaded(final Ad ad) {
+            // This identity check is from Facebook's Native API sample code:
+            // https://developers.facebook.com/docs/audience-network/android/native-api
+            if (!mNativeAd.equals(ad) || !mNativeAd.isAdLoaded()) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
+                return;
+            }
+
+            setTitle(mNativeAd.getAdTitle());
+            setText(mNativeAd.getAdBody());
+
+            NativeAd.Image coverImage = mNativeAd.getAdCoverImage();
             setMainImageUrl(coverImage == null ? null : coverImage.getUrl());
 
-            NativeAd.Image icon = nativeAd.getAdIcon();
+            NativeAd.Image icon = mNativeAd.getAdIcon();
             setIconImageUrl(icon == null ? null : icon.getUrl());
 
-            setCallToAction(nativeAd.getAdCallToAction());
-            setStarRating(getDoubleRating(nativeAd.getAdStarRating()));
+            setCallToAction(mNativeAd.getAdCallToAction());
+            setStarRating(getDoubleRating(mNativeAd.getAdStarRating()));
+
+            addExtra(SOCIAL_CONTEXT_FOR_AD, mNativeAd.getAdSocialContext());
+
+            final List<String> imageUrls = new ArrayList<String>();
+            final String mainImageUrl = getMainImageUrl();
+            if (mainImageUrl != null) {
+                imageUrls.add(getMainImageUrl());
+            }
+            final String iconUrl = getIconImageUrl();
+            if (iconUrl != null) {
+                imageUrls.add(getIconImageUrl());
+            }
 
-            addExtra(SOCIAL_CONTEXT_FOR_AD, nativeAd.getAdSocialContext());
+            preCacheImages(mContext, imageUrls, new ImageListener() {
+                @Override
+                public void onImagesCached() {
+                    mCustomEventNativeListener.onNativeAdLoaded(FacebookForwardingNativeAd.this);
+                }
+
+                @Override
+                public void onImagesFailedToCache(NativeErrorCode errorCode) {
+                    mCustomEventNativeListener.onNativeAdFailed(errorCode);
+                }
+            });
+        }
 
-            setImpressionMinTimeViewed(IMPRESSION_MIN_TIME_VIEWED);
+        @Override
+        public void onError(final Ad ad, final AdError adError) {
+            if (adError == null) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.UNSPECIFIED);
+            } else if (adError.getErrorCode() == AdError.NO_FILL.getErrorCode()) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_NO_FILL);
+            } else if (adError.getErrorCode() == AdError.INTERNAL_ERROR.getErrorCode()) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
+            } else {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.UNSPECIFIED);
+            }
+        }
+
+        @Override
+        public void onAdClicked(final Ad ad) {
+            notifyAdClicked();
+        }
+
+        // ImpressionListener
+        @Override
+        public void onLoggingImpression(final Ad ad) {
+            notifyAdImpressed();
         }
 
+        // BaseForwardingNativeAd
         @Override
-        public void recordImpression() {
-            mNativeAd.logImpression();
+        public void prepare(final View view) {
+            mNativeAd.registerViewForInteraction(view);
+            setOverridingClickTracker(true);
+            setOverridingImpressionTracker(true);
         }
 
         @Override
-        public void handleClick(final View view) {
-            mNativeAd.handleClick();
+        public void clear(final View view) {
+            mNativeAd.unregisterView();
         }
 
         @Override
@@ -151,7 +156,7 @@ public void destroy() {
             mNativeAd.destroy();
         }
 
-        private static Double getDoubleRating(final Rating rating) {
+        private Double getDoubleRating(final Rating rating) {
             if (rating == null) {
                 return null;
             }
diff --git a/extras/src/com/mopub/nativeads/InMobiNative.java b/extras/src/com/mopub/nativeads/InMobiNative.java
index 52fc7cf3..ae00d72a 100644
--- a/extras/src/com/mopub/nativeads/InMobiNative.java
+++ b/extras/src/com/mopub/nativeads/InMobiNative.java
@@ -2,6 +2,7 @@
 
 import android.app.Activity;
 import android.content.Context;
+import android.util.Log;
 import android.view.View;
 import android.view.ViewGroup;
 
@@ -9,7 +10,6 @@
 import com.inmobi.monetization.IMErrorCode;
 import com.inmobi.monetization.IMNative;
 import com.inmobi.monetization.IMNativeListener;
-import com.mopub.common.util.MoPubLog;
 
 import org.json.JSONException;
 import org.json.JSONObject;
@@ -25,12 +25,9 @@
 /*
  * Tested with InMobi SDK 4.4.1
  */
-class InMobiNative extends CustomEventNative implements IMNativeListener {
+class InMobiNative extends CustomEventNative {
     private static final String APP_ID_KEY = "app_id";
 
-    private Context mContext;
-    private CustomEventNativeListener mCustomEventNativeListener;
-
     // CustomEventNative implementation
     @Override
     protected void loadNativeAd(final Context context,
@@ -38,8 +35,6 @@ protected void loadNativeAd(final Context context,
             final Map<String, Object> localExtras,
             final Map<String, String> serverExtras) {
 
-        mContext = context;
-
         if (!(context instanceof Activity)) {
             customEventNativeListener.onNativeAdFailed(NativeErrorCode.NATIVE_ADAPTER_CONFIGURATION_ERROR);
             return;
@@ -54,66 +49,11 @@ protected void loadNativeAd(final Context context,
             return;
         }
 
-        mCustomEventNativeListener = customEventNativeListener;
-
         InMobi.initialize(activity, appId);
-        final IMNative imNative = new IMNative(this);
-        imNative.loadAd();
-    }
-
-    // IMNativeListener implementation
-    @Override
-    public void onNativeRequestSucceeded(final IMNative imNative) {
-        if (imNative == null) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
-            return;
-        }
-
-        final InMobiForwardingNativeAd inMobiForwardingNativeAd;
-        try {
-            inMobiForwardingNativeAd = new InMobiForwardingNativeAd(imNative);
-        } catch (IllegalArgumentException e) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.UNSPECIFIED);
-            return;
-        } catch (JSONException e) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.INVALID_JSON);
-            return;
-        }
-
-        final List<String> imageUrls = new ArrayList<String>();
-        final String mainImageUrl = inMobiForwardingNativeAd.getMainImageUrl();
-        if (mainImageUrl != null) {
-            imageUrls.add(mainImageUrl);
-        }
-        final String iconUrl = inMobiForwardingNativeAd.getIconImageUrl();
-        if (iconUrl != null) {
-            imageUrls.add(iconUrl);
-        }
-
-        preCacheImages(mContext, imageUrls, new ImageListener() {
-            @Override
-            public void onImagesCached() {
-                mCustomEventNativeListener.onNativeAdLoaded(inMobiForwardingNativeAd);
-            }
-
-            @Override
-            public void onImagesFailedToCache(NativeErrorCode errorCode) {
-                mCustomEventNativeListener.onNativeAdFailed(errorCode);
-            }
-        });
-    }
-
-    @Override
-    public void onNativeRequestFailed(final IMErrorCode errorCode) {
-        if (errorCode == IMErrorCode.INVALID_REQUEST) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_REQUEST);
-        } else if (errorCode == IMErrorCode.INTERNAL_ERROR || errorCode == IMErrorCode.NETWORK_ERROR) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
-        } else if (errorCode == IMErrorCode.NO_FILL) {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_NO_FILL);
-        } else {
-            mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.UNSPECIFIED);
-        }
+        final InMobiForwardingNativeAd inMobiForwardingNativeAd =
+                new InMobiForwardingNativeAd(context, customEventNativeListener);
+        inMobiForwardingNativeAd.setIMNative(new IMNative(inMobiForwardingNativeAd));
+        inMobiForwardingNativeAd.loadAd();
     }
 
     private boolean extrasAreValid(final Map<String, String> serverExtras) {
@@ -121,7 +61,7 @@ private boolean extrasAreValid(final Map<String, String> serverExtras) {
         return (placementId != null && placementId.length() > 0);
     }
 
-    static class InMobiForwardingNativeAd extends BaseForwardingNativeAd {
+    static class InMobiForwardingNativeAd extends BaseForwardingNativeAd implements IMNativeListener {
         static final int IMPRESSION_MIN_TIME_VIEWED = 0;
 
         // Modifiable keys
@@ -136,50 +76,84 @@ private boolean extrasAreValid(final Map<String, String> serverExtras) {
         // Constant keys
         static final String URL = "url";
 
-        private final IMNative mImNative;
+        private final Context mContext;
+        private final CustomEventNativeListener mCustomEventNativeListener;
+        private IMNative mImNative;
 
-        InMobiForwardingNativeAd(final IMNative imNative) throws IllegalArgumentException, JSONException {
-            if (imNative == null) {
-                throw new IllegalArgumentException("InMobi Native Ad cannot be null");
-            }
+        InMobiForwardingNativeAd(final Context context,
+                final CustomEventNativeListener customEventNativeListener) {
+            mContext = context.getApplicationContext();
+            mCustomEventNativeListener = customEventNativeListener;
+        }
 
+        void setIMNative(final IMNative imNative) {
             mImNative = imNative;
+        }
 
-            final JSONTokener jsonTokener = new JSONTokener(mImNative.getContent());
-            final JSONObject jsonObject = new JSONObject(jsonTokener);
+        void loadAd() {
+            mImNative.loadAd();
+        }
 
-            setTitle(getJsonValue(jsonObject, TITLE, String.class));
-            setText(getJsonValue(jsonObject, DESCRIPTION, String.class));
+        // IMNativeListener implementation
+        @Override
+        public void onNativeRequestSucceeded(final IMNative imNative) {
+            if (imNative == null) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
+                return;
+            }
 
-            final JSONObject screenShotJsonObject = getJsonValue(jsonObject, SCREENSHOTS, JSONObject.class);
-            if (screenShotJsonObject != null) {
-                setMainImageUrl(getJsonValue(screenShotJsonObject, URL, String.class));
+            try {
+                parseJson(imNative);
+            } catch (JSONException e) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.INVALID_JSON);
+                return;
             }
 
-            final JSONObject iconJsonObject = getJsonValue(jsonObject, ICON, JSONObject.class);
-            if (iconJsonObject != null) {
-                setIconImageUrl(getJsonValue(iconJsonObject, URL, String.class));
+            final List<String> imageUrls = new ArrayList<String>();
+            final String mainImageUrl = getMainImageUrl();
+            if (mainImageUrl != null) {
+                imageUrls.add(mainImageUrl);
             }
 
-            setClickDestinationUrl(getJsonValue(jsonObject, LANDING_URL, String.class));
-            setCallToAction(getJsonValue(jsonObject, CTA, String.class));
+            final String iconUrl = getIconImageUrl();
+            if (iconUrl != null) {
+                imageUrls.add(iconUrl);
+            }
 
-            try {
-                setStarRating(parseDouble(jsonObject.opt(RATING)));
-            } catch (ClassCastException e) {
-                MoPubLog.d("Unable to set invalid star rating for InMobi Native.");
+            preCacheImages(mContext, imageUrls, new ImageListener() {
+                @Override
+                public void onImagesCached() {
+                    mCustomEventNativeListener.onNativeAdLoaded(InMobiForwardingNativeAd.this);
+                }
+
+                @Override
+                public void onImagesFailedToCache(NativeErrorCode errorCode) {
+                    mCustomEventNativeListener.onNativeAdFailed(errorCode);
+                }
+            });
+        }
+
+        @Override
+        public void onNativeRequestFailed(final IMErrorCode errorCode) {
+            if (errorCode == IMErrorCode.INVALID_REQUEST) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_REQUEST);
+            } else if (errorCode == IMErrorCode.INTERNAL_ERROR || errorCode == IMErrorCode.NETWORK_ERROR) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_INVALID_STATE);
+            } else if (errorCode == IMErrorCode.NO_FILL) {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_NO_FILL);
+            } else {
+                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.UNSPECIFIED);
             }
-            setImpressionMinTimeViewed(IMPRESSION_MIN_TIME_VIEWED);
         }
 
         @Override
-        public void prepareImpression(final View view) {
+        public void prepare(final View view) {
             if (view != null && view instanceof ViewGroup) {
                 mImNative.attachToView((ViewGroup) view);
             } else if (view != null && view.getParent() instanceof ViewGroup) {
                 mImNative.attachToView((ViewGroup) view.getParent());
             } else {
-                MoPubLog.e("InMobi did not receive ViewGroup to attachToView, unable to record impressions");
+                Log.e("MoPub", "InMobi did not receive ViewGroup to attachToView, unable to record impressions");
             }
         }
 
@@ -192,5 +166,34 @@ public void handleClick(final View view) {
         public void destroy() {
             mImNative.detachFromView();
         }
+
+        void parseJson(final IMNative imNative) throws JSONException  {
+            final JSONTokener jsonTokener = new JSONTokener(imNative.getContent());
+            final JSONObject jsonObject = new JSONObject(jsonTokener);
+
+            setTitle(getJsonValue(jsonObject, TITLE, String.class));
+            setText(getJsonValue(jsonObject, DESCRIPTION, String.class));
+
+            final JSONObject screenShotJsonObject = getJsonValue(jsonObject, SCREENSHOTS, JSONObject.class);
+            if (screenShotJsonObject != null) {
+                setMainImageUrl(getJsonValue(screenShotJsonObject, URL, String.class));
+            }
+
+            final JSONObject iconJsonObject = getJsonValue(jsonObject, ICON, JSONObject.class);
+            if (iconJsonObject != null) {
+                setIconImageUrl(getJsonValue(iconJsonObject, URL, String.class));
+            }
+
+            setClickDestinationUrl(getJsonValue(jsonObject, LANDING_URL, String.class));
+            setCallToAction(getJsonValue(jsonObject, CTA, String.class));
+
+            try {
+                setStarRating(parseDouble(jsonObject.opt(RATING)));
+            } catch (ClassCastException e) {
+                Log.d("MoPub", "Unable to set invalid star rating for InMobi Native.");
+            }
+            setImpressionMinTimeViewed(IMPRESSION_MIN_TIME_VIEWED);
+        }
+
     }
 }
diff --git a/gradle/wrapper/gradle-wrapper.jar b/gradle/wrapper/gradle-wrapper.jar
new file mode 100644
index 00000000..0087cd3b
Binary files /dev/null and b/gradle/wrapper/gradle-wrapper.jar differ
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
new file mode 100644
index 00000000..51905da1
--- /dev/null
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -0,0 +1,6 @@
+#Tue Aug 05 14:58:07 PDT 2014
+distributionBase=GRADLE_USER_HOME
+distributionPath=wrapper/dists
+zipStoreBase=GRADLE_USER_HOME
+zipStorePath=wrapper/dists
+distributionUrl=https\://services.gradle.org/distributions/gradle-1.12-all.zip
diff --git a/gradlew b/gradlew
new file mode 100755
index 00000000..91a7e269
--- /dev/null
+++ b/gradlew
@@ -0,0 +1,164 @@
+#!/usr/bin/env bash
+
+##############################################################################
+##
+##  Gradle start up script for UN*X
+##
+##############################################################################
+
+# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
+DEFAULT_JVM_OPTS=""
+
+APP_NAME="Gradle"
+APP_BASE_NAME=`basename "$0"`
+
+# Use the maximum available, or set MAX_FD != -1 to use that value.
+MAX_FD="maximum"
+
+warn ( ) {
+    echo "$*"
+}
+
+die ( ) {
+    echo
+    echo "$*"
+    echo
+    exit 1
+}
+
+# OS specific support (must be 'true' or 'false').
+cygwin=false
+msys=false
+darwin=false
+case "`uname`" in
+  CYGWIN* )
+    cygwin=true
+    ;;
+  Darwin* )
+    darwin=true
+    ;;
+  MINGW* )
+    msys=true
+    ;;
+esac
+
+# For Cygwin, ensure paths are in UNIX format before anything is touched.
+if $cygwin ; then
+    [ -n "$JAVA_HOME" ] && JAVA_HOME=`cygpath --unix "$JAVA_HOME"`
+fi
+
+# Attempt to set APP_HOME
+# Resolve links: $0 may be a link
+PRG="$0"
+# Need this for relative symlinks.
+while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+        PRG="$link"
+    else
+        PRG=`dirname "$PRG"`"/$link"
+    fi
+done
+SAVED="`pwd`"
+cd "`dirname \"$PRG\"`/" >&-
+APP_HOME="`pwd -P`"
+cd "$SAVED" >&-
+
+CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar
+
+# Determine the Java command to use to start the JVM.
+if [ -n "$JAVA_HOME" ] ; then
+    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
+        # IBM's JDK on AIX uses strange locations for the executables
+        JAVACMD="$JAVA_HOME/jre/sh/java"
+    else
+        JAVACMD="$JAVA_HOME/bin/java"
+    fi
+    if [ ! -x "$JAVACMD" ] ; then
+        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME
+
+Please set the JAVA_HOME variable in your environment to match the
+location of your Java installation."
+    fi
+else
+    JAVACMD="java"
+    which java >/dev/null 2>&1 || die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
+
+Please set the JAVA_HOME variable in your environment to match the
+location of your Java installation."
+fi
+
+# Increase the maximum file descriptors if we can.
+if [ "$cygwin" = "false" -a "$darwin" = "false" ] ; then
+    MAX_FD_LIMIT=`ulimit -H -n`
+    if [ $? -eq 0 ] ; then
+        if [ "$MAX_FD" = "maximum" -o "$MAX_FD" = "max" ] ; then
+            MAX_FD="$MAX_FD_LIMIT"
+        fi
+        ulimit -n $MAX_FD
+        if [ $? -ne 0 ] ; then
+            warn "Could not set maximum file descriptor limit: $MAX_FD"
+        fi
+    else
+        warn "Could not query maximum file descriptor limit: $MAX_FD_LIMIT"
+    fi
+fi
+
+# For Darwin, add options to specify how the application appears in the dock
+if $darwin; then
+    GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
+fi
+
+# For Cygwin, switch paths to Windows format before running java
+if $cygwin ; then
+    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
+    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`
+
+    # We build the pattern for arguments to be converted via cygpath
+    ROOTDIRSRAW=`find -L / -maxdepth 1 -mindepth 1 -type d 2>/dev/null`
+    SEP=""
+    for dir in $ROOTDIRSRAW ; do
+        ROOTDIRS="$ROOTDIRS$SEP$dir"
+        SEP="|"
+    done
+    OURCYGPATTERN="(^($ROOTDIRS))"
+    # Add a user-defined pattern to the cygpath arguments
+    if [ "$GRADLE_CYGPATTERN" != "" ] ; then
+        OURCYGPATTERN="$OURCYGPATTERN|($GRADLE_CYGPATTERN)"
+    fi
+    # Now convert the arguments - kludge to limit ourselves to /bin/sh
+    i=0
+    for arg in "$@" ; do
+        CHECK=`echo "$arg"|egrep -c "$OURCYGPATTERN" -`
+        CHECK2=`echo "$arg"|egrep -c "^-"`                                 ### Determine if an option
+
+        if [ $CHECK -ne 0 ] && [ $CHECK2 -eq 0 ] ; then                    ### Added a condition
+            eval `echo args$i`=`cygpath --path --ignore --mixed "$arg"`
+        else
+            eval `echo args$i`="\"$arg\""
+        fi
+        i=$((i+1))
+    done
+    case $i in
+        (0) set -- ;;
+        (1) set -- "$args0" ;;
+        (2) set -- "$args0" "$args1" ;;
+        (3) set -- "$args0" "$args1" "$args2" ;;
+        (4) set -- "$args0" "$args1" "$args2" "$args3" ;;
+        (5) set -- "$args0" "$args1" "$args2" "$args3" "$args4" ;;
+        (6) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" ;;
+        (7) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" ;;
+        (8) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" ;;
+        (9) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" "$args8" ;;
+    esac
+fi
+
+# Split up the JVM_OPTS And GRADLE_OPTS values into an array, following the shell quoting and substitution rules
+function splitJvmOpts() {
+    JVM_OPTS=("$@")
+}
+eval splitJvmOpts $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS
+JVM_OPTS[${#JVM_OPTS[*]}]="-Dorg.gradle.appname=$APP_BASE_NAME"
+
+exec "$JAVACMD" "${JVM_OPTS[@]}" -classpath "$CLASSPATH" org.gradle.wrapper.GradleWrapperMain "$@"
diff --git a/gradlew.bat b/gradlew.bat
new file mode 100644
index 00000000..8a0b282a
--- /dev/null
+++ b/gradlew.bat
@@ -0,0 +1,90 @@
+@if "%DEBUG%" == "" @echo off
+@rem ##########################################################################
+@rem
+@rem  Gradle startup script for Windows
+@rem
+@rem ##########################################################################
+
+@rem Set local scope for the variables with windows NT shell
+if "%OS%"=="Windows_NT" setlocal
+
+@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
+set DEFAULT_JVM_OPTS=
+
+set DIRNAME=%~dp0
+if "%DIRNAME%" == "" set DIRNAME=.
+set APP_BASE_NAME=%~n0
+set APP_HOME=%DIRNAME%
+
+@rem Find java.exe
+if defined JAVA_HOME goto findJavaFromJavaHome
+
+set JAVA_EXE=java.exe
+%JAVA_EXE% -version >NUL 2>&1
+if "%ERRORLEVEL%" == "0" goto init
+
+echo.
+echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
+echo.
+echo Please set the JAVA_HOME variable in your environment to match the
+echo location of your Java installation.
+
+goto fail
+
+:findJavaFromJavaHome
+set JAVA_HOME=%JAVA_HOME:"=%
+set JAVA_EXE=%JAVA_HOME%/bin/java.exe
+
+if exist "%JAVA_EXE%" goto init
+
+echo.
+echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
+echo.
+echo Please set the JAVA_HOME variable in your environment to match the
+echo location of your Java installation.
+
+goto fail
+
+:init
+@rem Get command-line arguments, handling Windowz variants
+
+if not "%OS%" == "Windows_NT" goto win9xME_args
+if "%@eval[2+2]" == "4" goto 4NT_args
+
+:win9xME_args
+@rem Slurp the command line arguments.
+set CMD_LINE_ARGS=
+set _SKIP=2
+
+:win9xME_args_slurp
+if "x%~1" == "x" goto execute
+
+set CMD_LINE_ARGS=%*
+goto execute
+
+:4NT_args
+@rem Get arguments from the 4NT Shell from JP Software
+set CMD_LINE_ARGS=%$
+
+:execute
+@rem Setup the command line
+
+set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar
+
+@rem Execute Gradle
+"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %CMD_LINE_ARGS%
+
+:end
+@rem End local scope for the variables with windows NT shell
+if "%ERRORLEVEL%"=="0" goto mainEnd
+
+:fail
+rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
+rem the _cmd.exe /c_ return code!
+if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
+exit /b 1
+
+:mainEnd
+if "%OS%"=="Windows_NT" endlocal
+
+:omega
diff --git a/mopub-sample/AndroidManifest.xml b/mopub-sample/AndroidManifest.xml
index 48338e11..0f350e93 100644
--- a/mopub-sample/AndroidManifest.xml
+++ b/mopub-sample/AndroidManifest.xml
@@ -3,7 +3,8 @@
       package="com.mopub.simpleadsdemo"
       android:versionCode="1"
       android:versionName="1.0">
-    <uses-sdk android:minSdkVersion="8" />
+    <uses-sdk android:minSdkVersion="9" 
+              android:targetSdkVersion="19"/>
 
     <uses-permission android:name="android.permission.INTERNET" />
     <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
@@ -13,8 +14,8 @@
     <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
 
     <application android:icon="@drawable/icon" android:label="@string/app_name">
-	    <activity android:name="com.mopub.simpleadsdemo.SimpleAdsDemo"
-	            android:label="@string/app_name" android:theme="@android:style/Theme.NoTitleBar"
+	    <activity android:name="com.mopub.simpleadsdemo.MoPubSampleActivity"
+	            android:label="@string/app_name"
                 android:configChanges="orientation">
 	        <intent-filter>
 	            <action android:name="android.intent.action.MAIN" />
@@ -32,6 +33,7 @@
 
         <meta-data android:name="com.google.android.gms.version"
                    android:value="@integer/google_play_services_version" />
+
     </application>
 
 </manifest>
diff --git a/mopub-sample/build.gradle b/mopub-sample/build.gradle
new file mode 100644
index 00000000..ea4e63c5
--- /dev/null
+++ b/mopub-sample/build.gradle
@@ -0,0 +1,42 @@
+apply plugin: 'com.android.application'
+
+group = 'com.mopub'
+
+description = '''MoPub SDK'''
+
+android {
+    compileSdkVersion 19
+    buildToolsVersion '19.1.0'
+
+    defaultConfig {
+        versionCode 1
+        versionName "3.2.0"
+        minSdkVersion 9
+        targetSdkVersion 19
+    }
+
+    sourceSets {
+        main {
+            manifest.srcFile 'AndroidManifest.xml'
+            java.srcDirs = ['src/main']
+            resources.srcDirs = ['src/main']
+            aidl.srcDirs = ['src/main']
+            renderscript.srcDirs = ['src/main']
+            res.srcDirs = ['res']
+            assets.srcDirs = ['assets']
+        }
+
+        androidTest.setRoot('src/test')
+    }
+
+    // Note: You will also need a local.properties file to set the location of the SDK in the same 
+    // way that the existing SDK requires, using the sdk.dir property.
+    // Alternatively, you can set an environment variable called ANDROID_HOME. There is no 
+    // difference between the two methods, you can use the one you prefer.
+}
+
+dependencies {
+    compile 'com.android.support:support-v4:19.1.+'
+    compile 'com.google.android.gms:play-services:5.0.89'
+    compile project(':mopub-sdk')
+}
diff --git a/mopub-sample/default.properties b/mopub-sample/default.properties
deleted file mode 100644
index d9bf8c4a..00000000
--- a/mopub-sample/default.properties
+++ /dev/null
@@ -1,12 +0,0 @@
-# This file is automatically generated by Android Tools.
-# Do not modify this file -- YOUR CHANGES WILL BE ERASED!
-#
-# This file must be checked in Version Control Systems.
-#
-# To customize properties used by the Ant build system use,
-# "build.properties", and override values to adapt the script to your
-# project structure.
-
-# Project target.
-target=android-4
-android.library.reference.1=../sdk
diff --git a/mopub-sample/mopub-sample.apk b/mopub-sample/mopub-sample.apk
deleted file mode 100644
index 4c11d4c4..00000000
Binary files a/mopub-sample/mopub-sample.apk and /dev/null differ
diff --git a/mopub-sample/pom.xml b/mopub-sample/pom.xml
index 42580ee3..a1d02f01 100644
--- a/mopub-sample/pom.xml
+++ b/mopub-sample/pom.xml
@@ -22,6 +22,7 @@
     <dependencies>
 
         <!--main-->
+
         <dependency>
             <groupId>com.mopub.mobileads</groupId>
             <artifactId>mopub-sdk</artifactId>
@@ -29,10 +30,17 @@
             <type>jar</type>
         </dependency>
 
+        <dependency>
+            <groupId>com.android.support</groupId>
+            <artifactId>support-v4</artifactId>
+            <version>19.1.0</version>
+            <type>jar</type>
+        </dependency>
+
         <dependency>
             <groupId>com.google.android.gms</groupId>
             <artifactId>play-services</artifactId>
-            <version>5.0.77</version>
+            <version>5.0.89</version>
             <type>aar</type>
         </dependency>
 
@@ -74,7 +82,6 @@
             <scope>test</scope>
         </dependency>
 
-        <!--android & robolectric-->
         <dependency>
             <groupId>org.robolectric</groupId>
             <artifactId>robolectric</artifactId>
@@ -82,10 +89,9 @@
             <scope>test</scope>
         </dependency>
 
-        <dependency>
-            <groupId>com.google.android</groupId>
+        <dependency> <groupId>com.google.android</groupId>
             <artifactId>android</artifactId>
-            <version>4.1.2</version>
+            <version>4.4.2</version>
             <scope>provided</scope>
         </dependency>
     </dependencies>
@@ -109,7 +115,7 @@
                 <configuration>
                     <sdk>
                         <!-- platform or api level (api level 4 = platform 1.6)-->
-                        <platform>16</platform>
+                        <platform>19</platform>
                     </sdk>
                     <undeployBeforeDeploy>true</undeployBeforeDeploy>
                 </configuration>
diff --git a/mopub-sample/proguard.cfg b/mopub-sample/proguard.cfg
index ebae2b03..c1f97c67 100644
--- a/mopub-sample/proguard.cfg
+++ b/mopub-sample/proguard.cfg
@@ -1,40 +1,18 @@
--optimizationpasses 5
--dontusemixedcaseclassnames
--dontskipnonpubliclibraryclasses
--dontpreverify
--verbose
--optimizations !code/simplification/arithmetic,!field/*,!class/merging/*
+# MoPub Proguard Config
+# NOTE: You should also include the Android Proguard config found with the build tools:
+# $ANDROID_HOME/tools/proguard/proguard-android.txt
 
--keep public class * extends android.app.Activity
--keep public class * extends android.app.Application
--keep public class * extends android.app.Service
--keep public class * extends android.content.BroadcastReceiver
--keep public class * extends android.content.ContentProvider
--keep public class * extends android.app.backup.BackupAgentHelper
--keep public class * extends android.preference.Preference
--keep public class com.android.vending.licensing.ILicensingService
+# Keep public classes and methods.
+-keepclassmembers class com.mopub.** { public *; }
+-keep public class com.mopub.**
+-keep public class android.webkit.JavascriptInterface {}
 
--keepclasseswithmembernames class * {
-    native <methods>;
-}
+# Explicitly keep any custom event classes in any package.
+-keep class * extends com.mopub.mobileads.CustomEventBanner {}
+-keep class * extends com.mopub.mobileads.CustomEventInterstitial {}
+-keep class * extends com.mopub.nativeads.CustomEventNative {}
 
--keepclasseswithmembernames class * {
-    public <init>(android.content.Context, android.util.AttributeSet);
-}
+# Support for Android Advertiser ID.
+-keep class com.google.android.gms.common.GooglePlayServicesUtil {*;}
+-keep class com.google.android.gms.ads.identifier.AdvertisingIdClient {*;}
 
--keepclasseswithmembernames class * {
-    public <init>(android.content.Context, android.util.AttributeSet, int);
-}
-
--keepclassmembers enum * {
-    public static **[] values();
-    public static ** valueOf(java.lang.String);
-}
-
--keep class * implements android.os.Parcelable {
-    public static final android.os.Parcelable$Creator *;
-}
-
--keep class com.chartboost.sdk.** {
-    *;
-}
diff --git a/mopub-sample/project.properties b/mopub-sample/project.properties
index 41c4563e..d8ac5433 100644
--- a/mopub-sample/project.properties
+++ b/mopub-sample/project.properties
@@ -8,6 +8,6 @@
 # project structure.
 
 # Project target.
-target=android-16
+target=android-19
 android.library.reference.1=../mopub-sdk
 
diff --git a/mopub-sample/res/layout/about.xml b/mopub-sample/res/layout/about.xml
deleted file mode 100644
index 1bb51563..00000000
--- a/mopub-sample/res/layout/about.xml
+++ /dev/null
@@ -1,40 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-	android:orientation="vertical"
-	android:layout_width="fill_parent"
-	android:layout_height="fill_parent">
-
-<ImageView
-	android:layout_width="fill_parent"
-	android:layout_height="wrap_content"
-	android:gravity="center_horizontal"
-	android:src="@drawable/logo"
-	android:paddingTop="50dp"/>
-
-<RelativeLayout
-	android:id="@+id/toplayout"
-	android:orientation="vertical"
-	android:layout_width="fill_parent"
-	android:layout_height="fill_parent">
-
-	<Button
-		android:id="@+id/opensite"
-		android:layout_width="wrap_content"
-		android:layout_height="wrap_content"
-		android:layout_alignParentBottom="true"
-		android:layout_centerHorizontal="true"
-		android:text="www.mopub.com" />
-
-	<TextView
-		android:layout_width="wrap_content"
-		android:layout_height="wrap_content"
-		android:layout_above="@id/opensite"
-		android:gravity="center_horizontal"
-		android:paddingBottom="20dp"
-		android:textSize = "17sp"
-		android:layout_centerHorizontal="true"
-		android:text="This app shows various ways to integrate ads served by MoPub into your application." />
-
-</RelativeLayout>
-
-</LinearLayout>
diff --git a/mopub-sample/res/layout/ad_config_dialog.xml b/mopub-sample/res/layout/ad_config_dialog.xml
new file mode 100644
index 00000000..dc2c304b
--- /dev/null
+++ b/mopub-sample/res/layout/ad_config_dialog.xml
@@ -0,0 +1,71 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent"
+              android:orientation="vertical"
+              android:padding="@dimen/sample_text_size">
+
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:layout_marginBottom="@dimen/sample_text_size"
+        android:gravity="center_vertical"
+        android:orientation="horizontal">
+
+        <TextView
+            android:layout_width="80sp"
+            android:layout_height="wrap_content"
+            android:text="@string/ad_type"
+            android:textSize="@dimen/sample_text_size"/>
+
+        <Spinner
+            android:id="@+id/add_ad_unit_type"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1"/>
+    </LinearLayout>
+
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:layout_marginBottom="@dimen/sample_text_size"
+        android:orientation="horizontal">
+
+        <TextView
+            android:layout_width="80sp"
+            android:layout_height="wrap_content"
+            android:text="@string/ad_unit_id"
+            android:textSize="@dimen/sample_text_size"/>
+
+        <EditText
+            android:id="@+id/add_ad_unit_id"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1"
+            android:hint="@string/ad_unit_hint"/>
+
+    </LinearLayout>
+
+
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:layout_marginBottom="@dimen/sample_text_size"
+        android:orientation="horizontal">
+
+        <TextView
+            android:layout_width="80sp"
+            android:layout_height="wrap_content"
+            android:text="@string/ad_unit_name"
+            android:textSize="@dimen/sample_text_size"/>
+
+        <EditText
+            android:id="@+id/add_ad_unit_description"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1"
+            android:hint="@string/ad_unit_name_hint"/>
+    </LinearLayout>
+
+</LinearLayout>
diff --git a/mopub-sample/res/layout/ad_configuration_list_item.xml b/mopub-sample/res/layout/ad_configuration_list_item.xml
new file mode 100644
index 00000000..1d12f082
--- /dev/null
+++ b/mopub-sample/res/layout/ad_configuration_list_item.xml
@@ -0,0 +1,54 @@
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    android:orientation="vertical"
+    android:paddingBottom="8dp" >
+
+    <TextView
+        android:id="@+id/separator"
+        style="?android:attr/listSeparatorTextViewStyle"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content" />
+
+    <RelativeLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+        <TextView
+            android:id="@+id/banner_description"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_alignParentTop="true"
+            android:paddingLeft="8dp"
+            android:paddingRight="8dp"
+            android:paddingTop="8dp"
+            android:singleLine="true"
+            android:textColor="?android:attr/textColorPrimary"
+            android:textSize="16sp"
+            android:textStyle="bold" />
+
+        <TextView
+            android:id="@+id/banner_ad_unit_id"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_below="@id/banner_description"
+            android:layout_marginTop="8dp"
+            android:paddingLeft="8dp"
+            android:paddingRight="8dp"
+            android:singleLine="true"
+            android:textColor="?android:attr/textColorSecondary"
+            android:textSize="14sp"
+            android:textStyle="normal" />
+
+        <ImageView
+            android:id="@+id/banner_delete"
+            android:layout_width="48dp"
+            android:layout_height="48dp"
+            android:layout_alignParentRight="true"
+            android:scaleType="centerCrop"
+            android:src="@android:drawable/ic_menu_delete"
+            />
+
+    </RelativeLayout>
+</LinearLayout>
diff --git a/mopub-sample/res/layout/ad_unit_list_fragment.xml b/mopub-sample/res/layout/ad_unit_list_fragment.xml
new file mode 100644
index 00000000..22ac358e
--- /dev/null
+++ b/mopub-sample/res/layout/ad_unit_list_fragment.xml
@@ -0,0 +1,30 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+              android:orientation="vertical"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent"
+              android:paddingBottom="15dp">
+
+    <ListView
+        android:id="@android:id/list"
+        android:layout_width="match_parent"
+        android:layout_height="0dp"
+        android:layout_weight="1"
+        android:layout_marginBottom="10dp"/>
+
+    <Button
+        android:id="@+id/add_ad_unit_button"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:layout_gravity="center_horizontal"
+        android:text="@string/add_ad_unit_button"
+        />
+
+    <TextView
+        android:id="@+id/version_code"
+        android:layout_gravity="center_horizontal"
+        android:textSize="@dimen/detail_text_size"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"/>
+</LinearLayout>
diff --git a/mopub-sample/res/layout/banner_detail_fragment.xml b/mopub-sample/res/layout/banner_detail_fragment.xml
new file mode 100644
index 00000000..b910e373
--- /dev/null
+++ b/mopub-sample/res/layout/banner_detail_fragment.xml
@@ -0,0 +1,62 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    android:orientation="vertical"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent" >
+
+    <TextView
+        android:id="@+id/description"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:paddingTop="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorPrimary"
+        android:textSize="16sp"
+        android:textStyle="bold" />
+
+    <TextView
+        android:id="@+id/ad_unit_id"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorSecondary"
+        android:textSize="14sp"
+        android:textStyle="normal" />
+
+    <LinearLayout
+        android:orientation="horizontal"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+        <EditText
+            android:id="@+id/keywords_field"
+            android:hint="@string/keywords"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="3"
+            android:inputType="text|textFilter|textShortMessage"
+            android:imeOptions="actionDone"
+            android:singleLine="true" />
+
+        <Button
+            android:id="@+id/load_button"
+            android:text="@string/load_ad"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1"
+            android:singleLine="true"/>
+    </LinearLayout>
+
+    <com.mopub.mobileads.MoPubView
+        android:id="@+id/banner_mopubview"
+        android:layout_width="320dp"
+        android:layout_height="50dp"
+        android:layout_gravity="center_horizontal"
+        android:layout_marginTop="10dp">
+    </com.mopub.mobileads.MoPubView>
+</LinearLayout>
diff --git a/mopub-sample/res/layout/banners.xml b/mopub-sample/res/layout/banners.xml
deleted file mode 100644
index 7efb2e83..00000000
--- a/mopub-sample/res/layout/banners.xml
+++ /dev/null
@@ -1,81 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
-     android:layout_width="fill_parent"
-     android:layout_height="fill_parent">
-
-    <LinearLayout
-        android:orientation="vertical"
-        android:layout_width="fill_parent"
-        android:layout_height="wrap_content">
-
-        <LinearLayout
-            android:layout_width="fill_parent"
-            android:layout_height="wrap_content"
-            android:orientation="horizontal">
-
-            <EditText
-                android:id="@+id/banner_adunit_field"
-                android:hint="Ad Unit ID for banner below"
-                android:layout_width="0dp"
-                android:layout_height="wrap_content"
-                android:layout_weight="7"
-                android:inputType="text|textFilter|textShortMessage"
-                android:imeOptions="actionDone"
-                android:singleLine="true" />
-
-            <Button
-                android:id="@+id/banner_load_button"
-                android:text="Load"
-                android:layout_width="wrap_content"
-                android:layout_height="wrap_content"
-                android:layout_weight="1" />
-        </LinearLayout>
-
-        <com.mopub.mobileads.MoPubView
-            android:id="@+id/banner_view"
-            android:layout_width="fill_parent"
-            android:layout_height="50dp"
-            android:background="@drawable/spacer" />
-
-        <LinearLayout
-            android:layout_width="fill_parent"
-            android:layout_height="wrap_content"
-            android:orientation="horizontal"
-            android:layout_marginTop="25dp">
-
-            <EditText
-                android:id="@+id/mrect_adunit_field"
-                android:hint="Ad Unit ID for mrect below"
-                android:layout_width="0dp"
-                android:layout_height="wrap_content"
-                android:layout_weight="7"
-                android:inputType="text|textFilter|textShortMessage"
-                android:imeOptions="actionDone"
-                android:singleLine="true" />
-
-            <Button
-                android:id="@+id/mrect_load_button"
-                android:text="Load"
-                android:layout_width="wrap_content"
-                android:layout_height="wrap_content"
-                android:layout_weight="1" />
-        </LinearLayout>
-
-        <com.mopub.mobileads.MoPubView
-            android:id="@+id/mrect_view"
-            android:layout_width="300dp"
-            android:layout_height="250dp"
-            android:layout_gravity="center_horizontal"
-            android:background="@drawable/spacer" />
-
-        <EditText
-            android:id="@+id/keywords_field"
-            android:hint="Keywords, try 'coffee'"
-            android:layout_width="fill_parent"
-            android:layout_height="wrap_content"
-            android:inputType="text|textFilter|textShortMessage"
-            android:imeOptions="actionDone"
-            android:singleLine="true"
-            android:layout_marginTop="25dp" />
-    </LinearLayout>
-</ScrollView>
diff --git a/mopub-sample/res/layout/empty_ad_row.xml b/mopub-sample/res/layout/empty_ad_row.xml
deleted file mode 100644
index 2266e491..00000000
--- a/mopub-sample/res/layout/empty_ad_row.xml
+++ /dev/null
@@ -1,7 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              android:orientation="vertical"
-              android:layout_width="match_parent"
-              android:layout_height="0dp">
-</LinearLayout>
diff --git a/mopub-sample/res/layout/interstitial_detail_fragment.xml b/mopub-sample/res/layout/interstitial_detail_fragment.xml
new file mode 100644
index 00000000..37aebae5
--- /dev/null
+++ b/mopub-sample/res/layout/interstitial_detail_fragment.xml
@@ -0,0 +1,59 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    android:orientation="vertical"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <TextView
+        android:id="@+id/description"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:paddingTop="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorPrimary"
+        android:textSize="16sp"
+        android:textStyle="bold" />
+
+    <TextView
+        android:id="@+id/ad_unit_id"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorSecondary"
+        android:textSize="14sp"
+        android:textStyle="normal" />
+
+    <EditText
+        android:id="@+id/keywords_field"
+        android:hint="@string/keywords"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:inputType="text|textFilter|textShortMessage"
+        android:imeOptions="actionDone"
+        android:singleLine="true" />
+
+    <LinearLayout
+        android:orientation="horizontal"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+        <Button
+            android:id="@+id/load_button"
+            android:text="@string/load_ad"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1" />
+
+        <Button
+            android:id="@+id/interstitial_show_button"
+            android:text="@string/show_ad"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1"/>
+    </LinearLayout>
+</LinearLayout>
diff --git a/mopub-sample/res/layout/interstitials.xml b/mopub-sample/res/layout/interstitials.xml
deleted file mode 100644
index 0a70c5c3..00000000
--- a/mopub-sample/res/layout/interstitials.xml
+++ /dev/null
@@ -1,40 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
-    android:layout_width="fill_parent"
-    android:layout_height="fill_parent">
-
-    <LinearLayout
-        android:orientation="vertical"
-        android:layout_width="fill_parent"
-        android:layout_height="wrap_content">
-
-        <EditText
-            android:id="@+id/interstitials_edit_text_interstitial"
-            android:hint="Ad Unit ID for interstitial"
-            android:layout_width="fill_parent"
-            android:layout_height="wrap_content"
-            android:inputType="text|textFilter|textShortMessage"
-            android:imeOptions="actionDone"
-            android:singleLine="true" />
-
-        <LinearLayout
-            android:orientation="horizontal"
-            android:layout_width="fill_parent"
-            android:layout_height="wrap_content">
-
-            <Button
-                android:id="@+id/interstitials_load_interstitial"
-                android:text="Load Interstitial"
-                android:layout_width="fill_parent"
-                android:layout_height="wrap_content"
-                android:layout_weight="1"/>
-
-            <Button
-                android:id="@+id/interstitials_show_interstitial"
-                android:text="Show Interstitial"
-                android:layout_width="fill_parent"
-                android:layout_height="wrap_content"
-                android:layout_weight="1"/>
-        </LinearLayout>
-    </LinearLayout>
-</ScrollView>
diff --git a/mopub-sample/res/layout/main.xml b/mopub-sample/res/layout/main.xml
index 32870ba9..682a1cc8 100644
--- a/mopub-sample/res/layout/main.xml
+++ b/mopub-sample/res/layout/main.xml
@@ -1,20 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
-<android.support.v4.app.FragmentTabHost xmlns:android="http://schemas.android.com/apk/res/android"
-    android:id="@+id/tabhost"
-    android:layout_width="fill_parent"
-    android:layout_height="fill_parent">
-    <LinearLayout
-        android:orientation="vertical"
-        android:layout_width="fill_parent"
-        android:layout_height="fill_parent">
-        <TabWidget
-            android:id="@+id/tabs"
-            android:layout_width="fill_parent"
-            android:layout_height="wrap_content" />
-        <FrameLayout
-            android:id="@+id/tabcontent"
-            android:layout_marginTop="64dp"
-            android:layout_width="fill_parent"
-            android:layout_height="fill_parent"/>
-    </LinearLayout>
-</android.support.v4.app.FragmentTabHost>
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:id="@+id/fragment_container"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+</FrameLayout>
diff --git a/mopub-sample/res/layout/mrect_detail_fragment.xml b/mopub-sample/res/layout/mrect_detail_fragment.xml
new file mode 100644
index 00000000..15167ce5
--- /dev/null
+++ b/mopub-sample/res/layout/mrect_detail_fragment.xml
@@ -0,0 +1,61 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    android:orientation="vertical"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <TextView
+        android:id="@+id/description"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:paddingTop="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorPrimary"
+        android:textSize="16sp"
+        android:textStyle="bold" />
+
+    <TextView
+        android:id="@+id/ad_unit_id"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorSecondary"
+        android:textSize="14sp"
+        android:textStyle="normal" />
+
+    <LinearLayout
+        android:orientation="horizontal"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+        <EditText
+            android:id="@+id/keywords_field"
+            android:hint="@string/keywords"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="3"
+            android:inputType="text|textFilter|textShortMessage"
+            android:imeOptions="actionDone"
+            android:singleLine="true" />
+
+        <Button
+            android:id="@+id/load_button"
+            android:text="@string/load_ad"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1" />
+    </LinearLayout>
+
+    <com.mopub.mobileads.MoPubView
+        android:id="@+id/mrect_mopubview"
+        android:layout_width="300dp"
+        android:layout_height="250dp"
+        android:layout_gravity="center_horizontal"
+        android:paddingTop="10dp">
+    </com.mopub.mobileads.MoPubView>
+</LinearLayout>
diff --git a/mopub-sample/res/layout/native_ad_row.xml b/mopub-sample/res/layout/native_ad_list_item.xml
similarity index 80%
rename from mopub-sample/res/layout/native_ad_row.xml
rename to mopub-sample/res/layout/native_ad_list_item.xml
index 663885a5..47528603 100644
--- a/mopub-sample/res/layout/native_ad_row.xml
+++ b/mopub-sample/res/layout/native_ad_list_item.xml
@@ -1,13 +1,13 @@
 <RelativeLayout
     xmlns:android="http://schemas.android.com/apk/res/android"
     android:id="@+id/native_outer_view"
-    android:layout_width="fill_parent"
+    android:layout_width="match_parent"
     android:layout_height="wrap_content"
     android:background="@android:color/white">
     <ImageView android:id="@+id/native_icon_image"
         android:layout_width="64dp"
         android:layout_height="64dp"
-        android:background="#FFFFFF"
+        android:background="@null"
         android:layout_alignParentLeft="true"
         android:layout_alignParentTop="true"
         android:layout_marginTop="10dp"
@@ -36,27 +36,29 @@
 
     <ImageView android:id="@+id/native_main_image"
         android:layout_width="match_parent"
-        android:layout_height="wrap_content"
-        android:adjustViewBounds="true"
+        android:layout_height="@dimen/native_main_image_height"
+        android:background="@null"
         android:layout_marginTop="10dp"
+        android:layout_marginLeft="10dp"
+        android:layout_marginRight="10dp"
         android:layout_below="@+id/native_text"
-        android:layout_alignParentLeft="true" />
+        android:layout_alignParentLeft="true"
+        android:contentDescription="@string/native_main_image"
+        android:scaleType="centerCrop"/>
 
     <Button
         android:id="@+id/native_cta"
         android:layout_width="wrap_content"
         android:layout_height="35dp"
-        android:text="Learn More"
+        android:text="@string/learn_more"
         android:textColor="@android:color/black"
-        android:onClick=""
         android:textStyle="bold"
         android:layout_marginRight="10dp"
         android:layout_marginTop="10dp"
         android:layout_below="@+id/native_main_image"
-        android:textSize="12dp"
+        android:textSize="12sp"
         android:layout_alignParentRight="true"
         android:clickable="true"
         android:paddingBottom="10dp" />
 
 </RelativeLayout>
-
diff --git a/mopub-sample/res/layout/native_gallery_content.xml b/mopub-sample/res/layout/native_gallery_content.xml
new file mode 100644
index 00000000..7bf2d7b4
--- /dev/null
+++ b/mopub-sample/res/layout/native_gallery_content.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0" encoding="utf-8"?>
+<TextView xmlns:android="http://schemas.android.com/apk/res/android"
+          android:id="@+id/native_gallery_content_text"
+          android:layout_width="match_parent"
+          android:layout_height="wrap_content"
+          android:layout_gravity="center"
+          android:padding="16dp"/>
+
diff --git a/mopub-sample/res/layout/native_gallery_fragment.xml b/mopub-sample/res/layout/native_gallery_fragment.xml
new file mode 100644
index 00000000..530ab4bc
--- /dev/null
+++ b/mopub-sample/res/layout/native_gallery_fragment.xml
@@ -0,0 +1,69 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent"
+              android:orientation="vertical">
+
+    <TextView
+        android:id="@+id/description"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:paddingTop="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorPrimary"
+        android:textSize="16sp"
+        android:textStyle="bold"/>
+
+    <TextView
+        android:id="@+id/ad_unit_id"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorSecondary"
+        android:textSize="14sp"
+        android:textStyle="normal"/>
+
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:orientation="horizontal">
+
+        <EditText
+            android:id="@+id/keywords_field"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="3"
+            android:hint="@string/keywords"
+            android:imeOptions="actionDone"
+            android:inputType="text|textFilter|textShortMessage"
+            android:singleLine="true"/>
+
+        <Button
+            android:id="@+id/load_button"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1"
+            android:text="@string/load_ad"/>
+    </LinearLayout>
+
+    <FrameLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+
+        <TextView
+            android:layout_width="match_parent"
+            android:layout_height="match_parent"
+            android:background="#aa333333"
+            android:gravity="center"
+            android:text="@string/swipe_text"/>
+
+        <android.support.v4.view.ViewPager
+            android:id="@+id/gallery_pager"
+            android:layout_width="match_parent"
+            android:layout_height="match_parent"/>
+    </FrameLayout>
+</LinearLayout>
diff --git a/mopub-sample/res/layout/native_list_view_fragment.xml b/mopub-sample/res/layout/native_list_view_fragment.xml
new file mode 100644
index 00000000..ff83a0ee
--- /dev/null
+++ b/mopub-sample/res/layout/native_list_view_fragment.xml
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent"
+              android:orientation="vertical">
+
+    <TextView
+        android:id="@+id/description"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:paddingTop="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorPrimary"
+        android:textSize="16sp"
+        android:textStyle="bold"/>
+
+    <TextView
+        android:id="@+id/ad_unit_id"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:paddingLeft="8dp"
+        android:paddingRight="8dp"
+        android:singleLine="true"
+        android:textColor="?android:attr/textColorSecondary"
+        android:textSize="14sp"
+        android:textStyle="normal"/>
+
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:orientation="horizontal">
+
+        <EditText
+            android:id="@+id/keywords_field"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="3"
+            android:hint="@string/keywords"
+            android:imeOptions="actionDone"
+            android:inputType="text|textFilter|textShortMessage"
+            android:singleLine="true"/>
+
+        <Button
+            android:id="@+id/load_button"
+            android:layout_width="0dp"
+            android:layout_height="wrap_content"
+            android:layout_weight="1"
+            android:text="@string/load_ad"/>
+    </LinearLayout>
+
+    <ListView
+        android:id="@+id/native_list_view"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:padding="5dp"/>
+</LinearLayout>
diff --git a/mopub-sample/res/layout/nativetab.xml b/mopub-sample/res/layout/nativetab.xml
deleted file mode 100644
index 496b30f4..00000000
--- a/mopub-sample/res/layout/nativetab.xml
+++ /dev/null
@@ -1,37 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-    android:orientation="vertical" android:layout_width="match_parent"
-    android:layout_height="match_parent">
-
-    <LinearLayout
-        android:layout_width="fill_parent"
-        android:layout_height="wrap_content"
-        android:orientation="horizontal">
-
-        <EditText
-            android:id="@+id/native_adunit_field"
-            android:hint="Ad Unit ID for native ads"
-            android:layout_width="0dp"
-            android:layout_height="wrap_content"
-            android:layout_weight="7"
-            android:inputType="text|textFilter|textShortMessage"
-            android:imeOptions="actionDone"
-            android:singleLine="true" />
-
-        <Button
-            android:id="@+id/native_load_button"
-            android:text="Load"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:layout_weight="1" />
-
-
-    </LinearLayout>
-
-    <ListView
-        android:id="@+id/list_view"
-        android:layout_width="fill_parent"
-        android:layout_height="wrap_content"
-        android:padding="5dp"/>
-</LinearLayout>
diff --git a/mopub-sample/res/layout/text_row.xml b/mopub-sample/res/layout/text_row.xml
deleted file mode 100644
index 373f0ad2..00000000
--- a/mopub-sample/res/layout/text_row.xml
+++ /dev/null
@@ -1,9 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<TextView
-    xmlns:android="http://schemas.android.com/apk/res/android"
-    android:id="@+id/my_text_view"
-    android:layout_width="match_parent"
-    android:layout_height="75dp"
-    android:gravity="center_vertical"
-    android:padding="10dp"
-    />
\ No newline at end of file
diff --git a/mopub-sample/res/values-sw400dp/dimens.xml b/mopub-sample/res/values-sw400dp/dimens.xml
new file mode 100644
index 00000000..76535326
--- /dev/null
+++ b/mopub-sample/res/values-sw400dp/dimens.xml
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>
+    <dimen name="native_main_image_height">200dp</dimen>
+</resources>
\ No newline at end of file
diff --git a/mopub-sample/res/values-sw600dp/dimens.xml b/mopub-sample/res/values-sw600dp/dimens.xml
new file mode 100644
index 00000000..512868f9
--- /dev/null
+++ b/mopub-sample/res/values-sw600dp/dimens.xml
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>
+    <dimen name="native_main_image_height">300dp</dimen>
+</resources>
\ No newline at end of file
diff --git a/mopub-sample/res/values-sw800dp/dimens.xml b/mopub-sample/res/values-sw800dp/dimens.xml
new file mode 100644
index 00000000..9980b5c3
--- /dev/null
+++ b/mopub-sample/res/values-sw800dp/dimens.xml
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>
+    <dimen name="native_main_image_height">400dp</dimen>
+</resources>
\ No newline at end of file
diff --git a/mopub-sample/res/values/dimens.xml b/mopub-sample/res/values/dimens.xml
new file mode 100644
index 00000000..02259949
--- /dev/null
+++ b/mopub-sample/res/values/dimens.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>
+    <dimen name="sample_text_size">16sp</dimen>
+    <dimen name="spinner_text_size">20sp</dimen>
+    <dimen name="detail_text_size">10sp</dimen>
+    <dimen name="title_size">24sp</dimen>
+    <dimen name="native_main_image_height">200dp</dimen>
+</resources>
\ No newline at end of file
diff --git a/mopub-sample/res/values/strings.xml b/mopub-sample/res/values/strings.xml
index 8a5847b9..6d5db0d9 100644
--- a/mopub-sample/res/values/strings.xml
+++ b/mopub-sample/res/values/strings.xml
@@ -1,5 +1,23 @@
 <?xml version="1.0" encoding="utf-8"?>
 <resources>
-    <string name="hello">Hello World, SimpleAdsDemo!</string>
-    <string name="app_name">SimpleAdsDemo</string>
+    <string name="app_name">MoPub Sample App</string>
+    <string name="keywords">Keywords (optional)</string>
+    <string name="load_ad">Load Ad</string>
+    <string name="show_ad">Show Ad</string>
+    <string name="native_icon_image">native_icon_image</string>
+    <string name="native_main_image">native_main_image</string>
+    <string name="learn_more">Learn More</string>
+    <string name="save">Save Ad Unit</string>
+    <string name="ad_unit_id">Ad Unit Id:</string>
+    <string name="ad_unit_hint">Enter Ad Unit Id</string>
+    <string name="ad_unit_name">Name:</string>
+    <string name="ad_unit_name_hint">Enter Name</string>
+    <string name="ad_type">Ad Type:</string>
+    <string name="add_ad_unit_title">Add an Ad Unit</string>
+    <string name="add_ad_unit_button">Add an Ad Unit</string>
+    <string name="ad_unit_id_banner">b195f8dd8ded45fe847ad89ed1d016da</string>
+    <string name="ad_unit_id_mrect">252412d5e9364a05ab77d9396346d73d</string>
+    <string name="ad_unit_id_interstitial">24534e1901884e398f1253216226017e</string>
+    <string name="ad_unit_id_native">11a17b188668469fb0412708c3d16813</string>
+    <string name="swipe_text"><![CDATA[< Swipe Left & Right >]]></string>
 </resources>
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AboutFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AboutFragment.java
deleted file mode 100644
index 43cae373..00000000
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AboutFragment.java
+++ /dev/null
@@ -1,66 +0,0 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
-package com.mopub.simpleadsdemo;
-
-import android.content.Intent;
-import android.net.Uri;
-import android.os.Bundle;
-import android.support.v4.app.Fragment;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.View.OnClickListener;
-import android.view.ViewGroup;
-import android.widget.Button;
-
-public class AboutFragment extends Fragment {
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-    }
-    
-    
-    public View onCreateView(LayoutInflater inflater, ViewGroup container,
-            Bundle savedInstanceState) {
-    	
-        View aboutTabView = inflater.inflate(R.layout.about, container, false);
-
-        Button mOpenSiteButton = (Button) aboutTabView.findViewById(R.id.opensite);
-        mOpenSiteButton.setOnClickListener(new OnClickListener() {
-            public void onClick(View v) {
-                startActivity(new Intent(android.content.Intent.ACTION_VIEW,
-                        Uri.parse("http://www.mopub.com/")));
-            }
-        });
-        
-        return aboutTabView;
-    }
-}
\ No newline at end of file
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AdUnitDataSource.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AdUnitDataSource.java
new file mode 100644
index 00000000..d6063c29
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AdUnitDataSource.java
@@ -0,0 +1,96 @@
+package com.mopub.simpleadsdemo;
+
+import android.content.ContentValues;
+import android.content.Context;
+import android.database.Cursor;
+import android.database.sqlite.SQLiteDatabase;
+
+import com.mopub.common.logging.MoPubLog;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import static com.mopub.simpleadsdemo.MoPubSQLiteHelper.COLUMN_AD_TYPE;
+import static com.mopub.simpleadsdemo.MoPubSQLiteHelper.COLUMN_AD_UNIT_ID;
+import static com.mopub.simpleadsdemo.MoPubSQLiteHelper.COLUMN_DESCRIPTION;
+import static com.mopub.simpleadsdemo.MoPubSQLiteHelper.COLUMN_ID;
+import static com.mopub.simpleadsdemo.MoPubSQLiteHelper.COLUMN_USER_GENERATED;
+import static com.mopub.simpleadsdemo.MoPubSQLiteHelper.TABLE_AD_CONFIGURATIONS;
+import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType;
+
+class AdUnitDataSource {
+    private MoPubSQLiteHelper mDatabaseHelper;
+    private String[] mAllColumns = {
+            COLUMN_ID,
+            COLUMN_AD_UNIT_ID,
+            COLUMN_DESCRIPTION,
+            COLUMN_USER_GENERATED,
+            COLUMN_AD_TYPE
+    };
+
+    AdUnitDataSource(final Context context) {
+        mDatabaseHelper = new MoPubSQLiteHelper(context);
+    }
+
+    MoPubSampleAdUnit createSampleAdUnit(final MoPubSampleAdUnit sampleAdUnit) {
+        final ContentValues values = new ContentValues();
+        values.put(COLUMN_AD_UNIT_ID, sampleAdUnit.getAdUnitId());
+        values.put(COLUMN_DESCRIPTION, sampleAdUnit.getDescription());
+        values.put(COLUMN_USER_GENERATED, 1);
+        values.put(COLUMN_AD_TYPE, sampleAdUnit.getFragmentClassName());
+        final SQLiteDatabase database = mDatabaseHelper.getWritableDatabase();
+        final long insertId = database.insert(TABLE_AD_CONFIGURATIONS, null, values);
+        final Cursor cursor = database.query(TABLE_AD_CONFIGURATIONS, mAllColumns,
+                COLUMN_ID + " = " + insertId, null, null, null, null);
+        cursor.moveToFirst();
+        final MoPubSampleAdUnit newAdConfiguration = cursorToAdConfiguration(cursor);
+        cursor.close();
+        database.close();
+        return newAdConfiguration;
+    }
+
+    void deleteSampleAdUnit(final MoPubSampleAdUnit adConfiguration) {
+        final long id = adConfiguration.getId();
+        SQLiteDatabase database = mDatabaseHelper.getWritableDatabase();
+        database.delete(TABLE_AD_CONFIGURATIONS, COLUMN_ID + " = " + id, null);
+        MoPubLog.d("Ad Configuration deleted with id: " + id);
+        database.close();
+    }
+
+    List<MoPubSampleAdUnit> getAllAdUnits() {
+        final List<MoPubSampleAdUnit> adConfigurations =
+                new ArrayList<MoPubSampleAdUnit>();
+        SQLiteDatabase database = mDatabaseHelper.getReadableDatabase();
+        final Cursor cursor = database.query(TABLE_AD_CONFIGURATIONS,
+                mAllColumns, null, null, null, null, null);
+        cursor.moveToFirst();
+
+        while (!cursor.isAfterLast()) {
+            final MoPubSampleAdUnit adConfiguration = cursorToAdConfiguration(cursor);
+            adConfigurations.add(adConfiguration);
+            cursor.moveToNext();
+        }
+
+        cursor.close();
+        database.close();
+        return adConfigurations;
+    }
+
+    private MoPubSampleAdUnit cursorToAdConfiguration(final Cursor cursor) {
+        final long id = cursor.getLong(0);
+        final String adUnitId = cursor.getString(1);
+        final String description = cursor.getString(2);
+        final int userGenerated = cursor.getInt(3);
+        final AdType adType = AdType.fromFragmentClassName(cursor.getString(4));
+
+        if (adType == null) {
+            return null;
+        }
+
+        return new MoPubSampleAdUnit.Builder(adUnitId, adType)
+                .description(description)
+                .isUserDefined(userGenerated == 1)
+                .id(id)
+                .build();
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/BannerDetailFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/BannerDetailFragment.java
new file mode 100644
index 00000000..a02dd1a1
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/BannerDetailFragment.java
@@ -0,0 +1,87 @@
+package com.mopub.simpleadsdemo;
+
+import android.os.Bundle;
+import android.support.v4.app.Fragment;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+
+import com.mopub.mobileads.MoPubErrorCode;
+import com.mopub.mobileads.MoPubView;
+
+import static com.mopub.mobileads.MoPubView.BannerAdListener;
+import static com.mopub.simpleadsdemo.Utils.hideSoftKeyboard;
+import static com.mopub.simpleadsdemo.Utils.logToast;
+
+public class BannerDetailFragment extends Fragment implements BannerAdListener {
+    private MoPubView mMoPubView;
+
+    @Override
+    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
+        super.onCreateView(inflater, container, savedInstanceState);
+        final MoPubSampleAdUnit adConfiguration =
+                MoPubSampleAdUnit.fromBundle(getArguments());
+        final View view = inflater.inflate(R.layout.banner_detail_fragment, container, false);
+        final DetailFragmentViewHolder views = DetailFragmentViewHolder.fromView(view);
+        mMoPubView = (MoPubView) view.findViewById(R.id.banner_mopubview);
+        hideSoftKeyboard(views.mKeywordsField);
+
+        final String adUnitId = adConfiguration.getAdUnitId();
+        views.mDescriptionView.setText(adConfiguration.getDescription());
+        views.mAdUnitIdView.setText(adUnitId);
+        views.mLoadButton.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                final String keywords = views.mKeywordsField.getText().toString();
+                loadMoPubView(adUnitId, keywords);
+            }
+        });
+        mMoPubView.setBannerAdListener(this);
+        loadMoPubView(adUnitId, null);
+
+        return view;
+    }
+
+    @Override
+    public void onDestroyView() {
+        super.onDestroyView();
+
+        if (mMoPubView != null) {
+            mMoPubView.destroy();
+            mMoPubView = null;
+        }
+    }
+
+    private void loadMoPubView(final String adUnitId, final String keywords) {
+        mMoPubView.setAdUnitId(adUnitId);
+        mMoPubView.setKeywords(keywords);
+        mMoPubView.loadAd();
+    }
+
+    // BannerAdListener
+    @Override
+    public void onBannerLoaded(MoPubView banner) {
+        logToast(getActivity(), "Banner loaded.");
+    }
+
+    @Override
+    public void onBannerFailed(MoPubView banner, MoPubErrorCode errorCode) {
+        final String errorMessage = (errorCode != null) ? errorCode.toString() : "";
+        logToast(getActivity(), "Banner failed to load: " + errorMessage);
+    }
+
+    @Override
+    public void onBannerClicked(MoPubView banner) {
+        logToast(getActivity(), "Banner clicked.");
+    }
+
+    @Override
+    public void onBannerExpanded(MoPubView banner) {
+        logToast(getActivity(), "Banner expanded.");
+    }
+
+    @Override
+    public void onBannerCollapsed(MoPubView banner) {
+        logToast(getActivity(), "Banner collapsed.");
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/BannersFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/BannersFragment.java
deleted file mode 100644
index 2331a02d..00000000
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/BannersFragment.java
+++ /dev/null
@@ -1,173 +0,0 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
-package com.mopub.simpleadsdemo;
-
-import static com.mopub.simpleadsdemo.Utils.hideSoftKeyboard;
-import static com.mopub.simpleadsdemo.Utils.logToast;
-import static com.mopub.simpleadsdemo.Utils.validateAdUnitId;
-import android.os.Bundle;
-import android.support.v4.app.Fragment;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.View.OnClickListener;
-import android.view.ViewGroup;
-import android.widget.Button;
-import android.widget.EditText;
-
-import com.mopub.mobileads.MoPubErrorCode;
-import com.mopub.mobileads.MoPubView;
-import com.mopub.mobileads.MoPubView.BannerAdListener;
-
-public class BannersFragment extends Fragment implements BannerAdListener {
-    private MoPubView mBannerView;
-    private EditText mBannerAdUnitField;
-
-    private MoPubView mMrectView;
-    private EditText mMrectAdUnitField;
-
-    private EditText mKeywordsField;
-    
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-    }
-    
-    public View onCreateView(LayoutInflater inflater, ViewGroup container,
-            Bundle savedInstanceState) {
-    	
-        OnClickListener fieldFocusListener = new OnClickListener() {
-            public void onClick(View view) {
-            	view.requestFocusFromTouch();
-            }
-        };
-    	
-        View bannerTabView = inflater.inflate(R.layout.banners, container, false);
-        
-        mBannerView = (MoPubView) bannerTabView.findViewById(R.id.banner_view);
-        mBannerAdUnitField = (EditText) bannerTabView.findViewById(R.id.banner_adunit_field);
-        hideSoftKeyboard(mBannerAdUnitField);
-        
-        mBannerAdUnitField.setOnClickListener(fieldFocusListener);
-
-        mMrectView = (MoPubView) bannerTabView.findViewById(R.id.mrect_view);
-        mMrectAdUnitField = (EditText) bannerTabView.findViewById(R.id.mrect_adunit_field);
-        
-        mMrectAdUnitField.setOnClickListener(fieldFocusListener);
-
-        hideSoftKeyboard(mMrectAdUnitField);
-
-        mKeywordsField = (EditText) bannerTabView.findViewById(R.id.keywords_field);
-        hideSoftKeyboard(mKeywordsField);
-
-        Button bannerLoadButton = (Button) bannerTabView.findViewById(R.id.banner_load_button);
-        bannerLoadButton.setOnClickListener(new OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                String adUnitId = mBannerAdUnitField.getText().toString();
-                String keywords = mKeywordsField.getText().toString();
-
-                loadMoPubView(mBannerView, adUnitId, keywords);
-            }
-        });
-
-        Button mrectLoadButton = (Button) bannerTabView.findViewById(R.id.mrect_load_button);
-        mrectLoadButton.setOnClickListener(new OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                String adUnitId = mMrectAdUnitField.getText().toString();
-                String keywords = mKeywordsField.getText().toString();
-
-                loadMoPubView(mMrectView, adUnitId, keywords);
-            }
-        });
-        
-        return bannerTabView;
-    }
-
-    @Override
-	public void onDestroy() {
-        if (mBannerView != null) {
-            mBannerView.destroy();
-        }
-        if (mMrectView != null) {
-            mMrectView.destroy();
-        }
-        super.onDestroy();
-    }
-
-    private void loadMoPubView(MoPubView moPubView, String adUnitId, String keywords) {
-        if (moPubView == null) {
-            logToast(getActivity(), "Unable to inflate MoPubView from xml.");
-            return;
-        }
-
-        try {
-            validateAdUnitId(adUnitId);
-        } catch (IllegalArgumentException exception) {
-            logToast(getActivity(), exception.getMessage());
-            return;
-        }
-
-        moPubView.setBannerAdListener(this);
-        moPubView.setAdUnitId(adUnitId);
-        moPubView.setKeywords(keywords);
-        moPubView.loadAd();
-    }
-
-    /*
-     * MoPubBanner.BannerAdListener implementation
-     */
-    @Override
-    public void onBannerLoaded(MoPubView moPubView) {
-        logToast(getActivity(), "Banner loaded callback.");
-    }
-
-    @Override
-    public void onBannerFailed(MoPubView moPubView, MoPubErrorCode errorCode) {
-        logToast(getActivity(), "Banner failed callback with: " + errorCode.toString());
-    }
-
-    @Override
-    public void onBannerClicked(MoPubView moPubView) {
-        logToast(getActivity(), "Banner clicked callback.");
-    }
-
-    @Override
-    public void onBannerExpanded(MoPubView moPubView) {
-        logToast(getActivity(), "Banner expanded callback.");
-    }
-
-    @Override
-    public void onBannerCollapsed(MoPubView moPubView) {
-        logToast(getActivity(), "Banner collapsed callback.");
-    }
-}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/DetailFragmentViewHolder.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/DetailFragmentViewHolder.java
new file mode 100644
index 00000000..ca780f7e
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/DetailFragmentViewHolder.java
@@ -0,0 +1,31 @@
+package com.mopub.simpleadsdemo;
+
+import android.view.View;
+import android.widget.Button;
+import android.widget.EditText;
+import android.widget.TextView;
+
+class DetailFragmentViewHolder {
+    final TextView mDescriptionView;
+    final Button mLoadButton;
+    final TextView mAdUnitIdView;
+    final EditText mKeywordsField;
+
+    DetailFragmentViewHolder(final TextView descriptionView, final TextView adUnitIdView,
+            final EditText keywordsField, final Button loadButton) {
+        mDescriptionView = descriptionView;
+        mAdUnitIdView = adUnitIdView;
+        mKeywordsField = keywordsField;
+        mLoadButton = loadButton;
+    }
+
+    static DetailFragmentViewHolder fromView(final View view) {
+        final TextView descriptionView = (TextView) view.findViewById(R.id.description);
+        final TextView adUnitIdView = (TextView) view.findViewById(R.id.ad_unit_id);
+        final EditText keywordsField = (EditText) view.findViewById(R.id.keywords_field);
+        final Button loadButton = (Button) view.findViewById(R.id.load_button);
+
+        return new DetailFragmentViewHolder(descriptionView, adUnitIdView,
+                keywordsField, loadButton);
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialDetailFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialDetailFragment.java
new file mode 100644
index 00000000..2314e718
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialDetailFragment.java
@@ -0,0 +1,94 @@
+package com.mopub.simpleadsdemo;
+
+import android.os.Bundle;
+import android.support.v4.app.Fragment;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.Button;
+
+import com.mopub.mobileads.MoPubErrorCode;
+import com.mopub.mobileads.MoPubInterstitial;
+
+import static com.mopub.mobileads.MoPubInterstitial.InterstitialAdListener;
+import static com.mopub.simpleadsdemo.Utils.hideSoftKeyboard;
+import static com.mopub.simpleadsdemo.Utils.logToast;
+
+public class InterstitialDetailFragment extends Fragment implements InterstitialAdListener {
+    private MoPubInterstitial mMoPubInterstitial;
+    private Button mShowButton;
+
+    @Override
+    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
+        super.onCreateView(inflater, container, savedInstanceState);
+        final MoPubSampleAdUnit adConfiguration =
+                MoPubSampleAdUnit.fromBundle(getArguments());
+        final View view = inflater.inflate(R.layout.interstitial_detail_fragment, container, false);
+        final DetailFragmentViewHolder views = DetailFragmentViewHolder.fromView(view);
+        hideSoftKeyboard(views.mKeywordsField);
+
+        final String adUnitId = adConfiguration.getAdUnitId();
+        views.mDescriptionView.setText(adConfiguration.getDescription());
+        views.mAdUnitIdView.setText(adUnitId);
+        views.mLoadButton.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                final String keywords = views.mKeywordsField.getText().toString();
+                mMoPubInterstitial = new MoPubInterstitial(getActivity(), adUnitId);
+                mMoPubInterstitial.setInterstitialAdListener(InterstitialDetailFragment.this);
+                mMoPubInterstitial.setKeywords(keywords);
+                mMoPubInterstitial.load();
+                mShowButton.setEnabled(false);
+            }
+        });
+        mShowButton = (Button) view.findViewById(R.id.interstitial_show_button);
+        mShowButton.setEnabled(false);
+        mShowButton.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                mMoPubInterstitial.show();
+            }
+        });
+
+        return view;
+    }
+
+    @Override
+    public void onDestroyView() {
+        super.onDestroyView();
+
+        if (mMoPubInterstitial != null) {
+            mMoPubInterstitial.destroy();
+            mMoPubInterstitial = null;
+        }
+    }
+
+    // InterstitialAdListener implementation
+    @Override
+    public void onInterstitialLoaded(MoPubInterstitial interstitial) {
+        mShowButton.setEnabled(true);
+        logToast(getActivity(), "Interstitial loaded.");
+    }
+
+    @Override
+    public void onInterstitialFailed(MoPubInterstitial interstitial, MoPubErrorCode errorCode) {
+        final String errorMessage = (errorCode != null) ? errorCode.toString() : "";
+        logToast(getActivity(), "Interstitial failed to load: " + errorMessage);
+    }
+
+    @Override
+    public void onInterstitialShown(MoPubInterstitial interstitial) {
+        mShowButton.setEnabled(false);
+        logToast(getActivity(), "Interstitial shown.");
+    }
+
+    @Override
+    public void onInterstitialClicked(MoPubInterstitial interstitial) {
+        logToast(getActivity(), "Interstitial clicked.");
+    }
+
+    @Override
+    public void onInterstitialDismissed(MoPubInterstitial interstitial) {
+        logToast(getActivity(), "Interstitial dismissed.");
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialFragment.java
deleted file mode 100644
index 38c895d0..00000000
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialFragment.java
+++ /dev/null
@@ -1,144 +0,0 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
-package com.mopub.simpleadsdemo;
-
-import static com.mopub.simpleadsdemo.Utils.hideSoftKeyboard;
-import static com.mopub.simpleadsdemo.Utils.logToast;
-import static com.mopub.simpleadsdemo.Utils.validateAdUnitId;
-import android.os.Bundle;
-import android.support.v4.app.Fragment;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.View.OnClickListener;
-import android.view.ViewGroup;
-import android.widget.Button;
-import android.widget.EditText;
-
-import com.mopub.mobileads.MoPubErrorCode;
-import com.mopub.mobileads.MoPubInterstitial;
-import com.mopub.mobileads.MoPubInterstitial.InterstitialAdListener;
-
-public class InterstitialFragment extends Fragment implements InterstitialAdListener {
-    private MoPubInterstitial mMoPubInterstitial;
-    private EditText mInterstitialAdUnitField;
-    
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-    }
-    
-    public View onCreateView(LayoutInflater inflater, ViewGroup container,
-            Bundle savedInstanceState) {
-    	
-        View interstitialTabView = inflater.inflate(R.layout.interstitials, container, false);
-
-        OnClickListener fieldFocusListener = new OnClickListener() {
-            public void onClick(View view) {
-            	view.requestFocusFromTouch();
-            }
-        };
-       
-        mInterstitialAdUnitField = (EditText) interstitialTabView.findViewById(R.id.interstitials_edit_text_interstitial);
-        mInterstitialAdUnitField.setOnClickListener(fieldFocusListener);
-        hideSoftKeyboard(mInterstitialAdUnitField);
-
-        Button interstitialLoadButton = (Button) interstitialTabView.findViewById(R.id.interstitials_load_interstitial);
-        interstitialLoadButton.setOnClickListener(new OnClickListener() {
-            public void onClick(View v) {
-                String adUnitId = mInterstitialAdUnitField.getText().toString();
-
-                try {
-                    validateAdUnitId(adUnitId);
-
-                    mMoPubInterstitial = new MoPubInterstitial(InterstitialFragment.this.getActivity(), adUnitId);
-                    mMoPubInterstitial.setInterstitialAdListener(InterstitialFragment.this);
-                    mMoPubInterstitial.load();
-                } catch (IllegalArgumentException exception) {
-                    String message = exception.getMessage();
-
-                    if (message != null) {
-                        logToast(InterstitialFragment.this.getActivity(), message);
-                    }
-                }
-            }
-        });
-        
-        Button interstitialShowButton = (Button) interstitialTabView.findViewById(R.id.interstitials_show_interstitial);
-        interstitialShowButton.setOnClickListener(new OnClickListener() {
-            public void onClick(View v) {
-                if (mMoPubInterstitial != null && mMoPubInterstitial.isReady()) {
-                    mMoPubInterstitial.show();
-                } else {
-                    logToast(InterstitialFragment.this.getActivity(), "Interstitial was not ready. Try reloading.");
-                }
-            }
-        });
-        
-        return interstitialTabView;
-    }
-
-    @Override
-    public void onDestroy() {
-        if (mMoPubInterstitial != null) {
-            mMoPubInterstitial.destroy();
-        }
-        super.onDestroy();
-    }
-
-    /*
-     * MoPubInterstitial.InterstitialAdListener implementation
-     */
-    @Override
-    public void onInterstitialLoaded(MoPubInterstitial interstitial) {
-        logToast(getActivity(), "Interstitial loaded successfully.");
-    }
-
-    @Override
-    public void onInterstitialFailed(MoPubInterstitial interstitial, MoPubErrorCode errorCode) {
-        logToast(getActivity(), "Interstitial failed to load with error: " + errorCode.toString());
-    }
-
-    @Override
-    public void onInterstitialShown(MoPubInterstitial interstitial) {
-        logToast(getActivity(), "Interstitial shown.");
-    }
-
-    @Override
-    public void onInterstitialClicked(MoPubInterstitial interstitial) {
-        logToast(getActivity(), "Interstitial clicked.");
-    }
-
-    @Override
-    public void onInterstitialDismissed(MoPubInterstitial interstitial) {
-        logToast(getActivity(), "Interstitial dismissed.");
-    }
-}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubListFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubListFragment.java
new file mode 100644
index 00000000..d655656c
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubListFragment.java
@@ -0,0 +1,247 @@
+package com.mopub.simpleadsdemo;
+
+import android.app.AlertDialog;
+import android.app.Dialog;
+import android.content.DialogInterface;
+import android.os.Bundle;
+import android.support.v4.app.DialogFragment;
+import android.support.v4.app.Fragment;
+import android.support.v4.app.FragmentTransaction;
+import android.support.v4.app.ListFragment;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ArrayAdapter;
+import android.widget.Button;
+import android.widget.EditText;
+import android.widget.ListView;
+import android.widget.Spinner;
+import android.widget.TextView;
+import android.widget.Toast;
+
+import com.mopub.common.MoPub;
+import com.mopub.common.logging.MoPubLog;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType;
+
+
+interface TrashCanClickListener {
+    void onTrashCanClicked(MoPubSampleAdUnit adUnit);
+}
+
+public class MoPubListFragment extends ListFragment implements TrashCanClickListener {
+    private MoPubSampleListAdapter mAdapter;
+    private AdUnitDataSource mAdUnitDataSource;
+
+    private static final AdType[] adTypes = AdType.values();
+
+    @Override
+    public void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        initializeAdapter();
+    }
+
+    @Override
+    public View onCreateView(final LayoutInflater inflater, final ViewGroup container, final Bundle savedInstanceState) {
+        final View view = inflater.inflate(R.layout.ad_unit_list_fragment, container, false);
+        final Button button = (Button) view.findViewById(R.id.add_ad_unit_button);
+        final TextView versionCodeView = (TextView) view.findViewById(R.id.version_code);
+        versionCodeView.setText("SDK Version " + MoPub.SDK_VERSION);
+
+        button.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(final View view) {
+                onAddClicked(view);
+            }
+        });
+
+        return view;
+    }
+
+    @Override
+    public void onListItemClick(ListView listView, View view, int position, long id) {
+        super.onListItemClick(listView, view, position, id);
+
+        final MoPubSampleAdUnit adConfiguration = mAdapter.getItem(position);
+
+        final FragmentTransaction fragmentTransaction =
+                getActivity().getSupportFragmentManager().beginTransaction();
+
+        final Class<? extends Fragment> fragmentClass = adConfiguration.getFragmentClass();
+        final Fragment fragment;
+
+        try {
+            fragment = fragmentClass.newInstance();
+        } catch (java.lang.InstantiationException e) {
+            MoPubLog.e("Error creating fragment for class " + fragmentClass, e);
+            return;
+        } catch (IllegalAccessException e) {
+            MoPubLog.e("Error creating fragment for class " + fragmentClass, e);
+            return;
+        }
+
+        fragment.setArguments(adConfiguration.toBundle());
+
+        fragmentTransaction
+                .replace(R.id.fragment_container, fragment)
+                .addToBackStack(null)
+                .commit();
+    }
+
+    @Override
+    public void onTrashCanClicked(final MoPubSampleAdUnit adUnit) {
+        final DialogFragment deleteConfirmation = DeleteDialogFragment.newInstance(adUnit);
+        deleteConfirmation.setTargetFragment(this, 0);
+        deleteConfirmation.show(getActivity().getSupportFragmentManager(), "delete");
+    }
+
+    public void onAddClicked(final View view) {
+        final AddDialogFragment dialogFragment = AddDialogFragment.newInstance();
+        dialogFragment.setTargetFragment(this, 0);
+        dialogFragment.show(getActivity().getSupportFragmentManager(), "add");
+    }
+
+    @Override
+    public void onResume() {
+        super.onResume();
+        Utils.hideSoftKeyboard(getListView());
+    }
+
+    private void initializeAdapter() {
+        mAdapter = new MoPubSampleListAdapter(getActivity(), this);
+
+        mAdUnitDataSource = new AdUnitDataSource(getActivity());
+
+        // If you have a large amount of data, this loading work should be done in the background.
+        final List<MoPubSampleAdUnit> adUnits = mAdUnitDataSource.getAllAdUnits();
+        for (final MoPubSampleAdUnit adUnit : adUnits) {
+            mAdapter.add(adUnit);
+        }
+
+        mAdapter.sort(MoPubSampleAdUnit.COMPARATOR);
+        setListAdapter(mAdapter);
+    }
+
+    @Override
+    public void onPause() {
+        super.onPause();
+    }
+
+    void addAdUnit(final MoPubSampleAdUnit moPubSampleAdUnit) {
+        MoPubSampleAdUnit createdAdUnit = mAdUnitDataSource.createSampleAdUnit(moPubSampleAdUnit);
+        mAdapter.add(createdAdUnit);
+        mAdapter.sort(MoPubSampleAdUnit.COMPARATOR);
+    }
+
+    void deleteAdUnit(final MoPubSampleAdUnit moPubSampleAdUnit) {
+        mAdUnitDataSource.deleteSampleAdUnit(moPubSampleAdUnit);
+        mAdapter.remove(moPubSampleAdUnit);
+        mAdapter.sort(MoPubSampleAdUnit.COMPARATOR);
+    }
+
+    public static class DeleteDialogFragment extends DialogFragment {
+        public static DeleteDialogFragment newInstance(MoPubSampleAdUnit adUnit) {
+            final DeleteDialogFragment deleteDialogFragment = new DeleteDialogFragment();
+            Bundle args = adUnit.toBundle();
+            deleteDialogFragment.setArguments(args);
+            return deleteDialogFragment;
+        }
+
+        @Override
+        public Dialog onCreateDialog(final Bundle savedInstanceState) {
+            final Bundle args = getArguments();
+
+            return new AlertDialog.Builder(getActivity())
+                    .setTitle("Delete Ad Unit " + args.getString(MoPubSampleAdUnit.DESCRIPTION) + "?")
+                    .setPositiveButton("Delete", new DialogInterface.OnClickListener() {
+                        @Override
+                        public void onClick(final DialogInterface dialogInterface, final int i) {
+                            final MoPubListFragment listFragment = (MoPubListFragment) getTargetFragment();
+                            listFragment.deleteAdUnit(MoPubSampleAdUnit.fromBundle(args));
+                        }
+                    })
+                    .setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
+                        @Override
+                        public void onClick(final DialogInterface dialogInterface, final int i) {
+                            dismiss();
+                        }
+                    })
+                    .setCancelable(true)
+                    .create();
+        }
+    }
+
+    public static class AddDialogFragment extends DialogFragment {
+        public static AddDialogFragment newInstance() {
+            return new AddDialogFragment();
+        }
+
+        @Override
+        public Dialog onCreateDialog(final Bundle savedInstanceState) {
+            AlertDialog dialog = new AlertDialog.Builder(getActivity())
+                    .setTitle("Add a custom Ad Unit")
+                    .setPositiveButton("Save ad unit", new DialogInterface.OnClickListener() {
+                        @Override
+                        public void onClick(final DialogInterface dialogInterface, final int i) {
+                            AlertDialog dialog = (AlertDialog) dialogInterface;
+                            final EditText adUnitIdField =
+                                    (EditText) dialog.findViewById(R.id.add_ad_unit_id);
+                            final Spinner adTypeSpinner =
+                                    (Spinner) dialog.findViewById(R.id.add_ad_unit_type);
+                            final EditText descriptionField =
+                                    (EditText) dialog.findViewById(R.id.add_ad_unit_description);
+
+                            // Verify data:
+                            try {
+                                Utils.validateAdUnitId(adUnitIdField.getText().toString());
+                            } catch (IllegalArgumentException e) {
+                                // Input is not valid.
+                                Toast toast = Toast.makeText(getActivity(), "Ad Unit ID invalid",
+                                        Toast.LENGTH_SHORT);
+                                toast.show();
+                                return;
+                            }
+
+                            // Create ad unit and save it in the database:
+                            final String adUnitId = adUnitIdField.getText().toString();
+                            final AdType adType = adTypes[adTypeSpinner.getSelectedItemPosition()];
+                            final String description = descriptionField.getText().toString();
+                            final MoPubSampleAdUnit sampleAdUnit =
+                                    new MoPubSampleAdUnit.Builder(adUnitId, adType)
+                                            .description(description)
+                                            .isUserDefined(true)
+                                            .build();
+                            ((MoPubListFragment) getTargetFragment()).addAdUnit(sampleAdUnit);
+                            dismiss();
+                        }
+                    })
+                    .setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
+                        @Override
+                        public void onClick(final DialogInterface dialogInterface, final int i) {
+                            dismiss();
+                        }
+                    })
+                    .setCancelable(true)
+                    .create();
+
+            // Inflate and add our custom layout to the dialog.
+            final View view = dialog.getLayoutInflater()
+                    .inflate(R.layout.ad_config_dialog, null);
+            final Spinner spinner = (Spinner) view.findViewById(R.id.add_ad_unit_type);
+            final List<String> adTypeStrings = new ArrayList<String>(adTypes.length);
+
+            for (final AdType adType : adTypes) {
+                adTypeStrings.add(adType.getName());
+            }
+
+            spinner.setAdapter(new ArrayAdapter<String>(getActivity(),
+                    android.R.layout.simple_spinner_dropdown_item, android.R.id.text1, adTypeStrings));
+            dialog.setView(view);
+            return dialog;
+        }
+    }
+}
+
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSQLiteHelper.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSQLiteHelper.java
new file mode 100644
index 00000000..35f1862b
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSQLiteHelper.java
@@ -0,0 +1,116 @@
+package com.mopub.simpleadsdemo;
+
+import android.content.ContentValues;
+import android.content.Context;
+import android.database.sqlite.SQLiteDatabase;
+import android.database.sqlite.SQLiteOpenHelper;
+import android.util.Log;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType.BANNER;
+import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType.CUSTOM_NATIVE;
+import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType.INTERSTITIAL;
+import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType.LIST_VIEW;
+import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType.MRECT;
+
+class MoPubSQLiteHelper extends SQLiteOpenHelper {
+    public static final String TABLE_AD_CONFIGURATIONS = "adConfigurations";
+    public static final String COLUMN_ID = "_id";
+    public static final String COLUMN_AD_UNIT_ID = "adUnitId";
+    public static final String COLUMN_DESCRIPTION = "description";
+    public static final String COLUMN_USER_GENERATED = "userGenerated";
+    public static final String COLUMN_AD_TYPE = "adType";
+
+    private static final String DATABASE_NAME = "savedConfigurations.db";
+    private static final int DATABASE_VERSION = 1;
+
+    private static final String DATABASE_CREATE = "create table " + TABLE_AD_CONFIGURATIONS
+            + " ("
+            + COLUMN_ID + " integer primary key autoincrement, "
+            + COLUMN_AD_UNIT_ID + " text not null, "
+            + COLUMN_DESCRIPTION + " text not null, "
+            + COLUMN_USER_GENERATED + " integer not null, "
+            + COLUMN_AD_TYPE + " text not null"
+            + ");";
+
+    private final Context mContext;
+
+    public MoPubSQLiteHelper(final Context context) {
+        super(context, DATABASE_NAME, null, DATABASE_VERSION);
+        mContext = context.getApplicationContext();
+    }
+
+    @Override
+    public void onCreate(SQLiteDatabase sqLiteDatabase) {
+        // Built-in sample ad units.
+        final List<MoPubSampleAdUnit> adUnitList = new ArrayList<MoPubSampleAdUnit>();
+        adUnitList.add(
+                new MoPubSampleAdUnit
+                        .Builder(mContext.getString(R.string.ad_unit_id_banner), BANNER)
+                        .description("MoPub Banner Sample")
+                        .build());
+
+        adUnitList.add(
+                new MoPubSampleAdUnit
+                        .Builder(mContext.getString(R.string.ad_unit_id_mrect), MRECT)
+                        .description("MoPub Mrect Sample")
+                        .build());
+
+        adUnitList.add(
+                new MoPubSampleAdUnit
+                        .Builder(mContext.getString(R.string.ad_unit_id_interstitial), INTERSTITIAL)
+                        .description("MoPub Interstitial Sample")
+                        .build());
+
+        adUnitList.add(
+                new MoPubSampleAdUnit
+                        .Builder(mContext.getString(R.string.ad_unit_id_native), LIST_VIEW)
+                        .description("MoPub Ad Placer Sample")
+                        .build());
+        adUnitList.add(
+                new MoPubSampleAdUnit
+                        .Builder(mContext.getString(R.string.ad_unit_id_native), CUSTOM_NATIVE)
+                        .description("MoPub View Pager Sample")
+                        .build());
+        sqLiteDatabase.execSQL(DATABASE_CREATE);
+        sqLiteDatabase.beginTransaction();
+
+        // Populate the MoPub built-in samples.
+        for (final MoPubSampleAdUnit adUnit : adUnitList) {
+            final ContentValues values = new ContentValues();
+            values.put(COLUMN_AD_UNIT_ID, adUnit.getAdUnitId());
+            values.put(COLUMN_DESCRIPTION, adUnit.getDescription());
+            values.put(COLUMN_USER_GENERATED, 0);
+            values.put(COLUMN_AD_TYPE, adUnit.getFragmentClassName());
+
+            sqLiteDatabase.insert(TABLE_AD_CONFIGURATIONS, null, values);
+        }
+        sqLiteDatabase.setTransactionSuccessful();
+        sqLiteDatabase.endTransaction();
+    }
+
+    @Override
+    public void onDowngrade(SQLiteDatabase database, int oldVersion, int newVersion) {
+        Log.w(MoPubSQLiteHelper.class.getName(),
+                "Downgrading database from version " + oldVersion + " to "
+                        + newVersion + ", which will destroy all old data"
+        );
+        recreateDb(database);
+    }
+
+    @Override
+    public void onUpgrade(SQLiteDatabase database, int oldVersion, int newVersion) {
+        Log.w(MoPubSQLiteHelper.class.getName(),
+                "Upgrading database from version " + oldVersion + " to "
+                        + newVersion + ", which will destroy all old data"
+        );
+        recreateDb(database);
+    }
+
+    private void recreateDb(SQLiteDatabase database) {
+        database.execSQL("DROP TABLE IF EXISTS " + TABLE_AD_CONFIGURATIONS);
+        onCreate(database);
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleActivity.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleActivity.java
new file mode 100644
index 00000000..f2ba89bc
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleActivity.java
@@ -0,0 +1,33 @@
+package com.mopub.simpleadsdemo;
+
+import android.os.Bundle;
+import android.support.v4.app.FragmentActivity;
+import android.support.v4.app.FragmentManager;
+
+import com.mopub.common.MoPub;
+
+
+public class MoPubSampleActivity extends FragmentActivity {
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        setContentView(R.layout.main);
+
+        if (savedInstanceState != null) {
+            return;
+        }
+
+        // Set location awareness and precision globally for your app:
+        MoPub.setLocationAwareness(MoPub.LocationAwareness.TRUNCATED);
+        MoPub.setLocationPrecision(4);
+
+        if (findViewById(R.id.fragment_container) != null) {
+            final MoPubListFragment listFragment = new MoPubListFragment();
+            listFragment.setArguments(getIntent().getExtras());
+            FragmentManager fragmentManager = getSupportFragmentManager();
+            fragmentManager.beginTransaction()
+                    .add(R.id.fragment_container, listFragment)
+                    .commit();
+        }
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleAdUnit.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleAdUnit.java
new file mode 100644
index 00000000..dfeacd95
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleAdUnit.java
@@ -0,0 +1,200 @@
+package com.mopub.simpleadsdemo;
+
+import android.os.Bundle;
+import android.support.v4.app.Fragment;
+
+import java.util.Comparator;
+
+class MoPubSampleAdUnit implements Comparable<MoPubSampleAdUnit> {
+
+    public static final String AD_UNIT_ID = "adUnitId";
+    public static final String DESCRIPTION = "description";
+    public static final String AD_TYPE = "adType";
+    public static final String IS_USER_DEFINED = "isCustom";
+    public static final String ID = "id";
+
+    // Note that entries are also sorted in this order
+    enum AdType {
+        BANNER("Banner", BannerDetailFragment.class),
+        MRECT("Mrect", MrectDetailFragment.class),
+        INTERSTITIAL("Interstitial", InterstitialDetailFragment.class),
+        LIST_VIEW("Native List View", NativeListViewFragment.class),
+        CUSTOM_NATIVE("Native Gallery (Custom Stream)", NativeGalleryFragment.class);
+
+        String getName() {
+            return name;
+        }
+
+        private final String name;
+        private final Class<? extends Fragment> fragmentClass;
+
+        private AdType(final String name, final Class<? extends Fragment> fragmentClass) {
+            this.name = name;
+            this.fragmentClass = fragmentClass;
+        }
+
+        private Class<? extends Fragment> getFragmentClass() {
+            return fragmentClass;
+        }
+
+        static AdType fromFragmentClassName(final String fragmentClassName) {
+            for (final AdType adType : values()) {
+                if (adType.fragmentClass.getName().equals(fragmentClassName)) {
+                    return adType;
+                }
+            }
+
+            return null;
+        }
+    }
+
+    static final Comparator<MoPubSampleAdUnit> COMPARATOR =
+            new Comparator<MoPubSampleAdUnit>() {
+                @Override
+                public int compare(MoPubSampleAdUnit a, MoPubSampleAdUnit b) {
+                    return a.compareTo(b);
+                }
+            };
+
+    static class Builder {
+        private final String mAdUnitId;
+        private final AdType mAdType;
+
+        private String mDescription;
+        private boolean mIsUserDefined;
+        private long mId;
+
+        Builder(final String adUnitId, final AdType adType) {
+            mAdUnitId = adUnitId;
+            mAdType = adType;
+            mId = -1;
+        }
+
+        Builder description(final String description) {
+            mDescription = description;
+            return this;
+        }
+
+        Builder isUserDefined(boolean userDefined) {
+            mIsUserDefined = userDefined;
+            return this;
+        }
+
+        Builder id(final long id) {
+            mId = id;
+            return this;
+        }
+
+        MoPubSampleAdUnit build() {
+            return new MoPubSampleAdUnit(this);
+        }
+    }
+
+    private final String mAdUnitId;
+    private final AdType mAdType;
+    private final String mDescription;
+    private final boolean mIsUserDefined;
+    private final long mId;
+
+    private MoPubSampleAdUnit(final Builder builder) {
+        mAdUnitId = builder.mAdUnitId;
+        mAdType = builder.mAdType;
+        mDescription = builder.mDescription;
+        mIsUserDefined = builder.mIsUserDefined;
+        mId = builder.mId;
+    }
+
+    Class<? extends Fragment> getFragmentClass() {
+        return mAdType.getFragmentClass();
+    }
+
+    String getAdUnitId() {
+        return mAdUnitId;
+    }
+
+    String getDescription() {
+        return mDescription;
+    }
+
+    String getFragmentClassName() {
+        return mAdType.getFragmentClass().getName();
+    }
+
+    String getHeaderName() {
+        return mAdType.name;
+    }
+
+    long getId() {
+        return mId;
+    }
+
+    boolean isUserDefined() {
+        return mIsUserDefined;
+    }
+
+    Bundle toBundle() {
+        final Bundle bundle = new Bundle();
+        bundle.putLong(ID, mId);
+        bundle.putString(AD_UNIT_ID, mAdUnitId);
+        bundle.putString(DESCRIPTION, mDescription);
+        bundle.putSerializable(AD_TYPE, mAdType);
+        bundle.putBoolean(IS_USER_DEFINED, mIsUserDefined);
+
+        return bundle;
+    }
+
+    static MoPubSampleAdUnit fromBundle(final Bundle bundle) {
+        final Long id = bundle.getLong(ID, -1L);
+        final String adUnitId = bundle.getString(AD_UNIT_ID);
+        final AdType adType = (AdType) bundle.getSerializable(AD_TYPE);
+        final String description = bundle.getString(DESCRIPTION);
+        final boolean isUserDefined = bundle.getBoolean(IS_USER_DEFINED, false);
+        final Builder builder = new MoPubSampleAdUnit.Builder(adUnitId, adType);
+        builder.description(description);
+        builder.id(id);
+        builder.isUserDefined(isUserDefined);
+
+        return builder.build();
+    }
+
+    @Override
+    public int compareTo(MoPubSampleAdUnit that) {
+        if (mAdType != that.mAdType) {
+            return mAdType.ordinal() - that.mAdType.ordinal();
+        }
+
+        return mDescription.compareTo(that.mDescription);
+    }
+
+    @Override
+    public int hashCode() {
+        int result = 11;
+        result = 31 * result + mAdType.ordinal();
+        result = 31 * result + (mIsUserDefined ? 1 : 0);
+        result = 31 * result + mDescription.hashCode();
+        result = 31 * result + mAdUnitId.hashCode();
+        return result;
+    }
+
+    @Override
+    public boolean equals(Object o) {
+        if (o == null) {
+            return false;
+        }
+
+        if (this == o) {
+            return true;
+        }
+
+        if (!(o instanceof MoPubSampleAdUnit)) {
+            return false;
+        }
+
+        final MoPubSampleAdUnit that = (MoPubSampleAdUnit) o;
+
+        return that.mAdType.equals(this.mAdType) &&
+                that.mIsUserDefined == this.mIsUserDefined &&
+                that.mDescription.equals(this.mDescription) &&
+                that.mAdUnitId.equals(this.mAdUnitId);
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleListAdapter.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleListAdapter.java
new file mode 100644
index 00000000..a2678507
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleListAdapter.java
@@ -0,0 +1,86 @@
+package com.mopub.simpleadsdemo;
+
+import android.content.Context;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ArrayAdapter;
+import android.widget.ImageView;
+import android.widget.TextView;
+
+import java.util.ArrayList;
+
+class MoPubSampleListAdapter extends ArrayAdapter<MoPubSampleAdUnit> {
+    private final TrashCanClickListener mListener;
+
+    static class ViewHolder {
+        TextView separator;
+        TextView description;
+        TextView adUnitId;
+        ImageView trashCan;
+    }
+
+    private final LayoutInflater mLayoutInflater;
+
+    MoPubSampleListAdapter(final Context context, TrashCanClickListener listener) {
+        super(context, 0, new ArrayList<MoPubSampleAdUnit>());
+        mListener = listener;
+        mLayoutInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
+    }
+
+
+    @Override
+    public View getView(final int position, final View convertView, final ViewGroup parent) {
+        final View view;
+        final ViewHolder viewHolder;
+
+        if (convertView == null) {
+            view = mLayoutInflater.inflate(R.layout.ad_configuration_list_item, parent, false);
+            viewHolder = new ViewHolder();
+            viewHolder.separator = (TextView) view.findViewById(R.id.separator);
+            viewHolder.description = (TextView) view.findViewById(R.id.banner_description);
+            viewHolder.adUnitId = (TextView) view.findViewById(R.id.banner_ad_unit_id);
+            viewHolder.trashCan = (ImageView) view.findViewById(R.id.banner_delete);
+        } else {
+            view = convertView;
+            viewHolder = (ViewHolder) view.getTag();
+        }
+
+        view.setTag(viewHolder);
+        final MoPubSampleAdUnit sampleAdUnit = getItem(position);
+        viewHolder.description.setText(sampleAdUnit.getDescription());
+        viewHolder.adUnitId.setText(sampleAdUnit.getAdUnitId());
+
+        if (isFirstInSection(position)) {
+            viewHolder.separator.setVisibility(View.VISIBLE);
+            viewHolder.separator.setText(sampleAdUnit.getHeaderName());
+        } else {
+            viewHolder.separator.setVisibility(View.GONE);
+        }
+
+        if (sampleAdUnit.isUserDefined()) {
+            viewHolder.trashCan.setVisibility(View.VISIBLE);
+            viewHolder.trashCan.setOnClickListener(new View.OnClickListener() {
+                @Override
+                public void onClick(final View view) {
+                    mListener.onTrashCanClicked(sampleAdUnit);
+                }
+            });
+        } else {
+            viewHolder.trashCan.setVisibility(View.INVISIBLE);
+            viewHolder.trashCan.setOnClickListener(null);
+        }
+
+        return view;
+    }
+
+    private boolean isFirstInSection(int position) {
+        if (position <= 0) {
+            return true;
+        }
+
+        final MoPubSampleAdUnit previous = getItem(position - 1);
+        final MoPubSampleAdUnit current = getItem(position);
+        return !previous.getHeaderName().equals(current.getHeaderName());
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MrectDetailFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MrectDetailFragment.java
new file mode 100644
index 00000000..2ae93318
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MrectDetailFragment.java
@@ -0,0 +1,87 @@
+package com.mopub.simpleadsdemo;
+
+import android.os.Bundle;
+import android.support.v4.app.Fragment;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+
+import com.mopub.mobileads.MoPubErrorCode;
+import com.mopub.mobileads.MoPubView;
+
+import static com.mopub.mobileads.MoPubView.BannerAdListener;
+import static com.mopub.simpleadsdemo.Utils.hideSoftKeyboard;
+import static com.mopub.simpleadsdemo.Utils.logToast;
+
+public class MrectDetailFragment extends Fragment implements BannerAdListener {
+    private MoPubView mMoPubView;
+
+    @Override
+    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
+        super.onCreateView(inflater, container, savedInstanceState);
+
+        final MoPubSampleAdUnit adConfiguration =
+                MoPubSampleAdUnit.fromBundle(getArguments());
+        final View view = inflater.inflate(R.layout.mrect_detail_fragment, container, false);
+        final DetailFragmentViewHolder views = DetailFragmentViewHolder.fromView(view);
+        hideSoftKeyboard(views.mKeywordsField);
+        mMoPubView = (MoPubView) view.findViewById(R.id.mrect_mopubview);
+        final String adUnitId = adConfiguration.getAdUnitId();
+        views.mDescriptionView.setText(adConfiguration.getDescription());
+        views.mAdUnitIdView.setText(adUnitId);
+        views.mLoadButton.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                final String keywords = views.mKeywordsField.getText().toString();
+                loadMoPubView(adUnitId, keywords);
+            }
+        });
+        mMoPubView.setBannerAdListener(this);
+        loadMoPubView(adUnitId, null);
+
+        return view;
+    }
+
+    @Override
+    public void onDestroyView() {
+        super.onDestroyView();
+
+        if (mMoPubView != null) {
+            mMoPubView.destroy();
+            mMoPubView = null;
+        }
+    }
+
+    private void loadMoPubView(final String adUnitId, final String keywords) {
+        mMoPubView.setAdUnitId(adUnitId);
+        mMoPubView.setKeywords(keywords);
+        mMoPubView.loadAd();
+    }
+
+    // BannerAdListener
+    @Override
+    public void onBannerLoaded(MoPubView banner) {
+        logToast(getActivity(), "Mrect loaded.");
+    }
+
+    @Override
+    public void onBannerFailed(MoPubView banner, MoPubErrorCode errorCode) {
+        final String errorMessage = (errorCode != null) ? errorCode.toString() : "";
+        logToast(getActivity(), "Mrect failed to load: " + errorMessage);
+    }
+
+    @Override
+    public void onBannerClicked(MoPubView banner) {
+        logToast(getActivity(), "Mrect clicked.");
+    }
+
+    @Override
+    public void onBannerExpanded(MoPubView banner) {
+        logToast(getActivity(), "Mrect expanded.");
+    }
+
+    @Override
+    public void onBannerCollapsed(MoPubView banner) {
+        logToast(getActivity(), "Mrect collapsed.");
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeAdapter.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeAdapter.java
deleted file mode 100644
index a281b289..00000000
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeAdapter.java
+++ /dev/null
@@ -1,210 +0,0 @@
-package com.mopub.simpleadsdemo;
-
-import android.content.Context;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.BaseAdapter;
-import android.widget.TextView;
-
-import com.mopub.nativeads.AdapterHelper;
-import com.mopub.nativeads.NativeResponse;
-import com.mopub.nativeads.ViewBinder;
-
-import java.util.ArrayList;
-import java.util.HashMap;
-import java.util.LinkedList;
-import java.util.List;
-import java.util.Queue;
-
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
-import static com.mopub.simpleadsdemo.NativeFragment.MoPubNativeConsumptionListener;
-
-final class NativeAdapter extends BaseAdapter {
-    private static final int NUMBER_OF_ROWS = 100;
-    private static final int NATIVE_AD_START_POSITION = 10;
-    private static final int NATIVE_AD_REPEAT = 7;
-    private static final int CONTENT_LAYOUT = R.layout.text_row;
-
-    private final Context mContext;
-
-    // Listener to notify the activity of ad events
-    private final MoPubNativeListener mMoPubNativeListener;
-
-    // Specific listener to notify the activity when a native response has been consumed
-    // from the mNativeResponses queue
-    // This lets the activity request another native ad to replenish its supply
-    private final MoPubNativeConsumptionListener mMoPubNativeConsumptionListener;
-
-    // Binds native ad view ids to fields expected from the native response
-    private final ViewBinder mViewBinder;
-
-    // Helps with calculating native ad positions in the list and populating views with
-    // native response content
-    private final AdapterHelper mAdapterHelper;
-
-    // Sample content to be displayed in the list
-    private final List<String> mBackingList;
-
-    // Queue of native responses retrieved from the network and ready to be displayed in the app
-    private final Queue<NativeResponse> mNativeResponses;
-
-    // Mapping of native responses to position in the list where they have been displayed
-    private final HashMap<Integer, Object> mPositionToResponse;
-
-    private enum RowType {
-        CONTENT(0),
-        NATIVE_AD(1),
-        EMPTY_AD(2);
-
-        private static final int size = values().length;
-        private final int id;
-
-        private RowType(int id) {
-            this.id = id;
-        }
-    }
-
-    NativeAdapter(final Context context,
-            final MoPubNativeListener moPubNativeListener,
-            final MoPubNativeConsumptionListener moPubNativeConsumptionListener,
-            final ViewBinder viewBinder) {
-        super();
-
-        mContext = context.getApplicationContext();
-        mMoPubNativeListener = moPubNativeListener;
-        mMoPubNativeConsumptionListener = moPubNativeConsumptionListener;
-        mViewBinder = viewBinder;
-
-        mAdapterHelper = new AdapterHelper(context, NATIVE_AD_START_POSITION, NATIVE_AD_REPEAT);
-        mBackingList = createBackingList(NUMBER_OF_ROWS);
-
-        mNativeResponses = new LinkedList<NativeResponse>();
-        mPositionToResponse = new HashMap<Integer, Object>();
-    }
-
-    @Override
-    public int getCount() {
-        return mAdapterHelper.shiftedCount(NUMBER_OF_ROWS);
-    }
-
-    @Override
-    public String getItem(int position) {
-        return mBackingList.get(mAdapterHelper.shiftedPosition(position));
-    }
-
-    @Override
-    public long getItemId(int position) {
-        return 0;
-    }
-
-    @Override
-    public int getViewTypeCount() {
-        return RowType.size;
-    }
-
-    @Override
-    public int getItemViewType(int position) {
-        if (mAdapterHelper.isAdPosition(position)) {
-            Object nativeResponse = mPositionToResponse.get(position);
-
-            // If we have a native response already assigned to this position in the list then
-            // we can use it again
-            if (nativeResponse instanceof NativeResponse) {
-                return RowType.NATIVE_AD.id;
-
-            // If object is null it implies that this position in the list has yet to be assigned
-            // as a native response or empty response
-            // If we have a native response ready to be shown in the queue, then assign this
-            // position in the list a native response
-            } else if (nativeResponse == null && !mNativeResponses.isEmpty()) {
-                return RowType.NATIVE_AD.id;
-
-            // If we get here it means that the position in the list was either already an
-            // empty response or we didn't have a native response ready to show
-            } else {
-                return RowType.EMPTY_AD.id;
-            }
-        } else {
-            return RowType.CONTENT.id;
-        }
-    }
-
-    @Override
-    public View getView(int position, View convertView, ViewGroup parent) {
-        int itemViewType = getItemViewType(position);
-        if (itemViewType == RowType.NATIVE_AD.id) {
-            return getNativeAdView(position, convertView, parent);
-        } else if (itemViewType == RowType.EMPTY_AD.id) {
-            return getEmptyAdView(position, convertView, parent);
-        } else {
-            return getContentView(position, convertView, parent);
-        }
-    }
-
-    private View getNativeAdView(int position, View convertView, ViewGroup parent) {
-        // Check to see if we have a native response already used at this position
-        Object nativeResponse = mPositionToResponse.get(position);
-        if (nativeResponse == null) {
-
-            // If we don't then get a native response from the queue and assign it to this position
-            // in the LruCache
-            nativeResponse = mNativeResponses.poll();
-            mPositionToResponse.put(position, nativeResponse);
-
-            // Notify the activity that we consumed a native response from the queue so it can
-            // fetch another one
-            mMoPubNativeConsumptionListener
-                    .onNativeResponseConsumed((NativeResponse) nativeResponse);
-        }
-
-        View view = mAdapterHelper.getAdView(
-                convertView,
-                parent,
-                (NativeResponse) nativeResponse,
-                mViewBinder,
-                mMoPubNativeListener);
-
-        return view;
-    }
-
-    private View getEmptyAdView(int position, View convertView, ViewGroup parent) {
-        // Use a linear layout with height of 0 to display nothing for this row
-        if (convertView == null) {
-            convertView = LayoutInflater
-                    .from(mContext)
-                    .inflate(R.layout.empty_ad_row, parent, false);
-        }
-        mPositionToResponse.put(position, new EmptyNativeResponse());
-        return convertView;
-    }
-
-    private View getContentView(int position, View convertView, ViewGroup parent) {
-        // Display app content
-        if (convertView == null) {
-            convertView = LayoutInflater.from(mContext).inflate(CONTENT_LAYOUT, parent, false);
-        }
-
-        TextView label = (TextView) convertView.findViewById(R.id.my_text_view);
-        label.setText(getItem(position));
-
-        return convertView;
-    }
-
-    public void addNativeResponse(NativeResponse nativeResponse) {
-        // Add more native responses to the queue to be displayed in the app
-        mNativeResponses.add(nativeResponse);
-    }
-
-    private List<String> createBackingList(int numberOfRows) {
-        // Create sample content
-        List<String> list = new ArrayList<String>(numberOfRows);
-        for (int i = 0; i < numberOfRows; i++) {
-            list.add(String.valueOf(i));
-        }
-        return list;
-    }
-
-    // Empty class to denote an empty ad view in the list
-    private static final class EmptyNativeResponse {}
-}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeFragment.java
deleted file mode 100644
index ee5780cb..00000000
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeFragment.java
+++ /dev/null
@@ -1,218 +0,0 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
-package com.mopub.simpleadsdemo;
-
-import android.location.Location;
-import android.os.Bundle;
-import android.os.Handler;
-import android.support.v4.app.Fragment;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.Button;
-import android.widget.EditText;
-import android.widget.ListView;
-
-import com.mopub.common.util.MoPubLog;
-import com.mopub.nativeads.MoPubNative;
-import com.mopub.nativeads.NativeErrorCode;
-import com.mopub.nativeads.NativeResponse;
-import com.mopub.nativeads.RequestParameters;
-import com.mopub.nativeads.ViewBinder;
-
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
-import static com.mopub.simpleadsdemo.Utils.hideSoftKeyboard;
-import static com.mopub.simpleadsdemo.Utils.logToast;
-
-public final class NativeFragment extends Fragment {
-    private static final int NATIVE_AD_INITIALIZATION_COUNT = 3;
-
-    private final MyMoPubNativeListener mMyMoPubNativeListener;
-    private final MyMoPubNativeConsumptionListener mMyMoPubNativeConsumptionListener;
-
-    private ListView mListView;
-    private MoPubNative mMoPubNative;
-    private EditText mNativeAdUnitField;
-
-    private ViewBinder mViewBinder;
-    private NativeAdapter mNativeAdapter;
-
-    public NativeFragment() {
-        super();
-        mMyMoPubNativeListener = new MyMoPubNativeListener();
-        mMyMoPubNativeConsumptionListener = new MyMoPubNativeConsumptionListener();
-    }
-
-    @Override
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState); }
-
-    public View onCreateView(LayoutInflater inflater, ViewGroup container,
-                 Bundle savedInstanceState) {
-
-        View nativeFragmentView = inflater.inflate(R.layout.nativetab, container, false);
-
-        mListView = (ListView) nativeFragmentView.findViewById(R.id.list_view);
-
-        View.OnClickListener fieldFocusListener = new View.OnClickListener() {
-            public void onClick(View view) {
-                view.requestFocusFromTouch();
-            }
-        };
-
-        mNativeAdUnitField = (EditText) nativeFragmentView.findViewById(R.id.native_adunit_field);
-        hideSoftKeyboard(mNativeAdUnitField);
-
-        mNativeAdUnitField.setOnClickListener(fieldFocusListener);
-
-        mViewBinder = new ViewBinder.Builder(R.layout.native_ad_row)
-                .titleId(R.id.native_title)
-                .textId(R.id.native_text)
-                .callToActionId(R.id.native_cta)
-                .mainImageId(R.id.native_main_image)
-                .iconImageId(R.id.native_icon_image)
-                .build();
-
-        Button nativeLoadButton = (Button) nativeFragmentView.findViewById(R.id.native_load_button);
-        nativeLoadButton.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                String adUnitId = mNativeAdUnitField.getText().toString();
-
-                // Destory old native ad if it exists
-                if(mMoPubNative != null) {
-                    mMoPubNative.destroy();
-                }
-
-                mMoPubNative = new MoPubNative(getActivity(), adUnitId, mMyMoPubNativeListener);
-
-                // Initialize activity with a number of native ads ready to show
-                for (int i=0; i < NATIVE_AD_INITIALIZATION_COUNT; ++i) {
-                    requestNativeAd();
-                }
-
-                mNativeAdapter = new NativeAdapter(
-                        getActivity(),
-                        mMyMoPubNativeListener,
-                        mMyMoPubNativeConsumptionListener,
-                        mViewBinder
-                );
-
-                mListView.setAdapter(mNativeAdapter);
-
-                logToast(getActivity(), "Loaded new native ad unit");
-            }
-        });
-
-        return nativeFragmentView;
-    }
-
-    private void requestNativeAd() {
-        Location exampleLocation = new Location("example");
-        exampleLocation.setLatitude(23.1);
-        exampleLocation.setLongitude(42.1);
-        exampleLocation.setAccuracy(100);
-
-        RequestParameters requestParameters = new RequestParameters.Builder()
-                .keywords("key:value")
-                .location(exampleLocation)
-                .build();
-
-        mMoPubNative.makeRequest(requestParameters);
-    }
-
-    private final class MyMoPubNativeListener implements MoPubNativeListener {
-        private static final int EMPTY_RESPONSE_DELAY_MS = 30000; // 30 seconds
-        private Handler mHandler;
-        private Runnable mRunnable;
-
-        public MyMoPubNativeListener() {
-            mHandler = new Handler();
-            mRunnable = new Runnable() {
-                @Override
-                public void run() {
-                    requestNativeAd();
-                }
-            };
-        }
-
-        @Override
-        public void onNativeLoad(final NativeResponse nativeResponse) {
-            MoPubLog.d("MoPubNativeListener: Load!, NativeResponse: " + nativeResponse.toString());
-
-            // When we have a valid response, let the adapter manage when it will be shown
-            mNativeAdapter.addNativeResponse(nativeResponse);
-        }
-
-        @Override
-        public void onNativeFail(final NativeErrorCode errorCode) {
-            MoPubLog.d("MoPubNativeListener: Fail!, NativeErrorCode: " + errorCode.toString());
-            switch (errorCode) {
-                case INVALID_REQUEST_URL:
-                    // Invalid url, don't try to request again
-                    break;
-                case CONNECTION_ERROR:
-                    // Data connection was lost, activity should start requesting ads again
-                    // when the data connection is regained
-                    break;
-                default:
-                    // For any other error, wait 30 seconds before trying again
-                    mHandler.postDelayed(mRunnable, EMPTY_RESPONSE_DELAY_MS);
-                    break;
-            }
-        }
-
-        @Override
-        public void onNativeImpression(final View view) {
-            MoPubLog.d("MoPubNativeListener: Impression!, View: " + view.toString());
-        }
-
-        @Override
-        public void onNativeClick(final View view) {
-            MoPubLog.d("MoPubNativeListener: Click!, View: " + view.toString());
-        }
-    }
-
-    public static interface MoPubNativeConsumptionListener {
-        public void onNativeResponseConsumed(NativeResponse nativeResponse);
-    }
-
-    private final class MyMoPubNativeConsumptionListener implements MoPubNativeConsumptionListener {
-        @Override
-        public void onNativeResponseConsumed(NativeResponse nativeResponse) {
-            // Native ad was displayed in the app, request a new one to always
-            // have ads ready to display
-            requestNativeAd();
-        }
-    }
-}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeGalleryFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeGalleryFragment.java
new file mode 100644
index 00000000..ede4745c
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeGalleryFragment.java
@@ -0,0 +1,223 @@
+package com.mopub.simpleadsdemo;
+
+import android.app.Activity;
+import android.location.Location;
+import android.os.Bundle;
+import android.support.v4.app.Fragment;
+import android.support.v4.app.FragmentManager;
+import android.support.v4.app.FragmentStatePagerAdapter;
+import android.support.v4.view.ViewPager;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.TextView;
+
+import com.mopub.nativeads.MoPubNativeAdLoadedListener;
+import com.mopub.nativeads.MoPubNativeAdPositioning;
+import com.mopub.nativeads.MoPubNativeAdRenderer;
+import com.mopub.nativeads.MoPubStreamAdPlacer;
+import com.mopub.nativeads.RequestParameters;
+import com.mopub.nativeads.ViewBinder;
+
+import java.util.EnumSet;
+
+import static com.mopub.nativeads.RequestParameters.NativeAdAsset;
+
+public class NativeGalleryFragment extends Fragment implements MoPubNativeAdLoadedListener {
+    private MoPubSampleAdUnit mAdConfiguration;
+    private ViewPager mViewPager;
+    private CustomPagerAdapter mPagerAdapter;
+    private MoPubStreamAdPlacer mStreamAdPlacer;
+    private RequestParameters mRequestParameters;
+
+    @Override
+    public View onCreateView(final LayoutInflater inflater, final ViewGroup container,
+            final Bundle savedInstanceState) {
+        super.onCreateView(inflater, container, savedInstanceState);
+        mAdConfiguration = MoPubSampleAdUnit.fromBundle(getArguments());
+        final View view = inflater.inflate(R.layout.native_gallery_fragment, container, false);
+        final DetailFragmentViewHolder views = DetailFragmentViewHolder.fromView(view);
+        views.mLoadButton.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                // If your app already has location access, include it here.
+                final Location location = null;
+                final String keywords = views.mKeywordsField.getText().toString();
+
+                // Setting desired assets on your request helps native ad networks and bidders
+                // provide higher-quality ads.
+                final EnumSet<NativeAdAsset> desiredAssets = EnumSet.of(
+                        NativeAdAsset.TITLE,
+                        NativeAdAsset.TEXT,
+                        NativeAdAsset.ICON_IMAGE,
+                        NativeAdAsset.MAIN_IMAGE,
+                        NativeAdAsset.CALL_TO_ACTION_TEXT);
+
+                mRequestParameters = new RequestParameters.Builder()
+                        .location(location)
+                        .keywords(keywords)
+                        .desiredAssets(desiredAssets)
+                        .build();
+
+                if (mStreamAdPlacer != null) {
+                    mStreamAdPlacer.loadAds(mAdConfiguration.getAdUnitId(), mRequestParameters);
+                }
+            }
+        });
+
+        final String adUnitId = mAdConfiguration.getAdUnitId();
+        views.mDescriptionView.setText(mAdConfiguration.getDescription());
+        views.mAdUnitIdView.setText(adUnitId);
+        mViewPager = (ViewPager) view.findViewById(R.id.gallery_pager);
+        mStreamAdPlacer = new MoPubStreamAdPlacer(getActivity(),
+                MoPubNativeAdPositioning.clientPositioning()
+                        .addFixedPosition(4)
+                        .addFixedPosition(1)
+                        .enableRepeatingPositions(3)
+        );
+        final MoPubNativeAdRenderer adRenderer = new MoPubNativeAdRenderer(
+                new ViewBinder.Builder(R.layout.native_ad_list_item)
+                        .titleId(R.id.native_title)
+                        .textId(R.id.native_text)
+                        .mainImageId(R.id.native_main_image)
+                        .iconImageId(R.id.native_icon_image)
+                        .callToActionId(R.id.native_cta)
+                        .build()
+        );
+        mPagerAdapter = new CustomPagerAdapter(getChildFragmentManager(), mStreamAdPlacer);
+        mStreamAdPlacer.registerAdRenderer(adRenderer);
+        mStreamAdPlacer.setAdLoadedListener(this);
+        mViewPager.setAdapter(mPagerAdapter);
+
+        return view;
+    }
+
+    public MoPubStreamAdPlacer getAdPlacer() {
+        return mStreamAdPlacer;
+    }
+
+    @Override
+    public void onDestroyView() {
+        // You must call this or the ad adapter may cause a memory leak.
+        mStreamAdPlacer.destroy();
+        super.onDestroyView();
+    }
+
+    @Override
+    public void onResume() {
+        // MoPub recommends reloading ads when the user returns to a view.
+        mStreamAdPlacer.loadAds(mAdConfiguration.getAdUnitId(), mRequestParameters);
+        super.onResume();
+    }
+
+    @Override
+    public void onAdLoaded(final int position) {
+        mViewPager.invalidate();
+        mPagerAdapter.notifyDataSetChanged();
+    }
+
+    @Override
+    public void onAdRemoved(final int position) {
+        mViewPager.invalidate();
+        mPagerAdapter.notifyDataSetChanged();
+    }
+
+    private static class CustomPagerAdapter extends FragmentStatePagerAdapter {
+        private static final int ITEM_COUNT = 30;
+        private MoPubStreamAdPlacer mStreamAdPlacer;
+
+        public CustomPagerAdapter(final FragmentManager fragmentManager,
+                MoPubStreamAdPlacer streamAdPlacer) {
+            super(fragmentManager);
+            this.mStreamAdPlacer = streamAdPlacer;
+            streamAdPlacer.setItemCount(ITEM_COUNT);
+        }
+
+        @Override
+        public int getItemPosition(final Object object) {
+            // This forces all items to be recreated when invalidate() is called on the ViewPager.
+            return POSITION_NONE;
+        }
+
+        @Override
+        public Fragment getItem(final int i) {
+            mStreamAdPlacer.placeAdsInRange(i - 5, i + 5);
+            if (mStreamAdPlacer.isAd(i)) {
+                return AdFragment.newInstance(i);
+            }
+            return ContentFragment.newInstance(mStreamAdPlacer.getOriginalPosition(i));
+        }
+
+        @Override
+        public int getCount() {
+            return mStreamAdPlacer.getAdjustedCount(ITEM_COUNT);
+        }
+
+        @Override
+        public CharSequence getPageTitle(final int position) {
+            if (mStreamAdPlacer.isAd(position)) {
+                return "Advertisement";
+            }
+            return "Content Item " + mStreamAdPlacer.getOriginalPosition(position);
+        }
+
+    }
+
+    public static class ContentFragment extends Fragment {
+        /**
+         * The fragment argument representing the section number for this
+         * fragment.
+         */
+        private static final String ARG_SECTION_NUMBER = "section_number";
+
+        public static ContentFragment newInstance(int sectionNumber) {
+            ContentFragment fragment = new ContentFragment();
+            Bundle args = new Bundle();
+            args.putInt(ARG_SECTION_NUMBER, sectionNumber);
+            fragment.setArguments(args);
+            return fragment;
+        }
+
+        @Override
+        public View onCreateView(final LayoutInflater inflater, final ViewGroup container,
+                final Bundle savedInstanceState) {
+            // Inflate the view.
+            View rootView = inflater.inflate(R.layout.native_gallery_content, container, false);
+            int contentNumber = getArguments().getInt(ARG_SECTION_NUMBER);
+            TextView textView = (TextView) rootView.findViewById(R.id.native_gallery_content_text);
+            textView.setText("Content Item " + contentNumber);
+            return rootView;
+        }
+    }
+
+    public static class AdFragment extends Fragment {
+        private static final String ARG_AD_POSITION = "ad_position";
+        private MoPubStreamAdPlacer mAdPlacer;
+
+        public static AdFragment newInstance(int adPosition) {
+            AdFragment fragment = new AdFragment();
+            Bundle bundle = new Bundle();
+            bundle.putInt(ARG_AD_POSITION, adPosition);
+            fragment.setArguments(bundle);
+            return fragment;
+        }
+
+        @Override
+        public void onAttach(final Activity activity) {
+            mAdPlacer = ((NativeGalleryFragment) getParentFragment()).getAdPlacer();
+            super.onAttach(activity);
+        }
+
+        @Override
+        public View onCreateView(final LayoutInflater inflater, final ViewGroup container,
+                final Bundle savedInstanceState) {
+            if (mAdPlacer != null) {
+                int position = getArguments().getInt(ARG_AD_POSITION);
+                mAdPlacer.placeAdsInRange(position - 5, position + 5);
+                return mAdPlacer.getAdView(position, null, container);
+            }
+
+            return null;
+        }
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeListViewFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeListViewFragment.java
new file mode 100644
index 00000000..ba042047
--- /dev/null
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeListViewFragment.java
@@ -0,0 +1,108 @@
+package com.mopub.simpleadsdemo;
+
+import android.location.Location;
+import android.os.Bundle;
+import android.support.v4.app.Fragment;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.ArrayAdapter;
+import android.widget.ListView;
+
+import com.mopub.nativeads.MoPubAdAdapter;
+import com.mopub.nativeads.MoPubNativeAdPositioning;
+import com.mopub.nativeads.MoPubNativeAdRenderer;
+import com.mopub.nativeads.RequestParameters;
+import com.mopub.nativeads.ViewBinder;
+
+import java.util.EnumSet;
+
+import static com.mopub.nativeads.RequestParameters.NativeAdAsset;
+
+public class NativeListViewFragment extends Fragment {
+    private MoPubAdAdapter mAdAdapter;
+    private MoPubSampleAdUnit mAdConfiguration;
+    private RequestParameters mRequestParameters;
+
+    @Override
+    public View onCreateView(final LayoutInflater inflater,
+            final ViewGroup container,
+            final Bundle savedInstanceState) {
+        super.onCreateView(inflater, container, savedInstanceState);
+
+        mAdConfiguration = MoPubSampleAdUnit.fromBundle(getArguments());
+        final View view = inflater.inflate(R.layout.native_list_view_fragment, container, false);
+        final ListView listView = (ListView) view.findViewById(R.id.native_list_view);
+        final DetailFragmentViewHolder views = DetailFragmentViewHolder.fromView(view);
+        views.mLoadButton.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                // If your app already has location access, include it here.
+                final Location location = null;
+                final String keywords = views.mKeywordsField.getText().toString();
+
+                // Setting desired assets on your request helps native ad networks and bidders
+                // provide higher-quality ads.
+                final EnumSet<NativeAdAsset> desiredAssets = EnumSet.of(
+                        NativeAdAsset.TITLE,
+                        NativeAdAsset.TEXT,
+                        NativeAdAsset.ICON_IMAGE,
+                        NativeAdAsset.MAIN_IMAGE,
+                        NativeAdAsset.CALL_TO_ACTION_TEXT);
+
+                mRequestParameters = new RequestParameters.Builder()
+                        .location(location)
+                        .keywords(keywords)
+                        .desiredAssets(desiredAssets)
+                        .build();
+
+                mAdAdapter.loadAds(mAdConfiguration.getAdUnitId(), mRequestParameters);
+            }
+        });
+        final String adUnitId = mAdConfiguration.getAdUnitId();
+        views.mDescriptionView.setText(mAdConfiguration.getDescription());
+        views.mAdUnitIdView.setText(adUnitId);
+
+        final ArrayAdapter<String> adapter = new ArrayAdapter<String>(getActivity(),
+                android.R.layout.simple_list_item_1);
+        for (int i = 0; i < 100; ++i) {
+            adapter.add("Item " + i);
+        }
+
+        // Create an ad adapter with ads in positions 0, 4, and every 10 places thereafter.
+        // This adapter will be used in place of the original adapter for the ListView.
+        mAdAdapter = new MoPubAdAdapter(getActivity(), adapter, MoPubNativeAdPositioning.clientPositioning()
+                .addFixedPosition(0)
+                .addFixedPosition(4)
+                .enableRepeatingPositions(10));
+
+        // Set up an renderer that knows how to put ad data in an ad view.
+        final MoPubNativeAdRenderer adRenderer = new MoPubNativeAdRenderer(
+                new ViewBinder.Builder(R.layout.native_ad_list_item)
+                        .titleId(R.id.native_title)
+                        .textId(R.id.native_text)
+                        .mainImageId(R.id.native_main_image)
+                        .iconImageId(R.id.native_icon_image)
+                        .callToActionId(R.id.native_cta)
+                        .build());
+
+        // Register the renderer with the MoPubAdAdapter and then set the adapter on the ListView.
+        mAdAdapter.registerAdRenderer(adRenderer);
+        listView.setAdapter(mAdAdapter);
+        return view;
+    }
+
+    @Override
+    public void onDestroyView() {
+        // You must call this or the ad adapter may cause a memory leak.
+        mAdAdapter.destroy();
+        super.onDestroyView();
+    }
+
+    @Override
+    public void onResume() {
+        // MoPub recommends loading knew ads when the user returns to your activity.
+        mAdAdapter.loadAds(mAdConfiguration.getAdUnitId(), mRequestParameters);
+        super.onResume();
+    }
+}
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/SimpleAdsDemo.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/SimpleAdsDemo.java
deleted file mode 100644
index c81aebf4..00000000
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/SimpleAdsDemo.java
+++ /dev/null
@@ -1,66 +0,0 @@
-/*
-* Copyright (c) 2010-2013, MoPub Inc.
-* All rights reserved.
-*
-* Redistribution and use in source and binary forms, with or without
-* modification, are permitted provided that the following conditions are
-* met:
-*
-*  Redistributions of source code must retain the above copyright
-*   notice, this list of conditions and the following disclaimer.
-*
-*  Redistributions in binary form must reproduce the above copyright
-*   notice, this list of conditions and the following disclaimer in the
-*   documentation and/or other materials provided with the distribution.
-*
-*  Neither the name of 'MoPub Inc.' nor the names of its contributors
-*   may be used to endorse or promote products derived from this software
-*   without specific prior written permission.
-*
-* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
-* TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-* PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
-* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
-* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
-* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
-* LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
-* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-*/
-
-package com.mopub.simpleadsdemo;
-
-import android.os.Bundle;
-import android.support.v4.app.FragmentActivity;
-import android.support.v4.app.FragmentTabHost;
-
-import com.mopub.mobileads.MoPubConversionTracker;
-
-public class SimpleAdsDemo extends FragmentActivity {
-    @Override
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-        setContentView(R.layout.main);
-
-        FragmentTabHost mTabHost = (FragmentTabHost)findViewById(R.id.tabhost);
-        mTabHost.setup(this, getSupportFragmentManager(), R.id.tabcontent);
-
-        mTabHost.addTab(mTabHost.newTabSpec("banners").setIndicator("Banners"),
-                BannersFragment.class, null);
-
-        mTabHost.addTab(mTabHost.newTabSpec("interstitials").setIndicator("Full"),
-        		InterstitialFragment.class, null);
-
-        mTabHost.addTab(mTabHost.newTabSpec("native").setIndicator("Native"),
-                NativeFragment.class, null);
-        
-        mTabHost.addTab(mTabHost.newTabSpec("about").setIndicator("About"),
-        		AboutFragment.class, null);
-
-
-        // Conversion tracking
-        new MoPubConversionTracker().reportAppOpen(this);
-    }
-}
\ No newline at end of file
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/Utils.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/Utils.java
index 0b50d55d..f63af8fe 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/Utils.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/Utils.java
@@ -4,15 +4,14 @@
 import android.util.Log;
 import android.view.View;
 import android.view.inputmethod.InputMethodManager;
-import android.widget.EditText;
 import android.widget.Toast;
 
-public class Utils {
-    public static final String LOGTAG = "MoPub Demo";
+class Utils {
+    static final String LOGTAG = "MoPub Sample App";
 
     private Utils() {}
 
-    public static void validateAdUnitId(String adUnitId) throws IllegalArgumentException {
+    static void validateAdUnitId(String adUnitId) throws IllegalArgumentException {
         if (adUnitId == null) {
             throw new IllegalArgumentException("Invalid Ad Unit ID: null ad unit.");
         } else if (adUnitId.length() == 0) {
@@ -24,17 +23,17 @@ public static void validateAdUnitId(String adUnitId) throws IllegalArgumentExcep
         }
     }
 
-    public static void hideSoftKeyboard(final EditText editText) {
-        InputMethodManager inputMethodManager =
-                (InputMethodManager) editText.getContext().getSystemService(Context.INPUT_METHOD_SERVICE);
-        inputMethodManager.hideSoftInputFromWindow(editText.getWindowToken(), 0);
+    static void hideSoftKeyboard(final View view) {
+        final InputMethodManager inputMethodManager =
+                (InputMethodManager) view.getContext().getSystemService(Context.INPUT_METHOD_SERVICE);
+        inputMethodManager.hideSoftInputFromWindow(view.getWindowToken(), 0);
     }
 
-    public static boolean isAlphaNumeric(String input) {
+    static boolean isAlphaNumeric(final String input) {
         return input.matches("^[a-zA-Z0-9-_]*$");
     }
 
-    public static void logToast(Context context, String message) {
+    static void logToast(Context context, String message) {
         Log.d(LOGTAG, message);
         Toast.makeText(context, message, Toast.LENGTH_SHORT).show();
     }
diff --git a/mopub-sample/src/test/java/com/mopub/mobileads/test/support/SimpleAdsDemoTestRunner.java b/mopub-sample/src/test/java/com/mopub/mobileads/test/support/SimpleAdsDemoTestRunner.java
index 7b6c6fc9..2bcaee0e 100644
--- a/mopub-sample/src/test/java/com/mopub/mobileads/test/support/SimpleAdsDemoTestRunner.java
+++ b/mopub-sample/src/test/java/com/mopub/mobileads/test/support/SimpleAdsDemoTestRunner.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import org.junit.runners.model.InitializationError;
diff --git a/mopub-sdk/AndroidManifest.xml b/mopub-sdk/AndroidManifest.xml
index 91419b01..22ac7cb1 100644
--- a/mopub-sdk/AndroidManifest.xml
+++ b/mopub-sdk/AndroidManifest.xml
@@ -3,5 +3,7 @@
 		package="com.mopub.mobileads"
 		android:versionCode="1"
 		android:versionName="1.0">
-	<uses-sdk android:minSdkVersion="8"/>
+	<uses-sdk
+        android:minSdkVersion="9"
+        android:targetSdkVersion="19"/>
 </manifest>
\ No newline at end of file
diff --git a/mopub-sdk/build.gradle b/mopub-sdk/build.gradle
new file mode 100644
index 00000000..45f21e2a
--- /dev/null
+++ b/mopub-sdk/build.gradle
@@ -0,0 +1,57 @@
+// This buildscript will assemble the MoPub SDK into an AAR.
+
+repositories {
+    mavenCentral()
+}
+
+apply plugin: 'com.android.library'
+
+group = 'com.mopub'
+
+description = '''MoPub SDK'''
+
+android {
+    compileSdkVersion 19
+    buildToolsVersion '19.1.0'
+
+    defaultConfig {
+        versionCode 1
+        versionName "3.2.0"
+        minSdkVersion 9
+        targetSdkVersion 19
+        consumerProguardFiles 'proguard.txt'
+    }
+
+    sourceSets {
+        main {
+            manifest.srcFile 'AndroidManifest.xml'
+            java.srcDirs = ['src/main/java']
+            resources.srcDirs = ['src/main/java']
+            aidl.srcDirs = ['src/main']
+            renderscript.srcDirs = ['src/main']
+            res.srcDirs = ['res']
+            assets.srcDirs = ['assets']
+        }
+    }
+
+    buildTypes {
+        release {
+            runProguard false
+            proguardFiles getDefaultProguardFile('proguard-android.txt'), file('proguard.txt')
+        }
+    }
+
+    // Note: You will also need a local.properties file to set the location of the SDK in the same 
+    // way that the existing SDK requires, using the sdk.dir property.
+    // Alternatively, you can set an environment variable called ANDROID_HOME. There is no 
+    // difference between the two methods, you can use the one you prefer.
+}
+
+dependencies {
+    compile 'com.android.support:support-v4:19.1.+'
+}
+
+// Don't run the Robolectric Unit Tests. They don't build properly in Gradle or Android Studio in this version.
+check.dependsOn.remove("test")
+check.dependsOn.remove("testDebug")
+
diff --git a/mopub-sdk/default.properties b/mopub-sdk/default.properties
deleted file mode 100644
index 64c51277..00000000
--- a/mopub-sdk/default.properties
+++ /dev/null
@@ -1,12 +0,0 @@
-# This file is automatically generated by Android Tools.
-# Do not modify this file -- YOUR CHANGES WILL BE ERASED!
-# 
-# This file must be checked in Version Control Systems.
-# 
-# To customize properties used by the Ant build system use,
-# "build.properties", and override values to adapt the script to your
-# project structure.
-
-# Project target.
-target=android-4
-android.library=true
diff --git a/mopub-sdk/etc/mraid.js b/mopub-sdk/etc/mraid.js
index 443df6ff..1dff72b6 100644
--- a/mopub-sdk/etc/mraid.js
+++ b/mopub-sdk/etc/mraid.js
@@ -17,6 +17,9 @@
   // Establish the root mraidbridge object.
   var mraidbridge = window.mraidbridge = {};
 
+  // native SDK is ready to process mraid commands.
+  var nativeSDKFiredReady = false;
+
   // Listeners for bridge events.
   var listeners = {};
 
@@ -29,6 +32,7 @@
   //////////////////////////////////////////////////////////////////////////////////////////////////
 
   mraidbridge.fireReadyEvent = function() {
+    nativeSDKFiredReady = true;
     mraidbridge.fireEvent('ready');
   };
 
@@ -63,6 +67,12 @@
   };
 
   mraidbridge.executeNativeCall = function(command) {
+    if (!nativeSDKFiredReady) {
+        console.log('rejecting ' + command + ' because mraid is not ready');
+        mraidbridge.fireErrorEvent('mraid is not ready', command);
+        return;
+    }
+
     var call = 'mraid://' + command;
 
     var key, value;
diff --git a/mopub-sdk/gradle/wrapper/gradle-wrapper.jar b/mopub-sdk/gradle/wrapper/gradle-wrapper.jar
new file mode 100644
index 00000000..3c7abdf1
Binary files /dev/null and b/mopub-sdk/gradle/wrapper/gradle-wrapper.jar differ
diff --git a/mopub-sdk/gradle/wrapper/gradle-wrapper.properties b/mopub-sdk/gradle/wrapper/gradle-wrapper.properties
new file mode 100644
index 00000000..d27e87ae
--- /dev/null
+++ b/mopub-sdk/gradle/wrapper/gradle-wrapper.properties
@@ -0,0 +1,6 @@
+#Thu Mar 20 15:07:53 PDT 2014
+distributionBase=GRADLE_USER_HOME
+distributionPath=wrapper/dists
+zipStoreBase=GRADLE_USER_HOME
+zipStorePath=wrapper/dists
+distributionUrl=http\://services.gradle.org/distributions/gradle-1.11-bin.zip
diff --git a/mopub-sdk/gradlew b/mopub-sdk/gradlew
new file mode 100755
index 00000000..91a7e269
--- /dev/null
+++ b/mopub-sdk/gradlew
@@ -0,0 +1,164 @@
+#!/usr/bin/env bash
+
+##############################################################################
+##
+##  Gradle start up script for UN*X
+##
+##############################################################################
+
+# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
+DEFAULT_JVM_OPTS=""
+
+APP_NAME="Gradle"
+APP_BASE_NAME=`basename "$0"`
+
+# Use the maximum available, or set MAX_FD != -1 to use that value.
+MAX_FD="maximum"
+
+warn ( ) {
+    echo "$*"
+}
+
+die ( ) {
+    echo
+    echo "$*"
+    echo
+    exit 1
+}
+
+# OS specific support (must be 'true' or 'false').
+cygwin=false
+msys=false
+darwin=false
+case "`uname`" in
+  CYGWIN* )
+    cygwin=true
+    ;;
+  Darwin* )
+    darwin=true
+    ;;
+  MINGW* )
+    msys=true
+    ;;
+esac
+
+# For Cygwin, ensure paths are in UNIX format before anything is touched.
+if $cygwin ; then
+    [ -n "$JAVA_HOME" ] && JAVA_HOME=`cygpath --unix "$JAVA_HOME"`
+fi
+
+# Attempt to set APP_HOME
+# Resolve links: $0 may be a link
+PRG="$0"
+# Need this for relative symlinks.
+while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+        PRG="$link"
+    else
+        PRG=`dirname "$PRG"`"/$link"
+    fi
+done
+SAVED="`pwd`"
+cd "`dirname \"$PRG\"`/" >&-
+APP_HOME="`pwd -P`"
+cd "$SAVED" >&-
+
+CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar
+
+# Determine the Java command to use to start the JVM.
+if [ -n "$JAVA_HOME" ] ; then
+    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
+        # IBM's JDK on AIX uses strange locations for the executables
+        JAVACMD="$JAVA_HOME/jre/sh/java"
+    else
+        JAVACMD="$JAVA_HOME/bin/java"
+    fi
+    if [ ! -x "$JAVACMD" ] ; then
+        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME
+
+Please set the JAVA_HOME variable in your environment to match the
+location of your Java installation."
+    fi
+else
+    JAVACMD="java"
+    which java >/dev/null 2>&1 || die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
+
+Please set the JAVA_HOME variable in your environment to match the
+location of your Java installation."
+fi
+
+# Increase the maximum file descriptors if we can.
+if [ "$cygwin" = "false" -a "$darwin" = "false" ] ; then
+    MAX_FD_LIMIT=`ulimit -H -n`
+    if [ $? -eq 0 ] ; then
+        if [ "$MAX_FD" = "maximum" -o "$MAX_FD" = "max" ] ; then
+            MAX_FD="$MAX_FD_LIMIT"
+        fi
+        ulimit -n $MAX_FD
+        if [ $? -ne 0 ] ; then
+            warn "Could not set maximum file descriptor limit: $MAX_FD"
+        fi
+    else
+        warn "Could not query maximum file descriptor limit: $MAX_FD_LIMIT"
+    fi
+fi
+
+# For Darwin, add options to specify how the application appears in the dock
+if $darwin; then
+    GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
+fi
+
+# For Cygwin, switch paths to Windows format before running java
+if $cygwin ; then
+    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
+    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`
+
+    # We build the pattern for arguments to be converted via cygpath
+    ROOTDIRSRAW=`find -L / -maxdepth 1 -mindepth 1 -type d 2>/dev/null`
+    SEP=""
+    for dir in $ROOTDIRSRAW ; do
+        ROOTDIRS="$ROOTDIRS$SEP$dir"
+        SEP="|"
+    done
+    OURCYGPATTERN="(^($ROOTDIRS))"
+    # Add a user-defined pattern to the cygpath arguments
+    if [ "$GRADLE_CYGPATTERN" != "" ] ; then
+        OURCYGPATTERN="$OURCYGPATTERN|($GRADLE_CYGPATTERN)"
+    fi
+    # Now convert the arguments - kludge to limit ourselves to /bin/sh
+    i=0
+    for arg in "$@" ; do
+        CHECK=`echo "$arg"|egrep -c "$OURCYGPATTERN" -`
+        CHECK2=`echo "$arg"|egrep -c "^-"`                                 ### Determine if an option
+
+        if [ $CHECK -ne 0 ] && [ $CHECK2 -eq 0 ] ; then                    ### Added a condition
+            eval `echo args$i`=`cygpath --path --ignore --mixed "$arg"`
+        else
+            eval `echo args$i`="\"$arg\""
+        fi
+        i=$((i+1))
+    done
+    case $i in
+        (0) set -- ;;
+        (1) set -- "$args0" ;;
+        (2) set -- "$args0" "$args1" ;;
+        (3) set -- "$args0" "$args1" "$args2" ;;
+        (4) set -- "$args0" "$args1" "$args2" "$args3" ;;
+        (5) set -- "$args0" "$args1" "$args2" "$args3" "$args4" ;;
+        (6) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" ;;
+        (7) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" ;;
+        (8) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" ;;
+        (9) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" "$args8" ;;
+    esac
+fi
+
+# Split up the JVM_OPTS And GRADLE_OPTS values into an array, following the shell quoting and substitution rules
+function splitJvmOpts() {
+    JVM_OPTS=("$@")
+}
+eval splitJvmOpts $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS
+JVM_OPTS[${#JVM_OPTS[*]}]="-Dorg.gradle.appname=$APP_BASE_NAME"
+
+exec "$JAVACMD" "${JVM_OPTS[@]}" -classpath "$CLASSPATH" org.gradle.wrapper.GradleWrapperMain "$@"
diff --git a/mopub-sdk/gradlew.bat b/mopub-sdk/gradlew.bat
new file mode 100644
index 00000000..8a0b282a
--- /dev/null
+++ b/mopub-sdk/gradlew.bat
@@ -0,0 +1,90 @@
+@if "%DEBUG%" == "" @echo off
+@rem ##########################################################################
+@rem
+@rem  Gradle startup script for Windows
+@rem
+@rem ##########################################################################
+
+@rem Set local scope for the variables with windows NT shell
+if "%OS%"=="Windows_NT" setlocal
+
+@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
+set DEFAULT_JVM_OPTS=
+
+set DIRNAME=%~dp0
+if "%DIRNAME%" == "" set DIRNAME=.
+set APP_BASE_NAME=%~n0
+set APP_HOME=%DIRNAME%
+
+@rem Find java.exe
+if defined JAVA_HOME goto findJavaFromJavaHome
+
+set JAVA_EXE=java.exe
+%JAVA_EXE% -version >NUL 2>&1
+if "%ERRORLEVEL%" == "0" goto init
+
+echo.
+echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
+echo.
+echo Please set the JAVA_HOME variable in your environment to match the
+echo location of your Java installation.
+
+goto fail
+
+:findJavaFromJavaHome
+set JAVA_HOME=%JAVA_HOME:"=%
+set JAVA_EXE=%JAVA_HOME%/bin/java.exe
+
+if exist "%JAVA_EXE%" goto init
+
+echo.
+echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
+echo.
+echo Please set the JAVA_HOME variable in your environment to match the
+echo location of your Java installation.
+
+goto fail
+
+:init
+@rem Get command-line arguments, handling Windowz variants
+
+if not "%OS%" == "Windows_NT" goto win9xME_args
+if "%@eval[2+2]" == "4" goto 4NT_args
+
+:win9xME_args
+@rem Slurp the command line arguments.
+set CMD_LINE_ARGS=
+set _SKIP=2
+
+:win9xME_args_slurp
+if "x%~1" == "x" goto execute
+
+set CMD_LINE_ARGS=%*
+goto execute
+
+:4NT_args
+@rem Get arguments from the 4NT Shell from JP Software
+set CMD_LINE_ARGS=%$
+
+:execute
+@rem Setup the command line
+
+set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar
+
+@rem Execute Gradle
+"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %CMD_LINE_ARGS%
+
+:end
+@rem End local scope for the variables with windows NT shell
+if "%ERRORLEVEL%"=="0" goto mainEnd
+
+:fail
+rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
+rem the _cmd.exe /c_ return code!
+if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
+exit /b 1
+
+:mainEnd
+if "%OS%"=="Windows_NT" endlocal
+
+:omega
diff --git a/mopub-sdk/pom.xml b/mopub-sdk/pom.xml
index 2cbbc97f..6b8156e6 100644
--- a/mopub-sdk/pom.xml
+++ b/mopub-sdk/pom.xml
@@ -36,39 +36,17 @@
             <scope>test</scope>
         </dependency>
 
-        <dependency>
-            <groupId>org.apache.httpcomponents</groupId>
-            <artifactId>httpcore</artifactId>
-            <version>4.0.1</version>
-            <scope>test</scope>
-        </dependency>
-
         <dependency>
             <groupId>com.squareup</groupId>
             <artifactId>fest-android</artifactId>
-            <version>1.0.1</version>
-            <scope>test</scope>
-        </dependency>
-
-        <!-- this needs to come above fest-reflect or we pick up the wrong org.fest.util.Strings -->
-        <dependency>
-            <groupId>org.easytesting</groupId>
-            <artifactId>fest-assert-core</artifactId>
-            <version>2.0M9</version>
-            <scope>test</scope>
-        </dependency>
-
-        <dependency>
-            <groupId>org.easytesting</groupId>
-            <artifactId>fest-reflect</artifactId>
-            <version>1.4</version>
+            <version>1.0.7</version>
             <scope>test</scope>
         </dependency>
 
         <dependency>
             <groupId>junit</groupId>
-            <artifactId>junit</artifactId>
-            <version>4.8.2</version>
+            <artifactId>junit-dep</artifactId>
+            <version>4.10</version>
             <scope>test</scope>
         </dependency>
 
@@ -90,7 +68,7 @@
         <dependency>
             <groupId>com.google.android</groupId>
             <artifactId>android</artifactId>
-            <version>4.1.2</version>
+            <version>4.4.2</version>
             <scope>provided</scope>
         </dependency>
     </dependencies>
@@ -114,7 +92,7 @@
                 <configuration>
                     <sdk>
                         <!-- platform or api level (api level 4 = platform 1.6)-->
-                        <platform>16</platform>
+                        <platform>19</platform>
                     </sdk>
                     <undeployBeforeDeploy>true</undeployBeforeDeploy>
                 </configuration>
@@ -129,6 +107,7 @@
                     <excludes>
                         <exclude>**/Test*.java</exclude>
                     </excludes>
+                    <parallel>classesAndMethods</parallel>
                 </configuration>
             </plugin>
         </plugins>
diff --git a/mopub-sdk/proguard.cfg b/mopub-sdk/proguard.cfg
deleted file mode 100644
index e009ace4..00000000
--- a/mopub-sdk/proguard.cfg
+++ /dev/null
@@ -1,44 +0,0 @@
--optimizationpasses 5
--dontusemixedcaseclassnames
--dontskipnonpubliclibraryclasses
--dontpreverify
--verbose
--optimizations !code/simplification/arithmetic,!field/*,!class/merging/*
-
--keep public class * extends android.app.Activity
--keep public class * extends android.app.Application
--keep public class * extends android.app.Service
--keep public class * extends android.content.BroadcastReceiver
--keep public class * extends android.content.ContentProvider
--keep public class * extends android.app.backup.BackupAgentHelper
--keep public class * extends android.preference.Preference
--keep public class com.android.vending.licensing.ILicensingService
-
--keepclasseswithmembernames class * {
-    native <methods>;
-}
-
--keepclasseswithmembers class * {
-    public <init>(android.content.Context, android.util.AttributeSet);
-}
-
--keepclasseswithmembers class * {
-    public <init>(android.content.Context, android.util.AttributeSet, int);
-}
-
--keepclassmembers class * extends android.app.Activity {
-   public void *(android.view.View);
-}
-
--keepclassmembers enum * {
-    public static **[] values();
-    public static ** valueOf(java.lang.String);
-}
-
--keep class * implements android.os.Parcelable {
-    public static final android.os.Parcelable$Creator *;
-}
-
--keep class com.chartboost.sdk.** {
-    *;
-}
diff --git a/mopub-sdk/proguard.txt b/mopub-sdk/proguard.txt
new file mode 100644
index 00000000..17b5b82f
--- /dev/null
+++ b/mopub-sdk/proguard.txt
@@ -0,0 +1,16 @@
+# MoPub Proguard Config
+# NOTE: You should also include the Android Proguard config found with the build tools:
+# $ANDROID_HOME/tools/proguard/proguard-android.txt
+
+# Keep public classes and methods.
+-keepclassmembers class com.mopub.** { public *; }
+-keep public class com.mopub.**
+
+# Explicitly keep any custom event classes in any package.
+-keep class * extends com.mopub.mobileads.CustomEventBanner {}
+-keep class * extends com.mopub.mobileads.CustomEventInterstitial {}
+-keep class * extends com.mopub.nativeads.CustomEventNative {}
+
+# Support for Android Advertiser ID.
+-keep class com.google.android.gms.common.GooglePlayServicesUtil {*;}
+-keep class com.google.android.gms.ads.identifier.AdvertisingIdClient {*;}
diff --git a/mopub-sdk/settings.gradle b/mopub-sdk/settings.gradle
new file mode 100644
index 00000000..b44b682c
--- /dev/null
+++ b/mopub-sdk/settings.gradle
@@ -0,0 +1 @@
+rootProject.name = 'mopub-sdk'
diff --git a/mopub-sdk/src/main/java/android/webkit/JavascriptInterface.java b/mopub-sdk/src/main/java/android/webkit/JavascriptInterface.java
deleted file mode 100644
index 5c490a27..00000000
--- a/mopub-sdk/src/main/java/android/webkit/JavascriptInterface.java
+++ /dev/null
@@ -1,13 +0,0 @@
-package android.webkit;
-
-/*
- * Starting with API 17, calls to WebView#addJavascriptInterface must be marked with a
- * @JavascriptInterface annotation. Unfortunately, the annotation itself is only available on API
- * 17+, so we cheat by making a copy for our own use.
- *
- * http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)
- */
-@java.lang.annotation.Retention(java.lang.annotation.RetentionPolicy.RUNTIME)
-@java.lang.annotation.Target({java.lang.annotation.ElementType.METHOD})
-public @interface JavascriptInterface {
-}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/AdUrlGenerator.java b/mopub-sdk/src/main/java/com/mopub/common/AdUrlGenerator.java
index 7852fd5e..2a012bed 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/AdUrlGenerator.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/AdUrlGenerator.java
@@ -1,80 +1,19 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common;
 
 import android.content.Context;
-import android.content.res.Configuration;
 import android.location.Location;
-import android.net.ConnectivityManager;
-import android.net.NetworkInfo;
-import android.telephony.TelephonyManager;
 
-import com.mopub.common.util.DateAndTime;
 import com.mopub.common.util.IntentUtils;
 
-import java.text.SimpleDateFormat;
-
-import static android.Manifest.permission.ACCESS_NETWORK_STATE;
-import static android.content.pm.PackageManager.PERMISSION_GRANTED;
-import static android.net.ConnectivityManager.TYPE_MOBILE;
-import static android.net.ConnectivityManager.TYPE_WIFI;
-import static com.mopub.common.AdUrlGenerator.MoPubNetworkType.ETHERNET;
-import static com.mopub.common.AdUrlGenerator.MoPubNetworkType.MOBILE;
-import static com.mopub.common.AdUrlGenerator.MoPubNetworkType.UNKNOWN;
-import static com.mopub.common.AdUrlGenerator.MoPubNetworkType.WIFI;
+import static com.mopub.common.ClientMetadata.MoPubNetworkType;
 
 public abstract class AdUrlGenerator extends BaseUrlGenerator {
     private static TwitterAppInstalledStatus sTwitterAppInstalledStatus = TwitterAppInstalledStatus.UNKNOWN;
-    public static final String DEVICE_ORIENTATION_PORTRAIT = "p";
-    public static final String DEVICE_ORIENTATION_LANDSCAPE = "l";
-    public static final String DEVICE_ORIENTATION_SQUARE = "s";
-    public static final String DEVICE_ORIENTATION_UNKNOWN = "u";
-
-    // From ConnectivityManager
-    public static final int TYPE_DUMMY = 0x8;
-    public static final int TYPE_ETHERNET = 0x9;
-    public static final int TYPE_MOBILE_DUN = 0x4;
-    public static final int TYPE_MOBILE_HIPRI = 0x5;
-    public static final int TYPE_MOBILE_MMS = 0x2;
-    public static final int TYPE_MOBILE_SUPL = 0x3;
 
     protected Context mContext;
-    protected TelephonyManager mTelephonyManager;
-    protected ConnectivityManager mConnectivityManager;
     protected String mAdUnitId;
     protected String mKeywords;
     protected Location mLocation;
-    protected boolean mFacebookSupportEnabled;
 
     public static enum TwitterAppInstalledStatus {
         UNKNOWN,
@@ -82,22 +21,8 @@
         INSTALLED,
     }
 
-    public static enum MoPubNetworkType {
-        UNKNOWN,
-        ETHERNET,
-        WIFI,
-        MOBILE;
-
-        @Override
-        public String toString() {
-            return Integer.toString(ordinal());
-        }
-    }
-
     public AdUrlGenerator(Context context) {
         mContext = context;
-        mTelephonyManager = (TelephonyManager) mContext.getSystemService(Context.TELEPHONY_SERVICE);
-        mConnectivityManager = (ConnectivityManager) mContext.getSystemService(Context.CONNECTIVITY_SERVICE);
     }
 
     public AdUrlGenerator withAdUnitId(String adUnitId) {
@@ -110,11 +35,6 @@ public AdUrlGenerator withKeywords(String keywords) {
         return this;
     }
 
-    public AdUrlGenerator withFacebookSupported(boolean enabled) {
-        mFacebookSupportEnabled = enabled;
-        return this;
-    }
-
     public AdUrlGenerator withLocation(Location location) {
         mLocation = location;
         return this;
@@ -143,16 +63,8 @@ protected void setTimezone(String timeZoneOffsetString) {
         addParam("z", timeZoneOffsetString);
     }
 
-    protected void setOrientation(int orientation) {
-        String orString = DEVICE_ORIENTATION_UNKNOWN;
-        if (orientation == Configuration.ORIENTATION_PORTRAIT) {
-            orString = DEVICE_ORIENTATION_PORTRAIT;
-        } else if (orientation == Configuration.ORIENTATION_LANDSCAPE) {
-            orString = DEVICE_ORIENTATION_LANDSCAPE;
-        } else if (orientation == Configuration.ORIENTATION_SQUARE) {
-            orString = DEVICE_ORIENTATION_SQUARE;
-        }
-        addParam("o", orString);
+    protected void setOrientation(String orientation) {
+        addParam("o", orientation);
     }
 
     protected void setDensity(float density) {
@@ -181,56 +93,18 @@ protected void setCarrierName(String networkOperatorName) {
         addParam("cn", networkOperatorName);
     }
 
-    protected void setNetworkType(int type) {
-        switch(type) {
-            case TYPE_ETHERNET:
-                addParam("ct", ETHERNET);
-                break;
-            case TYPE_WIFI:
-                addParam("ct", WIFI);
-                break;
-            case TYPE_MOBILE:
-            case TYPE_MOBILE_DUN:
-            case TYPE_MOBILE_HIPRI:
-            case TYPE_MOBILE_MMS:
-            case TYPE_MOBILE_SUPL:
-                addParam("ct", MOBILE);
-                break;
-            default:
-                addParam("ct", UNKNOWN);
-        }
+    protected void setNetworkType(MoPubNetworkType networkType) {
+        addParam("ct", networkType);
     }
 
     private void addParam(String key, MoPubNetworkType value) {
         addParam(key, value.toString());
     }
-    protected String getNetworkOperator() {
-        String networkOperator = mTelephonyManager.getNetworkOperator();
-        if (mTelephonyManager.getPhoneType() == TelephonyManager.PHONE_TYPE_CDMA &&
-                mTelephonyManager.getSimState() == TelephonyManager.SIM_STATE_READY) {
-            networkOperator = mTelephonyManager.getSimOperator();
-        }
-        return networkOperator;
-    }
 
     private int mncPortionLength(String networkOperator) {
         return Math.min(3, networkOperator.length());
     }
 
-    protected static String getTimeZoneOffsetString() {
-        SimpleDateFormat format = new SimpleDateFormat("Z");
-        format.setTimeZone(DateAndTime.localTimeZone());
-        return format.format(DateAndTime.now());
-    }
-
-    protected int getActiveNetworkType() {
-        if (mContext.checkCallingOrSelfPermission(ACCESS_NETWORK_STATE) == PERMISSION_GRANTED) {
-            NetworkInfo activeNetworkInfo = mConnectivityManager.getActiveNetworkInfo();
-            return activeNetworkInfo != null ? activeNetworkInfo.getType() : TYPE_DUMMY;
-        }
-        return TYPE_DUMMY;
-    }
-
     protected void setTwitterAppInstalledFlag() {
         if (sTwitterAppInstalledStatus == TwitterAppInstalledStatus.UNKNOWN) {
             sTwitterAppInstalledStatus = getTwitterAppInstallStatus();
@@ -249,4 +123,12 @@ public TwitterAppInstalledStatus getTwitterAppInstallStatus() {
     public static void setTwitterAppInstalledStatus(TwitterAppInstalledStatus status) {
         sTwitterAppInstalledStatus = status;
     }
+
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
+    public AdUrlGenerator withFacebookSupported(boolean enabled) {
+        return this;
+    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/common/BaseUrlGenerator.java b/mopub-sdk/src/main/java/com/mopub/common/BaseUrlGenerator.java
index 9fec434f..2b7eb021 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/BaseUrlGenerator.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/BaseUrlGenerator.java
@@ -1,43 +1,6 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common;
 
-import android.content.Context;
-import android.content.pm.PackageInfo;
 import android.net.Uri;
-import android.provider.Settings;
-
-import com.mopub.common.util.Utils;
 
 import static com.mopub.common.util.Strings.isEmpty;
 
@@ -113,30 +76,4 @@ protected void setDoNotTrack(boolean dnt) {
     protected void setUdid(String udid) {
         addParam("udid", udid);
     }
-
-    protected String getUdidFromContext(Context context) {
-        /*
-         * try to use the android id from Google Play Services if available
-         * if not fall back on the device id
-         */
-        final String androidId = GpsHelper.getAdvertisingId(context);
-
-        if (androidId != null) {
-            return IFA_PREFIX + androidId;
-        } else {
-            String deviceId = Settings.Secure.getString(context.getContentResolver(), Settings.Secure.ANDROID_ID);
-            deviceId = (deviceId == null) ? "" : Utils.sha1(deviceId);
-            return SHA_PREFIX + deviceId;
-        }
-    }
-
-    protected String getAppVersionFromContext(Context context) {
-        try {
-            String packageName = context.getPackageName();
-            PackageInfo packageInfo = context.getPackageManager().getPackageInfo(packageName, 0);
-            return packageInfo.versionName;
-        } catch (Exception exception) {
-            return null;
-        }
-    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/common/CacheService.java b/mopub-sdk/src/main/java/com/mopub/common/CacheService.java
index da362092..fcc5fad2 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/CacheService.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/CacheService.java
@@ -1,11 +1,12 @@
 package com.mopub.common;
 
 import android.content.Context;
+import android.graphics.Bitmap;
 import android.os.AsyncTask;
 import android.support.v4.util.LruCache;
 
 import com.mopub.common.util.DeviceUtils;
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Streams;
 import com.mopub.common.util.Utils;
 
@@ -20,6 +21,10 @@
 import static com.mopub.common.DiskLruCache.open;
 
 public class CacheService {
+    public static interface DiskLruCacheGetListener {
+        void onComplete(final String key, final byte[] content);
+    }
+
     static final String UNIQUE_CACHE_NAME = "mopub-cache";
     private static final int APP_VERSION = 1;
     // The number of values per cache entry. Must be positive.
@@ -27,16 +32,16 @@
     private static final int DISK_CACHE_INDEX = 0;
 
     private static DiskLruCache sDiskLruCache;
-    private static MemoryLruCache sMemoryLruCache;
+    private static BitmapLruCache sBitmapLruCache;
 
-    public static boolean initializeMemoryCache(final Context context) {
+    public static boolean initializeBitmapCache(final Context context) {
         if (context == null) {
             return false;
         }
 
-        if (sMemoryLruCache == null) {
+        if (sBitmapLruCache == null) {
             final int memoryCacheSizeBytes = DeviceUtils.memoryCacheSizeBytes(context);
-            sMemoryLruCache = new MemoryLruCache(memoryCacheSizeBytes);
+            sBitmapLruCache = new BitmapLruCache(memoryCacheSizeBytes);
         }
         return true;
     }
@@ -63,8 +68,8 @@ public static boolean initializeDiskCache(final Context context) {
         return true;
     }
 
-    public static void initializeCaches(final Context context) {
-        initializeMemoryCache(context);
+    public static void initialize(final Context context) {
+        initializeBitmapCache(context);
         initializeDiskCache(context);
     }
 
@@ -105,12 +110,12 @@ public static String getFilePathDiskCache(final String key) {
                 + DISK_CACHE_INDEX;
     }
 
-    public static byte[] getFromMemoryCache(final String key) {
-        if (sMemoryLruCache == null) {
+    public static Bitmap getFromBitmapCache(final String key) {
+        if (sBitmapLruCache == null) {
             return null;
         }
 
-        return sMemoryLruCache.get(key);
+        return sBitmapLruCache.get(key);
     }
 
     public static byte[] getFromDiskCache(final String key) {
@@ -151,20 +156,12 @@ public static void getFromDiskCacheAsync(final String key, final DiskLruCacheGet
         new DiskLruCacheGetTask(key, diskLruCacheGetListener).execute();
     }
 
-    public static byte[] get(final String key) {
-        byte[] bytes = getFromMemoryCache(key);
-        if (bytes != null) {
-            return bytes;
-        }
-        return getFromDiskCache(key);
-    }
-
-    public static void putToMemoryCache(final String key, final byte[] content) {
-        if (sMemoryLruCache == null) {
+    public static void putToBitmapCache(final String key, final Bitmap bitmap) {
+        if (sBitmapLruCache == null) {
             return;
         }
 
-        sMemoryLruCache.put(key, content);
+        sBitmapLruCache.put(key, bitmap);
     }
 
     public static boolean putToDiskCache(final String key, final byte[] content) {
@@ -211,30 +208,21 @@ public static void putToDiskCacheAsync(final String key, final byte[] content) {
         new DiskLruCachePutTask(key, content).execute();
     }
 
-    public static void put(final String key, final byte[] content) {
-        putToMemoryCache(key, content);
-        putToDiskCacheAsync(key, content);
-    }
-
-    private static class MemoryLruCache extends LruCache<String, byte[]> {
-        public MemoryLruCache(int maxSize) {
+    private static class BitmapLruCache extends LruCache<String, Bitmap> {
+        public BitmapLruCache(final int maxSize) {
             super(maxSize);
         }
 
         @Override
-        protected int sizeOf(final String key, final byte[] bytes) {
-            if (bytes != null && bytes.length > 0) {
-                return bytes.length;
+        protected int sizeOf(final String key, final Bitmap bitmap) {
+            if (bitmap != null) {
+                return bitmap.getRowBytes() * bitmap.getHeight();
             }
 
-            return super.sizeOf(key, bytes);
+            return super.sizeOf(key, bitmap);
         }
     }
 
-    public static interface DiskLruCacheGetListener {
-        void onComplete(final String key, final byte[] content);
-    }
-
     private static class DiskLruCacheGetTask extends AsyncTask<Void, Void, byte[]> {
         private final DiskLruCacheGetListener mDiskLruCacheGetListener;
         private final String mKey;
@@ -287,6 +275,7 @@ protected Void doInBackground(Void... voids) {
 
     // Testing
     @Deprecated
+    @VisibleForTesting
     public static void clearAndNullCaches() {
         if (sDiskLruCache != null) {
             try {
@@ -296,20 +285,22 @@ public static void clearAndNullCaches() {
                 sDiskLruCache = null;
             }
         }
-        if (sMemoryLruCache != null) {
-            sMemoryLruCache.evictAll();
-            sMemoryLruCache = null;
+        if (sBitmapLruCache != null) {
+            sBitmapLruCache.evictAll();
+            sBitmapLruCache = null;
         }
     }
 
     // Testing
     @Deprecated
-    public static LruCache<String, byte[]> getMemoryLruCache() {
-        return sMemoryLruCache;
+    @VisibleForTesting
+    public static LruCache<String, Bitmap> getBitmapLruCache() {
+        return sBitmapLruCache;
     }
 
     // Testing
     @Deprecated
+    @VisibleForTesting
     public static DiskLruCache getDiskLruCache() {
         return sDiskLruCache;
     }
diff --git a/mopub-sdk/src/main/java/com/mopub/common/ClientMetadata.java b/mopub-sdk/src/main/java/com/mopub/common/ClientMetadata.java
new file mode 100644
index 00000000..d3189e99
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/ClientMetadata.java
@@ -0,0 +1,287 @@
+package com.mopub.common;
+
+import android.content.Context;
+import android.content.pm.PackageInfo;
+import android.content.res.Configuration;
+import android.net.ConnectivityManager;
+import android.net.NetworkInfo;
+import android.os.Build;
+import android.provider.Settings;
+import android.telephony.TelephonyManager;
+
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.util.Utils;
+
+import static android.Manifest.permission.ACCESS_NETWORK_STATE;
+import static android.content.pm.PackageManager.PERMISSION_GRANTED;
+
+/**
+ * Singleton that caches Client objects so they will be available to background threads.
+ */
+public class ClientMetadata {
+    // Network type constant defined after API 9:
+    private static final int TYPE_ETHERNET = 9;
+
+    private static final String DEVICE_ORIENTATION_PORTRAIT = "p";
+    private static final String DEVICE_ORIENTATION_LANDSCAPE = "l";
+    private static final String DEVICE_ORIENTATION_SQUARE = "s";
+    private static final String DEVICE_ORIENTATION_UNKNOWN = "u";
+    private static final String IFA_PREFIX = "ifa:";
+    private static final String SHA_PREFIX = "sha:";
+    private static final int UNKNOWN_NETWORK = -1;
+
+    private static volatile ClientMetadata sInstance;
+
+    private String mNetworkOperator;
+    private String mIsoCountryCode;
+    private String mNetworkOperatorName;
+    private String mUdid;
+
+    /**
+     * Returns the singleton ClientMetadata object, using the context to obtain data if necessary.
+     */
+    public static ClientMetadata getInstance(Context context) {
+        // Use a local variable so we can reduce accesses of the volatile field.
+        ClientMetadata result = sInstance;
+        if (result == null) {
+            synchronized (ClientMetadata.class) {
+                result = sInstance;
+                if (result == null) {
+                    result = new ClientMetadata(context);
+                    sInstance = result;
+                }
+            }
+        }
+        return result;
+    }
+
+    /**
+     * Can be used by background threads and other objects without a context to attempt to get
+     * ClientMetadata. If the object has never been referenced from a thread with a context,
+     * this will return null.
+     */
+    public static ClientMetadata getInstance() {
+        ClientMetadata result = sInstance;
+        if (result == null) {
+            // If it's being initialized in another thread, wait for the lock.
+            synchronized (ClientMetadata.class) {
+                result = sInstance;
+            }
+        }
+
+        return result;
+    }
+
+    public static enum MoPubNetworkType {
+        UNKNOWN(0),
+        ETHERNET(1),
+        WIFI(2),
+        MOBILE(3);
+
+        private final int mId;
+
+        private MoPubNetworkType(int id) {
+            mId = id;
+        }
+
+        @Override
+        public String toString() {
+            return Integer.toString(mId);
+        }
+
+        private static MoPubNetworkType fromAndroidNetworkType(int type) {
+            switch(type) {
+                case TYPE_ETHERNET:
+                    return ETHERNET;
+                case ConnectivityManager.TYPE_WIFI:
+                    return WIFI;
+                case ConnectivityManager.TYPE_MOBILE:
+                case ConnectivityManager.TYPE_MOBILE_DUN:
+                case ConnectivityManager.TYPE_MOBILE_HIPRI:
+                case ConnectivityManager.TYPE_MOBILE_MMS:
+                case ConnectivityManager.TYPE_MOBILE_SUPL:
+                    return MOBILE;
+                default:
+                    return UNKNOWN;
+            }
+        }
+    }
+
+    // Cached client metadata used for generating URLs and events.
+    private final String mDeviceManufacturer;
+    private final String mDeviceModel;
+    private final String mDeviceProduct;
+    private final String mSdkVersion;
+    private final String mAppVersion;
+    private final Context mContext;
+    private final ConnectivityManager mConnectivityManager;
+
+    private ClientMetadata(Context context) {
+        mContext = context.getApplicationContext();
+        mConnectivityManager =
+                (ConnectivityManager) mContext.getSystemService(Context.CONNECTIVITY_SERVICE);
+        mDeviceManufacturer = Build.MANUFACTURER;
+        mDeviceModel = Build.MODEL;
+        mDeviceProduct = Build.PRODUCT;
+        mSdkVersion = MoPub.SDK_VERSION;
+
+        // Cache context items that don't change:
+        mAppVersion = getAppVersionFromContext(mContext);
+
+        final TelephonyManager telephonyManager =
+                (TelephonyManager) mContext.getSystemService(Context.TELEPHONY_SERVICE);
+
+        mNetworkOperator = telephonyManager.getNetworkOperator();
+        if (telephonyManager.getPhoneType() == TelephonyManager.PHONE_TYPE_CDMA &&
+                telephonyManager.getSimState() == TelephonyManager.SIM_STATE_READY) {
+            mNetworkOperator = telephonyManager.getSimOperator();
+        }
+
+        mIsoCountryCode = telephonyManager.getNetworkCountryIso();
+        try {
+            // Some Lenovo devices require READ_PHONE_STATE here.
+            mNetworkOperatorName = telephonyManager.getNetworkOperatorName();
+        } catch (SecurityException e) {
+            mNetworkOperatorName = null;
+        }
+
+        mUdid = getUdidFromContext(mContext);
+    }
+
+    private static String getAppVersionFromContext(Context context) {
+        try {
+            final String packageName = context.getPackageName();
+            final PackageInfo packageInfo =
+                    context.getPackageManager().getPackageInfo(packageName, 0);
+            return packageInfo.versionName;
+        } catch (Exception exception) {
+            MoPubLog.d("Failed to retrieve PackageInfo#versionName.");
+            return null;
+        }
+    }
+
+    private static String getUdidFromContext(Context context) {
+        // try to use the android id from Google Play Services if available
+        // if not fall back on the device id
+        final String androidId = GpsHelper.getAdvertisingId(context);
+
+        if (androidId != null) {
+            return IFA_PREFIX + androidId;
+        } else {
+            String deviceId = Settings.Secure.getString(context.getContentResolver(),
+                    Settings.Secure.ANDROID_ID);
+            deviceId = (deviceId == null) ? "" : Utils.sha1(deviceId);
+            return SHA_PREFIX + deviceId;
+        }
+    }
+
+    /**
+     * @return the display orientation. Useful when generating ad requests.
+     */
+    public String getOrientationString() {
+        final int orientationInt = mContext.getResources().getConfiguration().orientation;
+        String orientation = DEVICE_ORIENTATION_UNKNOWN;
+        if (orientationInt == Configuration.ORIENTATION_PORTRAIT) {
+            orientation = DEVICE_ORIENTATION_PORTRAIT;
+        } else if (orientationInt == Configuration.ORIENTATION_LANDSCAPE) {
+            orientation = DEVICE_ORIENTATION_LANDSCAPE;
+        } else if (orientationInt == Configuration.ORIENTATION_SQUARE) {
+            orientation = DEVICE_ORIENTATION_SQUARE;
+        }
+        return orientation;
+    }
+
+
+    public MoPubNetworkType getActiveNetworkType() {
+        int networkType = UNKNOWN_NETWORK;
+        if (mContext.checkCallingOrSelfPermission(ACCESS_NETWORK_STATE) == PERMISSION_GRANTED) {
+            NetworkInfo activeNetworkInfo = mConnectivityManager.getActiveNetworkInfo();
+            networkType = activeNetworkInfo != null
+                    ? activeNetworkInfo.getType() : UNKNOWN_NETWORK;
+        }
+        return MoPubNetworkType.fromAndroidNetworkType(networkType);
+    }
+
+
+    /**
+     * Get the logical density of the display as in {@link android.util.DisplayMetrics#density}
+     */
+    public float getDensity() {
+        return mContext.getResources().getDisplayMetrics().density;
+    }
+
+    /**
+     * @return whether doNotTrack is enabled in the advertising settings.
+     */
+    public boolean getDoNoTrack() {
+        return GpsHelper.isLimitAdTrackingEnabled(mContext);
+    }
+
+    /**
+     * @return the network operator.
+     */
+    public String getNetworkOperator() {
+        return mNetworkOperator;
+    }
+
+    /**
+     * @return the country code of the device.
+     */
+    public String getIsoCountryCode() {
+        return mIsoCountryCode;
+    }
+
+    /**
+     * @return the network operator name.
+     */
+    public String getNetworkOperatorName() {
+        return mNetworkOperatorName;
+    }
+
+    /**
+     * @return the Google Play advertising ID or the device ID if Play Services are not available.
+     */
+    public String getUdid() {
+        return mUdid;
+    }
+
+    /**
+     * @return the device manufacturer.
+     */
+    public String getDeviceManufacturer() {
+        return mDeviceManufacturer;
+    }
+
+    /**
+     * @return the device model identifier.
+     */
+    public String getDeviceModel() {
+        return mDeviceModel;
+    }
+
+    /**
+     * @return the device product identifier.
+     */
+    public String getDeviceProduct() {
+        return mDeviceProduct;
+    }
+
+    /**
+     * @return the MoPub SDK Version.
+     */
+    public String getSdkVersion() {
+        return mSdkVersion;
+    }
+
+    /**
+     * @return the version of the application the SDK is included in.
+     */
+    public String getAppVersion() {
+        return mAppVersion;
+    }
+
+    @VisibleForTesting
+    public static synchronized void clearForTesting() {
+        sInstance = null;
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/DownloadTask.java b/mopub-sdk/src/main/java/com/mopub/common/DownloadTask.java
index 3e551b58..fc31c97c 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/DownloadTask.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/DownloadTask.java
@@ -2,9 +2,7 @@
 
 import android.net.http.AndroidHttpClient;
 import android.os.AsyncTask;
-
-import com.mopub.common.util.MoPubLog;
-
+import com.mopub.common.logging.MoPubLog;
 import org.apache.http.HttpResponse;
 import org.apache.http.client.methods.HttpUriRequest;
 
@@ -40,7 +38,7 @@ protected DownloadResponse doInBackground(final HttpUriRequest... httpUriRequest
             final HttpResponse httpResponse = httpClient.execute(httpUriRequest);
             return new DownloadResponse(httpResponse);
         } catch (Exception e) {
-            MoPubLog.d("Download task threw an internal exception");
+            MoPubLog.d("Download task threw an internal exception", e);
             cancel(true);
             return null;
         } finally {
diff --git a/mopub-sdk/src/main/java/com/mopub/common/GpsHelper.java b/mopub-sdk/src/main/java/com/mopub/common/GpsHelper.java
index e8a6ceeb..70874038 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/GpsHelper.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/GpsHelper.java
@@ -3,10 +3,9 @@
 import android.content.Context;
 import android.content.SharedPreferences;
 import android.os.AsyncTask;
-
 import com.mopub.common.factories.MethodBuilderFactory;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.AsyncTasks;
-import com.mopub.common.util.MoPubLog;
 
 import java.lang.ref.WeakReference;
 
diff --git a/mopub-sdk/src/main/java/com/mopub/common/HttpClient.java b/mopub-sdk/src/main/java/com/mopub/common/HttpClient.java
index 45423e77..88e4f7bd 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/HttpClient.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/HttpClient.java
@@ -8,7 +8,7 @@
 
 import com.mopub.common.util.AsyncTasks;
 import com.mopub.common.util.DeviceUtils;
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 import org.apache.http.HttpStatus;
 import org.apache.http.client.methods.HttpGet;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/HttpResponses.java b/mopub-sdk/src/main/java/com/mopub/common/HttpResponses.java
index df8dbaaa..457a69fb 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/HttpResponses.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/HttpResponses.java
@@ -1,12 +1,14 @@
 package com.mopub.common;
 
 import android.graphics.Bitmap;
-import android.graphics.BitmapFactory;
 
 import org.json.JSONObject;
 import org.json.JSONTokener;
 
+import static android.graphics.BitmapFactory.decodeByteArray;
+
 public final class HttpResponses {
+
     private HttpResponses() {}
 
     public static Bitmap asBitmap(final DownloadResponse downloadResponse) {
@@ -15,7 +17,7 @@ public static Bitmap asBitmap(final DownloadResponse downloadResponse) {
         }
 
         final byte[] bytes = downloadResponse.getByteArray();
-        return BitmapFactory.decodeByteArray(bytes, 0, bytes.length);
+        return decodeByteArray(bytes, 0, bytes.length);
     }
 
     public static JSONObject asJsonObject(final DownloadResponse downloadResponse) {
diff --git a/mopub-sdk/src/main/java/com/mopub/common/LocationService.java b/mopub-sdk/src/main/java/com/mopub/common/LocationService.java
index eff1bb6a..52b2c67b 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/LocationService.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/LocationService.java
@@ -4,12 +4,42 @@
 import android.location.Location;
 import android.location.LocationManager;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 import java.math.BigDecimal;
 
 public class LocationService {
-    public static enum LocationAwareness { NORMAL, TRUNCATED, DISABLED };
+    public static enum LocationAwareness {
+        NORMAL, TRUNCATED, DISABLED;
+
+        // These deprecated methods are only used to support the deprecated methods
+        // MoPubView#setLocationAwareness, MoPubInterstitial#setLocationAwareness
+        // and should not be used elsewhere. Unless interacting with those methods, use
+        // the type MoPub.LocationAwareness
+
+        @Deprecated
+        public MoPub.LocationAwareness getNewLocationAwareness() {
+            if (this == TRUNCATED) {
+                return MoPub.LocationAwareness.TRUNCATED;
+            } else if (this == DISABLED) {
+                return MoPub.LocationAwareness.DISABLED;
+            } else {
+                return MoPub.LocationAwareness.NORMAL;
+            }
+        }
+
+        @Deprecated
+        public static LocationAwareness
+                fromMoPubLocationAwareness(MoPub.LocationAwareness awareness) {
+            if (awareness == MoPub.LocationAwareness.DISABLED) {
+                return DISABLED;
+            } else if (awareness == MoPub.LocationAwareness.TRUNCATED) {
+                return TRUNCATED;
+            } else {
+                return NORMAL;
+            }
+        }
+    }
 
     /*
      * Returns the last known location of the device using its GPS and network location providers.
@@ -19,11 +49,11 @@
      * - Location awareness is disabled in the parent MoPubView
      */
     public static Location getLastKnownLocation(final Context context,
-                                                final int locationPrecision,
-                                                final LocationAwareness locationAwareness) {
+            final int locationPrecision,
+            final MoPub.LocationAwareness locationLocationAwareness) {
         Location result;
 
-        if (locationAwareness == LocationAwareness.DISABLED) {
+        if (locationLocationAwareness == MoPub.LocationAwareness.DISABLED) {
             return null;
         }
 
@@ -48,16 +78,20 @@ public static Location getLastKnownLocation(final Context context,
 
         if (gpsLocation == null && networkLocation == null) {
             return null;
+        } else if (gpsLocation != null && networkLocation != null) {
+            if (gpsLocation.getTime() > networkLocation.getTime()) {
+                result = gpsLocation;
+            } else {
+                result = networkLocation;
+            }
+        } else if (gpsLocation != null) {
+            result = gpsLocation;
+        } else {
+            result = networkLocation;
         }
-        else if (gpsLocation != null && networkLocation != null) {
-            if (gpsLocation.getTime() > networkLocation.getTime()) result = gpsLocation;
-            else result = networkLocation;
-        }
-        else if (gpsLocation != null) result = gpsLocation;
-        else result = networkLocation;
 
         // Truncate latitude/longitude to the number of digits specified by locationPrecision.
-        if (locationAwareness == LocationAwareness.TRUNCATED) {
+        if (locationLocationAwareness == MoPub.LocationAwareness.TRUNCATED) {
             double lat = result.getLatitude();
             double truncatedLat = BigDecimal.valueOf(lat)
                     .setScale(locationPrecision, BigDecimal.ROUND_HALF_DOWN)
diff --git a/mopub-sdk/src/main/java/com/mopub/common/MoPub.java b/mopub-sdk/src/main/java/com/mopub/common/MoPub.java
index 8f388b7a..2a7a7931 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/MoPub.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/MoPub.java
@@ -1,37 +1,31 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common;
 
 public class MoPub {
-    public static final String SDK_VERSION = "2.3";
+    public static final String SDK_VERSION = "3.2.0";
+
+    public static enum LocationAwareness { NORMAL, TRUNCATED, DISABLED }
+
+    private static final int DEFAULT_LOCATION_PRECISION = 6;
+    private static volatile LocationAwareness sLocationLocationAwareness = LocationAwareness.NORMAL;
+    private static volatile int sLocationPrecision = DEFAULT_LOCATION_PRECISION;
+
+    public static LocationAwareness getLocationAwareness() {
+        return sLocationLocationAwareness;
+    }
+
+    public static void setLocationAwareness(LocationAwareness locationAwareness) {
+        sLocationLocationAwareness = locationAwareness;
+    }
+
+    public static int getLocationPrecision() {
+        return sLocationPrecision;
+    }
+
+    /**
+     * Sets the precision to use when the SDK's location awareness is set
+     * to {@link com.mopub.common.MoPub.LocationAwareness#TRUNCATED}.
+     */
+    public static void setLocationPrecision(int precision) {
+        sLocationPrecision = Math.min(Math.max(0, precision), DEFAULT_LOCATION_PRECISION);
+    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/common/MoPubBrowser.java b/mopub-sdk/src/main/java/com/mopub/common/MoPubBrowser.java
index 8d9d6046..4e55f583 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/MoPubBrowser.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/MoPubBrowser.java
@@ -21,7 +21,7 @@
 import android.widget.RelativeLayout;
 import android.widget.Toast;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
 import static android.view.ViewGroup.LayoutParams.WRAP_CONTENT;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/Preconditions.java b/mopub-sdk/src/main/java/com/mopub/common/Preconditions.java
new file mode 100644
index 00000000..126ff4b4
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/Preconditions.java
@@ -0,0 +1,302 @@
+package com.mopub.common;
+
+
+import android.os.Looper;
+
+import com.mopub.common.logging.MoPubLog;
+
+import java.util.IllegalFormatException;
+
+/**
+ * Simple static methods to be called at the start of your own methods to verify correct arguments
+ * and state.
+ *
+ * Each method supports 2 flavors - one that will always throw a runtime exception, and a NoThrow
+ * version that will only throw an exception when in strict mode. We use the former
+ * for internal state checks, and the later to validate arguments passed to the SDK.
+ */
+public final class Preconditions {
+
+    public static final String EMPTY_ARGUMENTS = "";
+
+    private Preconditions() {
+        // Non-instantiable.
+    }
+
+    /**
+     * Ensures the truth of an expression.
+     */
+    public static void checkArgument(boolean expression) {
+        checkArgumentInternal(expression, true, "Illegal argument.", EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures the truth of an expression, with an error message.
+     */
+    public static void checkArgument(boolean expression, String errorMessage) {
+        checkArgumentInternal(expression, true, errorMessage, EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures the truth of an expression, with an error message that takes arguments.
+     */
+    public static void checkArgument(boolean expression,
+            String errorMessageTemplate, Object... errorMessageArgs) {
+        checkArgumentInternal(expression, true, errorMessageTemplate, errorMessageArgs);
+    }
+
+    /**
+     * Ensures the truth of an expression involving the state of the caller.
+     */
+    public static void checkState(boolean expression) {
+        checkStateInternal(expression, true, "Illegal state.", EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures the truth of an expression involving the state of the caller, with an error message.
+     */
+    public static void checkState(boolean expression, String errorMessage) {
+        checkStateInternal(expression, true, errorMessage, EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures the truth of an expression involving the state of the caller, with an error message
+     * that takes arguments.
+     */
+    public static void checkState(boolean expression,
+            String errorMessageTemplate, Object... errorMessageArgs) {
+        checkStateInternal(expression, true, errorMessageTemplate, errorMessageArgs);
+    }
+
+    /**
+     * Ensures that an object reference is not null.
+     */
+    public static void checkNotNull(Object reference) {
+        checkNotNullInternal(reference, true, "Object can not be null.", EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures that an object reference is not null, with an error message.
+     */
+    public static void checkNotNull(Object reference, String errorMessage) {
+        checkNotNullInternal(reference, true, errorMessage, EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures that an object reference is not null, with an error message that takes arguments.
+     */
+    public static void checkNotNull(Object reference,
+            String errorMessageTemplate, Object... errorMessageArgs) {
+        checkNotNullInternal(reference, true, errorMessageTemplate, errorMessageArgs);
+    }
+
+    /**
+     * Ensures that the current thread is the UI thread.
+     */
+    public static void checkUiThread() {
+        checkUiThreadInternal(true, "This method must be called from the UI thread.",
+                EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures that the current thread is the UI thread, with an error message.
+     */
+    public static void checkUiThread(String errorMessage) {
+        checkUiThreadInternal(true, errorMessage, EMPTY_ARGUMENTS);
+    }
+
+    /**
+     * Ensures that the current thread is the UI thread, with an error message that takes
+     * arguments.
+     */
+    public static void checkUiThread(String errorMessageTemplate, Object... errorMessageArgs) {
+        checkUiThreadInternal(true, errorMessageTemplate, errorMessageArgs);
+    }
+
+    /**
+     * Preconditions checks that avoid throwing and exception in release mode. These versions return
+     * a boolean which the caller should check.
+     */
+    public final static class NoThrow {
+        private static volatile boolean sStrictMode = false;
+
+        /**
+         * Enables or disables strict mode.
+         *
+         * In strict mode, this class will throw anyway. For example, you could set strict mode to
+         * BuildConfig.DEBUG to always get exceptions when in the IDE.
+         *
+         * @param strictMode Whether to use strict mode.
+         */
+        public static void setStrictMode(boolean strictMode) {
+            sStrictMode = strictMode;
+        }
+
+        /**
+         * Ensures the truth of an expression.
+         */
+        public static boolean checkArgument(boolean expression) {
+            return checkArgumentInternal(expression, sStrictMode, "Illegal argument",
+                    EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures the truth of an expression, with an error message.
+         */
+        public static boolean checkArgument(boolean expression, String errorMessage) {
+            return checkArgumentInternal(expression, sStrictMode, errorMessage, EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures the truth of an expression, with an error message that takes arguments.
+         */
+        public static boolean checkArgument(boolean expression,
+                String errorMessageTemplate, Object... errorMessageArgs) {
+            return checkArgumentInternal(expression, sStrictMode, errorMessageTemplate,
+                    errorMessageArgs);
+        }
+
+
+        /**
+         * Ensures the truth of an expression involving the state of the caller.
+         */
+        public static boolean checkState(boolean expression) {
+            return checkStateInternal(expression, sStrictMode, "Illegal state.", EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures the truth of an expression involving the state of the caller, with an error
+         * message.
+         */
+        public static boolean checkState(boolean expression, String errorMessage) {
+            return checkStateInternal(expression, sStrictMode, errorMessage, EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures the truth of an expression involving the state of the caller, with an error
+         * message that takes arguments.
+         */
+        public static boolean checkState(boolean expression,
+                String errorMessageTemplate, Object... errorMessageArgs) {
+            return checkStateInternal(expression, sStrictMode, errorMessageTemplate,
+                    errorMessageArgs);
+        }
+
+        /**
+         * Ensures that an object reference is not null.
+         */
+        public static boolean checkNotNull(Object reference) {
+            return checkNotNullInternal(reference, sStrictMode, "Object can not be null.",
+                    EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures that an object reference is not null, with an error message.
+         */
+        public static boolean checkNotNull(Object reference, String errorMessage) {
+            return checkNotNullInternal(reference, sStrictMode, errorMessage, EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures that an object reference is not null, with an error message that takes
+         * arguments.
+         */
+        public static boolean checkNotNull(Object reference,
+                String errorMessageTemplate, Object... errorMessageArgs) {
+            return checkNotNullInternal(reference, sStrictMode, errorMessageTemplate,
+                    errorMessageArgs);
+        }
+
+        /**
+         * Ensures that the current thread is the UI thread.
+         */
+        public static boolean checkUiThread() {
+            return checkUiThreadInternal(sStrictMode,
+                    "This method must be called from the UI thread.", EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures that the current thread is the UI thread, with an error message.
+         */
+        public static boolean checkUiThread(String errorMessage) {
+            return checkUiThreadInternal(sStrictMode, errorMessage, EMPTY_ARGUMENTS);
+        }
+
+        /**
+         * Ensures that the current thread is the UI thread, with an error message that takes
+         * arguments.
+         */
+        public static boolean checkUiThread(String errorMessageTemplate,
+                Object... errorMessageArgs) {
+            return checkUiThreadInternal(false, errorMessageTemplate, errorMessageArgs);
+        }
+    }
+
+    private static boolean checkArgumentInternal(boolean expression, boolean allowThrow,
+            String errorMessageTemplate, Object... errorMessageArgs) {
+        if (expression) {
+            return true;
+        }
+        String errorMessage = format(errorMessageTemplate, errorMessageArgs);
+        if (allowThrow) {
+            throw new IllegalArgumentException(errorMessage);
+        }
+        MoPubLog.e(errorMessage);
+        return false;
+    }
+
+    private static boolean checkStateInternal(boolean expression, boolean allowThrow,
+            String errorMessageTemplate, Object... errorMessageArgs) {
+        if (expression) {
+            return true;
+        }
+        String errorMessage = format(errorMessageTemplate, errorMessageArgs);
+        if (allowThrow) {
+            throw new IllegalStateException(errorMessage);
+        }
+        MoPubLog.e(errorMessage);
+        return false;
+    }
+
+    private static boolean checkNotNullInternal(Object reference, boolean allowThrow,
+            String errorMessageTemplate, Object... errorMessageArgs) {
+        if (reference != null) {
+            return true;
+        }
+        String errorMessage = format(errorMessageTemplate, errorMessageArgs);
+        if (allowThrow) {
+            throw new NullPointerException(errorMessage);
+        }
+        MoPubLog.e(errorMessage);
+        return false;
+    }
+
+    private static boolean checkUiThreadInternal(boolean allowThrow,
+            String errorMessageTemplate, Object... errorMessageArgs) {
+        // Check that the main looper is the current looper.
+        if (Looper.getMainLooper().equals(Looper.myLooper())) {
+            return true;
+        }
+        String errorMessage = format(errorMessageTemplate, errorMessageArgs);
+        if (allowThrow) {
+            throw new IllegalStateException(errorMessage);
+        }
+        MoPubLog.e(errorMessage);
+        return false;
+    }
+
+    /**
+     * Substitutes each {@code %s} in {@code template} with an argument. These are matched by
+     * position - the first {@code %s} gets {@code args[0]}, etc.
+     */
+    private static String format(String template, Object... args) {
+        template = String.valueOf(template);  // null -> "null"
+
+        try {
+            return String.format(template, args);
+        } catch (IllegalFormatException exception) {
+            MoPubLog.e("MoPub preconditions had a format exception: " + exception.getMessage());
+            return template;
+        }
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/VisibleForTesting.java b/mopub-sdk/src/main/java/com/mopub/common/VisibleForTesting.java
new file mode 100644
index 00000000..75dec6a8
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/VisibleForTesting.java
@@ -0,0 +1,9 @@
+package com.mopub.common;
+
+/**
+ * An annotation that indicates that the visibility of a type or member has been relaxed to make
+ * the code testable. You should not use VisibleForTesting methods when integrating the SDK, as
+ * they may change in future versions.
+ */
+public @interface VisibleForTesting {
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/event/BaseEvent.java b/mopub-sdk/src/main/java/com/mopub/common/event/BaseEvent.java
new file mode 100644
index 00000000..4e053528
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/event/BaseEvent.java
@@ -0,0 +1,43 @@
+package com.mopub.common.event;
+
+import com.mopub.common.ClientMetadata;
+
+public abstract class BaseEvent {
+    public enum Type {
+        NETWORK_REQUEST("request"),
+        DATA_ERROR("invalid_data");
+
+        public final String mName;
+        Type(String name) {
+            mName = name;
+        }
+    }
+
+    private final ClientMetadata mMetadata;
+    private final String mEventName;
+    private final String mRequestUrl;
+    private final long mEventTimeUtcMillis;
+
+    BaseEvent(Type eventType, String requestUrl, ClientMetadata metadata) {
+        mEventTimeUtcMillis = System.currentTimeMillis();
+        mEventName = eventType.mName;
+        mRequestUrl = requestUrl;
+        mMetadata = metadata;
+    }
+
+    public long getEventTimeUtcMillis() {
+        return mEventTimeUtcMillis;
+    }
+
+    public String getRequestUrl() {
+        return mRequestUrl;
+    }
+
+    public String getEventName() {
+        return mEventName;
+    }
+
+    public ClientMetadata getMetadata() {
+        return mMetadata;
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/event/Event.java b/mopub-sdk/src/main/java/com/mopub/common/event/Event.java
new file mode 100644
index 00000000..fee902fd
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/event/Event.java
@@ -0,0 +1,12 @@
+package com.mopub.common.event;
+
+import com.mopub.common.ClientMetadata;
+
+/**
+ * Immutable data class with client event data.
+ */
+public class Event extends BaseEvent {
+    Event(final Type eventType, final String requestUrl, final ClientMetadata metadata) {
+        super(eventType, requestUrl, metadata);
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/event/EventRecorder.java b/mopub-sdk/src/main/java/com/mopub/common/event/EventRecorder.java
new file mode 100644
index 00000000..13ed5518
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/event/EventRecorder.java
@@ -0,0 +1,9 @@
+package com.mopub.common.event;
+
+/**
+ * This interface represents a backend to which MoPub client events are logged.
+ */
+public interface EventRecorder {
+    public void recordEvent(Event event);
+    public void recordTimedEvent(TimedEvent event);
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/event/MoPubEvents.java b/mopub-sdk/src/main/java/com/mopub/common/event/MoPubEvents.java
new file mode 100644
index 00000000..a36c4f9f
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/event/MoPubEvents.java
@@ -0,0 +1,125 @@
+package com.mopub.common.event;
+
+import android.os.Handler;
+import android.os.HandlerThread;
+import android.os.Message;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.VisibleForTesting;
+
+import java.util.ArrayList;
+
+/**
+ * Records both untimed and timed events. This class maintains a queue of events to be recorded and
+ * launches a background thread to handler their recording.
+ */
+public class MoPubEvents {
+
+    private static volatile EventDispatcher sEventDispatcher;
+
+    private static EventDispatcher getDispatcher() {
+        EventDispatcher result = sEventDispatcher;
+        if (result == null) {
+            synchronized (MoPubEvents.class) {
+                result = sEventDispatcher;
+                if (result == null) {
+                    ArrayList<EventRecorder> recorders = new ArrayList<EventRecorder>();
+                    recorders.add(new NoopEventRecorder());
+                    HandlerThread handlerThread = new HandlerThread("mopub_event_queue");
+                    result = sEventDispatcher = new EventDispatcher(recorders, handlerThread);
+                }
+            }
+        }
+        return result;
+    }
+
+    @VisibleForTesting
+    public static void setEventDispatcher(EventDispatcher dispatcher) {
+        sEventDispatcher = dispatcher;
+    }
+
+    /**
+     * Log a ClientEvent. MoPub uses logged events to analyze and improve performance.
+     * This method should not be called by app developers.
+     */
+    public static void event(Event.Type eventType, String requestUrl) {
+        final EventDispatcher dispatcher = MoPubEvents.getDispatcher();
+        final Event event = new Event(eventType, requestUrl, ClientMetadata.getInstance());
+        dispatcher.sendEventToHandlerThread(event);
+    }
+
+
+    /**
+     * Create and start a TimedEvent. A TimedEvent isn't recored until
+     * {@link com.mopub.common.event.TimedEvent#stop(int)} is called.
+     */
+    public static TimedEvent timedEvent(Event.Type eventType, String requestUrl) {
+        final EventDispatcher events = getDispatcher();
+        final TimedEvent event =
+                new TimedEvent(eventType, requestUrl, ClientMetadata.getInstance(), events);
+        return event;
+    }
+
+    private static class NoopEventRecorder implements EventRecorder {
+
+        @Override
+        public void recordEvent(final Event event) {
+
+        }
+
+        @Override
+        public void recordTimedEvent(final TimedEvent event) {
+
+        }
+    }
+
+    @VisibleForTesting
+    public static class EventDispatcher implements TimedEvent.Listener {
+        private final Iterable<EventRecorder> mEventRecorders;
+        private final HandlerThread mHandlerThread;
+        private final Handler mMessageHandler;
+
+        @VisibleForTesting Handler.Callback mHandlerCallback;
+
+        @VisibleForTesting
+        EventDispatcher(Iterable<EventRecorder> recorders, HandlerThread handlerThread) {
+            mEventRecorders = recorders;
+            mHandlerCallback = new Handler.Callback() {
+                @Override
+                public boolean handleMessage(final Message msg) {
+                    if (msg.obj instanceof TimedEvent) {
+                        final TimedEvent event = (TimedEvent) msg.obj;
+                        for (final EventRecorder recorder : mEventRecorders) {
+                            recorder.recordTimedEvent(event);
+                        }
+
+                    } else if (msg.obj instanceof Event) {
+                        final Event event = (Event) msg.obj;
+                        for (final EventRecorder recorder : mEventRecorders) {
+                            recorder.recordEvent(event);
+                        }
+                    }
+                    return true; // Even if it's not an event, swallow the message.
+                }
+            };
+            mHandlerThread = handlerThread;
+            mHandlerThread.start();
+            mMessageHandler = new Handler(mHandlerThread.getLooper(), mHandlerCallback);
+        }
+
+        private void sendEventToHandlerThread(BaseEvent event) {
+            final Message message = Message.obtain(mMessageHandler, 0, event);
+            message.sendToTarget();
+        }
+
+        @Override
+        public void onStopped(final TimedEvent event) {
+            this.sendEventToHandlerThread(event);
+        }
+
+        @Override
+        public void onCancelled(final TimedEvent event) {
+            // Nothing to do for now.
+        }
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/event/TimedEvent.java b/mopub-sdk/src/main/java/com/mopub/common/event/TimedEvent.java
new file mode 100644
index 00000000..c2aa7dc9
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/event/TimedEvent.java
@@ -0,0 +1,76 @@
+package com.mopub.common.event;
+
+import com.mopub.common.ClientMetadata;
+
+import java.util.concurrent.TimeUnit;
+
+/**
+ * Immutable data class with client event data, including a duration.
+ */
+public class TimedEvent extends BaseEvent {
+    interface Listener {
+        public void onStopped(TimedEvent event);
+
+        public void onCancelled(TimedEvent event);
+    }
+
+    /**
+     * Use this status code when stopping an event where an HTTP Status Code isn't relevant.
+     */
+    public static final int SC_NOT_RELEVANT = 0;
+
+    /**
+     * Use this status code when the timed event has no response.
+     */
+    public static final int SC_NO_RESPONSE = -1;
+
+    private final long mStartTimeNanos;
+    private enum State {
+        WAITING, STOPPED, CANCELLED
+    }
+    private State mState;
+    private final Listener mListener;
+
+
+    private long mDurationMillis;
+    private int mHttpStatusCode;
+
+    TimedEvent(final Type eventType, final String requestUrl,
+            final ClientMetadata clientMetadata, Listener listener) {
+        super(eventType, requestUrl, clientMetadata);
+        // System.nanoTime isn't affected by changing the system time, so we use it here.
+        mState = State.WAITING;
+        mStartTimeNanos = System.nanoTime();
+        mListener = listener;
+    }
+
+    public synchronized void stop(int httpStatusCode) {
+        if (mState == State.WAITING) {
+            mState = State.STOPPED;
+            mHttpStatusCode = httpStatusCode;
+            long stopTimeNanos = System.nanoTime();
+            mDurationMillis = TimeUnit.MILLISECONDS.convert(stopTimeNanos - mStartTimeNanos,
+                    TimeUnit.NANOSECONDS);
+            if (mListener != null) {
+                mListener.onStopped(this);
+            }
+        }
+    }
+
+    public synchronized void cancel() {
+        if (mState == State.WAITING) {
+            mState = State.CANCELLED;
+            if (mListener != null) {
+                mListener.onCancelled(this);
+            }
+        }
+    }
+
+    public final synchronized long getDurationMillis() {
+        return mDurationMillis;
+    }
+
+    public final synchronized int getHttpStatusCode() {
+        return mHttpStatusCode;
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/factories/MethodBuilderFactory.java b/mopub-sdk/src/main/java/com/mopub/common/factories/MethodBuilderFactory.java
index 0c008962..d2d726b7 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/factories/MethodBuilderFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/factories/MethodBuilderFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.factories;
 
 import static com.mopub.common.util.Reflection.MethodBuilder;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/logging/MoPubLog.java b/mopub-sdk/src/main/java/com/mopub/common/logging/MoPubLog.java
new file mode 100644
index 00000000..70ac4e7b
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/logging/MoPubLog.java
@@ -0,0 +1,126 @@
+package com.mopub.common.logging;
+
+import android.util.Log;
+import android.util.SparseArray;
+
+import java.util.ArrayList;
+import java.util.EnumMap;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.logging.Handler;
+import java.util.logging.Level;
+import java.util.logging.LogManager;
+import java.util.logging.LogRecord;
+import java.util.logging.Logger;
+
+public class MoPubLog {
+    private static final String LOGTAG = "MoPub";
+    private static final Logger LOGGER = Logger.getLogger("com.mopub");
+    private static final MoPubLogHandler LOG_HANDLER = new MoPubLogHandler();
+
+    static {
+        LogManager.getLogManager().addLogger(LOGGER);
+        LOGGER.addHandler(LOG_HANDLER);
+        LOGGER.setLevel(Level.FINE);
+    }
+
+    private MoPubLog() {}
+
+    public static void c(final String message) {
+        MoPubLog.c(message, null);
+    }
+
+    public static void v(final String message) {
+        MoPubLog.v(message, null);
+    }
+
+    public static void d(final String message) {
+        MoPubLog.d(message, null);
+    }
+
+    public static void i(final String message) {
+        MoPubLog.i(message, null);
+    }
+
+    public static void w(final String message) {
+        MoPubLog.w(message, null);
+    }
+
+    public static void e(final String message) {
+        MoPubLog.e(message, null);
+    }
+
+    public static void c(final String message, final Throwable throwable) {
+        LOGGER.log(Level.FINEST, message, throwable);
+    }
+
+    public static void v(final String message, final Throwable throwable) {
+        LOGGER.log(Level.FINE, message, throwable);
+    }
+
+    public static void d(final String message, final Throwable throwable) {
+        LOGGER.log(Level.CONFIG, message, throwable);
+    }
+
+    public static void i(final String message, final Throwable throwable) {
+        LOGGER.log(Level.INFO, message, throwable);
+    }
+
+    public static void w(final String message, final Throwable throwable) {
+        LOGGER.log(Level.WARNING, message, throwable);
+    }
+
+    public static void e(final String message, final Throwable throwable) {
+        LOGGER.log(Level.SEVERE, message, throwable);
+    }
+
+    private static final class MoPubLogHandler extends Handler {
+        private static final Map<Level, Integer> LEVEL_TO_LOG = new HashMap<Level, Integer>(7);
+
+        /*
+         * Mapping between Level.* and Log.*:
+         * Level.FINEST  => Log.v
+         * Level.FINER   => Log.v
+         * Level.FINE    => Log.v
+         * Level.CONFIG  => Log.d
+         * Level.INFO    => Log.i
+         * Level.WARNING => Log.w
+         * Level.SEVERE  => Log.e
+         */
+        static {
+            LEVEL_TO_LOG.put(Level.FINEST, Log.VERBOSE);
+            LEVEL_TO_LOG.put(Level.FINER, Log.VERBOSE);
+            LEVEL_TO_LOG.put(Level.FINE, Log.VERBOSE);
+            LEVEL_TO_LOG.put(Level.CONFIG, Log.DEBUG);
+            LEVEL_TO_LOG.put(Level.INFO, Log.INFO);
+            LEVEL_TO_LOG.put(Level.WARNING, Log.WARN);
+            LEVEL_TO_LOG.put(Level.SEVERE, Log.ERROR);
+        }
+
+        @Override
+        public void publish(final LogRecord logRecord) {
+            if (isLoggable(logRecord)) {
+                final int priority;
+                if (LEVEL_TO_LOG.containsKey(logRecord.getLevel())) {
+                    priority = LEVEL_TO_LOG.get(logRecord.getLevel());
+                } else {
+                    priority = Log.VERBOSE;
+                }
+
+                String message = logRecord.getMessage() + "\n";
+
+                final Throwable error = logRecord.getThrown();
+                if (error != null) {
+                    message += Log.getStackTraceString(error);
+                }
+
+                Log.println(priority, LOGTAG, message);
+            }
+        }
+
+        @Override public void close() {}
+
+        @Override public void flush() {}
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/AsyncTasks.java b/mopub-sdk/src/main/java/com/mopub/common/util/AsyncTasks.java
index 314549a2..b8e25d73 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/AsyncTasks.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/AsyncTasks.java
@@ -1,39 +1,51 @@
 package com.mopub.common.util;
 
+import android.annotation.TargetApi;
 import android.os.AsyncTask;
-import android.os.Looper;
+import android.os.Build.VERSION;
+import android.os.Build.VERSION_CODES;
 
-import java.util.concurrent.Executor;
+import com.mopub.common.Preconditions;
+import com.mopub.common.VisibleForTesting;
 
-import static com.mopub.common.util.Reflection.MethodBuilder;
-import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
-import static com.mopub.common.util.VersionCode.currentApiLevel;
+import java.util.concurrent.Executor;
+import java.util.concurrent.Executors;
 
 public class AsyncTasks {
-    /**
-     * Starting with ICS, default AsyncTask#execute behavior runs the tasks serially. This method
-     * attempts to force these AsyncTasks to run in parallel with a ThreadPoolExecutor, if possible.
-     */
-    public static <P> void safeExecuteOnExecutor(AsyncTask<P, ?, ?> asyncTask, P... params) throws IllegalArgumentException, IllegalStateException {
-        if (asyncTask == null) {
-            throw new IllegalArgumentException("Unable to execute null AsyncTask.");
-        }
+    private static Executor sExecutor;
+
+    static {
+        init();
+    }
 
-        if (Looper.myLooper() != Looper.getMainLooper()) {
-            throw new IllegalStateException("AsyncTask must be executed on the main thread");
+    // This is in a separate method rather than a static block to pass lint.
+    @TargetApi(VERSION_CODES.HONEYCOMB)
+    private static void init() {
+        // Reuse the async task executor if possible
+        if (VERSION.SDK_INT >= VERSION_CODES.HONEYCOMB) {
+            sExecutor = AsyncTask.THREAD_POOL_EXECUTOR;
+        } else {
+            sExecutor = Executors.newSingleThreadExecutor();
         }
+    }
+
+    @VisibleForTesting
+    public static void setExecutor(Executor executor) {
+        sExecutor = executor;
+    }
+
+    /**
+     * Starting with Honeycomb, default AsyncTask#execute behavior runs the tasks serially. This
+     * method attempts to force these AsyncTasks to run in parallel with a ThreadPoolExecutor, if
+     * possible.
+     */
+    @TargetApi(VERSION_CODES.HONEYCOMB)
+    public static <P> void safeExecuteOnExecutor(AsyncTask<P, ?, ?> asyncTask, P... params) {
+        Preconditions.checkNotNull(asyncTask, "Unable to execute null AsyncTask.");
+        Preconditions.checkUiThread("AsyncTask must be executed on the main thread");
 
-        if (currentApiLevel().isAtLeast(ICE_CREAM_SANDWICH)) {
-            try {
-                Executor threadPoolExecutor = (Executor) AsyncTask.class.getField("THREAD_POOL_EXECUTOR").get(AsyncTask.class);
-
-                new MethodBuilder(asyncTask, "executeOnExecutor")
-                        .addParam(Executor.class, threadPoolExecutor)
-                        .addParam(Object[].class, params)
-                        .execute();
-            } catch (Exception e) {
-                asyncTask.execute(params);
-            }
+        if (VERSION.SDK_INT >= VERSION_CODES.HONEYCOMB) {
+            asyncTask.executeOnExecutor(sExecutor, params);
         } else {
             asyncTask.execute(params);
         }
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/DateAndTime.java b/mopub-sdk/src/main/java/com/mopub/common/util/DateAndTime.java
index b4e0cbfd..01e6edb3 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/DateAndTime.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/DateAndTime.java
@@ -1,37 +1,6 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
+import java.text.SimpleDateFormat;
 import java.util.Date;
 import java.util.TimeZone;
 
@@ -51,6 +20,14 @@ public static Date now() {
         return instance.internalNow();
     }
 
+    public static String getTimeZoneOffsetString() {
+        // A new instance is created with each call because DateFormat objects have
+        // internal state and are not thread safe.
+        SimpleDateFormat format = new SimpleDateFormat("Z");
+        format.setTimeZone(localTimeZone());
+        return format.format(now());
+    }
+
     public TimeZone internalLocalTimeZone() {
         return TimeZone.getDefault();
     }
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/DeviceUtils.java b/mopub-sdk/src/main/java/com/mopub/common/util/DeviceUtils.java
index 88709280..3ac25c61 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/DeviceUtils.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/DeviceUtils.java
@@ -9,6 +9,8 @@
 import android.os.StatFs;
 import android.provider.Settings;
 
+import com.mopub.common.logging.MoPubLog;
+
 import org.apache.http.conn.util.InetAddressUtils;
 
 import java.io.File;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Dips.java b/mopub-sdk/src/main/java/com/mopub/common/util/Dips.java
index b858a4a0..71e2f464 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/Dips.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Dips.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.content.Context;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Drawables.java b/mopub-sdk/src/main/java/com/mopub/common/util/Drawables.java
index f54d02de..63d32fa3 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/Drawables.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Drawables.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.content.Context;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/IntentUtils.java b/mopub-sdk/src/main/java/com/mopub/common/util/IntentUtils.java
index eb37cc9c..ac1a3d71 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/IntentUtils.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/IntentUtils.java
@@ -7,7 +7,8 @@
 import android.content.pm.ResolveInfo;
 import android.net.Uri;
 import android.os.Bundle;
-import android.util.Log;
+
+import com.mopub.common.logging.MoPubLog;
 
 import java.util.List;
 
@@ -100,7 +101,7 @@ public static boolean canHandleApplicationUrl(Context context, String url, boole
         // If there are no relevant activities, don't follow the link
         if (!IntentUtils.deviceCanHandleIntent(context, intent)) {
             if (logError) {
-                Log.w("MoPub", "Could not handle application specific action: " + url + ". " +
+                MoPubLog.w("Could not handle application specific action: " + url + ". " +
                         "You may be running in the emulator or another device which does not " +
                         "have the required application.");
             }
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Json.java b/mopub-sdk/src/main/java/com/mopub/common/util/Json.java
index ed7075d1..e33ac0b3 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/Json.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Json.java
@@ -1,37 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
+import com.mopub.common.logging.MoPubLog;
+
 import org.json.JSONArray;
 import org.json.JSONException;
 import org.json.JSONObject;
@@ -101,6 +71,8 @@ public static String mapToJsonString(Map<String, String> map) {
         }
     }
 
+    // This method is used by the Native Custom events.
+    @SuppressWarnings("unused")
     public static <T> T getJsonValue(final JSONObject jsonObject, final String key, final Class<T> valueClass) {
         if (jsonObject == null || key == null || valueClass == null) {
             throw new IllegalArgumentException("Cannot pass any null argument to getJsonValue");
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/ManifestUtils.java b/mopub-sdk/src/main/java/com/mopub/common/util/ManifestUtils.java
index cf4771bb..aff7bb39 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/ManifestUtils.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/ManifestUtils.java
@@ -7,6 +7,8 @@
 import android.view.Gravity;
 import android.widget.Toast;
 
+import com.mopub.common.logging.MoPubLog;
+
 import java.util.ArrayList;
 import java.util.List;
 
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/MoPubLog.java b/mopub-sdk/src/main/java/com/mopub/common/util/MoPubLog.java
deleted file mode 100644
index 98d489a0..00000000
--- a/mopub-sdk/src/main/java/com/mopub/common/util/MoPubLog.java
+++ /dev/null
@@ -1,31 +0,0 @@
-package com.mopub.common.util;
-
-import android.util.Log;
-
-public class MoPubLog {
-    private static final String LOGTAG = "MoPub";
-
-    public static int d(final String message) {
-        return MoPubLog.d(message, null);
-    }
-
-    public static int d(final String message, final Throwable throwable) {
-        return Log.d(LOGTAG, message, throwable);
-    }
-
-    public static int w(final String message) {
-        return MoPubLog.w(message, null);
-    }
-
-    public static int w(final String message, final Throwable throwable) {
-        return Log.w(LOGTAG, message, throwable);
-    }
-
-    public static int e(final String message) {
-        return MoPubLog.e(message, null);
-    }
-
-    public static int e(final String message, final Throwable throwable) {
-        return Log.e(LOGTAG, message, throwable);
-    }
-}
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Reflection.java b/mopub-sdk/src/main/java/com/mopub/common/util/Reflection.java
index e4974559..bfb34e9a 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/Reflection.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Reflection.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import java.lang.reflect.Method;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/ResponseHeader.java b/mopub-sdk/src/main/java/com/mopub/common/util/ResponseHeader.java
index 2fe65112..4e0987b7 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/ResponseHeader.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/ResponseHeader.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 public enum ResponseHeader {
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Streams.java b/mopub-sdk/src/main/java/com/mopub/common/util/Streams.java
index c8b619fd..0572a7cf 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/Streams.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Streams.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import java.io.Closeable;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Strings.java b/mopub-sdk/src/main/java/com/mopub/common/util/Strings.java
index c27fa0fc..dd20902e 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/Strings.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Strings.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import java.io.IOException;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/VersionCode.java b/mopub-sdk/src/main/java/com/mopub/common/util/VersionCode.java
index 6cff3281..606b3782 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/VersionCode.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/VersionCode.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.os.Build;
@@ -53,6 +21,7 @@
     JELLY_BEAN(16),
     JELLY_BEAN_MR1(17),
     JELLY_BEAN_MR2(18),
+    KITKAT(19),
     CUR_DEVELOPMENT(10000);
 
     private int mApiLevel;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Views.java b/mopub-sdk/src/main/java/com/mopub/common/util/Views.java
index de44f4f7..e0ebd1e5 100644
--- a/mopub-sdk/src/main/java/com/mopub/common/util/Views.java
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Views.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.view.View;
diff --git a/mopub-sdk/src/main/java/com/mopub/common/util/Visibility.java b/mopub-sdk/src/main/java/com/mopub/common/util/Visibility.java
new file mode 100644
index 00000000..414aee91
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/common/util/Visibility.java
@@ -0,0 +1,16 @@
+package com.mopub.common.util;
+
+import android.view.View;
+
+public class Visibility {
+    private Visibility() {}
+
+    public static boolean isScreenVisible(final int visibility) {
+        return visibility == View.VISIBLE;
+    }
+
+    public static boolean hasScreenVisibilityChanged(final int oldVisibility,
+            final int newVisibility) {
+        return (isScreenVisible(oldVisibility) != isScreenVisible(newVisibility));
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertGestureListener.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertGestureListener.java
index b2616f26..57567c9e 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertGestureListener.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertGestureListener.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.view.GestureDetector;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertReporter.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertReporter.java
index 5f19a7d9..47ac6f49 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertReporter.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdAlertReporter.java
@@ -1,44 +1,11 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.content.Intent;
 import android.graphics.Bitmap;
 import android.net.Uri;
-import android.util.Log;
 import android.view.View;
-
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.DateAndTime;
 import com.mopub.common.util.Streams;
 import com.mopub.mobileads.util.Base64;
@@ -205,7 +172,7 @@ private void addImageAttachment(String fileName, Bitmap bitmap) {
             Uri fileUri = Uri.fromFile(new File(mContext.getFilesDir() + File.separator + fileName));
             mEmailAttachments.add(fileUri);
         } catch (Exception exception) {
-            Log.d("MoPub", "Unable to write text attachment to file: " + fileName);
+            MoPubLog.d("Unable to write text attachment to file: " + fileName);
         } finally {
             Streams.closeStream(fileOutputStream);
         }
@@ -225,7 +192,7 @@ private void addTextAttachment(String fileName, String body) {
             Uri fileUri = Uri.fromFile(new File(mContext.getFilesDir() + File.separator + fileName));
             mEmailAttachments.add(fileUri);
         } catch (Exception exception) {
-            Log.d("MoPub", "Unable to write text attachment to file: " + fileName);
+            MoPubLog.d("Unable to write text attachment to file: " + fileName);
         } finally {
             Streams.closeStream(fileOutputStream);
         }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdConfiguration.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdConfiguration.java
index 9160fe5d..236c577b 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdConfiguration.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdConfiguration.java
@@ -1,56 +1,18 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.os.Build;
 import android.provider.Settings;
 import android.webkit.WebView;
-
 import com.mopub.common.MoPub;
 import com.mopub.common.util.DateAndTime;
 import com.mopub.common.util.Utils;
 import com.mopub.common.util.VersionCode;
-
 import org.apache.http.HttpResponse;
 
-import java.io.*;
-import java.util.*;
+import java.io.Serializable;
+import java.util.Map;
 
-import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
-import static com.mopub.mobileads.util.HttpResponses.extractHeader;
-import static com.mopub.mobileads.util.HttpResponses.extractIntHeader;
-import static com.mopub.mobileads.util.HttpResponses.extractIntegerHeader;
 import static com.mopub.common.util.ResponseHeader.AD_TIMEOUT;
 import static com.mopub.common.util.ResponseHeader.AD_TYPE;
 import static com.mopub.common.util.ResponseHeader.CLICKTHROUGH_URL;
@@ -62,6 +24,10 @@
 import static com.mopub.common.util.ResponseHeader.REDIRECT_URL;
 import static com.mopub.common.util.ResponseHeader.REFRESH_TIME;
 import static com.mopub.common.util.ResponseHeader.WIDTH;
+import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
+import static com.mopub.mobileads.util.HttpResponses.extractHeader;
+import static com.mopub.mobileads.util.HttpResponses.extractIntHeader;
+import static com.mopub.mobileads.util.HttpResponses.extractIntegerHeader;
 
 public class AdConfiguration implements Serializable {
     private static final long serialVersionUID = 0L;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetchTask.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetchTask.java
index e4893cbf..85875e25 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetchTask.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetchTask.java
@@ -1,39 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.os.AsyncTask;
-import android.util.Log;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.mobileads.factories.HttpClientFactory;
 import org.apache.http.HttpResponse;
 import org.apache.http.HttpStatus;
@@ -41,10 +9,10 @@
 import org.apache.http.client.methods.HttpGet;
 import org.apache.http.conn.ClientConnectionManager;
 
-import static com.mopub.mobileads.util.HttpResponses.extractHeader;
 import static com.mopub.common.util.ResponseHeader.AD_TYPE;
 import static com.mopub.common.util.ResponseHeader.USER_AGENT;
 import static com.mopub.common.util.ResponseHeader.WARMUP;
+import static com.mopub.mobileads.util.HttpResponses.extractHeader;
 
 public class AdFetchTask extends AsyncTask<String, Void, AdLoadTask> {
     private TaskTracker mTaskTracker;
@@ -100,7 +68,7 @@ private AdLoadTask fetch(String url) throws Exception {
     private boolean responseContainsContent(HttpResponse response) {
         // Ensure that the ad is not warming up.
         if ("1".equals(extractHeader(response, WARMUP))) {
-            Log.d("MoPub", "Ad Unit (" + mAdViewController.getAdUnitId() + ") is still warming up. " +
+            MoPubLog.d("Ad Unit (" + mAdViewController.getAdUnitId() + ") is still warming up. " +
                     "Please try again in a few minutes.");
             mFetchStatus = AdFetcher.FetchStatus.AD_WARMING_UP;
             return false;
@@ -109,7 +77,7 @@ private boolean responseContainsContent(HttpResponse response) {
         // Ensure that the ad type header is valid and not "clear".
         String adType = extractHeader(response, AD_TYPE);
         if ("clear".equals(adType)) {
-            Log.d("MoPub", "No inventory found for adunit (" + mAdViewController.getAdUnitId() + ").");
+            MoPubLog.d("No ads found for adunit (" + mAdViewController.getAdUnitId() + ").");
             mFetchStatus = AdFetcher.FetchStatus.CLEAR_AD_TYPE;
             return false;
         }
@@ -119,7 +87,7 @@ private boolean responseContainsContent(HttpResponse response) {
 
     private boolean isResponseValid(HttpResponse response) {
         if (response == null || response.getEntity() == null) {
-            Log.d("MoPub", "MoPub server returned null response.");
+            MoPubLog.d("MoPub server returned null response.");
             mFetchStatus = AdFetcher.FetchStatus.INVALID_SERVER_RESPONSE_NOBACKOFF;
             return false;
         }
@@ -128,14 +96,14 @@ private boolean isResponseValid(HttpResponse response) {
 
         // Client and Server HTTP errors should result in an exponential backoff
         if (statusCode >= 400) {
-            Log.d("MoPub", "Server error: returned HTTP status code " + Integer.toString(statusCode) +
+            MoPubLog.d("Server error: returned HTTP status code " + Integer.toString(statusCode) +
                     ". Please try again.");
             mFetchStatus = AdFetcher.FetchStatus.INVALID_SERVER_RESPONSE_BACKOFF;
             return false;
         }
         // Other non-200 HTTP status codes should still fail
         else if (statusCode != HttpStatus.SC_OK) {
-            Log.d("MoPub", "MoPub server returned invalid response: HTTP status code " +
+            MoPubLog.d("MoPub server returned invalid response: HTTP status code " +
                     Integer.toString(statusCode) + ".");
             mFetchStatus = AdFetcher.FetchStatus.INVALID_SERVER_RESPONSE_NOBACKOFF;
             return false;
@@ -152,7 +120,7 @@ private boolean isStateValid() {
         }
 
         if (mAdViewController == null || mAdViewController.isDestroyed()) {
-            Log.d("MoPub", "Error loading ad: AdViewController has already been GCed or destroyed.");
+            MoPubLog.d("Error loading ad: AdViewController has already been GCed or destroyed.");
             return false;
         }
         return true;
@@ -161,7 +129,7 @@ private boolean isStateValid() {
     @Override
     protected void onPostExecute(AdLoadTask adLoadTask) {
         if (!isMostCurrentTask()) {
-            Log.d("MoPub", "Ad response is stale.");
+            MoPubLog.d("Ad response is stale.");
             cleanup();
             return;
         }
@@ -178,7 +146,7 @@ protected void onPostExecute(AdLoadTask adLoadTask) {
 
         if (adLoadTask == null) {
             if (mException != null) {
-                Log.d("MoPub", "Exception caught while loading ad: " + mException);
+                MoPubLog.d("Exception caught while loading ad: " + mException);
             }
 
             MoPubErrorCode errorCode;
@@ -228,14 +196,14 @@ protected void onPostExecute(AdLoadTask adLoadTask) {
     @Override
     protected void onCancelled() {
         if (!isMostCurrentTask()) {
-            Log.d("MoPub", "Ad response is stale.");
+            MoPubLog.d("Ad response is stale.");
             cleanup();
             return;
         }
 
-        Log.d("MoPub", "Ad loading was cancelled.");
+        MoPubLog.d("Ad loading was cancelled.");
         if (mException != null) {
-            Log.d("MoPub", "Exception caught while loading ad: " + mException);
+            MoPubLog.d("Exception caught while loading ad: " + mException);
         }
         mTaskTracker.markTaskCompleted(mTaskId);
         cleanup();
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetcher.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetcher.java
index 03c73101..79486a06 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetcher.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdFetcher.java
@@ -1,39 +1,6 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
-import android.util.Log;
-
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.AsyncTasks;
 import com.mopub.mobileads.factories.AdFetchTaskFactory;
 
@@ -76,7 +43,7 @@ public AdFetcher(AdViewController adview, String userAgent) {
 
     public void fetchAdForUrl(String url) {
         mTaskTracker.newTaskStarted();
-        Log.i("MoPub", "Fetching ad for task #" + getCurrentTaskId());
+        MoPubLog.i("Fetching ad for task #" + getCurrentTaskId());
 
         if (mCurrentTask != null) {
             mCurrentTask.cancel(true);
@@ -87,13 +54,13 @@ public void fetchAdForUrl(String url) {
         try {
             AsyncTasks.safeExecuteOnExecutor(mCurrentTask, url);
         } catch (Exception exception) {
-            Log.d("MoPub", "Error executing AdFetchTask", exception);
+            MoPubLog.d("Error executing AdFetchTask", exception);
         }
     }
 
     public void cancelFetch() {
         if (mCurrentTask != null) {
-            Log.i("MoPub", "Canceling fetch ad for task #" + getCurrentTaskId());
+            MoPubLog.i("Canceling fetch ad for task #" + getCurrentTaskId());
             mCurrentTask.cancel(true);
         }
     }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdLoadTask.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdLoadTask.java
index e01e7430..cb379e71 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdLoadTask.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdLoadTask.java
@@ -1,53 +1,19 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.net.Uri;
-import android.util.Log;
 
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Json;
 import com.mopub.common.util.Strings;
-
 import org.apache.http.Header;
 import org.apache.http.HttpEntity;
 import org.apache.http.HttpResponse;
 
-import java.io.IOException;
+import java.io.*;
 import java.lang.ref.WeakReference;
 import java.lang.reflect.Method;
-import java.util.HashMap;
-import java.util.Map;
+import java.util.*;
 
 import static com.mopub.common.util.ResponseHeader.AD_TYPE;
 import static com.mopub.common.util.ResponseHeader.CLICKTHROUGH_URL;
@@ -100,7 +66,7 @@ AdLoadTask extract() throws IOException {
             adType = extractHeader(response, AD_TYPE);
             fullAdType = extractHeader(response, FULL_AD_TYPE);
 
-            Log.d("MoPub", "Loading ad type: " + AdTypeTranslator.getAdNetworkType(adType, fullAdType));
+            MoPubLog.d("Loading ad type: " + AdTypeTranslator.getAdNetworkType(adType, fullAdType));
 
             adTypeCustomEventName = AdTypeTranslator.getCustomEventNameForAdType(
                     adViewController.getMoPubView(), adType, fullAdType);
@@ -115,7 +81,7 @@ AdLoadTask extract() throws IOException {
         }
 
         private AdLoadTask extractCustomEventAdLoadTask() {
-            Log.i("MoPub", "Performing custom event.");
+            MoPubLog.i("Performing custom event.");
 
             // If applicable, try to invoke the new custom event system (which uses custom classes)
             adTypeCustomEventName = extractHeader(response, CUSTOM_EVENT_NAME);
@@ -236,13 +202,13 @@ void execute() {
             MoPubView mpv = adViewController.getMoPubView();
 
             if (mHeader == null) {
-                Log.i("MoPub", "Couldn't call custom method because the server did not specify one.");
+                MoPubLog.i("Couldn't call custom method because the server did not specify one.");
                 mpv.loadFailUrl(MoPubErrorCode.ADAPTER_NOT_FOUND);
                 return;
             }
 
             String methodName = mHeader.getValue();
-            Log.i("MoPub", "Trying to call method named " + methodName);
+            MoPubLog.i("Trying to call method named " + methodName);
 
             Class<? extends Activity> c;
             Method method;
@@ -252,11 +218,11 @@ void execute() {
                 method = c.getMethod(methodName, MoPubView.class);
                 method.invoke(userActivity, mpv);
             } catch (NoSuchMethodException e) {
-                Log.d("MoPub", "Couldn't perform custom method named " + methodName +
+                MoPubLog.d("Couldn't perform custom method named " + methodName +
                         "(MoPubView view) because your activity class has no such method");
                 mpv.loadFailUrl(MoPubErrorCode.ADAPTER_NOT_FOUND);
             } catch (Exception e) {
-                Log.d("MoPub", "Couldn't perform custom method named " + methodName);
+                MoPubLog.d("Couldn't perform custom method named " + methodName);
                 mpv.loadFailUrl(MoPubErrorCode.ADAPTER_NOT_FOUND);
             }
         }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdTypeTranslator.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdTypeTranslator.java
index 837d6dad..2ac1f294 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdTypeTranslator.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdTypeTranslator.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 public class AdTypeTranslator {
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/AdViewController.java b/mopub-sdk/src/main/java/com/mopub/mobileads/AdViewController.java
index 3f78096b..1fa8159d 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/AdViewController.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/AdViewController.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
@@ -42,12 +10,11 @@
 import android.view.Gravity;
 import android.view.View;
 import android.widget.FrameLayout;
-
+import com.mopub.common.MoPub;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Dips;
-import com.mopub.common.util.MoPubLog;
 import com.mopub.mobileads.factories.AdFetcherFactory;
 import com.mopub.mobileads.factories.HttpClientFactory;
-
 import org.apache.http.HttpResponse;
 import org.apache.http.client.methods.HttpGet;
 import org.apache.http.impl.client.DefaultHttpClient;
@@ -55,9 +22,10 @@
 import java.util.*;
 
 import static android.Manifest.permission.ACCESS_NETWORK_STATE;
-import static com.mopub.common.LocationService.*;
-import static com.mopub.common.GpsHelper.*;
-import static com.mopub.mobileads.MoPubView.DEFAULT_LOCATION_PRECISION;
+import static com.mopub.common.GpsHelper.GpsHelperListener;
+import static com.mopub.common.GpsHelper.asyncFetchAdvertisingInfo;
+import static com.mopub.common.GpsHelper.asyncFetchAdvertisingInfoIfNotCached;
+import static com.mopub.common.LocationService.getLastKnownLocation;
 
 public class AdViewController {
     static final int MINIMUM_REFRESH_TIME_MILLISECONDS = 10000;
@@ -87,9 +55,6 @@
     private boolean mPreviousAutoRefreshSetting = true;
     private String mKeywords;
     private Location mLocation;
-    private LocationAwareness mLocationAwareness = LocationAwareness.NORMAL;
-    private int mLocationPrecision = DEFAULT_LOCATION_PRECISION;
-    private boolean mIsFacebookSupported = true;
     private boolean mIsTesting;
     private boolean mAdWasLoaded;
 
@@ -130,19 +95,21 @@ public MoPubView getMoPubView() {
     public void loadAd() {
         mAdWasLoaded = true;
         if (mAdConfiguration.getAdUnitId() == null) {
-            Log.d("MoPub", "Can't load an ad in this ad view because the ad unit ID is null. " +
+            MoPubLog.d("Can't load an ad in this ad view because the ad unit ID is null. " +
                     "Did you forget to call setAdUnitId()?");
             return;
         }
 
         if (!isNetworkAvailable()) {
-            Log.d("MoPub", "Can't load an ad because there is no network connectivity.");
+            MoPubLog.d("Can't load an ad because there is no network connectivity.");
             scheduleRefreshTimerIfEnabled();
             return;
         }
 
         if (mLocation == null) {
-            mLocation = getLastKnownLocation(mContext, mLocationPrecision, mLocationAwareness);
+            mLocation = getLastKnownLocation(mContext,
+                    MoPub.getLocationPrecision(),
+                    MoPub.getLocationAwareness());
         }
 
         // If we have access to Google Play Services (GPS) but the advertising info
@@ -154,10 +121,10 @@ public void loadAd() {
     void loadNonJavascript(String url) {
         if (url == null) return;
 
-        Log.d("MoPub", "Loading url: " + url);
+        MoPubLog.d("Loading url: " + url);
         if (mIsLoading) {
             if (mAdConfiguration.getAdUnitId() != null) {
-                Log.i("MoPub", "Already loading an ad for " + mAdConfiguration.getAdUnitId() + ", wait to finish.");
+                MoPubLog.i("Already loading an ad for " + mAdConfiguration.getAdUnitId() + ", wait to finish.");
             }
             return;
         }
@@ -170,7 +137,7 @@ void loadNonJavascript(String url) {
     }
 
     public void reload() {
-        Log.d("MoPub", "Reload ad: " + mUrl);
+        MoPubLog.d("Reload ad: " + mUrl);
         loadNonJavascript(mUrl);
     }
 
@@ -180,7 +147,7 @@ void loadFailUrl(MoPubErrorCode errorCode) {
         Log.v("MoPub", "MoPubErrorCode: " + (errorCode == null ? "" : errorCode.toString()));
 
         if (mAdConfiguration.getFailUrl() != null) {
-            Log.d("MoPub", "Loading failover url: " + mAdConfiguration.getFailUrl());
+            MoPubLog.d("Loading failover url: " + mAdConfiguration.getFailUrl());
             loadNonJavascript(mAdConfiguration.getFailUrl());
         } else {
             // No other URLs to try, so signal a failure.
@@ -204,14 +171,6 @@ public void setKeywords(String keywords) {
         mKeywords = keywords;
     }
 
-    public boolean isFacebookSupported() {
-        return mIsFacebookSupported;
-    }
-
-    public void setFacebookSupported(boolean enabled) {
-        mIsFacebookSupported = enabled;
-    }
-
     public Location getLocation() {
         return mLocation;
     }
@@ -246,11 +205,6 @@ public String getClickthroughUrl() {
         return mAdConfiguration.getClickthroughUrl();
     }
 
-    @Deprecated
-    public void setClickthroughUrl(String clickthroughUrl) {
-        mAdConfiguration.setClickthroughUrl(clickthroughUrl);
-    }
-
     public String getRedirectUrl() {
         return mAdConfiguration.getRedirectUrl();
     }
@@ -302,14 +256,6 @@ public void setTesting(boolean enabled) {
         mIsTesting = enabled;
     }
 
-    int getLocationPrecision() {
-        return mLocationPrecision;
-    }
-
-    void setLocationPrecision(int precision) {
-        mLocationPrecision = Math.max(0, precision);
-    }
-
     AdConfiguration getAdConfiguration() {
         return mAdConfiguration;
     }
@@ -372,7 +318,7 @@ public void run () {
                     httpget.addHeader("User-Agent", mAdConfiguration.getUserAgent());
                     httpClient.execute(httpget);
                 } catch (Exception e) {
-                    Log.d("MoPub", "Impression tracking failed : " + mAdConfiguration.getImpressionUrl(), e);
+                    MoPubLog.d("Impression tracking failed : " + mAdConfiguration.getImpressionUrl(), e);
                 } finally {
                     httpClient.getConnectionManager().shutdown();
                 }
@@ -387,12 +333,12 @@ public void run () {
 
                 DefaultHttpClient httpClient = HttpClientFactory.create();
                 try {
-                    Log.d("MoPub", "Tracking click for: " + mAdConfiguration.getClickthroughUrl());
+                    MoPubLog.d("Tracking click for: " + mAdConfiguration.getClickthroughUrl());
                     HttpGet httpget = new HttpGet(mAdConfiguration.getClickthroughUrl());
                     httpget.addHeader("User-Agent", mAdConfiguration.getUserAgent());
                     httpClient.execute(httpget);
                 } catch (Exception e) {
-                    Log.d("MoPub", "Click tracking failed: " + mAdConfiguration.getClickthroughUrl(), e);
+                    MoPubLog.d("Click tracking failed: " + mAdConfiguration.getClickthroughUrl(), e);
                 } finally {
                     httpClient.getConnectionManager().shutdown();
                 }
@@ -415,13 +361,12 @@ String generateAdUrl() {
         return mUrlGenerator
                 .withAdUnitId(mAdConfiguration.getAdUnitId())
                 .withKeywords(mKeywords)
-                .withFacebookSupported(mIsFacebookSupported)
                 .withLocation(mLocation)
                 .generateUrlString(getServerHostname());
     }
 
     void adDidFail(MoPubErrorCode errorCode) {
-        Log.i("MoPub", "Ad failed to load.");
+        MoPubLog.i("Ad failed to load.");
         setNotLoading();
         scheduleRefreshTimerIfEnabled();
         getMoPubView().adFailed(errorCode);
@@ -527,4 +472,23 @@ public void customEventDidFailToLoadAd() {
     public void customEventActionWillBegin() {
         registerClick();
     }
+
+    @Deprecated
+    public void setClickthroughUrl(String clickthroughUrl) {
+        mAdConfiguration.setClickthroughUrl(clickthroughUrl);
+    }
+
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
+    public boolean isFacebookSupported() {
+        return false;
+    }
+
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
+    public void setFacebookSupported(boolean enabled) {}
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseHtmlWebView.java b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseHtmlWebView.java
index 3b30f0c5..6f8cea10 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseHtmlWebView.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseHtmlWebView.java
@@ -1,46 +1,14 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.graphics.Color;
-import android.util.Log;
 import android.view.MotionEvent;
 import android.view.View;
+import com.mopub.common.logging.MoPubLog;
 
-import static com.mopub.mobileads.ViewGestureDetector.UserClickListener;
 import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
 import static com.mopub.common.util.VersionCode.currentApiLevel;
+import static com.mopub.mobileads.ViewGestureDetector.UserClickListener;
 
 public class BaseHtmlWebView extends BaseWebView implements UserClickListener {
     private final ViewGestureDetector mViewGestureDetector;
@@ -69,7 +37,7 @@ public void init(boolean isScrollable) {
     public void loadUrl(String url) {
         if (url == null) return;
 
-        Log.d("MoPub", "Loading url: " + url);
+        MoPubLog.d("Loading url: " + url);
         if (url.startsWith("javascript:")) {
             super.loadUrl(url);
         }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseInterstitialActivity.java b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseInterstitialActivity.java
index 7ddca8df..5fb5f449 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseInterstitialActivity.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseInterstitialActivity.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -96,10 +64,10 @@ public void onClick(final View view) {
             }
         };
 
+        // The contentView needs to be a RelativeLayout so the close button can be properly aligned
         mLayout = new RelativeLayout(this);
         final RelativeLayout.LayoutParams adViewLayout = new RelativeLayout.LayoutParams(
-                RelativeLayout.LayoutParams.FILL_PARENT, RelativeLayout.LayoutParams.WRAP_CONTENT);
-        adViewLayout.addRule(RelativeLayout.CENTER_IN_PARENT);
+                RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT);
         mLayout.addView(getAdView(), adViewLayout);
         setContentView(mLayout);
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoPlayerActivity.java b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoPlayerActivity.java
index b87e3a06..ec9ce51c 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoPlayerActivity.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoPlayerActivity.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -37,7 +5,7 @@
 import android.content.Context;
 import android.content.Intent;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.mobileads.util.vast.VastVideoConfiguration;
 
 import static android.content.Intent.FLAG_ACTIVITY_NEW_TASK;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoViewController.java b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoViewController.java
index ec8681dc..195b1612 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoViewController.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseVideoViewController.java
@@ -1,46 +1,14 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.content.Intent;
 import android.os.Bundle;
-import android.util.Log;
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.RelativeLayout;
 import android.widget.VideoView;
+import com.mopub.common.logging.MoPubLog;
 
 import static com.mopub.mobileads.EventForwardingBroadcastReceiver.ACTION_INTERSTITIAL_CLICK;
 import static com.mopub.mobileads.EventForwardingBroadcastReceiver.ACTION_INTERSTITIAL_FAIL;
@@ -102,7 +70,7 @@ ViewGroup getLayout() {
 
 
     void videoError(boolean shouldFinish) {
-        Log.d("MoPub", "Error: video can not be played.");
+        MoPubLog.d("Error: video can not be played.");
         broadcastAction(ACTION_INTERSTITIAL_FAIL);
         if (shouldFinish) {
            mBaseVideoViewControllerListener.onFinish();
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseWebView.java b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseWebView.java
index 8b3f32bf..c9f633be 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/BaseWebView.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/BaseWebView.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBanner.java b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBanner.java
index bc95c62e..dbc8345d 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBanner.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBanner.java
@@ -1,42 +1,10 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.view.View;
 
-import java.util.*;
+import java.util.Map;
 
 /*
  * CustomEventBanner is a base class for custom events that support banners. By implementing
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java
index edbe72e7..56a7e525 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
@@ -42,9 +10,9 @@
 
 import android.app.Activity;
 import android.os.Handler;
-import android.util.Log;
 import android.view.View;
 
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Json;
 import com.mopub.mobileads.CustomEventBanner.CustomEventBannerListener;
 import com.mopub.mobileads.factories.CustomEventBannerFactory;
@@ -79,17 +47,17 @@ public CustomEventBannerAdapter(MoPubView moPubView, String className, String cl
         mTimeout = new Runnable() {
             @Override
             public void run() {
-                Log.d("MoPub", "Third-party network timed out.");
+                MoPubLog.d("Third-party network timed out.");
                 onBannerFailed(NETWORK_TIMEOUT);
                 invalidate();
             }
         };
 
-        Log.d("MoPub", "Attempting to invoke custom event: " + className);
+        MoPubLog.d("Attempting to invoke custom event: " + className);
         try {
             mCustomEventBanner = CustomEventBannerFactory.create(className);
         } catch (Exception exception) {
-            Log.d("MoPub", "Couldn't locate or instantiate custom event: " + className + ".");
+            MoPubLog.d("Couldn't locate or instantiate custom event: " + className + ".");
             mMoPubView.loadFailUrl(ADAPTER_NOT_FOUND);
             return;
         }
@@ -98,7 +66,7 @@ public void run() {
         try {
             mServerExtras = Json.jsonStringToMap(classData);
         } catch (Exception exception) {
-            Log.d("MoPub", "Failed to create Map from JSON: " + classData + exception.toString());
+            MoPubLog.d("Failed to create Map from JSON: " + classData + exception.toString());
         }
 
         mLocalExtras = mMoPubView.getLocalExtras();
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitial.java b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitial.java
index 0a61dc74..22e62819 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitial.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitial.java
@@ -1,40 +1,8 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 
-import java.util.*;
+import java.util.Map;
 
 /*
  * CustomEventInterstitial is a base class for custom events that support interstitials. By
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitialAdapter.java b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitialAdapter.java
index 4ef0f468..f4a74c41 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitialAdapter.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/CustomEventInterstitialAdapter.java
@@ -1,41 +1,9 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.os.Handler;
-import android.util.Log;
 
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Json;
 import com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import com.mopub.mobileads.factories.CustomEventInterstitialFactory;
@@ -61,42 +29,43 @@
     private final Handler mHandler;
     private final Runnable mTimeout;
 
-    public CustomEventInterstitialAdapter(MoPubInterstitial moPubInterstitial, String className, String jsonParams) {
+    public CustomEventInterstitialAdapter(final MoPubInterstitial moPubInterstitial, final String className, final String jsonParams) {
         mHandler = new Handler();
         mMoPubInterstitial = moPubInterstitial;
         mServerExtras = new HashMap<String, String>();
         mLocalExtras = new HashMap<String, Object>();
-        mContext = moPubInterstitial.getActivity();
+        mContext = mMoPubInterstitial.getActivity();
         mTimeout = new Runnable() {
             @Override
             public void run() {
-                Log.d("MoPub", "Third-party network timed out.");
+                MoPubLog.d("Third-party network timed out.");
                 onInterstitialFailed(NETWORK_TIMEOUT);
                 invalidate();
             }
         };
 
-        Log.d("MoPub", "Attempting to invoke custom event: " + className);
+        MoPubLog.d("Attempting to invoke custom event: " + className);
         try {
             mCustomEventInterstitial = CustomEventInterstitialFactory.create(className);
         } catch (Exception exception) {
-            Log.d("MoPub", "Couldn't locate or instantiate custom event: " + className + ".");
-            if (mCustomEventInterstitialAdapterListener != null) mCustomEventInterstitialAdapterListener.onCustomEventInterstitialFailed(ADAPTER_NOT_FOUND);
+            MoPubLog.d("Couldn't locate or instantiate custom event: " + className + ".");
+            mMoPubInterstitial.onCustomEventInterstitialFailed(ADAPTER_NOT_FOUND);
+            return;
         }
-        
+
         // Attempt to load the JSON extras into mServerExtras.
         try {
             mServerExtras = Json.jsonStringToMap(jsonParams);
         } catch (Exception exception) {
-            Log.d("MoPub", "Failed to create Map from JSON: " + jsonParams);
+            MoPubLog.d("Failed to create Map from JSON: " + jsonParams);
         }
-        
-        mLocalExtras = moPubInterstitial.getLocalExtras();
-        if (moPubInterstitial.getLocation() != null) {
-            mLocalExtras.put("location", moPubInterstitial.getLocation());
+
+        mLocalExtras = mMoPubInterstitial.getLocalExtras();
+        if (mMoPubInterstitial.getLocation() != null) {
+            mLocalExtras.put("location", mMoPubInterstitial.getLocation());
         }
 
-        AdViewController adViewController = moPubInterstitial.getMoPubInterstitialView().getAdViewController();
+        final AdViewController adViewController = mMoPubInterstitial.getMoPubInterstitialView().getAdViewController();
         if (adViewController != null) {
             mLocalExtras.put(AD_CONFIGURATION_KEY, adViewController.getAdConfiguration());
         }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultBannerAdListener.java b/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultBannerAdListener.java
index d4888cf0..84999f66 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultBannerAdListener.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultBannerAdListener.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import static com.mopub.mobileads.MoPubView.BannerAdListener;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultInterstitialAdListener.java b/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultInterstitialAdListener.java
index 0eb4040e..73a37a12 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultInterstitialAdListener.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/DefaultInterstitialAdListener.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import static com.mopub.mobileads.MoPubInterstitial.InterstitialAdListener;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/EventForwardingBroadcastReceiver.java b/mopub-sdk/src/main/java/com/mopub/mobileads/EventForwardingBroadcastReceiver.java
index a4edd5cd..624995f2 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/EventForwardingBroadcastReceiver.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/EventForwardingBroadcastReceiver.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.BroadcastReceiver;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/FacebookKeywordProvider.java b/mopub-sdk/src/main/java/com/mopub/mobileads/FacebookKeywordProvider.java
index 401aa998..8b310536 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/FacebookKeywordProvider.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/FacebookKeywordProvider.java
@@ -1,80 +1,17 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
-import android.database.Cursor;
-import android.net.Uri;
-import android.util.Log;
 
-/*
- * This class enables the MoPub SDK to deliver targeted ads from Facebook via MoPub Marketplace
- * (MoPub's real-time bidding ad exchange) as part of a test program. This class sends an identifier
- * to Facebook so Facebook can select the ad MoPub will serve in your app through MoPub Marketplace.
- * If this class is removed from the SDK, your application will not receive targeted ads from
- * Facebook.
+/**
+ * @deprecated As of release 2.4
  */
-
+@Deprecated
 public class FacebookKeywordProvider {
-    private static final Uri ID_URL = Uri.parse("content://com.facebook.katana.provider.AttributionIdProvider");
-    private static final String ID_COLUMN_NAME = "aid";
-    private static final String ID_PREFIX = "FBATTRID:";
-
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
     public static String getKeyword(Context context) {
-        Cursor cursor = null;
-
-        try {
-            String projection[] = {ID_COLUMN_NAME};
-            cursor = context.getContentResolver().query(ID_URL, projection, null, null, null);
-            
-            if (cursor == null || !cursor.moveToFirst()) {
-                return null;
-            }
-            
-            String attributionId = cursor.getString(cursor.getColumnIndex(ID_COLUMN_NAME));
-            
-            if (attributionId == null || attributionId.length() == 0) {
-                return null;
-            }
-            
-            return ID_PREFIX + attributionId;
-        } catch (Exception exception) {
-            Log.d("MoPub", "Unable to retrieve FBATTRID: " + exception.toString());
-            return null;
-        } finally {
-            if (cursor != null) {
-                cursor.close();
-            }
-        }
+        return null;
     }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBanner.java b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBanner.java
index 88bd278e..ff274a17 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBanner.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBanner.java
@@ -1,43 +1,12 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.net.Uri;
+
 import com.mopub.mobileads.factories.HtmlBannerWebViewFactory;
 
-import java.util.*;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.CLICKTHROUGH_URL_KEY;
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBannerWebView.java b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBannerWebView.java
index 8e009421..b707d66f 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBannerWebView.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlBannerWebView.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitial.java b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitial.java
index 153548df..d3ddf4a9 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitial.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitial.java
@@ -1,40 +1,8 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.net.Uri;
 
-import java.util.*;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.CLICKTHROUGH_URL_KEY;
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitialWebView.java b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitialWebView.java
index 4f7c99c7..54f10701 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitialWebView.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlInterstitialWebView.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.annotation.TargetApi;
@@ -37,9 +5,9 @@
 import android.os.Handler;
 import android.webkit.JavascriptInterface;
 
-import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.common.util.VersionCode.HONEYCOMB;
 import static com.mopub.common.util.VersionCode.currentApiLevel;
+import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 
 public class HtmlInterstitialWebView extends BaseHtmlWebView {
     private Handler mHandler;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewClient.java b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewClient.java
index e2daeed9..1b8726d3 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewClient.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewClient.java
@@ -1,46 +1,14 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.content.Intent;
 import android.graphics.Bitmap;
 import android.net.Uri;
-import android.util.Log;
 import android.webkit.WebView;
 import android.webkit.WebViewClient;
 
 import com.mopub.common.MoPubBrowser;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.IntentUtils;
 import com.mopub.mobileads.util.Utils;
 
@@ -70,7 +38,7 @@ public boolean shouldOverrideUrlLoading(WebView view, String url) {
             return true;
         }
 
-        Log.d("MoPub", "Ad clicked. Click URL: " + url);
+        MoPubLog.d("Ad clicked. Click URL: " + url);
 
         // this is added because http/s can also be intercepted
         if (!isWebSiteUrl(url) && IntentUtils.canHandleApplicationUrl(mContext, url)) {
@@ -152,7 +120,7 @@ private boolean handleNativeBrowserScheme(String url) {
         try {
             urlToOpenInNativeBrowser = uri.getQueryParameter("url");
         } catch (UnsupportedOperationException e) {
-            Log.w("MoPub", "Could not handle url: " + url);
+            MoPubLog.w("Could not handle url: " + url);
             return false;
         }
 
@@ -188,7 +156,7 @@ private boolean launchApplicationUrl(String url) {
 
     private void showMoPubBrowserForUrl(String url) {
         if (url == null || url.equals("")) url = "about:blank";
-        Log.d("MoPub", "Final URI to show in browser: " + url);
+        MoPubLog.d("Final URI to show in browser: " + url);
         Intent intent = new Intent(mContext, MoPubBrowser.class);
         intent.putExtra(MoPubBrowser.DESTINATION_URL_KEY, url);
         intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
@@ -213,7 +181,7 @@ private void handleCustomIntentFromUri(Uri uri) {
             action = uri.getQueryParameter("fnc");
             adData = uri.getQueryParameter("data");
         } catch (UnsupportedOperationException e) {
-            Log.w("MoPub", "Could not handle custom intent with uri: " + uri);
+            MoPubLog.w("Could not handle custom intent with uri: " + uri);
             return;
         }
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewListener.java b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewListener.java
index 5b23c221..41ee0dbb 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewListener.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/HtmlWebViewListener.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 public interface HtmlWebViewListener {
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubActivity.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubActivity.java
index f26c89fa..223c015e 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubActivity.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubActivity.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.ActivityNotFoundException;
@@ -40,6 +8,7 @@
 import android.view.View;
 import android.webkit.WebView;
 import android.webkit.WebViewClient;
+
 import com.mopub.mobileads.factories.HtmlInterstitialWebViewFactory;
 
 import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubBrowserController.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubBrowserController.java
index 4029b87f..ff9a8f49 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubBrowserController.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubBrowserController.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 
@@ -37,7 +5,6 @@
 import android.content.Intent;
 import android.net.Uri;
 import android.util.Log;
-
 import com.mopub.common.MoPubBrowser;
 import com.mopub.common.util.IntentUtils;
 import com.mopub.mobileads.util.Utils;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java
index 012ddcbb..eb50d0dc 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java
@@ -1,46 +1,13 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.content.SharedPreferences;
-import android.util.Log;
-
 import com.mopub.common.BaseUrlGenerator;
+import com.mopub.common.ClientMetadata;
 import com.mopub.common.GpsHelper;
 import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.mobileads.factories.HttpClientFactory;
-
 import org.apache.http.HttpEntity;
 import org.apache.http.HttpResponse;
 import org.apache.http.HttpStatus;
@@ -74,7 +41,7 @@ public void reportAppOpen(Context context) {
         if (!isAlreadyTracked()) {
             GpsHelper.asyncFetchAdvertisingInfo(mContext, mConversionTrackerGpsHelperListener);
         } else {
-            Log.d("MoPub", "Conversion already tracked");
+            MoPubLog.d("Conversion already tracked");
         }
     }
 
@@ -89,9 +56,11 @@ public String generateUrlString(String serverHostname) {
 
             setApiVersion("6");
             setPackageId(mPackageName);
-            setUdid(getUdidFromContext(mContext));
+
+            ClientMetadata clientMetadata = ClientMetadata.getInstance(mContext);
+            setUdid(clientMetadata.getUdid());
             setDoNotTrack(GpsHelper.isLimitAdTrackingEnabled(mContext));
-            setAppVersion(getAppVersionFromContext(mContext));
+            setAppVersion(clientMetadata.getAppVersion());
             return getFinalUrlString();
         }
 
@@ -103,7 +72,7 @@ private void setPackageId(String packageName) {
     private class TrackOpen implements Runnable {
         public void run() {
             String url = new ConversionUrlGenerator().generateUrlString(TRACK_HOST);
-            Log.d("MoPub", "Conversion track: " + url);
+            MoPubLog.d("Conversion track: " + url);
 
             DefaultHttpClient httpClient = HttpClientFactory.create();
             HttpResponse response;
@@ -111,23 +80,23 @@ public void run() {
                 HttpGet httpget = new HttpGet(url);
                 response = httpClient.execute(httpget);
             } catch (Exception e) {
-                Log.d("MoPub", "Conversion track failed [" + e.getClass().getSimpleName() + "]: " + url);
+                MoPubLog.d("Conversion track failed [" + e.getClass().getSimpleName() + "]: " + url);
                 return;
             }
 
             if (response.getStatusLine().getStatusCode() != HttpStatus.SC_OK) {
-                Log.d("MoPub", "Conversion track failed: Status code != 200.");
+                MoPubLog.d("Conversion track failed: Status code != 200.");
                 return;
             }
 
             HttpEntity entity = response.getEntity();
             if (entity == null || entity.getContentLength() == 0) {
-                Log.d("MoPub", "Conversion track failed: Response was empty.");
+                MoPubLog.d("Conversion track failed: Response was empty.");
                 return;
             }
 
             // If we made it here, the request has been tracked
-            Log.d("MoPub", "Conversion track successful.");
+            MoPubLog.d("Conversion track successful.");
             mSharedPreferences
                     .edit()
                     .putBoolean(mIsTrackedKey, true)
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubErrorCode.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubErrorCode.java
index de6d1d11..a858a746 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubErrorCode.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubErrorCode.java
@@ -1,39 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 public enum MoPubErrorCode {
-    NO_FILL("No inventory."),
+    NO_FILL("No ads found."),
     SERVER_ERROR("Unable to connect to MoPub adserver."),
     INTERNAL_ERROR("Unable to serve ad due to invalid internal state."),
     CANCELLED("Ad request was cancelled."),
@@ -41,7 +9,7 @@
     ADAPTER_NOT_FOUND("Unable to find Native Network or Custom Event adapter."),
     ADAPTER_CONFIGURATION_ERROR("Native Network or Custom Event adapter was configured incorrectly."),
     NETWORK_TIMEOUT("Third-party network failed to respond in a timely manner."),
-    NETWORK_NO_FILL("Third-party network failed to provide inventory."),
+    NETWORK_NO_FILL("Third-party network failed to provide an ad."),
     NETWORK_INVALID_STATE("Third-party network failed due to invalid internal state."),
     MRAID_LOAD_ERROR("Error loading MRAID ad."),
     VIDEO_CACHE_ERROR("Error creating a cache to store downloaded videos."),
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubInterstitial.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubInterstitial.java
index 85df9c9a..be773f6c 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubInterstitial.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubInterstitial.java
@@ -1,50 +1,19 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.location.Location;
-import android.util.Log;
 
+import com.mopub.common.MoPub;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.mobileads.factories.CustomEventInterstitialAdapterFactory;
 
-import java.util.*;
+import java.util.Map;
 
-import static com.mopub.common.LocationService.*;
-import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
+import static com.mopub.common.LocationService.LocationAwareness;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_DATA;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_NAME;
+import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
 
 public class MoPubInterstitial implements CustomEventInterstitialAdapter.CustomEventInterstitialAdapterListener {
 
@@ -152,14 +121,6 @@ public String getKeywords() {
         return mInterstitialView.getKeywords();
     }
 
-    public void setFacebookSupported(boolean enabled) {
-        mInterstitialView.setFacebookSupported(enabled);
-    }
-
-    public boolean isFacebookSupported() {
-        return mInterstitialView.isFacebookSupported();
-    }
-
     public Activity getActivity() {
         return mActivity;
     }
@@ -188,22 +149,6 @@ public InterstitialAdListener getInterstitialAdListener() {
         return mInterstitialAdListener;
     }
 
-    public void setLocationAwareness(LocationAwareness awareness) {
-        mInterstitialView.setLocationAwareness(awareness);
-    }
-
-    public LocationAwareness getLocationAwareness() {
-        return mInterstitialView.getLocationAwareness();
-    }
-
-    public void setLocationPrecision(int precision) {
-        mInterstitialView.setLocationPrecision(precision);
-    }
-
-    public int getLocationPrecision() {
-        return mInterstitialView.getLocationPrecision();
-    }
-
     public void setTesting(boolean testing) {
         mInterstitialView.setTesting(testing);
     }
@@ -278,6 +223,26 @@ public void onCustomEventInterstitialDismissed() {
         }
     }
 
+    @Deprecated
+    public void setLocationAwareness(LocationAwareness locationAwareness) {
+        MoPub.setLocationAwareness(locationAwareness.getNewLocationAwareness());
+    }
+
+    @Deprecated
+    public LocationAwareness getLocationAwareness() {
+        return LocationAwareness.fromMoPubLocationAwareness(MoPub.getLocationAwareness());
+    }
+
+    @Deprecated
+    public void setLocationPrecision(int precision) {
+        MoPub.setLocationPrecision(precision);
+    }
+
+    @Deprecated
+    public int getLocationPrecision() {
+        return MoPub.getLocationPrecision();
+    }
+
     ////////////////////////////////////////////////////////////////////////////////////////////////
 
     public class MoPubInterstitialView extends MoPubView {
@@ -290,7 +255,7 @@ public MoPubInterstitialView(Context context) {
         @Override
         protected void loadCustomEvent(Map<String, String> paramsMap) {
             if (paramsMap == null) {
-                Log.d("MoPub", "Couldn't invoke custom event because the server did not specify one.");
+                MoPubLog.d("Couldn't invoke custom event because the server did not specify one.");
                 loadFailUrl(ADAPTER_NOT_FOUND);
                 return;
             }
@@ -299,7 +264,7 @@ protected void loadCustomEvent(Map<String, String> paramsMap) {
                 mCustomEventInterstitialAdapter.invalidate();
             }
 
-            Log.d("MoPub", "Loading custom event interstitial adapter.");
+            MoPubLog.d("Loading custom event interstitial adapter.");
 
             mCustomEventInterstitialAdapter = CustomEventInterstitialAdapterFactory.create(
                     MoPubInterstitial.this,
@@ -310,7 +275,7 @@ protected void loadCustomEvent(Map<String, String> paramsMap) {
         }
 
         protected void trackImpression() {
-            Log.d("MoPub", "Tracking impression for interstitial.");
+            MoPubLog.d("Tracking impression for interstitial.");
             if (mAdViewController != null) mAdViewController.trackImpression();
         }
 
@@ -351,4 +316,18 @@ public void customEventDidFailToLoadAd() {
     public void customEventActionWillBegin() {
         if (mInterstitialView != null) mInterstitialView.registerClick();
     }
+
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
+    public void setFacebookSupported(boolean enabled) {}
+
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
+    public boolean isFacebookSupported() {
+        return false;
+    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubView.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubView.java
index a9e887de..86aad8f7 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubView.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MoPubView.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -39,24 +7,24 @@
 import android.content.IntentFilter;
 import android.location.Location;
 import android.util.AttributeSet;
-import android.util.Log;
 import android.view.View;
 import android.webkit.WebViewDatabase;
 import android.widget.FrameLayout;
-
+import com.mopub.common.MoPub;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.ManifestUtils;
+import com.mopub.common.util.Visibility;
 import com.mopub.mobileads.factories.AdViewControllerFactory;
 import com.mopub.mobileads.factories.CustomEventBannerAdapterFactory;
 
 import java.util.*;
 
-import static com.mopub.common.LocationService.*;
-import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
+import static com.mopub.common.LocationService.LocationAwareness;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_DATA;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_NAME;
+import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
 
 public class MoPubView extends FrameLayout {
-
     public interface BannerAdListener {
         public void onBannerLoaded(MoPubView banner);
         public void onBannerFailed(MoPubView banner, MoPubErrorCode errorCode);
@@ -74,9 +42,8 @@
     protected CustomEventBannerAdapter mCustomEventBannerAdapter;
 
     private Context mContext;
+    private int mScreenVisibility;
     private BroadcastReceiver mScreenStateReceiver;
-    private boolean mIsInForeground;
-    private LocationAwareness mLocationAwareness;
 
     private BannerAdListener mBannerAdListener;
     
@@ -97,8 +64,7 @@ public MoPubView(Context context, AttributeSet attrs) {
         ManifestUtils.checkWebViewActivitiesDeclared(context);
 
         mContext = context;
-        mIsInForeground = (getVisibility() == VISIBLE);
-        mLocationAwareness = LocationAwareness.NORMAL;
+        mScreenVisibility = getVisibility();
 
         setHorizontalScrollBarEnabled(false);
         setVerticalScrollBarEnabled(false);
@@ -109,7 +75,7 @@ public MoPubView(Context context, AttributeSet attrs) {
         // Here, we'll work around it by trying to create a file store and then just go inert
         // if it's not accessible.
         if (WebViewDatabase.getInstance(context) == null) {
-            Log.e("MoPub", "Disabling MoPub. Local cache file is inaccessible so MoPub will " +
+            MoPubLog.e("Disabling MoPub. Local cache file is inaccessible so MoPub will " +
                     "fail if we try to create a WebView. Details of this Android bug found at:" +
                     "http://code.google.com/p/android/issues/detail?id=10789");
             return;
@@ -122,16 +88,16 @@ public MoPubView(Context context, AttributeSet attrs) {
     private void registerScreenStateBroadcastReceiver() {
         mScreenStateReceiver = new BroadcastReceiver() {
             public void onReceive(final Context context, final Intent intent) {
-                if (!mIsInForeground || intent == null) {
+                if (!Visibility.isScreenVisible(mScreenVisibility) || intent == null) {
                     return;
                 }
 
                 final String action = intent.getAction();
 
                 if (Intent.ACTION_USER_PRESENT.equals(action)) {
-                    setAdVisibility(true);
+                    setAdVisibility(View.VISIBLE);
                 } else if (Intent.ACTION_SCREEN_OFF.equals(action)) {
-                    setAdVisibility(false);
+                    setAdVisibility(View.GONE);
                 }
             }
         };
@@ -145,12 +111,14 @@ private void unregisterScreenStateBroadcastReceiver() {
         try {
             mContext.unregisterReceiver(mScreenStateReceiver);
         } catch (Exception IllegalArgumentException) {
-            Log.d("MoPub", "Failed to unregister screen state broadcast receiver (never registered).");
+            MoPubLog.d("Failed to unregister screen state broadcast receiver (never registered).");
         }
     }
 
     public void loadAd() {
-        if (mAdViewController != null) mAdViewController.loadAd();
+        if (mAdViewController != null) {
+            mAdViewController.loadAd();
+        }
     }
 
     /*
@@ -182,7 +150,7 @@ protected void loadFailUrl(MoPubErrorCode errorCode) {
 
     protected void loadCustomEvent(Map<String, String> paramsMap) {
         if (paramsMap == null) {
-            Log.d("MoPub", "Couldn't invoke custom event because the server did not specify one.");
+            MoPubLog.d("Couldn't invoke custom event because the server did not specify one.");
             loadFailUrl(ADAPTER_NOT_FOUND);
             return;
         }
@@ -191,7 +159,7 @@ protected void loadCustomEvent(Map<String, String> paramsMap) {
             mCustomEventBannerAdapter.invalidate();
         }
 
-        Log.d("MoPub", "Loading custom event adapter.");
+        MoPubLog.d("Loading custom event adapter.");
 
         mCustomEventBannerAdapter = CustomEventBannerAdapterFactory.create(
                 this,
@@ -210,24 +178,25 @@ protected void registerClick() {
     }
 
     protected void trackNativeImpression() {
-        Log.d("MoPub", "Tracking impression for native adapter.");
+        MoPubLog.d("Tracking impression for native adapter.");
         if (mAdViewController != null) mAdViewController.trackImpression();
     }
 
     @Override
-    protected void onWindowVisibilityChanged(int visibility) {
-        final boolean isVisible = (visibility == VISIBLE);
-
-        mIsInForeground = isVisible;
-        setAdVisibility(isVisible);
+    protected void onWindowVisibilityChanged(final int visibility) {
+        // Ignore transitions between View.GONE and View.INVISIBLE
+        if (Visibility.hasScreenVisibilityChanged(mScreenVisibility, visibility)) {
+            mScreenVisibility = visibility;
+            setAdVisibility(mScreenVisibility);
+        }
     }
 
-    private void setAdVisibility(boolean isVisible) {
+    private void setAdVisibility(final int visibility) {
         if (mAdViewController == null) {
             return;
         }
 
-        if (isVisible) {
+        if (Visibility.isScreenVisible(visibility)) {
             mAdViewController.unpauseRefresh();
         } else {
             mAdViewController.pauseRefresh();
@@ -235,7 +204,7 @@ private void setAdVisibility(boolean isVisible) {
     }
 
     protected void adLoaded() {
-        Log.d("MoPub", "adLoaded");
+        MoPubLog.d("adLoaded");
         
         if (mBannerAdListener != null) {
             mBannerAdListener.onBannerLoaded(this);
@@ -299,14 +268,6 @@ public String getKeywords() {
         return (mAdViewController != null) ? mAdViewController.getKeywords() : null;
     }
 
-    public void setFacebookSupported(boolean enabled) {
-        if (mAdViewController != null) mAdViewController.setFacebookSupported(enabled);
-    }
-
-    public boolean isFacebookSupported() {
-        return (mAdViewController != null) ? mAdViewController.isFacebookSupported() : false;
-    }
-
     public void setLocation(Location location) {
         if (mAdViewController != null) mAdViewController.setLocation(location);
     }
@@ -351,24 +312,6 @@ public BannerAdListener getBannerAdListener() {
         return mBannerAdListener;
     }
 
-    public void setLocationAwareness(LocationAwareness awareness) {
-        mLocationAwareness = awareness;
-    }
-
-    public LocationAwareness getLocationAwareness() {
-        return mLocationAwareness;
-    }
-
-    public void setLocationPrecision(int precision) {
-        if (mAdViewController != null) {
-            mAdViewController.setLocationPrecision(precision);
-        }
-    }
-
-    public int getLocationPrecision() {
-        return (mAdViewController != null) ? mAdViewController.getLocationPrecision() : 0;
-    }
-
     public void setLocalExtras(Map<String, Object> localExtras) {
         if (mAdViewController != null) mAdViewController.setLocalExtras(localExtras);
     }
@@ -387,7 +330,7 @@ public void setAutorefreshEnabled(boolean enabled) {
     public boolean getAutorefreshEnabled() {
         if (mAdViewController != null) return mAdViewController.getAutorefreshEnabled();
         else {
-            Log.d("MoPub", "Can't get autorefresh status for destroyed MoPubView. " +
+            MoPubLog.d("Can't get autorefresh status for destroyed MoPubView. " +
                     "Returning false.");
             return false;
         }
@@ -404,7 +347,7 @@ public void setTesting(boolean testing) {
     public boolean getTesting() {
         if (mAdViewController != null) return mAdViewController.getTesting();
         else {
-            Log.d("MoPub", "Can't get testing status for destroyed MoPubView. " +
+            MoPubLog.d("Can't get testing status for destroyed MoPubView. " +
                     "Returning false.");
             return false;
         }
@@ -423,6 +366,26 @@ AdViewController getAdViewController() {
         return mAdViewController;
     }
 
+    @Deprecated
+    public void setLocationAwareness(LocationAwareness locationAwareness) {
+        MoPub.setLocationAwareness(locationAwareness.getNewLocationAwareness());
+    }
+
+    @Deprecated
+    public LocationAwareness getLocationAwareness() {
+        return LocationAwareness.fromMoPubLocationAwareness(MoPub.getLocationAwareness());
+    }
+
+    @Deprecated
+    public void setLocationPrecision(int precision) {
+        MoPub.setLocationPrecision(precision);
+    }
+
+    @Deprecated
+    public int getLocationPrecision() {
+        return MoPub.getLocationPrecision();
+    }
+
     @Deprecated
     public interface OnAdWillLoadListener {
         public void OnAdWillLoad(MoPubView m, String url);
@@ -485,7 +448,7 @@ public void setOnAdClickedListener(OnAdClickedListener listener) {
 
     @Deprecated
     protected void adWillLoad(String url) {
-        Log.d("MoPub", "adWillLoad: " + url);
+        MoPubLog.d("adWillLoad: " + url);
         if (mOnAdWillLoadListener != null) mOnAdWillLoadListener.OnAdWillLoad(this, url);
     }
 
@@ -503,4 +466,18 @@ public void customEventDidFailToLoadAd() {
     public void customEventActionWillBegin() {
         if (mAdViewController != null) mAdViewController.customEventActionWillBegin();
     }
+
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
+    public void setFacebookSupported(boolean enabled) {}
+
+    /**
+     * @deprecated As of release 2.4
+     */
+    @Deprecated
+    public boolean isFacebookSupported() {
+        return false;
+    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidAbstractController.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidAbstractController.java
index 4f1204ae..7f56c51f 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidAbstractController.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidAbstractController.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidActivity.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidActivity.java
index 6abe0001..ac5dedce 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidActivity.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidActivity.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.annotation.TargetApi;
@@ -42,6 +10,7 @@
 import android.view.WindowManager;
 import android.webkit.WebView;
 import android.webkit.WebViewClient;
+
 import com.mopub.mobileads.MraidView.ExpansionStyle;
 import com.mopub.mobileads.MraidView.NativeCloseButtonStyle;
 import com.mopub.mobileads.MraidView.PlacementType;
@@ -49,12 +18,12 @@
 import com.mopub.mobileads.factories.MraidViewFactory;
 import com.mopub.mobileads.util.WebViews;
 
+import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
+import static com.mopub.common.util.VersionCode.currentApiLevel;
 import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.BaseInterstitialActivity.JavaScriptWebViewCallbacks.WEB_VIEW_DID_APPEAR;
 import static com.mopub.mobileads.BaseInterstitialActivity.JavaScriptWebViewCallbacks.WEB_VIEW_DID_CLOSE;
-import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
-import static com.mopub.common.util.VersionCode.currentApiLevel;
 import static com.mopub.mobileads.EventForwardingBroadcastReceiver.ACTION_INTERSTITIAL_CLICK;
 import static com.mopub.mobileads.EventForwardingBroadcastReceiver.ACTION_INTERSTITIAL_DISMISS;
 import static com.mopub.mobileads.EventForwardingBroadcastReceiver.ACTION_INTERSTITIAL_SHOW;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidBanner.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidBanner.java
index c9fe1375..63809fdd 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidBanner.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidBanner.java
@@ -1,44 +1,13 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.net.Uri;
+
 import com.mopub.mobileads.MraidView.ViewState;
 import com.mopub.mobileads.factories.MraidViewFactory;
 
-import java.util.*;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.MoPubErrorCode.MRAID_LOAD_ERROR;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommand.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommand.java
index 34913473..c6e64d64 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommand.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommand.java
@@ -1,40 +1,8 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
-import android.util.Log;
+import com.mopub.common.logging.MoPubLog;
 
-import java.util.*;
+import java.util.Map;
 
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.GET_RESIZE_PROPERTIES;
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.OPEN;
@@ -136,7 +104,7 @@ void execute() {
             mView.getDisplayController().showUserDownloadImageAlert(url);
         } else {
             mView.fireErrorEvent(STORE_PICTURE, "Image can't be stored with null or empty URL");
-            Log.d("MoPub", "Invalid URI for Mraid Store Picture.");
+            MoPubLog.d("Invalid URI for Mraid Store Picture.");
         }
     }
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommandFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommandFactory.java
index e8ccd704..4145b710 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommandFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidCommandFactory.java
@@ -1,38 +1,6 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
-import java.util.*;
+import java.util.Map;
 
 class MraidCommandFactory {
     protected static MraidCommandFactory instance = new MraidCommandFactory();
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidDisplayController.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidDisplayController.java
index a541c768..8c1ac81a 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidDisplayController.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidDisplayController.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -64,7 +32,7 @@
 import android.widget.ImageView;
 import android.widget.RelativeLayout;
 import android.widget.Toast;
-
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Dips;
 import com.mopub.common.util.Streams;
 import com.mopub.mobileads.MraidView.ExpansionStyle;
@@ -75,23 +43,16 @@
 import com.mopub.mobileads.util.HttpResponses;
 import com.mopub.mobileads.util.Interstitials;
 import com.mopub.mobileads.util.Mraids;
-
 import org.apache.http.Header;
 import org.apache.http.HttpResponse;
 import org.apache.http.client.HttpClient;
 import org.apache.http.client.methods.HttpGet;
 
-import java.io.File;
-import java.io.FileOutputStream;
-import java.io.InputStream;
-import java.io.OutputStream;
+import java.io.*;
 import java.net.URI;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
-import java.util.ArrayList;
-import java.util.Date;
-import java.util.HashMap;
-import java.util.Map;
+import java.util.*;
 
 import static android.graphics.Color.TRANSPARENT;
 import static com.mopub.common.util.Drawables.INTERSTITIAL_CLOSE_BUTTON_NORMAL;
@@ -347,7 +308,7 @@ protected void showUserDownloadImageAlert(String imageUrl) {
         Context context = getContext();
         if (!isStorePictureSupported(context)) {
             getMraidView().fireErrorEvent(STORE_PICTURE, "Error downloading file - the device does not have an SD card mounted, or the Android permission is not granted.");
-            Log.d("MoPub", "Error downloading file - the device does not have an SD card mounted, or the Android permission is not granted.");
+            MoPubLog.d("Error downloading file - the device does not have an SD card mounted, or the Android permission is not granted.");
             return;
         }
 
@@ -408,7 +369,7 @@ public void run() {
                         public void run() {
                             showUserToast("Image failed to download.");
                             getMraidView().fireErrorEvent(STORE_PICTURE, "Error downloading and saving image file.");
-                            Log.d("MoPub", "Error downloading and saving image file.");
+                            MoPubLog.d("Error downloading and saving image file.");
                         }
                     });
                 } finally {
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidInterstitial.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidInterstitial.java
index b09553a9..53ac578e 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidInterstitial.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidInterstitial.java
@@ -1,41 +1,9 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 
 import android.net.Uri;
 
-import java.util.*;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidProperty.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidProperty.java
index 82b74525..bfcfdf56 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidProperty.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidProperty.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import com.mopub.mobileads.MraidView.PlacementType;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoPlayerActivity.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoPlayerActivity.java
index 9f246b71..7c9a2202 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoPlayerActivity.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoPlayerActivity.java
@@ -1,46 +1,14 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.ActivityNotFoundException;
 import android.content.Intent;
 import android.os.Bundle;
-import android.util.Log;
 import android.view.View;
 import android.view.Window;
 import android.view.WindowManager;
 
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.IntentUtils;
 
 import static com.mopub.mobileads.EventForwardingBroadcastReceiver.ACTION_INTERSTITIAL_FAIL;
@@ -61,7 +29,7 @@ protected void onCreate(Bundle savedInstanceState) {
         if (adConfiguration != null) {
             mBroadcastIdentifier = adConfiguration.getBroadcastIdentifier();
         } else {
-            Log.d("MoPub", "Unable to obtain broadcast identifier. Video interactions cannot be tracked.");
+            MoPubLog.d("Unable to obtain broadcast identifier. Video interactions cannot be tracked.");
         }
 
         try {
@@ -159,7 +127,7 @@ public void onStartActivityForResult(final Class<? extends Activity> clazz,
         try {
             startActivityForResult(intent, requestCode);
         } catch (ActivityNotFoundException e) {
-            Log.d("MoPub", "Activity " + clazz.getName() + " not found. Did you declare it in your AndroidManifest.xml?");
+            MoPubLog.d("Activity " + clazz.getName() + " not found. Did you declare it in your AndroidManifest.xml?");
         }
     }
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoViewController.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoViewController.java
index 67582d38..06111b88 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoViewController.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidVideoViewController.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
@@ -40,9 +8,7 @@
 import android.widget.ImageButton;
 import android.widget.RelativeLayout;
 import android.widget.VideoView;
-
 import com.mopub.common.util.Dips;
-import com.mopub.common.util.Drawables;
 
 import static android.view.View.GONE;
 import static android.view.View.OnClickListener;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidView.java b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidView.java
index f5e94874..4a5fa6b9 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/MraidView.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/MraidView.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.ActivityNotFoundException;
@@ -42,11 +10,10 @@
 import android.view.View;
 import android.webkit.WebView;
 import android.webkit.WebViewClient;
-
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Strings;
 import com.mopub.mobileads.factories.HttpClientFactory;
 import com.mopub.mobileads.resource.MraidJavascript;
-
 import org.apache.http.HttpEntity;
 import org.apache.http.HttpResponse;
 import org.apache.http.NameValuePair;
@@ -224,7 +191,7 @@ public void loadUrl(String url) {
                 outString = Strings.fromStream(entity.getContent());
             }
         } catch (IllegalArgumentException e) {
-            Log.d("MoPub", "Mraid loadUrl failed (IllegalArgumentException): "+url);
+            MoPubLog.d("Mraid loadUrl failed (IllegalArgumentException): " + url);
             notifyOnFailureListener();
             return;
         } catch (ClientProtocolException e) {
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/ResponseBodyInterstitial.java b/mopub-sdk/src/main/java/com/mopub/mobileads/ResponseBodyInterstitial.java
index d390d919..2d73912e 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/ResponseBodyInterstitial.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/ResponseBodyInterstitial.java
@@ -1,40 +1,8 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 
-import java.util.*;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_INVALID_STATE;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/TaskTracker.java b/mopub-sdk/src/main/java/com/mopub/mobileads/TaskTracker.java
index 3ca25972..ffe0a65b 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/TaskTracker.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/TaskTracker.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 public class TaskTracker {
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/ToolbarWidget.java b/mopub-sdk/src/main/java/com/mopub/mobileads/ToolbarWidget.java
index dc3d983b..382b0e03 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/ToolbarWidget.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/ToolbarWidget.java
@@ -4,7 +4,6 @@
 import android.graphics.Color;
 import android.graphics.drawable.Drawable;
 import android.text.TextUtils;
-import android.util.Log;
 import android.view.Gravity;
 import android.view.View;
 import android.widget.ImageView;
@@ -13,6 +12,7 @@
 import android.widget.TextView;
 
 import com.mopub.common.util.Dips;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Utils;
 import com.mopub.mobileads.resource.TextDrawable;
 
@@ -184,7 +184,7 @@ void updateImageText(final String text) {
             final TextDrawable textDrawable = (TextDrawable) mImageView.getDrawable();
             textDrawable.updateText(text);
         } catch (Exception e) {
-            Log.d("MoPub", "Unable to update ToolbarWidget text.");
+            MoPubLog.d("Unable to update ToolbarWidget text.");
         }
     }
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoDownloadTask.java b/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoDownloadTask.java
index 0d3f14d6..778d7de1 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoDownloadTask.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoDownloadTask.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.net.http.AndroidHttpClient;
@@ -37,7 +5,7 @@
 
 import com.mopub.common.CacheService;
 import com.mopub.common.HttpClient;
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 import org.apache.http.HttpResponse;
 import org.apache.http.client.methods.HttpGet;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoInterstitial.java b/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoInterstitial.java
index 7ac734d3..b96d0f89 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoInterstitial.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoInterstitial.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.net.Uri;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoViewController.java b/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoViewController.java
index b103e4d9..c73582b5 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoViewController.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/VastVideoViewController.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -49,30 +17,24 @@
 import android.widget.ImageView;
 import android.widget.RelativeLayout;
 import android.widget.VideoView;
-
 import com.mopub.common.DownloadResponse;
 import com.mopub.common.DownloadTask;
 import com.mopub.common.HttpResponses;
 import com.mopub.common.MoPubBrowser;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.AsyncTasks;
 import com.mopub.common.util.Dips;
 import com.mopub.common.util.Drawables;
-import com.mopub.common.util.MoPubLog;
 import com.mopub.common.util.Streams;
 import com.mopub.common.util.VersionCode;
 import com.mopub.mobileads.util.vast.VastCompanionAd;
 import com.mopub.mobileads.util.vast.VastVideoConfiguration;
-
 import org.apache.http.HttpStatus;
 import org.apache.http.client.methods.HttpGet;
 
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.Serializable;
-import java.util.List;
-import java.util.concurrent.LinkedBlockingQueue;
-import java.util.concurrent.ThreadPoolExecutor;
-import java.util.concurrent.TimeUnit;
+import java.io.*;
+import java.util.*;
+import java.util.concurrent.*;
 
 import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE;
 import static com.mopub.common.HttpClient.initializeHttpGet;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/ViewGestureDetector.java b/mopub-sdk/src/main/java/com/mopub/mobileads/ViewGestureDetector.java
index f02e5e2e..bb9a23df 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/ViewGestureDetector.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/ViewGestureDetector.java
@@ -1,43 +1,12 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
-import android.util.Log;
 import android.view.GestureDetector;
 import android.view.MotionEvent;
 import android.view.View;
 
+import com.mopub.common.logging.MoPubLog;
+
 public class ViewGestureDetector extends GestureDetector {
     private final View mView;
 
@@ -69,7 +38,7 @@ void sendTouchEvent(MotionEvent motionEvent) {
                 if (mUserClickListener != null) {
                     mUserClickListener.onUserClick();
                 } else {
-                    Log.d("MoPub", "View's onUserClick() is not registered.");
+                    MoPubLog.d("View's onUserClick() is not registered.");
                 }
                 mAdAlertGestureListener.finishGestureDetection();
                 break;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/WebViewAdUrlGenerator.java b/mopub-sdk/src/main/java/com/mopub/mobileads/WebViewAdUrlGenerator.java
index 24e97126..5cfb84ed 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/WebViewAdUrlGenerator.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/WebViewAdUrlGenerator.java
@@ -1,14 +1,13 @@
 package com.mopub.mobileads;
 
 import android.content.Context;
-import android.os.Build;
+import android.location.Location;
 
 import com.mopub.common.AdUrlGenerator;
-import com.mopub.common.GpsHelper;
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.LocationService;
 import com.mopub.common.MoPub;
-import com.mopub.mobileads.util.Utils;
-
-import java.lang.reflect.Method;
+import com.mopub.common.util.DateAndTime;
 
 import static com.mopub.mobileads.util.Mraids.isStorePictureSupported;
 
@@ -21,41 +20,50 @@ public WebViewAdUrlGenerator(Context context) {
     public String generateUrlString(String serverHostname) {
         initUrlString(serverHostname, MoPubView.AD_HANDLER);
 
+        final ClientMetadata clientMetadata = ClientMetadata.getInstance(mContext);
+
         setApiVersion("6");
 
         setAdUnitId(mAdUnitId);
 
-        setSdkVersion(MoPub.SDK_VERSION);
+        setSdkVersion(clientMetadata.getSdkVersion());
 
-        setDeviceInfo(Build.MANUFACTURER, Build.MODEL, Build.PRODUCT);
+        setDeviceInfo(clientMetadata.getDeviceManufacturer(),
+                clientMetadata.getDeviceModel(),
+                clientMetadata.getDeviceProduct());
 
-        setUdid(getUdidFromContext(mContext));
+        setUdid(clientMetadata.getUdid());
 
-        setDoNotTrack(GpsHelper.isLimitAdTrackingEnabled(mContext));
+        setDoNotTrack(clientMetadata.getDoNoTrack());
 
-        String keywords = addKeyword(mKeywords, getFacebookKeyword(mContext, mFacebookSupportEnabled));
-        setKeywords(keywords);
+        setKeywords(mKeywords);
 
-        setLocation(mLocation);
+        Location location = mLocation;
+        if (location == null) {
+            location = LocationService.getLastKnownLocation(mContext,
+                    MoPub.getLocationPrecision(),
+                    MoPub.getLocationAwareness());
+        }
+        setLocation(location);
 
-        setTimezone(AdUrlGenerator.getTimeZoneOffsetString());
+        setTimezone(DateAndTime.getTimeZoneOffsetString());
 
-        setOrientation(mContext.getResources().getConfiguration().orientation);
+        setOrientation(clientMetadata.getOrientationString());
 
-        setDensity(mContext.getResources().getDisplayMetrics().density);
+        setDensity(clientMetadata.getDensity());
 
         setMraidFlag(detectIsMraidSupported());
 
-        String networkOperator = getNetworkOperator();
+        String networkOperator = clientMetadata.getNetworkOperator();
         setMccCode(networkOperator);
         setMncCode(networkOperator);
 
-        setIsoCountryCode(mTelephonyManager.getNetworkCountryIso());
-        setCarrierName(mTelephonyManager.getNetworkOperatorName());
+        setIsoCountryCode(clientMetadata.getIsoCountryCode());
+        setCarrierName(clientMetadata.getNetworkOperatorName());
 
-        setNetworkType(getActiveNetworkType());
+        setNetworkType(clientMetadata.getActiveNetworkType());
 
-        setAppVersion(getAppVersionFromContext(mContext));
+        setAppVersion(clientMetadata.getAppVersion());
 
         setExternalStoragePermission(isStorePictureSupported(mContext));
 
@@ -73,29 +81,4 @@ private boolean detectIsMraidSupported() {
         }
         return mraid;
     }
-
-    private static String getFacebookKeyword(Context context, final boolean enabled) {
-        if (!enabled) {
-            return null;
-        }
-
-        try {
-            Class<?> facebookKeywordProviderClass = Class.forName("com.mopub.mobileads.FacebookKeywordProvider");
-            Method getKeywordMethod = facebookKeywordProviderClass.getMethod("getKeyword", Context.class);
-
-            return (String) getKeywordMethod.invoke(facebookKeywordProviderClass, context);
-        } catch (Exception exception) {
-            return null;
-        }
-    }
-
-    private static String addKeyword(String keywords, String addition) {
-        if (addition == null || addition.length() == 0) {
-            return keywords;
-        } else if (keywords == null || keywords.length() == 0) {
-            return addition;
-        } else {
-            return keywords + "," + addition;
-        }
-    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetchTaskFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetchTaskFactory.java
index b1da8295..23c463be 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetchTaskFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetchTaskFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import com.mopub.mobileads.AdFetchTask;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetcherFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetcherFactory.java
index dae07963..7490ced8 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetcherFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdFetcherFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import com.mopub.mobileads.AdFetcher;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdViewControllerFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdViewControllerFactory.java
index 6e3df0b6..994fbef2 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdViewControllerFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/AdViewControllerFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import android.content.Context;
+
 import com.mopub.mobileads.AdViewController;
 import com.mopub.mobileads.MoPubView;
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerAdapterFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerAdapterFactory.java
index 28ec0140..bf363e57 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerAdapterFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerAdapterFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import com.mopub.mobileads.CustomEventBannerAdapter;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerFactory.java
index 9e41d7b9..0e48242d 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventBannerFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import com.mopub.mobileads.CustomEventBanner;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialAdapterFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialAdapterFactory.java
index 1e54f943..f6534dda 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialAdapterFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialAdapterFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import com.mopub.mobileads.CustomEventInterstitialAdapter;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialFactory.java
index ec5a17f6..7d3f5830 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/CustomEventInterstitialFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import com.mopub.mobileads.CustomEventInterstitial;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java
index d936ba91..e7d300b1 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import android.content.Context;
+
 import com.mopub.mobileads.AdConfiguration;
 import com.mopub.mobileads.HtmlBannerWebView;
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlInterstitialWebViewFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlInterstitialWebViewFactory.java
index a91efae3..ab8c4490 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlInterstitialWebViewFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HtmlInterstitialWebViewFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import android.content.Context;
+
 import com.mopub.mobileads.AdConfiguration;
 import com.mopub.mobileads.HtmlInterstitialWebView;
 
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HttpClientFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HttpClientFactory.java
index 8a1d5e28..b13cded1 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HttpClientFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/HttpClientFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import org.apache.http.impl.client.DefaultHttpClient;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MoPubViewFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MoPubViewFactory.java
index 4f506621..b24a90f7 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MoPubViewFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MoPubViewFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import android.content.Context;
+
 import com.mopub.mobileads.MoPubView;
 
 public class MoPubViewFactory {
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MraidViewFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MraidViewFactory.java
index c7bc65b5..a139babf 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MraidViewFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/MraidViewFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import android.content.Context;
+
 import com.mopub.mobileads.AdConfiguration;
 import com.mopub.mobileads.MraidView;
 import com.mopub.mobileads.MraidView.NativeCloseButtonStyle;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/VastVideoDownloadTaskFactory.java b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/VastVideoDownloadTaskFactory.java
index a9e9f9d5..c2bd8e68 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/factories/VastVideoDownloadTaskFactory.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/factories/VastVideoDownloadTaskFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
 import com.mopub.mobileads.VastVideoDownloadTask;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/resource/MraidJavascript.java b/mopub-sdk/src/main/java/com/mopub/mobileads/resource/MraidJavascript.java
index 3b128491..94228d44 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/resource/MraidJavascript.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/resource/MraidJavascript.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.resource;
 
 public class MraidJavascript {
@@ -53,6 +21,9 @@
             "  // Establish the root mraidbridge object.\n" +
             "  var mraidbridge = window.mraidbridge = {};\n" +
             "\n" +
+            "  // native SDK is ready to process mraid commands.\n" +
+            "  var nativeSDKFiredReady = false;\n" +
+            "\n" +
             "  // Listeners for bridge events.\n" +
             "  var listeners = {};\n" +
             "\n" +
@@ -65,6 +36,7 @@
             "  //////////////////////////////////////////////////////////////////////////////////////////////////\n" +
             "\n" +
             "  mraidbridge.fireReadyEvent = function() {\n" +
+            "    nativeSDKFiredReady = true;\n" +
             "    mraidbridge.fireEvent('ready');\n" +
             "  };\n" +
             "\n" +
@@ -99,6 +71,12 @@
             "  };\n" +
             "\n" +
             "  mraidbridge.executeNativeCall = function(command) {\n" +
+            "    if (!nativeSDKFiredReady) {\n" +
+            "        console.log('rejecting ' + command + ' because mraid is not ready');\n" +
+            "        mraidbridge.fireErrorEvent('mraid is not ready', command);\n" +
+            "        return;\n" +
+            "    }\n" +
+            "\n" +
             "    var call = 'mraid://' + command;\n" +
             "\n" +
             "    var key, value;\n" +
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/Base64.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/Base64.java
index 1943cce4..5a2aebe0 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/Base64.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/Base64.java
@@ -1,38 +1,6 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.util;
 
-import java.io.*;
+import java.io.UnsupportedEncodingException;
 
 /**
  * Utilities for encoding and decoding the Base64 representation of
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/HttpResponses.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/HttpResponses.java
index b5802fd3..3167787d 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/HttpResponses.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/HttpResponses.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.util;
 
 import com.mopub.common.util.ResponseHeader;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/Mraids.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/Mraids.java
index 55ad6d0f..da58d1f5 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/Mraids.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/Mraids.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.util;
 
 import android.content.Context;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/Utils.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/Utils.java
index 6ed1f14e..d96476f4 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/Utils.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/Utils.java
@@ -1,41 +1,10 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.util;
 
 import android.app.Activity;
 import android.content.Context;
 import android.content.Intent;
-import android.util.Log;
+
+import com.mopub.common.logging.MoPubLog;
 
 public class Utils {
     private Utils() {}
@@ -47,7 +16,7 @@ public static boolean executeIntent(Context context, Intent intent, String error
             }
             context.startActivity(intent);
         } catch (Exception e) {
-            Log.d("MoPub", (errorMessage != null)
+            MoPubLog.d((errorMessage != null)
                     ? errorMessage
                     : "Unable to start intent.");
             return false;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/WebViews.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/WebViews.java
index abb33f2d..f368ccd3 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/WebViews.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/WebViews.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.util;
 
 import android.util.Log;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastManager.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastManager.java
index b3fa2bcb..ab6c0dce 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastManager.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastManager.java
@@ -3,16 +3,12 @@
 import android.content.Context;
 import android.view.Display;
 import android.view.WindowManager;
-
 import com.mopub.common.CacheService;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.AsyncTasks;
-import com.mopub.common.util.MoPubLog;
 import com.mopub.mobileads.VastVideoDownloadTask;
 
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Iterator;
-import java.util.List;
+import java.util.*;
 
 import static com.mopub.mobileads.VastVideoDownloadTask.VastVideoDownloadTaskListener;
 import static com.mopub.mobileads.util.vast.VastXmlManagerAggregator.VastXmlManagerAggregatorListener;
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManager.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManager.java
index 86748f05..8b098a7d 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManager.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManager.java
@@ -6,15 +6,11 @@
 import org.xml.sax.InputSource;
 import org.xml.sax.SAXException;
 
-import java.io.IOException;
-import java.io.StringReader;
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.List;
-
 import javax.xml.parsers.DocumentBuilder;
 import javax.xml.parsers.DocumentBuilderFactory;
 import javax.xml.parsers.ParserConfigurationException;
+import java.io.*;
+import java.util.*;
 
 class VastXmlManager {
     private static final String ROOT_TAG = "MPMoVideoXMLDocRoot";
diff --git a/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregator.java b/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregator.java
index 13fd5b14..e9d377ed 100644
--- a/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregator.java
+++ b/mopub-sdk/src/main/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregator.java
@@ -4,7 +4,7 @@
 import android.os.AsyncTask;
 
 import com.mopub.common.HttpClient;
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Strings;
 
 import org.apache.http.HttpEntity;
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/AdapterHelper.java b/mopub-sdk/src/main/java/com/mopub/nativeads/AdapterHelper.java
index ac8de165..6cc0ca94 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/AdapterHelper.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/AdapterHelper.java
@@ -5,18 +5,25 @@
 import android.view.View;
 import android.view.ViewGroup;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
 
 import java.lang.ref.WeakReference;
 
 import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
 
+/**
+ * @deprecated As of release 2.4, use {@link com.mopub.nativeads.MoPubAdAdapter} or
+ * {@link com.mopub.nativeads.MoPubStreamAdPlacer} instead
+ */
+@Deprecated
 public final class AdapterHelper {
     private final WeakReference<Activity> mActivity;
     private final Context mApplicationContext;
     private final int mStart;
     private final int mInterval;
 
+    @Deprecated
     public AdapterHelper(final Context context, final int start, final int interval) throws IllegalArgumentException {
         if (context == null) {
             throw new IllegalArgumentException("Illegal argument: Context was null.");
@@ -34,6 +41,7 @@ public AdapterHelper(final Context context, final int start, final int interval)
         mInterval = interval;
     }
 
+    @Deprecated
     public View getAdView(final View convertView,
             final ViewGroup parent,
             final NativeResponse nativeResponse,
@@ -57,15 +65,18 @@ public View getAdView(final View convertView,
     }
 
     // Total number of content rows + ad rows
+    @Deprecated
     public int shiftedCount(final int originalCount) {
         return originalCount + numberOfAdsThatCouldFitWithContent(originalCount);
     }
 
     // Shifted position of content in the backing list
+    @Deprecated
     public int shiftedPosition(final int position) {
         return position - numberOfAdsSeenUpToPosition(position);
     }
 
+    @Deprecated
     public boolean isAdPosition(final int position) {
         if (position < mStart) {
             return false;
@@ -106,6 +117,7 @@ private int numberOfAdsThatCouldFitWithContent(final int contentRowCount) {
 
     // Testing
     @Deprecated
+    @VisibleForTesting
     void clearActivityContext() {
         mActivity.clear();
     }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/BaseForwardingNativeAd.java b/mopub-sdk/src/main/java/com/mopub/nativeads/BaseForwardingNativeAd.java
index a7acfe06..9f5b58cf 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/BaseForwardingNativeAd.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/BaseForwardingNativeAd.java
@@ -1,16 +1,29 @@
 package com.mopub.nativeads;
 
+import android.content.Context;
+import android.graphics.Bitmap;
 import android.view.View;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 import java.util.HashMap;
 import java.util.HashSet;
+import java.util.List;
 import java.util.Map;
 import java.util.Set;
 
+import static com.mopub.nativeads.CustomEventNative.CustomEventNativeListener;
+import static com.mopub.nativeads.CustomEventNative.ImageListener;
+
 abstract class BaseForwardingNativeAd implements NativeAdInterface {
     private static final int IMPRESSION_MIN_PERCENTAGE_VIEWED = 50;
+
+    static interface NativeEventListener {
+        public void onAdImpressed();
+        public void onAdClicked();
+    }
+    private NativeEventListener mNativeEventListener;
+
     static final double MIN_STAR_RATING = 0;
     static final double MAX_STAR_RATING = 5;
 
@@ -30,6 +43,10 @@
     // Extras
     private final Map<String, Object> mExtras;
 
+    // Event Logistics
+    private boolean mIsOverridingClickTracker;
+    private boolean mIsOverridingImpressionTracker;
+
     BaseForwardingNativeAd() {
         mImpressionMinTimeViewed = 1000;
 
@@ -138,18 +155,45 @@ final public Object getExtra(final String key) {
         return mExtras.get(key);
     }
 
-    @Override
     /**
      * Returns a copy of the extras map, reflecting additional ad content not reflected in any
      * of the above hardcoded setters. This is particularly useful for passing down custom fields
      * with MoPub's direct-sold native ads or from mediated networks that pass back additional
      * fields.
      */
+    @Override
     final public Map<String, Object> getExtras() {
         return new HashMap<String, Object>(mExtras);
     }
 
+    /**
+     * Returns {@code true} if the native ad is using a network impression tracker. If set to
+     * true, the network must expose a callback that calls into
+     * {@link BaseForwardingNativeAd#notifyAdImpressed()} in order for MoPub to fire its impression
+     * tracker at the appropriate time.
+     */
+    @Override
+    final public boolean isOverridingImpressionTracker() {
+        return mIsOverridingImpressionTracker;
+    }
+
+    /**
+     * Returns {@code true} if the native ad is using a network click tracker. If set to true, the
+     * network must expose a callback that calls into
+     * {@link BaseForwardingNativeAd#notifyAdClicked()} in order for MoPub to fire its click tracker
+     * at the appropriate time.
+     */
+    @Override
+    final public boolean isOverridingClickTracker() {
+        return mIsOverridingClickTracker;
+    }
+
     // Setters
+    @Override
+    public final void setNativeEventListener(final NativeEventListener nativeEventListener) {
+        mNativeEventListener = nativeEventListener;
+    }
+
     final void setMainImageUrl(final String mainImageUrl) {
         mMainImageUrl = mainImageUrl;
     }
@@ -199,18 +243,28 @@ final void setImpressionMinTimeViewed(final int impressionMinTimeViewed) {
         }
     }
 
+    final void setOverridingImpressionTracker(final boolean isOverridingImpressionTracker) {
+        mIsOverridingImpressionTracker = isOverridingImpressionTracker;
+    }
+
+    final void setOverridingClickTracker(final boolean isOverridingClickTracker) {
+        mIsOverridingClickTracker = isOverridingClickTracker;
+    }
+
     // Event Handlers
     /**
      * Your base native ad subclass should implement this method if the network requires the developer
-     * to prepare state for recording an impression before a view is rendered to screen.
+     * to prepare state for recording an impression or click before a view is rendered to screen.
+     *
      * This method is optional.
      */
     @Override
-    public void prepareImpression(final View view) { }
+    public void prepare(final View view) { }
 
     /**
      * Your base native ad subclass should implement this method if the network requires the developer
      * to explicitly record an impression of a view rendered to screen.
+     *
      * This method is optional.
      */
     @Override
@@ -219,16 +273,72 @@ public void recordImpression() { }
     /**
      * Your base native ad subclass should implement this method if the network requires the developer
      * to explicitly handle click events of views rendered to screen.
+     *
      * This method is optional.
      */
     @Override
     public void handleClick(final View view) { }
 
+    /**
+     * Your base native ad subclass should implement this method if the network requires the developer
+     * to reset or clear state of the native ad after it goes off screen and before it is rendered
+     * again.
+     *
+     * This method is optional.
+     */
+    @Override
+    public void clear(final View view) { }
+
     /**
      * Your base native ad subclass should implement this method if the network requires the developer
      * to destroy or cleanup their native ad when they are finished with it.
+     *
      * This method is optional.
      */
     @Override
     public void destroy() { }
+
+    // Event Notifiers
+    /**
+     * Notifies the SDK that the ad has been shown. This will cause the SDK to record an impression
+     * for the ad. This is meant for network SDKs that expose their own impression tracking
+     * callbacks, and requires that you call
+     * {@link BaseForwardingNativeAd#setOverridingImpressionTracker} from your implementation of
+     * {@link BaseForwardingNativeAd#prepare}.
+     */
+    protected final void notifyAdImpressed() {
+        mNativeEventListener.onAdImpressed();
+    }
+
+    /**
+     * Notifies the SDK that the user has clicked the ad. This will cause the SDK to record an
+     * click for the ad. This is meant for network SDKs that expose their own click
+     * tracking callbacks, and requires that you call
+     * {@link BaseForwardingNativeAd#setOverridingClickTracker} from your implementation of
+     * {@link BaseForwardingNativeAd#prepare}.
+     */
+    protected final void notifyAdClicked() {
+        mNativeEventListener.onAdClicked();
+    }
+
+    /**
+     * Pre caches the given set of image urls. We recommend using this method to warm the image
+     * cache before calling {@link CustomEventNativeListener#onNativeAdLoaded}. Doing so will
+     * force images to cache before displaying the ad.
+     */
+    static void preCacheImages(final Context context,
+            final List<String> imageUrls,
+            final ImageListener imageListener) {
+        ImageService.get(context, imageUrls, new ImageService.ImageServiceListener() {
+            @Override
+            public void onSuccess(final Map<String, Bitmap> bitmaps) {
+                imageListener.onImagesCached();
+            }
+
+            @Override
+            public void onFail() {
+                imageListener.onImagesFailedToCache(NativeErrorCode.IMAGE_DOWNLOAD_FAILURE);
+            }
+        });
+    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ClientPositioningSource.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ClientPositioningSource.java
new file mode 100644
index 00000000..bcfea7c7
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/ClientPositioningSource.java
@@ -0,0 +1,27 @@
+package com.mopub.nativeads;
+
+import android.os.Handler;
+
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+
+/**
+ * Returns a preset client positioning object.
+ */
+class ClientPositioningSource implements PositioningSource {
+    private Handler mHandler = new Handler();
+    private final MoPubClientPositioning mPositioning;
+
+    ClientPositioningSource(MoPubClientPositioning positioning) {
+        mPositioning = MoPubNativeAdPositioning.clone(positioning);
+    }
+
+    @Override
+    public void loadPositions(final String adUnitId, final PositioningListener listener) {
+        mHandler.post(new Runnable() {
+            @Override
+            public void run() {
+                listener.onLoad(mPositioning);
+            }
+        });
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/Constants.java b/mopub-sdk/src/main/java/com/mopub/nativeads/Constants.java
index 389731aa..ad256b8b 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/Constants.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/Constants.java
@@ -5,4 +5,7 @@
 
     static final String NATIVE_HOST = "ads.mopub.com";
     static final String NATIVE_HANDLER = "/m/ad";
+
+    static final String POSITIONING_HOST = "ads.mopub.com";
+    static final String POSITIONING_HANDLER = "/m/pos";
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNative.java b/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNative.java
index 7df5da09..03397057 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNative.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNative.java
@@ -1,9 +1,7 @@
 package com.mopub.nativeads;
 
 import android.content.Context;
-import android.graphics.Bitmap;
 
-import java.util.List;
 import java.util.Map;
 
 /**
@@ -34,27 +32,6 @@ protected abstract void loadNativeAd(final Context context,
             final Map<String, Object> localExtras,
             final Map<String, String> serverExtras);
 
-    /**
-     * Pre caches the given set of image urls. We recommend using this method to warm the image
-     * cache before calling {@link CustomEventNativeListener#onNativeAdLoaded}. Doing so will
-     * force images to cache before displaying the ad.
-     */
-    final void preCacheImages(final Context context,
-            final List<String> imageUrls,
-            final ImageListener imageListener) {
-        ImageService.get(context, imageUrls, new ImageService.ImageServiceListener() {
-            @Override
-            public void onSuccess(final Map<String, Bitmap> bitmaps) {
-                imageListener.onImagesCached();
-            }
-
-            @Override
-            public void onFail() {
-                imageListener.onImagesFailedToCache(NativeErrorCode.IMAGE_DOWNLOAD_FAILURE);
-            }
-        });
-    }
-
     public interface ImageListener {
         /**
          * Called when images are successfully cached. If you haven't already called
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java b/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java
index 3aab114d..224fa646 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java
@@ -5,7 +5,7 @@
 import com.mopub.common.DownloadResponse;
 import com.mopub.common.HttpResponses;
 import com.mopub.common.util.Json;
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.ResponseHeader;
 import com.mopub.nativeads.factories.CustomEventNativeFactory;
 
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDiskTaskManager.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDiskTaskManager.java
index 2f678f7f..f355fe69 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDiskTaskManager.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDiskTaskManager.java
@@ -1,29 +1,32 @@
 package com.mopub.nativeads;
 
 import android.graphics.Bitmap;
-
 import com.mopub.common.CacheService;
 
-import java.util.List;
+import java.util.*;
 
 import static com.mopub.common.CacheService.DiskLruCacheGetListener;
 
-class ImageDiskTaskManager extends ImageTaskManager {
+class ImageDiskTaskManager extends TaskManager<Bitmap> {
     private final List<String> mUrls;
+    private final int mMaxImageWidth;
 
-    ImageDiskTaskManager(final List<String> urls, final ImageTaskManagerListener imageTaskManagerListener)
+    ImageDiskTaskManager(final List<String> urls,
+            final TaskManagerListener<Bitmap> imageTaskManagerListener,
+            final int maxImageWidth)
             throws IllegalArgumentException {
         super(urls, imageTaskManagerListener);
+        mMaxImageWidth = maxImageWidth;
         mUrls = urls;
     }
 
     @Override
     void execute() {
         if (mUrls.isEmpty()) {
-            mImageTaskManagerListener.onSuccess(mImages);
+            mImageTaskManagerListener.onSuccess(mResults);
         }
 
-        ImageDiskTaskListener imageDiskTaskListener = new ImageDiskTaskListener();
+        ImageDiskTaskListener imageDiskTaskListener = new ImageDiskTaskListener(mMaxImageWidth);
         for (final String url : mUrls) {
             CacheService.getFromDiskCacheAsync(url, imageDiskTaskListener);
         }
@@ -36,6 +39,13 @@ void failAllTasks() {
     }
 
     private class ImageDiskTaskListener implements DiskLruCacheGetListener {
+
+        private final int mTargetWidth;
+
+        ImageDiskTaskListener(final int targetWidth) {
+            mTargetWidth = targetWidth;
+        }
+
         @Override
         public void onComplete(final String key, final byte[] content) {
             if (key == null) {
@@ -44,13 +54,13 @@ public void onComplete(final String key, final byte[] content) {
             } else {
                 Bitmap bitmap = null;
                 if (content != null) {
-                     bitmap = ImageService.byteArrayToBitmap(content);
+                     bitmap = ImageService.byteArrayToBitmap(content, mTargetWidth);
                 }
-                mImages.put(key, bitmap);
+                mResults.put(key, bitmap);
             }
 
             if (mCompletedCount.incrementAndGet() == mSize) {
-                mImageTaskManagerListener.onSuccess(mImages);
+                mImageTaskManagerListener.onSuccess(mResults);
             }
         }
     }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDownloadTaskManager.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDownloadTaskManager.java
index d10574b5..b022aa2f 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDownloadTaskManager.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageDownloadTaskManager.java
@@ -1,12 +1,9 @@
 package com.mopub.nativeads;
 
-import android.graphics.Bitmap;
-
 import com.mopub.common.DownloadResponse;
 import com.mopub.common.DownloadTask;
-import com.mopub.common.HttpResponses;
 import com.mopub.common.util.AsyncTasks;
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 import org.apache.http.HttpStatus;
 import org.apache.http.client.methods.HttpGet;
@@ -17,17 +14,21 @@
 import java.util.Map;
 
 import static com.mopub.common.DownloadTask.DownloadTaskListener;
-
 import static java.util.Map.Entry;
 
-class ImageDownloadTaskManager extends ImageTaskManager {
+class ImageDownloadTaskManager extends TaskManager<DownloadResponse> {
 
     private final Map<HttpUriRequest, DownloadTask> mDownloadTasks;
+    private final int mRequestedWidth;
 
-    ImageDownloadTaskManager(final List<String> urls, final ImageTaskManagerListener imageTaskManagerListener)
+    ImageDownloadTaskManager(final List<String> urls,
+                             final TaskManagerListener<DownloadResponse> imageTaskManagerListener,
+                             final int requestedWidth)
             throws IllegalArgumentException {
         super(urls, imageTaskManagerListener);
 
+        mRequestedWidth = requestedWidth;
+
         final DownloadTaskListener downloadTaskListener = new ImageDownloadTaskListener();
         mDownloadTasks = new HashMap<HttpUriRequest, DownloadTask>(urls.size());
         for (final String url : urls) {
@@ -39,7 +40,7 @@
     @Override
     void execute() {
         if (mDownloadTasks.isEmpty()) {
-            mImageTaskManagerListener.onSuccess(mImages);
+            mImageTaskManagerListener.onSuccess(mResults);
         }
 
         for (final Entry<HttpUriRequest, DownloadTask> entry : mDownloadTasks.entrySet()) {
@@ -74,18 +75,10 @@ public void onComplete(final String url, final DownloadResponse downloadResponse
                 return;
             }
 
-            final Bitmap bitmap = HttpResponses.asBitmap(downloadResponse);
-
-            if (bitmap == null) {
-                MoPubLog.d("Failed to decode bitmap from response for image: " + url);
-                failAllTasks();
-                return;
-            }
-
-            MoPubLog.d("Successfully downloaded image: " + url);
-            mImages.put(url, bitmap);
+            MoPubLog.d("Successfully downloaded image bye array: " + url);
+            mResults.put(url, downloadResponse);
             if (mCompletedCount.incrementAndGet() == mSize) {
-                mImageTaskManagerListener.onSuccess(mImages);
+                mImageTaskManagerListener.onSuccess(mResults);
             }
         }
     }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageService.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageService.java
index 6276a80c..d020becc 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageService.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageService.java
@@ -1,32 +1,60 @@
 package com.mopub.nativeads;
 
+import android.annotation.TargetApi;
 import android.content.Context;
 import android.graphics.Bitmap;
-import android.graphics.BitmapFactory;
+import android.graphics.Point;
+import android.view.Display;
+import android.view.WindowManager;
 
 import com.mopub.common.CacheService;
-import com.mopub.common.util.MoPubLog;
-import com.mopub.common.util.Streams;
+import com.mopub.common.DownloadResponse;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.util.VersionCode;
 
-import java.io.ByteArrayOutputStream;
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 
-import static com.mopub.nativeads.ImageTaskManager.ImageTaskManagerListener;
+import static android.graphics.BitmapFactory.Options;
+import static android.graphics.BitmapFactory.decodeByteArray;
+import static com.mopub.common.util.VersionCode.HONEYCOMB_MR2;
+import static com.mopub.nativeads.TaskManager.TaskManagerListener;
 import static java.util.Map.Entry;
 
 class ImageService {
-    private static int COMPRESSION_QUALITY = 25;
+    private static final int TWO_MEGABYTES = 2097152;
+    private static int sTargetWidth = -1;
 
     interface ImageServiceListener {
         void onSuccess(Map<String, Bitmap> bitmaps);
         void onFail();
     }
 
+    @TargetApi(13)
+    @VisibleForTesting
+    static void initialize(Context context) {
+        if (sTargetWidth == -1) {
+            // Get Display Options
+            WindowManager wm = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);
+            Display display = wm.getDefaultDisplay();
+            Point size = new Point();
+            if (VersionCode.currentApiLevel().isBelow(HONEYCOMB_MR2)) {
+                size.set(display.getWidth(), display.getHeight());
+            } else {
+                display.getSize(size);
+            }
+
+            // Make our images no wider than the skinny side of the display.
+            sTargetWidth = Math.min(size.x, size.y);
+        }
+    }
+
     static void get(final Context context, final List<String> urls, final ImageServiceListener imageServiceListener) {
-        CacheService.initializeCaches(context);
+        initialize(context);
+        CacheService.initialize(context);
         get(urls, imageServiceListener);
     }
 
@@ -43,7 +71,8 @@ static void get(final List<String> urls, final ImageServiceListener imageService
         try {
             imageDiskTaskManager = new ImageDiskTaskManager(
                     urlCacheMisses,
-                    new ImageDiskTaskManagerListener(imageServiceListener, cacheBitmaps)
+                    new ImageDiskTaskManagerListener(imageServiceListener, cacheBitmaps),
+                    sTargetWidth
             );
         } catch (IllegalArgumentException e) {
             MoPubLog.d("Unable to initialize ImageDiskTaskManager", e);
@@ -54,16 +83,15 @@ static void get(final List<String> urls, final ImageServiceListener imageService
         imageDiskTaskManager.execute();
     }
 
-    static void putBitmapsInCache(final Map<String, Bitmap> bitmaps) {
-        for (final Entry<String, Bitmap> entry : bitmaps.entrySet()) {
-            MoPubLog.d("Caching bitmap: " + entry.getKey());
-            putBitmapInCache(entry.getKey(), entry.getValue());
-        }
-    }
+
 
     static void putBitmapInCache(final String key, final Bitmap bitmap) {
-        final byte[] bytes = bitmapToByteArray(bitmap);
-        CacheService.put(key, bytes);
+        CacheService.putToBitmapCache(key, bitmap);
+    }
+
+    static void putDataInCache(final String key, final Bitmap bitmap, final byte[] byteData) {
+        CacheService.putToBitmapCache(key, bitmap);
+        CacheService.putToDiskCacheAsync(key, byteData);
     }
 
     static List<String> getBitmapsFromMemoryCache(final List<String> urls, final Map<String, Bitmap> hits) {
@@ -82,30 +110,10 @@ static void putBitmapInCache(final String key, final Bitmap bitmap) {
     }
 
     static Bitmap getBitmapFromMemoryCache(final String key) {
-        Bitmap bitmap = null;
-        byte[] bytes = CacheService.getFromMemoryCache(key);
-        if (bytes != null) {
-            bitmap = byteArrayToBitmap(bytes);
-        }
-        return bitmap;
-    }
-
-    static Bitmap byteArrayToBitmap(final byte[] bytes) {
-        return BitmapFactory.decodeByteArray(bytes, 0, bytes.length);
-    }
-
-    static byte[] bitmapToByteArray(final Bitmap bitmap) {
-        ByteArrayOutputStream byteArrayOutputStream = null;
-        try {
-            byteArrayOutputStream = new ByteArrayOutputStream();
-            bitmap.compress(Bitmap.CompressFormat.JPEG, COMPRESSION_QUALITY, byteArrayOutputStream);
-            return byteArrayOutputStream.toByteArray();
-        } finally {
-            Streams.closeStream(byteArrayOutputStream);
-        }
+        return CacheService.getFromBitmapCache(key);
     }
 
-    private static class ImageDiskTaskManagerListener implements ImageTaskManagerListener {
+    private static class ImageDiskTaskManagerListener implements TaskManagerListener<Bitmap> {
         final private ImageServiceListener mImageServiceListener;
         final private Map<String, Bitmap> mBitmaps;
 
@@ -135,7 +143,8 @@ public void onSuccess(final Map<String, Bitmap> diskBitmaps) {
                 try {
                     imageDownloadTaskManager = new ImageDownloadTaskManager(
                             urlDiskMisses,
-                            new ImageNetworkTaskManagerListener(mImageServiceListener, mBitmaps)
+                            new ImageDownloadResponseListener(mImageServiceListener, mBitmaps),
+                            sTargetWidth
                     );
                 } catch (IllegalArgumentException e) {
                     MoPubLog.d("Unable to initialize ImageDownloadTaskManager", e);
@@ -153,20 +162,30 @@ public void onFail() {
         }
     }
 
-    private static class ImageNetworkTaskManagerListener implements ImageTaskManagerListener {
+    private static class ImageDownloadResponseListener implements TaskManagerListener<DownloadResponse> {
         private final ImageServiceListener mImageServiceListener;
         private final Map<String, Bitmap> mBitmaps;
 
-        ImageNetworkTaskManagerListener(final ImageServiceListener imageServiceListener,
+        ImageDownloadResponseListener(final ImageServiceListener imageServiceListener,
                 final Map<String, Bitmap> bitmaps) {
             mImageServiceListener = imageServiceListener;
             mBitmaps = bitmaps;
         }
 
         @Override
-        public void onSuccess(final Map<String, Bitmap> images) {
-            putBitmapsInCache(images);
-            mBitmaps.putAll(images);
+        public void onSuccess(final Map<String, DownloadResponse> responses) {
+            for (final Entry<String, DownloadResponse> entry : responses.entrySet()) {
+                final Bitmap bitmap = asBitmap(entry.getValue(), sTargetWidth);
+                final String key = entry.getKey();
+                if (bitmap == null) {
+                    MoPubLog.d("Error decoding image for url: " + entry.getKey());
+                    onFail();
+                    return;
+                }
+
+                putDataInCache(key, bitmap, entry.getValue().getByteArray());
+                mBitmaps.put(key, bitmap);
+            }
             mImageServiceListener.onSuccess(mBitmaps);
         }
 
@@ -176,14 +195,93 @@ public void onFail() {
         }
     }
 
+    public static Bitmap asBitmap(final DownloadResponse downloadResponse, final int requestedWidth) {
+        if (downloadResponse == null) {
+            return null;
+        }
+
+        final byte[] bytes = downloadResponse.getByteArray();
+        return byteArrayToBitmap(bytes, requestedWidth);
+    }
+
+    public static Bitmap byteArrayToBitmap(final byte[] bytes, final int requestedWidth) {
+        if (requestedWidth <= 0) {
+            return null;
+        }
+
+        Options options = new Options();
+        options.inJustDecodeBounds = true;
+        decodeByteArray(bytes, 0, bytes.length, options);
+        options.inSampleSize = calculateInSampleSize(options.outWidth, requestedWidth);
+
+        // If the bitmap will be very large, downsample more to avoid blowing up the heap.
+        while (getMemBytes(options) > TWO_MEGABYTES) {
+            options.inSampleSize *= 2;
+        }
+
+        options.inJustDecodeBounds = false;
+        Bitmap bitmap = decodeByteArray(bytes, 0, bytes.length, options);
+        if (bitmap == null) {
+            return null;
+        }
+
+        final int subsampleWidth = bitmap.getWidth();
+
+        // If needed, scale the bitmap so it's exactly the requested width.
+        if (subsampleWidth > requestedWidth) {
+            final int requestedHeight = (int)(bitmap.getHeight() * (double) requestedWidth / bitmap.getWidth());
+            Bitmap subsampledBitmap = bitmap;
+            bitmap = Bitmap.createScaledBitmap(subsampledBitmap, requestedWidth, requestedHeight, true);
+            subsampledBitmap.recycle();
+        }
+        
+        return bitmap;
+    }
+
+    /**
+     * Returns the size of the byte array that the bitmap described by the options object will consume.
+     */
+    public static long getMemBytes(Options options) {
+        long memBytes = 4 * (long) options.outWidth * (long) options.outHeight / options.inSampleSize / options.inSampleSize;
+        return memBytes;
+    }
+
+    /**
+     * Calculate the largest inSampleSize value that is a power of 2 and keeps the
+     * width greater than or equal to the requested width.
+     */
+    public static int calculateInSampleSize(final int nativeWidth, int requestedWidth) {
+        int inSampleSize = 1;
+
+        if (nativeWidth > requestedWidth) {
+            final int halfWidth = nativeWidth / 2;
+
+            while ((halfWidth / inSampleSize) >= requestedWidth) {
+                inSampleSize *= 2;
+            }
+        }
+
+        return inSampleSize;
+    }
+
     // Testing, also performs disk IO
     @Deprecated
     static Bitmap getBitmapFromDiskCache(final String key) {
         Bitmap bitmap = null;
         byte[] bytes = CacheService.getFromDiskCache(key);
         if (bytes != null) {
-            bitmap = byteArrayToBitmap(bytes);
+            bitmap = byteArrayToBitmap(bytes, sTargetWidth);
         }
         return bitmap;
     }
+
+    @VisibleForTesting
+    static void clear() {
+        sTargetWidth = -1;
+    }
+
+    @VisibleForTesting
+    static int getTargetWidth() {
+        return sTargetWidth;
+    }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageViewService.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageViewService.java
index 924cd626..ef337e0c 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageViewService.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/ImageViewService.java
@@ -1,26 +1,30 @@
 package com.mopub.nativeads;
 
 import android.graphics.Bitmap;
-import android.view.View;
 import android.widget.ImageView;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Utils;
 
 import java.lang.ref.WeakReference;
 import java.util.Arrays;
 import java.util.Map;
+import java.util.WeakHashMap;
 
 import static com.mopub.nativeads.ImageService.ImageServiceListener;
 
 class ImageViewService {
-    // random large number so we hopefully don't collide with something a pub is using
-    private static final int VIEW_TAG_MOPUB_KEY = 817491827;
+    // This is used instead of View.setTag, which causes a memory leak in 2.3
+    // and earlier: https://code.google.com/p/android/issues/detail?id=18273
+    private static final WeakHashMap<ImageView, Long> sImageViewRequestIds =
+            new WeakHashMap<ImageView, Long>();
 
     private ImageViewService(){}
 
     static void loadImageView(final String url, final ImageView imageView) {
         if (imageView == null) {
+            MoPubLog.d("Attempted to load an image into a null ImageView");
             return;
         }
 
@@ -29,8 +33,8 @@ static void loadImageView(final String url, final ImageView imageView) {
 
         if (url != null) {
             // Unique id to identify this async image request
-            setImageViewUniqueId(imageView);
-            long uniqueId = getImageViewUniqueId(imageView);
+            long uniqueId = Utils.generateUniqueId();
+            sImageViewRequestIds.put(imageView, uniqueId);
 
             // Async call to get image from memory cache, disk and then network
             ImageService.get(
@@ -57,7 +61,7 @@ public void onSuccess(final Map<String, Bitmap> bitmaps) {
             if (imageView == null || bitmaps == null || !bitmaps.containsKey(mUrl)) {
                 return;
             }
-            final Long uniqueId = getImageViewUniqueId(imageView);
+            final Long uniqueId = sImageViewRequestIds.get(imageView);
             if (uniqueId != null && mUniqueId == uniqueId) {
                 imageView.setImageBitmap(bitmaps.get(mUrl));
             }
@@ -69,27 +73,15 @@ public void onFail() {
         }
     }
 
-    static void setImageViewUniqueId(final ImageView imageView) {
-        if (imageView != null) {
-            setViewTag(imageView, Utils.generateUniqueId());
-        }
-    }
-
+    @VisibleForTesting
+    @Deprecated
     static Long getImageViewUniqueId(final ImageView imageView) {
-        if (imageView != null) {
-            Object object = getViewTag(imageView);
-            if (object instanceof Long) {
-                return (Long) object;
-            }
-        }
-        return null;
-    }
-
-    static void setViewTag(final View view, final Object object) {
-        view.setTag(VIEW_TAG_MOPUB_KEY, object);
+        return sImageViewRequestIds.get(imageView);
     }
 
-    static Object getViewTag(final View view) {
-        return view.getTag(VIEW_TAG_MOPUB_KEY);
+    @VisibleForTesting
+    @Deprecated
+    static void setImageViewUniqueId(final ImageView imageView, final long uniqueId) {
+        sImageViewRequestIds.put(imageView, uniqueId);
     }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ImpressionTracker.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ImpressionTracker.java
new file mode 100644
index 00000000..35508618
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/ImpressionTracker.java
@@ -0,0 +1,197 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+import android.os.Handler;
+import android.view.View;
+
+import com.mopub.common.VisibleForTesting;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+import java.util.WeakHashMap;
+
+import static com.mopub.nativeads.VisibilityTracker.VisibilityChecker;
+import static com.mopub.nativeads.VisibilityTracker.VisibilityTrackerListener;
+
+class ImpressionTracker {
+
+    private static final int PERIOD = 250;
+
+    // Object tracking visibility of added views
+    private final VisibilityTracker mVisibilityTracker;
+
+    // All views and responses being tracked for impressions
+    private final Map<View, NativeResponse> mTrackedViews;
+
+    // Visible views being polled for time on screen before tracking impression
+    private final Map<View, TimestampWrapper<NativeResponse>> mPollingViews;
+
+    // Handler for polling visible views
+    private final Handler mPollHandler;
+
+    // Runnable to run on each visibility loop
+    private final PollingRunnable mPollingRunnable;
+
+    // Object to check actual visibility
+    private final VisibilityChecker mVisibilityChecker;
+
+    // Listener for when a view becomes visible or non visible
+    private VisibilityTrackerListener mVisibilityTrackerListener;
+
+    ImpressionTracker(final Context context) {
+        this(new WeakHashMap<View, NativeResponse>(),
+                new WeakHashMap<View, TimestampWrapper<NativeResponse>>(),
+                new VisibilityChecker(),
+                new VisibilityTracker(context),
+                new Handler());
+    }
+
+    @VisibleForTesting
+    ImpressionTracker(final Map<View, NativeResponse> trackedViews,
+                      final Map<View, TimestampWrapper<NativeResponse>> pollingViews,
+                      final VisibilityChecker visibilityChecker,
+                      final VisibilityTracker visibilityTracker,
+                      final Handler handler) {
+        mTrackedViews = trackedViews;
+        mPollingViews = pollingViews;
+        mVisibilityChecker = visibilityChecker;
+        mVisibilityTracker = visibilityTracker;
+
+        mVisibilityTrackerListener = new VisibilityTrackerListener() {
+            @Override
+            public void onVisibilityChanged(final List<View> visibleViews, final List<View> invisibleViews) {
+                for (final View view : visibleViews) {
+                    // It's possible for native response to be null if the view was GC'd from this class
+                    // but not from VisibilityTracker
+                    // If it's null then clean up the view from this class
+                    final NativeResponse nativeResponse = mTrackedViews.get(view);
+                    if (nativeResponse == null) {
+                        removeView(view);
+                        continue;
+                    }
+
+                    // If the native response is already polling, don't recreate it
+                    final TimestampWrapper<NativeResponse> polling = mPollingViews.get(view);
+                    if (polling != null && nativeResponse.equals(polling.mInstance)) {
+                        continue;
+                    }
+
+                    // Add a new polling view
+                    mPollingViews.put(view, new TimestampWrapper<NativeResponse>(nativeResponse));
+                }
+
+                for (final View view : invisibleViews) {
+                    mPollingViews.remove(view);
+                }
+                scheduleNextPoll();
+            }
+        };
+        mVisibilityTracker.setVisibilityTrackerListener(mVisibilityTrackerListener);
+
+        mPollHandler = handler;
+        mPollingRunnable = new PollingRunnable();
+    }
+
+    /**
+     * Tracks the given view for impressions.
+     */
+    void addView(final View view, final NativeResponse nativeResponse) {
+        // View is already associated with same native response
+        if (mTrackedViews.get(view) == nativeResponse) {
+            return;
+        }
+
+        // Clean up state if view is being recycled and associated with a different response
+        removeView(view);
+
+        if (nativeResponse.getRecordedImpression() || nativeResponse.isDestroyed()) {
+            return;
+        }
+
+        mTrackedViews.put(view, nativeResponse);
+        mVisibilityTracker.addView(view, nativeResponse.getImpressionMinPercentageViewed());
+    }
+
+    void removeView(final View view) {
+        mTrackedViews.remove(view);
+        removePollingView(view);
+        mVisibilityTracker.removeView(view);
+    }
+
+    /**
+     * Immediately clear all views. Useful for when we re-request ads for an ad placer
+     */
+    void clear() {
+        mTrackedViews.clear();
+        mPollingViews.clear();
+        mVisibilityTracker.clear();
+        mPollHandler.removeMessages(0);
+    }
+
+    void destroy() {
+        clear();
+        mVisibilityTracker.destroy();
+        mVisibilityTrackerListener = null;
+    }
+
+    @VisibleForTesting
+    void scheduleNextPoll() {
+        // Only schedule if there are no messages already scheduled.
+        if (mPollHandler.hasMessages(0)) {
+            return;
+        }
+
+        mPollHandler.postDelayed(mPollingRunnable, PERIOD);
+    }
+
+    private void removePollingView(final View view) {
+        mPollingViews.remove(view);
+    }
+
+    @VisibleForTesting
+    class PollingRunnable implements Runnable {
+        // Create this once to avoid excessive garbage collection observed when calculating
+        // these on each pass.
+        private final ArrayList<View> mRemovedViews;
+
+        PollingRunnable() {
+            mRemovedViews = new ArrayList<View>();
+        }
+
+        @Override
+        public void run() {
+            for (final Map.Entry<View, TimestampWrapper<NativeResponse>> entry : mPollingViews.entrySet()) {
+                final View view = entry.getKey();
+                final TimestampWrapper<NativeResponse> timestampWrapper = entry.getValue();
+
+                // If it's been visible for the min impression time, trigger the callback
+                if (!mVisibilityChecker.hasRequiredTimeElapsed(
+                        timestampWrapper.mCreatedTimestamp,
+                        timestampWrapper.mInstance.getImpressionMinTimeViewed())) {
+                    continue;
+                }
+
+                timestampWrapper.mInstance.recordImpression(view);
+
+                // Removed in a separate loop to avoid a ConcurrentModification exception.
+                mRemovedViews.add(view);
+            }
+
+            for (View view : mRemovedViews) {
+              removeView(view);
+            }
+            mRemovedViews.clear();
+
+            if (!mPollingViews.isEmpty()) {
+                scheduleNextPoll();
+            }
+        }
+    }
+
+    @Deprecated
+    @VisibleForTesting
+    VisibilityTrackerListener getVisibilityTrackerListener() {
+        return mVisibilityTrackerListener;
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ImpressionTrackingManager.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ImpressionTrackingManager.java
deleted file mode 100644
index fda539a5..00000000
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/ImpressionTrackingManager.java
+++ /dev/null
@@ -1,286 +0,0 @@
-package com.mopub.nativeads;
-
-import android.graphics.Rect;
-import android.os.Handler;
-import android.os.SystemClock;
-import android.view.View;
-import android.view.ViewTreeObserver;
-
-import java.lang.ref.WeakReference;
-import java.util.ArrayList;
-import java.util.List;
-import java.util.Map;
-import java.util.WeakHashMap;
-
-import static android.view.ViewTreeObserver.OnPreDrawListener;
-
-/**
- * Tracks views to determine when they've been viewable by the user, where viewability is defined as
- * having been at least X% on the screen for a continuous Y seconds. These values are set by the
- */
-final class ImpressionTrackingManager {
-    private ImpressionTrackingManager(){}
-
-    private static final int PERIOD = 250;
-
-    // Visible views currently polling to become viewable, subset of tracked views.
-    private static final WeakHashMap<View, OnPreDrawListener> sWaitingViews =
-            new WeakHashMap<View, OnPreDrawListener>(10);
-
-    // Views waiting to become visible, subset of tracked views
-    private static final WeakHashMap<View, NativeResponseWrapper> sPollingViews =
-            new WeakHashMap<View, NativeResponseWrapper>(10);
-
-    // Handler to delay starting tracking until the next render loop
-    private static final Handler startHandler = new Handler();
-
-    // Handler for polling visible views
-    private static final Handler pollHandler = new Handler();
-
-    // Runnable to run on each visibility loop
-    private static final PollingRunnable pollingRunnable = new PollingRunnable();
-
-    // Object to check actual visibility
-    private static final VisibilityChecker visibilityChecker = new VisibilityChecker();
-
-    /**
-     * Tracks the given view for visibility.
-     * <p/>
-     * If the view is already being tracked this does nothing. To restart tracking you should call
-     * stopTracking first.
-     * <p/>
-     * It is the caller's responsibility to avoid tracking views for ads that have already registered
-     * an impression.
-     */
-    static void addView(final View view, final NativeResponse nativeResponse) {
-        // Ignore if already being tracked.
-        if (view == null || nativeResponse == null || isViewTracked(view)) {
-            return;
-        }
-
-        // Posting the handler gives the view another render loop before checking visibility. Useful
-        // because ListView likes to reparent a views after calling getView.
-        final WeakReference<View> viewReference = new WeakReference<View>(view);
-        startHandler.post(new Runnable() {
-            @Override
-            public void run() {
-                final View view = viewReference.get();
-                // Might have been untracked or GC'd
-                if (view == null) {
-                    return;
-                }
-
-                // Important to test viewability instead of just waiting
-                if (visibilityChecker.isMostlyVisible(view,
-                        nativeResponse.getImpressionMinPercentageViewed())) {
-                    pollVisibleView(view, nativeResponse);
-                } else {
-                    waitForVisibility(view, nativeResponse);
-                }
-            }
-        });
-    }
-
-    static boolean isViewTracked(final View view) {
-        return sPollingViews.containsKey(view) || sWaitingViews.containsKey(view);
-    }
-
-    static void waitForVisibility(final View view, final NativeResponse nativeResponse) {
-        // Remove from the polling list
-        removePollingView(view);
-
-        // Track draw events on this view to see when it becomes visible
-        final WeakReference<View> viewReference = new WeakReference<View>(view);
-        OnPreDrawListener preDrawListener = new OnPreDrawListener() {
-            @Override
-            public boolean onPreDraw() {
-                final View view = viewReference.get();
-                if (view == null) {
-                    return true;
-                }
-
-                if (visibilityChecker.isMostlyVisible(view,
-                        nativeResponse.getImpressionMinPercentageViewed())) {
-                    pollVisibleView(view, nativeResponse);
-                }
-                return true;
-            }
-        };
-
-        final ViewTreeObserver viewTreeObserver = view.getViewTreeObserver();
-        if (viewTreeObserver.isAlive()) {
-            viewTreeObserver.addOnPreDrawListener(preDrawListener);
-            sWaitingViews.put(view, preDrawListener);
-        }
-    }
-
-    static void pollVisibleView(final View view, final NativeResponse nativeResponse) {
-        // Remove from waiting and add to polling
-        removeWaitingView(view);
-        sPollingViews.put(view, new NativeResponseWrapper(nativeResponse));
-
-        // Make sure we're polling
-        scheduleNextPoll();
-    }
-
-    static void scheduleNextPoll() {
-        // Only schedule if there are no messages already scheduled.
-        if (pollHandler.hasMessages(0)) {
-            return;
-        }
-
-        pollHandler.postDelayed(pollingRunnable, PERIOD);
-    }
-
-    static void removeWaitingView(final View view) {
-        final OnPreDrawListener listener = sWaitingViews.remove(view);
-        if (listener != null) {
-            final ViewTreeObserver viewTreeObserver = view.getViewTreeObserver();
-            if (viewTreeObserver.isAlive()) {
-                viewTreeObserver.removeOnPreDrawListener(listener);
-            }
-        }
-    }
-
-    static void removePollingView(View view) {
-        sPollingViews.remove(view);
-    }
-
-    /**
-     * Stops tracking a view, cleaning any pending tracking
-     */
-    static void removeView(View view) {
-        removeWaitingView(view);
-        removePollingView(view);
-    }
-
-    /**
-     * Immediately clear all views. Useful for when we re-request ads for an ad placer
-     */
-    static void clearTracking() {
-        // Stop waiting. Copy so that we can modify the map during iteration.
-        final List<View> views = new ArrayList<View>(sWaitingViews.keySet());
-        for (final View view : views) {
-            removeWaitingView(view);
-        }
-
-        // Clear and stop the polling
-        sPollingViews.clear();
-        pollHandler.removeMessages(0);
-
-        // Stop any views being currently added to tracking
-        startHandler.removeMessages(0);
-    }
-
-    static class PollingRunnable implements Runnable {
-
-        @Override
-        public void run() {
-            final ArrayList<View> views = new ArrayList<View>(sPollingViews.keySet());
-            for (final View view : views) {
-                final NativeResponseWrapper nativeResponseWrapper = sPollingViews.get(view);
-
-                if (nativeResponseWrapper == null
-                        || nativeResponseWrapper.mNativeResponse == null
-                        || nativeResponseWrapper.mNativeResponse.getRecordedImpression()
-                        || nativeResponseWrapper.mNativeResponse.isDestroyed()) {
-                    removeView(view);
-                    continue;
-                }
-
-                // If no longer visible, go back to a waiting state
-                if (!visibilityChecker.isMostlyVisible(view,
-                        nativeResponseWrapper.mNativeResponse.getImpressionMinPercentageViewed())) {
-                    // Also removes from the visible list
-                    waitForVisibility(view, nativeResponseWrapper.mNativeResponse);
-                    continue;
-                }
-
-                // If it's been visible for a Y seconds, trigger the callback
-                if (!visibilityChecker.hasRequiredTimeElapsed(
-                        nativeResponseWrapper.mFirstVisibleTimestamp,
-                        nativeResponseWrapper.mNativeResponse.getImpressionMinTimeViewed())) {
-                    continue;
-                }
-
-                nativeResponseWrapper.mNativeResponse.recordImpression(view);
-                removeView(view);
-            }
-
-            if (!sPollingViews.isEmpty()) {
-                scheduleNextPoll();
-            }
-        }
-    }
-
-    // Visible for testing.
-    static class VisibilityChecker {
-
-        /**
-         * Whether the visible time has elapsed from the start time. Easily mocked for testing.
-         */
-        static boolean hasRequiredTimeElapsed(final long startTimeMillis,
-                final int impressionMinTimeViewed) {
-            return SystemClock.uptimeMillis() - startTimeMillis >= impressionMinTimeViewed;
-        }
-
-        /**
-         * Whether the view is at least certain % visible
-         */
-        static boolean isMostlyVisible(final View view, final int impressionMinPercentageViewed) {
-            /*
-             * ListView & GridView both call detachFromParent() for views that can be recycled for
-             * new data. This is one of the rare instances where a view will have a null parent for
-             * an extended period of time and will not be the main window.
-             *
-             * view.getGlobalVisibleRect() doesn't check that case, so if the view has visibility
-             * of View.VISIBLE but has no parent it is likely in the recycle bin of a
-             * ListView / GridView and not on screen.
-             */
-            if (view == null || view.getVisibility() != View.VISIBLE || view.getParent() == null) {
-                return false;
-            }
-
-            final Rect clipRect = new Rect();
-            if (!view.getGlobalVisibleRect(clipRect)) {
-                // Not visible
-                return false;
-            }
-
-            // % visible check - the cast is to avoid int overflow for large views.
-            final long visibleViewArea = (long) clipRect.height() * clipRect.width();
-            final long totalViewArea = (long) view.getHeight() * view.getWidth();
-
-            if (totalViewArea <= 0) {
-                return false;
-            }
-
-            return 100 * visibleViewArea >= impressionMinPercentageViewed * totalViewArea;
-        }
-    }
-
-    static class NativeResponseWrapper {
-        final NativeResponse mNativeResponse;
-        long mFirstVisibleTimestamp;
-
-        NativeResponseWrapper(final NativeResponse nativeResponse) {
-            mNativeResponse = nativeResponse;
-            mFirstVisibleTimestamp = SystemClock.uptimeMillis();
-        }
-    }
-
-    @Deprecated // for testing
-    static Map<View, OnPreDrawListener> getWaitingViews() {
-        return sWaitingViews;
-    }
-
-    @Deprecated // for testing
-    static Map<View, NativeResponseWrapper> getPollingViews() {
-        return sPollingViews;
-    }
-
-    @Deprecated // for testing
-    static Handler getStartHandler() {
-        return startHandler;
-    }
-}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubAdAdapter.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubAdAdapter.java
new file mode 100644
index 00000000..ddd2aac8
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubAdAdapter.java
@@ -0,0 +1,603 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+import android.database.DataSetObserver;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.Adapter;
+import android.widget.AdapterView;
+import android.widget.BaseAdapter;
+import android.widget.ListAdapter;
+import android.widget.ListView;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubServerPositioning;
+
+import java.util.*;
+
+import static android.widget.AdapterView.OnItemClickListener;
+import static android.widget.AdapterView.OnItemLongClickListener;
+import static android.widget.AdapterView.OnItemSelectedListener;
+import static com.mopub.nativeads.VisibilityTracker.VisibilityTrackerListener;
+
+/**
+ * {@code MoPubAdAdapter} facilitates placing ads into an Android {@link android.widget.ListView} or
+ * other widgets that use a {@link android.widget.ListAdapter}.
+ *
+ * For your content items, this class will call your original adapter with the original position of
+ * content before ads were loaded.
+ *
+ * This adapter uses a {@link com.mopub.nativeads.MoPubStreamAdPlacer} object internally. If you
+ * wish to avoid wrapping your original adapter, you can use {@code MoPubStreamAdPlacer} directly.
+ */
+public class MoPubAdAdapter extends BaseAdapter {
+    private final WeakHashMap<View, Integer> mViewPositionMap;
+    private final Adapter mOriginalAdapter;
+    private final MoPubStreamAdPlacer mStreamAdPlacer;
+    private final VisibilityTracker mVisibilityTracker;
+
+    private MoPubNativeAdLoadedListener mAdLoadedListener;
+
+    /**
+     * Creates a new MoPubAdAdapter object.
+     *
+     * By default, the adapter will contact the server to determine ad positions. If you
+     * wish to hard-code positions in your app, see {@link MoPubAdAdapter(Context,
+     * MoPubClientPositioning)}.
+     *
+     * @param context The activity context.
+     * @param originalAdapter Your original adapter.
+     */
+    public MoPubAdAdapter(final Context context, final Adapter originalAdapter) {
+        this(context, originalAdapter, MoPubNativeAdPositioning.serverPositioning());
+    }
+
+    /**
+     * Creates a new MoPubAdAdapter object, using server positioning.
+     *
+     * @param context The activity context.
+     * @param originalAdapter Your original adapter.
+     * @param adPositioning A positioning object for specifying where ads will be placed in your
+     * stream. See {@link MoPubNativeAdPositioning#serverPositioning()}.
+     */
+    public MoPubAdAdapter(final Context context,
+            final Adapter originalAdapter,
+            final MoPubServerPositioning adPositioning) {
+        this(new MoPubStreamAdPlacer(context, adPositioning), originalAdapter,
+                new VisibilityTracker(context));
+    }
+
+    /**
+     * Creates a new MoPubAdAdapter object, using client positioning.
+     *
+     * @param context The activity context.
+     * @param originalAdapter Your original adapter.
+     * @param adPositioning A positioning object for specifying where ads will be placed in your
+     * stream. See {@link MoPubNativeAdPositioning#clientPositioning()}.
+     */
+    public MoPubAdAdapter(final Context context,
+            final Adapter originalAdapter,
+            final MoPubClientPositioning adPositioning) {
+        this(new MoPubStreamAdPlacer(context, adPositioning), originalAdapter,
+                new VisibilityTracker(context));
+    }
+
+    @VisibleForTesting
+    MoPubAdAdapter(final MoPubStreamAdPlacer streamAdPlacer,
+            final Adapter originalAdapter,
+            final VisibilityTracker visibilityTracker) {
+        mOriginalAdapter = originalAdapter;
+        mStreamAdPlacer = streamAdPlacer;
+        mViewPositionMap = new WeakHashMap<View, Integer>();
+
+        mVisibilityTracker = visibilityTracker;
+        mVisibilityTracker.setVisibilityTrackerListener(new VisibilityTrackerListener() {
+            @Override
+            public void onVisibilityChanged(final List<View> visibleViews,
+                    final List<View> invisibleViews) {
+                handleVisibilityChange(visibleViews);
+            }
+        });
+        mOriginalAdapter.registerDataSetObserver(new DataSetObserver() {
+            @Override
+            public void onChanged() {
+                mStreamAdPlacer.setItemCount(mOriginalAdapter.getCount());
+                notifyDataSetChanged();
+            }
+
+            @Override
+            public void onInvalidated() {
+                notifyDataSetInvalidated();
+            }
+        });
+
+        mStreamAdPlacer.setAdLoadedListener(new MoPubNativeAdLoadedListener() {
+            @Override
+            public void onAdLoaded(final int position) {
+                handleAdLoaded(position);
+            }
+
+            @Override
+            public void onAdRemoved(final int position) {
+                handleAdRemoved(position);
+            }
+
+        });
+
+        mStreamAdPlacer.setItemCount(mOriginalAdapter.getCount());
+    }
+
+    @VisibleForTesting
+    void handleAdLoaded(final int position) {
+        if (mAdLoadedListener != null) {
+            mAdLoadedListener.onAdLoaded(position);
+        }
+        notifyDataSetChanged();
+    }
+
+    @VisibleForTesting
+    void handleAdRemoved(final int position) {
+        if (mAdLoadedListener != null) {
+            mAdLoadedListener.onAdRemoved(position);
+        }
+        notifyDataSetChanged();
+    }
+
+    /**
+     * Registers a {@link MoPubNativeAdRenderer} to use when displaying ads in your stream.
+     *
+     * This renderer will automatically create and render your view when you call {@link #getView}.
+     * If you register a second renderer, it will replace the first, although this behavior is
+     * subject to change in a future SDK version.
+     *
+     * @param adRenderer The ad renderer.
+     */
+    public final void registerAdRenderer(final MoPubAdRenderer adRenderer) {
+        if (adRenderer == null) {
+            MoPubLog.w("Tried to set a null ad renderer on the placer.");
+            return;
+        }
+        mStreamAdPlacer.registerAdRenderer(adRenderer);
+    }
+
+    /**
+     * Sets a listener that will be called after the SDK loads new ads from the server and places
+     * them into your stream.
+     *
+     * The listener will be active between when you call {@link #loadAds} and when you call {@link
+     * #destroy()}. You can also set the listener to {@code null} to remove the listener.
+     *
+     * Note that there is not a one to one correspondence between calls to {@link #loadAds} and this
+     * listener. The SDK will call the listener every time an ad loads.
+     *
+     * @param listener The listener.
+     */
+    public final void setAdLoadedListener(final MoPubNativeAdLoadedListener listener) {
+        mAdLoadedListener = listener;
+    }
+
+    /**
+     * Start loading ads from the MoPub server.
+     *
+     * We recommend using {@link #loadAds(String, RequestParameters)} instead of this method, in
+     * order to pass targeting information to the server.
+     *
+     * @param adUnitId The ad unit ID to use when loading ads.
+     */
+    public void loadAds(final String adUnitId) {
+        mStreamAdPlacer.loadAds(adUnitId);
+    }
+
+    /**
+     * Start loading ads from the MoPub server, using the given request targeting information.
+     *
+     * When loading ads, {@link MoPubNativeAdLoadedListener#onAdLoaded(int)} will be called for each
+     * ad that is added to the stream.
+     *
+     * To refresh ads in your stream, call {@link #refreshAds(ListView, String)}. When new ads load,
+     * they will replace the current ads in your stream. If you are using {@code
+     * MoPubNativeAdLoadedListener} you will see a call to {@code onAdRemoved} for each of the old
+     * ads, followed by a calls to {@code onAdLoaded}.
+     *
+     * @param adUnitId The ad unit ID to use when loading ads.
+     * @param requestParameters Targeting information to pass to the ad server.
+     */
+    public void loadAds(final String adUnitId,
+            final RequestParameters requestParameters) {
+        mStreamAdPlacer.loadAds(adUnitId, requestParameters);
+    }
+
+    /**
+     * Whether the given position is an ad.
+     *
+     * This will return {@code true} only if there is an ad loaded for this position. You can also
+     * listen for ads to load using {@link MoPubNativeAdLoadedListener#onAdLoaded(int)}.
+     *
+     * @param position The position to check for an ad, expressed in terms of the position in the
+     * stream including ads.
+     * @return Whether there is an ad at the given position.
+     */
+    public boolean isAd(final int position) {
+        return mStreamAdPlacer.isAd(position);
+    }
+
+    /**
+     * Stops loading ads, immediately clearing any ads currently in the stream.
+     *
+     * This method also stops ads from loading as the user moves through the stream. If you want to
+     * refresh ads, call {@link #refreshAds(ListView, String, RequestParameters)} instead of this
+     * method.
+     *
+     * When ads are cleared, {@link MoPubNativeAdLoadedListener#onAdRemoved} will be called for each
+     * ad that is removed from the stream.
+     */
+    public void clearAds() {
+        mStreamAdPlacer.clearAds();
+    }
+
+    /**
+     * Destroys the ad adapter, preventing it from future use.
+     *
+     * You must call this method before the hosting activity for this class is destroyed in order to
+     * avoid a memory leak. Typically you should destroy the adapter in the life-cycle method that
+     * is counterpoint to the method you used to create the adapter. For example, if you created the
+     * adapter in {@code Fragment#onCreateView} you should destroy it in {code
+     * Fragment#onDestroyView}.
+     */
+    public void destroy() {
+        mStreamAdPlacer.destroy();
+        mVisibilityTracker.destroy();
+    }
+
+    @Override
+    public boolean areAllItemsEnabled() {
+        return mOriginalAdapter instanceof ListAdapter
+                && ((ListAdapter) mOriginalAdapter).areAllItemsEnabled();
+    }
+
+    @Override
+    public boolean isEnabled(final int position) {
+        return isAd(position) || (mOriginalAdapter instanceof ListAdapter
+                && ((ListAdapter) mOriginalAdapter).isEnabled(mStreamAdPlacer.getOriginalPosition(
+                position)));
+    }
+
+    /**
+     * Returns the number of items in your stream, including ads.
+     *
+     * @return The count of items.
+     * @inheritDoc
+     */
+    @Override
+    public int getCount() {
+        return mStreamAdPlacer.getAdjustedCount(mOriginalAdapter.getCount());
+    }
+
+    /**
+     * For ad items, returns an ad data object. For non ad items, calls you original adapter using
+     * the original item position.
+     *
+     * @inheritDoc
+     */
+    @Override
+    public Object getItem(final int position) {
+        final Object ad = mStreamAdPlacer.getAdData(position);
+        if (ad != null) {
+            return ad;
+        }
+        return mOriginalAdapter.getItem(mStreamAdPlacer.getOriginalPosition(position));
+    }
+
+    /**
+     * For ad items, returns an ID representing the ad. For non ad items, calls your original
+     * adapter using the original item position.
+     *
+     * For ads, this ID will be a negative integer. If you feel that this ID might collide with your
+     * original adapter's IDs, you should return {@code false} from {@code #hasStableIds()}.
+     *
+     * @inheritDoc
+     */
+    @Override
+    public long getItemId(final int position) {
+        final Object adData = mStreamAdPlacer.getAdData(position);
+        if (adData != null) {
+            return ~System.identityHashCode(adData) + 1;
+        }
+        return mOriginalAdapter.getItemId(mStreamAdPlacer.getOriginalPosition(position));
+    }
+
+    /**
+     * Returns the value returned by {@code hasStableIds()} on your original adapter.
+     *
+     * @inheritDoc
+     */
+    @Override
+    public boolean hasStableIds() {
+        return mOriginalAdapter.hasStableIds();
+    }
+
+    /**
+     * For ad items, returns an ad View for the underlying position. For non-ad items, calls your
+     * original adapter using the original ad position.
+     *
+     * @inheritDoc
+     */
+    @Override
+    public View getView(final int position, final View view, final ViewGroup viewGroup) {
+        final View resultView;
+        final View adView = mStreamAdPlacer.getAdView(position, view, viewGroup);
+        if (adView != null) {
+            resultView = adView;
+        } else {
+            resultView = mOriginalAdapter.getView(
+                    mStreamAdPlacer.getOriginalPosition(position), view, viewGroup);
+        }
+        mViewPositionMap.put(resultView, position);
+        mVisibilityTracker.addView(resultView, 0);
+
+        return resultView;
+    }
+
+    /**
+     * For ad items, returns a number greater than or equal to the view type count for your
+     * underlying adapter. For non-ad items, calls your original adapter using the original ad
+     * position.
+     *
+     * @inheritDoc
+     */
+    @Override
+    public int getItemViewType(final int position) {
+        final int viewType = mStreamAdPlacer.getAdViewType(position);
+        if (viewType != MoPubStreamAdPlacer.CONTENT_VIEW_TYPE) {
+            return viewType + mOriginalAdapter.getViewTypeCount() - 1;
+        }
+        return mOriginalAdapter.getItemViewType(mStreamAdPlacer.getOriginalPosition(position));
+    }
+
+    /**
+     * Returns the view type count of your original adapter, plus the the number of possible view
+     * types for ads. The number of possible ad view types is currently 1, but this is subject to
+     * change in future SDK versions.
+     *
+     * @inheritDoc
+     */
+    @Override
+    public int getViewTypeCount() {
+        return mOriginalAdapter.getViewTypeCount() + mStreamAdPlacer.getAdViewTypeCount();
+    }
+
+    /**
+     * Returns whether the adapter is empty, calling through to your original adapter.
+     *
+     * @inheritDoc
+     */
+    @Override
+    public boolean isEmpty() {
+        return mOriginalAdapter.isEmpty() && mStreamAdPlacer.getAdjustedCount(0) == 0;
+    }
+
+    private void handleVisibilityChange(final List<View> visibleViews) {
+        // Loop through all visible positions in order to build a max and min range, and then
+        // place ads into that range.
+        int min = Integer.MAX_VALUE;
+        int max = 0;
+        for (final View view : visibleViews) {
+            final Integer pos = mViewPositionMap.get(view);
+            if (pos == null) {
+                continue;
+            }
+            min = Math.min(pos, min);
+            max = Math.max(pos, max);
+        }
+        mStreamAdPlacer.placeAdsInRange(min, max + 1);
+    }
+
+    /**
+     * Returns the original position of an item considering ads in the stream.
+     *
+     * @see {@link MoPubStreamAdPlacer#getOriginalPosition(int)}
+     * @param position The adjusted position.
+     * @return The original position before placing ads.
+     */
+    public int getOriginalPosition(final int position) {
+        return mStreamAdPlacer.getOriginalPosition(position);
+    }
+
+    /**
+     * Returns the position of an item considering ads in the stream.
+     *
+     * @see {@link MoPubStreamAdPlacer#getAdjustedPosition(int)}
+     * @param originalPosition The original position.
+     * @return The position adjusted by placing ads.
+     */
+    public int getAdjustedPosition(final int originalPosition) {
+        return mStreamAdPlacer.getAdjustedPosition(originalPosition);
+    }
+
+    /**
+     * Inserts a content row at the given position, adjusting ad positions accordingly.
+     *
+     * Use this method if you are inserting an item into your stream and want to increment ad
+     * positions based on that new item.
+     *
+     * If you do not want to increment your ad positions when inserting items, you can simply call
+     * notifyDataSetChanged on the adapter and let it reload items normally. This is typically the
+     * case when inserting items at the end of your stream.
+     *
+     * @see {@link MoPubStreamAdPlacer#insertItem(int)}
+     * @param originalPosition The original content position at which to add an item. If you have an
+     * adjusted position, you will need to call {@link #getOriginalPosition} to get this value.
+     */
+    public void insertItem(final int originalPosition) {
+        mStreamAdPlacer.insertItem(originalPosition);
+    }
+
+    /**
+     * Removes the content row at the given position, adjusting ad positions accordingly.
+     *
+     * Use this method if you are removing an item from your stream and want to decrement ad
+     * positions based on that removed item.
+     *
+     * If you do not want to decrement your ad positions when inserting items, you can simply call
+     * notifyDataSet changed on the adapter and let it reload items normally. This is typically the
+     * case when removing items from the end of your stream.
+     *
+     * @see {@link MoPubStreamAdPlacer#removeItem(int)}
+     * @param originalPosition The original content position at which to add an item. If you have an
+     * adjusted position, you will need to call {@link #getOriginalPosition} to get this value.
+     */
+    public void removeItem(final int originalPosition) {
+        mStreamAdPlacer.removeItem(originalPosition);
+    }
+
+
+    /**
+     * Sets an on click listener for the given ListView, automatically adjusting the listener
+     * callback positions based on ads in the adapter.
+     *
+     * This listener will not be called when ads are clicked.
+     *
+     * @param listView The ListView for this adapter.
+     * @param listener An on click listener.
+     */
+    public void setOnClickListener(final ListView listView,
+            final OnItemClickListener listener) {
+        listView.setOnItemClickListener(new OnItemClickListener() {
+            @Override
+            public void onItemClick(final AdapterView<?> adapterView, final View view,
+                    final int position, final long id) {
+                if (!mStreamAdPlacer.isAd(position)) {
+                    listener.onItemClick(
+                            adapterView, view, mStreamAdPlacer.getOriginalPosition(position), id);
+                }
+            }
+        });
+    }
+
+    /**
+     * Sets an on long click listener for the given ListView, automatically adjusting the listener
+     * callback positions based on ads in the adapter.
+     *
+     * This listener will not be called when ads are long clicked.
+     *
+     * @param listView The ListView for this adapter.
+     * @param listener An an long click listener.
+     */
+    public void setOnItemLongClickListener(final ListView listView,
+            final OnItemLongClickListener listener) {
+        listView.setOnItemLongClickListener(new OnItemLongClickListener() {
+            @Override
+            public boolean onItemLongClick(final AdapterView<?> adapterView,
+                    final View view, final int position, final long id) {
+                return isAd(position) || listener.onItemLongClick(
+                        adapterView, view, mStreamAdPlacer.getOriginalPosition(position), id);
+            }
+        });
+    }
+
+    /**
+     * Sets an on item selected listener for the given ListView, automatically adjusting the
+     * listener callback positions based on ads in the adapter.
+     *
+     * @param listView The ListView for this adapter.
+     * @param listener An an item selected listener.
+     */
+    public void setOnItemSelectedListener(final ListView listView,
+            final OnItemSelectedListener listener) {
+        listView.setOnItemSelectedListener(new OnItemSelectedListener() {
+            @Override
+            public void onItemSelected(final AdapterView<?> adapterView,
+                    final View view, final int position, final long id) {
+                if (!isAd(position)) {
+                    listener.onItemSelected(adapterView, view,
+                            mStreamAdPlacer.getOriginalPosition(position), id);
+                }
+            }
+
+            @Override
+            public void onNothingSelected(final AdapterView<?> adapterView) {
+                listener.onNothingSelected(adapterView);
+            }
+        });
+    }
+
+    /**
+     * Sets the currently selected item in the ListView, automatically adjusting the position based
+     * on ads in the adapter.
+     *
+     * @param listView The ListView for this adapter.
+     * @param originalPosition The original content position before loading ads.
+     */
+    public void setSelection(final ListView listView, final int originalPosition) {
+        listView.setSelection(mStreamAdPlacer.getAdjustedPosition(originalPosition));
+    }
+
+    /**
+     * Scrolls an item in the ListView, automatically adjusting the position based on ads in the
+     * adapter.
+     *
+     * @param listView The ListView for this adapter.
+     * @param originalPosition The original content position before loading ads.
+     */
+    public void smoothScrollToPosition(final ListView listView, final int originalPosition) {
+        listView.smoothScrollToPosition(mStreamAdPlacer.getAdjustedPosition(originalPosition));
+    }
+
+    /**
+     * Refreshes ads in the given ListView while preserving the scroll position.
+     *
+     * Call this instead of {@link #loadAds(String)} in order to preserve the scroll position in
+     * your list.
+     *
+     * @param adUnitId The ad unit ID to use when loading ads.
+     */
+    public void refreshAds(final ListView listView, String adUnitId) {
+        refreshAds(listView, adUnitId, null);
+    }
+
+    /**
+     * Refreshes ads in the given ListView while preserving the scroll position.
+     *
+     * Call this instead of {@link #loadAds(String, RequestParameters)} in order to preserve the
+     * scroll position in your list.
+     *
+     * @param adUnitId The ad unit ID to use when loading ads.
+     * @param requestParameters Targeting information to pass to the ad server.
+     */
+    public void refreshAds(final ListView listView,
+            String adUnitId, RequestParameters requestParameters) {
+        if (listView.getAdapter() != this) {
+            MoPubLog.w("You called refreshAds on a ListView whose adapter is not an ad placer");
+            return;
+        }
+
+        // Get scroll offset of the first view, if it exists.
+        View firstView = listView.getChildAt(0);
+        int offsetY = (firstView == null) ? 0 : firstView.getTop();
+
+        // Find the range of positions where we should not clear ads.
+        int firstPosition = listView.getFirstVisiblePosition();
+        int startRange = Math.max(firstPosition - 1, 0);
+        while (mStreamAdPlacer.isAd(startRange) && startRange > 0) {
+            startRange--;
+        }
+        int lastPosition = listView.getLastVisiblePosition();
+        while (mStreamAdPlacer.isAd(lastPosition) && lastPosition < getCount() - 1) {
+            lastPosition++;
+        }
+        int originalStartRange = mStreamAdPlacer.getOriginalPosition(startRange);
+        int originalEndRange = mStreamAdPlacer.getOriginalCount(lastPosition + 1);
+
+        // Remove ads before and after the range.
+        int originalCount = mStreamAdPlacer.getOriginalCount(getCount());
+        mStreamAdPlacer.removeAdsInRange(originalEndRange, originalCount);
+        int numAdsRemoved = mStreamAdPlacer.removeAdsInRange(0, originalStartRange);
+
+        // Reset the scroll position, and reload ads.
+        if (numAdsRemoved > 0) {
+            listView.setSelectionFromTop(firstPosition - numAdsRemoved, offsetY);
+        }
+        loadAds(adUnitId, requestParameters);
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubAdRenderer.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubAdRenderer.java
new file mode 100644
index 00000000..87542fb1
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubAdRenderer.java
@@ -0,0 +1,39 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+import android.view.View;
+import android.view.ViewGroup;
+
+/**
+ * An interface for creating ad views and rendering them using ad data.
+ *
+ * Normally you will use the subclass {@link com.mopub.nativeads.MoPubNativeAdRenderer} with {@link
+ * com.mopub.nativeads.ViewBinder} to customize your ad view with your own layout. However, if you
+ * wish to programmatically create or manage your ad view, you can implement {@code
+ * }MoPubAdRenderer} directly.
+ *
+ * @param <T> The ad payload type.
+ */
+public interface MoPubAdRenderer<T> {
+    /**
+     * Creates a new view to be used as an ad.
+     *
+     * This method is called when you call {@link com.mopub.nativeads.MoPubStreamAdPlacer#getAdView}
+     * when the convertView is null. You must return a valid view.
+     *
+     * @param parent The parent that the view will eventually be attached to. You might use the
+     * parent to determine layout parameters, but should return the view without attaching it to the
+     * parent.
+     * @param context The context. Useful for creating a view.
+     * @return A new ad view.
+     */
+    View createAdView(Context context, ViewGroup parent);
+
+    /**
+     * Renders a view created by {@link #createAdView} by filling it with ad data.
+     *
+     * @param view The ad View
+     * @param ad The ad data that should be bound to the view.
+     */
+    void renderAdView(View view, T ad);
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java
index a7f43959..93f1ad45 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java
@@ -2,8 +2,7 @@
 
 import android.content.Context;
 
-import com.mopub.common.util.MoPubLog;
-import com.mopub.common.util.Numbers;
+import com.mopub.common.logging.MoPubLog;
 
 import org.json.JSONArray;
 import org.json.JSONException;
@@ -22,15 +21,20 @@
 import static com.mopub.nativeads.NativeResponse.Parameter;
 
 public class MoPubCustomEventNative extends CustomEventNative {
+
     @Override
     protected void loadNativeAd(final Context context,
             final CustomEventNativeListener customEventNativeListener,
             final Map<String, Object> localExtras,
             final Map<String, String> serverExtras) {
 
-        final MoPubForwardingNativeAd moPubForwardingNativeAd;
+        final MoPubForwardingNativeAd moPubForwardingNativeAd =
+                new MoPubForwardingNativeAd(context.getApplicationContext(),
+                        serverExtras.get(RESPONSE_BODY_KEY),
+                        customEventNativeListener);
+
         try {
-            moPubForwardingNativeAd = new MoPubForwardingNativeAd(serverExtras.get(RESPONSE_BODY_KEY));
+            moPubForwardingNativeAd.loadAd();
         } catch (IllegalArgumentException e) {
             customEventNativeListener.onNativeAdFailed(NativeErrorCode.UNSPECIFIED);
             return;
@@ -38,26 +42,27 @@ protected void loadNativeAd(final Context context,
             customEventNativeListener.onNativeAdFailed(NativeErrorCode.INVALID_JSON);
             return;
         }
-        preCacheImages(context, moPubForwardingNativeAd.getAllImageUrls(), new ImageListener() {
-            @Override
-            public void onImagesCached() {
-                customEventNativeListener.onNativeAdLoaded(moPubForwardingNativeAd);
-            }
-
-            @Override
-            public void onImagesFailedToCache(NativeErrorCode errorCode) {
-                customEventNativeListener.onNativeAdFailed(errorCode);
-            }
-        });
     }
 
     static class MoPubForwardingNativeAd extends BaseForwardingNativeAd {
-        MoPubForwardingNativeAd(final String jsonString) throws IllegalArgumentException, JSONException {
-            if (jsonString == null) {
+        private final Context mContext;
+        private final String mJsonString;
+        private final CustomEventNativeListener mCustomEventNativeListener;
+
+        MoPubForwardingNativeAd(final Context context,
+                final String jsonString,
+                final CustomEventNativeListener customEventNativeListener) {
+            mContext = context;
+            mJsonString = jsonString;
+            mCustomEventNativeListener = customEventNativeListener;
+        }
+
+        void loadAd() throws IllegalArgumentException, JSONException {
+            if (mJsonString == null) {
                 throw new IllegalArgumentException("Json String cannot be null");
             }
 
-            final JSONTokener jsonTokener = new JSONTokener(jsonString);
+            final JSONTokener jsonTokener = new JSONTokener(mJsonString);
             final JSONObject jsonObject = new JSONObject(jsonTokener);
 
             if (!containsRequiredKeys(jsonObject)) {
@@ -79,6 +84,18 @@ public void onImagesFailedToCache(NativeErrorCode errorCode) {
                     addExtra(key, jsonObject.opt(key));
                 }
             }
+
+            preCacheImages(mContext, getAllImageUrls(), new ImageListener() {
+                @Override
+                public void onImagesCached() {
+                    mCustomEventNativeListener.onNativeAdLoaded(MoPubForwardingNativeAd.this);
+                }
+
+                @Override
+                public void onImagesFailedToCache(final NativeErrorCode errorCode) {
+                    mCustomEventNativeListener.onNativeAdFailed(errorCode);
+                }
+            });
         }
 
         private boolean containsRequiredKeys(final JSONObject jsonObject) {
@@ -177,6 +194,5 @@ private boolean isImageKey(final String name) {
             imageUrls.addAll(getExtrasImageUrls());
             return imageUrls;
         }
-
     }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNative.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNative.java
index 4903cdb5..e842729b 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNative.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNative.java
@@ -2,29 +2,26 @@
 
 import android.content.Context;
 import android.view.View;
-
 import com.mopub.common.DownloadResponse;
 import com.mopub.common.DownloadTask;
 import com.mopub.common.GpsHelper;
 import com.mopub.common.HttpClient;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.AsyncTasks;
 import com.mopub.common.util.DeviceUtils;
 import com.mopub.common.util.ManifestUtils;
-import com.mopub.common.util.MoPubLog;
 import com.mopub.common.util.ResponseHeader;
-
 import org.apache.http.HttpStatus;
 import org.apache.http.client.methods.HttpGet;
 import org.apache.http.client.methods.HttpUriRequest;
 
 import java.lang.ref.WeakReference;
-import java.util.HashMap;
-import java.util.Map;
+import java.util.*;
 
 import static com.mopub.common.GpsHelper.GpsHelperListener;
 import static com.mopub.common.GpsHelper.asyncFetchAdvertisingInfo;
 import static com.mopub.nativeads.CustomEventNative.CustomEventNativeListener;
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener.EMPTY_MOPUB_NATIVE_LISTENER;
 import static com.mopub.nativeads.NativeErrorCode.CONNECTION_ERROR;
 import static com.mopub.nativeads.NativeErrorCode.EMPTY_AD_RESPONSE;
 import static com.mopub.nativeads.NativeErrorCode.INVALID_REQUEST_URL;
@@ -32,50 +29,99 @@
 import static com.mopub.nativeads.NativeErrorCode.UNEXPECTED_RESPONSE_CODE;
 import static com.mopub.nativeads.NativeErrorCode.UNSPECIFIED;
 
-public final class MoPubNative {
-
-    public interface MoPubNativeListener {
+public class MoPubNative {
+    public interface MoPubNativeNetworkListener {
         public void onNativeLoad(final NativeResponse nativeResponse);
         public void onNativeFail(final NativeErrorCode errorCode);
+    }
+
+    static final MoPubNativeNetworkListener EMPTY_NETWORK_LISTENER = new
+            MoPubNativeNetworkListener() {
+        @Override
+        public void onNativeLoad(final NativeResponse nativeResponse) {
+            // If this listener is invoked, it means that MoPubNative instance has been destroyed
+            // so destroy any leftover incoming NativeResponses
+            nativeResponse.destroy();
+        }
+        @Override
+        public void onNativeFail(final NativeErrorCode errorCode) {
+        }
+    };
+
+    static final MoPubNativeEventListener EMPTY_EVENT_LISTENER = new
+            MoPubNativeEventListener() {
+        @Override
+        public void onNativeImpression(final View view) {
+        }
+        @Override
+        public void onNativeClick(final View view) {
+        }
+    };
+
+    public interface MoPubNativeEventListener {
         public void onNativeImpression(final View view);
         public void onNativeClick(final View view);
+    }
 
-        public static final MoPubNativeListener EMPTY_MOPUB_NATIVE_LISTENER = new MoPubNativeListener() {
-            @Override public void onNativeLoad(final NativeResponse nativeResponse) {}
-            @Override public void onNativeFail(final NativeErrorCode errorCode) {}
-            @Override public void onNativeImpression(final View view) {}
-            @Override public void onNativeClick(final View view) {}
-        };
+    /**
+     * @deprecated As of release 2.4, use {@link MoPubNativeEventListener} and
+     * {@link MoPubNativeNetworkListener} instead.
+     */
+    @Deprecated
+    public interface MoPubNativeListener extends MoPubNativeNetworkListener, MoPubNativeEventListener {
     }
 
     // must be an activity context since 3rd party networks need it
     private final WeakReference<Context> mContext;
     private final String mAdUnitId;
-    private MoPubNativeListener mMoPubNativeListener;
+    private MoPubNativeNetworkListener mMoPubNativeNetworkListener;
+    private MoPubNativeEventListener mMoPubNativeEventListener;
     private Map<String, Object> mLocalExtras;
 
-    public MoPubNative(final Context context, final String adUnitId, final MoPubNativeListener moPubNativeListener) {
+    /**
+     * @deprecated As of release 2.4, use {@link MoPubNative(Context, String,
+     * MoPubNativeNetworkListener)} and {@link #setNativeEventListener(MoPubNativeEventListener)}
+     * instead.
+     */
+    @Deprecated
+    public MoPubNative(final Context context,
+            final String adUnitId,
+            final MoPubNativeListener moPubNativeListener) {
+        this(context, adUnitId, (MoPubNativeNetworkListener)moPubNativeListener);
+        setNativeEventListener(moPubNativeListener);
+    }
+
+    public MoPubNative(final Context context,
+                final String adUnitId,
+                final MoPubNativeNetworkListener moPubNativeNetworkListener) {
         if (context == null) {
             throw new IllegalArgumentException("Context may not be null.");
         } else if (adUnitId == null) {
             throw new IllegalArgumentException("AdUnitId may not be null.");
-        } else if (moPubNativeListener == null) {
-            throw new IllegalArgumentException("MoPubNativeListener may not be null.");
+        } else if (moPubNativeNetworkListener == null) {
+            throw new IllegalArgumentException("MoPubNativeNetworkListener may not be null.");
         }
 
         ManifestUtils.checkNativeActivitiesDeclared(context);
 
         mContext = new WeakReference<Context>(context);
         mAdUnitId = adUnitId;
-        mMoPubNativeListener = moPubNativeListener;
-        
+        mMoPubNativeNetworkListener = moPubNativeNetworkListener;
+        mMoPubNativeEventListener = EMPTY_EVENT_LISTENER;
+
         // warm up cache for google play services info
         asyncFetchAdvertisingInfo(context);
     }
 
+    public void setNativeEventListener(final MoPubNativeEventListener nativeEventListener) {
+        mMoPubNativeEventListener = (nativeEventListener == null)
+                ? EMPTY_EVENT_LISTENER : nativeEventListener;
+    }
+
     public void destroy() {
         mContext.clear();
-        mMoPubNativeListener = EMPTY_MOPUB_NATIVE_LISTENER;
+        mMoPubNativeNetworkListener = EMPTY_NETWORK_LISTENER;
+        mMoPubNativeEventListener = EMPTY_EVENT_LISTENER;
     }
 
     public void setLocalExtras(final Map<String, Object> localExtras) {
@@ -83,8 +129,7 @@ public void setLocalExtras(final Map<String, Object> localExtras) {
     }
 
     public void makeRequest() {
-        final RequestParameters requestParameters = null;
-        makeRequest(requestParameters);
+        makeRequest((RequestParameters)null);
     }
 
     public void makeRequest(final RequestParameters requestParameters) {
@@ -98,7 +143,7 @@ void makeRequest(final NativeGpsHelperListener nativeGpsHelperListener) {
         }
 
         if (!DeviceUtils.isNetworkAvailable(context)) {
-            mMoPubNativeListener.onNativeFail(CONNECTION_ERROR);
+            mMoPubNativeNetworkListener.onNativeFail(CONNECTION_ERROR);
             return;
         }
 
@@ -111,16 +156,21 @@ void makeRequest(final NativeGpsHelperListener nativeGpsHelperListener) {
         );
     }
 
-    void loadNativeAd(final RequestParameters requestParameters) {
+    void loadNativeAd(final RequestParameters requestParameters, final Integer sequenceNumber) {
         final Context context = getContextOrDestroy();
         if (context == null) {
             return;
         }
 
-        final String endpointUrl = new NativeUrlGenerator(context)
+        final NativeUrlGenerator generator = new NativeUrlGenerator(context)
                 .withAdUnitId(mAdUnitId)
-                .withRequest(requestParameters)
-                .generateUrlString(Constants.NATIVE_HOST);
+                .withRequest(requestParameters);
+
+        if (sequenceNumber != null) {
+            generator.withSequenceNumber(sequenceNumber);
+        }
+
+        final String endpointUrl = generator.generateUrlString(Constants.NATIVE_HOST);
 
         if (endpointUrl != null) {
             MoPubLog.d("Loading ad from: " + endpointUrl);
@@ -129,6 +179,10 @@ void loadNativeAd(final RequestParameters requestParameters) {
         requestNativeAd(endpointUrl);
     }
 
+    void loadNativeAd(final RequestParameters requestParameters) {
+        loadNativeAd(requestParameters, null);
+    }
+
     void requestNativeAd(final String endpointUrl) {
         final Context context = getContextOrDestroy();
         if (context == null) {
@@ -136,7 +190,7 @@ void requestNativeAd(final String endpointUrl) {
         }
 
         if (endpointUrl == null) {
-            mMoPubNativeListener.onNativeFail(INVALID_REQUEST_URL);
+            mMoPubNativeNetworkListener.onNativeFail(INVALID_REQUEST_URL);
             return;
         }
 
@@ -144,7 +198,7 @@ void requestNativeAd(final String endpointUrl) {
         try {
             httpGet = HttpClient.initializeHttpGet(endpointUrl, context);
         } catch (IllegalArgumentException e) {
-            mMoPubNativeListener.onNativeFail(INVALID_REQUEST_URL);
+            mMoPubNativeNetworkListener.onNativeFail(INVALID_REQUEST_URL);
             return;
         }
 
@@ -156,14 +210,14 @@ private void downloadJson(final HttpUriRequest httpUriRequest) {
             @Override
             public void onComplete(final String url, final DownloadResponse downloadResponse) {
                 if (downloadResponse == null) {
-                    mMoPubNativeListener.onNativeFail(UNSPECIFIED);
+                    mMoPubNativeNetworkListener.onNativeFail(UNSPECIFIED);
                 } else if (downloadResponse.getStatusCode() >= 500 &&
                         downloadResponse.getStatusCode() < 600) {
-                    mMoPubNativeListener.onNativeFail(SERVER_ERROR_RESPONSE_CODE);
+                    mMoPubNativeNetworkListener.onNativeFail(SERVER_ERROR_RESPONSE_CODE);
                 } else if (downloadResponse.getStatusCode() != HttpStatus.SC_OK) {
-                    mMoPubNativeListener.onNativeFail(UNEXPECTED_RESPONSE_CODE);
+                    mMoPubNativeNetworkListener.onNativeFail(UNEXPECTED_RESPONSE_CODE);
                 } else if (downloadResponse.getContentLength() == 0) {
-                    mMoPubNativeListener.onNativeFail(EMPTY_AD_RESPONSE);
+                    mMoPubNativeNetworkListener.onNativeFail(EMPTY_AD_RESPONSE);
                 } else {
                     final CustomEventNativeListener customEventNativeListener = new CustomEventNativeListener() {
                         @Override
@@ -172,7 +226,7 @@ public void onNativeAdLoaded(final NativeAdInterface nativeAd) {
                             if (context == null) {
                                 return;
                             }
-                            mMoPubNativeListener.onNativeLoad(new NativeResponse(context, downloadResponse, nativeAd, mMoPubNativeListener));
+                            mMoPubNativeNetworkListener.onNativeLoad(new NativeResponse(context, downloadResponse, mAdUnitId, nativeAd, mMoPubNativeEventListener));
                         }
 
                         @Override
@@ -185,6 +239,7 @@ public void onNativeAdFailed(final NativeErrorCode errorCode) {
                     if (context == null) {
                         return;
                     }
+
                     CustomEventNativeAdapter.loadNativeAd(
                             context,
                             mLocalExtras,
@@ -200,7 +255,7 @@ public void onNativeAdFailed(final NativeErrorCode errorCode) {
         } catch (Exception e) {
             MoPubLog.d("Failed to download json", e);
 
-            mMoPubNativeListener.onNativeFail(UNSPECIFIED);
+            mMoPubNativeNetworkListener.onNativeFail(UNSPECIFIED);
         }
 
     }
@@ -217,18 +272,27 @@ Context getContextOrDestroy() {
 
     // Do not store this class as a member of MoPubNative; will result in circular reference
     class NativeGpsHelperListener implements GpsHelperListener {
-        private RequestParameters mRequestParameters;
+        private final RequestParameters mRequestParameters;
+
         NativeGpsHelperListener(RequestParameters requestParameters) {
             mRequestParameters = requestParameters;
         }
+
         @Override
         public void onFetchAdInfoCompleted() {
             loadNativeAd(mRequestParameters);
         }
     }
 
+    @VisibleForTesting
+    @Deprecated
+    MoPubNativeNetworkListener getMoPubNativeNetworkListener() {
+        return mMoPubNativeNetworkListener;
+    }
+
+    @VisibleForTesting
     @Deprecated
-    MoPubNativeListener getMoPubNativeListener() {
-        return mMoPubNativeListener;
+    MoPubNativeEventListener getMoPubNativeEventListener() {
+        return mMoPubNativeEventListener;
     }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdLoadedListener.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdLoadedListener.java
new file mode 100644
index 00000000..84289613
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdLoadedListener.java
@@ -0,0 +1,20 @@
+package com.mopub.nativeads;
+
+/**
+ * A listener for determining when ads are loaded into an ad Placer
+ */
+public interface MoPubNativeAdLoadedListener {
+    /**
+     * Called when an ad is loaded at the specified position.
+     *
+     * @param position The ad position of the newly loaded ad.
+     */
+    void onAdLoaded(int position);
+
+    /**
+     * Called when an ad is removed at the specified position.
+     *
+     * @param position The removed ad position.
+     */
+    void onAdRemoved(int position);
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdPositioning.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdPositioning.java
new file mode 100644
index 00000000..593439ee
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdPositioning.java
@@ -0,0 +1,168 @@
+package com.mopub.nativeads;
+
+import com.mopub.common.Preconditions;
+
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.List;
+
+/**
+ * Provides factory methods for setting up native ad positions.
+ *
+ * This class supports 2 types of positioning to use when placing ads into your stream:
+ * <ol>
+ *     <li><b>Server positioning</b>. The SDK will connect to the MoPub server to determine the
+ *     optimal positions for ads. You can also configure these positions yourself using the
+ *     MoPub publisher UI. We recommend using server positioning, and it is the default if you
+ *     do not specify positioning when loading ads.</li>
+ *     <li><b>Client positioning.</b> Requires you to hard-code positions into your app. You
+ *     can specify fixed positions for ads, as well as a repeating interval.
+ *     </li>
+ * </ol>
+ */
+public final class MoPubNativeAdPositioning {
+    /**
+     * Allows the SDK to connect to the MoPub server in order to determine ad
+     * positions.
+     */
+    public static class MoPubServerPositioning {
+        // No-op. This is used by the ad placer as an indicator to use server positioning.
+    }
+
+    /**
+     * Allows hard-coding ad positions into your app.
+     */
+    public static class MoPubClientPositioning {
+        /**
+         * Constant indicating that ad positions should not repeat.
+         */
+        public static final int NO_REPEAT = Integer.MAX_VALUE;
+
+        private final ArrayList<Integer> mFixedPositions = new ArrayList<Integer>();
+        private int mRepeatInterval = NO_REPEAT;
+
+        public MoPubClientPositioning() {
+        }
+
+        /**
+         * Specifies a fixed ad position.
+         *
+         * @param position The ad position.
+         * @return This object for easy use in chained setters.
+         */
+        public MoPubClientPositioning addFixedPosition(final int position) {
+            if (!Preconditions.NoThrow.checkArgument(position >= 0)) {
+                return this;
+            }
+
+            // Add in sorted order if this does not exist.
+            int index = Collections.binarySearch(mFixedPositions, position);
+            if (index < 0) {
+                mFixedPositions.add(~index, position);
+            }
+            return this;
+        }
+
+        /**
+         * Returns an ordered array of fixed ad positions.
+         *
+         * @return Fixed ad positions.
+         */
+        List<Integer> getFixedPositions() {
+            return mFixedPositions;
+        }
+
+        /**
+         * Enables showing ads ad at a repeated interval.
+         *
+         * @param interval The frequency at which to show ads. Must be an integer greater than 1 or
+         * the constant NO_REPEAT.
+         * @return This object for easy use in chained setters.
+         */
+        public MoPubClientPositioning enableRepeatingPositions(final int interval) {
+            if (!Preconditions.NoThrow.checkArgument(
+                    interval > 1, "Repeating interval must be greater than 1")) {
+                mRepeatInterval = NO_REPEAT;
+                return this;
+            }
+            mRepeatInterval = interval;
+            return this;
+        }
+
+        /**
+         * Returns the repeating ad interval.
+         *
+         * Repeating ads start after the last fixed position. Returns {@link #NO_REPEAT} if there is
+         * no repeating interval.
+         *
+         * @return The repeating ad interval.
+         */
+        int getRepeatingInterval() {
+            return mRepeatInterval;
+        }
+    }
+
+    static MoPubClientPositioning clone(MoPubClientPositioning positioning) {
+        MoPubClientPositioning clone = new MoPubClientPositioning();
+        clone.mFixedPositions.addAll(positioning.mFixedPositions);
+        clone.mRepeatInterval = positioning.mRepeatInterval;
+        return clone;
+    }
+
+    /**
+     * Creates and returns a {@link MoPubClientPositioning} object.
+     * @return A new positioning object.
+     */
+    public static MoPubClientPositioning clientPositioning() {
+        return new MoPubClientPositioning();
+    }
+
+    /**
+     * Creates and returns a {@link MoPubServerPositioning} object.
+     * @return A new positioning object.
+     */
+    public static MoPubServerPositioning serverPositioning() {
+        return new MoPubServerPositioning();
+    }
+
+    /**
+     * Creates and returns a {@link MoPubNativeAdPositioning.Builder}.
+     *
+     * @return A new builder.
+     * @deprecated We recommend using {@link #serverPositioning()} and specifying positioning in
+     * the MoPub UI. If you still want to hard-code positioning information in your app,
+     * use {@link #clientPositioning} instead of this builder.
+     */
+    @Deprecated
+    public static Builder newBuilder() {
+        return new Builder();
+    }
+
+    /**
+     * A Builder class for the ad positioning.
+     */
+    @Deprecated
+    public static final class Builder extends MoPubClientPositioning {
+        @Override
+        public Builder addFixedPosition(final int position) {
+            super.addFixedPosition(position);
+            return this;
+        }
+
+        @Override
+        public Builder enableRepeatingPositions(final int interval) {
+            super.enableRepeatingPositions(interval);
+            return this;
+        }
+
+        /**
+         * Creates and returns a new immutable positioning object.
+         *
+         * @return A new positioning object.
+         */
+        @Deprecated
+        public MoPubClientPositioning build() {
+            return this;
+        }
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdRenderer.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdRenderer.java
new file mode 100644
index 00000000..e33dd2c6
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubNativeAdRenderer.java
@@ -0,0 +1,75 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+
+import java.util.WeakHashMap;
+
+import static android.view.View.VISIBLE;
+
+/**
+ * An implementation of {@link com.mopub.nativeads.MoPubAdRenderer} for rendering native ads.
+ */
+public class MoPubNativeAdRenderer implements MoPubAdRenderer<NativeResponse> {
+
+    private final ViewBinder mViewBinder;
+
+    // This is used instead of View.setTag, which causes a memory leak in 2.3
+    // and earlier: https://code.google.com/p/android/issues/detail?id=18273
+    private final WeakHashMap<View, NativeViewHolder> mViewHolderMap;
+
+    /**
+     * Constructs a native ad renderer with a view binder.
+     *
+     * @param viewBinder The view binder to use when inflating and rendering an ad.
+     */
+    public MoPubNativeAdRenderer(final ViewBinder viewBinder) {
+        mViewBinder = viewBinder;
+        mViewHolderMap = new WeakHashMap<View, NativeViewHolder>();
+    }
+
+    @Override
+    public View createAdView(final Context context, final ViewGroup parent) {
+        return LayoutInflater
+                .from(context)
+                .inflate(mViewBinder.layoutId, parent, false);
+    }
+
+    @Override
+    public void renderAdView(final View view, final NativeResponse nativeResponse) {
+        final NativeViewHolder nativeViewHolder = getOrCreateNativeViewHolder(view, mViewBinder);
+
+        if (nativeViewHolder == null) {
+            MoPubLog.d("Could not create NativeViewHolder.");
+            return;
+        }
+
+        populateConvertViewSubViews(view, nativeViewHolder, nativeResponse, mViewBinder);
+        view.setVisibility(VISIBLE);
+    }
+
+    @VisibleForTesting
+    NativeViewHolder getOrCreateNativeViewHolder(final View view, final ViewBinder viewBinder) {
+        // Create view holder and put it in the view tag
+        NativeViewHolder nativeViewHolder = mViewHolderMap.get(view);
+        if (nativeViewHolder == null) {
+            nativeViewHolder = NativeViewHolder.fromViewBinder(view, viewBinder);
+            mViewHolderMap.put(view, nativeViewHolder);
+            return nativeViewHolder;
+        }
+        return nativeViewHolder;
+    }
+
+    private void populateConvertViewSubViews(final View view,
+            final NativeViewHolder nativeViewHolder,
+            final NativeResponse nativeResponse,
+            final ViewBinder viewBinder) {
+        nativeViewHolder.update(nativeResponse);
+        nativeViewHolder.updateExtras(view, nativeResponse, viewBinder);
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubStreamAdPlacer.java b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubStreamAdPlacer.java
new file mode 100644
index 00000000..0234a56b
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/MoPubStreamAdPlacer.java
@@ -0,0 +1,643 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+import android.os.Handler;
+import android.view.View;
+import android.view.ViewGroup;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubServerPositioning;
+import com.mopub.nativeads.PositioningSource.PositioningListener;
+
+import java.util.*;
+
+/**
+ * @code MoPubStreamAdPlacer facilitates loading ads and placing them into a content stream.
+ *
+ * If you are inserting ads into a ListView, we recommend that you use a {@link MoPubAdAdapter}
+ * instead of this class.
+ *
+ * To start loading ads, call {@link #loadAds}. We recommend passing targeting information to
+ * increase the chance that you show ads that are relevant to your users.
+ *
+ * This class is not intended to be used by multiple threads. All calls should be made from the main
+ * UI thread.
+ */
+public class MoPubStreamAdPlacer {
+    /**
+     * Constant representing that the view type for a given position is a regular content item
+     * instead of an ad.
+     */
+    public static final int CONTENT_VIEW_TYPE = 0;
+
+    private final Context mContext;
+    private final Handler mPlacementHandler;
+    private final Runnable mPlacementRunnable;
+    private final PositioningSource mPositioningSource;
+    private final NativeAdSource mAdSource;
+    private final ImpressionTracker mImpressionTracker;
+    private final WeakHashMap<View, NativeResponse> mNativeResponseMap;
+
+    private boolean mHasReceivedPositions;
+    private PlacementData mPendingPlacementData;
+    private boolean mHasReceivedAds;
+    private boolean mHasPlacedAds;
+    private PlacementData mPlacementData;
+    
+    private MoPubAdRenderer mAdRenderer;
+    private String mAdUnitId;
+
+    private MoPubNativeAdLoadedListener mAdLoadedListener;
+    // The visible range is the range of items which we believe are visible, inclusive.
+    // Placing ads near this range makes for a smoother user experience when scrolling up
+    // or down.
+    private static final int MAX_VISIBLE_RANGE = 100;
+    private int mVisibleRangeStart;
+    private int mVisibleRangeEnd;
+
+    private int mItemCount;
+    // A buffer around the visible range where we'll place ads if possible.
+    private static final int RANGE_BUFFER = 10;
+    private boolean mNeedsPlacement;
+
+    /**
+     * Creates a new MoPubStreamAdPlacer object.
+     *
+     * By default, the StreamAdPlacer will contact the server to determine ad positions. If you
+     * wish to hard-code positions in your app, see {@link MoPubStreamAdPlacer(Context,
+     * MoPubClientPositioning)}.
+     *
+     * @param context The activity context.
+     */
+    public MoPubStreamAdPlacer(final Context context) {
+        // MoPubClientPositioning is mutable, so we must take care not to hold a
+        // reference to it that might be subsequently modified by the caller.
+        this(context, MoPubNativeAdPositioning.serverPositioning());
+    }
+
+    /**
+     * Creates a new MoPubStreamAdPlacer object, using server positioning.
+     *
+     * @param context The activity context.
+     * @param adPositioning A positioning object for specifying where ads will be placed in your
+     * stream. See {@link MoPubNativeAdPositioning#serverPositioning()}.
+     */
+    public MoPubStreamAdPlacer(final Context context, final MoPubServerPositioning adPositioning) {
+        this(context,
+                new NativeAdSource(),
+                new ImpressionTracker(context),
+                new ServerPositioningSource(context));
+    }
+
+    /**
+     * Creates a new MoPubStreamAdPlacer object, using client positioning.
+     *
+     * @param context The activity context.
+     * @param adPositioning A positioning object for specifying where ads will be placed in your
+     * stream. See {@link MoPubNativeAdPositioning#clientPositioning()}.
+     */
+    public MoPubStreamAdPlacer(final Context context, final MoPubClientPositioning adPositioning) {
+        // MoPubClientPositioning is mutable, so we must take care not to hold a
+        // reference to it that might be subsequently modified by the caller.
+        this(context,
+                new NativeAdSource(),
+                new ImpressionTracker(context),
+                new ClientPositioningSource(adPositioning));
+    }
+
+    @VisibleForTesting
+    MoPubStreamAdPlacer(final Context context,
+            final NativeAdSource adSource,
+            final ImpressionTracker impressionTracker,
+            final PositioningSource positioningSource) {
+        mContext = context;
+        mImpressionTracker = impressionTracker;
+        mPositioningSource = positioningSource;
+        mAdSource = adSource;
+        mPlacementData = PlacementData.empty();
+        mNativeResponseMap = new WeakHashMap<View, NativeResponse>();
+
+        mPlacementHandler = new Handler();
+        mPlacementRunnable = new Runnable() {
+            @Override
+            public void run() {
+                if (!mNeedsPlacement) {
+                    return;
+                }
+                placeAds();
+                mNeedsPlacement = false;
+            }
+        };
+
+        mVisibleRangeStart = 0;
+        mVisibleRangeEnd = 0;
+    }
+
+    /**
+     * Registers an ad renderer to use when displaying ads in your stream.
+     *
+     * This renderer will automatically create and render your view when you call {@link
+     * #getAdView}. If you register a second renderer, it will replace the first, although this
+     * behavior is subject to change in a future SDK version.
+     *
+     * @param adRenderer The ad renderer.
+     */
+    public void registerAdRenderer(final MoPubAdRenderer adRenderer) {
+        mAdRenderer = adRenderer;
+    }
+
+    /**
+     * Sets a listener that will be called after the SDK loads new ads from the server and places
+     * them into your stream.
+     *
+     * The listener will be active between when you call {@link #loadAds} and when you call {@link
+     * #destroy()}. You can also set the listener to {@code null} to remove the listener.
+     *
+     * Note that there is not a one to one correspondence between calls to {@link #loadAds} and this
+     * listener. The SDK will call the listener every time an ad loads.
+     *
+     * @param listener The listener.
+     */
+    public void setAdLoadedListener(final MoPubNativeAdLoadedListener listener) {
+        mAdLoadedListener = listener;
+    }
+
+    /**
+     * Start loading ads from the MoPub server.
+     *
+     * We recommend using {@link #loadAds(String, RequestParameters)} instead of this method, in
+     * order to pass targeting information to the server.
+     *
+     * @param adUnitId The ad unit ID to use when loading ads.
+     */
+    public void loadAds(final String adUnitId) {
+        loadAds(adUnitId, /* requestParameters */ null);
+    }
+
+    /**
+     * Start loading ads from the MoPub server, using the given request targeting information.
+     *
+     * When loading ads, use {@link MoPubNativeAdLoadedListener#onAdLoaded(int)} will be called for
+     * each ad that is added to the stream.
+     *
+     * To refresh ads in your stream, call {@code loadAds} again. When new ads load, they will
+     * replace the current ads in your stream. If you are using {@code MoPubNativeAdLoadedListener}
+     * you will see a call to {@code onAdRemoved} for each of the old ads, followed by a calls to
+     * {@code onAdLoaded}.
+     *
+     * @param adUnitId The ad unit ID to use when loading ads.
+     * @param requestParameters Targeting information to pass to the ad server.
+     */
+    public void loadAds(final String adUnitId,
+            final RequestParameters requestParameters) {
+        mAdUnitId = adUnitId;
+
+        mHasPlacedAds = false;
+        mHasReceivedPositions = false;
+        mHasReceivedAds = false;
+
+        mPositioningSource.loadPositions(adUnitId, new PositioningListener() {
+            @Override
+            public void onLoad(final MoPubClientPositioning positioning) {
+                handlePositioningLoad(positioning);
+            }
+
+            @Override
+            public void onFailed() {
+            }
+        });
+
+        mAdSource.setAdSourceListener(new NativeAdSource.AdSourceListener() {
+            @Override
+            public void onAdsAvailable() {
+                handleAdsAvailable();
+            }
+        });
+
+        mAdSource.loadAds(mContext, adUnitId, requestParameters);
+    }
+
+    @VisibleForTesting
+    void handlePositioningLoad(final MoPubClientPositioning positioning) {
+        PlacementData placementData = PlacementData.fromAdPositioning(positioning);
+        if (mHasReceivedAds) {
+            placeInitialAds(placementData);
+        } else {
+            mPendingPlacementData = placementData;
+        }
+        mHasReceivedPositions = true;
+    }
+
+    @VisibleForTesting
+    void handleAdsAvailable() {
+        // If we've already placed ads, just notify that we need placement.
+        if (mHasPlacedAds) {
+            notifyNeedsPlacement();
+            return;
+        }
+
+        // Otherwise, we may need to place initial ads.
+        if (mHasReceivedPositions) {
+            placeInitialAds(mPendingPlacementData);
+        }
+        mHasReceivedAds = true;
+    }
+
+    private void placeInitialAds(PlacementData placementData) {
+        // Remove ads that may be present and immediately place ads again. This prevents the UI
+        // from flashing grossly.
+        removeAdsInRange(0, mItemCount);
+
+        mPlacementData = placementData;
+        placeAds();
+        mHasPlacedAds = true;
+    }
+
+    /**
+     * Inserts ads that should appear in the given range.
+     *
+     * By default, the ad placer will place ads withing the first 10 positions in your stream,
+     * according the positions you've specified. You can should use this method as your user scrolls
+     * through your stream to place ads into the currently visible range.
+     *
+     * This method takes advantage of a short-lived in memory ad cache, and will immediately place
+     * any ads from the cache. If there are no ads in the cache, this method will load additional
+     * ads from the server and place them once they are loaded. If you call {@code placeAdsInRange}
+     * again before ads are retrieved from the server, the new ads will show in the new positions
+     * rather than the old positions.
+     *
+     * You can pass any integer as a startPosition and endPosition for the range, including negative
+     * numbers or numbers greater than the current stream item count. The ad placer will only place
+     * ads between 0 and item count.
+     *
+     * @param startPosition The start of the range in which to place ads, inclusive.
+     * @param endPosition The end of the range in which to place ads, exclusive.
+     */
+    public void placeAdsInRange(final int startPosition, final int endPosition) {
+        mVisibleRangeStart = startPosition;
+        mVisibleRangeEnd = Math.min(endPosition, startPosition + MAX_VISIBLE_RANGE);
+        notifyNeedsPlacement();
+    }
+
+    /**
+     * Whether the given position is an ad.
+     *
+     * This will return {@code true} only if there is an ad loaded for this position. You can listen
+     * for ads to load using {@link MoPubNativeAdLoadedListener#onAdLoaded(int)}.
+     *
+     * @param position The position to check for an ad, expressed in terms of the position in the
+     * stream including ads.
+     * @return Whether there is an ad at the given position.
+     */
+    public boolean isAd(final int position) {
+        return mPlacementData.isPlacedAd(position);
+    }
+
+    /**
+     * Stops loading ads, immediately clearing any ads currently in the stream.
+     *
+     * This method also stops ads from loading as the user moves through the stream. If you want to
+     * just remove ads but want to continue loading them, call {@link #removeAdsInRange(int, int)}.
+     *
+     * When ads are cleared, {@link MoPubNativeAdLoadedListener#onAdRemoved} will be called for each
+     * ad that is removed from the stream.
+     */
+    public void clearAds() {
+        removeAdsInRange(0, mItemCount);
+        mAdSource.clear();
+    }
+
+    /**
+     * Destroys the ad placer, preventing it from future use.
+     *
+     * You must call this method before the hosting activity for this class is destroyed in order to
+     * avoid a memory leak. Typically you should destroy the adapter in the life-cycle method that
+     * is counterpoint to the method you used to create the adapter. For example, if you created the
+     * adapter in {@code Fragment#onCreateView} you should destroy it in {code
+     * Fragment#onDestroyView}.
+     */
+    public void destroy() {
+        mPlacementHandler.removeMessages(0);
+        mAdSource.clear();
+        mImpressionTracker.destroy();
+        mPlacementData.clearAds();
+    }
+
+    /**
+     * Returns an ad data object, or {@code null} if there is no ad at this position.
+     *
+     * This method is useful when implementing your own Adapter using {@code MoPubStreamAdPlacer}.
+     * To avoid worrying about view type, consider using {@link MoPubAdAdapter} instead of this
+     * class.
+     *
+     * @param position The position where to place an ad.
+     * @return An object representing ad data.
+     */
+    public Object getAdData(final int position) {
+        return mPlacementData.getPlacedAd(position);
+    }
+
+    /**
+     * Gets the ad at the given position, or {@code null} if there is no ad at the given position.
+     *
+     * This method will attempt to reuse the convertView if it is not {@code null}, and will
+     * otherwise create it. See {@link MoPubAdRenderer#createAdView(Context, ViewGroup)}.
+     *
+     * @param position The position where to place an ad.
+     * @param convertView A recycled view into which to render data, or {@code null}.
+     * @param parent The parent that the view will eventually be attached to.
+     * @return The newly placed ad view.
+     */
+    public View getAdView(final int position, final View convertView, final ViewGroup parent) {
+        if (!isAd(position)) {
+            return null;
+        }
+
+        final NativeAdData adData = mPlacementData.getPlacedAd(position);
+        final MoPubAdRenderer adRenderer = adData.getAdRenderer();
+        final View view = (convertView != null) ?
+                convertView : adRenderer.createAdView(mContext, parent);
+
+        NativeResponse nativeResponse = adData.getAd();
+        if (!nativeResponse.equals(mNativeResponseMap.get(view))) {
+            clearNativeResponse(view);
+            prepareNativeResponse(nativeResponse, view);
+            adRenderer.renderAdView(view, nativeResponse);
+        }
+        return view;
+    }
+
+    /**
+     * Removes ads in the given range from [startRange, endRange).
+     *
+     * @param originalStartPosition The start position to clear, expressed as the original content
+     * position before ads were inserted.
+     * @param originalEndPosition The position after end position to clear, expressed as the
+     * original content position before ads were inserted.
+     * @return The number of ads removed.
+     */
+    public int removeAdsInRange(int originalStartPosition, int originalEndPosition) {
+        int[] positions = mPlacementData.getPlacedAdPositions();
+
+        int adjustedStartRange = mPlacementData.getAdjustedPosition(originalStartPosition);
+        int adjustedEndRange = mPlacementData.getAdjustedPosition(originalEndPosition);
+
+        ArrayList<Integer> removedPositions = new ArrayList<Integer>();
+        // Traverse in reverse order to make this less error-prone for developers who are removing
+        // views directly from their UI.
+        for (int i = positions.length - 1; i >= 0; --i) {
+            int position = positions[i];
+            if (position < adjustedStartRange || position >= adjustedEndRange) {
+                continue;
+            }
+
+            removedPositions.add(position);
+
+            // Decrement the start range for any removed ads. We don't bother to decrement the end
+            // range, as it is OK if it isn't 100% accurate.
+            if (position < mVisibleRangeStart) {
+                mVisibleRangeStart--;
+            }
+            mItemCount--;
+        }
+
+        int clearedAdsCount = mPlacementData.clearAdsInRange(adjustedStartRange, adjustedEndRange);
+        for (int position : removedPositions) {
+            mAdLoadedListener.onAdRemoved(position);
+        }
+        return clearedAdsCount;
+    }
+
+    /**
+     * Returns the number of ad view types that can be placed by this ad placer. The number of
+     * possible ad view types is currently 1, but this is subject to change in future SDK versions.
+     *
+     * @return The number of ad view types.
+     * @see #getAdViewType
+     */
+    public int getAdViewTypeCount() {
+        return 1;
+    }
+
+    /**
+     * The ad view type for this position.
+     *
+     * Returns 0 if this is a regular content item. Otherwise, returns a number between 1 and {@link
+     * #getAdViewTypeCount}.
+     *
+     * This method is useful when implementing your own Adapter using {@code MoPubStreamAdPlacer}.
+     * To avoid worrying about view type, consider using {@link MoPubAdAdapter} instead of this
+     * class.
+     *
+     * @param position The stream position.
+     * @return The ad view type.
+     */
+    public int getAdViewType(final int position) {
+        return isAd(position) ? 1 : CONTENT_VIEW_TYPE;
+    }
+
+    /**
+     * Returns the original position of an item considering ads in the stream.
+     *
+     * For example if your stream looks like:
+     *
+     * {@code Item0 Ad Item1 Item2 Ad Item3 </code>
+     *
+     * {@code getOriginalPosition(5)} will return {@code 3}.
+     *
+     * @param position The adjusted position.
+     * @return The original position before placing ads.
+     */
+    public int getOriginalPosition(final int position) {
+        return mPlacementData.getOriginalPosition(position);
+    }
+
+    /**
+     * Returns the position of an item considering ads in the stream.
+     *
+     * @param originalPosition The original position.
+     * @return The position adjusted by placing ads.
+     */
+    public int getAdjustedPosition(final int originalPosition) {
+        return mPlacementData.getAdjustedPosition(originalPosition);
+    }
+
+    /**
+     * Returns the original number of items considering ads in the stream.
+     *
+     * @param count The number of items in the stream.
+     * @return The original number of items before placing ads.
+     */
+    public int getOriginalCount(final int count) {
+        return mPlacementData.getOriginalCount(count);
+    }
+
+    /**
+     * Returns the number of items considering ads in the stream.
+     *
+     * @param originalCount The original number of items.
+     * @return The number of items adjusted by placing ads.
+     */
+    public int getAdjustedCount(final int originalCount) {
+        return mPlacementData.getAdjustedCount(originalCount);
+    }
+
+    /**
+     * Sets the original number of items in your stream.
+     *
+     * You must call this method so that the placer knows where valid positions are to place ads.
+     * After calling this method, the ad placer will call {@link
+     * MoPubNativeAdLoadedListener#onAdLoaded
+     * (int)} each time an ad is loaded in the stream.
+     *
+     * @param originalCount The original number of items.
+     */
+    public void setItemCount(final int originalCount) {
+        mItemCount = mPlacementData.getAdjustedCount(originalCount);
+        notifyNeedsPlacement();
+    }
+
+    /**
+     * Inserts a content row at the given position, adjusting ad positions accordingly.
+     *
+     * Use this method if you are inserting an item into your stream and want to increment ad
+     * positions based on that new item.
+     *
+     * For example if your stream looks like:
+     *
+     * {@code Item0 Ad Item1 Item2 Ad Item3}
+     *
+     * and you insert an item at position 2, your new stream will look like:
+     *
+     * {@code Item0 Ad Item1 Item2 New Item Ad Item3}
+     *
+     * @param originalPosition The position at which to add an item. If you have an adjusted
+     * position, you will need to call {@link #getOriginalPosition} to get this value.
+     */
+    public void insertItem(final int originalPosition) {
+        mPlacementData.insertItem(originalPosition);
+    }
+
+    /**
+     * Removes the content row at the given position, adjusting ad positions accordingly.
+     *
+     * Use this method if you are removing an item from your stream and want to decrement ad
+     * positions based on that removed item.
+     *
+     * For example if your stream looks like:
+     *
+     * {@code Item0 Ad Item1 Item2 Ad Item3}
+     *
+     * and you remove an item at position 2, your new stream will look like:
+     *
+     * {@code Item0 Ad Item1 Ad Item3}
+     *
+     * @param originalPosition The position at which to add an item. If you have an adjusted
+     * position, you will need to call {@link #getOriginalPosition} to get this value.
+     */
+    public void removeItem(final int originalPosition) {
+        mPlacementData.removeItem(originalPosition);
+    }
+
+    /**
+     * Moves the content row at the given position adjusting ad positions accordingly.
+     *
+     * Use this method if you are moving an item in your stream and want to have ad positions move
+     * as well.
+     *
+     * @param originalPosition The position from which to move an item. If you have an adjusted
+     * position, you will need to call {@link #getOriginalPosition} to get this value.
+     * @param newPosition The new position, also expressed in terms of the original position.
+     */
+    public void moveItem(final int originalPosition, final int newPosition) {
+        mPlacementData.moveItem(originalPosition, newPosition);
+    }
+
+    private void notifyNeedsPlacement() {
+        // Avoid posting if this method has already been called.
+        if (mNeedsPlacement) {
+            return;
+        }
+        mNeedsPlacement = true;
+
+        // Post the placement to happen on the next UI render loop.
+        mPlacementHandler.post(mPlacementRunnable);
+    }
+
+    /**
+     * Places ads using the current visible range.
+     */
+    private void placeAds() {
+        // Place ads within the visible range
+        if (!tryPlaceAdsInRange(mVisibleRangeStart, mVisibleRangeEnd)) {
+            return;
+        }
+
+        // Place ads after the visible range so that user will see an ad if they scroll down. We
+        // don't place an ad before the visible range, because we are trying to be mindful of
+        // changes that will affect scrolling.
+        tryPlaceAdsInRange(mVisibleRangeEnd, mVisibleRangeEnd + RANGE_BUFFER);
+    }
+
+    /**
+     * Attempts to place ads in the range (start, end], returning false if there is no ad available
+     * to be placed.
+     */
+    private boolean tryPlaceAdsInRange(final int start, final int end) {
+        int position = start;
+        int lastPosition = end - 1;
+        while (position <= lastPosition && position != PlacementData.NOT_FOUND) {
+            if (position >= mItemCount) {
+                break;
+            }
+            if (mPlacementData.shouldPlaceAd(position)) {
+                if (!tryPlaceAd(position)) {
+                    return false;
+                }
+                lastPosition++;
+            }
+            position = mPlacementData.nextInsertionPosition(position);
+        }
+        return true;
+    }
+
+    /**
+     * Attempts to place an ad at the given position, returning false if there is no ad available to
+     * be placed.
+     */
+    private boolean tryPlaceAd(final int position) {
+        final NativeResponse adResponse = mAdSource.dequeueAd();
+        if (adResponse == null) {
+            return false;
+        }
+
+        final NativeAdData adData = createAdData(position, adResponse);
+        mPlacementData.placeAd(position, adData);
+        mItemCount++;
+
+        if (mAdLoadedListener != null) {
+            mAdLoadedListener.onAdLoaded(position);
+        }
+        return true;
+    }
+
+    private NativeAdData createAdData(final int position, final NativeResponse adResponse) {
+        return new NativeAdData(mAdUnitId, mAdRenderer, adResponse);
+    }
+
+    private void clearNativeResponse(final View view) {
+        mImpressionTracker.removeView(view);
+        final NativeResponse lastNativeResponse = mNativeResponseMap.get(view);
+        if (lastNativeResponse != null) {
+            lastNativeResponse.clear(view);
+        }
+    }
+
+    private void prepareNativeResponse(final NativeResponse nativeResponse, final View view) {
+        mNativeResponseMap.put(view, nativeResponse);
+        if (!nativeResponse.isOverridingImpressionTracker()) {
+            mImpressionTracker.addView(view, nativeResponse);
+        }
+        nativeResponse.prepare(view);
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdData.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdData.java
new file mode 100644
index 00000000..d4623a35
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdData.java
@@ -0,0 +1,30 @@
+package com.mopub.nativeads;
+
+/**
+ * An object that represents placed ads in a {@link com.mopub.nativeads.MoPubStreamAdPlacer}
+ */
+class NativeAdData {
+    private final String adUnitId;
+    private final MoPubAdRenderer adRenderer;
+    private final NativeResponse adResponse;
+
+    NativeAdData(final String adUnitId,
+            final MoPubAdRenderer adRenderer,
+            final NativeResponse adResponse) {
+        this.adUnitId = adUnitId;
+        this.adRenderer = adRenderer;
+        this.adResponse = adResponse;
+    }
+
+    String getAdUnitId() {
+        return adUnitId;
+    }
+
+    MoPubAdRenderer getAdRenderer() {
+        return adRenderer;
+    }
+
+    NativeResponse getAd() {
+        return adResponse;
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdInterface.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdInterface.java
index f4f247bd..d748a681 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdInterface.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdInterface.java
@@ -5,6 +5,8 @@
 import java.util.Map;
 import java.util.Set;
 
+import static com.mopub.nativeads.BaseForwardingNativeAd.NativeEventListener;
+
 interface NativeAdInterface {
     // Getters
     String getMainImageUrl();
@@ -19,13 +21,20 @@
     int getImpressionMinPercentageViewed();
     int getImpressionMinTimeViewed();
 
+    boolean isOverridingClickTracker();
+    boolean isOverridingImpressionTracker();
+
     // Extras Getters
     Object getExtra(final String key);
     Map<String, Object> getExtras();
 
+    // Setters
+    void setNativeEventListener(final NativeEventListener nativeEventListener);
+
     // Event Handlers
-    void prepareImpression(final View view);
+    void prepare(final View view);
     void recordImpression();
     void handleClick(final View view);
+    void clear(final View view);
     void destroy();
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdSource.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdSource.java
new file mode 100644
index 00000000..c354dcc9
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdSource.java
@@ -0,0 +1,239 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+import android.os.Handler;
+import android.os.SystemClock;
+
+import com.mopub.common.VisibleForTesting;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import static com.mopub.nativeads.MoPubNative.MoPubNativeNetworkListener;
+
+/**
+ * An ad source responsible for requesting ads from the MoPub ad server.
+ *
+ * The ad source utilizes a cache to store ads, which allows ads to be immediately visible when
+ * scrolling through a stream rather than "snapping" in when loaded. The cache is implemented as
+ * a queue, so that the first ad loaded from the server will be the first ad available for dequeue.
+ * To take an ad out of the cache, call {@link #dequeueAd}.
+ *
+ * The cache size may be automatically adjusted by the MoPub server based on an app's usage and
+ * ad fill rate. Cached ads have a maximum TTL of 15 minutes before which they expire.
+ *
+ * The ad source also takes care of retrying failed ad requests, with a reasonable back-off to
+ * avoid spamming the server.
+ *
+ * This class is not thread safe and should only be called from the UI thread.
+ */
+class NativeAdSource {
+    private static final int CACHE_LIMIT = 3;
+    private static final int EXPIRATION_TIME_MILLISECONDS = 15 * 60 * 1000; // 15 minutes
+    private static final int DEFAULT_RETRY_TIME_MILLISECONDS = 1000; // 1 second
+    private static final int MAXIMUM_RETRY_TIME_MILLISECONDS = 5 * 60 * 1000; // 5 minutes.
+    private static final double EXPONENTIAL_BACKOFF_FACTOR = 2.0;
+
+    private final List<TimestampWrapper<NativeResponse>> mNativeAdCache;
+    private final Handler mReplenishCacheHandler;
+    private final Runnable mReplenishCacheRunnable;
+    private final MoPubNativeNetworkListener mMoPubNativeNetworkListener;
+
+    @VisibleForTesting boolean mRequestInFlight;
+    @VisibleForTesting boolean mRetryInFlight;
+    @VisibleForTesting int mSequenceNumber;
+    @VisibleForTesting int mRetryTimeMilliseconds;
+
+    private AdSourceListener mAdSourceListener;
+
+    // We will need collections of these when we support multiple ad units.
+    private RequestParameters mRequestParameters;
+    private MoPubNative mMoPubNative;
+
+    /**
+     * A listener for when ads are available for dequeueing.
+     */
+    interface AdSourceListener {
+        /**
+         * Called when the number of items available for goes from 0 to more than 0.
+         */
+        void onAdsAvailable();
+    }
+
+    NativeAdSource() {
+        this(new ArrayList<TimestampWrapper<NativeResponse>>(CACHE_LIMIT), new Handler());
+    }
+
+    @VisibleForTesting
+    NativeAdSource(final List<TimestampWrapper<NativeResponse>> nativeAdCache,
+            final Handler replenishCacheHandler) {
+        mNativeAdCache = nativeAdCache;
+        mReplenishCacheHandler = replenishCacheHandler;
+        mReplenishCacheRunnable = new Runnable() {
+            @Override
+            public void run() {
+                mRetryInFlight = false;
+                replenishCache();
+            }
+        };
+
+        // Construct native URL and start filling the cache
+        mMoPubNativeNetworkListener = new MoPubNativeNetworkListener() {
+            @Override
+            public void onNativeLoad(final NativeResponse nativeResponse) {
+                // This can be null if the ad source was cleared as the AsyncTask is posting
+                // back to the UI handler. Drop this response.
+                if (mMoPubNative == null) {
+                    return;
+                }
+
+                mRequestInFlight = false;
+                mSequenceNumber++;
+                resetRetryTime();
+
+                mNativeAdCache.add(new TimestampWrapper<NativeResponse>(nativeResponse));
+                if (mNativeAdCache.size() == 1 && mAdSourceListener != null) {
+                    mAdSourceListener.onAdsAvailable();
+                }
+
+                replenishCache();
+            }
+
+            @Override
+            public void onNativeFail(final NativeErrorCode errorCode) {
+                // Reset the retry time for the next time we dequeue.
+                mRequestInFlight = false;
+
+                // Stopping requests after the max retry time prevents us from using battery when
+                // the user is not interacting with the stream, eg. the app is backgrounded.
+                if (mRetryTimeMilliseconds >= MAXIMUM_RETRY_TIME_MILLISECONDS) {
+                    resetRetryTime();
+                    return;
+                }
+
+                updateRetryTime();
+                mRetryInFlight = true;
+                mReplenishCacheHandler.postDelayed(mReplenishCacheRunnable, mRetryTimeMilliseconds);
+            }
+        };
+
+        mSequenceNumber = 0;
+        mRetryTimeMilliseconds = DEFAULT_RETRY_TIME_MILLISECONDS;
+    }
+
+    /**
+     * Sets a adSourceListener for determining when ads are available.
+     * @param adSourceListener An AdSourceListener.
+     */
+    void setAdSourceListener(final AdSourceListener adSourceListener) {
+        mAdSourceListener = adSourceListener;
+    }
+
+    void loadAds(final Context context,
+            final String adUnitId,
+            final RequestParameters requestParameters) {
+        loadAds(requestParameters, new MoPubNative(context, adUnitId, mMoPubNativeNetworkListener));
+    }
+
+    @VisibleForTesting
+    void loadAds(final RequestParameters requestParameters,
+             final MoPubNative moPubNative) {
+        clear();
+
+        mRequestParameters = requestParameters;
+        mMoPubNative = moPubNative;
+
+        replenishCache();
+    }
+
+    /**
+     * Clears the ad source, removing any currently queued ads.
+     */
+    void clear() {
+        // This will cleanup listeners to stop callbacks from handling old ad units
+        if (mMoPubNative != null) {
+            mMoPubNative.destroy();
+            mMoPubNative = null;
+        }
+
+        mRequestParameters = null;
+
+        for (final TimestampWrapper<NativeResponse> timestampWrapper : mNativeAdCache) {
+            timestampWrapper.mInstance.destroy();
+        }
+        mNativeAdCache.clear();
+
+        mReplenishCacheHandler.removeMessages(0);
+        mRequestInFlight = false;
+        mSequenceNumber = 0;
+        resetRetryTime();
+    }
+
+    /**
+     * Removes an ad from the front of the ad source cache.
+     *
+     * Dequeueing will automatically attempt to replenish the cache. Callers should dequeue ads as
+     * late as possible, typically immediately before rendering them into a view.
+     *
+     * Set the listener to {@code null} to remove the listener.
+     *
+     * @return Ad ad item that should be rendered into a view.
+     */
+    NativeResponse dequeueAd() {
+        final long now = SystemClock.uptimeMillis();
+
+        // Starting an ad request takes several millis. Post for performance reasons.
+        if (!mRequestInFlight && !mRetryInFlight) {
+            mReplenishCacheHandler.post(mReplenishCacheRunnable);
+        }
+
+        // Dequeue the first ad that hasn't expired.
+        while (!mNativeAdCache.isEmpty()) {
+            TimestampWrapper<NativeResponse> responseWrapper = mNativeAdCache.remove(0);
+
+            if (now - responseWrapper.mCreatedTimestamp < EXPIRATION_TIME_MILLISECONDS) {
+                return responseWrapper.mInstance;
+            }
+        }
+        return null;
+    }
+
+    @VisibleForTesting
+    void updateRetryTime() {
+        // Backoff time calculations
+        mRetryTimeMilliseconds = (int) (mRetryTimeMilliseconds * EXPONENTIAL_BACKOFF_FACTOR);
+        if (mRetryTimeMilliseconds > MAXIMUM_RETRY_TIME_MILLISECONDS) {
+            mRetryTimeMilliseconds = MAXIMUM_RETRY_TIME_MILLISECONDS;
+        }
+    }
+
+    @VisibleForTesting
+    void resetRetryTime() {
+        mRetryTimeMilliseconds = DEFAULT_RETRY_TIME_MILLISECONDS;
+    }
+
+    /**
+     * Replenish ads in the ad source cache.
+     *
+     * Calling this method is useful for warming the cache without dequeueing an ad.
+     */
+    @VisibleForTesting
+    void replenishCache() {
+        if (!mRequestInFlight && mMoPubNative != null && mNativeAdCache.size() < CACHE_LIMIT) {
+            mRequestInFlight = true;
+            mMoPubNative.loadNativeAd(mRequestParameters, mSequenceNumber);
+        }
+    }
+
+    @Deprecated
+    @VisibleForTesting
+    void setMoPubNative(final MoPubNative moPubNative) {
+        mMoPubNative = moPubNative;
+    }
+
+    @Deprecated
+    @VisibleForTesting
+    MoPubNativeNetworkListener getMoPubNativeNetworkListener() {
+        return mMoPubNativeNetworkListener;
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdViewHelper.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdViewHelper.java
index faf76da4..969d27d6 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdViewHelper.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeAdViewHelper.java
@@ -1,21 +1,36 @@
 package com.mopub.nativeads;
 
 import android.content.Context;
-import android.view.LayoutInflater;
 import android.view.View;
 import android.view.ViewGroup;
-import android.widget.Button;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+
+import java.util.WeakHashMap;
 
 import static android.view.View.GONE;
-import static android.view.View.OnClickListener;
-import static android.view.View.VISIBLE;
 import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
 
+/**
+ * @deprecated As of release 2.4, use {@link com.mopub.nativeads.MoPubNativeAdRenderer} instead
+ */
+@Deprecated
 class NativeAdViewHelper {
     private NativeAdViewHelper() {}
 
+    // Because the impression tracker requires tracking drawing views,
+    // each context requires a separate impression tracker. To avoid leaking, keep weak references.
+    @VisibleForTesting
+    static final WeakHashMap<Context, ImpressionTracker> sImpressionTrackerMap =
+            new WeakHashMap<Context, ImpressionTracker>();
+
+    // Used to keep track of the last NativeResponse a view was associated with in order to clean
+    // up its state before associating with a new NativeResponse
+    static private final WeakHashMap<View, NativeResponse> sNativeResponseMap =
+            new WeakHashMap<View, NativeResponse>();
+
+    @Deprecated
     static View getAdView(View convertView,
                           final ViewGroup parent,
                           final Context context,
@@ -28,15 +43,12 @@ static View getAdView(View convertView,
             return new View(context);
         }
 
+        final MoPubNativeAdRenderer moPubNativeAdRenderer = new MoPubNativeAdRenderer(viewBinder);
         if (convertView == null) {
-            convertView = createConvertView(context, parent, viewBinder);
+            convertView = moPubNativeAdRenderer.createAdView(context, parent);
         }
 
-        final NativeViewHolder nativeViewHolder = getOrCreateNativeViewHolder(convertView, viewBinder);
-
-        // Clean up previous state of view
-        removeClickListeners(convertView, nativeViewHolder);
-        ImpressionTrackingManager.removeView(convertView);
+        clearNativeResponse(context, convertView);
 
         if (nativeResponse == null) {
             // If we don't have content for the view, then hide the view for now
@@ -45,92 +57,38 @@ static View getAdView(View convertView,
         } else if (nativeResponse.isDestroyed()) {
             MoPubLog.d("NativeResponse is destroyed, returning hidden view.");
             convertView.setVisibility(GONE);
-        } else if (nativeViewHolder == null) {
-            MoPubLog.d("Could not create NativeViewHolder, returning hidden view.");
-            convertView.setVisibility(GONE);
         } else {
-            populateConvertViewSubViews(convertView, nativeViewHolder, nativeResponse, viewBinder);
-            attachClickListeners(convertView, nativeViewHolder, nativeResponse);
-            convertView.setVisibility(VISIBLE);
-            nativeResponse.prepareImpression(convertView);
+            prepareNativeResponse(context, convertView, nativeResponse);
+            moPubNativeAdRenderer.renderAdView(convertView, nativeResponse);
         }
 
         return convertView;
     }
 
-    private static View createConvertView(final Context context, final ViewGroup parent, final ViewBinder viewBinder) {
-        final View convertView = LayoutInflater
-                .from(context)
-                .inflate(viewBinder.layoutId, parent, false);
-        return convertView;
-    }
-
-    static NativeViewHolder getOrCreateNativeViewHolder(final View convertView, final ViewBinder viewBinder) {
-        // Create view holder and put it in the view tag
-        Object object = ImageViewService.getViewTag(convertView);
-        if (object == null || !(object instanceof NativeViewHolder)) {
-            final NativeViewHolder nativeViewHolder = NativeViewHolder.fromViewBinder(convertView, viewBinder);
-            ImageViewService.setViewTag(convertView, nativeViewHolder);
-            return nativeViewHolder;
-        } else {
-            return (NativeViewHolder) object;
-        }
-    }
-
-    private static void populateConvertViewSubViews(final View convertView,
-            final NativeViewHolder nativeViewHolder,
-            final NativeResponse nativeResponse,
-            final ViewBinder viewBinder) {
-        nativeViewHolder.update(nativeResponse);
-        nativeViewHolder.updateExtras(convertView, nativeResponse, viewBinder);
-    }
-
-    private static void removeClickListeners(final View view,
-                                             final NativeViewHolder nativeViewHolder) {
-        if (view == null) {
-            return;
+    private static void clearNativeResponse(final Context context, final View view) {
+        getImpressionTracker(context).removeView(view);
+        final NativeResponse nativeResponse = sNativeResponseMap.get(view);
+        if (nativeResponse != null) {
+            nativeResponse.clear(view);
         }
-
-        view.setOnClickListener(null);
-        setCtaClickListener(nativeViewHolder, null);
     }
 
-    private static void attachClickListeners(final View view,
-            final NativeViewHolder nativeViewHolder,
+    private static void prepareNativeResponse(final Context context,
+            final View view,
             final NativeResponse nativeResponse) {
-        if (view == null || nativeResponse == null) {
-            return;
-        }
-
-        final NativeViewClickListener nativeViewClickListener
-                = new NativeViewClickListener(nativeResponse);
-        view.setOnClickListener(nativeViewClickListener);
-        setCtaClickListener(nativeViewHolder, nativeViewClickListener);
-    }
-
-    private static void setCtaClickListener(final NativeViewHolder nativeViewHolder,
-            final NativeViewClickListener nativeViewClickListener) {
-        if (nativeViewHolder == null || nativeViewClickListener == null) {
-            return;
-        }
-
-        // CTA widget could be a button and buttons don't inherit click listeners from parents
-        // So we have to set it manually here if so
-        if (nativeViewHolder.callToActionView != null && nativeViewHolder.callToActionView instanceof Button) {
-            nativeViewHolder.callToActionView.setOnClickListener(nativeViewClickListener);
+        sNativeResponseMap.put(view, nativeResponse);
+        if (!nativeResponse.isOverridingImpressionTracker()) {
+            getImpressionTracker(context).addView(view, nativeResponse);
         }
+        nativeResponse.prepare(view);
     }
 
-    static class NativeViewClickListener implements OnClickListener {
-        private final NativeResponse mNativeResponse;
-
-        NativeViewClickListener(final NativeResponse nativeResponse) {
-            mNativeResponse = nativeResponse;
-        }
-
-        @Override
-        public void onClick(View view) {
-            mNativeResponse.handleClick(view);
+    private static ImpressionTracker getImpressionTracker(final Context context) {
+        ImpressionTracker impressionTracker = sImpressionTrackerMap.get(context);
+        if (impressionTracker == null) {
+            impressionTracker = new ImpressionTracker(context);
+            sImpressionTrackerMap.put(context, impressionTracker);
         }
+        return impressionTracker;
     }
 }
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeErrorCode.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeErrorCode.java
index c0d86de4..7999f22f 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeErrorCode.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeErrorCode.java
@@ -12,7 +12,7 @@
 
     NETWORK_INVALID_REQUEST("Third-party network received invalid request."),
     NETWORK_TIMEOUT("Third-party network failed to respond in a timely manner."),
-    NETWORK_NO_FILL("Third-party network failed to provide inventory."),
+    NETWORK_NO_FILL("Third-party network failed to provide an ad."),
     NETWORK_INVALID_STATE("Third-party network failed due to invalid internal state."),
 
     NATIVE_ADAPTER_CONFIGURATION_ERROR("Custom Event Native was configured incorrectly."),
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeResponse.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeResponse.java
index e353c2bf..c0eeb9ed 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeResponse.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeResponse.java
@@ -4,14 +4,17 @@
 import android.content.Intent;
 import android.net.Uri;
 import android.view.View;
+import android.view.ViewGroup;
 import android.widget.ImageView;
 
 import com.mopub.common.DownloadResponse;
 import com.mopub.common.HttpClient;
 import com.mopub.common.MoPubBrowser;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.IntentUtils;
-import com.mopub.common.util.MoPubLog;
 import com.mopub.common.util.ResponseHeader;
+import com.mopub.nativeads.MoPubNative.MoPubNativeEventListener;
 
 import java.lang.ref.SoftReference;
 import java.util.ArrayList;
@@ -22,8 +25,8 @@
 import java.util.Map;
 import java.util.Set;
 
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener.EMPTY_MOPUB_NATIVE_LISTENER;
+import static android.view.View.OnClickListener;
+import static com.mopub.nativeads.BaseForwardingNativeAd.NativeEventListener;
 import static com.mopub.nativeads.NativeResponse.Parameter.CALL_TO_ACTION;
 import static com.mopub.nativeads.NativeResponse.Parameter.CLICK_DESTINATION;
 import static com.mopub.nativeads.NativeResponse.Parameter.CLICK_TRACKER;
@@ -36,7 +39,7 @@
 import static com.mopub.nativeads.UrlResolutionTask.UrlResolutionListener;
 import static com.mopub.nativeads.UrlResolutionTask.getResolvedUrl;
 
-public final class NativeResponse {
+public class NativeResponse {
     enum Parameter {
         IMPRESSION_TRACKER("imptracker", true),
         CLICK_TRACKER("clktracker", true),
@@ -69,7 +72,8 @@ static Parameter from(final String name) {
             return null;
         }
 
-        static Set<String> requiredKeys = new HashSet<String>();
+        @VisibleForTesting
+        static final Set<String> requiredKeys = new HashSet<String>();
         static {
             for (final Parameter parameter : values()) {
                 if (parameter.required) {
@@ -79,25 +83,39 @@ static Parameter from(final String name) {
         }
     }
 
-    final Context mContext;
-    MoPubNativeListener mMoPubNativeListener;
-    final NativeAdInterface mNativeAd;
+    private final Context mContext;
+    private MoPubNativeEventListener mMoPubNativeEventListener;
+    private final NativeAdInterface mNativeAd;
 
     // Impression and click trackers for the MoPub adserver
-    final Set<String> mMoPubImpressionTrackers;
-    final String mMoPubClickTracker;
+    private final Set<String> mMoPubImpressionTrackers;
+    private final String mMoPubClickTracker;
+    private final String mAdUnitId;
 
-    boolean mRecordedImpression;
-    boolean mIsClicked;
-    boolean mIsDestroyed;
+    private boolean mRecordedImpression;
+    private boolean mIsClicked;
+    private boolean mIsDestroyed;
 
     public NativeResponse(final Context context,
             final DownloadResponse downloadResponse,
+            final String adUnitId,
             final NativeAdInterface nativeAd,
-            final MoPubNativeListener moPubNativeListener) {
+            final MoPubNativeEventListener moPubNativeEventListener) {
         mContext = context.getApplicationContext();
-        mMoPubNativeListener = moPubNativeListener;
+        mAdUnitId = adUnitId;
+        mMoPubNativeEventListener = moPubNativeEventListener;
         mNativeAd = nativeAd;
+        mNativeAd.setNativeEventListener(new NativeEventListener() {
+            @Override
+            public void onAdImpressed() {
+                recordImpression(null);
+            }
+
+            @Override
+            public void onAdClicked() {
+                handleClick(null);
+            }
+        });
 
         mMoPubImpressionTrackers = new HashSet<String>();
         mMoPubImpressionTrackers.add(downloadResponse.getFirstHeader(ResponseHeader.IMPRESSION_URL));
@@ -123,6 +141,10 @@ public String toString() {
         return stringBuilder.toString();
     }
 
+   public String getAdUnitId() {
+       return mAdUnitId;
+   }
+
     // Interface Methods
     // Getters
     public String getMainImageUrl() {
@@ -181,14 +203,25 @@ public Object getExtra(final String key) {
         return mNativeAd.getExtras();
     }
 
+    public boolean isOverridingImpressionTracker() {
+        return mNativeAd.isOverridingImpressionTracker();
+    }
+
+    public boolean isOverridingClickTracker() {
+        return mNativeAd.isOverridingClickTracker();
+    }
+
     // Event Handlers
-    public void prepareImpression(final View view) {
-        if (getRecordedImpression() || isDestroyed()) {
+    public void prepare(final View view) {
+        if (isDestroyed()) {
             return;
         }
 
-        ImpressionTrackingManager.addView(view, this);
-        mNativeAd.prepareImpression(view);
+        if (!isOverridingClickTracker()) {
+            setOnClickListener(view, new NativeViewClickListener());
+        }
+
+        mNativeAd.prepare(view);
     }
 
     public void recordImpression(final View view) {
@@ -203,7 +236,7 @@ public void recordImpression(final View view) {
         mNativeAd.recordImpression();
         mRecordedImpression = true;
 
-        mMoPubNativeListener.onNativeImpression(view);
+        mMoPubNativeEventListener.onNativeImpression(view);
     }
 
     public void handleClick(final View view) {
@@ -219,7 +252,13 @@ public void handleClick(final View view) {
         mNativeAd.handleClick(view);
         mIsClicked = true;
 
-        mMoPubNativeListener.onNativeClick(view);
+        mMoPubNativeEventListener.onNativeClick(view);
+    }
+
+    public void clear(final View view) {
+        setOnClickListener(view, null);
+
+        mNativeAd.clear(view);
     }
 
     public void destroy() {
@@ -227,7 +266,7 @@ public void destroy() {
             return;
         }
 
-        mMoPubNativeListener = EMPTY_MOPUB_NATIVE_LISTENER;
+        mMoPubNativeEventListener = MoPubNative.EMPTY_EVENT_LISTENER;
 
         mNativeAd.destroy();
         mIsDestroyed = true;
@@ -287,6 +326,15 @@ private void openClickDestinationUrl(final View view) {
         getResolvedUrl(urlIterator.next(), urlResolutionListener);
     }
 
+    private void setOnClickListener(final View view, final OnClickListener onClickListener) {
+        view.setOnClickListener(onClickListener);
+        if ((view instanceof ViewGroup)) {
+            ViewGroup viewGroup = (ViewGroup)view;
+            for (int i = 0; i < viewGroup.getChildCount(); i++)
+                setOnClickListener(viewGroup.getChildAt(i), onClickListener);
+        }
+    }
+
     private static class ClickDestinationUrlResolutionListener implements UrlResolutionListener {
         private final Context mContext;
         private final Iterator<String> mUrlIterator;
@@ -336,18 +384,26 @@ private void removeSpinningProgressView() {
         }
     }
 
+    @VisibleForTesting
+    class NativeViewClickListener implements OnClickListener {
+        @Override
+        public void onClick(final View view) {
+            handleClick(view);
+        }
+    }
+
     @Deprecated
     public String getSubtitle() {
         return mNativeAd.getText();
     }
 
-    // Testing
+    @VisibleForTesting
     @Deprecated
-    MoPubNativeListener getMoPubNativeListener() {
-        return mMoPubNativeListener;
+    MoPubNativeEventListener getMoPubNativeEventListener() {
+        return mMoPubNativeEventListener;
     }
 
-    // Testing
+    @VisibleForTesting
     @Deprecated
     void setRecordedImpression(final boolean recordedImpression) {
         mRecordedImpression = recordedImpression;
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java
index af13c917..bbcfbf7c 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java
@@ -2,20 +2,17 @@
 
 import android.content.Context;
 import android.location.Location;
-import android.os.Build;
-
+import android.text.TextUtils;
 import com.mopub.common.AdUrlGenerator;
-import com.mopub.common.GpsHelper;
+import com.mopub.common.ClientMetadata;
 import com.mopub.common.LocationService;
 import com.mopub.common.MoPub;
+import com.mopub.common.util.DateAndTime;
 import com.mopub.common.util.Strings;
 
 class NativeUrlGenerator extends AdUrlGenerator {
-    private static int sLocationPrecision = 6;
-    private static LocationService.LocationAwareness sLocationAwareness
-            = LocationService.LocationAwareness.NORMAL;
-
     private String mDesiredAssets;
+    private String mSequenceNumber;
 
     NativeUrlGenerator(Context context) {
         super(context);
@@ -36,55 +33,70 @@ NativeUrlGenerator withRequest(final RequestParameters requestParameters) {
         return this;
     }
 
+    NativeUrlGenerator withSequenceNumber(final int sequenceNumber) {
+        mSequenceNumber = String.valueOf(sequenceNumber);
+        return this;
+    }
+
     @Override
     public String generateUrlString(final String serverHostname) {
         initUrlString(serverHostname, Constants.NATIVE_HANDLER);
 
         setAdUnitId(mAdUnitId);
 
-        setSdkVersion(MoPub.SDK_VERSION);
-
-        setDeviceInfo(Build.MANUFACTURER, Build.MODEL, Build.PRODUCT);
-
-        setUdid(getUdidFromContext(mContext));
-
-        setDoNotTrack(GpsHelper.isLimitAdTrackingEnabled(mContext));
-
         setKeywords(mKeywords);
 
         Location location = mLocation;
         if (location == null) {
             location = LocationService.getLastKnownLocation(mContext,
-                                                            sLocationPrecision,
-                                                            sLocationAwareness);
+                    MoPub.getLocationPrecision(),
+                    MoPub.getLocationAwareness());
         }
-
         setLocation(location);
 
-        setTimezone(getTimeZoneOffsetString());
+        ClientMetadata clientMetadata = ClientMetadata.getInstance(mContext);
+        setSdkVersion(clientMetadata.getSdkVersion());
+
+        setDeviceInfo(clientMetadata.getDeviceManufacturer(),
+                clientMetadata.getDeviceModel(),
+                clientMetadata.getDeviceProduct());
+
+        setUdid(clientMetadata.getUdid());
+
+        setDoNotTrack(clientMetadata.getDoNoTrack());
 
-        setOrientation(mContext.getResources().getConfiguration().orientation);
+        setTimezone(DateAndTime.getTimeZoneOffsetString());
 
-        setDensity(mContext.getResources().getDisplayMetrics().density);
+        setOrientation(clientMetadata.getOrientationString());
 
-        String networkOperator = getNetworkOperator();
+        setDensity(clientMetadata.getDensity());
+
+        String networkOperator = clientMetadata.getNetworkOperator();
         setMccCode(networkOperator);
         setMncCode(networkOperator);
 
-        setIsoCountryCode(mTelephonyManager.getNetworkCountryIso());
-        setCarrierName(mTelephonyManager.getNetworkOperatorName());
+        setIsoCountryCode(clientMetadata.getIsoCountryCode());
+        setCarrierName(clientMetadata.getNetworkOperatorName());
 
-        setNetworkType(getActiveNetworkType());
+        setNetworkType(clientMetadata.getActiveNetworkType());
 
-        setAppVersion(getAppVersionFromContext(mContext));
+        setAppVersion(clientMetadata.getAppVersion());
 
         setTwitterAppInstalledFlag();
 
         setDesiredAssets();
 
+        setSequenceNumber();
+
         return getFinalUrlString();
     }
 
+    private void setSequenceNumber() {
+       if (!TextUtils.isEmpty(mSequenceNumber)) {
+           addParam("MAGIC_NO", mSequenceNumber);
+       }
+    }
+
     private void setDesiredAssets() {
         if (mDesiredAssets != null && !Strings.isEmpty(mDesiredAssets)) {
             addParam("assets", mDesiredAssets);
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeViewHolder.java b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeViewHolder.java
index 9e81b899..0ca2dc4a 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/NativeViewHolder.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/NativeViewHolder.java
@@ -4,7 +4,7 @@
 import android.widget.ImageView;
 import android.widget.TextView;
 
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 class NativeViewHolder {
     TextView titleView;
@@ -17,7 +17,7 @@
     private NativeViewHolder() {}
 
     static NativeViewHolder fromViewBinder(final View view, final ViewBinder viewBinder) {
-        NativeViewHolder nativeViewHolder = new NativeViewHolder();
+        final NativeViewHolder nativeViewHolder = new NativeViewHolder();
 
         try {
             nativeViewHolder.titleView = (TextView) view.findViewById(viewBinder.titleId);
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/PlacementData.java b/mopub-sdk/src/main/java/com/mopub/nativeads/PlacementData.java
new file mode 100644
index 00000000..cb4e21df
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/PlacementData.java
@@ -0,0 +1,520 @@
+package com.mopub.nativeads;
+
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+
+import java.util.List;
+
+/**
+ * A data that represents placed ads in a {@link com.mopub.nativeads.MoPubStreamAdPlacer},
+ * useful for tracking insertion and placed ad positions.
+ *
+ * It maintains four lists of integers
+ * 1) Desired insertion positions - positions to place ads
+ * 2) Desired original positions - original position for each ad to place
+ * 2) Adjusted ad positions - ad positions that were placed
+ * 3) Original ad positions - original position of the item after each placed ad
+ *
+ * For example, consider the following ad positions:
+ * ORIGINAL LIST    ADJUSTED LIST
+ *   Item 0           Item 0
+ *   Item 1           Ad
+ *   Item 2           Item 1
+ *   Item 3           Ad
+ *                    Item 2
+ *                    Ad
+ *                    Item 3
+ *
+ * List starts as:
+ *   Item 0
+ *   Item 1
+ *   Item 2
+ *   Item 3
+ * desiredOriginalPositions: {1, 2, 3}
+ * desiredInsertionPositions: {1, 2, 3}
+ * originalPositions: {}
+ * adjustedPositions: {}
+ *
+ * If we place at position 2:
+ *   Item 0
+ *   Item 1
+ *   Ad
+ *   Item 2
+ *   Item 3
+ * desiredOriginalPositions: {1, 3}
+ * desiredInsertionPositions: {1, 4}
+ * originalPositions: {2}
+ * adjustedPositions: {2}
+ *
+ * If the developer adds a content item at position 2
+ *   Item 0
+ *   Item 1
+ *   New Item
+ *   Ad
+ *   Item 3
+ *   Item 4
+ * desiredOriginalPositions: {1, 4}
+ * desiredInsertionPositions: {1, 5}
+ * originalPositions: {3}
+ * adjustedPositions: {3}
+ *
+ * Now, place at position 1
+ *   Item 0
+ *   Ad
+ *   Item 1
+ *   New Item
+ *   Ad
+ *   Item 3
+ *   Item 4
+ * desiredOriginalPositions: {4}
+ * desiredInsertionPositions: {6}
+ * originalPositions: {1, 3}
+ * adjustedPositions: {1, 4}
+ *
+ * Place at position 6
+ *   Item 0
+ *   Ad
+ *   Item 1
+ *   New Item
+ *   Ad
+ *   Item 3
+ *   Ad
+ *   Item 4
+ * desiredOriginalPositions: {}
+ * desiredInsertionPositions: {}
+ * originalPositions: {1, 3, 4}
+ * adjustedPositions: {1, 4, 6}
+ *
+ * Clear ad at position 1
+ *   Item 0
+ *   Item 1
+ *   New Item
+ *   Ad
+ *   Item 3
+ *   Ad
+ *   Item 4
+ * desiredOriginalPositions: {1}
+ * desiredInsertionPositions: {1}
+ * originalPositions: {3, 4}
+ * adjustedPositions: {3, 5}
+ *
+ * Clear ad at position 5
+ *   Item 0
+ *   Item 1
+ *   New Item
+ *   Ad
+ *   Item 3
+ *   Item 4
+ * desiredOriginalPositions: {1, 4}
+ * desiredInsertionPositions: {1, 5}
+ * originalPositions: {3}
+ * adjustedPositions: {3}
+ *
+ * Some runtime guarantees in terms of number of insertion ads:
+ * - Finds the next or previous insertion position in O(logN)
+ * - Maps from adjusted to original positions and vice versa in O(logN)
+ * - Places an ad (moves positions from desired to placed) in O(N)
+ */
+class PlacementData {
+    /**
+     * Returned when positions are not found.
+     */
+    public final static int NOT_FOUND = -1;
+
+    // Cap the number of ads to avoid unrestrained memory usage. 200 allows the 5 positioning
+    // arrays to fit in less than 4K.
+    private final static int MAX_ADS = 200;
+
+    // Initialize all of these to their max capacity. This prevents garbage collection when
+    // reallocating the list, which causes noticeable stuttering when scrolling on some devices.
+    private final int[] mDesiredOriginalPositions = new int[MAX_ADS];
+    private final int[] mDesiredInsertionPositions = new int[MAX_ADS];
+    private int mDesiredCount = 0;
+    private final int[] mOriginalAdPositions = new int[MAX_ADS];
+    private final int[] mAdjustedAdPositions = new int[MAX_ADS];
+    private final NativeAdData[] mAdDataObjects = new NativeAdData[MAX_ADS];
+    private int mPlacedCount = 0;
+
+    /**
+     * @param desiredInsertionPositions Insertion positions, expressed as original positions
+     */
+    private PlacementData(final int[] desiredInsertionPositions) {
+        mDesiredCount = Math.min(desiredInsertionPositions.length, MAX_ADS);
+        System.arraycopy(desiredInsertionPositions, 0, mDesiredInsertionPositions, 0, mDesiredCount);
+        System.arraycopy(desiredInsertionPositions, 0, mDesiredOriginalPositions, 0, mDesiredCount);
+    }
+
+    static PlacementData fromAdPositioning(final MoPubClientPositioning adPositioning) {
+        final List<Integer> fixed = adPositioning.getFixedPositions();
+        final int interval = adPositioning.getRepeatingInterval();
+
+        final int size = (interval == MoPubClientPositioning.NO_REPEAT ? fixed.size() : MAX_ADS);
+        final int[] desiredInsertionPositions = new int[size];
+
+        // Fixed positions are in terms of final positions. Calculate current insertion positions
+        // by decrementing numAds at each index.
+        int numAds = 0;
+        int lastPos = 0;
+        for (final Integer position : fixed) {
+            lastPos = position - numAds;
+            desiredInsertionPositions[numAds++] = lastPos;
+        }
+
+        // Expand the repeating positions, if there are any
+        while (numAds < size) {
+            lastPos = lastPos + interval - 1;
+            desiredInsertionPositions[numAds++] = lastPos;
+        }
+        return new PlacementData(desiredInsertionPositions);
+    }
+
+    static PlacementData empty() {
+        return new PlacementData(new int[] {});
+    }
+
+    /**
+     * Whether the given position should be an ad.
+     */
+    boolean shouldPlaceAd(final int position) {
+        final int index = binarySearch(mDesiredInsertionPositions, 0, mDesiredCount, position);
+        return index >= 0;
+    }
+
+    /**
+     * The next position after this position that should be an ad. Returns NOT_FOUND if there are no
+     * more ads.
+     */
+    int nextInsertionPosition(final int position) {
+        final int index = binarySearchGreaterThan(
+                mDesiredInsertionPositions, mDesiredCount, position);
+        if (index == mDesiredCount) {
+            return NOT_FOUND;
+        }
+        return mDesiredInsertionPositions[index];
+    }
+
+    /**
+     * The next position after this position that should be an ad. Returns NOT_FOUND if there
+     * are no more ads.
+     */
+    int previousInsertionPosition(final int position) {
+        final int index = binarySearchFirstEquals(
+                mDesiredInsertionPositions,  mDesiredCount, position);
+        if (index == 0) {
+            return NOT_FOUND;
+        }
+        return mDesiredInsertionPositions[index - 1];
+    }
+
+    /**
+     * Sets ad data at the given position.
+     */
+    void placeAd(final int adjustedPosition, final NativeAdData adData) {
+        // See if this is a insertion ad
+        final int desiredIndex = binarySearchFirstEquals(
+                mDesiredInsertionPositions, mDesiredCount, adjustedPosition);
+        if (desiredIndex == mDesiredCount
+                || mDesiredInsertionPositions[desiredIndex] != adjustedPosition) {
+            MoPubLog.w("Attempted to insert an ad at an invalid position");
+            return;
+        }
+
+        // Add to placed array
+        final int originalPosition = mDesiredOriginalPositions[desiredIndex];
+        int placeIndex = binarySearchGreaterThan(
+                mOriginalAdPositions, mPlacedCount, originalPosition);
+        if (placeIndex < mPlacedCount) {
+            final int num = mPlacedCount - placeIndex;
+            System.arraycopy(mOriginalAdPositions, placeIndex,
+                    mOriginalAdPositions, placeIndex + 1, num);
+            System.arraycopy(mAdjustedAdPositions, placeIndex,
+                    mAdjustedAdPositions, placeIndex + 1, num);
+            System.arraycopy(mAdDataObjects, placeIndex, mAdDataObjects, placeIndex + 1, num);
+        }
+        mOriginalAdPositions[placeIndex] = originalPosition;
+        mAdjustedAdPositions[placeIndex] = adjustedPosition;
+        mAdDataObjects[placeIndex] = adData;
+        mPlacedCount++;
+
+        // Remove desired index
+        final int num = mDesiredCount - desiredIndex - 1;
+        System.arraycopy(mDesiredInsertionPositions, desiredIndex + 1,
+                mDesiredInsertionPositions, desiredIndex, num);
+        System.arraycopy(mDesiredOriginalPositions, desiredIndex + 1,
+                mDesiredOriginalPositions, desiredIndex, num);
+        mDesiredCount--;
+
+        // Increment adjusted positions
+        for (int i = desiredIndex; i < mDesiredCount; ++i) {
+            mDesiredInsertionPositions[i]++;
+        }
+        for (int i = placeIndex + 1; i < mPlacedCount; ++i) {
+            mAdjustedAdPositions[i]++;
+        }
+    }
+
+    /**
+     * @see {@link com.mopub.nativeads.MoPubStreamAdPlacer#isAd(int)}
+     */
+    boolean isPlacedAd(final int position) {
+        final int index = binarySearch(mAdjustedAdPositions, 0, mPlacedCount, position);
+        return index >= 0;
+    }
+
+    /**
+     * Returns the ad data associated with the given ad position, or {@code null} if there is
+     * no ad at this position.
+     */
+    NativeAdData getPlacedAd(final int position) {
+        final int index = binarySearch(mAdjustedAdPositions, 0, mPlacedCount, position);
+        if (index < 0) {
+            return null;
+        }
+        return mAdDataObjects[index];
+    }
+
+    /**
+     * Returns all placed ad positions. This method allocates new memory on every invocation. Do
+     * not call it from performance critical code.
+     */
+    int[] getPlacedAdPositions() {
+        int[] positions = new int[mPlacedCount];
+        System.arraycopy(mAdjustedAdPositions, 0, positions, 0, mPlacedCount);
+        return positions;
+    }
+
+    /**
+     * @see com.mopub.nativeads.MoPubStreamAdPlacer#getOriginalPosition(int)
+     */
+    int getOriginalPosition(final int position) {
+        final int index = binarySearch(mAdjustedAdPositions, 0, mPlacedCount, position);
+
+        // No match, ~index is the number of ads before this pos.
+        if (index < 0) {
+            return position - ~index;
+        }
+
+        // This is an ad - there is no original position
+        return NOT_FOUND;
+    }
+
+    /**
+     * @see com.mopub.nativeads.MoPubStreamAdPlacer#getAdjustedPosition(int)
+     */
+    int getAdjustedPosition(final int originalPosition) {
+        // This is an ad. Since binary search doesn't properly handle dups, find the first non-ad.
+        int index = binarySearchGreaterThan(mOriginalAdPositions, mPlacedCount, originalPosition);
+        return originalPosition + index;
+    }
+
+    /**
+     * @see com.mopub.nativeads.MoPubStreamAdPlacer#getOriginalCount(int)
+     */
+    int getOriginalCount(final int count) {
+        if (count == 0) {
+            return 0;
+        }
+
+        // The last item will never be an ad
+        final int originalPos = getOriginalPosition(count - 1);
+        return (originalPos == NOT_FOUND) ? NOT_FOUND : originalPos + 1;
+    }
+
+    /**
+     * @see com.mopub.nativeads.MoPubStreamAdPlacer#getAdjustedCount(int)
+     */
+    int getAdjustedCount(final int originalCount) {
+        if (originalCount == 0) {
+            return 0;
+        }
+        return getAdjustedPosition(originalCount - 1) + 1;
+    }
+
+    /**
+     * Clears the ads in the given range. After calling this method, the ad positions
+     * will be removed from the placed ad positions and put back into the desired ad insertion
+     * positions.
+     */
+    int clearAdsInRange(final int adjustedStartRange, final int adjustedEndRange) {
+        // Temporary arrays to store the cleared positions. Using temporary arrays makes it
+        // easy to debug what positions are being cleared.
+        int[] clearOriginalPositions = new int[mPlacedCount];
+        int[] clearAdjustedPositions = new int[mPlacedCount];
+        int clearCount = 0;
+
+        // Add to the clear position arrays any positions that fall inside
+        // [adjustedRangeStart, adjustedRangeEnd).
+        for (int i = 0; i < mPlacedCount; ++i) {
+            int originalPosition = mOriginalAdPositions[i];
+            int adjustedPosition = mAdjustedAdPositions[i];
+            if (adjustedStartRange <= adjustedPosition && adjustedPosition < adjustedEndRange) {
+                // When copying adjusted positions, subtract the current clear count because there
+                // is no longer an ad incrementing the desired insertion position.
+                clearOriginalPositions[clearCount] = originalPosition;
+                clearAdjustedPositions[clearCount] = adjustedPosition - clearCount;
+
+                // Destroying and nulling out the ad objects to avoids a memory leak.
+                mAdDataObjects[i].getAd().destroy();
+                mAdDataObjects[i] = null;
+                clearCount++;
+            } else if (clearCount > 0) {
+                // The position is not in the range; shift it by the number of cleared ads.
+                int newIndex = i - clearCount;
+                mOriginalAdPositions[newIndex] = originalPosition;
+                mAdjustedAdPositions[newIndex] = adjustedPosition - clearCount;
+                mAdDataObjects[newIndex] = mAdDataObjects[i];
+            }
+        }
+
+        // If we have cleared nothing, this method was a no-op.
+        if (clearCount == 0) {
+            return 0;
+        }
+
+        // Modify the desired positions arrays in order to make space to put back the
+        // cleared ad positions. For example if the desired array was {1, 10,
+        // 15} and we need to insert {3, 7} we'll shift the desired array to be {1, ?, ? , 10, 15}.
+        int firstCleared = clearAdjustedPositions[0];
+        int desiredIndex = binarySearchFirstEquals(
+                mDesiredInsertionPositions, mDesiredCount, firstCleared);
+        for (int i = mDesiredCount - 1; i >= desiredIndex; --i) {
+            mDesiredOriginalPositions[i + clearCount] = mDesiredOriginalPositions[i];
+            mDesiredInsertionPositions[i + clearCount] = mDesiredInsertionPositions[i] - clearCount;
+        }
+
+        // Copy the cleared ad positions into the desired arrays.
+        for (int i = 0; i < clearCount; ++i) {
+            mDesiredOriginalPositions[desiredIndex + i] = clearOriginalPositions[i];
+            mDesiredInsertionPositions[desiredIndex + i] = clearAdjustedPositions[i];
+        }
+
+        // Update the array counts, and we're done.
+        mDesiredCount = mDesiredCount + clearCount;
+        mPlacedCount = mPlacedCount - clearCount;
+        return clearCount;
+    }
+
+    /**
+     * Clears the ads in the given range. After calling this method the ad's position
+     * will be back to the desired insertion positions.
+     */
+    void clearAds() {
+        if (mPlacedCount == 0) {
+            return;
+        }
+
+        clearAdsInRange(0, mAdjustedAdPositions[mPlacedCount - 1] + 1);
+    }
+
+    /**
+     * @see com.mopub.nativeads.MoPubStreamAdPlacer#insertItem(int)
+     */
+    void insertItem(final int originalPosition) {
+
+        // Increment desired arrays.
+        int indexToIncrement = binarySearchFirstEquals(
+                mDesiredOriginalPositions, mDesiredCount, originalPosition);
+        for (int i = indexToIncrement; i < mDesiredCount; ++i) {
+            mDesiredOriginalPositions[i]++;
+            mDesiredInsertionPositions[i]++;
+        }
+
+        // Increment placed arrays.
+        indexToIncrement = binarySearchFirstEquals(
+                mOriginalAdPositions, mPlacedCount, originalPosition);
+        for (int i = indexToIncrement; i < mPlacedCount; ++i) {
+            mOriginalAdPositions[i]++;
+            mAdjustedAdPositions[i]++;
+        }
+    }
+
+    /**
+     * @see com.mopub.nativeads.MoPubStreamAdPlacer#removeItem(int)
+     */
+    void removeItem(final int originalPosition) {
+        // When removing items, we only decrement ad position values *greater* than the original
+        // position we're removing. The original position associated with an ad is the original
+        // position of the first content item after the ad, so we shouldn't change the original
+        // position of an ad that matches the original position removed.
+        int indexToDecrement = binarySearchGreaterThan(
+                mDesiredOriginalPositions, mDesiredCount, originalPosition);
+
+        // Decrement desired arrays.
+        for (int i = indexToDecrement; i < mDesiredCount; ++i) {
+            mDesiredOriginalPositions[i]--;
+            mDesiredInsertionPositions[i]--;
+        }
+
+        indexToDecrement = binarySearchGreaterThan(
+                mOriginalAdPositions, mPlacedCount, originalPosition);
+
+        for (int i = indexToDecrement; i < mPlacedCount; ++i) {
+            mOriginalAdPositions[i]--;
+            mAdjustedAdPositions[i]--;
+        }
+    }
+
+    /**
+     * @see com.mopub.nativeads.MoPubStreamAdPlacer#moveItem(int, int)
+     */
+    void moveItem(final int originalPosition, final int newPosition) {
+        removeItem(originalPosition);
+        insertItem(newPosition);
+    }
+
+    private static int binarySearchFirstEquals(int[] array, int count, int value) {
+        int index = binarySearch(array, 0, count, value);
+
+        // If not found, binarySearch returns the 2's complement of the index of the nearest
+        // value higher than the target value, which is also the insertion index.
+        if (index < 0) {
+            return ~index;
+        }
+
+        int duplicateValue = array[index];
+        while (index >= 0 && array[index] == duplicateValue) {
+            index--;
+        }
+
+        return index + 1;
+    }
+
+    private static int binarySearchGreaterThan(int[] array, int count, int value) {
+        int index = binarySearch(array, 0, count, value);
+
+        // If not found, binarySearch returns the 2's complement of the index of the nearest
+        // value higher than the target value, which is also the insertion index.
+        if (index < 0) {
+            return ~index;
+        }
+
+        int duplicateValue = array[index];
+        while (index < count && array[index] == duplicateValue) {
+            index++;
+        }
+
+        return index;
+    }
+
+    /**
+     * Copied from Arrays.java, which isn't available until Gingerbread.
+     */
+    private static int binarySearch(int[] array, int startIndex, int endIndex, int value) {
+        int lo = startIndex;
+        int hi = endIndex - 1;
+
+        while (lo <= hi) {
+            int mid = (lo + hi) >>> 1;
+            int midVal = array[mid];
+
+            if (midVal < value) {
+                lo = mid + 1;
+            } else if (midVal > value) {
+                hi = mid - 1;
+            } else {
+                return mid;  // value found
+            }
+        }
+        return ~lo;  // value not present
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/PositioningSource.java b/mopub-sdk/src/main/java/com/mopub/nativeads/PositioningSource.java
new file mode 100644
index 00000000..354ea6df
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/PositioningSource.java
@@ -0,0 +1,21 @@
+package com.mopub.nativeads;
+
+import android.os.Handler;
+
+import com.mopub.common.VisibleForTesting;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+
+/**
+ * Allows asynchronously requesting positioning information.
+ */
+interface PositioningSource {
+
+    interface PositioningListener {
+        void onLoad(MoPubClientPositioning positioning);
+
+        void onFailed();
+    }
+
+    void loadPositions(String adUnitId, PositioningListener listener);
+
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/PositioningUrlGenerator.java b/mopub-sdk/src/main/java/com/mopub/nativeads/PositioningUrlGenerator.java
new file mode 100644
index 00000000..954eae59
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/PositioningUrlGenerator.java
@@ -0,0 +1,53 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+
+import com.mopub.common.BaseUrlGenerator;
+import com.mopub.common.ClientMetadata;
+
+class PositioningUrlGenerator extends BaseUrlGenerator {
+    private static final String POSITIONING_API_VERSION = "1";
+
+    private final Context mContext;
+    private String mAdUnitId;
+
+    public PositioningUrlGenerator(Context context) {
+        mContext = context;
+    }
+
+    public PositioningUrlGenerator withAdUnitId(final String adUnitId) {
+        mAdUnitId = adUnitId;
+        return this;
+    }
+
+    @Override
+    public String generateUrlString(final String serverHostname) {
+        initUrlString(serverHostname, Constants.POSITIONING_HANDLER);
+
+        setAdUnitId(mAdUnitId);
+
+        setApiVersion(POSITIONING_API_VERSION);
+
+        ClientMetadata clientMetadata = ClientMetadata.getInstance(mContext);
+
+        setSdkVersion(clientMetadata.getSdkVersion());
+
+        setDeviceInfo(clientMetadata.getDeviceManufacturer(),
+                clientMetadata.getDeviceModel(),
+                clientMetadata.getDeviceProduct());
+
+        setUdid(clientMetadata.getUdid());
+
+        setAppVersion(clientMetadata.getAppVersion());
+
+        return getFinalUrlString();
+    }
+
+    private void setAdUnitId(String adUnitId) {
+        addParam("id", adUnitId);
+    }
+
+    private void setSdkVersion(String sdkVersion) {
+        addParam("nsv", sdkVersion);
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ServerPositioningSource.java b/mopub-sdk/src/main/java/com/mopub/nativeads/ServerPositioningSource.java
new file mode 100644
index 00000000..55049bd4
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/ServerPositioningSource.java
@@ -0,0 +1,241 @@
+package com.mopub.nativeads;
+
+import android.content.Context;
+import android.os.Handler;
+
+import com.mopub.common.DownloadResponse;
+import com.mopub.common.DownloadTask;
+import com.mopub.common.DownloadTask.DownloadTaskListener;
+import com.mopub.common.HttpClient;
+import com.mopub.common.HttpResponses;
+import com.mopub.common.Preconditions;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.util.AsyncTasks;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+
+import org.apache.http.HttpStatus;
+import org.apache.http.client.methods.HttpGet;
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+
+/**
+ * Requests positioning information from the MoPub ad server.
+ *
+ * The expected JSON format contains a set of rules for fixed and repeating positions. For example:
+ * {
+ *   fixed: [{
+ *     position: 7
+ *   }, {
+ *     section : 1
+ *     position: 6
+ *   }],
+ *   repeating:  {
+ *     interval: 12
+ *   }
+ * }
+ *
+ * Both fixed and repeating rules are optional. If they exist they must follow the following
+ * guidelines:
+ *
+ * fixed - contains a set of positioning objects, each with an optional section and a required
+ * position. Section is used for iOS clients only, and non-zero sections are ignored on Android.
+ *
+ * repeating - contains a required interval, which must be 2 or greater.
+ *
+ * The JSON parsing logic treats any violations to the above spec as invalid,
+ * rather than trying to continue with a partially valid response.
+ */
+class ServerPositioningSource implements PositioningSource {
+
+    private static final double DEFAULT_RETRY_TIME_MILLISECONDS = 1000; // 1 second
+    private static final double EXPONENTIAL_BACKOFF_FACTOR = 2;
+
+    @VisibleForTesting
+    static int MAXIMUM_RETRY_TIME_MILLISECONDS = 5 * 60 * 1000; // 5 minutes.
+
+    private static final String FIXED_KEY = "fixed";
+    private static final String SECTION_KEY = "section";
+    private static final String POSITION_KEY = "position";
+    private static final String REPEATING_KEY = "repeating";
+    private static final String INTERVAL_KEY = "interval";
+
+    // Max value to avoid bad integer math calculations. This is 2 ^ 16.
+    private static final int MAX_VALUE = 1 << 16;
+
+    private final Context mContext;
+
+    private final DownloadTaskProvider mDownloadTaskProvider;
+
+    // Handler and runnable for retrying after a failed response.
+    private final Handler mRetryHandler;
+    private final Runnable mRetryRunnable;
+
+    // Only exists while a request is in flight.
+    private DownloadTask mDownloadTask;
+
+    private PositioningListener mListener;
+    private int mRetryCount;
+    private String mRetryUrl;
+
+    ServerPositioningSource(final Context context) {
+        this(context, new DownloadTaskProvider());
+    }
+
+    @VisibleForTesting
+    ServerPositioningSource(final Context context,
+            final DownloadTaskProvider downloadTaskProvider) {
+        mContext = context.getApplicationContext();
+        mDownloadTaskProvider = downloadTaskProvider;
+        mRetryHandler = new Handler();
+        mRetryRunnable = new Runnable() {
+            @Override
+            public void run() {
+                requestPositioningInternal();
+            }
+        };
+    }
+
+    @Override
+    public void loadPositions(String adUnitId, PositioningListener listener) {
+        // If a request is in flight, remove it.
+        if (mDownloadTask != null) {
+            mDownloadTask.cancel(true);
+            mDownloadTask = null;
+        }
+
+        // If a retry is pending remove it.
+        if (mRetryCount > 0) {
+            mRetryHandler.removeCallbacks(mRetryRunnable);
+            mRetryCount = 0;
+        }
+
+        mListener = listener;
+        mRetryUrl = new PositioningUrlGenerator(mContext)
+                .withAdUnitId(adUnitId)
+                .generateUrlString(Constants.POSITIONING_HOST);
+        requestPositioningInternal();
+    }
+
+    private void requestPositioningInternal() {
+        MoPubLog.d("Loading positioning from: " + mRetryUrl);
+        mDownloadTask = mDownloadTaskProvider.get(mTaskListener);
+        final HttpGet httpGet = HttpClient.initializeHttpGet(mRetryUrl, mContext);
+        AsyncTasks.safeExecuteOnExecutor(mDownloadTask, httpGet);
+    }
+
+    private DownloadTaskListener mTaskListener = new DownloadTask.DownloadTaskListener() {
+        @Override
+        public void onComplete(final String url, final DownloadResponse downloadResponse) {
+            // Will be null only if cancelled.
+            if (downloadResponse == null) {
+                return;
+            }
+
+            mDownloadTask = null;
+            if (downloadResponse.getStatusCode() != HttpStatus.SC_OK) {
+                MoPubLog.e("Invalid positioning download response ");
+                handleFailure();
+                return;
+            }
+
+            String responseText = HttpResponses.asResponseString(downloadResponse);
+            MoPubClientPositioning positioning;
+            try {
+                positioning = parseJsonResponse(responseText);
+            } catch (JSONException exception) {
+                MoPubLog.e("Error parsing JSON: ", exception);
+                handleFailure();
+                return;
+            }
+
+            handleSuccess(positioning);
+        }
+    };
+
+    @VisibleForTesting
+    static class DownloadTaskProvider {
+        DownloadTask get(DownloadTaskListener listener) {
+            return new DownloadTask(listener);
+        }
+    }
+
+    private void handleSuccess(MoPubClientPositioning positioning) {
+        mListener.onLoad(positioning);
+        mListener = null;
+        mRetryCount = 0;
+    }
+
+    private void handleFailure() {
+        double multiplier = Math.pow(EXPONENTIAL_BACKOFF_FACTOR, mRetryCount + 1);
+        int delay = (int) (DEFAULT_RETRY_TIME_MILLISECONDS * multiplier);
+        if (delay >= MAXIMUM_RETRY_TIME_MILLISECONDS) {
+            MoPubLog.d("Error downloading positioning information");
+            mListener.onFailed();
+            mListener = null;
+            return;
+        }
+
+        mRetryCount++;
+        mRetryHandler.postDelayed(mRetryRunnable, delay);
+    }
+
+    @VisibleForTesting
+    MoPubClientPositioning parseJsonResponse(String json) throws JSONException {
+        if (json == null || json.equals("")) {
+            throw new JSONException("Empty response");
+        }
+
+        // If the server returns an error explicitly, throw an error with the message.
+        JSONObject jsonObject = new JSONObject(json);
+        String error = jsonObject.optString("error", null);
+        if (error != null) {
+            throw new JSONException(error);
+        }
+
+        // Parse fixed and repeating rules.
+        JSONArray fixed = jsonObject.optJSONArray(FIXED_KEY);
+        JSONObject repeating = jsonObject.optJSONObject(REPEATING_KEY);
+        MoPubClientPositioning positioning = new MoPubClientPositioning();
+        if (fixed == null && repeating == null) {
+            throw new JSONException("Must contain fixed or repeating positions");
+        }
+        if (fixed != null) {
+            parseFixedJson(fixed, positioning);
+        }
+        if (repeating != null) {
+            parseRepeatingJson(repeating, positioning);
+        }
+        return positioning;
+    }
+
+    private void parseFixedJson(final JSONArray fixed,
+            final MoPubClientPositioning positioning) throws JSONException {
+        for (int i = 0; i < fixed.length(); ++i) {
+            JSONObject positionObject = fixed.getJSONObject(i);
+            int section = positionObject.optInt(SECTION_KEY, 0);
+            if (section < 0) {
+                throw new JSONException("Invalid section " + section + " in JSON response");
+            }
+            if (section > 0) {
+                // Ignore sections > 0.
+                continue;
+            }
+            int position = positionObject.getInt(POSITION_KEY);
+            if (position < 0 || position > MAX_VALUE) {
+                throw new JSONException("Invalid position " + position + " in JSON response");
+            }
+            positioning.addFixedPosition(position);
+        }
+    }
+
+    private void parseRepeatingJson(final JSONObject repeatingObject,
+            final MoPubClientPositioning positioning) throws JSONException {
+        int interval = repeatingObject.getInt(INTERVAL_KEY);
+        if (interval < 2 || interval > MAX_VALUE) {
+            throw new JSONException("Invalid interval " + interval + " in JSON response");
+        }
+        positioning.enableRepeatingPositions(interval);
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageTaskManager.java b/mopub-sdk/src/main/java/com/mopub/nativeads/TaskManager.java
similarity index 68%
rename from mopub-sdk/src/main/java/com/mopub/nativeads/ImageTaskManager.java
rename to mopub-sdk/src/main/java/com/mopub/nativeads/TaskManager.java
index 8d399039..443a9875 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/ImageTaskManager.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/TaskManager.java
@@ -1,7 +1,5 @@
 package com.mopub.nativeads;
 
-import android.graphics.Bitmap;
-
 import java.util.Collections;
 import java.util.HashMap;
 import java.util.List;
@@ -9,20 +7,20 @@
 import java.util.concurrent.atomic.AtomicBoolean;
 import java.util.concurrent.atomic.AtomicInteger;
 
-abstract class ImageTaskManager {
-    protected final ImageTaskManagerListener mImageTaskManagerListener;
+abstract class TaskManager<T> {
+    protected final TaskManagerListener<T> mImageTaskManagerListener;
     protected final int mSize;
-    protected final Map<String, Bitmap> mImages;
+    protected final Map<String, T> mResults;
 
     protected final AtomicInteger mCompletedCount;
     protected final AtomicBoolean mFailed;
 
-    interface ImageTaskManagerListener {
-        void onSuccess(final Map<String, Bitmap> images);
+    interface TaskManagerListener<T> {
+        void onSuccess(final Map<String, T> images);
         void onFail();
     }
 
-    ImageTaskManager(final List<String> urls, final ImageTaskManagerListener imageTaskManagerListener)
+    TaskManager(final List<String> urls, final TaskManagerListener<T> imageTaskManagerListener)
             throws IllegalArgumentException {
         if (urls == null) {
             throw new IllegalArgumentException("Urls list cannot be null");
@@ -37,8 +35,9 @@
         mImageTaskManagerListener = imageTaskManagerListener;
         mCompletedCount = new AtomicInteger(0);
         mFailed = new AtomicBoolean(false);
-        mImages = Collections.synchronizedMap(new HashMap<String, Bitmap>(mSize));
+        mResults = Collections.synchronizedMap(new HashMap<String, T>(mSize));
     }
 
     abstract void execute();
 }
+
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/TimestampWrapper.java b/mopub-sdk/src/main/java/com/mopub/nativeads/TimestampWrapper.java
new file mode 100644
index 00000000..3bed271a
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/TimestampWrapper.java
@@ -0,0 +1,13 @@
+package com.mopub.nativeads;
+
+import android.os.SystemClock;
+
+class TimestampWrapper<T> {
+    final T mInstance;
+    long mCreatedTimestamp;
+
+    TimestampWrapper(final T instance) {
+        mInstance = instance;
+        mCreatedTimestamp = SystemClock.uptimeMillis();
+    }
+}
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/UrlResolutionTask.java b/mopub-sdk/src/main/java/com/mopub/nativeads/UrlResolutionTask.java
index cce76111..119b4ed8 100644
--- a/mopub-sdk/src/main/java/com/mopub/nativeads/UrlResolutionTask.java
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/UrlResolutionTask.java
@@ -4,7 +4,7 @@
 
 import com.mopub.common.util.AsyncTasks;
 import com.mopub.common.util.IntentUtils;
-import com.mopub.common.util.MoPubLog;
+import com.mopub.common.logging.MoPubLog;
 
 import java.io.IOException;
 import java.net.HttpURLConnection;
diff --git a/mopub-sdk/src/main/java/com/mopub/nativeads/VisibilityTracker.java b/mopub-sdk/src/main/java/com/mopub/nativeads/VisibilityTracker.java
new file mode 100644
index 00000000..7ff0842a
--- /dev/null
+++ b/mopub-sdk/src/main/java/com/mopub/nativeads/VisibilityTracker.java
@@ -0,0 +1,266 @@
+package com.mopub.nativeads;
+
+import android.app.Activity;
+import android.content.Context;
+import android.graphics.Rect;
+import android.os.Handler;
+import android.os.SystemClock;
+import android.view.View;
+import android.view.ViewTreeObserver;
+
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+
+import java.lang.ref.WeakReference;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+import java.util.WeakHashMap;
+
+import static android.view.ViewTreeObserver.OnPreDrawListener;
+
+/**
+ * Tracks views to determine when they become visible or invisible, where visibility is defined as
+ * having been at least X% on the screen.
+ */
+class VisibilityTracker {
+    // Time interval to use for throttling visibility checks.
+    private static final int VISIBILITY_THROTTLE_MILLIS = 100;
+
+    // Trim the tracked views after this many accesses. This protects us against tracking
+    // too many views if the developer uses the adapter for multiple ListViews. It also
+    // limits the memory leak if a developer forgets to call destroy().
+    @VisibleForTesting static final int NUM_ACCESSES_BEFORE_TRIMMING = 50;
+
+    // Temporary array of trimmed views so that we don't allocate this on every trim.
+    private final ArrayList<View> mTrimmedViews;
+
+    // Incrementing access counter. Use a long to support very long-lived apps.
+    private long mAccessCounter = 0;
+
+    // Listener that passes all visible and invisible views when a visibility check occurs
+    static interface VisibilityTrackerListener {
+        void onVisibilityChanged(List<View> visibleViews, List<View> invisibleViews);
+    }
+
+    @VisibleForTesting OnPreDrawListener mOnPreDrawListener;
+    @VisibleForTesting final WeakReference<View> mRootView;
+
+    static class TrackingInfo {
+        int mMinViewablePercent;
+        long mAccessOrder;
+    }
+
+    // Views that are being tracked, mapped to the min viewable percentage
+    private final Map<View, TrackingInfo> mTrackedViews;
+
+    // Object to check actual visibility
+    private final VisibilityChecker mVisibilityChecker;
+
+    // Callback listener
+    private VisibilityTrackerListener mVisibilityTrackerListener;
+
+    // Runnable to run on each visibility loop
+    private final VisibilityRunnable mVisibilityRunnable;
+
+    // Handler for visibility
+    private final Handler mVisibilityHandler;
+
+    // Whether the visibility runnable is scheduled
+    private boolean mIsVisibilityScheduled;
+
+    public VisibilityTracker(final Context context) {
+        this(context,
+                new WeakHashMap<View, TrackingInfo>(10),
+                new VisibilityChecker(),
+                new Handler());
+    }
+
+    @VisibleForTesting
+    VisibilityTracker(final Context context,
+            final Map<View, TrackingInfo> trackedViews,
+            final VisibilityChecker visibilityChecker,
+            final Handler visibilityHandler) {
+        mTrackedViews = trackedViews;
+        mVisibilityChecker = visibilityChecker;
+        mVisibilityHandler = visibilityHandler;
+        mVisibilityRunnable = new VisibilityRunnable();
+        mTrimmedViews = new ArrayList<View>(NUM_ACCESSES_BEFORE_TRIMMING);
+
+        final View rootView = ((Activity) context).getWindow().getDecorView();
+        mRootView = new WeakReference<View>(rootView);
+        final ViewTreeObserver viewTreeObserver = rootView.getViewTreeObserver();
+        if (!viewTreeObserver.isAlive()) {
+            MoPubLog.w("Visibility Tracker was unable to track views because the"
+                    + " root view tree observer was not alive");
+        } else {
+            mOnPreDrawListener = new OnPreDrawListener() {
+                @Override
+                public boolean onPreDraw() {
+                    scheduleVisibilityCheck();
+                    return true;
+                }
+            };
+            viewTreeObserver.addOnPreDrawListener(mOnPreDrawListener);
+        }
+    }
+
+    void setVisibilityTrackerListener(final VisibilityTrackerListener visibilityTrackerListener) {
+        mVisibilityTrackerListener = visibilityTrackerListener;
+    }
+
+    /**
+     * Tracks the given view for visibility.
+     */
+    void addView(final View view, final int minPercentageViewed) {
+        // Find the view if already tracked
+        TrackingInfo trackingInfo = mTrackedViews.get(view);
+        if (trackingInfo == null) {
+            trackingInfo = new TrackingInfo();
+            mTrackedViews.put(view, trackingInfo);
+            scheduleVisibilityCheck();
+        }
+        trackingInfo.mMinViewablePercent = minPercentageViewed;
+        trackingInfo.mAccessOrder = mAccessCounter;
+
+        // Trim the number of tracked views to a reasonable number
+        mAccessCounter++;
+        if (mAccessCounter % NUM_ACCESSES_BEFORE_TRIMMING == 0) {
+            trimTrackedViews(mAccessCounter - NUM_ACCESSES_BEFORE_TRIMMING);
+        }
+    }
+
+    private void trimTrackedViews(long minAccessOrder) {
+        // Clear anything that is below minAccessOrder.
+        for (final Map.Entry<View, TrackingInfo> entry : mTrackedViews.entrySet()) {
+            if (entry.getValue().mAccessOrder <  minAccessOrder) {
+                mTrimmedViews.add(entry.getKey());
+            }
+        }
+
+        for (View view : mTrimmedViews) {
+            removeView(view);
+        }
+        mTrimmedViews.clear();
+    }
+
+    /**
+     * Stops tracking a view, cleaning any pending tracking
+     */
+    void removeView(final View view) {
+        mTrackedViews.remove(view);
+    }
+
+    /**
+     * Immediately clear all views. Useful for when we re-request ads for an ad placer
+     */
+    void clear() {
+        mTrackedViews.clear();
+        mVisibilityHandler.removeMessages(0);
+        mIsVisibilityScheduled = false;
+    }
+
+    /**
+     * Destroy the visibility tracker, preventing it from future use.
+     */
+    void destroy() {
+        clear();
+        final View rootView = mRootView.get();
+        if (rootView != null && mOnPreDrawListener != null) {
+            final ViewTreeObserver viewTreeObserver = rootView.getViewTreeObserver();
+            if (viewTreeObserver.isAlive()) {
+                viewTreeObserver.removeOnPreDrawListener(mOnPreDrawListener);
+            }
+            mOnPreDrawListener = null;
+        }
+        mVisibilityTrackerListener = null;
+    }
+
+    void scheduleVisibilityCheck() {
+        // Tracking this directly instead of calling hasMessages directly because we measured that
+        // this led to slightly better performance.
+        if (mIsVisibilityScheduled) {
+            return;
+        }
+
+        mIsVisibilityScheduled = true;
+        mVisibilityHandler.postDelayed(mVisibilityRunnable, VISIBILITY_THROTTLE_MILLIS);
+    }
+
+    class VisibilityRunnable implements Runnable {
+        // Set of views that are visible or invisible. We create these once to avoid excessive
+        // garbage collection observed when calculating these on each pass.
+        private final ArrayList<View> mVisibleViews;
+        private final ArrayList<View> mInvisibleViews;
+
+        VisibilityRunnable() {
+            mInvisibleViews = new ArrayList<View>();
+            mVisibleViews = new ArrayList<View>();
+        }
+
+        @Override
+        public void run() {
+            mIsVisibilityScheduled = false;
+            for (final Map.Entry<View, TrackingInfo> entry : mTrackedViews.entrySet()) {
+                final View view = entry.getKey();
+                final int minPercentageViewed = entry.getValue().mMinViewablePercent;
+
+                if (mVisibilityChecker.isVisible(view, minPercentageViewed)) {
+                    mVisibleViews.add(view);
+                } else {
+                    mInvisibleViews.add(view);
+                }
+            }
+
+            if (mVisibilityTrackerListener != null) {
+                mVisibilityTrackerListener.onVisibilityChanged(mVisibleViews, mInvisibleViews);
+            }
+
+            // Clear these immediately so that we don't leak memory
+            mVisibleViews.clear();
+            mInvisibleViews.clear();
+        }
+    }
+
+    static class VisibilityChecker {
+        // A rect to use for hit testing. Create this once to avoid excess garbage collection
+        private final Rect mClipRect = new Rect();
+
+        /**
+         * Whether the visible time has elapsed from the start time. Easily mocked for testing.
+         */
+        boolean hasRequiredTimeElapsed(final long startTimeMillis, final int minTimeViewed) {
+            return SystemClock.uptimeMillis() - startTimeMillis >= minTimeViewed;
+        }
+
+        /**
+         * Whether the view is at least certain % visible
+         */
+        boolean isVisible(final View view, final int minPercentageViewed) {
+            // ListView & GridView both call detachFromParent() for views that can be recycled for
+            // new data. This is one of the rare instances where a view will have a null parent for
+            // an extended period of time and will not be the main window.
+            // view.getGlobalVisibleRect() doesn't check that case, so if the view has visibility
+            // of View.VISIBLE but has no parent it is likely in the recycle bin of a
+            // ListView / GridView and not on screen.
+            if (view == null || view.getVisibility() != View.VISIBLE || view.getParent() == null) {
+                return false;
+            }
+
+            if (!view.getGlobalVisibleRect(mClipRect)) {
+                // Not visible
+                return false;
+            }
+
+            // % visible check - the cast is to avoid int overflow for large views.
+            final long visibleViewArea = (long) mClipRect.height() * mClipRect.width();
+            final long totalViewArea = (long) view.getHeight() * view.getWidth();
+
+            if (totalViewArea <= 0) {
+                return false;
+            }
+
+            return 100 * visibleViewArea >= minPercentageViewed * totalViewArea;
+        }
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/CacheServiceTest.java b/mopub-sdk/src/test/java/com/mopub/common/CacheServiceTest.java
index b2317b89..f7f5abd4 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/CacheServiceTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/CacheServiceTest.java
@@ -1,9 +1,10 @@
 package com.mopub.common;
 
 import android.app.Activity;
+import android.graphics.Bitmap;
 import android.support.v4.util.LruCache;
 
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.After;
 import org.junit.Before;
@@ -67,15 +68,15 @@ public void tearDown() throws Exception {
     public void initializeCaches_withValidContext_shouldCreateNewCachesIdempotently() throws Exception {
         assertThat(CacheService.getDiskLruCache()).isNull();
 
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         DiskLruCache diskLruCache = CacheService.getDiskLruCache();
         assertThat(diskLruCache).isNotNull();
-        LruCache<String, byte[]> memoryLruCache = CacheService.getMemoryLruCache();
+        LruCache<String, Bitmap> memoryLruCache = CacheService.getBitmapLruCache();
         assertThat(memoryLruCache).isNotNull();
 
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         assertThat(diskLruCache).isEqualTo(CacheService.getDiskLruCache());
-        assertThat(memoryLruCache).isEqualTo(CacheService.getMemoryLruCache());
+        assertThat(memoryLruCache).isEqualTo(CacheService.getBitmapLruCache());
     }
     
     @Test
@@ -87,21 +88,21 @@ public void getDiskLruCacheDirectory_shouldReturnValidCacheDirectory() throws Ex
 
     @Test
     public void diskLruCacheGet_whenPopulated_shouldReturnValue() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheService.putToDiskCache(key1, data1.getBytes());
         assertThat(CacheService.getFromDiskCache(key1)).isEqualTo(data1.getBytes());
     }
 
     @Test
     public void diskLruCacheGet_whenEmpty_shouldReturnNull() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         assertCachesAreEmpty();
         assertThat(CacheService.getFromDiskCache(key1)).isNull();
     }
 
     @Test
     public void diskLruCacheAsyncGet_whenPopulated_shouldReturnValue() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         assertCachesAreEmpty();
         CacheService.putToDiskCache(key1, data1.getBytes());
         CacheService.getFromDiskCacheAsync(key1, diskCacheGetListener);
@@ -112,7 +113,7 @@ public void diskLruCacheAsyncGet_whenPopulated_shouldReturnValue() throws Except
 
     @Test
     public void diskLruCacheAsyncGet_whenEmpty_shouldReturnNull() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheService.getFromDiskCacheAsync(key1, diskCacheGetListener);
         semaphore.acquire();
         assertThat(getKey).isEqualTo(key1);
@@ -122,7 +123,7 @@ public void diskLruCacheAsyncGet_whenEmpty_shouldReturnNull() throws Exception {
     @Test
     public void diskLruCachePut_withEmptyStringKey_shouldPutCorrectly() throws Exception {
         // this works because an empty string sha1 hashes to a valid key
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheService.putToDiskCache("", data1.getBytes());
         assertThat(CacheService.getFromDiskCache("")).isEqualTo(data1.getBytes());
     }
@@ -130,7 +131,7 @@ public void diskLruCachePut_withEmptyStringKey_shouldPutCorrectly() throws Excep
     @Test
     public void diskLruCachePut_withNullKey_shouldNotPut() throws Exception {
         // null value produces empty string key which is invalid for disk lru cache
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         assertCachesAreEmpty();
         CacheService.putToDiskCache(null, data1.getBytes());
         assertCachesAreEmpty();
@@ -138,13 +139,13 @@ public void diskLruCachePut_withNullKey_shouldNotPut() throws Exception {
 
     @Test
     public void createValidDiskLruCacheKey_withNullValue_shouldReturnEmptyString() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         assertThat(CacheService.createValidDiskCacheKey(null)).isEqualTo("");
     }
 
     @Test
     public void diskLruCacheAsyncPut_whenEmpty_shouldReturnNull() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheService.putToDiskCacheAsync(key1, data1.getBytes());
         Thread.sleep(500);
         assertThat(CacheService.getFromDiskCache(key1)).isEqualTo(data1.getBytes());
@@ -164,8 +165,8 @@ public static void assertDiskCacheIsEmpty() {
     }
 
     public static void assertCachesAreEmpty() {
-        assertThat(CacheService.getMemoryLruCache()).isNotNull();
-        assertThat(CacheService.getMemoryLruCache().size()).isEqualTo(0);
+        assertThat(CacheService.getBitmapLruCache()).isNotNull();
+        assertThat(CacheService.getBitmapLruCache().size()).isEqualTo(0);
         assertDiskCacheIsEmpty();
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/ClientMetadataTest.java b/mopub-sdk/src/test/java/com/mopub/common/ClientMetadataTest.java
new file mode 100644
index 00000000..74696613
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/ClientMetadataTest.java
@@ -0,0 +1,72 @@
+package com.mopub.common;
+
+import android.app.Activity;
+import android.content.Context;
+import android.telephony.TelephonyManager;
+
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.test.support.MoPubShadowTelephonyManager;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import static android.Manifest.permission.ACCESS_NETWORK_STATE;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.robolectric.Robolectric.shadowOf;
+
+@RunWith(SdkTestRunner.class)
+@Config(shadows = {MoPubShadowTelephonyManager.class})
+public class ClientMetadataTest {
+
+    public Activity activityContext;
+    private MoPubShadowTelephonyManager shadowTelephonyManager;
+
+    @Before
+    public void setUp() throws Exception {
+        activityContext = Robolectric.buildActivity(Activity.class).create().get();
+        shadowOf(activityContext).grantPermissions(ACCESS_NETWORK_STATE);
+        shadowTelephonyManager = (MoPubShadowTelephonyManager)
+                shadowOf((TelephonyManager) activityContext.getSystemService(Context.TELEPHONY_SERVICE));
+    }
+
+    // This has to be first or the singleton will be initialized by an earlier test. We should
+    // destroy the application between tests to get around this.
+    @Test
+    public void getWithoutContext_shouldReturnNull() {
+        final ClientMetadata clientMetadata = ClientMetadata.getInstance();
+        assertThat(clientMetadata).isNull();
+    }
+
+    @Test
+    public void getWithContext_shouldReturnInstance() {
+        final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
+        assertThat(clientMetadata).isNotNull();
+    }
+
+    @Test
+    public void getWithoutContextAfterInit_shouldReturnInstance() {
+        ClientMetadata.getInstance(activityContext);
+        final ClientMetadata clientMetadata = ClientMetadata.getInstance();
+        assertThat(clientMetadata).isNotNull();
+    }
+
+    @Test
+    public void testCachedData_shouldBeAvailable() {
+        shadowTelephonyManager.setNetworkOperatorName("testNetworkOperatorName");
+        shadowTelephonyManager.setNetworkOperator("testNetworkOperator");
+        shadowTelephonyManager.setNetworkCountryIso("1");
+        shadowTelephonyManager.setSimCountryIso("1");
+
+        final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
+        // Telephony manager data.
+        assertThat(clientMetadata.getNetworkOperator()).isEqualTo("testNetworkOperator");
+        assertThat(clientMetadata.getNetworkOperatorName()).isEqualTo("testNetworkOperatorName");
+        assertThat(clientMetadata.getIsoCountryCode()).isEqualTo("1");
+
+        // Other cached data.
+        assertThat(clientMetadata.getUdid()).isNotNull().isNotEmpty();
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/DownloadTaskTest.java b/mopub-sdk/src/test/java/com/mopub/common/DownloadTaskTest.java
index 7da791f4..cfa1702f 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/DownloadTaskTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/DownloadTaskTest.java
@@ -1,5 +1,6 @@
 package com.mopub.common;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.ResponseHeader;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 
@@ -9,42 +10,32 @@
 import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.ArgumentCaptor;
+import org.mockito.Captor;
+import org.mockito.Mock;
 import org.robolectric.Robolectric;
-import org.robolectric.RobolectricTestRunner;
 import org.robolectric.tester.org.apache.http.FakeHttpLayer;
 
-import java.util.concurrent.Semaphore;
-
 import static junit.framework.Assert.fail;
 import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.spy;
+import static org.mockito.Matchers.eq;
+import static org.mockito.Mockito.verify;
 
-@RunWith(RobolectricTestRunner.class)
+@RunWith(SdkTestRunner.class)
 public class DownloadTaskTest {
 
+    @Mock private DownloadTask.DownloadTaskListener mockDownloadTaskListener;
+    @Captor private ArgumentCaptor<DownloadResponse> responseCaptor;
+
     private DownloadTask mDownloadTask;
-    private DownloadTask.DownloadTaskListener mDownloadTaskListener;
-    private Semaphore mSemaphore;
-    private String mUrl;
-    private DownloadResponse mDownloadResponse;
     private HttpGet httpGet;
     private String mTestResponse;
     private FakeHttpLayer mFakeHttpLayer;
     private TestHttpResponseWithHeaders mTestHttpResponseWithHeaders;
 
     @Before
-    public void setUp() throws Exception {
-        mSemaphore = new Semaphore(0);
-
-        mDownloadTaskListener = new DownloadTask.DownloadTaskListener() {
-            @Override
-            public void onComplete(String url, DownloadResponse response) {
-                mUrl = url;
-                mDownloadResponse = response;
-                mSemaphore.release();
-            }
-        };
-        mDownloadTask = spy(new DownloadTask(mDownloadTaskListener));
+    public void setUp() {
+        mDownloadTask = new DownloadTask(mockDownloadTaskListener);
         try {
             httpGet = new HttpGet("http://www.mopub.com/");
         } catch (IllegalArgumentException e) {
@@ -60,77 +51,80 @@ public void onComplete(String url, DownloadResponse response) {
     }
 
     @Test
-    public void execute_whenDownloadTaskAndHttpClientCompleteSuccessfully_shouldReturn200HttpResponse() throws Exception {
+    public void execute_whenDownloadTaskAndHttpClientCompleteSuccessfully_shouldReturn200HttpResponse() {
         mFakeHttpLayer.addPendingHttpResponse(mTestHttpResponseWithHeaders);
         mDownloadTask.execute(httpGet);
-        mSemaphore.acquire();
-        assertThat(mUrl).isEqualTo(httpGet.getURI().toString());
-        assertThat(mDownloadResponse.getStatusCode()).isEqualTo(200);
-        assertThat(mDownloadResponse.getFirstHeader(ResponseHeader.IMPRESSION_URL)).isEqualTo("moPubImpressionTrackerUrl");
-        assertThat(mDownloadResponse.getFirstHeader(ResponseHeader.CLICKTHROUGH_URL)).isEqualTo("moPubClickTrackerUrl");
-        assertThat(HttpResponses.asResponseString(mDownloadResponse)).isEqualTo(mTestResponse);
+
+        verify(mockDownloadTaskListener).onComplete(eq(httpGet.getURI().toString()),
+                responseCaptor.capture());
+        DownloadResponse response = responseCaptor.getValue();
+        assertThat(response.getStatusCode()).isEqualTo(200);
+        assertThat(response.getFirstHeader(ResponseHeader.IMPRESSION_URL)).isEqualTo("moPubImpressionTrackerUrl");
+        assertThat(response.getFirstHeader(ResponseHeader.CLICKTHROUGH_URL)).isEqualTo("moPubClickTrackerUrl");
+        assertThat(HttpResponses.asResponseString(response)).isEqualTo(mTestResponse);
     }
 
     @Test
-    public void execute_whenDownloadTaskCompletesSuccessfullyAndHttpClientTimesOut_shouldReturn599HttpResponse() throws Exception {
+    public void execute_whenDownloadTaskCompletesSuccessfullyAndHttpClientTimesOut_shouldReturn599HttpResponse() {
         mFakeHttpLayer.addPendingHttpResponse(599, "");
         mDownloadTask.execute(httpGet);
-        mSemaphore.acquire();
-        assertThat(mUrl).isEqualTo(httpGet.getURI().toString());
-        assertThat(mDownloadResponse.getStatusCode()).isEqualTo(599);
-        assertThat(HttpResponses.asResponseString(mDownloadResponse)).isEqualTo("");
+
+        verify(mockDownloadTaskListener).onComplete(eq(httpGet.getURI().toString()),
+                responseCaptor.capture());
+        DownloadResponse response = responseCaptor.getValue();
+        assertThat(response.getStatusCode()).isEqualTo(599);
+        assertThat(HttpResponses.asResponseString(response)).isEqualTo("");
     }
 
     @Test
-    public void execute_whenDownloadTaskIsCancelledBeforeExecute_shouldReturnNullHttpReponseAndNullUrl() throws Exception {
+    public void execute_whenDownloadTaskIsCancelledBeforeExecute_shouldReturnNullHttpReponseAndNullUrl() {
         mFakeHttpLayer.addPendingHttpResponse(200, mTestResponse);
         mDownloadTask.cancel(true);
         mDownloadTask.execute(httpGet);
-        mSemaphore.acquire();
-        assertThat(mUrl).isEqualTo(null);
-        assertThat(mDownloadResponse).isEqualTo(null);
+
+        verify(mockDownloadTaskListener).onComplete(null, null);
     }
 
     @Ignore("pending")
     @Test
-    public void execute_whenDownloadTaskIsCancelledDuringDoInBackground_shouldReturnNullHttpReponse() throws Exception {
         // need a way to reliably cancel task during doInBackground
+    public void execute_whenDownloadTaskIsCancelledDuringDoInBackground_shouldReturnNullHttpReponse() {
     }
 
     @Ignore("pending")
     @Test
-    public void execute_whenHttpUriRequestThrowsIOException_shouldCancelTaskAndReturnNullHttpResponse() throws Exception {
+    public void execute_whenHttpUriRequestThrowsIOException_shouldCancelTaskAndReturnNullHttpResponse() {
         // need a way to force HttpUriRequest to throw on execute
     }
 
     @Test
-    public void execute_whenHttpUriRequestIsNull_shouldReturnNullHttpReponseAndNullUrl() throws Exception {
+    public void execute_whenHttpUriRequestIsNull_shouldReturnNullHttpReponseAndNullUrl() {
         mDownloadTask.execute((HttpUriRequest) null);
-        mSemaphore.acquire();
-        assertThat(mUrl).isEqualTo(null);
-        assertThat(mDownloadResponse).isEqualTo(null);
+        verify(mockDownloadTaskListener).onComplete(null, null);
     }
 
     @Test
-    public void execute_whenHttpUriRequestIsNullArray_shouldReturnNullHttpReponseAndNullUrl() throws Exception {
-        mDownloadTask.execute((HttpUriRequest[])null);
-        mSemaphore.acquire();
-        assertThat(mUrl).isEqualTo(null);
-        assertThat(mDownloadResponse).isEqualTo(null);
+    public void execute_whenHttpUriRequestIsNullArray_shouldReturnNullHttpReponseAndNullUrl() {
+        mDownloadTask.execute((HttpUriRequest[]) null);
+        verify(mockDownloadTaskListener).onComplete(null, null);
     }
 
     @Test
-    public void execute_whenHttpUriRequestIsArray_shouldOnlyReturnFirstResponse() throws Exception {
+    public void execute_whenHttpUriRequestIsArray_shouldOnlyReturnFirstResponse() {
         mFakeHttpLayer.addPendingHttpResponse(200, mTestResponse);
         mFakeHttpLayer.addPendingHttpResponse(500, "");
         mDownloadTask.execute(httpGet, new HttpGet("http://www.twitter.com/"));
-        mSemaphore.acquire();
-        assertThat(mDownloadResponse.getStatusCode()).isEqualTo(200);
-        assertThat(HttpResponses.asResponseString(mDownloadResponse)).isEqualTo(mTestResponse);
+
+        verify(mockDownloadTaskListener).onComplete(eq(httpGet.getURI().toString()),
+                responseCaptor.capture());
+        DownloadResponse response = responseCaptor.getValue();
+
+        assertThat(response.getStatusCode()).isEqualTo(200);
+        assertThat(HttpResponses.asResponseString(response)).isEqualTo(mTestResponse);
     }
 
     @Test
-    public void downLoadTask_whenConstructedWithNullListener_shouldThrowIllegalArgumentException() throws Exception {
+    public void downLoadTask_whenConstructedWithNullListener_shouldThrowIllegalArgumentException() {
         try {
             new DownloadTask(null);
             fail("DownloadTask didn't throw IllegalArgumentException when constructed with null");
diff --git a/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java b/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java
index d14356f8..25fd0bcc 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common;
 
 import android.app.Activity;
@@ -38,9 +6,8 @@
 import android.os.Looper;
 
 import com.mopub.common.factories.MethodBuilderFactory;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
-import com.mopub.mobileads.test.support.ThreadUtils;
 
 import org.junit.After;
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/HttpResponsesTest.java b/mopub-sdk/src/test/java/com/mopub/common/HttpResponsesTest.java
index 17bd22d4..814bcf55 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/HttpResponsesTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/HttpResponsesTest.java
@@ -36,13 +36,6 @@ public void asBitmap_shouldReturnBitmap() throws Exception {
         assertThat(shadowOf(bitmap).getCreatedFromBytes()).isEqualTo(imageData.getBytes());
     }
 
-    @Test
-    public void asBitmap_withNullResponse_shouldReturnNull() throws Exception {
-        final Bitmap bitmap = HttpResponses.asBitmap(null);
-
-        assertThat(bitmap).isNull();
-    }
-
     @Test
     public void asJsonObject_withEmptyJsonString_shouldReturnEmptyJsonObjectAndCloseStream() throws Exception {
         String jsonData = "{}";
diff --git a/mopub-sdk/src/test/java/com/mopub/common/PreconditionsTest.java b/mopub-sdk/src/test/java/com/mopub/common/PreconditionsTest.java
new file mode 100644
index 00000000..2e021297
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/PreconditionsTest.java
@@ -0,0 +1,308 @@
+package com.mopub.common;
+
+
+import com.mopub.common.Preconditions.NoThrow;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.RobolectricTestRunner;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.fest.assertions.api.Assertions.fail;
+
+@RunWith(RobolectricTestRunner.class)
+public class PreconditionsTest {
+
+    @Before
+    public void setUp() {
+        NoThrow.setStrictMode(false);
+    }
+    
+    @Test
+    public void checkArgument_success_shouldNotThrow() {
+        Preconditions.checkArgument(true);
+    }
+
+    @Test(expected = IllegalArgumentException.class)
+    public void checkArgument_failure_shouldThrowIllegalArgumentException() {
+        Preconditions.checkArgument(false);
+    }
+
+    @Test
+    public void checkArgument_failure_withMessage_shouldThrowIllegalArgumentException() {
+        try {
+            Preconditions.checkArgument(false, "message");
+            fail("no exception thrown");
+        } catch (IllegalArgumentException exception) {
+            assertThat(exception.getMessage()).isEqualTo("message");
+        }
+    }
+
+    @Test
+    public void checkArgument_failure_withNullMessage_shouldThrowIllegalArgumentException() {
+        try {
+            Preconditions.checkArgument(false, null);
+            fail("no exception thrown");
+        } catch (IllegalArgumentException exception) {
+            assertThat(exception.getMessage()).isEqualTo("null");
+        }
+    }
+
+    @Test
+    public void checkArgument_failure_withComplexMessage_shouldThrowIllegalArgumentException() {
+        try {
+            Preconditions.checkArgument(false, "I %s fail", "should");
+            fail("no exception thrown");
+        } catch (IllegalArgumentException exception) {
+            assertThat(exception.getMessage()).isEqualTo("I should fail");
+        }
+    }
+
+    @Test
+    public void checkState_success_shouldNotThrow() {
+        Preconditions.checkArgument(true);
+    }
+
+    @Test(expected = IllegalStateException.class)
+    public void checkState_failure_shouldThrowIllegalStateException() {
+        Preconditions.checkState(false);
+    }
+
+    @Test
+    public void checkState_failure_withMessage_shouldThrowIllegalStateException() {
+        try {
+            Preconditions.checkState(false, "message");
+            fail("no exception thrown");
+        } catch (IllegalStateException exception) {
+            assertThat(exception.getMessage()).isEqualTo("message");
+        }
+    }
+
+    @Test
+    public void checkState_failure_withNullMessage_shouldThrowIllegalStateException() {
+        try {
+            Preconditions.checkState(false, null);
+            fail("no exception thrown");
+        } catch (IllegalStateException exception) {
+            assertThat(exception.getMessage()).isEqualTo("null");
+        }
+    }
+
+    @Test
+    public void checkState_failure_withComplexMessage_shouldThrowIllegalStateException() {
+        try {
+            Preconditions.checkState(false, "I %s fail", "should");
+            fail("no exception thrown");
+        } catch (IllegalStateException exception) {
+            assertThat(exception.getMessage()).isEqualTo("I should fail");
+        }
+    }
+
+    @Test
+    public void checkNotNull_success_shouldNotThrow() {
+        Preconditions.checkNotNull(new Object());
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void checkNotNull_failure_shouldThrowNullPointerException() {
+        Preconditions.checkNotNull(null);
+    }
+
+    @Test
+    public void checkNotNull_failure_withMessage_shouldThrowNullPointerException() {
+        try {
+            Preconditions.checkNotNull(null, "message");
+            fail("no exception thrown");
+        } catch (NullPointerException exception) {
+            assertThat(exception.getMessage()).isEqualTo("message");
+        }
+    }
+
+    @Test
+    public void checkNotNull_failure_withNullMessage_shouldThrowNullPointerException() {
+        try {
+            Preconditions.checkNotNull(null, null);
+            fail("no exception thrown");
+        } catch (NullPointerException exception) {
+            assertThat(exception.getMessage()).isEqualTo("null");
+        }
+    }
+
+    @Test
+    public void checkNotNull_failure_withComplexMessage_shouldThrowNullPointerException() {
+        try {
+            Preconditions.checkNotNull(null, "I %s fail", "should");
+            fail("no exception thrown");
+        } catch (NullPointerException exception) {
+            assertThat(exception.getMessage()).isEqualTo("I should fail");
+        }
+    }
+
+    @Test
+    public void checkUiThread_success_shouldNotThrow() {
+        Preconditions.checkUiThread();
+    }
+
+    @Test
+    public void noThrow_checkArgument_success_shouldReturnTrue() {
+        assertThat(NoThrow.checkArgument(true)).isTrue();
+    }
+
+    @Test
+    public void noThrow_checkArgument_failure_shouldReturnFalse() {
+        assertThat(NoThrow.checkArgument(false)).isFalse();
+    }
+
+    @Test(expected = IllegalArgumentException.class)
+    public void noThrow_strictMode_checkArgument_failure_shouldThrowIllegalArgumentException() {
+        NoThrow.setStrictMode(true);
+        NoThrow.checkArgument(false);
+    }
+
+    @Test
+    public void noThrow_strictMode_checkArgument_failure_withMessage_shouldThrowIllegalArgumentException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkArgument(false, "message");
+            fail("no exception thrown");
+        } catch (IllegalArgumentException exception) {
+            assertThat(exception.getMessage()).isEqualTo("message");
+        }
+    }
+
+    @Test
+    public void noThrow_strictMode_checkArgument_failure_withNullMessage_shouldThrowIllegalArgumentException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkArgument(false, null);
+            fail("no exception thrown");
+        } catch (IllegalArgumentException exception) {
+            assertThat(exception.getMessage()).isEqualTo("null");
+        }
+    }
+
+    @Test
+    public void noThrow_strictMode_checkArgument_failure_withComplexMessage_shouldThrowIllegalArgumentException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkArgument(false, "I %s fail", "should");
+            fail("no exception thrown");
+        } catch (IllegalArgumentException exception) {
+            assertThat(exception.getMessage()).isEqualTo("I should fail");
+        }
+    }
+
+    @Test
+    public void noThrow_checkState_success_shouldReturnTrue() {
+        assertThat(NoThrow.checkArgument(true)).isTrue();
+    }
+
+    @Test
+    public void noThrow_checkState_failure_shouldReturnFalse() {
+        assertThat(NoThrow.checkState(false)).isFalse();
+    }
+
+    @Test(expected = IllegalStateException.class)
+    public void noThrow_strictMode_checkState_failure_shouldThrowIllegalStateException() {
+        NoThrow.setStrictMode(true);
+        NoThrow.checkState(false);
+    }
+
+    @Test
+    public void noThrow_strictMode_checkState_failure_withMessage_shouldThrowIllegalStateException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkState(false, "message");
+            fail("no exception thrown");
+        } catch (IllegalStateException exception) {
+            assertThat(exception.getMessage()).isEqualTo("message");
+        }
+    }
+
+    @Test
+    public void noThrow_strictMode_checkState_failure_withNullMessage_shouldThrowIllegalStateException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkState(false, null);
+            fail("no exception thrown");
+        } catch (IllegalStateException exception) {
+            assertThat(exception.getMessage()).isEqualTo("null");
+        }
+    }
+
+    @Test
+    public void noThrow_strictMode_checkState_failure_withComplexMessage_shouldThrowIllegalStateException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkState(false, "I %s fail", "should");
+            fail("no exception thrown");
+        } catch (IllegalStateException exception) {
+            assertThat(exception.getMessage()).isEqualTo("I should fail");
+        }
+    }
+
+    @Test
+    public void noThrow_checkNotNull_success_shouldReturnTrue() {
+        assertThat(NoThrow.checkNotNull(new Object())).isTrue();
+    }
+
+    @Test
+    public void noThrow_checkNotNull_failure_shouldReturnFalse() {
+        assertThat(NoThrow.checkNotNull(null)).isFalse();
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void noThrow_strictMode_checkNotNull_failure_shouldThrowNullPointerException() {
+        NoThrow.setStrictMode(true);
+        NoThrow.checkNotNull(null);
+    }
+
+    @Test
+    public void noThrow_strictMode_checkNotNull_failure_withMessage_shouldThrowNullPointerException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkNotNull(null, "message");
+            fail("no exception thrown");
+        } catch (NullPointerException exception) {
+            assertThat(exception.getMessage()).isEqualTo("message");
+        }
+    }
+
+    @Test
+    public void noThrow_strictMode_checkNotNull_failure_withNullMessage_shouldThrowNullPointerException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkNotNull(null, null);
+            fail("no exception thrown");
+        } catch (NullPointerException exception) {
+            assertThat(exception.getMessage()).isEqualTo("null");
+        }
+    }
+
+    @Test
+    public void noThrow_strictMode_checkNotNull_failure_withComplexMessage_shouldThrowNullPointerException() {
+        NoThrow.setStrictMode(true);
+        try {
+            NoThrow.checkNotNull(null, "I %s fail", "should");
+            fail("no exception thrown");
+        } catch (NullPointerException exception) {
+            assertThat(exception.getMessage()).isEqualTo("I should fail");
+        }
+    }
+
+    @Test
+    public void noThrow_checkUiThread_success_shouldReturnTrue() {
+        assertThat(NoThrow.checkUiThread()).isTrue();
+    }
+
+    @Test
+    public void checkArgument_failure_withInvalidMessage_shouldThrowIllegalArgumentException() {
+        try {
+            Preconditions.checkArgument(false, "messages: ", "message1", "message2");
+            fail("no exception thrown");
+        } catch (IllegalArgumentException exception) {
+            assertThat(exception.getMessage()).isEqualTo("messages: ");
+        }
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/EventHandlerTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/EventHandlerTest.java
new file mode 100644
index 00000000..8c2d338c
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/event/EventHandlerTest.java
@@ -0,0 +1,57 @@
+package com.mopub.common.event;
+
+import android.os.HandlerThread;
+import android.os.Message;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.apache.http.HttpStatus;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import static org.mockito.Matchers.eq;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.verify;
+
+
+@RunWith(SdkTestRunner.class)
+public class EventHandlerTest {
+
+    private EventRecorder testRecorder;
+    private MoPubEvents.EventDispatcher subject;
+    private HandlerThread testHandlerThread;
+
+    @Before
+    public void setup() {
+        // Set up test event recorders and test handler thread.
+        List<EventRecorder> recorders = new ArrayList<EventRecorder>();
+        testRecorder = mock(EventRecorder.class);
+        recorders.add(testRecorder);
+        testHandlerThread = new HandlerThread("mopub-test-events");
+        subject = new MoPubEvents.EventDispatcher(recorders, testHandlerThread);
+        // The test runner uses a mock dispatcher that does nothing.
+        MoPubEvents.setEventDispatcher(subject);
+    }
+
+    @Test
+    public void createEvent_testCallbackCallsHandler() throws Exception {
+        Message message = new Message();
+        message.obj = new Event(BaseEvent.Type.DATA_ERROR, "Test URL", ClientMetadata.getInstance());
+        subject.mHandlerCallback.handleMessage(message);
+        verify(testRecorder).recordEvent(eq((Event) message.obj));
+    }
+
+    @Test
+    public void createTimedEvent_testCallbackCallsHandler() throws Exception {
+        Message message = new Message();
+        message.obj = new TimedEvent(BaseEvent.Type.DATA_ERROR, "Test URL", ClientMetadata.getInstance(), null);
+        ((TimedEvent) message.obj).stop(HttpStatus.SC_OK);
+        subject.mHandlerCallback.handleMessage(message);
+        verify(testRecorder).recordTimedEvent((TimedEvent) eq(message.obj));
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/SdkTestRunner.java b/mopub-sdk/src/test/java/com/mopub/common/test/support/SdkTestRunner.java
similarity index 56%
rename from mopub-sdk/src/test/java/com/mopub/mobileads/test/support/SdkTestRunner.java
rename to mopub-sdk/src/test/java/com/mopub/common/test/support/SdkTestRunner.java
index 217ba1d0..d17a79d8 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/SdkTestRunner.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/test/support/SdkTestRunner.java
@@ -1,39 +1,12 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
-package com.mopub.mobileads.test.support;
+package com.mopub.common.test.support;
 
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.MoPub;
+import com.mopub.common.event.MoPubEvents;
 import com.mopub.common.factories.MethodBuilderFactory;
+import com.mopub.common.util.AsyncTasks;
 import com.mopub.common.util.DateAndTime;
+import com.mopub.common.util.test.support.ShadowAsyncTasks;
 import com.mopub.common.util.test.support.TestDateAndTime;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
 import com.mopub.mobileads.factories.AdFetcherFactory;
@@ -50,12 +23,36 @@
 import com.mopub.mobileads.factories.VastManagerFactory;
 import com.mopub.mobileads.factories.VastVideoDownloadTaskFactory;
 import com.mopub.mobileads.factories.ViewGestureDetectorFactory;
+import com.mopub.mobileads.test.support.TestAdFetcherFactory;
+import com.mopub.mobileads.test.support.TestAdViewControllerFactory;
+import com.mopub.mobileads.test.support.TestCustomEventBannerAdapterFactory;
+import com.mopub.mobileads.test.support.TestCustomEventBannerFactory;
+import com.mopub.mobileads.test.support.TestCustomEventInterstitialAdapterFactory;
+import com.mopub.mobileads.test.support.TestCustomEventInterstitialFactory;
+import com.mopub.mobileads.test.support.TestHtmlBannerWebViewFactory;
+import com.mopub.mobileads.test.support.TestHtmlInterstitialWebViewFactory;
+import com.mopub.mobileads.test.support.TestHttpClientFactory;
+import com.mopub.mobileads.test.support.TestMoPubViewFactory;
+import com.mopub.mobileads.test.support.TestMraidViewFactory;
+import com.mopub.mobileads.test.support.TestVastManagerFactory;
+import com.mopub.mobileads.test.support.TestVastVideoDownloadTaskFactory;
+import com.mopub.mobileads.test.support.TestViewGestureDetectorFactory;
+import com.mopub.nativeads.factories.CustomEventNativeFactory;
+import com.mopub.nativeads.test.support.TestCustomEventNativeFactory;
 
 import org.junit.runners.model.InitializationError;
 import org.mockito.MockitoAnnotations;
 import org.robolectric.DefaultTestLifecycle;
 import org.robolectric.RobolectricTestRunner;
 import org.robolectric.TestLifecycle;
+import org.robolectric.bytecode.ClassInfo;
+import org.robolectric.bytecode.Setup;
+import org.robolectric.util.RobolectricBackgroundExecutorService;
+
+import java.lang.reflect.Method;
+
+import static com.mopub.common.MoPub.LocationAwareness;
+import static org.mockito.Mockito.mock;
 
 public class SdkTestRunner extends RobolectricTestRunner {
 
@@ -63,6 +60,17 @@ public SdkTestRunner(Class<?> testClass) throws InitializationError {
         super(testClass);
     }
 
+    @Override
+    public Setup createSetup() {
+        return new Setup() {
+            @Override
+            public boolean shouldInstrument(ClassInfo classInfo) {
+                return classInfo.getName().equals(AsyncTasks.class.getName())
+                        || super.shouldInstrument(classInfo);
+            }
+        };
+    }
+
     @Override
     protected Class<? extends TestLifecycle> getTestLifecycleClass() {
         return TestLifeCycleWithInjection.class;
@@ -87,8 +95,20 @@ public void prepareTest(Object test) {
             VastManagerFactory.setInstance(new TestVastManagerFactory());
             VastVideoDownloadTaskFactory.setInstance(new TestVastVideoDownloadTaskFactory());
             MethodBuilderFactory.setInstance(new TestMethodBuilderFactory());
+            CustomEventNativeFactory.setInstance(new TestCustomEventNativeFactory());
+            ShadowAsyncTasks.reset();
+            MoPubEvents.setEventDispatcher(mock(MoPubEvents.EventDispatcher.class));
+            MoPub.setLocationAwareness(LocationAwareness.NORMAL);
+            MoPub.setLocationPrecision(6);
 
             MockitoAnnotations.initMocks(test);
+
+            AsyncTasks.setExecutor(new RobolectricBackgroundExecutorService());
+        }
+
+        @Override
+        public void afterTest(final Method method) {
+            ClientMetadata.clearForTesting();
         }
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/AsyncTasksTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/AsyncTasksTest.java
index 1a6dc5e1..89473924 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/AsyncTasksTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/AsyncTasksTest.java
@@ -2,6 +2,7 @@
 
 import android.os.AsyncTask;
 import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.os.Handler;
 import android.os.Looper;
 
@@ -12,11 +13,12 @@
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
 import org.robolectric.RobolectricTestRunner;
+import org.robolectric.annotation.Config;
+
+import java.util.concurrent.Executor;
 
-import static android.os.AsyncTask.THREAD_POOL_EXECUTOR;
-import static com.mopub.common.util.VersionCode.HONEYCOMB_MR2;
-import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
 import static junit.framework.Assert.fail;
+import static org.mockito.Matchers.any;
 import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.spy;
 import static org.mockito.Mockito.verify;
@@ -34,80 +36,71 @@ protected Void doInBackground(String... strings) {
                 return null;
             }
         });
-    };
+    }
 
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
     @Test
-    public void safeExecuteOnExecutor_beforeICS_shouldCallExecuteWithParams() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB_MR2.getApiLevel());
-
+    public void safeExecuteOnExecutor_beforeHoneycomb_shouldCallExecuteWithParams() throws Exception {
         AsyncTasks.safeExecuteOnExecutor(asyncTask, "hello");
 
         verify(asyncTask).execute(eq("hello"));
     }
 
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
     @Test
-    public void safeExecutorOnExecutor_beforeICS_withNullParam_shouldCallExecute() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB_MR2.getApiLevel());
-
+    public void safeExecutorOnExecutor_beforeHoneycomb_withNullParam_shouldCallExecute() throws Exception {
         AsyncTasks.safeExecuteOnExecutor(asyncTask, (String) null);
 
         verify(asyncTask).execute(eq((String) null));
     }
 
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
     @Test
-    public void safeExecutorOnExecutor_beforeICS_withNullAsyncTask_shouldThrowIllegalArgumentException() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB_MR2.getApiLevel());
-
+    public void safeExecutorOnExecutor_beforeHoneycomb_withNullAsyncTask_shouldThrowIllegalArgumentException() throws Exception {
         try {
             AsyncTasks.safeExecuteOnExecutor(null, "hello");
-            fail("Should have thrown IllegalArgumentException");
-        } catch (IllegalArgumentException exception) {
+            fail("Should have thrown NullPointerException");
+        } catch (NullPointerException exception) {
             // pass
         }
     }
 
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
     @Test
-    public void safeExecutorOnExecutor_beforeICS_runningOnABackgroundThread_shouldThrowIllegalStateException() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB_MR2.getApiLevel());
-
+    public void safeExecutorOnExecutor_beforeHoneycomb_runningOnABackgroundThread_shouldThrowIllegalStateException() throws Exception {
         ensureFastFailWhenTaskIsRunOnBackgroundThread();
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB)
     @Test
-    public void safeExecuteOnExecutor_atLeastICS_shouldCallExecuteWithParamsWithExecutor() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
-
+    public void safeExecuteOnExecutor_atLeastHoneycomb_shouldCallExecuteWithParamsWithExecutor() throws Exception {
         AsyncTasks.safeExecuteOnExecutor(asyncTask, "goodbye");
 
-        verify(asyncTask).executeOnExecutor(eq(THREAD_POOL_EXECUTOR), eq("goodbye"));
+        verify(asyncTask).executeOnExecutor(any(Executor.class), eq("goodbye"));
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB)
     @Test
-    public void safeExecutorOnExecutor_atLeastICS_withNullParam_shouldCallExecuteWithParamsWithExecutor() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
-
+    public void safeExecutorOnExecutor_atLeastHoneycomb_withNullParam_shouldCallExecuteWithParamsWithExecutor() throws Exception {
         AsyncTasks.safeExecuteOnExecutor(asyncTask, (String) null);
 
-        verify(asyncTask).executeOnExecutor(eq(THREAD_POOL_EXECUTOR), eq((String) null));
-
+        verify(asyncTask).executeOnExecutor(any(Executor.class), eq((String) null));
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB)
     @Test
-    public void safeExecutorOnExecutor_atLeastICS_withNullAsyncTask_shouldThrowIllegalArgumentException() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
-
+    public void safeExecutorOnExecutor_atLeastHoneycomb_withNullAsyncTask_shouldThrowIllegalArgumentException() throws Exception {
         try {
             AsyncTasks.safeExecuteOnExecutor(null, "hello");
-            fail("Should have thrown IllegalArgumentException");
-        } catch (IllegalArgumentException exception) {
+            fail("Should have thrown NullPointerException");
+        } catch (NullPointerException exception) {
             // pass
         }
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB)
     @Test
-    public void safeExecutorOnExecutor_atLeastICS_runningOnABackgroundThread_shouldThrowIllegalStateException() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
-
+    public void safeExecutorOnExecutor_atLeastHoneycomb_runningOnABackgroundThread_shouldThrowIllegalStateException() throws Exception {
         ensureFastFailWhenTaskIsRunOnBackgroundThread();
     }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java
index 963e36a2..269b6577 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.app.Activity;
+
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.RobolectricTestRunner;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/IntentUtilsTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/IntentUtilsTest.java
index b5f93cff..2630da5e 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/IntentUtilsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/IntentUtilsTest.java
@@ -1,35 +1,3 @@
-/*
-* Copyright (c) 2010-2013, MoPub Inc.
-* All rights reserved.
-*
-* Redistribution and use in source and binary forms, with or without
-* modification, are permitted provided that the following conditions are
-* met:
-*
-*  Redistributions of source code must retain the above copyright
-*   notice, this list of conditions and the following disclaimer.
-*
-*  Redistributions in binary form must reproduce the above copyright
-*   notice, this list of conditions and the following disclaimer in the
-*   documentation and/or other materials provided with the distribution.
-*
-*  Neither the name of 'MoPub Inc.' nor the names of its contributors
-*   may be used to endorse or promote products derived from this software
-*   without specific prior written permission.
-*
-* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
-* TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-* PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
-* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
-* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
-* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
-* LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
-* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-*/
-
 package com.mopub.common.util;
 
 import android.app.Activity;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/JsonTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/JsonTest.java
index c0954dd3..8636e84e 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/JsonTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/JsonTest.java
@@ -1,38 +1,6 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/ReflectionTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/ReflectionTest.java
index 78f7dac2..2b73cf80 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/ReflectionTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/ReflectionTest.java
@@ -1,46 +1,13 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.app.Activity;
 import android.view.View;
-
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.RobolectricTestRunner;
 
-import static com.mopub.common.util.Reflection.*;
+import static com.mopub.common.util.Reflection.MethodBuilder;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.fest.assertions.api.Assertions.fail;
 
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/StreamsTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/StreamsTest.java
index 0aab8870..495e44e6 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/StreamsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/StreamsTest.java
@@ -1,42 +1,15 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.RobolectricTestRunner;
 
-import java.io.*;
+import java.io.ByteArrayInputStream;
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.InputStream;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.fest.assertions.api.Assertions.fail;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/StringsTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/StringsTest.java
index 986eb122..1f2279c6 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/StringsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/StringsTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/VersionCodeTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/VersionCodeTest.java
index a0c2ee1e..c42a0681 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/VersionCodeTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/VersionCodeTest.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.os.Build;
+
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/ViewsTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/ViewsTest.java
index 87053070..7f09ebcc 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/ViewsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/ViewsTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util;
 
 import android.app.Activity;
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/VisibilityTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/VisibilityTest.java
new file mode 100644
index 00000000..0aa6f25d
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/VisibilityTest.java
@@ -0,0 +1,41 @@
+package com.mopub.common.util;
+
+import android.view.View;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+
+@RunWith(SdkTestRunner.class)
+public class VisibilityTest {
+    @Test
+    public void isScreenVisible_shouldOnlyReturnTrueForViewVisible() throws Exception {
+        assertThat(Visibility.isScreenVisible(View.VISIBLE)).isTrue();
+        assertThat(Visibility.isScreenVisible(View.INVISIBLE)).isFalse();
+        assertThat(Visibility.isScreenVisible(View.GONE)).isFalse();
+    }
+    
+    @Test
+    public void hasScreenVisibilityChanged_withIdenticalArguments_shouldReturnFalse() throws Exception {
+        assertThat(Visibility.hasScreenVisibilityChanged(View.VISIBLE, View.VISIBLE)).isFalse();
+        assertThat(Visibility.hasScreenVisibilityChanged(View.INVISIBLE, View.INVISIBLE)).isFalse();
+        assertThat(Visibility.hasScreenVisibilityChanged(View.GONE, View.GONE)).isFalse();
+    }
+
+    @Test
+    public void hasScreenVisibilityChanged_withTwoNonVisibleArguments_shouldReturnFalse() throws Exception {
+        assertThat(Visibility.hasScreenVisibilityChanged(View.INVISIBLE, View.GONE)).isFalse();
+        assertThat(Visibility.hasScreenVisibilityChanged(View.GONE, View.INVISIBLE)).isFalse();
+    }
+
+    @Test
+    public void hasScreenVisibilityChanged_withDifferentVisibilities_shouldReturnTrue() throws Exception {
+        assertThat(Visibility.hasScreenVisibilityChanged(View.VISIBLE, View.GONE)).isTrue();
+        assertThat(Visibility.hasScreenVisibilityChanged(View.GONE, View.VISIBLE)).isTrue();
+        assertThat(Visibility.hasScreenVisibilityChanged(View.VISIBLE, View.INVISIBLE)).isTrue();
+        assertThat(Visibility.hasScreenVisibilityChanged(View.INVISIBLE, View.VISIBLE)).isTrue();
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestDateAndTime.java b/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestDateAndTime.java
index 019568e6..154d12d3 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestDateAndTime.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestDateAndTime.java
@@ -1,40 +1,9 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util.test.support;
 
 import com.mopub.common.util.DateAndTime;
 
-import java.util.*;
+import java.util.Date;
+import java.util.TimeZone;
 
 public class TestDateAndTime extends DateAndTime {
     private TimeZone timeZone = TimeZone.getTimeZone("GMT-7");
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestMethodBuilderFactory.java b/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestMethodBuilderFactory.java
index e928e301..49d11389 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestMethodBuilderFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/test/support/TestMethodBuilderFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.common.util.test.support;
 
 import com.mopub.common.factories.MethodBuilderFactory;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertGestureListenerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertGestureListenerTest.java
index ea34c842..961ee9c0 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertGestureListenerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertGestureListenerTest.java
@@ -1,42 +1,12 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.view.MotionEvent;
 import android.view.View;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.GestureUtils;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertReporterTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertReporterTest.java
index e78a6989..ce36a6e8 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertReporterTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdAlertReporterTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -39,16 +7,21 @@
 import android.net.Uri;
 import android.view.View;
 import android.widget.TextView;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.test.support.TestDateAndTime;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
 
-import java.io.*;
+import java.io.File;
+import java.io.FileOutputStream;
 import java.text.SimpleDateFormat;
-import java.util.*;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.Locale;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdConfigurationTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdConfigurationTest.java
index ff5f1fea..f238ba05 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdConfigurationTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdConfigurationTest.java
@@ -5,7 +5,7 @@
 import android.os.Build;
 
 import com.mopub.common.MoPub;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.test.support.TestDateAndTime;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdFetcherTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdFetcherTest.java
index 7ab2bb97..22cf06bc 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdFetcherTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdFetcherTest.java
@@ -1,57 +1,30 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.os.Build;
+import android.os.Build.VERSION_CODES;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.factories.AdFetchTaskFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestAdFetchTaskFactory;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
+
 import org.apache.http.HttpResponse;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 
-import java.util.*;
-import java.util.concurrent.*;
+import java.util.HashMap;
+import java.util.Map;
+import java.util.concurrent.Executor;
 
 import static com.mopub.common.util.ResponseHeader.AD_TYPE;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_DATA;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_NAME;
 import static com.mopub.common.util.ResponseHeader.FULL_AD_TYPE;
 import static com.mopub.common.util.ResponseHeader.NATIVE_PARAMS;
-import static com.mopub.common.util.VersionCode.HONEYCOMB_MR2;
+import static com.mopub.common.util.VersionCode.GINGERBREAD;
 import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
 import static org.mockito.Matchers.any;
 import static org.mockito.Matchers.anyString;
@@ -127,21 +100,21 @@ public void fetchAdForUrl_shouldRouteMillennialInterstitialToCustomEventHandling
         verify(moPubInterstitialView).loadCustomEvent(eq(paramsMap));
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void fetchAdForUrl_whenApiLevelIsAtLeastICS_shouldExecuteUsingAnExecutor() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
+    public void fetchAdForUrl_atLeastIcs_shouldExecuteUsingAnExecutor() throws Exception {
         AdFetchTaskFactory.setInstance(new TestAdFetchTaskFactory());
         AdFetchTask adFetchTask = TestAdFetchTaskFactory.getSingletonMock();
 
         subject.fetchAdForUrl("some url");
 
-        verify(adFetchTask).executeOnExecutor(eq(AdFetchTask.THREAD_POOL_EXECUTOR), eq("some url"));
+        verify(adFetchTask).executeOnExecutor(any(Executor.class), eq("some url"));
         verify(adFetchTask, never()).execute(anyString());
     }
 
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
     @Test
-    public void fetchAdForUrl_whenApiLevelIsBelowICS_shouldExecuteWithoutAnExecutor() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB_MR2.getApiLevel());
+    public void fetchAdForUrl_beforeHoneycomb_shouldExecuteWithoutAnExecutor() throws Exception {
         AdFetchTaskFactory.setInstance(new TestAdFetchTaskFactory());
         AdFetchTask adFetchTask = TestAdFetchTaskFactory.getSingletonMock();
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdLoadTaskTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdLoadTaskTest.java
index b3838554..a14bf614 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdLoadTaskTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdLoadTaskTest.java
@@ -1,40 +1,9 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.JsonUtils;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
+
 import org.apache.http.Header;
 import org.apache.http.HttpEntity;
 import org.apache.http.HttpResponse;
@@ -42,11 +11,6 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.GOOGLE_PLAY_SERVICES_BANNER;
-import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.HTML_BANNER;
-import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.HTML_INTERSTITIAL;
-import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.MRAID_BANNER;
-import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.MRAID_INTERSTITIAL;
 import static com.mopub.common.util.ResponseHeader.AD_TYPE;
 import static com.mopub.common.util.ResponseHeader.CLICKTHROUGH_URL;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_DATA;
@@ -55,6 +19,11 @@
 import static com.mopub.common.util.ResponseHeader.NATIVE_PARAMS;
 import static com.mopub.common.util.ResponseHeader.REDIRECT_URL;
 import static com.mopub.common.util.ResponseHeader.SCROLLABLE;
+import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.GOOGLE_PLAY_SERVICES_BANNER;
+import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.HTML_BANNER;
+import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.HTML_INTERSTITIAL;
+import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.MRAID_BANNER;
+import static com.mopub.mobileads.AdTypeTranslator.CustomEventType.MRAID_INTERSTITIAL;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.stub;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java
index 57a72d6d..fb137103 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java
@@ -1,42 +1,11 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java
index a0f7bbfd..cabf6b71 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -41,18 +9,16 @@
 import android.view.View;
 import android.webkit.WebView;
 import android.widget.FrameLayout;
-
 import com.mopub.common.GpsHelper;
 import com.mopub.common.GpsHelperTest;
 import com.mopub.common.MoPub;
 import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
 import com.mopub.mobileads.factories.HttpClientFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestAdFetcherFactory;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 import com.mopub.mobileads.test.support.ThreadUtils;
-
 import org.apache.http.HttpRequest;
 import org.apache.http.HttpResponse;
 import org.apache.http.client.HttpClient;
@@ -276,6 +242,7 @@ public void trackImpression_shouldHttpGetTheImpressionUrl() throws Exception {
         }
     }
 
+    // this test for impressionUrl is unnecessary (since we're catching the NullPointerException)
     @Test
     public void trackImpression_shouldDoNothingIfImpressionUrlNotSpecified() throws Exception {
         subject.configureUsingHttpResponse(response);
@@ -314,6 +281,7 @@ public void registerClick_shouldHttpGetTheClickthroughUrl() throws Exception {
         }
     }
 
+    // this test for clickthroughUrl is unnecessary (since we're catching the NullPointerException)
     @Test
     public void trackImpression_shouldDoNothingIfClickthroughUrlNotSpecified() throws Exception {
         subject.configureUsingHttpResponse(response);
@@ -536,7 +504,7 @@ public void run() {
                 subject.setAdContentView(view);
             }
         }).start();
-        ThreadUtils.pause(10);
+        ThreadUtils.pause(100);
         Robolectric.runUiThreadTasks();
 
         verify(moPubView).removeAllViews();
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseHtmlWebViewTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseHtmlWebViewTest.java
index aeb012f8..0453e1bb 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseHtmlWebViewTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseHtmlWebViewTest.java
@@ -1,47 +1,19 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.view.MotionEvent;
 import android.view.View;
 import android.view.ViewGroup;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowWebView;
 
 import static android.webkit.WebSettings.PluginState;
@@ -70,15 +42,40 @@ public void setUp() throws Exception {
         touchUp = createMotionEvent(MotionEvent.ACTION_UP);
     }
 
+    @Config(reportSdk = VERSION_CODES.JELLY_BEAN_MR2)
+    @Test
+    public void pluginState_atLeastJellybeanMr2_shouldDefaultToOff_shouldNeverBeEnabled()  {
+        subject = new BaseHtmlWebView(new Activity(), adConfiguration);
+        assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.OFF);
+
+        subject.enablePlugins(true);
+        assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.OFF);
+    }
+
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void shouldEnablePluginsBasedOnApiLevel() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
+    public void pluginState_atLeastIcsButBelowJellybeanMr2_shouldDefaultToOn_shouldAllowToggling() {
         subject = new BaseHtmlWebView(new Activity(), adConfiguration);
         assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.ON);
 
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB_MR2.getApiLevel());
+        subject.enablePlugins(false);
+        assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.OFF);
+
+        subject.enablePlugins(true);
+        assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.ON);
+    }
+
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
+    @Test
+    public void pluginState_beforeIcs_shouldDefaultToOff_shouldAllowToggling() {
         subject = new BaseHtmlWebView(new Activity(), adConfiguration);
         assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.OFF);
+
+        subject.enablePlugins(true);
+        assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.ON);
+
+        subject.enablePlugins(false);
+        assertThat(subject.getSettings().getPluginState()).isEqualTo(PluginState.OFF);
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java
index 8a45f1e2..cf7d6c34 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -41,7 +9,6 @@
 import android.view.ViewGroup;
 import android.widget.ImageButton;
 import android.widget.RelativeLayout;
-
 import org.fest.assertions.api.ANDROID;
 import org.junit.Ignore;
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseVideoPlayerActivitiyTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseVideoPlayerActivitiyTest.java
index 2eeb9d78..5663115e 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseVideoPlayerActivitiyTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseVideoPlayerActivitiyTest.java
@@ -1,43 +1,10 @@
-/*
-* Copyright (c) 2010-2013, MoPub Inc.
-* All rights reserved.
-*
-* Redistribution and use in source and binary forms, with or without
-* modification, are permitted provided that the following conditions are
-* met:
-*
-*  Redistributions of source code must retain the above copyright
-*   notice, this list of conditions and the following disclaimer.
-*
-*  Redistributions in binary form must reproduce the above copyright
-*   notice, this list of conditions and the following disclaimer in the
-*   documentation and/or other materials provided with the distribution.
-*
-*  Neither the name of 'MoPub Inc.' nor the names of its contributors
-*   may be used to endorse or promote products derived from this software
-*   without specific prior written permission.
-*
-* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
-* TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-* PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
-* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
-* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
-* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
-* LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
-* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-*/
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Intent;
 
-import com.mopub.common.util.DeviceUtils;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Utils;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.util.vast.VastVideoConfiguration;
 
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseWebViewTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseWebViewTest.java
index 7dbc9d49..a6c36a4d 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseWebViewTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseWebViewTest.java
@@ -1,47 +1,19 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 
 import android.app.Activity;
 import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.view.ViewGroup;
 import android.webkit.WebSettings;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowWebView;
 
 import static com.mopub.common.util.VersionCode.JELLY_BEAN_MR1;
@@ -62,9 +34,9 @@ public void setup() {
         context = new Activity();
     }
 
+    @Config(reportSdk = VERSION_CODES.JELLY_BEAN_MR1)
     @Test
-    public void jellyBeanMr1AndBefore_shouldDisablePluginsByDefault() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", JELLY_BEAN_MR1.getApiLevel());
+    public void beforeJellyBeanMr1_shouldDisablePluginsByDefault() throws Exception {
         subject = new BaseWebView(context);
 
         WebSettings webSettings = subject.getSettings();
@@ -74,9 +46,9 @@ public void jellyBeanMr1AndBefore_shouldDisablePluginsByDefault() throws Excepti
         assertThat(webSettings.getPluginState()).isEqualTo(WebSettings.PluginState.ON);
     }
 
+    @Config(reportSdk = VERSION_CODES.JELLY_BEAN_MR2)
     @Test
-    public void jellyBeanMr2AndAfter_shouldPass() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", JELLY_BEAN_MR2.getApiLevel());
+    public void atLeastJellybeanMr2_shouldPass() throws Exception {
         subject = new BaseWebView(context);
 
         subject.enablePlugins(true);
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventAdLoadTaskTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventAdLoadTaskTest.java
index a692e525..944e8378 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventAdLoadTaskTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventAdLoadTaskTest.java
@@ -1,43 +1,13 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.mock;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java
index 0d6b1986..d99e6508 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java
@@ -1,43 +1,13 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.location.Location;
 import android.view.View;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.factories.CustomEventBannerFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -45,7 +15,8 @@
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.CustomEventBanner.CustomEventBannerListener;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventInterstitialAdapterTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventInterstitialAdapterTest.java
index c458e4ba..cdf1ad36 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventInterstitialAdapterTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventInterstitialAdapterTest.java
@@ -1,41 +1,11 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.content.Context;
 import android.location.Location;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.factories.CustomEventInterstitialFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -47,6 +17,7 @@
 
 import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR;
+import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_TIMEOUT;
 import static com.mopub.mobileads.MoPubErrorCode.UNSPECIFIED;
 import static org.fest.assertions.api.Assertions.assertThat;
@@ -92,6 +63,15 @@ public void setUp() throws Exception {
         subject.setAdapterListener(interstitialAdapterListener);
     }
 
+    @Test
+    public void constructor_withInvalidClassName_shouldCallOnCustomEventInterstitialFailed() throws Exception {
+        // Remove testing mock and use the real thing
+        CustomEventInterstitialFactory.setInstance(new CustomEventInterstitialFactory());
+
+        new CustomEventInterstitialAdapter(moPubInterstitial, "bad_class_name_11i234jb", null);
+        verify(moPubInterstitial).onCustomEventInterstitialFailed(ADAPTER_NOT_FOUND);
+    }
+
     @Test
     public void timeout_shouldSignalFailureAndInvalidateWithDefaultDelay() throws Exception {
         subject.loadInterstitial();
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java
index cc8d91e4..d0dfea10 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -37,10 +5,9 @@
 import android.content.IntentFilter;
 import android.support.v4.content.LocalBroadcastManager;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.factories.CustomEventInterstitialAdapterFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 
-import org.fest.util.Lists;
 import org.fest.util.Sets;
 import org.junit.Before;
 import org.junit.Ignore;
@@ -48,9 +15,7 @@
 import org.junit.runner.RunWith;
 import org.robolectric.shadows.ShadowLocalBroadcastManager;
 
-import java.util.ArrayList;
-import java.util.Iterator;
-import java.util.Set;
+import java.util.*;
 
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
@@ -62,7 +27,6 @@
 import static com.mopub.mobileads.MoPubInterstitial.InterstitialAdListener;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
-import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.verify;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/FacebookKeywordProviderTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/FacebookKeywordProviderTest.java
deleted file mode 100644
index d2fdfc4f..00000000
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/FacebookKeywordProviderTest.java
+++ /dev/null
@@ -1,80 +0,0 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
-package com.mopub.mobileads;
-
-import android.content.ContentResolver;
-import android.content.Context;
-import android.database.Cursor;
-import android.net.Uri;
-import com.mopub.mobileads.test.support.SdkTestRunner;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-
-import static org.mockito.Matchers.any;
-import static org.mockito.Matchers.anyString;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.stub;
-import static org.mockito.Mockito.verify;
-
-@RunWith(SdkTestRunner.class)
-public class FacebookKeywordProviderTest {
-
-    private Context context;
-    private ContentResolver contentResolver;
-    private Cursor cursor;
-    private FacebookKeywordProvider subject;
-
-    @Before
-    public void setUp() throws Exception {
-        subject = new FacebookKeywordProvider();
-        context = mock(Context.class);
-        contentResolver = mock(ContentResolver.class);
-        cursor = mock(Cursor.class);
-
-        stub(context.getContentResolver()).toReturn(contentResolver);
-        stub(contentResolver.query(
-                any(Uri.class),
-                any(String[].class),
-                anyString(),
-                any(String[].class),
-                anyString())).toReturn(cursor);
-    }
-
-    @Test
-    public void getKeyword_shouldCloseCursor() throws Exception {
-        subject.getKeyword(context);
-
-        verify(cursor).close();
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java
index 0118378d..d541d73d 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java
@@ -1,51 +1,23 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.net.Uri;
 import android.view.Gravity;
 import android.widget.FrameLayout;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHtmlBannerWebViewFactory;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 import com.mopub.mobileads.test.support.TestMoPubViewFactory;
+
 import org.apache.http.HttpResponse;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.ArgumentCaptor;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.CLICKTHROUGH_URL_KEY;
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
@@ -60,7 +32,7 @@
 import static org.mockito.Mockito.stub;
 import static org.mockito.Mockito.verify;
 
-@RunWith(com.mopub.mobileads.test.support.SdkTestRunner.class)
+@RunWith(SdkTestRunner.class)
 public class HtmlBannerTest {
 
     private HtmlBanner subject;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerWebViewTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerWebViewTest.java
index c02db867..aaf8a188 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerWebViewTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerWebViewTest.java
@@ -1,40 +1,10 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.webkit.WebViewClient;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java
index cd5da469..6d606330 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java
@@ -1,49 +1,20 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Intent;
 import android.net.Uri;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHtmlInterstitialWebViewFactory;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
 import org.robolectric.shadows.ShadowLocalBroadcastManager;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
 import static com.mopub.mobileads.AdFetcher.CLICKTHROUGH_URL_KEY;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialWebViewTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialWebViewTest.java
index 3a2ee83c..ebd3b8f8 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialWebViewTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialWebViewTest.java
@@ -1,45 +1,17 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.webkit.WebViewClient;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 
 import java.lang.reflect.Method;
 
@@ -115,9 +87,9 @@ public void init_shouldAddJavascriptInterface() throws Exception {
         verify(customEventInterstitialListener).onInterstitialLoaded();
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB)
     @Test
-    public void destroy_onHoneycombAndBeyond_shouldRemoveJavascriptInterface() {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB.getApiLevel());
+    public void destroy_atLeastHoneycomb_shouldRemoveJavascriptInterface() {
         HtmlInterstitialWebView spySubject = spy(subject);
 
         spySubject.destroy();
@@ -125,9 +97,9 @@ public void destroy_onHoneycombAndBeyond_shouldRemoveJavascriptInterface() {
         verify(spySubject).removeJavascriptInterface(MOPUB_JS_INTERFACE_NAME);
     }
 
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
     @Test
     public void destroy_beforeHoneycomb_shouldNotRemoveJavascriptInterface() {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", GINGERBREAD_MR1.getApiLevel());
         HtmlInterstitialWebView spySubject = spy(subject);
 
         spySubject.destroy();
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java
index 5cb2fdc1..7f395a4c 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -39,9 +7,9 @@
 import android.content.pm.ResolveInfo;
 import android.net.Uri;
 import android.webkit.WebView;
-
 import com.mopub.common.MoPubBrowser;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java
index f5dbe9c2..0903b56d 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -39,10 +7,8 @@
 import android.view.View;
 import android.webkit.WebViewClient;
 import android.widget.RelativeLayout;
-
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHtmlInterstitialWebViewFactory;
-
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -50,7 +16,6 @@
 import org.robolectric.Robolectric;
 import org.robolectric.shadows.ShadowLocalBroadcastManager;
 
-import static android.widget.RelativeLayout.LayoutParams;
 import static com.mopub.mobileads.AdFetcher.CLICKTHROUGH_URL_KEY;
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.AdFetcher.REDIRECT_URL_KEY;
@@ -169,9 +134,8 @@ public void onCreate_shouldLayoutWebView() throws Exception {
         verify(htmlInterstitialWebView).setLayoutParams(captor.capture());
         RelativeLayout.LayoutParams actualLayoutParams = captor.getValue();
 
-        assertThat(actualLayoutParams.width).isEqualTo(RelativeLayout.LayoutParams.FILL_PARENT);
-        assertThat(actualLayoutParams.height).isEqualTo(RelativeLayout.LayoutParams.WRAP_CONTENT);
-        assertOnlyOneRuleSet(actualLayoutParams, RelativeLayout.CENTER_IN_PARENT);
+        assertThat(actualLayoutParams.width).isEqualTo(RelativeLayout.LayoutParams.MATCH_PARENT);
+        assertThat(actualLayoutParams.height).isEqualTo(RelativeLayout.LayoutParams.MATCH_PARENT);
     }
 
     @Test
@@ -292,17 +256,5 @@ public void broadcastingInterstitialListener_onInterstitialClicked_shouldBroadca
     private Intent createMoPubActivityIntent(String htmlData, boolean isScrollable, String redirectUrl, String clickthroughUrl, AdConfiguration adConfiguration) {
         return MoPubActivity.createIntent(new Activity(), htmlData, isScrollable, redirectUrl, clickthroughUrl, adConfiguration);
     }
-
-    private void assertOnlyOneRuleSet(LayoutParams layoutParams, int desiredRule) {
-        int[] rules = layoutParams.getRules();
-        for (int ruleIndex = 0; ruleIndex < rules.length; ruleIndex++) {
-            int currentRule = rules[ruleIndex];
-            if (ruleIndex == desiredRule) {
-                assertThat(currentRule).isNotEqualTo(0);
-            } else {
-                assertThat(currentRule).isEqualTo(0);
-            }
-        }
-    }
 }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubBrowserControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubBrowserControllerTest.java
index dd3cce49..4f685a00 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubBrowserControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubBrowserControllerTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -39,7 +7,8 @@
 import android.net.Uri;
 
 import com.mopub.common.MoPubBrowser;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java
index 7ff77b61..b27d9986 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -37,10 +5,10 @@
 
 import com.mopub.common.GpsHelper;
 import com.mopub.common.GpsHelperTest;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Reflection.MethodBuilder;
 import com.mopub.common.util.Utils;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 
 import org.apache.http.HttpRequest;
 import org.junit.After;
@@ -52,6 +20,7 @@
 import org.robolectric.tester.org.apache.http.HttpRequestInfo;
 
 import static org.fest.assertions.api.Assertions.assertThat;
+import static org.fest.assertions.api.Assertions.fail;
 import static org.mockito.Matchers.any;
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.when;
@@ -86,33 +55,33 @@ public void tearDown() throws Exception {
     public void reportAppOpen_onValidHttpResponse_isIdempotent() throws Exception {
         fakeHttpLayer.addPendingHttpResponse(200, "doesn't matter what this is as long as it's not nothing");
         subject.reportAppOpen(context);
-        assertThat(requestWasMade()).isTrue();
+        assertRequestMade(true);
 
         fakeHttpLayer.addPendingHttpResponse(200, "doesn't matter what this is as long as it's not nothing");
         subject.reportAppOpen(context);
-        assertThat(requestWasMade()).isFalse();
+        assertRequestMade(false);
     }
 
     @Test
     public void reportAppOpen_onInvalidStatusCode_shouldMakeSecondRequest() throws Exception {
         fakeHttpLayer.addPendingHttpResponse(404, "doesn't matter what this is as long as it's not nothing");
         subject.reportAppOpen(context);
-        assertThat(requestWasMade()).isTrue();
+        assertRequestMade(true);
 
         fakeHttpLayer.addPendingHttpResponse(404, "doesn't matter what this is as long as it's not nothing");
         subject.reportAppOpen(context);
-        assertThat(requestWasMade()).isTrue();
+        assertRequestMade(true);
     }
 
     @Test
     public void reportAppOpen_onEmptyResponse_shouldMakeSecondRequest() throws Exception {
         fakeHttpLayer.addPendingHttpResponse(200, "");
         subject.reportAppOpen(context);
-        assertThat(requestWasMade()).isTrue();
+        assertRequestMade(true);
 
         fakeHttpLayer.addPendingHttpResponse(200, "");
         subject.reportAppOpen(context);
-        assertThat(requestWasMade()).isTrue();
+        assertRequestMade(true);
     }
 
     @Test
@@ -136,10 +105,10 @@ public void reportAppOpen_whenGooglePlayServicesIsLinkedAndAdInfoIsNotCached_sho
         fakeHttpLayer.addPendingHttpResponse(200, "doesn't matter what this is as long as it's not nothing");
         subject.reportAppOpen(context);
         Thread.sleep(500); // extra sleep since there are 2 async tasks
-        assertThat(requestWasMade()).isTrue();
+        assertRequestMade(true);
     }
 
-    private boolean requestWasMade() throws Exception {
+    private void assertRequestMade(boolean shouldRequestBeMade) throws Exception {
         StringBuilder stringBuilder = new StringBuilder("http://ads.mopub.com/m/open")
                 .append("?v=6")
                 .append("&id=").append("com.mopub.mobileads")
@@ -156,12 +125,15 @@ private boolean requestWasMade() throws Exception {
         Thread.sleep(500);
         HttpRequestInfo lastSentHttpRequestInfo = fakeHttpLayer.getLastSentHttpRequestInfo();
         if (lastSentHttpRequestInfo == null) {
-            return false;
+            if (shouldRequestBeMade) {
+                fail("No request info in the http layer");
+            }
+            return;
         }
         HttpRequest request = lastSentHttpRequestInfo.getHttpRequest();
         fakeHttpLayer.clearRequestInfos();
         String actualUrl = request.getRequestLine().getUri();
-        return actualUrl.equals(expectedUrl);
+        assertThat(actualUrl).isEqualTo(expectedUrl);
     }
 }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java
index b92eb9ed..9bc34a61 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java
@@ -1,39 +1,10 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 
+import com.mopub.common.LocationService;
+import com.mopub.common.MoPub;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestAdViewControllerFactory;
 import com.mopub.mobileads.test.support.TestCustomEventInterstitialAdapterFactory;
 import org.junit.Before;
@@ -43,14 +14,13 @@
 import java.math.BigDecimal;
 import java.util.*;
 
-import static com.mopub.common.LocationService.*;
+import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_DATA;
+import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_HTML_DATA;
+import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_NAME;
 import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
 import static com.mopub.mobileads.MoPubErrorCode.CANCELLED;
 import static com.mopub.mobileads.MoPubErrorCode.INTERNAL_ERROR;
 import static com.mopub.mobileads.MoPubErrorCode.UNSPECIFIED;
-import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_DATA;
-import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_HTML_DATA;
-import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_NAME;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.mock;
@@ -58,7 +28,7 @@
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.verify;
 
-@RunWith(com.mopub.mobileads.test.support.SdkTestRunner.class)
+@RunWith(SdkTestRunner.class)
 public class MoPubInterstitialTest {
 
     private static final String KEYWORDS_VALUE = "expected_keywords";
@@ -119,46 +89,24 @@ public void getKeywordsTest() throws Exception {
     }
 
     @Test
-    public void getInterstitialAdListenerTest() throws Exception {
-        interstitialAdListener = mock(MoPubInterstitial.InterstitialAdListener.class);
-        subject.setInterstitialAdListener(interstitialAdListener);
-        assertThat(subject.getInterstitialAdListener()).isSameAs(interstitialAdListener);
-    }
-
-    @Test
-    public void setLocationAwarenessTest() throws Exception {
-        subject.setInterstitialView(interstitialView);
-        subject.setLocationAwareness(LocationAwareness.NORMAL);
-        verify(interstitialView).setLocationAwareness(eq(LocationAwareness.NORMAL));
-    }
-
-    @Test
-    public void getLocationAwarenessTest() throws Exception {
-        subject.setInterstitialView(interstitialView);
-        subject.getLocationAwareness();
-        verify(interstitialView).getLocationAwareness();
-    }
-
-    @Test
-    public void setLocationPrecisionTest() throws Exception {
+    public void setTestingTest() throws Exception {
         subject.setInterstitialView(interstitialView);
-        subject.setLocationPrecision(10);
-        verify(interstitialView).setLocationPrecision(eq(10));
+        subject.setTesting(true);
+        verify(interstitialView).setTesting(eq(true));
     }
 
     @Test
-    public void getLocationPrecisionTest() throws Exception {
-        subject.setInterstitialView(interstitialView);
-        subject.getLocationPrecision();
-        verify(interstitialView).getLocationPrecision();
+    public void getInterstitialAdListenerTest() throws Exception {
+        interstitialAdListener = mock(MoPubInterstitial.InterstitialAdListener.class);
+        subject.setInterstitialAdListener(interstitialAdListener);
+        assertThat(subject.getInterstitialAdListener()).isSameAs(interstitialAdListener);
     }
 
-
     @Test
-    public void setTestingTest() throws Exception {
-        subject.setInterstitialView(interstitialView);
-        subject.setTesting(true);
-        verify(interstitialView).setTesting(eq(true));
+    public void setLocationAwarenss_shouldChangeGlobalSetting() {
+        assertThat(MoPub.getLocationAwareness()).isEqualTo(MoPub.LocationAwareness.NORMAL);
+        subject.setLocationAwareness(LocationService.LocationAwareness.DISABLED);
+        assertThat(MoPub.getLocationAwareness()).isEqualTo(MoPub.LocationAwareness.DISABLED);
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubViewTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubViewTest.java
index 83ce806a..57095db9 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubViewTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubViewTest.java
@@ -1,60 +1,30 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
-import android.content.BroadcastReceiver;
 import android.content.Context;
 import android.content.Intent;
-import android.support.v4.content.LocalBroadcastManager;
 import android.view.View;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.LocationService;
+import com.mopub.common.MoPub;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestAdViewControllerFactory;
 import com.mopub.mobileads.test.support.TestCustomEventBannerAdapterFactory;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
 import org.robolectric.shadows.ShadowApplication;
-import org.robolectric.shadows.ShadowLocalBroadcastManager;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
 
-import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_DATA;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_HTML_DATA;
 import static com.mopub.common.util.ResponseHeader.CUSTOM_EVENT_NAME;
+import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.never;
@@ -132,17 +102,55 @@ public void screenStateBroadcastReceiver_afterOnDestroy_shouldDoNothing() throws
     }
 
     @Test
-    public void onWindowVisibilityChanged_toVisible_shouldUnpauseRefresh() throws Exception {
+    public void onWindowVisibilityChanged_fromVisibleToInvisible_shouldPauseRefresh() throws Exception {
+        // Default visibility is View.VISIBLE
+        subject.onWindowVisibilityChanged(View.INVISIBLE);
+
+        verify(adViewController).pauseRefresh();
+        verify(adViewController, never()).unpauseRefresh();
+    }
+
+
+    @Test
+    public void onWindowVisibilityChanged_fromInvisibleToVisible_shouldUnpauseRefresh() throws Exception {
+        subject.onWindowVisibilityChanged(View.INVISIBLE);
+        reset(adViewController);
+
         subject.onWindowVisibilityChanged(View.VISIBLE);
 
+        verify(adViewController, never()).pauseRefresh();
         verify(adViewController).unpauseRefresh();
     }
 
     @Test
-    public void onWindowVisibilityChanged_toInvisible_shouldPauseRefresh() throws Exception {
+    public void onWindowVisibilityChanged_fromVisibleToVisible_shouldDoNothing() throws Exception {
+        // Default visibility is View.VISIBLE
+        subject.onWindowVisibilityChanged(View.VISIBLE);
+
+        verify(adViewController, never()).pauseRefresh();
+        verify(adViewController, never()).unpauseRefresh();
+    }
+
+    @Test
+    public void onWindowVisibilityChanged_fromInvisibleToGone_shouldDoNothing() throws Exception {
         subject.onWindowVisibilityChanged(View.INVISIBLE);
+        reset(adViewController);
 
-        verify(adViewController).pauseRefresh();
+        subject.onWindowVisibilityChanged(View.GONE);
+
+        verify(adViewController, never()).pauseRefresh();
+        verify(adViewController, never()).unpauseRefresh();
+    }
+
+    @Test
+    public void onWindowVisibilityChanged_fromGoneToInvisible_shouldDoNothing() throws Exception {
+        subject.onWindowVisibilityChanged(View.GONE);
+        reset(adViewController);
+
+        subject.onWindowVisibilityChanged(View.INVISIBLE);
+
+        verify(adViewController, never()).pauseRefresh();
+        verify(adViewController, never()).unpauseRefresh();
     }
 
     @Test
@@ -189,6 +197,13 @@ public void loadCustomEvent_whenParamsMapIsNull_shouldCallLoadFailUrl() throws E
         verify(customEventBannerAdapter, never()).loadAd();
     }
 
+    @Test
+    public void setLocationAwarenss_shouldChangeGlobalSetting() {
+        assertThat(MoPub.getLocationAwareness()).isEqualTo(MoPub.LocationAwareness.NORMAL);
+        subject.setLocationAwareness(LocationService.LocationAwareness.DISABLED);
+        assertThat(MoPub.getLocationAwareness()).isEqualTo(MoPub.LocationAwareness.DISABLED);
+    }
+
     private void broadcastIntent(final Intent intent) {
         final List<ShadowApplication.Wrapper> wrappers = Robolectric.getShadowApplication().getRegisteredReceivers();
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java
index 1cc01d41..cbe31354 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -38,6 +6,7 @@
 import android.content.Intent;
 import android.graphics.Color;
 import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.view.View;
 import android.view.WindowManager;
 import android.webkit.WebViewClient;
@@ -45,8 +14,8 @@
 import android.widget.ImageButton;
 import android.widget.RelativeLayout;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Dips;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestMraidViewFactory;
 
 import org.fest.assertions.api.ANDROID;
@@ -55,6 +24,7 @@
 import org.junit.runner.RunWith;
 import org.mockito.ArgumentCaptor;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowLocalBroadcastManager;
 
 import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
@@ -175,6 +145,18 @@ public void onCreate_shouldSetupAnMraidView() throws Exception {
         verify(mraidView).loadHtmlData(EXPECTED_SOURCE);
     }
 
+    @Test
+    public void onCreate_shouldSetLayoutOfMraidView() throws Exception {
+        subject.onCreate(null);
+
+        ArgumentCaptor<RelativeLayout.LayoutParams> captor = ArgumentCaptor.forClass(RelativeLayout.LayoutParams.class);
+        verify(mraidView).setLayoutParams(captor.capture());
+        RelativeLayout.LayoutParams actualLayoutParams = captor.getValue();
+
+        assertThat(actualLayoutParams.width).isEqualTo(RelativeLayout.LayoutParams.MATCH_PARENT);
+        assertThat(actualLayoutParams.height).isEqualTo(RelativeLayout.LayoutParams.MATCH_PARENT);
+    }
+
     @Test
     public void onCreate_shouldAddCloseEventRegion() throws Exception {
         subject.onCreate(null);
@@ -190,20 +172,18 @@ public void onCreate_shouldAddCloseEventRegion() throws Exception {
                 .isEqualTo(RelativeLayout.TRUE);
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void onCreate_whenICS_shouldSetHardwareAcceleratedFlag() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", 14);
-
+    public void onCreate_atLeastIcs_shouldSetHardwareAcceleratedFlag() throws Exception {
         subject.onCreate(null);
 
         boolean hardwareAccelerated = shadowOf(subject.getWindow()).getFlag(WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED);
         assertThat(hardwareAccelerated).isTrue();
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB_MR2)
     @Test
-    public void onCreate_whenPreICS_shouldNotSetHardwareAcceleratedFlag() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", 13);
-
+    public void onCreate_beforeIcs_shouldNotSetHardwareAcceleratedFlag() throws Exception {
         subject.onCreate(null);
 
         boolean hardwareAccelerated = shadowOf(subject.getWindow()).getFlag(WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED);
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidBannerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidBannerTest.java
index 3cd1e76c..05aa59de 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidBannerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidBannerTest.java
@@ -1,46 +1,17 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestMraidViewFactory;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.ArgumentCaptor;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.CustomEventBanner.CustomEventBannerListener;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandFactoryTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandFactoryTest.java
index 8dc8dd85..8a164b71 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandFactoryTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandFactoryTest.java
@@ -1,43 +1,12 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import java.util.*;
+import java.util.Map;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Mockito.mock;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandPlayVideoTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandPlayVideoTest.java
index fc9f653f..44908b00 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandPlayVideoTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandPlayVideoTest.java
@@ -1,40 +1,8 @@
-/*
-* Copyright (c) 2010-2013, MoPub Inc.
-* All rights reserved.
-*
-* Redistribution and use in source and binary forms, with or without
-* modification, are permitted provided that the following conditions are
-* met:
-*
-*  Redistributions of source code must retain the above copyright
-*   notice, this list of conditions and the following disclaimer.
-*
-*  Redistributions in binary form must reproduce the above copyright
-*   notice, this list of conditions and the following disclaimer in the
-*   documentation and/or other materials provided with the distribution.
-*
-*  Neither the name of 'MoPub Inc.' nor the names of its contributors
-*   may be used to endorse or promote products derived from this software
-*   without specific prior written permission.
-*
-* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
-* TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-* PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
-* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
-* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
-* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
-* LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
-* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-*/
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestMraidViewFactory;
 
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandResizeTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandResizeTest.java
index e7ffb5f1..1a9063c3 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandResizeTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandResizeTest.java
@@ -1,44 +1,13 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestMraidViewFactory;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import java.util.*;
+import java.util.HashMap;
 
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.GET_RESIZE_PROPERTIES;
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.RESIZE;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandStorePictureTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandStorePictureTest.java
index 57f89fe8..3fad21a5 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandStorePictureTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandStorePictureTest.java
@@ -1,45 +1,15 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.FileUtils;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestMraidViewFactory;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static com.mopub.mobileads.MraidCommand.URI_KEY;
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.STORE_PICTURE;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandTest.java
index 6dee186f..e4b7682e 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidCommandTest.java
@@ -1,40 +1,8 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import org.junit.Test;
 
-import java.util.*;
+import java.util.Map;
 
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.CLOSE;
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.CREATE_CALENDAR_EVENT;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidDisplayControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidDisplayControllerTest.java
index 610ae4bc..035a693f 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidDisplayControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidDisplayControllerTest.java
@@ -1,35 +1,3 @@
-/*
-* Copyright (c) 2010-2013, MoPub Inc.
-* All rights reserved.
-*
-* Redistribution and use in source and binary forms, with or without
-* modification, are permitted provided that the following conditions are
-* met:
-*
-*  Redistributions of source code must retain the above copyright
-*   notice, this list of conditions and the following disclaimer.
-*
-*  Redistributions in binary form must reproduce the above copyright
-*   notice, this list of conditions and the following disclaimer in the
-*   documentation and/or other materials provided with the distribution.
-*
-*  Neither the name of 'MoPub Inc.' nor the names of its contributors
-*   may be used to endorse or promote products derived from this software
-*   without specific prior written permission.
-*
-* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
-* TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-* PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
-* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
-* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
-* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
-* LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
-* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-*/
-
 package com.mopub.mobileads;
 
 import android.Manifest;
@@ -38,7 +6,7 @@
 import android.content.Context;
 import android.content.Intent;
 import android.graphics.Color;
-import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.os.Environment;
 import android.provider.CalendarContract;
 import android.view.Gravity;
@@ -49,14 +17,13 @@
 import android.widget.ImageView;
 import android.widget.RelativeLayout;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Dips;
 import com.mopub.mobileads.test.support.FileUtils;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 import com.mopub.mobileads.test.support.TestMraidViewFactory;
 import com.mopub.mobileads.test.support.ThreadUtils;
 import com.mopub.mobileads.util.MraidsTest;
-
 import org.apache.http.HttpResponse;
 import org.apache.http.client.methods.HttpUriRequest;
 import org.junit.Before;
@@ -66,21 +33,18 @@
 import org.mockito.invocation.InvocationOnMock;
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowAlertDialog;
 import org.robolectric.shadows.ShadowEnvironment;
 import org.robolectric.shadows.ShadowLog;
 import org.robolectric.shadows.ShadowToast;
 
-import java.io.File;
+import java.io.*;
 import java.net.URI;
-import java.util.HashMap;
-import java.util.Map;
+import java.util.*;
 
 import static android.content.DialogInterface.BUTTON_NEGATIVE;
 import static android.content.DialogInterface.BUTTON_POSITIVE;
-import static com.mopub.common.util.VersionCode.ECLAIR;
-import static com.mopub.common.util.VersionCode.FROYO;
-import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
 import static com.mopub.mobileads.BaseVideoPlayerActivitiyTest.assertMraidVideoPlayerActivityStarted;
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.CREATE_CALENDAR_EVENT;
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.GET_CURRENT_POSITION;
@@ -90,7 +54,7 @@
 import static com.mopub.mobileads.MraidCommandFactory.MraidJavascriptCommand.STORE_PICTURE;
 import static com.mopub.mobileads.MraidCommandStorePicture.MIME_TYPE_HEADER;
 import static com.mopub.mobileads.util.Mraids.ANDROID_CALENDAR_CONTENT_TYPE;
-import static java.io.File.separator;
+import static java.io.File.*;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
 import static org.mockito.Matchers.eq;
@@ -256,10 +220,10 @@ public void initializeSupportedFunctionsProperty_whenSDCardMounted_andWriteExter
         assertThat(mraidSupportsProperty.toJsonPair()).contains("storePicture: true");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void initializeSupportedFunctionsProperty_whenApiLevelICSAndAbove_shouldReportCalendarAvailable() throws Exception {
+    public void initializeSupportedFunctionsProperty_atLeastIcs_shouldReportCalendarAvailable() throws Exception {
         Context mockContext = createMockContextWithSpecificIntentData(null, null, ANDROID_CALENDAR_CONTENT_TYPE, "android.intent.action.INSERT");
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
         resetMockMraidView(mockContext);
 
         subject.initializeSupportedFunctionsProperty();
@@ -269,10 +233,9 @@ public void initializeSupportedFunctionsProperty_whenApiLevelICSAndAbove_shouldR
         assertThat(mraidSupportsProperty.toJsonPair()).contains("calendar: true");
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB_MR2)
     @Test
-    public void initializeSupportedFunctionsProperty_whenBelowApiLevelICS_shouldNotReportCalendarAvailable() throws Exception {
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", FROYO.getApiLevel());
-
+    public void initializeSupportedFunctionsProperty_beforeIcs_shouldNotReportCalendarAvailable() throws Exception {
         resetMockMraidView(new Activity());
         subject.initializeSupportedFunctionsProperty();
 
@@ -538,8 +501,9 @@ public void getScreenSize_shouldFireErrorEvent() throws Exception {
         verify(mraidView).fireErrorEvent(eq(GET_SCREEN_SIZE), any(String.class));
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void createCalendarEvent_withMinimumValidParams_onICS_shouldCreateEventIntent() throws Exception {
+    public void createCalendarEvent_withMinimumValidParams_atLeastICS_shouldCreateEventIntent() throws Exception {
         setupCalendarParams();
 
         subject.createCalendarEvent(params);
@@ -554,8 +518,9 @@ public void createCalendarEvent_withMinimumValidParams_onICS_shouldCreateEventIn
         assertThat(intent.getLongExtra(CalendarContract.EXTRA_EVENT_BEGIN_TIME, -1)).isNotEqualTo(-1);
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void createCalendarEvent_withoutSecondsOnStartDate_onICS_shouldCreateEventIntent() throws Exception {
+    public void createCalendarEvent_withoutSecondsOnStartDate_atLeastICS_shouldCreateEventIntent() throws Exception {
         setupCalendarParams();
         params.put("start", "2012-12-21T00:00-0500");
 
@@ -571,6 +536,7 @@ public void createCalendarEvent_withoutSecondsOnStartDate_onICS_shouldCreateEven
         assertThat(intent.getLongExtra(CalendarContract.EXTRA_EVENT_BEGIN_TIME, -1)).isNotEqualTo(-1);
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withDailyRecurrence_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -584,6 +550,7 @@ public void createCalendarEvent_withDailyRecurrence_shouldCreateCalendarIntent()
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=DAILY;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withDailyRecurrence_withInterval_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -596,6 +563,7 @@ public void createCalendarEvent_withDailyRecurrence_withInterval_shouldCreateCal
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=DAILY;INTERVAL=2;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withWeeklyRecurrence_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -607,6 +575,7 @@ public void createCalendarEvent_withWeeklyRecurrence_shouldCreateCalendarIntent(
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=WEEKLY;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withWeeklyRecurrence_withInterval_withOutWeekday_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -619,6 +588,7 @@ public void createCalendarEvent_withWeeklyRecurrence_withInterval_withOutWeekday
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=WEEKLY;INTERVAL=7;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withWeeklyRecurrence_onAllWeekDays_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -631,6 +601,7 @@ public void createCalendarEvent_withWeeklyRecurrence_onAllWeekDays_shouldCreateC
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=WEEKLY;BYDAY=SU,MO,TU,WE,TH,FR,SA;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withWeeklyRecurrence_onDuplicateWeekDays_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -643,6 +614,7 @@ public void createCalendarEvent_withWeeklyRecurrence_onDuplicateWeekDays_shouldC
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=WEEKLY;BYDAY=WE,TU,SU;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withWeeklyRecurrence_withInterval_withWeekDay_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -656,6 +628,7 @@ public void createCalendarEvent_withWeeklyRecurrence_withInterval_withWeekDay_sh
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=WEEKLY;INTERVAL=1;BYDAY=MO;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withDailyRecurrence_withWeeklyRecurrence_withMonthlyOccurence_shouldCreateDailyCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -671,7 +644,7 @@ public void createCalendarEvent_withDailyRecurrence_withWeeklyRecurrence_withMon
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=DAILY;INTERVAL=2;");
     }
 
-
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withMonthlyRecurrence_withOutInterval_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -683,6 +656,7 @@ public void createCalendarEvent_withMonthlyRecurrence_withOutInterval_shouldCrea
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=MONTHLY;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withMonthlyRecurrence_withInterval_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -695,6 +669,7 @@ public void createCalendarEvent_withMonthlyRecurrence_withInterval_shouldCreateC
         assertThat(intent.getStringExtra(CalendarContract.Events.RRULE)).isEqualTo("FREQ=MONTHLY;INTERVAL=2;");
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void createCalendarEvent_withMonthlyRecurrence_withOutInterval_withDaysOfMonth_shouldCreateCalendarIntent() throws Exception {
         setupCalendarParams();
@@ -735,10 +710,10 @@ public void createCalendarEvent_withWeeklyRecurrence_withInvalidDaysOfWeek_shoul
         assertThat(ShadowLog.getLogs().size()).isEqualTo(1);
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB_MR2)
     @Test
-    public void createCalendarEvent_onPreICSDevice_shouldFireErrorEvent() throws Exception {
+    public void createCalendarEvent_beforeIcs_shouldFireErrorEvent() throws Exception {
         resetMockMraidView(new Activity());
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ECLAIR.getApiLevel());
 
         subject.createCalendarEvent(params);
 
@@ -748,7 +723,6 @@ public void createCalendarEvent_onPreICSDevice_shouldFireErrorEvent() throws Exc
     @Test
     public void createCalendarEvent_withInvalidDate_shouldFireErrorEvent() throws Exception {
         resetMockMraidView(new Activity());
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
         params.put("start", "2013-08-14T09:00.-08:00");
         params.put("description", "Some Event");
 
@@ -760,7 +734,6 @@ public void createCalendarEvent_withInvalidDate_shouldFireErrorEvent() throws Ex
     @Test
     public void createCalendarEvent_withMissingParameters_shouldFireErrorEvent() throws Exception {
         resetMockMraidView(new Activity());
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
         //it needs a start time
         params.put("description", "Some Event");
 
@@ -772,7 +745,6 @@ public void createCalendarEvent_withMissingParameters_shouldFireErrorEvent() thr
     @Test
     public void createCalendarEvent_withNullDate_shouldFireErrorEvent() throws Exception {
         resetMockMraidView(new Activity());
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
         params.put("start", null);
         params.put("description", "Some Event");
 
@@ -781,8 +753,10 @@ public void createCalendarEvent_withNullDate_shouldFireErrorEvent() throws Excep
         verify(mraidView).fireErrorEvent(eq(CREATE_CALENDAR_EVENT), any(String.class));
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void createCalendarEvent_withValidParamsAllExceptRecurrence_onICS_shouldCreateEventIntent() throws Exception {
+    public void
+    createCalendarEvent_withValidParamsAllExceptRecurrence_atLeastICS_shouldCreateEventIntent() throws Exception {
         setupCalendarParams();
         params.put("location", "my house");
         params.put("end", "2013-08-14T22:01:01-0000");
@@ -871,7 +845,6 @@ public Void answer(InvocationOnMock invocation) throws Throwable {
         }).when(mockContext).startActivity(any(Intent.class));
 
         resetMockMraidView(mockContext);
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
         params.put("description", "Some Event");
         params.put("start", CALENDAR_START_TIME);
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidInterstitialTest.java
index 56be2be0..d6da03a2 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidInterstitialTest.java
@@ -1,48 +1,19 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.content.Context;
 import android.content.Intent;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.shadows.ShadowActivity;
 import org.robolectric.shadows.ShadowLocalBroadcastManager;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static com.mopub.mobileads.AdFetcher.AD_CONFIGURATION_KEY;
 import static com.mopub.mobileads.AdFetcher.HTML_RESPONSE_BODY_KEY;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidSupportsPropertyTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidSupportsPropertyTest.java
index 1d9daea5..56ab537d 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidSupportsPropertyTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidSupportsPropertyTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java
index 6e72d0bd..d8a9ca17 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -41,7 +9,7 @@
 import android.widget.ImageView;
 
 import com.mopub.common.MoPubBrowser;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.util.vast.VastVideoConfiguration;
 
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoViewControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoViewControllerTest.java
index 8013a514..80b115ef 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoViewControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoViewControllerTest.java
@@ -6,7 +6,7 @@
 import android.os.Bundle;
 import android.widget.ImageButton;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.apache.http.HttpRequest;
 import org.junit.After;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidViewTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidViewTest.java
index d145cf61..b8e54fe5 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidViewTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidViewTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -39,29 +7,28 @@
 import android.view.ViewGroup;
 import android.webkit.WebViewClient;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.resource.MraidJavascript;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.ArgumentCaptor;
-import org.mockito.Mockito;
 import org.robolectric.Robolectric;
 import org.robolectric.shadows.ShadowWebView;
 
-import java.util.*;
+import java.util.HashMap;
+import java.util.Map;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
 import static org.mockito.Matchers.anyString;
 import static org.mockito.Matchers.eq;
-import static org.mockito.Mockito.isA;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.spy;
 import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.times;
 import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/ResponseBodyInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/ResponseBodyInterstitialTest.java
index a223ae35..e5832e88 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/ResponseBodyInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/ResponseBodyInterstitialTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import org.junit.Ignore;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/TaskTrackerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/TaskTrackerTest.java
index 5ae760da..604fed40 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/TaskTrackerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/TaskTrackerTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoDownloadTaskTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoDownloadTaskTest.java
index 44f232f1..aa9f1786 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoDownloadTaskTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoDownloadTaskTest.java
@@ -4,7 +4,7 @@
 
 import com.mopub.common.CacheService;
 import com.mopub.common.CacheServiceTest;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 
 import org.junit.After;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java
index a42362ae..ba4a9454 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java
@@ -1,35 +1,3 @@
-/*
-* Copyright (c) 2010-2013, MoPub Inc.
-* All rights reserved.
-*
-* Redistribution and use in source and binary forms, with or without
-* modification, are permitted provided that the following conditions are
-* met:
-*
-*  Redistributions of source code must retain the above copyright
-*   notice, this list of conditions and the following disclaimer.
-*
-*  Redistributions in binary form must reproduce the above copyright
-*   notice, this list of conditions and the following disclaimer in the
-*   documentation and/or other materials provided with the distribution.
-*
-*  Neither the name of 'MoPub Inc.' nor the names of its contributors
-*   may be used to endorse or promote products derived from this software
-*   without specific prior written permission.
-*
-* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-* "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
-* TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-* PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
-* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
-* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
-* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
-* LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
-* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-*/
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -39,7 +7,7 @@
 
 import com.mopub.common.CacheService;
 import com.mopub.common.CacheServiceTest;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 import com.mopub.mobileads.test.support.TestVastManagerFactory;
 import com.mopub.mobileads.test.support.TestVastVideoDownloadTaskFactory;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoToolbarTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoToolbarTest.java
index 0704c19d..f29f0a54 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoToolbarTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoToolbarTest.java
@@ -6,7 +6,7 @@
 import android.widget.TextView;
 
 import com.mopub.mobileads.resource.TextDrawable;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java
index b550e83f..0b414074 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java
@@ -8,23 +8,20 @@
 import android.graphics.drawable.GradientDrawable;
 import android.graphics.drawable.LayerDrawable;
 import android.media.MediaPlayer;
-import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.os.Bundle;
 import android.view.View;
 import android.view.ViewGroup;
 import android.webkit.WebView;
 import android.widget.ImageView;
 import android.widget.VideoView;
-
 import com.mopub.common.MoPubBrowser;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Dips;
 import com.mopub.common.util.Drawables;
-import com.mopub.common.util.VersionCode;
 import com.mopub.mobileads.test.support.GestureUtils;
-import com.mopub.mobileads.test.support.SdkTestRunner;
 import com.mopub.mobileads.util.vast.VastCompanionAd;
 import com.mopub.mobileads.util.vast.VastVideoConfiguration;
-
 import org.apache.http.HttpRequest;
 import org.apache.maven.artifact.ant.shaded.ReflectionUtils;
 import org.junit.After;
@@ -34,14 +31,14 @@
 import org.junit.runner.RunWith;
 import org.mockito.ArgumentCaptor;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowLocalBroadcastManager;
 import org.robolectric.shadows.ShadowVideoView;
 import org.robolectric.tester.org.apache.http.RequestMatcher;
 import org.robolectric.tester.org.apache.http.TestHttpResponse;
 
-import java.io.File;
-import java.util.ArrayList;
-import java.util.Arrays;
+import java.io.*;
+import java.util.*;
 
 import static android.media.MediaPlayer.OnPreparedListener;
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
@@ -499,6 +496,8 @@ public void onPrepared_whenDurationIsLessThanMaxVideoDurationForCloseButton_shou
         stub(mediaPlayer.getDuration()).toReturn(1000);
         setMediaPlayer(mediaPlayer);
 
+        // this callback is typically called when the media filed is loaded and ready to play
+        // invoke this manually since we are using a mock url and don't want to wait
         final OnPreparedListener onPreparedListener = getShadowVideoView().getOnPreparedListener();
         onPreparedListener.onPrepared(null);
 
@@ -628,13 +627,12 @@ public void onError_shouldStopProgressChecker() throws Exception {
         assertThat(subject.getIsVideoProgressShouldBeChecked()).isFalse();
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH_MR1)
     @Test
     public void onError_withVideoFilePermissionErrorBelowJellyBean_shouldRetryPlayingTheVideo() throws Exception {
         File file = new File("disk_video_path");
         file.createNewFile();
 
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", VersionCode.ICE_CREAM_SANDWICH_MR1.getApiLevel());
-
         initializeSubject();
 
         assertThat(getShadowVideoView().getCurrentVideoState()).isEqualTo(-1);
@@ -648,13 +646,12 @@ public void onError_withVideoFilePermissionErrorBelowJellyBean_shouldRetryPlayin
         file.delete();
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH_MR1)
     @Test
     public void retryMediaPlayer_withVideoFilePermissionErrorAndBelowJellyBean_shouldReturnTrue() throws Exception {
         File file = new File("disk_video_path");
         file.createNewFile();
 
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", VersionCode.ICE_CREAM_SANDWICH_MR1.getApiLevel());
-
         initializeSubject();
 
         assertThat(subject.getVideoRetries()).isEqualTo(0);
@@ -664,13 +661,12 @@ public void retryMediaPlayer_withVideoFilePermissionErrorAndBelowJellyBean_shoul
         file.delete();
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH_MR1)
     @Test
     public void retryMediaPlayer_shouldNotRunMoreThanOnce() throws Exception {
         File file = new File("disk_video_path");
         file.createNewFile();
 
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", VersionCode.ICE_CREAM_SANDWICH_MR1.getApiLevel());
-
         initializeSubject();
 
         assertThat(subject.getVideoRetries()).isEqualTo(0);
@@ -683,13 +679,12 @@ public void retryMediaPlayer_shouldNotRunMoreThanOnce() throws Exception {
         file.delete();
     }
 
+    @Config(reportSdk = VERSION_CODES.JELLY_BEAN)
     @Test
     public void retryMediaPlayer_withAndroidVersionAboveJellyBean_shouldReturnFalse() throws Exception {
         File file = new File("disk_video_path");
         file.createNewFile();
 
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", VersionCode.JELLY_BEAN.getApiLevel());
-
         initializeSubject();
 
         assertThat(subject.getVideoRetries()).isEqualTo(0);
@@ -699,13 +694,12 @@ public void retryMediaPlayer_withAndroidVersionAboveJellyBean_shouldReturnFalse(
         file.delete();
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void retryMediaPlayer_withOtherVideoError_shouldReturnFalse() throws Exception {
         File file = new File("disk_video_path");
         file.createNewFile();
 
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", VersionCode.ICE_CREAM_SANDWICH.getApiLevel());
-
         initializeSubject();
 
         assertThat(subject.getVideoRetries()).isEqualTo(0);
@@ -715,6 +709,7 @@ public void retryMediaPlayer_withOtherVideoError_shouldReturnFalse() throws Exce
         file.delete();
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
     public void retryMediaPlayer_withExceptionThrown_shouldReturnFalseAndIncrementRetryCount() throws Exception {
         File file = new File("disk_video_path");
@@ -722,9 +717,6 @@ public void retryMediaPlayer_withExceptionThrown_shouldReturnFalseAndIncrementRe
             assertThat(file.delete()).isTrue();
         }
 
-        // No file will cause FileInputStream to throw
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", VersionCode.ICE_CREAM_SANDWICH.getApiLevel());
-
         initializeSubject();
 
         assertThat(subject.getVideoRetries()).isEqualTo(0);
@@ -1028,13 +1020,12 @@ public void onResume_shouldSetVideoViewStateToStarted() throws Exception {
         assertThat(getShadowVideoView().getPrevVideoState()).isNotEqualTo(ShadowVideoView.START);
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH_MR1)
     @Test
     public void onResume_shouldResetVideoRetryCountToZero() throws Exception {
         File file = new File("disk_video_path");
         file.createNewFile();
 
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", VersionCode.ICE_CREAM_SANDWICH_MR1.getApiLevel());
-
         initializeSubject();
 
         assertThat(subject.retryMediaPlayer(new MediaPlayer(), 1, Integer.MIN_VALUE)).isTrue();
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java
index 86a54d09..cbc01aae 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java
@@ -1,41 +1,11 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
 import android.view.MotionEvent;
 import android.view.View;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewUrlGeneratorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewAdUrlGeneratorTest.java
similarity index 85%
rename from mopub-sdk/src/test/java/com/mopub/mobileads/WebViewUrlGeneratorTest.java
rename to mopub-sdk/src/test/java/com/mopub/mobileads/WebViewAdUrlGeneratorTest.java
index 76f79c4d..7fa291fc 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewUrlGeneratorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewAdUrlGeneratorTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads;
 
 import android.app.Activity;
@@ -38,28 +6,32 @@
 import android.location.Location;
 import android.net.ConnectivityManager;
 import android.net.NetworkInfo;
+import android.net.Uri;
 import android.os.Build;
 import android.provider.Settings;
 import android.telephony.TelephonyManager;
+import android.text.TextUtils;
 
 import com.mopub.common.AdUrlGenerator;
+import com.mopub.common.ClientMetadata;
 import com.mopub.common.GpsHelper;
 import com.mopub.common.GpsHelperTest;
+import com.mopub.common.MoPub;
 import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Reflection.MethodBuilder;
-import com.mopub.common.MoPub;
 import com.mopub.common.util.Utils;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.mobileads.test.support.MoPubShadowTelephonyManager;
 
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mockito;
+import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowConnectivityManager;
 import org.robolectric.shadows.ShadowNetworkInfo;
-import org.robolectric.shadows.ShadowTelephonyManager;
 
 import static android.Manifest.permission.ACCESS_NETWORK_STATE;
 import static android.net.ConnectivityManager.TYPE_DUMMY;
@@ -71,9 +43,9 @@
 import static android.net.ConnectivityManager.TYPE_MOBILE_SUPL;
 import static android.net.ConnectivityManager.TYPE_WIFI;
 import static android.telephony.TelephonyManager.NETWORK_TYPE_UNKNOWN;
-import static com.mopub.common.AdUrlGenerator.MoPubNetworkType;
+import static com.mopub.common.AdUrlGenerator.TwitterAppInstalledStatus;
+import static com.mopub.common.ClientMetadata.MoPubNetworkType;
 import static com.mopub.common.util.Strings.isEmpty;
-import static com.mopub.mobileads.WebViewAdUrlGenerator.TwitterAppInstalledStatus;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
 import static org.mockito.Mockito.doReturn;
@@ -83,13 +55,14 @@
 import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
-public class WebViewUrlGeneratorTest {
+@Config(shadows = {MoPubShadowTelephonyManager.class})
+public class WebViewAdUrlGeneratorTest {
 
     private WebViewAdUrlGenerator subject;
     private static final String TEST_UDID = "20b013c721c";
     private String expectedUdid;
     private Configuration configuration;
-    private ShadowTelephonyManager shadowTelephonyManager;
+    private MoPubShadowTelephonyManager shadowTelephonyManager;
     private ShadowConnectivityManager shadowConnectivityManager;
     private Activity context;
     private MethodBuilder methodBuilder;
@@ -102,7 +75,7 @@ public void setup() {
         Settings.Secure.putString(application.getContentResolver(), Settings.Secure.ANDROID_ID, TEST_UDID);
         expectedUdid = "sha%3A" + Utils.sha1(TEST_UDID);
         configuration = application.getResources().getConfiguration();
-        shadowTelephonyManager = shadowOf((TelephonyManager) application.getSystemService(Context.TELEPHONY_SERVICE));
+        shadowTelephonyManager = (MoPubShadowTelephonyManager) shadowOf((TelephonyManager) application.getSystemService(Context.TELEPHONY_SERVICE));
         shadowConnectivityManager = shadowOf((ConnectivityManager) application.getSystemService(Context.CONNECTIVITY_SERVICE));
         methodBuilder = TestMethodBuilderFactory.getSingletonMock();
     }
@@ -181,23 +154,62 @@ public void generateAdUrl_shouldHandleFunkyNetworkOperatorCodes() throws Excepti
         String adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withMcc("123").withMnc("456").build());
 
+        ClientMetadata.clearForTesting();
         shadowTelephonyManager.setNetworkOperator("12345");
         adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withMcc("123").withMnc("45").build());
 
+        ClientMetadata.clearForTesting();
         shadowTelephonyManager.setNetworkOperator("1234");
         adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withMcc("123").withMnc("4").build());
 
+        ClientMetadata.clearForTesting();
         shadowTelephonyManager.setNetworkOperator("123");
         adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withMcc("123").withMnc("").build());
 
+        ClientMetadata.clearForTesting();
         shadowTelephonyManager.setNetworkOperator("12");
         adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withMcc("12").withMnc("").build());
     }
 
+    @Test
+    public void generateAdUrl_needsAndDoesNotHaveReadPhoneState_shouldNotContainOperatorName() {
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+
+        shadowTelephonyManager.setNeedsReadPhoneState(true);
+        shadowTelephonyManager.setReadPhoneStatePermission(false);
+
+        String adUrl = generateMinimumUrlString();
+        assertThat(adUrl).isEqualTo(urlBuilder.withCarrierName("").build());
+    }
+
+    @Test
+    public void generateAdUrl_needsAndHasReadPhoneState_shouldContainOperatorName() {
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+
+        shadowTelephonyManager.setNeedsReadPhoneState(true);
+        shadowTelephonyManager.setReadPhoneStatePermission(true);
+        shadowTelephonyManager.setNetworkOperatorName("TEST_NAME");
+
+        String adUrl = generateMinimumUrlString();
+        assertThat(adUrl).isEqualTo(urlBuilder.withCarrierName("TEST_NAME").build());
+    }
+
+    @Test
+    public void generateAdUrl_doesNotNeedReadPhoneState_shouldContainOperatorName() {
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+
+        shadowTelephonyManager.setNeedsReadPhoneState(false);
+        shadowTelephonyManager.setReadPhoneStatePermission(false);
+        shadowTelephonyManager.setNetworkOperatorName("TEST_NAME");
+
+        String adUrl = generateMinimumUrlString();
+        assertThat(adUrl).isEqualTo(urlBuilder.withCarrierName("TEST_NAME").build());
+    }
+
     @Test
     public void generateAdurl_whenOnCDMA_shouldGetOwnerStringFromSimCard() throws Exception {
         AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
@@ -341,6 +353,31 @@ public void generateAdUrl_whenGooglePlayServicesIsLinkedAndAdInfoIsCached_should
         assertThat(generateMinimumUrlString()).isEqualTo(expectedAdUrl);
     }
 
+    @Test
+    public void enableLocationTracking_shouldIncludeLocationInUrl() {
+        MoPub.setLocationAwareness(MoPub.LocationAwareness.NORMAL);
+        String adUrl = generateMinimumUrlString();
+        assertThat(getLocationFromRequestUrl(adUrl)).isNotNull();
+    }
+
+    @Test
+    public void disableLocationCollection_shouldNotIncludeLocationInUrl() {
+        MoPub.setLocationAwareness(MoPub.LocationAwareness.DISABLED);
+        String adUrl = generateMinimumUrlString();
+        assertThat(getLocationFromRequestUrl(adUrl)).isNullOrEmpty();
+    }
+
+    private String getLocationFromRequestUrl(String requestString) {
+        Uri requestUri = Uri.parse(requestString);
+        String location = requestUri.getQueryParameter("ll");
+
+        if (TextUtils.isEmpty(location)) {
+            return "";
+        }
+
+        return location;
+    }
+
     private NetworkInfo createNetworkInfo(int type) {
         return ShadowNetworkInfo.newInstance(null,
                 type,
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventBannerFactoryTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventBannerFactoryTest.java
index 6bae7304..771f97c1 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventBannerFactoryTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventBannerFactoryTest.java
@@ -1,40 +1,9 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.AdTypeTranslator;
 import com.mopub.mobileads.CustomEventBanner;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventInterstitialFactoryTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventInterstitialFactoryTest.java
index fd94ae51..81146585 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventInterstitialFactoryTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/factories/CustomEventInterstitialFactoryTest.java
@@ -1,40 +1,9 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.factories;
 
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.AdTypeTranslator;
 import com.mopub.mobileads.CustomEventInterstitial;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/FileUtils.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/FileUtils.java
index 1e8b63a7..ddaab4e5 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/FileUtils.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/FileUtils.java
@@ -1,40 +1,9 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.common.util.Streams;
 
-import java.io.*;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
 
 // note: keep this in test/support folder. this is not intended to be of Utility usage
 public class FileUtils {
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/GestureUtils.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/GestureUtils.java
index b9b9fa5a..eeee2c93 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/GestureUtils.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/GestureUtils.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import android.view.MotionEvent;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/MoPubShadowTelephonyManager.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/MoPubShadowTelephonyManager.java
new file mode 100644
index 00000000..7a4256e5
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/MoPubShadowTelephonyManager.java
@@ -0,0 +1,41 @@
+package com.mopub.mobileads.test.support;
+
+import android.telephony.TelephonyManager;
+
+import org.robolectric.annotation.Implements;
+import org.robolectric.shadows.ShadowTelephonyManager;
+
+@Implements(TelephonyManager.class)
+public class MoPubShadowTelephonyManager extends ShadowTelephonyManager {
+
+    private boolean mNeedsReadPhoneState;
+    private boolean mHasReadPhoneState;
+
+    public MoPubShadowTelephonyManager() {
+        mNeedsReadPhoneState = false;
+        mHasReadPhoneState = false;
+    }
+
+    /**
+     * Some Lenovo & other phones require READ_PHONE_STATE on getNetworkOperatorName().
+     */
+    public void setNeedsReadPhoneState(boolean needsReadPhoneState) {
+        mNeedsReadPhoneState = needsReadPhoneState;
+    }
+
+    @Override
+    public void setReadPhoneStatePermission(final boolean readPhoneStatePermission) {
+        // Robolectric hides its checkReadPhoneState method so we need to hack our own.
+        mHasReadPhoneState = readPhoneStatePermission;
+        super.setReadPhoneStatePermission(readPhoneStatePermission);
+    }
+
+    @Override
+    public String getNetworkOperatorName() {
+        if (!mNeedsReadPhoneState || mHasReadPhoneState) {
+            return super.getNetworkOperatorName();
+        } else {
+            throw new SecurityException("READ_PHONE_STATE is required.");
+        }
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetchTaskFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetchTaskFactory.java
index 199b4ca3..599de6b1 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetchTaskFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetchTaskFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.AdFetchTask;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetcherFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetcherFactory.java
index 3618170c..d36df69b 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetcherFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdFetcherFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.AdFetcher;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdViewControllerFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdViewControllerFactory.java
index f9db330d..6ca5f842 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdViewControllerFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestAdViewControllerFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import android.content.Context;
+
 import com.mopub.mobileads.AdViewController;
 import com.mopub.mobileads.MoPubView;
 import com.mopub.mobileads.factories.AdViewControllerFactory;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerAdapterFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerAdapterFactory.java
index a28d4932..a26bf457 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerAdapterFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerAdapterFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.CustomEventBannerAdapter;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerFactory.java
index 75b7e0f5..ec88b419 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventBannerFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.CustomEventBanner;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialAdapterFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialAdapterFactory.java
index 6fc5066c..10893134 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialAdapterFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialAdapterFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.CustomEventInterstitialAdapter;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialFactory.java
index e9f0a60d..2ca47147 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestCustomEventInterstitialFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.CustomEventInterstitial;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlBannerWebViewFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlBannerWebViewFactory.java
index 03953d7e..0909e309 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlBannerWebViewFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlBannerWebViewFactory.java
@@ -1,39 +1,8 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import android.content.Context;
 import android.webkit.WebSettings;
+
 import com.mopub.mobileads.AdConfiguration;
 import com.mopub.mobileads.HtmlBannerWebView;
 import com.mopub.mobileads.factories.HtmlBannerWebViewFactory;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlInterstitialWebViewFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlInterstitialWebViewFactory.java
index e0be9ec5..d5fea284 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlInterstitialWebViewFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHtmlInterstitialWebViewFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import android.content.Context;
+
 import com.mopub.mobileads.AdConfiguration;
 import com.mopub.mobileads.HtmlInterstitialWebView;
 import com.mopub.mobileads.factories.HtmlInterstitialWebViewFactory;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpClientFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpClientFactory.java
index e01ca95c..2a364a19 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpClientFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpClientFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.factories.HttpClientFactory;
+
 import org.apache.http.impl.client.DefaultHttpClient;
 
 public class TestHttpClientFactory extends HttpClientFactory {
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpResponseWithHeaders.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpResponseWithHeaders.java
index db63f8ba..e2ca6644 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpResponseWithHeaders.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpResponseWithHeaders.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import org.apache.http.Header;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMoPubViewFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMoPubViewFactory.java
index 9296dd0a..971b61b2 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMoPubViewFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMoPubViewFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import android.content.Context;
+
 import com.mopub.mobileads.MoPubView;
 import com.mopub.mobileads.factories.MoPubViewFactory;
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMraidViewFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMraidViewFactory.java
index 5e262c43..005ac90d 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMraidViewFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestMraidViewFactory.java
@@ -1,38 +1,7 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import android.content.Context;
+
 import com.mopub.mobileads.AdConfiguration;
 import com.mopub.mobileads.MraidView;
 import com.mopub.mobileads.factories.MraidViewFactory;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestVastVideoDownloadTaskFactory.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestVastVideoDownloadTaskFactory.java
index 9fa60cfd..fb9b24f7 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestVastVideoDownloadTaskFactory.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestVastVideoDownloadTaskFactory.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 import com.mopub.mobileads.VastVideoDownloadTask;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/ThreadUtils.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/ThreadUtils.java
index 5e0b0fdb..5d143b2f 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/ThreadUtils.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/ThreadUtils.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test.support;
 
 // note: keep this in test/support folder. this is not intended to be of Utility usage
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpClientsTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpClientsTest.java
index bbe55de4..b2bbbb3b 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpClientsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpClientsTest.java
@@ -1,6 +1,6 @@
 package com.mopub.mobileads.util;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.ThreadUtils;
 import org.apache.http.client.HttpClient;
 import org.apache.http.conn.ClientConnectionManager;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpResponsesTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpResponsesTest.java
index 5ab561b1..54981b2e 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpResponsesTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/util/HttpResponsesTest.java
@@ -1,39 +1,8 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.util;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
+
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/util/MraidsTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/util/MraidsTest.java
index 5f9bd441..6e24109d 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/util/MraidsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/util/MraidsTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.util;
 
 import android.Manifest;
@@ -39,17 +7,22 @@
 import android.content.pm.PackageManager;
 import android.content.pm.ResolveInfo;
 import android.os.Build;
+import android.os.Build.VERSION_CODES;
 import android.os.Environment;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.hamcrest.BaseMatcher;
 import org.hamcrest.Description;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowEnvironment;
 
-import java.util.*;
+import java.util.ArrayList;
+import java.util.List;
 
 import static com.mopub.common.util.VersionCode.HONEYCOMB_MR2;
 import static com.mopub.common.util.VersionCode.ICE_CREAM_SANDWICH;
@@ -120,27 +93,25 @@ public void isStorePictureAvailable_whenMediaUnmounted_shouldReturnFalse() throw
         assertThat(Mraids.isStorePictureSupported(context)).isFalse();
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void isCalendarAvailable_whenApiLevelICS_shouldReturnTrue() throws Exception {
+    public void isCalendarAvailable_atLeastIcs_shouldReturnTrue() throws Exception {
         context = createMockContextWithSpecificIntentData(null, null, Mraids.ANDROID_CALENDAR_CONTENT_TYPE, "android.intent.action.INSERT");
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
-
         assertThat(Mraids.isCalendarAvailable(context)).isTrue();
     }
 
+    @Config(reportSdk = VERSION_CODES.HONEYCOMB_MR2)
     @Test
-    public void isCalendarAvailable_whenApiLevelBelowICS_shouldReturnFalse() throws Exception {
+    public void isCalendarAvailable_beforeIcs_shouldReturnFalse() throws Exception {
         context = createMockContextWithSpecificIntentData(null, null, Mraids.ANDROID_CALENDAR_CONTENT_TYPE, "android.intent.action.INSERT");
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", HONEYCOMB_MR2.getApiLevel());
-
         assertThat(Mraids.isCalendarAvailable(context)).isFalse();
     }
 
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
     @Test
-    public void isCalendarAvailable_whenApiLevelICSButCanNotAcceptIntent_shouldReturnFalse() throws Exception {
+    public void isCalendarAvailable_atLeastIcs_butCanNotAcceptIntent_shouldReturnFalse() throws
+            Exception {
         context = createMockContextWithSpecificIntentData(null, null, "vnd.android.cursor.item/NOPE", "android.intent.action.INSERT");
-        Robolectric.Reflection.setFinalStaticField(Build.VERSION.class, "SDK_INT", ICE_CREAM_SANDWICH.getApiLevel());
-
         assertThat(Mraids.isCalendarAvailable(context)).isFalse();
     }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastManagerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastManagerTest.java
index 26e5bf1a..4e1faf55 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastManagerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastManagerTest.java
@@ -6,7 +6,7 @@
 import android.view.WindowManager;
 
 import com.mopub.common.CacheService;
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.After;
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregatorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregatorTest.java
index 3b9324ad..f7ddc3f2 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregatorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerAggregatorTest.java
@@ -1,6 +1,6 @@
 package com.mopub.mobileads.util.vast;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerTest.java
index 80072ad8..dd7bb02b 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/util/vast/VastXmlManagerTest.java
@@ -1,6 +1,6 @@
 package com.mopub.mobileads.util.vast;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/AdapterHelperTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/AdapterHelperTest.java
index db692e8b..fe8f94c7 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/AdapterHelperTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/AdapterHelperTest.java
@@ -2,7 +2,7 @@
 
 import android.app.Activity;
 
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/BaseForwardingNativeAdTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/BaseForwardingNativeAdTest.java
index cadf1625..d9d5a191 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/BaseForwardingNativeAdTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/BaseForwardingNativeAdTest.java
@@ -1,8 +1,7 @@
 package com.mopub.nativeads;
 
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
-import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -19,11 +18,6 @@ public void setUp() throws Exception {
         subject = new BaseForwardingNativeAd() {};
     }
 
-    @After
-    public void tearDown() throws Exception {
-        ImpressionTrackingManager.clearTracking();
-    }
-
     @Test
     public void constructor_shouldInitializeMembers() throws Exception {
         assertThat(subject.getImpressionMinPercentageViewed()).isEqualTo(50);
@@ -46,7 +40,7 @@ public void setImpressionMinTimeViewed_whenTimeIsLessThan0_shouldNotSetTime() th
         subject.setImpressionMinTimeViewed(-1);
         assertThat(subject.getImpressionMinTimeViewed()).isEqualTo(250);
     }
-    
+
     @Test
     public void setStarRating_withinValidRange_shouldSetStarRating() throws Exception {
         subject.setStarRating(0.0);
@@ -84,7 +78,7 @@ public void setStarRating_withNanOrInf_shouldNotSetStarRating() throws Exception
         subject.setStarRating(Double.NEGATIVE_INFINITY);
         assertThat(subject.getStarRating()).isEqualTo(initialStarRating);
     }
-    
+
     @Test
     public void setStarRating_withValuesOutsideOfValidRange_shouldNotSetStarRating() throws Exception {
         // First, set star rating to a valid value
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/CustomEventNativeAdapterTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/CustomEventNativeAdapterTest.java
index 1939b6c5..85fe6d61 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/CustomEventNativeAdapterTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/CustomEventNativeAdapterTest.java
@@ -5,7 +5,7 @@
 import com.mopub.common.DownloadResponse;
 import com.mopub.common.util.ResponseHeader;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.nativeads.test.support.TestCustomEventNativeFactory;
 
 import org.junit.Before;
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDiskTaskManagerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDiskTaskManagerTest.java
index 030f41b8..6d6e7195 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDiskTaskManagerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDiskTaskManagerTest.java
@@ -6,12 +6,13 @@
 
 import com.mopub.common.CacheService;
 import com.mopub.common.CacheServiceTest;
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.Mock;
 import org.mockito.invocation.InvocationOnMock;
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
@@ -22,18 +23,16 @@
 import java.util.Map;
 import java.util.concurrent.Semaphore;
 
-import static com.mopub.nativeads.ImageTaskManager.ImageTaskManagerListener;
+import static com.mopub.nativeads.TaskManager.TaskManagerListener;
 import static junit.framework.Assert.fail;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.anyMap;
 import static org.mockito.Mockito.doAnswer;
-import static org.mockito.Mockito.mock;
-import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 public class ImageDiskTaskManagerTest {
 
-    private ImageTaskManagerListener imageTaskManagerListener;
+    @Mock private TaskManagerListener<Bitmap> imageTaskManagerListener;
     private Semaphore semaphore;
     private Map<String, Bitmap> bitmaps;
     private FakeHttpLayer fakeHttpLayer;
@@ -45,12 +44,12 @@
     private String imageData3;
     private List<String> list;
     private Context context;
+    private static final int TEST_WIDTH = 400;
 
     @Before
     public void setUp() throws Exception {
         context = new Activity();
         semaphore = new Semaphore(0);
-        imageTaskManagerListener = mock(ImageTaskManagerListener.class);
         doAnswer(new Answer() {
             @Override
             public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
@@ -90,7 +89,7 @@ public void tearDown() throws Exception {
     @Test
     public void constructor_withNullUrlsList_shouldThrowIllegalArgumentException() throws Exception {
         try {
-            new ImageDiskTaskManager(null, imageTaskManagerListener);
+            new ImageDiskTaskManager(null, imageTaskManagerListener, TEST_WIDTH);
             fail("Should have thrown IllegalArgumentException");
         } catch (IllegalArgumentException e) {
             // pass
@@ -102,7 +101,7 @@ public void constructor_withNullInUrlsList_shouldThrowIllegalArgumentException()
         List<String> myList = new ArrayList<String>();
         myList.add(null);
         try {
-            new ImageDiskTaskManager(myList, imageTaskManagerListener);
+            new ImageDiskTaskManager(myList, imageTaskManagerListener, TEST_WIDTH);
             fail("Should have thrown IllegalArgumentException");
         } catch (IllegalArgumentException e) {
             // pass
@@ -112,7 +111,7 @@ public void constructor_withNullInUrlsList_shouldThrowIllegalArgumentException()
     @Test
     public void constructor_withNullImageTaskManagerListener_shouldThrowIllegalArgumentException() throws Exception {
         try {
-            new ImageDiskTaskManager(list, null);
+            new ImageDiskTaskManager(list, null, TEST_WIDTH);
             fail("Should have thrown IllegalArgumentException");
         } catch (IllegalArgumentException e) {
             // pass
@@ -121,7 +120,7 @@ public void constructor_withNullImageTaskManagerListener_shouldThrowIllegalArgum
 
     @Test
     public void execute_withEmptyDiskCache_shouldReturnNullsInMap() throws Exception {
-        new ImageDiskTaskManager(list, imageTaskManagerListener).execute();
+        new ImageDiskTaskManager(list, imageTaskManagerListener, TEST_WIDTH).execute();
         semaphore.acquire();
 
         assertThat(bitmaps.size()).isEqualTo(2);
@@ -133,30 +132,30 @@ public void execute_withEmptyDiskCache_shouldReturnNullsInMap() throws Exception
 
     @Test
     public void execute_withPopulatedDiskCache_shouldReturnImagesInMap() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
         CacheService.putToDiskCache(url1, imageData1.getBytes());
         CacheService.putToDiskCache(url2, imageData2.getBytes());
 
-        new ImageDiskTaskManager(list, imageTaskManagerListener).execute();
+        new ImageDiskTaskManager(list, imageTaskManagerListener, TEST_WIDTH).execute();
         semaphore.acquire();
 
         assertThat(bitmaps.size()).isEqualTo(2);
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
-        assertThat(shadowOf(bitmaps.get(url2)).getCreatedFromBytes()).isEqualTo(imageData2.getBytes());
+        assertThat(bitmaps.get(url1)).isNotNull();
+        assertThat(bitmaps.get(url2)).isNotNull();
     }
 
     @Test
     public void execute_withPartiallyPopulatedDiskCache_shouldReturnSomeImagesInMap() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
         CacheService.putToDiskCache(url1, imageData1.getBytes());
 
-        new ImageDiskTaskManager(list, imageTaskManagerListener).execute();
+        new ImageDiskTaskManager(list, imageTaskManagerListener, TEST_WIDTH).execute();
         semaphore.acquire();
 
         assertThat(bitmaps.size()).isEqualTo(2);
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
+        assertThat(bitmaps.get(url1)).isNotNull();
         assertThat(bitmaps.containsKey(url2)).isTrue();
         assertThat(bitmaps.get(url2)).isNull();
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDownloadTaskManagerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDownloadTaskManagerTest.java
index 3c6734f8..b9664d43 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDownloadTaskManagerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageDownloadTaskManagerTest.java
@@ -1,8 +1,7 @@
 package com.mopub.nativeads;
 
-import android.graphics.Bitmap;
-
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.DownloadResponse;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.apache.http.HttpEntity;
 import org.apache.http.HttpResponse;
@@ -11,6 +10,7 @@
 import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.Mock;
 import org.mockito.invocation.InvocationOnMock;
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
@@ -23,6 +23,7 @@
 import java.util.Map;
 import java.util.concurrent.Semaphore;
 
+import static com.mopub.nativeads.TaskManager.TaskManagerListener;
 import static junit.framework.Assert.fail;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.anyMap;
@@ -31,15 +32,15 @@
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
-import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 public class ImageDownloadTaskManagerTest {
 
     private ImageDownloadTaskManager subject;
-    private ImageDownloadTaskManager.ImageTaskManagerListener mMockImageTaskManagerListener;
+    @Mock private TaskManagerListener<DownloadResponse> mMockImageTaskManagerListener;
     private Semaphore semaphore;
-    private Map<String, Bitmap> networkImages;
+    private Map<String, DownloadResponse> networkImages;
+    private int testMaxWidth;
     private FakeHttpLayer fakeHttpLayer;
     private String url1;
     private String url2;
@@ -47,12 +48,11 @@
     @Before
     public void setUp() throws Exception {
         semaphore = new Semaphore(0);
-        mMockImageTaskManagerListener = mock(ImageDownloadTaskManager.ImageTaskManagerListener.class);
         doAnswer(new Answer() {
             @Override
             public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
                 Object[] args = invocationOnMock.getArguments();
-                Map<String, Bitmap> map = (Map)args[0];
+                Map<String, DownloadResponse> map = (Map)args[0];
                 ImageDownloadTaskManagerTest.this.networkImages = map;
                 semaphore.release();
                 return null;
@@ -65,6 +65,7 @@ public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
                 return null;
             }
         }).when(mMockImageTaskManagerListener).onFail();
+        testMaxWidth = 30;
 
         fakeHttpLayer = Robolectric.getFakeHttpLayer();
         url1 = "http://www.mopub.com/";
@@ -75,7 +76,8 @@ public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
     public void constructor_withValidUrlListAndListener_shouldReturnNewImageDownloadTaskManager() throws Exception {
         subject = new ImageDownloadTaskManager(
                 Arrays.asList(url1, url2),
-                mMockImageTaskManagerListener
+                mMockImageTaskManagerListener,
+                testMaxWidth
         );
     }
 
@@ -83,7 +85,8 @@ public void constructor_withValidUrlListAndListener_shouldReturnNewImageDownload
     public void constructor_withEmptyUrlListAndListener_shouldReturnNewImageDownloadTaskManager() throws Exception {
         subject = new ImageDownloadTaskManager(
                 new ArrayList<String>(),
-                mMockImageTaskManagerListener
+                mMockImageTaskManagerListener,
+                testMaxWidth
         );
     }
 
@@ -92,7 +95,8 @@ public void constructor_withInvalidUrlList_shouldThrowIllegalArgumentException()
         try {
             subject = new ImageDownloadTaskManager(
                     Arrays.asList("BAD URL", url2),
-                    mMockImageTaskManagerListener
+                    mMockImageTaskManagerListener,
+                    testMaxWidth
             );
             fail("ImageDownloadTaskManager didn't throw an illegal argument exception");
         } catch (IllegalArgumentException e) {
@@ -102,7 +106,8 @@ public void constructor_withInvalidUrlList_shouldThrowIllegalArgumentException()
         try {
             subject = new ImageDownloadTaskManager(
                     Arrays.asList(url1, null),
-                    mMockImageTaskManagerListener
+                    mMockImageTaskManagerListener,
+                    testMaxWidth
             );
             fail("ImageDownloadTaskManager didn't throw an illegal argument exception");
         } catch (IllegalArgumentException e) {
@@ -115,7 +120,8 @@ public void constructor_withAnyNullParams_shouldThrowIllegalArgumentException()
         try {
             subject = new ImageDownloadTaskManager(
                     null,
-                    mMockImageTaskManagerListener
+                    mMockImageTaskManagerListener,
+                    testMaxWidth
             );
             fail("ImageDownloadTaskManager didn't throw an illegal argument exception");
         } catch (IllegalArgumentException e) {
@@ -125,7 +131,8 @@ public void constructor_withAnyNullParams_shouldThrowIllegalArgumentException()
         try {
             subject = new ImageDownloadTaskManager(
                     Arrays.asList(url1, url2),
-                    null
+                    null,
+                    testMaxWidth
             );
             fail("ImageDownloadTaskManager didn't throw an illegal argument exception");
         } catch (IllegalArgumentException e) {
@@ -134,34 +141,26 @@ public void constructor_withAnyNullParams_shouldThrowIllegalArgumentException()
     }
 
     @Test
-    public void execute_withValidUrlListAndListenerAndHttpResponses_shouldReturnMapOfUrlToBitmap() throws Exception {
+    public void execute_withValidUrlListAndListenerAndHttpResponses_shouldReturnMapOfUrlToDownloadResponse() throws Exception {
         subject = new ImageDownloadTaskManager(
                 Arrays.asList(url1, url2),
-                mMockImageTaskManagerListener
+                mMockImageTaskManagerListener,
+                testMaxWidth
         );
 
         String imageData1 = "image_data_1";
-        Robolectric.addHttpResponseRule(
-                url1,
-                new TestHttpResponse(200, imageData1)
-        );
-
         String imageData2 = "image_data_2";
-        Robolectric.addHttpResponseRule(
-                url2,
-                new TestHttpResponse(200, imageData2)
-        );
+        fakeHttpLayer.addPendingHttpResponse(200, imageData1);
+        fakeHttpLayer.addPendingHttpResponse(200, imageData2);
 
         subject.execute();
         semaphore.acquire();
 
         assertThat(networkImages.keySet()).containsOnly(url1, url2);
 
-        Bitmap bitmap1 = networkImages.get(url1);
-        assertThat(shadowOf(bitmap1).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
-
-        Bitmap bitmap2 = networkImages.get(url2);
-        assertThat(shadowOf(bitmap2).getCreatedFromBytes()).isEqualTo(imageData2.getBytes());
+        // These statements will fail if the objects are not of the correct type.
+        DownloadResponse bitmap1 = networkImages.get(url1);
+        DownloadResponse bitmap2 = networkImages.get(url2);
 
         verify(mMockImageTaskManagerListener).onSuccess(anyMap());
         verify(mMockImageTaskManagerListener, never()).onFail();
@@ -171,7 +170,8 @@ public void execute_withValidUrlListAndListenerAndHttpResponses_shouldReturnMapO
     public void execute_withEmptyUrlList_shouldReturnEmptyMap() throws Exception {
         subject = new ImageDownloadTaskManager(
                 new ArrayList<String>(),
-                mMockImageTaskManagerListener
+                mMockImageTaskManagerListener,
+                testMaxWidth
         );
 
         subject.execute();
@@ -186,7 +186,8 @@ public void execute_withEmptyUrlList_shouldReturnEmptyMap() throws Exception {
     public void execute_withSingleNon200Response_shouldFailAllTasks() throws Exception {
         subject = new ImageDownloadTaskManager(
                 Arrays.asList(url1, url1, url1, url1, url1),
-                mMockImageTaskManagerListener
+                mMockImageTaskManagerListener,
+                testMaxWidth
         );
 
         fakeHttpLayer.addPendingHttpResponse(200, "");
@@ -206,7 +207,8 @@ public void execute_withSingleNon200Response_shouldFailAllTasks() throws Excepti
     public void execute_withMultipleNon200Response_shouldFailAllTasks() throws Exception {
         subject = new ImageDownloadTaskManager(
                 Arrays.asList(url1, url1, url1, url1, url1),
-                mMockImageTaskManagerListener
+                mMockImageTaskManagerListener,
+                testMaxWidth
         );
 
         fakeHttpLayer.addPendingHttpResponse(599, "");
@@ -227,7 +229,8 @@ public void execute_withMultipleNon200Response_shouldFailAllTasks() throws Excep
     public void execute_withSingleInvalidHttpResponse_shouldFailAllTasks() throws Exception {
         subject = new ImageDownloadTaskManager(
                 Arrays.asList(url1, url1, url1, url1, url1),
-                mMockImageTaskManagerListener
+                mMockImageTaskManagerListener,
+                testMaxWidth
         );
 
         fakeHttpLayer.addPendingHttpResponse(200, "");
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageServiceTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageServiceTest.java
index 55e792e5..f1298d06 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageServiceTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageServiceTest.java
@@ -7,7 +7,10 @@
 
 import com.mopub.common.CacheService;
 import com.mopub.common.CacheServiceTest;
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.DownloadResponse;
+import com.mopub.nativeads.test.support.MoPubShadowBitmap;
+import com.mopub.nativeads.test.support.MoPubShadowDisplay;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.After;
 import org.junit.Before;
@@ -16,6 +19,7 @@
 import org.mockito.invocation.InvocationOnMock;
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.tester.org.apache.http.FakeHttpLayer;
 
 import java.io.ByteArrayInputStream;
@@ -33,11 +37,12 @@
 import static org.mockito.Mockito.doAnswer;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.spy;
+import static org.mockito.Mockito.when;
 import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
+@Config(shadows={MoPubShadowBitmap.class, MoPubShadowDisplay.class})
 public class ImageServiceTest {
-
     private ImageServiceListener imageServiceListener;
     private Semaphore semaphore;
     private Map<String, Bitmap> bitmaps;
@@ -49,6 +54,9 @@
     private String imageData2;
     private String imageData3;
     private Context context;
+    private Bitmap image2;
+    private Bitmap image1;
+    private DownloadResponse downloadResponse;
 
     @Before
     public void setUp() throws Exception {
@@ -72,6 +80,7 @@ public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
             }
         }).when(imageServiceListener).onFail();
 
+        downloadResponse = mock(DownloadResponse.class);
         fakeHttpLayer = Robolectric.getFakeHttpLayer();
         url1 = "http://www.mopub.com/";
         url2 = "http://www.twitter.com";
@@ -79,7 +88,11 @@ public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
         imageData1 = "image_data_1";
         imageData2 = "image_data_2";
         imageData3 = "image_data_3";
+        image1 = BitmapFactory.decodeByteArray(imageData1.getBytes(), 0, imageData1.getBytes().length);
+        image2 = BitmapFactory.decodeByteArray(imageData2.getBytes(), 0, imageData2.getBytes().length);
         context = new Activity();
+
+        ImageService.initialize(context);
     }
 
     @After
@@ -90,30 +103,40 @@ public void tearDown() throws Exception {
     @Test
     public void get_shouldInitializeCaches() throws Exception {
         CacheService.clearAndNullCaches();
-        assertThat(CacheService.getMemoryLruCache()).isNull();
+        assertThat(CacheService.getBitmapLruCache()).isNull();
         assertThat(CacheService.getDiskLruCache()).isNull();
 
         ImageService.get(context, new ArrayList<String>(), imageServiceListener);
 
-        assertThat(CacheService.getMemoryLruCache()).isNotNull();
+        assertThat(CacheService.getBitmapLruCache()).isNotNull();
         assertThat(CacheService.getDiskLruCache()).isNotNull();
     }
 
+    @Test
+    public void get_shouldGetDisplaySize() {
+        ImageService.clear();
+        assertThat(ImageService.getTargetWidth()).isEqualTo(-1);
+
+        ImageService.get(context, new ArrayList<String>(), imageServiceListener);
+        assertThat(ImageService.getTargetWidth()).isGreaterThan(-1);
+    }
+
     @Test
     public void get_withImageInMemoryCache_shouldReturnImage() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
-        CacheService.putToMemoryCache(url1, imageData1.getBytes());
+        CacheService.putToBitmapCache(url1, image1);
 
         ImageService.get(context, Arrays.asList(url1), imageServiceListener);
         // no need for semaphore since memory cache is synchronous
 
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
+        assertThat(shadowOf(bitmaps.get(url1)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
     }
 
     @Test
     public void get_withImageInDiskCache_shouldReturnImage() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
         CacheService.putToDiskCache(url1, imageData1.getBytes());
 
@@ -121,12 +144,13 @@ public void get_withImageInDiskCache_shouldReturnImage() throws Exception {
         semaphore.acquire();
 
         assertThat(fakeHttpLayer.getLastSentHttpRequestInfo()).isNull();
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
+        assertThat(shadowOf(bitmaps.get(url1)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
     }
 
     @Test
     public void get_withEmptyCaches_shouldGetImageFromNetwork() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
         fakeHttpLayer.addPendingHttpResponse(200, imageData1);
@@ -134,31 +158,33 @@ public void get_withEmptyCaches_shouldGetImageFromNetwork() throws Exception {
         ImageService.get(context, Arrays.asList(url1), imageServiceListener);
         semaphore.acquire();
 
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
+        assertThat(shadowOf(bitmaps.get(url1)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
     }
 
     @Test
     public void get_withImagesInMemoryCacheAndDiskCache_shouldReturnBothImages() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
-        CacheService.putToMemoryCache(url1, imageData1.getBytes());
+        CacheService.putToBitmapCache(url1, image1);
         CacheService.putToDiskCache(url2, imageData2.getBytes());
 
         ImageService.get(context, Arrays.asList(url1, url2), imageServiceListener);
         semaphore.acquire();
 
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
+        assertThat(bitmaps.get(url1)).isEqualTo(image1);
         assertThat(fakeHttpLayer.getLastSentHttpRequestInfo()).isNull();
-        assertThat(shadowOf(bitmaps.get(url2)).getCreatedFromBytes()).isEqualTo(imageData2.getBytes());
+        assertThat(shadowOf(bitmaps.get(url2)).getDescription())
+                .isEqualTo("Bitmap for image_data_2");
     }
 
     @Test
     public void get_withImagesInMemoryAndNetwork_shouldReturnBothImages() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
-        CacheService.putToMemoryCache(url1, imageData1.getBytes());
+        CacheService.putToBitmapCache(url1, image1);
         fakeHttpLayer.addPendingHttpResponse(200, imageData2);
 
         ImageService.get(context, Arrays.asList(url1, url2), imageServiceListener);
@@ -166,12 +192,13 @@ public void get_withImagesInMemoryAndNetwork_shouldReturnBothImages() throws Exc
 
         assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
         assertThat(fakeHttpLayer.getLastSentHttpRequestInfo().getHttpHost().toString()).isEqualTo(url2);
-        assertThat(shadowOf(bitmaps.get(url2)).getCreatedFromBytes()).isEqualTo(imageData2.getBytes());
+        assertThat(shadowOf(bitmaps.get(url2)).getDescription())
+                .isEqualTo("Bitmap for image_data_2");
     }
 
     @Test
     public void get_withImagesInDiskAndNetwork_shouldReturnBothImages() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
         CacheService.putToDiskCache(url1, imageData1.getBytes());
@@ -180,17 +207,19 @@ public void get_withImagesInDiskAndNetwork_shouldReturnBothImages() throws Excep
         ImageService.get(context, Arrays.asList(url1, url2), imageServiceListener);
         semaphore.acquire();
 
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
+        assertThat(shadowOf(bitmaps.get(url1)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
         assertThat(fakeHttpLayer.getLastSentHttpRequestInfo().getHttpHost().toString()).isEqualTo(url2);
-        assertThat(shadowOf(bitmaps.get(url2)).getCreatedFromBytes()).isEqualTo(imageData2.getBytes());
+        assertThat(shadowOf(bitmaps.get(url2)).getDescription())
+                .isEqualTo("Bitmap for image_data_2");
     }
 
     @Test
     public void get_withImagesInMemoryAndDiskAndNetwork_shouldReturnAllImages() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
-        CacheService.putToMemoryCache(url1, imageData1.getBytes());
+        CacheService.putToBitmapCache(url1, image1);
         CacheService.putToDiskCache(url2, imageData2.getBytes());
         fakeHttpLayer.addPendingHttpResponse(200, imageData3);
 
@@ -198,16 +227,18 @@ public void get_withImagesInMemoryAndDiskAndNetwork_shouldReturnAllImages() thro
         semaphore.acquire();
 
         assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData1.getBytes());
-        assertThat(shadowOf(bitmaps.get(url2)).getCreatedFromBytes()).isEqualTo(imageData2.getBytes());
-        assertThat(shadowOf(bitmaps.get(url3)).getCreatedFromBytes()).isEqualTo(imageData3.getBytes());
+        assertThat(shadowOf(bitmaps.get(url2)).getDescription())
+                .isEqualTo("Bitmap for image_data_2");
+        assertThat(shadowOf(bitmaps.get(url3)).getDescription())
+                .isEqualTo("Bitmap for image_data_3");
     }
 
     @Test
     public void get_withSameKeysInMemoryAndDiskCache_shouldReturnValueFromMemoryCache() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
-        CacheService.putToMemoryCache(url1, imageData2.getBytes());
+        CacheService.putToBitmapCache(url1, image2);
         CacheService.putToDiskCache(url1, imageData1.getBytes());
 
         ImageService.get(context, Arrays.asList(url1), imageServiceListener);
@@ -218,10 +249,10 @@ public void get_withSameKeysInMemoryAndDiskCache_shouldReturnValueFromMemoryCach
 
     @Test
     public void get_withSameKeysInMemoryAndNetwork_shouldReturnValueFromMemoryCache() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
-        CacheService.putToMemoryCache(url1, imageData2.getBytes());
+        CacheService.putToBitmapCache(url1, image2);
         fakeHttpLayer.addPendingHttpResponse(200, imageData1);
 
         ImageService.get(context, Arrays.asList(url1), imageServiceListener);
@@ -232,7 +263,7 @@ public void get_withSameKeysInMemoryAndNetwork_shouldReturnValueFromMemoryCache(
 
     @Test
     public void get_withSameKeysInDiskAndNetwork_shouldReturnValueFromDiskCache() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
         CacheService.putToDiskCache(url1, imageData2.getBytes());
@@ -241,15 +272,17 @@ public void get_withSameKeysInDiskAndNetwork_shouldReturnValueFromDiskCache() th
         ImageService.get(context, Arrays.asList(url1), imageServiceListener);
         semaphore.acquire();
 
-        assertThat(shadowOf(bitmaps.get(url1)).getCreatedFromBytes()).isEqualTo(imageData2.getBytes());
+        assertThat(fakeHttpLayer.getLastSentHttpRequestInfo()).isNull();
+        assertThat(shadowOf(bitmaps.get(url1)).getDescription())
+                .isEqualTo("Bitmap for image_data_2");
     }
 
     @Test
     public void get_withNetworkFailure_shouldFail() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
-        CacheService.putToMemoryCache(url1, imageData1.getBytes());
+        CacheService.putToBitmapCache(url1, image1);
         CacheService.putToDiskCache(url2, imageData2.getBytes());
         fakeHttpLayer.addPendingHttpResponse(500, imageData3);
 
@@ -261,7 +294,7 @@ public void get_withNetworkFailure_shouldFail() throws Exception {
 
     @Test
     public void get_withMultipleNetworkSuccessAndOneFailure_shouldFail() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
         CacheServiceTest.assertCachesAreEmpty();
 
         fakeHttpLayer.addPendingHttpResponse(200, imageData1);
@@ -275,34 +308,34 @@ public void get_withMultipleNetworkSuccessAndOneFailure_shouldFail() throws Exce
     }
 
     @Test
-    public void putBitmapsInCache_populatesCaches() throws Exception {
-        CacheService.initializeCaches(context);
+    public void putDataInCache_populatesCaches() throws Exception {
+        CacheService.initialize(context);
 
         Bitmap bitmap1 = BitmapFactory.decodeStream(getInputStreamFromString(imageData1));
         Bitmap bitmap2 = BitmapFactory.decodeStream(getInputStreamFromString(imageData2));
 
-        Map<String, Bitmap> bitmaps = new HashMap<String, Bitmap>(2);
-        bitmaps.put(url1, bitmap1);
-        bitmaps.put(url2, bitmap2);
-
         assertThat(ImageService.getBitmapFromDiskCache(url1)).isNull();
         assertThat(ImageService.getBitmapFromDiskCache(url2)).isNull();
         assertThat(ImageService.getBitmapFromMemoryCache(url1)).isNull();
         assertThat(ImageService.getBitmapFromMemoryCache(url2)).isNull();
 
-        ImageService.putBitmapsInCache(bitmaps);
+        ImageService.putDataInCache(url1, bitmap1, imageData1.getBytes());
+        ImageService.putDataInCache(url2, bitmap2, imageData2.getBytes());
+
         Thread.sleep(500); // disk cache put is async
 
-        assertThat(ImageService.getBitmapFromDiskCache(url1)).isNotNull();
-        assertThat(ImageService.getBitmapFromDiskCache(url2)).isNotNull();
-        assertThat(ImageService.getBitmapFromMemoryCache(url1)).isNotNull();
-        assertThat(ImageService.getBitmapFromMemoryCache(url2)).isNotNull();
+        assertThat(shadowOf(ImageService.getBitmapFromDiskCache(url1)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
+        assertThat(shadowOf(ImageService.getBitmapFromDiskCache(url2)).getDescription())
+                .isEqualTo("Bitmap for image_data_2");
+        assertThat(ImageService.getBitmapFromMemoryCache(url1)).isEqualTo(bitmap1);
+        assertThat(ImageService.getBitmapFromMemoryCache(url2)).isEqualTo(bitmap2);
     }
 
     @Test
     public void getBitmapsFromMemoryCache_withEmptyCacheAndTwoUrls_returnsNoCacheHitsAndTwoCacheMisses() throws Exception {
-        CacheService.initializeCaches(context);
-        assertThat(CacheService.getMemoryLruCache().size()).isEqualTo(0);
+        CacheService.initialize(context);
+        assertThat(CacheService.getBitmapLruCache().size()).isEqualTo(0);
 
         Map<String, Bitmap> cacheHits = new HashMap<String, Bitmap>(2);
         List<String> cacheMisses =
@@ -314,11 +347,11 @@ public void getBitmapsFromMemoryCache_withEmptyCacheAndTwoUrls_returnsNoCacheHit
 
     @Test
     public void getBitmapsFromMemoryCache_withOneCacheEntryAndTwoUrls_returnsOneCacheHitAndOneCacheMiss() throws Exception {
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
 
-        assertThat(CacheService.getMemoryLruCache().size()).isEqualTo(0);
+        assertThat(CacheService.getBitmapLruCache().size()).isEqualTo(0);
 
-        CacheService.putToMemoryCache(url1, imageData1.getBytes());
+        CacheService.putToBitmapCache(url1, image1);
 
         Map<String, Bitmap> cacheHits = new HashMap<String, Bitmap>(2);
         List<String> cacheMisses =
@@ -328,6 +361,45 @@ public void getBitmapsFromMemoryCache_withOneCacheEntryAndTwoUrls_returnsOneCach
         assertThat(cacheMisses).containsOnly(url2);
     }
 
+    @Test
+    public void asBitmap_withMaxSize_shouldReturnBitmap() {
+
+        String imageData = "fake_bitmap_data";
+        when(downloadResponse.getByteArray()).thenReturn(imageData.getBytes());
+
+        final Bitmap bitmap = ImageService.asBitmap(downloadResponse, 30);
+
+        assertThat(bitmap).isNotNull();
+        assertThat(bitmap).isInstanceOf(Bitmap.class);
+    }
+
+    @Test
+    public void asBitmap_withNullResponse_shouldReturnNull() throws Exception {
+        final Bitmap bitmap = ImageService.asBitmap(null, 30);
+
+        assertThat(bitmap).isNull();
+    }
+
+    @Test
+    public void calculateInSampleSize_withImageSmallerThanRequested_shouldBe1() {
+        int nativeWidth = 1024;
+        assertThat(ImageService.calculateInSampleSize(nativeWidth, 2046)).isEqualTo(1);
+    }
+
+    @Test
+    public void calculateInSampleSize_withImageSlightlyBiggerThanRequest_shouldBe1() {
+        int nativeWidth = 1024;
+        assertThat(ImageService.calculateInSampleSize(nativeWidth, 800)).isEqualTo(1);
+
+    }
+
+    @Test
+    public void calculateInSampleSize_withImageMuchBiggerThanRequest_shouldBe4() {
+        int nativeWidth = 2048;
+        int nativeHeight = 1024;
+        assertThat(ImageService.calculateInSampleSize(nativeWidth, 512)).isEqualTo(4);
+    }
+
     private static InputStream getInputStreamFromString(final String string) {
         return spy(new ByteArrayInputStream(string.getBytes()));
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageViewServiceTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageViewServiceTest.java
index 4aaef2fc..54ea511d 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/ImageViewServiceTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/ImageViewServiceTest.java
@@ -3,24 +3,29 @@
 import android.app.Activity;
 import android.content.Context;
 import android.graphics.Bitmap;
+import android.graphics.BitmapFactory;
 import android.graphics.drawable.BitmapDrawable;
 import android.widget.ImageView;
 
 import com.mopub.common.CacheService;
 import com.mopub.common.CacheServiceTest;
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.nativeads.test.support.MoPubShadowBitmap;
+import com.mopub.nativeads.test.support.MoPubShadowDisplay;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
 import org.robolectric.tester.org.apache.http.FakeHttpLayer;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
+@Config(shadows={MoPubShadowBitmap.class, MoPubShadowDisplay.class})
 public class ImageViewServiceTest {
 
     private ImageView imageView;
@@ -29,16 +34,19 @@
     private String imageData1;
     private String imageData2;
     private FakeHttpLayer fakeHttpLayer;
+    private Bitmap image1;
 
     @Before
     public void setUp() throws Exception {
         Context context = new Activity();
         imageView = new ImageView(context);
-        CacheService.initializeCaches(context);
+        CacheService.initialize(context);
+        ImageService.initialize(context);
         url1 = "http://www.mopub.com/";
         url2 = "http://www.twitter.com/";
         imageData1 = "image_data_1";
         imageData2 = "image_data_2";
+        image1 = BitmapFactory.decodeByteArray(imageData1.getBytes(), 0, imageData1.getBytes().length);
         fakeHttpLayer = Robolectric.getFakeHttpLayer();
     }
 
@@ -50,7 +58,7 @@ public void tearDown() throws Exception {
     @Test
     public void loadImageView_withImageInMemoryCache_shouldLoadImageData() throws Exception {
         CacheServiceTest.assertCachesAreEmpty();
-        CacheService.putToMemoryCache(url1, imageData1.getBytes());
+        CacheService.putToBitmapCache(url1, image1);
 
         assertThat(ImageViewService.getImageViewUniqueId(imageView)).isNull();
 
@@ -65,6 +73,7 @@ public void loadImageView_withImageInMemoryCache_shouldLoadImageData() throws Ex
     public void loadImageView_withImageInDiskCache_shouldLoadImageDataAsync() throws Exception {
         CacheServiceTest.assertCachesAreEmpty();
         CacheService.putToDiskCache(url1, imageData1.getBytes());
+        assertThat(CacheService.containsKeyDiskCache(url1)).isTrue();
 
         assertThat(ImageViewService.getImageViewUniqueId(imageView)).isNull();
 
@@ -72,8 +81,8 @@ public void loadImageView_withImageInDiskCache_shouldLoadImageDataAsync() throws
         Thread.sleep(500);
 
         assertThat(ImageViewService.getImageViewUniqueId(imageView)).isNotNull();
-        assertThat(shadowOf(getBitmapFromImageView(imageView)).getCreatedFromBytes())
-                .isEqualTo(imageData1.getBytes());
+        assertThat(shadowOf(getBitmapFromImageView(imageView)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
     }
 
     @Test
@@ -82,13 +91,14 @@ public void loadImageView_withImageInNetwork_shouldLoadImageDataAsync() throws E
         fakeHttpLayer.addPendingHttpResponse(200, imageData1);
 
         assertThat(ImageViewService.getImageViewUniqueId(imageView)).isNull();
+        assertThat(imageView.getDrawable()).isNull();
 
         ImageViewService.loadImageView(url1, imageView);
         Thread.sleep(500);
 
         assertThat(ImageViewService.getImageViewUniqueId(imageView)).isNotNull();
-        assertThat(shadowOf(getBitmapFromImageView(imageView)).getCreatedFromBytes())
-                .isEqualTo(imageData1.getBytes());
+        assertThat(shadowOf(getBitmapFromImageView(imageView)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
     }
 
     @Test
@@ -103,7 +113,7 @@ public void loadImageView_withImageInNetworkAndUniqueIdChanges_shouldNotLoadImag
         ImageViewService.loadImageView(url1, imageView);
 
         // Change unique id before running async task to simulate another image load
-        ImageViewService.setImageViewUniqueId(imageView);
+        ImageViewService.setImageViewUniqueId(imageView, -1);
 
         Robolectric.getBackgroundScheduler().runOneTask();
         Robolectric.getBackgroundScheduler().unPause();
@@ -124,7 +134,7 @@ public void loadImageView_withImageInNetworkAndUniqueIdIsNull_shouldNotLoadImage
         ImageViewService.loadImageView(url1, imageView);
 
         // Change unique id before running async task to simulate another image load
-        ImageViewService.setViewTag(imageView, null);
+        ImageViewService.setImageViewUniqueId(imageView, -1);
 
         Robolectric.getBackgroundScheduler().runOneTask();
         Robolectric.getBackgroundScheduler().unPause();
@@ -151,8 +161,8 @@ public void loadImageView_withTwoNetworkRequests_shouldLoadSecondImageData() thr
         Robolectric.getBackgroundScheduler().unPause();
         Thread.sleep(500);
 
-        assertThat(shadowOf(getBitmapFromImageView(imageView)).getCreatedFromBytes())
-                .isEqualTo(imageData2.getBytes());
+        assertThat(shadowOf(getBitmapFromImageView(imageView)).getDescription())
+                .isEqualTo("Bitmap for image_data_2");
     }
 
     @Test
@@ -166,8 +176,8 @@ public void loadImageView_shouldClearDrawable() throws Exception {
 
         ImageViewService.loadImageView(url1, imageView);
         Thread.sleep(500);
-        assertThat(shadowOf(getBitmapFromImageView(imageView)).getCreatedFromBytes())
-                .isEqualTo(imageData1.getBytes());
+        assertThat(shadowOf(getBitmapFromImageView(imageView)).getDescription())
+                .isEqualTo("Bitmap for image_data_1");
 
         Robolectric.getBackgroundScheduler().pause();
         ImageViewService.loadImageView(url2, imageView);
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ImpressionTrackerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ImpressionTrackerTest.java
new file mode 100644
index 00000000..0bba4e12
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/ImpressionTrackerTest.java
@@ -0,0 +1,305 @@
+package com.mopub.nativeads;
+
+import android.os.Handler;
+import android.view.View;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.fest.util.Lists;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.robolectric.Robolectric;
+import org.robolectric.shadows.ShadowSystemClock;
+
+import java.util.HashMap;
+
+import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
+import static com.mopub.nativeads.VisibilityTracker.VisibilityChecker;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.eq;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
+@RunWith(SdkTestRunner.class)
+public class ImpressionTrackerTest {
+    private ImpressionTracker subject;
+    private TimestampWrapper<NativeResponse> timeStampWrapper;
+    private HashMap<View, NativeResponse> trackedViews;
+    private HashMap<View, TimestampWrapper<NativeResponse>> pollingViews;
+
+    @Mock private NativeResponse nativeResponse;
+    @Mock private NativeResponse nativeResponse2;
+    @Mock private MoPubNativeListener moPubNativeListener;
+    @Mock private VisibilityTracker visibilityTracker;
+    @Mock private Handler handler;
+    @Mock private View view;
+    @Mock private View view2;
+
+    @Before
+    public void setUp() {
+        view = VisibilityTrackerTest.createViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
+        view2 = VisibilityTrackerTest.createViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
+
+        pollingViews = new HashMap<View, TimestampWrapper<NativeResponse>>(10);
+        trackedViews = new HashMap<View, NativeResponse>(10);
+        final VisibilityChecker visibilityChecker = new VisibilityChecker();
+        subject = new ImpressionTracker(trackedViews, pollingViews, visibilityChecker,
+                visibilityTracker, handler);
+
+        timeStampWrapper = new TimestampWrapper<NativeResponse>(nativeResponse);
+
+        when(nativeResponse.getImpressionMinPercentageViewed()).thenReturn(50);
+        when(nativeResponse.getImpressionMinTimeViewed()).thenReturn(1000);
+        when(nativeResponse2.getImpressionMinPercentageViewed()).thenReturn(50);
+        when(nativeResponse2.getImpressionMinTimeViewed()).thenReturn(1000);
+
+        // XXX We need this to ensure that our SystemClock starts
+        ShadowSystemClock.uptimeMillis();
+    }
+
+    @Test
+    public void addView_shouldAddViewToTrackedViews_shouldAddViewToVisibilityTracker() {
+        subject.addView(view, nativeResponse);
+
+        assertThat(trackedViews).hasSize(1);
+        assertThat(trackedViews.get(view)).isEqualTo(nativeResponse);
+        verify(visibilityTracker).addView(view, nativeResponse.getImpressionMinPercentageViewed());
+    }
+
+    @Test
+    public void addView_withRecordedImpression_shouldNotAddView() {
+        when(nativeResponse.getRecordedImpression()).thenReturn(true);
+
+        subject.addView(view, nativeResponse);
+
+        assertThat(trackedViews).hasSize(0);
+        verify(visibilityTracker, never())
+                .addView(view, nativeResponse.getImpressionMinPercentageViewed());
+    }
+
+    @Test
+    public void addView_withDestroyedNativeResponse_shouldNotAddView() {
+        when(nativeResponse.isDestroyed()).thenReturn(true);
+
+        subject.addView(view, nativeResponse);
+
+        assertThat(trackedViews).isEmpty();
+        verify(visibilityTracker, never())
+                .addView(view, nativeResponse.getImpressionMinPercentageViewed());
+    }
+
+    @Test
+    public void addView_withDifferentNativeResponse_shouldRemoveFromPollingViews() {
+        subject.addView(view, nativeResponse);
+
+        assertThat(trackedViews).hasSize(1);
+        assertThat(trackedViews.get(view)).isEqualTo(nativeResponse);
+        verify(visibilityTracker).addView(view, nativeResponse.getImpressionMinPercentageViewed());
+
+        pollingViews.put(view, timeStampWrapper);
+
+        subject.addView(view, nativeResponse2);
+
+        assertThat(trackedViews).hasSize(1);
+        assertThat(trackedViews.get(view)).isEqualTo(nativeResponse2);
+        assertThat(pollingViews).isEmpty();
+        verify(visibilityTracker, times(2))
+                .addView(view, nativeResponse.getImpressionMinPercentageViewed());
+    }
+
+    @Test
+    public void addView_withDifferentAlreadyImpressedNativeResponse_shouldRemoveFromPollingViews_shouldNotTrack() {
+        when(nativeResponse2.getRecordedImpression()).thenReturn(true);
+
+        subject.addView(view, nativeResponse);
+
+        assertThat(trackedViews).hasSize(1);
+        assertThat(trackedViews.get(view)).isEqualTo(nativeResponse);
+        verify(visibilityTracker).addView(view, nativeResponse.getImpressionMinPercentageViewed());
+
+        pollingViews.put(view, timeStampWrapper);
+
+        subject.addView(view, nativeResponse2);
+
+        assertThat(trackedViews).hasSize(0);
+        assertThat(trackedViews.get(view)).isNull();
+        assertThat(pollingViews).isEmpty();
+        verify(visibilityTracker).addView(view, nativeResponse.getImpressionMinPercentageViewed());
+    }
+
+    @Test
+    public void addView_withSameNativeResponse_shouldNotAddView() {
+        subject.addView(view, nativeResponse);
+
+        assertThat(trackedViews).hasSize(1);
+        assertThat(trackedViews.get(view)).isEqualTo(nativeResponse);
+        verify(visibilityTracker).addView(view, nativeResponse.getImpressionMinPercentageViewed());
+
+        pollingViews.put(view, timeStampWrapper);
+
+        subject.addView(view, nativeResponse);
+
+        assertThat(trackedViews).hasSize(1);
+        assertThat(trackedViews.get(view)).isEqualTo(nativeResponse);
+        assertThat(pollingViews.keySet()).containsOnly(view);
+
+        // Still only one call
+        verify(visibilityTracker).addView(view, nativeResponse.getImpressionMinPercentageViewed());
+    }
+
+    @Test
+    public void removeView_shouldRemoveViewFromViewTrackedViews_shouldRemoveViewFromPollingMap_shouldRemoveViewFromVisibilityTracker() {
+        trackedViews.put(view, nativeResponse);
+        pollingViews.put(view, new TimestampWrapper<NativeResponse>(nativeResponse));
+        visibilityTracker.addView(view, nativeResponse.getImpressionMinPercentageViewed());
+
+        subject.removeView(view);
+
+        assertThat(trackedViews).isEmpty();
+        assertThat(pollingViews).isEmpty();
+        verify(visibilityTracker).removeView(view);
+    }
+
+    @Test
+    public void clear_shouldClearViewTrackedViews_shouldClearPollingViews_shouldClearVisibilityTracker_shouldClearPollHandler() {
+        trackedViews.put(view, nativeResponse);
+        trackedViews.put(view2, nativeResponse);
+        pollingViews.put(view, timeStampWrapper);
+        pollingViews.put(view2, timeStampWrapper);
+        visibilityTracker.addView(view, nativeResponse.getImpressionMinPercentageViewed());
+        visibilityTracker.addView(view2, nativeResponse.getImpressionMinPercentageViewed());
+
+        subject.clear();
+
+        assertThat(trackedViews).isEmpty();
+        assertThat(pollingViews).isEmpty();
+        verify(visibilityTracker).clear();
+        verify(handler).removeMessages(0);
+    }
+    
+    @Test
+    public void destroy_shouldCallClear_shouldDestroyVisibilityTracker_shouldSetVisibilityTrackerListenerToNull() throws Exception {
+        trackedViews.put(view, nativeResponse);
+        trackedViews.put(view2, nativeResponse);
+        pollingViews.put(view, timeStampWrapper);
+        pollingViews.put(view2, timeStampWrapper);
+        visibilityTracker.addView(view, nativeResponse.getImpressionMinPercentageViewed());
+        visibilityTracker.addView(view2, nativeResponse.getImpressionMinPercentageViewed());
+        assertThat(subject.getVisibilityTrackerListener()).isNotNull();
+
+        subject.destroy();
+
+        assertThat(trackedViews).isEmpty();
+        assertThat(pollingViews).isEmpty();
+        verify(visibilityTracker).clear();
+        verify(handler).removeMessages(0);
+
+        verify(visibilityTracker).destroy();
+        assertThat(subject.getVisibilityTrackerListener()).isNull();
+    }
+
+    @Test
+    public void scheduleNextPoll_shouldPostDelayedThePollingRunnable() {
+        when(handler.hasMessages(0)).thenReturn(false);
+
+        subject.scheduleNextPoll();
+
+        verify(handler).postDelayed(any(ImpressionTracker.PollingRunnable.class), eq((long) 250));
+    }
+
+    @Test
+    public void scheduleNextPoll_withMessages_shouldNotPostDelayedThePollingRunnable() {
+        when(handler.hasMessages(0)).thenReturn(true);
+
+        subject.scheduleNextPoll();
+
+        verify(handler, never())
+                .postDelayed(any(ImpressionTracker.PollingRunnable.class), eq((long) 250));
+    }
+
+    @Test
+    public void visibilityTrackerListener_onVisibilityChanged_withVisibleViews_shouldAddViewToPollingViews_shouldScheduleNextPoll() {
+        subject.addView(view, nativeResponse);
+
+        assertThat(pollingViews).isEmpty();
+
+        subject.getVisibilityTrackerListener()
+                .onVisibilityChanged(Lists.newArrayList(view), Lists.<View>newArrayList());
+
+        assertThat(pollingViews.keySet()).containsOnly(view);
+        verify(handler).postDelayed(any(ImpressionTracker.PollingRunnable.class), eq((long) 250));
+    }
+
+    @Test
+    public void visibilityTrackerListener_onVisibilityChanged_withVisibleViews_shouldRemoveViewFromPollingViews() {
+        subject.addView(view, nativeResponse);
+        subject.getVisibilityTrackerListener()
+                .onVisibilityChanged(Lists.newArrayList(view), Lists.<View>newArrayList());
+
+
+        assertThat(trackedViews.keySet()).containsOnly(view);
+        assertThat(pollingViews.keySet()).containsOnly(view);
+
+        subject.getVisibilityTrackerListener()
+                .onVisibilityChanged(Lists.<View>newArrayList(), Lists.newArrayList(view));
+
+        assertThat(trackedViews.keySet()).containsOnly(view);
+        assertThat(pollingViews).isEmpty();
+    }
+
+    @Test
+    public void pollingRunnableRun_whenLessThanOneSecondHasElapsed_shouldNotTrackImpression_shouldScheduleNextPoll() {
+        // Force the last viewed timestamp to be a known value
+        timeStampWrapper.mCreatedTimestamp = 5555;
+        pollingViews.put(view, timeStampWrapper);
+
+        // We progress 999 milliseconds
+        Robolectric.getUiThreadScheduler().advanceBy(5555 + 999);
+        subject.new PollingRunnable().run();
+
+        verify(nativeResponse, never()).recordImpression(view);
+
+        assertThat(pollingViews.keySet()).containsOnly(view);
+        verify(handler).postDelayed(any(ImpressionTracker.PollingRunnable.class), eq((long) 250));
+    }
+
+    @Test
+    public void pollingRunnableRun_whenMoreThanOneSecondHasElapsed_shouldTrackImpression_shouldNotScheduleNextPoll() {
+        // Force the last viewed timestamp to be a known value
+        timeStampWrapper.mCreatedTimestamp = 5555;
+        pollingViews.put(view, timeStampWrapper);
+
+        // We progress 1000 milliseconds
+        Robolectric.getUiThreadScheduler().advanceBy(5555 + 1000);
+        subject.new PollingRunnable().run();
+
+        verify(nativeResponse).recordImpression(view);
+
+        assertThat(pollingViews).isEmpty();
+        verify(handler, never())
+                .postDelayed(any(ImpressionTracker.PollingRunnable.class), eq((long) 250));
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void pollingRunnableRun_whenWrapperIsNull_shouldThrowNPE() {
+        pollingViews.put(view, null);
+        subject.new PollingRunnable().run();
+
+        verify(nativeResponse, never()).recordImpression(view);
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void pollingRunnableRun_whenNativeResponseIsNull_shouldThrowNPE() {
+        // This doesn't normally happen; perhaps we're being overly defensive
+        pollingViews.put(view, new TimestampWrapper<NativeResponse>(null));
+
+        subject.new PollingRunnable().run();
+
+        verify(nativeResponse, never()).recordImpression(view);
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ImpressionTrackingManagerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ImpressionTrackingManagerTest.java
deleted file mode 100644
index e91cdcd7..00000000
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/ImpressionTrackingManagerTest.java
+++ /dev/null
@@ -1,493 +0,0 @@
-package com.mopub.nativeads;
-
-import android.app.Activity;
-import android.content.Context;
-import android.graphics.Rect;
-import android.view.View;
-import android.view.ViewParent;
-import android.view.ViewTreeObserver;
-
-import com.mopub.common.DownloadResponse;
-import com.mopub.common.util.ResponseHeader;
-import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
-import com.mopub.nativeads.test.support.SdkTestRunner;
-
-import org.junit.After;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.invocation.InvocationOnMock;
-import org.mockito.stubbing.Answer;
-import org.robolectric.Robolectric;
-import org.robolectric.shadows.ShadowSystemClock;
-import org.robolectric.tester.org.apache.http.TestHttpResponse;
-
-import static android.view.ViewTreeObserver.OnPreDrawListener;
-import static com.mopub.nativeads.ImpressionTrackingManager.NativeResponseWrapper;
-import static com.mopub.nativeads.ImpressionTrackingManager.PollingRunnable;
-import static com.mopub.nativeads.ImpressionTrackingManager.VisibilityChecker.isMostlyVisible;
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Matchers.any;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.never;
-import static org.mockito.Mockito.reset;
-import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-public class ImpressionTrackingManagerTest {
-    private static final String IMPRESSION_TRACKER = "url1";
-    private static final int IMPRESSION_MIN_PERCENTAGE_VIEWED = 50;
-
-    private View view;
-    private NativeResponse nativeResponse;
-    private NativeResponseWrapper nativeResponseWrapper;
-    private Context context;
-    private MoPubNativeListener mopubNativeListener;
-
-    @Before
-    public void setUp() throws Exception {
-        ImpressionTrackingManager.clearTracking();
-
-        context = new Activity();
-        mopubNativeListener = mock(MoPubNativeListener.class);
-        view = getViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
-
-        final BaseForwardingNativeAd nativeAd = new BaseForwardingNativeAd() {};
-        final TestHttpResponseWithHeaders testHttpResponseWithHeaders = new TestHttpResponseWithHeaders(200, "");
-        testHttpResponseWithHeaders.addHeader(ResponseHeader.IMPRESSION_URL.getKey(), "url1");
-        final DownloadResponse downloadResponse = new DownloadResponse(testHttpResponseWithHeaders);
-
-        nativeResponse = new NativeResponse(context, downloadResponse, nativeAd, mopubNativeListener);
-        nativeResponseWrapper = new NativeResponseWrapper(nativeResponse);
-
-        Robolectric.addPendingHttpResponse(new TestHttpResponse(200, ""));
-
-        // We need this to ensure that our SystemClock starts
-        ShadowSystemClock.uptimeMillis();
-    }
-
-    @After
-    public void tearDown() throws Exception {
-        ImpressionTrackingManager.clearTracking();
-    }
-
-    @Test
-    public void addView_withVisibleView_shouldAddViewToPollingHashMap() throws Exception {
-        ImpressionTrackingManager.addView(view, nativeResponse);
-
-        assertThat(ImpressionTrackingManager.getPollingViews().keySet()).containsOnly(view);
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-    }
-
-    @Test
-    public void addView_withNonVisibleView_shouldAddViewToWaitingHashMap() throws Exception {
-        view = getViewMock(View.GONE, 0, 0, 0, 0, true, false);
-
-        ImpressionTrackingManager.addView(view, nativeResponse);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getWaitingViews().keySet()).containsOnly(view);
-    }
-
-    @Test
-    public void addView_whenViewIsNull_shouldNotAddView() throws Exception {
-        ImpressionTrackingManager.addView(null, nativeResponse);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-    }
-
-    @Test
-    public void addView_whenNativeResponseIsNull_shouldNotAddView() throws Exception {
-        ImpressionTrackingManager.addView(view, null);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-    }
-
-    @Test
-    public void isViewTracked_whenPollingViewsOrWaitingViewsContainsView_shouldReturnTrue() throws Exception {
-        assertThat(ImpressionTrackingManager.isViewTracked(view)).isEqualTo(false);
-
-        ImpressionTrackingManager.getPollingViews().put(view, new NativeResponseWrapper(nativeResponse));
-        assertThat(ImpressionTrackingManager.isViewTracked(view)).isTrue();
-        ImpressionTrackingManager.getPollingViews().clear();
-
-        ImpressionTrackingManager.getWaitingViews().put(view, mock(OnPreDrawListener.class));
-        assertThat(ImpressionTrackingManager.isViewTracked(view)).isTrue();
-        ImpressionTrackingManager.getWaitingViews().clear();
-
-        ImpressionTrackingManager.getPollingViews().put(view, new NativeResponseWrapper(nativeResponse));
-        ImpressionTrackingManager.getWaitingViews().put(view, mock(OnPreDrawListener.class));
-        assertThat(ImpressionTrackingManager.isViewTracked(view)).isTrue();
-    }
-    
-    @Test
-    public void waitForVisibility_shouldRemoveViewFromPollingHashMap() throws Exception {
-        ImpressionTrackingManager.getPollingViews().put(view, new NativeResponseWrapper(nativeResponse));
-        ImpressionTrackingManager.waitForVisibility(view, nativeResponse);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-    }
-
-    @Test
-    public void waitForVisibility_whenViewTreeObserverIsAliveIsTrue_shouldAddOnPreDrawListenerToViewTreeObserverAndPopulateWaitingViewsHashMap() throws Exception {
-        ViewTreeObserver mockViewTreeObserver = mock(ViewTreeObserver.class);
-        when(mockViewTreeObserver.isAlive()).thenReturn(true);
-        when(view.getViewTreeObserver()).thenReturn(mockViewTreeObserver);
-
-        ImpressionTrackingManager.waitForVisibility(view, nativeResponse);
-
-        verify(mockViewTreeObserver).addOnPreDrawListener(any(OnPreDrawListener.class));
-        assertThat(ImpressionTrackingManager.getWaitingViews().keySet()).containsOnly(view);
-    }
-
-    @Test
-    public void waitForVisibility_whenViewTreeObserverIsAliveIsFalse_shouldNotAddOnPreDrawListenerToViewTreeObserverAndNotPopulateWaitingViewsHashMap() throws Exception {
-        ViewTreeObserver mockViewTreeObserver = mock(ViewTreeObserver.class);
-        when(mockViewTreeObserver.isAlive()).thenReturn(false);
-        when(view.getViewTreeObserver()).thenReturn(mockViewTreeObserver);
-
-        ImpressionTrackingManager.waitForVisibility(view, nativeResponse);
-
-        verify(mockViewTreeObserver, never()).addOnPreDrawListener(any(OnPreDrawListener.class));
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-    }
-
-    @Test
-    public void waitForVisibility_onPreDrawListener_onPreDraw_withVisibleView_shouldAddViewToPollingHashMap() throws Exception {
-        ImpressionTrackingManager.waitForVisibility(view, nativeResponse);
-        view.getViewTreeObserver().dispatchOnPreDraw();
-
-        assertThat(ImpressionTrackingManager.getPollingViews().keySet()).containsOnly(view);
-    }
-
-    @Test
-    public void waitForVisibility_onPreDrawListener_onPreDraw_withNonVisibleView_shouldNotAddViewToPollingHashMap() throws Exception {
-        View view = getViewMock(View.INVISIBLE, 100, 100, 100, 100, true, true);
-        ImpressionTrackingManager.waitForVisibility(view, nativeResponse);
-        view.getViewTreeObserver().dispatchOnPreDraw();
-
-        assertThat(ImpressionTrackingManager.getPollingViews().keySet()).isEmpty();
-    }
-    
-    @Test
-    public void pollVisibleView_shouldRemoveViewFromWaitingHashMap_shouldAddViewToPollingHashMap_shouldScheduleNextPoll() throws Exception {
-        Robolectric.getUiThreadScheduler().pause();
-        assertThat(Robolectric.getUiThreadScheduler().enqueuedTaskCount()).isEqualTo(0);
-
-        ImpressionTrackingManager.getWaitingViews().put(view, mock(OnPreDrawListener.class));
-
-        ImpressionTrackingManager.pollVisibleView(view, nativeResponse);
-
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getPollingViews()).hasSize(1);
-        assertThat(ImpressionTrackingManager.getPollingViews().get(view)).isNotNull();
-        assertThat(Robolectric.getUiThreadScheduler().enqueuedTaskCount()).isEqualTo(1);
-    }
-
-    @Test
-    public void scheduleNextPoll_withNoMessages_shouldSchedulePoll() throws Exception {
-        Robolectric.getUiThreadScheduler().pause();
-        assertThat(Robolectric.getUiThreadScheduler().enqueuedTaskCount()).isEqualTo(0);
-
-        ImpressionTrackingManager.scheduleNextPoll();
-
-        assertThat(Robolectric.getUiThreadScheduler().enqueuedTaskCount()).isEqualTo(1);
-    }
-
-    @Test
-    public void removeWaiting_shouldRemoveViewFromWaitingHashMapAndRemoveOnPreDrawListener() throws Exception {
-        ViewTreeObserver mockViewTreeObserver = mock(ViewTreeObserver.class);
-        when(mockViewTreeObserver.isAlive()).thenReturn(true);
-        when(view.getViewTreeObserver()).thenReturn(mockViewTreeObserver);
-
-        OnPreDrawListener onPreDrawListener = mock(OnPreDrawListener.class);
-        ImpressionTrackingManager.getWaitingViews().put(view, onPreDrawListener);
-
-        ImpressionTrackingManager.removeWaitingView(view);
-
-        assertThat(ImpressionTrackingManager.getWaitingViews().keySet()).isEmpty();
-        verify(mockViewTreeObserver).removeOnPreDrawListener(onPreDrawListener);
-    }
-
-    @Test
-    public void removeWaiting_withNullView_shouldDoNothing() throws Exception {
-        assertThat(ImpressionTrackingManager.getWaitingViews().keySet()).isEmpty();
-
-        ImpressionTrackingManager.removeWaitingView(null);
-
-        assertThat(ImpressionTrackingManager.getWaitingViews().keySet()).isEmpty();
-    }
-
-    @Test
-    public void removePolling_shouldRemoveViewFromPollingHashMap() throws Exception {
-        ImpressionTrackingManager.getPollingViews().put(view, nativeResponseWrapper);
-
-        ImpressionTrackingManager.removePollingView(view);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-    }
-
-    @Test
-    public void removePolling_withNullView_shouldDoNothing() throws Exception {
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-
-        ImpressionTrackingManager.removePollingView(null);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-    }
-
-    @Test
-    public void removeView_shouldRemoveViewFromWaitingAndPollingViews() throws Exception {
-        ImpressionTrackingManager.addView(view, nativeResponse);
-        View view1 = getViewMock(View.GONE, 0, 0, 0, 0, true, false);
-        ImpressionTrackingManager.addView(view1, nativeResponse);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).hasSize(1);
-        assertThat(ImpressionTrackingManager.getWaitingViews()).hasSize(1);
-
-        ImpressionTrackingManager.removeView(view1);
-        assertThat(ImpressionTrackingManager.getPollingViews()).hasSize(1);
-       assertThat(ImpressionTrackingManager.getPollingViews().keySet()).containsOnly(view);
-        assertThat(ImpressionTrackingManager.getWaitingViews()).hasSize(0);
-
-        ImpressionTrackingManager.removeView(view);
-        assertThat(ImpressionTrackingManager.getPollingViews()).hasSize(0);
-        assertThat(ImpressionTrackingManager.getWaitingViews()).hasSize(0);
-    }
-
-    @Test
-    public void removeView_withEmptyPollingAndWaitingHashMaps_shouldDoNothing() throws Exception {
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-
-        ImpressionTrackingManager.removeView(view);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-    }
-
-    @Test
-    public void removeView_whenViewIsNull_shouldDoNothing() throws Exception {
-        ImpressionTrackingManager.addView(view, nativeResponse);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).hasSize(1);
-        ImpressionTrackingManager.removeView(null);
-        assertThat(ImpressionTrackingManager.getPollingViews()).hasSize(1);
-    }
-
-    @Test
-    public void clearTracking_shouldClearWaitingAndPollingHashMaps_shouldClearHandlers() throws Exception {
-        ImpressionTrackingManager.getWaitingViews().put(view, mock(OnPreDrawListener.class));
-        ImpressionTrackingManager.getPollingViews().put(view, nativeResponseWrapper);
-
-        ImpressionTrackingManager.clearTracking();
-
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-
-    }
-
-    @Test
-    public void pollingRunnableRun_whenWrapperIsNull_shouldNotTrackImpression() throws Exception {
-        // This doesn't normally happen; perhaps we're being overly defensive
-        ImpressionTrackingManager.getPollingViews().put(view, null);
-
-        new PollingRunnable().run();
-        assertThat(nativeResponse.getRecordedImpression()).isFalse();
-        assertImpressionTracked(false);
-    }
-
-    @Test
-    public void pollingRunnableRun_whenNativeResponseIsNull_shouldNotTrackImpression() throws Exception {
-        // This doesn't normally happen; perhaps we're being overly defensive
-        ImpressionTrackingManager.getPollingViews().put(view, new NativeResponseWrapper(null));
-
-        new PollingRunnable().run();
-        assertThat(nativeResponse.getRecordedImpression()).isFalse();
-        assertImpressionTracked(false);
-    }
-
-    @Test
-    public void pollingRunnableRun_whenNativeResponseHasRecordedImpression_shouldNotTrackImpression() throws Exception {
-        nativeResponse.recordImpression(view);
-        assertImpressionTracked(true);
-
-        Robolectric.getFakeHttpLayer().clearRequestInfos();
-        reset(mopubNativeListener);
-
-        new PollingRunnable().run();
-        assertImpressionTracked(false);
-    }
-
-    @Test
-    public void pollingRunnableRun_whenNativeResponseHasBeenDestroyed_shouldNotTrackImpression() throws Exception {
-        nativeResponse.destroy();
-
-        Robolectric.getFakeHttpLayer().clearRequestInfos();
-        reset(mopubNativeListener);
-
-        new PollingRunnable().run();
-        assertImpressionTracked(false);
-    }
-
-    @Test
-    public void pollingRunnableRun_withNonVisibleView_shouldWaitForVisibility_shouldNotScheduleNextPoll() throws Exception {
-        View view = getViewMock(View.INVISIBLE, 100, 100, 100, 100, true, true);
-        ImpressionTrackingManager.getPollingViews().put(view, nativeResponseWrapper);
-
-        new PollingRunnable().run();
-
-        assertThat(nativeResponse.getRecordedImpression()).isFalse();
-        assertImpressionTracked(false);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getWaitingViews().keySet()).containsOnly(view);
-        assertThat(Robolectric.getUiThreadScheduler().enqueuedTaskCount()).isEqualTo(0);
-    }
-
-    @Test
-    public void pollingRunnableRun_whenLessThanOneSecondHasElapsed_shouldNotTrackImpression_shouldScheduleNextPoll() throws Exception {
-        // Force the last viewed timestamp to be a known value
-        nativeResponseWrapper.mFirstVisibleTimestamp = 5555;
-        ImpressionTrackingManager.getPollingViews().put(view, nativeResponseWrapper);
-
-        // We progress 999 milliseconds
-        Robolectric.getUiThreadScheduler().advanceBy(5555 + 999);
-        new PollingRunnable().run();
-
-        assertThat(nativeResponse.getRecordedImpression()).isFalse();
-        assertImpressionTracked(false);
-
-        assertThat(ImpressionTrackingManager.getPollingViews().keySet()).containsOnly(view);
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-        assertThat(Robolectric.getUiThreadScheduler().enqueuedTaskCount()).isEqualTo(1);
-    }
-
-    @Test
-    public void pollingRunnableRun_whenMoreThanOneSecondHasElapsed_shouldTrackImpression_shouldNotScheduleNextPoll() throws Exception {
-        // Force the last viewed timestamp to be a known value
-        nativeResponseWrapper.mFirstVisibleTimestamp = 5555;
-        ImpressionTrackingManager.getPollingViews().put(view, nativeResponseWrapper);
-
-        // We progress 1000 milliseconds
-        Robolectric.getUiThreadScheduler().advanceBy(5555 + 1000);
-        new PollingRunnable().run();
-
-        assertThat(nativeResponse.getRecordedImpression()).isTrue();
-        assertImpressionTracked(true);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        assertThat(ImpressionTrackingManager.getWaitingViews()).isEmpty();
-        assertThat(Robolectric.getUiThreadScheduler().enqueuedTaskCount()).isEqualTo(0);
-    }
-
-    @Test
-    public void isMostlyVisible_whenParentIsNull_shouldReturnFalse() throws Exception {
-        view = getViewMock(View.VISIBLE, 100, 100, 100, 100, false, true);
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-    }
-
-    @Test
-    public void isMostlyVisible_whenViewIsOffScreen_shouldReturnFalse() throws Exception {
-        view = getViewMock(View.VISIBLE, 100, 100, 100, 100, true, false);
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-    }
-
-
-    @Test
-    public void isMostlyVisible_whenViewIsEntirelyOnScreen_shouldReturnTrue() throws Exception {
-        view = getViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
-
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isTrue();
-    }
-
-    @Test
-    public void isMostlyVisible_whenViewIs50PercentVisible_shouldReturnTrue() throws Exception {
-        view = getViewMock(View.VISIBLE, 50, 100, 100, 100, true, true);
-
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isTrue();
-    }
-
-    @Test
-    public void isMostlyVisible_whenViewIs49PercentVisible_shouldReturnFalse() throws Exception {
-        view = getViewMock(View.VISIBLE, 49, 100, 100, 100, true, true);
-
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-    }
-
-    @Test
-    public void isMostlyVisible_whenVisibleAreaIsZero_shouldReturnFalse() throws Exception {
-        view = getViewMock(View.VISIBLE, 0, 0, 100, 100, true, true);
-
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-    }
-
-    @Test
-    public void isMostlyVisible_whenViewIsInvisibleOrGone_shouldReturnFalse() throws Exception {
-        View view = getViewMock(View.INVISIBLE, 100, 100, 100, 100, true, true);
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-
-        reset(view);
-        view = getViewMock(View.GONE, 100, 100, 100, 100, true, true);
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-    }
-
-    @Test
-    public void isMostlyVisible_whenViewHasZeroWidthAndHeight_shouldReturnFalse() throws Exception {
-        view = getViewMock(View.VISIBLE, 100, 100, 0, 0, true, true);
-
-        assertThat(isMostlyVisible(view, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-    }
-
-    @Test
-    public void isMostlyVisible_whenViewIsNull_shouldReturnFalse() throws Exception {
-        assertThat(isMostlyVisible(null, IMPRESSION_MIN_PERCENTAGE_VIEWED)).isFalse();
-    }
-
-    static View getViewMock(final int visibility,
-            final int visibleWidth, final int visibleHeight,
-            final int viewWidth, final int viewHeight,
-            final boolean isParentSet, final boolean isOnScreen) {
-        View view = mock(View.class);
-        when(view.getContext()).thenReturn(new Activity());
-        when(view.getVisibility()).thenReturn(visibility);
-
-        when(view.getGlobalVisibleRect(any(Rect.class)))
-                .thenAnswer(new Answer<Boolean>() {
-                    @Override
-                    public Boolean answer(InvocationOnMock invocationOnMock) throws Throwable {
-                        Object[] args = invocationOnMock.getArguments();
-                        Rect rect = (Rect) args[0];
-                        rect.set(0, 0, visibleWidth, visibleHeight);
-                        return isOnScreen;
-                    }
-                });
-
-        when(view.getWidth()).thenReturn(viewWidth);
-        when(view.getHeight()).thenReturn(viewHeight);
-        if (isParentSet) {
-            when(view.getParent()).thenReturn(mock(ViewParent.class));
-        }
-
-        when(view.getViewTreeObserver()).thenCallRealMethod();
-
-        return view;
-    }
-
-    private void assertImpressionTracked(final boolean wasTracked) {
-        // Ensure that we fired off the HttpGets for each of the impression trackers
-        if (wasTracked) {
-            assertThat(Robolectric.getFakeHttpLayer().getSentHttpRequestInfos().size()).isEqualTo(1);
-            final String actualUri = Robolectric.getFakeHttpLayer().getLastSentHttpRequestInfo().getHttpRequest().getRequestLine().getUri();
-            assertThat(actualUri).isEqualTo(IMPRESSION_TRACKER);
-            verify(mopubNativeListener).onNativeImpression(view);
-        } else {
-            assertThat(Robolectric.getFakeHttpLayer().getLastSentHttpRequestInfo()).isNull();
-            verify(mopubNativeListener, never()).onNativeImpression(view);
-        }
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubAdAdapterTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubAdAdapterTest.java
new file mode 100644
index 00000000..880c3ba1
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubAdAdapterTest.java
@@ -0,0 +1,145 @@
+package com.mopub.nativeads;
+
+import android.database.DataSetObserver;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.BaseAdapter;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.robolectric.annotation.Config;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.AdditionalMatchers.leq;
+import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.anyInt;
+import static org.mockito.Matchers.eq;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
+@Config(manifest=Config.NONE)
+@RunWith(SdkTestRunner.class)
+public class MoPubAdAdapterTest {
+
+    @Mock
+    public BaseAdapter mockOriginalAdapter;
+    @Mock
+    public MoPubStreamAdPlacer mockStreamAdPlacer;
+    @Mock
+    public Object mockItem;
+    @Mock
+    public NativeAdData mockAd;
+    @Mock
+    public View mockAdView;
+    @Mock
+    public View mockItemView;
+    @Mock
+    public VisibilityTracker mockVisibilityTracker;
+    @Mock
+    public MoPubNativeAdLoadedListener mockAdLoadedListener;
+    @Mock
+    public DataSetObserver mockDataSetObserver;
+
+    public MoPubAdAdapter subject;
+
+    private static final int AD_POSITION = 4;
+
+    @Before
+    public void setup() {
+
+        // Mock setup code.
+        when(mockOriginalAdapter.getViewTypeCount()).thenReturn(1);
+        when(mockOriginalAdapter.getCount()).thenReturn(30);
+        when(mockOriginalAdapter.getItem(leq(29))).thenReturn(mockItem);
+        when(mockOriginalAdapter.getView(anyInt(), any(View.class), any(ViewGroup.class))).thenReturn(mockItemView);
+
+        when(mockStreamAdPlacer.getAdData(AD_POSITION)).thenReturn(mockAd);
+        when(mockStreamAdPlacer.getAdView(eq(AD_POSITION), any(View.class), any(ViewGroup.class))).thenReturn(mockAdView);
+
+        // Mock some adjustment behavior for tests.
+        when(mockStreamAdPlacer.getOriginalPosition(eq(1))).thenReturn(1);
+        when(mockStreamAdPlacer.getOriginalPosition(eq(8))).thenReturn(7);
+        when(mockStreamAdPlacer.getAdjustedCount(eq(30))).thenReturn(31);
+
+        subject = new MoPubAdAdapter(mockStreamAdPlacer, mockOriginalAdapter, mockVisibilityTracker);
+    }
+
+    @Test
+    public void getItem_shouldCallAdPlacer() throws Exception {
+        assertThat(subject.getItem(AD_POSITION)).isEqualTo(mockAd);
+        verify(mockStreamAdPlacer, never()).getOriginalPosition(AD_POSITION);
+        verify(mockStreamAdPlacer).getAdData(AD_POSITION);
+    }
+
+    @Test
+    public void getItem_shouldCallOriginalAdapter() throws Exception {
+        assertThat(subject.getItem(1)).isEqualTo(mockItem);
+        verify(mockStreamAdPlacer).getOriginalPosition(1);
+        verify(mockOriginalAdapter).getItem(1);
+
+        assertThat(subject.getItem(8)).isEqualTo(mockItem);
+        verify(mockStreamAdPlacer).getOriginalPosition(8);
+        verify(mockOriginalAdapter).getItem(7);
+    }
+
+    @Test
+    public void getCount_shouldCallAdPlacer() throws Exception {
+        assertThat(subject.getCount()).isEqualTo(31);
+        verify(mockStreamAdPlacer).getAdjustedCount(30);
+    }
+
+    @Test
+    public void getItemIdForAd_shouldBeNegative() throws Exception {
+        assertThat(subject.getItemId(AD_POSITION)).isLessThan(0);
+    }
+    
+    @Test
+    public void destroy_shouldDestroyStreamAdPlacer_shouldDestroyVisibilityTracker() {
+        subject.destroy();
+        verify(mockStreamAdPlacer).destroy();
+        verify(mockVisibilityTracker).destroy();
+    }
+
+    @Test
+    public void setAdLoadedListener_handleAdLoaded_shouldCallCallback_shouldCallObserver() {
+        subject.setAdLoadedListener(mockAdLoadedListener);
+        subject.registerDataSetObserver(mockDataSetObserver);
+
+        subject.handleAdLoaded(8);
+        verify(mockAdLoadedListener).onAdLoaded(8);
+        verify(mockDataSetObserver).onChanged();
+    }
+
+    @Test
+    public void setAdLoadedListener_handleAdRemoved_shouldCallCallback_shouldCallObserver() {
+        subject.setAdLoadedListener(mockAdLoadedListener);
+        subject.registerDataSetObserver(mockDataSetObserver);
+
+        subject.handleAdRemoved(10);
+        verify(mockAdLoadedListener).onAdRemoved(10);
+        verify(mockDataSetObserver).onChanged();
+    }
+
+    @Test
+    public void insertItem_shouldCallInsertItemOnStreamAdPlacer() throws Exception {
+        subject.insertItem(5);
+        verify(mockStreamAdPlacer).insertItem(5);
+    }
+
+    @Test
+    public void removeItem_shouldCallRemoveItemOnStreamAdPlacer() throws Exception {
+        subject.removeItem(5);
+        verify(mockStreamAdPlacer).removeItem(5);
+    }
+
+    @Test
+    public void getOriginalPosition_shouldCallGetOriginalPositionOnStreamAdPlacer() throws Exception {
+        subject.getOriginalPosition(5);
+        verify(mockStreamAdPlacer).getOriginalPosition(5);
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubClientPositioningTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubClientPositioningTest.java
new file mode 100644
index 00000000..cce90d4e
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubClientPositioningTest.java
@@ -0,0 +1,91 @@
+package com.mopub.nativeads;
+
+import com.mopub.common.Preconditions.NoThrow;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.fest.util.Lists;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.annotation.Config;
+
+import static com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning.NO_REPEAT;
+import static org.fest.assertions.api.Assertions.assertThat;
+
+@Config(manifest=Config.NONE)
+@RunWith(SdkTestRunner.class)
+public class MoPubClientPositioningTest {
+
+    private MoPubClientPositioning subject;
+
+    @Before
+    public void setup() {
+        subject = MoPubNativeAdPositioning.clientPositioning();
+    }
+
+    @Test
+    public void addFixedPositionsOutOfOrder_shouldBeSorted() {
+        subject.addFixedPosition(27);
+        subject.addFixedPosition(31);
+        subject.addFixedPosition(17);
+        subject.addFixedPosition(7);
+        subject.addFixedPosition(56);
+
+        assertThat(subject.getFixedPositions())
+                .isEqualTo(Lists.newArrayList(7, 17, 27, 31, 56));
+    }
+
+    @Test
+    public void setRepeatingEnabled_shouldHaveRightInterval() {
+        subject.addFixedPosition(10);
+        subject.enableRepeatingPositions(5);
+
+        assertThat(subject.getRepeatingInterval()).isEqualTo(5);
+        assertThat(subject.getFixedPositions()).isEqualTo(Lists.newArrayList(10));
+    }
+
+    @Test
+    public void setNoRepeat_shouldReturnNoRepeat() {
+        subject.enableRepeatingPositions(5);
+        subject.enableRepeatingPositions(NO_REPEAT);
+
+        assertThat(subject.getRepeatingInterval()).isEqualTo(NO_REPEAT);
+    }
+
+    @Test
+    public void setFixedPositionTwice_shouldReturnOnlyOne() {
+        subject.addFixedPosition(7);
+        subject.addFixedPosition(7);
+
+        assertThat(subject.getFixedPositions().size()).isEqualTo(1);
+    }
+
+    @Test(expected = IllegalArgumentException.class)
+    public void setInvalidFixedPosition_strictMode_shouldThrow() {
+        NoThrow.setStrictMode(true);
+        subject.addFixedPosition(-3);
+    }
+
+    @Test
+    public void setInvalidFixedPosition_releaseMode_shouldNotAddPosition() {
+        NoThrow.setStrictMode(false);
+        subject.addFixedPosition(-3);
+
+        assertThat(subject.getFixedPositions().size()).isEqualTo(0);
+    }
+
+    @Test(expected = IllegalArgumentException.class)
+    public void setInvalidRepeatingInterval_strictMode_shouldThrow() {
+        NoThrow.setStrictMode(true);
+        subject.enableRepeatingPositions(1);
+    }
+
+    @Test
+    public void setInvalidRepeatingInterval_releaseMode_shouldClearRepeatingInterval() {
+        NoThrow.setStrictMode(false);
+        subject.enableRepeatingPositions(0);
+
+        assertThat(subject.getRepeatingInterval()).isEqualTo(NO_REPEAT);
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java
index 1dd83d8b..9f67e204 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java
@@ -2,24 +2,17 @@
 
 import android.app.Activity;
 
-import com.mopub.common.CacheService;
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
 
-import org.apache.http.HttpRequest;
 import org.json.JSONArray;
 import org.json.JSONObject;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.robolectric.Robolectric;
-import org.robolectric.tester.org.apache.http.FakeHttpLayer;
-import org.robolectric.tester.org.apache.http.RequestMatcher;
-import org.robolectric.tester.org.apache.http.TestHttpResponse;
 
 import java.util.HashMap;
 
-import static com.mopub.common.util.test.support.CommonUtils.assertHttpRequestsMade;
 import static com.mopub.nativeads.CustomEventNative.CustomEventNativeListener;
 import static org.mockito.Matchers.any;
 import static org.mockito.Mockito.mock;
@@ -36,7 +29,6 @@
     private CustomEventNativeListener mCustomEventNativeListener;
     private HashMap<String, String> serverExtras;
     private JSONObject fakeJsonObject;
-    private FakeHttpLayer fakeHttpLayer;
 
     @Before
     public void setUp() throws Exception {
@@ -56,50 +48,15 @@ public void setUp() throws Exception {
         serverExtras.put(CustomEventNativeAdapter.RESPONSE_BODY_KEY, fakeJsonObject.toString());
 
         mCustomEventNativeListener = mock(CustomEventNativeListener.class);
-
-        fakeHttpLayer = Robolectric.getFakeHttpLayer();
-        fakeHttpLayer.addHttpResponseRule(
-                new RequestMatcher() {
-                    @Override
-                    public boolean matches(HttpRequest request) {
-                        return true;
-                    }
-                },
-                new TestHttpResponse(200, "body")
-        );
     }
 
     @After
     public void tearDown() throws Exception {
-        CacheService.clearAndNullCaches();
         reset(mCustomEventNativeListener);
     }
 
     @Test
-    public void loadNativeAd_withValidInput_shouldDownloadImagesAndNotifyListenerOfOnNativeAdLoaded() throws Exception {
-        subject.loadNativeAd(context, mCustomEventNativeListener, localExtras, serverExtras);
-
-        assertHttpRequestsMade(null, "mainimageurl", "iconimageurl", "extraimageurl");
-
-        verify(mCustomEventNativeListener).onNativeAdLoaded(any(MoPubCustomEventNative.MoPubForwardingNativeAd.class));
-        verify(mCustomEventNativeListener, never()).onNativeAdFailed(any(NativeErrorCode.class));
-    }
-
-    @Test
-    public void loadNativeAd_withValidInput_withFailedImageDownload_shouldNotDownloadImagesAndNotifyListenerOfOnNativeAdFailed() throws Exception {
-        fakeHttpLayer.clearHttpResponseRules();
-        fakeHttpLayer.addPendingHttpResponse(500, "body");
-
-        serverExtras.put(CustomEventNativeAdapter.RESPONSE_BODY_KEY, fakeJsonObject.toString());
-
-        subject.loadNativeAd(context, mCustomEventNativeListener, localExtras, serverExtras);
-
-        verify(mCustomEventNativeListener, never()).onNativeAdLoaded(any(MoPubCustomEventNative.MoPubForwardingNativeAd.class));
-        verify(mCustomEventNativeListener).onNativeAdFailed(NativeErrorCode.IMAGE_DOWNLOAD_FAILURE);
-    }
-
-    @Test
-    public void loadNativeAd_withInvalidResponseBody_shouldNotifyListenerOfOnNativeAdFailedAndReturn() throws Exception {
+    public void loadNativeAd_withInvalidResponseBody_shouldNotifyListenerOfOnNativeAdFailed() throws Exception {
         serverExtras.put(CustomEventNativeAdapter.RESPONSE_BODY_KEY, "{ \"bad json");
 
         subject.loadNativeAd(context, mCustomEventNativeListener, localExtras, serverExtras);
@@ -108,7 +65,7 @@ public void loadNativeAd_withInvalidResponseBody_shouldNotifyListenerOfOnNativeA
     }
 
     @Test
-    public void loadNativeAd_withNullResponseBody_shouldNotifyListenerOfOnNativeAdFailedAndReturn() throws Exception {
+    public void loadNativeAd_withNullResponseBody_shouldNotifyListenerOfOnNativeAdFailed() throws Exception {
         serverExtras.put(CustomEventNativeAdapter.RESPONSE_BODY_KEY, null);
 
         subject.loadNativeAd(context, mCustomEventNativeListener, localExtras, serverExtras);
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubForwardingNativeAdTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubForwardingNativeAdTest.java
index e46755ee..7ae673b8 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubForwardingNativeAdTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubForwardingNativeAdTest.java
@@ -2,14 +2,23 @@
 
 import android.app.Activity;
 
-import com.mopub.mobileads.test.support.SdkTestRunner;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.test.support.CommonUtils;
+import com.mopub.nativeads.test.support.MoPubShadowBitmap;
+import com.mopub.nativeads.test.support.MoPubShadowDisplay;
 
+import org.apache.http.HttpRequest;
 import org.json.JSONArray;
 import org.json.JSONObject;
 import org.junit.Before;
 import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+import org.robolectric.tester.org.apache.http.FakeHttpLayer;
+import org.robolectric.tester.org.apache.http.RequestMatcher;
+import org.robolectric.tester.org.apache.http.TestHttpResponse;
 
 import java.util.ArrayList;
 import java.util.HashMap;
@@ -21,18 +30,39 @@
 import static com.mopub.nativeads.NativeResponse.Parameter.requiredKeys;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.fest.assertions.api.Assertions.fail;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.verify;
 
 @RunWith(SdkTestRunner.class)
+@Config(shadows={MoPubShadowBitmap.class, MoPubShadowDisplay.class})
 public class MoPubForwardingNativeAdTest {
 
     private JSONObject fakeJsonObject;
     private MoPubCustomEventNative.MoPubForwardingNativeAd subject;
+    private Activity context;
+    private CustomEventNative.CustomEventNativeListener mockCustomEventNativeListener;
+    private FakeHttpLayer fakeHttpLayer;
 
     @Before
     public void setUp() throws Exception {
+        context = new Activity();
+        mockCustomEventNativeListener = mock(CustomEventNative.CustomEventNativeListener.class);
         fakeJsonObject = new JSONObject();
         fakeJsonObject.put("imptracker", new JSONArray("[\"url1\", \"url2\"]"));
         fakeJsonObject.put("clktracker", "expected clicktracker");
+
+        fakeHttpLayer = Robolectric.getFakeHttpLayer();
+        fakeHttpLayer.addHttpResponseRule(
+                new RequestMatcher() {
+                    @Override
+                    public boolean matches(HttpRequest request) {
+                        return true;
+                    }
+                },
+                new TestHttpResponse(200, "body")
+        );
     }
 
     @Test
@@ -59,11 +89,12 @@ public void parameter_fromString_shouldReturnNullOnIllegalKey() throws Exception
     }
 
     @Test
-    public void constructor_whenMissingRequiredKeys_shouldThrowIllegalArgumentException() throws Exception {
+    public void loadAd_whenMissingRequiredKeys_shouldThrowIllegalArgumentException() throws Exception {
         fakeJsonObject.remove("imptracker");
 
         try {
-            subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+            subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+            subject.loadAd();
             fail("Expected IllegalArgumentException");
         } catch (IllegalArgumentException e) {
             // pass
@@ -71,11 +102,12 @@ public void constructor_whenMissingRequiredKeys_shouldThrowIllegalArgumentExcept
     }
 
     @Test
-    public void constructor_whenRequiredKeyOfWrongType_shouldThrowIllegalArgumentException() throws Exception {
+    public void loadAd_whenRequiredKeyOfWrongType_shouldThrowIllegalArgumentException() throws Exception {
         fakeJsonObject.put("imptracker", 12345);
 
         try {
-            subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+            subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+            subject.loadAd();
             fail("Expected IllegalArgumentException");
         } catch (IllegalArgumentException e) {
             // pass
@@ -83,13 +115,14 @@ public void constructor_whenRequiredKeyOfWrongType_shouldThrowIllegalArgumentExc
     }
 
     @Test
-    public void constructor_shouldSetRequiredExpectedFields() throws Exception {
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+    public void loadAd_shouldSetRequiredExpectedFields() throws Exception {
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
         assertThat(subject.getImpressionTrackers()).containsOnly("url1", "url2");
     }
 
     @Test
-    public void constructor_shouldSetOptionalExpectedFields() throws Exception {
+    public void loadAd_shouldSetOptionalExpectedFields() throws Exception {
         fakeJsonObject.put("title", "expected title");
         fakeJsonObject.put("text", "expected text");
         fakeJsonObject.put("mainimage", "expected mainimage");
@@ -101,7 +134,8 @@ public void constructor_shouldSetOptionalExpectedFields() throws Exception {
         fakeJsonObject.put("ctatext", "expected ctatext");
         fakeJsonObject.put("starrating", 5.0);
 
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getTitle()).isEqualTo("expected title");
         assertThat(subject.getText()).isEqualTo("expected text");
@@ -117,46 +151,50 @@ public void constructor_shouldSetOptionalExpectedFields() throws Exception {
     }
 
     @Test
-    public void constructor_withIntegerStarRating_shouldSetStarRating() throws Exception {
+    public void loadAd_withIntegerStarRating_shouldSetStarRating() throws Exception {
         fakeJsonObject.put("starrating", 3);
 
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getStarRating()).isEqualTo(3.0);
     }
 
     @Test
-    public void constructor_withStringStarRating_shouldSetStarRating() throws Exception {
+    public void loadAd_withStringStarRating_shouldSetStarRating() throws Exception {
         fakeJsonObject.put("starrating", "2.3");
 
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getStarRating()).isEqualTo(2.3);
     }
-    
+
     @Test
-    public void constructor_withInvalidStringStarRating_shouldNotSetStarRating() throws Exception {
+    public void loadAd_withInvalidStringStarRating_shouldNotSetStarRating() throws Exception {
         fakeJsonObject.put("starrating", "this is not a number");
 
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getStarRating()).isNull();
     }
 
     @Test
-    public void constructor_withInvalidlyTypedStarRating_shouldNotSetStarRating() throws Exception {
+    public void loadAd_withInvalidlyTypedStarRating_shouldNotSetStarRating() throws Exception {
         fakeJsonObject.put("starrating", new Activity());
 
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getStarRating()).isNull();
     }
 
     @Test
-    public void constructor_whenImpressionTrackersContainsNonStrings_willCoerceToString() throws Exception {
+    public void loadAd_whenImpressionTrackersContainsNonStrings_willCoerceToString() throws Exception {
         /**
          * At this level of abstraction, we don't actually care that these Strings resolve to valid
-         * URLs. We just want to ensure that the constructor does not throw an exception.
+         * URLs. We just want to ensure that loadAd does not throw an exception.
          */
         final JSONArray impressionTrackers = new JSONArray();
         impressionTrackers.put("url1");
@@ -164,13 +202,14 @@ public void constructor_whenImpressionTrackersContainsNonStrings_willCoerceToStr
         impressionTrackers.put(2.12);
         fakeJsonObject.put("imptracker", impressionTrackers);
 
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getImpressionTrackers()).containsOnly("url1", "null", "2.12");
     }
 
     @Test
-    public void constructor_shouldSetExtraFields() throws Exception {
+    public void loadAd_shouldSetExtraFields() throws Exception {
         List<Object> array = new ArrayList<Object>();
         array.add("index1");
         array.add(-10);
@@ -184,7 +223,8 @@ public void constructor_shouldSetExtraFields() throws Exception {
         fakeJsonObject.put("key3", new JSONArray(array));
         fakeJsonObject.put("key4", new JSONObject(map));
 
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getExtra("key1")).isEqualTo("yay json");
         assertThat(subject.getExtra("key2")).isEqualTo(5);
@@ -192,6 +232,37 @@ public void constructor_shouldSetExtraFields() throws Exception {
         assertThat((JSONObject) subject.getExtra("key4")).isEqualsToByComparingFields(new JSONObject(map));
     }
 
+    @Test
+    public void loadAd_shouldDownloadImages_shouldNotifyListenerOfOnNativeAdLoaded() throws Exception {
+        fakeJsonObject.put("mainimage", "mainimageurl");
+        fakeJsonObject.put("iconimage", "iconimageurl");
+        fakeJsonObject.put("extraimage", "extraimageurl");
+
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
+
+        CommonUtils.assertHttpRequestsMade(null, "mainimageurl", "iconimageurl", "extraimageurl");
+
+        verify(mockCustomEventNativeListener).onNativeAdLoaded(subject);
+        verify(mockCustomEventNativeListener, never()).onNativeAdFailed(any(NativeErrorCode.class));
+    }
+
+    @Test
+    public void loadAd_withFailedImageDownload_shouldNotDownloadImages_shouldNotifyListenerOfOnNativeAdFailed() throws Exception {
+        fakeJsonObject.put("mainimage", "mainimageurl");
+        fakeJsonObject.put("iconimage", "iconimageurl");
+        fakeJsonObject.put("extraimage", "extraimageurl");
+
+        fakeHttpLayer.clearHttpResponseRules();
+        fakeHttpLayer.addPendingHttpResponse(500, "body");
+
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
+
+        verify(mockCustomEventNativeListener, never()).onNativeAdLoaded(subject);
+        verify(mockCustomEventNativeListener).onNativeAdFailed(NativeErrorCode.IMAGE_DOWNLOAD_FAILURE);
+    }
+
     @Ignore("pending")
     @Test
     public void loadMainAndIconImages_shouldAsyncLoadImages() throws Exception {
@@ -207,7 +278,8 @@ public void getExtrasImageUrls_whenExtrasContainsImages_shouldReturnImageUrls()
         fakeJsonObject.put("otherIMAGE", "image_url_2");
         fakeJsonObject.put("more filler", "ignored");
         fakeJsonObject.put("lastimage", "image_url_3");
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getExtrasImageUrls()).containsOnly("image_url_1", "image_url_2", "image_url_3");
     }
@@ -219,7 +291,8 @@ public void getExtrasImageUrls_whenExtrasDoesNotContainImageKeys_shouldReturnEmp
         fakeJsonObject.put("imageAtFront", "ignored");
         fakeJsonObject.put("middle_image_in_key", "ignored");
         fakeJsonObject.put("other", "ignored");
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getExtrasImageUrls()).isEmpty();
     }
@@ -229,7 +302,8 @@ public void getAllImageUrls_withExtraImagesAndMainAndIconImages_shouldReturnAllU
         fakeJsonObject.put("mainimage", "mainImageUrl");
         fakeJsonObject.put("iconimage", "iconImageUrl");
         fakeJsonObject.put("extraimage", "extraImageUrl");
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getAllImageUrls()).containsOnly(
                 "mainImageUrl",
@@ -242,7 +316,8 @@ public void getAllImageUrls_withExtraImagesAndMainAndIconImages_shouldReturnAllU
     public void getAllImageUrls_withOnlyExtrasImages_shouldNotIncludeMainOrIconImages() throws Exception {
         fakeJsonObject.put("extra1_image", "expected extra1_image");
         fakeJsonObject.put("extra2_image", "expected extra2_image");
-        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(fakeJsonObject.toString());
+        subject = new MoPubCustomEventNative.MoPubForwardingNativeAd(context, fakeJsonObject.toString(), mockCustomEventNativeListener);
+        subject.loadAd();
 
         assertThat(subject.getAllImageUrls()).containsOnly("expected extra1_image", "expected extra2_image");
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeAdRendererTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeAdRendererTest.java
new file mode 100644
index 00000000..0bcebf6d
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeAdRendererTest.java
@@ -0,0 +1,174 @@
+package com.mopub.nativeads;
+
+import android.app.Activity;
+import android.view.ViewGroup;
+import android.widget.Button;
+import android.widget.ImageView;
+import android.widget.LinearLayout;
+import android.widget.RelativeLayout;
+import android.widget.TextView;
+
+import com.mopub.common.DownloadResponse;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.ResponseHeader;
+import com.mopub.common.util.Utils;
+import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
+
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.rules.ExpectedException;
+import org.junit.runner.RunWith;
+
+import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Mockito.mock;
+
+@RunWith(SdkTestRunner.class)
+public class MoPubNativeAdRendererTest {
+    private MoPubNativeAdRenderer subject;
+    private Activity context;
+    private RelativeLayout relativeLayout;
+    private ViewGroup viewGroup;
+    private NativeResponse nativeResponse;
+    private BaseForwardingNativeAd mNativeAd;
+    private ViewBinder viewBinder;
+    private TextView titleView;
+    private TextView textView;
+    private TextView callToActionView;
+    private ImageView mainImageView;
+    private ImageView iconImageView;
+    private ImageView badView;
+
+    @Before
+    public void setUp() throws Exception {
+        context = new Activity();
+        relativeLayout = new RelativeLayout(context);
+        relativeLayout.setId((int) Utils.generateUniqueId());
+        viewGroup = new LinearLayout(context);
+
+        mNativeAd = new BaseForwardingNativeAd() {};
+        mNativeAd.setTitle("test title");
+        mNativeAd.setText("test text");
+        mNativeAd.setCallToAction("test call to action");
+        mNativeAd.setClickDestinationUrl("destinationUrl");
+
+        final TestHttpResponseWithHeaders testHttpResponseWithHeaders = new TestHttpResponseWithHeaders(200, "");
+        testHttpResponseWithHeaders.addHeader(ResponseHeader.CLICKTHROUGH_URL.getKey(), "clickTrackerUrl");
+        final DownloadResponse downloadResponse = new DownloadResponse(testHttpResponseWithHeaders);
+        nativeResponse = new NativeResponse(context, downloadResponse, "test ID", mNativeAd, mock(MoPubNativeListener.class));
+
+        titleView = new TextView(context);
+        titleView.setId((int) Utils.generateUniqueId());
+        textView = new TextView(context);
+        textView.setId((int) Utils.generateUniqueId());
+        callToActionView = new Button(context);
+        callToActionView.setId((int) Utils.generateUniqueId());
+        mainImageView = new ImageView(context);
+        mainImageView.setId((int) Utils.generateUniqueId());
+        iconImageView = new ImageView(context);
+        iconImageView.setId((int) Utils.generateUniqueId());
+        badView = new ImageView(context);
+        badView.setId((int) Utils.generateUniqueId());
+
+        relativeLayout.addView(titleView);
+        relativeLayout.addView(textView);
+        relativeLayout.addView(callToActionView);
+        relativeLayout.addView(mainImageView);
+        relativeLayout.addView(iconImageView);
+        relativeLayout.addView(badView);
+
+        viewBinder = new ViewBinder.Builder(relativeLayout.getId())
+                .titleId(titleView.getId())
+                .textId(textView.getId())
+                .callToActionId(callToActionView.getId())
+                .mainImageId(mainImageView.getId())
+                .iconImageId(iconImageView.getId())
+                .build();
+
+        subject = new MoPubNativeAdRenderer(viewBinder);
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void createAdView_withNullContext_shouldThrowNPE() {
+        subject.createAdView(null, viewGroup);
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void renderAdView_withNullView_shouldThrowNPE() {
+        subject.renderAdView(null, nativeResponse);
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void renderAdView_withNullNativeResponse_shouldThrowNPE() {
+        subject.renderAdView(relativeLayout, null);
+    }
+
+    @Rule public ExpectedException exception = ExpectedException.none();
+    public void renderAdView_withNullViewBinder_shouldThrowNPE() {
+        subject = new MoPubNativeAdRenderer(null);
+
+        exception.expect(NullPointerException.class);
+        subject.renderAdView(relativeLayout, nativeResponse);
+    }
+
+    @Test
+    public void renderAdView_shouldReturnPopulatedView() {
+        subject.renderAdView(relativeLayout, nativeResponse);
+
+        assertThat(((TextView)relativeLayout.findViewById(titleView.getId())).getText()).isEqualTo("test title");
+        assertThat(((TextView)relativeLayout.findViewById(textView.getId())).getText()).isEqualTo(
+                "test text");
+        assertThat(((TextView)relativeLayout.findViewById(callToActionView.getId())).getText()).isEqualTo("test call to action");
+
+        // not testing images due to testing complexity
+    }
+
+    @Test
+    public void renderAdView_withFailedViewBinder_shouldReturnFast() {
+        viewBinder = new ViewBinder.Builder(relativeLayout.getId())
+                .titleId(titleView.getId())
+                .textId(badView.getId())
+                .callToActionId(callToActionView.getId())
+                .mainImageId(mainImageView.getId())
+                .iconImageId(iconImageView.getId())
+                .build();
+
+        subject = new MoPubNativeAdRenderer(viewBinder);
+        subject.renderAdView(relativeLayout, nativeResponse);
+
+        assertThat(((TextView)relativeLayout.findViewById(titleView.getId())).getText()).isEqualTo("");
+        assertThat(((TextView)relativeLayout.findViewById(textView.getId())).getText()).isEqualTo(
+                "");
+        assertThat(((TextView)relativeLayout.findViewById(callToActionView.getId())).getText()).isEqualTo(
+                "");
+    }
+
+    @Test
+    public void getOrCreateNativeViewHolder_withNoViewHolder_shouldCreateNativeViewHolder() {
+        final NativeViewHolder viewHolder =
+                subject.getOrCreateNativeViewHolder(relativeLayout, viewBinder);
+
+        final NativeViewHolder expectedViewHolder =
+                NativeViewHolder.fromViewBinder(relativeLayout, viewBinder);
+        compareNativeViewHolders(expectedViewHolder, viewHolder);
+    }
+
+    @Test
+    public void getOrCreateNativeViewHolder_withViewHolder_shouldNotReCreateNativeViewHolder() {
+        final NativeViewHolder viewHolder =
+                subject.getOrCreateNativeViewHolder(relativeLayout, viewBinder);
+
+        assertThat(subject.getOrCreateNativeViewHolder(relativeLayout, viewBinder))
+                .isEqualTo(viewHolder);
+    }
+
+    static private void compareNativeViewHolders(final NativeViewHolder actualViewHolder,
+            final NativeViewHolder expectedViewHolder) {
+        assertThat(actualViewHolder.titleView).isEqualTo(expectedViewHolder.titleView);
+        assertThat(actualViewHolder.textView).isEqualTo(expectedViewHolder.textView);
+        assertThat(actualViewHolder.callToActionView).isEqualTo(expectedViewHolder.callToActionView);
+        assertThat(actualViewHolder.mainImageView).isEqualTo(expectedViewHolder.mainImageView);
+        assertThat(actualViewHolder.iconImageView).isEqualTo(expectedViewHolder.iconImageView);
+    }
+}
\ No newline at end of file
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java
index ea6073a5..7510acf4 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java
@@ -1,33 +1,35 @@
 package com.mopub.nativeads;
 
 import android.app.Activity;
-
 import com.mopub.common.DownloadTask;
 import com.mopub.common.GpsHelper;
 import com.mopub.common.GpsHelperTest;
 import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.test.support.ShadowAsyncTasks;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
-import com.mopub.nativeads.test.support.SdkTestRunner;
-
+import com.mopub.nativeads.MoPubNative.MoPubNativeEventListener;
+import com.mopub.nativeads.MoPubNative.MoPubNativeNetworkListener;
 import org.apache.http.client.methods.HttpGet;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.Mock;
 import org.mockito.invocation.InvocationOnMock;
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 
-import java.util.List;
-import java.util.concurrent.Semaphore;
+import java.util.*;
+import java.util.concurrent.*;
 
 import static android.Manifest.permission.ACCESS_NETWORK_STATE;
 import static android.Manifest.permission.INTERNET;
 import static com.mopub.common.util.Reflection.MethodBuilder;
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
+import static com.mopub.nativeads.MoPubNative.EMPTY_EVENT_LISTENER;
+import static com.mopub.nativeads.MoPubNative.EMPTY_NETWORK_LISTENER;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
 import static org.mockito.Mockito.doAnswer;
@@ -47,15 +49,17 @@
     private MoPubNative.NativeGpsHelperListener nativeGpsHelperListener;
     private Semaphore semaphore;
     private static final String adUnitId = "test_adunit_id";
-    private MoPubNativeListener moPubNativeListener;
+    
+    @Mock private MoPubNativeEventListener mockEventListener;
 
+    @Mock private MoPubNativeNetworkListener mockNetworkListener;
+    
     @Before
     public void setup() {
         context = new Activity();
         shadowOf(context).grantPermissions(ACCESS_NETWORK_STATE);
         shadowOf(context).grantPermissions(INTERNET);
-        moPubNativeListener = mock(MoPubNativeListener.class);
-        subject = new MoPubNative(context, adUnitId, moPubNativeListener);
+        subject = new MoPubNative(context, adUnitId, mockNetworkListener);
         methodBuilder = TestMethodBuilderFactory.getSingletonMock();
         nativeGpsHelperListener = mock(MoPubNative.NativeGpsHelperListener.class);
         semaphore = new Semaphore(0);
@@ -69,13 +73,14 @@ public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
     }
 
     @After
-    public void tearDown() throws Exception {
+    public void tearDown() {
         reset(methodBuilder);
     }
 
     @Ignore("fix concurrency issues")
     @Test
-    public void makeRequest_whenGooglePlayServicesIsLinkedAndAdInfoIsNotCached_shouldCacheAdInfoBeforeFetchingAd() throws Exception {
+    public void
+    makeRequest_whenGooglePlayServicesIsLinkedAndAdInfoIsNotCached_shouldCacheAdInfoBeforeFetchingAd() throws Exception {
         SharedPreferencesHelper.getSharedPreferences(context).edit().clear().commit();
         GpsHelperTest.verifyCleanSharedPreferences(context);
 
@@ -154,19 +159,32 @@ public void makeRequest_whenGooglePlayServicesIsLinkedAndAdInfoIsCached_shouldFe
     }
 
     @Test
-    public void destroy_shouldSetMoPubNativeListenerToEmptyAndClearContext() throws Exception {
+    public void destroy_shouldSetListenersToEmptyAndClearContext() {
         assertThat(subject.getContextOrDestroy()).isSameAs(context);
-        assertThat(subject.getMoPubNativeListener()).isSameAs(moPubNativeListener);
+        assertThat(subject.getMoPubNativeNetworkListener()).isSameAs(mockNetworkListener);
+        subject.setNativeEventListener(mockEventListener);
+        assertThat(subject.getMoPubNativeEventListener()).isSameAs(mockEventListener);
 
         subject.destroy();
 
         assertThat(subject.getContextOrDestroy()).isNull();
-        assertThat(subject.getMoPubNativeListener()).isSameAs(MoPubNativeListener.EMPTY_MOPUB_NATIVE_LISTENER);
+        assertThat(subject.getMoPubNativeNetworkListener()).isSameAs(EMPTY_NETWORK_LISTENER);
+        assertThat(subject.getMoPubNativeEventListener()).isSameAs(EMPTY_EVENT_LISTENER);
+    }
+
+    @Test
+    public void setNativeEventListener_shouldSetListener() {
+        assertThat(subject.getMoPubNativeNetworkListener()).isSameAs(mockNetworkListener);
+        subject.setNativeEventListener(mockEventListener);
+        assertThat(subject.getMoPubNativeEventListener()).isSameAs(mockEventListener);
+
+        subject.setNativeEventListener(null);
+        assertThat(subject.getMoPubNativeEventListener()).isSameAs(EMPTY_EVENT_LISTENER);
     }
 
     @Ignore("pending")
     @Test
-    public void loadNativeAd_shouldQueueAsyncDownloadTask() throws Exception {
+    public void loadNativeAd_shouldQueueAsyncDownloadTask() {
         Robolectric.getUiThreadScheduler().pause();
 
         subject.loadNativeAd(null);
@@ -175,7 +193,7 @@ public void loadNativeAd_shouldQueueAsyncDownloadTask() throws Exception {
     }
 
     @Test
-    public void loadNativeAd_shouldReturnFast() throws Exception {
+    public void loadNativeAd_shouldReturnFast() {
         Robolectric.getUiThreadScheduler().pause();
 
         subject.destroy();
@@ -185,13 +203,13 @@ public void loadNativeAd_shouldReturnFast() throws Exception {
     }
 
     @Test
-    public void requestNativeAd_withValidUrl_shouldStartDownloadTaskWithUrl() throws Exception {
+    public void requestNativeAd_withValidUrl_shouldStartDownloadTaskWithUrl() {
         Robolectric.getUiThreadScheduler().pause();
         Robolectric.addPendingHttpResponse(200, "body");
 
         subject.requestNativeAd("http://www.mopub.com");
 
-        verify(moPubNativeListener, never()).onNativeFail(any(NativeErrorCode.class));
+        verify(mockNetworkListener, never()).onNativeFail(any(NativeErrorCode.class));
         assertThat(wasDownloadTaskExecuted()).isTrue();
 
         List<?> latestParams = ShadowAsyncTasks.getLatestParams();
@@ -201,22 +219,22 @@ public void requestNativeAd_withValidUrl_shouldStartDownloadTaskWithUrl() throws
     }
 
     @Test
-    public void requestNativeAd_withInvalidUrl_shouldFireNativeFailAndNotStartAsyncTask() throws Exception {
+    public void requestNativeAd_withInvalidUrl_shouldFireNativeFailAndNotStartAsyncTask() {
         Robolectric.getUiThreadScheduler().pause();
 
         subject.requestNativeAd("//\\//\\::::");
 
-        verify(moPubNativeListener).onNativeFail(any(NativeErrorCode.class));
+        verify(mockNetworkListener).onNativeFail(any(NativeErrorCode.class));
         assertThat(wasDownloadTaskExecuted()).isFalse();
     }
 
     @Test
-    public void requestNativeAd_withNullUrl_shouldFireNativeFailAndNotStartAsyncTask() throws Exception {
+    public void requestNativeAd_withNullUrl_shouldFireNativeFailAndNotStartAsyncTask() {
         Robolectric.getUiThreadScheduler().pause();
 
         subject.requestNativeAd(null);
 
-        verify(moPubNativeListener).onNativeFail(any(NativeErrorCode.class));
+        verify(mockNetworkListener).onNativeFail(any(NativeErrorCode.class));
         assertThat(wasDownloadTaskExecuted()).isFalse();
     }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubStreamAdPlacerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubStreamAdPlacerTest.java
new file mode 100644
index 00000000..06f09512
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubStreamAdPlacerTest.java
@@ -0,0 +1,442 @@
+package com.mopub.nativeads;
+
+import android.app.Activity;
+import android.content.Context;
+import android.view.View;
+import android.view.ViewGroup;
+
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Answers;
+import org.mockito.Mock;
+import org.robolectric.Robolectric;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.List;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.anyInt;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
+@RunWith(SdkTestRunner.class)
+public class MoPubStreamAdPlacerTest {
+    private Context context;
+
+    MoPubClientPositioning positioning;
+
+    @Mock
+    PositioningSource mockPositioningSource;
+    @Mock
+    NativeAdSource mockAdSource;
+    @Mock
+    MoPubNativeAdRenderer mockAdRenderer;
+    @Mock
+    MoPubNativeAdLoadedListener mockAdLoadedListener;
+    @Mock
+    ImpressionTracker mockImpressionTracker;
+
+    @Mock(answer = Answers.RETURNS_DEEP_STUBS)
+    NativeResponse stubNativeResponse;
+
+    private MoPubStreamAdPlacer subject;
+
+    @Before
+    public void setup() {
+        context = new Activity();
+        positioning = MoPubNativeAdPositioning.clientPositioning()
+                .enableRepeatingPositions(2);
+
+        subject = new MoPubStreamAdPlacer(
+                context, mockAdSource, mockImpressionTracker, mockPositioningSource);
+        subject.registerAdRenderer(mockAdRenderer);
+        subject.setAdLoadedListener(mockAdLoadedListener);
+    }
+
+    @Test
+    public void isAd_initialState_hasNoAds() {
+        checkAdPositions();
+    }
+
+    @Test
+    public void isAd_loadPositions_withoutLoadingAds_hasNoAds() {
+        subject.handlePositioningLoad(positioning);
+        checkAdPositions();
+    }
+
+    @Test
+    public void isAd_loadAds_withoutLoadingPositions_hasNoAds() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+        checkAdPositions();
+    }
+
+    @Test
+    public void isAd_loadAds_thenLoadPositions_hasAds() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handleAdsAvailable();
+        subject.handlePositioningLoad(positioning);
+        subject.setItemCount(4);
+        checkAdPositions(1, 3, 5);
+    }
+
+    @Test
+    public void isAd_loadPositions_thenLoadAds_hasAds() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+        checkAdPositions(1, 3, 5);
+    }
+
+    @Test
+    public void getOriginalPosition_adjustsPositions() {
+        assertThat(subject.getOriginalPosition(0)).isEqualTo(0);
+        assertThat(subject.getOriginalPosition(1)).isEqualTo(1);
+        assertThat(subject.getOriginalPosition(2)).isEqualTo(2);
+        assertThat(subject.getOriginalPosition(3)).isEqualTo(3);
+        assertThat(subject.getOriginalPosition(4)).isEqualTo(4);
+
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+
+        assertThat(subject.getOriginalPosition(0)).isEqualTo(0);
+        assertThat(subject.getOriginalPosition(1)).isEqualTo(PlacementData.NOT_FOUND);
+        assertThat(subject.getOriginalPosition(2)).isEqualTo(1);
+        assertThat(subject.getOriginalPosition(3)).isEqualTo(PlacementData.NOT_FOUND);
+        assertThat(subject.getOriginalPosition(4)).isEqualTo(2);
+        assertThat(subject.getOriginalPosition(5)).isEqualTo(PlacementData.NOT_FOUND);
+        assertThat(subject.getOriginalPosition(6)).isEqualTo(3);
+        assertThat(subject.getOriginalPosition(7)).isEqualTo(4);
+        assertThat(subject.getOriginalPosition(8)).isEqualTo(5);
+        assertThat(subject.getOriginalPosition(9)).isEqualTo(6);
+    }
+
+    @Test
+    public void getAdjustedPosition_adjustsPositions() {
+        assertThat(subject.getAdjustedPosition(0)).isEqualTo(0);
+        assertThat(subject.getAdjustedPosition(1)).isEqualTo(1);
+        assertThat(subject.getAdjustedPosition(2)).isEqualTo(2);
+        assertThat(subject.getAdjustedPosition(3)).isEqualTo(3);
+        assertThat(subject.getAdjustedPosition(4)).isEqualTo(4);
+
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+
+        assertThat(subject.getAdjustedPosition(0)).isEqualTo(0);
+        assertThat(subject.getAdjustedPosition(1)).isEqualTo(2);
+        assertThat(subject.getAdjustedPosition(2)).isEqualTo(4);
+        assertThat(subject.getAdjustedPosition(3)).isEqualTo(6);
+        assertThat(subject.getAdjustedPosition(4)).isEqualTo(7);
+        assertThat(subject.getAdjustedPosition(5)).isEqualTo(8);
+        assertThat(subject.getAdjustedPosition(6)).isEqualTo(9);
+        assertThat(subject.getAdjustedPosition(7)).isEqualTo(10);
+        assertThat(subject.getAdjustedPosition(8)).isEqualTo(11);
+        assertThat(subject.getAdjustedPosition(9)).isEqualTo(12);
+    }
+
+    @Test
+    public void getOriginalCount_adjustsPositions() {
+        assertThat(subject.getOriginalCount(0)).isEqualTo(0);
+        assertThat(subject.getOriginalCount(1)).isEqualTo(1);
+        assertThat(subject.getOriginalCount(2)).isEqualTo(2);
+        assertThat(subject.getOriginalCount(3)).isEqualTo(3);
+        assertThat(subject.getOriginalCount(4)).isEqualTo(4);
+
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+
+        assertThat(subject.getOriginalCount(0)).isEqualTo(0);
+        assertThat(subject.getOriginalCount(1)).isEqualTo(1);
+        assertThat(subject.getOriginalCount(2)).isEqualTo(PlacementData.NOT_FOUND);
+        assertThat(subject.getOriginalCount(3)).isEqualTo(2);
+        assertThat(subject.getOriginalCount(4)).isEqualTo(PlacementData.NOT_FOUND);
+        assertThat(subject.getOriginalCount(5)).isEqualTo(3);
+        assertThat(subject.getOriginalCount(6)).isEqualTo(PlacementData.NOT_FOUND);
+        assertThat(subject.getOriginalCount(7)).isEqualTo(4);
+        assertThat(subject.getOriginalCount(8)).isEqualTo(5);
+        assertThat(subject.getOriginalCount(9)).isEqualTo(6);
+    }
+
+    @Test
+    public void getAdjustedCount_adjustsPositions() {
+        assertThat(subject.getAdjustedCount(0)).isEqualTo(0);
+        assertThat(subject.getAdjustedCount(1)).isEqualTo(1);
+        assertThat(subject.getAdjustedCount(2)).isEqualTo(2);
+        assertThat(subject.getAdjustedCount(3)).isEqualTo(3);
+        assertThat(subject.getAdjustedCount(4)).isEqualTo(4);
+
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+
+        assertThat(subject.getAdjustedCount(0)).isEqualTo(0);
+        assertThat(subject.getAdjustedCount(1)).isEqualTo(1);
+        assertThat(subject.getAdjustedCount(2)).isEqualTo(3);
+        assertThat(subject.getAdjustedCount(3)).isEqualTo(5);
+        assertThat(subject.getAdjustedCount(4)).isEqualTo(7);
+        assertThat(subject.getAdjustedCount(5)).isEqualTo(8);
+        assertThat(subject.getAdjustedCount(6)).isEqualTo(9);
+        assertThat(subject.getAdjustedCount(7)).isEqualTo(10);
+        assertThat(subject.getAdjustedCount(8)).isEqualTo(11);
+        assertThat(subject.getAdjustedCount(9)).isEqualTo(12);
+    }
+
+    @Test
+    public void placeAds_shouldCallListener() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+
+        verify(mockAdLoadedListener, never()).onAdLoaded(0);
+        verify(mockAdLoadedListener).onAdLoaded(1);
+        verify(mockAdLoadedListener, never()).onAdLoaded(2);
+        verify(mockAdLoadedListener).onAdLoaded(3);
+        verify(mockAdLoadedListener, never()).onAdLoaded(4);
+        verify(mockAdLoadedListener).onAdLoaded(5);
+        verify(mockAdLoadedListener, never()).onAdLoaded(6);
+        verify(mockAdLoadedListener, never()).onAdLoaded(7);
+    }
+
+    @Test
+    public void placeAdsInRange_shouldPlaceAfter() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+
+        Robolectric.getUiThreadScheduler().pause();
+        subject.setItemCount(100);
+        subject.placeAdsInRange(50, 50);
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+
+        assertThat(subject.isAd(48)).isFalse();
+        assertThat(subject.isAd(49)).isFalse();
+        assertThat(subject.isAd(50)).isTrue();
+        assertThat(subject.isAd(51)).isFalse();
+        assertThat(subject.isAd(52)).isTrue();
+        assertThat(subject.isAd(53)).isFalse();
+        assertThat(subject.isAd(54)).isTrue();
+    }
+
+    @Test
+    public void placeAdsInRange_shouldCallListener() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+
+        Robolectric.getUiThreadScheduler().pause();
+        subject.setItemCount(100);
+        subject.placeAdsInRange(50, 54);
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+
+        verify(mockAdLoadedListener).onAdLoaded(50);
+        verify(mockAdLoadedListener, never()).onAdLoaded(51);
+        verify(mockAdLoadedListener).onAdLoaded(52);
+        verify(mockAdLoadedListener, never()).onAdLoaded(53);
+        verify(mockAdLoadedListener).onAdLoaded(54);
+        verify(mockAdLoadedListener, never()).onAdLoaded(55);
+        verify(mockAdLoadedListener).onAdLoaded(56);
+    }
+
+    @Test
+    public void placeAdsInRange_aboveItemCount_shouldNotInsert() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+
+        Robolectric.getUiThreadScheduler().pause();
+        subject.setItemCount(0);
+        subject.placeAdsInRange(50, 54);
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+
+        verify(mockAdLoadedListener, never()).onAdLoaded(50);
+    }
+
+    @Test
+    public void getAdView_withNoAds_returnsNull() {
+        assertThat(subject.getAdView(1, null, null)).isNull();
+    }
+
+    @Test
+    public void loadAds_shouldClearAds_afterFirstAdLoads() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(2);
+        subject.placeAdsInRange(0, 1);
+
+        subject.loadAds("test_ad-unit-id");
+
+        // Ad should still exist until a new ad is available
+        checkAdPositions(1);
+        verify(mockAdLoadedListener, never()).onAdRemoved(anyInt());
+
+        // Once an ad is available, it should be immediately removed and replaced
+        subject.handleAdsAvailable();
+        subject.handlePositioningLoad(positioning);
+        verify(mockAdLoadedListener).onAdRemoved(1);
+        verify(mockAdLoadedListener, times(2)).onAdLoaded(1);
+        checkAdPositions(1);
+    }
+
+    @Test
+    public void destroy_shouldClearAdSource_shouldDestroyImpressionTracker_shouldDestroyResponse() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+
+        subject = new MoPubStreamAdPlacer(context,
+                mockAdSource, mockImpressionTracker, mockPositioningSource);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(2);  // Places 1 ad
+
+        subject.destroy();
+
+        verify(mockAdSource).clear();
+        verify(mockImpressionTracker).destroy();
+        verify(stubNativeResponse).destroy();
+    }
+
+    @Test
+    public void getAdView_withNullConvertView_callsRenderer_addsToImpressionTracker() {
+        View view = new View(context);
+        when(mockAdRenderer.createAdView(any(Context.class), any(ViewGroup.class)))
+                .thenReturn(view);
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(100);
+
+        assertThat(subject.getAdView(1, null, null)).isEqualTo(view);
+        verify(mockAdRenderer).createAdView(any(Context.class), any(ViewGroup.class));
+        verify(mockAdRenderer).renderAdView(view, stubNativeResponse);
+        verify(mockImpressionTracker).addView(view, stubNativeResponse);
+    }
+
+    @Test
+    public void getAdView_withConvertView_callsRenderer_addsToImpressionTracker() {
+        View convertView = new View(context);
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+
+        assertThat(subject.getAdView(1, convertView, null)).isEqualTo(convertView);
+        verify(mockAdRenderer, never()).createAdView(any(Context.class), any(ViewGroup.class));
+        verify(mockAdRenderer).renderAdView(convertView, stubNativeResponse);
+        verify(mockImpressionTracker).addView(convertView, stubNativeResponse);
+    }
+
+    @Test
+    public void getAdView_shouldRemoveViewFromImpressionTracker_shouldClearPreviousNativeResponse() throws Exception {
+        NativeResponse mockNativeResponse = mock(NativeResponse.class);
+        View mockView = mock(View.class);
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse, mockNativeResponse, stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(100);
+
+        subject.getAdView(1, mockView, null);
+        verify(mockImpressionTracker).removeView(mockView);
+
+        // Second call should clear the first NativeResponse
+        subject.getAdView(3, mockView, null);
+        verify(mockImpressionTracker, times(2)).removeView(mockView);
+        verify(stubNativeResponse).clear(mockView);
+
+        // Third call should clear the second NativeResponse
+        subject.getAdView(5, mockView, null);
+        verify(mockImpressionTracker, times(3)).removeView(mockView);
+        verify(mockNativeResponse).clear(mockView);
+    }
+
+    @Test
+    public void getAdView_withNetworkImpressionTracker_shouldNotAddViewToImpressionTracker_shouldPrepareNativeResponse() throws Exception {
+        View mockView = mock(View.class);
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(100);
+
+        when(stubNativeResponse.isOverridingImpressionTracker()).thenReturn(true);
+        subject.getAdView(1, mockView, null);
+
+        verify(mockImpressionTracker, never()).addView(any(View.class), any(NativeResponse.class));
+        verify(stubNativeResponse).prepare(mockView);
+    }
+
+    @Test
+    public void getAdView_withoutNetworkImpressionTracker_shouldAddViewToImpressionTracker_shouldPrepareNativeResponse() throws Exception {
+        View mockView = mock(View.class);
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(100);
+
+        when(stubNativeResponse.isOverridingImpressionTracker()).thenReturn(false);
+        subject.getAdView(1, mockView, null);
+
+        verify(mockImpressionTracker).addView(mockView, stubNativeResponse);
+        verify(stubNativeResponse).prepare(mockView);
+    }
+
+    @Test
+    public void destroy_shouldClearAdSource_shouldDestroyImpressionTracker_shouldResetPlacementData() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+
+        subject = new MoPubStreamAdPlacer(context,
+                mockAdSource, mockImpressionTracker, mockPositioningSource);
+        subject.handlePositioningLoad(positioning);
+        subject.handleAdsAvailable();
+        subject.setItemCount(2);  // Places 1 ad
+
+        subject.destroy();
+
+        verify(mockAdSource).clear();
+        verify(mockImpressionTracker).destroy();
+        verify(stubNativeResponse).destroy();
+    }
+
+    @Test
+    public void modifyClientPositioning_afterConstructingAdPlacer_shouldNotModifyAdPositions() {
+        when(mockAdSource.dequeueAd()).thenReturn(stubNativeResponse);
+        subject.handlePositioningLoad(positioning);
+        positioning.enableRepeatingPositions(5);
+
+        subject.handleAdsAvailable();
+        subject.setItemCount(4);
+        checkAdPositions(1, 3, 5);
+    }
+
+    void checkAdPositions(Integer... positions) {
+        List<Integer> expected = Arrays.asList(positions);
+        List<Integer> actual = new ArrayList<Integer>();
+        for (int i = 0; i < 20; i++) {
+            if (subject.isAd(i)) {
+                actual.add(i);
+                assertThat(subject.getAdData(i)).isNotNull();
+            } else {
+                assertThat(subject.getAdData(i)).isNull();
+            }
+        }
+
+        assertThat(actual).isEqualTo(expected);
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeAdSourceTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeAdSourceTest.java
new file mode 100644
index 00000000..36bebe63
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeAdSourceTest.java
@@ -0,0 +1,327 @@
+package com.mopub.nativeads;
+
+import android.os.Handler;
+import android.os.SystemClock;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.robolectric.shadows.ShadowSystemClock;
+
+import java.util.ArrayList;
+
+import static com.mopub.nativeads.NativeAdSource.AdSourceListener;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.anyLong;
+import static org.mockito.Matchers.eq;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.verify;
+
+@RunWith(SdkTestRunner.class)
+public class NativeAdSourceTest {
+    private NativeAdSource subject;
+    private ArrayList<TimestampWrapper<NativeResponse>> nativeAdCache;
+    private RequestParameters requestParameters;
+    private int defaultRetryTime;
+    private int maxRetryTime;
+
+    @Mock private AdSourceListener mockAdSourceListener;
+    @Mock private MoPubNative mockMoPubNative;
+    @Mock private NativeResponse mockNativeResponse;
+    @Mock private Handler mockReplenishCacheHandler;
+
+    @Before
+    public void setUp() {
+        nativeAdCache = new ArrayList<TimestampWrapper<NativeResponse>>(2);
+        subject = new NativeAdSource(nativeAdCache, mockReplenishCacheHandler);
+        subject.setAdSourceListener(mockAdSourceListener);
+
+        requestParameters = new RequestParameters.Builder().build();
+
+        defaultRetryTime = 1000;
+        maxRetryTime = 5*60*1000;
+
+        // XXX We need this to ensure that our SystemClock starts
+        ShadowSystemClock.uptimeMillis();
+    }
+
+    @Test
+    public void constructor_shouldInitializeCorrectly() {
+        assertThat(subject.mRequestInFlight).isFalse();
+        assertThat(subject.mSequenceNumber).isEqualTo(0);
+        assertThat(subject.mRetryTimeMilliseconds).isEqualTo(defaultRetryTime);
+    }
+
+    @Test
+    public void loadAds_shouldReplenishCache() {
+        subject.loadAds(requestParameters, mockMoPubNative);
+        assertThat(subject.mRequestInFlight).isTrue();
+        verify(mockMoPubNative).loadNativeAd(requestParameters, 0);
+    }
+
+    @Test
+    public void loadAds_shouldClearNativeAdSource() {
+        subject.setMoPubNative(mockMoPubNative);
+        TimestampWrapper<NativeResponse> timestampWrapper =
+                new TimestampWrapper<NativeResponse>(mock(NativeResponse.class));
+        nativeAdCache.add(timestampWrapper);
+        subject.mRequestInFlight = true;
+        subject.mSequenceNumber = 5;
+        subject.mRetryTimeMilliseconds = maxRetryTime;
+
+        subject.loadAds(requestParameters, mockMoPubNative);
+
+        verify(timestampWrapper.mInstance).destroy();
+        assertThat(nativeAdCache).isEmpty();
+        verify(mockMoPubNative).destroy();
+        verify(mockReplenishCacheHandler).removeMessages(0);
+        assertThat(subject.mSequenceNumber).isEqualTo(0);
+        assertThat(subject.mRetryTimeMilliseconds).isEqualTo(defaultRetryTime);
+
+        // new request has been kicked off
+        assertThat(subject.mRequestInFlight).isTrue();
+    }
+
+    @Test
+    public void loadAds_shouldDestroyPreviousMoPubNativeInstance() {
+        subject.loadAds(requestParameters, mockMoPubNative);
+        verify(mockMoPubNative, never()).destroy();
+
+        subject.loadAds(requestParameters, mockMoPubNative);
+        verify(mockMoPubNative).destroy();
+    }
+
+    @Test
+    public void clear_shouldDestroyMoPubNative_shouldClearNativeAdCache_shouldRemovePollHandlerMessages_shouldResetSequenceNumber_shouldResetRequestInFlight_shouldResetRetryTime() {
+        subject.setMoPubNative(mockMoPubNative);
+        TimestampWrapper<NativeResponse> timestampWrapper = new TimestampWrapper<NativeResponse>(mock(NativeResponse.class));
+        nativeAdCache.add(timestampWrapper);
+        subject.mRequestInFlight = true;
+        subject.mSequenceNumber = 5;
+        subject.mRetryTimeMilliseconds = maxRetryTime;
+
+        subject.clear();
+
+        verify(timestampWrapper.mInstance).destroy();
+        assertThat(nativeAdCache).isEmpty();
+        verify(mockMoPubNative).destroy();
+        verify(mockReplenishCacheHandler).removeMessages(0);
+        assertThat(subject.mRequestInFlight).isFalse();
+        assertThat(subject.mSequenceNumber).isEqualTo(0);
+        assertThat(subject.mRetryTimeMilliseconds).isEqualTo(defaultRetryTime);
+    }
+
+    @Test
+    public void dequeueAd_withNonStaleResponse_shouldReturnNativeResponse() {
+        subject.setMoPubNative(mockMoPubNative);
+        nativeAdCache.add(new TimestampWrapper<NativeResponse>(mockNativeResponse));
+
+        assertThat(subject.dequeueAd()).isEqualTo(mockNativeResponse);
+        assertThat(nativeAdCache).isEmpty();
+    }
+
+    @Test
+    public void dequeueAd_withStaleResponse_shouldReturnNativeResponse() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        TimestampWrapper<NativeResponse> timestampWrapper = new TimestampWrapper<NativeResponse>(
+                mockNativeResponse);
+        timestampWrapper.mCreatedTimestamp = SystemClock.uptimeMillis() - (15*60*1000+1);
+        nativeAdCache.add(timestampWrapper);
+
+        assertThat(subject.dequeueAd()).isNull();
+        assertThat(nativeAdCache).isEmpty();
+    }
+
+    @Test
+    public void dequeueAd_noRequestInFlight_shouldReplenishCache() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        nativeAdCache.add(new TimestampWrapper<NativeResponse>(mockNativeResponse));
+
+        assertThat(subject.dequeueAd()).isEqualTo(mockNativeResponse);
+
+        assertThat(nativeAdCache).isEmpty();
+        verify(mockReplenishCacheHandler).post(any(Runnable.class));
+    }
+
+    @Test
+    public void dequeueAd_requestInFlight_shouldNotReplenishCache() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        nativeAdCache.add(new TimestampWrapper<NativeResponse>(mockNativeResponse));
+
+        subject.mRequestInFlight = true;
+        assertThat(subject.dequeueAd()).isEqualTo(mockNativeResponse);
+
+        assertThat(nativeAdCache).isEmpty();
+        verify(mockReplenishCacheHandler, never()).post(any(Runnable.class));
+    }
+
+    @Test
+    public void updateRetryTime_shouldUpdateRetryTimeUntilAt10Minutes() {
+        int retryTime = 0;
+        while (subject.mRetryTimeMilliseconds < maxRetryTime) {
+            subject.updateRetryTime();
+            retryTime = subject.mRetryTimeMilliseconds;
+        }
+
+        assertThat(retryTime).isEqualTo(maxRetryTime);
+
+        // assert it won't change anymore
+        subject.updateRetryTime();
+        assertThat(retryTime).isEqualTo(subject.mRetryTimeMilliseconds);
+    }
+
+    @Test
+    public void resetRetryTime_shouldSetRetryTimeTo1Second() {
+        assertThat(subject.mRetryTimeMilliseconds).isEqualTo(defaultRetryTime);
+
+        subject.updateRetryTime();
+        assertThat(subject.mRetryTimeMilliseconds).isGreaterThan(defaultRetryTime);
+
+        subject.resetRetryTime();
+        assertThat(subject.mRetryTimeMilliseconds).isEqualTo(defaultRetryTime);
+    }
+
+    @Test
+    public void replenishCache_shouldLoadNativeAd_shouldMarkRequestInFlight() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        subject.replenishCache();
+
+        verify(mockMoPubNative).loadNativeAd(any(RequestParameters.class), eq(0));
+        assertThat(subject.mRequestInFlight).isTrue();
+    }
+
+    @Test
+    public void replenishCache_withRequestInFlight_shouldNotLoadNativeAd() {
+        subject.mRequestInFlight = true;
+        subject.setMoPubNative(mockMoPubNative);
+
+        subject.replenishCache();
+
+        verify(mockMoPubNative, never()).loadNativeAd(requestParameters, 0);
+        assertThat(subject.mRequestInFlight).isTrue();
+    }
+
+    @Test
+    public void replenishCache_withCacheSizeAtLimit_shouldNotLoadNativeAd() {
+        // Default cache size may change in the future and this test will have to be updated
+        nativeAdCache.add(mock(TimestampWrapper.class));
+        nativeAdCache.add(mock(TimestampWrapper.class));
+        nativeAdCache.add(mock(TimestampWrapper.class));
+
+        subject.setMoPubNative(mockMoPubNative);
+
+        subject.replenishCache();
+
+        verify(mockMoPubNative, never()).loadNativeAd(any(RequestParameters.class), any(Integer.class));
+        assertThat(subject.mRequestInFlight).isFalse();
+    }
+
+    @Test
+    public void moPubNativeNetworkListener_onNativeLoad_shouldAddToCache() {
+        subject.setMoPubNative(mockMoPubNative);
+        subject.getMoPubNativeNetworkListener().onNativeLoad(mockNativeResponse);
+
+        assertThat(nativeAdCache).hasSize(1);
+        assertThat(nativeAdCache.get(0).mInstance).isEqualTo(mockNativeResponse);
+    }
+
+    @Test
+    public void moPubNativeNetworkListener_onNativeLoad_withEmptyCache_shouldCallOnAdsAvailable() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        assertThat(nativeAdCache).isEmpty();
+        subject.getMoPubNativeNetworkListener().onNativeLoad(mockNativeResponse);
+
+        assertThat(nativeAdCache).hasSize(1);
+        verify(mockAdSourceListener).onAdsAvailable();
+    }
+
+    @Test
+    public void moPubNativeNetworkListener_onNativeLoad_withNonEmptyCache_shouldNotCallOnAdsAvailable() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        nativeAdCache.add(mock(TimestampWrapper.class));
+        subject.getMoPubNativeNetworkListener().onNativeLoad(mockNativeResponse);
+
+        assertThat(nativeAdCache).hasSize(2);
+        verify(mockAdSourceListener, never()).onAdsAvailable();
+    }
+
+    @Test
+    public void moPubNativeNetworkListener_onNativeLoad_shouldIncrementSequenceNumber_shouldResetRetryTime() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        subject.mRetryTimeMilliseconds = maxRetryTime;
+        subject.mSequenceNumber = 5;
+
+        subject.getMoPubNativeNetworkListener().onNativeLoad(mockNativeResponse);
+
+        assertThat(subject.mRetryTimeMilliseconds).isEqualTo(defaultRetryTime);
+        assertThat(subject.mSequenceNumber).isEqualTo(6);
+    }
+
+    @Test
+    public void moPubNativeNetworkListener_onNativeLoad_withFullCache_shouldResetRequestInFlight() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        subject.mRequestInFlight = true;
+
+        // fill cache
+        nativeAdCache.add(mock(TimestampWrapper.class));
+        nativeAdCache.add(mock(TimestampWrapper.class));
+        nativeAdCache.add(mock(TimestampWrapper.class));
+
+        subject.getMoPubNativeNetworkListener().onNativeLoad(mockNativeResponse);
+
+        assertThat(subject.mRequestInFlight).isEqualTo(false);
+    }
+
+    @Test
+    public void moPubNativeNetworkListener_onNativeLoad_withNonFullCache_shouldReplenishCache() {
+        subject.setMoPubNative(mockMoPubNative);
+
+        subject.mRequestInFlight = true;
+
+        subject.getMoPubNativeNetworkListener().onNativeLoad(mockNativeResponse);
+
+        assertThat(subject.mRequestInFlight).isEqualTo(true);
+        verify(mockMoPubNative).loadNativeAd(any(RequestParameters.class), eq(1));
+    }
+
+    @Test
+    public void
+    moPubNativeNetworkListener_onNativeFail_shouldResetInFlight_shouldUpdateRetryTime_shouldPostDelayedRunnable() {
+        subject.mRequestInFlight = true;
+        subject.mRetryTimeMilliseconds = defaultRetryTime;
+
+        subject.getMoPubNativeNetworkListener().onNativeFail(NativeErrorCode.UNSPECIFIED);
+
+        assertThat(subject.mRequestInFlight).isEqualTo(false);
+        assertThat(subject.mRetryInFlight).isEqualTo(true);
+        assertThat(subject.mRetryTimeMilliseconds).isGreaterThan(defaultRetryTime);
+        verify(mockReplenishCacheHandler).postDelayed(any(Runnable.class), eq((long)subject.mRetryTimeMilliseconds));
+    }
+
+    @Test
+    public void
+    moPubNativeNetworkListener_onNativeFail_maxRetryTime_shouldResetInflight_shouldResetRetryTime_shouldNotPostDelayedRunnable() {
+        subject.mRequestInFlight = true;
+        subject.mRetryTimeMilliseconds = maxRetryTime;
+
+        subject.getMoPubNativeNetworkListener().onNativeFail(NativeErrorCode.UNSPECIFIED);
+
+        assertThat(subject.mRequestInFlight).isEqualTo(false);
+        assertThat(subject.mRetryInFlight).isEqualTo(false);
+        assertThat(subject.mRetryTimeMilliseconds).isEqualTo(defaultRetryTime);
+        verify(mockReplenishCacheHandler, never()).postDelayed(any(Runnable.class), anyLong());
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeAdViewHelperTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeAdViewHelperTest.java
index ad1e8d90..4d4b3e9f 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeAdViewHelperTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeAdViewHelperTest.java
@@ -4,40 +4,39 @@
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.Button;
-import android.widget.ImageView;
 import android.widget.LinearLayout;
 import android.widget.RelativeLayout;
 import android.widget.TextView;
 
-import com.mopub.common.DownloadResponse;
-import com.mopub.common.util.ResponseHeader;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Utils;
-import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
-import com.mopub.nativeads.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.robolectric.Robolectric;
+import org.mockito.Mock;
 
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener;
-import static com.mopub.nativeads.NativeAdViewHelper.NativeViewClickListener;
 import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.mock;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
 public class NativeAdViewHelperTest {
     private Activity context;
     private RelativeLayout relativeLayout;
     private ViewGroup viewGroup;
-    private NativeResponse nativeResponse;
     private BaseForwardingNativeAd mNativeAd;
     private ViewBinder viewBinder;
     private TextView titleView;
     private TextView textView;
     private TextView callToActionView;
-    private ImageView mainImageView;
-    private ImageView iconImageView;
+
+    @Mock private NativeResponse mockNativeResponse1;
+    @Mock private NativeResponse mockNativeResponse2;
+    @Mock private ImpressionTracker mockImpressionTracker;
 
     @Before
     public void setUp() throws Exception {
@@ -47,11 +46,9 @@ public void setUp() throws Exception {
         viewGroup = new LinearLayout(context);
 
         mNativeAd = new BaseForwardingNativeAd() {};
-        mNativeAd.setClickDestinationUrl("destinationUrl");
-        final TestHttpResponseWithHeaders testHttpResponseWithHeaders = new TestHttpResponseWithHeaders(200, "");
-        testHttpResponseWithHeaders.addHeader(ResponseHeader.CLICKTHROUGH_URL.getKey(), "clickTrackerUrl");
-        final DownloadResponse downloadResponse = new DownloadResponse(testHttpResponseWithHeaders);
-        nativeResponse = new NativeResponse(context, downloadResponse, mNativeAd, mock(MoPubNativeListener.class));
+        mNativeAd.setTitle("test title");
+        mNativeAd.setText("test text");
+        mNativeAd.setCallToAction("test call to action");
 
         titleView = new TextView(context);
         titleView.setId((int) Utils.generateUniqueId());
@@ -59,108 +56,98 @@ public void setUp() throws Exception {
         textView.setId((int) Utils.generateUniqueId());
         callToActionView = new Button(context);
         callToActionView.setId((int) Utils.generateUniqueId());
-        mainImageView = new ImageView(context);
-        mainImageView.setId((int) Utils.generateUniqueId());
-        iconImageView = new ImageView(context);
-        iconImageView.setId((int) Utils.generateUniqueId());
 
         relativeLayout.addView(titleView);
         relativeLayout.addView(textView);
         relativeLayout.addView(callToActionView);
-        relativeLayout.addView(mainImageView);
-        relativeLayout.addView(iconImageView);
 
         viewBinder = new ViewBinder.Builder(relativeLayout.getId())
                 .titleId(titleView.getId())
                 .textId(textView.getId())
                 .callToActionId(callToActionView.getId())
-                .mainImageId(mainImageView.getId())
-                .iconImageId(iconImageView.getId())
                 .build();
-    }
 
-    @Test
-    public void getAdView_whenCallToActionIsAButton_shouldAttachClickListenersToConvertViewAndCtaButton() throws Exception {
-        assertThat(relativeLayout.performClick()).isFalse();
-        assertThat(callToActionView.performClick()).isFalse();
-        NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, nativeResponse, viewBinder, null);
-        assertThat(relativeLayout.performClick()).isTrue();
-        assertThat(callToActionView.performClick()).isTrue();
+        when(mockNativeResponse1.isDestroyed()).thenReturn(false);
+        when(mockNativeResponse2.isDestroyed()).thenReturn(false);
     }
 
     @Test
-    public void getAdView_whenCallToActionIsATextView_shouldAttachClickListenersToConvertViewOnly() throws Exception {
-        relativeLayout.removeView(callToActionView);
-        callToActionView = new TextView(context);
-        callToActionView.setId((int) Utils.generateUniqueId());
-        relativeLayout.addView(callToActionView);
+    public void getAdView_shouldReturnPopulatedView() throws Exception {
+        when(mockNativeResponse1.getTitle()).thenReturn("test title");
+        when(mockNativeResponse1.getText()).thenReturn("test text");
+        when(mockNativeResponse1.getCallToAction()).thenReturn("test call to action");
 
-        assertThat(relativeLayout.performClick()).isFalse();
-        assertThat(callToActionView.performClick()).isFalse();
+        View view = NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse1, viewBinder, null);
 
-        NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, nativeResponse, viewBinder, null);
+        assertThat(((TextView)view.findViewById(titleView.getId())).getText()).isEqualTo("test title");
+        assertThat(((TextView)view.findViewById(textView.getId())).getText()).isEqualTo("test text");
+        assertThat(((TextView)view.findViewById(callToActionView.getId())).getText()).isEqualTo("test call to action");
 
-        assertThat(relativeLayout.performClick()).isTrue();
-        assertThat(callToActionView.performClick()).isFalse();
+        // not testing images due to testing complexity
     }
 
     @Test
-    public void getOrCreateNativeViewHolder_withNoViewHolder_shouldCreateNativeViewHolder() throws Exception {
-        assertThat(ImageViewService.getViewTag(relativeLayout)).isNull();
-        NativeAdViewHelper.getOrCreateNativeViewHolder(relativeLayout, viewBinder);
-        final NativeViewHolder nativeViewHolder = NativeViewHolder.fromViewBinder(relativeLayout, viewBinder);
-        compareNativeViewHolders(nativeViewHolder, (NativeViewHolder) ImageViewService.getViewTag(relativeLayout));
+    public void getAdView_withNullViewBinder_shouldReturnEmptyView() throws Exception {
+        View view = NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse1, null, null);
+
+        assertThat(view).isNotNull();
+        assertThat(view).isNotEqualTo(relativeLayout);
     }
 
     @Test
-    public void getOrCreateNativeViewHolder_whenViewTagHasOtherObject_shouldCreateNativeViewHolder() throws Exception {
-        assertThat(ImageViewService.getViewTag(relativeLayout)).isNull();
-        ImageViewService.setViewTag(relativeLayout, new Object());
-        NativeAdViewHelper.getOrCreateNativeViewHolder(relativeLayout, viewBinder);
-        final NativeViewHolder nativeViewHolder = NativeViewHolder.fromViewBinder(relativeLayout, viewBinder);
-        compareNativeViewHolders(nativeViewHolder, (NativeViewHolder) ImageViewService.getViewTag(relativeLayout));
+    public void getAdView_withNullNativeResponse_shouldReturnGONEConvertView() throws Exception {
+        View view = NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, null, viewBinder, null);
+
+        assertThat(view).isEqualTo(relativeLayout);
+        assertThat(view.getVisibility()).isEqualTo(View.GONE);
     }
 
     @Test
-    public void getOrCreateNativeViewHolder_whenViewTagHasNativeViewHolder_shouldNotCreateNativeViewHolder() throws Exception {
-        assertThat(ImageViewService.getViewTag(relativeLayout)).isNull();
-        final NativeViewHolder nativeViewHolder = NativeViewHolder.fromViewBinder(relativeLayout, viewBinder);
-        ImageViewService.setViewTag(relativeLayout, nativeViewHolder);
-        NativeAdViewHelper.getOrCreateNativeViewHolder(relativeLayout, viewBinder);
-        assertThat(ImageViewService.getViewTag(relativeLayout)).isEqualTo(nativeViewHolder);
-    }
+    public void getAdView_withDestroyedNativeResponse_shouldReturnGONEConvertView() throws Exception {
+        when(mockNativeResponse1.isDestroyed()).thenReturn(true);
+        View view = NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse1, viewBinder, null);
 
+        assertThat(view).isEqualTo(relativeLayout);
+        assertThat(view.getVisibility()).isEqualTo(View.GONE);
+    }
+    
     @Test
-    public void onClick_shouldQueueClickTrackerAndUrlResolutionTasks() throws Exception {
-        NativeViewClickListener nativeViewClickListener = new NativeViewClickListener(nativeResponse);
+    public void getAdView_shouldRemoveViewFromImpressionTracker_shouldClearPreviousNativeResponse() throws Exception {
+        NativeAdViewHelper.sImpressionTrackerMap.put(context, mockImpressionTracker);
 
-        Robolectric.getBackgroundScheduler().pause();
-        assertThat(Robolectric.getBackgroundScheduler().enqueuedTaskCount()).isEqualTo(0);
-        nativeViewClickListener.onClick(new View(context));
+        NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse1, viewBinder, null);
+        verify(mockImpressionTracker).removeView(relativeLayout);
 
-        assertThat(Robolectric.getBackgroundScheduler().enqueuedTaskCount()).isEqualTo(2);
+        // Second call should clear the first NativeResponse
+        NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse2, viewBinder, null);
+        verify(mockImpressionTracker, times(2)).removeView(relativeLayout);
+        verify(mockNativeResponse1).clear(relativeLayout);
+
+        // Third call should clear the second NativeResponse
+        NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse1, viewBinder, null);
+        verify(mockImpressionTracker, times(3)).removeView(relativeLayout);
+        verify(mockNativeResponse2).clear(relativeLayout);
     }
 
     @Test
-    public void onClick_withNullDestinationUrl_shouldNotQueueUrlResolutionTask() throws Exception {
-        mNativeAd.setClickDestinationUrl(null);
-
-        NativeViewClickListener nativeViewClickListener = new NativeViewClickListener(nativeResponse);
+    public void getAdView_withNetworkImpressionTracker_shouldNotAddViewToImpressionTracker_shouldPrepareNativeResponse() throws Exception {
+        NativeAdViewHelper.sImpressionTrackerMap.put(context, mockImpressionTracker);
+        when(mockNativeResponse1.isOverridingImpressionTracker()).thenReturn(true);
 
-        Robolectric.getBackgroundScheduler().pause();
-        assertThat(Robolectric.getBackgroundScheduler().enqueuedTaskCount()).isEqualTo(0);
-        nativeViewClickListener.onClick(new View(context));
+        NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse1, viewBinder, null);
 
-        // 1 task for async ping to click tracker
-        assertThat(Robolectric.getBackgroundScheduler().enqueuedTaskCount()).isEqualTo(1);
+        verify(mockImpressionTracker, never()).addView(any(View.class), any(NativeResponse.class));
+        verify(mockNativeResponse1).prepare(relativeLayout);
     }
 
-    static private void compareNativeViewHolders(final NativeViewHolder nativeViewHolder1,
-                                                 final NativeViewHolder nativeViewHolder2) {
-        assertThat(nativeViewHolder1.titleView).isEqualTo(nativeViewHolder2.titleView);
-        assertThat(nativeViewHolder1.textView).isEqualTo(nativeViewHolder2.textView);
-        assertThat(nativeViewHolder1.callToActionView).isEqualTo(nativeViewHolder2.callToActionView);
-        assertThat(nativeViewHolder1.mainImageView).isEqualTo(nativeViewHolder2.mainImageView);
-        assertThat(nativeViewHolder1.iconImageView).isEqualTo(nativeViewHolder2.iconImageView);
+    @Test
+    public void getAdView_withoutNetworkImpressionTracker_shouldAddViewToImpressionTracker_shouldPrepareNativeResponse() throws Exception {
+        NativeAdViewHelper.sImpressionTrackerMap.put(context, mockImpressionTracker);
+        when(mockNativeResponse1.isOverridingImpressionTracker()).thenReturn(false);
+
+        NativeAdViewHelper.getAdView(relativeLayout, viewGroup, context, mockNativeResponse1, viewBinder, null);
+
+        verify(mockImpressionTracker).addView(relativeLayout, mockNativeResponse1);
+        verify(mockNativeResponse1).prepare(relativeLayout);
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeResponseTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeResponseTest.java
index 2fe23230..a1cef1c5 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeResponseTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeResponseTest.java
@@ -3,14 +3,16 @@
 import android.app.Activity;
 import android.view.View;
 import android.view.ViewGroup;
+import android.widget.Button;
 import android.widget.LinearLayout;
+import android.widget.RelativeLayout;
 
 import com.mopub.common.DownloadResponse;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.ResponseHeader;
+import com.mopub.common.util.Utils;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
-import com.mopub.nativeads.test.support.SdkTestRunner;
 
-import org.junit.After;
 import org.junit.Before;
 import org.junit.Ignore;
 import org.junit.Test;
@@ -21,13 +23,14 @@
 import java.util.List;
 import java.util.Map;
 
-import static com.mopub.nativeads.ImpressionTrackingManager.NativeResponseWrapper;
-import static com.mopub.nativeads.MoPubNative.MoPubNativeListener.EMPTY_MOPUB_NATIVE_LISTENER;
+import static com.mopub.nativeads.MoPubNative.EMPTY_EVENT_LISTENER;
 import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
 public class NativeResponseTest {
@@ -77,54 +80,56 @@ public void handleClick(final View view) {
 
         moPubNativeListener = mock(MoPubNative.MoPubNativeListener.class);
 
-        subject = new NativeResponse(context, downloadResponse, mNativeAd, moPubNativeListener);
+        subject = new NativeResponse(context, downloadResponse, "adunit_id", mNativeAd, moPubNativeListener);
 
         mMockNativeAd = mock(NativeAdInterface.class);
-        subjectWMockBaseNativeAd = new NativeResponse(context, downloadResponse, mMockNativeAd, moPubNativeListener);
+        subjectWMockBaseNativeAd = new NativeResponse(context, downloadResponse, "adunit_id", mMockNativeAd, moPubNativeListener);
     }
 
-    @After
-    public void tearDown() throws Exception {
-        ImpressionTrackingManager.clearTracking();
+    @Test
+    public void constructor_shouldSetNativeEventListenerOnNativeAdInterface() {
+        reset(mMockNativeAd);
+        subject = new NativeResponse(context, downloadResponse, "adunit_id", mMockNativeAd, moPubNativeListener);
+        verify(mMockNativeAd).setNativeEventListener(any(BaseForwardingNativeAd.NativeEventListener.class));
     }
 
     @Test
-    public void getTitle_shouldReturnTitleFromBaseNativeAd() throws Exception {
+    public void getTitle_shouldReturnTitleFromBaseNativeAd() {
         assertThat(subject.getTitle()).isEqualTo("title");
     }
 
     @Test
-    public void getTitle_shouldReturnTextFromBaseNativeAd() throws Exception {
+    public void getTitle_shouldReturnTextFromBaseNativeAd() {
         assertThat(subject.getText()).isEqualTo("text");
     }
 
     @Test
-    public void getMainImageUrl_shouldReturnMainImageUrlFromBaseNativeAd() throws Exception {
+    public void getMainImageUrl_shouldReturnMainImageUrlFromBaseNativeAd() {
         assertThat(subject.getMainImageUrl()).isEqualTo("mainImageUrl");
     }
 
     @Test
-    public void getIconImageUrl_shouldReturnIconImageUrlFromBaseNativeAd() throws Exception {
+    public void getIconImageUrl_shouldReturnIconImageUrlFromBaseNativeAd() {
         assertThat(subject.getIconImageUrl()).isEqualTo("iconImageUrl");
     }
 
     @Test
-    public void getClickDestinationUrl_shouldReturnClickDestinationUrlFromBaseNativeAd() throws Exception {
+    public void getClickDestinationUrl_shouldReturnClickDestinationUrlFromBaseNativeAd() {
         assertThat(subject.getClickDestinationUrl()).isEqualTo("clickDestinationUrl");
     }
 
     @Test
-    public void getCallToAction_shouldReturnCallToActionFromBaseNativeAd() throws Exception {
+    public void getCallToAction_shouldReturnCallToActionFromBaseNativeAd() {
         assertThat(subject.getCallToAction()).isEqualTo("callToAction");
     }
 
     @Test
-    public void getExtra_shouldReturnExtraFromBaseNativeAd() throws Exception {
+    public void getExtra_shouldReturnExtraFromBaseNativeAd() {
         assertThat(subject.getExtra("extra")).isEqualTo("extraValue");
     }
 
     @Test
-    public void getExtras_shouldReturnCopyOfExtrasMapFromBaseNativeAd() throws Exception {
+    public void getExtras_shouldReturnCopyOfExtrasMapFromBaseNativeAd() {
         final Map<String, Object> extras = subject.getExtras();
         assertThat(extras.size()).isEqualTo(2);
         assertThat(extras.get("extra")).isEqualTo("extraValue");
@@ -133,65 +138,73 @@ public void getExtras_shouldReturnCopyOfExtrasMapFromBaseNativeAd() throws Excep
     }
 
     @Test
-    public void getImpressionTrackers_shouldReturnImpressionTrackersFromMoPubAndFromBaseNativeAd() throws Exception {
+    public void getImpressionTrackers_shouldReturnImpressionTrackersFromMoPubAndFromBaseNativeAd() {
         final List<String> impressionTrackers = subject.getImpressionTrackers();
         assertThat(impressionTrackers).containsOnly("moPubImpressionTrackerUrl", "impressionUrl");
     }
 
     @Test
-    public void getImpressionMinTimeViewed_shouldReturnImpressionMinTimeViewedFromBaseNativeAd() throws Exception {
+    public void getImpressionMinTimeViewed_shouldReturnImpressionMinTimeViewedFromBaseNativeAd() {
         assertThat(subject.getImpressionMinTimeViewed()).isEqualTo(500);
     }
 
     @Test
-    public void getImpressionMinPercentageViewed_shouldReturnImpressionMinPercentageViewedFromBaseNativeAd() throws Exception {
+    public void getImpressionMinPercentageViewed_shouldReturnImpressionMinPercentageViewedFromBaseNativeAd() {
         assertThat(subject.getImpressionMinPercentageViewed()).isEqualTo(50);
     }
 
     @Test
-    public void getClickTracker_shouldReturnMoPubClickTracker() throws Exception {
+    public void getClickTracker_shouldReturnMoPubClickTracker() {
         assertThat(subject.getClickTracker()).isEqualTo("moPubClickTrackerUrl");
     }
-    
-    @Test
-    public void prepareImpression_shouldAddViewAndResponseToImpressionTrackingManagerAndCallPrepareImpressionOnBaseNativeAd() throws Exception {
-        View view = ImpressionTrackingManagerTest.getViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
-
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        subjectWMockBaseNativeAd.prepareImpression(view);
-        final Map<View, NativeResponseWrapper> keptViews = ImpressionTrackingManager.getPollingViews();
-        assertThat(keptViews.size()).isEqualTo(1);
-        assertThat(keptViews.get(view).mNativeResponse).isSameAs(subjectWMockBaseNativeAd);
 
-        verify(mMockNativeAd).prepareImpression(view);
+    @Test
+    public void prepare_shouldCallPrepareOnBaseNativeAd() {
+        subjectWMockBaseNativeAd.prepare(view);
+        verify(mMockNativeAd).prepare(view);
     }
 
     @Test
-    public void prepareImpression_whenDestroyed_shouldReturnFast() throws Exception {
+    public void prepare_whenDestroyed_shouldReturnFast() {
         subjectWMockBaseNativeAd.destroy();
-        assertThat(subjectWMockBaseNativeAd.isDestroyed()).isTrue();
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-
-        subjectWMockBaseNativeAd.prepareImpression(view);
+        subjectWMockBaseNativeAd.prepare(view);
+        verify(mMockNativeAd, never()).prepare(view);
+    }
+    
+    @Test
+    public void prepare_withOverridingeClickTracker_shouldNotSetOnClickListener() throws Exception {
+        when(mMockNativeAd.isOverridingClickTracker()).thenReturn(true);
+        View view = mock(View.class);
+        subjectWMockBaseNativeAd.prepare(view);
+        verify(view, never()).setOnClickListener(any(NativeResponse.NativeViewClickListener.class));
+    }
 
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        verify(mMockNativeAd, never()).prepareImpression(view);
+    @Test
+    public void prepare_withoutOverridingClickTracker_shouldSetOnClickListener() throws Exception {
+        when(mMockNativeAd.isOverridingClickTracker()).thenReturn(false);
+        View view = mock(View.class);
+        subjectWMockBaseNativeAd.prepare(view);
+        verify(view).setOnClickListener(any(NativeResponse.NativeViewClickListener.class));
     }
 
     @Test
-    public void prepareImpression_whenAlreadyImpressed_shouldReturnFast() throws Exception {
-        subjectWMockBaseNativeAd.setRecordedImpression(true);
-        assertThat(subjectWMockBaseNativeAd.getRecordedImpression()).isTrue();
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
+    public void prepare_shouldAttachClickListenersToViewTree() {
+        RelativeLayout relativeLayout = new RelativeLayout(context);
+        Button callToActionView = new Button(context);
+        callToActionView.setId((int) Utils.generateUniqueId());
+        relativeLayout.addView(callToActionView);
+
+        assertThat(relativeLayout.performClick()).isFalse();
+        assertThat(callToActionView.performClick()).isFalse();
 
-        subjectWMockBaseNativeAd.prepareImpression(view);
+        subject.prepare(relativeLayout);
 
-        assertThat(ImpressionTrackingManager.getPollingViews()).isEmpty();
-        verify(mMockNativeAd, never()).prepareImpression(view);
+        assertThat(relativeLayout.performClick()).isTrue();
+        assertThat(callToActionView.performClick()).isTrue();
     }
 
     @Test
-    public void recordImpression_shouldRecordImpressionsAndCallIntoBaseNativeAdAndNotifyListenerIdempotently() throws Exception {
+    public void recordImpression_shouldRecordImpressionsAndCallIntoBaseNativeAdAndNotifyListenerIdempotently() {
         Robolectric.getFakeHttpLayer().addPendingHttpResponse(200, "ok");
         Robolectric.getFakeHttpLayer().addPendingHttpResponse(200, "ok");
         assertThat(subject.getRecordedImpression()).isFalse();
@@ -222,7 +235,7 @@ public void recordImpression_shouldRecordImpressionsAndCallIntoBaseNativeAdAndNo
     }
 
     @Test
-    public void recordImpression_whenDestroyed_shouldReturnFast() throws Exception {
+    public void recordImpression_whenDestroyed_shouldReturnFast() {
         subject.destroy();
         subject.recordImpression(view);
         assertThat(subject.getRecordedImpression()).isFalse();
@@ -232,7 +245,7 @@ public void recordImpression_whenDestroyed_shouldReturnFast() throws Exception {
     }
 
     @Test
-    public void handleClick_withNoBaseNativeAdClickDestinationUrl_shouldRecordClickAndCallIntoBaseNativeAdAndNotifyListener() throws Exception {
+    public void handleClick_withNoBaseNativeAdClickDestinationUrl_shouldRecordClickAndCallIntoBaseNativeAdAndNotifyListener() {
         Robolectric.getFakeHttpLayer().addPendingHttpResponse(200, "ok");
         assertThat(subject.isClicked()).isFalse();
 
@@ -262,12 +275,12 @@ public void handleClick_withNoBaseNativeAdClickDestinationUrl_shouldRecordClickA
 
     @Ignore("pending")
     @Test
-    public void handleClick_withBaseNativeAdClickDestinationUrl_shouldRecordClickAndCallIntoBaseNativeAdAndOpenClickDestinationAndNotifyListener() throws Exception {
+    public void handleClick_withBaseNativeAdClickDestinationUrl_shouldRecordClickAndCallIntoBaseNativeAdAndOpenClickDestinationAndNotifyListener() {
         // Really difficult to test url resolution since it doesn't use the apache http client
     }
 
     @Test
-    public void handleClick_whenDestroyed_shouldReturnFast() throws Exception {
+    public void handleClick_whenDestroyed_shouldReturnFast() {
         subject.destroy();
         subject.handleClick(view);
         assertThat(subject.isClicked()).isFalse();
@@ -277,7 +290,7 @@ public void handleClick_whenDestroyed_shouldReturnFast() throws Exception {
     }
 
     @Test
-    public void destroy_shouldCallIntoBaseNativeAd() throws Exception {
+    public void destroy_shouldCallIntoBaseNativeAd() {
         subjectWMockBaseNativeAd.destroy();
         assertThat(subjectWMockBaseNativeAd.isDestroyed()).isTrue();
         verify(mMockNativeAd).destroy();
@@ -289,17 +302,28 @@ public void destroy_shouldCallIntoBaseNativeAd() throws Exception {
     }
 
     @Test
-    public void destroy_shouldSetMoPubNativeListenerToEmptyMoPubNativeListener() throws Exception {
-        assertThat(subjectWMockBaseNativeAd.getMoPubNativeListener()).isSameAs(moPubNativeListener);
+    public void destroy_shouldSetMoPubNativeEventListenerToEmptyMoPubNativeListener() {
+        assertThat(subjectWMockBaseNativeAd.getMoPubNativeEventListener()).isSameAs(moPubNativeListener);
 
         subjectWMockBaseNativeAd.destroy();
 
-        assertThat(subjectWMockBaseNativeAd.getMoPubNativeListener()).isSameAs(EMPTY_MOPUB_NATIVE_LISTENER);
+        assertThat(subjectWMockBaseNativeAd.getMoPubNativeEventListener()).isSameAs(EMPTY_EVENT_LISTENER);
+    }
+
+    // NativeViewClickListener tests
+    @Test
+    public void NativeViewClickListener_onClick_shouldQueueClickTrackerAndUrlResolutionTasks() {
+        subject = mock(NativeResponse.class);
+        NativeResponse.NativeViewClickListener nativeViewClickListener = subject.new NativeViewClickListener();
+
+        View view = new View(context);
+        nativeViewClickListener.onClick(view);
+        verify(subject).handleClick(view);
     }
 
     @Ignore("pending")
     @Test
-    public void loadExtrasImage_shouldAsyncLoadImages() throws Exception {
+    public void loadExtrasImage_shouldAsyncLoadImages() {
         // no easy way to test this since nothing can be mocked
         // also not a critical test since it directly calls another service
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java
index 86deaa9f..5d96c9b0 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java
@@ -1,33 +1,43 @@
 package com.mopub.nativeads;
 
 import android.app.Activity;
+import android.content.Context;
 import android.net.Uri;
+import android.telephony.TelephonyManager;
+import android.text.TextUtils;
 
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.common.MoPub;
+import com.mopub.mobileads.test.support.MoPubShadowTelephonyManager;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.robolectric.annotation.Config;
 
-import java.util.EnumSet;
-import java.util.List;
 import java.util.ArrayList;
 import java.util.Arrays;
-import java.util.HashSet;
+import java.util.EnumSet;
+import java.util.List;
 
 import static android.Manifest.permission.ACCESS_NETWORK_STATE;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
+@Config(shadows = {MoPubShadowTelephonyManager.class})
 public class NativeUrlGeneratorTest {
+    public static final String AD_UNIT_ID = "1234";
     private Activity context;
     private NativeUrlGenerator subject;
+    private MoPubShadowTelephonyManager shadowTelephonyManager;
 
     @Before
     public void setup() {
         context = new Activity();
         shadowOf(context).grantPermissions(ACCESS_NETWORK_STATE);
+        shadowTelephonyManager = (MoPubShadowTelephonyManager)
+                shadowOf((TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE));
     }
 
     @Test
@@ -35,7 +45,7 @@ public void generateNativeAdUrl_shouldIncludeDesiredAssetIfSet() throws Exceptio
         EnumSet<RequestParameters.NativeAdAsset> assetsSet = EnumSet.of(RequestParameters.NativeAdAsset.TITLE);
         RequestParameters requestParameters = new RequestParameters.Builder().desiredAssets(assetsSet).build();
 
-        subject = new NativeUrlGenerator(context).withAdUnitId("1234").withRequest(requestParameters);
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID).withRequest(requestParameters);
 
         String requestString = generateMinimumUrlString();
         List<String> desiredAssets = getDesiredAssetsListFromRequestUrlString(requestString);
@@ -49,7 +59,7 @@ public void generateNativeAdUrl_shouldIncludeDesiredAssetsIfSet() throws Excepti
         EnumSet<RequestParameters.NativeAdAsset> assetsSet = EnumSet.of(RequestParameters.NativeAdAsset.TITLE, RequestParameters.NativeAdAsset.TEXT, RequestParameters.NativeAdAsset.ICON_IMAGE);
         RequestParameters requestParameters = new RequestParameters.Builder().desiredAssets(assetsSet).build();
 
-        subject = new NativeUrlGenerator(context).withAdUnitId("1234").withRequest(requestParameters);
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID).withRequest(requestParameters);
 
         String requestString = generateMinimumUrlString();
         List<String> desiredAssets = getDesiredAssetsListFromRequestUrlString(requestString);
@@ -60,7 +70,7 @@ public void generateNativeAdUrl_shouldIncludeDesiredAssetsIfSet() throws Excepti
 
     @Test
     public void generateNativeAdUrl_shouldNotIncludeDesiredAssetsIfNotSet() throws Exception {
-        subject = new NativeUrlGenerator(context).withAdUnitId("1234");
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
 
         String requestString = generateMinimumUrlString();
         List<String> desiredAssets = getDesiredAssetsListFromRequestUrlString(requestString);
@@ -73,7 +83,7 @@ public void generateNativeAdUrl_shouldNotIncludeDesiredAssetsIfNoAssetsAreSet()
         EnumSet<RequestParameters.NativeAdAsset> assetsSet = EnumSet.noneOf(RequestParameters.NativeAdAsset.class);
         RequestParameters requestParameters = new RequestParameters.Builder().desiredAssets(assetsSet).build();
 
-        subject = new NativeUrlGenerator(context).withAdUnitId("1234").withRequest(requestParameters);
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID).withRequest(requestParameters);
 
         String requestString = generateMinimumUrlString();
         List<String> desiredAssets = getDesiredAssetsListFromRequestUrlString(requestString);
@@ -81,6 +91,60 @@ public void generateNativeAdUrl_shouldNotIncludeDesiredAssetsIfNoAssetsAreSet()
         assertThat(desiredAssets.size()).isEqualTo(0);
     }
 
+    @Test
+    public void generateNativeAdUrl_needsButDoesNotHaveReadPhoneState_shouldNotContainOperatorName() {
+        shadowTelephonyManager.setNeedsReadPhoneState(true);
+        shadowTelephonyManager.setReadPhoneStatePermission(false);
+        shadowTelephonyManager.setNetworkOperatorName("TEST_CARRIER");
+
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+        String requestString = generateMinimumUrlString();
+
+        assertThat(getNetworkOperatorNameFromRequestUrl(requestString)).isNullOrEmpty();
+    }
+    
+    @Test
+    public void generateNativeAdUrl_needsAndHasReadPhoneState_shouldContainOperatorName() {
+        shadowTelephonyManager.setNeedsReadPhoneState(true);
+        shadowTelephonyManager.setReadPhoneStatePermission(true);
+        shadowTelephonyManager.setNetworkOperatorName("TEST_CARRIER");
+
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+        String requestString = generateMinimumUrlString();
+
+        assertThat(getNetworkOperatorNameFromRequestUrl(requestString)).isEqualTo("TEST_CARRIER");
+    }
+
+    @Test
+    public void generateNativeAdUrl_doesNotNeedReadPhoneState_shouldContainOperatorName() {
+        shadowTelephonyManager.setNeedsReadPhoneState(false);
+        shadowTelephonyManager.setReadPhoneStatePermission(false);
+        shadowTelephonyManager.setNetworkOperatorName("TEST_CARRIER");
+
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+        String requestString = generateMinimumUrlString();
+
+        assertThat(getNetworkOperatorNameFromRequestUrl(requestString)).isEqualTo("TEST_CARRIER");
+    }
+
+    @Test
+    public void enableLocation_shouldIncludeLocationInUrl() {
+        MoPub.setLocationAwareness(MoPub.LocationAwareness.NORMAL);
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+
+        String requestString = generateMinimumUrlString();
+        assertThat(getLocationFromRequestUrl(requestString)).isNotNull();
+    }
+
+    @Test
+    public void disableLocation_shouldNotIncludeLocationInUrl() {
+        MoPub.setLocationAwareness(MoPub.LocationAwareness.DISABLED);
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+
+        String requestString = generateMinimumUrlString();
+        assertThat(getLocationFromRequestUrl(requestString)).isNullOrEmpty();
+    }
+
     private List<String> getDesiredAssetsListFromRequestUrlString(String requestString) {
         Uri requestUri = Uri.parse(requestString);
 
@@ -88,6 +152,29 @@ public void generateNativeAdUrl_shouldNotIncludeDesiredAssetsIfNoAssetsAreSet()
         return (desiredAssetsString == null) ? new ArrayList<String>() : Arrays.asList(desiredAssetsString.split(","));
     }
 
+    private String getNetworkOperatorNameFromRequestUrl(String requestString) {
+        Uri requestUri = Uri.parse(requestString);
+
+        String networkOperatorName = requestUri.getQueryParameter("cn");
+
+        if (TextUtils.isEmpty(networkOperatorName)) {
+            return "";
+        }
+
+        return networkOperatorName;
+    }
+
+    private String getLocationFromRequestUrl(String requestString) {
+        Uri requestUri = Uri.parse(requestString);
+        String location = requestUri.getQueryParameter("ll");
+
+        if (TextUtils.isEmpty(location)) {
+            return "";
+        }
+
+        return location;
+    }
+
     private String generateMinimumUrlString() {
         return subject.generateUrlString("ads.mopub.com");
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeViewHolderTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeViewHolderTest.java
index 736c6da7..52e22017 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeViewHolderTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeViewHolderTest.java
@@ -2,6 +2,8 @@
 
 import android.app.Activity;
 import android.content.Context;
+import android.graphics.Bitmap;
+import android.graphics.BitmapFactory;
 import android.view.ViewGroup;
 import android.widget.Button;
 import android.widget.ImageView;
@@ -13,17 +15,20 @@
 import com.mopub.common.DownloadResponse;
 import com.mopub.common.util.Utils;
 import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
-import com.mopub.nativeads.test.support.SdkTestRunner;
+import com.mopub.nativeads.test.support.MoPubShadowBitmap;
+import com.mopub.common.test.support.SdkTestRunner;
 
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.robolectric.annotation.Config;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Mockito.mock;
 import static org.robolectric.Robolectric.shadowOf;
 
 @RunWith(SdkTestRunner.class)
+@Config(shadows={MoPubShadowBitmap.class})
 public class NativeViewHolderTest {
     private Context context;
     private RelativeLayout relativeLayout;
@@ -39,6 +44,16 @@
     private TextView extrasTextView;
     private ImageView extrasImageView;
     private ImageView extrasImageView2;
+    private String mainImageUrl;
+    private String iconImageUrl;
+    private String mainImageData;
+    private String iconImageData;
+    private Bitmap iconImage;
+    private Bitmap mainImage;
+    private String extrasImageData;
+    private String extrasImageData2;
+    private Bitmap extrasImage2;
+    private Bitmap extrasImage;
 
     @Before
     public void setUp() throws Exception {
@@ -75,6 +90,17 @@ public void setUp() throws Exception {
         relativeLayout.addView(extrasTextView);
         relativeLayout.addView(extrasImageView);
         relativeLayout.addView(extrasImageView2);
+
+        mainImageUrl = "mainimageurl";
+        iconImageUrl = "iconimageurl";
+        mainImageData = "mainimagedata";
+        iconImageData = "iconimagedata";
+        extrasImageData = "extrasimagedata";
+        extrasImageData2 = "extrasimagedata2";
+        iconImage = BitmapFactory.decodeByteArray(iconImageData.getBytes(), 0, iconImageData.getBytes().length);
+        mainImage = BitmapFactory.decodeByteArray(mainImageData.getBytes(), 0, mainImageData.getBytes().length);
+        extrasImage = BitmapFactory.decodeByteArray(extrasImageData.getBytes(), 0, extrasImageData.getBytes().length);
+        extrasImage2 = BitmapFactory.decodeByteArray(extrasImageData2.getBytes(), 0, extrasImageData2.getBytes().length);
     }
 
     @Test
@@ -137,9 +163,9 @@ public void fromViewBinder_withNonExistantIds_shouldLeaveFieldsNull() throws Exc
     @Test
     public void update_shouldAddValuesToViews() throws Exception {
         // Setup for cache state for image gets
-        CacheService.initializeCaches(context);
-        CacheService.putToMemoryCache("mainimageurl", "mainimagedata".getBytes());
-        CacheService.putToMemoryCache("iconimageurl", "iconimagedata".getBytes());
+        CacheService.initialize(context);
+        CacheService.putToBitmapCache(mainImageUrl, mainImage);
+        CacheService.putToBitmapCache(iconImageUrl, iconImage);
 
         BaseForwardingNativeAd nativeAd = new BaseForwardingNativeAd() {};
         nativeAd.setTitle("titletext");
@@ -149,7 +175,7 @@ public void update_shouldAddValuesToViews() throws Exception {
         nativeAd.setCallToAction("cta");
 
         final DownloadResponse downloadResponse = new DownloadResponse(new TestHttpResponseWithHeaders(200, ""));
-        nativeResponse = new NativeResponse(context, downloadResponse, nativeAd, null);
+        nativeResponse = new NativeResponse(context, downloadResponse, "adunit_id", nativeAd, null);
 
         viewBinder = new ViewBinder.Builder(relativeLayout.getId())
                 .titleId(titleView.getId())
@@ -168,9 +194,9 @@ public void update_shouldAddValuesToViews() throws Exception {
         assertThat(textView.getText()).isEqualTo("texttext");
         assertThat(callToActionView.getText()).isEqualTo("cta");
         assertThat(shadowOf(ImageViewServiceTest.getBitmapFromImageView(mainImageView))
-                .getCreatedFromBytes()).isEqualTo("mainimagedata".getBytes());
+                .getCreatedFromBytes()).isEqualTo(mainImageData.getBytes());
         assertThat(shadowOf(ImageViewServiceTest.getBitmapFromImageView(iconImageView))
-                .getCreatedFromBytes()).isEqualTo("iconimagedata".getBytes());
+                .getCreatedFromBytes()).isEqualTo(iconImageData.getBytes());
     }
 
     @Test
@@ -179,12 +205,12 @@ public void update_withMissingNativeResponseFields_shouldClearPreviousValues() t
         titleView.setText("previoustitletext");
         textView.setText("previoustexttext");
         callToActionView.setText("previousctatext");
-        mainImageView.setImageBitmap(ImageService.byteArrayToBitmap("previousmainimagedata".getBytes()));
-        iconImageView.setImageBitmap(ImageService.byteArrayToBitmap("previousiconimagedata".getBytes()));
+        mainImageView.setImageBitmap(BitmapFactory.decodeByteArray("previousmainimagedata".getBytes(), 0, "previousmainimagedata".getBytes().length));
+        iconImageView.setImageBitmap(BitmapFactory.decodeByteArray("previousiconimagedata".getBytes(), 0, "previousiconimagedata".getBytes().length));
 
         // Only required fields in native response
         final DownloadResponse downloadResponse = new DownloadResponse(new TestHttpResponseWithHeaders(200, ""));
-        nativeResponse = new NativeResponse(context, downloadResponse, mock(BaseForwardingNativeAd.class), null);
+        nativeResponse = new NativeResponse(context, downloadResponse, "adunit_id", mock(BaseForwardingNativeAd.class), null);
 
         viewBinder = new ViewBinder.Builder(relativeLayout.getId())
                 .titleId(titleView.getId())
@@ -215,7 +241,7 @@ public void update_withDifferentViewBinder_shouldNotClearPreviousValues() throws
         BaseForwardingNativeAd nativeAd = new BaseForwardingNativeAd() {};
         nativeAd.setCallToAction("cta");
         final DownloadResponse downloadResponse = new DownloadResponse(new TestHttpResponseWithHeaders(200, ""));
-        nativeResponse = new NativeResponse(context, downloadResponse, nativeAd, null);
+        nativeResponse = new NativeResponse(context, downloadResponse, "adunit_id", nativeAd, null);
 
         viewBinder = new ViewBinder.Builder(relativeLayout.getId())
                 .callToActionId(callToActionView.getId())
@@ -234,16 +260,16 @@ public void update_withDifferentViewBinder_shouldNotClearPreviousValues() throws
     @Test
     public void updateExtras_shouldAddValuesToViews() throws Exception {
         // Setup for cache state for image gets
-        CacheService.initializeCaches(context);
-        CacheService.putToMemoryCache("extrasimageurl", "extrasimagedata".getBytes());
-        CacheService.putToMemoryCache("extrasimageurl2", "extrasimagedata2".getBytes());
+        CacheService.initialize(context);
+        CacheService.putToBitmapCache("extrasimageurl", extrasImage);
+        CacheService.putToBitmapCache("extrasimageurl2", extrasImage2);
 
         BaseForwardingNativeAd nativeAd = new BaseForwardingNativeAd() {};
         nativeAd.addExtra("extrastext", "extrastexttext");
         nativeAd.addExtra("extrasimage", "extrasimageurl");
         nativeAd.addExtra("extrasimage2", "extrasimageurl2");
         final DownloadResponse downloadResponse = new DownloadResponse(new TestHttpResponseWithHeaders(200, ""));
-        nativeResponse = new NativeResponse(context, downloadResponse, nativeAd, null);
+        nativeResponse = new NativeResponse(context, downloadResponse, "adunit_id", nativeAd, null);
 
         viewBinder = new ViewBinder.Builder(relativeLayout.getId())
                 .addExtra("extrastext", extrasTextView.getId())
@@ -266,11 +292,11 @@ public void updateExtras_shouldAddValuesToViews() throws Exception {
     @Test
     public void updateExtras_withMissingExtrasValues_shouldClearPreviousValues() throws Exception {
         extrasTextView.setText("previousextrastext");
-        extrasImageView.setImageBitmap(ImageService.byteArrayToBitmap("previousextrasimagedata".getBytes()));
-        extrasImageView2.setImageBitmap(ImageService.byteArrayToBitmap("previousextrasimagedata2".getBytes()));
+        extrasImageView.setImageBitmap(BitmapFactory.decodeByteArray("previousextrasimagedata".getBytes(), 0, "previousextrasimagedata".getBytes().length));
+        extrasImageView2.setImageBitmap(BitmapFactory.decodeByteArray("previousextrasimagedata2".getBytes(), 0, "previousextrasimagedata2".getBytes().length));
 
         final DownloadResponse downloadResponse = new DownloadResponse(new TestHttpResponseWithHeaders(200, ""));
-        nativeResponse = new NativeResponse(context, downloadResponse, new BaseForwardingNativeAd(){}, null);
+        nativeResponse = new NativeResponse(context, downloadResponse, "adunit_id", new BaseForwardingNativeAd(){}, null);
 
         viewBinder = new ViewBinder.Builder(relativeLayout.getId())
                 .addExtra("extrastext", extrasTextView.getId())
@@ -301,7 +327,7 @@ public void updateExtras_withMismatchingViewTypes_shouldSetTextViewToImageUrlAnd
         nativeAd.addExtra("extrasimage", "extrasimageurl");
 
         final DownloadResponse downloadResponse = new DownloadResponse(new TestHttpResponseWithHeaders(200, ""));
-        nativeResponse = new NativeResponse(context, downloadResponse, nativeAd, null);
+        nativeResponse = new NativeResponse(context, downloadResponse, "adunit_id", nativeAd, null);
 
         viewBinder = new ViewBinder.Builder(relativeLayout.getId())
                 .addExtra("extrastext", extrasImageView.getId())
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/PlacementDataTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/PlacementDataTest.java
new file mode 100644
index 00000000..75de2550
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/PlacementDataTest.java
@@ -0,0 +1,845 @@
+
+
+package com.mopub.nativeads;
+
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.robolectric.annotation.Config;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.List;
+
+import static com.mopub.nativeads.PlacementData.NOT_FOUND;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
+@Config(manifest=Config.NONE)
+@RunWith(SdkTestRunner.class)
+public class PlacementDataTest {
+    private PlacementData noAds;
+    private PlacementData adAt0;
+    private PlacementData adAt1;
+    private PlacementData adsAt01;
+    private PlacementData adsAt1234;
+    private PlacementData adsAt14;
+    private PlacementData adsRepeating;
+    private PlacementData adsAt15repeating;
+
+    @Mock private NativeAdData mockNativeAdData;
+    @Mock private NativeAdData mockNativeAdData2;
+    @Mock private NativeAdData mockNativeAdData3;
+    @Mock private NativeAdData mockNativeAdData4;
+    @Mock private NativeResponse mockNativeResponse;
+    @Mock private NativeResponse mockNativeResponse2;
+    @Mock private NativeResponse mockNativeResponse3;
+    @Mock private NativeResponse mockNativeResponse4;
+
+    @Before
+    public void setup() {
+        noAds = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning());
+        adAt0 = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning()
+                .addFixedPosition(0));
+        adAt1 = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning()
+                .addFixedPosition(1));
+        adsAt01 = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning()
+                .addFixedPosition(0)
+                .addFixedPosition(1));
+        adsAt14 = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning()
+                .addFixedPosition(1)
+                .addFixedPosition(4));
+        adsRepeating = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning()
+                .enableRepeatingPositions(3));
+        adsAt15repeating = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning()
+                .addFixedPosition(1)
+                .addFixedPosition(5)
+                .enableRepeatingPositions(3));
+        adsAt1234 = PlacementData.fromAdPositioning(MoPubNativeAdPositioning.clientPositioning()
+                .addFixedPosition(1)
+                .addFixedPosition(2)
+                .addFixedPosition(3)
+                .addFixedPosition(4));
+
+        when(mockNativeAdData.getAd()).thenReturn(mockNativeResponse);
+        when(mockNativeAdData2.getAd()).thenReturn(mockNativeResponse2);
+        when(mockNativeAdData3.getAd()).thenReturn(mockNativeResponse3);
+        when(mockNativeAdData4.getAd()).thenReturn(mockNativeResponse4);
+    }
+
+    @Test
+    public void initialState_isDesired() {
+        assertThat(noAds.shouldPlaceAd(0)).isFalse();
+        assertThat(noAds.shouldPlaceAd(1)).isFalse();
+        assertThat(noAds.shouldPlaceAd(2)).isFalse();
+        assertThat(noAds.shouldPlaceAd(3)).isFalse();
+        assertThat(noAds.shouldPlaceAd(4)).isFalse();
+
+        assertThat(adAt0.shouldPlaceAd(0)).isTrue();
+        assertThat(adAt0.shouldPlaceAd(1)).isFalse();
+        assertThat(adAt0.shouldPlaceAd(2)).isFalse();
+        assertThat(adAt0.shouldPlaceAd(3)).isFalse();
+        assertThat(adAt0.shouldPlaceAd(4)).isFalse();
+
+        assertThat(adAt1.shouldPlaceAd(0)).isFalse();
+        assertThat(adAt1.shouldPlaceAd(1)).isTrue();
+        assertThat(adAt1.shouldPlaceAd(2)).isFalse();
+        assertThat(adAt1.shouldPlaceAd(3)).isFalse();
+        assertThat(adAt1.shouldPlaceAd(4)).isFalse();
+
+        assertThat(adsAt01.shouldPlaceAd(0)).isTrue();
+        assertThat(adsAt01.shouldPlaceAd(1)).isFalse();
+        assertThat(adsAt01.shouldPlaceAd(2)).isFalse();
+        assertThat(adsAt01.shouldPlaceAd(3)).isFalse();
+        assertThat(adsAt01.shouldPlaceAd(4)).isFalse();
+
+        assertThat(adsAt14.shouldPlaceAd(0)).isFalse();
+        assertThat(adsAt14.shouldPlaceAd(1)).isTrue();
+        assertThat(adsAt14.shouldPlaceAd(2)).isFalse();
+        assertThat(adsAt14.shouldPlaceAd(3)).isTrue();
+        assertThat(adsAt14.shouldPlaceAd(4)).isFalse();
+
+        assertThat(adsRepeating.shouldPlaceAd(0)).isFalse();
+        assertThat(adsRepeating.shouldPlaceAd(1)).isFalse();
+        assertThat(adsRepeating.shouldPlaceAd(2)).isTrue();
+        assertThat(adsRepeating.shouldPlaceAd(3)).isFalse();
+        assertThat(adsRepeating.shouldPlaceAd(4)).isTrue();
+        assertThat(adsRepeating.shouldPlaceAd(5)).isFalse();
+        assertThat(adsRepeating.shouldPlaceAd(6)).isTrue();
+
+        assertThat(adsAt15repeating.shouldPlaceAd(0)).isFalse();
+        assertThat(adsAt15repeating.shouldPlaceAd(1)).isTrue();
+        assertThat(adsAt15repeating.shouldPlaceAd(2)).isFalse();
+        assertThat(adsAt15repeating.shouldPlaceAd(3)).isFalse();
+        assertThat(adsAt15repeating.shouldPlaceAd(4)).isTrue();
+        assertThat(adsAt15repeating.shouldPlaceAd(5)).isFalse();
+        assertThat(adsAt15repeating.shouldPlaceAd(6)).isTrue();
+        assertThat(adsAt15repeating.shouldPlaceAd(7)).isFalse();
+        assertThat(adsAt15repeating.shouldPlaceAd(8)).isTrue();
+
+        assertThat(adsAt1234.shouldPlaceAd(0)).isFalse();
+        assertThat(adsAt1234.shouldPlaceAd(1)).isTrue();
+        assertThat(adsAt1234.shouldPlaceAd(2)).isFalse();
+        assertThat(adsAt1234.shouldPlaceAd(3)).isFalse();
+    }
+
+    @Test
+    public void initialState_nextInsertionPosition() {
+        assertThat(noAds.nextInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(noAds.nextInsertionPosition(1)).isEqualTo(NOT_FOUND);
+
+        assertThat(adAt0.nextInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adAt0.nextInsertionPosition(1)).isEqualTo(NOT_FOUND);
+
+        assertThat(adAt1.nextInsertionPosition(0)).isEqualTo(1);
+        assertThat(adAt1.nextInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adAt1.nextInsertionPosition(2)).isEqualTo(NOT_FOUND);
+
+        assertThat(adsAt01.nextInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt01.nextInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt01.nextInsertionPosition(2)).isEqualTo(NOT_FOUND);
+
+        assertThat(adsAt14.nextInsertionPosition(0)).isEqualTo(1);
+        assertThat(adsAt14.nextInsertionPosition(1)).isEqualTo(3);
+        assertThat(adsAt14.nextInsertionPosition(2)).isEqualTo(3);
+        assertThat(adsAt14.nextInsertionPosition(3)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt14.nextInsertionPosition(4)).isEqualTo(NOT_FOUND);
+
+        assertThat(adsRepeating.nextInsertionPosition(0)).isEqualTo(2);
+        assertThat(adsRepeating.nextInsertionPosition(1)).isEqualTo(2);
+        assertThat(adsRepeating.nextInsertionPosition(2)).isEqualTo(4);
+        assertThat(adsRepeating.nextInsertionPosition(3)).isEqualTo(4);
+        assertThat(adsRepeating.nextInsertionPosition(4)).isEqualTo(6);
+        assertThat(adsRepeating.nextInsertionPosition(5)).isEqualTo(6);
+        assertThat(adsRepeating.nextInsertionPosition(6)).isEqualTo(8);
+
+        assertThat(adsAt15repeating.nextInsertionPosition(0)).isEqualTo(1);
+        assertThat(adsAt15repeating.nextInsertionPosition(1)).isEqualTo(4);
+        assertThat(adsAt15repeating.nextInsertionPosition(2)).isEqualTo(4);
+        assertThat(adsAt15repeating.nextInsertionPosition(3)).isEqualTo(4);
+        assertThat(adsAt15repeating.nextInsertionPosition(4)).isEqualTo(6);
+        assertThat(adsAt15repeating.nextInsertionPosition(5)).isEqualTo(6);
+        assertThat(adsAt15repeating.nextInsertionPosition(6)).isEqualTo(8);
+        assertThat(adsAt15repeating.nextInsertionPosition(7)).isEqualTo(8);
+        assertThat(adsAt15repeating.nextInsertionPosition(8)).isEqualTo(10);
+
+        assertThat(adsAt1234.nextInsertionPosition(0)).isEqualTo(1);
+        assertThat(adsAt1234.nextInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt1234.nextInsertionPosition(2)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt1234.nextInsertionPosition(3)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt1234.nextInsertionPosition(4)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt1234.nextInsertionPosition(5)).isEqualTo(NOT_FOUND);
+    }
+
+    @Test
+    public void initialState_prevInsertionPosition() {
+        assertThat(noAds.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(noAds.previousInsertionPosition(1)).isEqualTo(NOT_FOUND);
+
+        assertThat(adAt0.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adAt0.previousInsertionPosition(1)).isEqualTo(0);
+        assertThat(adAt0.previousInsertionPosition(2)).isEqualTo(0);
+
+        assertThat(adAt1.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adAt1.previousInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adAt1.previousInsertionPosition(2)).isEqualTo(1);
+        assertThat(adAt1.previousInsertionPosition(3)).isEqualTo(1);
+
+        assertThat(adsAt01.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt01.previousInsertionPosition(1)).isEqualTo(0);
+        assertThat(adsAt01.previousInsertionPosition(2)).isEqualTo(0);
+        assertThat(adsAt01.previousInsertionPosition(3)).isEqualTo(0);
+
+        assertThat(adsAt14.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt14.previousInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt14.previousInsertionPosition(2)).isEqualTo(1);
+        assertThat(adsAt14.previousInsertionPosition(3)).isEqualTo(1);
+        assertThat(adsAt14.previousInsertionPosition(4)).isEqualTo(3);
+        assertThat(adsAt14.previousInsertionPosition(5)).isEqualTo(3);
+
+        assertThat(adsRepeating.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adsRepeating.previousInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adsRepeating.previousInsertionPosition(2)).isEqualTo(NOT_FOUND);
+        assertThat(adsRepeating.previousInsertionPosition(3)).isEqualTo(2);
+        assertThat(adsRepeating.previousInsertionPosition(4)).isEqualTo(2);
+        assertThat(adsRepeating.previousInsertionPosition(5)).isEqualTo(4);
+        assertThat(adsRepeating.previousInsertionPosition(6)).isEqualTo(4);
+        assertThat(adsRepeating.previousInsertionPosition(7)).isEqualTo(6);
+
+        assertThat(adsAt15repeating.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt15repeating.previousInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt15repeating.previousInsertionPosition(2)).isEqualTo(1);
+        assertThat(adsAt15repeating.previousInsertionPosition(3)).isEqualTo(1);
+        assertThat(adsAt15repeating.previousInsertionPosition(4)).isEqualTo(1);
+        assertThat(adsAt15repeating.previousInsertionPosition(5)).isEqualTo(4);
+        assertThat(adsAt15repeating.previousInsertionPosition(6)).isEqualTo(4);
+        assertThat(adsAt15repeating.previousInsertionPosition(7)).isEqualTo(6);
+        assertThat(adsAt15repeating.previousInsertionPosition(8)).isEqualTo(6);
+        assertThat(adsAt15repeating.previousInsertionPosition(9)).isEqualTo(8);
+
+        assertThat(adsAt1234.previousInsertionPosition(0)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt1234.previousInsertionPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt1234.previousInsertionPosition(2)).isEqualTo(1);
+        assertThat(adsAt1234.previousInsertionPosition(3)).isEqualTo(1);
+    }
+
+    @Test
+    public void initialState_isPlacedAd() {
+        assertThat(adsAt15repeating.isPlacedAd(0)).isFalse();
+        assertThat(adsAt15repeating.isPlacedAd(1)).isFalse();
+        assertThat(adsAt15repeating.isPlacedAd(10)).isFalse();
+        assertThat(adsAt15repeating.isPlacedAd(1000)).isFalse();
+
+        assertThat(noAds.isPlacedAd(0)).isFalse();
+        assertThat(noAds.isPlacedAd(1000)).isFalse();
+    }
+
+    @Test
+    public void initialState_getOriginalPosition() {
+        assertThat(adsAt15repeating.getOriginalPosition(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getOriginalPosition(1)).isEqualTo(1);
+        assertThat(adsAt15repeating.getOriginalPosition(10)).isEqualTo(10);
+        assertThat(adsAt15repeating.getOriginalPosition(1000)).isEqualTo(1000);
+
+        assertThat(noAds.getOriginalPosition(0)).isEqualTo(0);
+        assertThat(noAds.getOriginalPosition(1000)).isEqualTo(1000);
+    }
+
+    @Test
+    public void initialState_getOriginalCount() {
+        assertThat(adsAt15repeating.getOriginalCount(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getOriginalCount(1)).isEqualTo(1);
+        assertThat(adsAt15repeating.getOriginalCount(10)).isEqualTo(10);
+        assertThat(adsAt15repeating.getOriginalCount(1000)).isEqualTo(1000);
+
+        assertThat(noAds.getOriginalCount(0)).isEqualTo(0);
+        assertThat(noAds.getOriginalCount(1000)).isEqualTo(1000);
+    }
+
+    @Test
+    public void initialState_getAdjustedPosition() {
+        assertThat(adsAt15repeating.getAdjustedPosition(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getAdjustedPosition(1)).isEqualTo(1);
+        assertThat(adsAt15repeating.getAdjustedPosition(10)).isEqualTo(10);
+        assertThat(adsAt15repeating.getAdjustedPosition(1000)).isEqualTo(1000);
+
+        assertThat(noAds.getAdjustedPosition(0)).isEqualTo(0);
+        assertThat(noAds.getAdjustedPosition(1000)).isEqualTo(1000);
+    }
+
+    @Test
+    public void initialState_getAdjustedCount() {
+        assertThat(adsAt15repeating.getAdjustedCount(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getAdjustedCount(1)).isEqualTo(1);
+        assertThat(adsAt15repeating.getAdjustedCount(10)).isEqualTo(10);
+        assertThat(adsAt15repeating.getAdjustedCount(1000)).isEqualTo(1000);
+
+        assertThat(noAds.getAdjustedCount(0)).isEqualTo(0);
+        assertThat(noAds.getAdjustedCount(1000)).isEqualTo(1000);
+    }
+
+    @Test
+    public void placeAds_inOrder_shouldUpdatePositions() {
+        checkInsertionPositions(10, adsAt15repeating, 1, 4, 6, 8, 10);
+        checkPlacedPositions(20, adsAt15repeating);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        checkInsertionPositions(10, adsAt15repeating, 5, 7, 9);
+        checkPlacedPositions(20, adsAt15repeating, 1);
+
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        checkInsertionPositions(10, adsAt15repeating, 8, 10);
+        checkPlacedPositions(20, adsAt15repeating, 1, 5);
+
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+        checkInsertionPositions(10, adsAt15repeating);
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 8);
+    }
+
+    @Test
+    public void placeAds_outOfOrder_shouldUpdatePositions() {
+        checkInsertionPositions(10, adsAt15repeating, 1, 4, 6, 8, 10);
+        checkPlacedPositions(20, adsAt15repeating);
+
+        adsAt15repeating.placeAd(6, mockNativeAdData);
+        checkInsertionPositions(10, adsAt15repeating, 1, 4, 9);
+        checkPlacedPositions(20, adsAt15repeating, 6);
+
+        adsAt15repeating.placeAd(4, mockNativeAdData);
+        checkInsertionPositions(10, adsAt15repeating, 1, 10);
+        checkPlacedPositions(20, adsAt15repeating, 4, 7);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        checkInsertionPositions(10, adsAt15repeating);
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 8);
+    }
+
+    @Test
+    public void placedAds_getOriginalPositionAndCount() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        assertThat(adsAt15repeating.getOriginalPosition(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getOriginalPosition(1)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt15repeating.getOriginalPosition(2)).isEqualTo(1);
+        assertThat(adsAt15repeating.getOriginalPosition(3)).isEqualTo(2);
+        assertThat(adsAt15repeating.getOriginalPosition(4)).isEqualTo(3);
+        assertThat(adsAt15repeating.getOriginalPosition(5)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt15repeating.getOriginalPosition(6)).isEqualTo(4);
+        assertThat(adsAt15repeating.getOriginalPosition(7)).isEqualTo(5);
+        assertThat(adsAt15repeating.getOriginalPosition(8)).isEqualTo(NOT_FOUND);
+        assertThat(adsAt15repeating.getOriginalPosition(9)).isEqualTo(6);
+        assertThat(adsAt15repeating.getOriginalPosition(10)).isEqualTo(7);
+
+        assertThat(adsAt15repeating.getOriginalCount(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getOriginalCount(10)).isEqualTo(7);
+        assertThat(adsAt15repeating.getOriginalCount(20)).isEqualTo(17);
+    }
+
+    @Test
+    public void placedAds_getAdjustedPositionAndCount() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        assertThat(adsAt15repeating.getAdjustedPosition(0)).isEqualTo(0);
+        // Ad here
+        assertThat(adsAt15repeating.getAdjustedPosition(1)).isEqualTo(2);
+        assertThat(adsAt15repeating.getAdjustedPosition(2)).isEqualTo(3);
+        assertThat(adsAt15repeating.getAdjustedPosition(3)).isEqualTo(4);
+        // Ad here
+        assertThat(adsAt15repeating.getAdjustedPosition(4)).isEqualTo(6);
+        assertThat(adsAt15repeating.getAdjustedPosition(5)).isEqualTo(7);
+        // Ad here
+        assertThat(adsAt15repeating.getAdjustedPosition(6)).isEqualTo(9);
+        assertThat(adsAt15repeating.getAdjustedPosition(7)).isEqualTo(10);
+        assertThat(adsAt15repeating.getAdjustedPosition(8)).isEqualTo(11);
+        assertThat(adsAt15repeating.getAdjustedPosition(9)).isEqualTo(12);
+        assertThat(adsAt15repeating.getAdjustedPosition(10)).isEqualTo(13);
+
+        assertThat(adsAt15repeating.getAdjustedCount(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getAdjustedCount(10)).isEqualTo(13);
+        assertThat(adsAt15repeating.getAdjustedCount(20)).isEqualTo(23);
+    }
+
+    @Test
+    public void placeAdsClumped_shouldPlaceAdsInOrder() {
+        int nextPosition = adsAt1234.nextInsertionPosition(0);
+        adsAt1234.placeAd(nextPosition, mockNativeAdData);
+
+        nextPosition = adsAt1234.nextInsertionPosition(nextPosition);
+        adsAt1234.placeAd(nextPosition, mockNativeAdData2);
+
+        nextPosition = adsAt1234.nextInsertionPosition(nextPosition);
+        adsAt1234.placeAd(nextPosition, mockNativeAdData3);
+
+        nextPosition = adsAt1234.nextInsertionPosition(nextPosition);
+        adsAt1234.placeAd(nextPosition, mockNativeAdData4);
+
+        nextPosition = adsAt1234.nextInsertionPosition(nextPosition);
+        assertThat(nextPosition).isEqualTo(NOT_FOUND);
+
+        assertThat(adsAt1234.isPlacedAd(0)).isFalse();
+        assertThat(adsAt1234.getPlacedAd(1)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(4)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(5)).isFalse();
+    }
+
+    @Test
+    public void placeAdsClumped_thenRemoveContentBeforeClumpedAds_shouldShiftAds() {
+        adsAt1234.placeAd(1, mockNativeAdData);
+        adsAt1234.placeAd(2, mockNativeAdData2);
+        adsAt1234.placeAd(3, mockNativeAdData3);
+        adsAt1234.placeAd(4, mockNativeAdData4);
+
+        adsAt1234.removeItem(0);
+        assertThat(adsAt1234.getPlacedAd(0)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(1)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(4)).isFalse();
+
+        adsAt1234.removeItem(0);
+        assertThat(adsAt1234.getPlacedAd(0)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(1)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(4)).isFalse();
+    }
+
+    @Test
+    public void placeAdsClumped_thenRemoveContentAfterClumpedAds_shouldNotShiftAds() {
+        adsAt1234.placeAd(1, mockNativeAdData);
+        adsAt1234.placeAd(2, mockNativeAdData2);
+        adsAt1234.placeAd(3, mockNativeAdData3);
+        adsAt1234.placeAd(4, mockNativeAdData4);
+
+        adsAt1234.removeItem(1);
+        assertThat(adsAt1234.isPlacedAd(0)).isFalse();
+        assertThat(adsAt1234.getPlacedAd(1)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(4)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(5)).isFalse();
+
+        adsAt1234.removeItem(2);
+        assertThat(adsAt1234.isPlacedAd(0)).isFalse();
+        assertThat(adsAt1234.getPlacedAd(1)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(4)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(5)).isFalse();
+    }
+
+    @Test
+    public void placeAdsClumped_thenInsertContentBeforeClumpedAds_shouldShiftAds() {
+        adsAt1234.placeAd(1, mockNativeAdData);
+        adsAt1234.placeAd(2, mockNativeAdData2);
+        adsAt1234.placeAd(3, mockNativeAdData3);
+        adsAt1234.placeAd(4, mockNativeAdData4);
+
+        adsAt1234.insertItem(1);
+        assertThat(adsAt1234.isPlacedAd(0)).isFalse();
+        assertThat(adsAt1234.isPlacedAd(1)).isFalse();
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(4)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(5)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(6)).isFalse();
+
+        adsAt1234.insertItem(0);
+        assertThat(adsAt1234.isPlacedAd(0)).isFalse();
+        assertThat(adsAt1234.isPlacedAd(1)).isFalse();
+        assertThat(adsAt1234.isPlacedAd(2)).isFalse();
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(4)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(5)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(6)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(7)).isFalse();
+    }
+
+    @Test
+    public void placeAdsClumped_thenInsertContentAfterClumpedAds_shouldNotShiftAds() {
+        adsAt1234.placeAd(1, mockNativeAdData);
+        adsAt1234.placeAd(2, mockNativeAdData2);
+        adsAt1234.placeAd(3, mockNativeAdData3);
+        adsAt1234.placeAd(4, mockNativeAdData4);
+
+        adsAt1234.insertItem(2);
+        assertThat(adsAt1234.isPlacedAd(0)).isFalse();
+        assertThat(adsAt1234.getPlacedAd(1)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(4)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(5)).isFalse();
+
+        adsAt1234.removeItem(3);
+        assertThat(adsAt1234.isPlacedAd(0)).isFalse();
+        assertThat(adsAt1234.getPlacedAd(1)).isEqualTo(mockNativeAdData);
+        assertThat(adsAt1234.getPlacedAd(2)).isEqualTo(mockNativeAdData2);
+        assertThat(adsAt1234.getPlacedAd(3)).isEqualTo(mockNativeAdData3);
+        assertThat(adsAt1234.getPlacedAd(4)).isEqualTo(mockNativeAdData4);
+        assertThat(adsAt1234.isPlacedAd(5)).isFalse();
+    }
+
+    @Test
+    public void placedAds_thenClearEmptyRange_doesNothing() {
+        checkPlacedPositions(15, adsAt15repeating);
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+
+        adsAt15repeating.clearAdsInRange(0, 0);
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(15, adsAt15repeating, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(4, 4);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(15, adsAt15repeating, 11, 13, 15);
+    }
+
+    @Test
+    public void placedAds_thenClearAll_shouldResetInsertionPositions() {
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(15, adsAt15repeating, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(1, 10);
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+    }
+
+    @Test
+    public void placedAds_thenClearRange_inOrder_shouldResetInsertionPositions() {
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(15, adsAt15repeating, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(1, 2);
+        checkPlacedPositions(15, adsAt15repeating, 4, 7);
+        checkInsertionPositions(15, adsAt15repeating, 1, 10, 12, 14);
+
+        adsAt15repeating.clearAdsInRange(4, 5);
+        checkPlacedPositions(15, adsAt15repeating, 6);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 9, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(6, 7);
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+    }
+
+    @Test
+    public void placedAds_thenClearRange_descending_shouldResetInsertionPositions() {
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(15, adsAt15repeating, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(8, 9);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5);
+        checkInsertionPositions(15, adsAt15repeating, 8, 10, 12, 14);
+
+        adsAt15repeating.clearAdsInRange(5, 6);
+        checkPlacedPositions(15, adsAt15repeating, 1);
+        checkInsertionPositions(15, adsAt15repeating, 5, 7, 9, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(1, 2);
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+    }
+
+    @Test
+    public void placedAds_thenClearRange_multiple_shouldResetInsertionPositions() {
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(15, adsAt15repeating, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(1, 6);
+        checkPlacedPositions(15, adsAt15repeating, 6);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 9, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(5, 10);
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+    }
+
+    @Test
+    public void placedAds_thenClearRange_descending_multiple_shouldResetInsertionPositions() {
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+        checkPlacedPositions(15, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(15, adsAt15repeating, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(5, 9);
+        checkPlacedPositions(15, adsAt15repeating, 1);
+        checkInsertionPositions(15, adsAt15repeating, 5, 7, 9, 11, 13, 15);
+
+        adsAt15repeating.clearAdsInRange(1, 5);
+        checkPlacedPositions(15, adsAt15repeating);
+        checkInsertionPositions(15, adsAt15repeating, 1, 4, 6, 8, 10, 12, 14);
+    }
+
+    @Test
+    public void placeAds_thenClear_shouldCallDestroy() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData2);
+        adsAt15repeating.placeAd(8, mockNativeAdData3);
+
+        adsAt15repeating.clearAdsInRange(5, 10);
+        verify(mockNativeResponse, never()).destroy();
+        verify(mockNativeResponse2).destroy();
+        verify(mockNativeResponse3).destroy();
+    }
+
+    @Test
+    public void insertItems_afterPlacing() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        adsAt15repeating.insertItem(1);
+        adsAt15repeating.insertItem(4);
+        adsAt15repeating.insertItem(12);
+
+        checkPlacedPositions(20, adsAt15repeating, 2, 7, 10);
+    }
+
+    @Test
+    public void insertItems_beforePlacing() {
+        checkInsertionPositions(7, adsAt15repeating, 1, 4, 6);
+
+        adsAt15repeating.insertItem(4);
+        adsAt15repeating.insertItem(7);
+
+        checkInsertionPositions(9, adsAt15repeating, 1, 5, 8);
+    }
+
+    @Test
+    public void removeThenInsertItem_atZero_shouldBeAtZero() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        adsAt15repeating.removeItem(0);
+        checkPlacedPositions(20, adsAt15repeating, 0, 4, 7);
+        checkInsertionPositions(16, adsAt15repeating, 10, 12, 14, 16);
+
+        adsAt15repeating.insertItem(0);
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 8);
+        checkInsertionPositions(16, adsAt15repeating, 11, 13, 15);
+    }
+
+    @Test
+    public void placeThenInsertThenPlace() {
+        adsAt15repeating.placeAd(4, mockNativeAdData);
+        adsAt15repeating.insertItem(4);
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 6);
+    }
+
+    @Test
+    public void removeItems_afterPlacing() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 8);
+
+        adsAt15repeating.removeItem(3);
+        adsAt15repeating.removeItem(5);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 4, 7);
+
+        // Check the adjusted positions.
+        assertThat(adsAt15repeating.getAdjustedPosition(0)).isEqualTo(0);
+        assertThat(adsAt15repeating.getAdjustedPosition(1)).isEqualTo(2);
+        assertThat(adsAt15repeating.getAdjustedPosition(2)).isEqualTo(3);
+        assertThat(adsAt15repeating.getAdjustedPosition(3)).isEqualTo(5);
+        assertThat(adsAt15repeating.getAdjustedPosition(4)).isEqualTo(6);
+        assertThat(adsAt15repeating.getAdjustedPosition(5)).isEqualTo(8);
+    }
+
+    @Test
+    public void removeItemsBetweenAds_thenInsert_shouldClumpAds() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        adsAt15repeating.removeItem(4);
+        adsAt15repeating.removeItem(4);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 6);
+
+        adsAt15repeating.insertItem(5);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 6);
+
+        adsAt15repeating.insertItem(4);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 6, 7);
+    }
+
+    @Test
+    public void removeItems_beforePlacing() {
+        checkInsertionPositions(7, adsAt15repeating, 1, 4, 6);
+
+        adsAt15repeating.removeItem(4);
+
+        // Check insertion positions.
+        checkInsertionPositions(7, adsAt15repeating, 1, 4, 5, 7);
+    }
+
+    @Test
+    public void removeItem_withClumpedAdsBeforeIt_shouldCorrectlyRemoveItem() throws Exception {
+        adsRepeating.placeAd(2, mockNativeAdData);
+        adsRepeating.placeAd(5, mockNativeAdData);
+        adsRepeating.placeAd(8, mockNativeAdData);
+
+        checkPlacedPositions(20, adsRepeating, 2, 5, 8);
+        assertThat(adsRepeating.getAdjustedCount(7)).isEqualTo(10);
+
+        // Removing from the head will cause ads to pile up
+        adsRepeating.removeItem(0);
+        adsRepeating.removeItem(0);
+        adsRepeating.removeItem(0);
+        adsRepeating.removeItem(0);
+        adsRepeating.removeItem(0);
+        adsRepeating.removeItem(0);
+
+        checkPlacedPositions(20, adsRepeating, 0, 1, 2);
+
+        adsRepeating.removeItem(0);
+
+        checkPlacedPositions(20, adsRepeating, 0, 1, 2);
+    }
+
+    @Test
+    public void removeItems_afterClumpedAds_shouldStayClumped() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        adsAt15repeating.removeItem(4);
+        adsAt15repeating.removeItem(4);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 6);
+
+        // Shouldn't move any ads.
+        adsAt15repeating.removeItem(4);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 5, 6);
+
+        adsAt15repeating.removeItem(3);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 4, 5);
+    }
+
+    @Test
+    public void moveItems_afterPlacing() {
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData);
+        adsAt15repeating.placeAd(8, mockNativeAdData);
+
+        assertThat(adsAt15repeating.getAdjustedPosition(4)).isEqualTo(6);
+        assertThat(adsAt15repeating.getAdjustedPosition(5)).isEqualTo(7);
+
+        adsAt15repeating.moveItem(4, 2);
+
+        checkPlacedPositions(20, adsAt15repeating, 1, 6, 8);
+
+        assertThat(adsAt15repeating.getAdjustedPosition(4)).isEqualTo(5);
+        assertThat(adsAt15repeating.getAdjustedPosition(5)).isEqualTo(7);
+    }
+
+    @Test
+    public void clearAll_shouldCallDestroyOnAdData_shouldResetPositions() {
+        when(mockNativeAdData.getAd()).thenReturn(mockNativeResponse);
+        when(mockNativeAdData2.getAd()).thenReturn(mockNativeResponse2);
+        when(mockNativeAdData3.getAd()).thenReturn(mockNativeResponse3);
+
+        adsAt15repeating.placeAd(1, mockNativeAdData);
+        adsAt15repeating.placeAd(5, mockNativeAdData2);
+        adsAt15repeating.placeAd(8, mockNativeAdData3);
+
+        adsAt15repeating.clearAds();
+
+        verify(mockNativeResponse).destroy();
+        verify(mockNativeResponse2).destroy();
+        verify(mockNativeResponse3).destroy();
+
+        // Should reset to original positions
+        checkInsertionPositions(10, adsAt15repeating, 1, 4, 6, 8, 10);
+        checkPlacedPositions(20, adsAt15repeating);
+    }
+
+    void checkInsertionPositions(int maxValue, PlacementData placementData, Integer... positions) {
+        List<Integer> expected = Arrays.asList(positions);
+        List<Integer> actual = new ArrayList<Integer>();
+        for (int i = 0; i <= maxValue; i++) {
+            if (placementData.shouldPlaceAd(i)) {
+                actual.add(i);
+            }
+        }
+
+        assertThat(actual).isEqualTo(expected);
+    }
+
+    void checkPlacedPositions(int maxValue, PlacementData placementData, Integer... positions) {
+        List<Integer> expected = Arrays.asList(positions);
+        List<Integer> actual = new ArrayList<Integer>();
+        for (int i = 0; i < maxValue; i++) {
+            if (placementData.isPlacedAd(i)) {
+                actual.add(i);
+                assertThat(placementData.getPlacedAd(i)).isEqualTo(mockNativeAdData);
+            } else {
+                assertThat(placementData.getPlacedAd(i)).isNull();
+            }
+        }
+
+        assertThat(actual).isEqualTo(expected);
+
+        // Also check getPlacedAdPositions
+        List<Integer> actualFromAdPositions = new ArrayList<Integer>();
+        for (Integer position : placementData.getPlacedAdPositions()) {
+            actualFromAdPositions.add(position);
+        }
+        assertThat(actualFromAdPositions).isEqualTo(expected);
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ServerPositioningSourceTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ServerPositioningSourceTest.java
new file mode 100644
index 00000000..2930217b
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/ServerPositioningSourceTest.java
@@ -0,0 +1,287 @@
+package com.mopub.nativeads;
+
+import android.app.Activity;
+import android.os.Build.VERSION_CODES;
+
+import com.mopub.common.DownloadResponse;
+import com.mopub.common.DownloadTask;
+import com.mopub.common.DownloadTask.DownloadTaskListener;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
+import com.mopub.nativeads.PositioningSource.PositioningListener;
+import com.mopub.nativeads.ServerPositioningSource.DownloadTaskProvider;
+
+import org.apache.http.HttpStatus;
+import org.apache.http.client.methods.HttpGet;
+import org.json.JSONException;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.ArgumentCaptor;
+import org.mockito.Captor;
+import org.mockito.Mock;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import java.util.concurrent.Executor;
+
+import static junit.framework.Assert.fail;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.anyBoolean;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
+@RunWith(SdkTestRunner.class)
+public class ServerPositioningSourceTest {
+    @Mock DownloadTaskProvider mockDownloadTaskProvider;
+    @Mock DownloadTaskListener mockDownloadTaskListener;
+    @Mock DownloadTask mockDownloadTask;
+    @Mock PositioningListener mockPositioningListener;
+    @Captor ArgumentCaptor<DownloadTaskListener> taskListenerCaptor;
+    @Mock DownloadResponse mockValidResponse;
+    @Mock DownloadResponse mockNotFoundResponse;
+    @Mock DownloadResponse mockInvalidJsonResponse;
+    @Mock DownloadResponse mockWarmingUpJsonResponse;
+    @Captor ArgumentCaptor<MoPubClientPositioning> positioningCaptor;
+
+    ServerPositioningSource subject;
+
+    @Before
+    public void setUp() {
+        Activity activity = Robolectric.buildActivity(Activity.class).create().get();
+        subject = new ServerPositioningSource(activity, mockDownloadTaskProvider);
+
+        when(mockDownloadTaskProvider.get(any(DownloadTaskListener.class)))
+                .thenReturn(mockDownloadTask);
+
+        when(mockValidResponse.getStatusCode()).thenReturn(HttpStatus.SC_OK);
+        when(mockValidResponse.getByteArray()).thenReturn("{fixed: []}".getBytes());
+
+        when(mockInvalidJsonResponse.getStatusCode()).thenReturn(HttpStatus.SC_OK);
+        when(mockInvalidJsonResponse.getByteArray()).thenReturn("blah blah".getBytes());
+
+        when(mockWarmingUpJsonResponse.getStatusCode()).thenReturn(HttpStatus.SC_OK);
+        when(mockWarmingUpJsonResponse.getByteArray()).thenReturn(
+                "{\"error\":\"WARMING_UP\"}".getBytes());
+
+        when(mockNotFoundResponse.getStatusCode()).thenReturn(HttpStatus.SC_NOT_FOUND);
+    }
+
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
+    @Test
+    public void loadPositions_atLeastIcs_shouldExecuteDownloadTask() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+        verify(mockDownloadTask).executeOnExecutor(any(Executor.class), any(HttpGet.class));
+    }
+
+    @Config(reportSdk = VERSION_CODES.GINGERBREAD_MR1)
+    @Test
+    public void loadPositions_beforeIcs_shouldExecuteDownloadTask() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+        verify(mockDownloadTask).execute(any(HttpGet.class));
+    }
+
+    @Test
+    public void loadPositionsTwice_shouldCancelPreviousDownloadTask_shouldNotCallListener() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+        verify(mockDownloadTask).cancel(true);
+
+        // Cancelling completes the download tasks with a null response.
+        taskListenerCaptor.getValue().onComplete("some_url", null);
+        verify(mockPositioningListener, never()).onFailed();
+        verify(mockPositioningListener, never()).onLoad(any(MoPubClientPositioning.class));
+    }
+
+    @Test
+    public void loadPositionsTwice_withPendingRetry_shouldNotCancelPreviousDownloadTask() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+        taskListenerCaptor.getValue().onComplete("some_url", mockValidResponse);
+
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+        verify(mockDownloadTask, never()).cancel(anyBoolean());
+    }
+
+    @Test
+    public void loadPositions_thenComplete_withValidResponse_shouldCallOnLoadListener() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+        taskListenerCaptor.getValue().onComplete("some_url", mockValidResponse);
+
+        verify(mockPositioningListener).onLoad(positioningCaptor.capture());
+        MoPubClientPositioning positioning = positioningCaptor.getValue();
+        assertThat(positioning.getFixedPositions()).isEmpty();
+        assertThat(positioning.getRepeatingInterval()).isEqualTo(MoPubClientPositioning.NO_REPEAT);
+    }
+
+    @Config(reportSdk = VERSION_CODES.ICE_CREAM_SANDWICH)
+    @Test
+    public void loadPositions_thenComplete_withNotFoundResponse_shouldRetry() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+        
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+        taskListenerCaptor.getValue().onComplete("some_url", mockNotFoundResponse);
+
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+        verify(mockDownloadTask, times(2))
+                .executeOnExecutor(any(Executor.class), any(HttpGet.class));
+    }
+
+    @Test
+    public void loadPositions_thenComplete_withWarmingUpResponse_shouldRetry() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+        taskListenerCaptor.getValue().onComplete("some_url", mockWarmingUpJsonResponse);
+
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+        verify(mockDownloadTask, times(2))
+                .executeOnExecutor(any(Executor.class), any(HttpGet.class));
+    }
+
+    @Test
+    public void loadPositions_thenComplete_withInvalidJsonResponse_shouldRetry() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+        taskListenerCaptor.getValue().onComplete("some_url", mockInvalidJsonResponse);
+
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+        verify(mockDownloadTask, times(2))
+                .executeOnExecutor(any(Executor.class), any(HttpGet.class));
+    }
+
+    @Test
+    public void loadPositions_withPendingRetry_shouldNotRetry() {
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+        taskListenerCaptor.getValue().onComplete("some_url", mockInvalidJsonResponse);
+
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+        verify(mockDownloadTask, times(2))
+                .executeOnExecutor(any(Executor.class), any(HttpGet.class));
+    }
+
+    @Test
+    public void loadPositions_thenFailAfterMaxRetryTime_shouldCallFailureHandler() {
+        ServerPositioningSource.MAXIMUM_RETRY_TIME_MILLISECONDS = 999;
+
+        subject.loadPositions("test_ad_unit", mockPositioningListener);
+
+        verify(mockDownloadTaskProvider).get(taskListenerCaptor.capture());
+        taskListenerCaptor.getValue().onComplete("some_url", mockInvalidJsonResponse);
+
+        Robolectric.getUiThreadScheduler().advanceToLastPostedRunnable();
+        verify(mockPositioningListener).onFailed();
+    }
+
+    @Test
+    public void parseJsonResponse_noFixedPositions_shouldReturnEmptyPositioning()
+            throws JSONException {
+        MoPubClientPositioning positioning = subject.parseJsonResponse(
+                "{fixed: []}");
+        assertThat(positioning.getFixedPositions()).isEmpty();
+        assertThat(positioning.getRepeatingInterval()).isEqualTo(MoPubClientPositioning.NO_REPEAT);
+    }
+
+    @Test
+    public void parseJsonResponse_oneFixedPosition_shouldReturnValidPositioning()
+            throws JSONException {
+        MoPubClientPositioning positioning = subject.parseJsonResponse(
+                "{fixed: [{position: 2}]}");
+        assertThat(positioning.getFixedPositions()).containsOnly(2);
+        assertThat(positioning.getRepeatingInterval()).isEqualTo(MoPubClientPositioning.NO_REPEAT);
+    }
+
+    @Test
+    public void parseJsonResponse_twoFixedPositions_shouldReturnValidPositioning()
+            throws JSONException {
+        MoPubClientPositioning positioning = subject.parseJsonResponse(
+                "{fixed: [{position: 1}, {position: 8}]}");
+        assertThat(positioning.getFixedPositions()).containsExactly(1, 8);
+        assertThat(positioning.getRepeatingInterval()).isEqualTo(MoPubClientPositioning.NO_REPEAT);
+    }
+
+    @Test
+    public void parseJsonResponse_twoFixedPositions_shouldIgnoreNonZeroSection()
+            throws JSONException {
+        MoPubClientPositioning positioning = subject.parseJsonResponse(
+                "{fixed: [{section: 0, position: 5}, {section: 1, position: 8}]}");
+        assertThat(positioning.getFixedPositions()).containsOnly(5);
+        assertThat(positioning.getRepeatingInterval()).isEqualTo(MoPubClientPositioning.NO_REPEAT);
+    }
+
+    @Test
+    public void parseJsonResponse_invalidFixedPosition_shouldThrowException() {
+        // Must have either fixed or repeating positions.
+        checkException(null, "Empty response");
+        checkException("", "Empty response");
+        checkException("{}", "Must contain fixed or repeating positions");
+        checkException("{\"error\":\"WARMING_UP\"}", "WARMING_UP");
+
+        // Position is required.
+        checkException("{fixed: [{}]}", "JSONObject[\"position\"] not found.");
+        checkException("{fixed: [{section: 0}]}", "JSONObject[\"position\"] not found.");
+
+        // Section is optional, but if it exists must be > 0
+        checkException("{fixed: [{section: -1, position: 8}]}", "Invalid section -1 in JSON response");
+
+        // Positions must be between [0 and 2 ^ 16).
+        checkException("{fixed: [{position: -1}]}", "Invalid position -1 in JSON response");
+        checkException("{fixed: [{position: 1}, {position: -8}]}",
+                "Invalid position -8 in JSON response");
+        checkException("{fixed: [{position: 1}, {position: 66000}]}",
+                "Invalid position 66000 in JSON response");
+    }
+
+    @Test
+    public void parseJsonResponse_repeatingInterval_shouldReturnValidPositioning()
+            throws JSONException {
+        MoPubClientPositioning positioning = subject.parseJsonResponse(
+                "{repeating: {interval: 2}}");
+        assertThat(positioning.getFixedPositions()).isEmpty();
+        assertThat(positioning.getRepeatingInterval()).isEqualTo(2);
+    }
+
+    @Test
+    public void parseJsonResponse_invalidRepeating_shouldThrowException() {
+        checkException("{repeating: }", "Missing value at character 12");
+        checkException("{repeating: {}}", "JSONObject[\"interval\"] not found.");
+
+        // Intervals must be between [2 and 2 ^ 16).
+        checkException("{repeating: {interval: -1}}", "Invalid interval -1 in JSON response");
+        checkException("{repeating: {interval: 0}}", "Invalid interval 0 in JSON response");
+        checkException("{repeating: {interval: 1}}", "Invalid interval 1 in JSON response");
+        checkException("{repeating: {interval: 66000}}",
+                "Invalid interval 66000 in JSON response");
+    }
+
+    @Test
+    public void parseJsonResponse_fixedAndRepeating_shouldReturnValidPositioning()
+            throws JSONException {
+        MoPubClientPositioning positioning = subject.parseJsonResponse(
+                "{fixed: [{position: 0}, {position: 1}], repeating: {interval: 2}}");
+        assertThat(positioning.getFixedPositions()).containsExactly(0, 1);
+        assertThat(positioning.getRepeatingInterval()).isEqualTo(2);
+    }
+
+    private void checkException(String json, String expectedMessage) {
+        try {
+            subject.parseJsonResponse(json);
+        } catch (JSONException e) {
+            assertThat(e.getMessage()).isEqualTo(expectedMessage);
+            return;
+        }
+        fail("Should have received an exception");
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/VisibilityTrackerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/VisibilityTrackerTest.java
new file mode 100644
index 00000000..488c1ae7
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/VisibilityTrackerTest.java
@@ -0,0 +1,338 @@
+package com.mopub.nativeads;
+
+import android.app.Activity;
+import android.graphics.Rect;
+import android.os.Handler;
+import android.os.SystemClock;
+import android.view.View;
+import android.view.ViewParent;
+import android.view.ViewTreeObserver;
+import android.view.Window;
+
+import com.mopub.nativeads.VisibilityTracker.TrackingInfo;
+import com.mopub.common.test.support.SdkTestRunner;
+
+import org.fest.util.Lists;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.ArgumentCaptor;
+import org.mockito.Mock;
+import org.mockito.invocation.InvocationOnMock;
+import org.mockito.stubbing.Answer;
+import org.robolectric.shadows.ShadowSystemClock;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+import java.util.WeakHashMap;
+
+import static android.view.ViewTreeObserver.OnPreDrawListener;
+import static com.mopub.nativeads.VisibilityTracker.VisibilityChecker;
+import static com.mopub.nativeads.VisibilityTracker.VisibilityTrackerListener;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.reset;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
+@RunWith(SdkTestRunner.class)
+public class VisibilityTrackerTest {
+    private static final int MIN_PERCENTAGE_VIEWED = 50;
+
+    private Activity activity;
+    private VisibilityTracker subject;
+    private Map<View, TrackingInfo> trackedViews;
+    private VisibilityChecker visibilityChecker;
+
+    @Mock private VisibilityTrackerListener visibilityTrackerListener;
+    @Mock private View view;
+    @Mock private View view2;
+    @Mock private Handler visibilityHandler;
+
+    @Before
+    public void setUp() throws Exception {
+        trackedViews = new WeakHashMap<View, TrackingInfo>();
+        visibilityChecker = new VisibilityChecker();
+        activity = new Activity();
+        view = createViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
+        view2 = createViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
+
+        // Add a proxy listener to that makes a safe copy of the listener args.
+        VisibilityTrackerListener proxyListener = new VisibilityTrackerListener() {
+            @Override
+            public void onVisibilityChanged(List<View> visibleViews, List<View> invisibleViews) {
+                ArrayList<View> safeVisibleViews = new ArrayList<View>(visibleViews);
+                ArrayList<View> safeInVisibleViews = new ArrayList<View>(invisibleViews);
+                visibilityTrackerListener.onVisibilityChanged(safeVisibleViews, safeInVisibleViews);
+            }
+        };
+        subject = new VisibilityTracker(activity, trackedViews, visibilityChecker, visibilityHandler);
+        subject.setVisibilityTrackerListener(proxyListener);
+
+        // XXX We need this to ensure that our SystemClock starts
+        ShadowSystemClock.uptimeMillis();
+    }
+
+    @Test
+    public void constructor_shouldSetOnPreDrawListenerForDecorView() throws Exception {
+        Activity activity1 = mock(Activity.class);
+        Window window = mock(Window.class);
+        View decorView = mock(View.class);
+        ViewTreeObserver viewTreeObserver = mock(ViewTreeObserver.class);
+
+        when(activity1.getWindow()).thenReturn(window);
+        when(window.getDecorView()).thenReturn(decorView);
+        when(decorView.getViewTreeObserver()).thenReturn(viewTreeObserver);
+        when(viewTreeObserver.isAlive()).thenReturn(true);
+
+        subject = new VisibilityTracker(activity1, trackedViews, visibilityChecker, visibilityHandler);
+        assertThat(subject.mRootView.get()).isEqualTo(decorView);
+        assertThat(subject.mOnPreDrawListener).isNotNull();
+        verify(viewTreeObserver).addOnPreDrawListener(subject.mOnPreDrawListener);
+    }
+
+    @Test
+    public void constructor_withNonAliveViewTreeObserver_shouldNotSetOnPreDrawListenerForDecorView() throws Exception {
+        Activity activity1 = mock(Activity.class);
+        Window window = mock(Window.class);
+        View decorView = mock(View.class);
+        ViewTreeObserver viewTreeObserver = mock(ViewTreeObserver.class);
+
+        when(activity1.getWindow()).thenReturn(window);
+        when(window.getDecorView()).thenReturn(decorView);
+        when(decorView.getViewTreeObserver()).thenReturn(viewTreeObserver);
+        when(viewTreeObserver.isAlive()).thenReturn(false);
+
+        subject = new VisibilityTracker(activity1, trackedViews, visibilityChecker, visibilityHandler);
+        assertThat(subject.mRootView.get()).isEqualTo(decorView);
+        assertThat(subject.mOnPreDrawListener).isNull();
+        verify(viewTreeObserver, never()).addOnPreDrawListener(subject.mOnPreDrawListener);
+    }
+
+    @Test
+    public void addView_withVisibleView_shouldAddVisibleViewToTrackedViews() throws Exception {
+        subject.addView(view, MIN_PERCENTAGE_VIEWED);
+
+        assertThat(trackedViews).hasSize(1);
+    }
+
+    @Test(expected = AssertionError.class)
+    public void addView_whenViewIsNull_shouldThrowNPE() throws Exception {
+        subject.addView(null, MIN_PERCENTAGE_VIEWED);
+
+        assertThat(trackedViews).isEmpty();
+    }
+
+    @Test
+    public void removeView_shouldRemoveFromTrackedViews() throws Exception {
+        subject.addView(view, MIN_PERCENTAGE_VIEWED);
+
+        assertThat(trackedViews).hasSize(1);
+        assertThat(trackedViews).containsKey(view);
+
+        subject.removeView(view);
+
+        assertThat(trackedViews).isEmpty();
+    }
+
+    @Test
+    public void clear_shouldRemoveAllViewsFromTrackedViews_shouldRemoveMessagesFromVisibilityHandler_shouldResetIsVisibilityScheduled() throws Exception {
+        subject.addView(view, MIN_PERCENTAGE_VIEWED);
+        subject.addView(view2, MIN_PERCENTAGE_VIEWED);
+        assertThat(trackedViews).hasSize(2);
+
+        subject.clear();
+
+        assertThat(trackedViews).isEmpty();
+        verify(visibilityHandler).removeMessages(0);
+    }
+
+    @Test
+    public void destroy_shouldCallClear_shouldRemoveListenerFromDecorView() throws Exception {
+        Activity activity1 = mock(Activity.class);
+        Window window = mock(Window.class);
+        View decorView = mock(View.class);
+        ViewTreeObserver viewTreeObserver = mock(ViewTreeObserver.class);
+
+        when(activity1.getWindow()).thenReturn(window);
+        when(window.getDecorView()).thenReturn(decorView);
+        when(decorView.getViewTreeObserver()).thenReturn(viewTreeObserver);
+        when(viewTreeObserver.isAlive()).thenReturn(true);
+
+        subject = new VisibilityTracker(activity1, trackedViews, visibilityChecker, visibilityHandler);
+
+        subject.addView(view, MIN_PERCENTAGE_VIEWED);
+        subject.addView(view2, MIN_PERCENTAGE_VIEWED);
+        assertThat(trackedViews).hasSize(2);
+
+        subject.destroy();
+
+        assertThat(trackedViews).isEmpty();
+        verify(visibilityHandler).removeMessages(0);
+        verify(viewTreeObserver).removeOnPreDrawListener(any(OnPreDrawListener.class));
+        assertThat(subject.mOnPreDrawListener).isNull();
+    }
+
+    @Test
+    public void visibilityRunnable_run_withVisibleView_shouldCallOnVisibleCallback() throws Exception {
+        subject.addView(view, MIN_PERCENTAGE_VIEWED);
+
+        subject.new VisibilityRunnable().run();
+
+        verify(visibilityTrackerListener).onVisibilityChanged(
+                Lists.newArrayList(view), Lists.<View>newArrayList());
+    }
+
+    @Test
+    public void visibilityRunnable_run_withNonVisibleView_shouldCallOnNonVisibleCallback() throws Exception {
+        when(view.getVisibility()).thenReturn(View.INVISIBLE);
+        subject.addView(view, MIN_PERCENTAGE_VIEWED);
+
+        subject.new VisibilityRunnable().run();
+
+        ArgumentCaptor<List> visibleCaptor = ArgumentCaptor.forClass(List.class);
+        ArgumentCaptor<List> invisibleCaptor = ArgumentCaptor.forClass(List.class);
+        verify(visibilityTrackerListener).onVisibilityChanged(visibleCaptor.capture(),
+                invisibleCaptor.capture());
+        assertThat(visibleCaptor.getValue().size()).isEqualTo(0);
+        assertThat(invisibleCaptor.getValue().size()).isEqualTo(1);
+    }
+
+    // VisibilityChecker tests
+
+    @Test
+    public void hasRequiredTimeElapsed_withElapsedTimeGreaterThanMinTimeViewed_shouldReturnTrue() throws Exception {
+        assertThat(visibilityChecker.hasRequiredTimeElapsed(SystemClock.uptimeMillis() - 501, 500)).isTrue();
+    }
+
+    @Test
+    public void hasRequiredTimeElapsed_withElapsedTimeLessThanMinTimeViewed_shouldReturnFalse() throws Exception {
+        assertThat(visibilityChecker.hasRequiredTimeElapsed(SystemClock.uptimeMillis() - 499, 500)).isFalse();
+    }
+
+    @Test
+    public void isMostlyVisible_whenParentIsNull_shouldReturnFalse() throws Exception {
+        view = createViewMock(View.VISIBLE, 100, 100, 100, 100, false, true);
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isFalse();
+    }
+
+    @Test
+    public void isMostlyVisible_whenViewIsOffScreen_shouldReturnFalse() throws Exception {
+        view = createViewMock(View.VISIBLE, 100, 100, 100, 100, true, false);
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isFalse();
+    }
+
+    @Test
+    public void isMostlyVisible_whenViewIsEntirelyOnScreen_shouldReturnTrue() throws Exception {
+        view = createViewMock(View.VISIBLE, 100, 100, 100, 100, true, true);
+
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isTrue();
+    }
+
+    @Test
+    public void isMostlyVisible_whenViewIs50PercentVisible_shouldReturnTrue() throws Exception {
+        view = createViewMock(View.VISIBLE, 50, 100, 100, 100, true, true);
+
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isTrue();
+    }
+
+    @Test
+    public void isMostlyVisible_whenViewIs49PercentVisible_shouldReturnFalse() throws Exception {
+        view = createViewMock(View.VISIBLE, 49, 100, 100, 100, true, true);
+
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isFalse();
+    }
+
+    @Test
+    public void isMostlyVisible_whenVisibleAreaIsZero_shouldReturnFalse() throws Exception {
+        view = createViewMock(View.VISIBLE, 0, 0, 100, 100, true, true);
+
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isFalse();
+    }
+
+    @Test
+    public void isMostlyVisible_whenViewIsInvisibleOrGone_shouldReturnFalse() throws Exception {
+        View view = createViewMock(View.INVISIBLE, 100, 100, 100, 100, true, true);
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isFalse();
+
+        reset(view);
+        view = createViewMock(View.GONE, 100, 100, 100, 100, true, true);
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isFalse();
+    }
+
+    @Test
+    public void isMostlyVisible_whenViewHasZeroWidthAndHeight_shouldReturnFalse() throws Exception {
+        view = createViewMock(View.VISIBLE, 100, 100, 0, 0, true, true);
+
+        assertThat(visibilityChecker.isVisible(view, MIN_PERCENTAGE_VIEWED)).isFalse();
+    }
+
+    @Test
+    public void isMostlyVisible_whenViewIsNull_shouldReturnFalse() throws Exception {
+        assertThat(visibilityChecker.isVisible(null, MIN_PERCENTAGE_VIEWED)).isFalse();
+    }
+
+    @Test
+    public void addView_shouldClearViewAfterNumAccesses() {
+        // Access 1 time
+        subject.addView(view, MIN_PERCENTAGE_VIEWED);
+        assertThat(trackedViews).hasSize(1);
+
+        // Access 2-49 times
+        for (int i = 0; i < VisibilityTracker.NUM_ACCESSES_BEFORE_TRIMMING - 2; ++i) {
+            subject.addView(view2, MIN_PERCENTAGE_VIEWED);
+        }
+        assertThat(trackedViews).hasSize(2);
+
+        // 50th time
+        subject.addView(view2, MIN_PERCENTAGE_VIEWED);
+        assertThat(trackedViews).hasSize(2);
+
+        // 51-99
+        for (int i = 0; i < VisibilityTracker.NUM_ACCESSES_BEFORE_TRIMMING - 1; ++i) {
+            subject.addView(view2, MIN_PERCENTAGE_VIEWED);
+        }
+        assertThat(trackedViews).hasSize(2);
+
+        // 100
+        subject.addView(view2, MIN_PERCENTAGE_VIEWED);
+        assertThat(trackedViews).hasSize(1);
+    }
+
+    static View createViewMock(final int visibility,
+            final int visibleWidth,
+            final int visibleHeight,
+            final int viewWidth,
+            final int viewHeight,
+            final boolean isParentSet,
+            final boolean isOnScreen) {
+        View view = mock(View.class);
+        when(view.getContext()).thenReturn(new Activity());
+        when(view.getVisibility()).thenReturn(visibility);
+
+        when(view.getGlobalVisibleRect(any(Rect.class)))
+                .thenAnswer(new Answer<Boolean>() {
+                    @Override
+                    public Boolean answer(InvocationOnMock invocationOnMock) throws Throwable {
+                        Object[] args = invocationOnMock.getArguments();
+                        Rect rect = (Rect) args[0];
+                        rect.set(0, 0, visibleWidth, visibleHeight);
+                        return isOnScreen;
+                    }
+                });
+
+        when(view.getWidth()).thenReturn(viewWidth);
+        when(view.getHeight()).thenReturn(viewHeight);
+
+        if (isParentSet) {
+            when(view.getParent()).thenReturn(mock(ViewParent.class));
+        }
+
+        when(view.getViewTreeObserver()).thenCallRealMethod();
+
+        return view;
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/MoPubShadowBitmap.java b/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/MoPubShadowBitmap.java
new file mode 100644
index 00000000..614254fc
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/MoPubShadowBitmap.java
@@ -0,0 +1,18 @@
+package com.mopub.nativeads.test.support;
+
+import android.graphics.Bitmap;
+
+import org.robolectric.annotation.Implements;
+import org.robolectric.shadows.ShadowBitmap;
+
+// XXX the config for a newly created ShadowBitmap is never set so we need to set it ourselves
+// https://github.com/robolectric/robolectric/issues/876
+@Implements(Bitmap.class)
+public class MoPubShadowBitmap extends ShadowBitmap {
+
+    public MoPubShadowBitmap() {
+        // can also be some other config value
+        setConfig(Bitmap.Config.ARGB_8888);
+    }
+}
+
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/MoPubShadowDisplay.java b/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/MoPubShadowDisplay.java
new file mode 100644
index 00000000..9b38d956
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/MoPubShadowDisplay.java
@@ -0,0 +1,16 @@
+package com.mopub.nativeads.test.support;
+
+import android.graphics.Point;
+import android.view.Display;
+
+import org.robolectric.annotation.Implements;
+import org.robolectric.shadows.ShadowDisplay;
+
+/* Our old version of Robolectric doesn't have the newer Display.class methods implemented. */
+@Implements(Display.class)
+public class MoPubShadowDisplay extends ShadowDisplay {
+
+    public void getSize(Point size) {
+        size.set(getWidth(), getHeight());
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/SdkTestRunner.java b/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/SdkTestRunner.java
deleted file mode 100644
index cf51086a..00000000
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/test/support/SdkTestRunner.java
+++ /dev/null
@@ -1,49 +0,0 @@
-package com.mopub.nativeads.test.support;
-
-import com.mopub.common.factories.MethodBuilderFactory;
-import com.mopub.common.util.AsyncTasks;
-import com.mopub.common.util.test.support.ShadowAsyncTasks;
-import com.mopub.common.util.test.support.TestMethodBuilderFactory;
-import com.mopub.nativeads.factories.CustomEventNativeFactory;
-
-import org.junit.runners.model.InitializationError;
-import org.mockito.MockitoAnnotations;
-import org.robolectric.DefaultTestLifecycle;
-import org.robolectric.RobolectricTestRunner;
-import org.robolectric.TestLifecycle;
-import org.robolectric.bytecode.ClassInfo;
-import org.robolectric.bytecode.Setup;
-
-public class SdkTestRunner extends RobolectricTestRunner {
-    public SdkTestRunner(Class<?> testClass) throws InitializationError {
-        super(testClass);
-    }
-
-    @Override
-    public Setup createSetup() {
-        return new Setup() {
-            @Override
-            public boolean shouldInstrument(ClassInfo classInfo) {
-                return classInfo.getName().equals(AsyncTasks.class.getName())
-                        || super.shouldInstrument(classInfo);
-            }
-        };
-    }
-
-    @Override
-    protected Class<? extends TestLifecycle> getTestLifecycleClass() {
-        return TestLifeCycleWithInjection.class;
-    }
-
-    public static class TestLifeCycleWithInjection extends DefaultTestLifecycle {
-        @Override
-        public void prepareTest(Object test) {
-            MethodBuilderFactory.setInstance(new TestMethodBuilderFactory());
-            CustomEventNativeFactory.setInstance(new TestCustomEventNativeFactory());
-
-            ShadowAsyncTasks.reset();
-
-            MockitoAnnotations.initMocks(test);
-        }
-    }
-}
diff --git a/pom.xml b/pom.xml
index 5be7e9c3..7d637a7c 100644
--- a/pom.xml
+++ b/pom.xml
@@ -19,13 +19,13 @@
         <repository>
             <id>andsupport</id>
             <name>Android Support</name>
-            <url>file://${env.ANDROID_HOME}/extras/android/m2repository</url>
+            <url>file:///${env.ANDROID_HOME}/extras/android/m2repository</url>
         </repository>
 
         <repository>
             <id>playservices</id>
             <name>Android Play Services</name>
-            <url>file://${env.ANDROID_HOME}/extras/google/m2repository</url>
+            <url>file:///${env.ANDROID_HOME}/extras/google/m2repository</url>
         </repository>
     </repositories>
 
diff --git a/robotium-sample/AndroidManifest.xml b/robotium-sample/AndroidManifest.xml
index 24230c17..c4277cd0 100644
--- a/robotium-sample/AndroidManifest.xml
+++ b/robotium-sample/AndroidManifest.xml
@@ -3,7 +3,9 @@
       package="com.mopub.mobileads.robotium"
       android:versionCode="1"
       android:versionName="1.0">
-    <uses-sdk android:minSdkVersion="8" />
+    <uses-sdk
+        android:minSdkVersion="9"
+        android:targetSdkVersion="19"/>
 
     <uses-permission android:name="android.permission.INTERNET" />
     <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
@@ -18,9 +20,14 @@
 	        </intent-filter>
 	    </activity>
 
-        <activity android:name="com.mopub.mobileads.MoPubActivity" android:configChanges="keyboardHidden|orientation"/>
-        <activity android:name="com.mopub.mobileads.MraidActivity" android:configChanges="keyboardHidden|orientation"/>
-        <activity android:name="com.mopub.common.MoPubBrowser" android:configChanges="keyboardHidden|orientation"/>
+        <activity android:name="com.mopub.mobileads.MoPubActivity"
+                android:configChanges="keyboardHidden|orientation"/>
+        <activity android:name="com.mopub.mobileads.MraidActivity"
+                android:configChanges="keyboardHidden|orientation"/>
+        <activity android:name="com.mopub.common.MoPubBrowser"
+                android:configChanges="keyboardHidden|orientation"/>
+        <activity android:name="com.mopub.mobileads.MraidVideoPlayerActivity"
+                android:configChanges="keyboardHidden|orientation"/>
     </application>
 
 </manifest>
diff --git a/robotium-sample/pom.xml b/robotium-sample/pom.xml
index eed43b07..3481483f 100644
--- a/robotium-sample/pom.xml
+++ b/robotium-sample/pom.xml
@@ -68,7 +68,7 @@
         <dependency>
             <groupId>com.google.android</groupId>
             <artifactId>android</artifactId>
-            <version>4.1.2</version>
+            <version>4.4.2</version>
             <scope>provided</scope>
         </dependency>
     </dependencies>
@@ -92,7 +92,7 @@
                 <configuration>
                     <sdk>
                         <!-- platform or api level (api level 4 = platform 1.6)-->
-                        <platform>16</platform>
+                        <platform>19</platform>
                     </sdk>
                     <undeployBeforeDeploy>true</undeployBeforeDeploy>
                 </configuration>
diff --git a/robotium-sample/src/main/java/com/mopub/mobileads/robotium/RobotiumTestSupportActivity.java b/robotium-sample/src/main/java/com/mopub/mobileads/robotium/RobotiumTestSupportActivity.java
index 80a3c5ac..217d8db8 100644
--- a/robotium-sample/src/main/java/com/mopub/mobileads/robotium/RobotiumTestSupportActivity.java
+++ b/robotium-sample/src/main/java/com/mopub/mobileads/robotium/RobotiumTestSupportActivity.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.robotium;
 
 import android.app.Activity;
@@ -37,6 +5,7 @@
 import android.view.View;
 import android.widget.Button;
 import android.widget.EditText;
+
 import com.mopub.mobileads.MoPubInterstitial;
 import com.mopub.mobileads.MoPubView;
 
diff --git a/robotium-tests/AndroidManifest.xml b/robotium-tests/AndroidManifest.xml
index 03714b71..43a6b6d4 100644
--- a/robotium-tests/AndroidManifest.xml
+++ b/robotium-tests/AndroidManifest.xml
@@ -3,11 +3,16 @@
 		package="com.mopub.mobileads.test"
 		android:versionCode="1"
 		android:versionName="1.0">
-	<uses-sdk android:minSdkVersion="8"/>
+    <uses-sdk
+        android:minSdkVersion="9"
+        android:targetSdkVersion="19"/>
 
     <instrumentation android:targetPackage="com.mopub.mobileads.robotium" android:name="android.test.InstrumentationTestRunner" />
 
     <application android:label="Cool Activity Test">
         <uses-library android:name="android.test.runner" />
+
+        <meta-data android:name="com.google.android.gms.version"
+                   android:value="@integer/google_play_services_version" />
     </application>
 </manifest>
diff --git a/robotium-tests/pom.xml b/robotium-tests/pom.xml
index 262b5451..e15157b9 100644
--- a/robotium-tests/pom.xml
+++ b/robotium-tests/pom.xml
@@ -25,6 +25,12 @@
             <scope>provided</scope>
         </dependency>
 
+        <dependency>
+            <groupId>com.google.android.gms</groupId>
+            <artifactId>play-services</artifactId>
+            <version>5.2.08</version>
+            <type>aar</type>
+        </dependency>
 
         <!--test-->
 
@@ -38,7 +44,7 @@
         <dependency>
             <groupId>com.google.android</groupId>
             <artifactId>android</artifactId>
-            <version>4.1.2</version>
+            <version>4.4.2</version>
             <scope>provided</scope>
         </dependency>
     </dependencies>
@@ -62,7 +68,7 @@
                 <configuration>
                     <sdk>
                         <!-- platform or api level (api level 4 = platform 1.6)-->
-                        <platform>16</platform>
+                        <platform>19</platform>
                     </sdk>
                     <test>
                         <skip>true</skip>
diff --git a/robotium-tests/src/main/java/com/mopub/mobileads/test/RobotiumTestSupportActivityTest.java b/robotium-tests/src/main/java/com/mopub/mobileads/test/RobotiumTestSupportActivityTest.java
index 3ddad10e..fdf5c296 100644
--- a/robotium-tests/src/main/java/com/mopub/mobileads/test/RobotiumTestSupportActivityTest.java
+++ b/robotium-tests/src/main/java/com/mopub/mobileads/test/RobotiumTestSupportActivityTest.java
@@ -1,35 +1,3 @@
-/*
- * Copyright (c) 2010-2013, MoPub Inc.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions are
- * met:
- *
- *  Redistributions of source code must retain the above copyright
- *   notice, this list of conditions and the following disclaimer.
- *
- *  Redistributions in binary form must reproduce the above copyright
- *   notice, this list of conditions and the following disclaimer in the
- *   documentation and/or other materials provided with the distribution.
- *
- *  Neither the name of 'MoPub Inc.' nor the names of its contributors
- *   may be used to endorse or promote products derived from this software
- *   without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
- * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
- * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
- * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
- * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
- * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
- * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
- * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
- * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
- * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
- * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
- */
-
 package com.mopub.mobileads.test;
 
 import android.test.ActivityInstrumentationTestCase2;
@@ -42,13 +10,13 @@
 import com.mopub.mobileads.MoPubInterstitial;
 import com.mopub.mobileads.MoPubView;
 import com.mopub.mobileads.robotium.R;
-import com.robotium.solo.Solo;
 import com.mopub.mobileads.robotium.RobotiumTestSupportActivity;
+import com.robotium.solo.Solo;
 
 import static com.mopub.mobileads.MoPubInterstitial.InterstitialAdListener;
 
 public class RobotiumTestSupportActivityTest extends ActivityInstrumentationTestCase2<RobotiumTestSupportActivity>{
-    private static final long NETWORK_SLEEP_TIME = 3000;
+    private static final long NETWORK_SLEEP_TIME = 8000;
     private static final String BANNER_AD_UNIT_ID = "agltb3B1Yi1pbmNyDAsSBFNpdGUY8fgRDA";
     private static final String INTERSTITIAL_AD_UNIT_ID = "agltb3B1Yi1pbmNyDAsSBFNpdGUY6tERDA";
 
diff --git a/settings.gradle b/settings.gradle
new file mode 100644
index 00000000..281d020c
--- /dev/null
+++ b/settings.gradle
@@ -0,0 +1,3 @@
+rootProject.name = 'mopub-android'
+include ':mopub-sdk', ':mopub-sample'
+
