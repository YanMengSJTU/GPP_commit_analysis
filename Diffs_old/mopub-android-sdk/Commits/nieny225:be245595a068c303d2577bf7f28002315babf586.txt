diff --git a/CHANGELOG.md b/CHANGELOG.md
index 5add0cbc..a5de7bb2 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -1,3 +1,30 @@
+## Version 5.2.0 (July 9, 2018)
+- SDK initialization is required for ads to load. Ad requests will fail unless MoPub is initialized.
+- `MoPub#isSdkInitialized()` now more accurately reflects whether or not MoPub is initialized. This method now returns true after the `SdkInitializationListener#onInitializationFinished()` callback instead of immediately.
+- Bug fixes.
+
+## Version 5.1.0 (June 5, 2018)
+- Upgraded Moat dependency to 2.4.5.
+- Banners now only refresh after an impression is made.
+- Added `PersonalInfoManager.forceGdprApplies()` in order to let MoPub know that this app should always apply GDPR rules.
+- Loading MoPub's consent dialog is only possible when GDPR rules applies to the app.
+- Bug fixes.
+
+## Version 5.0.0 (May 14, 2018)
+- General Data Protection Regulation (GDPR) update to support a way for publishers to determine GDPR applicability and to obtain and manage consent from users in European Economic Area, the United Kingdom, or Switzerland to serve personalized ads.
+- New SDK initialization method to initialize consent management and rewarded video ad networks. Required for receiving personalized ads. In future versions of the SDK, initialization will be required to receive ads.
+- Updated network stack to MoPub-Volley-2.0.0.
+- Updated ad requests to use POST instead of GET.
+- All communication with MoPub servers is now made via HTTPS.
+
+## Version 4.20.0 (February 20, 2018)
+- Upgraded Gradle dependency to 4.3.1.
+- Upgraded Moat dependency to 2.4.1. This fixes the AAPT2 manifest merge error.
+- Fixed a viewability bug for video ads where ViewGroups were not being properly added to the list of known obstructions.
+- We are formally separating network adapters from our MoPub SDK. This is to enable an independent release cadence resulting in faster updates and certification cycles. New mediation location is accessible [here](https://github.com/mopub/mopub-android-mediation).  
+We have also added an additional tool, making it easy for publishers to get up and running with the mediation integration. Check out https://developers.mopub.com/docs/mediation/integrate/ and integration instructions at https://developers.mopub.com/docs/android/integrating-networks/.
+- Bug fixes.
+
 ## Version 4.19.0 (December 11, 2017)
 - Updated Facebook Audience Network adapters to 4.26.1.
 - Updated Flurry adapters to 8.1.0.
diff --git a/Jenkinsfile b/Jenkinsfile
index 0f179eab..6b5523bc 100644
--- a/Jenkinsfile
+++ b/Jenkinsfile
@@ -13,10 +13,10 @@ pipeline {
     }
     post {
         success {
-            hipchatSend message: "${env.JOB_NAME} #${env.BUILD_NUMBER} has succeeded.", color: 'GREEN'
+            slackSend color: 'GREEN', message: "<${env.BUILD_URL}|${env.JOB_NAME} #${env.BUILD_NUMBER}> has succeeded."
         }
         failure {
-            hipchatSend message: "Attention @here ${env.JOB_NAME} #${env.BUILD_NUMBER} has failed.", color: 'RED'
+            slackSend color: 'RED', message: "Attention @here <${env.BUILD_URL}|${env.JOB_NAME} #${env.BUILD_NUMBER}> has failed."
         }
     }
 }
diff --git a/README.md b/README.md
index a262d86f..9bc5b523 100644
--- a/README.md
+++ b/README.md
@@ -39,7 +39,7 @@ The MoPub SDK is available via:
     }
 
     dependencies {
-        compile('com.mopub:mopub-sdk:4.19.0@aar') {
+        implementation('com.mopub:mopub-sdk:5.2.0@aar') {
             transitive = true
         }
     }
@@ -61,27 +61,27 @@ The MoPub SDK is available via:
         // ... other project dependencies
 
         // For banners
-        compile('com.mopub:mopub-sdk-banner:4.19.0@aar') {
+        implementation('com.mopub:mopub-sdk-banner:5.2.0@aar') {
             transitive = true
         }
         
         // For interstitials
-        compile('com.mopub:mopub-sdk-interstitial:4.19.0@aar') {
+        implementation('com.mopub:mopub-sdk-interstitial:5.2.0@aar') {
             transitive = true
         }
 
         // For rewarded videos. This will automatically also include interstitials
-        compile('com.mopub:mopub-sdk-rewardedvideo:4.19.0@aar') {
+        implementation('com.mopub:mopub-sdk-rewardedvideo:5.2.0@aar') {
             transitive = true
         }
 
         // For native static (images).
-        compile('com.mopub:mopub-sdk-native-static:4.19.0@aar') {
+        implementation('com.mopub:mopub-sdk-native-static:5.2.0@aar') {
             transitive = true
         }
 
         // For native video. This will automatically also include native static
-        compile('com.mopub:mopub-sdk-native-video:4.19.0@aar') {
+        implementation('com.mopub:mopub-sdk-native-video:5.2.0@aar') {
             transitive = true
         }
     }
@@ -109,9 +109,8 @@ The MoPub SDK is available via:
 ## New in this Version
 Please view the [changelog](https://github.com/mopub/mopub-android-sdk/blob/master/CHANGELOG.md) for a complete list of additions, fixes, and enhancements in the latest release.
 
-- Updated Facebook Audience Network adapters to 4.26.1.
-- Updated Flurry adapters to 8.1.0.
-- Updated Millennial rewarded ads adapters to 6.6.1.
+- SDK initialization is required for ads to load. Ad requests will fail unless MoPub is initialized.
+- `MoPub#isSdkInitialized()` now more accurately reflects whether or not MoPub is initialized. This method now returns true after the `SdkInitializationListener#onInitializationFinished()` callback instead of immediately.
 
 ## Requirements
 
@@ -119,9 +118,15 @@ Please view the [changelog](https://github.com/mopub/mopub-android-sdk/blob/mast
 - android-support-v4.jar, r26 (**Updated in 4.18.0**)
 - android-support-annotations.jar, r26 (**Updated in 4.18.0**)
 - android-support-v7-recyclerview.jar, r26 (**Updated in 4.18.0**)
-- MoPub Volley Library (mopub-volley-1.1.0.jar - available on JCenter) (**Updated in 3.6.0**)
+- MoPub Volley Library (mopub-volley-2.0.0.jar - available on JCenter) (**Updated in 5.0.0**)
 - **Recommended** Google Play Services 11.4.0
 
+## Upgrading to SDK 5.0
+
+Please see the [Getting Started Guide](https://developers.mopub.com/docs/android/getting-started/) for instructions on upgrading from SDK 4.X to SDK 5.0.
+
+For GDPR-specific upgrading instructions, also see the [GDPR Integration Guide](https://developers.mopub.com/docs/publisher/gdpr).
+
 ## <a name="upgradeRepositoryViewability"></a>Upgrading from 4.15.0 and Prior
 In 4.16.0, dependencies were added to viewability libraries provided by AVID and Moat. Apps upgrading from previous versions must add
 `maven { url "https://s3.amazonaws.com/moat-sdk-builds" }`
@@ -134,7 +139,7 @@ Normally, to add the MoPub SDK to your app via JCenter, your `build.gradle` woul
 
 ```	
 dependencies {
-    compile('com.mopub:mopub-sdk:4.18.0@aar') {
+    implementation('com.mopub:mopub-sdk:5.2.0@aar') {
         transitive = true
     }
 }
@@ -143,7 +148,7 @@ Update to the following to exclude one or both viewability vendors:
 
 ```
 dependencies {
-    compile('com.mopub:mopub-sdk:4.19.0@aar') {
+    implementation('com.mopub:mopub-sdk:5.2.0@aar') {
         transitive = true
         exclude module: 'libAvid-mopub' // To exclude AVID
         exclude module: 'moat-mobile-app-kit' // To exclude Moat
diff --git a/build.gradle b/build.gradle
index e7b8ca18..62e69f6b 100644
--- a/build.gradle
+++ b/build.gradle
@@ -1,15 +1,15 @@
 buildscript {
     repositories {
-        mavenCentral()
         jcenter()
+        google()
     }
 
     dependencies {
-        classpath 'com.android.tools.build:gradle:2.3.0'
-        classpath 'com.novoda:bintray-release:0.4.0'
+        classpath 'com.android.tools.build:gradle:3.0.1'
+        classpath 'com.novoda:bintray-release:0.8.0'
     }
 }
 
 task wrapper(type: Wrapper) {
-    gradleVersion = '2.10'
+    gradleVersion = '4.3.1'
 }
diff --git a/extras/README.md b/extras/README.md
new file mode 100644
index 00000000..dae4df22
--- /dev/null
+++ b/extras/README.md
@@ -0,0 +1,5 @@
+# MoPub Android SDK
+
+We are formally separating network adapters from our MoPub SDK. This is to enable an independent release cadence resulting in faster updates and certification cycles. New mediation location is accessible [here](https://github.com/mopub/mopub-android-mediation).  
+
+We have also added an additional tool, making it easy for publishers to get up and running with the mediation integration. Check out https://developers.mopub.com/docs/mediation/integrate/ and integration instructions at https://developers.mopub.com/docs/android/integrating-networks/.
diff --git a/extras/src/com/mopub/mobileads/AdColonyInterstitial.java b/extras/src/com/mopub/mobileads/AdColonyInterstitial.java
deleted file mode 100644
index f0b08021..00000000
--- a/extras/src/com/mopub/mobileads/AdColonyInterstitial.java
+++ /dev/null
@@ -1,222 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.content.Context;
-import android.os.Handler;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.util.Log;
-
-import com.adcolony.sdk.AdColony;
-import com.adcolony.sdk.AdColonyAppOptions;
-import com.adcolony.sdk.AdColonyInterstitialListener;
-import com.adcolony.sdk.AdColonyZone;
-import com.mopub.common.util.Json;
-
-import java.util.Arrays;
-import java.util.Map;
-
-/**
- * Please reference the Supported Mediation Partner page at http://bit.ly/2mqsuFH for the latest version and ad format certifications.
- */
-public class AdColonyInterstitial extends CustomEventInterstitial {
-    private static final String TAG = "AdColonyInterstitial";
-    /*
-     * We recommend passing the AdColony client options, app ID, all zone IDs, and current zone ID
-     * in the serverExtras Map by specifying Custom Event Data in MoPub's web interface.
-     *
-     * Please see AdColony's documentation for more information:
-     * https://github.com/AdColony/AdColony-Android-SDK-3
-     */
-    private static final String DEFAULT_CLIENT_OPTIONS = "version=YOUR_APP_VERSION_HERE,store:google";
-    private static final String DEFAULT_APP_ID = "YOUR_AD_COLONY_APP_ID_HERE";
-    private static final String[] DEFAULT_ALL_ZONE_IDS = {"ZONE_ID_1", "ZONE_ID_2", "..."};
-    private static final String DEFAULT_ZONE_ID = "YOUR_CURRENT_ZONE_ID";
-
-    /*
-     * These keys are intended for MoPub internal use. Do not modify.
-     */
-    public static final String CLIENT_OPTIONS_KEY = "clientOptions";
-    public static final String APP_ID_KEY = "appId";
-    public static final String ALL_ZONE_IDS_KEY = "allZoneIds";
-    public static final String ZONE_ID_KEY = "zoneId";
-
-    private CustomEventInterstitialListener mCustomEventInterstitialListener;
-    private AdColonyInterstitialListener mAdColonyInterstitialListener;
-    private final Handler mHandler;
-    private com.adcolony.sdk.AdColonyInterstitial mAdColonyInterstitial;
-    private static String[] previousAdColonyAllZoneIds;
-
-    public AdColonyInterstitial() {
-        mHandler = new Handler();
-    }
-
-    @Override
-    protected void loadInterstitial(@NonNull Context context,
-            @NonNull CustomEventInterstitialListener customEventInterstitialListener,
-            @Nullable Map<String, Object> localExtras,
-            @NonNull Map<String, String> serverExtras) {
-        if (context == null
-                || !(context instanceof Activity)
-                || customEventInterstitialListener == null
-                || serverExtras == null) {
-            customEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        String clientOptions = DEFAULT_CLIENT_OPTIONS;
-        String appId = DEFAULT_APP_ID;
-        String[] allZoneIds = DEFAULT_ALL_ZONE_IDS;
-        String zoneId = DEFAULT_ZONE_ID;
-
-        mCustomEventInterstitialListener = customEventInterstitialListener;
-
-        if (extrasAreValid(serverExtras)) {
-            clientOptions = serverExtras.get(CLIENT_OPTIONS_KEY);
-            appId = serverExtras.get(APP_ID_KEY);
-            allZoneIds = extractAllZoneIds(serverExtras);
-            zoneId = serverExtras.get(ZONE_ID_KEY);
-        }
-        AdColonyAppOptions adColonyAppOptions = AdColonyAppOptions.getMoPubAppOptions(clientOptions);
-        mAdColonyInterstitialListener = getAdColonyInterstitialListener();
-        if (!isAdColonyConfigured()) {
-            AdColony.configure((Activity) context, adColonyAppOptions, appId, allZoneIds);
-        } else if ((shouldReconfigure(previousAdColonyAllZoneIds, allZoneIds))) {
-            // Need to check the zone IDs sent from the MoPub portal and reconfigure if they are
-            // different than the zones we initially called AdColony.configure() with
-            AdColony.configure((Activity) context, adColonyAppOptions, appId, allZoneIds);
-            previousAdColonyAllZoneIds = allZoneIds;
-        }
-
-        AdColony.requestInterstitial(zoneId, mAdColonyInterstitialListener);
-    }
-
-    @Override
-    protected void showInterstitial() {
-        if (mAdColonyInterstitial == null || mAdColonyInterstitial.isExpired()) {
-            Log.e(TAG, "AdColony interstitial ad is null or has expired");
-            mHandler.post(new Runnable() {
-                @Override
-                public void run() {
-                    mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.VIDEO_PLAYBACK_ERROR);
-                }
-            });
-        } else {
-            mAdColonyInterstitial.show();
-        }
-    }
-
-    @Override
-    protected void onInvalidate() {
-        if (mAdColonyInterstitial != null) {
-            mAdColonyInterstitialListener = null;
-            mAdColonyInterstitial.setListener(null);
-            mAdColonyInterstitial.destroy();
-            mAdColonyInterstitial = null;
-        }
-    }
-
-    private boolean isAdColonyConfigured() {
-        return !AdColony.getSDKVersion().isEmpty();
-    }
-
-    private AdColonyInterstitialListener getAdColonyInterstitialListener() {
-        if (mAdColonyInterstitialListener != null) {
-            return mAdColonyInterstitialListener;
-        } else {
-            return new AdColonyInterstitialListener() {
-                @Override
-                public void onRequestFilled(@NonNull com.adcolony.sdk.AdColonyInterstitial adColonyInterstitial) {
-                    mAdColonyInterstitial = adColonyInterstitial;
-                    Log.d(TAG, "AdColony interstitial ad has been successfully loaded.");
-                    mHandler.post(new Runnable() {
-                        @Override
-                        public void run() {
-                            mCustomEventInterstitialListener.onInterstitialLoaded();
-                        }
-                    });
-                }
-
-                @Override
-                public void onRequestNotFilled(@NonNull AdColonyZone zone) {
-                    Log.d(TAG, "AdColony interstitial ad has no fill.");
-                    mHandler.post(new Runnable() {
-                        @Override
-                        public void run() {
-                            mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-                        }
-                    });
-                }
-
-                @Override
-                public void onClosed(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-                    Log.d(TAG, "AdColony interstitial ad has been dismissed.");
-                    mHandler.post(new Runnable() {
-                        @Override
-                        public void run() {
-                            mCustomEventInterstitialListener.onInterstitialDismissed();
-                        }
-                    });
-                }
-
-                @Override
-                public void onOpened(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-                    Log.d(TAG, "AdColony interstitial ad shown: " + ad.getZoneID());
-                    mHandler.post(new Runnable() {
-                        @Override
-                        public void run() {
-                            mCustomEventInterstitialListener.onInterstitialShown();
-                        }
-                    });
-                }
-
-                @Override
-                public void onExpiring(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-                    Log.d(TAG, "AdColony interstitial ad is expiring; requesting new ad");
-                    AdColony.requestInterstitial(ad.getZoneID(), mAdColonyInterstitialListener);
-                }
-
-                @Override
-                public void onClicked(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-                    mCustomEventInterstitialListener.onInterstitialClicked();
-                }
-            };
-        }
-    }
-
-    private boolean extrasAreValid(Map<String, String> extras) {
-        return extras != null
-                && extras.containsKey(CLIENT_OPTIONS_KEY)
-                && extras.containsKey(APP_ID_KEY)
-                && extras.containsKey(ALL_ZONE_IDS_KEY)
-                && extras.containsKey(ZONE_ID_KEY);
-    }
-
-    private static boolean shouldReconfigure(String[] previousZones, String[] newZones) {
-        // If AdColony is configured already, but previousZones is null, then that means AdColony
-        // was configured with the AdColonyRewardedVideo adapter so attempt to configure with
-        // the ids in newZones. They will be ignored within the AdColony SDK if the zones are
-        // the same as the zones that the other adapter called AdColony.configure() with.
-        if (previousZones == null) {
-            return true;
-        } else if (newZones == null) {
-            return false;
-        } else if (previousZones.length != newZones.length) {
-            return true;
-        }
-        Arrays.sort(previousZones);
-        Arrays.sort(newZones);
-        return !Arrays.equals(previousZones, newZones);
-    }
-
-    private String[] extractAllZoneIds(Map<String, String> serverExtras) {
-        String[] result = Json.jsonArrayToStringArray(serverExtras.get(ALL_ZONE_IDS_KEY));
-
-        // AdColony requires at least one valid String in the allZoneIds array.
-        if (result.length == 0) {
-            result = new String[]{""};
-        }
-
-        return result;
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/AdColonyRewardedVideo.java b/extras/src/com/mopub/mobileads/AdColonyRewardedVideo.java
deleted file mode 100644
index accb01f2..00000000
--- a/extras/src/com/mopub/mobileads/AdColonyRewardedVideo.java
+++ /dev/null
@@ -1,401 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.os.Handler;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.util.Log;
-
-import com.adcolony.sdk.AdColony;
-import com.adcolony.sdk.AdColonyAdOptions;
-import com.adcolony.sdk.AdColonyAppOptions;
-import com.adcolony.sdk.AdColonyInterstitial;
-import com.adcolony.sdk.AdColonyInterstitialListener;
-import com.adcolony.sdk.AdColonyReward;
-import com.adcolony.sdk.AdColonyRewardListener;
-import com.adcolony.sdk.AdColonyZone;
-
-import com.mopub.common.BaseLifecycleListener;
-import com.mopub.common.DataKeys;
-import com.mopub.common.LifecycleListener;
-import com.mopub.common.MediationSettings;
-import com.mopub.common.MoPubReward;
-import com.mopub.common.util.Json;
-
-import java.util.Arrays;
-import java.util.Map;
-import java.util.WeakHashMap;
-import java.util.concurrent.ScheduledThreadPoolExecutor;
-import java.util.concurrent.TimeUnit;
-
-/**
- * Please reference the Supported Mediation Partner page at http://bit.ly/2mqsuFH for the latest version and ad format certifications.
- */
-public class AdColonyRewardedVideo extends CustomEventRewardedVideo {
-    private static final String TAG = "AdColonyRewardedVideo";
-    /*
-     * We recommend passing the AdColony client options, app ID, all zone IDs, and current zone ID
-     * in the serverExtras Map by specifying Custom Event Data in MoPub's web interface.
-     *
-     * Please see AdColony's documentation for more information:
-     * https://github.com/AdColony/AdColony-Android-SDK-3
-     */
-    private static final String DEFAULT_CLIENT_OPTIONS = "version=YOUR_APP_VERSION_HERE,store:google";
-    private static final String DEFAULT_APP_ID = "YOUR_AD_COLONY_APP_ID_HERE";
-    private static final String[] DEFAULT_ALL_ZONE_IDS = {"ZONE_ID_1", "ZONE_ID_2", "..."};
-    private static final String DEFAULT_ZONE_ID = "YOUR_CURRENT_ZONE_ID";
-
-    /*
-     * These keys are intended for MoPub internal use. Do not modify.
-     */
-    public static final String CLIENT_OPTIONS_KEY = "clientOptions";
-    public static final String APP_ID_KEY = "appId";
-    public static final String ALL_ZONE_IDS_KEY = "allZoneIds";
-    public static final String ZONE_ID_KEY = "zoneId";
-
-    private static boolean sInitialized = false;
-    private static LifecycleListener sLifecycleListener = new BaseLifecycleListener();
-    private static String[] previousAdColonyAllZoneIds;
-
-    AdColonyInterstitial mAd;
-    private String mZoneId;
-    private AdColonyListener mAdColonyListener;
-    private AdColonyAdOptions mAdColonyAdOptions = new AdColonyAdOptions();
-    private AdColonyAppOptions mAdColonyAppOptions = new AdColonyAppOptions();
-    private static WeakHashMap<String, AdColonyInterstitial> sZoneIdToAdMap = new WeakHashMap<>();
-
-
-    @Nullable
-    private String mAdUnitId;
-    private boolean mIsLoading = false;
-
-    // For waiting and notifying the SDK:
-    private final Handler mHandler;
-    private final ScheduledThreadPoolExecutor mScheduledThreadPoolExecutor;
-
-    public AdColonyRewardedVideo() {
-        mScheduledThreadPoolExecutor = new ScheduledThreadPoolExecutor(1);
-        mHandler = new Handler();
-    }
-
-    @Nullable
-    @Override
-    public CustomEventRewardedVideoListener getVideoListenerForSdk() {
-        return mAdColonyListener;
-    }
-
-    @Nullable
-    @Override
-    public LifecycleListener getLifecycleListener() {
-        return sLifecycleListener;
-    }
-
-    @NonNull
-    @Override
-    public String getAdNetworkId() {
-        return mZoneId;
-    }
-
-    @Override
-    protected void onInvalidate() {
-        mScheduledThreadPoolExecutor.shutdownNow();
-        AdColonyInterstitial ad = sZoneIdToAdMap.get(mZoneId);
-        if (ad != null) {
-            ad.setListener(null);
-            ad.destroy();
-            sZoneIdToAdMap.remove(mZoneId);
-            Log.d(TAG, "AdColony rewarded video destroyed");
-        }
-    }
-
-    @Override
-    public boolean checkAndInitializeSdk(@NonNull final Activity launcherActivity,
-            @NonNull final Map<String, Object> localExtras,
-            @NonNull final Map<String, String> serverExtras) throws Exception {
-        synchronized (AdColonyRewardedVideo.class) {
-            if (sInitialized) {
-                return false;
-            }
-
-            String adColonyClientOptions = DEFAULT_CLIENT_OPTIONS;
-            String adColonyAppId = DEFAULT_APP_ID;
-            String[] adColonyAllZoneIds = DEFAULT_ALL_ZONE_IDS;
-
-            // Set up serverExtras
-            if (extrasAreValid(serverExtras)) {
-                adColonyClientOptions = serverExtras.get(CLIENT_OPTIONS_KEY);
-                adColonyAppId = serverExtras.get(APP_ID_KEY);
-                adColonyAllZoneIds = extractAllZoneIds(serverExtras);
-            }
-
-            setUpGlobalSettings();
-            mAdColonyAppOptions = AdColonyAppOptions.getMoPubAppOptions(adColonyClientOptions);
-            if (!isAdColonyConfigured()) {
-                previousAdColonyAllZoneIds = adColonyAllZoneIds;
-                AdColony.configure(launcherActivity, mAdColonyAppOptions, adColonyAppId, adColonyAllZoneIds);
-            }
-
-            sInitialized = true;
-            return true;
-        }
-    }
-
-    @Override
-    protected void loadWithSdkInitialized(@NonNull final Activity activity,
-            @NonNull final Map<String, Object> localExtras,
-            @NonNull final Map<String, String> serverExtras) throws Exception {
-        mZoneId = DEFAULT_ZONE_ID;
-        if (extrasAreValid(serverExtras)) {
-            mZoneId = serverExtras.get(ZONE_ID_KEY);
-            String adColonyClientOptions = serverExtras.get(CLIENT_OPTIONS_KEY);
-            String adColonyAppId = serverExtras.get(APP_ID_KEY);
-            String[] adColonyAllZoneIds = extractAllZoneIds(serverExtras);
-
-            // Need to check the zone IDs sent from the MoPub portal and reconfigure if they are
-            // different than the zones we initially called AdColony.configure() with
-            if (shouldReconfigure(previousAdColonyAllZoneIds, adColonyAllZoneIds)) {
-                mAdColonyAppOptions = AdColonyAppOptions.getMoPubAppOptions(adColonyClientOptions);
-                AdColony.configure(activity, mAdColonyAppOptions, adColonyAppId, adColonyAllZoneIds);
-                previousAdColonyAllZoneIds = adColonyAllZoneIds;
-            }
-        }
-
-        Object adUnitObject = localExtras.get(DataKeys.AD_UNIT_ID_KEY);
-        if (adUnitObject != null && adUnitObject instanceof String) {
-            mAdUnitId = (String) adUnitObject;
-        }
-
-        sZoneIdToAdMap.put(mZoneId, null);
-        setUpAdOptions();
-        mAdColonyListener = new AdColonyListener(mAdColonyAdOptions);
-        AdColony.setRewardListener(mAdColonyListener);
-        AdColony.requestInterstitial(mZoneId, mAdColonyListener, mAdColonyAdOptions);
-        scheduleOnVideoReady();
-    }
-
-    private static boolean shouldReconfigure(String[] previousZones, String[] newZones) {
-        // If AdColony is configured already, but previousZones is null, then that means AdColony
-        // was configured with the AdColonyInterstitial adapter so attempt to configure with
-        // the ids in newZones. They will be ignored within the AdColony SDK if the zones are
-        // the same as the zones that the other adapter called AdColony.configure() with.
-        if (previousZones == null) {
-            return true;
-        } else if (newZones == null) {
-            return false;
-        } else if (previousZones.length != newZones.length) {
-            return true;
-        }
-        Arrays.sort(previousZones);
-        Arrays.sort(newZones);
-        return !Arrays.equals(previousZones, newZones);
-    }
-
-    private void setUpAdOptions() {
-        mAdColonyAdOptions.enableConfirmationDialog(getConfirmationDialogFromSettings());
-        mAdColonyAdOptions.enableResultsDialog(getResultsDialogFromSettings());
-    }
-
-    private boolean isAdColonyConfigured() {
-        return !AdColony.getSDKVersion().isEmpty();
-    }
-
-    @Override
-    public boolean hasVideoAvailable() {
-        return mAd != null && !mAd.isExpired();
-    }
-
-    @Override
-    public void showVideo() {
-        if (this.hasVideoAvailable()) {
-            mAd.show();
-        } else {
-            MoPubRewardedVideoManager.onRewardedVideoPlaybackError(
-                    AdColonyRewardedVideo.class,
-                    mZoneId,
-                    MoPubErrorCode.VIDEO_PLAYBACK_ERROR);
-        }
-    }
-
-    private boolean extrasAreValid(Map<String, String> extras) {
-        return extras != null
-                && extras.containsKey(CLIENT_OPTIONS_KEY)
-                && extras.containsKey(APP_ID_KEY)
-                && extras.containsKey(ALL_ZONE_IDS_KEY)
-                && extras.containsKey(ZONE_ID_KEY);
-    }
-
-    private String[] extractAllZoneIds(Map<String, String> serverExtras) {
-        String[] result = Json.jsonArrayToStringArray(serverExtras.get(ALL_ZONE_IDS_KEY));
-
-        // AdColony requires at least one valid String in the allZoneIds array.
-        if (result.length == 0) {
-            result = new String[]{""};
-        }
-
-        return result;
-    }
-
-    private void setUpGlobalSettings() {
-        final AdColonyGlobalMediationSettings globalMediationSettings =
-                MoPubRewardedVideoManager.getGlobalMediationSettings(AdColonyGlobalMediationSettings.class);
-        if (globalMediationSettings != null) {
-            if (globalMediationSettings.getUserId() != null) {
-                mAdColonyAppOptions.setUserID(globalMediationSettings.getUserId());
-            }
-        }
-    }
-
-    private boolean getConfirmationDialogFromSettings() {
-        final AdColonyInstanceMediationSettings settings =
-                MoPubRewardedVideoManager.getInstanceMediationSettings(AdColonyInstanceMediationSettings.class, mAdUnitId);
-        return settings != null && settings.withConfirmationDialog();
-    }
-
-    private boolean getResultsDialogFromSettings() {
-        final AdColonyInstanceMediationSettings settings =
-                MoPubRewardedVideoManager.getInstanceMediationSettings(AdColonyInstanceMediationSettings.class, mAdUnitId);
-        return settings != null && settings.withResultsDialog();
-    }
-
-    private void scheduleOnVideoReady() {
-        Runnable runnable = new Runnable() {
-            @Override
-            public void run() {
-                if (isAdAvailable(mZoneId)) {
-                    mAd = sZoneIdToAdMap.get(mZoneId);
-                    mIsLoading = false;
-                    mScheduledThreadPoolExecutor.shutdownNow();
-                    mHandler.post(new Runnable() {
-                        @Override
-                        public void run() {
-                            if (hasVideoAvailable()) {
-                                Log.d(TAG, "AdColony rewarded ad has been successfully loaded.");
-                                MoPubRewardedVideoManager.onRewardedVideoLoadSuccess(
-                                        AdColonyRewardedVideo.class,
-                                        mZoneId);
-                            } else {
-                                MoPubRewardedVideoManager.onRewardedVideoLoadFailure(
-                                        AdColonyRewardedVideo.class,
-                                        mZoneId,
-                                        MoPubErrorCode.NETWORK_NO_FILL);
-                            }
-                        }
-                    });
-                }
-            }
-        };
-
-        if (!mIsLoading) {
-            mScheduledThreadPoolExecutor.scheduleAtFixedRate(runnable, 1, 1, TimeUnit.SECONDS);
-            mIsLoading = true;
-        }
-    }
-
-    private boolean isAdAvailable(String zoneId) {
-        return sZoneIdToAdMap.get(zoneId) != null;
-    }
-
-    private static class AdColonyListener extends AdColonyInterstitialListener
-            implements AdColonyRewardListener, CustomEventRewardedVideoListener {
-        private static final String TAG = "AdColonyListener";
-        private AdColonyAdOptions mAdOptions;
-
-        AdColonyListener(AdColonyAdOptions adOptions) {
-            mAdOptions = adOptions;
-        }
-
-        @Override
-        public void onReward(@NonNull AdColonyReward a) {
-            MoPubReward reward;
-            if (a.success()) {
-                Log.d(TAG, "AdColonyReward name: " + a.getRewardName());
-                Log.d(TAG, "AdColonyReward amount: " + a.getRewardAmount());
-                reward = MoPubReward.success(a.getRewardName(), a.getRewardAmount());
-            } else {
-                Log.d(TAG, "AdColonyReward failed");
-                reward = MoPubReward.failure();
-            }
-
-            MoPubRewardedVideoManager.onRewardedVideoCompleted(
-                    AdColonyRewardedVideo.class,
-                    a.getZoneID(),
-                    reward);
-        }
-
-        @Override
-        public void onRequestFilled(@NonNull com.adcolony.sdk.AdColonyInterstitial adColonyInterstitial) {
-            sZoneIdToAdMap.put(adColonyInterstitial.getZoneID(), adColonyInterstitial);
-        }
-
-        @Override
-        public void onRequestNotFilled(@NonNull AdColonyZone zone) {
-            Log.d(TAG, "AdColony rewarded ad has no fill.");
-            MoPubRewardedVideoManager.onRewardedVideoLoadFailure(
-                    AdColonyRewardedVideo.class,
-                    zone.getZoneID(),
-                    MoPubErrorCode.NETWORK_NO_FILL);
-        }
-
-        @Override
-        public void onClosed(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-            Log.d(TAG, "AdColony rewarded ad has been dismissed.");
-            MoPubRewardedVideoManager.onRewardedVideoClosed(
-                    AdColonyRewardedVideo.class,
-                    ad.getZoneID());
-        }
-
-        @Override
-        public void onOpened(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-            Log.d(TAG, "AdColony rewarded ad shown: " + ad.getZoneID());
-            MoPubRewardedVideoManager.onRewardedVideoStarted(
-                    AdColonyRewardedVideo.class,
-                    ad.getZoneID());
-        }
-
-        @Override
-        public void onExpiring(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-            Log.d(TAG, "AdColony rewarded ad is expiring; requesting new ad");
-            AdColony.requestInterstitial(ad.getZoneID(), ad.getListener(), mAdOptions);
-        }
-
-        @Override
-        public void onClicked(@NonNull com.adcolony.sdk.AdColonyInterstitial ad) {
-            MoPubRewardedVideoManager.onRewardedVideoClicked(
-                    AdColonyRewardedVideo.class,
-                    ad.getZoneID());
-        }
-    }
-
-    public static final class AdColonyGlobalMediationSettings implements MediationSettings {
-        @Nullable
-        private final String mUserId;
-
-        public AdColonyGlobalMediationSettings(@Nullable String userId) {
-            mUserId = userId;
-        }
-
-        @Nullable
-        public String getUserId() {
-            return mUserId;
-        }
-    }
-
-    public static final class AdColonyInstanceMediationSettings implements MediationSettings {
-        private final boolean mWithConfirmationDialog;
-        private final boolean mWithResultsDialog;
-
-        public AdColonyInstanceMediationSettings(
-                boolean withConfirmationDialog, boolean withResultsDialog) {
-            mWithConfirmationDialog = withConfirmationDialog;
-            mWithResultsDialog = withResultsDialog;
-        }
-
-        public boolean withConfirmationDialog() {
-            return mWithConfirmationDialog;
-        }
-
-        public boolean withResultsDialog() {
-            return mWithResultsDialog;
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/ChartboostInterstitial.java b/extras/src/com/mopub/mobileads/ChartboostInterstitial.java
deleted file mode 100644
index 0201a1aa..00000000
--- a/extras/src/com/mopub/mobileads/ChartboostInterstitial.java
+++ /dev/null
@@ -1,91 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.content.Context;
-import android.support.annotation.NonNull;
-import android.text.TextUtils;
-import android.util.Log;
-
-import com.chartboost.sdk.Chartboost;
-import com.mopub.common.Preconditions;
-
-import java.util.Map;
-
-/**
- * A custom event for showing Chartboost interstitial ads.
- *
- * Certified with Chartboost 7.0.1
- */
-class ChartboostInterstitial extends CustomEventInterstitial {
-
-    @NonNull
-    private String mLocation = ChartboostShared.LOCATION_DEFAULT;
-
-    /*
-     * Note: Chartboost recommends implementing their specific Activity lifecycle callbacks in your
-     * Activity's onStart(), onStop(), onBackPressed() methods for proper results. Please see their
-     * documentation for more information.
-     */
-
-    /*
-     * Abstract methods from CustomEventInterstitial
-     */
-    @Override
-    protected void loadInterstitial(@NonNull Context context,
-            @NonNull CustomEventInterstitialListener interstitialListener,
-            @NonNull Map<String, Object> localExtras, @NonNull Map<String, String> serverExtras) {
-        Preconditions.checkNotNull(context);
-        Preconditions.checkNotNull(interstitialListener);
-        Preconditions.checkNotNull(localExtras);
-        Preconditions.checkNotNull(serverExtras);
-
-        if (!(context instanceof Activity)) {
-            interstitialListener.onInterstitialFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        if (serverExtras.containsKey(ChartboostShared.LOCATION_KEY)) {
-            String location = serverExtras.get(ChartboostShared.LOCATION_KEY);
-            mLocation = TextUtils.isEmpty(location) ? mLocation : location;
-        }
-
-        // If there's already a listener for this location, then another instance of
-        // CustomEventInterstitial is still active and we should fail.
-        if (ChartboostShared.getDelegate().hasInterstitialLocation(mLocation) &&
-                ChartboostShared.getDelegate().getInterstitialListener(mLocation) != interstitialListener) {
-            interstitialListener.onInterstitialFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        Activity activity = (Activity) context;
-        try {
-            ChartboostShared.initializeSdk(activity, serverExtras);
-            ChartboostShared.getDelegate().registerInterstitialListener(mLocation, interstitialListener);
-        } catch (NullPointerException e) {
-            interstitialListener.onInterstitialFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-            return;
-        } catch (IllegalStateException e) {
-            interstitialListener.onInterstitialFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        Chartboost.onCreate(activity);
-        Chartboost.onStart(activity);
-        if (Chartboost.hasInterstitial(mLocation)) {
-            ChartboostShared.getDelegate().didCacheInterstitial(mLocation);
-        } else {
-            Chartboost.cacheInterstitial(mLocation);
-        }
-    }
-
-    @Override
-    protected void showInterstitial() {
-        Log.d("MoPub", "Showing Chartboost interstitial ad.");
-        Chartboost.showInterstitial(mLocation);
-    }
-
-    @Override
-    protected void onInvalidate() {
-        ChartboostShared.getDelegate().unregisterInterstitialListener(mLocation);
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/ChartboostRewardedVideo.java b/extras/src/com/mopub/mobileads/ChartboostRewardedVideo.java
deleted file mode 100644
index bc994411..00000000
--- a/extras/src/com/mopub/mobileads/ChartboostRewardedVideo.java
+++ /dev/null
@@ -1,176 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.os.Handler;
-import android.support.annotation.NonNull;
-import android.text.TextUtils;
-
-import com.chartboost.sdk.Chartboost;
-import com.mopub.common.DataKeys;
-import com.mopub.common.LifecycleListener;
-import com.mopub.common.MediationSettings;
-import com.mopub.common.logging.MoPubLog;
-
-import java.util.Map;
-
-/**
- * A custom event for showing Chartboost rewarded videos.
- *
- * Certified with Chartboost 7.0.1
- */
-public class ChartboostRewardedVideo extends CustomEventRewardedVideo {
-    @NonNull private static final LifecycleListener sLifecycleListener =
-            new ChartboostLifecycleListener();
-
-    @NonNull private String mLocation = ChartboostShared.LOCATION_DEFAULT;
-    @NonNull private final Handler mHandler;
-
-    public ChartboostRewardedVideo() {
-        mHandler = new Handler();
-    }
-
-    @Override
-    @NonNull
-    public CustomEventRewardedVideoListener getVideoListenerForSdk() {
-        return ChartboostShared.getDelegate();
-    }
-
-    @Override
-    @NonNull
-    public LifecycleListener getLifecycleListener() {
-        return sLifecycleListener;
-    }
-
-    @Override
-    @NonNull
-    public String getAdNetworkId() {
-        return mLocation;
-    }
-
-    @Override
-    public boolean checkAndInitializeSdk(@NonNull Activity launcherActivity,
-            @NonNull Map<String, Object> localExtras,
-            @NonNull Map<String, String> serverExtras) throws Exception {
-        // We need to attempt to reinitialize Chartboost on each request, in case an interstitial has been
-        // loaded and used since then.
-        ChartboostShared.initializeSdk(launcherActivity, serverExtras);  // throws IllegalStateException
-
-        // Always return true so that the lifecycle listener is registered even if an interstitial
-        // did the initialization.
-        return true;
-    }
-
-    @Override
-    protected void loadWithSdkInitialized(@NonNull Activity activity,
-            @NonNull Map<String, Object> localExtras, @NonNull Map<String, String> serverExtras)
-            throws Exception {
-
-        if (serverExtras.containsKey(ChartboostShared.LOCATION_KEY)) {
-            String location = serverExtras.get(ChartboostShared.LOCATION_KEY);
-            mLocation = TextUtils.isEmpty(location) ? mLocation : location;
-        }
-
-        ChartboostShared.getDelegate().registerRewardedVideoLocation(mLocation);
-        setUpMediationSettingsForRequest((String) localExtras.get(DataKeys.AD_UNIT_ID_KEY));
-
-        // We do this to ensure that the custom event manager has a chance to get the listener
-        // and ad unit ID before any delegate callbacks are made.
-        mHandler.post(new Runnable() {
-            public void run() {
-                if (Chartboost.hasRewardedVideo(mLocation)) {
-                    ChartboostShared.getDelegate().didCacheRewardedVideo(mLocation);
-                } else {
-                    Chartboost.cacheRewardedVideo(mLocation);
-                }
-            }
-        });
-    }
-
-    private void setUpMediationSettingsForRequest(String moPubId) {
-        final ChartboostMediationSettings globalSettings =
-                MoPubRewardedVideoManager.getGlobalMediationSettings(ChartboostMediationSettings.class);
-        final ChartboostMediationSettings instanceSettings =
-                MoPubRewardedVideoManager.getInstanceMediationSettings(ChartboostMediationSettings.class, moPubId);
-
-        // Instance settings override global settings.
-        if (instanceSettings != null) {
-            Chartboost.setCustomId(instanceSettings.getCustomId());
-        } else if (globalSettings != null) {
-            Chartboost.setCustomId(globalSettings.getCustomId());
-        }
-    }
-
-    @Override
-    public boolean hasVideoAvailable() {
-        return Chartboost.hasRewardedVideo(mLocation);
-    }
-
-    @Override
-    public void showVideo() {
-        if (hasVideoAvailable()) {
-            Chartboost.showRewardedVideo(mLocation);
-        } else {
-            MoPubLog.d("Attempted to show Chartboost rewarded video before it was available.");
-        }
-    }
-
-    @Override
-    protected void onInvalidate() {
-        // This prevents sending didCache or didFailToCache callbacks.
-        ChartboostShared.getDelegate().unregisterRewardedVideoLocation(mLocation);
-    }
-
-    private static final class ChartboostLifecycleListener implements LifecycleListener {
-        @Override
-        public void onCreate(@NonNull Activity activity) {
-            Chartboost.onCreate(activity);
-        }
-
-        @Override
-        public void onStart(@NonNull Activity activity) {
-            Chartboost.onStart(activity);
-        }
-
-        @Override
-        public void onPause(@NonNull Activity activity) {
-            Chartboost.onPause(activity);
-        }
-
-        @Override
-        public void onResume(@NonNull Activity activity) {
-            Chartboost.onResume(activity);
-        }
-
-        @Override
-        public void onRestart(@NonNull Activity activity) {
-        }
-
-        @Override
-        public void onStop(@NonNull Activity activity) {
-            Chartboost.onStop(activity);
-        }
-
-        @Override
-        public void onDestroy(@NonNull Activity activity) {
-            Chartboost.onDestroy(activity);
-        }
-
-        @Override
-        public void onBackPressed(@NonNull Activity activity) {
-            Chartboost.onBackPressed();
-        }
-    }
-
-    public static final class ChartboostMediationSettings implements MediationSettings {
-        @NonNull private final String mCustomId;
-
-        public ChartboostMediationSettings(@NonNull final String customId) {
-            mCustomId = customId;
-        }
-
-        @NonNull
-        public String getCustomId() {
-            return mCustomId;
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/ChartboostShared.java b/extras/src/com/mopub/mobileads/ChartboostShared.java
deleted file mode 100644
index d70fb7ed..00000000
--- a/extras/src/com/mopub/mobileads/ChartboostShared.java
+++ /dev/null
@@ -1,296 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.util.Log;
-
-import com.chartboost.sdk.Chartboost;
-import com.chartboost.sdk.ChartboostDelegate;
-import com.chartboost.sdk.Model.CBError;
-import com.mopub.common.MoPub;
-import com.mopub.common.MoPubReward;
-import com.mopub.common.Preconditions;
-import com.mopub.common.VisibleForTesting;
-import com.mopub.common.logging.MoPubLog;
-import com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
-
-import java.util.Collections;
-import java.util.Map;
-import java.util.Set;
-import java.util.TreeMap;
-import java.util.TreeSet;
-
-import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR;
-import static com.mopub.mobileads.MoPubErrorCode.VIDEO_DOWNLOAD_ERROR;
-
-/**
- * Shared infrastructure for initializing the Chartboost SDK when mediated by MoPub
- *
- * Certified with Chartboost 7.0.1
- */
-public class ChartboostShared {
-    private static volatile ChartboostSingletonDelegate sDelegate = new ChartboostSingletonDelegate();
-
-    /*
-     * These keys are intended for MoPub internal use. Do not modify.
-     */
-    public static final String APP_ID_KEY = "appId";
-    public static final String APP_SIGNATURE_KEY = "appSignature";
-    public static final String LOCATION_KEY = "location";
-    public static final String LOCATION_DEFAULT = "Default";
-
-    @Nullable private static String mAppId;
-    @Nullable private static String mAppSignature;
-
-    /**
-     * Initialize the Chartboost SDK for the provided application id and app signature.
-     */
-    public static synchronized boolean initializeSdk(@NonNull Activity launcherActivity,
-            @NonNull Map<String, String> serverExtras) {
-        Preconditions.checkNotNull(launcherActivity);
-        Preconditions.checkNotNull(serverExtras);
-
-        // Validate Chartboost args
-        if (!serverExtras.containsKey(APP_ID_KEY)) {
-            throw new IllegalStateException("Chartboost rewarded video initialization" +
-                    " failed due to missing application ID.");
-        }
-
-        if (!serverExtras.containsKey(APP_SIGNATURE_KEY)) {
-            throw new IllegalStateException("Chartboost rewarded video initialization" +
-                    " failed due to missing application signature.");
-        }
-
-        final String appId = serverExtras.get(APP_ID_KEY);
-        final String appSignature = serverExtras.get(APP_SIGNATURE_KEY);
-
-        if (appId.equals(mAppId) && appSignature.equals(mAppSignature)) {
-            // We don't need to reinitialize.
-            return false;
-        }
-
-        mAppId = appId;
-        mAppSignature = appSignature;
-
-        // Perform all the common SDK initialization steps including startAppWithId
-        Chartboost.startWithAppId(launcherActivity, mAppId, mAppSignature);
-        Chartboost.setMediation(Chartboost.CBMediation.CBMediationMoPub, MoPub.SDK_VERSION);
-        Chartboost.setDelegate(sDelegate);
-        Chartboost.setShouldRequestInterstitialsInFirstSession(true);
-        Chartboost.setAutoCacheAds(false);
-        Chartboost.setShouldDisplayLoadingViewForMoreApps(false);
-
-        // Callers of this method need to call onCreate & onStart themselves.
-        return true;
-    }
-
-    @NonNull
-    public static ChartboostSingletonDelegate getDelegate() {
-        return sDelegate;
-    }
-
-    /**
-     * A {@link ChartboostDelegate} that can forward events for Chartboost interstitials
-     * and rewarded videos to the appropriate listener based on the Chartboost location used.
-     */
-    public static class ChartboostSingletonDelegate extends ChartboostDelegate
-            implements CustomEventRewardedVideo.CustomEventRewardedVideoListener {
-        private static final CustomEventInterstitialListener NULL_LISTENER =
-                new CustomEventInterstitialListener() {
-                    @Override
-                    public void onInterstitialLoaded() { }
-
-                    @Override
-                    public void onInterstitialFailed(MoPubErrorCode errorCode) { }
-
-                    @Override
-                    public void onInterstitialShown() { }
-
-                    @Override
-                    public void onInterstitialClicked() { }
-
-                    @Override
-                    public void onLeaveApplication() { }
-
-                    @Override
-                    public void onInterstitialDismissed() { }
-                };
-
-        //***************
-        // Chartboost Location Management for interstitials and rewarded videos
-        //***************
-
-        private Map<String, CustomEventInterstitialListener> mInterstitialListenersForLocation
-                = Collections.synchronizedMap(new TreeMap<String, CustomEventInterstitialListener>());
-
-        private Set<String> mRewardedVideoLocationsToLoad = Collections.synchronizedSet(new TreeSet<String>());
-
-        public void registerInterstitialListener(@NonNull String location,
-                @NonNull CustomEventInterstitialListener interstitialListener) {
-            Preconditions.checkNotNull(location);
-            Preconditions.checkNotNull(interstitialListener);
-            mInterstitialListenersForLocation.put(location, interstitialListener);
-        }
-
-        public void unregisterInterstitialListener(@NonNull String location) {
-            Preconditions.checkNotNull(location);
-            mInterstitialListenersForLocation.remove(location);
-        }
-
-        public void registerRewardedVideoLocation(@NonNull String location) {
-            Preconditions.checkNotNull(location);
-            mRewardedVideoLocationsToLoad.add(location);
-        }
-
-        public void unregisterRewardedVideoLocation(@NonNull String location) {
-            Preconditions.checkNotNull(location);
-            mRewardedVideoLocationsToLoad.remove(location);
-        }
-
-        @NonNull
-        public CustomEventInterstitialListener getInterstitialListener(@NonNull String location) {
-            final CustomEventInterstitialListener listener = mInterstitialListenersForLocation.get(location);
-            return listener != null ? listener : NULL_LISTENER;
-        }
-
-        public boolean hasInterstitialLocation(@NonNull String location) {
-            return mInterstitialListenersForLocation.containsKey(location);
-        }
-
-        //******************
-        // Chartboost Delegate methods.
-        //******************
-
-        //******************
-        // Interstitials
-        //******************
-        @Override
-        public void didCacheInterstitial(String location) {
-            MoPubLog.d("Chartboost interstitial loaded successfully.");
-            getInterstitialListener(location).onInterstitialLoaded();
-        }
-
-        @Override
-        public void didFailToLoadInterstitial(String location, CBError.CBImpressionError error) {
-            String suffix = error != null ? "Error: " + error.name() : "";
-            Log.d("MoPub", "Chartboost interstitial ad failed to load." + suffix);
-            getInterstitialListener(location).onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-        }
-
-        @Override
-        public void didDismissInterstitial(String location) {
-            // Note that this method is fired before didCloseInterstitial and didClickInterstitial.
-            MoPubLog.d("Chartboost interstitial ad dismissed.");
-            getInterstitialListener(location).onInterstitialDismissed();
-        }
-
-        @Override
-        public void didCloseInterstitial(String location) {
-            MoPubLog.d("Chartboost interstitial ad closed.");
-        }
-
-        @Override
-        public void didClickInterstitial(String location) {
-            MoPubLog.d("Chartboost interstitial ad clicked.");
-            getInterstitialListener(location).onInterstitialClicked();
-        }
-
-        @Override
-        public void didDisplayInterstitial(String location) {
-            MoPubLog.d("Chartboost interstitial ad shown.");
-            getInterstitialListener(location).onInterstitialShown();
-        }
-
-        //******************
-        // Rewarded Videos
-        //******************
-        @Override
-        public void didCacheRewardedVideo(String location) {
-            super.didCacheRewardedVideo(location);
-
-            if (mRewardedVideoLocationsToLoad.contains(location)) {
-                MoPubLog.d("Chartboost rewarded video cached for location " + location + ".");
-                MoPubRewardedVideoManager.onRewardedVideoLoadSuccess(ChartboostRewardedVideo.class, location);
-                mRewardedVideoLocationsToLoad.remove(location);
-            }
-        }
-
-        @Override
-        public void didFailToLoadRewardedVideo(String location, CBError.CBImpressionError error) {
-            super.didFailToLoadRewardedVideo(location, error);
-            String suffix = error != null ? " with error: " + error.name() : "";
-            if (mRewardedVideoLocationsToLoad.contains(location)) {
-                MoPubErrorCode errorCode = VIDEO_DOWNLOAD_ERROR;
-                MoPubLog.d("Chartboost rewarded video cache failed for location " + location + suffix);
-                if (CBError.CBImpressionError.INVALID_LOCATION.equals(error)) {
-                    errorCode = ADAPTER_CONFIGURATION_ERROR;
-                }
-                MoPubRewardedVideoManager.onRewardedVideoLoadFailure(ChartboostRewardedVideo.class, location, errorCode);
-                mRewardedVideoLocationsToLoad.remove(location);
-            }
-        }
-
-        @Override
-        public void didDismissRewardedVideo(String location) {
-            // This is called before didCloseRewardedVideo and didClickRewardedVideo
-            super.didDismissRewardedVideo(location);
-            MoPubRewardedVideoManager.onRewardedVideoClosed(ChartboostRewardedVideo.class, location);
-            MoPubLog.d("Chartboost rewarded video dismissed for location " + location + ".");
-        }
-
-        @Override
-        public void didCloseRewardedVideo(String location) {
-            super.didCloseRewardedVideo(location);
-            MoPubLog.d("Chartboost rewarded video closed for location " + location + ".");
-        }
-
-        @Override
-        public void didClickRewardedVideo(String location) {
-            super.didClickRewardedVideo(location);
-            MoPubRewardedVideoManager.onRewardedVideoClicked(ChartboostRewardedVideo.class, location);
-            MoPubLog.d("Chartboost rewarded video clicked for location " + location + ".");
-        }
-
-        @Override
-        public void didCompleteRewardedVideo(String location, int reward) {
-            super.didCompleteRewardedVideo(location, reward);
-            MoPubLog.d("Chartboost rewarded video completed for location " + location + " with "
-                    + "reward amount " + reward);
-            MoPubRewardedVideoManager.onRewardedVideoCompleted(
-                    ChartboostRewardedVideo.class,
-                    location,
-                    MoPubReward.success(MoPubReward.NO_REWARD_LABEL, reward));
-        }
-
-        @Override
-        public void didDisplayRewardedVideo(String location) {
-            super.didDisplayRewardedVideo(location);
-            MoPubLog.d("Chartboost rewarded video displayed for location " + location + ".");
-            MoPubRewardedVideoManager.onRewardedVideoStarted(ChartboostRewardedVideo.class, location);
-        }
-
-        //******************
-        // More Apps
-        //******************
-        @Override
-        public boolean shouldRequestMoreApps(String location) {
-            return false;
-        }
-
-        @Override
-        public boolean shouldDisplayMoreApps(final String location) {
-            return false;
-        }
-    }
-
-
-    @VisibleForTesting
-    @Deprecated
-    static void reset() {
-        // Clears all the locations to load and other state.
-        sDelegate = new ChartboostSingletonDelegate();
-        mAppId = null;
-        mAppSignature = null;
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/FlurryAgentWrapper.java b/extras/src/com/mopub/mobileads/FlurryAgentWrapper.java
deleted file mode 100644
index 38ebcd8d..00000000
--- a/extras/src/com/mopub/mobileads/FlurryAgentWrapper.java
+++ /dev/null
@@ -1,82 +0,0 @@
-package com.mopub.mobileads;
-
-import android.content.Context;
-import android.os.Build;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.text.TextUtils;
-import android.util.Log;
-
-import com.flurry.android.FlurryAgent;
-import com.flurry.android.FlurryAgentListener;
-
-/**
- * Certified with Flurry 8.1.0
- */
-public final class FlurryAgentWrapper {
-    public static final String PARAM_API_KEY = "apiKey";
-    public static final String PARAM_AD_SPACE_NAME = "adSpaceName";
-
-    private static final String ORIGIN_IDENTIFIER = "Flurry_Mopub_Android";
-    private static final String ORIGIN_VERSION = "6.5.0";
-
-    private FlurryAgent.Builder mAgentBuilder;
-
-    public static FlurryAgentWrapper getInstance() {
-        return FlurryAgentLoader.INSTANCE;
-    }
-
-    private FlurryAgentWrapper() {
-        mAgentBuilder = new FlurryAgent.Builder()
-                .withLogEnabled(false)
-                .withLogLevel(Log.INFO);
-
-        FlurryAgent.addOrigin(ORIGIN_IDENTIFIER, ORIGIN_VERSION);
-    }
-
-    public synchronized void startSession(@NonNull final Context context,
-            final String apiKey,
-            @Nullable FlurryAgentListener flurryAgentListener) {
-        // validate parameters
-        if (TextUtils.isEmpty(apiKey)) {
-            return;
-        }
-
-        // init
-        if (!FlurryAgent.isSessionActive()) {
-            mAgentBuilder.withListener(flurryAgentListener) // withListener allows nulls
-                    .build(context, apiKey);
-
-            // sessions are automatic on ICS+
-            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
-                return;
-            }
-
-            FlurryAgent.onStartSession(context);
-        }
-    }
-
-    public synchronized void endSession(final Context context) {
-        // validate parameters
-        if (context == null) {
-            return;
-        }
-
-        if (FlurryAgent.isSessionActive()) {
-            // sessions are automatic on ICS+
-            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
-                return;
-            }
-
-            FlurryAgent.onEndSession(context);
-        }
-    }
-
-    public synchronized boolean isSessionActive() {
-        return FlurryAgent.isSessionActive();
-    }
-
-    private static class FlurryAgentLoader {
-        private static final FlurryAgentWrapper INSTANCE = new FlurryAgentWrapper();
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/FlurryCustomEventBanner.java b/extras/src/com/mopub/mobileads/FlurryCustomEventBanner.java
deleted file mode 100644
index 8a31a9d7..00000000
--- a/extras/src/com/mopub/mobileads/FlurryCustomEventBanner.java
+++ /dev/null
@@ -1,196 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.content.Context;
-import android.text.TextUtils;
-import android.util.Log;
-import android.widget.FrameLayout;
-
-import com.flurry.android.ads.FlurryAdBanner;
-import com.flurry.android.ads.FlurryAdBannerListener;
-import com.flurry.android.ads.FlurryAdErrorType;
-
-import java.util.Map;
-
-import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR;
-import static com.mopub.mobileads.MoPubErrorCode.NETWORK_INVALID_STATE;
-import static com.mopub.mobileads.MoPubErrorCode.NETWORK_NO_FILL;
-import static com.mopub.mobileads.MoPubErrorCode.UNSPECIFIED;
-
-/**
- * Certified with Flurry 8.1.0
- */
-class FlurryCustomEventBanner extends com.mopub.mobileads.CustomEventBanner {
-    private static final String LOG_TAG = FlurryCustomEventBanner.class.getSimpleName();
-
-    private Context mContext;
-    private CustomEventBannerListener mListener;
-    private FrameLayout mLayout;
-
-    private String mAdSpaceName;
-
-    private FlurryAdBanner mBanner;
-
-    // CustomEventBanner
-    @Override
-    protected void loadBanner(Context context,
-            CustomEventBannerListener listener,
-            Map<String, Object> localExtras, Map<String, String> serverExtras) {
-        if (context == null) {
-            Log.e(LOG_TAG, "Context cannot be null.");
-            listener.onBannerFailed(ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        if (listener == null) {
-            Log.e(LOG_TAG, "CustomEventBannerListener cannot be null.");
-            return;
-        }
-
-        if (!(context instanceof Activity)) {
-            Log.e(LOG_TAG, "Ad can be rendered only in Activity context.");
-            listener.onBannerFailed(ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        if (!validateExtras(serverExtras)) {
-            Log.e(LOG_TAG, "Failed banner ad fetch: Missing required server extras" +
-                    " [FLURRY_APIKEY and/or FLURRY_ADSPACE].");
-            listener.onBannerFailed(ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        mContext = context;
-        mListener = listener;
-        mLayout = new FrameLayout(context);
-
-        String apiKey = serverExtras.get(FlurryAgentWrapper.PARAM_API_KEY);
-        mAdSpaceName = serverExtras.get(FlurryAgentWrapper.PARAM_AD_SPACE_NAME);
-
-        FlurryAgentWrapper.getInstance().startSession(context, apiKey, null);
-
-        Log.d(LOG_TAG, "Fetching Flurry ad, ad unit name:" + mAdSpaceName);
-        mBanner = new FlurryAdBanner(mContext, mLayout, mAdSpaceName);
-        mBanner.setListener(new FlurryMopubBannerListener());
-        mBanner.fetchAd();
-    }
-
-    @Override
-    protected void onInvalidate() {
-        if (mContext == null) {
-            return;
-        }
-
-        Log.d(LOG_TAG, "MoPub issued onInvalidate. Flurry ad unit: " + mAdSpaceName);
-
-        if (mBanner != null) {
-            mBanner.destroy();
-            mBanner = null;
-        }
-
-        FlurryAgentWrapper.getInstance().endSession(mContext);
-
-        mContext = null;
-        mListener = null;
-        mLayout = null;
-    }
-
-    private boolean validateExtras(final Map<String, String> serverExtras) {
-        if (serverExtras == null) {
-            return false;
-        }
-
-        final String flurryApiKey = serverExtras.get(FlurryAgentWrapper.PARAM_API_KEY);
-        final String flurryAdSpace = serverExtras.get(FlurryAgentWrapper.PARAM_AD_SPACE_NAME);
-        Log.i(LOG_TAG, "ServerInfo fetched from Mopub " + FlurryAgentWrapper.PARAM_API_KEY + " : "
-                + flurryApiKey + " and " + FlurryAgentWrapper.PARAM_AD_SPACE_NAME + " :" +
-                flurryAdSpace);
-
-        return (!TextUtils.isEmpty(flurryApiKey) && !TextUtils.isEmpty(flurryAdSpace));
-    }
-
-    // FlurryAdListener
-    private class FlurryMopubBannerListener implements FlurryAdBannerListener {
-        private final String LOG_TAG = getClass().getSimpleName();
-
-        @Override
-        public void onFetched(FlurryAdBanner adBanner) {
-            Log.d(LOG_TAG, "onFetched: Flurry banner ad fetched successfully!");
-
-            if (mBanner != null) {
-                mBanner.displayAd();
-            }
-        }
-
-        @Override
-        public void onRendered(FlurryAdBanner adBanner) {
-            Log.d(LOG_TAG, "onRendered: Flurry banner ad rendered");
-
-            if (mListener != null) {
-                mListener.onBannerLoaded(mLayout);
-            }
-        }
-
-        @Override
-        public void onShowFullscreen(FlurryAdBanner adBanner) {
-            Log.d(LOG_TAG, "onFetched: Flurry banner ad in full-screen");
-
-            if (mListener != null) {
-                mListener.onBannerExpanded();
-            }
-        }
-
-        @Override
-        public void onCloseFullscreen(FlurryAdBanner adBanner) {
-            Log.d(LOG_TAG, "onCloseFullscreen: Flurry banner ad full-screen closed");
-
-            if (mListener != null) {
-                mListener.onBannerCollapsed();
-            }
-        }
-
-        @Override
-        public void onAppExit(FlurryAdBanner adBanner) {
-            Log.d(LOG_TAG, "onAppExit: Flurry banner ad exited app");
-        }
-
-        @Override
-        public void onClicked(FlurryAdBanner adBanner) {
-            Log.d(LOG_TAG, "onClicked: Flurry banner ad clicked");
-
-            if (mListener != null) {
-                mListener.onBannerClicked();
-            }
-        }
-
-        @Override
-        public void onVideoCompleted(FlurryAdBanner adBanner) {
-            Log.d(LOG_TAG, "onVideoCompleted: Flurry banner ad video completed");
-
-            // no-op
-        }
-
-        @Override
-        public void onError(FlurryAdBanner adBanner, FlurryAdErrorType adErrorType,
-                int errorCode) {
-            Log.d(LOG_TAG, String.format("onError: Flurry banner ad not available. " +
-                    "Error type: %s. Error code: %s", adErrorType.toString(), errorCode));
-
-            if (mListener != null) {
-                switch (adErrorType) {
-                    case FETCH:
-                        mListener.onBannerFailed(NETWORK_NO_FILL);
-                        return;
-                    case RENDER:
-                        mListener.onBannerFailed(NETWORK_INVALID_STATE);
-                        return;
-                    case CLICK:
-                        // Don't call onBannerFailed in this case.
-                        return;
-                    default:
-                        mListener.onBannerFailed(UNSPECIFIED);
-                }
-            }
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/FlurryCustomEventInterstitial.java b/extras/src/com/mopub/mobileads/FlurryCustomEventInterstitial.java
deleted file mode 100644
index c912b75a..00000000
--- a/extras/src/com/mopub/mobileads/FlurryCustomEventInterstitial.java
+++ /dev/null
@@ -1,200 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.content.Context;
-import android.text.TextUtils;
-import android.util.Log;
-
-import com.flurry.android.ads.FlurryAdErrorType;
-import com.flurry.android.ads.FlurryAdInterstitial;
-import com.flurry.android.ads.FlurryAdInterstitialListener;
-
-import java.util.Map;
-
-import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR;
-import static com.mopub.mobileads.MoPubErrorCode.NETWORK_INVALID_STATE;
-import static com.mopub.mobileads.MoPubErrorCode.NETWORK_NO_FILL;
-import static com.mopub.mobileads.MoPubErrorCode.UNSPECIFIED;
-
-/**
- * Certified with Flurry 8.1.0
- */
-class FlurryCustomEventInterstitial extends com.mopub.mobileads.CustomEventInterstitial {
-    private static final String LOG_TAG = FlurryCustomEventInterstitial.class.getSimpleName();
-
-    private Context mContext;
-    private CustomEventInterstitialListener mListener;
-
-    private String mAdSpaceName;
-
-    private FlurryAdInterstitial mInterstitial;
-
-    // CustomEventInterstitial
-    @Override
-    protected void loadInterstitial(Context context,
-            CustomEventInterstitialListener listener,
-            Map<String, Object> localExtras,
-            Map<String, String> serverExtras) {
-        if (context == null) {
-            Log.e(LOG_TAG, "Context cannot be null.");
-            listener.onInterstitialFailed(ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        if (listener == null) {
-            Log.e(LOG_TAG, "CustomEventInterstitialListener cannot be null.");
-            return;
-        }
-
-        if (!(context instanceof Activity)) {
-            Log.e(LOG_TAG, "Ad can be rendered only in Activity context.");
-            listener.onInterstitialFailed(ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        if (!validateExtras(serverExtras)) {
-            Log.e(LOG_TAG, "Failed interstitial ad fetch: Missing required server extras" +
-                    " [FLURRY_APIKEY and/or FLURRY_ADSPACE].");
-            listener.onInterstitialFailed(ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        mContext = context;
-        mListener = listener;
-
-        String apiKey = serverExtras.get(FlurryAgentWrapper.PARAM_API_KEY);
-        mAdSpaceName = serverExtras.get(FlurryAgentWrapper.PARAM_AD_SPACE_NAME);
-
-        FlurryAgentWrapper.getInstance().startSession(context, apiKey, null);
-
-        Log.d(LOG_TAG, "Fetching Flurry ad, ad unit name:" + mAdSpaceName);
-        mInterstitial = new FlurryAdInterstitial(mContext, mAdSpaceName);
-        mInterstitial.setListener(new FlurryMopubInterstitialListener());
-        mInterstitial.fetchAd();
-    }
-
-    @Override
-    protected void onInvalidate() {
-        if (mContext == null) {
-            return;
-        }
-
-        Log.d(LOG_TAG, "MoPub issued onInvalidate (" + mAdSpaceName + ")");
-
-        if (mInterstitial != null) {
-            mInterstitial.destroy();
-            mInterstitial = null;
-        }
-
-        FlurryAgentWrapper.getInstance().endSession(mContext);
-
-        mContext = null;
-        mListener = null;
-    }
-
-    @Override
-    protected void showInterstitial() {
-        Log.d(LOG_TAG, "MoPub issued showInterstitial (" + mAdSpaceName + ")");
-
-        if (mInterstitial != null) {
-            mInterstitial.displayAd();
-        }
-    }
-
-    private boolean validateExtras(final Map<String, String> serverExtras) {
-        if (serverExtras == null) {
-            return false;
-        }
-
-        final String flurryApiKey = serverExtras.get(FlurryAgentWrapper.PARAM_API_KEY);
-        final String flurryAdSpace = serverExtras.get(FlurryAgentWrapper.PARAM_AD_SPACE_NAME);
-        Log.i(LOG_TAG, "ServerInfo fetched from Mopub " + FlurryAgentWrapper.PARAM_API_KEY + " : "
-                + flurryApiKey + " and " + FlurryAgentWrapper.PARAM_AD_SPACE_NAME + " :" +
-                flurryAdSpace);
-
-        return (!TextUtils.isEmpty(flurryApiKey) && !TextUtils.isEmpty(flurryAdSpace));
-    }
-
-    // FlurryAdListener
-    private class FlurryMopubInterstitialListener implements FlurryAdInterstitialListener {
-        private final String LOG_TAG = getClass().getSimpleName();
-
-        @Override
-        public void onFetched(FlurryAdInterstitial adInterstitial) {
-            Log.d(LOG_TAG, "onFetched: Flurry interstitial ad fetched successfully!");
-
-            if (mListener != null) {
-                mListener.onInterstitialLoaded();
-            }
-        }
-
-        @Override
-        public void onRendered(FlurryAdInterstitial adInterstitial) {
-            Log.d(LOG_TAG, "onRendered: Flurry interstitial ad rendered");
-
-            if (mListener != null) {
-                mListener.onInterstitialShown();
-            }
-        }
-
-        @Override
-        public void onDisplay(FlurryAdInterstitial adInterstitial) {
-            Log.d(LOG_TAG, "onDisplay: Flurry interstitial ad displayed");
-
-            // no-op
-        }
-
-        @Override
-        public void onClose(FlurryAdInterstitial adInterstitial) {
-            Log.d(LOG_TAG, "onClose: Flurry interstitial ad closed");
-
-            if (mListener != null) {
-                mListener.onInterstitialDismissed();
-            }
-        }
-
-        @Override
-        public void onAppExit(FlurryAdInterstitial adInterstitial) {
-            Log.d(LOG_TAG, "onAppExit: Flurry interstitial ad exited app");
-        }
-
-        @Override
-        public void onClicked(FlurryAdInterstitial adInterstitial) {
-            Log.d(LOG_TAG, "onClicked: Flurry interstitial ad clicked");
-
-            if (mListener != null) {
-                mListener.onInterstitialClicked();
-            }
-        }
-
-        @Override
-        public void onVideoCompleted(FlurryAdInterstitial adInterstitial) {
-            Log.d(LOG_TAG, "onVideoCompleted: Flurry interstitial ad video completed");
-
-            // no-op
-        }
-
-        @Override
-        public void onError(FlurryAdInterstitial adInterstitial, FlurryAdErrorType adErrorType,
-                int errorCode) {
-            Log.d(LOG_TAG, String.format("onError: Flurry interstitial ad not available. " +
-                    "Error type: %s. Error code: %s", adErrorType.toString(), errorCode));
-
-            if (mListener != null) {
-                switch (adErrorType) {
-                    case FETCH:
-                        mListener.onInterstitialFailed(NETWORK_NO_FILL);
-                        return;
-                    case RENDER:
-                        mListener.onInterstitialFailed(NETWORK_INVALID_STATE);
-                        return;
-                    case CLICK:
-                        // Don't call onInterstitialFailed in this case.
-                        return;
-                    default:
-                        mListener.onInterstitialFailed(UNSPECIFIED);
-                }
-            }
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/MillennialBanner.java b/extras/src/com/mopub/mobileads/MillennialBanner.java
deleted file mode 100644
index 0a329984..00000000
--- a/extras/src/com/mopub/mobileads/MillennialBanner.java
+++ /dev/null
@@ -1,254 +0,0 @@
-package com.mopub.mobileads;
-
-import android.content.Context;
-import android.util.Log;
-import android.view.Gravity;
-import android.widget.FrameLayout;
-import android.widget.FrameLayout.LayoutParams;
-
-import com.millennialmedia.AppInfo;
-import com.millennialmedia.CreativeInfo;
-import com.millennialmedia.InlineAd;
-import com.millennialmedia.InlineAd.AdSize;
-import com.millennialmedia.InlineAd.InlineAdMetadata;
-import com.millennialmedia.InlineAd.InlineErrorStatus;
-import com.millennialmedia.MMException;
-import com.millennialmedia.MMLog;
-import com.millennialmedia.MMSDK;
-import com.mopub.common.MoPub;
-
-import java.util.Map;
-
-
-/**
- * Compatible with version 6.6 of the Millennial Media SDK.
- */
-
-final class MillennialBanner extends CustomEventBanner {
-
-    private static final String TAG = MillennialBanner.class.getSimpleName();
-
-    private static final String DCN_KEY = "dcn";
-    private static final String APID_KEY = "adUnitID";
-    private static final String AD_WIDTH_KEY = "adWidth";
-    private static final String AD_HEIGHT_KEY = "adHeight";
-
-    private InlineAd inlineAd;
-    private CustomEventBannerListener bannerListener;
-    private FrameLayout internalView;
-
-    static {
-        Log.i(TAG, "Millennial Media Adapter Version: " + MillennialUtils.VERSION);
-    }
-
-
-    public CreativeInfo getCreativeInfo() {
-
-        if (inlineAd == null) {
-            return null;
-        }
-
-        return inlineAd.getCreativeInfo();
-    }
-
-    
-    @Override
-    protected void loadBanner(final Context context, final CustomEventBannerListener customEventBannerListener,
-                              final Map<String, Object> localExtras, final Map<String, String> serverExtras) {
-
-        bannerListener = customEventBannerListener;
-        if (!MillennialUtils.initSdk(context)) {
-            Log.e(TAG, "MM SDK must be initialized with an Activity or Application context.");
-            bannerListener.onBannerFailed(MoPubErrorCode.INTERNAL_ERROR);
-            return;
-        }
-
-        String apid = serverExtras.get(APID_KEY);
-        int width = Integer.parseInt(serverExtras.get(AD_WIDTH_KEY));
-        int height = Integer.parseInt(serverExtras.get(AD_HEIGHT_KEY));
-
-        if (MillennialUtils.isEmpty(apid) || (width < 0) || (height < 0)) {
-            Log.e(TAG, "We were given invalid extras! Make sure placement ID, width, and height are specified.");
-            bannerListener.onBannerFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        // Set DCN on the AppInfo if provided
-        String dcn = serverExtras.get(DCN_KEY);
-        AppInfo ai = new AppInfo().setMediator("mopubsdk");
-        if (!MillennialUtils.isEmpty(dcn)) {
-            ai.setSiteId(dcn);
-        }
-
-        try {
-
-            MMSDK.setAppInfo(ai);
-
-            internalView = new FrameLayout(context);
-
-            LayoutParams lp = new LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.WRAP_CONTENT);
-            lp.gravity = Gravity.CENTER_HORIZONTAL;
-            internalView.setLayoutParams(lp);
-
-            inlineAd = InlineAd.createInstance(apid, internalView);
-            InlineAdMetadata mInlineAdMetadata = new InlineAdMetadata().setAdSize(new AdSize(width, height));
-
-            inlineAd.setListener(new MillennialInlineListener());
-
-            MMSDK.setLocationEnabled(MoPub.getLocationAwareness() != MoPub.LocationAwareness.DISABLED);
-
-            AdViewController.setShouldHonorServerDimensions(internalView);
-
-            inlineAd.request(mInlineAdMetadata);
-
-        } catch (MMException e) {
-            Log.e(TAG, "MM SDK exception occurred obtaining an inline ad unit.", e);
-            bannerListener.onBannerFailed(MoPubErrorCode.INTERNAL_ERROR);
-        }
-    }
-
-
-    @Override
-    protected void onInvalidate() {
-        // Destroy any hanging references.
-        if (inlineAd != null) {
-            inlineAd.destroy();
-            inlineAd = null;
-        }
-    }
-
-
-    class MillennialInlineListener implements InlineAd.InlineListener {
-
-        @Override
-        public void onAdLeftApplication(InlineAd inlineAd) {
-            // onLeaveApplication is an alias to on clicked. We are not required to call this.
-
-            // @formatter:off
-            // https://github.com/mopub/mopub-android-sdk/blob/940eee70fe1980b4869d61cb5d668ccbab75c0ee/mopub-sdk/mopub-sdk-interstitial/src/main/java/com/mopub/mobileads/CustomEventInterstitial.java
-            // @formatter:on
-            Log.d(TAG, "Millennial Inline Ad - Leaving application");
-        }
-
-
-        @Override
-        public void onClicked(InlineAd inlineAd) {
-
-            Log.d(TAG, "Millennial Inline Ad - Ad clicked");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    bannerListener.onBannerClicked();
-                }
-            });
-        }
-
-
-        @Override
-        public void onCollapsed(InlineAd inlineAd) {
-
-            Log.d(TAG, "Millennial Inline Ad - Banner collapsed");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    bannerListener.onBannerCollapsed();
-                }
-            });
-
-        }
-
-
-        @Override
-        public void onExpanded(InlineAd inlineAd) {
-
-            Log.d(TAG, "Millennial Inline Ad - Banner expanded");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    bannerListener.onBannerExpanded();
-                }
-            });
-        }
-
-
-        @Override
-        public void onRequestFailed(InlineAd inlineAd, InlineErrorStatus inlineErrorStatus) {
-
-            Log.d(TAG, "Millennial Inline Ad - Banner failed (" + inlineErrorStatus.getErrorCode() + "): " +
-                    inlineErrorStatus.getDescription());
-
-            MoPubErrorCode mopubErrorCode;
-
-            switch (inlineErrorStatus.getErrorCode()) {
-                case InlineErrorStatus.ADAPTER_NOT_FOUND:
-                    mopubErrorCode = MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR;
-                    break;
-                case InlineErrorStatus.DISPLAY_FAILED:
-                    mopubErrorCode = MoPubErrorCode.INTERNAL_ERROR;
-                    break;
-                case InlineErrorStatus.INIT_FAILED:
-                    mopubErrorCode = MoPubErrorCode.WARMUP;
-                    break;
-                case InlineErrorStatus.NO_NETWORK:
-                    mopubErrorCode = MoPubErrorCode.NO_CONNECTION;
-                    break;
-                case InlineErrorStatus.UNKNOWN:
-                    mopubErrorCode = MoPubErrorCode.UNSPECIFIED;
-                    break;
-                case InlineErrorStatus.LOAD_FAILED:
-                default:
-                    mopubErrorCode = MoPubErrorCode.NETWORK_NO_FILL;
-            }
-
-            final MoPubErrorCode fErrorCode = mopubErrorCode;
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    bannerListener.onBannerFailed(fErrorCode);
-                }
-            });
-
-        }
-
-
-        @Override
-        public void onRequestSucceeded(InlineAd inlineAd) {
-
-            Log.d(TAG, "Millennial Inline Ad - Banner request succeeded");
-
-            CreativeInfo creativeInfo = getCreativeInfo();
-
-            if ((creativeInfo != null) && MMLog.isDebugEnabled()) {
-                MMLog.d(TAG, "Banner Creative Info: " + creativeInfo);
-            }
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    bannerListener.onBannerLoaded(internalView);
-                }
-            });
-        }
-
-
-        @Override
-        public void onResize(InlineAd inlineAd, int w, int h) {
-
-            Log.d(TAG, "Millennial Inline Ad - Banner about to resize (width: " + w + ", height: " + h + ")");
-        }
-
-
-        @Override
-        public void onResized(InlineAd inlineAd, int w, int h, boolean isClosed) {
-
-            Log.d(TAG, "Millennial Inline Ad - Banner resized (width: " + w + ", height: " + h + "). " +
-                    (isClosed ? "Returned to original placement." : "Got a fresh, new place."));
-
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/MillennialInterstitial.java b/extras/src/com/mopub/mobileads/MillennialInterstitial.java
deleted file mode 100644
index cbb6c879..00000000
--- a/extras/src/com/mopub/mobileads/MillennialInterstitial.java
+++ /dev/null
@@ -1,266 +0,0 @@
-package com.mopub.mobileads;
-
-import android.content.Context;
-import android.util.Log;
-
-import com.millennialmedia.AppInfo;
-import com.millennialmedia.CreativeInfo;
-import com.millennialmedia.InterstitialAd;
-import com.millennialmedia.InterstitialAd.InterstitialErrorStatus;
-import com.millennialmedia.InterstitialAd.InterstitialListener;
-import com.millennialmedia.MMException;
-import com.millennialmedia.MMLog;
-import com.millennialmedia.MMSDK;
-import com.mopub.common.MoPub;
-
-import java.util.Map;
-
-
-/**
- * Compatible with version 6.6 of the Millennial Media SDK.
- */
-
-final class MillennialInterstitial extends CustomEventInterstitial {
-
-    private static final String TAG = MillennialInterstitial.class.getSimpleName();
-    private static final String DCN_KEY = "dcn";
-    private static final String APID_KEY = "adUnitID";
-
-    private InterstitialAd millennialInterstitial;
-    private Context context;
-    private CustomEventInterstitialListener interstitialListener;
-
-    static {
-        Log.i(TAG, "Millennial Media Adapter Version: " + MillennialUtils.VERSION);
-    }
-
-
-    public CreativeInfo getCreativeInfo() {
-
-        if (millennialInterstitial == null) {
-            return null;
-        }
-
-        return millennialInterstitial.getCreativeInfo();
-    }
-
-
-    @Override
-    protected void loadInterstitial(final Context context,
-                                    final CustomEventInterstitialListener customEventInterstitialListener,
-                                    final Map<String, Object> localExtras,
-                                    final Map<String, String> serverExtras) {
-
-        interstitialListener = customEventInterstitialListener;
-        this.context = context;
-
-        if (!MillennialUtils.initSdk(context)) {
-            Log.e(TAG, "MM SDK must be initialized with an Activity or Application context.");
-            interstitialListener.onInterstitialFailed(MoPubErrorCode.INTERNAL_ERROR);
-            return;
-        }
-
-        String apid = serverExtras.get(APID_KEY);
-
-        if (MillennialUtils.isEmpty(apid)) {
-            Log.e(TAG, "Invalid extras-- Be sure you have an placement ID specified.");
-            interstitialListener.onInterstitialFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-
-            return;
-        }
-
-        // Add DCN support
-        String dcn = serverExtras.get(DCN_KEY);
-
-        AppInfo ai = new AppInfo().setMediator("mopubsdk");
-        if (!MillennialUtils.isEmpty(dcn)) {
-            ai.setSiteId(dcn);
-        }
-
-        try {
-            MMSDK.setAppInfo(ai);
-            MMSDK.setLocationEnabled(MoPub.getLocationAwareness() != MoPub.LocationAwareness.DISABLED);
-            millennialInterstitial = InterstitialAd.createInstance(apid);
-            millennialInterstitial.setListener(new MillennialInterstitialListener());
-            millennialInterstitial.load(context, null);
-        } catch (MMException e) {
-            Log.e(TAG, "Exception occurred while obtaining an interstitial from MM SDK.", e);
-            interstitialListener.onInterstitialFailed(MoPubErrorCode.INTERNAL_ERROR);
-        }
-    }
-
-
-    @Override
-    protected void showInterstitial() {
-
-        if (millennialInterstitial.isReady()) {
-            try {
-                millennialInterstitial.show(context);
-            } catch (MMException e) {
-                MMLog.e(TAG, "An exception occurred while attempting to show interstitial.", e);
-                interstitialListener.onInterstitialFailed(MoPubErrorCode.INTERNAL_ERROR);
-            }
-        } else {
-            Log.w(TAG, "showInterstitial called but interstitial is not ready.");
-        }
-    }
-
-
-    @Override
-    protected void onInvalidate() {
-
-        if (millennialInterstitial != null) {
-            millennialInterstitial.destroy();
-            millennialInterstitial = null;
-        }
-    }
-
-
-    class MillennialInterstitialListener implements InterstitialListener {
-
-        @Override
-        public void onAdLeftApplication(InterstitialAd interstitialAd) {
-            // onLeaveApplication is an alias to on clicked. We are not required to call this.
-
-            // @formatter:off
-            // https://github.com/mopub/mopub-android-sdk/blob/940eee70fe1980b4869d61cb5d668ccbab75c0ee/mopub-sdk/mopub-sdk-interstitial/src/main/java/com/mopub/mobileads/CustomEventInterstitial.java
-            // @formatter:on
-            Log.d(TAG, "Millennial Interstitial Ad - Leaving application");
-        }
-
-
-        @Override
-        public void onClicked(InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Interstitial Ad - Ad was clicked");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    interstitialListener.onInterstitialClicked();
-                }
-            });
-        }
-
-
-        @Override
-        public void onClosed(InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Interstitial Ad - Ad was closed");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    interstitialListener.onInterstitialDismissed();
-                }
-            });
-        }
-
-
-        @Override
-        public void onExpired(InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Interstitial Ad - Ad expired");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    interstitialListener.onInterstitialFailed(MoPubErrorCode.NO_FILL);
-                }
-            });
-        }
-
-
-        @Override
-        public void onLoadFailed(InterstitialAd interstitialAd, InterstitialErrorStatus interstitialErrorStatus) {
-
-            Log.d(TAG, "Millennial Interstitial Ad - load failed (" + interstitialErrorStatus.getErrorCode() + "): " +
-                    interstitialErrorStatus.getDescription());
-
-            final MoPubErrorCode moPubErrorCode;
-
-            switch (interstitialErrorStatus.getErrorCode()) {
-                case InterstitialErrorStatus.ALREADY_LOADED:
-                    // This will generate discrepancies, as requests will NOT be sent to Millennial.
-                    interstitialListener.onInterstitialLoaded();
-                    Log.w(TAG, "Millennial Interstitial Ad - Attempted to load ads when ads are already loaded.");
-                    return;
-                case InterstitialErrorStatus.EXPIRED:
-                case InterstitialErrorStatus.DISPLAY_FAILED:
-                case InterstitialErrorStatus.INIT_FAILED:
-                case InterstitialErrorStatus.ADAPTER_NOT_FOUND:
-                    moPubErrorCode = MoPubErrorCode.INTERNAL_ERROR;
-                    break;
-                case InterstitialErrorStatus.NO_NETWORK:
-                    moPubErrorCode = MoPubErrorCode.NO_CONNECTION;
-                    break;
-                case InterstitialErrorStatus.UNKNOWN:
-                    moPubErrorCode = MoPubErrorCode.UNSPECIFIED;
-                    break;
-                case InterstitialErrorStatus.NOT_LOADED:
-                case InterstitialErrorStatus.LOAD_FAILED:
-                default:
-                    moPubErrorCode = MoPubErrorCode.NETWORK_NO_FILL;
-            }
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    interstitialListener.onInterstitialFailed(moPubErrorCode);
-                }
-            });
-        }
-
-
-        @Override
-        public void onLoaded(InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Interstitial Ad - Ad loaded splendidly");
-
-            CreativeInfo creativeInfo = getCreativeInfo();
-
-            if ((creativeInfo != null) && MMLog.isDebugEnabled()) {
-                MMLog.d(TAG, "Interstitial Creative Info: " + creativeInfo);
-            }
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    interstitialListener.onInterstitialLoaded();
-                }
-            });
-        }
-
-
-        @Override
-        public void onShowFailed(InterstitialAd interstitialAd, InterstitialErrorStatus interstitialErrorStatus) {
-
-            Log.e(TAG, "Millennial Interstitial Ad - Show failed (" + interstitialErrorStatus.getErrorCode() + "): " +
-                    interstitialErrorStatus.getDescription());
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    interstitialListener.onInterstitialFailed(MoPubErrorCode.INTERNAL_ERROR);
-                }
-            });
-        }
-
-
-        @Override
-        public void onShown(InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Interstitial Ad - Ad shown");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    interstitialListener.onInterstitialShown();
-                }
-            });
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/MillennialRewardedVideo.java b/extras/src/com/mopub/mobileads/MillennialRewardedVideo.java
deleted file mode 100644
index ca906ba1..00000000
--- a/extras/src/com/mopub/mobileads/MillennialRewardedVideo.java
+++ /dev/null
@@ -1,361 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.content.Context;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.util.Log;
-
-import com.millennialmedia.AppInfo;
-import com.millennialmedia.CreativeInfo;
-import com.millennialmedia.InterstitialAd;
-import com.millennialmedia.InterstitialAd.InterstitialErrorStatus;
-import com.millennialmedia.InterstitialAd.InterstitialListener;
-import com.millennialmedia.MMException;
-import com.millennialmedia.MMLog;
-import com.millennialmedia.MMSDK;
-import com.millennialmedia.XIncentivizedEventListener;
-import com.mopub.common.BaseLifecycleListener;
-import com.mopub.common.LifecycleListener;
-import com.mopub.common.MoPub;
-import com.mopub.common.MoPubReward;
-
-import java.util.Map;
-
-
-/**
- * Compatible with version 6.6 of the Millennial Media SDK.
- */
-
-@SuppressWarnings("unused")
-final class MillennialRewardedVideo extends CustomEventRewardedVideo {
-
-    private static final String TAG = MillennialRewardedVideo.class.getSimpleName();
-    public static final String DCN_KEY = "dcn";
-    public static final String APID_KEY = "adUnitID";
-
-    private InterstitialAd millennialInterstitial;
-    private MillennialRewardedVideoListener millennialRewardedVideoListener = new MillennialRewardedVideoListener();
-    private Context context;
-    private String apid = null;
-
-    static {
-        Log.i(TAG, "Millennial Media Adapter Version: " + MillennialUtils.VERSION);
-    }
-
-
-    public CreativeInfo getCreativeInfo() {
-
-        if (millennialInterstitial == null) {
-            return null;
-        }
-
-        return millennialInterstitial.getCreativeInfo();
-    }
-
-
-    @Nullable
-    @Override
-    protected CustomEventRewardedVideoListener getVideoListenerForSdk() {
-
-        return millennialRewardedVideoListener;
-    }
-
-
-    @Nullable
-    @Override
-    protected LifecycleListener getLifecycleListener() {
-
-        return new BaseLifecycleListener();
-    }
-
-
-    @NonNull
-    @Override
-    protected String getAdNetworkId() {
-
-        return (apid == null) ? "" : apid;
-    }
-
-
-    @Override
-    protected void onInvalidate() {
-
-        if (millennialInterstitial != null) {
-            millennialInterstitial.destroy();
-            millennialInterstitial = null;
-            apid = null;
-        }
-    }
-
-
-    @Override
-    protected boolean checkAndInitializeSdk(@NonNull Activity launcherActivity,
-            @NonNull Map<String, Object> localExtras, @NonNull Map<String, String> serverExtras) throws Exception {
-
-        if (!MillennialUtils.initSdk(launcherActivity)) {
-            Log.e(TAG, "MM SDK must be initialized with an Activity or Application context.");
-
-            return false;
-        }
-
-        return true;
-    }
-
-
-    @Override
-    protected void loadWithSdkInitialized(@NonNull Activity activity, @NonNull Map<String, Object> localExtras,
-            @NonNull Map<String, String> serverExtras) throws Exception {
-
-        this.context = activity.getApplicationContext();
-        apid = serverExtras.get(APID_KEY);
-        String dcn = serverExtras.get(DCN_KEY);
-
-        if (MillennialUtils.isEmpty(apid)) {
-            Log.e(TAG, "Invalid extras-- Be sure you have a placement ID specified.");
-            MoPubRewardedVideoManager.onRewardedVideoLoadFailure(MillennialRewardedVideo.class, "",
-                    MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-
-            return;
-        }
-
-        // Add DCN support
-        AppInfo ai = new AppInfo().setMediator("mopubsdk").setSiteId(dcn);
-        try {
-            MMSDK.setAppInfo(ai);
-			/* If MoPub gets location, so do we. */
-            MMSDK.setLocationEnabled(MoPub.getLocationAwareness() != MoPub.LocationAwareness.DISABLED);
-
-            millennialInterstitial = InterstitialAd.createInstance(apid);
-            millennialInterstitial.setListener(millennialRewardedVideoListener);
-            millennialInterstitial.xSetIncentivizedListener(millennialRewardedVideoListener);
-            millennialInterstitial.load(activity, null);
-
-        } catch (MMException e) {
-            Log.e(TAG, "An exception occurred loading an InterstitialAd", e);
-            MoPubRewardedVideoManager
-                    .onRewardedVideoLoadFailure(MillennialRewardedVideo.class, apid, MoPubErrorCode.INTERNAL_ERROR);
-        }
-    }
-
-
-    @Override
-    protected boolean hasVideoAvailable() {
-
-        return ((millennialInterstitial != null) && millennialInterstitial.isReady());
-    }
-
-
-    @Override
-    protected void showVideo() {
-
-        if ((millennialInterstitial != null) && millennialInterstitial.isReady()) {
-            try {
-                millennialInterstitial.show(context);
-            } catch (MMException e) {
-                Log.e(TAG, "An exception occurred showing the MM SDK interstitial.", e);
-                MoPubRewardedVideoManager
-                        .onRewardedVideoPlaybackError(MillennialRewardedVideo.class, millennialInterstitial.placementId,
-                                MoPubErrorCode.INTERNAL_ERROR);
-            }
-        } else {
-            Log.w(TAG, "showVideo called before MillennialInterstitial ad was loaded.");
-        }
-    }
-
-
-    class MillennialRewardedVideoListener
-            implements InterstitialListener, XIncentivizedEventListener, CustomEventRewardedVideoListener {
-
-        @Override
-        public void onAdLeftApplication(InterstitialAd interstitialAd) {
-            // onLeaveApplication is an alias to on clicked. We are not required to call this.
-
-            // @formatter:off
-            // https://github.com/mopub/mopub-android-sdk/blob/940eee70fe1980b4869d61cb5d668ccbab75c0ee/mopub-sdk/mopub-sdk-interstitial/src/main/java/com/mopub/mobileads/CustomEventInterstitial.java
-            // @formatter:on
-            Log.d(TAG, "Millennial Rewarded Video Ad - Leaving application");
-        }
-
-
-        @Override
-        public void onClicked(final InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - Ad was clicked");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoClicked(MillennialRewardedVideo.class, interstitialAd.placementId);
-                }
-            });
-        }
-
-
-        @Override
-        public void onClosed(final InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - Ad was closed");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoClosed(MillennialRewardedVideo.class, interstitialAd.placementId);
-                }
-            });
-        }
-
-
-        @Override
-        public void onExpired(final InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - Ad expired");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoLoadFailure(MillennialRewardedVideo.class, interstitialAd.placementId,
-                                    MoPubErrorCode.VIDEO_NOT_AVAILABLE);
-                }
-            });
-        }
-
-
-        @Override
-        public void onLoadFailed(final InterstitialAd interstitialAd, InterstitialErrorStatus
-                interstitialErrorStatus) {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - load failed (" + interstitialErrorStatus.getErrorCode() + "): " +
-                    interstitialErrorStatus.getDescription());
-
-            final MoPubErrorCode moPubErrorCode;
-
-            switch (interstitialErrorStatus.getErrorCode()) {
-                case InterstitialErrorStatus.ALREADY_LOADED:
-                    // This will generate discrepancies, as requests will NOT be sent to Millennial.
-                    MillennialUtils.postOnUiThread(new Runnable() {
-                        @Override
-                        public void run() {
-
-                            MoPubRewardedVideoManager
-                                    .onRewardedVideoLoadSuccess(MillennialRewardedVideo.class, interstitialAd.placementId);
-                        }
-                    });
-                    Log.w(TAG, "Millennial Rewarded Video Ad - Attempted to load ads when ads are already loaded.");
-                    return;
-                case InterstitialErrorStatus.EXPIRED:
-                case InterstitialErrorStatus.DISPLAY_FAILED:
-                case InterstitialErrorStatus.INIT_FAILED:
-                case InterstitialErrorStatus.ADAPTER_NOT_FOUND:
-                    moPubErrorCode = MoPubErrorCode.INTERNAL_ERROR;
-                    break;
-                case InterstitialErrorStatus.NO_NETWORK:
-                    moPubErrorCode = MoPubErrorCode.NO_CONNECTION;
-                    break;
-                case InterstitialErrorStatus.UNKNOWN:
-                    moPubErrorCode = MoPubErrorCode.UNSPECIFIED;
-                    break;
-                case InterstitialErrorStatus.NOT_LOADED:
-                case InterstitialErrorStatus.LOAD_FAILED:
-                default:
-                    moPubErrorCode = MoPubErrorCode.NETWORK_NO_FILL;
-            }
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoLoadFailure(MillennialRewardedVideo.class, interstitialAd.placementId,
-                                    moPubErrorCode);
-                }
-            });
-        }
-
-
-        @Override
-        public void onLoaded(final InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - Ad loaded splendidly");
-
-            CreativeInfo creativeInfo = getCreativeInfo();
-
-            if ((creativeInfo != null) && MMLog.isDebugEnabled()) {
-                MMLog.d(TAG, "Rewarded Video Creative Info: " + creativeInfo);
-            }
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoLoadSuccess(MillennialRewardedVideo.class, interstitialAd.placementId);
-                }
-            });
-        }
-
-
-        @Override
-        public void onShowFailed(final InterstitialAd interstitialAd, InterstitialErrorStatus
-                interstitialErrorStatus) {
-
-            Log.e(TAG, "Millennial Rewarded Video Ad - Show failed (" + interstitialErrorStatus.getErrorCode() + "): " +
-                    interstitialErrorStatus.getDescription());
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoPlaybackError(MillennialRewardedVideo.class, interstitialAd.placementId,
-                                    MoPubErrorCode.VIDEO_PLAYBACK_ERROR);
-                }
-            });
-        }
-
-
-        @Override
-        public void onShown(final InterstitialAd interstitialAd) {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - Ad shown");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoStarted(MillennialRewardedVideo.class, interstitialAd.placementId);
-                }
-            });
-        }
-
-
-        @Override
-        public boolean onVideoComplete() {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - Video completed");
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    MoPubRewardedVideoManager
-                            .onRewardedVideoCompleted(MillennialRewardedVideo.class, millennialInterstitial.placementId,
-                                    MoPubReward.success(MoPubReward.NO_REWARD_LABEL, MoPubReward.DEFAULT_REWARD_AMOUNT));
-                }
-            });
-            return false;
-        }
-
-
-        @Override
-        public boolean onCustomEvent(XIncentiveEvent xIncentiveEvent) {
-
-            Log.d(TAG, "Millennial Rewarded Video Ad - Custom event received: " + xIncentiveEvent.eventId + ", " +
-                    xIncentiveEvent.args);
-
-            return false;
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/MillennialUtils.java b/extras/src/com/mopub/mobileads/MillennialUtils.java
deleted file mode 100644
index 0417e7ee..00000000
--- a/extras/src/com/mopub/mobileads/MillennialUtils.java
+++ /dev/null
@@ -1,65 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Application;
-import android.content.Context;
-import android.os.Handler;
-import android.os.Looper;
-import android.support.annotation.NonNull;
-import android.util.Log;
-
-import com.millennialmedia.MMException;
-import com.millennialmedia.MMSDK;
-import com.mopub.common.Preconditions;
-
-
-final public class MillennialUtils {
-    private static final String LOG_TAG = MillennialUtils.class.getSimpleName();
-
-    private static final Handler handler = new Handler(Looper.getMainLooper());
-
-    public static final String VERSION = "1.2.0";
-
-    private static volatile boolean sIsInitialized = false;
-
-    public static void postOnUiThread(Runnable runnable) {
-        handler.post(runnable);
-    }
-
-    public static boolean isEmpty(String s) {
-        return (s == null || s.trim().isEmpty());
-    }
-
-    /**
-     * @param context - application or activity context
-     * @return {@code true} successfully initialized
-     */
-    public static boolean initSdk(@NonNull Context context) {
-        if (sIsInitialized) {
-            return true;
-        }
-
-        synchronized (MillennialUtils.class) {
-            if (sIsInitialized) {
-                return true;
-            }
-            Preconditions.checkNotNull(context);
-
-            final Application application;
-            if (context instanceof Application) {
-                application = (Application) context;
-            } else {
-                application = (Application) context.getApplicationContext();
-            }
-
-            try {
-                MMSDK.initialize(application);
-            } catch (MMException e) {
-                Log.e(LOG_TAG, "Exception occurred initializing the MM SDK.", e);
-                return false;
-            }
-
-            sIsInitialized = true;
-        }
-        return true;
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/TapjoyInterstitial.java b/extras/src/com/mopub/mobileads/TapjoyInterstitial.java
deleted file mode 100644
index 9a87ee6a..00000000
--- a/extras/src/com/mopub/mobileads/TapjoyInterstitial.java
+++ /dev/null
@@ -1,182 +0,0 @@
-// Copyright (C) 2015 by Tapjoy Inc.
-//
-// This file is part of the Tapjoy SDK.
-//
-// By using the Tapjoy SDK in your software, you agree to the terms of the Tapjoy SDK License Agreement.
-//
-// The Tapjoy SDK is bound by the Tapjoy SDK License Agreement and can be found here: https://www.tapjoy.com/sdk/license
-
-package com.mopub.mobileads;
-
-import android.content.Context;
-import android.os.Handler;
-import android.os.Looper;
-import android.text.TextUtils;
-
-import com.mopub.common.logging.MoPubLog;
-import com.tapjoy.TJActionRequest;
-import com.tapjoy.TJConnectListener;
-import com.tapjoy.TJError;
-import com.tapjoy.TJPlacement;
-import com.tapjoy.TJPlacementListener;
-import com.tapjoy.Tapjoy;
-import com.tapjoy.TapjoyLog;
-
-import java.util.Map;
-
-// Tested with Tapjoy SDK 11.11.0
-public class TapjoyInterstitial extends CustomEventInterstitial implements TJPlacementListener {
-    private static final String TAG = TapjoyInterstitial.class.getSimpleName();
-    private static final String TJC_MOPUB_NETWORK_CONSTANT = "mopub";
-    private static final String TJC_MOPUB_ADAPTER_VERSION_NUMBER = "4.1.0";
-
-    // Configuration keys
-    public static final String SDK_KEY = "sdkKey";
-    public static final String DEBUG_ENABLED = "debugEnabled";
-    public static final String PLACEMENT_NAME = "name";
-
-    private TJPlacement tjPlacement;
-    private CustomEventInterstitialListener mInterstitialListener;
-    private Handler mHandler;
-
-    static {
-        TapjoyLog.i(TAG, "Class initialized with network adapter version " + TJC_MOPUB_ADAPTER_VERSION_NUMBER);
-    }
-
-    @Override
-    protected void loadInterstitial(final Context context,
-            CustomEventInterstitialListener customEventInterstitialListener,
-            Map<String, Object> localExtras,
-            Map<String, String> serverExtras) {
-        MoPubLog.d("Requesting Tapjoy interstitial");
-
-        mInterstitialListener = customEventInterstitialListener;
-        mHandler = new Handler(Looper.getMainLooper());
-
-        final String placementName = serverExtras.get(PLACEMENT_NAME);
-        if (TextUtils.isEmpty(placementName)) {
-            MoPubLog.d("Tapjoy interstitial loaded with empty 'name' field. Request will fail.");
-        }
-
-        boolean canRequestPlacement = true;
-        if (!Tapjoy.isConnected()) {
-            // Check if configuration data is available
-            boolean enableDebug = Boolean.valueOf(serverExtras.get(DEBUG_ENABLED));
-            Tapjoy.setDebugEnabled(enableDebug);
-
-            String sdkKey = serverExtras.get(SDK_KEY);
-            if (!TextUtils.isEmpty(sdkKey)) {
-                MoPubLog.d("Connecting to Tapjoy via MoPub dashboard settings...");
-                Tapjoy.connect(context, sdkKey, null, new TJConnectListener() {
-                    @Override
-                    public void onConnectSuccess() {
-                        MoPubLog.d("Tapjoy connected successfully");
-                        createPlacement(context, placementName);
-                    }
-
-                    @Override
-                    public void onConnectFailure() {
-                        MoPubLog.d("Tapjoy connect failed");
-                    }
-                });
-
-                // If sdkKey is present via MoPub dashboard, we only want to request placement
-                // after auto-connect succeeds
-                canRequestPlacement = false;
-            } else {
-                MoPubLog.d("Tapjoy interstitial is initialized with empty 'sdkKey'. You must call Tapjoy.connect()");
-            }
-        }
-
-        if (canRequestPlacement) {
-            createPlacement(context, placementName);
-        }
-    }
-
-    private void createPlacement(Context context, String placementName) {
-        tjPlacement = new TJPlacement(context, placementName, this);
-        tjPlacement.setMediationName(TJC_MOPUB_NETWORK_CONSTANT);
-        tjPlacement.setAdapterVersion(TJC_MOPUB_ADAPTER_VERSION_NUMBER);
-        tjPlacement.requestContent();
-    }
-
-    @Override
-    protected void onInvalidate() {
-        // No custom cleanup to do here.
-    }
-
-    @Override
-    protected void showInterstitial() {
-        MoPubLog.d("Tapjoy interstitial will be shown");
-        tjPlacement.showContent();
-    }
-
-    // Tapjoy
-
-    @Override
-    public void onRequestSuccess(final TJPlacement placement) {
-        mHandler.post(new Runnable() {
-            @Override
-            public void run() {
-                if (placement.isContentAvailable()) {
-                    MoPubLog.d("Tapjoy interstitial request successful");
-                    mInterstitialListener.onInterstitialLoaded();
-                } else {
-                    MoPubLog.d("No Tapjoy interstitials available");
-                    mInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-                }
-            }
-        });
-    }
-
-    @Override
-    public void onRequestFailure(TJPlacement placement, TJError error) {
-        MoPubLog.d("Tapjoy interstitial request failed");
-
-        mHandler.post(new Runnable() {
-            @Override
-            public void run() {
-                mInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-            }
-        });
-    }
-
-    @Override
-    public void onContentShow(TJPlacement placement) {
-        MoPubLog.d("Tapjoy interstitial shown");
-
-        mHandler.post(new Runnable() {
-            @Override
-            public void run() {
-                mInterstitialListener.onInterstitialShown();
-            }
-        });
-    }
-
-    @Override
-    public void onContentDismiss(TJPlacement placement) {
-        MoPubLog.d("Tapjoy interstitial dismissed");
-
-        mHandler.post(new Runnable() {
-            @Override
-            public void run() {
-                mInterstitialListener.onInterstitialDismissed();
-            }
-        });
-    }
-
-    @Override
-    public void onContentReady(TJPlacement placement) {
-    }
-
-    @Override
-    public void onPurchaseRequest(TJPlacement placement, TJActionRequest request,
-            String productId) {
-    }
-
-    @Override
-    public void onRewardRequest(TJPlacement placement, TJActionRequest request, String itemId,
-            int quantity) {
-    }
-
-}
diff --git a/extras/src/com/mopub/mobileads/TapjoyRewardedVideo.java b/extras/src/com/mopub/mobileads/TapjoyRewardedVideo.java
deleted file mode 100644
index 8613c441..00000000
--- a/extras/src/com/mopub/mobileads/TapjoyRewardedVideo.java
+++ /dev/null
@@ -1,273 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.text.TextUtils;
-
-import com.mopub.common.LifecycleListener;
-import com.mopub.common.MediationSettings;
-import com.mopub.common.MoPubReward;
-import com.mopub.common.logging.MoPubLog;
-import com.tapjoy.TJActionRequest;
-import com.tapjoy.TJConnectListener;
-import com.tapjoy.TJError;
-import com.tapjoy.TJPlacement;
-import com.tapjoy.TJPlacementListener;
-import com.tapjoy.TJVideoListener;
-import com.tapjoy.Tapjoy;
-import com.tapjoy.TapjoyLog;
-
-import java.util.Hashtable;
-import java.util.Map;
-
-// Tested with Tapjoy SDK 11.11.0
-public class TapjoyRewardedVideo extends CustomEventRewardedVideo {
-    private static final String TAG = TapjoyRewardedVideo.class.getSimpleName();
-    private static final String TJC_MOPUB_NETWORK_CONSTANT = "mopub";
-    private static final String TJC_MOPUB_ADAPTER_VERSION_NUMBER = "4.1.0";
-    private static final String TAPJOY_AD_NETWORK_CONSTANT = "tapjoy_id";
-
-    // Configuration keys
-    public static final String SDK_KEY = "sdkKey";
-    public static final String DEBUG_ENABLED = "debugEnabled";
-    public static final String PLACEMENT_NAME = "name";
-
-    private String sdkKey;
-    private String placementName;
-    private Hashtable<String, Object> connectFlags;
-    private TJPlacement tjPlacement;
-    private boolean isAutoConnect = false;
-    private static TapjoyRewardedVideoListener sTapjoyListener = new TapjoyRewardedVideoListener();
-
-    static {
-        TapjoyLog.i(TAG, "Class initialized with network adapter version " + TJC_MOPUB_ADAPTER_VERSION_NUMBER);
-    }
-
-    @Override
-    protected CustomEventRewardedVideoListener getVideoListenerForSdk() {
-        return sTapjoyListener;
-    }
-
-    @Override
-    protected LifecycleListener getLifecycleListener() {
-        return null;
-    }
-
-    @Override
-    protected String getAdNetworkId() {
-        return TAPJOY_AD_NETWORK_CONSTANT;
-    }
-
-    @Override
-    protected void onInvalidate() {
-    }
-
-    @Override
-    protected boolean checkAndInitializeSdk(@NonNull Activity launcherActivity,
-            @NonNull Map<String, Object> localExtras,
-            @NonNull Map<String, String> serverExtras)
-            throws Exception {
-
-        placementName = serverExtras.get(PLACEMENT_NAME);
-        if (TextUtils.isEmpty(placementName)) {
-            MoPubLog.d("Tapjoy rewarded video loaded with empty 'name' field. Request will fail.");
-        }
-
-        if (!Tapjoy.isConnected()) {
-            if (checkAndInitMediationSettings()) {
-                MoPubLog.d("Connecting to Tapjoy via MoPub mediation settings...");
-                connectToTapjoy(launcherActivity);
-
-                isAutoConnect = true;
-                return true;
-            } else {
-                boolean enableDebug = Boolean.valueOf(serverExtras.get(DEBUG_ENABLED));
-                Tapjoy.setDebugEnabled(enableDebug);
-
-                sdkKey = serverExtras.get(SDK_KEY);
-                if (!TextUtils.isEmpty(sdkKey)) {
-                    MoPubLog.d("Connecting to Tapjoy via MoPub dashboard settings...");
-                    connectToTapjoy(launcherActivity);
-
-                    isAutoConnect = true;
-                    return true;
-                } else {
-                    MoPubLog.d("Tapjoy rewarded video is initialized with empty 'sdkKey'. You must call Tapjoy.connect()");
-                    isAutoConnect = false;
-                }
-            }
-        }
-
-        return false;
-    }
-
-    @Override
-    protected void loadWithSdkInitialized(@NonNull Activity activity,
-            @NonNull Map<String, Object> localExtras,
-            @NonNull Map<String, String> serverExtras)
-            throws Exception {
-        MoPubLog.d("Requesting Tapjoy rewarded video");
-        createPlacement(activity);
-    }
-
-    private void connectToTapjoy(final Activity launcherActivity) {
-        Tapjoy.connect(launcherActivity, sdkKey, connectFlags, new TJConnectListener() {
-            @Override
-            public void onConnectSuccess() {
-                MoPubLog.d("Tapjoy connected successfully");
-                createPlacement(launcherActivity);
-            }
-
-            @Override
-            public void onConnectFailure() {
-                MoPubLog.d("Tapjoy connect failed");
-            }
-        });
-    }
-
-    private void createPlacement(Activity activity) {
-        if (!TextUtils.isEmpty(placementName)) {
-            if (isAutoConnect && !Tapjoy.isConnected()) {
-                // If adapter is making the Tapjoy.connect() call on behalf of the pub, wait for it to
-                // succeed before making a placement request.
-                MoPubLog.d("Tapjoy is still connecting. Please wait for this to finish before making a placement request");
-                return;
-            }
-
-            tjPlacement = new TJPlacement(activity, placementName, sTapjoyListener);
-            tjPlacement.setMediationName(TJC_MOPUB_NETWORK_CONSTANT);
-            tjPlacement.setAdapterVersion(TJC_MOPUB_ADAPTER_VERSION_NUMBER);
-            tjPlacement.requestContent();
-        } else {
-            MoPubLog.d("Tapjoy placementName is empty. Unable to create TJPlacement.");
-        }
-    }
-
-    @Override
-    protected boolean hasVideoAvailable() {
-        return tjPlacement.isContentAvailable();
-    }
-
-    @Override
-    protected void showVideo() {
-        if (hasVideoAvailable()) {
-            MoPubLog.d("Tapjoy rewarded video will be shown.");
-            tjPlacement.showContent();
-        } else {
-            MoPubLog.d("Failed to show Tapjoy rewarded video.");
-        }
-    }
-
-    private boolean checkAndInitMediationSettings() {
-        final TapjoyMediationSettings globalMediationSettings =
-                MoPubRewardedVideoManager.getGlobalMediationSettings(TapjoyMediationSettings.class);
-
-        if (globalMediationSettings != null) {
-            MoPubLog.d("Initializing Tapjoy mediation settings");
-
-            if (!TextUtils.isEmpty(globalMediationSettings.getSdkKey())) {
-                sdkKey = globalMediationSettings.getSdkKey();
-            } else {
-                MoPubLog.d("Cannot initialize Tapjoy -- 'sdkkey' is empty");
-                return false;
-            }
-
-            if (globalMediationSettings.getConnectFlags() != null) {
-                connectFlags = globalMediationSettings.getConnectFlags();
-            }
-
-            return true;
-        } else {
-            return false;
-        }
-    }
-
-    private static class TapjoyRewardedVideoListener implements TJPlacementListener, CustomEventRewardedVideoListener, TJVideoListener {
-        @Override
-        public void onRequestSuccess(TJPlacement placement) {
-            if (!placement.isContentAvailable()) {
-                MoPubLog.d("No Tapjoy rewarded videos available");
-                MoPubRewardedVideoManager.onRewardedVideoLoadFailure(TapjoyRewardedVideo.class, TAPJOY_AD_NETWORK_CONSTANT, MoPubErrorCode.NETWORK_NO_FILL);
-            }
-        }
-
-        @Override
-        public void onContentReady(TJPlacement placement) {
-            MoPubLog.d("Tapjoy rewarded video content is ready");
-            MoPubRewardedVideoManager.onRewardedVideoLoadSuccess(TapjoyRewardedVideo.class, TAPJOY_AD_NETWORK_CONSTANT);
-        }
-
-        @Override
-        public void onRequestFailure(TJPlacement placement, TJError error) {
-            MoPubLog.d("Tapjoy rewarded video request failed");
-            MoPubRewardedVideoManager.onRewardedVideoLoadFailure(TapjoyRewardedVideo.class, TAPJOY_AD_NETWORK_CONSTANT, MoPubErrorCode.NETWORK_NO_FILL);
-        }
-
-        @Override
-        public void onContentShow(TJPlacement placement) {
-            Tapjoy.setVideoListener(this);
-            MoPubLog.d("Tapjoy rewarded video content shown");
-            MoPubRewardedVideoManager.onRewardedVideoStarted(TapjoyRewardedVideo.class, TAPJOY_AD_NETWORK_CONSTANT);
-        }
-
-        @Override
-        public void onContentDismiss(TJPlacement placement) {
-            Tapjoy.setVideoListener(null);
-            MoPubLog.d("Tapjoy rewarded video content dismissed");
-            MoPubRewardedVideoManager.onRewardedVideoClosed(TapjoyRewardedVideo.class, TAPJOY_AD_NETWORK_CONSTANT);
-        }
-
-        @Override
-        public void onPurchaseRequest(TJPlacement placement, TJActionRequest request,
-                String productId) {
-        }
-
-        @Override
-        public void onRewardRequest(TJPlacement placement, TJActionRequest request, String itemId,
-                int quantity) {
-        }
-
-        @Override
-        public void onVideoStart() {
-
-        }
-
-        @Override
-        public void onVideoError(int statusCode) {
-        }
-
-        @Override
-        public void onVideoComplete() {
-            MoPubLog.d("Tapjoy rewarded video completed");
-            MoPubRewardedVideoManager.onRewardedVideoCompleted(TapjoyRewardedVideo.class, TAPJOY_AD_NETWORK_CONSTANT, MoPubReward.success(MoPubReward.NO_REWARD_LABEL, MoPubReward.NO_REWARD_AMOUNT));
-        }
-    }
-
-    public static final class TapjoyMediationSettings implements MediationSettings {
-        @Nullable
-        private final String mSdkKey;
-        @Nullable
-        Hashtable<String, Object> mConnectFlags;
-
-        public TapjoyMediationSettings(String sdkKey) {
-            this.mSdkKey = sdkKey;
-        }
-
-        public TapjoyMediationSettings(String sdkKey, Hashtable<String, Object> connectFlags) {
-            this.mSdkKey = sdkKey;
-            this.mConnectFlags = connectFlags;
-        }
-
-        @NonNull
-        public String getSdkKey() {
-            return mSdkKey;
-        }
-
-        @NonNull
-        public Hashtable<String, Object> getConnectFlags() {
-            return mConnectFlags;
-        }
-    }
-
-}
diff --git a/extras/src/com/mopub/mobileads/UnityInterstitial.java b/extras/src/com/mopub/mobileads/UnityInterstitial.java
deleted file mode 100644
index 37b31b27..00000000
--- a/extras/src/com/mopub/mobileads/UnityInterstitial.java
+++ /dev/null
@@ -1,112 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.content.Context;
-
-import com.mopub.common.logging.MoPubLog;
-import com.unity3d.ads.mediation.IUnityAdsExtendedListener;
-import com.unity3d.ads.UnityAds;
-
-import java.util.Map;
-
-/**
- * Certified with Unity Ads 2.1.1
- */
-public class UnityInterstitial extends CustomEventInterstitial implements IUnityAdsExtendedListener {
-
-    private CustomEventInterstitialListener mCustomEventInterstitialListener;
-    private Context mContext;
-    private String mPlacementId = "video";
-    private boolean loadRequested = false;
-
-    @Override
-    protected void loadInterstitial(Context context,
-            CustomEventInterstitialListener customEventInterstitialListener,
-            Map<String, Object> localExtras,
-            Map<String, String> serverExtras) {
-
-        mPlacementId = UnityRouter.placementIdForServerExtras(serverExtras, mPlacementId);
-        mCustomEventInterstitialListener = customEventInterstitialListener;
-        mContext = context;
-        loadRequested = true;
-
-        try {
-            UnityRouter.addListener(mPlacementId, this);
-            initializeUnityAdsSdk(serverExtras);
-            if (UnityAds.isReady()) {
-                mCustomEventInterstitialListener.onInterstitialLoaded();
-                loadRequested = false;
-            }
-        } catch (UnityRouter.UnityAdsException e) {
-            mCustomEventInterstitialListener.onInterstitialFailed(UnityRouter.UnityAdsUtils.getMoPubErrorCode(e.getErrorCode()));
-        }
-    }
-
-    private void initializeUnityAdsSdk(Map<String, String> serverExtras) {
-        if (!UnityAds.isInitialized()) {
-            if (!(mContext instanceof Activity)) {
-                throw new UnityRouter.UnityAdsException(UnityAds.UnityAdsError.INVALID_ARGUMENT, "Context is null or is not an instanceof Activity.");
-            }
-            UnityRouter.initUnityAds(serverExtras, (Activity) mContext);
-        }
-    }
-
-
-    @Override
-    protected void showInterstitial() {
-        if (UnityAds.isReady(mPlacementId) && mContext != null) {
-            UnityAds.show((Activity) mContext, mPlacementId);
-        } else {
-            MoPubLog.d("Attempted to show Unity interstitial video before it was available.");
-        }
-    }
-
-    @Override
-    protected void onInvalidate() {
-        UnityRouter.removeListener(mPlacementId);
-    }
-
-    @Override
-    public void onUnityAdsReady(String placementId) {
-        if (loadRequested) {
-            mCustomEventInterstitialListener.onInterstitialLoaded();
-            loadRequested = false;
-        }
-    }
-
-    @Override
-    public void onUnityAdsStart(String placementId) {
-        mCustomEventInterstitialListener.onInterstitialShown();
-    }
-
-    @Override
-    public void onUnityAdsFinish(String placementId, UnityAds.FinishState finishState) {
-        if (finishState == UnityAds.FinishState.ERROR) {
-            MoPubLog.d("Unity interstitial video encountered a playback error for placement " + placementId);
-            mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.VIDEO_PLAYBACK_ERROR);
-        } else {
-            MoPubLog.d("Unity interstitial video completed for placement " + placementId);
-            mCustomEventInterstitialListener.onInterstitialDismissed();
-        }
-
-        UnityRouter.removeListener(placementId);
-    }
-
-    @Override
-    public void onUnityAdsClick(String placementId) {
-        mCustomEventInterstitialListener.onInterstitialClicked();
-    }
-
-
-    // @Override
-    public void onUnityAdsPlacementStateChanged(String placementId, UnityAds.PlacementState oldState, UnityAds.PlacementState newState) {
-
-    }
-
-    @Override
-    public void onUnityAdsError(UnityAds.UnityAdsError unityAdsError, String message) {
-        MoPubLog.d("Unity interstitial video cache failed for placement " + mPlacementId + ".");
-        MoPubErrorCode errorCode = UnityRouter.UnityAdsUtils.getMoPubErrorCode(unityAdsError);
-        mCustomEventInterstitialListener.onInterstitialFailed(errorCode);
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/UnityRewardedVideo.java b/extras/src/com/mopub/mobileads/UnityRewardedVideo.java
deleted file mode 100644
index 24636be9..00000000
--- a/extras/src/com/mopub/mobileads/UnityRewardedVideo.java
+++ /dev/null
@@ -1,177 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-
-import com.mopub.common.BaseLifecycleListener;
-import com.mopub.common.LifecycleListener;
-import com.mopub.common.MoPubReward;
-import com.mopub.common.VisibleForTesting;
-import com.mopub.common.logging.MoPubLog;
-import com.unity3d.ads.mediation.IUnityAdsExtendedListener;
-import com.unity3d.ads.UnityAds;
-
-import java.util.Map;
-
-/**
- * A custom event for showing Unity rewarded videos.
- *
- * Certified with Unity Ads 2.1.1
- */
-public class UnityRewardedVideo extends CustomEventRewardedVideo {
-    private static final String GAME_ID_KEY = "gameId";
-    private static final LifecycleListener sLifecycleListener = new UnityLifecycleListener();
-    private static final UnityAdsListener sUnityAdsListener = new UnityAdsListener();
-    private static String sPlacementId = "";
-
-    @Nullable
-    private Activity mLauncherActivity;
-
-    @Override
-    @NonNull
-    public CustomEventRewardedVideoListener getVideoListenerForSdk() {
-        return sUnityAdsListener;
-    }
-
-    @Override
-    @NonNull
-    public LifecycleListener getLifecycleListener() {
-        return sLifecycleListener;
-    }
-
-    @Override
-    @NonNull
-    public String getAdNetworkId() {
-        return sPlacementId;
-    }
-
-    @Override
-    public boolean checkAndInitializeSdk(@NonNull final Activity launcherActivity,
-            @NonNull final Map<String, Object> localExtras,
-            @NonNull final Map<String, String> serverExtras) throws Exception {
-        synchronized (UnityRewardedVideo.class) {
-            if (UnityAds.isInitialized()) {
-                return false;
-            }
-
-            try {
-                UnityRouter.initUnityAds(serverExtras, launcherActivity);
-                UnityRouter.addListener(sPlacementId, sUnityAdsListener);
-            } catch (UnityRouter.UnityAdsException e) {
-                MoPubLog.e("Failed to initialize Unity Ads.", e);
-                MoPubRewardedVideoManager.onRewardedVideoLoadFailure(UnityRewardedVideo.class, sPlacementId, UnityRouter.UnityAdsUtils.getMoPubErrorCode(e.getErrorCode()));
-            }
-
-            return true;
-        }
-    }
-
-    @Override
-    protected void loadWithSdkInitialized(@NonNull Activity activity,
-            @NonNull Map<String, Object> localExtras,
-            @NonNull Map<String, String> serverExtras) throws Exception {
-
-        sPlacementId = UnityRouter.placementIdForServerExtras(serverExtras, sPlacementId);
-        mLauncherActivity = activity;
-
-        UnityRouter.addListener(sPlacementId, sUnityAdsListener);
-        if (UnityAds.isReady()) {
-            MoPubRewardedVideoManager.onRewardedVideoLoadSuccess(UnityRewardedVideo.class, sPlacementId);
-        }
-    }
-
-    @Override
-    public boolean hasVideoAvailable() {
-        return UnityAds.isReady(sPlacementId);
-    }
-
-    @Override
-    public void showVideo() {
-        if (hasVideoAvailable()) {
-            UnityAds.show(mLauncherActivity, sPlacementId);
-        } else {
-            MoPubLog.d("Attempted to show Unity rewarded video before it was available.");
-        }
-    }
-
-    @Override
-    protected void onInvalidate() {
-        UnityRouter.removeListener(sPlacementId);
-    }
-
-    private static final class UnityLifecycleListener extends BaseLifecycleListener {
-        @Override
-        public void onCreate(@NonNull final Activity activity) {
-            super.onCreate(activity);
-        }
-
-        @Override
-        public void onResume(@NonNull final Activity activity) {
-            super.onResume(activity);
-        }
-
-    }
-
-    private static class UnityAdsListener implements IUnityAdsExtendedListener,
-            CustomEventRewardedVideoListener {
-        @Override
-        public void onUnityAdsReady(String placementId) {
-            if (placementId.equals(sPlacementId)) {
-                MoPubLog.d("Unity rewarded video cached for placement " + placementId + ".");
-                MoPubRewardedVideoManager.onRewardedVideoLoadSuccess(UnityRewardedVideo.class, placementId);
-            }
-        }
-
-        @Override
-        public void onUnityAdsStart(String placementId) {
-            MoPubRewardedVideoManager.onRewardedVideoStarted(UnityRewardedVideo.class, placementId);
-            MoPubLog.d("Unity rewarded video started for placement " + placementId + ".");
-        }
-
-        @Override
-        public void onUnityAdsFinish(String placementId, UnityAds.FinishState finishState) {
-            MoPubLog.d("Unity Ad finished with finish state = " + finishState);
-            if (finishState == UnityAds.FinishState.ERROR) {
-                MoPubRewardedVideoManager.onRewardedVideoPlaybackError(
-                        UnityRewardedVideo.class,
-                        sPlacementId,
-                        MoPubErrorCode.VIDEO_PLAYBACK_ERROR);
-                MoPubLog.d("Unity rewarded video encountered a playback error for placement " + placementId);
-            } else if (finishState == UnityAds.FinishState.COMPLETED) {
-                MoPubRewardedVideoManager.onRewardedVideoCompleted(
-                        UnityRewardedVideo.class,
-                        sPlacementId,
-                        MoPubReward.success(MoPubReward.NO_REWARD_LABEL, MoPubReward.NO_REWARD_AMOUNT));
-                MoPubLog.d("Unity rewarded video completed for placement " + placementId);
-            } else if (finishState == UnityAds.FinishState.SKIPPED) {
-                MoPubLog.d("Unity ad was skipped, no reward will be given.");
-            }
-            MoPubRewardedVideoManager.onRewardedVideoClosed(UnityRewardedVideo.class, sPlacementId);
-            UnityRouter.removeListener(placementId);
-        }
-
-        @Override
-        public void onUnityAdsClick(String placementId) {
-            MoPubRewardedVideoManager.onRewardedVideoClicked(UnityRewardedVideo.class, placementId);
-            MoPubLog.d("Unity rewarded video clicked for placement " + placementId + ".");
-        }
-
-        // @Override
-        public void onUnityAdsPlacementStateChanged(String placementId, UnityAds.PlacementState oldState, UnityAds.PlacementState newState) {
-
-        }
-
-        @Override
-        public void onUnityAdsError(UnityAds.UnityAdsError unityAdsError, String message) {
-            MoPubLog.d("Unity rewarded video cache failed for placement " + sPlacementId + ".");
-            MoPubErrorCode errorCode = UnityRouter.UnityAdsUtils.getMoPubErrorCode(unityAdsError);
-            MoPubRewardedVideoManager.onRewardedVideoLoadFailure(UnityRewardedVideo.class, sPlacementId, errorCode);
-        }
-    }
-
-    @VisibleForTesting
-    void reset() {
-        sPlacementId = "";
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/UnityRouter.java b/extras/src/com/mopub/mobileads/UnityRouter.java
deleted file mode 100644
index a7358947..00000000
--- a/extras/src/com/mopub/mobileads/UnityRouter.java
+++ /dev/null
@@ -1,147 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.text.TextUtils;
-
-import com.mopub.common.MoPub;
-import com.unity3d.ads.UnityAds;
-import com.unity3d.ads.mediation.IUnityAdsExtendedListener;
-import com.unity3d.ads.metadata.MediationMetaData;
-
-import java.util.HashMap;
-import java.util.Map;
-
-/**
- * Certified with Unity Ads 2.1.1
- */
-public class UnityRouter {
-    private static String sCurrentPlacementId;
-    private static final String GAME_ID_KEY = "gameId";
-    private static final String ZONE_ID_KEY = "zoneId";
-    private static final String PLACEMENT_ID_KEY = "placementId";
-    private static final UnityAdsListener sUnityAdsListener = new UnityAdsListener();
-    private static Map<String, IUnityAdsExtendedListener> mUnityAdsListeners = new HashMap<>();
-
-    static boolean initUnityAds(Map<String, String> serverExtras, Activity launcherActivity) {
-        String gameId = serverExtras.get(GAME_ID_KEY);
-        if (gameId == null || gameId.isEmpty()) {
-            throw new UnityAdsException(UnityAds.UnityAdsError.INVALID_ARGUMENT, "Sever extras is missing \"%s\" or is empty.", GAME_ID_KEY);
-        }
-
-        MediationMetaData mediationMetaData = new MediationMetaData(launcherActivity);
-        mediationMetaData.setName("MoPub");
-        mediationMetaData.setVersion(MoPub.SDK_VERSION);
-        mediationMetaData.commit();
-
-        UnityAds.initialize(launcherActivity, gameId, sUnityAdsListener);
-        return true;
-    }
-
-    static String placementIdForServerExtras(Map<String, String> serverExtras, String defaultPlacementId) {
-        String placementId = null;
-        if (serverExtras.containsKey(PLACEMENT_ID_KEY)) {
-            placementId = serverExtras.get(PLACEMENT_ID_KEY);
-        } else if (serverExtras.containsKey(ZONE_ID_KEY)) {
-            placementId = serverExtras.get(ZONE_ID_KEY);
-        }
-        return TextUtils.isEmpty(placementId) ? defaultPlacementId : placementId;
-    }
-
-    static void showAd(Activity activity, String placementId) {
-        sCurrentPlacementId = placementId;
-        UnityAds.show(activity, placementId);
-    }
-
-    static void addListener(String placementId, IUnityAdsExtendedListener unityListener) {
-        mUnityAdsListeners.put(placementId, unityListener);
-    }
-
-    static void removeListener(String placementId) {
-        mUnityAdsListeners.remove(placementId);
-    }
-
-    private static class UnityAdsListener implements IUnityAdsExtendedListener {
-        @Override
-        public void onUnityAdsReady(String placementId) {
-            IUnityAdsExtendedListener listener = mUnityAdsListeners.get(placementId);
-            if (listener != null) {
-                listener.onUnityAdsReady(placementId);
-            }
-        }
-
-        @Override
-        public void onUnityAdsStart(String placementId) {
-            IUnityAdsExtendedListener listener = mUnityAdsListeners.get(placementId);
-            if (listener != null) {
-                listener.onUnityAdsStart(placementId);
-            }
-        }
-
-        @Override
-        public void onUnityAdsFinish(String placementId, UnityAds.FinishState finishState) {
-            IUnityAdsExtendedListener listener = mUnityAdsListeners.get(placementId);
-            if (listener != null) {
-                listener.onUnityAdsFinish(placementId, finishState);
-            }
-        }
-
-        @Override
-        public void onUnityAdsClick(String placementId) {
-            IUnityAdsExtendedListener listener = mUnityAdsListeners.get(placementId);
-            if (listener != null) {
-                listener.onUnityAdsClick(placementId);
-            }
-        }
-
-        // @Override
-        public void onUnityAdsPlacementStateChanged(String placementId, UnityAds.PlacementState oldState, UnityAds.PlacementState newState) {
-
-        }
-
-        @Override
-        public void onUnityAdsError(UnityAds.UnityAdsError unityAdsError, String message) {
-            IUnityAdsExtendedListener listener = mUnityAdsListeners.get(sCurrentPlacementId);
-            if (listener != null) {
-                listener.onUnityAdsError(unityAdsError, message);
-            }
-        }
-    }
-
-    static final class UnityAdsUtils {
-        static MoPubErrorCode getMoPubErrorCode(UnityAds.UnityAdsError unityAdsError) {
-            MoPubErrorCode errorCode;
-            switch (unityAdsError) {
-                case VIDEO_PLAYER_ERROR:
-                    errorCode = MoPubErrorCode.VIDEO_PLAYBACK_ERROR;
-                    break;
-                case INVALID_ARGUMENT:
-                    errorCode = MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR;
-                    break;
-                case INTERNAL_ERROR:
-                    errorCode = MoPubErrorCode.NETWORK_INVALID_STATE;
-                    break;
-                default:
-                    errorCode = MoPubErrorCode.NETWORK_NO_FILL;
-                    break;
-            }
-            return errorCode;
-        }
-    }
-
-    static class UnityAdsException extends RuntimeException {
-        private final UnityAds.UnityAdsError errorCode;
-
-        public UnityAdsException(UnityAds.UnityAdsError errorCode, String detailFormat, Object... args) {
-            this(errorCode, String.format(detailFormat, args));
-        }
-
-        public UnityAdsException(UnityAds.UnityAdsError errorCode, String detailMessage) {
-            super(detailMessage);
-            this.errorCode = errorCode;
-        }
-
-        public UnityAds.UnityAdsError getErrorCode() {
-            return errorCode;
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/VungleInterstitial.java b/extras/src/com/mopub/mobileads/VungleInterstitial.java
deleted file mode 100644
index ba140085..00000000
--- a/extras/src/com/mopub/mobileads/VungleInterstitial.java
+++ /dev/null
@@ -1,237 +0,0 @@
-package com.mopub.mobileads;
-
-import android.content.Context;
-import android.os.Handler;
-import android.os.Looper;
-import android.support.annotation.NonNull;
-
-import com.mopub.common.logging.MoPubLog;
-
-import java.util.Map;
-
-/**
- * A custom event for showing Vungle Interstitial.
- * <p>
- * Certified with Vungle SDK 5.3.0
- */
-public class VungleInterstitial extends CustomEventInterstitial {
-
-    private static final String INTERSTITIAL_TAG = "Vungle Interstitial: ";
-
-    /*
-     * APP_ID_KEY is intended for MoPub internal use. Do not modify.
-     */
-    public static final String APP_ID_KEY = "appId";
-    public static final String PLACEMENT_ID_KEY = "pid";
-    public static final String PLACEMENT_IDS_KEY = "pids";
-
-    private static VungleRouter sVungleRouter;
-    private final Handler mHandler;
-    private CustomEventInterstitialListener mCustomEventInterstitialListener;
-    private VungleInterstitialRouterListener mVungleRouterListener;
-    private String mAppId;
-    private String mPlacementId;
-    private String[] mPlacementIds;
-    private boolean mIsPlaying;
-
-
-    public VungleInterstitial() {
-        mHandler = new Handler(Looper.getMainLooper());
-        sVungleRouter = VungleRouter.getInstance();
-    }
-
-    @Override
-    protected void loadInterstitial(Context context,
-            CustomEventInterstitialListener customEventInterstitialListener,
-            Map<String, Object> localExtras,
-            Map<String, String> serverExtras) {
-        mCustomEventInterstitialListener = customEventInterstitialListener;
-        mIsPlaying = false;
-
-        if (context == null) {
-            mHandler.post(new Runnable() {
-                @Override
-                public void run() {
-                    mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_INVALID_STATE);
-                }
-            });
-
-            return;
-        }
-
-        if (!validateIdsInServerExtras(serverExtras)) {
-            mHandler.post(new Runnable() {
-                @Override
-                public void run() {
-                    mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-                }
-            });
-
-            return;
-        }
-
-        if (mVungleRouterListener == null) {
-            mVungleRouterListener = new VungleInterstitialRouterListener();
-        }
-
-        if (!sVungleRouter.isVungleInitialized()) {
-            sVungleRouter.initVungle(context, mAppId, mPlacementIds);
-        }
-
-        sVungleRouter.loadAdForPlacement(mPlacementId, mVungleRouterListener);
-    }
-
-    @Override
-    protected void showInterstitial() {
-        if (sVungleRouter.isAdPlayableForPlacement(mPlacementId)) {
-            sVungleRouter.playAdForPlacement(mPlacementId, null);
-            mIsPlaying = true;
-        } else {
-            MoPubLog.d(INTERSTITIAL_TAG + "SDK tried to show a Vungle interstitial ad before it finished loading. Please try again.");
-            mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-        }
-    }
-
-    @Override
-    protected void onInvalidate() {
-        MoPubLog.d(INTERSTITIAL_TAG + "onInvalidate is called for Placement ID:" + mPlacementId);
-        sVungleRouter.removeRouterListener(mPlacementId);
-        mVungleRouterListener = null;
-    }
-
-    // private functions
-    private boolean validateIdsInServerExtras(Map<String, String> serverExtras) {
-        boolean isAllDataValid = true;
-
-        if (serverExtras.containsKey(APP_ID_KEY)) {
-            mAppId = serverExtras.get(APP_ID_KEY);
-            if (mAppId.isEmpty()) {
-                MoPubLog.w(INTERSTITIAL_TAG + "App ID is empty.");
-                isAllDataValid = false;
-            }
-        } else {
-            MoPubLog.w(INTERSTITIAL_TAG + "AppID is not in serverExtras.");
-            isAllDataValid = false;
-        }
-
-        if (serverExtras.containsKey(PLACEMENT_ID_KEY)) {
-            mPlacementId = serverExtras.get(PLACEMENT_ID_KEY);
-            if (mPlacementId.isEmpty()) {
-                MoPubLog.w(INTERSTITIAL_TAG + "Placement ID for this Ad Unit is empty.");
-                isAllDataValid = false;
-            }
-        } else {
-            MoPubLog.w(INTERSTITIAL_TAG + "Placement ID for this Ad Unit is not in serverExtras.");
-            isAllDataValid = false;
-        }
-
-        if (serverExtras.containsKey(PLACEMENT_IDS_KEY)) {
-            mPlacementIds = serverExtras.get(PLACEMENT_IDS_KEY).replace(" ", "").split(",", 0);
-            if (mPlacementIds.length == 0) {
-                MoPubLog.w(INTERSTITIAL_TAG + "Placement IDs are empty.");
-                isAllDataValid = false;
-            }
-        } else {
-            MoPubLog.w(INTERSTITIAL_TAG + "Placement IDs for this Ad Unit is not in serverExtras.");
-            isAllDataValid = false;
-        }
-
-        if (isAllDataValid) {
-            boolean foundInList = false;
-            for (String pid : mPlacementIds) {
-                if (pid.equals(mPlacementId)) {
-                    foundInList = true;
-                }
-            }
-            if (!foundInList) {
-                MoPubLog.w(INTERSTITIAL_TAG + "Placement IDs for this Ad Unit is not in the array of Placement IDs");
-                isAllDataValid = false;
-            }
-        }
-
-        return isAllDataValid;
-    }
-
-
-    /*
-     * VungleRouterListener
-     */
-    private class VungleInterstitialRouterListener implements VungleRouterListener {
-        @Override
-        public void onAdEnd(@NonNull String placementReferenceId, final boolean wasSuccessfulView, final boolean wasCallToActionClicked) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                MoPubLog.d(INTERSTITIAL_TAG + "onAdEnd - Placement ID: " + placementReferenceId + ", wasSuccessfulView: " + wasSuccessfulView + ", wasCallToActionClicked: " + wasCallToActionClicked);
-                mIsPlaying = false;
-
-                mHandler.post(new Runnable() {
-                    @Override
-                    public void run() {
-                        if (wasCallToActionClicked) {
-                            mCustomEventInterstitialListener.onInterstitialClicked();
-                        }
-                        mCustomEventInterstitialListener.onInterstitialDismissed();
-                    }
-                });
-
-                sVungleRouter.removeRouterListener(mPlacementId);
-            }
-        }
-
-        @Override
-        public void onAdStart(@NonNull String placementReferenceId) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                MoPubLog.d(INTERSTITIAL_TAG + "onAdStart - Placement ID: " + placementReferenceId);
-                mIsPlaying = true;
-
-                mHandler.post(new Runnable() {
-                    @Override
-                    public void run() {
-                        mCustomEventInterstitialListener.onInterstitialShown();
-                    }
-                });
-            }
-        }
-
-        @Override
-        public void onUnableToPlayAd(@NonNull String placementReferenceId, String reason) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                MoPubLog.d(INTERSTITIAL_TAG + "onUnableToPlayAd - Placement ID: " + placementReferenceId + ", reason: " + reason);
-                mIsPlaying = false;
-
-                mHandler.post(new Runnable() {
-                    @Override
-                    public void run() {
-                        mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-                    }
-                });
-            }
-        }
-
-        @Override
-        public void onAdAvailabilityUpdate(@NonNull String placementReferenceId, boolean isAdAvailable) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                if (!mIsPlaying) {
-                    if (isAdAvailable) {
-                        MoPubLog.d(INTERSTITIAL_TAG + "interstitial ad successfully loaded - Placement ID: " + placementReferenceId);
-
-                        mHandler.post(new Runnable() {
-                            @Override
-                            public void run() {
-                                mCustomEventInterstitialListener.onInterstitialLoaded();
-                            }
-                        });
-                    } else {
-                        MoPubLog.d(INTERSTITIAL_TAG + "interstitial ad is not loaded - Placement ID: " + placementReferenceId);
-
-                        mHandler.post(new Runnable() {
-                            @Override
-                            public void run() {
-                                mCustomEventInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-                            }
-                        });
-                    }
-                }
-            }
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/VungleRewardedVideo.java b/extras/src/com/mopub/mobileads/VungleRewardedVideo.java
deleted file mode 100644
index 6a44e429..00000000
--- a/extras/src/com/mopub/mobileads/VungleRewardedVideo.java
+++ /dev/null
@@ -1,364 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.text.TextUtils;
-
-import com.mopub.common.DataKeys;
-import com.mopub.common.LifecycleListener;
-import com.mopub.common.MediationSettings;
-import com.mopub.common.MoPubReward;
-import com.mopub.common.logging.MoPubLog;
-
-import com.vungle.publisher.AdConfig;
-
-import java.util.Map;
-
-/**
- * A custom event for showing Vungle rewarded videos.
- *
- * Certified with Vungle SDK 5.3.0
- */
-public class VungleRewardedVideo extends CustomEventRewardedVideo {
-
-    private static final String REWARDED_TAG = "Vungle Rewarded: ";
-
-    /*
-     * These constants are intended for MoPub internal use. Do not modify.
-     */
-    public static final String APP_ID_KEY = "appId";
-    public static final String PLACEMENT_ID_KEY = "pid";
-    public static final String PLACEMENT_IDS_KEY = "pids";
-
-    public static final String VUNGLE_NETWORK_ID_DEFAULT = "vngl_id";
-    private static final String VUNGLE_DEFAULT_APP_ID = "YOUR_APP_ID_HERE";
-    private static final String[] VUNGLE_DEFAULT_ALL_PLACEMENT_IDS = {"PLACEMENT_ID_1", "PLACEMENT_ID_2", "..."};
-
-    private static VungleRouter sVungleRouter;
-    private VungleRewardedRouterListener mVungleRewardedRouterListener;
-    private static boolean sInitialized;
-    private String mAppId;
-    private String mPlacementId;
-    private String[] mPlacementIds;
-    private boolean mIsPlaying;
-
-    private String mAdUnitId;
-    private String mCustomerId;
-
-
-    public VungleRewardedVideo() {
-        sVungleRouter = VungleRouter.getInstance();
-
-        if (mVungleRewardedRouterListener == null) {
-            mVungleRewardedRouterListener = new VungleRewardedRouterListener();
-        }
-    }
-
-    @Nullable
-    @Override
-    public LifecycleListener getLifecycleListener() {
-        return sVungleRouter.getLifecycleListener();
-    }
-
-    @NonNull
-    @Override
-    protected String getAdNetworkId() {
-        return mPlacementId;
-    }
-
-    @Override
-    protected boolean checkAndInitializeSdk(@NonNull final Activity launcherActivity,
-            @NonNull final Map<String, Object> localExtras,
-            @NonNull final Map<String, String> serverExtras) throws Exception {
-        synchronized (VungleRewardedVideo.class) {
-            if (sInitialized) {
-                return false;
-            }
-
-            if (!validateIdsInServerExtras(serverExtras)) {
-                mAppId = VUNGLE_DEFAULT_APP_ID;
-                mPlacementIds = VUNGLE_DEFAULT_ALL_PLACEMENT_IDS;
-            }
-
-            if (!sVungleRouter.isVungleInitialized()) {
-                sVungleRouter.initVungle(launcherActivity, mAppId, mPlacementIds);
-            }
-
-            sInitialized = true;
-
-            return true;
-        }
-    }
-
-    @Override
-    protected void loadWithSdkInitialized(@NonNull final Activity activity, @NonNull final Map<String, Object> localExtras, @NonNull final Map<String, String> serverExtras) throws Exception {
-        mIsPlaying = false;
-
-        if (!validateIdsInServerExtras(serverExtras)) {
-            mPlacementId = VUNGLE_NETWORK_ID_DEFAULT;
-            MoPubRewardedVideoManager.onRewardedVideoLoadFailure(VungleRewardedVideo.class, mPlacementId, MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-
-            return;
-        }
-
-        Object adUnitObject = localExtras.get(DataKeys.AD_UNIT_ID_KEY);
-        if (adUnitObject instanceof String) {
-            mAdUnitId = (String) adUnitObject;
-        }
-
-        Object customerIdObject = localExtras.get(DataKeys.REWARDED_AD_CUSTOMER_ID_KEY);
-        if (customerIdObject instanceof String && !TextUtils.isEmpty((String) customerIdObject)) {
-            mCustomerId = (String) customerIdObject;
-        }
-
-        if (sVungleRouter.isVungleInitialized()) {
-            sVungleRouter.loadAdForPlacement(mPlacementId, mVungleRewardedRouterListener);
-        }
-        else {
-            MoPubLog.d(REWARDED_TAG + "There should not be this case. loadWithSdkInitialized is called before the SDK starts initialization for Placement ID: " + mPlacementId);
-            MoPubRewardedVideoManager.onRewardedVideoLoadFailure(VungleRewardedVideo.class, mPlacementId, MoPubErrorCode.ADAPTER_CONFIGURATION_ERROR);
-        }
-    }
-
-    @Override
-    protected boolean hasVideoAvailable() {
-        return sVungleRouter.isAdPlayableForPlacement(mPlacementId);
-    }
-
-    @Override
-    protected void showVideo() {
-        final AdConfig adConfig = new AdConfig();
-        setUpMediationSettingsForRequest(adConfig);
-
-        sVungleRouter.playAdForPlacement(mPlacementId, adConfig);
-        mIsPlaying = true;
-    }
-
-    @Override
-    protected void onInvalidate() {
-        MoPubLog.d(REWARDED_TAG + "onInvalidate is called for Placement ID:" + mPlacementId);
-
-        sVungleRouter.removeRouterListener(mPlacementId);
-        mVungleRewardedRouterListener = null;
-    }
-
-
-    //private functions
-    private boolean validateIdsInServerExtras (Map<String, String> serverExtras) {
-        boolean isAllDataValid = true;
-
-        if (serverExtras.containsKey(APP_ID_KEY)) {
-            mAppId = serverExtras.get(APP_ID_KEY);
-            if (mAppId.isEmpty()) {
-                MoPubLog.w(REWARDED_TAG + "App ID is empty.");
-                isAllDataValid = false;
-            }
-        } else {
-            MoPubLog.w(REWARDED_TAG + "AppID is not in serverExtras.");
-            isAllDataValid = false;
-        }
-
-        if (serverExtras.containsKey(PLACEMENT_ID_KEY)) {
-            mPlacementId = serverExtras.get(PLACEMENT_ID_KEY);
-            if (mPlacementId.isEmpty()) {
-                MoPubLog.w(REWARDED_TAG + "Placement ID for this Ad Unit is empty.");
-                isAllDataValid = false;
-            }
-        } else {
-            MoPubLog.w(REWARDED_TAG + "Placement ID for this Ad Unit is not in serverExtras.");
-            isAllDataValid = false;
-        }
-
-        if (serverExtras.containsKey(PLACEMENT_IDS_KEY)) {
-            mPlacementIds = serverExtras.get(PLACEMENT_IDS_KEY).replace(" ", "").split(",", 0);
-            if (mPlacementIds.length == 0) {
-                MoPubLog.w(REWARDED_TAG + "Placement IDs are empty.");
-                isAllDataValid = false;
-            }
-        } else {
-            MoPubLog.w(REWARDED_TAG + "Placement IDs for this Ad Unit is not in serverExtras.");
-            isAllDataValid = false;
-        }
-
-        if (isAllDataValid) {
-            boolean foundInList = false;
-            for (String pid:  mPlacementIds) {
-                if(pid.equals(mPlacementId)) {
-                    foundInList = true;
-                }
-            }
-            if(!foundInList) {
-                MoPubLog.w(REWARDED_TAG + "Placement IDs for this Ad Unit is not in the array of Placement IDs");
-                isAllDataValid = false;
-            }
-        }
-
-        return isAllDataValid;
-    }
-
-    private void setUpMediationSettingsForRequest(AdConfig adConfig) {
-        final VungleMediationSettings globalMediationSettings =
-                MoPubRewardedVideoManager.getGlobalMediationSettings(VungleMediationSettings.class);
-        final VungleMediationSettings instanceMediationSettings =
-                MoPubRewardedVideoManager.getInstanceMediationSettings(VungleMediationSettings.class, mAdUnitId);
-
-        // Local options override global options.
-        // The two objects are not merged.
-        if (instanceMediationSettings != null) {
-            modifyAdConfig(adConfig, instanceMediationSettings);
-        } else if (globalMediationSettings != null) {
-            modifyAdConfig(adConfig, globalMediationSettings);
-        }
-    }
-
-    private void modifyAdConfig(AdConfig adConfig, VungleMediationSettings mediationSettings) {
-        if (!TextUtils.isEmpty(mediationSettings.body)) {
-            adConfig.setIncentivizedCancelDialogBodyText(mediationSettings.body);
-        }
-        if (!TextUtils.isEmpty(mediationSettings.closeButtonText)) {
-            adConfig.setIncentivizedCancelDialogCloseButtonText(mediationSettings.closeButtonText);
-        }
-        if (!TextUtils.isEmpty(mediationSettings.keepWatchingButtonText)) {
-            adConfig.setIncentivizedCancelDialogKeepWatchingButtonText(mediationSettings.keepWatchingButtonText);
-        }
-        if (!TextUtils.isEmpty(mediationSettings.title)) {
-            adConfig.setIncentivizedCancelDialogTitle(mediationSettings.title);
-        }
-        if (!TextUtils.isEmpty(mCustomerId)) {
-            adConfig.setIncentivizedUserId(mCustomerId);
-        } else if (!TextUtils.isEmpty(mediationSettings.userId)) {
-            adConfig.setIncentivizedUserId(mediationSettings.userId);
-        }
-    }
-
-
-    /*
-     * VungleRewardedRouterListener
-     */
-    private class VungleRewardedRouterListener implements VungleRouterListener {
-        @Override
-        public void onAdEnd(@NonNull String placementReferenceId, final boolean wasSuccessfulView, final boolean wasCallToActionClicked) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                MoPubLog.d(REWARDED_TAG + "onAdEnd - Placement ID: " + placementReferenceId + ", wasSuccessfulView: " + wasSuccessfulView + ", wasCallToActionClicked: " + wasCallToActionClicked);
-
-                mIsPlaying = false;
-
-                if (wasSuccessfulView) {
-                    // Vungle does not provide a callback when a user should be rewarded.
-                    // You will need to provide your own reward logic if you receive a reward with
-                    // "NO_REWARD_LABEL" && "NO_REWARD_AMOUNT"
-                    MoPubRewardedVideoManager.onRewardedVideoCompleted(VungleRewardedVideo.class,
-                            mPlacementId,
-                            MoPubReward.success(MoPubReward.NO_REWARD_LABEL,
-                                    MoPubReward.NO_REWARD_AMOUNT));
-                }
-
-                if (wasCallToActionClicked) {
-                    MoPubRewardedVideoManager.onRewardedVideoClicked(VungleRewardedVideo.class,
-                            mPlacementId);
-                }
-
-                MoPubRewardedVideoManager.onRewardedVideoClosed(VungleRewardedVideo.class,
-                        mPlacementId);
-
-                sVungleRouter.removeRouterListener(mPlacementId);
-            }
-        }
-
-        @Override
-        public void onAdStart(@NonNull String placementReferenceId) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                MoPubLog.d(REWARDED_TAG + "onAdStart - Placement ID: " + placementReferenceId);
-
-                mIsPlaying = true;
-
-                MoPubRewardedVideoManager.onRewardedVideoStarted(VungleRewardedVideo.class,
-                        mPlacementId);
-            }
-        }
-
-        @Override
-        public void onUnableToPlayAd(@NonNull String placementReferenceId, String reason) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                MoPubLog.d(REWARDED_TAG + "onUnableToPlayAd - Placement ID: " + placementReferenceId + ", reason: " + reason);
-
-                mIsPlaying = false;
-                MoPubRewardedVideoManager.onRewardedVideoLoadFailure(VungleRewardedVideo.class,
-                        mPlacementId, MoPubErrorCode.NETWORK_NO_FILL);
-            }
-        }
-
-        @Override
-        public void onAdAvailabilityUpdate(@NonNull String placementReferenceId, boolean isAdAvailable) {
-            if (mPlacementId.equals(placementReferenceId)) {
-                if (!mIsPlaying) {
-                    if (isAdAvailable) {
-                        MoPubLog.d(REWARDED_TAG + "rewarded video ad successfully loaded - Placement ID: " + placementReferenceId);
-                        MoPubRewardedVideoManager.onRewardedVideoLoadSuccess(VungleRewardedVideo.class,
-                                mPlacementId);
-                    }
-                    else {
-                        MoPubLog.d(REWARDED_TAG + "rewarded video ad is not loaded - Placement ID: " + placementReferenceId);
-                        MoPubRewardedVideoManager.onRewardedVideoLoadFailure(VungleRewardedVideo.class,
-                                mPlacementId, MoPubErrorCode.NETWORK_NO_FILL);
-                    }
-                }
-            }
-        }
-    }
-
-
-    public static class VungleMediationSettings implements MediationSettings {
-        @Nullable private final String userId;
-        @Nullable private final String title;
-        @Nullable private final String body;
-        @Nullable private final String closeButtonText;
-        @Nullable private final String keepWatchingButtonText;
-
-        public static class Builder {
-            @Nullable private String userId;
-            @Nullable private String title;
-            @Nullable private String body;
-            @Nullable private String closeButtonText;
-            @Nullable private String keepWatchingButtonText;
-
-            public Builder withUserId(@NonNull final String userId) {
-                this.userId = userId;
-                return this;
-            }
-
-            public Builder withCancelDialogTitle(@NonNull final String title) {
-                this.title = title;
-                return this;
-            }
-
-            public Builder withCancelDialogBody(@NonNull final String body) {
-                this.body = body;
-                return this;
-            }
-
-            public Builder withCancelDialogCloseButton(@NonNull final String buttonText) {
-                this.closeButtonText = buttonText;
-                return this;
-            }
-
-            public Builder withCancelDialogKeepWatchingButton(@NonNull final String buttonText) {
-                this.keepWatchingButtonText = buttonText;
-                return this;
-            }
-
-            public VungleMediationSettings build() {
-                return new VungleMediationSettings(this);
-            }
-        }
-
-        private VungleMediationSettings(@NonNull final Builder builder) {
-            this.userId = builder.userId;
-            this.title = builder.title;
-            this.body = builder.body;
-            this.closeButtonText = builder.closeButtonText;
-            this.keepWatchingButtonText = builder.keepWatchingButtonText;
-        }
-    }
-}
diff --git a/extras/src/com/mopub/mobileads/VungleRouter.java b/extras/src/com/mopub/mobileads/VungleRouter.java
deleted file mode 100644
index 46a499f7..00000000
--- a/extras/src/com/mopub/mobileads/VungleRouter.java
+++ /dev/null
@@ -1,211 +0,0 @@
-package com.mopub.mobileads;
-
-import android.app.Activity;
-import android.content.Context;
-import android.support.annotation.NonNull;
-
-import com.mopub.common.BaseLifecycleListener;
-import com.mopub.common.LifecycleListener;
-import com.mopub.common.logging.MoPubLog;
-
-import com.vungle.publisher.AdConfig;
-import com.vungle.publisher.VungleAdEventListener;
-import com.vungle.publisher.VungleInitListener;
-import com.vungle.publisher.VunglePub;
-import com.vungle.publisher.env.WrapperFramework;
-import com.vungle.publisher.inject.Injector;
-
-import java.util.HashMap;
-import java.util.Map;
-
-
-/**
- * Certified with Vungle SDK 5.3.0
- */
-public class VungleRouter {
-
-    private static final String ROUTER_TAG = "Vungle Router: ";
-
-    // Version of the adapter, intended for Vungle internal use.
-    private static final String VERSION = "5.3.0";
-
-    private static VungleRouter instance = new VungleRouter();
-    private enum SDKInitState {
-        NOTINITIALIZED,
-        INITIALIZING,
-        INITIALIZED;
-    }
-
-    private static SDKInitState sInitState = SDKInitState.NOTINITIALIZED;
-    private static VunglePub sVunglePub;
-    private static Map<String, VungleRouterListener> sVungleRouterListeners = new HashMap<>();
-    private static Map<String, VungleRouterListener> sWaitingList = new HashMap<>();
-
-    private static final LifecycleListener sLifecycleListener = new BaseLifecycleListener() {
-        @Override
-        public void onPause(@NonNull final Activity activity) {
-            super.onPause(activity);
-            sVunglePub.onPause();
-        }
-
-        @Override
-        public void onResume(@NonNull final Activity activity) {
-            super.onResume(activity);
-            sVunglePub.onResume();
-        }
-    };
-
-
-    private VungleRouter() {
-        Injector injector = Injector.getInstance();
-        injector.setWrapperFramework(WrapperFramework.mopub);
-        injector.setWrapperFrameworkVersion(VERSION.replace('.', '_'));
-
-        sVunglePub = VunglePub.getInstance();
-    }
-
-    public static VungleRouter getInstance() {
-        return instance;
-    }
-
-    public LifecycleListener getLifecycleListener() {
-        return sLifecycleListener;
-    }
-
-
-    public void initVungle(Context context, String vungleAppId, String[] placementReferenceIds) {
-        sVunglePub.init(context, vungleAppId, placementReferenceIds, new VungleInitListener() {
-            @Override
-            public void onSuccess() {
-                MoPubLog.d(ROUTER_TAG + "SDK is initialized successfully.");
-
-                sInitState = SDKInitState.INITIALIZED;
-
-                sVunglePub.clearAndSetEventListeners(vungleDefaultListener);
-                clearWaitingList();
-            }
-
-            @Override
-            public void onFailure(Throwable throwable) {
-                MoPubLog.w(ROUTER_TAG + "Initialization is failed.");
-
-                sInitState = SDKInitState.NOTINITIALIZED;
-            }
-        });
-
-        sInitState = SDKInitState.INITIALIZING;
-    }
-
-    public boolean isVungleInitialized() {
-        if (sInitState == SDKInitState.NOTINITIALIZED) {
-            return false;
-        } else if (sInitState == SDKInitState.INITIALIZING) {
-            return true;
-        } else if (sInitState == SDKInitState.INITIALIZED) {
-            return true;
-        }
-
-        return sVunglePub.isInitialized();
-    }
-
-    public void loadAdForPlacement(String placementId, VungleRouterListener routerListener) {
-        switch (sInitState) {
-            case NOTINITIALIZED:
-                MoPubLog.w(ROUTER_TAG + "There should not be this case. loadAdForPlacement is called before initialization starts.");
-                break;
-
-            case INITIALIZING:
-                sWaitingList.put(placementId, routerListener);
-                break;
-
-            case INITIALIZED:
-                addRouterListener(placementId, routerListener);
-                sVunglePub.loadAd(placementId);
-                break;
-        }
-    }
-
-    private void addRouterListener(String placementId, VungleRouterListener routerListener) {
-        sVungleRouterListeners.put(placementId, routerListener);
-    }
-
-    public void removeRouterListener(String placementId) {
-        sVungleRouterListeners.remove(placementId);
-    }
-
-    public boolean isAdPlayableForPlacement(String placementId) {
-        return sVunglePub.isAdPlayable(placementId);
-    }
-
-    public void playAdForPlacement(String placementId, AdConfig adConfig) {
-        if (sVunglePub.isAdPlayable(placementId)) {
-            sVunglePub.playAd(placementId, adConfig);
-        }
-        else {
-            MoPubLog.w(ROUTER_TAG + "There should not be this case. playAdForPlacement is called before an ad is loaded for Placement ID: " + placementId);
-        }
-    }
-
-    private void clearWaitingList() {
-        for (Map.Entry<String, VungleRouterListener> entry : sWaitingList.entrySet()) {
-            sVunglePub.loadAd(entry.getKey());
-            sVungleRouterListeners.put(entry.getKey(),entry.getValue());
-        }
-
-        sWaitingList.clear();
-    }
-
-
-    /*
-     * VungleAdEventListener
-     */
-    private final VungleAdEventListener vungleDefaultListener = new VungleAdEventListener() {
-        @Override
-        public void onAdEnd(@NonNull String placementReferenceId, final boolean wasSuccessfulView, final boolean wasCallToActionClicked) {
-            MoPubLog.d(ROUTER_TAG + "onAdEnd - Placement ID: " + placementReferenceId);
-
-            VungleRouterListener targetListener = sVungleRouterListeners.get(placementReferenceId);
-            if (targetListener != null) {
-                targetListener.onAdEnd(placementReferenceId, wasSuccessfulView, wasCallToActionClicked);
-            } else {
-                MoPubLog.w(ROUTER_TAG + "onAdEnd - VungleRouterListener is not found for Placement ID: " + placementReferenceId);
-            }
-        }
-
-        @Override
-        public void onAdStart(@NonNull String placementReferenceId) {
-            MoPubLog.d(ROUTER_TAG + "onAdStart - Placement ID: " + placementReferenceId);
-
-            VungleRouterListener targetListener = sVungleRouterListeners.get(placementReferenceId);
-            if (targetListener != null) {
-                targetListener.onAdStart(placementReferenceId);
-            } else {
-                MoPubLog.w(ROUTER_TAG + "onAdStart - VungleRouterListener is not found for Placement ID: " + placementReferenceId);
-            }
-        }
-
-        @Override
-        public void onUnableToPlayAd(@NonNull String placementReferenceId, String reason) {
-            MoPubLog.d(ROUTER_TAG + "onUnableToPlayAd - Placement ID: " + placementReferenceId);
-
-            VungleRouterListener targetListener = sVungleRouterListeners.get(placementReferenceId);
-            if (targetListener != null) {
-                targetListener.onUnableToPlayAd(placementReferenceId, reason);
-            } else {
-                MoPubLog.w(ROUTER_TAG + "onUnableToPlayAd - VungleRouterListener is not found for Placement ID: " + placementReferenceId);
-            }
-        }
-
-        @Override
-        public void onAdAvailabilityUpdate(@NonNull String placementReferenceId, boolean isAdAvailable) {
-            MoPubLog.d(ROUTER_TAG + "onAdAvailabilityUpdate - Placement ID: " + placementReferenceId);
-
-            VungleRouterListener targetListener = sVungleRouterListeners.get(placementReferenceId);
-            if (targetListener != null) {
-                targetListener.onAdAvailabilityUpdate(placementReferenceId, isAdAvailable);
-            } else {
-                MoPubLog.w(ROUTER_TAG + "onAdAvailabilityUpdate - VungleRouterListener is not found for Placement ID: " + placementReferenceId);
-            }
-        }
-    };
-}
diff --git a/extras/src/com/mopub/mobileads/VungleRouterListener.java b/extras/src/com/mopub/mobileads/VungleRouterListener.java
deleted file mode 100644
index 057a8af4..00000000
--- a/extras/src/com/mopub/mobileads/VungleRouterListener.java
+++ /dev/null
@@ -1,16 +0,0 @@
-package com.mopub.mobileads;
-
-import android.support.annotation.NonNull;
-
-/**
- * Certified with Vungle SDK 5.3.0
- */
-public interface VungleRouterListener {
-    void onAdEnd(@NonNull String var1, boolean var2, boolean var3);
-
-    void onAdStart(@NonNull String var1);
-
-    void onUnableToPlayAd(@NonNull String var1, String var2);
-
-    void onAdAvailabilityUpdate(@NonNull String var1, boolean var2);
-}
diff --git a/extras/src/com/mopub/nativeads/FlurryBaseNativeAd.java b/extras/src/com/mopub/nativeads/FlurryBaseNativeAd.java
deleted file mode 100644
index 3e24799b..00000000
--- a/extras/src/com/mopub/nativeads/FlurryBaseNativeAd.java
+++ /dev/null
@@ -1,37 +0,0 @@
-package com.mopub.nativeads;
-
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-
-import java.util.List;
-import java.util.Map;
-
-/**
- * Certified with Flurry 8.1.0
- */
-public interface FlurryBaseNativeAd {
-
-    void fetchAd();
-    @NonNull List<String> getImageUrls();
-    boolean isAppInstallAd();
-    void precacheImages();
-
-    @Nullable String getTitle();
-    @Nullable String getText();
-    @Nullable String getCallToAction();
-    @Nullable String getMainImageUrl();
-    @Nullable String getIconImageUrl();
-    @Nullable Double getStarRating();
-    @Nullable Map<String, Object> getExtras();
-
-
-    void setTitle(@Nullable final String title);
-    void setText(@Nullable final String text);
-    void setCallToAction(@Nullable final String callToAction);
-    void setMainImageUrl(@Nullable final String mainImageUrl);
-    void setIconImageUrl(@Nullable final String iconImageUrl);
-    void setStarRating(@Nullable final Double starRating);
-    void addExtra(@NonNull final String key, @Nullable final Object value);
-
-    void onNativeAdLoaded();
-}
diff --git a/extras/src/com/mopub/nativeads/FlurryCustomEventNative.java b/extras/src/com/mopub/nativeads/FlurryCustomEventNative.java
deleted file mode 100644
index 1fd7d61f..00000000
--- a/extras/src/com/mopub/nativeads/FlurryCustomEventNative.java
+++ /dev/null
@@ -1,636 +0,0 @@
-package com.mopub.nativeads;
-
-import android.content.Context;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.text.TextUtils;
-import android.util.Log;
-import android.view.View;
-import android.view.ViewGroup;
-
-import com.flurry.android.FlurryAgentListener;
-import com.flurry.android.ads.FlurryAdErrorType;
-import com.flurry.android.ads.FlurryAdNative;
-import com.flurry.android.ads.FlurryAdNativeAsset;
-import com.flurry.android.ads.FlurryAdNativeListener;
-import com.flurry.android.ads.FlurryAdTargeting;
-import com.mopub.mobileads.FlurryAgentWrapper;
-
-import java.util.ArrayList;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-
-/**
- * Certified with Flurry 8.1.0
- */
-public final class FlurryCustomEventNative extends CustomEventNative {
-
-    /**
-     * Extra image asset for the star-rating of app-install ads.
-     */
-    public static final String EXTRA_STAR_RATING_IMG = "flurry_starratingimage";
-    /**
-     * Extra text asset specifying the category for app-install ads.
-     */
-    public static final String EXTRA_APP_CATEGORY = "flurry_appcategorytext";
-    /**
-     * Extra image asset for the Flurry native ad branding logo.
-     */
-    public static final String EXTRA_SEC_BRANDING_LOGO = "flurry_brandingimage";
-    /**
-     * Key for enabling Flurry debug logging. After manually creating a {@link MoPubNative} object,
-     * pass in <code>true</code> as a value for this key in the map passed to
-     * {@link MoPubNative#setLocalExtras(Map)}.
-     *
-     * E.g.
-     *
-     * <blockquote><pre>
-     * {@code
-     * Map<String, Object> adapterExtras = new TreeMap<String, Object>();
-     * adapterExtras.put(FlurryCustomEventNative.LOCAL_EXTRA_TEST_MODE, true);
-     * mMoPubNative.setLocalExtras(adapterExtras);
-     * }
-     * </pre></blockquote>
-     *
-     * Debug logging is disabled on the Flurry SDK by default.
-     */
-    public static final String LOCAL_EXTRA_TEST_MODE = "enableTestMode";
-    private static final String LOG_TAG = FlurryCustomEventNative.class.getSimpleName();
-    private static final String ASSET_SEC_HQ_IMAGE = "secHqImage";
-    private static final String ASSET_SEC_IMAGE = "secImage";
-    private static final String ASSET_SEC_HQ_RATING_IMG = "secHqRatingImg";
-    private static final String ASSET_SEC_HQ_BRANDING_LOGO = "secHqBrandingLogo";
-    private static final String ASSET_SEC_RATING_IMG = "secRatingImg";
-    private static final String ASSET_APP_RATING = "appRating";
-    private static final String ASSET_APP_CATEGORY = "appCategory";
-    private static final String ASSET_HEADLINE = "headline";
-    private static final String ASSET_SUMMARY = "summary";
-    private static final String ASSET_CALL_TO_ACTION = "callToAction";
-    private static final String ASSET_VIDEO = "videoUrl";
-    private static final double MOPUB_STAR_RATING_SCALE = StaticNativeAd.MAX_STAR_RATING;
-
-    private FlurryAgentListener mFlurryAgentListener;
-
-    /* Static reference of the ads to ensure they don't get garbage collected */
-    private final static List<FlurryAdNative> sFlurryNativeAds = new ArrayList<>();
-
-    @Override
-    protected void loadNativeAd(@NonNull final Context context,
-            @NonNull final CustomEventNativeListener customEventNativeListener,
-            @NonNull final Map<String, Object> localExtras,
-            @NonNull final Map<String, String> serverExtras) {
-
-        final String flurryApiKey;
-        final String flurryAdSpace;
-
-        //Get the FLURRY_APIKEY and FLURRY_ADSPACE from the server.
-        if (validateExtras(serverExtras)) {
-            flurryApiKey = serverExtras.get(FlurryAgentWrapper.PARAM_API_KEY);
-            flurryAdSpace = serverExtras.get(FlurryAgentWrapper.PARAM_AD_SPACE_NAME);
-
-            if (FlurryAgentWrapper.getInstance().isSessionActive() || mFlurryAgentListener != null) {
-                fetchFlurryAd(context, flurryAdSpace, localExtras, customEventNativeListener);
-            } else {
-                mFlurryAgentListener = new FlurryAgentListener() {
-                    @Override
-                    public void onSessionStarted() {
-                        fetchFlurryAd(context, flurryAdSpace, localExtras,
-                                customEventNativeListener);
-                    }
-                };
-
-                FlurryAgentWrapper.getInstance().startSession(context, flurryApiKey,
-                        mFlurryAgentListener);
-            }
-        } else {
-            customEventNativeListener.onNativeAdFailed(
-                    NativeErrorCode.NATIVE_ADAPTER_CONFIGURATION_ERROR);
-            Log.i(LOG_TAG, "Failed Native AdFetch: Missing required server extras" +
-                    " [FLURRY_APIKEY and/or FLURRY_ADSPACE].");
-        }
-    }
-
-    private static synchronized void mapNativeAd(@NonNull final FlurryBaseNativeAd mopubSupportedAd,
-            @NonNull final FlurryAdNative flurryAdNative) {
-        FlurryAdNativeAsset coverImageAsset = flurryAdNative.getAsset(ASSET_SEC_HQ_IMAGE);
-        FlurryAdNativeAsset iconImageAsset = flurryAdNative.getAsset(ASSET_SEC_IMAGE);
-
-        if (coverImageAsset != null && !TextUtils.isEmpty(coverImageAsset.getValue())) {
-            mopubSupportedAd.setMainImageUrl(coverImageAsset.getValue());
-        }
-        if (iconImageAsset != null && !TextUtils.isEmpty(iconImageAsset.getValue())) {
-            mopubSupportedAd.setIconImageUrl(iconImageAsset.getValue());
-        }
-
-        mopubSupportedAd.setTitle(flurryAdNative.getAsset(ASSET_HEADLINE).getValue());
-        mopubSupportedAd.setText(flurryAdNative.getAsset(ASSET_SUMMARY).getValue());
-        mopubSupportedAd.addExtra(EXTRA_SEC_BRANDING_LOGO,
-                flurryAdNative.getAsset(ASSET_SEC_HQ_BRANDING_LOGO).getValue());
-
-        if (mopubSupportedAd.isAppInstallAd()) {
-            // App rating image URL may be null
-            FlurryAdNativeAsset ratingHqImageAsset = flurryAdNative
-                    .getAsset(ASSET_SEC_HQ_RATING_IMG);
-            if (ratingHqImageAsset != null && !TextUtils.isEmpty(ratingHqImageAsset.getValue())) {
-                mopubSupportedAd.addExtra(EXTRA_STAR_RATING_IMG, ratingHqImageAsset.getValue());
-            } else {
-                FlurryAdNativeAsset ratingImageAsset = flurryAdNative
-                        .getAsset(ASSET_SEC_RATING_IMG);
-                if (ratingImageAsset != null && !TextUtils.isEmpty(ratingImageAsset.getValue())) {
-                    mopubSupportedAd.addExtra(EXTRA_STAR_RATING_IMG, ratingImageAsset.getValue());
-                }
-            }
-
-            FlurryAdNativeAsset appCategoryAsset = flurryAdNative.getAsset(ASSET_APP_CATEGORY);
-            if (appCategoryAsset != null) {
-                mopubSupportedAd.addExtra(EXTRA_APP_CATEGORY, appCategoryAsset.getValue());
-            }
-            FlurryAdNativeAsset appRatingAsset = flurryAdNative.getAsset(ASSET_APP_RATING);
-            if (appRatingAsset != null) {
-                mopubSupportedAd.setStarRating(getStarRatingValue(appRatingAsset.getValue()));
-            }
-        }
-
-        FlurryAdNativeAsset ctaAsset = flurryAdNative.getAsset(ASSET_CALL_TO_ACTION);
-        if (ctaAsset != null) {
-            mopubSupportedAd.setCallToAction(ctaAsset.getValue());
-        }
-
-        if (mopubSupportedAd.getImageUrls().isEmpty()) {
-            Log.d(LOG_TAG, "preCacheImages: No images to cache for Flurry Native Ad: " +
-                    flurryAdNative.toString());
-            mopubSupportedAd.onNativeAdLoaded();
-        } else {
-            mopubSupportedAd.precacheImages();
-        }
-    }
-
-    @Nullable
-    private static Double getStarRatingValue(@Nullable final String appRatingString) {
-        // App rating String should be of the form X/Y. E.g. 80/100
-        Double rating = null;
-        if (appRatingString != null) {
-            String[] ratingParts = appRatingString.split("/");
-            if (ratingParts.length == 2) {
-                try {
-                    float numer = Integer.valueOf(ratingParts[0]);
-                    float denom = Integer.valueOf(ratingParts[1]);
-                    rating = (numer / denom) * MOPUB_STAR_RATING_SCALE;
-                } catch (NumberFormatException e) { /*Ignore and return null*/ }
-            }
-        }
-        return rating;
-    }
-
-    private boolean validateExtras(final Map<String, String> serverExtras) {
-        final String flurryApiKey = serverExtras.get(FlurryAgentWrapper.PARAM_API_KEY);
-        final String flurryAdSpace = serverExtras.get(FlurryAgentWrapper.PARAM_AD_SPACE_NAME);
-        Log.i(LOG_TAG, "ServerInfo fetched from Mopub " + FlurryAgentWrapper.PARAM_API_KEY + " : "
-                + flurryApiKey + " and " + FlurryAgentWrapper.PARAM_AD_SPACE_NAME + " :" +
-                flurryAdSpace);
-        return (!TextUtils.isEmpty(flurryApiKey) && !TextUtils.isEmpty(flurryAdSpace));
-    }
-
-    private void fetchFlurryAd(@NonNull Context context, String flurryAdSpace,
-            @NonNull Map<String, Object> localExtras,
-            @NonNull CustomEventNativeListener customEventNativeListener) {
-        final FlurryAdNative flurryAdNative = new FlurryAdNative(context, flurryAdSpace);
-
-        if (localExtras.containsKey(LOCAL_EXTRA_TEST_MODE) &&
-                localExtras.get(LOCAL_EXTRA_TEST_MODE) instanceof Boolean) {
-            final FlurryAdTargeting targeting = new FlurryAdTargeting();
-            targeting.setEnableTestAds((Boolean) localExtras.get(LOCAL_EXTRA_TEST_MODE));
-        }
-
-        final FlurryBaseNativeAd flurryNativeAd;
-        if (shouldAllowVideoNativeAds()) {
-            flurryNativeAd = new FlurryVideoEnabledNativeAd(context, flurryAdNative,
-                    customEventNativeListener);
-        } else {
-            flurryNativeAd = new FlurryStaticNativeAd(context, flurryAdNative,
-                    customEventNativeListener);
-        }
-
-        // Add to requested ad list
-        sFlurryNativeAds.add(flurryAdNative);
-
-        flurryNativeAd.fetchAd();
-    }
-
-    private boolean shouldAllowVideoNativeAds() {
-        try {
-            Class.forName("com.mopub.nativeads.FlurryNativeAdRenderer");
-        } catch (ClassNotFoundException e) {
-            return false;
-        }
-
-        return true;
-    }
-
-    /**
-     * Class that supports Flurry static native ads with the help of the
-     * {@link MoPubStaticNativeAdRenderer}.
-     *
-     * @see FlurryVideoEnabledNativeAd
-     */
-    private static class FlurryStaticNativeAd extends StaticNativeAd implements FlurryBaseNativeAd {
-
-        @NonNull private final Context mContext;
-        @NonNull private final CustomEventNativeListener mCustomEventNativeListener;
-        @NonNull private final FlurryAdNative mFlurryAdNative;
-        private final FlurryAdNativeListener mFlurryNativelistener = new FlurryBaseAdListener(this) {
-            @Override
-            public void onClicked(final FlurryAdNative flurryAdNative) {
-                super.onClicked(flurryAdNative);
-                notifyAdClicked();
-            }
-
-            @Override
-            public void onImpressionLogged(final FlurryAdNative flurryAdNative) {
-                super.onImpressionLogged(flurryAdNative);
-                notifyAdImpressed();
-            }
-
-            @Override
-            public void onError(final FlurryAdNative adNative,
-                    final FlurryAdErrorType adErrorType,
-                    final int errorCode) {
-                super.onError(adNative, adErrorType, errorCode);
-                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_NO_FILL);
-            }
-        };
-
-        FlurryStaticNativeAd(@NonNull Context context, @NonNull FlurryAdNative adNative,
-                @NonNull CustomEventNativeListener customEventNativeListener) {
-            mContext = context;
-            mFlurryAdNative = adNative;
-            mCustomEventNativeListener = customEventNativeListener;
-        }
-
-        // region StaticNativeAd
-
-        @Override
-        public void prepare(@NonNull final View view) {
-            mFlurryAdNative.setTrackingView(view);
-            Log.d(LOG_TAG, "prepare(" + mFlurryAdNative.toString() + " " + view.toString() + ")");
-        }
-
-        @Override
-        public void clear(@NonNull final View view) {
-            mFlurryAdNative.removeTrackingView();
-            Log.d(LOG_TAG, "clear(" + mFlurryAdNative.toString() + ")");
-        }
-
-        @Override
-        public void destroy() {
-            Log.d(LOG_TAG, "destroy(" + mFlurryAdNative.toString() + ") started.");
-            mFlurryAdNative.destroy();
-
-            FlurryAgentWrapper.getInstance().endSession(mContext);
-        }
-
-        //endregion
-
-        // region FlurryBaseNativeAd
-
-        @Override
-        public synchronized void fetchAd() {
-            Log.d(LOG_TAG, "Fetching Flurry Native Ad now.");
-            mFlurryAdNative.setListener(mFlurryNativelistener);
-            mFlurryAdNative.fetchAd();
-        }
-
-        @NonNull
-        public List<String> getImageUrls() {
-            final List<String> imageUrls = new ArrayList<>(2);
-            final String mainImageUrl = getMainImageUrl();
-
-            if (mainImageUrl != null) {
-                imageUrls.add(getMainImageUrl());
-                Log.d(LOG_TAG, "Flurry Native Ad main image found.");
-            }
-
-            final String iconUrl = getIconImageUrl();
-            if (iconUrl != null) {
-                imageUrls.add(this.getIconImageUrl());
-                Log.d(LOG_TAG, "Flurry Native Ad icon image found.");
-            }
-            return imageUrls;
-        }
-
-        public boolean isAppInstallAd() {
-            return mFlurryAdNative.getAsset(ASSET_SEC_RATING_IMG) != null ||
-                    mFlurryAdNative.getAsset(ASSET_SEC_HQ_RATING_IMG) != null ||
-                    mFlurryAdNative.getAsset(ASSET_APP_CATEGORY) != null;
-        }
-
-        @Override
-        public void onNativeAdLoaded() {
-            mCustomEventNativeListener.onNativeAdLoaded(this);
-        }
-
-        @Override
-        public void precacheImages() {
-            NativeImageHelper.preCacheImages(mContext, getImageUrls(),
-                    new NativeImageHelper.ImageListener() {
-                        @Override
-                        public void onImagesCached() {
-                            Log.d(LOG_TAG, "preCacheImages: Ad image cached.");
-                            mCustomEventNativeListener.onNativeAdLoaded(FlurryStaticNativeAd.this);
-                        }
-
-                        @Override
-                        public void onImagesFailedToCache(final NativeErrorCode errorCode) {
-                            mCustomEventNativeListener.onNativeAdFailed(errorCode);
-                            Log.d(LOG_TAG, "preCacheImages: Unable to cache Ad image. Error["
-                                    + errorCode.toString() + "]");
-                        }
-                    });
-        }
-
-        //endregion
-    }
-
-    /**
-     * Class that supports both Flurry static and video native ads with the help of
-     * {@link FlurryNativeAdRenderer}. This class does not need to be included if you
-     * are fetching only static ads. Use {@link FlurryStaticNativeAd} instead.
-     */
-    static class FlurryVideoEnabledNativeAd extends BaseNativeAd implements FlurryBaseNativeAd {
-        private @NonNull final Context mContext;
-        private @NonNull final CustomEventNativeListener mCustomEventNativeListener;
-        private @NonNull final FlurryAdNative mFlurryAdNative;
-        private final FlurryAdNativeListener mFlurryNativelistener = new FlurryBaseAdListener(this) {
-            @Override
-            public void onClicked(final FlurryAdNative flurryAdNative) {
-                super.onClicked(flurryAdNative);
-                notifyAdClicked();
-            }
-
-            @Override
-            public void onImpressionLogged(final FlurryAdNative flurryAdNative) {
-                super.onImpressionLogged(flurryAdNative);
-                notifyAdImpressed();
-            }
-
-            @Override
-            public void onError(final FlurryAdNative adNative,
-                    final FlurryAdErrorType adErrorType,
-                    final int errorCode) {
-                super.onError(adNative, adErrorType, errorCode);
-                mCustomEventNativeListener.onNativeAdFailed(NativeErrorCode.NETWORK_NO_FILL);
-            }
-        };
-
-        // Basic fields
-        @Nullable private String mTitle;
-        @Nullable private String mText;
-        @Nullable private String mCallToAction;
-        @Nullable private String mMainImageUrl;
-        @Nullable private String mIconImageUrl;
-        @Nullable private Double mStarRating;
-
-        // Extras
-        @NonNull private final Map<String, Object> mExtras;
-
-
-        FlurryVideoEnabledNativeAd(@NonNull Context context, @NonNull FlurryAdNative adNative,
-                @NonNull CustomEventNativeListener customEventNativeListener) {
-            mContext = context;
-            mFlurryAdNative = adNative;
-            mCustomEventNativeListener = customEventNativeListener;
-            mExtras = new HashMap<>();
-        }
-
-        // region StaticNativeAd
-
-        @Override
-        public void prepare(@NonNull View view) {
-            mFlurryAdNative.setTrackingView(view);
-            Log.d(LOG_TAG, "prepare(" + mFlurryAdNative.toString() + " " + view.toString() + ")");
-        }
-
-        @Override
-        public void clear(@NonNull View view) {
-            mFlurryAdNative.removeTrackingView();
-            Log.d(LOG_TAG, "clear(" + mFlurryAdNative.toString() + ")");
-        }
-
-        @Override
-        public void destroy() {
-            Log.d(LOG_TAG, "destroy(" + mFlurryAdNative.toString() + ") started.");
-            mFlurryAdNative.destroy();
-
-            FlurryAgentWrapper.getInstance().endSession(mContext);
-        }
-
-        // endregion
-
-        // region FlurryBaseNativeAd
-
-        @Override
-        public synchronized void fetchAd() {
-            Log.d(LOG_TAG, "Fetching Flurry Native Ad now.");
-            mFlurryAdNative.setListener(mFlurryNativelistener);
-            mFlurryAdNative.fetchAd();
-        }
-
-        @Override
-        public boolean isAppInstallAd() {
-            return mFlurryAdNative.getAsset(ASSET_SEC_RATING_IMG) != null ||
-                    mFlurryAdNative.getAsset(ASSET_SEC_HQ_RATING_IMG) != null ||
-                    mFlurryAdNative.getAsset(ASSET_APP_CATEGORY) != null;
-        }
-
-        @Override
-        public void precacheImages() {
-            NativeImageHelper.preCacheImages(mContext, getImageUrls(),
-                    new NativeImageHelper.ImageListener() {
-                        @Override
-                        public void onImagesCached() {
-                            Log.d(LOG_TAG, "preCacheImages: Ad image cached.");
-                            mCustomEventNativeListener.onNativeAdLoaded(
-                                    FlurryVideoEnabledNativeAd.this);
-                        }
-
-                        @Override
-                        public void onImagesFailedToCache(final NativeErrorCode errorCode) {
-                            mCustomEventNativeListener.onNativeAdFailed(errorCode);
-                            Log.d(LOG_TAG, "preCacheImages: Unable to cache Ad image. Error["
-                                    + errorCode.toString() + "]");
-                        }
-                    });
-        }
-
-        @NonNull
-        @Override
-        public List<String> getImageUrls() {
-            final List<String> imageUrls = new ArrayList<>(2);
-            final String mainImageUrl = getMainImageUrl();
-
-            if (mainImageUrl != null) {
-                imageUrls.add(getMainImageUrl());
-                Log.d(LOG_TAG, "Flurry Native Ad main image found.");
-            }
-
-            final String iconUrl = getIconImageUrl();
-            if (iconUrl != null) {
-                imageUrls.add(this.getIconImageUrl());
-                Log.d(LOG_TAG, "Flurry Native Ad icon image found.");
-            }
-            return imageUrls;
-        }
-
-        @Nullable
-        @Override
-        public String getTitle() {
-            return mTitle;
-        }
-
-        @Nullable
-        @Override
-        public String getText() {
-            return mText;
-        }
-
-        @Nullable
-        @Override
-        public String getCallToAction() {
-            return mCallToAction;
-        }
-
-        @Nullable
-        @Override
-        public String getMainImageUrl() {
-            return mMainImageUrl;
-        }
-
-        @Nullable
-        @Override
-        public String getIconImageUrl() {
-            return mIconImageUrl;
-        }
-
-        @Nullable
-        @Override
-        public Double getStarRating() {
-            return mStarRating;
-        }
-
-        @NonNull
-        @Override
-        public Map<String, Object> getExtras() {
-            return mExtras;
-        }
-
-        @Override
-        public void setTitle(@Nullable String title) {
-            mTitle = title;
-        }
-
-        @Override
-        public void setText(@Nullable String text) {
-            mText = text;
-        }
-
-        @Override
-        public void setCallToAction(@Nullable String callToAction) {
-            mCallToAction = callToAction;
-        }
-
-        @Override
-        public void setMainImageUrl(@Nullable String mainImageUrl) {
-            mMainImageUrl = mainImageUrl;
-        }
-
-        @Override
-        public void setIconImageUrl(@Nullable String iconImageUrl) {
-            mIconImageUrl = iconImageUrl;
-        }
-
-        @Override
-        public void setStarRating(@Nullable Double starRating) {
-            mStarRating = starRating;
-        }
-
-        @Override
-        public void addExtra(@NonNull String key, @Nullable Object value) {
-            mExtras.put(key, value);
-        }
-
-        @Override
-        public void onNativeAdLoaded() {
-            mCustomEventNativeListener.onNativeAdLoaded(this);
-        }
-
-        // endregion
-
-        boolean isVideoAd() {
-            return mFlurryAdNative.isVideoAd();
-        }
-
-        void loadVideoIntoView(@NonNull ViewGroup videoView) {
-            mFlurryAdNative.getAsset(ASSET_VIDEO).loadAssetIntoView(videoView);
-        }
-    }
-
-    static abstract class FlurryBaseAdListener implements FlurryAdNativeListener {
-        private final @NonNull FlurryBaseNativeAd mBaseNativeAd;
-
-        FlurryBaseAdListener(@NonNull FlurryBaseNativeAd baseNativeAd) {
-            mBaseNativeAd = baseNativeAd;
-        }
-
-        @Override
-        public void onFetched(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onFetched: Flurry native ad fetched successfully!");
-            mapNativeAd(mBaseNativeAd, flurryAdNative);
-            sFlurryNativeAds.remove(flurryAdNative);
-        }
-
-        @Override
-        public void onShowFullscreen(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onShowFullscreen: Flurry native ad in full-screen");
-        }
-
-        @Override
-        public void onCloseFullscreen(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onCloseFullscreen: Flurry native ad full-screen closed");
-        }
-
-        @Override
-        public void onAppExit(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onAppExit: Flurry native ad exited app");
-        }
-
-        @Override
-        public void onClicked(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onClicked: Flurry native ad clicked");
-        }
-
-        @Override
-        public void onImpressionLogged(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onImpressionLogged: Flurry native ad impression logged");
-        }
-
-        @Override
-        public void onExpanded(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onExpanded: Flurry native ad expanded");
-        }
-
-        @Override
-        public void onCollapsed(final FlurryAdNative flurryAdNative) {
-            Log.d(LOG_TAG, "onCollapsed: Flurry native ad collapsed");
-        }
-
-        @Override
-        public void onError(final FlurryAdNative flurryAdNative,
-                final FlurryAdErrorType adErrorType,
-                final int errorCode) {
-            Log.d(LOG_TAG, String.format("onError: Flurry native ad not available. " +
-                    "Error type: %s. Error code: %s", adErrorType.toString(), errorCode));
-            sFlurryNativeAds.remove(flurryAdNative);
-        }
-    }
-}
diff --git a/extras/src/com/mopub/nativeads/FlurryNativeAdRenderer.java b/extras/src/com/mopub/nativeads/FlurryNativeAdRenderer.java
deleted file mode 100644
index 4f1e362d..00000000
--- a/extras/src/com/mopub/nativeads/FlurryNativeAdRenderer.java
+++ /dev/null
@@ -1,103 +0,0 @@
-package com.mopub.nativeads;
-
-import android.content.Context;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
-
-import java.util.WeakHashMap;
-
-/**
- * Include this class if you want to use Flurry native video ads. This will use the FrameLayout
- * specified in the FlurryNativeViewHolder.videoView to show a video. If a video is not available,
- * this will still use the mainImageView.
- *
- *
- * Certified with Flurry 8.1.0
- */
-public class FlurryNativeAdRenderer implements
-        MoPubAdRenderer<FlurryCustomEventNative.FlurryVideoEnabledNativeAd> {
-    @NonNull private final FlurryViewBinder mViewBinder;
-    @NonNull private final WeakHashMap<View, FlurryNativeViewHolder> mViewHolderMap;
-
-    public FlurryNativeAdRenderer(@NonNull final FlurryViewBinder viewBinder) {
-        mViewBinder = viewBinder;
-        mViewHolderMap = new WeakHashMap<>();
-    }
-
-    @NonNull
-    @Override
-    public View createAdView(@NonNull final Context context, @Nullable final ViewGroup parent) {
-        return LayoutInflater.from(context).inflate(
-                mViewBinder.staticViewBinder.layoutId, parent, false);
-    }
-
-    @Override
-    public void renderAdView(@NonNull View view,
-            @NonNull FlurryCustomEventNative.FlurryVideoEnabledNativeAd ad) {
-        FlurryNativeViewHolder flurryNativeViewHolder = mViewHolderMap.get(view);
-        if (flurryNativeViewHolder == null) {
-            flurryNativeViewHolder = FlurryNativeViewHolder.fromViewBinder(view, mViewBinder);
-            mViewHolderMap.put(view, flurryNativeViewHolder);
-        }
-
-        update(flurryNativeViewHolder, ad);
-        NativeRendererHelper.updateExtras(flurryNativeViewHolder.staticNativeViewHolder.mainView,
-                mViewBinder.staticViewBinder.extras, ad.getExtras());
-        setViewVisibility(flurryNativeViewHolder, View.VISIBLE);
-    }
-
-    @Override
-    public boolean supports(@NonNull BaseNativeAd nativeAd) {
-        return nativeAd instanceof FlurryCustomEventNative.FlurryVideoEnabledNativeAd;
-    }
-
-    private void update(final FlurryNativeViewHolder viewHolder,
-            final FlurryCustomEventNative.FlurryVideoEnabledNativeAd ad) {
-        NativeRendererHelper.addTextView(viewHolder.staticNativeViewHolder.titleView,
-                ad.getTitle());
-        NativeRendererHelper.addTextView(viewHolder.staticNativeViewHolder.textView, ad.getText());
-        NativeRendererHelper.addTextView(viewHolder.staticNativeViewHolder.callToActionView,
-                ad.getCallToAction());
-        NativeImageHelper.loadImageView(ad.getIconImageUrl(),
-                viewHolder.staticNativeViewHolder.iconImageView);
-
-        if (ad.isVideoAd()) {
-            ad.loadVideoIntoView(viewHolder.videoView);
-        } else {
-            NativeImageHelper.loadImageView(ad.getMainImageUrl(),
-                    viewHolder.staticNativeViewHolder.mainImageView);
-        }
-    }
-
-    private void setViewVisibility(@NonNull final FlurryNativeViewHolder viewHolder,
-            final int visibility) {
-        if (viewHolder.staticNativeViewHolder.mainView != null) {
-            viewHolder.staticNativeViewHolder.mainView.setVisibility(visibility);
-        }
-    }
-
-    private static class FlurryNativeViewHolder {
-        private final StaticNativeViewHolder staticNativeViewHolder;
-        private final ViewGroup videoView;
-
-        private FlurryNativeViewHolder(final StaticNativeViewHolder staticNativeViewHolder,
-                final ViewGroup videoView) {
-            this.staticNativeViewHolder = staticNativeViewHolder;
-            this.videoView = videoView;
-        }
-
-        static FlurryNativeViewHolder fromViewBinder(
-                final View view,
-                final FlurryViewBinder viewBinder) {
-            StaticNativeViewHolder staticNativeViewHolder = StaticNativeViewHolder
-                    .fromViewBinder(view, viewBinder.staticViewBinder);
-
-            ViewGroup videoView = (ViewGroup) view.findViewById(viewBinder.videoViewId);
-
-            return new FlurryNativeViewHolder(staticNativeViewHolder, videoView);
-        }
-    }
-}
diff --git a/extras/src/com/mopub/nativeads/FlurryViewBinder.java b/extras/src/com/mopub/nativeads/FlurryViewBinder.java
deleted file mode 100644
index b6885793..00000000
--- a/extras/src/com/mopub/nativeads/FlurryViewBinder.java
+++ /dev/null
@@ -1,36 +0,0 @@
-package com.mopub.nativeads;
-
-import android.support.annotation.NonNull;
-
-/**
- * Certified with Flurry 8.1.0
- */
-public class FlurryViewBinder {
-    ViewBinder staticViewBinder;
-    int videoViewId;
-
-    private FlurryViewBinder(@NonNull Builder builder) {
-        this.staticViewBinder = builder.staticViewBinder;
-        this.videoViewId = builder.videoViewId;
-    }
-
-    public final static class Builder {
-        ViewBinder staticViewBinder;
-        int videoViewId;
-
-        public Builder(final ViewBinder staticViewBinder) {
-            this.staticViewBinder = staticViewBinder;
-        }
-
-        @NonNull
-        public final Builder videoViewId(final int videoViewId) {
-            this.videoViewId = videoViewId;
-            return this;
-        }
-
-        @NonNull
-        public final FlurryViewBinder build() {
-            return new FlurryViewBinder(this);
-        }
-    }
-}
diff --git a/extras/src/com/mopub/nativeads/MillennialNative.java b/extras/src/com/mopub/nativeads/MillennialNative.java
deleted file mode 100644
index 5055e47d..00000000
--- a/extras/src/com/mopub/nativeads/MillennialNative.java
+++ /dev/null
@@ -1,303 +0,0 @@
-package com.mopub.nativeads;
-
-import android.content.Context;
-import android.util.Log;
-import android.view.View;
-
-import com.millennialmedia.AppInfo;
-import com.millennialmedia.CreativeInfo;
-import com.millennialmedia.MMException;
-import com.millennialmedia.MMLog;
-import com.millennialmedia.MMSDK;
-import com.millennialmedia.NativeAd;
-import com.mopub.mobileads.MillennialUtils;
-
-import java.util.ArrayList;
-import java.util.List;
-import java.util.Map;
-
-import static com.mopub.nativeads.NativeImageHelper.preCacheImages;
-
-/**
- * Compatible with version 6.6 of the Millennial Media SDK.
- */
-
-public class MillennialNative extends CustomEventNative {
-    private static final String DCN_KEY = "dcn";
-    private static final String APID_KEY = "adUnitID";
-    private final static String TAG = MillennialNative.class.getSimpleName();
-
-    MillennialStaticNativeAd staticNativeAd;
-
-    public CreativeInfo getCreativeInfo() {
-
-        if (staticNativeAd == null) {
-            return null;
-        }
-
-        return staticNativeAd.getCreativeInfo();
-    }
-
-
-    @Override
-    protected void loadNativeAd(final Context context, final CustomEventNativeListener customEventNativeListener,
-                                Map<String, Object> localExtras, Map<String, String> serverExtras) {
-
-        if (!MillennialUtils.initSdk(context)) {
-            Log.e(TAG, "MM SDK must be initialized with an Activity or Application context.");
-            customEventNativeListener.onNativeAdFailed(NativeErrorCode.NATIVE_ADAPTER_CONFIGURATION_ERROR);
-            return;
-        }
-
-        String placementId = serverExtras.get(APID_KEY);
-        String siteId = serverExtras.get(DCN_KEY);
-
-        if (MillennialUtils.isEmpty(placementId)) {
-            customEventNativeListener.onNativeAdFailed(NativeErrorCode.NATIVE_ADAPTER_CONFIGURATION_ERROR);
-
-            return;
-        }
-
-        AppInfo ai = new AppInfo().setMediator("mopubsdk").setSiteId(siteId);
-
-        try {
-            MMSDK.setAppInfo(ai);
-
-            NativeAd nativeAd = NativeAd.createInstance(placementId, NativeAd.NATIVE_TYPE_INLINE);
-            staticNativeAd = new MillennialStaticNativeAd(context, nativeAd, new ImpressionTracker(context),
-                    new NativeClickHandler(context), customEventNativeListener);
-
-            staticNativeAd.loadAd();
-
-        } catch (MMException e) {
-            Log.e(TAG, "An exception occurred loading a native ad from MM SDK", e);
-            customEventNativeListener.onNativeAdFailed(NativeErrorCode.NATIVE_ADAPTER_CONFIGURATION_ERROR);
-        }
-    }
-
-
-    static class MillennialStaticNativeAd extends StaticNativeAd implements NativeAd.NativeListener {
-
-        private final Context context;
-        private NativeAd nativeAd;
-        private final ImpressionTracker impressionTracker;
-        private final NativeClickHandler nativeClickHandler;
-        private final CustomEventNativeListener listener;
-
-
-        public MillennialStaticNativeAd(final Context context, final NativeAd nativeAd,
-                                        final ImpressionTracker impressionTracker, final NativeClickHandler nativeClickHandler,
-                                        final CustomEventNativeListener customEventNativeListener) {
-
-            this.context = context.getApplicationContext();
-            this.nativeAd = nativeAd;
-            this.impressionTracker = impressionTracker;
-            this.nativeClickHandler = nativeClickHandler;
-            listener = customEventNativeListener;
-
-            nativeAd.setListener(this);
-        }
-
-
-        void loadAd() throws MMException {
-
-            Log.d(TAG, "Millennial native ad loading.");
-
-            nativeAd.load(context, null);
-        }
-
-
-        CreativeInfo getCreativeInfo() {
-
-            if (nativeAd == null) {
-                return null;
-            }
-
-            return nativeAd.getCreativeInfo();
-        }
-
-
-        // Lifecycle Handlers
-        @Override
-        public void prepare(final View view) {
-            // Must access these methods directly to get impressions to fire.
-            nativeAd.getIconImage();
-            nativeAd.getDisclaimer();
-            impressionTracker.addView(view, this);
-            nativeClickHandler.setOnClickListener(view, this);
-        }
-
-
-        @Override
-        public void clear(final View view) {
-
-            impressionTracker.removeView(view);
-            nativeClickHandler.clearOnClickListener(view);
-        }
-
-
-        @Override
-        public void destroy() {
-
-            impressionTracker.destroy();
-            nativeAd.destroy();
-            nativeAd = null;
-        }
-
-
-        // Event Handlers
-        @Override
-        public void recordImpression(final View view) {
-
-            notifyAdImpressed();
-
-            try {
-                nativeAd.fireImpression();
-                Log.d(TAG, "Millennial native ad impression recorded.");
-            } catch (MMException e) {
-                Log.e(TAG, "Error tracking Millennial native ad impression", e);
-            }
-        }
-
-
-        @Override
-        public void handleClick(final View view) {
-
-            notifyAdClicked();
-
-            nativeClickHandler.openClickDestinationUrl(getClickDestinationUrl(), view);
-            nativeAd.fireCallToActionClicked();
-            Log.d(TAG, "Millennial native ad clicked.");
-        }
-
-
-        // MM'S Native listener
-        @Override
-        public void onLoaded(NativeAd nativeAd) {
-
-            CreativeInfo creativeInfo = getCreativeInfo();
-            if ((creativeInfo != null) && MMLog.isDebugEnabled()) {
-
-                MMLog.d(TAG, "Native Creative Info: " + creativeInfo);
-            }
-
-            // Set assets
-            String iconImageUrl = nativeAd.getImageUrl(NativeAd.ComponentName.ICON_IMAGE, 1);
-            String mainImageUrl = nativeAd.getImageUrl(NativeAd.ComponentName.MAIN_IMAGE, 1);
-
-            setTitle(nativeAd.getTitle().getText().toString());
-            setText(nativeAd.getBody().getText().toString());
-            setCallToAction(nativeAd.getCallToActionButton().getText().toString());
-
-            final String clickDestinationUrl = nativeAd.getCallToActionUrl();
-            if (clickDestinationUrl == null) {
-                MillennialUtils.postOnUiThread(new Runnable() {
-                    @Override
-                    public void run() {
-
-                        Log.d(TAG, "Millennial native ad encountered null destination url.");
-                        listener.onNativeAdFailed(NativeErrorCode.NATIVE_ADAPTER_CONFIGURATION_ERROR);
-                    }
-                });
-                return;
-            }
-
-            setClickDestinationUrl(clickDestinationUrl);
-            setIconImageUrl(iconImageUrl);
-            setMainImageUrl(mainImageUrl);
-
-            final List<String> urls = new ArrayList<>();
-            if (iconImageUrl != null) {
-                urls.add(iconImageUrl);
-            }
-            if (mainImageUrl != null) {
-                urls.add(mainImageUrl);
-            }
-
-            addExtra("disclaimer", nativeAd.getDisclaimer().getText());
-
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-                    // This has to be run on the main thread:
-                    preCacheImages(context, urls, new NativeImageHelper.ImageListener() {
-                        @Override
-                        public void onImagesCached() {
-                            listener.onNativeAdLoaded(MillennialStaticNativeAd.this);
-                            Log.d(TAG, "Millennial native ad loaded.");
-                        }
-
-
-                        @Override
-                        public void onImagesFailedToCache(NativeErrorCode errorCode) {
-                            listener.onNativeAdFailed(errorCode);
-                        }
-                    });
-
-                }
-            });
-        }
-
-
-        @Override
-        public void onLoadFailed(NativeAd nativeAd, NativeAd.NativeErrorStatus nativeErrorStatus) {
-
-            final NativeErrorCode error;
-            switch (nativeErrorStatus.getErrorCode()) {
-                case NativeAd.NativeErrorStatus.LOAD_TIMED_OUT:
-                    error = NativeErrorCode.NETWORK_TIMEOUT;
-                    break;
-                case NativeAd.NativeErrorStatus.NO_NETWORK:
-                    error = NativeErrorCode.CONNECTION_ERROR;
-                    break;
-                case NativeAd.NativeErrorStatus.UNKNOWN:
-                    error = NativeErrorCode.UNSPECIFIED;
-                    break;
-                case NativeAd.NativeErrorStatus.LOAD_FAILED:
-                case NativeAd.NativeErrorStatus.INIT_FAILED:
-                    error = NativeErrorCode.UNEXPECTED_RESPONSE_CODE;
-                    break;
-                case NativeAd.NativeErrorStatus.ADAPTER_NOT_FOUND:
-                    error = NativeErrorCode.NATIVE_ADAPTER_CONFIGURATION_ERROR;
-                    break;
-                case NativeAd.NativeErrorStatus.DISPLAY_FAILED:
-                case NativeAd.NativeErrorStatus.EXPIRED:
-                    error = NativeErrorCode.UNSPECIFIED;
-                    break;
-                default:
-                    error = NativeErrorCode.NETWORK_NO_FILL;
-            }
-            MillennialUtils.postOnUiThread(new Runnable() {
-                @Override
-                public void run() {
-
-                    listener.onNativeAdFailed(error);
-                }
-            });
-            Log.i(TAG, "Millennial native ad failed: " + nativeErrorStatus.getDescription());
-        }
-
-
-        @Override
-        public void onClicked(NativeAd nativeAd, NativeAd.ComponentName componentName, int i) {
-
-            Log.d(TAG, "Millennial native ad click tracker fired.");
-        }
-
-
-        @Override
-        public void onAdLeftApplication(NativeAd nativeAd) {
-
-            Log.d(TAG, "Millennial native ad has left the application.");
-
-        }
-
-
-        @Override
-        public void onExpired(NativeAd nativeAd) {
-
-            Log.d(TAG, "Millennial native ad has expired!");
-        }
-
-    }
-}
diff --git a/extras/src/com/mopub/simpleadsdemo/GreystripeBanner.java b/extras/src/com/mopub/simpleadsdemo/GreystripeBanner.java
deleted file mode 100644
index 07311691..00000000
--- a/extras/src/com/mopub/simpleadsdemo/GreystripeBanner.java
+++ /dev/null
@@ -1,106 +0,0 @@
-package com.mopub.simpleadsdemo;
-
-import android.content.Context;
-import android.util.Log;
-
-import com.greystripe.sdk.AdPosition;
-import com.greystripe.sdk.GSAd;
-import com.greystripe.sdk.GSAdErrorCode;
-import com.greystripe.sdk.GSAdListener;
-import com.greystripe.sdk.GSMobileBannerAdView;
-import com.mopub.mobileads.CustomEventBanner;
-import com.mopub.mobileads.MoPubErrorCode;
-
-import java.util.Map;
-
-/*
- * Tested with Greystripe SDK 2.4.0.
- */
-class GreystripeBanner extends CustomEventBanner implements GSAdListener {
-
-    private static final String DEFAULT_GREYSTRIPE_APP_ID = "YOUR_GREYSTRIPE_APP_ID";
-
-    /*
-     * These keys are intended for MoPub internal use. Do not modify.
-     */
-    public static final String APP_ID_KEY = "GUID";
-
-    private CustomEventBannerListener mBannerListener;
-    private GSMobileBannerAdView mGreystripeAd;
-
-    /*
-     * Abstract methods from CustomEventBanner
-     */
-    @Override
-    protected void loadBanner(final Context context,
-                              final CustomEventBannerListener bannerListener,
-                              final Map<String, Object> localExtras,
-                              final Map<String, String> serverExtras) {
-        mBannerListener = bannerListener;
-
-        String greystripeAppId = DEFAULT_GREYSTRIPE_APP_ID;
-        if (extrasAreValid(serverExtras)) {
-            greystripeAppId = serverExtras.get(APP_ID_KEY);
-        }
-
-        mGreystripeAd = new GSMobileBannerAdView(context, greystripeAppId);
-        mGreystripeAd.addListener(this);
-
-        mGreystripeAd.refresh();
-    }
-
-    private boolean extrasAreValid(Map<String, String> extras) {
-        return extras.containsKey(APP_ID_KEY);
-    }
-
-    @Override
-    protected void onInvalidate() {
-        mGreystripeAd.removeListener(this);
-    }
-
-    /*
-     * GSAdListener implementation
-     */
-    @Override
-    public void onAdClickthrough(final GSAd greystripeAd) {
-        Log.d("MoPub", "Greystripe banner ad clicked.");
-        mBannerListener.onBannerClicked();
-    }
-
-    @Override
-    public void onAdDismissal(final GSAd greystripeAd) {
-        Log.d("MoPub", "Greystripe banner ad modal dismissed.");
-    }
-
-    @Override
-    public void onFailedToFetchAd(final GSAd greystripeAd, final GSAdErrorCode errorCode) {
-        Log.d("MoPub", "Greystripe banner ad failed to load.");
-        mBannerListener.onBannerFailed(MoPubErrorCode.NETWORK_NO_FILL);
-    }
-
-    @Override
-    public void onFetchedAd(final GSAd greystripeAd) {
-        if (mGreystripeAd != null && mGreystripeAd.isAdReady()) {
-            Log.d("MoPub", "Greystripe banner ad loaded successfully. Showing ad...");
-            mBannerListener.onBannerLoaded(mGreystripeAd);
-        } else {
-            mBannerListener.onBannerFailed(MoPubErrorCode.NETWORK_INVALID_STATE);
-        }
-    }
-
-    @Override
-    public void onAdCollapse(final GSAd greystripeAd) {
-        Log.d("MoPub", "Greystripe banner ad collapsed.");
-        mBannerListener.onBannerCollapsed();
-    }
-
-    @Override
-    public void onAdExpansion(final GSAd greystripeAd) {
-        Log.d("MoPub", "Greystripe banner ad expanded.");
-        mBannerListener.onBannerExpanded();
-    }
-
-    @Override
-    public void onAdResize(final GSAd gsAd, final AdPosition adPosition) {
-    }
-}
diff --git a/extras/src/com/mopub/simpleadsdemo/GreystripeInterstitial.java b/extras/src/com/mopub/simpleadsdemo/GreystripeInterstitial.java
deleted file mode 100644
index 6540db04..00000000
--- a/extras/src/com/mopub/simpleadsdemo/GreystripeInterstitial.java
+++ /dev/null
@@ -1,122 +0,0 @@
-package com.mopub.simpleadsdemo;
-
-import android.content.Context;
-import android.util.Log;
-
-import com.greystripe.sdk.AdPosition;
-import com.greystripe.sdk.GSAd;
-import com.greystripe.sdk.GSAdErrorCode;
-import com.greystripe.sdk.GSAdListener;
-import com.greystripe.sdk.GSFullscreenAd;
-import com.mopub.mobileads.CustomEventInterstitial;
-import com.mopub.mobileads.MoPubErrorCode;
-
-import java.util.Map;
-
-/*
- * Tested with Greystripe SDK 2.4.0.
- */
-class GreystripeInterstitial extends CustomEventInterstitial implements GSAdListener {
-
-    private static final String DEFAULT_GREYSTRIPE_APP_ID = "YOUR_GREYSTRIPE_APP_ID";
-
-    /*
-     * These keys are intended for MoPub internal use. Do not modify.
-     */
-    public static final String APP_ID_KEY = "GUID";
-
-    private CustomEventInterstitialListener mInterstitialListener;
-    private GSFullscreenAd mGreystripeAd;
-
-    /*
-     * Abstract methods from CustomEventInterstitial
-     */
-    @Override
-    protected void loadInterstitial(final Context context,
-                                    final CustomEventInterstitialListener interstitialListener,
-                                    final Map<String, Object> localExtras,
-                                    final Map<String, String> serverExtras) {
-        mInterstitialListener = interstitialListener;
-
-        String greystripeAppId = DEFAULT_GREYSTRIPE_APP_ID;
-        if (extrasAreValid(serverExtras)) {
-            greystripeAppId = serverExtras.get(APP_ID_KEY);
-        }
-
-        mGreystripeAd = new GSFullscreenAd(context, greystripeAppId);
-        mGreystripeAd.addListener(this);
-
-        mGreystripeAd.fetch();
-    }
-
-    private static boolean extrasAreValid(Map<String, String> extras) {
-        return extras.containsKey(APP_ID_KEY);
-    }
-
-    @Override
-    protected void showInterstitial() {
-        if (!mGreystripeAd.isAdReady()) {
-            mInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_INVALID_STATE);
-            return;
-        }
-
-        Log.d("MoPub", "Showing Greystripe interstitial ad.");
-        mGreystripeAd.display();
-        mInterstitialListener.onInterstitialShown();
-    }
-
-    @Override
-    protected void onInvalidate() {
-        mGreystripeAd.removeListener(this);
-    }
-
-    /*
-     * GSAdListener implementation
-     */
-    @Override
-    public void onAdClickthrough(final GSAd greystripeAd) {
-        Log.d("MoPub", "Greystripe interstitial ad clicked.");
-        mInterstitialListener.onInterstitialClicked();
-
-        /*
-         * XXX: When a Greystripe interstitial is dismissed as a result of a user click, the
-         * onAdDismissal callback does not get fired. This call ensures that the custom event
-         * listener is informed of all dismissals.
-         */
-        mInterstitialListener.onInterstitialDismissed();
-    }
-
-    @Override
-    public void onAdDismissal(final GSAd greystripeAd) {
-        Log.d("MoPub", "Greystripe interstitial ad dismissed.");
-        mInterstitialListener.onInterstitialDismissed();
-    }
-
-    @Override
-    public void onFailedToFetchAd(final GSAd greystripeAd, final GSAdErrorCode errorCode) {
-        Log.d("MoPub", "Greystripe interstitial ad failed to load.");
-        mInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_NO_FILL);
-    }
-
-    @Override
-    public void onFetchedAd(final GSAd greystripeAd) {
-        if (mGreystripeAd != null && mGreystripeAd.isAdReady()) {
-            Log.d("MoPub", "Greysripe interstitial ad loaded successfully.");
-            mInterstitialListener.onInterstitialLoaded();
-        } else {
-            mInterstitialListener.onInterstitialFailed(MoPubErrorCode.NETWORK_INVALID_STATE);
-        }
-    }
-
-    @Override
-    public void onAdCollapse(final GSAd greystripeAd) {
-    }
-
-    @Override
-    public void onAdExpansion(final GSAd greystripeAd) {
-    }
-
-    @Override
-    public void onAdResize(final GSAd gsAd, final AdPosition adPosition) {
-    }
-}
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index 8b60e124..3e785403 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,6 +1,6 @@
-#Tue Sep 06 11:08:36 PDT 2016
+#Mon Nov 13 15:46:01 PST 2017
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-3.3-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-4.3.1-all.zip
diff --git a/mopub-sample/AndroidManifest.xml b/mopub-sample/AndroidManifest.xml
index 814b58ea..c3945025 100644
--- a/mopub-sample/AndroidManifest.xml
+++ b/mopub-sample/AndroidManifest.xml
@@ -1,10 +1,10 @@
 <?xml version="1.0" encoding="utf-8"?>
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
       package="com.mopub.simpleadsdemo"
-      android:versionCode="57"
-      android:versionName="4.19.0">
+      android:versionCode="62"
+      android:versionName="5.2.0">
     <uses-sdk android:minSdkVersion="16"
-              android:targetSdkVersion="24"/>
+              android:targetSdkVersion="26"/>
 
     <uses-permission android:name="android.permission.INTERNET" />
     <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
@@ -17,7 +17,7 @@
                  android:networkSecurityConfig="@xml/network_security_config">
 	    <activity android:name="com.mopub.simpleadsdemo.MoPubSampleActivity"
 	            android:label="@string/app_name"
-                android:launchMode="singleInstance"
+                android:launchMode="singleTask"
                 android:configChanges="orientation|screenSize">
 	        <intent-filter>
 	            <action android:name="android.intent.action.MAIN" />
@@ -42,6 +42,9 @@
         <activity android:name="com.mopub.mobileads.RewardedMraidActivity"
                   android:configChanges="keyboardHidden|orientation|screenSize"/>
 
+        <activity android:name="com.mopub.common.privacy.ConsentDialogActivity"
+                  android:configChanges="keyboardHidden|orientation|screenSize"/>
+
         <meta-data android:name="com.google.android.gms.version"
                    android:value="@integer/google_play_services_version" />
     </application>
diff --git a/mopub-sample/build.gradle b/mopub-sample/build.gradle
index a0111bb3..798eed37 100644
--- a/mopub-sample/build.gradle
+++ b/mopub-sample/build.gradle
@@ -1,17 +1,17 @@
 repositories {
+    google()
     jcenter()
     flatDir {
         dirs '../libs'
     }
     maven { url "https://s3.amazonaws.com/moat-sdk-builds" }
-    maven { url 'https://maven.google.com' }
 }
 
 apply plugin: 'com.android.application'
 
 project.group = 'com.mopub'
 project.description = '''MoPub Sample App'''
-project.version = '4.19.0'
+project.version = '5.2.0'
 
 android {
     compileSdkVersion 26
@@ -19,7 +19,7 @@ android {
     lintOptions { abortOnError false }
 
     defaultConfig {
-        versionCode 57
+        versionCode 62
         versionName version
         minSdkVersion 16
         targetSdkVersion 26
@@ -57,9 +57,17 @@ android {
 }
 
 dependencies {
+<<<<<<< HEAD
     compile 'com.android.support:support-v4:26.1.0'
     compile 'com.google.android.gms:play-services-ads:11.4.0'
     compile 'com.facebook.android:audience-network-sdk:4.26.1'
     compile 'com.android.support:recyclerview-v7:26.1.0'
     compile project(':mopub-sdk')
+=======
+    implementation 'com.android.support:support-v4:26.1.0'
+    implementation 'com.google.android.gms:play-services-ads:11.4.0'
+    implementation 'com.google.android.gms:play-services-base:11.4.0'
+    implementation 'com.android.support:recyclerview-v7:26.1.0'
+    implementation project(':mopub-sdk')
+>>>>>>> upstream/master
 }
diff --git a/mopub-sample/pom.xml b/mopub-sample/pom.xml
deleted file mode 100644
index 8a283c4d..00000000
--- a/mopub-sample/pom.xml
+++ /dev/null
@@ -1,103 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
-    <modelVersion>4.0.0</modelVersion>
-
-    <parent>
-        <groupId>com.mopub.mobileads</groupId>
-        <artifactId>mopub-android</artifactId>
-        <version>1.0</version>
-    </parent>
-
-    <artifactId>mopub-sample</artifactId>
-    <version>1.0.0-SNAPSHOT</version>
-    <packaging>apk</packaging>
-    <name>MoPub Simple Ads Demo</name>
-    <description>Sample application that demonstrates how to use the MoPub SDK.</description>
-
-    <properties>
-        <robolectric.version>2.1</robolectric.version>
-    </properties>
-
-    <dependencies>
-
-        <!--main-->
-
-        <dependency>
-            <groupId>com.mopub.mobileads</groupId>
-            <artifactId>mopub-sdk</artifactId>
-            <version>1.0.0-SNAPSHOT</version>
-            <type>aar</type>
-        </dependency>
-
-        <dependency>
-            <groupId>com.android.support</groupId>
-            <artifactId>support-v4</artifactId>
-            <version>23.1.1</version>
-            <type>aar</type>
-        </dependency>
-
-        <dependency>
-            <groupId>com.android.support</groupId>
-            <artifactId>recyclerview-v7</artifactId>
-            <version>23.1.1</version>
-            <type>aar</type>
-        </dependency>
-        
-        <dependency>
-            <groupId>com.google.android.gms</groupId>
-            <artifactId>play-services-ads</artifactId>
-            <version>7.0.0</version>
-            <type>aar</type>
-        </dependency>
-
-        <dependency> <groupId>com.google.android</groupId>
-            <artifactId>android</artifactId>
-            <version>4.4.2</version>
-            <scope>provided</scope>
-        </dependency>
-    </dependencies>
-
-    <build>
-        <finalName>${project.artifactId}</finalName>
-
-        <plugins>
-            <plugin>
-                <artifactId>maven-compiler-plugin</artifactId>
-                <version>2.3.2</version>
-                <!-- Skip tests. We use Gradle to build and run tests. -->
-                <executions>
-                    <execution>
-                        <id>default-testCompile</id>
-                        <phase>test-compile</phase>
-                        <goals>
-                            <goal>testCompile</goal>
-                        </goals>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </execution>
-                </executions>
-                <configuration>
-                    <source>7</source>
-                    <target>7</target>
-                </configuration>
-            </plugin>
-            <plugin>
-                <groupId>com.simpligility.maven.plugins</groupId>
-                <artifactId>android-maven-plugin</artifactId>
-                <version>4.2.0</version>
-                <configuration>
-                    <androidManifestFile>AndroidManifest.xml</androidManifestFile>
-                    <resourceDirectory>res</resourceDirectory>
-                    <sdk>
-                        <!-- platform or api level (api level 4 = platform 1.6)-->
-                        <platform>22</platform>
-                    </sdk>
-                    <undeployBeforeDeploy>true</undeployBeforeDeploy>
-                </configuration>
-                <extensions>true</extensions>
-            </plugin>
-        </plugins>
-    </build>
-</project>
diff --git a/mopub-sample/res/layout/banner_detail_fragment.xml b/mopub-sample/res/layout/banner_detail_fragment.xml
index b910e373..35241ce3 100644
--- a/mopub-sample/res/layout/banner_detail_fragment.xml
+++ b/mopub-sample/res/layout/banner_detail_fragment.xml
@@ -28,14 +28,23 @@
         android:textSize="14sp"
         android:textStyle="normal" />
 
+    <EditText
+        android:id="@+id/keywords_field"
+        android:hint="@string/keywords"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:inputType="text|textFilter|textShortMessage"
+        android:imeOptions="actionDone"
+        android:singleLine="true" />
+
     <LinearLayout
         android:orientation="horizontal"
         android:layout_width="match_parent"
         android:layout_height="wrap_content">
 
         <EditText
-            android:id="@+id/keywords_field"
-            android:hint="@string/keywords"
+            android:id="@+id/user_data_keywords_field"
+            android:hint="@string/user_data_keywords"
             android:layout_width="0dp"
             android:layout_height="wrap_content"
             android:layout_weight="3"
diff --git a/mopub-sample/res/layout/interstitial_detail_fragment.xml b/mopub-sample/res/layout/interstitial_detail_fragment.xml
index 6f060ff6..03f4888b 100644
--- a/mopub-sample/res/layout/interstitial_detail_fragment.xml
+++ b/mopub-sample/res/layout/interstitial_detail_fragment.xml
@@ -37,6 +37,15 @@
         android:imeOptions="actionDone"
         android:singleLine="true" />
 
+    <EditText
+        android:id="@+id/user_data_keywords_field"
+        android:hint="@string/user_data_keywords"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:inputType="text|textFilter|textShortMessage"
+        android:imeOptions="actionDone"
+        android:singleLine="true" />
+
     <EditText
         android:id="@+id/custom_data_field"
         android:visibility="gone"
diff --git a/mopub-sample/res/layout/native_gallery_fragment.xml b/mopub-sample/res/layout/native_gallery_fragment.xml
index 530ab4bc..d368cc44 100644
--- a/mopub-sample/res/layout/native_gallery_fragment.xml
+++ b/mopub-sample/res/layout/native_gallery_fragment.xml
@@ -27,17 +27,26 @@
         android:textSize="14sp"
         android:textStyle="normal"/>
 
+    <EditText
+        android:id="@+id/keywords_field"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:hint="@string/keywords"
+        android:imeOptions="actionDone"
+        android:inputType="text|textFilter|textShortMessage"
+        android:singleLine="true"/>
+
     <LinearLayout
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
         android:orientation="horizontal">
 
         <EditText
-            android:id="@+id/keywords_field"
+            android:id="@+id/user_data_keywords_field"
             android:layout_width="0dp"
             android:layout_height="wrap_content"
             android:layout_weight="3"
-            android:hint="@string/keywords"
+            android:hint="@string/user_data_keywords"
             android:imeOptions="actionDone"
             android:inputType="text|textFilter|textShortMessage"
             android:singleLine="true"/>
diff --git a/mopub-sample/res/layout/native_list_view_fragment.xml b/mopub-sample/res/layout/native_list_view_fragment.xml
index d63273d1..0944ac52 100644
--- a/mopub-sample/res/layout/native_list_view_fragment.xml
+++ b/mopub-sample/res/layout/native_list_view_fragment.xml
@@ -27,17 +27,26 @@
         android:textSize="14sp"
         android:textStyle="normal"/>
 
+    <EditText
+        android:id="@+id/keywords_field"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:hint="@string/keywords"
+        android:imeOptions="actionDone"
+        android:inputType="text|textFilter|textShortMessage"
+        android:singleLine="true"/>
+
     <LinearLayout
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
         android:orientation="horizontal">
 
         <EditText
-            android:id="@+id/keywords_field"
+            android:id="@+id/user_data_keywords_field"
             android:layout_width="0dp"
             android:layout_height="wrap_content"
             android:layout_weight="3"
-            android:hint="@string/keywords"
+            android:hint="@string/user_data_keywords"
             android:imeOptions="actionDone"
             android:inputType="text|textFilter|textShortMessage"
             android:singleLine="true"/>
diff --git a/mopub-sample/res/layout/recycler_view_fragment.xml b/mopub-sample/res/layout/recycler_view_fragment.xml
index 0d04e5a9..f35696c6 100644
--- a/mopub-sample/res/layout/recycler_view_fragment.xml
+++ b/mopub-sample/res/layout/recycler_view_fragment.xml
@@ -25,17 +25,26 @@
         android:textSize="14sp"
         android:textStyle="normal"/>
 
+    <EditText
+        android:id="@+id/keywords_field"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:hint="@string/keywords"
+        android:imeOptions="actionDone"
+        android:inputType="text|textFilter|textShortMessage"
+        android:singleLine="true"/>
+
     <LinearLayout
         android:layout_width="match_parent"
         android:layout_height="wrap_content"
         android:orientation="horizontal">
 
         <EditText
-            android:id="@+id/keywords_field"
+            android:id="@+id/user_data_keywords_field"
             android:layout_width="0dp"
             android:layout_height="wrap_content"
             android:layout_weight="3"
-            android:hint="@string/keywords"
+            android:hint="@string/user_data_keywords"
             android:imeOptions="actionDone"
             android:inputType="text|textFilter|textShortMessage"
             android:singleLine="true"/>
diff --git a/mopub-sample/res/values/strings.xml b/mopub-sample/res/values/strings.xml
index 98143ede..290904ee 100644
--- a/mopub-sample/res/values/strings.xml
+++ b/mopub-sample/res/values/strings.xml
@@ -2,6 +2,7 @@
 <resources>
     <string name="app_name">MoPub Sample App</string>
     <string name="keywords">Keywords (optional)</string>
+    <string name="user_data_keywords">User Data Keywords (optional)</string>
     <string name="custom_data">Custom Data (optional)</string>
     <string name="load_ad">Load Ad</string>
     <string name="refresh_ad">Refresh Ad</string>
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AbstractBannerDetailFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AbstractBannerDetailFragment.java
index c92575b3..044b0f43 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AbstractBannerDetailFragment.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/AbstractBannerDetailFragment.java
@@ -45,7 +45,8 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container,
         mMoPubView.setLayoutParams(layoutParams);
 
         views.mKeywordsField.setText(getArguments().getString(MoPubListFragment.KEYWORDS_KEY, ""));
-        hideSoftKeyboard(views.mKeywordsField);
+        views.mUserDataKeywordsField.setText(getArguments().getString(MoPubListFragment.USER_DATA_KEYWORDS_KEY, ""));
+        hideSoftKeyboard(views.mUserDataKeywordsField);
 
         final String adUnitId = mMoPubSampleAdUnit.getAdUnitId();
         views.mDescriptionView.setText(mMoPubSampleAdUnit.getDescription());
@@ -54,11 +55,12 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container,
             @Override
             public void onClick(View view) {
                 final String keywords = views.mKeywordsField.getText().toString();
-                loadMoPubView(adUnitId, keywords);
+                final String userDataKeywords = views.mUserDataKeywordsField.getText().toString();
+                loadMoPubView(adUnitId, keywords, userDataKeywords);
             }
         });
         mMoPubView.setBannerAdListener(this);
-        loadMoPubView(adUnitId, null);
+        loadMoPubView(adUnitId, null, null);
 
         return view;
     }
@@ -73,9 +75,10 @@ public void onDestroyView() {
         }
     }
 
-    private void loadMoPubView(final String adUnitId, final String keywords) {
+    private void loadMoPubView(final String adUnitId, final String keywords, final String userDataKeywords) {
         mMoPubView.setAdUnitId(adUnitId);
         mMoPubView.setKeywords(keywords);
+        mMoPubView.setUserDataKeywords(userDataKeywords);
         mMoPubView.loadAd();
     }
 
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/DetailFragmentViewHolder.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/DetailFragmentViewHolder.java
index 8d870afd..e5e8118b 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/DetailFragmentViewHolder.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/DetailFragmentViewHolder.java
@@ -17,6 +17,7 @@
     @Nullable final Button mShowButton;
     @NonNull final TextView mAdUnitIdView;
     @NonNull final EditText mKeywordsField;
+    @NonNull final EditText mUserDataKeywordsField;
     @Nullable final EditText mCustomDataField;
 
     /**
@@ -26,8 +27,9 @@
      * @param adUnitIdView Displays adUnitId
      * @param loadButton Loads an ad. For non-cached ad formats, this will also display the ad
      * @param showButton Displays an ad. (optional, only defined for interstitial and rewarded ads)
-     * @param keywordsField Keyword entry field. This is eventually passed in the 'q' query
-     *                      parameter in the ad request
+     * @param keywordsField  Application keywords. This is passed in the 'q' query parameter
+     * @param userDataKeywordsField User data keyword entry field. This is eventually passed in the
+     *                      'user_data_q' query parameter in the ad request
      * @param customDataField Custom data entry field. Used to include arbitrary data to rewarded
      *                        completion URLs. View visibility defaults to {@link View#GONE}.
      *                        (optional, only defined for rewarded ads)
@@ -38,12 +40,14 @@ private DetailFragmentViewHolder(
             @NonNull final Button loadButton,
             @Nullable final Button showButton,
             @NonNull final EditText keywordsField,
+            @NonNull final EditText userDataKeywordsField,
             @Nullable final EditText customDataField) {
         mDescriptionView = descriptionView;
         mAdUnitIdView = adUnitIdView;
         mLoadButton = loadButton;
         mShowButton = showButton;
         mKeywordsField = keywordsField;
+        mUserDataKeywordsField = userDataKeywordsField;
         mCustomDataField = customDataField;
     }
 
@@ -53,9 +57,10 @@ static DetailFragmentViewHolder fromView(@NonNull final View view) {
         final Button loadButton = (Button) view.findViewById(R.id.load_button);
         final Button showButton = (Button) view.findViewById(R.id.show_button);
         final EditText keywordsField = (EditText) view.findViewById(R.id.keywords_field);
+        final EditText userDataKeywordsField = (EditText) view.findViewById(R.id.user_data_keywords_field);
         final EditText customDataField = (EditText) view.findViewById(R.id.custom_data_field);
 
         return new DetailFragmentViewHolder(descriptionView, adUnitIdView, loadButton, showButton,
-                keywordsField, customDataField);
+                keywordsField, userDataKeywordsField, customDataField);
     }
 }
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialDetailFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialDetailFragment.java
index fec98dd9..1c996ffd 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialDetailFragment.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/InterstitialDetailFragment.java
@@ -21,12 +21,12 @@
     @Override
     public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
         super.onCreateView(inflater, container, savedInstanceState);
-        final MoPubSampleAdUnit adConfiguration =
-                MoPubSampleAdUnit.fromBundle(getArguments());
+        final MoPubSampleAdUnit adConfiguration = MoPubSampleAdUnit.fromBundle(getArguments());
         final View view = inflater.inflate(R.layout.interstitial_detail_fragment, container, false);
         final DetailFragmentViewHolder views = DetailFragmentViewHolder.fromView(view);
         views.mKeywordsField.setText(getArguments().getString(MoPubListFragment.KEYWORDS_KEY, ""));
-        hideSoftKeyboard(views.mKeywordsField);
+        views.mUserDataKeywordsField.setText(getArguments().getString(MoPubListFragment.USER_DATA_KEYWORDS_KEY, ""));
+        hideSoftKeyboard(views.mUserDataKeywordsField);
 
         final String adUnitId = adConfiguration.getAdUnitId();
         views.mDescriptionView.setText(adConfiguration.getDescription());
@@ -40,7 +40,9 @@ public void onClick(View view) {
                     mMoPubInterstitial.setInterstitialAdListener(InterstitialDetailFragment.this);
                 }
                 final String keywords = views.mKeywordsField.getText().toString();
+                final String userDatakeywords = views.mUserDataKeywordsField.getText().toString();
                 mMoPubInterstitial.setKeywords(keywords);
+                mMoPubInterstitial.setUserDataKeywords(userDatakeywords);
                 mMoPubInterstitial.load();
             }
         });
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/LoggingUtils.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/LoggingUtils.java
index c39e77f5..c7cad1ac 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/LoggingUtils.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/LoggingUtils.java
@@ -33,11 +33,8 @@ static void enableCanaryLogging(@NonNull final Context context) {
             return;
         }
 
-        // This makes sure the static block in MoPubLog is executed before
-        // LogManager#getLogManager is called.
-        MoPubLog.c("Canary level logging enabled");
-
         final Handler handler = new SampleAppLogHandler(context.getApplicationContext());
+        MoPubLog.c("Setting up MoPubLog");
         final Logger logger = getLogger();
         logger.addHandler(handler);
 
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubListFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubListFragment.java
index ce6d1e79..7d16e54a 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubListFragment.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubListFragment.java
@@ -33,16 +33,15 @@
 import static com.mopub.simpleadsdemo.MoPubSampleAdUnit.AdType;
 import static com.mopub.simpleadsdemo.Utils.logToast;
 
-
 interface TrashCanClickListener {
     void onTrashCanClicked(MoPubSampleAdUnit adUnit);
 }
 
 public class MoPubListFragment extends ListFragment implements TrashCanClickListener {
-
     private static final String AD_UNIT_ID_KEY = "adUnitId";
     private static final String FORMAT_KEY = "format";
     static final String KEYWORDS_KEY = "keywords";
+    static final String USER_DATA_KEYWORDS_KEY = "user_data_keywords";
     private static final String NAME_KEY = "name";
 
     private MoPubSampleListAdapter mAdapter;
@@ -80,7 +79,8 @@ void addAdUnitViaDeeplink(@Nullable final Uri deeplinkData) {
         final MoPubSampleAdUnit adUnit = new MoPubSampleAdUnit.Builder(adUnitId,
                 adType).description(name == null ? "" : name).build();
         final MoPubSampleAdUnit newAdUnit = addAdUnit(adUnit);
-        enterAdFragment(newAdUnit, deeplinkData.getQueryParameter(KEYWORDS_KEY));
+        enterAdFragment(newAdUnit, deeplinkData.getQueryParameter(KEYWORDS_KEY),
+                deeplinkData.getQueryParameter(USER_DATA_KEYWORDS_KEY));
     }
 
     @Override
@@ -107,12 +107,12 @@ public void onListItemClick(ListView listView, View view, int position, long id)
         final MoPubSampleAdUnit adConfiguration = mAdapter.getItem(position);
 
         if (adConfiguration != null) {
-            enterAdFragment(adConfiguration, null);
+            enterAdFragment(adConfiguration, null, null);
         }
     }
 
     private void enterAdFragment(@NonNull final MoPubSampleAdUnit adConfiguration,
-            @Nullable final String keywords) {
+             @Nullable final String keywords, @Nullable final String userDataKeywords) {
         Preconditions.checkNotNull(adConfiguration);
 
         final FragmentTransaction fragmentTransaction =
@@ -135,6 +135,9 @@ private void enterAdFragment(@NonNull final MoPubSampleAdUnit adConfiguration,
         if (!TextUtils.isEmpty(keywords)) {
             bundle.putString(KEYWORDS_KEY, keywords);
         }
+        if (!TextUtils.isEmpty(userDataKeywords)) {
+            bundle.putString(USER_DATA_KEYWORDS_KEY, userDataKeywords);
+        }
         fragment.setArguments(bundle);
 
         if (getFragmentManager().getBackStackEntryCount() > 0) {
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleActivity.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleActivity.java
index a40e9dfb..08756572 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleActivity.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/MoPubSampleActivity.java
@@ -5,12 +5,20 @@
 import android.os.Build;
 import android.os.Bundle;
 import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
 import android.support.v4.app.ActivityCompat;
 import android.support.v4.app.FragmentActivity;
 import android.webkit.WebView;
 
 import com.mopub.common.MoPub;
+import com.mopub.common.SdkConfiguration;
+import com.mopub.common.SdkInitializationListener;
+import com.mopub.common.privacy.ConsentDialogListener;
+import com.mopub.common.privacy.ConsentStatus;
+import com.mopub.common.privacy.ConsentStatusChangeListener;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.util.DeviceUtils;
+import com.mopub.mobileads.MoPubErrorCode;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -20,7 +28,8 @@
 import static com.mopub.common.Constants.UNUSED_REQUEST_CODE;
 
 public class MoPubSampleActivity extends FragmentActivity {
-    private static final List<String> REQUIRED_DANGEROUS_PERMISSIONS = new ArrayList<String>();
+    private static final List<String> REQUIRED_DANGEROUS_PERMISSIONS = new ArrayList<>();
+
     static {
         REQUIRED_DANGEROUS_PERMISSIONS.add(ACCESS_COARSE_LOCATION);
         REQUIRED_DANGEROUS_PERMISSIONS.add(WRITE_EXTERNAL_STORAGE);
@@ -40,17 +49,15 @@ private static void setWebDebugging() {
 
     private MoPubListFragment mMoPubListFragment;
     private Intent mDeeplinkIntent;
+    @Nullable
+    PersonalInfoManager mPersonalInfoManager;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.main);
 
-        if (savedInstanceState != null) {
-            return;
-        }
-
-        List<String> permissionsToBeRequested = new ArrayList<String>();
+        List<String> permissionsToBeRequested = new ArrayList<>();
         for (String permission : REQUIRED_DANGEROUS_PERMISSIONS) {
             if (!DeviceUtils.isPermissionGranted(this, permission)) {
                 permissionsToBeRequested.add(permission);
@@ -67,7 +74,18 @@ protected void onCreate(Bundle savedInstanceState) {
         MoPub.setLocationAwareness(MoPub.LocationAwareness.TRUNCATED);
         MoPub.setLocationPrecision(4);
 
-        createMoPubListFragment(getIntent());
+        if (savedInstanceState == null) {
+            createMoPubListFragment(getIntent());
+        }
+
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder("b195f8dd8ded45fe847ad89ed1d016da")
+                .build();
+        MoPub.initializeSdk(this, sdkConfiguration, initSdkListener());
+
+        mPersonalInfoManager = MoPub.getPersonalInformationManager();
+        if (mPersonalInfoManager != null) {
+            mPersonalInfoManager.subscribeConsentStatusChangeListener(initConsentChangeListener());
+        }
 
         // Intercepts all logs including Level.FINEST so we can show a toast
         // that is not normally user-facing. This is only used for native ads.
@@ -98,4 +116,49 @@ public void onPostResume() {
             mDeeplinkIntent = null;
         }
     }
+
+    private SdkInitializationListener initSdkListener() {
+        return new SdkInitializationListener() {
+
+            @Override
+            public void onInitializationFinished() {
+                Utils.logToast(MoPubSampleActivity.this, "SDK initialized.");
+                if (mPersonalInfoManager != null && mPersonalInfoManager.shouldShowConsentDialog()) {
+                    mPersonalInfoManager.loadConsentDialog(initDialogLoadListener());
+                }
+            }
+        };
+    }
+
+    private ConsentStatusChangeListener initConsentChangeListener() {
+        return new ConsentStatusChangeListener() {
+
+            @Override
+            public void onConsentStateChange(@NonNull ConsentStatus oldConsentStatus,
+                                             @NonNull ConsentStatus newConsentStatus,
+                                             boolean canCollectPersonalInformation) {
+                Utils.logToast(MoPubSampleActivity.this, "Consent: " + newConsentStatus.name());
+                if (mPersonalInfoManager != null && mPersonalInfoManager.shouldShowConsentDialog()) {
+                    mPersonalInfoManager.loadConsentDialog(initDialogLoadListener());
+                }
+            }
+        };
+    }
+
+    private ConsentDialogListener initDialogLoadListener() {
+        return new ConsentDialogListener() {
+
+            @Override
+            public void onConsentDialogLoaded() {
+                if (mPersonalInfoManager != null) {
+                    mPersonalInfoManager.showConsentDialog();
+                }
+            }
+
+            @Override
+            public void onConsentDialogLoadFailed(@NonNull MoPubErrorCode moPubErrorCode) {
+                Utils.logToast(MoPubSampleActivity.this, "Consent dialog failed to load.");
+            }
+        };
+    }
 }
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeGalleryFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeGalleryFragment.java
index b62f18c5..aeb3e4ff 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeGalleryFragment.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeGalleryFragment.java
@@ -44,6 +44,7 @@ public void onClick(View view) {
                 // If your app already has location access, include it here.
                 final Location location = null;
                 final String keywords = views.mKeywordsField.getText().toString();
+                final String userDataKeywords = views.mUserDataKeywordsField.getText().toString();
 
                 // Setting desired assets on your request helps native ad networks and bidders
                 // provide higher-quality ads.
@@ -57,6 +58,7 @@ public void onClick(View view) {
                 mRequestParameters = new RequestParameters.Builder()
                         .location(location)
                         .keywords(keywords)
+                        .userDataKeywords(userDataKeywords)
                         .desiredAssets(desiredAssets)
                         .build();
 
@@ -70,6 +72,7 @@ public void onClick(View view) {
         views.mDescriptionView.setText(mAdConfiguration.getDescription());
         views.mAdUnitIdView.setText(adUnitId);
         views.mKeywordsField.setText(getArguments().getString(MoPubListFragment.KEYWORDS_KEY, ""));
+        views.mUserDataKeywordsField.setText(getArguments().getString(MoPubListFragment.USER_DATA_KEYWORDS_KEY, ""));
         mViewPager = (ViewPager) view.findViewById(R.id.gallery_pager);
 
         // Set up a renderer for a static native ad.
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeListViewFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeListViewFragment.java
index 6616d4e3..3c9bbb99 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeListViewFragment.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeListViewFragment.java
@@ -42,6 +42,7 @@ public void onClick(View view) {
                 // If your app already has location access, include it here.
                 final Location location = null;
                 final String keywords = views.mKeywordsField.getText().toString();
+                final String userDataKeywords = views.mUserDataKeywordsField.getText().toString();
 
                 // Setting desired assets on your request helps native ad networks and bidders
                 // provide higher-quality ads.
@@ -55,6 +56,7 @@ public void onClick(View view) {
                 mRequestParameters = new RequestParameters.Builder()
                         .location(location)
                         .keywords(keywords)
+                        .userDataKeywords(userDataKeywords)
                         .desiredAssets(desiredAssets)
                         .build();
 
@@ -65,6 +67,7 @@ public void onClick(View view) {
         views.mDescriptionView.setText(mAdConfiguration.getDescription());
         views.mAdUnitIdView.setText(adUnitId);
         views.mKeywordsField.setText(getArguments().getString(MoPubListFragment.KEYWORDS_KEY, ""));
+        views.mUserDataKeywordsField.setText(getArguments().getString(MoPubListFragment.USER_DATA_KEYWORDS_KEY, ""));
 
         final ArrayAdapter<String> adapter = new ArrayAdapter<String>(getActivity(),
                 android.R.layout.simple_list_item_1);
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeRecyclerViewFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeRecyclerViewFragment.java
index f9b9d095..cb899fe3 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeRecyclerViewFragment.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/NativeRecyclerViewFragment.java
@@ -56,6 +56,7 @@ public void onClick(final View v) {
                 // If your app already has location access, include it here.
                 final Location location = null;
                 final String keywords = viewHolder.mKeywordsField.getText().toString();
+                final String userDataKeywords = viewHolder.mUserDataKeywordsField.getText().toString();
 
                 // Setting desired assets on your request helps native ad networks and bidders
                 // provide higher-quality ads.
@@ -69,6 +70,7 @@ public void onClick(final View v) {
                 mRequestParameters = new RequestParameters.Builder()
                         .location(location)
                         .keywords(keywords)
+                        .userDataKeywords(userDataKeywords)
                         .desiredAssets(desiredAssets)
                         .build();
 
@@ -81,6 +83,7 @@ public void onClick(final View v) {
         viewHolder.mDescriptionView.setText(mAdConfiguration.getDescription());
         viewHolder.mAdUnitIdView.setText(adUnitId);
         viewHolder.mKeywordsField.setText(getArguments().getString(MoPubListFragment.KEYWORDS_KEY, ""));
+        viewHolder.mUserDataKeywordsField.setText(getArguments().getString(MoPubListFragment.USER_DATA_KEYWORDS_KEY, ""));
 
         final RecyclerView.Adapter originalAdapter = new DemoRecyclerAdapter();
 
diff --git a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/RewardedVideoDetailFragment.java b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/RewardedVideoDetailFragment.java
index 8f66f3d2..747df6ea 100644
--- a/mopub-sample/src/main/java/com/mopub/simpleadsdemo/RewardedVideoDetailFragment.java
+++ b/mopub-sample/src/main/java/com/mopub/simpleadsdemo/RewardedVideoDetailFragment.java
@@ -13,8 +13,9 @@
 import android.view.ViewGroup;
 import android.widget.Button;
 
+import com.mopub.common.MoPub;
 import com.mopub.common.MoPubReward;
-import com.mopub.mobileads.CustomEventRewardedVideo;
+import com.mopub.common.SdkConfiguration;
 import com.mopub.mobileads.MoPubErrorCode;
 import com.mopub.mobileads.MoPubRewardedVideoListener;
 import com.mopub.mobileads.MoPubRewardedVideoManager.RequestParameters;
@@ -35,8 +36,7 @@
     private static boolean sRewardedVideoInitialized;
 
     // Include any custom event rewarded video classes, if available, for initialization.
-    private static final List<Class<? extends CustomEventRewardedVideo>> sNetworksToInit =
-            new LinkedList<>();
+    private static final List<String> sNetworksToInit = new LinkedList<>();
 
     @Nullable private Button mShowButton;
     @Nullable private String mAdUnitId;
@@ -51,10 +51,14 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle sa
         final View view = inflater.inflate(R.layout.interstitial_detail_fragment, container, false);
         final DetailFragmentViewHolder views = DetailFragmentViewHolder.fromView(view);
         views.mKeywordsField.setText(getArguments().getString(MoPubListFragment.KEYWORDS_KEY, ""));
+        views.mUserDataKeywordsField.setText(getArguments().getString(MoPubListFragment.USER_DATA_KEYWORDS_KEY, ""));
         hideSoftKeyboard(views.mKeywordsField);
+        hideSoftKeyboard(views.mUserDataKeywordsField);
 
         if (!sRewardedVideoInitialized) {
-            MoPubRewardedVideos.initializeRewardedVideo(getActivity(), sNetworksToInit);
+            MoPub.initializeSdk(getActivity(), new SdkConfiguration.Builder(
+                            "b195f8dd8ded45fe847ad89ed1d016da")
+                            .withNetworksToInit(sNetworksToInit).build(), null);
             sRewardedVideoInitialized = true;
         }
         MoPubRewardedVideos.setRewardedVideoListener(this);
@@ -71,7 +75,7 @@ public void onClick(View view) {
                     return;
                 }
                 MoPubRewardedVideos.loadRewardedVideo(mAdUnitId,
-                        new RequestParameters(views.mKeywordsField.getText().toString(), null,
+                        new RequestParameters(views.mKeywordsField.getText().toString(), views.mUserDataKeywordsField.getText().toString(),null,
                                 "sample_app_customer_id"));
                 if (mShowButton != null) {
                     mShowButton.setEnabled(false);
diff --git a/mopub-sample/src/test/resources/robolectric.properties b/mopub-sample/src/test/resources/com/mopub/robolectric.properties
similarity index 100%
rename from mopub-sample/src/test/resources/robolectric.properties
rename to mopub-sample/src/test/resources/com/mopub/robolectric.properties
diff --git a/mopub-sdk/build.gradle b/mopub-sdk/build.gradle
index dc087560..eb0a8bde 100644
--- a/mopub-sdk/build.gradle
+++ b/mopub-sdk/build.gradle
@@ -1,27 +1,35 @@
 apply from: 'shared-build.gradle'
 
 dependencies {
-    compile project(':mopub-sdk:mopub-sdk-base')
-    compile project(':mopub-sdk:mopub-sdk-banner')
-    compile project(':mopub-sdk:mopub-sdk-interstitial')
-    compile project(':mopub-sdk:mopub-sdk-rewardedvideo')
-    compile project(':mopub-sdk:mopub-sdk-native-static')
-    compile project(':mopub-sdk:mopub-sdk-native-video')
+    api project(':mopub-sdk:mopub-sdk-base')
+    api project(':mopub-sdk:mopub-sdk-banner')
+    api project(':mopub-sdk:mopub-sdk-interstitial')
+    api project(':mopub-sdk:mopub-sdk-rewardedvideo')
+    api project(':mopub-sdk:mopub-sdk-native-static')
+    api project(':mopub-sdk:mopub-sdk-native-video')
 
-    testCompile 'junit:junit:4.10'
-    testCompile 'org.robolectric:robolectric:3.0'
-    testCompile 'org.robolectric:shadows-support-v4:3.0'
-    testCompile 'org.robolectric:shadows-httpclient:3.0'
-    testCompile 'com.squareup:fest-android:1.0.7'
-    testCompile 'org.mockito:mockito-core:1.9.5'
-    testCompile 'org.powermock:powermock-module-junit4:1.6.5'
-    testCompile 'org.powermock:powermock-module-junit4-rule:1.6.5'
-    testCompile 'org.powermock:powermock-api-mockito:1.6.5'
-    testCompile 'org.powermock:powermock-classloading-xstream:1.6.5'
+    testImplementation 'junit:junit:4.12'
+    testImplementation 'org.robolectric:robolectric:3.5.1'
+    testImplementation 'org.robolectric:shadows-support-v4:3.3.2'
+    testImplementation 'org.robolectric:shadows-httpclient:3.5.1'
+    testImplementation 'com.squareup:fest-android:1.0.7'
+    testImplementation 'org.mockito:mockito-core:1.9.5'
+    testImplementation 'org.powermock:powermock-module-junit4:1.6.5'
+    testImplementation 'org.powermock:powermock-module-junit4-rule:1.6.5'
+    testImplementation 'org.powermock:powermock-api-mockito:1.6.5'
+    testImplementation 'org.powermock:powermock-classloading-xstream:1.6.5'
+}
+
+android {
+    testOptions {
+        unitTests {
+            includeAndroidResources = true
+        }
+    }
 }
 
 project.description = 'MoPub Android SDK'
 project.ext.displayName = 'MoPub Android SDK'
 project.ext.projectName = 'mopub-sdk'
 project.ext.uploadName = 'mopub-android-sdk'
-apply from: 'publisher.gradle'
+apply from: 'publisher.gradle'
\ No newline at end of file
diff --git a/mopub-sdk/gradle/wrapper/gradle-wrapper.properties b/mopub-sdk/gradle/wrapper/gradle-wrapper.properties
index 6faa4eab..3e785403 100644
--- a/mopub-sdk/gradle/wrapper/gradle-wrapper.properties
+++ b/mopub-sdk/gradle/wrapper/gradle-wrapper.properties
@@ -1,6 +1,6 @@
-#Mon Jun 20 17:19:29 PDT 2016
+#Mon Nov 13 15:46:01 PST 2017
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-2.10-bin.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-4.3.1-all.zip
diff --git a/mopub-sdk/mopub-sdk-banner/build.gradle b/mopub-sdk/mopub-sdk-banner/build.gradle
index 011a0db8..843d709e 100644
--- a/mopub-sdk/mopub-sdk-banner/build.gradle
+++ b/mopub-sdk/mopub-sdk-banner/build.gradle
@@ -1,7 +1,7 @@
 apply from: '../shared-build.gradle'
 
 dependencies {
-    compile project(':mopub-sdk:mopub-sdk-base')
+    api project(':mopub-sdk:mopub-sdk-base')
 }
 
 project.description = 'MoPub Android SDK - Banner'
diff --git a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java
index 9ae515fd..5b24ec80 100644
--- a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java
+++ b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/CustomEventBannerAdapter.java
@@ -23,6 +23,7 @@
 import static com.mopub.common.DataKeys.AD_HEIGHT;
 import static com.mopub.common.DataKeys.AD_REPORT_KEY;
 import static com.mopub.common.DataKeys.AD_WIDTH;
+import static com.mopub.common.DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED;
 import static com.mopub.common.DataKeys.BROADCAST_IDENTIFIER_KEY;
 import static com.mopub.mobileads.MoPubErrorCode.ADAPTER_NOT_FOUND;
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_TIMEOUT;
@@ -39,7 +40,6 @@
 
     private final Handler mHandler;
     private final Runnable mTimeout;
-    private boolean mStoredAutorefresh;
 
     private int mImpressionMinVisibleDips = Integer.MIN_VALUE;
     private int mImpressionMinVisibleMs = Integer.MIN_VALUE;
@@ -87,6 +87,7 @@ public void run() {
         mLocalExtras.put(AD_REPORT_KEY, adReport);
         mLocalExtras.put(AD_WIDTH, mMoPubView.getAdWidth());
         mLocalExtras.put(AD_HEIGHT, mMoPubView.getAdHeight());
+        mLocalExtras.put(BANNER_IMPRESSION_PIXEL_COUNT_ENABLED, mIsVisibilityImpressionTrackingEnabled);
     }
 
     @ReflectionTarget
@@ -224,6 +225,8 @@ public void onBannerLoaded(View bannerView) {
             // Else, retain old behavior of firing AdServer impression tracking URL if and only if
             // banner is not HTML.
             if (mIsVisibilityImpressionTrackingEnabled) {
+                // Disable autorefresh temporarily until an impression happens.
+                mMoPubView.pauseAutorefresh();
                 // Set up visibility tracker and listener if in experiment
                 mVisibilityTracker = new BannerVisibilityTracker(mContext, mMoPubView, bannerView,
                         mImpressionMinVisibleDips, mImpressionMinVisibleMs);
@@ -235,6 +238,7 @@ public void onVisibilityChanged() {
                         if (mCustomEventBanner != null) {
                             mCustomEventBanner.trackMpxAndThirdPartyImpressions();
                         }
+                        mMoPubView.resumeAutorefresh();
                     }
                 });
             }
@@ -271,8 +275,7 @@ public void onBannerExpanded() {
             return;
         }
 
-        mStoredAutorefresh = mMoPubView.getAutorefreshEnabled();
-        mMoPubView.setAutorefreshEnabled(false);
+        mMoPubView.expand();
         mMoPubView.adPresentedOverlay();
     }
 
@@ -282,7 +285,7 @@ public void onBannerCollapsed() {
             return;
         }
 
-        mMoPubView.setAutorefreshEnabled(mStoredAutorefresh);
+        mMoPubView.collapse();
         mMoPubView.adClosed();
     }
 
diff --git a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/HtmlBanner.java b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/HtmlBanner.java
index 1cf274fb..884f10a5 100644
--- a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/HtmlBanner.java
+++ b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/HtmlBanner.java
@@ -7,19 +7,24 @@
 import com.mopub.common.AdReport;
 import com.mopub.common.DataKeys;
 import com.mopub.common.ExternalViewabilitySessionManager;
+import com.mopub.common.VisibleForTesting;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.mobileads.factories.HtmlBannerWebViewFactory;
 
+import java.lang.ref.WeakReference;
 import java.util.Map;
 
 import static com.mopub.common.DataKeys.AD_REPORT_KEY;
+import static com.mopub.common.DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED;
 import static com.mopub.common.util.JavaScriptWebViewCallbacks.WEB_VIEW_DID_APPEAR;
 import static com.mopub.mobileads.MoPubErrorCode.INTERNAL_ERROR;
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_INVALID_STATE;
 
 public class HtmlBanner extends CustomEventBanner {
-    private HtmlBannerWebView mHtmlBannerWebView;
+    @Nullable private HtmlBannerWebView mHtmlBannerWebView;
     @Nullable private ExternalViewabilitySessionManager mExternalViewabilitySessionManager;
+    private boolean mBannerImpressionPixelCountEnabled = false;
+    @Nullable private WeakReference<Activity> mWeakActivity;
 
     @Override
     protected void loadBanner(
@@ -27,6 +32,11 @@ protected void loadBanner(
             CustomEventBannerListener customEventBannerListener,
             Map<String, Object> localExtras,
             Map<String, String> serverExtras) {
+        final Object bannerImpressionPixelCountEnabledObject = localExtras.get(
+                BANNER_IMPRESSION_PIXEL_COUNT_ENABLED);
+        if (bannerImpressionPixelCountEnabledObject instanceof Boolean) {
+            mBannerImpressionPixelCountEnabled = (boolean) bannerImpressionPixelCountEnabledObject;
+        }
 
         String htmlData;
         String redirectUrl;
@@ -54,10 +64,15 @@ protected void loadBanner(
         mHtmlBannerWebView = HtmlBannerWebViewFactory.create(context, adReport, customEventBannerListener, isScrollable, redirectUrl, clickthroughUrl);
         AdViewController.setShouldHonorServerDimensions(mHtmlBannerWebView);
 
+        // We only measure viewability when we have an activity context. This sets up a delayed
+        // viewability session if we have the new pixel-counting banner impression tracking enabled.
+        // Otherwise, set up a regular display session.
         if (context instanceof Activity) {
             final Activity activity = (Activity) context;
+            mWeakActivity = new WeakReference<Activity>(activity);
             mExternalViewabilitySessionManager = new ExternalViewabilitySessionManager(activity);
-            mExternalViewabilitySessionManager.createDisplaySession(activity, mHtmlBannerWebView);
+            mExternalViewabilitySessionManager.createDisplaySession(activity, mHtmlBannerWebView,
+                    mBannerImpressionPixelCountEnabled);
         } else {
             MoPubLog.d("Unable to start viewability session for HTML banner: Context provided was not an Activity.");
         }
@@ -79,10 +94,33 @@ protected void onInvalidate() {
 
     @Override
     protected void trackMpxAndThirdPartyImpressions() {
+        if (mHtmlBannerWebView == null) {
+            return;
+        }
+
         mHtmlBannerWebView.loadUrl(WEB_VIEW_DID_APPEAR.getUrl());
+
+        // mExternalViewabilitySessionManager is usually only null if the original Context given
+        // to loadBanner() was not an Activity Context. We don't need to start the deferred
+        // viewability tracker since it wasn't created, and if it was, and the activity reference
+        // was lost, something bad has happened, so we should drop the request.
+        if (mBannerImpressionPixelCountEnabled && mExternalViewabilitySessionManager != null &&
+                mWeakActivity != null) {
+            final Activity activity = mWeakActivity.get();
+            if (activity != null) {
+                mExternalViewabilitySessionManager.startDeferredDisplaySession(activity);
+            } else {
+                MoPubLog.d("Lost the activity for deferred Viewability tracking. Dropping session.");
+            }
+        }
     }
 
     private boolean extrasAreValid(Map<String, String> serverExtras) {
         return serverExtras.containsKey(DataKeys.HTML_RESPONSE_BODY_KEY);
     }
+
+    @VisibleForTesting
+    boolean isBannerImpressionPixelCountEnabled() {
+        return mBannerImpressionPixelCountEnabled;
+    }
 }
diff --git a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java
index 9c0c92c9..f7be2625 100644
--- a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java
+++ b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mobileads/factories/HtmlBannerWebViewFactory.java
@@ -1,6 +1,7 @@
 package com.mopub.mobileads.factories;
 
 import android.content.Context;
+import android.support.annotation.NonNull;
 
 import com.mopub.common.AdReport;
 import com.mopub.mobileads.HtmlBannerWebView;
@@ -10,6 +11,7 @@
 public class HtmlBannerWebViewFactory {
     protected static HtmlBannerWebViewFactory instance = new HtmlBannerWebViewFactory();
 
+    @NonNull
     public static HtmlBannerWebView create(
             Context context,
             AdReport adReport,
diff --git a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mraid/MraidBanner.java b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mraid/MraidBanner.java
index 5e13128f..99b7eedb 100644
--- a/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mraid/MraidBanner.java
+++ b/mopub-sdk/mopub-sdk-banner/src/main/java/com/mopub/mraid/MraidBanner.java
@@ -1,5 +1,6 @@
 package com.mopub.mraid;
 
+import android.app.Activity;
 import android.content.Context;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
@@ -17,6 +18,7 @@
 import java.util.Map;
 
 import static com.mopub.common.DataKeys.AD_REPORT_KEY;
+import static com.mopub.common.DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED;
 import static com.mopub.common.DataKeys.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.common.util.JavaScriptWebViewCallbacks.WEB_VIEW_DID_APPEAR;
 import static com.mopub.mobileads.MoPubErrorCode.MRAID_LOAD_ERROR;
@@ -26,6 +28,7 @@
     @Nullable private CustomEventBannerListener mBannerListener;
     @Nullable private MraidWebViewDebugListener mDebugListener;
     @Nullable private ExternalViewabilitySessionManager mExternalViewabilitySessionManager;
+    private boolean mBannerImpressionPixelCountEnabled = false;
 
     @Override
     protected void loadBanner(@NonNull final Context context,
@@ -42,6 +45,12 @@ protected void loadBanner(@NonNull final Context context,
             return;
         }
 
+        final Object bannerImpressionPixelCountEnabledObject = localExtras.get(
+                BANNER_IMPRESSION_PIXEL_COUNT_ENABLED);
+        if (bannerImpressionPixelCountEnabledObject instanceof Boolean) {
+            mBannerImpressionPixelCountEnabled = (boolean) bannerImpressionPixelCountEnabledObject;
+        }
+
         try {
             AdReport adReport = (AdReport) localExtras.get(AD_REPORT_KEY);
             mMraidController = MraidControllerFactory.create(
@@ -88,8 +97,16 @@ public void onClose() {
             public void onReady(final @NonNull MraidBridge.MraidWebView webView,
                     final @Nullable ExternalViewabilitySessionManager viewabilityManager) {
                 webView.getSettings().setJavaScriptEnabled(true);
-                mExternalViewabilitySessionManager = new ExternalViewabilitySessionManager(context);
-                mExternalViewabilitySessionManager.createDisplaySession(context, webView);
+
+                // We only measure viewability when we have an activity context. This sets up a delayed
+                // viewability session if we have the new pixel-counting banner impression tracking enabled.
+                // Otherwise, set up a regular display session.
+                if (context instanceof Activity) {
+                    mExternalViewabilitySessionManager = new ExternalViewabilitySessionManager(
+                            context);
+                    mExternalViewabilitySessionManager.createDisplaySession(context, webView,
+                            mBannerImpressionPixelCountEnabled);
+                }
             }
         });
     }
@@ -108,7 +125,25 @@ protected void onInvalidate() {
 
     @Override
     protected void trackMpxAndThirdPartyImpressions() {
+        if (mMraidController == null) {
+            return;
+        }
+
         mMraidController.loadJavascript(WEB_VIEW_DID_APPEAR.getJavascript());
+
+        // mExternalViewabilitySessionManager is usually only null if the original Context given
+        // to mMraidController was not an Activity Context. We don't need to start the deferred
+        // viewability tracker since it wasn't created, and if it was, and the activity reference
+        // was lost, something bad has happened, so we should drop the request.
+        if (mBannerImpressionPixelCountEnabled &&
+                mExternalViewabilitySessionManager != null) {
+            final Activity activity = mMraidController.getWeakActivity().get();
+            if (activity != null) {
+                mExternalViewabilitySessionManager.startDeferredDisplaySession(activity);
+            } else {
+                MoPubLog.d("Lost the activity for deferred Viewability tracking. Dropping session.");
+            }
+        }
     }
 
     private boolean extrasAreValid(@NonNull final Map<String, String> serverExtras) {
@@ -122,4 +157,9 @@ public void setDebugListener(@Nullable MraidWebViewDebugListener debugListener)
             mMraidController.setDebugListener(debugListener);
         }
     }
+
+    @VisibleForTesting
+    boolean isBannerImpressionPixelCountEnabled() {
+        return mBannerImpressionPixelCountEnabled;
+    }
 }
diff --git a/mopub-sdk/mopub-sdk-base/build.gradle b/mopub-sdk/mopub-sdk-base/build.gradle
index f039998a..400d6467 100644
--- a/mopub-sdk/mopub-sdk-base/build.gradle
+++ b/mopub-sdk/mopub-sdk-base/build.gradle
@@ -8,15 +8,15 @@ repositories {
 }
 
 dependencies {
-    compile 'com.mopub.volley:mopub-volley:1.1.0'
+    api 'com.mopub.volley:mopub-volley:2.0.0'
 
     def avidEnabled = project.hasProperty("mopub.avidEnabled") ? project.getProperty("mopub.avidEnabled").toBoolean() : true
     if (avidEnabled) {
-        compile('com.mopub:libAvid-mopub:3.6.4')
+        implementation('com.mopub:libAvid-mopub:3.6.4')
     }
     def moatEnabled = project.hasProperty("mopub.moatEnabled") ? project.getProperty("mopub.moatEnabled").toBoolean() : true
     if (moatEnabled) {
-        compile 'com.moat.analytics.mobile.mpub:moat-mobile-app-kit:2.1.0'
+        implementation 'com.moat.analytics.mobile.mpub:moat-mobile-app-kit:2.4.5'
     }
 }
 
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdReport.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdReport.java
index 7e6a2b39..9fa221b2 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdReport.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdReport.java
@@ -3,6 +3,7 @@
 import android.os.Build;
 import android.support.annotation.NonNull;
 
+import com.mopub.common.privacy.AdvertisingId;
 import com.mopub.network.AdResponse;
 
 import java.io.Serializable;
@@ -22,14 +23,14 @@
     private final String mSdkVersion;
     private final String mDeviceModel;
     private final Locale mDeviceLocale;
-    private final String mUdid;
+    private final AdvertisingId mAdvertisingId;
 
     public AdReport(@NonNull String adUnitId, @NonNull ClientMetadata clientMetadata, @NonNull AdResponse adResponse) {
         mAdUnitId = adUnitId;
         mSdkVersion = clientMetadata.getSdkVersion();
         mDeviceModel = clientMetadata.getDeviceModel();
         mDeviceLocale = clientMetadata.getDeviceLocale();
-        mUdid = clientMetadata.getDeviceId();
+        mAdvertisingId = clientMetadata.getMoPubIdentifier().getAdvertisingInfo();
         mAdResponse = adResponse;
     }
 
@@ -43,7 +44,8 @@ public String toString() {
         appendKeyValue(parameters, "ad_unit_id", mAdUnitId);
         appendKeyValue(parameters, "device_locale",
                 mDeviceLocale == null ? null : mDeviceLocale.toString());
-        appendKeyValue(parameters, "device_id", mUdid);
+        appendKeyValue(parameters, "device_id",
+                mAdvertisingId.getIdentifier(MoPub.canCollectPersonalInformation()));
         appendKeyValue(parameters, "network_type", mAdResponse.getNetworkType());
         appendKeyValue(parameters, "platform", "android");
         appendKeyValue(parameters, "timestamp", getFormattedTimeStamp(mAdResponse.getTimestamp()));
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdType.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdType.java
index c387b248..35d738fa 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdType.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdType.java
@@ -14,4 +14,5 @@
     public static final String REWARDED_PLAYABLE = "rewarded_playable";
     public static final String CUSTOM = "custom";
     public static final String CLEAR = "clear";
+    public static final String MULTI = "multi";
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdUrlGenerator.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdUrlGenerator.java
index bc09b958..a4e42464 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdUrlGenerator.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdUrlGenerator.java
@@ -6,6 +6,8 @@
 import android.support.annotation.Nullable;
 import android.text.TextUtils;
 
+import com.mopub.common.privacy.ConsentData;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.util.DateAndTime;
 
 import static com.mopub.common.ClientMetadata.MoPubNetworkType;
@@ -13,20 +15,16 @@
 public abstract class AdUrlGenerator extends BaseUrlGenerator {
 
     /**
-     * The ad unit id which identifies a spot for an ad to be placed.
+     * q = query. This is for sending application keywords that better match ads.
      */
-    private static final String AD_UNIT_ID_KEY = "id";
-
-    /**
-     * nv = native version. This is the version of MoPub.
-     */
-    private static final String SDK_VERSION_KEY = "nv";
+    private static final String KEYWORDS_KEY = "q";
 
     /**
-     * q = query. This is for big publishers to send up certain
-     * keywords that better match ads.
+     * user_data_q = userDataQuery. This is for MoPub partners to send up certain
+     * user data keywords that better match ads. Will only be sent if the user has granted
+     * MoPub consent to gather and send user data information.
      */
-    private static final String KEYWORDS_KEY = "q";
+    private static final String USER_DATA_KEYWORDS_KEY = "user_data_q";
 
     /**
      * Location represented in latitude and longitude.
@@ -67,7 +65,7 @@
      * https://developer.android.com/guide/practices/screens_support.html
      * for details on values this can be.
      */
-    private static final String SCREEN_SCALE_KEY = "sc_a";
+    private static final String SCREEN_SCALE_KEY = "sc";
 
     /**
      * Whether or not this is using mraid. 1 = yes.
@@ -97,11 +95,6 @@
      */
     private static final String CARRIER_TYPE_KEY = "ct";
 
-    /**
-     * Bundle ID, as in package name.
-     */
-    private static final String BUNDLE_ID_KEY = "bundle";
-
     /**
      * Whether or not this ad is using third-party viewability tracking.
      * 0: Moat disabled, Avid disabled
@@ -111,13 +104,28 @@
      */
     private static final String VIEWABILITY_KEY = "vv";
 
+    /**
+     * The advanced bidding token for each MoPubAdvancedBidder in JSON format.
+     */
+    private static final String ADVANCED_BIDDING_TOKENS_KEY = "abt";
+
     protected Context mContext;
     protected String mAdUnitId;
     protected String mKeywords;
+    protected String mUserDataKeywords;
     protected Location mLocation;
+    @Nullable private final PersonalInfoManager mPersonalInfoManager;
+    @Nullable private final ConsentData mConsentData;
+    protected Boolean mForceGdprApplies;
 
     public AdUrlGenerator(Context context) {
         mContext = context;
+        mPersonalInfoManager = MoPub.getPersonalInformationManager();
+        if (mPersonalInfoManager == null) {
+            mConsentData = null;
+        } else {
+            mConsentData = mPersonalInfoManager.getConsentData();
+        }
     }
 
     public AdUrlGenerator withAdUnitId(String adUnitId) {
@@ -130,6 +138,11 @@ public AdUrlGenerator withKeywords(String keywords) {
         return this;
     }
 
+    public AdUrlGenerator withUserDataKeywords(String userDataKeywords) {
+        mUserDataKeywords = userDataKeywords;
+        return this;
+    }
+
     public AdUrlGenerator withLocation(Location location) {
         mLocation = location;
         return this;
@@ -147,7 +160,18 @@ protected void setKeywords(String keywords) {
         addParam(KEYWORDS_KEY, keywords);
     }
 
+    protected void setUserDataKeywords(String userDataKeywords) {
+        if (!MoPub.canCollectPersonalInformation()) {
+            return;
+        }
+        addParam(USER_DATA_KEYWORDS_KEY, userDataKeywords);
+    }
+
     protected void setLocation(@Nullable Location location) {
+        if (!MoPub.canCollectPersonalInformation()) {
+            return;
+        }
+
         Location bestLocation = location;
         Location locationFromLocationService = LocationService.getLastKnownLocation(mContext,
                 MoPub.getLocationPrecision(),
@@ -189,12 +213,17 @@ protected void setMraidFlag(boolean mraid) {
     }
 
     protected void setMccCode(String networkOperator) {
-        String mcc = networkOperator == null ? "" : networkOperator.substring(0, mncPortionLength(networkOperator));
+        String mcc = networkOperator == null
+                ? ""
+                : networkOperator.substring(0, mncPortionLength(networkOperator));
         addParam(MOBILE_COUNTRY_CODE_KEY, mcc);
     }
 
     protected void setMncCode(String networkOperator) {
-        String mnc = networkOperator == null ? "" : networkOperator.substring(mncPortionLength(networkOperator));
+        String mnc = networkOperator == null
+                ? ""
+                : networkOperator.substring(
+                mncPortionLength(networkOperator));
         addParam(MOBILE_NETWORK_CODE_KEY, mnc);
     }
 
@@ -222,6 +251,43 @@ protected void enableViewability(@NonNull final String vendorKey) {
         addParam(VIEWABILITY_KEY, vendorKey);
     }
 
+    protected void setAdvancedBiddingTokens() {
+        final String adTokens = MoPub.getAdvancedBiddingTokensJson(mContext);
+        addParam(ADVANCED_BIDDING_TOKENS_KEY, adTokens);
+    }
+
+    protected void setGdprApplies() {
+        if (mPersonalInfoManager != null) {
+            addParam(GDPR_APPLIES, mPersonalInfoManager.gdprApplies());
+        }
+    }
+
+    protected void setForceGdprApplies() {
+        if (mConsentData != null) {
+            addParam(FORCE_GDPR_APPLIES, mConsentData.isForceGdprApplies());
+        }
+    }
+
+    protected void setCurrentConsentStatus() {
+        if (mPersonalInfoManager != null) {
+            addParam(CURRENT_CONSENT_STATUS_KEY, mPersonalInfoManager.getPersonalInfoConsentStatus()
+                    .getValue());
+        }
+    }
+
+    protected void setConsentedPrivacyPolicyVersion() {
+        if (mConsentData != null) {
+            addParam(CONSENTED_PRIVACY_POLICY_VERSION_KEY,
+                    mConsentData.getConsentedPrivacyPolicyVersion());
+        }
+    }
+
+    protected void setConsentedVendorListVersion() {
+        if (mConsentData != null) {
+            addParam(CONSENTED_VENDOR_LIST_VERSION_KEY, mConsentData.getConsentedVendorListVersion());
+        }
+    }
+
     protected void addBaseParams(final ClientMetadata clientMetadata) {
         setAdUnitId(mAdUnitId);
 
@@ -233,7 +299,10 @@ protected void addBaseParams(final ClientMetadata clientMetadata) {
 
         setKeywords(mKeywords);
 
-        setLocation(mLocation);
+        if (MoPub.canCollectPersonalInformation()) {
+            setUserDataKeywords(mUserDataKeywords);
+            setLocation(mLocation);
+        }
 
         setTimezone(DateAndTime.getTimeZoneOffsetString());
 
@@ -252,7 +321,19 @@ protected void addBaseParams(final ClientMetadata clientMetadata) {
 
         setAppVersion(clientMetadata.getAppVersion());
 
+        setAdvancedBiddingTokens();
+
         appendAdvertisingInfoTemplates();
+
+        setGdprApplies();
+
+        setForceGdprApplies();
+
+        setCurrentConsentStatus();
+
+        setConsentedPrivacyPolicyVersion();
+
+        setConsentedVendorListVersion();
     }
 
     private void addParam(String key, MoPubNetworkType value) {
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdvancedBiddersInitializedListener.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdvancedBiddersInitializedListener.java
new file mode 100644
index 00000000..6a500f26
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdvancedBiddersInitializedListener.java
@@ -0,0 +1,9 @@
+package com.mopub.common;
+
+import android.support.annotation.NonNull;
+
+import java.util.List;
+
+interface AdvancedBiddersInitializedListener {
+    void onAdvancedBiddersInitialized(@NonNull final List<MoPubAdvancedBidder> advancedBidders);
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdvancedBiddingTokens.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdvancedBiddingTokens.java
new file mode 100644
index 00000000..76481dee
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AdvancedBiddingTokens.java
@@ -0,0 +1,119 @@
+package com.mopub.common;
+
+import android.content.Context;
+import android.os.AsyncTask;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.util.Reflection;
+
+import org.json.JSONException;
+import org.json.JSONObject;
+
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * Gets Advanced Bidders through an Async Task and stores it in memory for retrieval.
+ */
+public class AdvancedBiddingTokens implements AdvancedBiddersInitializedListener {
+
+    private static final String TOKEN_KEY = "token";
+
+    @NonNull private List<MoPubAdvancedBidder> mAdvancedBidders;
+    @Nullable private final SdkInitializationListener mSdkInitializationListener;
+
+    public AdvancedBiddingTokens(@Nullable final SdkInitializationListener sdkInitializationListener) {
+        mAdvancedBidders = new ArrayList<>();
+        mSdkInitializationListener = sdkInitializationListener;
+    }
+
+    public void addAdvancedBidders(
+            @NonNull final List<Class<? extends MoPubAdvancedBidder>> advancedBidderClasses) {
+        Preconditions.checkNotNull(advancedBidderClasses);
+
+        new AdvancedBiddersInitializationAsyncTask(advancedBidderClasses, this).execute();
+    }
+
+    @Nullable
+    String getTokensAsJsonString(@NonNull final Context context) {
+        Preconditions.checkNotNull(context);
+
+        final JSONObject tokens = getTokensAsJsonObject(context);
+        if (tokens == null) {
+            return null;
+        }
+        return tokens.toString();
+    }
+
+    @Nullable
+    private JSONObject getTokensAsJsonObject(@NonNull final Context context) {
+        Preconditions.checkNotNull(context);
+
+        if (mAdvancedBidders.isEmpty()) {
+            return null;
+        }
+
+        final JSONObject jsonObject = new JSONObject();
+        for (final MoPubAdvancedBidder bidder : mAdvancedBidders) {
+            try {
+                final JSONObject bidderJsonObject = new JSONObject();
+                bidderJsonObject.put(TOKEN_KEY, bidder.getToken(context));
+                jsonObject.put(bidder.getCreativeNetworkName(), bidderJsonObject);
+            } catch (JSONException e) {
+                MoPubLog.d("JSON parsing failed for creative network name: " +
+                        bidder.getCreativeNetworkName());
+            }
+        }
+        return jsonObject;
+    }
+
+    @Override
+    public void onAdvancedBiddersInitialized(
+            @NonNull final List<MoPubAdvancedBidder> advancedBidders) {
+        Preconditions.checkNotNull(advancedBidders);
+
+        mAdvancedBidders = advancedBidders;
+
+        if (mSdkInitializationListener != null) {
+            mSdkInitializationListener.onInitializationFinished();
+        }
+    }
+
+    private static class AdvancedBiddersInitializationAsyncTask extends AsyncTask<Void, Void, List<MoPubAdvancedBidder>> {
+
+        @NonNull private final List<Class<? extends MoPubAdvancedBidder>> advancedBidderClasses;
+        @NonNull private final AdvancedBiddersInitializedListener mAdvancedBiddersInitializedListener;
+
+        AdvancedBiddersInitializationAsyncTask(
+                @NonNull List<Class<? extends MoPubAdvancedBidder>> advancedBidderClasses,
+                @NonNull final AdvancedBiddersInitializedListener advancedBiddersInitializedListener) {
+            Preconditions.checkNotNull(advancedBidderClasses);
+            Preconditions.checkNotNull(advancedBiddersInitializedListener);
+
+            this.advancedBidderClasses = advancedBidderClasses;
+            this.mAdvancedBiddersInitializedListener = advancedBiddersInitializedListener;
+        }
+
+        @Override
+        protected List<MoPubAdvancedBidder> doInBackground(final Void... voids) {
+            final List<MoPubAdvancedBidder> advancedBidders = new ArrayList<>();
+            for (final Class<? extends MoPubAdvancedBidder> advancedBidderClass : advancedBidderClasses) {
+                try {
+                    final MoPubAdvancedBidder advancedBidder = Reflection.instantiateClassWithEmptyConstructor(
+                            advancedBidderClass.getName(), MoPubAdvancedBidder.class);
+                    advancedBidders.add(advancedBidder);
+                } catch (Exception e) {
+                    MoPubLog.e("Unable to find class " + advancedBidderClass.getName());
+                }
+            }
+            return advancedBidders;
+        }
+
+        @Override
+        protected void onPostExecute(final List<MoPubAdvancedBidder> advancedBidders) {
+            mAdvancedBiddersInitializedListener.onAdvancedBiddersInitialized(advancedBidders);
+        }
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AvidViewabilitySession.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AvidViewabilitySession.java
index 2a65e249..4583112e 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AvidViewabilitySession.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/AvidViewabilitySession.java
@@ -301,8 +301,8 @@ public Boolean createVideoSession(@NonNull final Activity activity, @NonNull fin
 
     @Override
     @Nullable
-    public Boolean registerVideoObstructions(@NonNull final List<View> views) {
-        Preconditions.checkNotNull(views);
+    public Boolean registerVideoObstruction(@NonNull final View view) {
+        Preconditions.checkNotNull(view);
 
         if (!isEnabled()) {
             return null;
@@ -314,16 +314,12 @@ public Boolean registerVideoObstructions(@NonNull final List<View> views) {
         }
 
         try {
-            for (final View view : views) {
-                if (view != null) {
-                    // Pre-reflection code:
-                    // mAvidVideoAdSession.registerFriendlyObstruction(view);
+            // Pre-reflection code:
+            // mAvidVideoAdSession.registerFriendlyObstruction(view);
 
-                    new Reflection.MethodBuilder(mAvidVideoAdSession, "registerFriendlyObstruction")
-                            .addParam(View.class, view)
-                            .execute();
-                }
-            }
+            new Reflection.MethodBuilder(mAvidVideoAdSession, "registerFriendlyObstruction")
+                    .addParam(View.class, view)
+                    .execute();
 
             return true;
         } catch (Exception e) {
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/BaseUrlGenerator.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/BaseUrlGenerator.java
index 759b528e..45b8b764 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/BaseUrlGenerator.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/BaseUrlGenerator.java
@@ -10,6 +10,57 @@
 
 public abstract class BaseUrlGenerator {
 
+    /**
+     * The ad unit id which identifies a spot for an ad to be placed.
+     */
+    protected static final String AD_UNIT_ID_KEY = "id";
+
+    /**
+     * nv = native version. This is the version of MoPub.
+     */
+    protected static final String SDK_VERSION_KEY = "nv";
+
+    /**
+     * User ifa or mopub-generated identifier.
+     */
+    protected static final String UDID_KEY = "udid";
+
+    /**
+     * "Do not track." Equal to 1 when limit ad tracking is turned on. Equal to 0 otherwise.
+     */
+    protected static final String DNT_KEY = "dnt";
+
+    /**
+     * Bundle ID, as in package name.
+     */
+    protected static final String BUNDLE_ID_KEY = "bundle";
+
+    /**
+     * The current consent state.
+     */
+    protected static final String CURRENT_CONSENT_STATUS_KEY = "current_consent_status";
+
+    /**
+     * The version of the vendor list that has been consented to. Null if no consent given.
+     */
+    protected static final String CONSENTED_VENDOR_LIST_VERSION_KEY = "consented_vendor_list_version";
+
+    /**
+     * The version of the privacy policy that has been consented to. Null if no consent given.
+     */
+    protected static final String CONSENTED_PRIVACY_POLICY_VERSION_KEY = "consented_privacy_policy_version";
+
+    /**
+     * Whether or not GDPR applies to this user. Can be different from whether or not this user is
+     * in a GDPR region.
+     */
+    protected static final String GDPR_APPLIES = "gdpr_applies";
+
+    /**
+     * "1" if the publisher has forced GDPR rules to apply to this app. "0" if this is not set.
+     */
+    protected static final String FORCE_GDPR_APPLIES = "force_gdpr_applies";
+
     private static final String WIDTH_KEY = "w";
     private static final String HEIGHT_KEY = "h";
 
@@ -39,6 +90,17 @@ protected void addParam(String key, String value) {
         mStringBuilder.append(Uri.encode(value));
     }
 
+    protected void addParam(String key, Boolean value) {
+        if (value == null) {
+            return;
+        }
+
+        mStringBuilder.append(getParamDelimiter());
+        mStringBuilder.append(key);
+        mStringBuilder.append("=");
+        mStringBuilder.append(value ? "1" : "0");
+    }
+
     private String getParamDelimiter() {
         if (mFirstParam) {
             mFirstParam = false;
@@ -73,23 +135,13 @@ protected void setDeviceInfo(String... info) {
         addParam("dn", result.toString());
     }
 
-    protected void setDoNotTrack(boolean dnt) {
-        if (dnt) {
-            addParam("dnt", "1");
-        }
-    }
-
-    protected void setUdid(String udid) {
-        addParam("udid", udid);
-    }
-
     /**
      * Appends special keys/values for advertising id and do-not-track. PlayServicesUrlRewriter will
      * replace these templates with the correct values when the request is processed.
      */
     protected void appendAdvertisingInfoTemplates() {
-        addParam("udid", PlayServicesUrlRewriter.UDID_TEMPLATE);
-        addParam("dnt", PlayServicesUrlRewriter.DO_NOT_TRACK_TEMPLATE);
+        addParam(UDID_KEY, PlayServicesUrlRewriter.UDID_TEMPLATE);
+        addParam(DNT_KEY, PlayServicesUrlRewriter.DO_NOT_TRACK_TEMPLATE);
     }
 
     /**
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ClientMetadata.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ClientMetadata.java
index 1317ab36..0cd8abe8 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ClientMetadata.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ClientMetadata.java
@@ -1,6 +1,6 @@
 package com.mopub.common;
 
-import android.content.ContentResolver;
+import android.annotation.SuppressLint;
 import android.content.Context;
 import android.content.pm.ApplicationInfo;
 import android.content.pm.PackageInfo;
@@ -8,16 +8,18 @@
 import android.content.res.Configuration;
 import android.graphics.Point;
 import android.net.ConnectivityManager;
+import android.net.Network;
+import android.net.NetworkCapabilities;
 import android.net.NetworkInfo;
 import android.os.Build;
-import android.provider.Settings;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
 import android.telephony.TelephonyManager;
-import android.text.TextUtils;
 
 import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.privacy.MoPubIdentifier;
 import com.mopub.common.util.DeviceUtils;
 import com.mopub.common.util.Dips;
-import com.mopub.common.util.Utils;
 
 import java.util.Locale;
 
@@ -28,34 +30,34 @@
  * Singleton that caches Client objects so they will be available to background threads.
  */
 public class ClientMetadata {
-    // Network type constant defined after API 9:
-    private static final int TYPE_ETHERNET = 9;
 
     private static final String DEVICE_ORIENTATION_PORTRAIT = "p";
     private static final String DEVICE_ORIENTATION_LANDSCAPE = "l";
     private static final String DEVICE_ORIENTATION_SQUARE = "s";
     private static final String DEVICE_ORIENTATION_UNKNOWN = "u";
-    private static final String IFA_PREFIX = "ifa:";
-    private static final String SHA_PREFIX = "sha:";
-    private static final int UNKNOWN_NETWORK = -1;
-    private static final int MISSING_VALUE = -1;
 
     private String mNetworkOperatorForUrl;
-    private final String mNetworkOperator;
+    private String mNetworkOperator;
     private String mSimOperator;
-    private final String mIsoCountryCode;
-    private final String mSimIsoCountryCode;
+    private String mIsoCountryCode;
+    private String mSimIsoCountryCode;
     private String mNetworkOperatorName;
     private String mSimOperatorName;
-    private String mUdid;
-    private boolean mDoNotTrack = false;
-    private boolean mAdvertisingInfoSet = false;
 
+    @NonNull
+    private final MoPubIdentifier moPubIdentifier;
+
+    /**
+     * MoPubNetworkType - network connection type enumeration
+     */
     public enum MoPubNetworkType {
         UNKNOWN(0),
         ETHERNET(1),
         WIFI(2),
-        MOBILE(3);
+        MOBILE(3),
+        GG(4),      // connected to 2G network
+        GGG(5),     // connected to 3G network
+        GGGG(6);    // connected to 4G network
 
         private final int mId;
         MoPubNetworkType(int id) {
@@ -67,23 +69,6 @@ public String toString() {
             return Integer.toString(mId);
         }
 
-        private static MoPubNetworkType fromAndroidNetworkType(int type) {
-            switch(type) {
-                case TYPE_ETHERNET:
-                    return ETHERNET;
-                case ConnectivityManager.TYPE_WIFI:
-                    return WIFI;
-                case ConnectivityManager.TYPE_MOBILE:
-                case ConnectivityManager.TYPE_MOBILE_DUN:
-                case ConnectivityManager.TYPE_MOBILE_HIPRI:
-                case ConnectivityManager.TYPE_MOBILE_MMS:
-                case ConnectivityManager.TYPE_MOBILE_SUPL:
-                    return MOBILE;
-                default:
-                    return UNKNOWN;
-            }
-        }
-
         public int getId() {
             return mId;
         }
@@ -106,6 +91,7 @@ public int getId() {
     /**
      * Returns the singleton ClientMetadata object, using the context to obtain data if necessary.
      */
+    @NonNull
     public static ClientMetadata getInstance(Context context) {
         // Use a local variable so we can reduce accesses of the volatile field.
         ClientMetadata result = sInstance;
@@ -126,6 +112,7 @@ public static ClientMetadata getInstance(Context context) {
      * ClientMetadata. If the object has never been referenced from a thread with a context,
      * this will return null.
      */
+    @Nullable
     public static ClientMetadata getInstance() {
         ClientMetadata result = sInstance;
         if (result == null) {
@@ -166,48 +153,43 @@ public ClientMetadata(Context context) {
 
         final TelephonyManager telephonyManager =
                 (TelephonyManager) mContext.getSystemService(Context.TELEPHONY_SERVICE);
-        mNetworkOperatorForUrl = telephonyManager.getNetworkOperator();
-        mNetworkOperator = telephonyManager.getNetworkOperator();
-        if (telephonyManager.getPhoneType() == TelephonyManager.PHONE_TYPE_CDMA &&
-                telephonyManager.getSimState() == TelephonyManager.SIM_STATE_READY) {
-            mNetworkOperatorForUrl = telephonyManager.getSimOperator();
-            mSimOperator = telephonyManager.getSimOperator();
-        }
+        if(telephonyManager!=null) {
+            mNetworkOperatorForUrl = telephonyManager.getNetworkOperator();
+            mNetworkOperator = telephonyManager.getNetworkOperator();
+            if (telephonyManager.getPhoneType() == TelephonyManager.PHONE_TYPE_CDMA &&
+                    telephonyManager.getSimState() == TelephonyManager.SIM_STATE_READY) {
+                mNetworkOperatorForUrl = telephonyManager.getSimOperator();
+                mSimOperator = telephonyManager.getSimOperator();
+            }
 
-        mIsoCountryCode = telephonyManager.getNetworkCountryIso();
-        mSimIsoCountryCode = telephonyManager.getSimCountryIso();
-        try {
-            // Some Lenovo devices require READ_PHONE_STATE here.
-            mNetworkOperatorName = telephonyManager.getNetworkOperatorName();
-            if (telephonyManager.getSimState() == TelephonyManager.SIM_STATE_READY) {
-                mSimOperatorName = telephonyManager.getSimOperatorName();
+            if (MoPub.canCollectPersonalInformation()) {
+                mIsoCountryCode = telephonyManager.getNetworkCountryIso();
+                mSimIsoCountryCode = telephonyManager.getSimCountryIso();
+            } else {
+                mIsoCountryCode = "";
+                mSimIsoCountryCode = "";
             }
-        } catch (SecurityException e) {
-            mNetworkOperatorName = null;
-            mSimOperatorName = null;
-        }
 
-        setAmazonAdvertisingInfo();
-        if (!mAdvertisingInfoSet) {
-            // Amazon ad info is not supported on this device, so get the device ID.
-            // This will be replaced later when the Play Services callbacks complete.
-            mUdid = getDeviceIdFromContext(mContext);
+            try {
+                // Some Lenovo devices require READ_PHONE_STATE here.
+                mNetworkOperatorName = telephonyManager.getNetworkOperatorName();
+                if (telephonyManager.getSimState() == TelephonyManager.SIM_STATE_READY) {
+                    mSimOperatorName = telephonyManager.getSimOperatorName();
+                }
+            } catch (SecurityException e) {
+                mNetworkOperatorName = null;
+                mSimOperatorName = null;
+            }
         }
-
+        moPubIdentifier = new MoPubIdentifier(mContext);
     }
 
-    // For Amazon tablets running Fire OS 5.1+ and TV devices running Fire OS 5.2.1.1+, the
-    // advertising info is available as System Settings.
-    // See https://developer.amazon.com/public/solutions/devices/fire-tv/docs/fire-tv-advertising-id
-    @VisibleForTesting
-    protected void setAmazonAdvertisingInfo() {
-        ContentResolver resolver = mContext.getContentResolver();
-        int limitAdTracking = Settings.Secure.getInt(resolver, "limit_ad_tracking", MISSING_VALUE);
-        String advertisingId = Settings.Secure.getString(resolver, "advertising_id");
-
-        if (limitAdTracking != MISSING_VALUE && !TextUtils.isEmpty(advertisingId)) {
-            boolean doNotTrack = limitAdTracking != 0;
-            setAdvertisingInfo(advertisingId, doNotTrack);
+    public void repopulateCountryData() {
+        final TelephonyManager telephonyManager =
+                (TelephonyManager) mContext.getSystemService(Context.TELEPHONY_SERVICE);
+        if (MoPub.canCollectPersonalInformation() && telephonyManager != null) {
+            mIsoCountryCode = telephonyManager.getNetworkCountryIso();
+            mSimIsoCountryCode = telephonyManager.getSimCountryIso();
         }
     }
 
@@ -223,13 +205,6 @@ private static String getAppVersionFromContext(Context context) {
         }
     }
 
-    private static String getDeviceIdFromContext(Context context) {
-        String deviceId = Settings.Secure.getString(context.getContentResolver(),
-                Settings.Secure.ANDROID_ID);
-        deviceId = (deviceId == null) ? "" : Utils.sha1(deviceId);
-        return SHA_PREFIX + deviceId;
-    }
-
     /**
      * @return the display orientation. Useful when generating ad requests.
      */
@@ -246,17 +221,64 @@ public String getOrientationString() {
         return orientation;
     }
 
-
+    @SuppressLint("MissingPermission")
     public MoPubNetworkType getActiveNetworkType() {
-        int networkType = UNKNOWN_NETWORK;
-        if (DeviceUtils.isPermissionGranted(mContext, ACCESS_NETWORK_STATE)) {
-            NetworkInfo activeNetworkInfo = mConnectivityManager.getActiveNetworkInfo();
-            networkType = activeNetworkInfo != null
-                    ? activeNetworkInfo.getType() : UNKNOWN_NETWORK;
+        if (!DeviceUtils.isPermissionGranted(mContext, ACCESS_NETWORK_STATE)) {
+            return MoPubNetworkType.UNKNOWN;
         }
-        return MoPubNetworkType.fromAndroidNetworkType(networkType);
-    }
 
+        NetworkInfo activeNetworkInfo = mConnectivityManager.getActiveNetworkInfo();
+        if (activeNetworkInfo == null || !activeNetworkInfo.isConnected()) {
+            return MoPubNetworkType.UNKNOWN;
+        }
+
+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {
+            if (activeNetworkInfo.getType() == ConnectivityManager.TYPE_ETHERNET) {
+                return MoPubNetworkType.ETHERNET;
+            }
+        } else {
+            Network[] networks = mConnectivityManager.getAllNetworks();
+            for (Network network : networks) {
+                NetworkCapabilities capabilities = mConnectivityManager.getNetworkCapabilities(network);
+                if (capabilities != null && capabilities.hasTransport(NetworkCapabilities.TRANSPORT_ETHERNET))
+                    return MoPubNetworkType.ETHERNET;
+            }
+        }
+
+        NetworkInfo networkInfo = mConnectivityManager.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
+        if (networkInfo != null && networkInfo.isConnected()) {
+            return MoPubNetworkType.WIFI;
+        }
+
+        networkInfo = mConnectivityManager.getNetworkInfo(ConnectivityManager.TYPE_MOBILE);
+        if (networkInfo != null && networkInfo.isConnected()) {
+            int netType = networkInfo.getSubtype();
+            switch (netType) {
+                case TelephonyManager.NETWORK_TYPE_GPRS:
+                case TelephonyManager.NETWORK_TYPE_EDGE:
+                case TelephonyManager.NETWORK_TYPE_CDMA:
+                case TelephonyManager.NETWORK_TYPE_1xRTT:
+                case TelephonyManager.NETWORK_TYPE_IDEN:
+                    return MoPubNetworkType.GG; // 2G
+                case TelephonyManager.NETWORK_TYPE_UMTS:
+                case TelephonyManager.NETWORK_TYPE_EVDO_0:
+                case TelephonyManager.NETWORK_TYPE_EVDO_A:
+                case TelephonyManager.NETWORK_TYPE_HSDPA:
+                case TelephonyManager.NETWORK_TYPE_HSUPA:
+                case TelephonyManager.NETWORK_TYPE_HSPA:
+                case TelephonyManager.NETWORK_TYPE_EVDO_B:
+                case TelephonyManager.NETWORK_TYPE_EHRPD:
+                    return MoPubNetworkType.GGG; // 3G
+                case TelephonyManager.NETWORK_TYPE_HSPAP:
+                case TelephonyManager.NETWORK_TYPE_LTE:
+                    return MoPubNetworkType.GGGG; // 4G
+                default:
+                    return MoPubNetworkType.MOBILE;
+            }
+        }
+
+        return MoPubNetworkType.UNKNOWN;
+    }
 
     /**
      * Get the logical density of the display as in {@link android.util.DisplayMetrics#density}
@@ -294,14 +316,14 @@ public String getSimOperator() {
      * @return the country code of the device.
      */
     public String getIsoCountryCode() {
-        return mIsoCountryCode;
+        return MoPub.canCollectPersonalInformation() ? mIsoCountryCode : "";
     }
 
     /**
      * @return the sim provider's country code.
      */
     public String getSimIsoCountryCode() {
-        return mSimIsoCountryCode;
+        return MoPub.canCollectPersonalInformation() ? mSimIsoCountryCode : "";
     }
 
     /**
@@ -319,28 +341,12 @@ public String getSimOperatorName() {
     }
 
     /**
-     * @return the stored device ID.
-     */
-    public synchronized String getDeviceId() {
-        return mUdid;
-    }
-
-    /**
-     * @return the user's do not track preference. Should be set whenever a getAdInfo() call is
-     *         completed.
+     *
+     * @return class to get Advertising ID and 'do not track' state
      */
-    public synchronized boolean isDoNotTrackSet() {
-        return mDoNotTrack;
-    }
-
-    public synchronized void setAdvertisingInfo(String advertisingId, boolean doNotTrack) {
-        mUdid = IFA_PREFIX + advertisingId;
-        mDoNotTrack = doNotTrack;
-        mAdvertisingInfoSet = true;
-    }
-
-    public synchronized boolean isAdvertisingInfoSet() {
-        return mAdvertisingInfoSet;
+    @NonNull
+    public MoPubIdentifier getMoPubIdentifier() {
+        return moPubIdentifier;
     }
 
     /**
@@ -427,6 +433,21 @@ public String getAppName() {
         return mAppName;
     }
 
+    @NonNull
+    public static String getCurrentLanguage(@NonNull final Context context) {
+        // Use default locale first for language code
+        String languageCode = Locale.getDefault().getLanguage().trim();
+
+        // If user's preferred locale is different from default locale, override language code
+        Locale userLocale = context.getResources().getConfiguration().locale;
+        if (userLocale != null) {
+            if (!userLocale.getLanguage().trim().isEmpty()) {
+                languageCode = userLocale.getLanguage().trim();
+            }
+        }
+        return languageCode;
+    }
+
     @Deprecated
     @VisibleForTesting
     public static void setInstance(ClientMetadata clientMetadata) {
@@ -435,6 +456,7 @@ public static void setInstance(ClientMetadata clientMetadata) {
         }
     }
 
+    @Deprecated
     @VisibleForTesting
     public static void clearForTesting() {
         sInstance = null;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/CloseableLayout.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/CloseableLayout.java
index 24111e03..aca01406 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/CloseableLayout.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/CloseableLayout.java
@@ -6,6 +6,7 @@
 import android.graphics.drawable.StateListDrawable;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
+import android.util.AttributeSet;
 import android.view.Gravity;
 import android.view.MotionEvent;
 import android.view.SoundEffectConstants;
@@ -99,8 +100,14 @@ int getGravity() {
     private UnsetPressedState mUnsetPressedState;
 
     public CloseableLayout(@NonNull Context context) {
-        super(context);
+        this(context, null, 0);
+    }
+    public CloseableLayout(@NonNull Context context, @Nullable AttributeSet attrs) {
+        this(context, attrs, 0);
+    }
 
+    public CloseableLayout(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
+        super(context, attrs, defStyleAttr);
         mCloseDrawable = new StateListDrawable();
         mClosePosition = ClosePosition.TOP_RIGHT;
 
@@ -122,6 +129,7 @@ public CloseableLayout(@NonNull Context context) {
         mCloseAlwaysInteractable = true;
     }
 
+
     public void setOnCloseListener(@Nullable OnCloseListener onCloseListener) {
         mOnCloseListener = onCloseListener;
     }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/CompositeSdkInitializationListener.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/CompositeSdkInitializationListener.java
new file mode 100644
index 00000000..7fc40db1
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/CompositeSdkInitializationListener.java
@@ -0,0 +1,43 @@
+package com.mopub.common;
+
+import android.os.Handler;
+import android.os.Looper;
+import android.support.annotation.NonNull;
+
+
+/**
+ * Aggregates sdk initialization listeners so that the listener only fires once everything is done.
+ */
+class CompositeSdkInitializationListener implements SdkInitializationListener {
+
+    @NonNull private final SdkInitializationListener mSdkInitializationListener;
+    private int mTimes;
+
+    /**
+     * Don't fire onInitializationFinished until the requisite number of times of
+     * onInitializationFinished has been called.
+     *
+     * @param sdkInitializationListener The original listener.
+     * @param times                     Number of times to expect onInitializationFinished() to be called.
+     */
+    public CompositeSdkInitializationListener(
+            @NonNull final SdkInitializationListener sdkInitializationListener, int times) {
+        Preconditions.checkNotNull(sdkInitializationListener);
+
+        mSdkInitializationListener = sdkInitializationListener;
+        mTimes = times;
+    }
+
+    @Override
+    public void onInitializationFinished() {
+        mTimes--;
+        if (mTimes <= 0) {
+            new Handler(Looper.getMainLooper()).post(new Runnable() {
+                @Override
+                public void run() {
+                    mSdkInitializationListener.onInitializationFinished();
+                }
+            });
+        }
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/Constants.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/Constants.java
index c0d2d12b..8303f908 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/Constants.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/Constants.java
@@ -13,6 +13,8 @@ private Constants() {}
     public static final String AD_HANDLER = "/m/ad";
     public static final String CONVERSION_TRACKING_HANDLER = "/m/open";
     public static final String POSITIONING_HANDLER = "/m/pos";
+    public static final String GDPR_SYNC_HANDLER = "/m/gdpr_sync";
+    public static final String GDPR_CONSENT_HANDLER = "/m/gdpr_consent_dialog";
 
 
     public static final int TEN_SECONDS_MILLIS = 10 * 1000;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/DataKeys.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/DataKeys.java
index 1de41b77..a841110b 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/DataKeys.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/DataKeys.java
@@ -20,6 +20,7 @@
     // Banner imp tracking fields
     public static final String BANNER_IMPRESSION_MIN_VISIBLE_DIPS = "Banner-Impression-Min-Pixels";
     public static final String BANNER_IMPRESSION_MIN_VISIBLE_MS = "Banner-Impression-Min-Ms";
+    public static final String BANNER_IMPRESSION_PIXEL_COUNT_ENABLED = "Banner-Impression-Pixel-Count-Enabled";
 
     // Native fields
     public static final String IMPRESSION_MIN_VISIBLE_PERCENT = "Impression-Min-Visible-Percent";
@@ -30,7 +31,6 @@
     public static final String PLAY_VISIBLE_PERCENT = "Play-Visible-Percent";
     public static final String PAUSE_VISIBLE_PERCENT = "Pause-Visible-Percent";
     public static final String MAX_BUFFER_MS = "Max-Buffer-Ms";
-    public static final String EVENT_DETAILS = "Event-Details";
 
     // Rewarded Ad fields
     public static final String REWARDED_AD_CURRENCY_NAME_KEY = "Rewarded-Ad-Currency-Name";
@@ -42,6 +42,9 @@
     // Viewability fields
     public static final String EXTERNAL_VIDEO_VIEWABILITY_TRACKERS_KEY = "External-Video-Viewability-Trackers";
 
+    // Advanced bidding fields
+    public static final String ADM_KEY = "Adm";
+
     /**
      * @deprecated as of 4.12, replaced by {@link #REWARDED_AD_CUSTOMER_ID_KEY}
      */
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/DownloadResponse.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/DownloadResponse.java
deleted file mode 100644
index 6ce126e8..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/DownloadResponse.java
+++ /dev/null
@@ -1,59 +0,0 @@
-package com.mopub.common;
-
-import com.mopub.common.util.ResponseHeader;
-import com.mopub.common.util.Streams;
-
-import org.apache.http.Header;
-import org.apache.http.HttpEntity;
-import org.apache.http.HttpResponse;
-
-import java.io.BufferedInputStream;
-import java.io.ByteArrayOutputStream;
-
-public class DownloadResponse {
-    private byte[] mBytes = new byte[0];
-    private final int mStatusCode;
-    private final long mContentLength;
-    private final Header[] mHeaders;
-
-    public DownloadResponse(final HttpResponse httpResponse) throws Exception {
-        final ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
-        BufferedInputStream inputStream = null;
-        try {
-            HttpEntity httpEntity = httpResponse.getEntity();
-            if (httpEntity != null) {
-                inputStream = new BufferedInputStream(httpEntity.getContent());
-                Streams.copyContent(inputStream, outputStream);
-                mBytes = outputStream.toByteArray();
-            }
-        } finally {
-            Streams.closeStream(inputStream);
-            Streams.closeStream(outputStream);
-        }
-
-        mStatusCode = httpResponse.getStatusLine().getStatusCode();
-        mContentLength = mBytes.length;
-        mHeaders = httpResponse.getAllHeaders();
-    }
-
-    public byte[] getByteArray() {
-        return mBytes;
-    }
-
-    public int getStatusCode() {
-        return mStatusCode;
-    }
-
-    public long getContentLength() {
-        return mContentLength;
-    }
-
-    public String getFirstHeader(final ResponseHeader responseHeader) {
-        for (final Header header : mHeaders) {
-            if (header.getName().equalsIgnoreCase(responseHeader.getKey())) {
-                return header.getValue();
-            }
-        }
-        return null;
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySession.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySession.java
index 258836f5..36423f9e 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySession.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySession.java
@@ -36,7 +36,7 @@
     @Nullable Boolean createVideoSession(@NonNull final Activity activity, @NonNull final View view,
             @NonNull final Set<String> buyerResources,
             @NonNull final Map<String, String> videoViewabilityTrackers);
-    @Nullable Boolean registerVideoObstructions(@NonNull final List<View> views);
+    @Nullable Boolean registerVideoObstruction(@NonNull final View view);
     @Nullable Boolean onVideoPrepared(@NonNull final View playerView, final int duration);
     @Nullable Boolean recordVideoEvent(@NonNull final VideoEvent event, final int playheadMillis);
     @Nullable Boolean endVideoSession();
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySessionManager.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySessionManager.java
index 439a96d3..cf24e521 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySessionManager.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/ExternalViewabilitySessionManager.java
@@ -11,7 +11,6 @@
 import com.mopub.mobileads.VastVideoConfig;
 
 import java.util.HashSet;
-import java.util.List;
 import java.util.Locale;
 import java.util.Set;
 
@@ -194,13 +193,13 @@ public void createVideoSession(@NonNull final Activity activity, @NonNull final
     /**
      * Prevents friendly obstructions from affecting viewability scores.
      *
-     * @param views Views in the same Window and a higher z-index as the video playing.
+     * @param view View in the same Window and a higher z-index as the video playing.
      */
-    public void registerVideoObstructions(@NonNull final List<View> views) {
-        Preconditions.checkNotNull(views);
+    public void registerVideoObstruction(@NonNull View view) {
+        Preconditions.checkNotNull(view);
 
         for (final ExternalViewabilitySession session : mViewabilitySessions) {
-            final Boolean successful = session.registerVideoObstructions(views);
+            final Boolean successful = session.registerVideoObstruction(view);
             logEvent(session, "register friendly obstruction", successful, true);
         }
     }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/GpsHelper.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/GpsHelper.java
index 5773b410..41e1c558 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/GpsHelper.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/GpsHelper.java
@@ -15,6 +15,7 @@
 
 public class GpsHelper {
     static public final int GOOGLE_PLAY_SUCCESS_CODE = 0;
+    static public final int SERVICE_VERSION_UPDATE_REQUIRED = 2;
     static public final String ADVERTISING_ID_KEY = "advertisingId";
     static public final String IS_LIMIT_AD_TRACKING_ENABLED_KEY = "isLimitAdTrackingEnabled";
     private static String sPlayServicesUtilClassName = "com.google.android.gms.common.GooglePlayServicesUtil";
@@ -42,7 +43,8 @@ public static boolean isPlayServicesAvailable(final Context context) {
 
             Object result = methodBuilder.execute();
 
-            return (result != null && (Integer) result == GOOGLE_PLAY_SUCCESS_CODE);
+            Integer intResult = (Integer) result;
+            return (intResult != null && (intResult == GOOGLE_PLAY_SUCCESS_CODE || intResult == SERVICE_VERSION_UPDATE_REQUIRED));
         } catch (Exception exception) {
             return false;
         }
@@ -58,18 +60,15 @@ static public boolean isLimitAdTrackingEnabled(Context context) {
         }
     }
 
-    static boolean isClientMetadataPopulated(final Context context) {
-        return ClientMetadata.getInstance(context).isAdvertisingInfoSet();
-    }
-
     static public void fetchAdvertisingInfoAsync(final Context context, final GpsHelperListener gpsHelperListener) {
         // This method guarantees that the Google Play Services (GPS) advertising info will
         // be populated if GPS is available and the ad info is not already cached
         // The above will happen before the callback is run
         boolean playServicesIsAvailable = isPlayServicesAvailable(context);
-        if (playServicesIsAvailable && !isClientMetadataPopulated(context)) {
+        if (playServicesIsAvailable ) {
             internalFetchAdvertisingInfoAsync(context, gpsHelperListener);
-        } else {
+        }
+        else {
             if (gpsHelperListener != null) {
                 gpsHelperListener.onFetchAdInfoCompleted();
             }
@@ -125,7 +124,7 @@ static private void internalFetchAdvertisingInfoAsync(final Context context, fin
     static private class FetchAdvertisingInfoTask extends AsyncTask<Void, Void, Void> {
         private WeakReference<Context> mContextWeakReference;
         private WeakReference<GpsHelperListener> mGpsHelperListenerWeakReference;
-
+        private AdvertisingInfo info;
         public FetchAdvertisingInfoTask(Context context, GpsHelperListener gpsHelperListener) {
             mContextWeakReference = new WeakReference<Context>(context);
             mGpsHelperListenerWeakReference = new WeakReference<GpsHelperListener>(gpsHelperListener);
@@ -146,7 +145,7 @@ protected Void doInBackground(Void... voids) {
                 Object adInfo = methodBuilder.execute();
 
                 if (adInfo != null) {
-                    updateClientMetadata(context, adInfo);
+                    // updateClientMetadata(context, adInfo);
                 }
             } catch (Exception exception) {
                 MoPubLog.d("Unable to obtain Google AdvertisingIdClient.Info via reflection.");
@@ -164,19 +163,6 @@ protected void onPostExecute(Void aVoid) {
         }
     }
 
-    static void updateClientMetadata(final Context context, final Object adInfo) {
-        String advertisingId = reflectedGetAdvertisingId(adInfo, null);
-        boolean isLimitAdTrackingEnabled = reflectedIsLimitAdTrackingEnabled(adInfo, false);
-
-        /*
-         * Committing using the editor is atomic; a single editor must always commit
-         * to ensure that the state of the GPS variables are in sync.
-         */
-
-        ClientMetadata clientMetadata = ClientMetadata.getInstance(context);
-        clientMetadata.setAdvertisingInfo(advertisingId, isLimitAdTrackingEnabled);
-    }
-
     static String reflectedGetAdvertisingId(final Object adInfo, final String defaultValue) {
         try {
             return (String) MethodBuilderFactory.create(adInfo, "getId").execute();
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/HttpResponses.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/HttpResponses.java
deleted file mode 100644
index 457a69fb..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/HttpResponses.java
+++ /dev/null
@@ -1,49 +0,0 @@
-package com.mopub.common;
-
-import android.graphics.Bitmap;
-
-import org.json.JSONObject;
-import org.json.JSONTokener;
-
-import static android.graphics.BitmapFactory.decodeByteArray;
-
-public final class HttpResponses {
-
-    private HttpResponses() {}
-
-    public static Bitmap asBitmap(final DownloadResponse downloadResponse) {
-        if (downloadResponse == null) {
-            return null;
-        }
-
-        final byte[] bytes = downloadResponse.getByteArray();
-        return decodeByteArray(bytes, 0, bytes.length);
-    }
-
-    public static JSONObject asJsonObject(final DownloadResponse downloadResponse) {
-        if (downloadResponse == null) {
-            return null;
-        }
-
-        try {
-            final String responseString = asResponseString(downloadResponse);
-
-            final JSONTokener tokener = new JSONTokener(responseString);
-            return new JSONObject(tokener);
-        } catch (Exception e) {
-            return null;
-        }
-    }
-
-    public static String asResponseString(final DownloadResponse downloadResponse) {
-        if (downloadResponse == null) {
-            return null;
-        }
-
-        try {
-            return new String(downloadResponse.getByteArray(), "UTF-8");
-        } catch (Exception e) {
-            return null;
-        }
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/LocationService.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/LocationService.java
index 8e6e5471..92270c72 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/LocationService.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/LocationService.java
@@ -115,6 +115,11 @@ private boolean hasRequiredPermissions(@NonNull final Context context) {
     public static Location getLastKnownLocation(@NonNull final Context context,
             final int locationPrecision,
             final @NonNull MoPub.LocationAwareness locationAwareness) {
+
+        if (!MoPub.canCollectPersonalInformation()) {
+            return null;
+        }
+
         Preconditions.checkNotNull(context);
         Preconditions.checkNotNull(locationAwareness);
 
@@ -149,6 +154,10 @@ static Location getLocationFromProvider(@NonNull final Context context,
         Preconditions.checkNotNull(context);
         Preconditions.checkNotNull(provider);
 
+        if (!MoPub.canCollectPersonalInformation()) {
+            return null;
+        }
+
         if (!provider.hasRequiredPermissions(context)) {
             return null;
         }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPub.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPub.java
index e4b96b6e..bf9f691f 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPub.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPub.java
@@ -1,10 +1,13 @@
 package com.mopub.common;
 
 import android.app.Activity;
+import android.content.Context;
+import android.os.Looper;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 
 import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.util.Reflection;
 
 import java.lang.reflect.InvocationTargetException;
@@ -13,7 +16,7 @@
 import static com.mopub.common.ExternalViewabilitySessionManager.ViewabilityVendor;
 
 public class MoPub {
-    public static final String SDK_VERSION = "4.19.0";
+    public static final String SDK_VERSION = "5.2.0";
 
     public enum LocationAwareness { NORMAL, TRUNCATED, DISABLED }
 
@@ -52,10 +55,6 @@ public static BrowserAgent fromHeader(@Nullable final Integer browserAgent) {
             "com.mopub.mobileads.MoPubRewardedVideos";
     private static final String MOPUB_REWARDED_VIDEO_MANAGER =
             "com.mopub.mobileads.MoPubRewardedVideoManager";
-    private static final String MOPUB_REWARDED_VIDEO_LISTENER =
-            "com.mopub.mobileads.MoPubRewardedVideoListener";
-    private static final String MOPUB_REWARDED_VIDEO_MANAGER_REQUEST_PARAMETERS =
-            "com.mopub.mobileads.MoPubRewardedVideoManager$RequestParameters";
 
     private static final int DEFAULT_LOCATION_PRECISION = 6;
     private static final long DEFAULT_LOCATION_REFRESH_TIME_MILLIS = 60 * 1000;
@@ -67,6 +66,11 @@ public static BrowserAgent fromHeader(@Nullable final Integer browserAgent) {
     private static volatile boolean sIsBrowserAgentOverriddenByClient = false;
     private static boolean sSearchedForUpdateActivityMethod = false;
     @Nullable private static Method sUpdateActivityMethod;
+    private static boolean sAdvancedBiddingEnabled = true;
+    private static boolean sSdkInitialized = false;
+    private static boolean sSdkInitializing = false;
+    private static AdvancedBiddingTokens sAdvancedBiddingTokens;
+    private static PersonalInfoManager sPersonalInfoManager;
 
     @NonNull
     public static LocationAwareness getLocationAwareness() {
@@ -127,6 +131,113 @@ public static BrowserAgent getBrowserAgent() {
         return sBrowserAgent;
     }
 
+    public static void setAdvancedBiddingEnabled(final boolean advancedBiddingEnabled) {
+        sAdvancedBiddingEnabled = advancedBiddingEnabled;
+    }
+
+    public static boolean isAdvancedBiddingEnabled() {
+        return sAdvancedBiddingEnabled;
+    }
+
+    /**
+     * Initializes the MoPub SDK. Call this before making any rewarded ads or advanced bidding
+     * requests. This will do the rewarded video custom event initialization any number of times,
+     * but the SDK itself can only be initialized once, and the rewarded ads module can only be
+     * initialized once.
+     *
+     * @param context                   Recommended to be an activity context.
+     *                                  Rewarded ads initialization requires an Activity.
+     * @param sdkConfiguration          Configuration data to initialize the SDK.
+     * @param sdkInitializationListener Callback for when SDK initialization finishes.
+     */
+    public static void initializeSdk(@NonNull final Context context,
+            @NonNull final SdkConfiguration sdkConfiguration,
+            @Nullable final SdkInitializationListener sdkInitializationListener) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(sdkConfiguration);
+
+        // This also initializes MoPubLog
+        MoPubLog.d("Initializing MoPub with ad unit: " + sdkConfiguration.getAdUnitId());
+
+        if (context instanceof Activity && Reflection.classFound(MOPUB_REWARDED_VIDEO_MANAGER)) {
+            final Activity activity = (Activity) context;
+            initializeRewardedVideo(activity, sdkConfiguration);
+        }
+
+        if (sSdkInitialized) {
+            MoPubLog.d("MoPub SDK is already initialized");
+            return;
+        }
+        if (sSdkInitializing) {
+            MoPubLog.d("MoPub SDK is currently initializing.");
+            return;
+        }
+
+        if (Looper.getMainLooper() != Looper.myLooper()) {
+            MoPubLog.e("MoPub can only be initialized on the main thread.");
+            return;
+        }
+
+        sSdkInitializing = true;
+
+        final SdkInitializationListener internalSdkInitializationListener = new SdkInitializationListener() {
+            @Override
+            public void onInitializationFinished() {
+                sSdkInitializing = false;
+                sSdkInitialized = true;
+                if (sdkInitializationListener != null) {
+                    sdkInitializationListener.onInitializationFinished();
+                }
+            }
+        };
+        final SdkInitializationListener compositeSdkInitializationListener =
+                new CompositeSdkInitializationListener(internalSdkInitializationListener, 2);
+
+        sPersonalInfoManager = new PersonalInfoManager(context, sdkConfiguration.getAdUnitId(),
+                compositeSdkInitializationListener);
+
+        ClientMetadata.getInstance(context);
+
+        sAdvancedBiddingTokens = new AdvancedBiddingTokens(compositeSdkInitializationListener);
+        sAdvancedBiddingTokens.addAdvancedBidders(sdkConfiguration.getAdvancedBidders());
+    }
+
+    /**
+     * @return true if SDK is initialized.
+     */
+    public static boolean isSdkInitialized() {
+        return sSdkInitialized;
+    }
+
+    /**
+     * Check this to see if you are allowed to collect personal user data.
+     *
+     * @return True if allowed, false otherwise.
+     */
+    public static boolean canCollectPersonalInformation() {
+        return sPersonalInfoManager != null && sPersonalInfoManager.canCollectPersonalInformation();
+    }
+
+    @Nullable
+    static String getAdvancedBiddingTokensJson(@NonNull final Context context) {
+        Preconditions.checkNotNull(context);
+
+        if (!isAdvancedBiddingEnabled() || sAdvancedBiddingTokens == null) {
+            return null;
+        }
+        return sAdvancedBiddingTokens.getTokensAsJsonString(context);
+    }
+
+    /**
+     * Gets the consent manager for handling user data.
+     *
+     * @return A PersonalInfoManager that handles consent management.
+     */
+    @Nullable
+    public static PersonalInfoManager getPersonalInformationManager() {
+        return sPersonalInfoManager;
+    }
+
     @VisibleForTesting
     static boolean isBrowserAgentOverriddenByClient() {
         return sIsBrowserAgentOverriddenByClient;
@@ -183,24 +294,16 @@ public static void disableViewability(@NonNull final ViewabilityVendor vendor) {
         vendor.disable();
     }
 
-    ////////// MoPub RewardedVideoControl methods //////////
-    // These methods have been deprecated as of release 4.9 due to SDK modularization. MoPub is
-    // inside of the base module while MoPubRewardedVideos is inside of the rewarded video module.
-    // MoPubRewardedVideos methods must now be called with reflection because the publisher
-    // may have excluded the rewarded video module.
+    private static void initializeRewardedVideo(@NonNull Activity activity, @NonNull SdkConfiguration sdkConfiguration) {
+        Preconditions.checkNotNull(activity);
+        Preconditions.checkNotNull(sdkConfiguration);
 
-
-    /**
-     * @deprecated As of release 4.9, use MoPubRewardedVideos#initializeRewardedVideo instead
-     */
-    @Deprecated
-    public static void initializeRewardedVideo(@NonNull Activity activity, MediationSettings... mediationSettings) {
         try {
             new Reflection.MethodBuilder(null, "initializeRewardedVideo")
                     .setStatic(Class.forName(MOPUB_REWARDED_VIDEOS))
+                    .setAccessible()
                     .addParam(Activity.class, activity)
-                    .addParam(MediationSettings[].class, mediationSettings)
-                    .execute();
+                    .addParam(SdkConfiguration.class, sdkConfiguration).execute();
         } catch (ClassNotFoundException e) {
             MoPubLog.w("initializeRewardedVideo was called without the rewarded video module");
         } catch (NoSuchMethodException e) {
@@ -239,97 +342,17 @@ static void updateActivity(@NonNull Activity activity) {
         }
     }
 
-    /**
-     * @deprecated As of release 4.9, use MoPubRewardedVideos#setRewardedVideoListener instead
-     */
     @Deprecated
-    public static void setRewardedVideoListener(@Nullable Object listener) {
-        try {
-            Class moPubRewardedVideoListenerClass = Class.forName(
-                    MOPUB_REWARDED_VIDEO_LISTENER);
-            new Reflection.MethodBuilder(null, "setRewardedVideoListener")
-                    .setStatic(Class.forName(MOPUB_REWARDED_VIDEOS))
-                    .addParam(moPubRewardedVideoListenerClass, listener)
-                    .execute();
-        } catch (ClassNotFoundException e) {
-            MoPubLog.w("setRewardedVideoListener was called without the rewarded video module");
-        } catch (NoSuchMethodException e) {
-            MoPubLog.w("setRewardedVideoListener was called without the rewarded video module");
-        } catch (Exception e) {
-            MoPubLog.e("Error while setting rewarded video listener", e);
-        }
-    }
-
-    /**
-     * @deprecated As of release 4.9, use MoPubRewardedVideos#loadRewardedVideo instead
-     */
-    @Deprecated
-    public static void loadRewardedVideo(@NonNull String adUnitId,
-            @Nullable MediationSettings... mediationSettings) {
-        MoPub.loadRewardedVideo(adUnitId, null, mediationSettings);
-    }
-
-    /**
-     * @deprecated As of release 4.9, use MoPubRewardedVideos#loadRewardedVideo instead
-     */
-    @Deprecated
-    public static void loadRewardedVideo(@NonNull String adUnitId,
-            @Nullable Object requestParameters,
-            @Nullable MediationSettings... mediationSettings) {
-        try {
-            Class requestParametersClass = Class.forName(
-                    MOPUB_REWARDED_VIDEO_MANAGER_REQUEST_PARAMETERS);
-            new Reflection.MethodBuilder(null, "loadRewardedVideo")
-                    .setStatic(Class.forName(MOPUB_REWARDED_VIDEOS))
-                    .addParam(String.class, adUnitId)
-                    .addParam(requestParametersClass, requestParameters)
-                    .addParam(MediationSettings[].class, mediationSettings)
-                    .execute();
-        } catch (ClassNotFoundException e) {
-            MoPubLog.w("loadRewardedVideo was called without the rewarded video module");
-        } catch (NoSuchMethodException e) {
-            MoPubLog.w("loadRewardedVideo was called without the rewarded video module");
-        } catch (Exception e) {
-            MoPubLog.e("Error while loading rewarded video", e);
-        }
-    }
-
-    /**
-     * @deprecated As of release 4.9, use MoPubRewardedVideos#hasRewardedVideo instead
-     */
-    @Deprecated
-    public static boolean hasRewardedVideo(@NonNull String adUnitId) {
-        try {
-            return (boolean) new Reflection.MethodBuilder(null, "hasRewardedVideo")
-                    .setStatic(Class.forName(MOPUB_REWARDED_VIDEOS))
-                    .addParam(String.class, adUnitId)
-                    .execute();
-        } catch (ClassNotFoundException e) {
-            MoPubLog.w("hasRewardedVideo was called without the rewarded video module");
-        } catch (NoSuchMethodException e) {
-            MoPubLog.w("hasRewardedVideo was called without the rewarded video module");
-        } catch (Exception e) {
-            MoPubLog.e("Error while checking rewarded video", e);
-        }
-        return false;
+    @VisibleForTesting
+    static void clearAdvancedBidders() {
+        sAdvancedBiddingTokens = null;
+        sPersonalInfoManager = null;
+        sSdkInitialized = false;
     }
 
-    /**
-     * @deprecated As of release 4.9, use MoPubRewardedVideos#showRewardedVideo instead
-     */
     @Deprecated
-    public static void showRewardedVideo(@NonNull String adUnitId) {
-        try {
-            new Reflection.MethodBuilder(null, "showRewardedVideo")
-                    .setStatic(Class.forName(MOPUB_REWARDED_VIDEOS))
-                    .addParam(String.class, adUnitId)
-                    .execute();
-        } catch (ClassNotFoundException e) {
-            MoPubLog.w("showRewardedVideo was called without the rewarded video module");
-        } catch (NoSuchMethodException e) {
-            MoPubLog.w("showRewardedVideo was called without the rewarded video module");
-        } catch (Exception e) {
-            MoPubLog.e("Error while showing rewarded video", e);
-        }
+    @VisibleForTesting
+    static void setPersonalInfoManager(@Nullable final PersonalInfoManager personalInfoManager) {
+        sPersonalInfoManager = personalInfoManager;
     }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubAdvancedBidder.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubAdvancedBidder.java
new file mode 100644
index 00000000..d41f46f9
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubAdvancedBidder.java
@@ -0,0 +1,11 @@
+package com.mopub.common;
+
+import android.content.Context;
+
+/**
+ * Interface for all advanced bidders.
+ */
+public interface MoPubAdvancedBidder {
+    public String getToken(Context context);
+    public String getCreativeNetworkName();
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubAdvancedBidderData.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubAdvancedBidderData.java
new file mode 100644
index 00000000..b1ec19e5
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubAdvancedBidderData.java
@@ -0,0 +1,39 @@
+package com.mopub.common;
+
+import android.support.annotation.NonNull;
+
+import com.mopub.common.logging.MoPubLog;
+
+import org.json.JSONException;
+import org.json.JSONObject;
+
+/**
+ * Data object holding advanced bidding data.
+ * {"[mCreativeNetworkName]" : {"token" : "[mToken]"}}
+ */
+public class MoPubAdvancedBidderData {
+    private static final String TOKEN_KEY = "token";
+
+    @NonNull final String mToken;
+    @NonNull final String mCreativeNetworkName;
+
+    public MoPubAdvancedBidderData(@NonNull final String token,
+            @NonNull final String creativeNetworkName) {
+        Preconditions.checkNotNull(token);
+        Preconditions.checkNotNull(creativeNetworkName);
+
+        mToken = token;
+        mCreativeNetworkName = creativeNetworkName;
+    }
+
+    @NonNull
+    public JSONObject toJson(){
+        JSONObject jsonObject = new JSONObject();
+        try {
+            jsonObject.put(TOKEN_KEY, mToken);
+        } catch (JSONException e) {
+            MoPubLog.e("Invalid token format: " + mToken);
+        }
+        return jsonObject;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubBrowser.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubBrowser.java
index c60702bf..26ef3318 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubBrowser.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubBrowser.java
@@ -3,6 +3,7 @@
 import android.app.Activity;
 import android.graphics.Color;
 import android.graphics.drawable.Drawable;
+import android.os.Build;
 import android.os.Bundle;
 import android.support.annotation.NonNull;
 import android.view.Gravity;
@@ -17,16 +18,11 @@
 import android.widget.LinearLayout;
 import android.widget.RelativeLayout;
 
-import com.mopub.common.event.Event;
-import com.mopub.common.event.MoPubEvents;
 import com.mopub.mobileads.BaseWebView;
 import com.mopub.mobileads.util.WebViews;
 
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
 import static android.view.ViewGroup.LayoutParams.WRAP_CONTENT;
-import static com.mopub.common.event.BaseEvent.Category;
-import static com.mopub.common.event.BaseEvent.Name;
-import static com.mopub.common.event.BaseEvent.SamplingRate;
 import static com.mopub.common.util.Drawables.BACKGROUND;
 import static com.mopub.common.util.Drawables.CLOSE;
 import static com.mopub.common.util.Drawables.REFRESH;
@@ -45,8 +41,7 @@
     private ImageButton mRefreshButton;
     private ImageButton mCloseButton;
 
-    private DoubleTimeTracker dwellTimeTracker;
-    private String mDspCreativeId;
+    private boolean mProgressBarAvailable;
 
     @NonNull
     public ImageButton getBackButton() {
@@ -79,13 +74,13 @@ public void onCreate(Bundle savedInstanceState) {
 
         setResult(Activity.RESULT_OK);
 
-        getWindow().requestFeature(Window.FEATURE_PROGRESS);
-        getWindow().setFeatureInt(Window.FEATURE_PROGRESS, Window.PROGRESS_VISIBILITY_ON);
+        mProgressBarAvailable = getWindow().requestFeature(Window.FEATURE_PROGRESS);
+        if (mProgressBarAvailable) {
+            getWindow().setFeatureInt(Window.FEATURE_PROGRESS, Window.PROGRESS_VISIBILITY_ON);
+        }
 
         setContentView(getMoPubBrowserView());
 
-        dwellTimeTracker = new DoubleTimeTracker();
-
         initializeWebView();
         initializeButtons();
         enableCookies();
@@ -96,7 +91,7 @@ private void initializeWebView() {
 
         webSettings.setJavaScriptEnabled(true);
 
-        /**
+        /*
          * Pinch to zoom is apparently not enabled by default on all devices, so
          * declare zoom support explicitly.
          * https://stackoverflow.com/questions/5125851/enable-disable-zoom-in-android-webview
@@ -105,21 +100,9 @@ private void initializeWebView() {
         webSettings.setBuiltInZoomControls(true);
         webSettings.setUseWideViewPort(true);
 
-        mDspCreativeId = getIntent().getStringExtra(DSP_CREATIVE_ID);
-
         mWebView.loadUrl(getIntent().getStringExtra(DESTINATION_URL_KEY));
 
         mWebView.setWebViewClient(new BrowserWebViewClient(this));
-
-        mWebView.setWebChromeClient(new WebChromeClient() {
-            public void onProgressChanged(WebView webView, int progress) {
-                setTitle("Loading...");
-                setProgress(progress * 100);
-                if (progress == 100) {
-                    setTitle(webView.getUrl());
-                }
-            }
-        });
     }
 
     private void initializeButtons() {
@@ -165,18 +148,29 @@ private void enableCookies() {
     protected void onPause() {
         super.onPause();
         CookieSyncManager.getInstance().stopSync();
+        mWebView.setWebChromeClient(null);
         WebViews.onPause(mWebView, isFinishing());
-        // Pause dwell time counting.
-        dwellTimeTracker.pause();
     }
 
     @Override
     protected void onResume() {
         super.onResume();
         CookieSyncManager.getInstance().startSync();
-        mWebView.onResume();
+        mWebView.setWebChromeClient(new WebChromeClient() {
+            public void onProgressChanged(WebView webView, int progress) {
+                if (progress == 100) {
+                    setTitle(webView.getUrl());
+                } else {
+                    setTitle("Loading...");
+                }
 
-        dwellTimeTracker.start();
+                if (mProgressBarAvailable && Build.VERSION.SDK_INT < Build.VERSION_CODES.N) {
+                    setProgress(progress * 100);
+                }
+            }
+        });
+
+        mWebView.onResume();
     }
 
     @Override
@@ -193,13 +187,6 @@ protected void onDestroy() {
         super.onDestroy();
         mWebView.destroy();
         mWebView = null;
-        // Log dwell time value.
-        MoPubEvents.log(new Event.Builder(Name.AD_DWELL_TIME,
-                Category.AD_INTERACTIONS,
-                SamplingRate.AD_INTERACTIONS.getSamplingRate())
-                .withDspCreativeId(mDspCreativeId)
-                .withPerformanceDurationMs(dwellTimeTracker.getInterval())
-                .build());
     }
 
     @SuppressWarnings("ResourceType") // Using XML resources causes issues in Unity
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubLifecycleManager.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubLifecycleManager.java
index 8d7a4e86..b57e1429 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubLifecycleManager.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoPubLifecycleManager.java
@@ -4,6 +4,8 @@
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 
+import com.mopub.common.privacy.PersonalInfoManager;
+
 import java.lang.ref.WeakReference;
 import java.util.HashSet;
 import java.util.Set;
@@ -72,6 +74,11 @@ public void onPause(@NonNull final Activity activity) {
 
     @Override
     public void onResume(@NonNull final Activity activity) {
+        final PersonalInfoManager personalInfoManager = MoPub.getPersonalInformationManager();
+        if (personalInfoManager != null) {
+            personalInfoManager.requestSync(false);
+        }
+
         for (LifecycleListener lifecycleListener : mLifecycleListeners) {
             lifecycleListener.onResume(activity);
         }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoatViewabilitySession.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoatViewabilitySession.java
index 8a3b6e9e..24450868 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoatViewabilitySession.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/MoatViewabilitySession.java
@@ -107,6 +107,7 @@ public Boolean initialize(@NonNull final Context context) {
         // Pre-reflection code:
         // final MoatOptions options = new MoatOptions();
         // options.disableAdIdCollection = true;
+        // options.disableLocationServices = true;
         // MoatAnalytics.getInstance().start(options, application);
 
         try {
@@ -116,6 +117,9 @@ public Boolean initialize(@NonNull final Context context) {
             moatOptions.getClass().getField("disableAdIdCollection")
                     .setBoolean(moatOptions, true);
 
+            moatOptions.getClass().getField("disableLocationServices")
+                    .setBoolean(moatOptions, true);
+
             Object moatAnalytics = new Reflection.MethodBuilder(null, "getInstance")
                     .setStatic(MOAT_ANALYTICS_PATH)
                     .execute();
@@ -285,8 +289,8 @@ public Boolean createVideoSession(@NonNull final Activity activity, @NonNull fin
 
     @Override
     @Nullable
-    public Boolean registerVideoObstructions(@NonNull final List<View> views) {
-        Preconditions.checkNotNull(views);
+    public Boolean registerVideoObstruction(@NonNull final View view) {
+        Preconditions.checkNotNull(view);
 
         if (!isEnabled()) {
             return null;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/SdkConfiguration.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/SdkConfiguration.java
new file mode 100644
index 00000000..2e456d32
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/SdkConfiguration.java
@@ -0,0 +1,159 @@
+package com.mopub.common;
+
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.common.util.MoPubCollections;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Collection;
+import java.util.Collections;
+import java.util.List;
+
+/**
+ * Data object holding any SDK initialization parameters.
+ */
+public class SdkConfiguration {
+
+    /**
+     * Any ad unit that your app uses.
+     */
+    @NonNull private final String mAdUnitId;
+
+    /**
+     * List of the class names of advanced bidders to initialize.
+     */
+    @NonNull private final List<Class<? extends MoPubAdvancedBidder>> mAdvancedBidders;
+
+    /**
+     * Used for rewarded video initialization. This holds each custom event's unique settings.
+     */
+    @NonNull private final MediationSettings[] mMediationSettings;
+
+    /**
+     * List of class names of rewarded video custom events to initialize. These classes must
+     * extend CustomEventRewardedVideo.
+     */
+    @Nullable private final List<String> mNetworksToInit;
+
+    /**
+     * Holds data for SDK initialization. Do not call this constructor directly; use the Builder.
+     */
+    private SdkConfiguration(@NonNull final String adUnitId,
+            @NonNull final List<Class<? extends MoPubAdvancedBidder>> advancedBidders,
+            @NonNull final MediationSettings[] mediationSettings,
+            @Nullable final List<String> networksToInit) {
+        Preconditions.checkNotNull(adUnitId);
+        Preconditions.checkNotNull(advancedBidders);
+
+        mAdUnitId = adUnitId;
+        mAdvancedBidders = advancedBidders;
+        mMediationSettings = mediationSettings;
+        mNetworksToInit = networksToInit;
+    }
+
+    @NonNull
+    public String getAdUnitId() {
+        return mAdUnitId;
+    }
+
+    @NonNull
+    public List<Class<? extends MoPubAdvancedBidder>> getAdvancedBidders() {
+        return Collections.unmodifiableList(mAdvancedBidders);
+    }
+
+    @NonNull
+    public MediationSettings[] getMediationSettings() {
+        return Arrays.copyOf(mMediationSettings, mMediationSettings.length);
+    }
+
+    @Nullable
+    public List<String> getNetworksToInit() {
+        if (mNetworksToInit == null) {
+            return null;
+        }
+        return Collections.unmodifiableList(mNetworksToInit);
+    }
+
+    public static class Builder {
+        @NonNull private String adUnitId;
+        @NonNull private final List<Class<? extends MoPubAdvancedBidder>> advancedBidders;
+        @NonNull private MediationSettings[] mediationSettings;
+        @Nullable private List<String> networksToInit;
+
+        /**
+         * Use this builder instead of creating a new SdkConfiguration. This Builder needs any ad
+         * unit that is used by this app.
+         *
+         * @param adUnitId Any ad unit id used by this app. This cannot be null.
+         */
+        public Builder(@NonNull final String adUnitId) {
+            this.adUnitId = adUnitId;
+            advancedBidders = new ArrayList<Class<? extends MoPubAdvancedBidder>>();
+            mediationSettings = new MediationSettings[0];
+        }
+
+        /**
+         * Adds a single advanced bidder class to be initialized.
+         *
+         * @param advancedBidder The advanced bidder class. Cannot be null.
+         * @return The builder.
+         */
+        public Builder withAdvancedBidder(
+                @NonNull final Class<? extends MoPubAdvancedBidder> advancedBidder) {
+            Preconditions.checkNotNull(advancedBidder);
+
+            this.advancedBidders.add(advancedBidder);
+            return this;
+        }
+
+        /**
+         * Adds a collection of advanced bidder classes to be initialized.
+         *
+         * @param advancedBidders Collection of advanced bidder classes. Cannot be null.
+         * @return The builder.
+         */
+        public Builder withAdvancedBidders(
+                @NonNull final Collection<Class<? extends MoPubAdvancedBidder>> advancedBidders) {
+            Preconditions.NoThrow.checkNotNull(advancedBidders);
+
+            MoPubCollections.addAllNonNull(this.advancedBidders, advancedBidders);
+            return this;
+        }
+
+        /**
+         * Adds mediation settings for rewarded video custom events.
+         *
+         * @param mediationSettings Array of mediation settings. Can be empty but not null.
+         * @return The builder.
+         */
+        public Builder withMediationSettings(@NonNull MediationSettings... mediationSettings) {
+            Preconditions.checkNotNull(mediationSettings);
+
+            this.mediationSettings = mediationSettings;
+            return this;
+        }
+
+        /**
+         * Adds a list of rewarded video custom events to initialize.
+         *
+         * @param networksToInit List of full class names as Strings to initialize for rewarded video.
+         * @return The builder.
+         */
+        public Builder withNetworksToInit(@Nullable final List<String> networksToInit) {
+            if (networksToInit == null) {
+                return this;
+            }
+
+            this.networksToInit = new ArrayList<>();
+            MoPubCollections.addAllNonNull(this.networksToInit, networksToInit);
+            return this;
+        }
+
+        public SdkConfiguration build() {
+            return new SdkConfiguration(adUnitId, advancedBidders, mediationSettings,
+                    networksToInit);
+        }
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/SdkInitializationListener.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/SdkInitializationListener.java
new file mode 100644
index 00000000..ba96a762
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/SdkInitializationListener.java
@@ -0,0 +1,11 @@
+package com.mopub.common;
+
+import android.content.Context;
+
+/**
+ * Called when Sdk initialization completes from
+ * {@link MoPub#initializeSdk(Context, SdkConfiguration, SdkInitializationListener)}
+ */
+public interface SdkInitializationListener {
+    void onInitializationFinished();
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlAction.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlAction.java
index 565239a8..39a16649 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlAction.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlAction.java
@@ -8,7 +8,6 @@
 import android.text.TextUtils;
 
 import com.mopub.common.MoPub.BrowserAgent;
-import com.mopub.common.event.BaseEvent;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Intents;
 import com.mopub.exceptions.IntentNotResolvableException;
@@ -254,7 +253,7 @@ protected void performAction(
             // 2. Attempt to handle the primary URL
             try {
                 Intents.launchApplicationUrl(context, primaryUri);
-                makeTrackingHttpRequest(primaryTrackingUrls, context, BaseEvent.Name.CLICK_REQUEST);
+                makeTrackingHttpRequest(primaryTrackingUrls, context);
                 return;
             } catch (IntentNotResolvableException e) {
                 // Primary URL failed; proceed to attempt fallback URL
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlHandler.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlHandler.java
index 599dd1c8..b665bf52 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlHandler.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlHandler.java
@@ -6,7 +6,6 @@
 import android.support.annotation.Nullable;
 import android.text.TextUtils;
 
-import com.mopub.common.event.BaseEvent;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Intents;
 import com.mopub.exceptions.IntentNotResolvableException;
@@ -313,8 +312,7 @@ public boolean handleResolvedUrl(@NonNull final Context context,
                     if (!mAlreadySucceeded && !mTaskPending
                             && !UrlAction.IGNORE_ABOUT_SCHEME.equals(urlAction)
                             && !UrlAction.HANDLE_MOPUB_SCHEME.equals(urlAction)) {
-                        makeTrackingHttpRequest(trackingUrls, context,
-                                BaseEvent.Name.CLICK_REQUEST);
+                        makeTrackingHttpRequest(trackingUrls, context);
                         mResultActions.urlHandlingSucceeded(destinationUri.toString(),
                                 urlAction);
                         mAlreadySucceeded = true;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlResolutionTask.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlResolutionTask.java
index 5cc833ec..b3a0496f 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlResolutionTask.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/UrlResolutionTask.java
@@ -80,6 +80,8 @@ protected String doInBackground(@Nullable String... urls) {
             return null;
         } catch (URISyntaxException e) {
             return null;
+        } catch (NullPointerException e) {
+            return null;
         }
 
         return previousUrl;
@@ -127,7 +129,11 @@ static String resolveRedirectLocation(@NonNull final String baseUrl,
                 result =  baseUri.resolve(redirectUrl).toString();
             } catch (IllegalArgumentException e) {
                 // Ensure the request is cancelled instead of resolving an intermediary URL
+                MoPubLog.e("Invalid URL redirection. baseUrl=" + baseUrl + "\n redirectUrl=" + redirectUrl);
                 throw new URISyntaxException(redirectUrl, "Unable to parse invalid URL");
+            } catch (NullPointerException e) {
+                MoPubLog.e("Invalid URL redirection. baseUrl=" + baseUrl + "\n redirectUrl=" + redirectUrl);
+                throw e;
             }
         }
 
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/BaseEvent.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/BaseEvent.java
deleted file mode 100644
index 5571fc30..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/BaseEvent.java
+++ /dev/null
@@ -1,605 +0,0 @@
-package com.mopub.common.event;
-
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-
-import com.mopub.common.ClientMetadata;
-import com.mopub.common.Preconditions;
-
-import java.text.SimpleDateFormat;
-import java.util.Date;
-
-import static com.mopub.common.ClientMetadata.MoPubNetworkType;
-
-public abstract class BaseEvent {
-
-    public enum ScribeCategory {
-        EXCHANGE_CLIENT_EVENT("exchange_client_event"),
-        EXCHANGE_CLIENT_ERROR("exchange_client_error");
-
-        @NonNull private final String mScribeCategory;
-        ScribeCategory(@NonNull String scribeCategory) {
-            mScribeCategory = scribeCategory;
-        }
-
-        @NonNull
-        public String getCategory() {
-            return mScribeCategory;
-        }
-    }
-
-    public enum SdkProduct {
-        NONE(0),
-        WEB_VIEW(1),
-        NATIVE(2);
-
-        private final int mType;
-        SdkProduct(int type) {
-            mType = type;
-        }
-
-        public int getType() {
-            return mType;
-        }
-    }
-
-    public enum AppPlatform {
-        NONE(0),
-        IOS(1),
-        ANDROID(2),
-        MOBILE_WEB(3);
-
-        private final int mType;
-        AppPlatform(int type) {
-            mType = type;
-        }
-
-        public int getType() {
-            return mType;
-        }
-    }
-
-    public enum Name {
-        // Ad Requests:
-        AD_REQUEST("ad_request"),
-        IMPRESSION_REQUEST("impression_request"),
-        CLICK_REQUEST("click_request"),
-
-        // Native Video:
-        DOWNLOAD_START("download_start"),
-        DOWNLOAD_VIDEO_READY("download_video_ready"),
-        DOWNLOAD_BUFFERING("download_video_buffering"),
-        DOWNLOAD_FINISHED("download_finished"),
-        ERROR_DURING_PLAYBACK("error_during_playback"),
-        ERROR_FAILED_TO_PLAY("error_failed_to_play"),
-
-        // Ad Interactions
-        AD_DWELL_TIME("clickthrough_dwell_time"),
-        ;
-
-        @NonNull private final String mName;
-        Name(@NonNull String name) {
-            mName = name;
-        }
-
-        @NonNull
-        public String getName() {
-            return mName;
-        }
-    }
-
-    public enum Category {
-        REQUESTS("requests"),
-        NATIVE_VIDEO("native_video"),
-        AD_INTERACTIONS("ad_interactions"),
-        ;
-
-        @NonNull private final String mCategory;
-        Category(@NonNull String category) {
-            mCategory = category;
-        }
-
-        @NonNull
-        public String getCategory() {
-            return mCategory;
-        }
-    }
-
-    public enum SamplingRate {
-        AD_REQUEST(0.1),
-        NATIVE_VIDEO(0.1),
-        AD_INTERACTIONS(0.1),
-        ;
-
-        private final double mSamplingRate;
-        SamplingRate(double samplingRate) {
-            mSamplingRate = samplingRate;
-        }
-
-        public double getSamplingRate() {
-            return mSamplingRate;
-        }
-    }
-
-    @NonNull private final ScribeCategory mScribeCategory;
-    @NonNull private final Name mName;
-    @NonNull private final Category mCategory;
-    @Nullable private final SdkProduct mSdkProduct;
-    @Nullable private final String mAdUnitId;
-    @Nullable private final String mAdCreativeId;
-    @Nullable private final String mAdType;
-    @Nullable private final String mAdNetworkType;
-    @Nullable private final Double mAdWidthPx;
-    @Nullable private final Double mAdHeightPx;
-    @Nullable private final String mDspCreativeId;
-    @Nullable private final Integer mDeviceScreenWidthDip;
-    @Nullable private final Integer mDeviceScreenHeightDip;
-    @Nullable private final Double mGeoLat;
-    @Nullable private final Double mGeoLon;
-    @Nullable private final Double mGeoAccuracy;
-    @Nullable private final MoPubNetworkType mNetworkType;
-    @Nullable private final String mNetworkOperator;
-    @Nullable private final String mNetworkOperatorName;
-    @Nullable private final String mIsoCountryCode;
-    @Nullable private final String mSimOperator;
-    @Nullable private final String mSimOperatorName;
-    @Nullable private final String mSimIsoCountryCode;
-    @Nullable private final Double mPerformanceDurationMs;
-    @Nullable private final String mRequestId;
-    @Nullable private final Integer mRequestStatusCode;
-    @Nullable private final String mRequestUri;
-    @Nullable private final Integer mRequestRetries;
-    private final long mTimestampUtcMs;
-    @Nullable private ClientMetadata mClientMetaData;
-
-     /**
-     * The percentage of events, in range 0 - 1.0, to be logged.
-     */
-    private final double mSamplingRate;
-
-    public BaseEvent(@NonNull final Builder builder) {
-        Preconditions.checkNotNull(builder);
-
-        mScribeCategory = builder.mScribeCategory;
-        mName = builder.mName;
-        mCategory = builder.mCategory;
-        mSdkProduct = builder.mSdkProduct;
-        mAdUnitId = builder.mAdUnitId;
-        mAdCreativeId = builder.mAdCreativeId;
-        mAdType = builder.mAdType;
-        mAdNetworkType = builder.mAdNetworkType;
-        mAdWidthPx = builder.mAdWidthPx;
-        mAdHeightPx = builder.mAdHeightPx;
-        mDspCreativeId = builder.mDspCreativeId;
-        mGeoLat = builder.mGeoLat;
-        mGeoLon = builder.mGeoLon;
-        mGeoAccuracy = builder.mGeoAccuracy;
-        mPerformanceDurationMs = builder.mPerformanceDurationMs;
-        mRequestId = builder.mRequestId;
-        mRequestStatusCode = builder.mRequestStatusCode;
-        mRequestUri = builder.mRequestUri;
-        mRequestRetries = builder.mRequestRetries;
-        mSamplingRate = builder.mSamplingRate;
-        mTimestampUtcMs = System.currentTimeMillis();
-
-        mClientMetaData = ClientMetadata.getInstance();
-        if (mClientMetaData != null) {
-            mDeviceScreenWidthDip = mClientMetaData.getDeviceScreenWidthDip();
-            mDeviceScreenHeightDip = mClientMetaData.getDeviceScreenHeightDip();
-            mNetworkType = mClientMetaData.getActiveNetworkType();
-            mNetworkOperator = mClientMetaData.getNetworkOperator();
-            mNetworkOperatorName = mClientMetaData.getNetworkOperatorName();
-            mIsoCountryCode = mClientMetaData.getIsoCountryCode();
-            mSimOperator = mClientMetaData.getSimOperator();
-            mSimOperatorName = mClientMetaData.getSimOperatorName();
-            mSimIsoCountryCode = mClientMetaData.getSimIsoCountryCode();
-        } else {
-            // Need to silence warnings about variables not being initialized
-            mDeviceScreenWidthDip = null;
-            mDeviceScreenHeightDip = null;
-            mNetworkType = null;
-            mNetworkOperator = null;
-            mNetworkOperatorName = null;
-            mIsoCountryCode = null;
-            mSimOperator = null;
-            mSimOperatorName = null;
-            mSimIsoCountryCode = null;
-        }
-    }
-
-    @NonNull
-    public ScribeCategory getScribeCategory() {
-        return mScribeCategory;
-    }
-
-    @NonNull
-    public Name getName() {
-        return mName;
-    }
-
-    @NonNull
-    public Category getCategory() {
-        return mCategory;
-    }
-
-    @Nullable
-    public SdkProduct getSdkProduct() {
-        return mSdkProduct;
-    }
-
-    @Nullable
-    public String getSdkVersion() {
-        return mClientMetaData == null ? null : mClientMetaData.getSdkVersion();
-    }
-
-    @Nullable
-    public String getAdUnitId() {
-        return mAdUnitId;
-    }
-
-    @Nullable
-    public String getAdCreativeId() {
-        return mAdCreativeId;
-    }
-
-    @Nullable
-    public String getDspCreativeId() {
-        return mDspCreativeId;
-    }
-
-    @Nullable
-    public String getAdType() {
-        return mAdType;
-    }
-
-    @Nullable
-    public String getAdNetworkType() {
-        return mAdNetworkType;
-    }
-
-    @Nullable
-    public Double getAdWidthPx() {
-        return mAdWidthPx;
-    }
-
-    @Nullable
-    public Double getAdHeightPx() {
-        return mAdHeightPx;
-    }
-
-    @Nullable
-    public AppPlatform getAppPlatform() {
-        return AppPlatform.ANDROID;
-    }
-
-    @Nullable
-    public String getAppName() {
-        return mClientMetaData == null ? null : mClientMetaData.getAppName();
-    }
-
-    @Nullable
-    public String getAppPackageName() {
-        return mClientMetaData == null ? null : mClientMetaData.getAppPackageName();
-    }
-
-    @Nullable
-    public String getAppVersion() {
-        return mClientMetaData == null ? null : mClientMetaData.getAppVersion();
-    }
-
-    @Nullable
-    public String getClientAdvertisingId() {
-        return mClientMetaData == null ? null : mClientMetaData.getDeviceId();
-    }
-
-    @NonNull
-    public String getObfuscatedClientAdvertisingId() {
-        // This is a placeholder for the advertising id until we approve a plan to use the
-        // real value
-        return "ifa:XXXX";
-    }
-
-    @NonNull
-    public Boolean getClientDoNotTrack() {
-        // Default to true if we don't have access to the client meta data
-        return mClientMetaData == null || mClientMetaData.isDoNotTrackSet();
-    }
-
-    @Nullable
-    public String getDeviceManufacturer() {
-        return mClientMetaData == null ? null : mClientMetaData.getDeviceManufacturer();
-    }
-
-    @Nullable
-    public String getDeviceModel() {
-        return mClientMetaData == null ? null : mClientMetaData.getDeviceModel();
-    }
-
-    @Nullable
-    public String getDeviceProduct() {
-        return mClientMetaData == null ? null : mClientMetaData.getDeviceProduct();
-    }
-
-    @Nullable
-    public String getDeviceOsVersion() {
-        return mClientMetaData == null ? null : mClientMetaData.getDeviceOsVersion();
-    }
-
-    @Nullable
-    public Integer getDeviceScreenWidthDip() {
-        return mDeviceScreenWidthDip;
-    }
-
-    @Nullable
-    public Integer getDeviceScreenHeightDip() {
-        return mDeviceScreenHeightDip;
-    }
-
-    @Nullable
-    public Double getGeoLat() {
-        return mGeoLat;
-    }
-
-    @Nullable
-    public Double getGeoLon() {
-        return mGeoLon;
-    }
-
-    @Nullable
-    public Double getGeoAccuracy() {
-        return mGeoAccuracy;
-    }
-
-    @Nullable
-    public Double getPerformanceDurationMs() {
-        return mPerformanceDurationMs;
-    }
-
-    @Nullable
-    public MoPubNetworkType getNetworkType() {
-        return mNetworkType;
-    }
-
-    @Nullable
-    public String getNetworkOperatorCode() {
-        return mNetworkOperator;
-    }
-
-    @Nullable
-    public String getNetworkOperatorName() {
-        return mNetworkOperatorName;
-    }
-
-    @Nullable
-    public String getNetworkIsoCountryCode() {
-        return mIsoCountryCode;
-    }
-
-    @Nullable
-    public String getNetworkSimCode() {
-        return mSimOperator;
-    }
-
-    @Nullable
-    public String getNetworkSimOperatorName() {
-        return mSimOperatorName;
-    }
-
-    @Nullable
-    public String getNetworkSimIsoCountryCode() {
-        return mSimIsoCountryCode;
-    }
-
-    @Nullable
-    public String getRequestId() {
-        return mRequestId;
-    }
-
-    @Nullable
-    public Integer getRequestStatusCode() {
-        return mRequestStatusCode;
-    }
-
-    @Nullable
-    public String getRequestUri() {
-        return mRequestUri;
-    }
-
-    @Nullable
-    public Integer getRequestRetries() {
-        return mRequestRetries;
-    }
-
-    public double getSamplingRate() {
-        return mSamplingRate;
-    }
-
-    @NonNull
-    public Long getTimestampUtcMs() {
-        return mTimestampUtcMs;
-    }
-
-    @Override
-    public String toString() {
-        return  "BaseEvent\n" +
-                "ScribeCategory: " + getScribeCategory() + "\n" +
-                "Name: " + getName() + "\n" +
-                "Category: " + getCategory() + "\n" +
-                "SdkProduct: " + getSdkProduct() + "\n" +
-                "SdkVersion: " + getSdkVersion() + "\n" +
-                "AdUnitId: " + getAdUnitId() + "\n" +
-                "AdCreativeId: " + getAdCreativeId() + "\n" +
-                "AdType: " + getAdType() + "\n" +
-                "AdNetworkType: " + getAdNetworkType() + "\n" +
-                "AdWidthPx: " + getAdWidthPx() + "\n" +
-                "AdHeightPx: " + getAdHeightPx() + "\n" +
-                "DspCreativeId: " + getDspCreativeId() + "\n" +
-                "AppPlatform: " + getAppPlatform() + "\n" +
-                "AppName: " + getAppName() + "\n" +
-                "AppPackageName: " + getAppPackageName() + "\n" +
-                "AppVersion: " + getAppVersion() + "\n" +
-                "DeviceManufacturer: " + getDeviceManufacturer() + "\n" +
-                "DeviceModel: " + getDeviceModel() + "\n" +
-                "DeviceProduct: " + getDeviceProduct() + "\n" +
-                "DeviceOsVersion: " + getDeviceOsVersion() + "\n" +
-                "DeviceScreenWidth: " + getDeviceScreenWidthDip() + "\n" +
-                "DeviceScreenHeight: " + getDeviceScreenHeightDip() + "\n" +
-                "GeoLat: " + getGeoLat() + "\n" +
-                "GeoLon: " + getGeoLon() + "\n" +
-                "GeoAccuracy: " + getGeoAccuracy() + "\n" +
-                "PerformanceDurationMs: " + getPerformanceDurationMs() + "\n" +
-                "NetworkType: " + getNetworkType() + "\n" +
-                "NetworkOperatorCode: " + getNetworkOperatorCode() + "\n" +
-                "NetworkOperatorName: " + getNetworkOperatorName() + "\n" +
-                "NetworkIsoCountryCode: " + getNetworkIsoCountryCode() + "\n" +
-                "NetworkSimCode: " + getNetworkSimCode() + "\n" +
-                "NetworkSimOperatorName: " + getNetworkSimOperatorName() + "\n" +
-                "NetworkSimIsoCountryCode: " + getNetworkSimIsoCountryCode() + "\n" +
-                "RequestId: " + getRequestId() + "\n" +
-                "RequestStatusCode: " + getRequestStatusCode() + "\n" +
-                "RequestUri: " + getRequestUri() + "\n" +
-                "RequestRetries: " + getRequestRetries() + "\n" +
-                "SamplingRate: " + getSamplingRate() + "\n" +
-                "TimestampUtcMs: " + new SimpleDateFormat().format(new Date(getTimestampUtcMs())) + "\n";
-    }
-
-    public static abstract class Builder {
-        @NonNull private ScribeCategory mScribeCategory;
-        @NonNull private Name mName;
-        @NonNull private Category mCategory;
-        @Nullable private SdkProduct mSdkProduct;
-        @Nullable private String mAdUnitId;
-        @Nullable private String mAdCreativeId;
-        @Nullable private String mAdType;
-        @Nullable private String mAdNetworkType;
-        @Nullable private Double mAdWidthPx;
-        @Nullable private Double mAdHeightPx;
-        @Nullable private String mDspCreativeId;
-        @Nullable private Double mGeoLat;
-        @Nullable private Double mGeoLon;
-        @Nullable private Double mGeoAccuracy;
-        @Nullable private Double mPerformanceDurationMs;
-        @Nullable private String mRequestId;
-        @Nullable private Integer mRequestStatusCode;
-        @Nullable private String mRequestUri;
-        @Nullable private Integer mRequestRetries;
-
-        /**
-         * The percentage of events, in range 0 - 1.0, to be logged.
-         */
-        private double mSamplingRate;
-
-        public Builder(@NonNull ScribeCategory scribeCategory,
-                @NonNull Name name,
-                @NonNull Category category,
-                double samplingRate) {
-            Preconditions.checkNotNull(scribeCategory);
-            Preconditions.checkNotNull(name);
-            Preconditions.checkNotNull(category);
-            Preconditions.checkArgument(samplingRate >= 0 && samplingRate <= 1.0);
-
-            mScribeCategory = scribeCategory;
-            mName = name;
-            mCategory = category;
-            mSamplingRate = samplingRate;
-        }
-
-        @NonNull
-        public Builder withSdkProduct(@Nullable SdkProduct sdkProduct) {
-            mSdkProduct = sdkProduct;
-            return this;
-        }
-
-        @NonNull
-        public Builder withAdUnitId(@Nullable String adUnitId) {
-            mAdUnitId = adUnitId;
-            return this;
-        }
-
-        @NonNull
-        public Builder withAdCreativeId(@Nullable String adCreativeId) {
-            mAdCreativeId = adCreativeId;
-            return this;
-        }
-
-        @NonNull
-        public Builder withAdType(@Nullable String adType) {
-            mAdType = adType;
-            return this;
-        }
-
-        @NonNull
-        public Builder withAdNetworkType(@Nullable String adNetworkType) {
-            mAdNetworkType = adNetworkType;
-            return this;
-        }
-
-        @NonNull
-        public Builder withAdWidthPx(@Nullable Double adWidthPx) {
-            mAdWidthPx = adWidthPx;
-            return this;
-        }
-
-        @NonNull
-        public Builder withAdHeightPx(@Nullable Double adHeightPx) {
-            mAdHeightPx = adHeightPx;
-            return this;
-        }
-
-        @NonNull
-        public Builder withDspCreativeId(@Nullable String dspCreativeId) {
-            mDspCreativeId = dspCreativeId;
-            return this;
-        }
-
-        @NonNull
-        public Builder withGeoLat(@Nullable Double geoLat) {
-            mGeoLat = geoLat;
-            return this;
-        }
-
-        @NonNull
-        public Builder withGeoLon(@Nullable Double geoLon) {
-            mGeoLon = geoLon;
-            return this;
-        }
-
-        @NonNull
-        public Builder withGeoAccuracy(@Nullable Double geoAccuracy) {
-            mGeoAccuracy = geoAccuracy;
-            return this;
-        }
-
-        @NonNull
-        public Builder withPerformanceDurationMs(@Nullable Double performanceDurationMs) {
-            mPerformanceDurationMs = performanceDurationMs;
-            return this;
-        }
-
-        @NonNull
-        public Builder withRequestId(@Nullable String requestId) {
-            mRequestId = requestId;
-            return this;
-        }
-
-        @NonNull
-        public Builder withRequestStatusCode(@Nullable Integer requestStatusCode) {
-            mRequestStatusCode = requestStatusCode;
-            return this;
-        }
-
-        @NonNull
-        public Builder withRequestUri(@Nullable String requestUri) {
-            mRequestUri = requestUri;
-            return this;
-        }
-
-        @NonNull
-        public Builder withRequestRetries(@Nullable Integer requestRetries) {
-            mRequestRetries = requestRetries;
-            return this;
-        }
-
-        public abstract BaseEvent build();
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/ErrorEvent.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/ErrorEvent.java
deleted file mode 100644
index 05a3d93f..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/ErrorEvent.java
+++ /dev/null
@@ -1,160 +0,0 @@
-package com.mopub.common.event;
-
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-
-import java.io.PrintWriter;
-import java.io.StringWriter;
-
-/**
- * Immutable data class with error event data.
- */
-public class ErrorEvent extends BaseEvent {
-    @Nullable private final String mErrorExceptionClassName;
-    @Nullable private final String mErrorMessage;
-    @Nullable private final String mErrorStackTrace;
-    @Nullable private final String mErrorFileName;
-    @Nullable private final String mErrorClassName;
-    @Nullable private final String mErrorMethodName;
-    @Nullable private final Integer mErrorLineNumber;
-
-    private ErrorEvent(@NonNull Builder builder) {
-        super(builder);
-        mErrorExceptionClassName = builder.mErrorExceptionClassName;
-        mErrorMessage = builder.mErrorMessage;
-        mErrorStackTrace = builder.mErrorStackTrace;
-        mErrorFileName = builder.mErrorFileName;
-        mErrorClassName = builder.mErrorClassName;
-        mErrorMethodName = builder.mErrorMethodName;
-        mErrorLineNumber = builder.mErrorLineNumber;
-    }
-
-    @Nullable
-    public String getErrorExceptionClassName() {
-        return mErrorExceptionClassName;
-    }
-
-    @Nullable
-    public String getErrorMessage() {
-        return mErrorMessage;
-    }
-
-    @Nullable
-    public String getErrorStackTrace() {
-        return mErrorStackTrace;
-    }
-
-    @Nullable
-    public String getErrorFileName() {
-        return mErrorFileName;
-    }
-
-    @Nullable
-    public String getErrorClassName() {
-        return mErrorClassName;
-    }
-
-    @Nullable
-    public String getErrorMethodName() {
-        return mErrorMethodName;
-    }
-
-    @Nullable
-    public Integer getErrorLineNumber() {
-        return mErrorLineNumber;
-    }
-
-    @Override
-    public String toString() {
-        final String string = super.toString();
-        return string +
-                "ErrorEvent\n" +
-                "ErrorExceptionClassName: " + getErrorExceptionClassName() + "\n" +
-                "ErrorMessage: " + getErrorMessage() + "\n" +
-                "ErrorStackTrace: " + getErrorStackTrace() + "\n" +
-                "ErrorFileName: " + getErrorFileName() + "\n" +
-                "ErrorClassName: " + getErrorClassName() + "\n" +
-                "ErrorMethodName: " + getErrorMethodName() + "\n" +
-                "ErrorLineNumber: " + getErrorLineNumber() + "\n";
-    }
-
-    public static class Builder extends BaseEvent.Builder {
-        @Nullable private String mErrorExceptionClassName;
-        @Nullable private String mErrorMessage;
-        @Nullable private String mErrorStackTrace;
-        @Nullable private String mErrorFileName;
-        @Nullable private String mErrorClassName;
-        @Nullable private String mErrorMethodName;
-        @Nullable private Integer mErrorLineNumber;
-
-        public Builder(@NonNull Name name, @NonNull Category category, double samplingRate) {
-            super(ScribeCategory.EXCHANGE_CLIENT_ERROR, name, category, samplingRate);
-        }
-
-        @NonNull
-        public Builder withErrorExceptionClassName(@Nullable String errorExceptionClassName) {
-            mErrorExceptionClassName = errorExceptionClassName;
-            return this;
-        }
-
-        @NonNull
-        public Builder withErrorMessage(@Nullable String errorMessage) {
-            mErrorMessage = errorMessage;
-            return this;
-        }
-
-        @NonNull
-        public Builder withErrorStackTrace(@Nullable String errorStackTrace) {
-            mErrorStackTrace = errorStackTrace;
-            return this;
-        }
-
-        @NonNull
-        public Builder withErrorFileName(@Nullable String errorFileName) {
-            mErrorFileName = errorFileName;
-            return this;
-        }
-
-        @NonNull
-        public Builder withErrorClassName(@Nullable String errorClassName) {
-            mErrorClassName = errorClassName;
-            return this;
-        }
-
-        @NonNull
-        public Builder withErrorMethodName(@Nullable String errorMethodName) {
-            mErrorMethodName = errorMethodName;
-            return this;
-        }
-
-        @NonNull
-        public Builder withErrorLineNumber(@Nullable Integer errorLineNumber) {
-            mErrorLineNumber = errorLineNumber;
-            return this;
-        }
-
-        @NonNull
-        public Builder withException(@Nullable Exception exception) {
-            mErrorExceptionClassName = exception.getClass().getName();
-            mErrorMessage = exception.getMessage();
-
-            StringWriter stringWriter = new StringWriter();
-            exception.printStackTrace(new PrintWriter(stringWriter));
-            mErrorStackTrace = stringWriter.toString();
-
-            if (exception.getStackTrace().length > 0) {
-                mErrorFileName = exception.getStackTrace()[0].getFileName();
-                mErrorClassName = exception.getStackTrace()[0].getClassName();
-                mErrorMethodName = exception.getStackTrace()[0].getMethodName();
-                mErrorLineNumber = exception.getStackTrace()[0].getLineNumber();
-            }
-            return this;
-        }
-
-        @NonNull
-        @Override
-        public ErrorEvent build() {
-            return new ErrorEvent(this);
-        }
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/Event.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/Event.java
deleted file mode 100644
index 949ce72f..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/Event.java
+++ /dev/null
@@ -1,74 +0,0 @@
-package com.mopub.common.event;
-
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-
-import com.mopub.common.Preconditions;
-import com.mopub.common.logging.MoPubLog;
-
-/**
- * Immutable data class with client event data.
- */
-public class Event extends BaseEvent {
-    private Event(@NonNull Builder builder) {
-        super(builder);
-    }
-
-    public static class Builder extends BaseEvent.Builder {
-        public Builder(@NonNull Name name, @NonNull Category category, double samplingRate) {
-            super(ScribeCategory.EXCHANGE_CLIENT_EVENT, name, category, samplingRate);
-        }
-
-        @NonNull
-        @Override
-        public Event build() {
-            return new Event(this);
-        }
-    }
-
-    /**
-     * Creates a BaseEvent from the specified event and the metadata surrounding the event.
-     *
-     * @param name         Event name: See {@link com.mopub.common.event.BaseEvent.Name} for
-     *                     constants.
-     * @param category     Category: See {@link com.mopub.common.event.BaseEvent.Category} for
-     *                     constants.
-     * @param samplingRate The percentage of events to sample. See {@link com.mopub.common.event.BaseEvent.SamplingRate}
-     *                     for constants.
-     * @param eventDetails Data object containing the remaining meta data around this event.
-     * @return An {@link BaseEvent} with all the parts combined, or {@code null} if there is no
-     * metadata available.
-     */
-    @Nullable
-    public static BaseEvent createEventFromDetails(@NonNull final BaseEvent.Name name,
-            @NonNull final BaseEvent.Category category,
-            @NonNull final BaseEvent.SamplingRate samplingRate,
-            @Nullable EventDetails eventDetails) {
-        Preconditions.checkNotNull(name);
-        Preconditions.checkNotNull(category);
-        Preconditions.checkNotNull(samplingRate);
-
-        if (eventDetails == null) {
-            MoPubLog.d("Unable to log event due to no details present");
-            return null;
-        }
-
-        return new Event.Builder(name,
-                category,
-                samplingRate.getSamplingRate())
-                .withAdUnitId(eventDetails.getAdUnitId())
-                .withAdCreativeId(eventDetails.getDspCreativeId())
-                .withAdType(eventDetails.getAdType())
-                .withAdNetworkType(eventDetails.getAdNetworkType())
-                .withAdWidthPx(eventDetails.getAdWidthPx())
-                .withAdHeightPx(eventDetails.getAdHeightPx())
-                .withGeoLat(eventDetails.getGeoLatitude())
-                .withGeoLon(eventDetails.getGeoLongitude())
-                .withGeoAccuracy(eventDetails.getGeoAccuracy())
-                .withPerformanceDurationMs(eventDetails.getPerformanceDurationMs())
-                .withRequestId(eventDetails.getRequestId())
-                .withRequestStatusCode(eventDetails.getRequestStatusCode())
-                .withRequestUri(eventDetails.getRequestUri())
-                .build();
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventDetails.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventDetails.java
deleted file mode 100644
index dcba998a..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventDetails.java
+++ /dev/null
@@ -1,256 +0,0 @@
-package com.mopub.common.event;
-
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-
-import com.mopub.common.Preconditions;
-import com.mopub.common.util.Json;
-
-import java.util.HashMap;
-import java.util.Map;
-
-public class EventDetails {
-
-    public static class Builder {
-        @NonNull private final Map<String, String> eventDetailsMap;
-
-        public Builder() {
-            eventDetailsMap = new HashMap<String, String>();
-        }
-
-        @NonNull
-        public Builder adUnitId(@Nullable final String adUnitId) {
-            if (adUnitId != null) {
-                eventDetailsMap.put(AD_UNIT_ID_KEY, adUnitId);
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder dspCreativeId(@Nullable final String dspCreativeId) {
-            if (dspCreativeId != null) {
-                eventDetailsMap.put(DSP_CREATIVE_ID_KEY, dspCreativeId);
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder adType(@Nullable final String adType) {
-            if (adType != null) {
-                eventDetailsMap.put(AD_TYPE_KEY, adType);
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder adNetworkType(@Nullable final String adNetworkType) {
-            if (adNetworkType != null) {
-                eventDetailsMap.put(AD_NETWORK_TYPE_KEY, adNetworkType);
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder adWidthPx(@Nullable final Integer adWidthPx) {
-            if (adWidthPx != null) {
-                eventDetailsMap.put(AD_WIDTH_PX_KEY, String.valueOf(adWidthPx));
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder adHeightPx(@Nullable final Integer adHeightPx) {
-            if (adHeightPx != null) {
-                eventDetailsMap.put(AD_HEIGHT_PX_KEY, String.valueOf(adHeightPx));
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder geoLatitude(@Nullable final Double geoLatitude) {
-            if (geoLatitude != null) {
-                eventDetailsMap.put(GEO_LATITUDE_KEY, String.valueOf(geoLatitude));
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder geoLongitude(@Nullable final Double geoLongitude) {
-            if (geoLongitude != null) {
-                eventDetailsMap.put(GEO_LONGITUDE_KEY, String.valueOf(geoLongitude));
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder geoAccuracy(@Nullable final Float geoAccuracy) {
-            if (geoAccuracy != null) {
-                eventDetailsMap.put(GEO_ACCURACY_KEY, String.valueOf((double) geoAccuracy));
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder performanceDurationMs(@Nullable final Long performanceDurationMs) {
-            if (performanceDurationMs != null) {
-                eventDetailsMap.put(PERFORMANCE_DURATION_MS_KEY,
-                        String.valueOf((double) performanceDurationMs));
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder requestId(@Nullable final String requestId) {
-            if (requestId != null) {
-                eventDetailsMap.put(REQUEST_ID_KEY, requestId);
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder requestStatusCode(@Nullable final Integer requestStatusCode) {
-            if (requestStatusCode != null) {
-                eventDetailsMap.put(REQUEST_STATUS_CODE_KEY, String.valueOf(requestStatusCode));
-            }
-            return this;
-        }
-
-        @NonNull
-        public Builder requestUri(@Nullable final String requestUri) {
-            if (requestUri != null) {
-                eventDetailsMap.put(REQUEST_URI_KEY, requestUri);
-            }
-            return this;
-        }
-
-        @NonNull
-        public EventDetails build() {
-            return new EventDetails(eventDetailsMap);
-        }
-    }
-
-
-    private static final String AD_UNIT_ID_KEY = "ad_unit_id";
-    private static final String DSP_CREATIVE_ID_KEY = "dsp_creative_id";
-    private static final String AD_TYPE_KEY = "ad_type";
-    private static final String AD_NETWORK_TYPE_KEY = "ad_network_type";
-    private static final String AD_WIDTH_PX_KEY = "ad_width_px";
-    private static final String AD_HEIGHT_PX_KEY = "ad_height_px_key";
-    private static final String GEO_LATITUDE_KEY = "geo_latitude";
-    private static final String GEO_LONGITUDE_KEY = "geo_longitude";
-    private static final String GEO_ACCURACY_KEY = "geo_accuracy_key";
-    private static final String PERFORMANCE_DURATION_MS_KEY = "performance_duration_ms";
-    private static final String REQUEST_ID_KEY = "request_id_key";
-    private static final String REQUEST_STATUS_CODE_KEY = "request_status_code";
-    private static final String REQUEST_URI_KEY = "request_uri_key";
-
-    @NonNull private final Map<String, String> mEventDetailsMap;
-
-    private EventDetails(@NonNull final Map<String, String> eventDetailsMap) {
-        Preconditions.checkNotNull(eventDetailsMap);
-        mEventDetailsMap = eventDetailsMap;
-    }
-
-    @Nullable
-    public String getAdUnitId() {
-        return mEventDetailsMap.get(AD_UNIT_ID_KEY);
-    }
-
-    @Nullable
-    public String getDspCreativeId() {
-        return mEventDetailsMap.get(DSP_CREATIVE_ID_KEY);
-    }
-
-    @Nullable
-    public String getAdType() {
-        return mEventDetailsMap.get(AD_TYPE_KEY);
-    }
-
-    @Nullable
-    public String getAdNetworkType() {
-        return mEventDetailsMap.get(AD_NETWORK_TYPE_KEY);
-    }
-
-    @Nullable
-    public Double getAdWidthPx() {
-        return getNullableDoubleValue(mEventDetailsMap, AD_WIDTH_PX_KEY);
-    }
-
-    @Nullable
-    public Double getAdHeightPx() {
-        return getNullableDoubleValue(mEventDetailsMap, AD_HEIGHT_PX_KEY);
-
-    }
-
-    @Nullable
-    public Double getGeoLatitude() {
-        return getNullableDoubleValue(mEventDetailsMap, GEO_LATITUDE_KEY);
-    }
-
-    @Nullable
-    public Double getGeoLongitude() {
-        return getNullableDoubleValue(mEventDetailsMap, GEO_LONGITUDE_KEY);
-    }
-
-    @Nullable
-    public Double getGeoAccuracy() {
-        return getNullableDoubleValue(mEventDetailsMap, GEO_ACCURACY_KEY);
-    }
-
-    @Nullable
-    public Double getPerformanceDurationMs() {
-        return getNullableDoubleValue(mEventDetailsMap, PERFORMANCE_DURATION_MS_KEY);
-    }
-
-    @Nullable
-    public String getRequestId() {
-        return mEventDetailsMap.get(REQUEST_ID_KEY);
-    }
-
-    @Nullable
-    public Integer getRequestStatusCode() {
-        return getNullableIntegerValue(mEventDetailsMap, REQUEST_STATUS_CODE_KEY);
-    }
-
-    @Nullable
-    public String getRequestUri() {
-        return mEventDetailsMap.get(REQUEST_URI_KEY);
-    }
-
-    public String toJsonString() {
-        return Json.mapToJsonString(mEventDetailsMap);
-    }
-
-    @Override
-    public String toString() {
-        return toJsonString();
-    }
-
-    @Nullable
-    private static Double getNullableDoubleValue(@NonNull final Map<String, String> map,
-            @NonNull final String key) {
-        final String value = map.get(key);
-        if (value == null) {
-            return null;
-        }
-        try {
-            return Double.parseDouble(value);
-        } catch (NumberFormatException e) {
-            return null;
-        }
-    }
-
-    @Nullable
-    private static Integer getNullableIntegerValue(@NonNull final Map<String, String> map,
-            @NonNull final String key) {
-        final String value = map.get(key);
-        if (value == null) {
-            return null;
-        }
-        try {
-            return Integer.parseInt(value);
-        } catch (NumberFormatException e) {
-            return null;
-        }
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventDispatcher.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventDispatcher.java
deleted file mode 100644
index f5ca5dbc..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventDispatcher.java
+++ /dev/null
@@ -1,49 +0,0 @@
-package com.mopub.common.event;
-
-import android.os.Handler;
-import android.os.Looper;
-import android.os.Message;
-
-import com.mopub.common.VisibleForTesting;
-import com.mopub.common.logging.MoPubLog;
-
-public class EventDispatcher {
-    private final Iterable<EventRecorder> mEventRecorders;
-    private final Looper mLooper;
-    private final Handler mMessageHandler;
-    private final Handler.Callback mHandlerCallback;
-
-    @VisibleForTesting
-    EventDispatcher(Iterable<EventRecorder> recorders, Looper looper) {
-        mEventRecorders = recorders;
-        mLooper = looper;
-        mHandlerCallback = new Handler.Callback() {
-            @Override
-            public boolean handleMessage(final Message msg) {
-                if (msg.obj instanceof BaseEvent) {
-                    for (final EventRecorder recorder : mEventRecorders) {
-                        recorder.record((BaseEvent) msg.obj);
-                    }
-                } else {
-                    MoPubLog.d("EventDispatcher received non-BaseEvent message type.");
-                }
-                return true;
-            }
-        };
-        mMessageHandler = new Handler(mLooper, mHandlerCallback);
-    }
-
-    public void dispatch(BaseEvent event) {
-        Message.obtain(mMessageHandler, 0, event).sendToTarget();
-    }
-
-    @VisibleForTesting
-    Iterable<EventRecorder> getEventRecorders() {
-        return mEventRecorders;
-    }
-
-    @VisibleForTesting
-    Handler.Callback getHandlerCallback() {
-        return mHandlerCallback;
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventRecorder.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventRecorder.java
deleted file mode 100644
index e24dea37..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventRecorder.java
+++ /dev/null
@@ -1,8 +0,0 @@
-package com.mopub.common.event;
-
-/**
- * This interface represents a backend to which MoPub client events are logged.
- */
-public interface EventRecorder {
-    void record(BaseEvent baseEvent);
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventSampler.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventSampler.java
deleted file mode 100644
index 9b514448..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventSampler.java
+++ /dev/null
@@ -1,71 +0,0 @@
-package com.mopub.common.event;
-
-import android.support.annotation.NonNull;
-
-import com.mopub.common.Preconditions;
-import com.mopub.common.VisibleForTesting;
-
-import java.util.LinkedHashMap;
-import java.util.Map;
-import java.util.Random;
-
-/**
- * Samples events based on rules defined in the sample method.
- */
-public class EventSampler {
-
-    @VisibleForTesting static final int MAX_SIZE = 100;
-    private static final float LOAD_FACTOR = 0.75f;
-    /**
-     * The capacity is just large enough to hold the max size without rehashing.
-     */
-    private static final int CAPACITY = (int) (MAX_SIZE / LOAD_FACTOR + 2);
-
-    @NonNull private Random mRandom;
-    @NonNull private LinkedHashMap<String, Boolean> mSampleDecisionsCache;
-
-    public EventSampler() {
-        this(new Random());
-    }
-
-    @VisibleForTesting
-    public EventSampler(@NonNull Random random) {
-        mRandom = random;
-        mSampleDecisionsCache = new LinkedHashMap<String, Boolean>(CAPACITY, LOAD_FACTOR, true) {
-            @Override
-            protected boolean removeEldestEntry(Map.Entry<String, Boolean> eldest) {
-                return size() > MAX_SIZE;
-            }
-        };
-    }
-
-    /**
-     * Samples events based on custom rules. Events with the same request ID will either all pass or
-     * be discarded together.
-     *
-     * @param baseEvent The event to be sampled.
-     * @return Will return {@code true} if the event passed sampling and {@code false} if it is to
-     * be discarded.
-     */
-    boolean sample(@NonNull BaseEvent baseEvent) {
-        Preconditions.checkNotNull(baseEvent);
-
-        final String requestId = baseEvent.getRequestId();
-        if (requestId == null) {
-            return mRandom.nextDouble() < baseEvent.getSamplingRate();
-        }
-
-        final Boolean existingSample = mSampleDecisionsCache.get(requestId);
-        if (existingSample != null) {
-            return existingSample;
-        }
-        final boolean newSample = mRandom.nextDouble() < baseEvent.getSamplingRate();
-        mSampleDecisionsCache.put(requestId, newSample);
-        return newSample;
-    }
-
-    @VisibleForTesting
-    int getCacheSize() {
-        return mSampleDecisionsCache.size();
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventSerializer.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventSerializer.java
deleted file mode 100644
index b91c95cd..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/EventSerializer.java
+++ /dev/null
@@ -1,143 +0,0 @@
-package com.mopub.common.event;
-
-import android.support.annotation.NonNull;
-
-import com.mopub.common.ClientMetadata;
-import com.mopub.common.Preconditions;
-import com.mopub.common.logging.MoPubLog;
-
-import org.json.JSONArray;
-import org.json.JSONException;
-import org.json.JSONObject;
-
-import java.util.List;
-
-/**
- * Serializes events to the data format expected by the Scribe service.
- */
-public class EventSerializer {
-
-    /**
-     * Serializes a list of events as a JSON array of flattened JSON objects.
-     *
-     * @param events The events to be serialized.
-     *
-     * @return Will return a {@code JSONArray} of serialized {@code JSONObject}s.
-     */
-    @NonNull
-    public JSONArray serializeAsJson(@NonNull List<BaseEvent> events) {
-        Preconditions.checkNotNull(events);
-
-        JSONArray jsonArray = new JSONArray();
-        for (BaseEvent event : events) {
-            try {
-                jsonArray.put(serializeAsJson(event));
-            } catch (JSONException e) {
-                MoPubLog.d("Failed to serialize event \"" + event.getName() + "\" to JSON: ", e);
-            }
-        }
-        return jsonArray;
-    }
-
-    /**
-     * Serializes a single event as a flattened JSON object. Key values are expected by the Scribe
-     * service.
-     *
-     * @param event The event to be serialized.
-     *
-     * @return Will return a single serialized {@code JSONObject}.
-     */
-    @NonNull
-    public JSONObject serializeAsJson(@NonNull BaseEvent event) throws JSONException {
-        Preconditions.checkNotNull(event);
-
-        // Note: adding null values to the JSONObject will remove the key value pair
-        JSONObject jsonObject = new JSONObject();
-
-        // Required Scribe Request Keys
-        jsonObject.put("_category_", event.getScribeCategory().getCategory());
-        jsonObject.put("ts", event.getTimestampUtcMs());
-
-        // Name Details
-        jsonObject.put("name",  event.getName().getName());
-        jsonObject.put("name_category", event.getCategory().getCategory());
-
-        // SDK Details
-        BaseEvent.SdkProduct sdkProduct = event.getSdkProduct();
-        jsonObject.put("sdk_product", sdkProduct == null ? null : sdkProduct.getType());
-        jsonObject.put("sdk_version", event.getSdkVersion());
-
-        // Ad Details
-        jsonObject.put("ad_unit_id", event.getAdUnitId());
-        jsonObject.put("ad_creative_id", event.getAdCreativeId());
-        jsonObject.put("ad_type", event.getAdType());
-        jsonObject.put("ad_network_type", event.getAdNetworkType());
-        jsonObject.put("ad_width_px", event.getAdWidthPx());
-        jsonObject.put("ad_height_px", event.getAdHeightPx());
-        jsonObject.put("dsp_creative_id", event.getDspCreativeId());
-
-        // App Details
-        BaseEvent.AppPlatform appPlatform = event.getAppPlatform();
-        jsonObject.put("app_platform", appPlatform == null ? null : appPlatform.getType());
-        jsonObject.put("app_name", event.getAppName());
-        jsonObject.put("app_package_name", event.getAppPackageName());
-        jsonObject.put("app_version", event.getAppVersion());
-
-        // Client Details
-        // Server side requires these values to be populated to satisfy thrift union
-        jsonObject.put("client_advertising_id", event.getObfuscatedClientAdvertisingId());
-        jsonObject.put("client_do_not_track", event.getClientDoNotTrack());
-
-        // Device Details
-        jsonObject.put("device_manufacturer", event.getDeviceManufacturer());
-        jsonObject.put("device_model", event.getDeviceModel());
-        jsonObject.put("device_product", event.getDeviceProduct());
-        jsonObject.put("device_os_version", event.getDeviceOsVersion());
-
-        // These fields will actually be the dip value until deprecated and new fields
-        // added for future releases
-        jsonObject.put("device_screen_width_px", event.getDeviceScreenWidthDip());
-        jsonObject.put("device_screen_height_px", event.getDeviceScreenHeightDip());
-
-        // Geo Details
-        jsonObject.put("geo_lat", event.getGeoLat());
-        jsonObject.put("geo_lon", event.getGeoLon());
-        jsonObject.put("geo_accuracy_radius_meters", event.getGeoAccuracy());
-
-        // Performance Details
-        jsonObject.put("perf_duration_ms", event.getPerformanceDurationMs());
-
-        // Network Details
-        ClientMetadata.MoPubNetworkType moPubNetworkType = event.getNetworkType();
-        jsonObject.put("network_type", moPubNetworkType == null ? null : moPubNetworkType.getId());
-        jsonObject.put("network_operator_code", event.getNetworkOperatorCode());
-        jsonObject.put("network_operator_name", event.getNetworkOperatorName());
-        jsonObject.put("network_iso_country_code", event.getNetworkIsoCountryCode());
-        jsonObject.put("network_sim_code", event.getNetworkSimCode());
-        jsonObject.put("network_sim_operator_name", event.getNetworkSimOperatorName());
-        jsonObject.put("network_sim_iso_country_code", event.getNetworkSimIsoCountryCode());
-
-        // Request Details
-        jsonObject.put("req_id", event.getRequestId());
-        jsonObject.put("req_status_code", event.getRequestStatusCode());
-        jsonObject.put("req_uri", event.getRequestUri());
-        jsonObject.put("req_retries", event.getRequestRetries());
-
-        // Timestamp Details
-        jsonObject.put("timestamp_client", event.getTimestampUtcMs());
-
-        if (event instanceof ErrorEvent) {
-            ErrorEvent errorEvent = (ErrorEvent) event;
-            // Error Details
-            jsonObject.put("error_exception_class_name", errorEvent.getErrorExceptionClassName());
-            jsonObject.put("error_message", errorEvent.getErrorMessage());
-            jsonObject.put("error_stack_trace", errorEvent.getErrorStackTrace());
-            jsonObject.put("error_file_name", errorEvent.getErrorFileName());
-            jsonObject.put("error_class_name", errorEvent.getErrorClassName());
-            jsonObject.put("error_method_name", errorEvent.getErrorMethodName());
-            jsonObject.put("error_line_number", errorEvent.getErrorLineNumber());
-        }
-
-        return jsonObject;
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/LogCatEventRecorder.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/LogCatEventRecorder.java
deleted file mode 100644
index f983de70..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/LogCatEventRecorder.java
+++ /dev/null
@@ -1,11 +0,0 @@
-package com.mopub.common.event;
-
-import com.mopub.common.logging.MoPubLog;
-
-class LogCatEventRecorder implements EventRecorder {
-    @Override
-    public void record(final BaseEvent baseEvent) {
-        MoPubLog.d(baseEvent.toString());
-    }
-}
-
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/MoPubEvents.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/MoPubEvents.java
deleted file mode 100644
index 3e76abff..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/MoPubEvents.java
+++ /dev/null
@@ -1,55 +0,0 @@
-package com.mopub.common.event;
-
-import android.os.HandlerThread;
-
-import com.mopub.common.VisibleForTesting;
-
-import java.util.ArrayList;
-
-/**
- * Public interface used to record client events.
- */
-public class MoPubEvents {
-
-    private static volatile EventDispatcher sEventDispatcher;
-
-    /**
-     * Log a BaseEvent. MoPub uses logged events to analyze and improve performance.
-     * This method should not be called by app developers.
-     */
-    public static void log(BaseEvent baseEvent) {
-        MoPubEvents.getDispatcher().dispatch(baseEvent);
-    }
-
-    @VisibleForTesting
-    public static void setEventDispatcher(EventDispatcher dispatcher) {
-        sEventDispatcher = dispatcher;
-    }
-
-    /**
-     * Returns a singleton event dispatcher constructed with a single background thread meant to be
-     * used for all event logging operations. Operations that end up on the main thread, such as
-     * the result of a network request, should post to this background thread when interacting
-     * with shared resources in order to avoid concurrency issues.
-     *
-     * This design is meant to emulate an {@code IntentService} which we can't use due to
-     * the requirement of the publisher having to update their manifest file.
-     */
-    @VisibleForTesting
-    static EventDispatcher getDispatcher() {
-        EventDispatcher result = sEventDispatcher;
-        if (result == null) {
-            synchronized (MoPubEvents.class) {
-                result = sEventDispatcher;
-                if (result == null) {
-                    ArrayList<EventRecorder> recorders = new ArrayList<EventRecorder>();
-                    HandlerThread handlerThread = new HandlerThread("mopub_event_logging");
-                    handlerThread.start();
-                    recorders.add(new ScribeEventRecorder(handlerThread.getLooper()));
-                    result = sEventDispatcher = new EventDispatcher(recorders, handlerThread.getLooper());
-                }
-            }
-        }
-        return result;
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/NoopEventRecorder.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/NoopEventRecorder.java
deleted file mode 100644
index 5459ffbe..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/NoopEventRecorder.java
+++ /dev/null
@@ -1,8 +0,0 @@
-package com.mopub.common.event;
-
-class NoopEventRecorder implements EventRecorder {
-    @Override
-    public void record(final BaseEvent baseEvent) {
-    }
-}
-
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/ScribeEventRecorder.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/ScribeEventRecorder.java
deleted file mode 100644
index 96a63ae9..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/event/ScribeEventRecorder.java
+++ /dev/null
@@ -1,142 +0,0 @@
-package com.mopub.common.event;
-
-import android.os.Handler;
-import android.os.Looper;
-import android.support.annotation.NonNull;
-
-import com.mopub.common.VisibleForTesting;
-import com.mopub.common.logging.MoPubLog;
-import com.mopub.network.ScribeBackoffPolicy;
-import com.mopub.network.ScribeRequest;
-import com.mopub.network.ScribeRequestManager;
-
-import java.util.ArrayList;
-import java.util.LinkedList;
-import java.util.List;
-import java.util.Queue;
-
-/**
- * The ScribeEventRecorder manages events being sent to the Scribe service. It is responsible for
- * sampling, batching and kicking off network requests. It is also responsible for ensuring batched
- * events don't grow unbounded.
- */
-public class ScribeEventRecorder implements EventRecorder {
-    private static final String SCRIBE_URL = "https://analytics.mopub.com/i/jot/exchange_client_event";
-    private static final int QUEUE_MAX_SIZE = 500;
-
-    /**
-     * As of SDK 3.6.0, events are roughly 1200 bytes in size. 1200 * 100 = 0.114441 MiB
-     * This threshhold must always be < 1 MiB
-     */
-    private static final int EVENT_COUNT_SEND_THRESHHOLD = 100;
-
-    /**
-     * 2 minute polling time to check for send up events
-     */
-    private static final int POLLING_PERIOD_MS = 2 * 60 * 1000;
-
-    @NonNull private final EventSampler mEventSampler;
-    @NonNull private final Queue<BaseEvent> mEventQueue;
-    @NonNull private final EventSerializer mEventSerializer;
-    @NonNull private final ScribeRequestManager mScribeRequestManager;
-
-    @NonNull private final Handler mPollHandler;
-    @NonNull private final PollingRunnable mPollingRunnable;
-
-    ScribeEventRecorder(@NonNull Looper looper) {
-        this(new EventSampler(),
-                new LinkedList<BaseEvent>(),
-                new EventSerializer(),
-                new ScribeRequestManager(looper),
-                new Handler(looper));
-    }
-
-    @VisibleForTesting
-    ScribeEventRecorder(@NonNull EventSampler eventSampler,
-            @NonNull Queue<BaseEvent> eventQueue,
-            @NonNull EventSerializer eventSerializer,
-            @NonNull ScribeRequestManager scribeRequestManager,
-            @NonNull Handler handler) {
-        mEventSampler = eventSampler;
-        mEventQueue = eventQueue;
-        mEventSerializer = eventSerializer;
-        mScribeRequestManager = scribeRequestManager;
-        mPollHandler = handler;
-        mPollingRunnable = new PollingRunnable();
-    }
-
-    @Override
-    public void record(@NonNull BaseEvent baseEvent) {
-        if (!mEventSampler.sample(baseEvent)) {
-            return;
-        }
-
-        if (mEventQueue.size() >= QUEUE_MAX_SIZE) {
-            MoPubLog.d("EventQueue is at max capacity. " +
-                    "Event \"" + baseEvent.getName() + "\" is being dropped.");
-            return;
-        }
-
-        mEventQueue.add(baseEvent);
-        if (mEventQueue.size() >= EVENT_COUNT_SEND_THRESHHOLD) {
-            sendEvents();
-        }
-
-        scheduleNextPoll();
-    }
-
-    @VisibleForTesting
-    void sendEvents() {
-        if (mScribeRequestManager.isAtCapacity()) {
-            return;
-        }
-
-        final List<BaseEvent> events = dequeueEvents();
-        if (events.isEmpty()) {
-            return;
-        }
-
-        mScribeRequestManager.makeRequest(
-                new ScribeRequest.ScribeRequestFactory() {
-                    @Override
-                    public ScribeRequest createRequest(ScribeRequest.Listener listener) {
-                        return new ScribeRequest(SCRIBE_URL, events, mEventSerializer, listener);
-                    }
-                },
-                new ScribeBackoffPolicy()
-        );
-    }
-
-    @VisibleForTesting
-    @NonNull
-    List<BaseEvent> dequeueEvents() {
-        ArrayList<BaseEvent> baseEvents = new ArrayList<BaseEvent>();
-
-        // Note: Some queues do not have constant time O(1) performance for its #size()
-        // method, so we're peeking and polling instead
-        while (mEventQueue.peek() != null && baseEvents.size() < EVENT_COUNT_SEND_THRESHHOLD) {
-            baseEvents.add(mEventQueue.poll());
-        }
-        return baseEvents;
-    }
-
-    @VisibleForTesting
-    void scheduleNextPoll() {
-        // Only schedule if there are no messages already scheduled.
-        // The user defined message code, the 'what' param in Handler#hasMessages, defaults to
-        // 0 for posting a delayed runnable
-        if (mPollHandler.hasMessages(0) || mEventQueue.isEmpty()) {
-            return;
-        }
-
-        mPollHandler.postDelayed(mPollingRunnable, POLLING_PERIOD_MS);
-    }
-
-    class PollingRunnable implements Runnable {
-        @Override
-        public void run() {
-            sendEvents();
-            scheduleNextPoll();
-        }
-    }
-}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/AdvertisingId.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/AdvertisingId.java
new file mode 100644
index 00000000..eab380af
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/AdvertisingId.java
@@ -0,0 +1,148 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+import android.text.TextUtils;
+
+import com.mopub.common.Preconditions;
+
+import java.io.Serializable;
+import java.util.Calendar;
+import java.util.UUID;
+
+public class AdvertisingId implements Serializable {
+    static final long ROTATION_TIME_MS = 24 * 60 * 60 * 1000;
+    private static final String PREFIX_IFA = "ifa:";
+    private static final String PREFIX_MOPUB = "mopub:";
+
+    /**
+     * time when mopub generated ID was rotated last time
+     */
+    @NonNull
+    final Calendar mLastRotation;
+
+    /**
+     * Advertising ID from device, may not always be available.
+     * Empty string if ifa is not available.
+     */
+    @NonNull
+    final String mAdvertisingId;
+
+    /**
+     * virtual device ID, rotated every 24 hours
+     */
+    @NonNull
+    final String mMopubId;
+
+    /**
+     * limit ad tracking device setting
+     */
+    final boolean mDoNotTrack;
+
+    AdvertisingId(@NonNull String ifaId,
+                  @NonNull String mopubId,
+                  boolean limitAdTrackingEnabled,
+                  long rotationTime) {
+        Preconditions.checkNotNull(ifaId);
+        Preconditions.checkNotNull(ifaId);
+
+        mAdvertisingId = ifaId;
+        mMopubId = mopubId;
+        mDoNotTrack = limitAdTrackingEnabled;
+        mLastRotation = Calendar.getInstance();
+        mLastRotation.setTimeInMillis(rotationTime);
+    }
+
+    /**
+     * @param consent - true means user is OK to track his data for Ad purposes
+     * @return read advertising ID or UUID
+     */
+    public String getIdentifier(boolean consent) {
+        return mDoNotTrack || !consent ? mMopubId : mAdvertisingId;
+    }
+
+    /**
+     * @param consent - true means user is OK to track his data for Ad purposes
+     * @return one of two: "mopub:mMopubId" or "ifa:mAdvertisingId"
+     */
+    @NonNull
+    public String getIdWithPrefix(boolean consent) {
+        if (mDoNotTrack || !consent || mAdvertisingId.isEmpty()) {
+            return PREFIX_MOPUB + mMopubId;
+        }
+        return PREFIX_IFA + mAdvertisingId;
+    }
+
+    /**
+     * Gets the ifa with the ifa prefix.
+     *
+     * @return The ifa, if it exists. Empty string if it doesn't.
+     */
+    @NonNull
+    String getIfaWithPrefix() {
+        if (TextUtils.isEmpty(mAdvertisingId)) {
+            return "";
+        }
+        return PREFIX_IFA + mAdvertisingId;
+    }
+
+    /**
+     * @return device Do Not Track settings
+     */
+    public boolean isDoNotTrack() {
+        return mDoNotTrack;
+    }
+
+    @NonNull
+    static AdvertisingId generateExpiredAdvertisingId() {
+        Calendar time = Calendar.getInstance();
+        String mopubId = generateIdString();
+        return new AdvertisingId("", mopubId, false, time.getTimeInMillis() - ROTATION_TIME_MS - 1);
+    }
+
+    @NonNull
+    static AdvertisingId generateFreshAdvertisingId() {
+        Calendar time = Calendar.getInstance();
+        String mopubId = generateIdString();
+        return new AdvertisingId("", mopubId, false, time.getTimeInMillis());
+    }
+
+    @NonNull
+    static String generateIdString() {
+        return UUID.randomUUID().toString();
+    }
+
+    boolean isRotationRequired() {
+        Calendar now = Calendar.getInstance();
+        return now.getTimeInMillis() - mLastRotation.getTimeInMillis() >= ROTATION_TIME_MS;
+    }
+
+    @Override
+    public String toString() {
+        return "AdvertisingId{" +
+                "mLastRotation=" + mLastRotation +
+                ", mAdvertisingId='" + mAdvertisingId + '\'' +
+                ", mMopubId='" + mMopubId + '\'' +
+                ", mDoNotTrack=" + mDoNotTrack +
+                '}';
+    }
+
+    @Override
+    public boolean equals(Object o) {
+        if (this == o) return true;
+        if (!(o instanceof AdvertisingId)) return false;
+
+        AdvertisingId that = (AdvertisingId) o;
+
+        if (mDoNotTrack != that.mDoNotTrack) return false;
+        if (!mAdvertisingId.equals(that.mAdvertisingId)) return false;
+        return mMopubId.equals(that.mMopubId);
+    }
+
+    @Override
+    public int hashCode() {
+        int result = mAdvertisingId.hashCode();
+        result = 31 * result + mMopubId.hashCode();
+        result = 31 * result + (mDoNotTrack ? 1 : 0);
+        return result;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentChangeReason.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentChangeReason.java
new file mode 100644
index 00000000..3ac6864b
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentChangeReason.java
@@ -0,0 +1,36 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+
+public enum ConsentChangeReason {
+    GRANTED_BY_USER("Consent was explicitly granted by the user"),
+    GRANTED_BY_WHITELISTED_PUB("Consent was explicitly granted by a whitelisted publisher"),
+    GRANTED_BY_NOT_WHITELISTED_PUB(
+            "Consent was explicitly granted by a publisher who is not whitelisted"),
+    DENIED_BY_USER("Consent was explicitly denied by the user"),
+    DENIED_BY_PUB("Consent was explicitly denied by the publisher"),
+    DENIED_BY_DNT_ON("Limit ad tracking was enabled and consent implicitly denied by the user"),
+    DNT_OFF("Limit ad tracking was disabled"),
+    REACQUIRE_BECAUSE_DNT_OFF(
+            "Consent needs to be reacquired because the user disabled limit ad tracking"),
+    REACQUIRE_BECAUSE_PRIVACY_POLICY(
+            "Consent needs to be reacquired because the privacy policy has changed"),
+    REACUIRE_BECAUSE_VENDOR_LIST(
+            "Consent needs to be reacquired because the vendor list has changed"),
+    REAQUIRE_BECAUSE_IAB_VENDOR_LIST(
+            "Consent needs to be reacquired because the IAB vendor list has changed"),
+    REVOKED_BY_SERVER("Consent was revoked by the server"),
+    REACQUIRE_BY_SERVER("Server requires that consent needs to be reacquired"),
+    IFA_CHANGED("Consent needs to be reacquired because the IFA has changed");
+
+    @NonNull private final String mReason;
+
+    ConsentChangeReason(@NonNull final String reason) {
+        mReason = reason;
+    }
+
+    @NonNull
+    public String getReason() {
+        return mReason;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentData.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentData.java
new file mode 100644
index 00000000..df1509ab
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentData.java
@@ -0,0 +1,85 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+/**
+ * Has all the getters for getting the current and consented data around vendor lists and
+ * privacy policies.
+ */
+public interface ConsentData {
+    /**
+     * Returns the current vendor list version.
+     */
+    @Nullable
+    String getCurrentVendorListVersion();
+
+    /**
+     * Returns a link for the current vendor list with the system default language.
+     */
+    @NonNull
+    String getCurrentVendorListLink();
+
+    /**
+     * Returns a link for the current vendor list in a specific language. If the language is not a
+     * valid language, this will return the link with the system default language.
+     *
+     * @param language ISO 639-1 2-letter language code
+     */
+    @NonNull
+    String getCurrentVendorListLink(@Nullable final String language);
+
+    /**
+     * Returns the current privacy policy version.
+     */
+    @Nullable
+    String getCurrentPrivacyPolicyVersion();
+
+    /**
+     * Returns a link for the current privacy policy with the system default language.
+     */
+    @NonNull
+    String getCurrentPrivacyPolicyLink();
+
+    /**
+     * Returns a link for the current privacy policy in a specific language. If the language is not
+     * a valid language, this will return the link with the system default language.
+     *
+     * @param language ISO 639-1 2-letter language code
+     */
+    @NonNull
+    String getCurrentPrivacyPolicyLink(@Nullable final String language);
+
+    /**
+     * Returns the current vendor list in IAB's global vendor list format.
+     */
+    @Nullable
+    String getCurrentVendorListIabFormat();
+
+    /**
+     * Returns the version of the privacy policy that the user has consented to.
+     */
+    @Nullable
+    String getConsentedPrivacyPolicyVersion();
+
+    /**
+     * Returns the version of the vendor list that the user has consented to.
+     */
+    @Nullable
+    String getConsentedVendorListVersion();
+
+    /**
+     * Returns the consented vendor list in IAB's global vendor list format.
+     */
+    @Nullable
+    String getConsentedVendorListIabFormat();
+
+    /**
+     * Whether GDPR rules have been forced to apply by either the publisher or by MoPub. In
+     * general, publishers should not need to directly access this.
+     *
+     * @return True means GDPR rules will be applied, false means respect MoPub's geofencing when
+     * determining whether or not GDPR rules apply.
+     */
+    boolean isForceGdprApplies();
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogActivity.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogActivity.java
new file mode 100644
index 00000000..9888af19
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogActivity.java
@@ -0,0 +1,144 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.content.ActivityNotFoundException;
+import android.content.Context;
+import android.content.Intent;
+import android.os.Bundle;
+import android.os.Handler;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+import android.view.Window;
+import android.view.WindowManager;
+
+import com.mopub.common.MoPub;
+import com.mopub.common.Preconditions;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.util.Intents;
+import com.mopub.exceptions.IntentNotResolvableException;
+
+public class ConsentDialogActivity extends Activity {
+    private static final int CLOSE_BUTTON_DELAY_MS = 10000;
+    private static final String KEY_HTML_PAGE = "html-page-content";
+
+    @Nullable
+    ConsentDialogLayout mView;
+    @Nullable
+    private Runnable mEnableCloseButtonRunnable;
+    @Nullable
+    Handler mCloseButtonHandler;
+
+    @Nullable
+    ConsentStatus mConsentStatus;
+
+    static void start(@NonNull final Context context, @NonNull String htmlData) {
+        Preconditions.checkNotNull(context);
+
+        if (TextUtils.isEmpty(htmlData)) {
+            MoPubLog.e("ConsentDialogActivity htmlData can't be empty string.");
+            return;
+        }
+
+        Intent intent = createIntent(context, htmlData);
+        try {
+            Intents.startActivity(context, intent);
+        } catch (ActivityNotFoundException | IntentNotResolvableException e) {
+            MoPubLog.e("ConsentDialogActivity not found - did you declare it in AndroidManifest.xml?");
+        }
+    }
+
+    @NonNull
+    static Intent createIntent(@NonNull final Context context, @NonNull final String htmlPageContent) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(htmlPageContent);
+
+        Bundle extra = new Bundle();
+        extra.putString(KEY_HTML_PAGE, htmlPageContent);
+        return Intents.getStartActivityIntent(context, ConsentDialogActivity.class, extra);
+    }
+
+    @Override
+    protected void onCreate(@Nullable Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+
+        Intent intent = getIntent();
+        String htmlBody = intent.getStringExtra(KEY_HTML_PAGE);
+        if (TextUtils.isEmpty(htmlBody)) {
+            MoPubLog.e("Web page for ConsentDialogActivity is empty");
+            finish();
+            return;
+        }
+
+        requestWindowFeature(Window.FEATURE_NO_TITLE);
+        getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);
+
+        mView = new ConsentDialogLayout(this);
+        mView.setConsentClickListener(new ConsentDialogLayout.ConsentListener() {
+            @Override
+            public void onConsentClick(ConsentStatus status) {
+                saveConsentStatus(status);
+                setCloseButtonVisibility(false);
+            }
+
+            @Override
+            public void onCloseClick() {
+                finish();
+            }
+        });
+
+        mEnableCloseButtonRunnable = new Runnable() {
+            @Override
+            public void run() {
+                setCloseButtonVisibility(true);
+            }
+        };
+
+        setContentView(mView);
+
+        mView.startLoading(htmlBody, new ConsentDialogLayout.PageLoadListener() {
+            @Override
+            public void onLoadProgress(int progress) {
+                if (progress == ConsentDialogLayout.FINISHED_LOADING) {
+                }
+            }
+        });
+    }
+
+    @Override
+    protected void onStart() {
+        super.onStart();
+        mCloseButtonHandler = new Handler();
+        mCloseButtonHandler.postDelayed(mEnableCloseButtonRunnable, CLOSE_BUTTON_DELAY_MS);
+    }
+
+    @Override
+    protected void onStop() {
+        super.onStop();
+        setCloseButtonVisibility(true);
+    }
+
+    @Override
+    protected void onDestroy() {
+        final PersonalInfoManager infoManager = MoPub.getPersonalInformationManager();
+        if (infoManager != null && mConsentStatus != null) {
+            infoManager.changeConsentStateFromDialog(mConsentStatus);
+        }
+        super.onDestroy();
+    }
+
+
+    void setCloseButtonVisibility(boolean visible) {
+        if (mCloseButtonHandler != null) {
+            mCloseButtonHandler.removeCallbacks(mEnableCloseButtonRunnable);
+        }
+        if (mView != null) {
+            mView.setCloseVisible(visible);
+        }
+    }
+
+    private void saveConsentStatus(@NonNull final ConsentStatus status) {
+        Preconditions.checkNotNull(status);
+        mConsentStatus = status;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogController.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogController.java
new file mode 100644
index 00000000..d8b34bc8
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogController.java
@@ -0,0 +1,128 @@
+package com.mopub.common.privacy;
+
+import android.content.Context;
+import android.os.Handler;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import com.mopub.common.Constants;
+import com.mopub.common.Preconditions;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.mobileads.MoPubErrorCode;
+import com.mopub.network.MoPubNetworkError;
+import com.mopub.network.Networking;
+import com.mopub.volley.VolleyError;
+
+public class ConsentDialogController implements ConsentDialogRequest.Listener {
+    @NonNull
+    private final Context mAppContext;
+
+    @Nullable private String mHtmlBody;
+    @Nullable private ConsentDialogListener mExtListener;
+    volatile boolean mReady;
+    volatile boolean mRequestInFlight;
+    private final Handler mHandler;
+
+    ConsentDialogController(@NonNull final Context appContext) {
+        Preconditions.checkNotNull(appContext);
+
+        mAppContext = appContext.getApplicationContext();
+        mHandler = new Handler();
+    }
+
+    @Override
+    public void onSuccess(final ConsentDialogResponse response) {
+        mRequestInFlight = false;
+        mHtmlBody = response.getHtml();
+        if (TextUtils.isEmpty(mHtmlBody)) {
+            mReady = false;
+            if (mExtListener != null) {
+                mExtListener.onConsentDialogLoadFailed(MoPubErrorCode.INTERNAL_ERROR);
+            }
+            return;
+        }
+
+        mReady = true;
+        if (mExtListener != null) {
+            mExtListener.onConsentDialogLoaded();
+        }
+    }
+
+    @Override
+    public void onErrorResponse(final VolleyError volleyError) {
+        final ConsentDialogListener loadListener = mExtListener;
+        resetState();
+
+        if (loadListener == null) {
+            return;
+        }
+
+        if (volleyError instanceof MoPubNetworkError) {
+            switch(((MoPubNetworkError) volleyError).getReason()) {
+                case BAD_BODY:
+                    loadListener.onConsentDialogLoadFailed(MoPubErrorCode.INTERNAL_ERROR);
+                    return;
+                default:
+                    break;
+            }
+        }
+
+        loadListener.onConsentDialogLoadFailed(MoPubErrorCode.UNSPECIFIED);
+    }
+
+    synchronized void loadConsentDialog(@Nullable final ConsentDialogListener listener,
+            @Nullable final Boolean gdprApplies,
+            @NonNull final PersonalInfoData personalInfoData) {
+        Preconditions.checkNotNull(personalInfoData);
+
+        if (mReady) {
+            if (listener != null) {
+                mHandler.post(new Runnable() {
+                    @Override
+                    public void run() {
+                        listener.onConsentDialogLoaded();
+                    }
+                });
+            }
+            return;
+        } else if (mRequestInFlight) {
+            MoPubLog.d("Already making a consent dialog load request.");
+            return;
+        }
+
+        mExtListener = listener;
+        mRequestInFlight = true;
+
+        ConsentDialogRequest consentDialogRequest = new ConsentDialogRequest(mAppContext,
+                new ConsentDialogUrlGenerator(mAppContext, personalInfoData.getAdUnitId(),
+                        personalInfoData.getConsentStatus().getValue())
+                        .withGdprApplies(gdprApplies)
+                        .withConsentedPrivacyPolicyVersion(personalInfoData.getConsentedPrivacyPolicyVersion())
+                        .withConsentedVendorListVersion(personalInfoData.getConsentedVendorListVersion())
+                        .withForceGdprApplies(personalInfoData.isForceGdprApplies())
+                        .generateUrlString(Constants.HOST), this);
+        Networking.getRequestQueue(mAppContext).add(consentDialogRequest);
+    }
+
+    boolean showConsentDialog() {
+        if (!mReady || TextUtils.isEmpty(mHtmlBody)) {
+            return false;
+        }
+
+        ConsentDialogActivity.start(mAppContext, mHtmlBody);
+        resetState();
+        return true;
+    }
+
+    boolean isReady() {
+        return mReady;
+    }
+
+    private void resetState() {
+        mRequestInFlight = false;
+        mReady = false;
+        mExtListener = null;
+        mHtmlBody = null;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogLayout.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogLayout.java
new file mode 100644
index 00000000..bd407b6c
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogLayout.java
@@ -0,0 +1,169 @@
+package com.mopub.common.privacy;
+
+import android.annotation.SuppressLint;
+import android.content.Context;
+import android.content.Intent;
+import android.graphics.Bitmap;
+import android.net.Uri;
+import android.os.Build;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+import android.util.AttributeSet;
+import android.view.View;
+import android.webkit.WebSettings;
+import android.webkit.WebView;
+import android.webkit.WebViewClient;
+
+import com.mopub.common.CloseableLayout;
+import com.mopub.common.Constants;
+import com.mopub.common.Preconditions;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.util.Intents;
+import com.mopub.exceptions.IntentNotResolvableException;
+
+import static com.mopub.common.privacy.ConsentStatus.EXPLICIT_NO;
+import static com.mopub.common.privacy.ConsentStatus.EXPLICIT_YES;
+
+class ConsentDialogLayout extends CloseableLayout {
+    static int FINISHED_LOADING = 101;
+
+    final static String URL_CONSENT_YES = "mopub://consent?yes";
+    final static String URL_CONSENT_NO = "mopub://consent?no";
+    final static String URL_CLOSE = "mopub://close";
+
+    interface ConsentListener {
+        void onConsentClick(ConsentStatus state);
+        void onCloseClick();
+    }
+
+    interface PageLoadListener {
+        void onLoadProgress(int progress);
+    }
+
+    @NonNull
+    private final WebView mWebView;
+    @Nullable
+    private PageLoadListener mLoadListener;
+    @Nullable
+    private ConsentListener mConsentListener;
+
+    public ConsentDialogLayout(@NonNull Context context) {
+        super(context);
+        mWebView = initWebView();
+    }
+
+    public ConsentDialogLayout(@NonNull Context context, @Nullable AttributeSet attrs) {
+        super(context, attrs);
+        mWebView = initWebView();
+    }
+
+    public ConsentDialogLayout(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
+        super(context, attrs, defStyleAttr);
+        mWebView = initWebView();
+    }
+
+    void startLoading(@NonNull final String htmlData, @Nullable final PageLoadListener listener) {
+        Preconditions.checkNotNull(htmlData);
+
+        mLoadListener = listener;
+        setupEventsListeners(mWebView);
+
+        mWebView.loadDataWithBaseURL(Constants.HTTPS + "://" + Constants.HOST + "/",
+                htmlData, "text/html", "UTF-8", null);
+    }
+
+    void setConsentClickListener(@NonNull final ConsentListener consentListener) {
+        Preconditions.checkNotNull(consentListener);
+        mConsentListener = consentListener;
+    }
+
+    @SuppressLint("SetJavaScriptEnabled")
+    private WebView initWebView() {
+        WebView webView = new WebView(getContext());
+        webView.setVerticalScrollBarEnabled(false);
+        webView.setHorizontalScrollBarEnabled(false);
+
+        WebSettings webSettings = webView.getSettings();
+        webSettings.setSupportZoom(false);
+        webSettings.setBuiltInZoomControls(false);
+        webSettings.setLoadsImagesAutomatically(true);
+        webSettings.setLoadWithOverviewMode(true);
+
+        webSettings.setJavaScriptEnabled(true);
+        webSettings.setDomStorageEnabled(true);
+        webSettings.setAppCacheEnabled(true);
+        webSettings.setAppCachePath(getContext().getCacheDir().getAbsolutePath());
+        webSettings.setAllowFileAccess(false);
+        webSettings.setAllowContentAccess(false);
+
+        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.JELLY_BEAN) {
+            webSettings.setAllowUniversalAccessFromFileURLs(false);
+        }
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
+            webView.setId(View.generateViewId());
+        }
+        setCloseVisible(false);
+
+        addView(webView, new LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT));
+        return webView;
+    }
+
+    private void setupEventsListeners(@NonNull final WebView webView) {
+        webView.setWebViewClient(webViewClient);
+        setOnCloseListener(new CloseableLayout.OnCloseListener() {
+            @Override
+            public void onClose() {
+                if (mConsentListener != null) {
+                    mConsentListener.onCloseClick();
+                }
+            }
+        });
+    }
+
+    private final WebViewClient webViewClient = new WebViewClient() {
+        @Override
+        public void onPageStarted(WebView view, String url, Bitmap favicon) {
+            super.onPageStarted(view, url, favicon);
+            if (mLoadListener != null) {
+                mLoadListener.onLoadProgress(0);
+            }
+        }
+
+        @Override
+        public void onPageFinished(WebView view, String url) {
+            if (mLoadListener != null) {
+                mLoadListener.onLoadProgress(FINISHED_LOADING);
+            }
+            super.onPageFinished(view, url);
+        }
+
+        @Override
+        public boolean shouldOverrideUrlLoading(WebView view, String url) {
+            if (URL_CONSENT_YES.equals(url)) {
+                if (mConsentListener != null) {
+                    mConsentListener.onConsentClick(EXPLICIT_YES);
+                }
+                return true;
+            } else if (URL_CONSENT_NO.equals(url)) {
+                if (mConsentListener != null) {
+                    mConsentListener.onConsentClick(EXPLICIT_NO);
+                }
+                return true;
+            } else if (URL_CLOSE.equals(url)) {
+                if (mConsentListener != null) {
+                    mConsentListener.onCloseClick();
+                }
+                return true;
+            } else if (!TextUtils.isEmpty(url)) {
+                try {
+                    Intents.launchActionViewIntent(getContext(), Uri.parse(url), "Cannot open native browser for " + url);
+                    return true;
+                } catch (IntentNotResolvableException e) {
+                    MoPubLog.e(e.getMessage());
+                }
+            }
+            return super.shouldOverrideUrlLoading(view, url);
+        }
+    };
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogListener.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogListener.java
new file mode 100644
index 00000000..dcb84da2
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogListener.java
@@ -0,0 +1,22 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+
+import com.mopub.mobileads.MoPubErrorCode;
+
+/**
+ * Use this interface to listen to a successful or failed consent dialog load request.
+ */
+public interface ConsentDialogListener {
+    /**
+     * Called when the consent dialog successfully loads.
+     */
+    void onConsentDialogLoaded();
+
+    /**
+     * Called when the consent dialog fails to load.
+     *
+     * @param moPubErrorCode The reason why the dialog failed to load.
+     */
+    void onConsentDialogLoadFailed(@NonNull final MoPubErrorCode moPubErrorCode);
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogRequest.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogRequest.java
new file mode 100644
index 00000000..2d5c1cdf
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogRequest.java
@@ -0,0 +1,72 @@
+package com.mopub.common.privacy;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import com.mopub.network.MoPubNetworkError;
+import com.mopub.network.MoPubRequest;
+import com.mopub.volley.DefaultRetryPolicy;
+import com.mopub.volley.NetworkResponse;
+import com.mopub.volley.Response;
+import com.mopub.volley.toolbox.HttpHeaderParser;
+
+import org.json.JSONException;
+import org.json.JSONObject;
+
+class ConsentDialogRequest extends MoPubRequest<ConsentDialogResponse> {
+    private static final String HTML_KEY = "dialog_html";
+
+    public interface Listener extends Response.ErrorListener {
+        void onSuccess(ConsentDialogResponse response);
+    }
+
+    @Nullable
+    private Listener mListener;
+
+    ConsentDialogRequest(@NonNull Context context, @NonNull String url, @Nullable Listener listener) {
+        super(context, url, listener);
+
+        mListener = listener;
+
+        DefaultRetryPolicy retryPolicy = new DefaultRetryPolicy(
+                DefaultRetryPolicy.DEFAULT_TIMEOUT_MS,
+                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,
+                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT);
+        setRetryPolicy(retryPolicy);
+        setShouldCache(false);
+    }
+
+    @Override
+    protected Response<ConsentDialogResponse> parseNetworkResponse(final NetworkResponse networkResponse) {
+        final String responseBody = parseStringBody(networkResponse);
+
+        ConsentDialogResponse response;
+        try {
+            final JSONObject jsonBody = new JSONObject(responseBody);
+            String html = jsonBody.getString(HTML_KEY);
+            if (TextUtils.isEmpty(html)) {
+                throw new JSONException("Empty HTML body");
+            }
+            response = new ConsentDialogResponse(html);
+        } catch (JSONException e) {
+            return Response.error(
+                    new MoPubNetworkError(
+                            "Unable to parse consent dialog request network response.",
+                            MoPubNetworkError.Reason.BAD_BODY,
+                            null
+                    )
+            );
+        }
+
+        return Response.success(response, HttpHeaderParser.parseCacheHeaders(networkResponse));
+    }
+
+    @Override
+    protected void deliverResponse(ConsentDialogResponse consentDialogResponse) {
+        if (mListener != null) {
+            mListener.onSuccess(consentDialogResponse);
+        }
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogResponse.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogResponse.java
new file mode 100644
index 00000000..85107b98
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogResponse.java
@@ -0,0 +1,21 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+
+import com.mopub.common.Preconditions;
+
+class ConsentDialogResponse {
+    @NonNull
+    private final String mHtml;
+
+    ConsentDialogResponse(@NonNull final String html) {
+        Preconditions.checkNotNull(html);
+
+        mHtml = html;
+    }
+
+    @NonNull
+    public String getHtml() {
+        return mHtml;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogUrlGenerator.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogUrlGenerator.java
new file mode 100644
index 00000000..a19bb3ff
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentDialogUrlGenerator.java
@@ -0,0 +1,84 @@
+package com.mopub.common.privacy;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.common.BaseUrlGenerator;
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.MoPub;
+import com.mopub.common.Preconditions;
+
+import static com.mopub.common.Constants.GDPR_CONSENT_HANDLER;
+
+public class ConsentDialogUrlGenerator extends BaseUrlGenerator {
+    /**
+     * Current device default language.
+     */
+    private static final String LANGUAGE_KEY = "language";
+
+    @NonNull
+    private final Context mContext;
+    @NonNull
+    private final String mAdUnitId;
+    @NonNull
+    private final String mCurrentConsentStatus;
+    @Nullable
+    private Boolean mGdprApplies;
+    private boolean mForceGdprApplies;
+    @Nullable
+    private String mConsentedVendorListVersion;
+    @Nullable
+    private String mConsentedPrivacyPolicyVersion;
+
+    ConsentDialogUrlGenerator(@NonNull final Context context,
+            @NonNull final String adUnitId,
+            @NonNull final String currentConsentStatus) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(adUnitId);
+        Preconditions.checkNotNull(currentConsentStatus);
+
+        mContext = context.getApplicationContext();
+        mAdUnitId = adUnitId;
+        mCurrentConsentStatus = currentConsentStatus;
+    }
+
+    protected ConsentDialogUrlGenerator withGdprApplies(@Nullable final Boolean gdprApplies) {
+        mGdprApplies = gdprApplies;
+        return this;
+    }
+
+    protected ConsentDialogUrlGenerator withForceGdprApplies(final boolean forceGdprApplies) {
+        mForceGdprApplies = forceGdprApplies;
+        return this;
+    }
+
+    protected ConsentDialogUrlGenerator withConsentedVendorListVersion(
+            @Nullable final String consentedVendorListVersion) {
+        mConsentedVendorListVersion = consentedVendorListVersion;
+        return this;
+    }
+
+    protected ConsentDialogUrlGenerator withConsentedPrivacyPolicyVersion(
+            @Nullable final String consentedPrivacyPolicyVersion) {
+        mConsentedPrivacyPolicyVersion = consentedPrivacyPolicyVersion;
+        return this;
+    }
+
+    @Override
+    public String generateUrlString(String serverHostname) {
+        initUrlString(serverHostname, GDPR_CONSENT_HANDLER);
+
+        addParam(AD_UNIT_ID_KEY, mAdUnitId);
+        addParam(CURRENT_CONSENT_STATUS_KEY, mCurrentConsentStatus);
+        addParam(SDK_VERSION_KEY, MoPub.SDK_VERSION);
+        addParam(LANGUAGE_KEY, ClientMetadata.getCurrentLanguage(mContext));
+        addParam(GDPR_APPLIES, mGdprApplies);
+        addParam(FORCE_GDPR_APPLIES, mForceGdprApplies);
+        addParam(CONSENTED_VENDOR_LIST_VERSION_KEY, mConsentedVendorListVersion);
+        addParam(CONSENTED_PRIVACY_POLICY_VERSION_KEY, mConsentedPrivacyPolicyVersion);
+        addParam(BUNDLE_ID_KEY, ClientMetadata.getInstance(mContext).getAppPackageName());
+
+        return getFinalUrlString();
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentStatus.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentStatus.java
new file mode 100644
index 00000000..cba8a4b9
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentStatus.java
@@ -0,0 +1,69 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+/**
+ * Possible GDPR consent states.
+ */
+public enum ConsentStatus {
+    /**
+     * User has explicitly granted consent.
+     */
+    EXPLICIT_YES("explicit_yes"),
+
+    /**
+     * User has explicitly denied consent.
+     */
+    EXPLICIT_NO("explicit_no"),
+
+    /**
+     * The consent state is unknown due to not having synced to the server, or the user has never
+     * set a consent state.
+     */
+    UNKNOWN("unknown"),
+
+    /**
+     * The SDK has set the consent state to EXPLICIT_YES, but that is not something this publisher
+     * can do since they are not whitelisted. This state is treated as if the user has not granted
+     * consent, but the user should no longer be prompted with the dialog.
+     */
+    POTENTIAL_WHITELIST("potential_whitelist"),
+
+    /**
+     * "Do Not Track". The user has set the limit ad tracking flag on their device. This is as if
+     * the user has denied consent.
+     */
+    DNT("dnt");
+
+    @NonNull final private String mValue;
+
+    ConsentStatus(@NonNull final String value) {
+        mValue = value;
+    }
+
+    /**
+     * AdServer expects these values in this format.
+     *
+     * @return String value of the enum.
+     */
+    @NonNull
+    public String getValue() {
+        return mValue;
+    }
+
+    @NonNull
+    public static ConsentStatus fromString(@Nullable final String name) {
+        if (name == null) {
+            return UNKNOWN;
+        }
+
+        for (ConsentStatus consentState : ConsentStatus.values()) {
+            if (name.equals(consentState.name())) {
+                return consentState;
+            }
+        }
+
+        return UNKNOWN;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentStatusChangeListener.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentStatusChangeListener.java
new file mode 100644
index 00000000..4333abbb
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/ConsentStatusChangeListener.java
@@ -0,0 +1,20 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+
+/**
+ * Add one of these to PersonalInfoManager#subscribeConsentStatusChangeListener to listen for
+ * status changes.
+ */
+public interface ConsentStatusChangeListener {
+    /**
+     * Called when a consent status transition happens.
+     *
+     * @param oldConsentStatus              The old consent status.
+     * @param newConsentStatus              The new consent status.
+     * @param canCollectPersonalInformation True if the sdk is allowed to collect personally identifiable information, false otherwise.
+     */
+    void onConsentStateChange(@NonNull final ConsentStatus oldConsentStatus,
+            @NonNull final ConsentStatus newConsentStatus,
+            boolean canCollectPersonalInformation);
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/MoPubIdentifier.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/MoPubIdentifier.java
new file mode 100644
index 00000000..c2ffb928
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/MoPubIdentifier.java
@@ -0,0 +1,262 @@
+package com.mopub.common.privacy;
+
+import android.content.ContentResolver;
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.os.AsyncTask;
+import android.provider.Settings;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import com.mopub.common.GpsHelper;
+import com.mopub.common.Preconditions;
+import com.mopub.common.SdkInitializationListener;
+import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+
+import java.util.Calendar;
+
+public class MoPubIdentifier {
+
+    public interface AdvertisingIdChangeListener {
+        void onIdChanged(@NonNull final AdvertisingId oldId, @NonNull final AdvertisingId newId);
+    }
+
+    private static final String PREF_AD_INFO_GROUP = "com.mopub.settings.identifier";
+    private static final String PREF_IFA_IDENTIFIER = "privacy.identifier.ifa";
+    private static final String PREF_MOPUB_IDENTIFIER = "privacy.identifier.mopub";
+    private static final String PREF_IDENTIFIER_TIME = "privacy.identifier.time";
+    private static final String PREF_LIMIT_AD_TRACKING = "privacy.limit.ad.tracking";
+    private static final int MISSING_VALUE = -1;
+
+    @NonNull
+    private AdvertisingId mAdInfo;
+
+    @NonNull
+    private final Context mAppContext;
+
+    @Nullable
+    private AdvertisingIdChangeListener mIdChangeListener;
+
+    private boolean mRefreshingAdvertisingInfo;
+
+    private boolean initialized;
+
+    @Nullable
+    private SdkInitializationListener mInitializationListener;
+
+    public MoPubIdentifier(@NonNull final Context appContext) {
+        this(appContext, null);
+    }
+
+    @VisibleForTesting
+    MoPubIdentifier(@NonNull final Context appContext,
+                    @Nullable final AdvertisingIdChangeListener idChangeListener) {
+        Preconditions.checkNotNull(appContext);
+
+        mAppContext = appContext;
+        mIdChangeListener = idChangeListener;
+        mAdInfo = readIdFromStorage(mAppContext);
+        if (mAdInfo == null) {
+            mAdInfo = AdvertisingId.generateExpiredAdvertisingId();
+        }
+        refreshAdvertisingInfo();
+    }
+
+    /**
+     * @return the most recent advertising ID and Do Not Track settings. This method  internally
+     * initiates AdvertisingId refresh. The value is returned instantly on UI thread,
+     * but may take some time to communicate with Google Play Services API when called
+     * from background thread.
+     */
+    @NonNull
+    public AdvertisingId getAdvertisingInfo() {
+        final AdvertisingId adInfo = mAdInfo;
+        refreshAdvertisingInfo();
+        return adInfo;
+    }
+
+    private void refreshAdvertisingInfo() {
+        if (mRefreshingAdvertisingInfo) {
+            return;
+        }
+        mRefreshingAdvertisingInfo = true;
+        new RefreshAdvertisingInfoAsyncTask().execute();
+    }
+
+    void refreshAdvertisingInfoBackgroundThread() {
+        long time = Calendar.getInstance().getTimeInMillis();
+
+        // try google
+        if (isPlayServicesAvailable()) {
+            GpsHelper.AdvertisingInfo info = GpsHelper.fetchAdvertisingInfoSync(mAppContext);
+            if (info != null && !TextUtils.isEmpty(info.advertisingId)) {
+                final AdvertisingId oldId = mAdInfo;
+                if (oldId.isRotationRequired()) {
+                    setAdvertisingInfo(info.advertisingId, AdvertisingId.generateIdString(), info.limitAdTracking, time);
+                } else {
+                    setAdvertisingInfo(info.advertisingId, oldId.mMopubId, info.limitAdTracking, oldId.mLastRotation.getTimeInMillis());
+                }
+                return;
+            } else {
+                MoPubLog.w("Call to 'getAdvertisingIdInfo' returned invalid value.");
+            }
+        }
+
+        // try amazon
+        final AdvertisingId info = getAmazonAdvertisingInfo(mAppContext);
+        if (info != null && !TextUtils.isEmpty(info.mAdvertisingId)) {
+            final AdvertisingId oldId = mAdInfo;
+            if (oldId.isRotationRequired()) {
+                setAdvertisingInfo(info.mAdvertisingId, AdvertisingId.generateIdString(), info.mDoNotTrack, time);
+            } else {
+                setAdvertisingInfo(info.mAdvertisingId, oldId.mMopubId, info.mDoNotTrack, oldId.mLastRotation.getTimeInMillis());
+            }
+            return;
+        }
+
+        // MoPub
+        rotateMopubId();
+    }
+
+    @Nullable
+    static synchronized AdvertisingId readIdFromStorage(@NonNull final Context appContext) {
+        Preconditions.checkNotNull(appContext);
+
+        Calendar now = Calendar.getInstance();
+        try {
+            final SharedPreferences preferences = SharedPreferencesHelper.getSharedPreferences(appContext, PREF_AD_INFO_GROUP);
+            final String ifa_id = preferences.getString(PREF_IFA_IDENTIFIER, "");
+            final String mopub_id = preferences.getString(PREF_MOPUB_IDENTIFIER, "");
+            final long time = preferences.getLong(PREF_IDENTIFIER_TIME, now.getTimeInMillis());
+            final boolean limitTracking = preferences.getBoolean(PREF_LIMIT_AD_TRACKING, false);
+            if (!TextUtils.isEmpty(ifa_id) && !TextUtils.isEmpty(mopub_id)) {
+                return new AdvertisingId(ifa_id, mopub_id, limitTracking, time);
+            }
+        } catch (ClassCastException ex) {
+            MoPubLog.e("Cannot read identifier from shared preferences");
+        }
+        return null;
+    }
+
+    private static synchronized void writeIdToStorage(@NonNull final Context context, @NonNull final AdvertisingId info) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(info);
+
+        final SharedPreferences preferences = SharedPreferencesHelper.getSharedPreferences(context, PREF_AD_INFO_GROUP);
+        final SharedPreferences.Editor editor = preferences.edit();
+        editor.putBoolean(PREF_LIMIT_AD_TRACKING, info.mDoNotTrack);
+        editor.putString(PREF_IFA_IDENTIFIER, info.mAdvertisingId);
+        editor.putString(PREF_MOPUB_IDENTIFIER, info.mMopubId);
+        editor.putLong(PREF_IDENTIFIER_TIME, info.mLastRotation.getTimeInMillis());
+        editor.apply();
+    }
+
+    @VisibleForTesting
+    static synchronized void clearStorage(@NonNull final Context context) {
+        Preconditions.checkNotNull(context);
+
+        final SharedPreferences preferences = SharedPreferencesHelper.getSharedPreferences(context, PREF_AD_INFO_GROUP);
+        final SharedPreferences.Editor editor = preferences.edit();
+        editor.remove(PREF_LIMIT_AD_TRACKING);
+        editor.remove(PREF_IFA_IDENTIFIER);
+        editor.remove(PREF_MOPUB_IDENTIFIER);
+        editor.remove(PREF_IDENTIFIER_TIME);
+        editor.apply();
+    }
+
+    void rotateMopubId() {
+        if (!mAdInfo.isRotationRequired()) {
+            setAdvertisingInfo(mAdInfo);
+            return;
+        }
+
+        setAdvertisingInfo(AdvertisingId.generateFreshAdvertisingId());
+    }
+
+    private void setAdvertisingInfo(@NonNull String advertisingId, @NonNull String mopubId, boolean limitAdTracking, long rotationTime) {
+        Preconditions.checkNotNull(advertisingId);
+        Preconditions.checkNotNull(mopubId);
+
+        setAdvertisingInfo(new AdvertisingId(advertisingId, mopubId, limitAdTracking, rotationTime));
+    }
+
+    void setAdvertisingInfo(@NonNull final AdvertisingId newId) {
+        AdvertisingId oldId = mAdInfo;
+        mAdInfo = newId;
+        writeIdToStorage(mAppContext, mAdInfo);
+
+        if (!mAdInfo.equals(oldId) || !initialized) {
+            notifyIdChangeListener(oldId, mAdInfo);
+        }
+        initialized = true;
+
+        reportInitializationComplete();
+    }
+
+    /**
+     * @param idChangeListener - will be called every time the OS Advertising ID or
+     *                         flag do-not-track changes its value. Pass null to stop listening.
+     */
+    public void setIdChangeListener(@Nullable final AdvertisingIdChangeListener idChangeListener) {
+        mIdChangeListener = idChangeListener;
+    }
+
+    void setInitializationListener(@Nullable final SdkInitializationListener initializationListener) {
+        mInitializationListener = initializationListener;
+        if (initialized) {
+            reportInitializationComplete();
+        }
+    }
+
+    private void reportInitializationComplete() {
+        if (mInitializationListener != null) {
+            mInitializationListener.onInitializationFinished();
+            mInitializationListener = null;
+        }
+    }
+
+    private void notifyIdChangeListener(@NonNull final AdvertisingId oldId, @NonNull final AdvertisingId newId) {
+        Preconditions.checkNotNull(newId);
+
+        if (mIdChangeListener != null) {
+            mIdChangeListener.onIdChanged(oldId, newId);
+        }
+    }
+
+    boolean isPlayServicesAvailable() {
+        return GpsHelper.isPlayServicesAvailable(mAppContext);
+    }
+
+    // For Amazon tablets running Fire OS 5.1+ and TV devices running Fire OS 5.2.1.1+, the
+    // advertising info is available as System Settings.
+    // See https://developer.amazon.com/public/solutions/devices/fire-tv/docs/fire-tv-advertising-id
+    @Nullable
+    private AdvertisingId getAmazonAdvertisingInfo(@NonNull final Context context) {
+        Preconditions.NoThrow.checkNotNull(context);
+
+        ContentResolver resolver = context.getContentResolver();
+        int limitAdTracking = Settings.Secure.getInt(resolver, "limit_ad_tracking", MISSING_VALUE);
+        String advertisingId = Settings.Secure.getString(resolver, "advertising_id");
+
+        if (limitAdTracking != MISSING_VALUE && !TextUtils.isEmpty(advertisingId)) {
+            boolean doNotTrack = limitAdTracking != 0;
+            final AdvertisingId oldId = mAdInfo;
+            // merge Amazon and MoPub data in one object
+            return new AdvertisingId(advertisingId, oldId.mMopubId, doNotTrack, oldId.mLastRotation.getTimeInMillis());
+        }
+        return null;
+    }
+
+    private class RefreshAdvertisingInfoAsyncTask extends AsyncTask<Void, Void, Void> {
+
+        @Override
+        protected Void doInBackground(final Void... voids) {
+            refreshAdvertisingInfoBackgroundThread();
+            mRefreshingAdvertisingInfo = false;
+            return null;
+        }
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PersonalInfoData.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PersonalInfoData.java
new file mode 100644
index 00000000..7960e5f2
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PersonalInfoData.java
@@ -0,0 +1,398 @@
+package com.mopub.common.privacy;
+
+
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.Preconditions;
+import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.VisibleForTesting;
+
+import java.util.Locale;
+
+class PersonalInfoData implements ConsentData {
+
+    private static final String PERSONAL_INFO_DATA_SHARED_PREFS = "com.mopub.privacy";
+    private static final String PERSONAL_INFO_PREFIX = "info/";
+    private static final String AD_UNIT_ID_SP_KEY = PERSONAL_INFO_PREFIX + "adunit";
+    private static final String CONSENT_STATUS_SP_KEY = PERSONAL_INFO_PREFIX + "consent_status";
+    private static final String LAST_SUCCESSFULLY_SYNCED_CONSENT_STATUS_SP_KEY = PERSONAL_INFO_PREFIX + "last_successfully_synced_consent_status";
+    private static final String IS_WHITELISTED_SP_KEY = PERSONAL_INFO_PREFIX + "is_whitelisted";
+    private static final String CURRENT_VENDOR_LIST_VERSION_SP_KEY = PERSONAL_INFO_PREFIX + "current_vendor_list_version";
+    private static final String CURRENT_VENDOR_LIST_LINK_SP_KEY = PERSONAL_INFO_PREFIX + "current_vendor_list_link";
+    private static final String CURRENT_PRIVACY_POLICY_VERSION_SP_KEY = PERSONAL_INFO_PREFIX + "current_privacy_policy_version";
+    private static final String CURRENT_PRIVACY_POLICY_LINK_SP_KEY = PERSONAL_INFO_PREFIX + "current_privacy_policy_link";
+    private static final String CURRENT_VENDOR_LIST_IAB_FORMAT_SP_KEY = PERSONAL_INFO_PREFIX + "current_vendor_list_iab_format";
+    private static final String CURRENT_VENDOR_LIST_IAB_HASH_SP_KEY = PERSONAL_INFO_PREFIX + "current_vendor_list_iab_hash";
+    private static final String CONSENTED_VENDOR_LIST_VERSION_SP_KEY = PERSONAL_INFO_PREFIX + "consented_vendor_list_version";
+    private static final String CONSENTED_PRIVACY_POLICY_VERSION_SP_KEY = PERSONAL_INFO_PREFIX + "consented_privacy_policy_version";
+    private static final String CONSENTED_VENDOR_LIST_IAB_FORMAT_SP_KEY = PERSONAL_INFO_PREFIX + "consented_vendor_list_iab_format";
+    private static final String EXTRAS_SP_KEY = PERSONAL_INFO_PREFIX + "extras";
+    private static final String CONSENT_CHANGE_REASON_SP_KEY = PERSONAL_INFO_PREFIX + "consent_change_reason";
+    private static final String REACQUIRE_CONSENT_SP_KEY = PERSONAL_INFO_PREFIX + "reacquire_consent";
+    private static final String GDPR_APPLIES_SP_KEY = PERSONAL_INFO_PREFIX + "gdpr_applies";
+    private static final String FORCE_GDPR_APPLIES_SP_KEY = PERSONAL_INFO_PREFIX + "force_gdpr_applies";
+    private static final String UDID_SP_KEY = PERSONAL_INFO_PREFIX + "udid";
+    private static final String LAST_CHANGED_MS_SP_KEY = PERSONAL_INFO_PREFIX + "last_changed_ms";
+    private static final String CONSENT_STATUS_BEFORE_DNT_SP_KEY = PERSONAL_INFO_PREFIX + "consent_status_before_dnt";
+
+    /**
+     * If this is found in a url, replace it with the device default language.
+     */
+    private static final String LANGUAGE_MACRO_KEY = "%%LANGUAGE%%";
+
+    @NonNull private final Context mAppContext;
+
+    // Values that are locally generated
+    @NonNull private String mAdUnitId;
+    @NonNull private ConsentStatus mConsentStatus;
+    @Nullable private ConsentStatus mLastSuccessfullySyncedConsentStatus;
+    @Nullable private String mConsentChangeReason;
+    private boolean mForceGdprApplies;
+    @Nullable private String mUdid;
+    @Nullable private String mLastChangedMs;
+    @Nullable private ConsentStatus mConsentStatusBeforeDnt;
+
+    // From server
+    private boolean mIsWhitelisted;
+    @Nullable private String mCurrentVendorListVersion;
+    @Nullable private String mCurrentVendorListLink;
+    @Nullable private String mCurrentPrivacyPolicyVersion;
+    @Nullable private String mCurrentPrivacyPolicyLink;
+    @Nullable private String mCurrentVendorListIabFormat;
+    @Nullable private String mCurrentVendorListIabHash;
+    @Nullable private String mConsentedVendorListVersion;
+    @Nullable private String mConsentedPrivacyPolicyVersion;
+    @Nullable private String mConsentedVendorListIabFormat;
+    @Nullable private String mExtras;
+    private boolean mReacquireConsent;
+    @Nullable private Boolean mGdprApplies;
+
+    PersonalInfoData(@NonNull final Context context, @NonNull final String adUnitId) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(adUnitId);
+
+        mAppContext = context.getApplicationContext();
+        mConsentStatus = ConsentStatus.UNKNOWN;
+        getStateFromDisk();
+        mAdUnitId = adUnitId;
+    }
+
+    private void getStateFromDisk() {
+        final SharedPreferences sharedPreferences = SharedPreferencesHelper.getSharedPreferences(
+                mAppContext, PERSONAL_INFO_DATA_SHARED_PREFS);
+        mAdUnitId = sharedPreferences.getString(AD_UNIT_ID_SP_KEY, "");
+        mConsentStatus = ConsentStatus.fromString(sharedPreferences.getString(
+                CONSENT_STATUS_SP_KEY, ConsentStatus.UNKNOWN.name()));
+        final String lastSuccessfullySyncedConsentStatusString = sharedPreferences.getString(
+                LAST_SUCCESSFULLY_SYNCED_CONSENT_STATUS_SP_KEY, null);
+        if (TextUtils.isEmpty(lastSuccessfullySyncedConsentStatusString)) {
+            mLastSuccessfullySyncedConsentStatus = null;
+        } else {
+            mLastSuccessfullySyncedConsentStatus =
+                    ConsentStatus.fromString(lastSuccessfullySyncedConsentStatusString);
+        }
+        mIsWhitelisted = sharedPreferences.getBoolean(IS_WHITELISTED_SP_KEY, false);
+        mCurrentVendorListVersion = sharedPreferences.getString(CURRENT_VENDOR_LIST_VERSION_SP_KEY,
+                null);
+        mCurrentVendorListLink = sharedPreferences.getString(CURRENT_VENDOR_LIST_LINK_SP_KEY, null);
+        mCurrentPrivacyPolicyVersion = sharedPreferences.getString(
+                CURRENT_PRIVACY_POLICY_VERSION_SP_KEY, null);
+        mCurrentPrivacyPolicyLink = sharedPreferences.getString(CURRENT_PRIVACY_POLICY_LINK_SP_KEY,
+                null);
+        mCurrentVendorListIabFormat = sharedPreferences.getString(
+                CURRENT_VENDOR_LIST_IAB_FORMAT_SP_KEY, null);
+        mCurrentVendorListIabHash = sharedPreferences.getString(CURRENT_VENDOR_LIST_IAB_HASH_SP_KEY,
+                null);
+        mConsentedVendorListVersion = sharedPreferences.getString(
+                CONSENTED_VENDOR_LIST_VERSION_SP_KEY, null);
+        mConsentedPrivacyPolicyVersion = sharedPreferences.getString(
+                CONSENTED_PRIVACY_POLICY_VERSION_SP_KEY, null);
+        mConsentedVendorListIabFormat = sharedPreferences.getString(
+                CONSENTED_VENDOR_LIST_IAB_FORMAT_SP_KEY, null);
+        mExtras = sharedPreferences.getString(EXTRAS_SP_KEY, null);
+        mConsentChangeReason = sharedPreferences.getString(CONSENT_CHANGE_REASON_SP_KEY, null);
+        mReacquireConsent = sharedPreferences.getBoolean(REACQUIRE_CONSENT_SP_KEY, false);
+        final String gdprAppliesString = sharedPreferences.getString(GDPR_APPLIES_SP_KEY, null);
+        if (TextUtils.isEmpty(gdprAppliesString)) {
+            mGdprApplies = null;
+        } else {
+            mGdprApplies = Boolean.parseBoolean(gdprAppliesString);
+        }
+        mForceGdprApplies = sharedPreferences.getBoolean(FORCE_GDPR_APPLIES_SP_KEY, false);
+        mUdid = sharedPreferences.getString(UDID_SP_KEY, null);
+        mLastChangedMs = sharedPreferences.getString(LAST_CHANGED_MS_SP_KEY, null);
+        final String consentStatusBeforeDnt = sharedPreferences.getString(
+                CONSENT_STATUS_BEFORE_DNT_SP_KEY, null);
+        if (TextUtils.isEmpty(consentStatusBeforeDnt)) {
+            mConsentStatusBeforeDnt = null;
+        } else {
+            mConsentStatusBeforeDnt = ConsentStatus.fromString(consentStatusBeforeDnt);
+        }
+    }
+
+    void writeToDisk() {
+        final SharedPreferences.Editor editor = SharedPreferencesHelper.getSharedPreferences(
+                mAppContext, PERSONAL_INFO_DATA_SHARED_PREFS).edit();
+        editor.putString(AD_UNIT_ID_SP_KEY, mAdUnitId);
+        editor.putString(CONSENT_STATUS_SP_KEY, mConsentStatus.name());
+        editor.putString(LAST_SUCCESSFULLY_SYNCED_CONSENT_STATUS_SP_KEY,
+                mLastSuccessfullySyncedConsentStatus == null ? null : mLastSuccessfullySyncedConsentStatus.name());
+        editor.putBoolean(IS_WHITELISTED_SP_KEY, mIsWhitelisted);
+        editor.putString(CURRENT_VENDOR_LIST_VERSION_SP_KEY, mCurrentVendorListVersion);
+        editor.putString(CURRENT_VENDOR_LIST_LINK_SP_KEY, mCurrentVendorListLink);
+        editor.putString(CURRENT_PRIVACY_POLICY_VERSION_SP_KEY, mCurrentPrivacyPolicyVersion);
+        editor.putString(CURRENT_PRIVACY_POLICY_LINK_SP_KEY, mCurrentPrivacyPolicyLink);
+        editor.putString(CURRENT_VENDOR_LIST_IAB_FORMAT_SP_KEY, mCurrentVendorListIabFormat);
+        editor.putString(CURRENT_VENDOR_LIST_IAB_HASH_SP_KEY, mCurrentVendorListIabHash);
+        editor.putString(CONSENTED_VENDOR_LIST_VERSION_SP_KEY, mConsentedVendorListVersion);
+        editor.putString(CONSENTED_PRIVACY_POLICY_VERSION_SP_KEY, mConsentedPrivacyPolicyVersion);
+        editor.putString(CONSENTED_VENDOR_LIST_IAB_FORMAT_SP_KEY, mConsentedVendorListIabFormat);
+        editor.putString(EXTRAS_SP_KEY, mExtras);
+        editor.putString(CONSENT_CHANGE_REASON_SP_KEY, mConsentChangeReason);
+        editor.putBoolean(REACQUIRE_CONSENT_SP_KEY, mReacquireConsent);
+        editor.putString(GDPR_APPLIES_SP_KEY,
+                mGdprApplies == null ? null : mGdprApplies.toString());
+        editor.putBoolean(FORCE_GDPR_APPLIES_SP_KEY, mForceGdprApplies);
+        editor.putString(UDID_SP_KEY, mUdid);
+        editor.putString(LAST_CHANGED_MS_SP_KEY, mLastChangedMs);
+        editor.putString(CONSENT_STATUS_BEFORE_DNT_SP_KEY,
+                mConsentStatusBeforeDnt == null ? null : mConsentStatusBeforeDnt.name());
+        editor.apply();
+    }
+
+    @NonNull
+    String getAdUnitId() {
+        return mAdUnitId;
+    }
+
+    @NonNull
+    ConsentStatus getConsentStatus() {
+        return mConsentStatus;
+    }
+
+    void setConsentStatus(@NonNull final ConsentStatus consentStatus) {
+        mConsentStatus = consentStatus;
+    }
+
+    @Nullable
+    ConsentStatus getLastSuccessfullySyncedConsentStatus() {
+        return mLastSuccessfullySyncedConsentStatus;
+    }
+
+    void setLastSuccessfullySyncedConsentStatus(
+            @Nullable final ConsentStatus lastSuccessfullySyncedConsentStatus) {
+        mLastSuccessfullySyncedConsentStatus = lastSuccessfullySyncedConsentStatus;
+    }
+
+    boolean isWhitelisted() {
+        return mIsWhitelisted;
+    }
+
+    void setWhitelisted(boolean whitelisted) {
+        mIsWhitelisted = whitelisted;
+    }
+
+    @Nullable
+    public String getCurrentVendorListVersion() {
+        return mCurrentVendorListVersion;
+    }
+
+    void setCurrentVendorListVersion(@Nullable final String currentVendorListVersion) {
+        mCurrentVendorListVersion = currentVendorListVersion;
+    }
+
+    @NonNull
+    public String getCurrentVendorListLink() {
+        return getCurrentVendorListLink(null);
+    }
+
+    @NonNull
+    public String getCurrentVendorListLink(@Nullable final String language) {
+        return replaceLanguageMacro(mCurrentVendorListLink, mAppContext,
+                language);
+    }
+
+    void setCurrentVendorListLink(@Nullable final String currentVendorListLink) {
+        mCurrentVendorListLink = currentVendorListLink;
+    }
+
+    @Nullable
+    public String getCurrentPrivacyPolicyVersion() {
+        return mCurrentPrivacyPolicyVersion;
+    }
+
+    void setCurrentPrivacyPolicyVersion(@Nullable final String currentPrivacyPolicyVersion) {
+        mCurrentPrivacyPolicyVersion = currentPrivacyPolicyVersion;
+    }
+
+    @NonNull
+    public String getCurrentPrivacyPolicyLink() {
+        return getCurrentPrivacyPolicyLink(null);
+    }
+
+    @NonNull
+    public String getCurrentPrivacyPolicyLink(@Nullable final String language) {
+        return replaceLanguageMacro(mCurrentPrivacyPolicyLink, mAppContext,
+                language);
+    }
+
+    void setCurrentPrivacyPolicyLink(@Nullable final String currentPrivacyPolicyLink) {
+        mCurrentPrivacyPolicyLink = currentPrivacyPolicyLink;
+    }
+
+    @Nullable
+    public String getCurrentVendorListIabFormat() {
+        return mCurrentVendorListIabFormat;
+    }
+
+    void setCurrentVendorListIabFormat(@Nullable final String currentVendorListIabFormat) {
+        mCurrentVendorListIabFormat = currentVendorListIabFormat;
+    }
+
+    @Nullable
+    String getCurrentVendorListIabHash() {
+        return mCurrentVendorListIabHash;
+    }
+
+    void setCurrentVendorListIabHash(@Nullable final String currentVendorListIabHash) {
+        mCurrentVendorListIabHash = currentVendorListIabHash;
+    }
+
+    @Nullable
+    public String getConsentedVendorListVersion() {
+        return mConsentedVendorListVersion;
+    }
+
+    void setConsentedVendorListVersion(@Nullable final String consentedVendorListVersion) {
+        mConsentedVendorListVersion = consentedVendorListVersion;
+    }
+
+    @Nullable
+    public String getConsentedPrivacyPolicyVersion() {
+        return mConsentedPrivacyPolicyVersion;
+    }
+
+    void setConsentedPrivacyPolicyVersion(
+            @Nullable final String consentedPrivacyPolicyVersion) {
+        mConsentedPrivacyPolicyVersion = consentedPrivacyPolicyVersion;
+    }
+
+    @Nullable
+    public String getConsentedVendorListIabFormat() {
+        return mConsentedVendorListIabFormat;
+    }
+
+    void setConsentedVendorListIabFormat(
+            @Nullable final String consentedVendorListIabFormat) {
+        mConsentedVendorListIabFormat = consentedVendorListIabFormat;
+    }
+
+    @Nullable
+    public String getExtras() {
+        return mExtras;
+    }
+
+    public void setExtras(@Nullable final String extras) {
+        mExtras = extras;
+    }
+
+    @Nullable
+    String getConsentChangeReason() {
+        return mConsentChangeReason;
+    }
+
+    void setConsentChangeReason(@Nullable final String consentChangeReason) {
+        mConsentChangeReason = consentChangeReason;
+    }
+
+    boolean shouldReacquireConsent() {
+        return mReacquireConsent;
+    }
+
+    void setShouldReacquireConsent(final boolean reacquireConsent) {
+        mReacquireConsent = reacquireConsent;
+    }
+
+    @Nullable
+    Boolean getGdprApplies() {
+        return mGdprApplies;
+    }
+
+    void setGdprApplies(@Nullable final Boolean gdprApplies) {
+        mGdprApplies = gdprApplies;
+    }
+
+    public boolean isForceGdprApplies() {
+        return mForceGdprApplies;
+    }
+
+    void setForceGdprApplies(final boolean forceGdprApplies) {
+        mForceGdprApplies = forceGdprApplies;
+    }
+
+    @Nullable
+    String getUdid() {
+        return mUdid;
+    }
+
+    void setUdid(@Nullable final String udid) {
+        mUdid = udid;
+    }
+
+    @Nullable
+    String getLastChangedMs() {
+        return mLastChangedMs;
+    }
+
+    void setLastChangedMs(@Nullable final String lastChangedMs) {
+        mLastChangedMs = lastChangedMs;
+    }
+
+    @Nullable
+    ConsentStatus getConsentStatusBeforeDnt() {
+        return mConsentStatusBeforeDnt;
+    }
+
+    void setConsentStatusBeforeDnt(@Nullable final ConsentStatus consentStatusBeforeDnt) {
+        mConsentStatusBeforeDnt = consentStatusBeforeDnt;
+    }
+
+    @VisibleForTesting
+    @NonNull
+    static String replaceLanguageMacro(@Nullable final String input,
+            @NonNull final Context context, @Nullable final String language) {
+        Preconditions.checkNotNull(context);
+
+        if (TextUtils.isEmpty(input)) {
+            return "";
+        }
+
+        return input.replaceAll(LANGUAGE_MACRO_KEY, validateLanguage(context, language));
+    }
+
+    /**
+     * Returns a valid 2-character ISO 639-1 language. This will return the default language of the
+     * device if language is empty or not an ISO 639-1 language.
+     *
+     * @param context  Context to get Locale.
+     * @param language Desired language.
+     */
+    @NonNull
+    private static String validateLanguage(@NonNull final Context context,
+            @Nullable final String language) {
+        Preconditions.checkNotNull(context);
+
+        for (final String isoLanguage : Locale.getISOLanguages()) {
+            if (isoLanguage != null && isoLanguage.equals(language)) {
+                return language;
+            }
+        }
+        return ClientMetadata.getCurrentLanguage(context);
+    }
+
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PersonalInfoManager.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PersonalInfoManager.java
new file mode 100644
index 00000000..67ff4c0a
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PersonalInfoManager.java
@@ -0,0 +1,711 @@
+package com.mopub.common.privacy;
+
+
+import android.content.Context;
+import android.os.Handler;
+import android.os.Looper;
+import android.os.SystemClock;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.Constants;
+import com.mopub.common.Preconditions;
+import com.mopub.common.SdkInitializationListener;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.util.ManifestUtils;
+import com.mopub.mobileads.MoPubConversionTracker;
+import com.mopub.mobileads.MoPubErrorCode;
+import com.mopub.network.AdRequest;
+import com.mopub.network.MoPubNetworkError;
+import com.mopub.network.Networking;
+import com.mopub.volley.VolleyError;
+
+import java.util.Calendar;
+import java.util.Collections;
+import java.util.HashSet;
+import java.util.Set;
+
+/**
+ * The manager handling personal information. If the user is in a GDPR region, MoPub must get
+ * user consent to handle and store user data.
+ */
+public class PersonalInfoManager {
+
+    /**
+     * Default minimum sync delay of 5 minutes.
+     */
+    private static final long MINIMUM_SYNC_DELAY = 5 * 60 * 1000;
+
+    @NonNull private final Context mAppContext;
+    @NonNull private final Set<ConsentStatusChangeListener> mConsentStatusChangeListeners;
+    @NonNull private final PersonalInfoData mPersonalInfoData;
+    @NonNull private final ConsentDialogController mConsentDialogController;
+    @NonNull private final MoPubConversionTracker mConversionTracker;
+    @NonNull private final SyncRequest.Listener mSyncRequestListener;
+    @NonNull private AdRequest.ServerOverrideListener mServerOverrideListener;
+    @Nullable private SdkInitializationListener mSdkInitializationListener;
+
+    private long mSyncDelayMs = MINIMUM_SYNC_DELAY;
+    @Nullable private Long mLastSyncRequestTimeUptimeMs;
+    @Nullable private ConsentStatus mSyncRequestConsentStatus;
+    private long mSyncRequestEpochTime;
+    private boolean mSyncRequestInFlight;
+    private boolean mForceGdprAppliesChanged;
+    private boolean mForceGdprAppliesChangedSending;
+
+    public PersonalInfoManager(@NonNull final Context context, @NonNull final String adUnitId,
+            @Nullable SdkInitializationListener sdkInitializationListener) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(adUnitId);
+
+        mAppContext = context.getApplicationContext();
+        mConsentStatusChangeListeners = Collections.synchronizedSet(
+                new HashSet<ConsentStatusChangeListener>());
+        mSyncRequestListener = new PersonalInfoSyncRequestListener();
+        mServerOverrideListener = new PersonalInfoServerOverrideListener();
+        AdRequest.setServerOverrideListener(mServerOverrideListener);
+
+        mConsentDialogController = new ConsentDialogController(mAppContext);
+
+        mPersonalInfoData = new PersonalInfoData(context, adUnitId);
+
+        mConversionTracker = new MoPubConversionTracker(mAppContext);
+
+        final MoPubIdentifier.AdvertisingIdChangeListener advertisingIdChangeListener =
+                new MoPubIdentifier.AdvertisingIdChangeListener() {
+                    @Override
+                    public void onIdChanged(@NonNull final AdvertisingId oldId,
+                            @NonNull final AdvertisingId newId) {
+                        Preconditions.checkNotNull(oldId);
+                        Preconditions.checkNotNull(newId);
+
+                        if (oldId.isDoNotTrack() && newId.isDoNotTrack()) {
+                            return;
+                        } else if (!oldId.isDoNotTrack() && newId.isDoNotTrack()) {
+                            attemptStateTransition(ConsentStatus.DNT,
+                                    ConsentChangeReason.DENIED_BY_DNT_ON);
+                            requestSync(true);
+                            return;
+                        } else if (oldId.isDoNotTrack() && !newId.isDoNotTrack()) {
+                            if (ConsentStatus.EXPLICIT_NO.equals(
+                                    mPersonalInfoData.getConsentStatusBeforeDnt())) {
+                                attemptStateTransition(ConsentStatus.EXPLICIT_NO,
+                                        ConsentChangeReason.DNT_OFF);
+                                return;
+                            }
+                            attemptStateTransition(ConsentStatus.UNKNOWN,
+                                    ConsentChangeReason.DNT_OFF);
+                            return;
+                        }
+                        // !oldId.isDoNotTrack() && !newId.isDoNotTrack()
+
+                        if (!TextUtils.isEmpty(newId.mAdvertisingId) &&
+                                !newId.getIfaWithPrefix().equals(mPersonalInfoData.getUdid()) &&
+                                ConsentStatus.EXPLICIT_YES.equals(
+                                        mPersonalInfoData.getConsentStatus())) {
+                            mPersonalInfoData.setLastSuccessfullySyncedConsentStatus(null);
+                            mPersonalInfoData.setLastChangedMs(null);
+                            attemptStateTransition(ConsentStatus.UNKNOWN,
+                                    ConsentChangeReason.IFA_CHANGED);
+                        }
+                    }
+                };
+        mSdkInitializationListener = sdkInitializationListener;
+
+        final MoPubIdentifier moPubIdentifier = ClientMetadata.getInstance(
+                mAppContext).getMoPubIdentifier();
+        moPubIdentifier.setIdChangeListener(advertisingIdChangeListener);
+        moPubIdentifier.setInitializationListener(createInitializationListener());
+    }
+
+    /**
+     * Checks to see if a publisher should load and then show a consent dialog.
+     *
+     * @return True for yes, false for no.
+     */
+    public boolean shouldShowConsentDialog() {
+        if (gdprApplies() == null || !gdprApplies()) {
+            return false;
+        }
+
+        if (ClientMetadata.getInstance(
+                mAppContext).getMoPubIdentifier().getAdvertisingInfo().isDoNotTrack()) {
+            return false;
+        }
+
+        // Check to see if the server said to reacquire consent and that the sdk had consent.
+        if (mPersonalInfoData.shouldReacquireConsent() && mPersonalInfoData.getConsentStatus().equals(
+                ConsentStatus.EXPLICIT_YES)) {
+            return true;
+        }
+        return mPersonalInfoData.getConsentStatus().equals(ConsentStatus.UNKNOWN);
+    }
+
+    /**
+     * Whether or not the consent dialog is done loading and ready to show.
+     *
+     * @return True for yes, false for no.
+     */
+    public boolean isConsentDialogReady() {
+        return mConsentDialogController.isReady();
+    }
+
+    /**
+     * Sends off a request to load the MoPub consent dialog.
+     *
+     * @param consentDialogListener This callback will be called when the dialog has finished
+     *                              loading or the dialog failed to load.
+     */
+    public void loadConsentDialog(
+            @Nullable final ConsentDialogListener consentDialogListener) {
+        ManifestUtils.checkGdprActivitiesDeclared(mAppContext);
+
+        if (ClientMetadata.getInstance(
+                mAppContext).getMoPubIdentifier().getAdvertisingInfo().isDoNotTrack()) {
+            if (consentDialogListener != null) {
+                new Handler().post(new Runnable() {
+                    @Override
+                    public void run() {
+                        consentDialogListener.onConsentDialogLoadFailed(
+                                MoPubErrorCode.DO_NOT_TRACK);
+                    }
+                });
+            }
+            return;
+        }
+        final Boolean gdprApplies = gdprApplies();
+        if (gdprApplies != null && !gdprApplies) {
+            if (consentDialogListener != null) {
+                new Handler().post(new Runnable() {
+                    @Override
+                    public void run() {
+                        consentDialogListener.onConsentDialogLoadFailed(
+                                MoPubErrorCode.GDPR_DOES_NOT_APPLY);
+                    }
+                });
+            }
+            return;
+        }
+        mConsentDialogController.loadConsentDialog(consentDialogListener, gdprApplies,
+                mPersonalInfoData);
+    }
+
+    /**
+     * If the MoPub consent dialog is loaded, then show it.
+     *
+     * @return True for successfully shown, false for failed to show.
+     */
+    public boolean showConsentDialog() {
+        return mConsentDialogController.showConsentDialog();
+    }
+
+    /**
+     * Whether or not the SDK is allowed to collect user data.
+     *
+     * @return true if able to collect user data.
+     */
+    public boolean canCollectPersonalInformation() {
+        final Boolean gdprApplies = gdprApplies();
+        // If we don't know whether or not GDPR applies, then we haven't synced, so we cannot
+        // collect personal information.
+        if (gdprApplies == null) {
+            return false;
+        }
+
+        // If we are not in a GDPR region, we can freely collect user data.
+        if (!gdprApplies) {
+            return true;
+        }
+
+        // Return whether or not we have consent and that Do Not Track is disabled.
+        return getPersonalInfoConsentStatus().equals(ConsentStatus.EXPLICIT_YES) &&
+                !ClientMetadata.getInstance(mAppContext).getMoPubIdentifier().getAdvertisingInfo()
+                        .isDoNotTrack();
+    }
+
+    /**
+     * Returns whether or not the SDK thinks the user is in a GDPR region or not. Returns true for
+     * in a GDPR region, false for not in a GDPR region, and null for unknown. This value can be
+     * overwritten to true by setting forceGdprApplies().
+     *
+     * @return true for in GDPR region, false for not in GDPR region, null for unknown
+     */
+    public Boolean gdprApplies() {
+        if (mPersonalInfoData.isForceGdprApplies()) {
+            return true;
+        }
+        return mPersonalInfoData.getGdprApplies();
+    }
+
+    /**
+     * Forces the SDK to treat this app as in a GDPR region. Setting this will permanently force
+     * GDPR rules for this user unless this app is uninstalled or the data for this app is cleared.
+     */
+    public void forceGdprApplies() {
+        if (mPersonalInfoData.isForceGdprApplies()) {
+            return;
+        }
+        final boolean oldCanCollectPersonalInformation = canCollectPersonalInformation();
+        mPersonalInfoData.setForceGdprApplies(true);
+        mForceGdprAppliesChanged = true;
+        mPersonalInfoData.writeToDisk();
+        final boolean newCanCollectPersonalInformation = canCollectPersonalInformation();
+        if (oldCanCollectPersonalInformation != newCanCollectPersonalInformation) {
+            fireOnConsentStateChangeListeners(mPersonalInfoData.getConsentStatus(),
+                    mPersonalInfoData.getConsentStatus(), newCanCollectPersonalInformation);
+        }
+        requestSync(true);
+    }
+
+    /**
+     * The user's current consent status. In general, publishers should not query this directly.
+     * It is recommended to use MoPub#canCollectPersonalInformation instead.
+     *
+     * @return ConsentStatus representing the current consent status.
+     */
+    @NonNull
+    public ConsentStatus getPersonalInfoConsentStatus() {
+        return mPersonalInfoData.getConsentStatus();
+    }
+
+    /**
+     * For use by whitelisted publishers only. Grants consent to collect personally identifiable
+     * information for the current user.
+     */
+    public void grantConsent() {
+        if (ClientMetadata.getInstance(mAppContext).getMoPubIdentifier().getAdvertisingInfo()
+                .isDoNotTrack()) {
+            MoPubLog.e("Cannot grant consent because Do Not Track is on.");
+            return;
+        }
+
+        if (mPersonalInfoData.isWhitelisted()) {
+            attemptStateTransition(ConsentStatus.EXPLICIT_YES,
+                    ConsentChangeReason.GRANTED_BY_WHITELISTED_PUB);
+        } else {
+            MoPubLog.w("You do not have approval to use the grantConsent API. Please reach out " +
+                    "to your account teams or support@mopub.com for more information.");
+            attemptStateTransition(ConsentStatus.POTENTIAL_WHITELIST,
+                    ConsentChangeReason.GRANTED_BY_NOT_WHITELISTED_PUB);
+        }
+        requestSync(true);
+    }
+
+    /**
+     * Denies consent to collect personally identifiable information for the current user.
+     */
+    public void revokeConsent() {
+        if (ClientMetadata.getInstance(mAppContext).getMoPubIdentifier().getAdvertisingInfo()
+                .isDoNotTrack()) {
+            MoPubLog.e("Cannot revoke consent because Do Not Track is on.");
+            return;
+        }
+
+        attemptStateTransition(ConsentStatus.EXPLICIT_NO, ConsentChangeReason.DENIED_BY_PUB);
+        requestSync(true);
+    }
+
+    void changeConsentStateFromDialog(@NonNull final ConsentStatus consentStatus) {
+        Preconditions.checkNotNull(consentStatus);
+
+        switch (consentStatus) {
+            case EXPLICIT_YES:
+                attemptStateTransition(consentStatus, ConsentChangeReason.GRANTED_BY_USER);
+                requestSync(true);
+                break;
+            case EXPLICIT_NO:
+                attemptStateTransition(consentStatus, ConsentChangeReason.DENIED_BY_USER);
+                requestSync(true);
+                break;
+            default:
+                MoPubLog.d("Invalid consent status: " + consentStatus + ". This is a bug with " +
+                        "the use of changeConsentStateFromDialog.");
+        }
+    }
+
+    /**
+     * Add a listener for consent status changes.
+     *
+     * @param consentStatusChangeListener This listener will be called when a status transition happens.
+     */
+    public void subscribeConsentStatusChangeListener(
+            @Nullable final ConsentStatusChangeListener consentStatusChangeListener) {
+        if (consentStatusChangeListener == null) {
+            return;
+        }
+        mConsentStatusChangeListeners.add(consentStatusChangeListener);
+    }
+
+    /**
+     * Call this to unsubscribe a consentStatusChangeListener.
+     *
+     * @param consentStatusChangeListener This listener will no longer be receiving status transitions.
+     */
+    public void unsubscribeConsentStatusChangeListener(
+            @Nullable final ConsentStatusChangeListener consentStatusChangeListener) {
+        mConsentStatusChangeListeners.remove(consentStatusChangeListener);
+    }
+
+    @VisibleForTesting
+    static boolean shouldMakeSyncRequest(final boolean syncRequestInFlight,
+            @Nullable final Boolean gdprApplies, final boolean force,
+            @Nullable final Long lastSyncRequestTimeMs, final long syncDelay,
+            @Nullable final String udid, final boolean dnt) {
+        if (syncRequestInFlight) {
+            return false;
+        }
+        if (gdprApplies == null) {
+            return true;
+        }
+        if (!gdprApplies) {
+            return false;
+        }
+        if (force) {
+            return true;
+        }
+        if (dnt && TextUtils.isEmpty(udid)) {
+            return false;
+        }
+        if (lastSyncRequestTimeMs == null) {
+            return true;
+        }
+        return SystemClock.uptimeMillis() - lastSyncRequestTimeMs > syncDelay;
+    }
+
+    /**
+     * Called internally to request a sync to ad server about consent status and other metadata.
+     *
+     * @param force Call sync even if it has not been mSyncDelayMs. Still won't happen if not in
+     *              a GDPR region or if a request is already in flight.
+     */
+    public void requestSync(final boolean force) {
+        final AdvertisingId advertisingId = ClientMetadata.getInstance(mAppContext)
+                .getMoPubIdentifier().getAdvertisingInfo();
+        if (!shouldMakeSyncRequest(mSyncRequestInFlight,
+                gdprApplies(),
+                force,
+                mLastSyncRequestTimeUptimeMs,
+                mSyncDelayMs,
+                mPersonalInfoData.getUdid(),
+                advertisingId.isDoNotTrack())) {
+            return;
+        }
+
+        mSyncRequestConsentStatus = mPersonalInfoData.getConsentStatus();
+        mSyncRequestEpochTime = Calendar.getInstance().getTimeInMillis();
+        mSyncRequestInFlight = true;
+
+        mLastSyncRequestTimeUptimeMs = SystemClock.uptimeMillis();
+        final SyncUrlGenerator syncUrlGenerator = new SyncUrlGenerator(mAppContext,
+                mSyncRequestConsentStatus.getValue());
+        syncUrlGenerator.withAdUnitId(mPersonalInfoData.getAdUnitId())
+                .withUdid(mPersonalInfoData.getUdid())
+                .withLastChangedMs(mPersonalInfoData.getLastChangedMs())
+                .withLastConsentStatus(mPersonalInfoData.getLastSuccessfullySyncedConsentStatus())
+                .withConsentChangeReason(mPersonalInfoData.getConsentChangeReason())
+                .withConsentedVendorListVersion(mPersonalInfoData.getConsentedVendorListVersion())
+                .withConsentedPrivacyPolicyVersion(
+                        mPersonalInfoData.getConsentedPrivacyPolicyVersion())
+                .withCachedVendorListIabHash(mPersonalInfoData.getCurrentVendorListIabHash())
+                .withExtras(mPersonalInfoData.getExtras())
+                .withGdprApplies(gdprApplies())
+                .withForceGdprApplies(mPersonalInfoData.isForceGdprApplies());
+        if (mForceGdprAppliesChanged) {
+            mForceGdprAppliesChangedSending = true;
+            syncUrlGenerator.withForceGdprAppliesChanged(true);
+        }
+
+        final SyncRequest syncRequest = new SyncRequest(mAppContext,
+                syncUrlGenerator.generateUrlString(
+                        Constants.HOST), mSyncRequestListener);
+        Networking.getRequestQueue(mAppContext).add(syncRequest);
+    }
+
+    /**
+     * For use by whitelisted publishers only. Gets a copy of the current and consented vendor
+     * list and privacy policy and their versions.
+     *
+     * @return ConsentData which is a snapshot of the underlying data store.
+     */
+    public ConsentData getConsentData() {
+        return new PersonalInfoData(mAppContext, mPersonalInfoData.getAdUnitId());
+    }
+
+    /**
+     * SDK-initiated state transitions should try to use this to keep the consent change reason
+     * to one of the reasons we know about.
+     *
+     * @param newConsentStatus    The new consent status we want to transition to.
+     * @param consentChangeReason Why the state changed.
+     */
+    private void attemptStateTransition(@NonNull final ConsentStatus newConsentStatus,
+            @NonNull final ConsentChangeReason consentChangeReason) {
+        attemptStateTransition(newConsentStatus, consentChangeReason.getReason());
+    }
+
+    /**
+     * Server-initiated state transitions may have non-enum change reasons, so use this.
+     *
+     * @param newConsentStatus    The new consent status we want to transition to.
+     * @param consentChangeReason Why the state changed.
+     */
+    @VisibleForTesting
+    void attemptStateTransition(@NonNull final ConsentStatus newConsentStatus,
+            @NonNull final String consentChangeReason) {
+        Preconditions.checkNotNull(newConsentStatus);
+        Preconditions.checkNotNull(consentChangeReason);
+
+        final ConsentStatus oldConsentStatus = mPersonalInfoData.getConsentStatus();
+        if (oldConsentStatus.equals(newConsentStatus)) {
+            MoPubLog.d("Consent status is already " + oldConsentStatus +
+                    ". Not doing a state transition.");
+            return;
+        }
+
+        MoPubLog.d("Changing consent status from " + oldConsentStatus + "to " + newConsentStatus +
+                " because " + consentChangeReason);
+        mPersonalInfoData.setConsentChangeReason(consentChangeReason);
+        mPersonalInfoData.setConsentStatus(newConsentStatus);
+        if (ConsentStatus.POTENTIAL_WHITELIST.equals(newConsentStatus) ||
+                (!ConsentStatus.POTENTIAL_WHITELIST.equals(oldConsentStatus)) &&
+                        ConsentStatus.EXPLICIT_YES.equals(newConsentStatus)) {
+            mPersonalInfoData.setConsentedPrivacyPolicyVersion(
+                    mPersonalInfoData.getCurrentPrivacyPolicyVersion());
+            mPersonalInfoData.setConsentedVendorListVersion(
+                    mPersonalInfoData.getCurrentVendorListVersion());
+            mPersonalInfoData.setConsentedVendorListIabFormat(
+                    mPersonalInfoData.getCurrentVendorListIabFormat());
+        }
+
+        if (ConsentStatus.DNT.equals(newConsentStatus) ||
+                ConsentStatus.EXPLICIT_NO.equals(newConsentStatus) ||
+                ConsentStatus.UNKNOWN.equals(newConsentStatus)) {
+            mPersonalInfoData.setConsentedPrivacyPolicyVersion(null);
+            mPersonalInfoData.setConsentedVendorListVersion(null);
+            mPersonalInfoData.setConsentedVendorListIabFormat(null);
+        }
+
+        if (ConsentStatus.EXPLICIT_YES.equals(newConsentStatus)) {
+            mPersonalInfoData.setUdid(ClientMetadata.getInstance(
+                    mAppContext).getMoPubIdentifier().getAdvertisingInfo().getIfaWithPrefix());
+        }
+
+        if (ConsentStatus.DNT.equals(newConsentStatus)) {
+            mPersonalInfoData.setConsentStatusBeforeDnt(oldConsentStatus);
+        }
+        mPersonalInfoData.setShouldReacquireConsent(false);
+        mPersonalInfoData.writeToDisk();
+
+        final boolean canCollectPersonalInformation = canCollectPersonalInformation();
+        if (canCollectPersonalInformation) {
+            ClientMetadata.getInstance(mAppContext).repopulateCountryData();
+            if (mConversionTracker.shouldTrack()) {
+                mConversionTracker.reportAppOpen(false);
+            }
+        }
+
+        fireOnConsentStateChangeListeners(oldConsentStatus, newConsentStatus,
+                canCollectPersonalInformation);
+    }
+
+    private void fireOnConsentStateChangeListeners(@NonNull final ConsentStatus oldConsentStatus,
+            @NonNull final ConsentStatus newConsentStatus,
+            final boolean canCollectPersonalInformation) {
+        synchronized (mConsentStatusChangeListeners) {
+            for (final ConsentStatusChangeListener stateChangeListener : mConsentStatusChangeListeners) {
+                new Handler(Looper.getMainLooper()).post(new Runnable() {
+                    @Override
+                    public void run() {
+                        stateChangeListener.onConsentStateChange(oldConsentStatus, newConsentStatus,
+                                canCollectPersonalInformation);
+                    }
+                });
+            }
+        }
+    }
+
+    private SdkInitializationListener createInitializationListener() {
+        return new SdkInitializationListener() {
+
+            @Override
+            public void onInitializationFinished() {
+                MoPubLog.d("MoPubIdentifier initialized.");
+                final AdvertisingId advertisingId = ClientMetadata.getInstance(mAppContext)
+                        .getMoPubIdentifier().getAdvertisingInfo();
+                if (!shouldMakeSyncRequest(mSyncRequestInFlight,
+                        gdprApplies(),
+                        false,
+                        mLastSyncRequestTimeUptimeMs,
+                        mSyncDelayMs,
+                        mPersonalInfoData.getUdid(),
+                        advertisingId.isDoNotTrack())) {
+                    if (mSdkInitializationListener != null) {
+                        mSdkInitializationListener.onInitializationFinished();
+                        mSdkInitializationListener = null;
+                    }
+                } else {
+                    requestSync(false);
+                }
+                new MoPubConversionTracker(mAppContext).reportAppOpen(true);
+            }
+        };
+    }
+
+    private class PersonalInfoSyncRequestListener implements SyncRequest.Listener {
+
+        @Override
+        public void onSuccess(final SyncResponse response) {
+            final boolean oldCanCollectPersonalInformation = canCollectPersonalInformation();
+            if (mPersonalInfoData.getGdprApplies() == null) {
+                mPersonalInfoData.setGdprApplies(response.isGdprRegion());
+            }
+            if (response.isForceGdprApplies()) {
+                mForceGdprAppliesChanged = true;
+                mPersonalInfoData.setForceGdprApplies(true);
+                final boolean newCanCollectPersonalInformation = canCollectPersonalInformation();
+                if (oldCanCollectPersonalInformation != newCanCollectPersonalInformation) {
+                    fireOnConsentStateChangeListeners(mPersonalInfoData.getConsentStatus(),
+                            mPersonalInfoData.getConsentStatus(), newCanCollectPersonalInformation);
+                }
+            }
+
+            mPersonalInfoData.setLastChangedMs("" + mSyncRequestEpochTime);
+            mPersonalInfoData.setLastSuccessfullySyncedConsentStatus(mSyncRequestConsentStatus);
+            mPersonalInfoData.setWhitelisted(response.isWhitelisted());
+            mPersonalInfoData.setCurrentVendorListVersion(response.getCurrentVendorListVersion());
+            mPersonalInfoData.setCurrentVendorListLink(response.getCurrentVendorListLink());
+            mPersonalInfoData.setCurrentPrivacyPolicyVersion(
+                    response.getCurrentPrivacyPolicyVersion());
+            mPersonalInfoData.setCurrentPrivacyPolicyLink(response.getCurrentPrivacyPolicyLink());
+            final String iabHash = response.getCurrentVendorListIabHash();
+            final String iabFormat = response.getCurrentVendorListIabFormat();
+            if (!TextUtils.isEmpty(iabHash) && !iabHash.equals(
+                    mPersonalInfoData.getCurrentVendorListIabHash()) && !TextUtils.isEmpty(
+                    iabFormat)) {
+                mPersonalInfoData.setCurrentVendorListIabFormat(iabFormat);
+                mPersonalInfoData.setCurrentVendorListIabHash(iabHash);
+            }
+            final String extras = response.getExtras();
+            if (!TextUtils.isEmpty(extras)) {
+                mPersonalInfoData.setExtras(extras);
+            }
+            final String consentChangeReason = response.getConsentChangeReason();
+
+            // Only one of these should happen. Prioritize no.
+            if (response.isForceExplicitNo()) {
+                mServerOverrideListener.onForceExplicitNo(consentChangeReason);
+            } else if (response.isInvalidateConsent()) {
+                mServerOverrideListener.onInvalidateConsent(consentChangeReason);
+            } else if (response.isReacquireConsent()) {
+                mServerOverrideListener.onReacquireConsent(consentChangeReason);
+            }
+
+            final String callAgainAfterSecs = response.getCallAgainAfterSecs();
+            if (!TextUtils.isEmpty(callAgainAfterSecs)) {
+                try {
+                    final long callAgainAfterSecsLong = Long.parseLong(callAgainAfterSecs);
+                    if (callAgainAfterSecsLong > 0) {
+                        mSyncDelayMs = callAgainAfterSecsLong * 1000;
+                    } else {
+                        MoPubLog.d("callAgainAfterSecs is not positive: " + callAgainAfterSecs);
+                    }
+                } catch (NumberFormatException e) {
+                    MoPubLog.d("Unable to parse callAgainAfterSecs. Ignoring value");
+                }
+            }
+
+            // Clear out our cached udid if we have sent it one last time in case limit ad tracking
+            // is turned on.
+            if (!ConsentStatus.EXPLICIT_YES.equals(mSyncRequestConsentStatus)) {
+                mPersonalInfoData.setUdid(null);
+            }
+
+            if (mForceGdprAppliesChangedSending) {
+                mForceGdprAppliesChanged = false;
+                mForceGdprAppliesChangedSending = false;
+            }
+
+            mPersonalInfoData.writeToDisk();
+
+            mSyncRequestInFlight = false;
+
+            if (ConsentStatus.POTENTIAL_WHITELIST.equals(
+                    mSyncRequestConsentStatus) && mPersonalInfoData.isWhitelisted()) {
+                attemptStateTransition(ConsentStatus.EXPLICIT_YES,
+                        ConsentChangeReason.GRANTED_BY_WHITELISTED_PUB);
+                requestSync(true);
+            }
+
+            if (mSdkInitializationListener != null) {
+                mSdkInitializationListener.onInitializationFinished();
+                mSdkInitializationListener = null;
+            }
+        }
+
+        @Override
+        public void onErrorResponse(final VolleyError volleyError) {
+            MoPubLog.d("Failed sync request because of " +
+                    ((volleyError instanceof MoPubNetworkError) ?
+                            ((MoPubNetworkError) volleyError).getReason() : volleyError.getMessage()));
+            mSyncRequestInFlight = false;
+            if (mSdkInitializationListener != null) {
+                MoPubLog.d("Personal Info Manager initialization finished but ran into errors.");
+                mSdkInitializationListener.onInitializationFinished();
+                mSdkInitializationListener = null;
+            }
+        }
+    }
+
+    private class PersonalInfoServerOverrideListener implements AdRequest.ServerOverrideListener {
+        @Override
+        public void onForceExplicitNo(@Nullable final String consentChangeReason) {
+            if (TextUtils.isEmpty(consentChangeReason)) {
+                attemptStateTransition(ConsentStatus.EXPLICIT_NO,
+                        ConsentChangeReason.REVOKED_BY_SERVER);
+                return;
+            }
+            attemptStateTransition(ConsentStatus.EXPLICIT_NO, consentChangeReason);
+        }
+
+        @Override
+        public void onInvalidateConsent(@Nullable final String consentChangeReason) {
+            if (TextUtils.isEmpty(consentChangeReason)) {
+                attemptStateTransition(ConsentStatus.UNKNOWN,
+                        ConsentChangeReason.REACQUIRE_BY_SERVER);
+                return;
+            }
+            attemptStateTransition(ConsentStatus.UNKNOWN, consentChangeReason);
+        }
+
+        @Override
+        public void onReacquireConsent(@Nullable final String consentChangeReason) {
+            if (!TextUtils.isEmpty(consentChangeReason)) {
+                mPersonalInfoData.setConsentChangeReason(consentChangeReason);
+            }
+            mPersonalInfoData.setShouldReacquireConsent(true);
+            mPersonalInfoData.writeToDisk();
+        }
+
+        @Override
+        public void onForceGdprApplies() {
+            forceGdprApplies();
+        }
+    }
+
+    @NonNull
+    @Deprecated
+    @VisibleForTesting
+    PersonalInfoData getPersonalInfoData() {
+        return mPersonalInfoData;
+    }
+
+    @NonNull
+    @Deprecated
+    @VisibleForTesting
+    AdRequest.ServerOverrideListener getServerOverrideListener() {
+        return mServerOverrideListener;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PrivacyKey.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PrivacyKey.java
new file mode 100644
index 00000000..62d6e69f
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/PrivacyKey.java
@@ -0,0 +1,34 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+
+/**
+ * Keys for gdpr sync, consent dialog requests, and setting consent state.
+ */
+public enum PrivacyKey {
+    IS_GDPR_REGION("is_gdpr_region"),
+    IS_WHITELISTED("is_whitelisted"),
+    FORCE_GDPR_APPLIES("force_gdpr_applies"),
+    FORCE_EXPLICIT_NO("force_explicit_no"),
+    INVALIDATE_CONSENT("invalidate_consent"),
+    REACQUIRE_CONSENT("reacquire_consent"),
+    EXTRAS("extras"),
+    CURRENT_VENDOR_LIST_VERSION("current_vendor_list_version"),
+    CURRENT_VENDOR_LIST_LINK("current_vendor_list_link"),
+    CURRENT_PRIVACY_POLICY_VERSION("current_privacy_policy_version"),
+    CURRENT_PRIVACY_POLICY_LINK("current_privacy_policy_link"),
+    CURRENT_VENDOR_LIST_IAB_FORMAT("current_vendor_list_iab_format"),
+    CURRENT_VENDOR_LIST_IAB_HASH("current_vendor_list_iab_hash"),
+    CALL_AGAIN_AFTER_SECS("call_again_after_secs"),
+    CONSENT_CHANGE_REASON("consent_change_reason");
+
+    @NonNull private final String key;
+    PrivacyKey(@NonNull final String key) {
+        this.key = key;
+    }
+
+    @NonNull
+    public String getKey() {
+        return this.key;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncRequest.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncRequest.java
new file mode 100644
index 00000000..3c99e15b
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncRequest.java
@@ -0,0 +1,91 @@
+package com.mopub.common.privacy;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.network.MoPubNetworkError;
+import com.mopub.network.MoPubRequest;
+import com.mopub.volley.DefaultRetryPolicy;
+import com.mopub.volley.NetworkResponse;
+import com.mopub.volley.Response;
+import com.mopub.volley.toolbox.HttpHeaderParser;
+
+import org.json.JSONException;
+import org.json.JSONObject;
+
+public class SyncRequest extends MoPubRequest<SyncResponse> {
+
+    public interface Listener extends Response.ErrorListener {
+        void onSuccess(SyncResponse response);
+    }
+
+    @Nullable private Listener mListener;
+
+    public SyncRequest(@NonNull final Context context,
+            @NonNull final String url,
+            @Nullable final Listener listener) {
+        super(context, url, listener);
+
+        mListener = listener;
+
+        DefaultRetryPolicy retryPolicy = new DefaultRetryPolicy(
+                DefaultRetryPolicy.DEFAULT_TIMEOUT_MS,
+                0,
+                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT);
+        setRetryPolicy(retryPolicy);
+        setShouldCache(false);
+    }
+
+    @Override
+    protected Response<SyncResponse> parseNetworkResponse(final NetworkResponse networkResponse) {
+        final SyncResponse.Builder builder = new SyncResponse.Builder();
+        final String responseBody = parseStringBody(networkResponse);
+
+        try {
+            final JSONObject jsonBody = new JSONObject(responseBody);
+            builder.setIsGdprRegion(jsonBody.getString(PrivacyKey.IS_GDPR_REGION.getKey()))
+                    .setForceExplicitNo(jsonBody.optString(PrivacyKey.FORCE_EXPLICIT_NO.getKey()))
+                    .setInvalidateConsent(
+                            jsonBody.optString(PrivacyKey.INVALIDATE_CONSENT.getKey()))
+                    .setReacquireConsent(jsonBody.optString(PrivacyKey.REACQUIRE_CONSENT.getKey()))
+                    .setIsWhitelisted(jsonBody.getString(PrivacyKey.IS_WHITELISTED.getKey()))
+                    .setForceGdprApplies(jsonBody.optString(PrivacyKey.FORCE_GDPR_APPLIES.getKey()))
+                    .setCurrentVendorListVersion(
+                            jsonBody.getString(PrivacyKey.CURRENT_VENDOR_LIST_VERSION.getKey()))
+                    .setCurrentVendorListLink(
+                            jsonBody.getString(PrivacyKey.CURRENT_VENDOR_LIST_LINK.getKey()))
+                    .setCurrentPrivacyPolicyLink(
+                            jsonBody.getString(PrivacyKey.CURRENT_PRIVACY_POLICY_LINK.getKey()))
+                    .setCurrentPrivacyPolicyVersion(
+                            jsonBody.getString(PrivacyKey.CURRENT_PRIVACY_POLICY_VERSION.getKey()))
+                    .setCurrentVendorListIabFormat(
+                            jsonBody.optString(PrivacyKey.CURRENT_VENDOR_LIST_IAB_FORMAT.getKey()))
+                    .setCurrentVendorListIabHash(
+                            jsonBody.getString(PrivacyKey.CURRENT_VENDOR_LIST_IAB_HASH.getKey()))
+                    .setCallAgainAfterSecs(
+                            jsonBody.optString(PrivacyKey.CALL_AGAIN_AFTER_SECS.getKey()))
+                    .setExtras(jsonBody.optString(PrivacyKey.EXTRAS.getKey()))
+                    .setConsentChangeReason(
+                            jsonBody.optString(PrivacyKey.CONSENT_CHANGE_REASON.getKey()));
+        } catch (JSONException e) {
+            return Response.error(
+                    new MoPubNetworkError(
+                            "Unable to parse sync request network response.",
+                            MoPubNetworkError.Reason.BAD_BODY,
+                            null
+                    )
+            );
+        }
+
+        return Response.success(builder.build(),
+                HttpHeaderParser.parseCacheHeaders(networkResponse));
+    }
+
+    @Override
+    protected void deliverResponse(final SyncResponse syncResponse) {
+        if (mListener != null) {
+            mListener.onSuccess(syncResponse);
+        }
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncResponse.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncResponse.java
new file mode 100644
index 00000000..31b88fed
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncResponse.java
@@ -0,0 +1,244 @@
+package com.mopub.common.privacy;
+
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.common.Preconditions;
+
+public class SyncResponse {
+
+    private final boolean mIsGdprRegion;
+    private final boolean mForceExplicitNo;
+    private final boolean mInvalidateConsent;
+    private final boolean mReacquireConsent;
+    private final boolean mIsWhitelisted;
+    private final boolean mForceGdprApplies;
+    @NonNull private final String mCurrentVendorListVersion;
+    @NonNull private final String mCurrentVendorListLink;
+    @NonNull private final String mCurrentPrivacyPolicyVersion;
+    @NonNull private final String mCurrentPrivacyPolicyLink;
+    @Nullable private final String mCurrentVendorListIabFormat;
+    @NonNull private final String mCurrentVendorListIabHash;
+    @Nullable private final String mCallAgainAfterSecs;
+    @Nullable private final String mExtras;
+    @Nullable private final String mConsentChangeReason;
+
+    public boolean isGdprRegion() {
+        return mIsGdprRegion;
+    }
+
+    public boolean isForceExplicitNo() {
+        return mForceExplicitNo;
+    }
+
+    public boolean isInvalidateConsent() {
+        return mInvalidateConsent;
+    }
+
+    public boolean isReacquireConsent() {
+        return mReacquireConsent;
+    }
+
+    public boolean isWhitelisted() {
+        return mIsWhitelisted;
+    }
+
+    public boolean isForceGdprApplies() {
+        return mForceGdprApplies;
+    }
+
+    @NonNull
+    public String getCurrentVendorListVersion() {
+        return mCurrentVendorListVersion;
+    }
+
+    @NonNull
+    public String getCurrentVendorListLink() {
+        return mCurrentVendorListLink;
+    }
+
+    @NonNull
+    public String getCurrentPrivacyPolicyVersion() {
+        return mCurrentPrivacyPolicyVersion;
+    }
+
+    @NonNull
+    public String getCurrentPrivacyPolicyLink() {
+        return mCurrentPrivacyPolicyLink;
+    }
+
+    @Nullable
+    public String getCurrentVendorListIabFormat() {
+        return mCurrentVendorListIabFormat;
+    }
+
+    @NonNull
+    public String getCurrentVendorListIabHash() {
+        return mCurrentVendorListIabHash;
+    }
+
+    @Nullable
+    public String getCallAgainAfterSecs() {
+        return mCallAgainAfterSecs;
+    }
+
+    @Nullable
+    String getExtras() {
+        return mExtras;
+    }
+
+    @Nullable
+    public String getConsentChangeReason() {
+        return mConsentChangeReason;
+    }
+
+    private SyncResponse(@NonNull final String isGdprRegion,
+            @Nullable final String forceExplicitNo,
+            @Nullable final String invalidateConsent,
+            @Nullable final String reacquireConsent,
+            @NonNull final String isWhitelisted,
+            @Nullable final String forceGdprApplies,
+            @NonNull final String currentVendorListVersion,
+            @NonNull final String currentVendorListLink,
+            @NonNull final String currentPrivacyPolicyVersion,
+            @NonNull final String currentPrivacyPolicyLink,
+            @Nullable final String currentVendorListIabFormat,
+            @NonNull final String currentVendorListIabHash,
+            @Nullable final String callAgainAfterSecs,
+            @Nullable final String extras,
+            @Nullable final String consentChangeReason) {
+        Preconditions.checkNotNull(isGdprRegion);
+        Preconditions.checkNotNull(isWhitelisted);
+        Preconditions.checkNotNull(currentVendorListVersion);
+        Preconditions.checkNotNull(currentVendorListLink);
+        Preconditions.checkNotNull(currentPrivacyPolicyVersion);
+        Preconditions.checkNotNull(currentPrivacyPolicyLink);
+        Preconditions.checkNotNull(currentVendorListIabHash);
+
+        // Default for this is true
+        mIsGdprRegion = !"0".equals(isGdprRegion);
+
+        // Default for the next five is false
+        mForceExplicitNo = "1".equals(forceExplicitNo);
+        mInvalidateConsent = "1".equals(invalidateConsent);
+        mReacquireConsent = "1".equals(reacquireConsent);
+        mIsWhitelisted = "1".equals(isWhitelisted);
+        mForceGdprApplies = "1".equals(forceGdprApplies);
+
+        mCurrentVendorListVersion = currentVendorListVersion;
+        mCurrentVendorListLink = currentVendorListLink;
+        mCurrentPrivacyPolicyVersion = currentPrivacyPolicyVersion;
+        mCurrentPrivacyPolicyLink = currentPrivacyPolicyLink;
+        mCurrentVendorListIabFormat = currentVendorListIabFormat;
+        mCurrentVendorListIabHash = currentVendorListIabHash;
+        mCallAgainAfterSecs = callAgainAfterSecs;
+        mExtras = extras;
+        mConsentChangeReason = consentChangeReason;
+    }
+
+    public static class Builder {
+        private String isGdprRegion;
+        private String forceExplicitNo;
+        private String invalidateConsent;
+        private String reacquireConsent;
+        private String isWhitelisted;
+        private String forceGdprApplies;
+        private String currentVendorListVersion;
+        private String currentVendorListLink;
+        private String currentPrivacyPolicyVersion;
+        private String currentPrivacyPolicyLink;
+        private String currentVendorListIabFormat;
+        private String currentVendorListIabHash;
+        private String callAgainAfterSecs;
+        private String extras;
+        private String consentChangeReason;
+
+        public Builder() {
+        }
+
+        public Builder setIsGdprRegion(@NonNull final String isGdprRegion) {
+            this.isGdprRegion = isGdprRegion;
+            return this;
+        }
+
+        public Builder setForceExplicitNo(@Nullable final String forceExplicitNo) {
+            this.forceExplicitNo = forceExplicitNo;
+            return this;
+        }
+
+        public Builder setInvalidateConsent(@Nullable final String invalidateConsent) {
+            this.invalidateConsent = invalidateConsent;
+            return this;
+        }
+
+        public Builder setReacquireConsent(@Nullable final String reacquireConsent) {
+            this.reacquireConsent = reacquireConsent;
+            return this;
+        }
+
+        public Builder setIsWhitelisted(@NonNull final String isWhitelisted) {
+            this.isWhitelisted = isWhitelisted;
+            return this;
+        }
+
+        public Builder setForceGdprApplies(@Nullable final String forceGdprApplies) {
+            this.forceGdprApplies = forceGdprApplies;
+            return this;
+        }
+
+        public Builder setCurrentVendorListVersion(@NonNull final String currentVendorListVersion) {
+            this.currentVendorListVersion = currentVendorListVersion;
+            return this;
+        }
+
+        public Builder setCurrentVendorListLink(@NonNull final String currentVendorListLink) {
+            this.currentVendorListLink = currentVendorListLink;
+            return this;
+        }
+
+        public Builder setCurrentPrivacyPolicyVersion(
+                @NonNull final String currentPrivacyPolicyVersion) {
+            this.currentPrivacyPolicyVersion = currentPrivacyPolicyVersion;
+            return this;
+        }
+
+        public Builder setCurrentPrivacyPolicyLink(@NonNull final String currentPrivacyPolicyLink) {
+            this.currentPrivacyPolicyLink = currentPrivacyPolicyLink;
+            return this;
+        }
+
+        public Builder setCurrentVendorListIabFormat(
+                @Nullable final String currentVendorListIabFormat) {
+            this.currentVendorListIabFormat = currentVendorListIabFormat;
+            return this;
+        }
+
+        public Builder setCurrentVendorListIabHash(@NonNull final String currentVendorListIabHash) {
+            this.currentVendorListIabHash = currentVendorListIabHash;
+            return this;
+        }
+
+        public Builder setCallAgainAfterSecs(@Nullable final String callAgainAfterSecs) {
+            this.callAgainAfterSecs = callAgainAfterSecs;
+            return this;
+        }
+
+        public Builder setExtras(@Nullable final String extras) {
+            this.extras = extras;
+            return this;
+        }
+
+        public Builder setConsentChangeReason(@Nullable final String consentChangeReason) {
+            this.consentChangeReason = consentChangeReason;
+            return this;
+        }
+
+        public SyncResponse build() {
+            return new SyncResponse(isGdprRegion, forceExplicitNo, invalidateConsent,
+                    reacquireConsent, isWhitelisted, forceGdprApplies, currentVendorListVersion,
+                    currentVendorListLink, currentPrivacyPolicyVersion, currentPrivacyPolicyLink,
+                    currentVendorListIabFormat, currentVendorListIabHash, callAgainAfterSecs,
+                    extras, consentChangeReason);
+        }
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncUrlGenerator.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncUrlGenerator.java
new file mode 100644
index 00000000..966453af
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/privacy/SyncUrlGenerator.java
@@ -0,0 +1,157 @@
+package com.mopub.common.privacy;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.common.BaseUrlGenerator;
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
+import com.mopub.common.Preconditions;
+import com.mopub.network.PlayServicesUrlRewriter;
+
+public class SyncUrlGenerator extends BaseUrlGenerator {
+
+    /**
+     * Unix time, in ms, of the last time the consent status was changed.
+     */
+    private static final String LAST_CHANGED_MS_KEY = "last_changed_ms";
+
+    /**
+     * Previous consent state acknowledged by the server.
+     */
+    private static final String LAST_CONSENT_STATUS_KEY = "last_consent_status";
+
+    /**
+     * The reason why the consent state changed, iff the current state has changed.
+     */
+    private static final String CONSENT_CHANGE_REASON_KEY = "consent_change_reason";
+
+    /**
+     * IAB's vendor list.
+     */
+    private static final String CACHED_VENDOR_LIST_IAB_HASH_KEY = "cached_vendor_list_iab_hash";
+
+    /**
+     * Any other server data that the server wants for the SDK to hang on to.
+     */
+    private static final String EXTRAS_KEY = "extras";
+
+    /**
+     * "1" when the publisher just forced gdpr applies. Otherwise, this is not sent.
+     */
+    private static final String FORCED_GDPR_APPLIES_CHANGED = "forced_gdpr_applies_changed";
+
+    @NonNull private final Context mContext;
+    @Nullable private String mAdUnitId;
+    @Nullable private String mUdid;
+    @Nullable private String mLastChangedMs;
+    @Nullable private String mLastConsentStatus;
+    @NonNull private final String mCurrentConsentStatus;
+    @Nullable private String mConsentChangeReason;
+    @Nullable private String mConsentedVendorListVersion;
+    @Nullable private String mConsentedPrivacyPolicyVersion;
+    @Nullable private String mCachedVendorListIabHash;
+    @Nullable private String mExtras;
+    @Nullable private Boolean mGdprApplies;
+    private boolean mForceGdprApplies;
+    @Nullable private Boolean mForceGdprAppliesChanged;
+
+    public SyncUrlGenerator(@NonNull final Context context,
+            @NonNull final String currentConsentStatus) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(currentConsentStatus);
+
+        mContext = context.getApplicationContext();
+        mCurrentConsentStatus = currentConsentStatus;
+    }
+
+    public SyncUrlGenerator withAdUnitId(@Nullable final String adUnitId) {
+        mAdUnitId = adUnitId;
+        return this;
+    }
+
+    public SyncUrlGenerator withUdid(@Nullable final String udid) {
+        mUdid = udid;
+        return this;
+    }
+
+    public SyncUrlGenerator withGdprApplies(@Nullable final Boolean gdprApplies) {
+        mGdprApplies = gdprApplies;
+        return this;
+    }
+
+    public SyncUrlGenerator withForceGdprApplies(final boolean forceGdprApplies) {
+        mForceGdprApplies = forceGdprApplies;
+        return this;
+    }
+
+    public SyncUrlGenerator withForceGdprAppliesChanged(
+            @Nullable final Boolean forceGdprAppliesChanged) {
+        mForceGdprAppliesChanged = forceGdprAppliesChanged;
+        return this;
+    }
+
+    public SyncUrlGenerator withLastChangedMs(@Nullable final String lastChangedMs) {
+        mLastChangedMs = lastChangedMs;
+        return this;
+    }
+
+    public SyncUrlGenerator withLastConsentStatus(@Nullable final ConsentStatus lastConsentStatus) {
+        mLastConsentStatus = lastConsentStatus == null ? null : lastConsentStatus.getValue();
+        return this;
+    }
+
+    public SyncUrlGenerator withConsentChangeReason(@Nullable final String consentChangeReason) {
+        mConsentChangeReason = consentChangeReason;
+        return this;
+    }
+
+    public SyncUrlGenerator withConsentedVendorListVersion(
+            @Nullable final String consentedVendorListVersion) {
+        mConsentedVendorListVersion = consentedVendorListVersion;
+        return this;
+    }
+
+    public SyncUrlGenerator withConsentedPrivacyPolicyVersion(
+            @Nullable final String consentedPrivacyPolicyVersion) {
+        mConsentedPrivacyPolicyVersion = consentedPrivacyPolicyVersion;
+        return this;
+    }
+
+    public SyncUrlGenerator withCachedVendorListIabHash(
+            @Nullable final String cachedVendorListIabHash) {
+        mCachedVendorListIabHash = cachedVendorListIabHash;
+        return this;
+    }
+
+    public SyncUrlGenerator withExtras(@Nullable final String extras) {
+        mExtras = extras;
+        return this;
+    }
+
+    @Override
+    public String generateUrlString(@NonNull final String serverHostname) {
+        initUrlString(serverHostname, Constants.GDPR_SYNC_HANDLER);
+
+        addParam(AD_UNIT_ID_KEY, mAdUnitId);
+        addParam(SDK_VERSION_KEY, MoPub.SDK_VERSION);
+        addParam(LAST_CHANGED_MS_KEY, mLastChangedMs);
+        addParam(LAST_CONSENT_STATUS_KEY, mLastConsentStatus);
+        addParam(CURRENT_CONSENT_STATUS_KEY, mCurrentConsentStatus);
+        addParam(CONSENT_CHANGE_REASON_KEY, mConsentChangeReason);
+        addParam(CONSENTED_VENDOR_LIST_VERSION_KEY, mConsentedVendorListVersion);
+        addParam(CONSENTED_PRIVACY_POLICY_VERSION_KEY, mConsentedPrivacyPolicyVersion);
+        addParam(CACHED_VENDOR_LIST_IAB_HASH_KEY, mCachedVendorListIabHash);
+        addParam(EXTRAS_KEY, mExtras);
+        addParam(UDID_KEY, mUdid);
+        addParam(GDPR_APPLIES, mGdprApplies);
+        addParam(FORCE_GDPR_APPLIES, mForceGdprApplies);
+        addParam(FORCED_GDPR_APPLIES_CHANGED, mForceGdprAppliesChanged);
+        addParam(BUNDLE_ID_KEY, ClientMetadata.getInstance(mContext).getAppPackageName());
+        addParam(DNT_KEY, PlayServicesUrlRewriter.DO_NOT_TRACK_TEMPLATE);
+
+        return getFinalUrlString();
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/DeviceUtils.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/DeviceUtils.java
index c4395a46..be7cbf45 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/DeviceUtils.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/DeviceUtils.java
@@ -248,8 +248,14 @@ public static boolean isPermissionGranted(@NonNull final Context context,
         Preconditions.checkNotNull(context);
         Preconditions.checkNotNull(permission);
 
-        return ContextCompat.checkSelfPermission(context, permission) ==
-                PackageManager.PERMISSION_GRANTED;
+        // Bug in ContextCompat where it can return a RuntimeException in rare circumstances.
+        // If this happens, then we return false.
+        try {
+            return ContextCompat.checkSelfPermission(context, permission) ==
+                    PackageManager.PERMISSION_GRANTED;
+        } catch (Exception e) {
+            return false;
+        }
     }
 
     /**
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ManifestUtils.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ManifestUtils.java
index 791ef1f6..b373e756 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ManifestUtils.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ManifestUtils.java
@@ -19,6 +19,10 @@
 import java.util.ArrayList;
 import java.util.List;
 
+/**
+ * This class maintains lists of required Activity permissions,
+ * for the WebView, Native SDKs, and base SDK.
+ */
 public class ManifestUtils {
     private ManifestUtils() {}
 
@@ -26,13 +30,11 @@ private ManifestUtils() {}
     private static final String MRAID_ACTIVITY = "com.mopub.mobileads.MraidActivity";
     private static final String REWARDED_MRAID_ACTIVITY =
             "com.mopub.mobileads.RewardedMraidActivity";
-    private static final List<Class<? extends Activity>> REQUIRED_WEB_VIEW_SDK_ACTIVITIES;
+    private static final String CONSENT_ACTIVITY = "com.mopub.common.privacy.ConsentDialogActivity";
+
     private static FlagCheckUtil sFlagCheckUtil = new FlagCheckUtil();
 
-    /**
-     * This class maintains two different lists of required Activity permissions,
-     * for the WebView and Native SDKs.
-     */
+    private static final List<Class<? extends Activity>> REQUIRED_WEB_VIEW_SDK_ACTIVITIES;
     static {
         REQUIRED_WEB_VIEW_SDK_ACTIVITIES = new ArrayList<Class<? extends Activity>>(4);
         // As a convenience, full class paths are provided here, in case the MoPub SDK was imported
@@ -58,6 +60,22 @@ private ManifestUtils() {}
         REQUIRED_NATIVE_SDK_ACTIVITIES.add(com.mopub.common.MoPubBrowser.class);
     }
 
+    private static final List<Class<? extends Activity>> REQUIRED_GDPR_ACTIVITIES;
+    static {
+        REQUIRED_GDPR_ACTIVITIES = new ArrayList<>(1);
+        REQUIRED_GDPR_ACTIVITIES.add(com.mopub.common.privacy.ConsentDialogActivity.class);
+    }
+
+    public static void checkGdprActivitiesDeclared(@NonNull final Context context) {
+        if (!Preconditions.NoThrow.checkNotNull(context, "context is not allowed to be null")) {
+            return;
+        }
+
+        displayWarningForMissingActivities(context, REQUIRED_GDPR_ACTIVITIES);
+        displayWarningForMisconfiguredActivities(context, REQUIRED_GDPR_ACTIVITIES);
+    }
+
+
     public static void checkWebViewActivitiesDeclared(@NonNull final Context context) {
         if (!Preconditions.NoThrow.checkNotNull(context, "context is not allowed to be null")) {
             return;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/MoPubCollections.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/MoPubCollections.java
index a83bec24..465d696c 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/MoPubCollections.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/MoPubCollections.java
@@ -3,6 +3,8 @@
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 
+import com.mopub.common.Preconditions;
+
 import java.util.Collection;
 import java.util.Collections;
 
@@ -12,4 +14,13 @@
         Collections.addAll(c, a);
         c.removeAll(Collections.singleton(null));
     }
+
+    public static <T> void addAllNonNull(@NonNull final Collection<? super T> collection,
+            @NonNull final Collection<T> elementsToAdd) {
+        Preconditions.checkNotNull(collection);
+        Preconditions.checkNotNull(elementsToAdd);
+
+        collection.addAll(elementsToAdd);
+        collection.removeAll(Collections.singleton(null));
+    }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/Reflection.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/Reflection.java
index cf94ec5b..d3a2410f 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/Reflection.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/Reflection.java
@@ -6,6 +6,7 @@
 import com.mopub.common.Preconditions;
 
 import java.lang.reflect.Constructor;
+import java.lang.reflect.Field;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 import java.util.ArrayList;
@@ -176,4 +177,12 @@ public static boolean classFound(@NonNull final String className) {
 
         return constructor.newInstance(parameters);
     }
+
+    // access class private field
+    public static Field getPrivateField(@NonNull final Class classType, @NonNull final String fieldName) throws NoSuchFieldException {
+        Field declaredField = classType.getDeclaredField(fieldName);
+        declaredField.setAccessible(true);
+        return declaredField;
+    }
+
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ResponseHeader.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ResponseHeader.java
index ad909dbe..e1bf56f4 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ResponseHeader.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/common/util/ResponseHeader.java
@@ -56,6 +56,17 @@
     VIDEO_VIEWABILITY_TRACKERS("X-Video-Viewability-Trackers"),
     DISABLE_VIEWABILITY("X-Disable-Viewability"),
 
+    // Advanced bidding fields
+    AD_RESPONSE_TYPE("X-Ad-Response-Type"),
+
+    // Consent fields
+    INVALIDATE_CONSENT("invalidate_consent"),
+    FORCE_EXPLICIT_NO("force_explicit_no"),
+    REACQUIRE_CONSENT("reacquire_consent"),
+    CONSENT_CHANGE_REASON("consent_change_reason"),
+    FORCE_GDPR_APPLIES("force_gdpr_applies"),
+
+
     @Deprecated CUSTOM_SELECTOR("X-Customselector");
 
     private final String key;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdTypeTranslator.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdTypeTranslator.java
index 025571bb..a273daeb 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdTypeTranslator.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdTypeTranslator.java
@@ -7,7 +7,7 @@
 import com.mopub.common.AdType;
 import com.mopub.common.util.ResponseHeader;
 
-import java.util.Map;
+import org.json.JSONObject;
 
 import static com.mopub.network.HeaderUtils.extractHeader;
 
@@ -99,7 +99,7 @@ static String getAdNetworkType(String adType, String fullAdType) {
     public static String getCustomEventName(@NonNull AdFormat adFormat,
             @NonNull String adType,
             @Nullable String fullAdType,
-            @NonNull Map<String, String> headers) {
+            @Nullable JSONObject headers) {
         if (AdType.CUSTOM.equalsIgnoreCase(adType)) {
             return extractHeader(headers, ResponseHeader.CUSTOM_EVENT_NAME);
         } else if (AdType.STATIC_NATIVE.equalsIgnoreCase(adType)) {
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdViewController.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdViewController.java
index 57144826..a97f8e42 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdViewController.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/AdViewController.java
@@ -16,9 +16,9 @@
 import com.mopub.common.AdReport;
 import com.mopub.common.ClientMetadata;
 import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
 import com.mopub.common.Preconditions;
 import com.mopub.common.VisibleForTesting;
-import com.mopub.common.event.BaseEvent;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.DeviceUtils;
 import com.mopub.common.util.Dips;
@@ -66,6 +66,7 @@
     private Handler mHandler;
     private boolean mIsLoading;
     private String mUrl;
+    private boolean mExpanded;
 
     // This is the power of the exponential term in the exponential backoff calculation.
     @VisibleForTesting
@@ -87,6 +88,7 @@
     private boolean mShouldAllowAutoRefresh = true;
 
     private String mKeywords;
+    private String mUserDataKeywords;
     private Location mLocation;
     private boolean mIsTesting;
     private boolean mAdWasLoaded;
@@ -316,11 +318,33 @@ public void setKeywords(String keywords) {
         mKeywords = keywords;
     }
 
+    public String getUserDataKeywords() {
+        if (!MoPub.canCollectPersonalInformation()) {
+            return null;
+        }
+        return mUserDataKeywords;
+    }
+
+    public void setUserDataKeywords(String userDataKeywords) {
+        if (!MoPub.canCollectPersonalInformation()) {
+            mUserDataKeywords = null;
+            return;
+        }
+        mUserDataKeywords = userDataKeywords;
+    }
+
     public Location getLocation() {
+        if (!MoPub.canCollectPersonalInformation()) {
+            return null;
+        }
         return mLocation;
     }
 
     public void setLocation(Location location) {
+        if (!MoPub.canCollectPersonalInformation()) {
+            mLocation = null;
+            return;
+        }
         mLocation = location;
     }
 
@@ -374,7 +398,7 @@ void pauseRefresh() {
     }
 
     void resumeRefresh() {
-        if (mShouldAllowAutoRefresh) {
+        if (mShouldAllowAutoRefresh && !mExpanded) {
             setAutoRefreshStatus(true);
         }
     }
@@ -400,6 +424,16 @@ private void setAutoRefreshStatus(final boolean newAutoRefreshStatus) {
         }
     }
 
+    void expand() {
+        mExpanded = true;
+        pauseRefresh();
+    }
+
+    void collapse() {
+        mExpanded = false;
+        resumeRefresh();
+    }
+
     @Nullable
     public AdReport getAdReport() {
         if (mAdUnitId != null && mAdResponse != null) {
@@ -454,7 +488,7 @@ Integer getAdTimeoutDelay() {
     void trackImpression() {
         if (mAdResponse != null) {
             TrackingRequest.makeTrackingHttpRequest(mAdResponse.getImpressionTrackingUrl(),
-                    mContext, BaseEvent.Name.IMPRESSION_REQUEST);
+                    mContext);
         }
     }
 
@@ -462,7 +496,7 @@ void registerClick() {
         if (mAdResponse != null) {
             // Click tracker fired from Banners and Interstitials
             TrackingRequest.makeTrackingHttpRequest(mAdResponse.getClickTrackingUrl(),
-                    mContext, BaseEvent.Name.CLICK_REQUEST);
+                    mContext);
         }
     }
 
@@ -492,11 +526,19 @@ void forceRefresh() {
 
     @Nullable
     String generateAdUrl() {
-        return mUrlGenerator == null ? null : mUrlGenerator
+        if (mUrlGenerator == null) {
+            return null;
+        }
+
+        final boolean canCollectPersonalInformation = MoPub.canCollectPersonalInformation();
+
+        mUrlGenerator
                 .withAdUnitId(mAdUnitId)
                 .withKeywords(mKeywords)
-                .withLocation(mLocation)
-                .generateUrlString(Constants.HOST);
+                .withUserDataKeywords(canCollectPersonalInformation ? mUserDataKeywords : null)
+                .withLocation(canCollectPersonalInformation ? mLocation : null);
+
+        return mUrlGenerator.generateUrlString(Constants.HOST);
     }
 
     void adDidFail(MoPubErrorCode errorCode) {
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/BaseWebView.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/BaseWebView.java
index e42aad70..53a57f6c 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/BaseWebView.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/BaseWebView.java
@@ -37,6 +37,12 @@ public BaseWebView(Context context) {
         }
     }
 
+    @Override
+    protected void onAttachedToWindow() {
+        super.onAttachedToWindow();
+        WebViews.manageThirdPartyCookies(this);
+    }
+
     @Override
     public void destroy() {
         mIsDestroyed = true;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/ConversionUrlGenerator.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/ConversionUrlGenerator.java
new file mode 100644
index 00000000..d667ea73
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/ConversionUrlGenerator.java
@@ -0,0 +1,86 @@
+package com.mopub.mobileads;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.common.BaseUrlGenerator;
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
+
+class ConversionUrlGenerator extends BaseUrlGenerator {
+    private static final String SESSION_TRACKER_KEY = "st";
+    private static final String PACKAGE_NAME_KEY = "id";
+
+    @NonNull
+    private Context mContext;
+    @Nullable
+    private String mCurrentConsentStatus;
+    @Nullable
+    private String mConsentedVendorListVersion;
+    @Nullable
+    private String mConsentedPrivacyPolicyVersion;
+    @Nullable
+    private Boolean mGdprApplies;
+    private boolean mForceGdprApplies;
+
+    private boolean mSt;
+
+    ConversionUrlGenerator(@NonNull final Context context) {
+        mContext = context;
+    }
+
+    public ConversionUrlGenerator withCurrentConsentStatus(
+            @Nullable final String currentConsentStatus) {
+        mCurrentConsentStatus = currentConsentStatus;
+        return this;
+    }
+
+    public ConversionUrlGenerator withGdprApplies(@Nullable final Boolean gdprApplies) {
+        mGdprApplies = gdprApplies;
+        return this;
+    }
+
+    public ConversionUrlGenerator withForceGdprApplies(final boolean forceGdprApplies) {
+        mForceGdprApplies = forceGdprApplies;
+        return this;
+    }
+
+    public ConversionUrlGenerator withConsentedVendorListVersion(@Nullable final String consentedVendorListVersion) {
+        mConsentedVendorListVersion = consentedVendorListVersion;
+        return this;
+    }
+
+    public ConversionUrlGenerator withConsentedPrivacyPolicyVersion(@Nullable final String consentedPrivacyPolicyVersion) {
+        mConsentedPrivacyPolicyVersion = consentedPrivacyPolicyVersion;
+        return this;
+    }
+
+    public ConversionUrlGenerator withSessionTracker(final boolean st) {
+        mSt = st;
+        return this;
+    }
+
+    @Override
+    public String generateUrlString(String serverHostname) {
+        ClientMetadata clientMetadata = ClientMetadata.getInstance(mContext);
+
+        initUrlString(serverHostname, Constants.CONVERSION_TRACKING_HANDLER);
+        setApiVersion("6");
+        setAppVersion(clientMetadata.getAppVersion());
+        appendAdvertisingInfoTemplates();
+
+        addParam(PACKAGE_NAME_KEY, mContext.getPackageName());
+        if (mSt) {
+            addParam(SESSION_TRACKER_KEY, true);
+        }
+        addParam(SDK_VERSION_KEY, MoPub.SDK_VERSION);
+        addParam(CURRENT_CONSENT_STATUS_KEY, mCurrentConsentStatus);
+        addParam(CONSENTED_VENDOR_LIST_VERSION_KEY, mConsentedVendorListVersion);
+        addParam(CONSENTED_PRIVACY_POLICY_VERSION_KEY, mConsentedPrivacyPolicyVersion);
+        addParam(GDPR_APPLIES, mGdprApplies);
+        addParam(FORCE_GDPR_APPLIES, mForceGdprApplies);
+        return getFinalUrlString();
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java
index edcf4b3f..490ba301 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubConversionTracker.java
@@ -4,67 +4,110 @@
 import android.content.SharedPreferences;
 import android.support.annotation.NonNull;
 
-import com.mopub.common.BaseUrlGenerator;
-import com.mopub.common.ClientMetadata;
 import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
+import com.mopub.common.Preconditions;
 import com.mopub.common.SharedPreferencesHelper;
 import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.privacy.ConsentData;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.network.TrackingRequest;
 import com.mopub.volley.VolleyError;
 
 public class MoPubConversionTracker {
-    private Context mContext;
-    private String mIsTrackedKey;
+    private static final String WANT_TO_TRACK = " wantToTrack";
+
+    @NonNull
+    private final Context mContext;
+    @NonNull
+    private final String mWantToTrack;
+    @NonNull
+    private final String mIsTrackedKey;
+    @NonNull
     private SharedPreferences mSharedPreferences;
-    private String mPackageName;
 
-    public void reportAppOpen(Context context) {
-        if (context == null) {
+    public MoPubConversionTracker(@NonNull final Context context) {
+        Preconditions.checkNotNull(context);
+
+        mContext = context.getApplicationContext();
+        String packageName = mContext.getPackageName();
+        mWantToTrack = packageName + WANT_TO_TRACK;
+        mIsTrackedKey = packageName + " tracked";
+        mSharedPreferences = SharedPreferencesHelper.getSharedPreferences(mContext);
+    }
+
+    /**
+     * Call this to report conversion tracking.
+     */
+    public void reportAppOpen() {
+        reportAppOpen(false);
+    }
+
+    /**
+     * This method is only used internally. Do not call this method.
+     *
+     * @param sessionTracker - true for session tracking
+     */
+    public void reportAppOpen(boolean sessionTracker) {
+        final PersonalInfoManager infoManager = MoPub.getPersonalInformationManager();
+        if (infoManager == null) {
+            MoPubLog.w("Cannot report app open until initialization is done");
             return;
         }
 
-        mContext = context;
-        mPackageName = mContext.getPackageName();
-        mIsTrackedKey = mPackageName + " tracked";
-        mSharedPreferences = SharedPreferencesHelper.getSharedPreferences(mContext);
 
-        if (!isAlreadyTracked()) {
-            TrackingRequest.makeTrackingHttpRequest(new ConversionUrlGenerator().generateUrlString(Constants.HOST),
-                    mContext, new TrackingRequest.Listener() {
-                @Override
-                public void onResponse(@NonNull String url) {
-                    mSharedPreferences
-                            .edit()
-                            .putBoolean(mIsTrackedKey, true)
-                            .commit();
-                }
-
-                @Override
-                public void onErrorResponse(final VolleyError volleyError) { }
-            });
-        } else {
+        if (!sessionTracker && isAlreadyTracked()) {
             MoPubLog.d("Conversion already tracked");
+            return;
         }
-    }
 
-    private boolean isAlreadyTracked() {
-        return mSharedPreferences.getBoolean(mIsTrackedKey, false);
+        if (!sessionTracker && !MoPub.canCollectPersonalInformation()) {
+            mSharedPreferences
+                    .edit()
+                    .putBoolean(mWantToTrack, true)
+                    .apply();
+            return;
+        }
+
+        final ConsentData consentData = infoManager.getConsentData();
+        final String url = new ConversionUrlGenerator(mContext)
+                .withGdprApplies(infoManager.gdprApplies())
+                .withForceGdprApplies(consentData.isForceGdprApplies())
+                .withCurrentConsentStatus(infoManager.getPersonalInfoConsentStatus().getValue())
+                .withConsentedPrivacyPolicyVersion(consentData.getConsentedPrivacyPolicyVersion())
+                .withConsentedVendorListVersion(consentData.getConsentedVendorListVersion())
+                .withSessionTracker(sessionTracker)
+                .generateUrlString(Constants.HOST);
+
+        TrackingRequest.makeTrackingHttpRequest(url,
+                mContext, new TrackingRequest.Listener() {
+                    @Override
+                    public void onResponse(@NonNull final String url) {
+                        mSharedPreferences
+                                .edit()
+                                .putBoolean(mIsTrackedKey, true)
+                                .putBoolean(mWantToTrack, false)
+                                .apply();
+                    }
+
+                    @Override
+                    public void onErrorResponse(final VolleyError volleyError) {
+                    }
+                });
+
     }
 
-    private class ConversionUrlGenerator extends BaseUrlGenerator {
-        @Override
-        public String generateUrlString(String serverHostname) {
-            initUrlString(serverHostname, Constants.CONVERSION_TRACKING_HANDLER);
-            setApiVersion("6");
-            setPackageId(mPackageName);
-            ClientMetadata clientMetadata = ClientMetadata.getInstance(mContext);
-            setAppVersion(clientMetadata.getAppVersion());
-            appendAdvertisingInfoTemplates();
-            return getFinalUrlString();
+    public boolean shouldTrack() {
+        PersonalInfoManager infoManager = MoPub.getPersonalInformationManager();
+        if (infoManager == null) {
+            return false;
         }
 
-        private void setPackageId(String packageName) {
-            addParam("id", packageName);
-        }
+        return infoManager.canCollectPersonalInformation() &&
+                mSharedPreferences.getBoolean(mWantToTrack, false);
+    }
+
+    private boolean isAlreadyTracked() {
+        return mSharedPreferences.getBoolean(mIsTrackedKey, false);
     }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubErrorCode.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubErrorCode.java
index b7c20a78..cc74ef2c 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubErrorCode.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubErrorCode.java
@@ -26,6 +26,9 @@
     REWARDED_CURRENCIES_PARSING_ERROR("Error parsing rewarded currencies JSON header."),
     REWARD_NOT_SELECTED("Reward not selected for rewarded ad."),
 
+    DO_NOT_TRACK("Do not track is enabled."),
+    GDPR_DOES_NOT_APPLY("GDPR does not apply. Ignoring consent-related actions."),
+
     UNSPECIFIED("Unspecified error.");
 
     private final String message;
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubView.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubView.java
index 4b26ded7..4f6fd25e 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubView.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/MoPubView.java
@@ -11,11 +11,11 @@
 import android.text.TextUtils;
 import android.util.AttributeSet;
 import android.view.View;
-import android.webkit.WebViewDatabase;
 import android.widget.FrameLayout;
 
 import com.mopub.common.AdFormat;
 import com.mopub.common.AdReport;
+import com.mopub.common.MoPub;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.ManifestUtils;
 import com.mopub.common.util.Reflection;
@@ -65,25 +65,6 @@ public MoPubView(Context context, AttributeSet attrs) {
         setHorizontalScrollBarEnabled(false);
         setVerticalScrollBarEnabled(false);
 
-        try {
-            // There is a rare bug in Froyo/2.2 where creation of a WebView causes a
-            // NullPointerException. (https://code.google.com/p/android/issues/detail?id=10789)
-            // It happens when the WebView can't access the local file store to make a cache file.
-            // Here, we'll work around it by trying to create a file store and then just go inert
-            // if it's not accessible.
-            if (WebViewDatabase.getInstance(context) == null) {
-                MoPubLog.e("Disabling MoPub. Local cache file is inaccessible so MoPub will " +
-                        "fail if we try to create a WebView. Details of this Android bug found at:" +
-                        "https://code.google.com/p/android/issues/detail?id=10789");
-                return;
-            }
-        } catch (Exception e) {
-            // If anything goes wrong here, it's most likely due to not having a WebView at all.
-            // This happens when Android updates WebView.
-            MoPubLog.e("Disabling MoPub due to no WebView, or it's being updated", e);
-            return;
-        }
-
         mAdViewController = AdViewControllerFactory.create(context, this);
         registerScreenStateBroadcastReceiver();
     }
@@ -291,15 +272,27 @@ public void setKeywords(String keywords) {
     }
 
     public String getKeywords() {
-        return (mAdViewController != null) ? mAdViewController.getKeywords() : null;
+        return (mAdViewController != null) ? mAdViewController.getKeywords(): null;
+    }
+
+    public void setUserDataKeywords(String userDataKeywords) {
+        if (mAdViewController != null && MoPub.canCollectPersonalInformation()) {
+            mAdViewController.setUserDataKeywords(userDataKeywords);
+        }
+    }
+
+    public String getUserDataKeywords() {
+        return (mAdViewController != null && MoPub.canCollectPersonalInformation()) ? mAdViewController.getUserDataKeywords() : null;
     }
 
     public void setLocation(Location location) {
-        if (mAdViewController != null) mAdViewController.setLocation(location);
+        if (mAdViewController != null && MoPub.canCollectPersonalInformation()) {
+            mAdViewController.setLocation(location);
+        }
     }
 
     public Location getLocation() {
-        return (mAdViewController != null) ? mAdViewController.getLocation() : null;
+        return (mAdViewController != null && MoPub.canCollectPersonalInformation()) ? mAdViewController.getLocation() : null;
     }
 
     public int getAdWidth() {
@@ -339,6 +332,30 @@ public void setAutorefreshEnabled(boolean enabled) {
         }
     }
 
+    void pauseAutorefresh() {
+        if (mAdViewController != null) {
+            mAdViewController.pauseRefresh();
+        }
+    }
+
+    void resumeAutorefresh() {
+        if (mAdViewController != null) {
+            mAdViewController.resumeRefresh();
+        }
+    }
+
+    void expand() {
+        if (mAdViewController != null) {
+            mAdViewController.expand();
+        }
+    }
+
+    void collapse() {
+        if (mAdViewController != null) {
+            mAdViewController.collapse();
+        }
+    }
+
     public boolean getAutorefreshEnabled() {
         if (mAdViewController != null) return mAdViewController.getCurrentAutoRefreshStatus();
         else {
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoConfig.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoConfig.java
index 77a8d5f4..c845fd9d 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoConfig.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoConfig.java
@@ -72,6 +72,8 @@
 
     // MoPub-specific metadata
     private String mDspCreativeId;
+    private String mPrivacyInformationIconImageUrl;
+    private String mPrivacyInformationIconClickthroughUrl;
 
     /**
      * Flag to indicate if the VAST xml document has explicitly set the orientation as opposed to
@@ -339,6 +341,16 @@ public void setIsRewardedVideo(final boolean isRewardedVideo) {
         mIsRewardedVideo = isRewardedVideo;
     }
 
+    public void setPrivacyInformationIconImageUrl(
+            @Nullable final String privacyInformationIconImageUrl) {
+        mPrivacyInformationIconImageUrl = privacyInformationIconImageUrl;
+    }
+
+    public void setPrivacyInformationIconClickthroughUrl(
+            @Nullable final String privacyInformationIconClickthroughUrl) {
+        mPrivacyInformationIconClickthroughUrl = privacyInformationIconClickthroughUrl;
+    }
+
     /**
      * Getters
      */
@@ -513,6 +525,16 @@ public boolean isRewardedVideo() {
         return mIsRewardedVideo;
     }
 
+    @Nullable
+    public String getPrivacyInformationIconImageUrl() {
+        return mPrivacyInformationIconImageUrl;
+    }
+
+    @Nullable
+    public String getPrivacyInformationIconClickthroughUrl() {
+        return mPrivacyInformationIconClickthroughUrl;
+    }
+
     /**
      * Called when the video starts playing.
      *
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoViewController.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoViewController.java
index 128282f9..a1e67198 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoViewController.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/VastVideoViewController.java
@@ -33,7 +33,6 @@
 import com.mopub.mobileads.resource.DrawableConstants;
 
 import java.io.Serializable;
-import java.util.Arrays;
 import java.util.Map;
 
 import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;
@@ -172,6 +171,7 @@ public boolean onTouch(View view, MotionEvent motionEvent) {
         mExternalViewabilitySessionManager = new ExternalViewabilitySessionManager(activity);
         mExternalViewabilitySessionManager.createVideoSession(activity, mVideoView,
                 mVastVideoConfig);
+        mExternalViewabilitySessionManager.registerVideoObstruction(mBlurredLastVideoFrameImageView);
 
         // Companion ad view, set to invisible initially to have it be drawn to calculate size
         mLandscapeCompanionAdView = createCompanionAdView(activity,
@@ -221,10 +221,6 @@ public void onGlobalLayout() {
         // Always add last to layout since it must be visible above all other views
         addCloseButtonWidget(activity, View.GONE);
 
-        mExternalViewabilitySessionManager.registerVideoObstructions(Arrays.asList(
-                mTopGradientStripWidget, mProgressBarWidget, mBottomGradientStripWidget,
-                mRadialCountdownWidget, mCtaButtonWidget, mSocialActionsView, mCloseButtonWidget));
-
         Handler mainHandler = new Handler(Looper.getMainLooper());
         mProgressCheckerRunnable = new VastVideoViewProgressRunnable(this, mVastVideoConfig,
                 mainHandler);
@@ -504,6 +500,7 @@ private void addTopGradientStripWidget(@NonNull final Context context) {
                 RelativeLayout.ALIGN_TOP,
                 getLayout().getId());
         getLayout().addView(mTopGradientStripWidget);
+        mExternalViewabilitySessionManager.registerVideoObstruction(mTopGradientStripWidget);
     }
 
     private void addBottomGradientStripWidget(@NonNull final Context context) {
@@ -517,6 +514,7 @@ private void addBottomGradientStripWidget(@NonNull final Context context) {
                 RelativeLayout.ABOVE,
                 mProgressBarWidget.getId());
         getLayout().addView(mBottomGradientStripWidget);
+        mExternalViewabilitySessionManager.registerVideoObstruction(mBottomGradientStripWidget);
     }
 
     private void addProgressBarWidget(@NonNull final Context context, int initialVisibility) {
@@ -524,12 +522,14 @@ private void addProgressBarWidget(@NonNull final Context context, int initialVis
         mProgressBarWidget.setAnchorId(mVideoView.getId());
         mProgressBarWidget.setVisibility(initialVisibility);
         getLayout().addView(mProgressBarWidget);
+        mExternalViewabilitySessionManager.registerVideoObstruction(mProgressBarWidget);
     }
 
     private void addRadialCountdownWidget(@NonNull final Context context, int initialVisibility) {
         mRadialCountdownWidget = new VastVideoRadialCountdownWidget(context);
         mRadialCountdownWidget.setVisibility(initialVisibility);
         getLayout().addView(mRadialCountdownWidget);
+        mExternalViewabilitySessionManager.registerVideoObstruction(mRadialCountdownWidget);
     }
 
     private void addCtaButtonWidget(@NonNull final Context context) {
@@ -541,6 +541,7 @@ private void addCtaButtonWidget(@NonNull final Context context) {
                 hasClickthroughUrl);
 
         getLayout().addView(mCtaButtonWidget);
+        mExternalViewabilitySessionManager.registerVideoObstruction(mCtaButtonWidget);
 
         mCtaButtonWidget.setOnTouchListener(mClickThroughListener);
 
@@ -556,6 +557,7 @@ private void addCloseButtonWidget(@NonNull final Context context, int initialVis
         mCloseButtonWidget.setVisibility(initialVisibility);
 
         getLayout().addView(mCloseButtonWidget);
+        mExternalViewabilitySessionManager.registerVideoObstruction(mCloseButtonWidget);
 
         final View.OnTouchListener closeOnTouchListener = new View.OnTouchListener() {
             @Override
@@ -632,6 +634,7 @@ View createCompanionAdView(@NonNull final Context context,
                         RelativeLayout.LayoutParams.MATCH_PARENT,
                         RelativeLayout.LayoutParams.MATCH_PARENT);
         getLayout().addView(relativeLayout, layoutParams);
+        mExternalViewabilitySessionManager.registerVideoObstruction(relativeLayout);
 
         VastWebView companionView = createCompanionVastWebView(context, vastCompanionAdConfig);
 
@@ -644,6 +647,8 @@ View createCompanionAdView(@NonNull final Context context,
         companionAdLayout.addRule(RelativeLayout.CENTER_IN_PARENT, RelativeLayout.TRUE);
 
         relativeLayout.addView(companionView, companionAdLayout);
+        mExternalViewabilitySessionManager.registerVideoObstruction(companionView);
+
         return companionView;
     }
 
@@ -695,9 +700,12 @@ View createSocialActionsView(@NonNull final Context context,
                 new RelativeLayout.LayoutParams(
                         RelativeLayout.LayoutParams.WRAP_CONTENT,
                         RelativeLayout.LayoutParams.WRAP_CONTENT);
+
         relativeLayout.addView(companionView, layoutParams);
+        mExternalViewabilitySessionManager.registerVideoObstruction(companionView);
 
         getLayout().addView(relativeLayout, companionAdLayout);
+        mExternalViewabilitySessionManager.registerVideoObstruction(relativeLayout);
 
         companionView.setVisibility(initialVisibility);
         return companionView;
@@ -753,6 +761,7 @@ public boolean shouldOverrideUrlLoading(WebView view, String url) {
         layoutParams.setMargins(leftMargin, topMargin, 0, 0);
 
         getLayout().addView(iconView, layoutParams);
+        mExternalViewabilitySessionManager.registerVideoObstruction(iconView);
 
         return iconView;
     }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/util/WebViews.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/util/WebViews.java
index f97898a0..05ceec73 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/util/WebViews.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mobileads/util/WebViews.java
@@ -1,11 +1,15 @@
 package com.mopub.mobileads.util;
 
+import android.os.Build;
 import android.support.annotation.NonNull;
+import android.webkit.CookieManager;
 import android.webkit.JsPromptResult;
 import android.webkit.JsResult;
 import android.webkit.WebChromeClient;
 import android.webkit.WebView;
 
+import com.mopub.common.MoPub;
+import com.mopub.common.Preconditions;
 import com.mopub.common.logging.MoPubLog;
 
 public class WebViews {
@@ -59,4 +63,34 @@ public boolean onJsBeforeUnload(@NonNull final WebView view, @NonNull final Stri
             }
         });
     }
+
+    public static void manageWebCookies() {
+        CookieManager cookieManager = CookieManager.getInstance();
+        if (MoPub.canCollectPersonalInformation()) {
+            cookieManager.setAcceptCookie(true);
+            CookieManager.setAcceptFileSchemeCookies(true);
+            return;
+        }
+
+        // remove all cookies
+        cookieManager.setAcceptCookie(false);
+        CookieManager.setAcceptFileSchemeCookies(false);
+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
+            cookieManager.removeSessionCookies(null);
+            cookieManager.removeAllCookies(null);
+            cookieManager.flush();
+        } else {
+            cookieManager.removeSessionCookie();
+            cookieManager.removeAllCookie();
+        }
+    }
+
+    public static void manageThirdPartyCookies(@NonNull final WebView webView){
+        Preconditions.checkNotNull(webView);
+
+        CookieManager cookieManager = CookieManager.getInstance();
+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
+            cookieManager.setAcceptThirdPartyCookies(webView, MoPub.canCollectPersonalInformation());
+        }
+    }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mraid/MraidController.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mraid/MraidController.java
index 834483a9..ef3c6834 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mraid/MraidController.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/mraid/MraidController.java
@@ -1076,6 +1076,11 @@ public Context getContext() {
         return mContext;
     }
 
+    @NonNull
+    WeakReference<Activity> getWeakActivity() {
+        return mWeakActivity;
+    }
+
     @VisibleForTesting
     void handleSetOrientationProperties(final boolean allowOrientationChange,
             final MraidOrientation forceOrientation) throws MraidCommandException {
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdRequest.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdRequest.java
index bd4ba50e..23aa9f40 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdRequest.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdRequest.java
@@ -1,7 +1,6 @@
 package com.mopub.network;
 
 import android.content.Context;
-import android.location.Location;
 import android.net.Uri;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
@@ -11,29 +10,25 @@
 import com.mopub.common.AdType;
 import com.mopub.common.DataKeys;
 import com.mopub.common.FullAdType;
-import com.mopub.common.LocationService;
 import com.mopub.common.MoPub;
 import com.mopub.common.MoPub.BrowserAgent;
 import com.mopub.common.Preconditions;
 import com.mopub.common.VisibleForTesting;
-import com.mopub.common.event.BaseEvent;
-import com.mopub.common.event.Event;
-import com.mopub.common.event.EventDetails;
-import com.mopub.common.event.MoPubEvents;
 import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.util.Json;
 import com.mopub.common.util.ResponseHeader;
 import com.mopub.mobileads.AdTypeTranslator;
 import com.mopub.volley.DefaultRetryPolicy;
 import com.mopub.volley.NetworkResponse;
-import com.mopub.volley.Request;
 import com.mopub.volley.Response;
 import com.mopub.volley.toolbox.HttpHeaderParser;
 
+import org.json.JSONArray;
 import org.json.JSONException;
 import org.json.JSONObject;
 
-import java.io.UnsupportedEncodingException;
+import java.util.HashMap;
 import java.util.Locale;
 import java.util.Map;
 import java.util.TreeMap;
@@ -44,23 +39,37 @@
 import static com.mopub.network.HeaderUtils.extractIntegerHeader;
 import static com.mopub.network.HeaderUtils.extractPercentHeaderString;
 
-public class AdRequest extends Request<AdResponse> {
+public class AdRequest extends MoPubRequest<AdResponse> {
+
+    @VisibleForTesting
+    static final String AD_RESPONSES_KEY = "ad-responses";
+    private static final String ADM_KEY = "adm";
+    private static final String BODY_KEY = "body";
+    private static final String HEADERS_KEY = "headers";
 
     @NonNull private final AdRequest.Listener mListener;
     @NonNull private final AdFormat mAdFormat;
     @Nullable private final String mAdUnitId;
     @NonNull private final Context mContext;
+    @Nullable private static ServerOverrideListener sServerOverrideListener;
 
     public interface Listener extends Response.ErrorListener {
         void onSuccess(AdResponse response);
     }
 
+    public interface ServerOverrideListener {
+        void onForceExplicitNo(@Nullable final String consentChangeReason);
+        void onInvalidateConsent(@Nullable final String consentChangeReason);
+        void onReacquireConsent(@Nullable final String consentChangeReason);
+        void onForceGdprApplies();
+    }
+
     public AdRequest(@NonNull final String url,
             @NonNull final AdFormat adFormat,
             @Nullable final String adUnitId,
             @NonNull Context context,
             @NonNull final Listener listener) {
-        super(Method.GET, url, listener);
+        super(context, clearUrlIfSdkNotInitialized(url), listener);
         Preconditions.checkNotNull(adFormat);
         Preconditions.checkNotNull(listener);
         mAdUnitId = adUnitId;
@@ -73,6 +82,26 @@ public AdRequest(@NonNull final String url,
                 DefaultRetryPolicy.DEFAULT_BACKOFF_MULT);
         setRetryPolicy(retryPolicy);
         setShouldCache(false);
+
+        final PersonalInfoManager personalInfoManager = MoPub.getPersonalInformationManager();
+        if (personalInfoManager != null) {
+            personalInfoManager.requestSync(false);
+        }
+    }
+
+    /**
+     * For 5.2 and onwards, disable load when the sdk is not initialized.
+     *
+     * @param url The original url
+     * @return The original url if the sdk is initialized. Otherwise, returns an empty url.
+     */
+    @NonNull
+    private static String clearUrlIfSdkNotInitialized(@NonNull final String url) {
+        if (MoPub.getPersonalInformationManager() == null || !MoPub.isSdkInitialized()) {
+            MoPubLog.e("Make sure to call MoPub#initializeSdk before loading an ad.");
+            return "";
+        }
+        return url;
     }
 
     @NonNull
@@ -80,6 +109,11 @@ public Listener getListener() {
         return mListener;
     }
 
+    public static void setServerOverrideListener(
+            @NonNull final ServerOverrideListener serverOverrideListener) {
+        sServerOverrideListener = serverOverrideListener;
+    }
+
     @Override
     public Map<String, String> getHeaders() {
         TreeMap<String, String> headers = new TreeMap<String, String>();
@@ -108,28 +142,53 @@ public Listener getListener() {
         // NOTE: We never get status codes outside of {[200, 299], 304}. Those errors are sent to the
         // error listener.
 
-        Map<String, String> headers = networkResponse.headers;
+        // convert all keys to lowercase
+        final Map<String, String> headers = new HashMap<>();
+        for(final String key : networkResponse.headers.keySet() ){
+            headers.put(key.toLowerCase(), networkResponse.headers.get(key));
+        }
+
+        final JSONObject jsonHeaders;
+        final JSONObject currentAdResponse;
 
         if (extractBooleanHeader(headers, ResponseHeader.WARMUP, false)) {
-            return Response.error(new MoPubNetworkError("Ad Unit is warming up.", MoPubNetworkError.Reason.WARMING_UP));
+            return Response.error(new MoPubNetworkError("Ad Unit is warming up.",
+                    MoPubNetworkError.Reason.WARMING_UP));
         }
 
+        final AdResponse.Builder builder = new AdResponse.Builder();
+        builder.setAdUnitId(mAdUnitId);
 
-        Location location = LocationService.getLastKnownLocation(mContext,
-                MoPub.getLocationPrecision(),
-                MoPub.getLocationAwareness());
+        // Response Body encoding / decoding
+        final String responseBody = parseStringBody(networkResponse);
+        builder.setResponseBody(responseBody);
 
-        AdResponse.Builder builder = new AdResponse.Builder();
-        builder.setAdUnitId(mAdUnitId);
+        if (AdType.MULTI.equalsIgnoreCase(extractHeader(headers, ResponseHeader.AD_RESPONSE_TYPE))) {
+            try {
+                final JSONObject rootBody = new JSONObject(responseBody);
+                final JSONArray adResponsesJson = rootBody.getJSONArray(AD_RESPONSES_KEY);
+                // Currently, there is only one ad response. Client-side waterfall will be
+                // able to handle multiple ad responses.
+                currentAdResponse = adResponsesJson.getJSONObject(0);
+                jsonHeaders = currentAdResponse.getJSONObject(HEADERS_KEY);
+            } catch (JSONException e) {
+                return Response.error(
+                        new MoPubNetworkError("Failed to decode header JSON",
+                                e, MoPubNetworkError.Reason.BAD_HEADER_DATA));
+            }
+        } else {
+            jsonHeaders = new JSONObject(headers);
+            currentAdResponse = null;
+        }
 
-        String adTypeString = extractHeader(headers, ResponseHeader.AD_TYPE);
-        String fullAdTypeString = extractHeader(headers, ResponseHeader.FULL_AD_TYPE);
+        String adTypeString = extractHeader(jsonHeaders, ResponseHeader.AD_TYPE);
+        String fullAdTypeString = extractHeader(jsonHeaders, ResponseHeader.FULL_AD_TYPE);
         builder.setAdType(adTypeString);
         builder.setFullAdType(fullAdTypeString);
 
         // In the case of a CLEAR response, the REFRESH_TIME header must still be respected. Ensure
         // that it is parsed and passed along to the MoPubNetworkError.
-        final Integer refreshTimeSeconds = extractIntegerHeader(headers,
+        final Integer refreshTimeSeconds = extractIntegerHeader(jsonHeaders,
                 ResponseHeader.REFRESH_TIME);
         final Integer refreshTimeMilliseconds = refreshTimeSeconds == null
                 ? null
@@ -138,7 +197,6 @@ public Listener getListener() {
 
         if (AdType.CLEAR.equals(adTypeString)) {
             final AdResponse adResponse = builder.build();
-            logScribeEvent(adResponse, networkResponse, location);
             return Response.error(
                     new MoPubNetworkError(
                             "No ads found for ad unit.",
@@ -148,44 +206,41 @@ public Listener getListener() {
             );
         }
 
-        String dspCreativeId = extractHeader(headers, ResponseHeader.DSP_CREATIVE_ID);
+        String dspCreativeId = extractHeader(jsonHeaders, ResponseHeader.DSP_CREATIVE_ID);
         builder.setDspCreativeId(dspCreativeId);
 
-        String networkType = extractHeader(headers, ResponseHeader.NETWORK_TYPE);
+        String networkType = extractHeader(jsonHeaders, ResponseHeader.NETWORK_TYPE);
         builder.setNetworkType(networkType);
 
-        String redirectUrl = extractHeader(headers, ResponseHeader.REDIRECT_URL);
+        String redirectUrl = extractHeader(jsonHeaders, ResponseHeader.REDIRECT_URL);
         builder.setRedirectUrl(redirectUrl);
 
         // X-Clickthrough is parsed into the AdResponse as the click tracker
         // Used by AdViewController, Rewarded Video, Native Adapter, MoPubNative
-        String clickTrackingUrl = extractHeader(headers, ResponseHeader.CLICK_TRACKING_URL);
+        String clickTrackingUrl = extractHeader(jsonHeaders, ResponseHeader.CLICK_TRACKING_URL);
         builder.setClickTrackingUrl(clickTrackingUrl);
 
-        builder.setImpressionTrackingUrl(extractHeader(headers, ResponseHeader.IMPRESSION_URL));
+        builder.setImpressionTrackingUrl(extractHeader(jsonHeaders, ResponseHeader.IMPRESSION_URL));
 
-        String failUrl = extractHeader(headers, ResponseHeader.FAIL_URL);
+        String failUrl = extractHeader(jsonHeaders, ResponseHeader.FAIL_URL);
         builder.setFailoverUrl(failUrl);
 
         String requestId = getRequestId(failUrl);
         builder.setRequestId(requestId);
 
-        boolean isScrollable = extractBooleanHeader(headers, ResponseHeader.SCROLLABLE, false);
+        boolean isScrollable = extractBooleanHeader(jsonHeaders, ResponseHeader.SCROLLABLE, false);
         builder.setScrollable(isScrollable);
 
-        Integer width = extractIntegerHeader(headers, ResponseHeader.WIDTH);
-        Integer height = extractIntegerHeader(headers, ResponseHeader.HEIGHT);
+        Integer width = extractIntegerHeader(jsonHeaders, ResponseHeader.WIDTH);
+        Integer height = extractIntegerHeader(jsonHeaders, ResponseHeader.HEIGHT);
         builder.setDimensions(width, height);
 
-        Integer adTimeoutDelaySeconds = extractIntegerHeader(headers, ResponseHeader.AD_TIMEOUT);
+        Integer adTimeoutDelaySeconds = extractIntegerHeader(jsonHeaders, ResponseHeader.AD_TIMEOUT);
         builder.setAdTimeoutDelayMilliseconds(
                 adTimeoutDelaySeconds == null
                         ? null
                         : adTimeoutDelaySeconds * 1000);
 
-        // Response Body encoding / decoding
-        String responseBody = parseStringBody(networkResponse);
-        builder.setResponseBody(responseBody);
         if (AdType.STATIC_NATIVE.equals(adTypeString) || AdType.VIDEO_NATIVE.equals(adTypeString)) {
             try {
                 builder.setJsonBody(new JSONObject(responseBody));
@@ -198,21 +253,21 @@ public Listener getListener() {
 
         // Derive custom event fields
         String customEventClassName = AdTypeTranslator.getCustomEventName(mAdFormat, adTypeString,
-                fullAdTypeString, headers);
+                fullAdTypeString, jsonHeaders);
         builder.setCustomEventClassName(customEventClassName);
 
         // Default browser agent from X-Browser-Agent header
         BrowserAgent browserAgent = BrowserAgent.fromHeader(
-                extractIntegerHeader(headers, ResponseHeader.BROWSER_AGENT));
+                extractIntegerHeader(jsonHeaders, ResponseHeader.BROWSER_AGENT));
         MoPub.setBrowserAgentFromAdServer(browserAgent);
         builder.setBrowserAgent(browserAgent);
 
         // Process server extras if they are present:
-        String customEventData = extractHeader(headers, ResponseHeader.CUSTOM_EVENT_DATA);
+        String customEventData = extractHeader(jsonHeaders, ResponseHeader.CUSTOM_EVENT_DATA);
 
         // Some server-supported custom events (like Millennial banners) use a different header field
         if (TextUtils.isEmpty(customEventData)) {
-            customEventData = extractHeader(headers, ResponseHeader.NATIVE_PARAMS);
+            customEventData = extractHeader(jsonHeaders, ResponseHeader.NATIVE_PARAMS);
         }
 
         final Map<String, String> serverExtras;
@@ -224,10 +279,20 @@ public Listener getListener() {
                             e, MoPubNetworkError.Reason.BAD_HEADER_DATA));
         }
 
-        if (redirectUrl != null) {
+        try {
+            if (currentAdResponse != null) {
+                serverExtras.put(DataKeys.ADM_KEY, currentAdResponse.getString(ADM_KEY));
+            }
+        } catch (JSONException e) {
+            return Response.error(
+                    new MoPubNetworkError("Failed to parse ADM for advanced bidding",
+                            e, MoPubNetworkError.Reason.BAD_BODY));
+        }
+
+        if (!TextUtils.isEmpty(redirectUrl)) {
             serverExtras.put(DataKeys.REDIRECT_URL_KEY, redirectUrl);
         }
-        if (clickTrackingUrl != null) {
+        if (!TextUtils.isEmpty(clickTrackingUrl)) {
             // X-Clickthrough parsed into serverExtras
             // Used by Banner, Interstitial
             serverExtras.put(DataKeys.CLICKTHROUGH_URL_KEY, clickTrackingUrl);
@@ -236,12 +301,12 @@ public Listener getListener() {
             // Some MoPub-specific custom events get their serverExtras from the response itself:
             serverExtras.put(DataKeys.HTML_RESPONSE_BODY_KEY, responseBody);
             serverExtras.put(DataKeys.SCROLLABLE_KEY, Boolean.toString(isScrollable));
-            serverExtras.put(DataKeys.CREATIVE_ORIENTATION_KEY, extractHeader(headers, ResponseHeader.ORIENTATION));
+            serverExtras.put(DataKeys.CREATIVE_ORIENTATION_KEY, extractHeader(jsonHeaders, ResponseHeader.ORIENTATION));
         }
         if (AdType.STATIC_NATIVE.equals(adTypeString) || AdType.VIDEO_NATIVE.equals(adTypeString)) {
-            final String impressionMinVisiblePercent = extractPercentHeaderString(headers,
+            final String impressionMinVisiblePercent = extractPercentHeaderString(jsonHeaders,
                     ResponseHeader.IMPRESSION_MIN_VISIBLE_PERCENT);
-            final String impressionVisibleMS = extractHeader(headers,
+            final String impressionVisibleMS = extractHeader(jsonHeaders,
                     ResponseHeader.IMPRESSION_VISIBLE_MS);
             final String impressionMinVisiblePx = extractHeader(headers,
                     ResponseHeader.IMPRESSION_MIN_VISIBLE_PX);
@@ -258,40 +323,23 @@ public Listener getListener() {
         }
         if (AdType.VIDEO_NATIVE.equals(adTypeString)) {
             serverExtras.put(DataKeys.PLAY_VISIBLE_PERCENT,
-                    extractPercentHeaderString(headers, ResponseHeader.PLAY_VISIBLE_PERCENT));
+                    extractPercentHeaderString(jsonHeaders, ResponseHeader.PLAY_VISIBLE_PERCENT));
             serverExtras.put(DataKeys.PAUSE_VISIBLE_PERCENT,
-                    extractPercentHeaderString(headers, ResponseHeader.PAUSE_VISIBLE_PERCENT));
-            serverExtras.put(DataKeys.MAX_BUFFER_MS, extractHeader(headers,
+                    extractPercentHeaderString(jsonHeaders, ResponseHeader.PAUSE_VISIBLE_PERCENT));
+            serverExtras.put(DataKeys.MAX_BUFFER_MS, extractHeader(jsonHeaders,
                     ResponseHeader.MAX_BUFFER_MS));
-
-            builder.setEventDetails(new EventDetails.Builder()
-                            .adUnitId(mAdUnitId)
-                            .adType(adTypeString)
-                            .adNetworkType(networkType)
-                            .adWidthPx(width)
-                            .adHeightPx(height)
-                            .dspCreativeId(dspCreativeId)
-                            .geoLatitude(location == null ? null : location.getLatitude())
-                            .geoLongitude(location == null ? null : location.getLongitude())
-                            .geoAccuracy(location == null ? null : location.getAccuracy())
-                            .performanceDurationMs(networkResponse.networkTimeMs)
-                            .requestId(requestId)
-                            .requestStatusCode(networkResponse.statusCode)
-                            .requestUri(getUrl())
-                            .build()
-            );
         }
 
         // Extract internal video trackers, if available
-        final String videoTrackers = extractHeader(headers, ResponseHeader.VIDEO_TRACKERS);
-        if (videoTrackers != null) {
+        final String videoTrackers = extractHeader(jsonHeaders, ResponseHeader.VIDEO_TRACKERS);
+        if (!TextUtils.isEmpty(videoTrackers)) {
             serverExtras.put(DataKeys.VIDEO_TRACKERS_KEY, videoTrackers);
         }
         if (AdType.REWARDED_VIDEO.equals(adTypeString) ||
                 (AdType.INTERSTITIAL.equals(adTypeString) &&
                         FullAdType.VAST.equals(fullAdTypeString))) {
             serverExtras.put(DataKeys.EXTERNAL_VIDEO_VIEWABILITY_TRACKERS_KEY,
-                    extractHeader(headers, ResponseHeader.VIDEO_VIEWABILITY_TRACKERS));
+                    extractHeader(jsonHeaders, ResponseHeader.VIDEO_VIEWABILITY_TRACKERS));
         }
 
         // Banner imp tracking
@@ -303,7 +351,7 @@ public Listener getListener() {
         }
 
         // Disable viewability vendors, if any
-        final String disabledViewabilityVendors = extractHeader(headers,
+        final String disabledViewabilityVendors = extractHeader(jsonHeaders,
                 ResponseHeader.DISABLE_VIEWABILITY);
         if (!TextUtils.isEmpty(disabledViewabilityVendors)) {
             final ViewabilityVendor disabledVendors =
@@ -317,17 +365,17 @@ public Listener getListener() {
 
         if (AdType.REWARDED_VIDEO.equals(adTypeString) || AdType.CUSTOM.equals(adTypeString) ||
                 AdType.REWARDED_PLAYABLE.equals(adTypeString)) {
-            final String rewardedVideoCurrencyName = extractHeader(headers,
+            final String rewardedVideoCurrencyName = extractHeader(jsonHeaders,
                     ResponseHeader.REWARDED_VIDEO_CURRENCY_NAME);
-            final String rewardedVideoCurrencyAmount = extractHeader(headers,
+            final String rewardedVideoCurrencyAmount = extractHeader(jsonHeaders,
                     ResponseHeader.REWARDED_VIDEO_CURRENCY_AMOUNT);
-            final String rewardedCurrencies = extractHeader(headers,
+            final String rewardedCurrencies = extractHeader(jsonHeaders,
                     ResponseHeader.REWARDED_CURRENCIES);
-            final String rewardedVideoCompletionUrl = extractHeader(headers,
+            final String rewardedVideoCompletionUrl = extractHeader(jsonHeaders,
                     ResponseHeader.REWARDED_VIDEO_COMPLETION_URL);
-            final Integer rewardedDuration = extractIntegerHeader(headers,
+            final Integer rewardedDuration = extractIntegerHeader(jsonHeaders,
                     ResponseHeader.REWARDED_DURATION);
-            final boolean shouldRewardOnClick = extractBooleanHeader(headers,
+            final boolean shouldRewardOnClick = extractBooleanHeader(jsonHeaders,
                     ResponseHeader.SHOULD_REWARD_ON_CLICK, false);
             builder.setRewardedVideoCurrencyName(rewardedVideoCurrencyName);
             builder.setRewardedVideoCurrencyAmount(rewardedVideoCurrencyAmount);
@@ -337,8 +385,31 @@ public Listener getListener() {
             builder.setShouldRewardOnClick(shouldRewardOnClick);
         }
 
+        final boolean invalidateConsent = extractBooleanHeader(jsonHeaders,
+                ResponseHeader.INVALIDATE_CONSENT, false);
+        final boolean forceExplicitNo = extractBooleanHeader(jsonHeaders,
+                ResponseHeader.FORCE_EXPLICIT_NO, false);
+        final boolean reacquireConsent = extractBooleanHeader(jsonHeaders,
+                ResponseHeader.REACQUIRE_CONSENT, false);
+        String consentChangeReason = extractHeader(jsonHeaders,
+                ResponseHeader.CONSENT_CHANGE_REASON);
+        final boolean forceGdprApplies = extractBooleanHeader(jsonHeaders,
+                ResponseHeader.FORCE_GDPR_APPLIES, false);
+
+        if (sServerOverrideListener != null) {
+            if (forceGdprApplies) {
+                sServerOverrideListener.onForceGdprApplies();
+            }
+            if (forceExplicitNo) {
+                sServerOverrideListener.onForceExplicitNo(consentChangeReason);
+            } else if (invalidateConsent) {
+                sServerOverrideListener.onInvalidateConsent(consentChangeReason);
+            } else if (reacquireConsent) {
+                sServerOverrideListener.onReacquireConsent(consentChangeReason);
+            }
+        }
+
         AdResponse adResponse = builder.build();
-        logScribeEvent(adResponse, networkResponse, location);
 
         return Response.success(builder.build(),  // Cast needed for Response generic.
                 HttpHeaderParser.parseCacheHeaders(networkResponse));
@@ -352,17 +423,6 @@ private boolean eventDataIsInResponseBody(@Nullable String adType,
                 AdType.REWARDED_PLAYABLE.equals(adType);
     }
 
-    // Based on Volley's StringResponse class.
-    protected String parseStringBody(NetworkResponse response) {
-        String parsed;
-        try {
-            parsed = new String(response.data, HttpHeaderParser.parseCharset(response.headers));
-        } catch (UnsupportedEncodingException e) {
-            parsed = new String(response.data);
-        }
-        return parsed;
-    }
-
     @Override
     protected void deliverResponse(final AdResponse adResponse) {
         mListener.onSuccess(adResponse);
@@ -385,34 +445,4 @@ String getRequestId(@Nullable String failUrl) {
 
         return requestId;
     }
-
-    @VisibleForTesting
-    void logScribeEvent(@NonNull AdResponse adResponse, @NonNull NetworkResponse networkResponse,
-            @Nullable Location location) {
-        Preconditions.checkNotNull(adResponse);
-        Preconditions.checkNotNull(networkResponse);
-
-        MoPubEvents.log(
-                new Event.Builder(BaseEvent.Name.AD_REQUEST, BaseEvent.Category.REQUESTS,
-                        BaseEvent.SamplingRate.AD_REQUEST.getSamplingRate())
-                        .withAdUnitId(mAdUnitId)
-                        .withDspCreativeId(adResponse.getDspCreativeId())
-                        .withAdType(adResponse.getAdType())
-                        .withAdNetworkType(adResponse.getNetworkType())
-                        .withAdWidthPx(adResponse.getWidth() != null
-                                ? adResponse.getWidth().doubleValue()
-                                : null)
-                        .withAdHeightPx(adResponse.getHeight() != null
-                                ? adResponse.getHeight().doubleValue()
-                                : null)
-                        .withGeoLat(location != null ? location.getLatitude() : null)
-                        .withGeoLon(location != null ? location.getLongitude() : null)
-                        .withGeoAccuracy(location != null ? (double) location.getAccuracy() : null)
-                        .withPerformanceDurationMs((double) networkResponse.networkTimeMs)
-                        .withRequestId(adResponse.getRequestId())
-                        .withRequestStatusCode(networkResponse.statusCode)
-                        .withRequestUri(getUrl())
-                        .build()
-        );
-    }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdResponse.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdResponse.java
index 7e034601..9dd3d24c 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdResponse.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/AdResponse.java
@@ -4,7 +4,6 @@
 import android.support.annotation.Nullable;
 
 import com.mopub.common.MoPub.BrowserAgent;
-import com.mopub.common.event.EventDetails;
 import com.mopub.common.util.DateAndTime;
 
 import org.json.JSONObject;
@@ -68,9 +67,6 @@
     @Nullable
     private final JSONObject mJsonBody;
 
-    @Nullable
-    private final EventDetails mEventDetails;
-
     @Nullable
     private final String mCustomEventClassName;
     @Nullable
@@ -107,9 +103,8 @@ private AdResponse(@NonNull Builder builder) {
         mScrollable = builder.scrollable;
         mResponseBody = builder.responseBody;
         mJsonBody = builder.jsonBody;
-        mEventDetails = builder.eventDetails;
         mCustomEventClassName = builder.customEventClassName;
-        mBrowserAgent = builder.mBrowserAgent;
+        mBrowserAgent = builder.browserAgent;
         mServerExtras = builder.serverExtras;
         mTimestamp = DateAndTime.now().getTime();
     }
@@ -123,11 +118,6 @@ public JSONObject getJsonBody() {
         return mJsonBody;
     }
 
-    @Nullable
-    public EventDetails getEventDetails() {
-        return mEventDetails;
-    }
-
     @Nullable
     public String getStringBody() {
         return mResponseBody;
@@ -275,7 +265,6 @@ public Builder toBuilder() {
                 .setScrollable(mScrollable)
                 .setResponseBody(mResponseBody)
                 .setJsonBody(mJsonBody)
-                .setEventDetails(mEventDetails)
                 .setCustomEventClassName(mCustomEventClassName)
                 .setBrowserAgent(mBrowserAgent)
                 .setServerExtras(mServerExtras);
@@ -311,10 +300,9 @@ public Builder toBuilder() {
         private String responseBody;
         private JSONObject jsonBody;
 
-        private EventDetails eventDetails;
-
         private String customEventClassName;
-        private BrowserAgent mBrowserAgent;
+        private BrowserAgent browserAgent;
+
         private Map<String, String> serverExtras = new TreeMap<String, String>();
 
         public Builder setAdType(@Nullable final String adType) {
@@ -432,18 +420,13 @@ public Builder setJsonBody(@Nullable final JSONObject jsonBody) {
             return this;
         }
 
-        public Builder setEventDetails(@Nullable final EventDetails eventDetails) {
-            this.eventDetails = eventDetails;
-            return this;
-        }
-
         public Builder setCustomEventClassName(@Nullable final String customEventClassName) {
             this.customEventClassName = customEventClassName;
             return this;
         }
 
         public Builder setBrowserAgent(@Nullable final BrowserAgent browserAgent) {
-            this.mBrowserAgent = browserAgent;
+            this.browserAgent = browserAgent;
             return this;
         }
 
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/HeaderUtils.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/HeaderUtils.java
index 55fba8cc..a1b0523a 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/HeaderUtils.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/HeaderUtils.java
@@ -1,23 +1,42 @@
 package com.mopub.network;
 
+import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 
+import com.mopub.common.Preconditions;
 import com.mopub.common.util.ResponseHeader;
+import com.mopub.volley.Header;
+import com.mopub.volley.toolbox.HttpResponse;
 
-import org.apache.http.Header;
-import org.apache.http.HttpResponse;
+import org.json.JSONObject;
 
 import java.text.NumberFormat;
+import java.util.Iterator;
+import java.util.List;
 import java.util.Locale;
 import java.util.Map;
 
 public class HeaderUtils {
     @Nullable
     public static String extractHeader(Map<String, String> headers, ResponseHeader responseHeader) {
-        return headers.get(responseHeader.getKey());
+        return headers.get(responseHeader.getKey().toLowerCase());
     }
 
-    public static Integer extractIntegerHeader(Map<String, String> headers, ResponseHeader responseHeader) {
+    @NonNull
+    public static String extractHeader(@Nullable final JSONObject headers,
+            @NonNull final ResponseHeader responseHeader) {
+        Preconditions.checkNotNull(responseHeader);
+
+        if (headers == null) {
+            return "";
+        }
+
+        final String key = getKeyIgnoreCase(headers, responseHeader.getKey());
+        return headers.optString(key);
+    }
+
+    @Nullable
+    public static Integer extractIntegerHeader(JSONObject headers, ResponseHeader responseHeader) {
         return formatIntHeader(extractHeader(headers, responseHeader));
     }
 
@@ -25,20 +44,25 @@ public static boolean extractBooleanHeader(Map<String, String> headers, Response
         return formatBooleanHeader(extractHeader(headers, responseHeader), defaultValue);
     }
 
-    public static Integer extractPercentHeader(Map<String, String> headers, ResponseHeader responseHeader) {
+    public static boolean extractBooleanHeader(JSONObject headers, ResponseHeader responseHeader, boolean defaultValue) {
+        return formatBooleanHeader(extractHeader(headers, responseHeader), defaultValue);
+    }
+
+    @Nullable
+    public static Integer extractPercentHeader(JSONObject headers, ResponseHeader responseHeader) {
         return formatPercentHeader(extractHeader(headers, responseHeader));
     }
 
     @Nullable
-    public static String extractPercentHeaderString(Map<String, String> headers,
+    public static String extractPercentHeaderString(JSONObject headers,
             ResponseHeader responseHeader) {
         Integer percentHeaderValue = extractPercentHeader(headers, responseHeader);
         return percentHeaderValue != null ? percentHeaderValue.toString() : null;
     }
 
-
+    @Nullable
     public static String extractHeader(HttpResponse response, ResponseHeader responseHeader) {
-        Header header = response.getFirstHeader(responseHeader.getKey());
+        final Header header = getFirstHeader(response.getHeaders(), responseHeader);
         return header != null ? header.getValue() : null;
     }
 
@@ -46,6 +70,7 @@ public static boolean extractBooleanHeader(HttpResponse response, ResponseHeader
         return formatBooleanHeader(extractHeader(response, responseHeader), defaultValue);
     }
 
+    @Nullable
     public static Integer extractIntegerHeader(HttpResponse response, ResponseHeader responseHeader) {
         String headerValue = extractHeader(response, responseHeader);
         return formatIntHeader(headerValue);
@@ -67,6 +92,7 @@ private static boolean formatBooleanHeader(@Nullable String headerValue, boolean
         return headerValue.equals("1");
     }
 
+    @Nullable
     private static Integer formatIntHeader(String headerValue) {
         try {
             return Integer.parseInt(headerValue);
@@ -101,4 +127,36 @@ private static Integer formatPercentHeader(@Nullable String headerValue) {
 
         return percentValue;
     }
+
+    private static Header getFirstHeader(@Nullable final List<Header> headers,
+            @NonNull final ResponseHeader responseHeader) {
+        Preconditions.checkNotNull(responseHeader);
+
+        if (headers == null) {
+            return null;
+        }
+
+        for (final Header header : headers) {
+            if (header.getName().equalsIgnoreCase(responseHeader.getKey())) {
+                return header;
+            }
+        }
+        return null;
+    }
+
+    @NonNull
+    private static String getKeyIgnoreCase(@NonNull final JSONObject json,
+                                           @NonNull final String searchKey) {
+        Preconditions.checkNotNull(json);
+        Preconditions.checkNotNull(searchKey);
+
+        final Iterator<String> keys = json.keys();
+        while (keys.hasNext()) {
+            final String key = keys.next();
+            if (searchKey.equalsIgnoreCase(key)) {
+                return key;
+            }
+        }
+        return searchKey;
+    }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/MoPubRequest.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/MoPubRequest.java
new file mode 100644
index 00000000..44c910a5
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/MoPubRequest.java
@@ -0,0 +1,83 @@
+package com.mopub.network;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.mopub.common.Preconditions;
+import com.mopub.common.VisibleForTesting;
+import com.mopub.volley.NetworkResponse;
+import com.mopub.volley.Request;
+import com.mopub.volley.Response;
+import com.mopub.volley.toolbox.HttpHeaderParser;
+
+import java.io.UnsupportedEncodingException;
+import java.util.Map;
+
+/**
+ * Changes the type of request it is based on whether or not the request is going to MoPub's ad
+ * server. If the request is for ad server in some way, reconstruct it as a POST request and
+ * set the body and content type to json.
+ */
+public abstract class MoPubRequest<T> extends Request<T>  {
+
+    private static final String JSON_CONTENT_TYPE = "application/json; charset=UTF-8";
+
+    @NonNull private final String mOriginalUrl;
+    @NonNull private final Context mContext;
+
+    public MoPubRequest(@NonNull final Context context,
+                        @NonNull final String url,
+                        @Nullable final Response.ErrorListener listener) {
+        super(MoPubRequestUtils.chooseMethod(url), MoPubRequestUtils.truncateQueryParamsIfPost(url),
+                listener);
+
+        mOriginalUrl = url;
+        mContext = context.getApplicationContext();
+    }
+
+    @Override
+    protected Map<String, String> getParams() {
+        if (!MoPubRequestUtils.isMoPubRequest(getUrl())) {
+            return null;
+        }
+
+        return MoPubRequestUtils.convertQueryToMap(mContext, mOriginalUrl);
+    }
+
+    @Override
+    public String getBodyContentType() {
+        if (MoPubRequestUtils.isMoPubRequest(getUrl())) {
+            return JSON_CONTENT_TYPE;
+        }
+        return super.getBodyContentType();
+    }
+
+    @Override
+    public byte[] getBody() {
+        final String body = MoPubRequestUtils.generateBodyFromParams(getParams(), getUrl());
+        if (body == null) {
+            return null;
+        }
+        return body.getBytes();
+    }
+
+    @NonNull
+    protected String parseStringBody(@NonNull final NetworkResponse response) {
+        Preconditions.checkNotNull(response);
+
+        String parsed;
+        try {
+            parsed = new String(response.data, HttpHeaderParser.parseCharset(response.headers));
+        } catch (UnsupportedEncodingException e) {
+            parsed = new String(response.data);
+        }
+        return parsed;
+    }
+
+    @VisibleForTesting
+    @NonNull
+    public String getOriginalUrl() {
+        return mOriginalUrl;
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/MoPubRequestUtils.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/MoPubRequestUtils.java
new file mode 100644
index 00000000..4b64ac29
--- /dev/null
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/MoPubRequestUtils.java
@@ -0,0 +1,98 @@
+package com.mopub.network;
+
+import android.content.Context;
+import android.net.Uri;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import com.mopub.common.Constants;
+import com.mopub.common.Preconditions;
+import com.mopub.common.logging.MoPubLog;
+import com.mopub.volley.Request;
+import com.mopub.volley.toolbox.HurlStack;
+
+import org.json.JSONException;
+import org.json.JSONObject;
+
+import java.util.HashMap;
+import java.util.Map;
+
+/**
+ * Keeps utility methods regarding MoPubRequests in one place.
+ */
+public class MoPubRequestUtils {
+
+    public static String truncateQueryParamsIfPost(@NonNull final String url) {
+        Preconditions.checkNotNull(url);
+        if (!isMoPubRequest(url)) {
+            return url;
+        }
+
+        final int queryPosition = url.indexOf('?');
+        if (queryPosition == -1) {
+            return url;
+        }
+
+        return url.substring(0, queryPosition);
+    }
+
+    public static boolean isMoPubRequest(@NonNull final String url) {
+        Preconditions.checkNotNull(url);
+
+        final String httpHost = Constants.HTTP + "://" + Constants.HOST;
+        final String httpsHost = Constants.HTTPS + "://" + Constants.HOST;
+
+        return url.startsWith(httpHost) || url.startsWith(httpsHost);
+    }
+
+    public static int chooseMethod(String url) {
+        if (isMoPubRequest(url)) {
+            return Request.Method.POST;
+        } else {
+            return Request.Method.GET;
+        }
+    }
+
+    @NonNull
+    public static Map<String, String> convertQueryToMap(@NonNull final Context context,
+            @NonNull final String url) {
+        Preconditions.checkNotNull(context);
+        Preconditions.checkNotNull(url);
+
+        final Map<String, String> params = new HashMap<>();
+        HurlStack.UrlRewriter rewriter = Networking.getUrlRewriter(context);
+        final Uri uri = Uri.parse(rewriter.rewriteUrl(url));
+        for (final String queryParam : uri.getQueryParameterNames()) {
+            params.put(queryParam, TextUtils.join(",", uri.getQueryParameters(queryParam)));
+        }
+
+        return params;
+    }
+
+    @Nullable
+    public static String generateBodyFromParams(@Nullable final Map<String, String> params,
+            @NonNull final String url) {
+        Preconditions.checkNotNull(url);
+
+        if (!MoPubRequestUtils.isMoPubRequest(url) || params == null || params.isEmpty()) {
+            return null;
+        }
+
+        final JSONObject jsonBody = new JSONObject();
+        for (final String queryName : params.keySet()) {
+            try {
+                jsonBody.put(queryName, params.get(queryName));
+            } catch (JSONException e) {
+                MoPubLog.d("Unable to add " + queryName + " to JSON body.");
+            }
+        }
+        return jsonBody.toString();
+    }
+
+    /**
+     * This is a helper class and should not be instantiated.
+     */
+    private MoPubRequestUtils() {
+    }
+}
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/Networking.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/Networking.java
index f55a88fa..e551304f 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/Networking.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/Networking.java
@@ -10,7 +10,6 @@
 import android.webkit.WebSettings;
 import android.webkit.WebView;
 
-import com.mopub.common.ClientMetadata;
 import com.mopub.common.Constants;
 import com.mopub.common.Preconditions;
 import com.mopub.common.VisibleForTesting;
@@ -18,9 +17,9 @@
 import com.mopub.volley.Cache;
 import com.mopub.volley.Network;
 import com.mopub.volley.RequestQueue;
+import com.mopub.volley.toolbox.BaseHttpStack;
 import com.mopub.volley.toolbox.BasicNetwork;
 import com.mopub.volley.toolbox.DiskBasedCache;
-import com.mopub.volley.toolbox.HttpStack;
 import com.mopub.volley.toolbox.HurlStack;
 import com.mopub.volley.toolbox.ImageLoader;
 
@@ -40,6 +39,7 @@
     private volatile static String sUserAgent;
     private volatile static MaxWidthImageLoader sMaxWidthImageLoader;
     private static boolean sUseHttps = false;
+    private static HurlStack.UrlRewriter sUrlRewriter;
 
     @Nullable
     public static MoPubRequestQueue getRequestQueue() {
@@ -47,7 +47,18 @@ public static MoPubRequestQueue getRequestQueue() {
     }
 
     @NonNull
-    public static MoPubRequestQueue getRequestQueue(@NonNull Context context) {
+    public static HurlStack.UrlRewriter getUrlRewriter(@NonNull final Context context) {
+        Preconditions.checkNotNull(context);
+
+        // No synchronization done here since it's fine to create the same rewriter more than once.
+        if (sUrlRewriter == null) {
+            sUrlRewriter = new PlayServicesUrlRewriter();
+        }
+        return sUrlRewriter;
+    }
+
+    @NonNull
+    public static MoPubRequestQueue getRequestQueue(@NonNull final Context context) {
         MoPubRequestQueue requestQueue = sRequestQueue;
         // Double-check locking to initialize.
         if (requestQueue == null) {
@@ -55,18 +66,18 @@ public static MoPubRequestQueue getRequestQueue(@NonNull Context context) {
                 requestQueue = sRequestQueue;
                 if (requestQueue == null) {
 
-                    // Guarantee ClientMetadata is set up.
-                    final ClientMetadata clientMetadata = ClientMetadata.getInstance(context);
-                    final HurlStack.UrlRewriter urlRewriter = new PlayServicesUrlRewriter(clientMetadata.getDeviceId(), context);
                     final SSLSocketFactory socketFactory = CustomSSLSocketFactory.getDefault(Constants.TEN_SECONDS_MILLIS);
 
-                    final String userAgent = Networking.getUserAgent(context.getApplicationContext());
-                    HttpStack httpStack = new RequestQueueHttpStack(userAgent, urlRewriter, socketFactory);
+                    final String userAgent = Networking.getUserAgent(
+                            context.getApplicationContext());
+                    final BaseHttpStack httpStack = new RequestQueueHttpStack(userAgent,
+                            getUrlRewriter(context), socketFactory);
 
-                    Network network = new BasicNetwork(httpStack);
-                    File volleyCacheDir = new File(context.getCacheDir().getPath() + File.separator
-                            + CACHE_DIRECTORY_NAME);
-                    Cache cache = new DiskBasedCache(volleyCacheDir, (int) DeviceUtils.diskCacheSizeBytes(volleyCacheDir, Constants.TEN_MB));
+                    final Network network = new BasicNetwork(httpStack);
+                    final File volleyCacheDir = new File(context.getCacheDir().getPath() +
+                            File.separator + CACHE_DIRECTORY_NAME);
+                    final Cache cache = new DiskBasedCache(volleyCacheDir,
+                            (int) DeviceUtils.diskCacheSizeBytes(volleyCacheDir, Constants.TEN_MB));
                     requestQueue = new MoPubRequestQueue(cache, network);
                     sRequestQueue = requestQueue;
                     requestQueue.start();
@@ -190,32 +201,34 @@ public static synchronized void setUserAgentForTesting(String userAgent) {
     }
 
     /**
-     * Set whether to use HTTPS for communication with MoPub ad servers.
+     * Set whether to use HTTP or HTTPS for WebView base urls.
      */
     public static void useHttps(boolean useHttps) {
         sUseHttps = useHttps;
     }
 
-    public static boolean useHttps() {
+    public static boolean shouldUseHttps() {
         return sUseHttps;
     }
 
     /**
-     * Retrieve the scheme that should be used based on {@link #useHttps()}.
+     * Retrieve the scheme that should be used to communicate to the ad server. This should always
+     * return https.
      *
-     * @return "https" if {@link #useHttps()} is true; "http" otherwise.
+     * @return "https"
      */
     public static String getScheme() {
-        return useHttps() ? Constants.HTTPS : Constants.HTTP;
+        return Constants.HTTPS;
     }
 
     /**
      * DSPs are currently not ready for full https creatives. When we flip the switch to go full
-     * https, this should just return {@link #getScheme()}.
+     * https, this should just return https. However, for now, we allow the publisher to use
+     * either http or https. This only affects WebView base urls.
      *
-     * @return "http"
+     * @return "https" if {@link #shouldUseHttps()} is true; "http" otherwise.
      */
     public static String getBaseUrlScheme() {
-        return Constants.HTTP;
+        return shouldUseHttps() ? Constants.HTTPS : Constants.HTTP;
     }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/PlayServicesUrlRewriter.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/PlayServicesUrlRewriter.java
index 42438bbd..9c4f9faf 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/PlayServicesUrlRewriter.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/PlayServicesUrlRewriter.java
@@ -1,9 +1,11 @@
 package com.mopub.network;
 
-import android.content.Context;
 import android.net.Uri;
 
-import com.mopub.common.GpsHelper;
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.MoPub;
+import com.mopub.common.privacy.AdvertisingId;
+import com.mopub.common.privacy.MoPubIdentifier;
 import com.mopub.volley.toolbox.HurlStack;
 
 /**
@@ -11,17 +13,10 @@
  * when a request is queued for dispatch by the HurlStack in Volley.
  */
 public class PlayServicesUrlRewriter implements HurlStack.UrlRewriter {
-    private static final String IFA_PREFIX = "ifa:";
-
     public static final String UDID_TEMPLATE = "mp_tmpl_advertising_id";
     public static final String DO_NOT_TRACK_TEMPLATE = "mp_tmpl_do_not_track";
 
-    private final String deviceIdentifier;
-    private final Context applicationContext;
-
-    public PlayServicesUrlRewriter(String deviceId, Context context) {
-        deviceIdentifier = deviceId;
-        applicationContext = context.getApplicationContext();
+    public PlayServicesUrlRewriter() {
     }
 
     @Override
@@ -30,22 +25,15 @@ public String rewriteUrl(final String url) {
             return url;
         }
 
-        String prefix = "";
-        GpsHelper.AdvertisingInfo advertisingInfo = new GpsHelper.AdvertisingInfo(deviceIdentifier, false);
-
-        // Attempt to fetch the Google Play Services fields
-        if (GpsHelper.isPlayServicesAvailable(applicationContext)) {
-            // We can do this synchronously because urlRewrite happens in a background thread.
-            GpsHelper.AdvertisingInfo playServicesAdInfo = GpsHelper.fetchAdvertisingInfoSync(applicationContext);
-            if (playServicesAdInfo != null) {
-                prefix = IFA_PREFIX;
-                advertisingInfo = playServicesAdInfo;
-            }
+        ClientMetadata clientMetadata = ClientMetadata.getInstance();
+        if (clientMetadata == null) {
+            return url;
         }
-
-        // Fill in the templates
-        String toReturn = url.replace(UDID_TEMPLATE, Uri.encode(prefix + advertisingInfo.advertisingId));
-        toReturn = toReturn.replace(DO_NOT_TRACK_TEMPLATE, advertisingInfo.limitAdTracking ? "1" : "0");
+        MoPubIdentifier identifier = clientMetadata.getMoPubIdentifier();
+        AdvertisingId info = identifier.getAdvertisingInfo();
+        String toReturn = url.replace(UDID_TEMPLATE,
+                Uri.encode(info.getIdWithPrefix(MoPub.canCollectPersonalInformation())));
+        toReturn = toReturn.replace(DO_NOT_TRACK_TEMPLATE, info.isDoNotTrack() ? "1" : "0");
         return toReturn;
     }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/RequestQueueHttpStack.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/RequestQueueHttpStack.java
index f2df816c..97110951 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/RequestQueueHttpStack.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/RequestQueueHttpStack.java
@@ -6,10 +6,9 @@
 import com.mopub.common.util.ResponseHeader;
 import com.mopub.volley.AuthFailureError;
 import com.mopub.volley.Request;
+import com.mopub.volley.toolbox.HttpResponse;
 import com.mopub.volley.toolbox.HurlStack;
 
-import org.apache.http.HttpResponse;
-
 import java.io.IOException;
 import java.util.Map;
 import java.util.TreeMap;
@@ -41,14 +40,16 @@ public RequestQueueHttpStack(@NonNull final String userAgent, @Nullable final Ur
     }
 
     @Override
-    public HttpResponse performRequest(@NonNull final Request<?> request,
+    public HttpResponse executeRequest(@NonNull final Request<?> request,
             @Nullable Map<String, String> additionalHeaders) throws IOException, AuthFailureError {
-        if (additionalHeaders == null) {
+        // If the headers map is null or empty, make a new once since Collections.emptyMap()
+        // returns an unmodifiable map.
+        if (additionalHeaders == null || additionalHeaders.isEmpty()) {
             additionalHeaders = new TreeMap<String, String>();
         }
 
         additionalHeaders.put(ResponseHeader.USER_AGENT.getKey(), mUserAgent);
 
-        return super.performRequest(request, additionalHeaders);
+        return super.executeRequest(request, additionalHeaders);
     }
 }
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeBackoffPolicy.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeBackoffPolicy.java
deleted file mode 100644
index 5b5b3732..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeBackoffPolicy.java
+++ /dev/null
@@ -1,54 +0,0 @@
-package com.mopub.network;
-
-import com.mopub.common.VisibleForTesting;
-import com.mopub.volley.NetworkResponse;
-import com.mopub.volley.NoConnectionError;
-import com.mopub.volley.VolleyError;
-
-/**
- * The backoff policy for making requests to the Scribe service.
- */
-public class ScribeBackoffPolicy extends BackoffPolicy {
-    private static final int DEFAULT_BACKOFF_TIME_MS = 60 * 1000;
-    private static final int MAX_RETRIES = 5;
-    private static final int BACKOFF_MULTIPLIER = 2;
-
-    public ScribeBackoffPolicy() {
-        this(DEFAULT_BACKOFF_TIME_MS, MAX_RETRIES, BACKOFF_MULTIPLIER);
-    }
-
-    @VisibleForTesting
-    ScribeBackoffPolicy(int defaultBackoffTimeMs, int maxRetries, int backoffMultiplier) {
-        mDefaultBackoffTimeMs = defaultBackoffTimeMs;
-        mMaxRetries = maxRetries;
-        mBackoffMultiplier = backoffMultiplier;
-    }
-
-    @Override
-    public void backoff(VolleyError volleyError) throws VolleyError {
-        if (!hasAttemptRemaining()) {
-            throw volleyError;
-        }
-
-        if (volleyError instanceof NoConnectionError) {
-            updateBackoffTime();
-            return;
-        }
-
-        NetworkResponse networkResponse = volleyError.networkResponse;
-        if (networkResponse != null &&
-                (networkResponse.statusCode == 503  || networkResponse.statusCode == 504)) {
-            updateBackoffTime();
-            return;
-        }
-
-        throw volleyError;
-    }
-
-    private void updateBackoffTime() {
-        double multiplier = Math.pow(mBackoffMultiplier, mRetryCount);
-        mBackoffMs = (int) (mDefaultBackoffTimeMs * multiplier);
-        mRetryCount++;
-    }
-}
-
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeRequest.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeRequest.java
deleted file mode 100644
index 50cfc29a..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeRequest.java
+++ /dev/null
@@ -1,83 +0,0 @@
-package com.mopub.network;
-
-import android.support.annotation.NonNull;
-
-import com.mopub.common.VisibleForTesting;
-import com.mopub.common.event.BaseEvent;
-import com.mopub.common.event.EventSerializer;
-import com.mopub.volley.DefaultRetryPolicy;
-import com.mopub.volley.NetworkResponse;
-import com.mopub.volley.Request;
-import com.mopub.volley.Response;
-import com.mopub.volley.toolbox.HttpHeaderParser;
-
-import org.json.JSONArray;
-
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-
-/**
- * A POST request for logging custom events to the Scribe service.
- */
-public class ScribeRequest extends Request<Void> {
-
-    public interface Listener extends Response.ErrorListener {
-        void onResponse();
-    }
-
-    public interface ScribeRequestFactory extends RequestManager.RequestFactory {
-        ScribeRequest createRequest(ScribeRequest.Listener listener);
-    }
-
-    @NonNull private final List<BaseEvent> mEvents;
-    @NonNull private final EventSerializer mEventSerializer;
-    @NonNull private final ScribeRequest.Listener mListener;
-
-    public ScribeRequest(@NonNull String url,
-            @NonNull List<BaseEvent> events,
-            @NonNull EventSerializer eventSerializer,
-            @NonNull Listener listener) {
-        super(Method.POST, url, listener);
-
-        mEvents = events;
-        mEventSerializer = eventSerializer;
-        mListener = listener;
-
-        setShouldCache(false);
-
-        // This retry policy applies to socket timeouts only
-        setRetryPolicy(new DefaultRetryPolicy());
-    }
-
-    /**
-     * This is method runs on the background thread
-     */
-    @Override
-    protected Map<String,String> getParams() {
-        JSONArray jsonArray = mEventSerializer.serializeAsJson(mEvents);
-        Map<String,String> params = new HashMap<String, String>();
-        params.put("log", jsonArray.toString());
-        return params;
-    }
-
-    @Override
-    protected Response<Void> parseNetworkResponse(NetworkResponse networkResponse) {
-        // NOTE: We never get status codes outside of {[200, 299], 304}. Those errors are sent to the
-        // error listener.
-        return Response.success(null, HttpHeaderParser.parseCacheHeaders(networkResponse));
-    }
-
-    @Override
-    protected void deliverResponse(Void aVoid) {
-        mListener.onResponse();
-    }
-
-    @NonNull
-    @Deprecated
-    @VisibleForTesting
-    public List<BaseEvent> getEvents() {
-        return mEvents;
-    }
-}
-
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeRequestManager.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeRequestManager.java
deleted file mode 100644
index e1b3fc45..00000000
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/ScribeRequestManager.java
+++ /dev/null
@@ -1,59 +0,0 @@
-package com.mopub.network;
-
-import android.os.Looper;
-import android.support.annotation.NonNull;
-
-import com.mopub.common.logging.MoPubLog;
-import com.mopub.volley.Request;
-import com.mopub.volley.VolleyError;
-
-import static com.mopub.network.ScribeRequest.ScribeRequestFactory;
-
-/**
- * Request manager to manage scribe requests. This class implements the specific Scribe
- * request listener.
- */
-public class ScribeRequestManager extends RequestManager<ScribeRequestFactory> implements ScribeRequest.Listener {
-
-    public ScribeRequestManager(final Looper looper) {
-        super(looper);
-    }
-
-    // RequestManager
-    @NonNull
-    @Override
-    Request<?> createRequest() {
-        return mRequestFactory.createRequest(this);
-    }
-
-    // ScribeRequest.Listener
-    @Override
-    public void onResponse() {
-        MoPubLog.d("Successfully scribed events");
-        // Get back to the dedicated event logging thread before touching shared resources
-        mHandler.post(new Runnable() {
-            @Override
-            public void run() {
-                clearRequest();
-            }
-        });
-    }
-
-    @Override
-    public void onErrorResponse(final VolleyError volleyError) {
-        // Post back to the dedicated event logging thread before touching shared resources
-        mHandler.post(new Runnable() {
-            @Override
-            public void run() {
-                try {
-                    mBackoffPolicy.backoff(volleyError);
-                    makeRequestInternal();
-                } catch (VolleyError e) {
-                    MoPubLog.d("Failed to Scribe events: " + volleyError);
-                    clearRequest();
-                }
-            }
-        });
-    }
-}
-
diff --git a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/TrackingRequest.java b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/TrackingRequest.java
index aa13cdf2..f6a7bf91 100644
--- a/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/TrackingRequest.java
+++ b/mopub-sdk/mopub-sdk-base/src/main/java/com/mopub/network/TrackingRequest.java
@@ -6,14 +6,12 @@
 import android.text.TextUtils;
 
 import com.mopub.common.Preconditions;
-import com.mopub.common.event.BaseEvent;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.mobileads.VastErrorCode;
 import com.mopub.mobileads.VastMacroHelper;
 import com.mopub.mobileads.VastTracker;
 import com.mopub.volley.DefaultRetryPolicy;
 import com.mopub.volley.NetworkResponse;
-import com.mopub.volley.Request;
 import com.mopub.volley.RequestQueue;
 import com.mopub.volley.Response;
 import com.mopub.volley.VolleyError;
@@ -23,7 +21,7 @@
 import java.util.Arrays;
 import java.util.List;
 
-public class TrackingRequest extends Request<Void> {
+public class TrackingRequest extends MoPubRequest<Void> {
 
     // Retrying may cause duplicate impressions
     private static final int ZERO_RETRIES = 0;
@@ -34,8 +32,10 @@
 
     @Nullable private final TrackingRequest.Listener mListener;
 
-    private TrackingRequest(@NonNull final String url, @Nullable final Listener listener) {
-        super(Method.GET, url, listener);
+    private TrackingRequest(@NonNull final Context context,
+            @NonNull final String url,
+            @Nullable final Listener listener) {
+        super(context, url, listener);
         mListener = listener;
         setShouldCache(false);
         setRetryPolicy(new DefaultRetryPolicy(
@@ -98,8 +98,7 @@ public static void makeVastTrackingHttpRequest(
 
     public static void makeTrackingHttpRequest(@Nullable final Iterable<String> urls,
             @Nullable final Context context,
-            @Nullable final Listener listener,
-            final BaseEvent.Name name) {
+            @Nullable final Listener listener) {
         if (urls == null || context == null) {
             return;
         }
@@ -127,43 +126,27 @@ public void onErrorResponse(final VolleyError volleyError) {
                     }
                 }
             };
-            final TrackingRequest trackingRequest = new TrackingRequest(url, internalListener);
+            final TrackingRequest trackingRequest = new TrackingRequest(context, url,
+                    internalListener);
             requestQueue.add(trackingRequest);
         }
     }
 
     public static void makeTrackingHttpRequest(@Nullable final String url,
             @Nullable final Context context) {
-        makeTrackingHttpRequest(url, context, null, null);
-    }
-
-    public static void makeTrackingHttpRequest(@Nullable final String url,
-            @Nullable final Context context, @Nullable Listener listener) {
-        makeTrackingHttpRequest(url, context, listener, null);
-    }
-
-    public static void makeTrackingHttpRequest(@Nullable final String url,
-            @Nullable final Context context, final BaseEvent.Name name) {
-        makeTrackingHttpRequest(url, context, null, name);
+        makeTrackingHttpRequest(url, context, null);
     }
 
     public static void makeTrackingHttpRequest(@Nullable final String url,
             @Nullable final Context context,
-            @Nullable Listener listener,
-            final BaseEvent.Name name) {
+            @Nullable Listener listener) {
         if (url != null) {
-            makeTrackingHttpRequest(Arrays.asList(url), context, listener, name);
+            makeTrackingHttpRequest(Arrays.asList(url), context, listener);
         }
     }
 
     public static void makeTrackingHttpRequest(@Nullable final Iterable<String> urls,
             @Nullable final Context context) {
-        makeTrackingHttpRequest(urls, context, null, null);
-    }
-
-    public static void makeTrackingHttpRequest(@Nullable final Iterable<String> urls,
-            @Nullable final Context context,
-            final BaseEvent.Name name) {
-        makeTrackingHttpRequest(urls, context, null, name);
+        makeTrackingHttpRequest(urls, context, null);
     }
 }
diff --git a/mopub-sdk/mopub-sdk-interstitial/build.gradle b/mopub-sdk/mopub-sdk-interstitial/build.gradle
index fe56e07f..9cddd85f 100644
--- a/mopub-sdk/mopub-sdk-interstitial/build.gradle
+++ b/mopub-sdk/mopub-sdk-interstitial/build.gradle
@@ -1,7 +1,7 @@
 apply from: '../shared-build.gradle'
 
 dependencies {
-    compile project(':mopub-sdk:mopub-sdk-base')
+    api project(':mopub-sdk:mopub-sdk-base')
 }
 
 project.description = 'MoPub Android SDK - Interstitial'
diff --git a/mopub-sdk/mopub-sdk-interstitial/src/main/java/com/mopub/mobileads/MoPubInterstitial.java b/mopub-sdk/mopub-sdk-interstitial/src/main/java/com/mopub/mobileads/MoPubInterstitial.java
index fe5a4a0a..94420ecc 100644
--- a/mopub-sdk/mopub-sdk-interstitial/src/main/java/com/mopub/mobileads/MoPubInterstitial.java
+++ b/mopub-sdk/mopub-sdk-interstitial/src/main/java/com/mopub/mobileads/MoPubInterstitial.java
@@ -309,6 +309,15 @@ public String getKeywords() {
         return mInterstitialView.getKeywords();
     }
 
+    public void setUserDataKeywords(@Nullable final String userDataKeywords) {
+        mInterstitialView.setUserDataKeywords(userDataKeywords);
+    }
+
+    @Nullable
+    public String getUserDataKeywords() {
+        return mInterstitialView.getUserDataKeywords();
+    }
+
     @NonNull
     public Activity getActivity() {
         return mActivity;
diff --git a/mopub-sdk/mopub-sdk-native-static/build.gradle b/mopub-sdk/mopub-sdk-native-static/build.gradle
index ba206ef6..191c33a9 100644
--- a/mopub-sdk/mopub-sdk-native-static/build.gradle
+++ b/mopub-sdk/mopub-sdk-native-static/build.gradle
@@ -1,8 +1,8 @@
 apply from: '../shared-build.gradle'
 
 dependencies {
-    compile project(':mopub-sdk:mopub-sdk-base')
-    compile 'com.android.support:recyclerview-v7:26.1.0'
+    api project(':mopub-sdk:mopub-sdk-base')
+    api 'com.android.support:recyclerview-v7:26.1.0'
 }
 
 project.description = 'MoPub Android SDK - Native Static'
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java
index 8a198b8a..e323a2ac 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/CustomEventNativeAdapter.java
@@ -4,7 +4,6 @@
 import android.support.annotation.NonNull;
 
 import com.mopub.common.DataKeys;
-import com.mopub.common.event.EventDetails;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.nativeads.factories.CustomEventNativeFactory;
 import com.mopub.network.AdResponse;
@@ -34,11 +33,6 @@ public static void loadNativeAd(@NonNull final Context context,
             localExtras.put(DataKeys.JSON_BODY_KEY, adResponse.getJsonBody());
         }
 
-        final EventDetails eventDetails = adResponse.getEventDetails();
-        if (eventDetails != null) {
-            localExtras.put(DataKeys.EVENT_DETAILS, eventDetails);
-        }
-
         localExtras.put(DataKeys.CLICK_TRACKING_URL_KEY, adResponse.getClickTrackingUrl());
 
         // Custom event classes can be developed by any third party and may not be tested.
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java
index 68209727..d5174d12 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubCustomEventNative.java
@@ -3,6 +3,7 @@
 import android.content.Context;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
+import android.text.TextUtils;
 import android.view.View;
 
 import com.mopub.common.DataKeys;
@@ -97,7 +98,10 @@ protected void loadNativeAd(@NonNull final Context context,
             CLICK_DESTINATION("clk", false),
             FALLBACK("fallback", false),
             CALL_TO_ACTION("ctatext", false),
-            STAR_RATING("starrating", false);
+            STAR_RATING("starrating", false),
+
+            PRIVACY_INFORMATION_ICON_IMAGE_URL("privacyicon", false),
+            PRIVACY_INFORMATION_ICON_CLICKTHROUGH_URL("privacyclkurl", false);
 
             @NonNull final String name;
             final boolean required;
@@ -171,7 +175,9 @@ void loadAd() throws IllegalArgumentException {
                     addExtra(key, mJsonObject.opt(key));
                 }
             }
-            setPrivacyInformationIconClickThroughUrl(PRIVACY_INFORMATION_CLICKTHROUGH_URL);
+            if (TextUtils.isEmpty(getPrivacyInformationIconClickThroughUrl())) {
+                setPrivacyInformationIconClickThroughUrl(PRIVACY_INFORMATION_CLICKTHROUGH_URL);
+            }
 
             preCacheImages(mContext, getAllImageUrls(), new ImageListener() {
                 @Override
@@ -227,6 +233,12 @@ private void addInstanceVariable(@NonNull final Parameter key,
                     case STAR_RATING:
                         setStarRating(parseDouble(value));
                         break;
+                    case PRIVACY_INFORMATION_ICON_IMAGE_URL:
+                        setPrivacyInformationIconImageUrl((String) value);
+                        break;
+                    case PRIVACY_INFORMATION_ICON_CLICKTHROUGH_URL:
+                        setPrivacyInformationIconClickThroughUrl((String) value);
+                        break;
                     default:
                         MoPubLog.d("Unable to add JSON key to internal mapping: " + key.name);
                         break;
@@ -267,13 +279,15 @@ private boolean isImageKey(@Nullable final String name) {
         @NonNull
         List<String> getAllImageUrls() {
             final List<String> imageUrls = new ArrayList<String>();
-            if (getMainImageUrl() != null) {
+            if (!TextUtils.isEmpty(getMainImageUrl())) {
                 imageUrls.add(getMainImageUrl());
             }
-            if (getIconImageUrl() != null) {
+            if (!TextUtils.isEmpty(getIconImageUrl())) {
                 imageUrls.add(getIconImageUrl());
             }
-
+            if (!TextUtils.isEmpty(getPrivacyInformationIconImageUrl())) {
+                imageUrls.add(getPrivacyInformationIconImageUrl());
+            }
             imageUrls.addAll(getExtrasImageUrls());
             return imageUrls;
         }
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubNative.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubNative.java
index ebb9293c..9fe1ae15 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubNative.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/MoPubNative.java
@@ -24,7 +24,6 @@
 import java.util.Map;
 import java.util.TreeMap;
 
-import static com.mopub.common.GpsHelper.fetchAdvertisingInfoAsync;
 import static com.mopub.nativeads.CustomEventNative.CustomEventNativeListener;
 import static com.mopub.nativeads.NativeErrorCode.CONNECTION_ERROR;
 import static com.mopub.nativeads.NativeErrorCode.EMPTY_AD_RESPONSE;
@@ -98,9 +97,6 @@ public void onErrorResponse(@NonNull final VolleyError volleyError) {
                 onAdError(volleyError);
             }
         };
-
-        // warm up cache for google play services info
-        fetchAdvertisingInfoAsync(context, null);
     }
 
     /**
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java
index bb9e97b1..e8854584 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/NativeUrlGenerator.java
@@ -8,6 +8,7 @@
 import com.mopub.common.AdUrlGenerator;
 import com.mopub.common.ClientMetadata;
 import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
 
 class NativeUrlGenerator extends AdUrlGenerator {
     @Nullable private String mDesiredAssets;
@@ -27,8 +28,12 @@ public NativeUrlGenerator withAdUnitId(final String adUnitId) {
     @NonNull
     NativeUrlGenerator withRequest(@Nullable final RequestParameters requestParameters) {
         if (requestParameters != null) {
+            final boolean canCollectPersonalInformation = MoPub.canCollectPersonalInformation();
+
+            mUserDataKeywords = canCollectPersonalInformation ? requestParameters.getUserDataKeywords() : null;
+            mLocation = canCollectPersonalInformation ? requestParameters.getLocation() : null;
+
             mKeywords = requestParameters.getKeywords();
-            mLocation = requestParameters.getLocation();
             mDesiredAssets = requestParameters.getDesiredAssets();
         }
         return this;
@@ -65,9 +70,4 @@ private void setDesiredAssets() {
             addParam("assets", mDesiredAssets);
         }
     }
-
-    @Override
-    protected void setSdkVersion(String sdkVersion) {
-        addParam("nsv", sdkVersion);
-    }
 }
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningRequest.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningRequest.java
index 9446d7a5..631e36fa 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningRequest.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningRequest.java
@@ -1,21 +1,24 @@
 package com.mopub.nativeads;
 
+import android.content.Context;
 import android.support.annotation.NonNull;
 
 import com.mopub.common.VisibleForTesting;
 import com.mopub.network.MoPubNetworkError;
+import com.mopub.network.MoPubRequestUtils;
 import com.mopub.volley.NetworkResponse;
 import com.mopub.volley.Response;
 import com.mopub.volley.VolleyError;
 import com.mopub.volley.toolbox.HttpHeaderParser;
 import com.mopub.volley.toolbox.JsonRequest;
 
-import org.apache.http.HttpStatus;
 import org.json.JSONArray;
 import org.json.JSONException;
 import org.json.JSONObject;
 
 import java.io.UnsupportedEncodingException;
+import java.net.HttpURLConnection;
+import java.util.Map;
 
 import static com.mopub.nativeads.MoPubNativeAdPositioning.MoPubClientPositioning;
 
@@ -29,13 +32,24 @@
     // Max value to avoid bad integer math calculations. This is 2 ^ 16.
     private static final int MAX_VALUE = 1 << 16;
 
-    public PositioningRequest(final String url,
+    @NonNull private final String mOriginalUrl;
+    @NonNull private final Context mContext;
+
+    public PositioningRequest(@NonNull final Context context,
+            final String url,
             final Response.Listener<MoPubClientPositioning> listener,
             final Response.ErrorListener errorListener) {
-        super(Method.GET, url, null, listener, errorListener);
+        super(MoPubRequestUtils.chooseMethod(url),
+                MoPubRequestUtils.truncateQueryParamsIfPost(url),
+                null,
+                listener,
+                errorListener);
+
+        mOriginalUrl = url;
+        mContext = context.getApplicationContext();
     }
 
-    // This is done just for unit testing visibolity.
+    // This is done just for unit testing visibility.
     @Override
     protected void deliverResponse(final MoPubClientPositioning response) {
         super.deliverResponse(response);
@@ -43,7 +57,7 @@ protected void deliverResponse(final MoPubClientPositioning response) {
 
     @Override
     protected Response<MoPubClientPositioning> parseNetworkResponse(final NetworkResponse response) {
-        if (response.statusCode != HttpStatus.SC_OK) {
+        if (response.statusCode != HttpURLConnection.HTTP_OK) {
             return Response.error(new VolleyError(response));
         }
 
@@ -124,4 +138,22 @@ private void parseRepeatingJson(@NonNull final JSONObject repeatingObject,
         }
         positioning.enableRepeatingPositions(interval);
     }
+
+    @Override
+    protected Map<String, String> getParams() {
+        if (!MoPubRequestUtils.isMoPubRequest(getUrl())) {
+            return null;
+        }
+
+        return MoPubRequestUtils.convertQueryToMap(mContext, mOriginalUrl);
+    }
+
+    @Override
+    public byte[] getBody() {
+        final String body = MoPubRequestUtils.generateBodyFromParams(getParams(), getUrl());
+        if (body == null) {
+            return null;
+        }
+        return body.getBytes();
+    }
 }
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningUrlGenerator.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningUrlGenerator.java
index f9b0fafb..cb654731 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningUrlGenerator.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/PositioningUrlGenerator.java
@@ -51,6 +51,6 @@ private void setAdUnitId(@NonNull String adUnitId) {
     }
 
     private void setSdkVersion(@NonNull String sdkVersion) {
-        addParam("nsv", sdkVersion);
+        addParam("nv", sdkVersion);
     }
 }
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/RequestParameters.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/RequestParameters.java
index d6edb69c..bbb2ec59 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/RequestParameters.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/RequestParameters.java
@@ -5,6 +5,8 @@
 import android.support.annotation.Nullable;
 import android.text.TextUtils;
 
+import com.mopub.common.MoPub;
+
 import java.util.EnumSet;
 
 public class RequestParameters {
@@ -31,11 +33,13 @@ public String toString() {
     }
 
     @Nullable private final String mKeywords;
+    @Nullable private final String mUserDataKeywords;
     @Nullable private final Location mLocation;
     @Nullable private final EnumSet<NativeAdAsset> mDesiredAssets;
 
     public final static class Builder {
         private String keywords;
+        private String userDatakeywords;
         private Location location;
         private EnumSet<NativeAdAsset> desiredAssets;
 
@@ -45,9 +49,15 @@ public final Builder keywords(String keywords) {
             return this;
         }
 
+        @NonNull
+        public final Builder userDataKeywords(String userDataKeywords) {
+            this.userDatakeywords = MoPub.canCollectPersonalInformation() ? userDataKeywords : null;
+            return this;
+        }
+
         @NonNull
         public final Builder location(Location location) {
-            this.location = location;
+            this.location = MoPub.canCollectPersonalInformation() ? location : null;
             return this;
         }
 
@@ -66,8 +76,11 @@ public final RequestParameters build() {
 
     private RequestParameters(@NonNull Builder builder) {
         mKeywords = builder.keywords;
-        mLocation = builder.location;
         mDesiredAssets = builder.desiredAssets;
+
+        final boolean canCollectPersonalInformation = MoPub.canCollectPersonalInformation();
+        mUserDataKeywords = canCollectPersonalInformation ? builder.userDatakeywords : null;
+        mLocation = canCollectPersonalInformation ? builder.location : null;
     }
 
     @Nullable
@@ -75,6 +88,14 @@ public final String getKeywords() {
         return mKeywords;
     }
 
+    @Nullable
+    public final String getUserDataKeywords() {
+        if(!MoPub.canCollectPersonalInformation()) {
+            return null;
+        }
+        return mUserDataKeywords;
+    }
+
     @Nullable
     public final Location getLocation() {
         return mLocation;
diff --git a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/ServerPositioningSource.java b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/ServerPositioningSource.java
index 60f49171..adb73b44 100644
--- a/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/ServerPositioningSource.java
+++ b/mopub-sdk/mopub-sdk-native-static/src/main/java/com/mopub/nativeads/ServerPositioningSource.java
@@ -126,7 +126,7 @@ public void loadPositions(@NonNull String adUnitId, @NonNull PositioningListener
     private void requestPositioningInternal() {
         MoPubLog.d("Loading positioning from: " + mRetryUrl);
 
-        mRequest = new PositioningRequest(mRetryUrl, mPositioningListener, mErrorListener);
+        mRequest = new PositioningRequest(mContext, mRetryUrl, mPositioningListener, mErrorListener);
         final RequestQueue requestQueue = Networking.getRequestQueue(mContext);
         requestQueue.add(mRequest);
     }
diff --git a/mopub-sdk/mopub-sdk-native-video/build.gradle b/mopub-sdk/mopub-sdk-native-video/build.gradle
index 6e83c328..885bf2e7 100644
--- a/mopub-sdk/mopub-sdk-native-video/build.gradle
+++ b/mopub-sdk/mopub-sdk-native-video/build.gradle
@@ -1,8 +1,8 @@
 apply from: '../shared-build.gradle'
 
 dependencies {
-    compile project(':mopub-sdk:mopub-sdk-native-static')
-    compile 'com.google.android.exoplayer:exoplayer:r2.4.4'
+    api project(':mopub-sdk:mopub-sdk-native-static')
+    api 'com.google.android.exoplayer:exoplayer:r2.4.4'
 }
 
 project.description = 'MoPub Android SDK - Native Video'
diff --git a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/HttpDiskCompositeDataSource.java b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/HttpDiskCompositeDataSource.java
index 1bbdd628..d7d4a135 100644
--- a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/HttpDiskCompositeDataSource.java
+++ b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/HttpDiskCompositeDataSource.java
@@ -13,10 +13,6 @@
 import com.mopub.common.CacheService;
 import com.mopub.common.Preconditions;
 import com.mopub.common.VisibleForTesting;
-import com.mopub.common.event.BaseEvent;
-import com.mopub.common.event.Event;
-import com.mopub.common.event.EventDetails;
-import com.mopub.common.event.MoPubEvents;
 import com.mopub.common.logging.MoPubLog;
 
 import org.json.JSONArray;
@@ -124,29 +120,18 @@
      */
     private boolean mIsDirty;
 
-    /**
-     * Used to store metadata around event logging.
-     */
-    @Nullable private final EventDetails mEventDetails;
-
-    /**
-     * Whether or not the event for starting the download has already been fired.
-     */
-    private boolean mHasLoggedDownloadStart;
-
     public HttpDiskCompositeDataSource(@NonNull final Context context,
-            @NonNull final String userAgent, @Nullable final EventDetails eventDetails) {
-        this(context, userAgent, eventDetails, new DefaultHttpDataSource(userAgent, null));
+            @NonNull final String userAgent) {
+        this(context, userAgent, new DefaultHttpDataSource(userAgent, null));
     }
 
     @VisibleForTesting
     HttpDiskCompositeDataSource(@NonNull final Context context,
-            @NonNull final String userAgent, @Nullable final EventDetails eventDetails,
+            @NonNull final String userAgent,
             @NonNull final HttpDataSource httpDataSource) {
         mHttpDataSource = httpDataSource;
         CacheService.initialize(context);
         mIntervals = new TreeSet<IntInterval>();
-        mEventDetails = eventDetails;
     }
 
     @Override
@@ -211,14 +196,6 @@ public long open(@NonNull final DataSpec dataSpec) throws IOException {
                             String.valueOf(mExpectedFileLength).getBytes());
                 }
                 mIsHttpSourceOpen = true;
-                if (!mHasLoggedDownloadStart) {
-                    MoPubEvents.log(Event.createEventFromDetails(
-                            BaseEvent.Name.DOWNLOAD_START,
-                            BaseEvent.Category.NATIVE_VIDEO,
-                            BaseEvent.SamplingRate.NATIVE_VIDEO,
-                            mEventDetails));
-                    mHasLoggedDownloadStart = true;
-                }
             } catch (HttpDataSource.InvalidResponseCodeException e) {
                 // This shouldn't happen anymore, but if we accidentally requested too many bytes
                 // because we already had the bytes before that point, then it's still fine.
@@ -287,14 +264,6 @@ public void close() throws IOException {
             CacheService.putToDiskCache(mSegment + mKey, mCachedBytes);
             addNewInterval(mIntervals, mStartInFile, mDataBlockOffset);
             writeIntervalsToDisk(mIntervals, mKey);
-            if (mIsDirty && mExpectedFileLength != null && getFirstContiguousPointAfter(
-                    0, mIntervals) == mExpectedFileLength) {
-                MoPubEvents.log(Event.createEventFromDetails(
-                        BaseEvent.Name.DOWNLOAD_FINISHED,
-                        BaseEvent.Category.NATIVE_VIDEO,
-                        BaseEvent.SamplingRate.NATIVE_VIDEO,
-                        mEventDetails));
-            }
         }
         mCachedBytes = null;
 
diff --git a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/MoPubCustomEventVideoNative.java b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/MoPubCustomEventVideoNative.java
index ac405b11..fa9b3ee3 100644
--- a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/MoPubCustomEventVideoNative.java
+++ b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/MoPubCustomEventVideoNative.java
@@ -12,10 +12,6 @@
 import com.mopub.common.DataKeys;
 import com.mopub.common.Preconditions;
 import com.mopub.common.VisibleForTesting;
-import com.mopub.common.event.BaseEvent;
-import com.mopub.common.event.Event;
-import com.mopub.common.event.EventDetails;
-import com.mopub.common.event.MoPubEvents;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.Utils;
 import com.mopub.mobileads.MraidVideoPlayerActivity;
@@ -40,7 +36,6 @@
 import java.util.Map;
 import java.util.Set;
 
-import static com.mopub.common.DataKeys.EVENT_DETAILS;
 import static com.mopub.common.DataKeys.IMPRESSION_MIN_VISIBLE_PERCENT;
 import static com.mopub.common.DataKeys.IMPRESSION_MIN_VISIBLE_PX;
 import static com.mopub.common.DataKeys.IMPRESSION_VISIBLE_MS;
@@ -66,10 +61,6 @@ protected void loadNativeAd(@NonNull final Context context,
             return;
         }
 
-        final Object eventDetailsObject = localExtras.get(EVENT_DETAILS);
-        final EventDetails eventDetails = eventDetailsObject instanceof EventDetails ?
-                (EventDetails) eventDetailsObject : null;
-
         final VideoResponseHeaders videoResponseHeaders = new VideoResponseHeaders(serverExtras);
         if (!videoResponseHeaders.hasValidHeaders()) {
             customEventNativeListener.onNativeAdFailed(NativeErrorCode.INVALID_RESPONSE);
@@ -87,7 +78,7 @@ protected void loadNativeAd(@NonNull final Context context,
 
         final String clickTrackingUrlFromHeader = (String) clickTrackingUrlFromHeaderObject;
         final MoPubVideoNativeAd videoNativeAd = new MoPubVideoNativeAd(context, (JSONObject) json,
-                customEventNativeListener, videoResponseHeaders, eventDetails,
+                customEventNativeListener, videoResponseHeaders,
                 clickTrackingUrlFromHeader);
         try {
             videoNativeAd.loadAd();
@@ -110,7 +101,9 @@ protected void loadNativeAd(@NonNull final Context context,
             CLICK_DESTINATION("clk", false),
             FALLBACK("fallback", false),
             CALL_TO_ACTION("ctatext", false),
-            VAST_VIDEO("video", false);
+            VAST_VIDEO("video", false),
+            PRIVACY_INFORMATION_ICON_IMAGE_URL("privacyicon", false),
+            PRIVACY_INFORMATION_ICON_CLICKTHROUGH_URL("privacyclkurl", false);
 
             @NonNull final String mName;
             final boolean mRequired;
@@ -167,7 +160,6 @@ static Parameter from(@NonNull final String name) {
         @Nullable VastVideoConfig mVastVideoConfig;
         @Nullable private MediaLayout mMediaLayout;
         @Nullable private View mRootView;
-        @Nullable private final EventDetails mEventDetails;
 
         private final long mId;
         private boolean mNeedsSeek;
@@ -187,11 +179,10 @@ public MoPubVideoNativeAd(
                 @NonNull final JSONObject jsonObject,
                 @NonNull final CustomEventNativeListener customEventNativeListener,
                 @NonNull final VideoResponseHeaders videoResponseHeaders,
-                @Nullable final EventDetails eventDetails,
                 @NonNull final String clickTrackingUrl) {
             this(context, jsonObject, customEventNativeListener, videoResponseHeaders,
                     new VisibilityTracker(context), new NativeVideoControllerFactory(),
-                    eventDetails, clickTrackingUrl, VastManagerFactory.create(context.getApplicationContext(), false));
+                    clickTrackingUrl, VastManagerFactory.create(context.getApplicationContext(), false));
         }
 
         @VisibleForTesting
@@ -202,7 +193,6 @@ public MoPubVideoNativeAd(
                 @NonNull final VideoResponseHeaders videoResponseHeaders,
                 @NonNull final VisibilityTracker visibilityTracker,
                 @NonNull final NativeVideoControllerFactory nativeVideoControllerFactory,
-                @Nullable final EventDetails eventDetails,
                 @NonNull final String clickTrackingUrl,
                 @NonNull final VastManager vastManager) {
             Preconditions.checkNotNull(context);
@@ -222,8 +212,6 @@ public MoPubVideoNativeAd(
             mNativeVideoControllerFactory = nativeVideoControllerFactory;
             mMoPubClickTrackingUrl = clickTrackingUrl;
 
-            mEventDetails = eventDetails;
-
             mId = Utils.generateUniqueId();
             mNeedsSeek = true;
             mVideoState = VideoState.CREATED;
@@ -270,14 +258,16 @@ void loadAd() throws IllegalArgumentException {
                     addExtra(key, mJsonObject.opt(key));
                 }
             }
-            setPrivacyInformationIconClickThroughUrl(PRIVACY_INFORMATION_CLICKTHROUGH_URL);
+            if (TextUtils.isEmpty(getPrivacyInformationIconClickThroughUrl())) {
+                setPrivacyInformationIconClickThroughUrl(PRIVACY_INFORMATION_CLICKTHROUGH_URL);
+            }
 
             preCacheImages(mContext, getAllImageUrls(), new NativeImageHelper.ImageListener() {
                 @Override
                 public void onImagesCached() {
                     mVastManager.prepareVastVideoConfiguration(getVastVideo(),
                             MoPubVideoNativeAd.this,
-                            mEventDetails == null ? null : mEventDetails.getDspCreativeId(),
+                            null,
                             mContext);
                 }
 
@@ -341,6 +331,10 @@ public void onVastVideoConfigurationPrepared(@Nullable VastVideoConfig vastVideo
                 visibilityTrackingEvents.add(vastVisibilityTrackingEvent);
             }
 
+            mVastVideoConfig.setPrivacyInformationIconImageUrl(getPrivacyInformationIconImageUrl());
+            mVastVideoConfig.setPrivacyInformationIconClickthroughUrl(
+                    getPrivacyInformationIconClickThroughUrl());
+
             Set<String> clickTrackers = new HashSet<String>();
             clickTrackers.add(mMoPubClickTrackingUrl);
             clickTrackers.addAll(getClickTrackers());
@@ -355,7 +349,7 @@ public void onVastVideoConfigurationPrepared(@Nullable VastVideoConfig vastVideo
             mVastVideoConfig.setClickThroughUrl(getClickDestinationUrl());
 
             mNativeVideoController = mNativeVideoControllerFactory.createForId(
-                    mId, mContext, visibilityTrackingEvents, mVastVideoConfig, mEventDetails);
+                    mId, mContext, visibilityTrackingEvents, mVastVideoConfig);
 
             mCustomEventNativeListener.onNativeAdLoaded(this);
 
@@ -412,6 +406,12 @@ private void addInstanceVariable(@NonNull final Parameter key,
                     case VAST_VIDEO:
                         setVastVideo((String) value);
                         break;
+                    case PRIVACY_INFORMATION_ICON_IMAGE_URL:
+                        setPrivacyInformationIconImageUrl((String) value);
+                        break;
+                    case PRIVACY_INFORMATION_ICON_CLICKTHROUGH_URL:
+                        setPrivacyInformationIconClickThroughUrl((String) value);
+                        break;
                     default:
                         MoPubLog.d("Unable to add JSON key to internal mapping: " + key.mName);
                         break;
@@ -674,14 +674,6 @@ void applyState(@NonNull final VideoState videoState, boolean transitionToFullSc
                     mVastVideoConfig.handleError(mContext, null, 0);
                     mNativeVideoController.setAppAudioEnabled(false);
                     mMediaLayout.setMode(MediaLayout.Mode.IMAGE);
-                    // Only log the failed to play event when the video has not started
-                    if (previousState != VideoState.PLAYING && previousState != VideoState.PLAYING_MUTED) {
-                        MoPubEvents.log(Event.createEventFromDetails(
-                                BaseEvent.Name.ERROR_FAILED_TO_PLAY,
-                                BaseEvent.Category.NATIVE_VIDEO,
-                                BaseEvent.SamplingRate.NATIVE_VIDEO,
-                                mEventDetails));
-                    }
                     break;
                 case CREATED:
                 case LOADING:
@@ -789,12 +781,15 @@ private boolean isImageKey(@Nullable final String name) {
         @NonNull
         private List<String> getAllImageUrls() {
             final List<String> imageUrls = new ArrayList<String>();
-            if (getMainImageUrl() != null) {
+            if (!TextUtils.isEmpty(getMainImageUrl())) {
                 imageUrls.add(getMainImageUrl());
             }
-            if (getIconImageUrl() != null) {
+            if (!TextUtils.isEmpty(getIconImageUrl())) {
                 imageUrls.add(getIconImageUrl());
             }
+            if (!TextUtils.isEmpty(getPrivacyInformationIconImageUrl())) {
+                imageUrls.add(getPrivacyInformationIconImageUrl());
+            }
 
             imageUrls.addAll(getExtrasImageUrls());
             return imageUrls;
@@ -896,10 +891,9 @@ public void execute() {
         public NativeVideoController createForId(final long id,
                 @NonNull final Context context,
                 @NonNull final List<VisibilityTrackingEvent> visibilityTrackingEvents,
-                @NonNull final VastVideoConfig vastVideoConfig,
-                @Nullable final EventDetails eventDetails) {
+                @NonNull final VastVideoConfig vastVideoConfig) {
             return NativeVideoController.createForId(id, context, visibilityTrackingEvents,
-                    vastVideoConfig, eventDetails);
+                    vastVideoConfig);
         }
     }
 
diff --git a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeFullScreenVideoView.java b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeFullScreenVideoView.java
index eb3a94ff..9b23cb26 100644
--- a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeFullScreenVideoView.java
+++ b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeFullScreenVideoView.java
@@ -65,7 +65,8 @@
     @VisibleForTesting final int mPlayControlSizePx;
     @VisibleForTesting final int mGradientStripHeightPx;
 
-    public NativeFullScreenVideoView(@NonNull final Context context, int orientation, @Nullable String ctaText) {
+    public NativeFullScreenVideoView(@NonNull final Context context, int orientation,
+            @Nullable String ctaText) {
         this(context, orientation, ctaText,
                 new ImageView(context),
                 new TextureView(context), new ProgressBar(context), new ImageView(context),
@@ -185,8 +186,6 @@ public NativeFullScreenVideoView(@NonNull final Context context, int orientation
 
         mPrivacyInformationIcon = privacyInformationIcon;
         mPrivacyInformationIcon.setId((int) Utils.generateUniqueId());
-        mPrivacyInformationIcon.setImageDrawable(
-                Drawables.NATIVE_PRIVACY_INFORMATION_ICON.createDrawable(context));
         mPrivacyInformationIcon.setPadding(mClosePaddingPx, mClosePaddingPx, mClosePaddingPx * 2,
                 mClosePaddingPx * 2);
         addView(mPrivacyInformationIcon);
@@ -256,6 +255,15 @@ public void setPrivacyInformationClickListener(
         mPrivacyInformationIcon.setOnClickListener(privacyInformationListener);
     }
 
+    public void setPrivacyInformationIconImageUrl(@Nullable final String privacyInformationIconImageUrl) {
+        if (TextUtils.isEmpty(privacyInformationIconImageUrl)) {
+            mPrivacyInformationIcon.setImageDrawable(
+                    Drawables.NATIVE_PRIVACY_INFORMATION_ICON.createDrawable(mPrivacyInformationIcon.getContext()));
+        } else {
+            NativeImageHelper.loadImageView(privacyInformationIconImageUrl, mPrivacyInformationIcon);
+        }
+    }
+
     public void setCtaClickListener(@Nullable OnClickListener ctaListener) {
         mCtaButton.setOnClickListener(ctaListener);
     }
diff --git a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoController.java b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoController.java
index d2e8f3e0..8a8768f5 100644
--- a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoController.java
+++ b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoController.java
@@ -23,7 +23,9 @@
 import com.google.android.exoplayer2.Renderer;
 import com.google.android.exoplayer2.Timeline;
 import com.google.android.exoplayer2.audio.MediaCodecAudioRenderer;
+import com.google.android.exoplayer2.extractor.Extractor;
 import com.google.android.exoplayer2.extractor.ExtractorsFactory;
+import com.google.android.exoplayer2.extractor.mp4.Mp4Extractor;
 import com.google.android.exoplayer2.mediacodec.MediaCodecSelector;
 import com.google.android.exoplayer2.source.ExtractorMediaSource;
 import com.google.android.exoplayer2.source.MediaSource;
@@ -31,17 +33,11 @@
 import com.google.android.exoplayer2.trackselection.DefaultTrackSelector;
 import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
 import com.google.android.exoplayer2.trackselection.TrackSelector;
+import com.google.android.exoplayer2.upstream.DataSource;
 import com.google.android.exoplayer2.upstream.DefaultAllocator;
 import com.google.android.exoplayer2.video.MediaCodecVideoRenderer;
-import com.google.android.exoplayer2.extractor.Extractor;
-import com.google.android.exoplayer2.extractor.mp4.Mp4Extractor;
-import com.google.android.exoplayer2.upstream.DataSource;
 import com.mopub.common.Preconditions;
 import com.mopub.common.VisibleForTesting;
-import com.mopub.common.event.BaseEvent;
-import com.mopub.common.event.Event;
-import com.mopub.common.event.EventDetails;
-import com.mopub.common.event.MoPubEvents;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.mobileads.RepeatingHandlerRunnable;
 import com.mopub.mobileads.VastTracker;
@@ -97,7 +93,6 @@
     @Nullable private BitmapDrawable mFinalFrame;
     @Nullable private MediaCodecAudioRenderer mAudioRenderer;
     @Nullable private MediaCodecVideoRenderer mVideoRenderer;
-    @Nullable private EventDetails mEventDetails;
 
     private boolean mPlayWhenReady;
     private boolean mAudioEnabled;
@@ -116,10 +111,9 @@
     public static NativeVideoController createForId(final long id,
             @NonNull final Context context,
             @NonNull final List<VisibilityTrackingEvent> visibilityTrackingEvents,
-            @NonNull final VastVideoConfig vastVideoConfig,
-            @Nullable final EventDetails eventDetails) {
+            @NonNull final VastVideoConfig vastVideoConfig) {
         NativeVideoController nvc = new NativeVideoController(context, visibilityTrackingEvents,
-                vastVideoConfig, eventDetails);
+                vastVideoConfig);
         sManagerMap.put(id, nvc);
         return nvc;
     }
@@ -131,10 +125,9 @@ public static NativeVideoController createForId(final long id,
             @NonNull final VastVideoConfig vastVideoConfig,
             @NonNull final NativeVideoProgressRunnable nativeVideoProgressRunnable,
             @NonNull final MoPubExoPlayerFactory moPubExoPlayerFactory,
-            @Nullable final EventDetails eventDetails,
             @NonNull final AudioManager audioManager) {
         NativeVideoController nvc = new NativeVideoController(context, vastVideoConfig,
-                nativeVideoProgressRunnable, moPubExoPlayerFactory, eventDetails, audioManager);
+                nativeVideoProgressRunnable, moPubExoPlayerFactory, audioManager);
         sManagerMap.put(id, nvc);
         return nvc;
     }
@@ -157,15 +150,13 @@ public static NativeVideoController remove(final long id) {
 
     private NativeVideoController(@NonNull final Context context,
             @NonNull final List<VisibilityTrackingEvent> visibilityTrackingEvents,
-            @NonNull final VastVideoConfig vastVideoConfig,
-            @Nullable final EventDetails eventDetails) {
+            @NonNull final VastVideoConfig vastVideoConfig) {
         this(context, vastVideoConfig,
                 new NativeVideoProgressRunnable(context,
                         new Handler(Looper.getMainLooper()),
                         visibilityTrackingEvents,
                         vastVideoConfig),
                 new MoPubExoPlayerFactory(),
-                eventDetails, 
                 (AudioManager) context.getSystemService(Context.AUDIO_SERVICE));
     }
 
@@ -173,7 +164,6 @@ private NativeVideoController(@NonNull final Context context,
             @NonNull final VastVideoConfig vastVideoConfig,
             @NonNull final NativeVideoProgressRunnable nativeVideoProgressRunnable,
             @NonNull final MoPubExoPlayerFactory moPubExoPlayerFactory,
-            @Nullable final EventDetails eventDetails,
             @NonNull final AudioManager audioManager) {
         Preconditions.checkNotNull(context);
         Preconditions.checkNotNull(vastVideoConfig);
@@ -185,7 +175,6 @@ private NativeVideoController(@NonNull final Context context,
         mVastVideoConfig = vastVideoConfig;
         mNativeVideoProgressRunnable = nativeVideoProgressRunnable;
         mMoPubExoPlayerFactory = moPubExoPlayerFactory;
-        mEventDetails = eventDetails;
         mAudioManager = audioManager;
     }
 
@@ -320,24 +309,6 @@ public void onPlayerStateChanged(final boolean playWhenReady, final int newState
             mNativeVideoProgressRunnable.requestStop();
         }
 
-        if (mPreviousExoPlayerState == ExoPlayer.STATE_READY && newState == ExoPlayer.STATE_BUFFERING) {
-            MoPubEvents.log(Event.createEventFromDetails(
-                    BaseEvent.Name.DOWNLOAD_BUFFERING,
-                    BaseEvent.Category.NATIVE_VIDEO,
-                    BaseEvent.SamplingRate.NATIVE_VIDEO,
-                    mEventDetails));
-        }
-
-        if (mExoPlayerStateStartedFromIdle &&
-                mPreviousExoPlayerState == ExoPlayer.STATE_BUFFERING &&
-                newState == ExoPlayer.STATE_READY) {
-            MoPubEvents.log(Event.createEventFromDetails(
-                    BaseEvent.Name.DOWNLOAD_VIDEO_READY,
-                    BaseEvent.Category.NATIVE_VIDEO,
-                    BaseEvent.SamplingRate.NATIVE_VIDEO,
-                    mEventDetails));
-        }
-
         mPreviousExoPlayerState = newState;
         if (newState == ExoPlayer.STATE_READY) {
             mExoPlayerStateStartedFromIdle = false;
@@ -373,12 +344,6 @@ public void onPlayerError(ExoPlaybackException e) {
             return;
         }
 
-        MoPubEvents.log(Event.createEventFromDetails(
-                BaseEvent.Name.ERROR_DURING_PLAYBACK,
-                BaseEvent.Category.NATIVE_VIDEO,
-                BaseEvent.SamplingRate.NATIVE_VIDEO,
-                mEventDetails));
-
         mListener.onError(e);
         mNativeVideoProgressRunnable.requestStop();
     }
@@ -445,7 +410,7 @@ private void preparePlayer() {
             final DataSource.Factory dataSourceFactory = new DataSource.Factory() {
                 @Override
                 public DataSource createDataSource() {
-                    return new HttpDiskCompositeDataSource(mContext, "exo_demo", mEventDetails);
+                    return new HttpDiskCompositeDataSource(mContext, "exo_demo");
                 }
             };
 
diff --git a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoViewController.java b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoViewController.java
index e98c9b1f..eb4684a3 100644
--- a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoViewController.java
+++ b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/NativeVideoViewController.java
@@ -9,6 +9,7 @@
 import android.os.Bundle;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
+import android.text.TextUtils;
 import android.view.TextureView;
 import android.view.View;
 import android.view.ViewGroup.LayoutParams;
@@ -124,11 +125,16 @@ public void onClick(View v) {
             public void onClick(View v) {
                 mNativeVideoController.setPlayWhenReady(false);
                 mCachedVideoFrame = mFullScreenVideoView.getTextureView().getBitmap();
+                String url = mVastVideoConfig.getPrivacyInformationIconClickthroughUrl();
+                if (TextUtils.isEmpty(url)) {
+                    url = MoPubVideoNativeAd.PRIVACY_INFORMATION_CLICKTHROUGH_URL;
+                }
                 new UrlHandler.Builder().withSupportedUrlActions(UrlAction.OPEN_IN_APP_BROWSER)
-                        .build().handleUrl(getContext(),
-                        MoPubVideoNativeAd.PRIVACY_INFORMATION_CLICKTHROUGH_URL);
+                        .build().handleUrl(getContext(), url);
             }
         });
+        mFullScreenVideoView.setPrivacyInformationIconImageUrl(
+                mVastVideoConfig.getPrivacyInformationIconImageUrl());
 
         final LayoutParams adViewLayout =
                 new LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT);
diff --git a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/VideoNativeAd.java b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/VideoNativeAd.java
index 97d19869..acd46822 100644
--- a/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/VideoNativeAd.java
+++ b/mopub-sdk/mopub-sdk-native-video/src/main/java/com/mopub/nativeads/VideoNativeAd.java
@@ -66,6 +66,12 @@ public String getCallToAction() {
         return mCallToAction;
     }
 
+    /**
+     * Returns the Privacy Information clickthrough url
+     *
+     * @return String representing the Privacy Information Icon clickthrough url, or {@code null}
+     * if not set.
+     */
     @Nullable
     public String getPrivacyInformationIconClickThroughUrl() {
         return mPrivacyInformationIconClickThroughUrl;
diff --git a/mopub-sdk/mopub-sdk-rewardedvideo/build.gradle b/mopub-sdk/mopub-sdk-rewardedvideo/build.gradle
index f9ad623a..c9fdc4fa 100644
--- a/mopub-sdk/mopub-sdk-rewardedvideo/build.gradle
+++ b/mopub-sdk/mopub-sdk-rewardedvideo/build.gradle
@@ -1,7 +1,7 @@
 apply from: '../shared-build.gradle'
 
 dependencies {
-    compile project(':mopub-sdk:mopub-sdk-interstitial')
+    api project(':mopub-sdk:mopub-sdk-interstitial')
 }
 
 project.description = 'MoPub Android SDK - Rewarded Video'
diff --git a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideoManager.java b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideoManager.java
index c7228b7c..bfb8edf2 100644
--- a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideoManager.java
+++ b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideoManager.java
@@ -17,6 +17,7 @@
 import com.mopub.common.Constants;
 import com.mopub.common.DataKeys;
 import com.mopub.common.MediationSettings;
+import com.mopub.common.MoPub;
 import com.mopub.common.MoPubReward;
 import com.mopub.common.Preconditions;
 import com.mopub.common.SharedPreferencesHelper;
@@ -107,6 +108,7 @@ public void onErrorResponse(final VolleyError volleyError) {
 
     public static final class RequestParameters {
         @Nullable public final String mKeywords;
+        @Nullable public final String mUserDataKeywords;
         @Nullable public final Location mLocation;
         @Nullable public final String mCustomerId;
 
@@ -114,16 +116,28 @@ public RequestParameters(@Nullable final String keywords) {
             this(keywords, null);
         }
 
+        public RequestParameters(@Nullable final String keywords, @Nullable final String userDataKeywords) {
+            this(keywords, userDataKeywords,null);
+        }
+
         public RequestParameters(@Nullable final String keywords,
-                @Nullable final Location location) {
-            this(keywords, location, null);
+                                 @Nullable final String userDataKeywords,
+                                 @Nullable final Location location) {
+            this(keywords, userDataKeywords, location, null);
         }
 
-        public RequestParameters(@Nullable final String keywords, @Nullable final Location location,
-                @Nullable final String customerId) {
+        public RequestParameters(@Nullable final String keywords,
+                                 @Nullable final String userDataKeywords,
+                                 @Nullable final Location location,
+                                 @Nullable final String customerId) {
             mKeywords = keywords;
-            mLocation = location;
             mCustomerId = customerId;
+
+            // Only add userDataKeywords and location to RequestParameters if we are allowed to collect
+            // personal information from a user
+            final boolean canCollectPersonalInformation = MoPub.canCollectPersonalInformation();
+            mUserDataKeywords = canCollectPersonalInformation ? userDataKeywords: null;
+            mLocation = canCollectPersonalInformation ? location : null;
         }
     }
 
@@ -297,8 +311,9 @@ public static void setVideoListener(@Nullable MoPubRewardedVideoListener listene
      * method will not make a new request if there is already a video loading for this adUnitId.
      *
      * @param adUnitId MoPub adUnitId String
-     * @param requestParameters Optional RequestParameters object containing optional keywords,
-     *                          optional location value, and optional customer id
+     * @param requestParameters Optional RequestParameters object containing optional keywords
+     *                          Optional RequestParameters object containing optional user data keywords
+     *                          optional location value, and optional customer id.
      * @param mediationSettings Optional instance-level MediationSettings to associate with the
      *                          above adUnitId.
      */
@@ -350,6 +365,8 @@ public void run() {
         final AdUrlGenerator urlGenerator = new WebViewAdUrlGenerator(sInstance.mContext, false);
         final String adUrlString = urlGenerator.withAdUnitId(adUnitId)
                 .withKeywords(requestParameters == null ? null : requestParameters.mKeywords)
+                .withUserDataKeywords((requestParameters == null ||
+                        !MoPub.canCollectPersonalInformation()) ? null : requestParameters.mUserDataKeywords)
                 .withLocation(requestParameters == null ? null : requestParameters.mLocation)
                 .generateUrlString(Constants.HOST);
 
@@ -594,10 +611,11 @@ public void run() {
                         "Updating init settings for custom event %s with params %s",
                         customEventClassName, serverExtrasJsonString));
 
+                // https://github.com/robolectric/robolectric/issues/3641
                 sCustomEventSharedPrefs
                         .edit()
                         .putString(customEventClassName, serverExtrasJsonString)
-                        .apply();
+                        .commit();
             }
 
             // Load custom event
diff --git a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideos.java b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideos.java
index 17a641e8..6b7c7fcd 100644
--- a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideos.java
+++ b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/MoPubRewardedVideos.java
@@ -3,12 +3,16 @@
 import android.app.Activity;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
+import android.text.TextUtils;
 
 import com.mopub.common.MediationSettings;
 import com.mopub.common.MoPubReward;
 import com.mopub.common.Preconditions;
+import com.mopub.common.SdkConfiguration;
+import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.util.ReflectionTarget;
 
+import java.util.ArrayList;
 import java.util.List;
 import java.util.Set;
 
@@ -19,7 +23,7 @@
 public class MoPubRewardedVideos {
 
     @ReflectionTarget
-    public static void initializeRewardedVideo(@NonNull Activity activity,
+    private static void initializeRewardedVideo(@NonNull Activity activity,
             MediationSettings... mediationSettings) {
         Preconditions.checkNotNull(activity);
 
@@ -27,7 +31,7 @@ public static void initializeRewardedVideo(@NonNull Activity activity,
     }
 
     @ReflectionTarget
-    public static void initializeRewardedVideo(@NonNull Activity activity,
+    private static void initializeRewardedVideo(@NonNull Activity activity,
             @NonNull List<Class<? extends CustomEventRewardedVideo>> networksToInit,
             MediationSettings... mediationSettings) {
         Preconditions.checkNotNull(activity);
@@ -37,6 +41,43 @@ public static void initializeRewardedVideo(@NonNull Activity activity,
         MoPubRewardedVideoManager.initNetworks(activity, networksToInit);
     }
 
+    /**
+     * Use MoPub#initializeSdk instead.
+     */
+    @ReflectionTarget
+    @SuppressWarnings("unchecked")
+    private static void initializeRewardedVideo(@NonNull final Activity activity,
+            @NonNull final SdkConfiguration sdkConfiguration) {
+        Preconditions.checkNotNull(activity);
+        Preconditions.checkNotNull(sdkConfiguration);
+
+        final List<String> networksToInit = sdkConfiguration.getNetworksToInit();
+        final List<Class<? extends CustomEventRewardedVideo>> classList = new ArrayList<>();
+        if (networksToInit != null) {
+            for (final String networkClassName : networksToInit) {
+                if (TextUtils.isEmpty(networkClassName)) {
+                    continue;
+                }
+                try {
+                    final Class networkClass = Class.forName(networkClassName);
+                    classList.add(networkClass.asSubclass(CustomEventRewardedVideo.class));
+                } catch (ClassNotFoundException e) {
+                    MoPubLog.w("Ignoring unknown class name " + networkClassName);
+                } catch (ClassCastException e) {
+                    MoPubLog.w(
+                            "Unable to cast " + networkClassName +
+                                    " to Class<? extends CustomEventRewardedVideo>.");
+                }
+            }
+        }
+
+        if (!classList.isEmpty()) {
+            initializeRewardedVideo(activity, classList, sdkConfiguration.getMediationSettings());
+        } else {
+            initializeRewardedVideo(activity, sdkConfiguration.getMediationSettings());
+        }
+    }
+
     @ReflectionTarget
     public static void setRewardedVideoListener(@Nullable MoPubRewardedVideoListener listener) {
         MoPubRewardedVideoManager.setVideoListener(listener);
diff --git a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequest.java b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequest.java
index 50f10267..c9ab5b46 100644
--- a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequest.java
+++ b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequest.java
@@ -1,9 +1,10 @@
 package com.mopub.mobileads;
 
+import android.content.Context;
 import android.support.annotation.NonNull;
 
+import com.mopub.network.MoPubRequest;
 import com.mopub.volley.NetworkResponse;
-import com.mopub.volley.Request;
 import com.mopub.volley.Response;
 import com.mopub.volley.RetryPolicy;
 import com.mopub.volley.toolbox.HttpHeaderParser;
@@ -12,7 +13,7 @@
  * The actual class making the video completion request. Since we actually only care about the
  * status code of the request, that's the only thing that is delivered.
  */
-public class RewardedVideoCompletionRequest extends Request<Integer> {
+public class RewardedVideoCompletionRequest extends MoPubRequest<Integer> {
 
     public interface RewardedVideoCompletionRequestListener extends Response.ErrorListener {
         void onResponse(Integer response);
@@ -20,10 +21,11 @@
 
     @NonNull final RewardedVideoCompletionRequestListener mListener;
 
-    public RewardedVideoCompletionRequest(@NonNull final String url,
+    public RewardedVideoCompletionRequest(@NonNull final Context context,
+            @NonNull final String url,
             @NonNull final RetryPolicy retryPolicy,
             @NonNull final RewardedVideoCompletionRequestListener listener) {
-        super(Method.GET, url, listener);
+        super(context, url, listener);
         setShouldCache(false);
         setRetryPolicy(retryPolicy);
         mListener = listener;
diff --git a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequestHandler.java b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequestHandler.java
index a046e41e..021b4532 100644
--- a/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequestHandler.java
+++ b/mopub-sdk/mopub-sdk-rewardedvideo/src/main/java/com/mopub/mobileads/RewardedVideoCompletionRequestHandler.java
@@ -46,6 +46,7 @@
     @NonNull private final String mUrl;
     @NonNull private final Handler mHandler;
     @NonNull private final RequestQueue mRequestQueue;
+    @NonNull private final Context mContext;
     private int mRetryCount;
     private volatile boolean mShouldStop;
 
@@ -79,6 +80,7 @@
         mRetryCount = 0;
         mHandler = handler;
         mRequestQueue = Networking.getRequestQueue(context);
+        mContext = context.getApplicationContext();
     }
 
     void makeRewardedVideoCompletionRequest() {
@@ -89,7 +91,7 @@ void makeRewardedVideoCompletionRequest() {
         }
 
         final RewardedVideoCompletionRequest rewardedVideoCompletionRequest =
-                new RewardedVideoCompletionRequest(mUrl,
+                new RewardedVideoCompletionRequest(mContext, mUrl,
                         new DefaultRetryPolicy(getTimeout(mRetryCount) - REQUEST_TIMEOUT_DELAY,
                                 0, 0f), this);
         rewardedVideoCompletionRequest.setTag(mUrl);
diff --git a/mopub-sdk/pom.xml b/mopub-sdk/pom.xml
deleted file mode 100644
index 011a3234..00000000
--- a/mopub-sdk/pom.xml
+++ /dev/null
@@ -1,105 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
-    <modelVersion>4.0.0</modelVersion>
-
-    <parent>
-        <groupId>com.mopub.mobileads</groupId>
-        <artifactId>mopub-android</artifactId>
-        <version>1.0</version>
-    </parent>
-
-    <artifactId>mopub-sdk</artifactId>
-    <version>1.0.0-SNAPSHOT</version>
-    <packaging>aar</packaging>
-    <name>MoPub SDK</name>
-    <description>The SDK for MoPub developers.</description>
-
-    <dependencies>
-
-        <!--main-->
-        <dependency>
-            <groupId>com.android.support</groupId>
-            <artifactId>support-annotations</artifactId>
-            <version>23.1.1</version>
-        </dependency>
-
-        <dependency>
-            <groupId>com.android.support</groupId>
-            <artifactId>support-v4</artifactId>
-            <version>23.1.1</version>
-            <type>aar</type>
-        </dependency>
-
-        <dependency>
-            <groupId>com.android.support</groupId>
-            <artifactId>recyclerview-v7</artifactId>
-            <version>23.1.1</version>
-            <type>aar</type>
-        </dependency>
-        
-        <dependency>
-            <groupId>com.mopub.volley</groupId>
-            <artifactId>mopub-volley</artifactId>
-            <version>1.1.0</version>
-        </dependency>
-
-        <dependency>
-            <groupId>com.google.android.exoplayer</groupId>
-            <artifactId>exoplayer</artifactId>
-            <version>r1.5.6</version>
-            <type>aar</type>
-        </dependency>
-
-        <!--android & oobolectric-->
-        <dependency>
-            <groupId>com.google.android</groupId>
-            <artifactId>android</artifactId>
-            <version>4.4.2</version>
-            <scope>provided</scope>
-        </dependency>
-    </dependencies>
-
-    <build>
-        <finalName>${project.artifactId}</finalName>
-
-        <plugins>
-            <plugin>
-                <artifactId>maven-compiler-plugin</artifactId>
-                <version>2.3.2</version>
-                <!-- Skip tests. We use Gradle to build and run tests. -->
-                <executions>
-                    <execution>
-                        <id>default-testCompile</id>
-                        <phase>test-compile</phase>
-                        <goals>
-                            <goal>testCompile</goal>
-                        </goals>
-                        <configuration>
-                            <skip>true</skip>
-                        </configuration>
-                    </execution>
-                </executions>
-                <configuration>
-                    <source>7</source>
-                    <target>7</target>
-                </configuration>
-            </plugin>
-            <plugin>
-                <groupId>com.simpligility.maven.plugins</groupId>
-                <artifactId>android-maven-plugin</artifactId>
-                <version>4.2.0</version>
-                <configuration>
-                    <androidManifestFile>AndroidManifest.xml</androidManifestFile>
-                    <resourceDirectory>res</resourceDirectory>
-                    <sdk>
-                        <!-- platform or api level (api level 4 = platform 1.6)-->
-                        <platform>22</platform>
-                    </sdk>
-                    <undeployBeforeDeploy>true</undeployBeforeDeploy>
-                </configuration>
-                <extensions>true</extensions>
-            </plugin>
-        </plugins>
-    </build>
-</project>
diff --git a/mopub-sdk/publisher.gradle b/mopub-sdk/publisher.gradle
index 9c40f84a..1fd54c43 100644
--- a/mopub-sdk/publisher.gradle
+++ b/mopub-sdk/publisher.gradle
@@ -31,8 +31,8 @@ android.libraryVariants.all { variant ->
         title = project.ext.displayName
         description "Generates Javadoc for $variant.name."
         source = variant.javaCompile.source
-        classpath += files(variant.javaCompile.classpath.files, project.android.getBootClasspath())
-        classpath += project.configurations.compile
+        classpath += project.files(android.getBootClasspath().join(File.pathSeparator))
+        classpath += configurations.compile
 
         options {
             links "http://docs.oracle.com/javase/7/docs/api/"
diff --git a/mopub-sdk/shared-build.gradle b/mopub-sdk/shared-build.gradle
index 7a2d3340..d808ee9b 100644
--- a/mopub-sdk/shared-build.gradle
+++ b/mopub-sdk/shared-build.gradle
@@ -1,17 +1,16 @@
 apply plugin: 'com.android.library'
 
 repositories {
-    mavenCentral()
+    google()
     jcenter()
     flatDir {
         dirs project(':mopub-sdk').file('../libs')
     }
     maven { url "https://s3.amazonaws.com/moat-sdk-builds" }
-    maven { url 'https://maven.google.com' }
 }
 
 project.group = 'com.mopub'
-project.version = '4.19.0'
+project.version = '5.2.0'
 
 android {
     compileSdkVersion 26
@@ -20,7 +19,7 @@ android {
     useLibrary 'org.apache.http.legacy'
 
     defaultConfig {
-        versionCode 57
+        versionCode 62
         versionName version
         minSdkVersion 16
         targetSdkVersion 26
@@ -76,6 +75,6 @@ android {
 }
 
 dependencies {
-    compile 'com.android.support:support-v4:26.1.0'
-    compile 'com.android.support:support-annotations:26.1.0'
+    api 'com.android.support:support-v4:26.1.0'
+    api 'com.android.support:support-annotations:26.1.0'
 }
diff --git a/mopub-sdk/src/main/AndroidManifest.xml b/mopub-sdk/src/main/AndroidManifest.xml
index 144e231e..438e00cd 100644
--- a/mopub-sdk/src/main/AndroidManifest.xml
+++ b/mopub-sdk/src/main/AndroidManifest.xml
@@ -5,7 +5,7 @@
     android:versionName="1.0">
     <uses-sdk
         android:minSdkVersion="9"
-        android:targetSdkVersion="23"/>
+        android:targetSdkVersion="26"/>
     <application/>
 </manifest>
 
diff --git a/mopub-sdk/src/main/resources/fabric/com.mopub.sdk.android.mopub.properties b/mopub-sdk/src/main/resources/fabric/com.mopub.sdk.android.mopub.properties
index 208a5002..d6608042 100644
--- a/mopub-sdk/src/main/resources/fabric/com.mopub.sdk.android.mopub.properties
+++ b/mopub-sdk/src/main/resources/fabric/com.mopub.sdk.android.mopub.properties
@@ -1,3 +1,3 @@
 fabric-identifier=com.mopub.sdk.android:mopub
-fabric-version=4.19.0+kit
+fabric-version=5.2.0+kit
 fabric-build-type=source
diff --git a/mopub-sdk/src/test/java/com/mopub/common/AdReportTest.java b/mopub-sdk/src/test/java/com/mopub/common/AdReportTest.java
index 75d415c2..ea9e121b 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/AdReportTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/AdReportTest.java
@@ -1,16 +1,21 @@
 package com.mopub.common;
 
+import android.app.Activity;
 import android.os.Build;
 
+import com.mopub.common.privacy.MoPubIdentifier;
+import com.mopub.common.privacy.MoPubIdentifierTest;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.test.support.TestDateAndTime;
 import com.mopub.mobileads.BuildConfig;
 import com.mopub.network.AdResponse;
 
+import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
+import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 
 import java.text.SimpleDateFormat;
@@ -24,21 +29,30 @@
 @Config(constants = BuildConfig.class)
 public class AdReportTest {
 
-    public AdReport subject;
     @Mock
-    ClientMetadata mockClientMetadata;
+    private ClientMetadata mockClientMetadata;
     @Mock
-    AdResponse mockAdResponse;
+    private AdResponse mockAdResponse;
+
     private Date now;
+    private Activity context;
+    public AdReport subject;
 
     @Before
-    public void setup() {
+    public void setup() throws Exception {
+        context = Robolectric.buildActivity(Activity.class).create().get();
         now = new Date();
         TestDateAndTime.getInstance().setNow(now);
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(context, true);
+    }
+
+    @After
+    public void tearDown(){
+        MoPubIdentifierTest.clearPreferences(context);
     }
 
     @Test
-    public void testToString_shouldProperlyConstructParametersTextFile() throws Exception {
+    public void testToString_shouldProperlyConstructParametersTextFile() {
         String expectedParameters =
                 "sdk_version : 1.15.2.2\n" +
                         "creative_id : \n" +
@@ -46,7 +60,7 @@ public void testToString_shouldProperlyConstructParametersTextFile() throws Exce
                         "device_model : android\n" +
                         "ad_unit_id : testAdUnit\n" +
                         "device_locale : en_US\n" +
-                        "device_id : UDID\n" +
+                        "device_id : "+MoPubIdentifierTest.TEST_MOPUB_ID+"\n" +
                         "network_type : unknown\n" +
                         "platform : android\n" +
                         "timestamp : " + getCurrentDateTime() + "\n" +
@@ -57,9 +71,9 @@ public void testToString_shouldProperlyConstructParametersTextFile() throws Exce
         stub(mockAdResponse.getDspCreativeId()).toReturn("");
         stub(mockClientMetadata.getDeviceModel()).toReturn("android");
         stub(mockClientMetadata.getDeviceLocale()).toReturn(Locale.US);
-        stub(mockClientMetadata.getDeviceId()).toReturn("UDID");
-        stub(mockAdResponse.getNetworkType()).toReturn("unknown");
+        stub(mockClientMetadata.getMoPubIdentifier()).toReturn(new MoPubIdentifier(context));
 
+        stub(mockAdResponse.getNetworkType()).toReturn("unknown");
         stub(mockAdResponse.getTimestamp()).toReturn(now.getTime());
         stub(mockAdResponse.getAdType()).toReturn("interstitial");
         stub(mockAdResponse.getWidth()).toReturn(480);
@@ -70,7 +84,7 @@ public void testToString_shouldProperlyConstructParametersTextFile() throws Exce
     }
 
     @Test
-    public void constructor_shouldHandleInvalidAdConfigurationValues() throws Exception {
+    public void constructor_shouldHandleInvalidAdConfigurationValues() {
         String expectedParameters =
                 "sdk_version : null\n" +
                         "creative_id : null\n" +
@@ -78,7 +92,7 @@ public void constructor_shouldHandleInvalidAdConfigurationValues() throws Except
                         "device_model : null\n" +
                         "ad_unit_id : testAdUnit\n" +
                         "device_locale : null\n" +
-                        "device_id : null\n" +
+                        "device_id : "+MoPubIdentifierTest.TEST_MOPUB_ID+"\n" +
                         "network_type : null\n" +
                         "platform : android\n" +
                         "timestamp : null" + "\n" +
@@ -88,8 +102,8 @@ public void constructor_shouldHandleInvalidAdConfigurationValues() throws Except
         stub(mockClientMetadata.getSdkVersion()).toReturn(null);
         stub(mockAdResponse.getDspCreativeId()).toReturn(null);
         stub(mockClientMetadata.getDeviceLocale()).toReturn(null);
-        stub(mockClientMetadata.getDeviceId()).toReturn(null);
         stub(mockAdResponse.getNetworkType()).toReturn(null);
+        stub(mockClientMetadata.getMoPubIdentifier()).toReturn(new MoPubIdentifier(context));
 
         stub(mockAdResponse.getTimestamp()).toReturn(-1L);
         stub(mockAdResponse.getAdType()).toReturn(null);
@@ -104,4 +118,4 @@ private String getCurrentDateTime() {
         SimpleDateFormat dateFormat = new SimpleDateFormat("M/d/yy hh:mm:ss a z", Locale.US);
         return dateFormat.format(now);
     }
-}
\ No newline at end of file
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/AdvancedBiddingTokensTest.java b/mopub-sdk/src/test/java/com/mopub/common/AdvancedBiddingTokensTest.java
new file mode 100644
index 00000000..9aa48037
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/AdvancedBiddingTokensTest.java
@@ -0,0 +1,77 @@
+package com.mopub.common;
+
+import android.app.Activity;
+import android.content.Context;
+
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.verify;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+public class AdvancedBiddingTokensTest {
+
+    private Context context;
+    private AdvancedBiddingTokens subject;
+    private SdkInitializationListener mockInitializationListener;
+
+    @Before
+    public void setup() {
+        context = Robolectric.buildActivity(Activity.class).create().get();
+        mockInitializationListener = mock(SdkInitializationListenerMockClass.class);
+        subject = new AdvancedBiddingTokens(mockInitializationListener);
+
+    }
+
+    @Test
+    public void addAdvancedBidders_getTokensAsJsonString_withAdvancedBiddingClass_shouldAddOneMoPubAdvancedBidder() throws Exception {
+        List<Class<? extends MoPubAdvancedBidder>> list = new ArrayList<>();
+        list.add(AdvancedBiddingTokensAdvancedBidder.class);
+
+        subject.addAdvancedBidders(list);
+
+        assertThat(subject.getTokensAsJsonString(context)).isEqualTo(
+                "{\"AdvancedBiddingTokensTest\":{\"token\":\"AdvancedBiddingTokensToken\"}}");
+        verify(mockInitializationListener).onInitializationFinished();
+    }
+
+    @Test
+    public void addAdvancedBidder_getTokensAsJsonString_withNoAdvancedBidders_shouldReturnNull() throws Exception {
+        List<Class<? extends MoPubAdvancedBidder>> list = new ArrayList<>();
+
+        subject.addAdvancedBidders(list);
+
+        assertThat(subject.getTokensAsJsonString(context)).isNull();
+        verify(mockInitializationListener).onInitializationFinished();
+    }
+
+    private static class AdvancedBiddingTokensAdvancedBidder implements MoPubAdvancedBidder {
+
+        @Override
+        public String getToken(final Context context) {
+            return "AdvancedBiddingTokensToken";
+        }
+
+        @Override
+        public String getCreativeNetworkName() {
+            return "AdvancedBiddingTokensTest";
+        }
+    }
+
+    // Creating extra class to prevent roboelectric cache conflict with
+    // MoPub.initializeSdk_withCallbackSet_shouldCallCallback
+    private abstract class SdkInitializationListenerMockClass implements SdkInitializationListener{};
+
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/BrowserWebViewClientTest.java b/mopub-sdk/src/test/java/com/mopub/common/BrowserWebViewClientTest.java
index a9f91333..d0b8e502 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/BrowserWebViewClientTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/BrowserWebViewClientTest.java
@@ -15,7 +15,6 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
-import org.robolectric.RuntimeEnvironment;
 import org.robolectric.annotation.Config;
 
 import static org.fest.assertions.api.Assertions.assertThat;
@@ -26,6 +25,7 @@
 import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -97,7 +97,7 @@ public void shouldOverrideUrlLoading_withDeeplinkPlusUrl_withSuccessfulPrimaryUr
     @Test
     public void shouldOverrideUrlLoading_withDeeplinkPlusUrl_withFailedPrimaryUrl_withHTTPFallbackUrl_shouldReturnTrue_shouldLoadFallbackUrl_shouldNotFinish() {
         final String primaryUrl = "missingApp://somePath";
-        final String fallbackUrl = "https://twitter.com/";
+        final String fallbackUrl = "https://mobile.twitter.com/";
         final String url = "deeplink+://navigate?primaryUrl=" + Uri.encode(primaryUrl)
                 + "&fallbackUrl=" + Uri.encode(fallbackUrl);
 
@@ -171,7 +171,7 @@ public void shouldOverrideUrlLoading_withoutMatchingSupporedUrl_shouldReturnFals
     }
 
     private void makeDeeplinkResolvable(String deeplink) {
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW,
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW,
                 Uri.parse(deeplink)), new ResolveInfo());
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/ClientMetadataTest.java b/mopub-sdk/src/test/java/com/mopub/common/ClientMetadataTest.java
index 9f1ef0b6..45e8ae8b 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/ClientMetadataTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/ClientMetadataTest.java
@@ -6,9 +6,12 @@
 import android.provider.Settings;
 import android.telephony.TelephonyManager;
 
+import com.mopub.common.privacy.MoPubIdentifierTest;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BuildConfig;
 import com.mopub.mobileads.test.support.MoPubShadowTelephonyManager;
+import com.mopub.common.util.Reflection;
 
 import org.junit.After;
 import org.junit.Before;
@@ -21,14 +24,17 @@
 
 import static android.Manifest.permission.ACCESS_NETWORK_STATE;
 import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class,
         shadows = {MoPubShadowTelephonyManager.class})
 public class ClientMetadataTest {
 
-    public Activity activityContext;
+    private Activity activityContext;
     private MoPubShadowTelephonyManager shadowTelephonyManager;
+    private PersonalInfoManager mockPersonalInfoManager;
 
     @Before
     public void setUp() throws Exception {
@@ -36,10 +42,13 @@ public void setUp() throws Exception {
         Shadows.shadowOf(activityContext).grantPermissions(ACCESS_NETWORK_STATE);
         shadowTelephonyManager = (MoPubShadowTelephonyManager)
                 Shadows.shadowOf((TelephonyManager) activityContext.getSystemService(Context.TELEPHONY_SERVICE));
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(activityContext, false);
     }
 
     @After
-    public void tearDown() throws Exception {
+    public void tearDown() {
+        MoPubIdentifierTest.clearPreferences(activityContext);
         ContentResolver resolver = RuntimeEnvironment.application.getContentResolver();
         Settings.Secure.putString(resolver, "limit_ad_tracking", null);
         Settings.Secure.putString(resolver, "advertising_id", null);
@@ -67,78 +76,42 @@ public void getWithoutContextAfterInit_shouldReturnInstance() {
     }
 
     @Test
-    public void testCachedData_shouldBeAvailable() {
+    public void testCachedData_shouldBeAvailable() throws Exception {
         shadowTelephonyManager.setNetworkOperatorName("testNetworkOperatorName");
         shadowTelephonyManager.setNetworkOperator("testNetworkOperator");
         shadowTelephonyManager.setNetworkCountryIso("1");
         shadowTelephonyManager.setSimCountryIso("1");
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+            .setStatic(MoPub.class)
+            .setAccessible()
+            .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+            .execute();
+
         final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
         // Telephony manager data.
         assertThat(clientMetadata.getNetworkOperatorForUrl()).isEqualTo("testNetworkOperator");
         assertThat(clientMetadata.getNetworkOperatorName()).isEqualTo("testNetworkOperatorName");
         assertThat(clientMetadata.getIsoCountryCode()).isEqualTo("1");
-
-        // Other cached data.
-        assertThat(clientMetadata.getDeviceId()).isNotNull().isNotEmpty();
-    }
-
-    @Test
-    public void constructor_onAmazonDevice_shouldSetAmazonAdvertisingInfo() {
-        ContentResolver resolver = RuntimeEnvironment.application.getContentResolver();
-        Settings.Secure.putInt(resolver, "limit_ad_tracking", 1);
-        Settings.Secure.putString(resolver, "advertising_id", "this-is-an-ifa");
-
-        final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
-
-        assertThat(clientMetadata.getDeviceId()).isEqualTo("ifa:this-is-an-ifa");
-        assertThat(clientMetadata.isDoNotTrackSet()).isTrue();
-        assertThat(clientMetadata.isAdvertisingInfoSet()).isTrue();
-    }
-
-    @Test
-    public void constructor_onNonAmazonDevice_shouldSetSha() {
-        final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
-
-        assertThat(clientMetadata.getDeviceId()).startsWith("sha:");
-        assertThat(clientMetadata.isDoNotTrackSet()).isFalse();
-        assertThat(clientMetadata.isAdvertisingInfoSet()).isFalse();
-    }
-
-    @Test
-    public void constructor_onAmazonDevice_withoutLimitAdTracking_shouldSetSha() {
-        ContentResolver resolver = RuntimeEnvironment.application.getContentResolver();
-        Settings.Secure.putString(resolver, "advertising_id", "this-is-an-ifa");
-
-        final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
-
-        assertThat(clientMetadata.getDeviceId()).startsWith("sha:");
-        assertThat(clientMetadata.isDoNotTrackSet()).isFalse();
-        assertThat(clientMetadata.isAdvertisingInfoSet()).isFalse();
     }
 
     @Test
-    public void constructor_onAmazonDevice_withoutAdvertisingId_shouldSetSha() {
-        ContentResolver resolver = RuntimeEnvironment.application.getContentResolver();
-        Settings.Secure.putInt(resolver, "limit_ad_tracking", 1);
-
-        final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
-
-        assertThat(clientMetadata.getDeviceId()).startsWith("sha:");
-        assertThat(clientMetadata.isDoNotTrackSet()).isFalse();
-        assertThat(clientMetadata.isAdvertisingInfoSet()).isFalse();
-    }
+    public void testCachedData_shouldNotBeAvailableWhenConsentIsFalse() throws Exception {
+        shadowTelephonyManager.setNetworkOperatorName("testNetworkOperatorName");
+        shadowTelephonyManager.setNetworkOperator("testNetworkOperator");
+        shadowTelephonyManager.setNetworkCountryIso("1");
+        shadowTelephonyManager.setSimCountryIso("1");
 
-    @Test
-    public void constructor_onAmazonDevice_withEmptyAdvertisingId_shouldSetSha() {
-        ContentResolver resolver = RuntimeEnvironment.application.getContentResolver();
-        Settings.Secure.putInt(resolver, "limit_ad_tracking", 1);
-        Settings.Secure.putString(resolver, "advertising_id", "");
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
 
         final ClientMetadata clientMetadata = ClientMetadata.getInstance(activityContext);
-
-        assertThat(clientMetadata.getDeviceId()).startsWith("sha:");
-        assertThat(clientMetadata.isDoNotTrackSet()).isFalse();
-        assertThat(clientMetadata.isAdvertisingInfoSet()).isFalse();
+        // Telephony manager data.
+        assertThat(clientMetadata.getIsoCountryCode()).isEqualTo("");
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/DownloadResponseTest.java b/mopub-sdk/src/test/java/com/mopub/common/DownloadResponseTest.java
deleted file mode 100644
index 93256457..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/DownloadResponseTest.java
+++ /dev/null
@@ -1,72 +0,0 @@
-package com.mopub.common;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.common.util.ResponseHeader;
-import com.mopub.mobileads.BuildConfig;
-import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
-
-import org.apache.http.HttpResponse;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.robolectric.annotation.Config;
-
-import java.util.Locale;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.junit.Assert.assertArrayEquals;
-import static org.junit.Assert.assertEquals;
-import static org.junit.Assert.assertNull;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class DownloadResponseTest {
-
-    DownloadResponse subject;
-    TestHttpResponseWithHeaders testHttpResponse;
-
-    @Before
-    public void setup() throws Exception {
-        testHttpResponse = new TestHttpResponseWithHeaders(200, "abcde".getBytes());
-        testHttpResponse.addHeader(ResponseHeader.CUSTOM_EVENT_NAME.getKey(), "testCustomEvent");
-        testHttpResponse.addHeader(ResponseHeader.CLICK_TRACKING_URL.getKey().toLowerCase(Locale.US), "https://example.com/");
-        testHttpResponse.addHeader(ResponseHeader.FAIL_URL.getKey().toUpperCase(Locale.US), "https://mopub.com/");
-        subject = new DownloadResponse(testHttpResponse);
-    }
-
-    @Test
-    public void constructor_withNullHttpEntity_shouldNotThrowNullPointerException() throws Exception {
-        HttpResponse mockHttpResponse = mock(HttpResponse.class);
-        when(mockHttpResponse.getEntity()).thenReturn(null);
-        when(mockHttpResponse.getStatusLine()).thenReturn(testHttpResponse.new TestStatusLine());
-
-        DownloadResponse downloadResponse = new DownloadResponse(mockHttpResponse);
-        assertThat(downloadResponse.getContentLength()).isEqualTo(0);
-        assertThat(downloadResponse.getByteArray()).isEmpty();
-    }
-
-    @Test
-    public void testGetByteArray() throws Exception {
-        assertArrayEquals("abcde".getBytes(), subject.getByteArray());
-    }
-
-    @Test
-    public void testGetStatusCode() throws Exception {
-        assertEquals(200, subject.getStatusCode());
-    }
-
-    @Test
-    public void testGetContentLength() throws Exception {
-        assertEquals("abcde".getBytes().length, subject.getContentLength());
-    }
-
-    @Test
-    public void testGetFirstHeader_caseInsensitive() throws Exception {
-        assertEquals("testCustomEvent", subject.getFirstHeader(ResponseHeader.CUSTOM_EVENT_NAME));
-        assertEquals("https://example.com/", subject.getFirstHeader(ResponseHeader.CLICK_TRACKING_URL));
-        assertEquals("https://mopub.com/", subject.getFirstHeader(ResponseHeader.FAIL_URL));
-        assertNull(subject.getFirstHeader(ResponseHeader.CUSTOM_EVENT_DATA));
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java b/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java
index a54830ea..9d114c35 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/GpsHelperTest.java
@@ -119,114 +119,6 @@ public void fetchAdvertisingInfoAsync_whenGooglePlayServicesIsLinked_shouldInvok
         assertThat(gpsHelperListenerCallbackLooper).isEqualTo(Looper.getMainLooper());
     }
 
-    @Test
-    public void fetchAdvertisingInfoAsync_whenGooglePlayServicesIsLinked_shouldPopulateClientMetadata() throws Exception {
-        verifyCleanClientMetadata(context);
-        GpsHelper.setClassNamesForTesting();
-        when(methodBuilder.execute()).thenReturn(
-                GpsHelper.GOOGLE_PLAY_SUCCESS_CODE,
-                adInfo,
-                adInfo.mAdId,
-                adInfo.mLimitAdTrackingEnabled
-        );
-
-        GpsHelper.fetchAdvertisingInfoAsync(context, semaphoreGpsHelperListener);
-        safeAcquireSemaphore();
-        verifyClientMetadata(context, adInfo);
-    }
-
-    @Test
-    public void fetchAdvertisingInfoAsync_whenReflectedMethodCallThrows_shouldNotPopulateClientMetadata() throws Exception {
-        verifyCleanClientMetadata(context);
-        GpsHelper.setClassNamesForTesting();
-        when(methodBuilder.execute()).thenThrow(new Exception());
-
-        GpsHelper.fetchAdvertisingInfoAsync(context, semaphoreGpsHelperListener);
-        safeAcquireSemaphore();
-        verifyCleanClientMetadata(context);
-    }
-
-    @Test
-    public void fetchAdvertisingInfoAsync_whenReflectedMethodCallReturnsNull_shouldNotPopulateClientMetadata() throws Exception {
-        verifyCleanClientMetadata(context);
-        GpsHelper.setClassNamesForTesting();
-        when(methodBuilder.execute()).thenReturn(null);
-
-        GpsHelper.fetchAdvertisingInfoAsync(context, semaphoreGpsHelperListener);
-        safeAcquireSemaphore();
-        verifyCleanClientMetadata(context);
-    }
-
-    @Test
-    public void fetchAdvertisingInfoAsync_whenGooglePlayServicesIsLinkedAndClientMetadataIsClean_shouldPopulateClientMetadata() throws Exception {
-        verifyCleanClientMetadata(context);
-        GpsHelper.setClassNamesForTesting();
-        when(methodBuilder.execute()).thenReturn(
-                GpsHelper.GOOGLE_PLAY_SUCCESS_CODE,
-                adInfo,
-                adInfo.mAdId,
-                adInfo.mLimitAdTrackingEnabled
-        );
-
-        GpsHelper.fetchAdvertisingInfoAsync(context, semaphoreGpsHelperListener);
-        safeAcquireSemaphore();
-        verifyClientMetadata(context, adInfo);
-    }
-
-    @Test
-    public void fetchAdvertisingInfoAsync_whenGooglePlayServicesLinkedAndClientMetadataIsPopulated_shouldRePopulateClientMetadata() throws Exception {
-        verifyCleanClientMetadata(context);
-        populateAndVerifyClientMetadata(context, adInfo);
-        adInfo.mLimitAdTrackingEnabled = false;
-        GpsHelper.setClassNamesForTesting();
-        when(methodBuilder.execute()).thenReturn(
-                GpsHelper.GOOGLE_PLAY_SUCCESS_CODE,
-                adInfo,
-                adInfo.mAdId,
-                adInfo.mLimitAdTrackingEnabled
-        );
-
-        GpsHelper.fetchAdvertisingInfoAsync(context, semaphoreGpsHelperListener);
-        safeAcquireSemaphore();
-        verifyClientMetadata(context, adInfo);
-    }
-
-    @Test
-    public void fetchAdvertisingInfoAsync_whenGooglePlayServicesIsNotLinked_shouldNotPopulateClientMetadata() throws Exception {
-        verifyCleanClientMetadata(context);
-        GpsHelper.setClassNamesForTesting();
-        when(methodBuilder.execute()).thenReturn(
-                GpsHelper.GOOGLE_PLAY_SUCCESS_CODE + 1
-        );
-
-        GpsHelper.fetchAdvertisingInfoAsync(context, semaphoreGpsHelperListener);
-        safeAcquireSemaphore();
-        verifyCleanClientMetadata(context);
-    }
-
-    @Test
-    public void isClientMetadataPopulated_whenContainsAdvertisingIdKeyAndIsLimitAdTrackingEnabledKey_shouldReturnTrue() throws Exception {
-        verifyCleanClientMetadata(context);
-        populateAndVerifyClientMetadata(context, adInfo);
-        assertThat(GpsHelper.isClientMetadataPopulated(context)).isTrue();
-    }
-
-    @Test
-    public void isClientMetadataPopulated_whenClean_shouldReturnFalse() throws Exception {
-        verifyCleanClientMetadata(context);
-        assertThat(GpsHelper.isClientMetadataPopulated(context)).isFalse();
-    }
-
-    @Test
-    public void updateClientMetadata_whenPassingInValidAdInfoObject_shouldUpdateClientMetadata() throws Exception {
-        // Use the real MethodBuilderFactory for this test, not the mock one
-        // Most mocks are set by default in SdkTestRunner setup
-        MethodBuilderFactory.setInstance(new MethodBuilderFactory());
-        verifyCleanClientMetadata(context);
-        GpsHelper.updateClientMetadata(context, adInfo);
-        verifyClientMetadata(context, adInfo);
-    }
-
     @Test
     public void reflectedGetIsLimitAdTrackingEnabled_whenIsLimitAdTrackingEnabledIsSet_shouldReturnIsLimitAdTrackingEnabled() throws Exception {
         MethodBuilderFactory.setInstance(new MethodBuilderFactory());
@@ -290,27 +182,10 @@ public void isLimitAdTrackingEnabled_whenGooglePlayServicesIsNotLinked_shouldRet
         assertThat(GpsHelper.isLimitAdTrackingEnabled(context)).isFalse();
     }
 
-    static public void populateAndVerifyClientMetadata(Context context, TestAdInfo adInfo) {
-        ClientMetadata clientMetadata = ClientMetadata.getInstance(context);
-        clientMetadata.setAdvertisingInfo(adInfo.getId(), adInfo.isLimitAdTrackingEnabled());
-        verifyClientMetadata(context, adInfo);
-    }
-
     private void safeAcquireSemaphore() throws Exception {
         Robolectric.getBackgroundThreadScheduler().advanceBy(0);
         ShadowLooper.runUiThreadTasks();
         semaphore.acquire();
     }
-
-    static public void verifyClientMetadata(Context context, TestAdInfo adInfo) {
-        ClientMetadata clientMetadata = ClientMetadata.getInstance(context);
-        assertThat(clientMetadata.getDeviceId()).isEqualTo("ifa:" + adInfo.getId());
-        assertThat(clientMetadata.isDoNotTrackSet()).isEqualTo(adInfo.isLimitAdTrackingEnabled());
-    }
-
-    static public void verifyCleanClientMetadata(Context context) {
-        ClientMetadata clientMetadata = ClientMetadata.getInstance(context);
-        assertThat(clientMetadata.isAdvertisingInfoSet()).isFalse();
-    }
 }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/common/HttpResponsesTest.java b/mopub-sdk/src/test/java/com/mopub/common/HttpResponsesTest.java
deleted file mode 100644
index 0d8ee5d9..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/HttpResponsesTest.java
+++ /dev/null
@@ -1,138 +0,0 @@
-package com.mopub.common;
-
-import android.graphics.Bitmap;
-
-import org.json.JSONArray;
-import org.json.JSONObject;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.robolectric.RobolectricTestRunner;
-import org.robolectric.Shadows;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.when;
-
-@RunWith(RobolectricTestRunner.class)
-public class HttpResponsesTest {
-
-    private DownloadResponse downloadResponse1;
-
-    @Before
-    public void setUp() throws Exception {
-        downloadResponse1 = mock(DownloadResponse.class);
-    }
-
-    @Test
-    public void asBitmap_shouldReturnBitmap() throws Exception {
-        String imageData = "fake_bitmap_data";
-        when(downloadResponse1.getByteArray()).thenReturn(imageData.getBytes());
-
-        final Bitmap bitmap = HttpResponses.asBitmap(downloadResponse1);
-
-        assertThat(bitmap).isNotNull();
-        assertThat(bitmap).isInstanceOf(Bitmap.class);
-        assertThat(Shadows.shadowOf(bitmap).getCreatedFromBytes()).isEqualTo(imageData.getBytes());
-    }
-
-    @Test
-    public void asJsonObject_withEmptyJsonString_shouldReturnEmptyJsonObjectAndCloseStream() throws Exception {
-        String jsonData = "{}";
-        when(downloadResponse1.getByteArray()).thenReturn(jsonData.getBytes());
-
-        final JSONObject expectedJsonObject = new JSONObject();
-
-        final JSONObject actualJsonObject = HttpResponses.asJsonObject(downloadResponse1);
-
-        assertThat(actualJsonObject).isEqualsToByComparingFields(expectedJsonObject);
-    }
-
-    @Test
-    public void asJsonObject_withShallowJsonString_shouldReturnPopulatedJsonObjectAndCloseStream() throws Exception {
-        String jsonData = "{\"key1\":\"value1\",\"key2\":\"2\",\"key3\":\"null\"}";
-        when(downloadResponse1.getByteArray()).thenReturn(jsonData.getBytes());
-
-        JSONObject expectedJsonObject = new JSONObject();
-        expectedJsonObject.put("key1", "value1");
-        expectedJsonObject.put("key2", 2);
-        expectedJsonObject.put("key3", JSONObject.NULL);
-
-        final JSONObject actualJsonObject = HttpResponses.asJsonObject(downloadResponse1);
-
-        assertThat(actualJsonObject).isEqualsToByComparingFields(expectedJsonObject);
-    }
-
-    @Test
-    public void asJsonObject_withDeepJsonString_shouldReturnPopulatedJsonObjectAndCloseStream() throws Exception {
-        String jsonData = "{\"key1\":\"value1\",\"key2\":[\"a\",\"b\"]}";
-        when(downloadResponse1.getByteArray()).thenReturn(jsonData.getBytes());
-
-        JSONObject expectedJsonObject = new JSONObject();
-        expectedJsonObject.put("key1", "value1");
-        final JSONArray jsonArray = new JSONArray();
-        jsonArray.put("a");
-        jsonArray.put("b");
-        expectedJsonObject.put("key2", jsonArray);
-
-        final JSONObject actualJsonObject = HttpResponses.asJsonObject(downloadResponse1);
-
-        assertThat(actualJsonObject).isEqualsToByComparingFields(expectedJsonObject);
-    }
-
-    @Test
-    public void asJsonObject_withMalformedJsonString_shouldReturnNullAndCloseStream() throws Exception {
-        String jsonData = "{whoops, forgot closing brace";
-        when(downloadResponse1.getByteArray()).thenReturn(jsonData.getBytes());
-
-        final JSONObject jsonObject = HttpResponses.asJsonObject(downloadResponse1);
-
-        assertThat(jsonObject).isNull();
-    }
-
-    @Test
-    public void asJsonObject_asResponseStringReturnsNull_shouldReturnNull() throws Exception {
-        when(downloadResponse1.getByteArray()).thenReturn(null);
-        assertThat(HttpResponses.asJsonObject(downloadResponse1)).isNull();
-    }
-
-    @Test
-    public void asJsonObject_withNullResponse_shouldReturnNull() throws Exception {
-        final JSONObject jsonObject = HttpResponses.asJsonObject(null);
-
-        assertThat(jsonObject).isNull();
-    }
-
-    @Test
-    public void asResponseString_withMultipleLines_shouldReturnResponseAndCloseStream() throws Exception {
-        String responseData = "1\n2\n3\n4";
-        when(downloadResponse1.getByteArray()).thenReturn(responseData.getBytes());
-
-        final String responseString = HttpResponses.asResponseString(downloadResponse1);
-
-        assertThat(responseString).isEqualTo(responseData);
-    }
-
-    @Test
-    public void asResponseString_shouldReturnResponseAndCloseStream() throws Exception {
-        String responseData = "response_string";
-        when(downloadResponse1.getByteArray()).thenReturn(responseData.getBytes());
-
-        final String responseString = HttpResponses.asResponseString(downloadResponse1);
-
-        assertThat(responseString).isEqualTo(responseData);
-    }
-
-    @Test
-    public void asResponseString_newStringThrowsException_shouldReturnNull() throws Exception {
-        when(downloadResponse1.getByteArray()).thenReturn(null);
-        assertThat(HttpResponses.asResponseString(downloadResponse1)).isNull();
-    }
-
-    @Test
-    public void asResponseString_withNullResponse_shouldReturnNull() throws Exception {
-        final String responseString = HttpResponses.asResponseString(null);
-
-        assertThat(responseString).isNull();
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/LocationServiceTest.java b/mopub-sdk/src/test/java/com/mopub/common/LocationServiceTest.java
index 498bac8b..2ae35eba 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/LocationServiceTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/LocationServiceTest.java
@@ -6,7 +6,9 @@
 import android.location.LocationManager;
 import android.os.SystemClock;
 
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Reflection;
 import com.mopub.mobileads.BuildConfig;
 
 import org.junit.After;
@@ -22,6 +24,8 @@
 import static android.Manifest.permission.ACCESS_COARSE_LOCATION;
 import static android.Manifest.permission.ACCESS_FINE_LOCATION;
 import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.when;
 import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
@@ -32,6 +36,7 @@
     private Location gpsLocation;
     private Location cachedLocation;
     private ShadowLocationManager shadowLocationManager;
+    private PersonalInfoManager mockPersonalInfoManager;
 
     @Before
     public void setUp() {
@@ -60,6 +65,7 @@ public void setUp() {
                 (LocationManager) RuntimeEnvironment.application.getSystemService(Context.LOCATION_SERVICE));
         shadowLocationManager.setLastKnownLocation(LocationManager.NETWORK_PROVIDER, networkLocation);
         shadowLocationManager.setLastKnownLocation(LocationManager.GPS_PROVIDER, gpsLocation);
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
     }
 
     @After
@@ -79,9 +85,16 @@ public void getLastKnownLocation_withFinePermission_shouldReturnMoreRecentLocati
     }
 
     @Test
-    public void getLastKnownLocation_withFinePermission_withLocationAwarenessTruncated_shouldTruncateLocationLatLon() {
+    public void getLastKnownLocation_withFinePermission_withLocationAwarenessTruncated_shouldTruncateLocationLatLon() throws  Exception{
         Shadows.shadowOf(activity).grantPermissions(ACCESS_FINE_LOCATION);
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         final Location result =
                 LocationService.getLastKnownLocation(activity, 2, MoPub.LocationAwareness.TRUNCATED);
 
@@ -93,8 +106,14 @@ public void getLastKnownLocation_withFinePermission_withLocationAwarenessTruncat
     }
 
     @Test
-    public void getLastKnownLocation_withOnlyCoarsePermission_shouldReturnNetworkLocation() {
+    public void getLastKnownLocation_withOnlyCoarsePermission_shouldReturnNetworkLocation() throws Exception {
         Shadows.shadowOf(activity).grantPermissions(ACCESS_COARSE_LOCATION);
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
 
         final Location result =
                 LocationService.getLastKnownLocation(activity, 10, MoPub.LocationAwareness.NORMAL);
@@ -126,9 +145,16 @@ public void getLastKnownLocation_withNoLocationPermissions_shouldReturnNull() {
     }
 
     @Test
-    public void getLastKnownLocation_withLocationAwarenessDisabled_shouldReturnNull() {
+    public void getLastKnownLocation_withLocationAwarenessDisabled_shouldReturnNull() throws Exception {
         Shadows.shadowOf(activity).grantPermissions(ACCESS_COARSE_LOCATION, ACCESS_FINE_LOCATION);
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+            .setStatic(MoPub.class)
+            .setAccessible()
+            .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+            .execute();
+
         final Location result =
                 LocationService.getLastKnownLocation(activity, 10, MoPub.LocationAwareness.DISABLED);
 
diff --git a/mopub-sdk/src/test/java/com/mopub/common/MoPubTest.java b/mopub-sdk/src/test/java/com/mopub/common/MoPubTest.java
index 27a9597a..8d0a3f25 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/MoPubTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/MoPubTest.java
@@ -1,45 +1,70 @@
 package com.mopub.common;
 
 import android.app.Activity;
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
 
 import com.mopub.common.MoPub.BrowserAgent;
+import com.mopub.common.privacy.SyncRequest;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Reflection;
 import com.mopub.mobileads.BuildConfig;
+import com.mopub.mobileads.CustomEventRewardedVideo;
 import com.mopub.mobileads.MoPubRewardedVideoListener;
 import com.mopub.mobileads.MoPubRewardedVideoManager;
 import com.mopub.mobileads.MoPubRewardedVideos;
+import com.mopub.network.MoPubRequestQueue;
+import com.mopub.network.Networking;
+import com.mopub.network.TrackingRequest;
+import com.mopub.volley.Request;
+import com.mopub.volley.VolleyError;
 
+import org.junit.After;
 import org.junit.Before;
 import org.junit.Rule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.invocation.InvocationOnMock;
+import org.mockito.stubbing.Answer;
 import org.powermock.core.classloader.annotations.PowerMockIgnore;
 import org.powermock.core.classloader.annotations.PrepareForTest;
 import org.powermock.modules.junit4.rule.PowerMockRule;
 import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+
 import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
 import static org.powermock.api.mockito.PowerMockito.mock;
 import static org.powermock.api.mockito.PowerMockito.mockStatic;
 import static org.powermock.api.mockito.PowerMockito.verifyStatic;
-import static org.powermock.api.mockito.PowerMockito.when;
 
 // If you encounter a VerifyError with PowerMock then you need to set Android Studio to use
 // JDK version 7u79 or later. Go to File > Project Structure > [Platform Settings] > SDK to
 // change the JDK version.
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class, sdk = 21)
-@PowerMockIgnore({ "org.mockito.*", "org.robolectric.*", "android.*" })
+@PowerMockIgnore({ "org.mockito.*", "org.robolectric.*", "android.*", "org.json.*", "com.mopub.network.CustomSSLSocketFactory" })
 @PrepareForTest({MoPubRewardedVideoManager.class})
 public class MoPubTest {
 
+    public static final String INIT_ADUNIT = "b195f8dd8ded45fe847ad89ed1d016da";
+
     private Activity mActivity;
     private MediationSettings[] mMediationSettings;
     private String mAdUnitId;
     private MoPubRewardedVideoListener mockRewardedVideoListener;
     private MoPubRewardedVideoManager.RequestParameters mockRequestParameters;
+    private SdkInitializationListener mockInitializationListener;
+    private MoPubRequestQueue mockRequestQueue;
+    private SyncRequest.Listener syncListener;
 
     @Rule
     public PowerMockRule rule = new PowerMockRule();
@@ -52,12 +77,38 @@ public void setup() {
 
         mockRewardedVideoListener = mock(MoPubRewardedVideoListener.class);
         mockRequestParameters = mock(MoPubRewardedVideoManager.RequestParameters.class);
+        mockInitializationListener = org.mockito.Mockito.mock(SdkInitializationListener.class);
+        mockRequestQueue = org.mockito.Mockito.mock(MoPubRequestQueue.class);
+        Networking.setRequestQueueForTesting(mockRequestQueue);
+        when(mockRequestQueue.add(any(Request.class))).then(new Answer<Object>() {
+            @Override
+            public Object answer(final InvocationOnMock invocationOnMock) throws Throwable {
+                Request req = ((Request) invocationOnMock.getArguments()[0]);
+                if (req.getClass().equals(SyncRequest.class)) {
+                    syncListener = (SyncRequest.Listener) req.getErrorListener();
+                    syncListener.onErrorResponse(new VolleyError());
+                    return null;
+                } else if (req.getClass().equals(TrackingRequest.class)) {
+                    return null;
+                } else {
+                    throw new Exception(String.format("Request object added to RequestQueue can " +
+                            "only be of type SyncRequest, " + "saw %s instead.", req.getClass()));
+                }
+            }
+        });
 
         mockStatic(MoPubRewardedVideoManager.class);
 
         MoPub.resetBrowserAgent();
     }
 
+    @After
+    public void tearDown() throws Exception {
+        MoPub.clearAdvancedBidders();
+        MoPub.resetBrowserAgent();
+        ClientMetadata.clearForTesting();
+    }
+
     @Test
     public void setBrowserAgent_withDefaultValue_shouldNotChangeBrowserAgent_shouldSetOverriddenFlag() {
         MoPub.setBrowserAgent(BrowserAgent.IN_APP);
@@ -98,19 +149,78 @@ public void setBrowserAgentFromAdServer_withNullValue_shouldThrowException() {
     }
 
     @Test
-    public void initializeRewardedVideo_withReflection_shouldExist() throws Exception {
-        assertThat(Reflection.getDeclaredMethodWithTraversal(MoPubRewardedVideos.class,
-                "initializeRewardedVideo", Activity.class, MediationSettings[].class)).isNotNull();
+    public void initializeSdk_withRewardedVideo_shouldCallMoPubRewardedVideoManager() throws Exception {
+        MoPub.initializeSdk(mActivity,
+                new SdkConfiguration.Builder(INIT_ADUNIT).build(),
+                mockInitializationListener);
+
+        verify(mockInitializationListener).onInitializationFinished();
+        verifyStatic();
+        MoPubRewardedVideoManager.init(mActivity, mMediationSettings);
     }
 
     @Test
-    public void initializeRewardedVideo_withValidParameters_shouldCallMoPubRewardedVideoManager() throws Exception {
-        MoPub.initializeRewardedVideo(mActivity, mMediationSettings);
+    public void initializeSdk_withRewardedVideo_withMediationSettings_shouldCallMoPubRewardedVideoManager() throws Exception {
+        MoPub.initializeSdk(mActivity,
+                new SdkConfiguration.Builder(INIT_ADUNIT).withMediationSettings(mMediationSettings).build(),
+                mockInitializationListener);
 
+        verify(mockInitializationListener).onInitializationFinished();
         verifyStatic();
         MoPubRewardedVideoManager.init(mActivity, mMediationSettings);
     }
 
+    @Test
+    public void initializeSdk_withRewardedVideo_withNetworksToInit_shouldCallMoPubRewardedVideoManager() throws Exception {
+        List<String> stringClassList = new ArrayList<>();
+        // This class does not extend from CustomEventRewardedVideo
+        stringClassList.add("com.mopub.common.MoPubTest");
+        // This class is one that works.
+        stringClassList.add("com.mopub.common.MoPubTest$TestCustomEventRewardedVideo");
+        // Not a real class, so not added to the list.
+        stringClassList.add("not.a.real.Classname");
+        // This class is two subclasses from CustomEventRewardedVideo, but it should still be added.
+        stringClassList.add("com.mopub.common.MoPubTest$TestInheritedCustomEventRewardedVideo");
+
+        MoPub.initializeSdk(mActivity,
+                new SdkConfiguration.Builder(INIT_ADUNIT)
+                        .withNetworksToInit(stringClassList)
+                        .withMediationSettings(mMediationSettings)
+                        .build(),
+                mockInitializationListener);
+
+        verify(mockInitializationListener).onInitializationFinished();
+        List<Class<? extends CustomEventRewardedVideo>> classList = new ArrayList<>();
+        classList.add(TestCustomEventRewardedVideo.class);
+        classList.add(TestInheritedCustomEventRewardedVideo.class);
+        verifyStatic();
+        MoPubRewardedVideoManager.init(mActivity, mMediationSettings);
+        verifyStatic();
+        MoPubRewardedVideoManager.initNetworks(mActivity, classList);
+    }
+
+    @Test
+    public void initializeSdk_withRewardedVideo_withoutActivity_shouldNotCallMoPubRewardedVideoManager() throws Exception {
+        // Since we can't verifyStatic with 0 times, we expect this to call the rewarded video
+        // manager exactly twice instead of three times since one of the times is with the
+        // application context instead of the activity context.
+        MoPub.initializeSdk(mActivity.getApplication(),
+                new SdkConfiguration.Builder(INIT_ADUNIT).withMediationSettings(
+                        mMediationSettings).build(), mockInitializationListener);
+
+        MoPub.initializeSdk(mActivity,
+                new SdkConfiguration.Builder(INIT_ADUNIT).withMediationSettings(
+                        mMediationSettings).build(), mockInitializationListener);
+
+        MoPub.initializeSdk(mActivity,
+                new SdkConfiguration.Builder(INIT_ADUNIT).withMediationSettings(
+                        mMediationSettings).build(), mockInitializationListener);
+
+        verifyStatic(times(2));
+        MoPubRewardedVideoManager.init(mActivity, mMediationSettings);
+        verify(mockInitializationListener);
+    }
+
     @Test
     public void updateActivity_withReflection_shouldExist() throws Exception {
         assertThat(Reflection.getDeclaredMethodWithTraversal(MoPubRewardedVideoManager.class,
@@ -131,22 +241,6 @@ public void setRewardedVideoListener_withReflection_shouldExist() throws Excepti
                 "setRewardedVideoListener", MoPubRewardedVideoListener.class)).isNotNull();
     }
 
-    @Test
-    public void setRewardedVideoListener_withValidListener_shouldSetMoPubRewardedVideoManagerListener() throws Exception {
-        MoPub.setRewardedVideoListener(mockRewardedVideoListener);
-
-        verifyStatic();
-        MoPubRewardedVideoManager.setVideoListener(mockRewardedVideoListener);
-    }
-
-    @Test
-    public void setRewardedVideoListener_withNullListener_shouldCallMoPubRewardedVideoManagerListenerWithNull() throws Exception {
-        MoPub.setRewardedVideoListener(null);
-
-        verifyStatic();
-        MoPubRewardedVideoManager.setVideoListener(null);
-    }
-
     @Test
     public void loadRewardedVideo_withReflection_shouldExist() throws Exception {
         assertThat(Reflection.getDeclaredMethodWithTraversal(MoPubRewardedVideos.class,
@@ -156,75 +250,126 @@ public void loadRewardedVideo_withReflection_shouldExist() throws Exception {
     }
 
     @Test
-    public void loadRewardedVideo_withTwoNonNullParameters_shouldCallMoPubRewardedVideoManager() throws Exception {
-        MoPub.loadRewardedVideo(mAdUnitId, mMediationSettings);
-
-        verifyStatic();
-        MoPubRewardedVideoManager.loadVideo(mAdUnitId, null, mMediationSettings);
+    public void hasRewardedVideo_withReflection_shouldExist() throws Exception {
+        assertThat(Reflection.getDeclaredMethodWithTraversal(MoPubRewardedVideos.class,
+                "hasRewardedVideo", String.class)).isNotNull();
     }
 
     @Test
-    public void loadRewardedVideo_withTwoParameters_withNullMediationSettings_shouldCallMoPubRewardedVideoManager() throws Exception {
-        MoPub.loadRewardedVideo(mAdUnitId, (MediationSettings[]) null);
+    public void initializeSdk_withOneAdvancedBidder_shouldSetAdvancedBiddingTokens() throws Exception {
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(
+                INIT_ADUNIT).withAdvancedBidder(
+                        AdvancedBidderTestClass.class).build();
 
-        verifyStatic();
-        MoPubRewardedVideoManager.loadVideo(mAdUnitId, null, (MediationSettings[]) null);
+        MoPub.initializeSdk(mActivity, sdkConfiguration, null);
+
+        assertThat(MoPub.getAdvancedBiddingTokensJson(mActivity)).isEqualTo(
+                "{\"AdvancedBidderTestClassName\":{\"token\":\"AdvancedBidderTestClassToken\"}}");
     }
 
     @Test
-    public void loadRewardedVideo_withThreeNonNullParameters_shouldCallMoPubRewardedVideoManager() throws Exception {
-        MoPub.loadRewardedVideo(mAdUnitId, mockRequestParameters, mMediationSettings);
+    public void initializeSdk_withMultipleInitializations_shouldSetAdvancedBiddingTokensOnce() throws Exception {
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder
+                (INIT_ADUNIT).withAdvancedBidder(
+                        AdvancedBidderTestClass.class).build();
 
-        verifyStatic();
-        MoPubRewardedVideoManager.loadVideo(mAdUnitId, mockRequestParameters, mMediationSettings);
-    }
+        MoPub.initializeSdk(mActivity, sdkConfiguration, null);
 
-    @Test
-    public void loadRewardedVideo_withThreeParameters_withNullRequestParameters_shouldCallMoPubRewardedVideoManager() throws Exception {
-        MoPub.loadRewardedVideo(mAdUnitId, null, mMediationSettings);
+        assertThat(MoPub.getAdvancedBiddingTokensJson(mActivity)).isEqualTo(
+                "{\"AdvancedBidderTestClassName\":{\"token\":\"AdvancedBidderTestClassToken\"}}");
 
-        verifyStatic();
-        MoPubRewardedVideoManager.loadVideo(mAdUnitId, null, mMediationSettings);
+        // Attempting to initialize twice
+        sdkConfiguration = new SdkConfiguration.Builder(INIT_ADUNIT)
+                .withAdvancedBidder(SecondAdvancedBidderTestClass.class).build();
+        MoPub.initializeSdk(mActivity, sdkConfiguration, null);
+
+        // This should not do anything, and getAdvancedBiddingTokensJson() should return the
+        // original Advanced Bidder.
+        assertThat(MoPub.getAdvancedBiddingTokensJson(mActivity)).isEqualTo(
+                "{\"AdvancedBidderTestClassName\":{\"token\":\"AdvancedBidderTestClassToken\"}}");
     }
 
     @Test
-    public void loadRewardedVideo_withThreeParameters_withNullRequestParameters_withNullMediationSettings_shouldCallMoPubRewardedVideoManager() throws Exception {
-        MoPub.loadRewardedVideo(mAdUnitId, null, (MediationSettings[]) null);
+    public void initializeSdk_withCallbackSet_shouldCallCallback() throws Exception {
+        MoPub.initializeSdk(mActivity, new SdkConfiguration.Builder(
+                INIT_ADUNIT).build(), mockInitializationListener);
 
-        verifyStatic();
-        MoPubRewardedVideoManager.loadVideo(mAdUnitId, null, (MediationSettings[]) null);
+        verify(mockInitializationListener).onInitializationFinished();
     }
 
-    @Test
-    public void hasRewardedVideo_withReflection_shouldExist() throws Exception {
-        assertThat(Reflection.getDeclaredMethodWithTraversal(MoPubRewardedVideos.class,
-                "hasRewardedVideo", String.class)).isNotNull();
-    }
+    private static class AdvancedBidderTestClass implements MoPubAdvancedBidder {
 
-    @Test
-    public void hasRewardedVideo_withValidAdUnitId_shouldReturnTrue() throws Exception {
-        when(MoPubRewardedVideoManager.hasVideo(mAdUnitId)).thenReturn(true);
+        @Override
+        public String getToken(final Context context) {
+            return "AdvancedBidderTestClassToken";
+        }
 
-        assertThat(MoPub.hasRewardedVideo(mAdUnitId)).isTrue();
+        @Override
+        public String getCreativeNetworkName() {
+            return "AdvancedBidderTestClassName";
+        }
     }
 
-    @Test
-    public void hasRewardedVideo_withInvalidAdUnitId_shouldReturnFalse() throws Exception {
-        assertThat(MoPub.hasRewardedVideo("fakeId")).isFalse();
-    }
+    private static class SecondAdvancedBidderTestClass implements MoPubAdvancedBidder {
 
-    @Test
-    public void showRewardedVideo_withReflection_shouldExist() throws Exception {
-        assertThat(Reflection.getDeclaredMethodWithTraversal(MoPubRewardedVideos.class,
-                "showRewardedVideo", String.class)).isNotNull();
-    }
+        @Override
+        public String getToken(final Context context) {
+            return "SecondAdvancedBidderTestClassToken";
+        }
 
-    @Test
-    public void showRewardedVideo_withNonNullAdUnitId_shouldCallMoPubRewardedVideoManager() throws Exception {
-        MoPub.showRewardedVideo(mAdUnitId);
+        @Override
+        public String getCreativeNetworkName() {
+            return "SecondAdvancedBidderTestClassName";
+        }
+    }
 
-        verifyStatic();
-        MoPubRewardedVideoManager.showVideo(mAdUnitId);
+    private static class TestCustomEventRewardedVideo extends CustomEventRewardedVideo {
+
+        public TestCustomEventRewardedVideo(String param) {
+
+        }
+        @Nullable
+        @Override
+        protected LifecycleListener getLifecycleListener() {
+            return null;
+        }
+
+        @Override
+        protected boolean checkAndInitializeSdk(@NonNull final Activity launcherActivity,
+                @NonNull final Map<String, Object> localExtras,
+                @NonNull final Map<String, String> serverExtras) throws Exception {
+            return false;
+        }
+
+        @Override
+        protected void loadWithSdkInitialized(@NonNull final Activity activity,
+                @NonNull final Map<String, Object> localExtras,
+                @NonNull final Map<String, String> serverExtras) throws Exception {
+        }
+
+        @NonNull
+        @Override
+        protected String getAdNetworkId() {
+            return "";
+        }
+
+        @Override
+        protected void onInvalidate() {
+        }
+
+        @Override
+        protected boolean hasVideoAvailable() {
+            return false;
+        }
+
+        @Override
+        protected void showVideo() {
+        }
     }
 
+    private static class TestInheritedCustomEventRewardedVideo extends TestCustomEventRewardedVideo {
+        public TestInheritedCustomEventRewardedVideo(String param) {
+            super(param);
+        }
+    }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/UrlActionTest.java b/mopub-sdk/src/test/java/com/mopub/common/UrlActionTest.java
index dadf0efa..0331d892 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/UrlActionTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/UrlActionTest.java
@@ -8,6 +8,7 @@
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BuildConfig;
 
+import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -33,6 +34,11 @@ public void setUp() {
         MoPub.resetBrowserAgent();
     }
 
+    @After
+    public void tearDown() {
+        MoPub.resetBrowserAgent();
+    }
+
     @Test
     public void handleMopubScheme_shouldBeCaseInsensitive() throws Exception {
         assertUrlActionMatching(HANDLE_MOPUB_SCHEME, "mopub:", true);
diff --git a/mopub-sdk/src/test/java/com/mopub/common/UrlHandlerTest.java b/mopub-sdk/src/test/java/com/mopub/common/UrlHandlerTest.java
index 909292e8..c4c936aa 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/UrlHandlerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/UrlHandlerTest.java
@@ -17,7 +17,6 @@
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.robolectric.Robolectric;
-import org.robolectric.RuntimeEnvironment;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowApplication;
 
@@ -39,6 +38,7 @@
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.verifyNoMoreInteractions;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -410,7 +410,7 @@ public void urlHandler_withDeeplinkPlus_shouldTriggerPrimaryTracker() {
     public void urlHandler_withDeeplinkPlus_shouldTriggerMultiplePrimaryTrackers() {
         final String primaryUrl = "twitter://timeline";
         final String primaryTracker1 = "https://ads.twitter.com/tracking?pubId=1234&userId=5678";
-        final String primaryTracker2 = "https://ads.mopub.com/tracking?pubId=4321&userId=8765";
+        final String primaryTracker2 = "https://tracker.mopub.com/tracking?pubId=4321&userId=8765";
         final String url = "deeplink+://navigate?primaryUrl=" + Uri.encode(primaryUrl)
                 + "&primaryTrackingUrl=" + Uri.encode(primaryTracker1)
                 + "&primaryTrackingUrl=" + Uri.encode(primaryTracker2);
@@ -451,7 +451,7 @@ public void urlHandler_withDeeplinkPlus_withResolvableFallback_shouldTriggerMult
         final String primaryUrl = "missingApp://somePath";
         final String fallbackUrl = "https://twitter.com";
         final String fallbackTracker1 = "https://ads.twitter.com/tracking?pubId=1234&userId=5678";
-        final String fallbackTracker2 = "https://ads.mopub.com/tracking?pubId=4321&userId=8765";
+        final String fallbackTracker2 = "https://tracker.mopub.com/tracking?pubId=4321&userId=8765";
         final String url = "deeplink+://navigate?primaryUrl=" + Uri.encode(primaryUrl)
                 + "&fallbackUrl=" + Uri.encode(fallbackUrl)
                 + "&fallbackTrackingUrl=" + Uri.encode(fallbackTracker1)
@@ -941,12 +941,12 @@ private void verifyNoStartedActivity() {
     }
 
     private void makeDeeplinkResolvable(String deeplink) {
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW,
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW,
                 Uri.parse(deeplink)), new ResolveInfo());
     }
 
     private void makeIntentUrlResolvable(String intentUrl) throws URISyntaxException {
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(
                 Intent.parseUri(intentUrl, Intent.URI_INTENT_SCHEME), new ResolveInfo());
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/UrlResolutionTaskTest.java b/mopub-sdk/src/test/java/com/mopub/common/UrlResolutionTaskTest.java
index 509175ed..a11feb12 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/UrlResolutionTaskTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/UrlResolutionTaskTest.java
@@ -10,6 +10,7 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
+import org.mockito.internal.matchers.Null;
 import org.robolectric.annotation.Config;
 
 import java.io.IOException;
@@ -35,7 +36,7 @@ public void setUp() throws Exception {
 
     @After
     public void tearDown() {
-        MoPub.setBrowserAgent(MoPub.BrowserAgent.IN_APP);
+        MoPub.resetBrowserAgent();
     }
 
     @Test
@@ -134,12 +135,11 @@ public void resolveRedirectLocation_withResponseCode200_shouldReturnNull() throw
                 .isNull();
     }
 
-    @Test
-    public void resolveRedirectLocation_withoutLocation_shouldReturnNull() throws Exception {
-        setupMockHttpUrlConnection(200, null);
+    @Test(expected = NullPointerException.class)
+    public void resolveRedirectLocation_withResponseCode302_withoutLocation_shouldThrowException() throws Exception {
+        when(mockHttpUrlConnection.getResponseCode()).thenReturn(302);
 
-        assertThat(UrlResolutionTask.resolveRedirectLocation(BASE_URL, mockHttpUrlConnection))
-                .isNull();
+        UrlResolutionTask.resolveRedirectLocation(BASE_URL, mockHttpUrlConnection);
     }
 
     @Test(expected = URISyntaxException.class)
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/BaseEventTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/BaseEventTest.java
deleted file mode 100644
index a5c0d99f..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/BaseEventTest.java
+++ /dev/null
@@ -1,247 +0,0 @@
-package com.mopub.common.event;
-
-import com.mopub.common.ClientMetadata;
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-
-import org.junit.After;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.robolectric.annotation.Config;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class BaseEventTest {
-
-    private BaseEvent subject;
-    @Mock private ClientMetadata mockClientMetaData;
-
-    @Before
-    public void setUp() {
-        when(mockClientMetaData.getSdkVersion()).thenReturn("sdk_version");
-        when(mockClientMetaData.getAppName()).thenReturn("app_name");
-        when(mockClientMetaData.getAppPackageName()).thenReturn("app_package_name");
-        when(mockClientMetaData.getAppVersion()).thenReturn("app_version");
-        when(mockClientMetaData.getDeviceId()).thenReturn("client_device_id");
-        when(mockClientMetaData.isDoNotTrackSet()).thenReturn(true);
-        when(mockClientMetaData.getDeviceManufacturer()).thenReturn("device_manufacturer");
-        when(mockClientMetaData.getDeviceModel()).thenReturn("device_model");
-        when(mockClientMetaData.getDeviceProduct()).thenReturn("device_product");
-        when(mockClientMetaData.getDeviceOsVersion()).thenReturn("device_os_version");
-        when(mockClientMetaData.getDeviceScreenWidthDip()).thenReturn(1337);
-        when(mockClientMetaData.getDeviceScreenHeightDip()).thenReturn(70707);
-        when(mockClientMetaData.getActiveNetworkType()).thenReturn(ClientMetadata.MoPubNetworkType.WIFI);
-        when(mockClientMetaData.getNetworkOperator()).thenReturn("network_operator");
-        when(mockClientMetaData.getNetworkOperatorName()).thenReturn("network_operator_name");
-        when(mockClientMetaData.getIsoCountryCode()).thenReturn("network_iso_country_code");
-        when(mockClientMetaData.getSimOperator()).thenReturn("network_sim_operator");
-        when(mockClientMetaData.getSimOperatorName()).thenReturn("network_sim_operator_name");
-        when(mockClientMetaData.getSimIsoCountryCode()).thenReturn("network_sim_iso_country_code");
-        ClientMetadata.setInstance(mockClientMetaData);
-
-        subject = new Event.Builder(BaseEvent.Name.AD_REQUEST, BaseEvent.Category.REQUESTS, 0.10000123)
-                .withSdkProduct(BaseEvent.SdkProduct.NATIVE)
-                .withAdUnitId("8cf00598d3664adaaeccd800e46afaca")
-                .withAdCreativeId("3c2b887e2c2a4cd0ae6a925440a62f0d")
-                .withAdType("html")
-                .withAdNetworkType("admob")
-                .withAdWidthPx(320.0)
-                .withAdHeightPx(50.0)
-                .withGeoLat(37.7833)
-                .withGeoLon(-122.4183333)
-                .withGeoAccuracy(10.0)
-                .withPerformanceDurationMs(100.0)
-                .withRequestId("b550796074da4559a27c5072dcba2b27")
-                .withRequestStatusCode(200)
-                .withRequestUri("https://ads.mopub.com/m/ad?id=8cf00598d3664adaaeccd800e46afaca")
-                .withRequestRetries(0)
-                .build();
-    }
-
-    @After
-    public void tearDown() {
-        ClientMetadata.setInstance(null);
-    }
-
-    @Test
-    public void ScribeCategory_shouldHaveExpectedValues() throws Exception {
-        // We're testing this since our backend data definitions depend on these values matching
-        assertThat(BaseEvent.ScribeCategory.EXCHANGE_CLIENT_EVENT.getCategory())
-                .isEqualTo("exchange_client_event");
-        assertThat(BaseEvent.ScribeCategory.EXCHANGE_CLIENT_ERROR.getCategory())
-                .isEqualTo("exchange_client_error");
-    }
-
-    @Test
-    public void SdkProduct_shouldHaveExpectedValues() throws Exception {
-        // We're testing this since our backend data definitions depend on these values matching
-        assertThat(BaseEvent.SdkProduct.NONE.getType())
-                .isEqualTo(0);
-        assertThat(BaseEvent.SdkProduct.WEB_VIEW.getType())
-                .isEqualTo(1);
-        assertThat(BaseEvent.SdkProduct.NATIVE.getType())
-                .isEqualTo(2);
-    }
-
-    @Test
-    public void AppPlatform_shouldHaveExpectedValues() throws Exception {
-        // We're testing this since our backend data definitions depend on these values matching
-        assertThat(BaseEvent.AppPlatform.NONE.getType())
-                .isEqualTo(0);
-        assertThat(BaseEvent.AppPlatform.IOS.getType())
-                .isEqualTo(1);
-        assertThat(BaseEvent.AppPlatform.ANDROID.getType())
-                .isEqualTo(2);
-        assertThat(BaseEvent.AppPlatform.MOBILE_WEB.getType())
-                .isEqualTo(3);
-    }
-
-    @Test
-    public void Name_shouldHaveExpectedValues() throws Exception {
-        // We're testing this since our backend data definitions depend on these values matching
-        assertThat(BaseEvent.Name.AD_REQUEST.getName())
-                .isEqualTo("ad_request");
-        assertThat(BaseEvent.Name.IMPRESSION_REQUEST.getName())
-                .isEqualTo("impression_request");
-        assertThat(BaseEvent.Name.CLICK_REQUEST.getName())
-                .isEqualTo("click_request");
-    }
-
-    @Test
-    public void Category_shouldHaveExpectedValues() throws Exception {
-        // We're testing this since our backend data definitions depend on these values matching
-        assertThat(BaseEvent.Category.REQUESTS.getCategory())
-                .isEqualTo("requests");
-    }
-
-    @Test
-    public void SamplingRate_shouldHaveExpectedValues() throws Exception {
-        // We're testing this since our backend data definitions depend on these values matching
-        assertThat(BaseEvent.SamplingRate.AD_REQUEST.getSamplingRate()).isEqualTo(0.1);
-    }
-
-    @Test
-    public void constructor_shouldCorrectlyAssignFieldsFromBuilder() throws Exception {
-        assertThat(subject.getSdkProduct()).isEqualTo(BaseEvent.SdkProduct.NATIVE);
-        assertThat(subject.getAdUnitId()).isEqualTo("8cf00598d3664adaaeccd800e46afaca");
-        assertThat(subject.getAdCreativeId()).isEqualTo("3c2b887e2c2a4cd0ae6a925440a62f0d");
-        assertThat(subject.getAdType()).isEqualTo("html");
-        assertThat(subject.getAdNetworkType()).isEqualTo("admob");
-        assertThat(subject.getAdWidthPx()).isEqualTo(320.0);
-        assertThat(subject.getAdHeightPx()).isEqualTo(50.0);
-        assertThat(subject.getGeoLat()).isEqualTo(37.7833);
-        assertThat(subject.getGeoLon()).isEqualTo(-122.4183333);
-        assertThat(subject.getGeoAccuracy()).isEqualTo(10.0);
-        assertThat(subject.getPerformanceDurationMs()).isEqualTo(100.0);
-        assertThat(subject.getRequestId()).isEqualTo("b550796074da4559a27c5072dcba2b27");
-        assertThat(subject.getRequestStatusCode()).isEqualTo(200);
-        assertThat(subject.getRequestUri()).isEqualTo("https://ads.mopub.com/m/ad?id=8cf00598d3664adaaeccd800e46afaca");
-        assertThat(subject.getRequestRetries()).isEqualTo(0);
-        assertThat(subject.getSamplingRate()).isEqualTo(0.10000123);
-    }
-
-    @Test
-    public void getSdkVersion_shouldReturnClientMetaDataSdkVersion() throws Exception {
-        assertThat(subject.getSdkVersion()).isEqualTo("sdk_version");
-    }
-
-    @Test
-    public void getAppName_shouldReturnClientMetaDataAppName() throws Exception {
-        assertThat(subject.getAppName()).isEqualTo("app_name");
-    }
-
-    @Test
-    public void getAppPackageName_shouldReturnClientMetaDataAppPackageName() throws Exception {
-        assertThat(subject.getAppPackageName()).isEqualTo("app_package_name");
-    }
-
-    @Test
-    public void getAppVersion_shouldReturnClientMetaDataAppVersion() throws Exception {
-        assertThat(subject.getAppVersion()).isEqualTo("app_version");
-    }
-
-    @Test
-    public void getClientAdvertisingId_shouldReturnClientMetaDataDeviceId() throws Exception {
-        assertThat(subject.getClientAdvertisingId()).isEqualTo("client_device_id");
-    }
-
-    @Test
-    public void getObfuscatedClientAdvertisingId_shouldReturnObfuscatedDeviceId() throws Exception {
-        assertThat(subject.getObfuscatedClientAdvertisingId()).isEqualTo("ifa:XXXX");
-    }
-
-    @Test
-    public void getClientDoNotTrack_shouldReturnClientMetaDataDoNotTrack() throws Exception {
-        assertThat(subject.getClientDoNotTrack()).isEqualTo(true);
-    }
-
-    @Test
-    public void getDeviceManufacturer_shouldReturnClientMetaDataDeviceManufacturer() throws Exception {
-        assertThat(subject.getDeviceManufacturer()).isEqualTo("device_manufacturer");
-    }
-
-    @Test
-    public void getDeviceModel_shouldReturnClientMetaDataDeviceModel() throws Exception {
-        assertThat(subject.getDeviceModel()).isEqualTo("device_model");
-    }
-
-    @Test
-    public void getDeviceProduct_shouldReturnClientMetaDataDeviceProduct() throws Exception {
-        assertThat(subject.getDeviceProduct()).isEqualTo("device_product");
-    }
-
-    @Test
-    public void getDeviceOsVersion_shouldReturnClientMetaDataDeviceOsVersion() throws Exception {
-        assertThat(subject.getDeviceOsVersion()).isEqualTo("device_os_version");
-    }
-
-    @Test
-    public void getDeviceScreenWidthDip_shouldReturnClientMetaDataDeviceScreenWidthDip() throws Exception {
-        assertThat(subject.getDeviceScreenWidthDip()).isEqualTo(1337);
-    }
-
-    @Test
-    public void getDeviceScreenHeightDip_shouldReturnClientMetaDataDeviceScreenHeightDip() throws Exception {
-        assertThat(subject.getDeviceScreenHeightDip()).isEqualTo(70707);
-    }
-
-    @Test
-    public void getNetworkType_shouldReturnClientMetaDataActiveNetworkType() throws Exception {
-        assertThat(subject.getNetworkType()).isEqualTo(ClientMetadata.MoPubNetworkType.WIFI);
-    }
-
-    @Test
-    public void getNetworkOperatorCode_shouldReturnClientMetaDataNetworkOperator() throws Exception {
-        assertThat(subject.getNetworkOperatorCode()).isEqualTo("network_operator");
-    }
-
-    @Test
-    public void getNetworkOperatorName_shouldReturnClientMetaDataNetworkOperatorName() throws Exception {
-        assertThat(subject.getNetworkOperatorName()).isEqualTo("network_operator_name");
-    }
-
-    @Test
-    public void getNetworkIsoCountryCode_shouldReturnClientMetaDataNetworkIsoCountryCode() throws Exception {
-        assertThat(subject.getNetworkIsoCountryCode()).isEqualTo("network_iso_country_code");
-    }
-
-    @Test
-    public void getNetworkSimCode_shouldReturnClientMetaDataNetworkSimOperator() throws Exception {
-        assertThat(subject.getNetworkSimCode()).isEqualTo("network_sim_operator");
-    }
-
-    @Test
-    public void getNetworkSimOperatorName_shouldReturnClientMetaDataNetworkSimOperatorName() throws Exception {
-        assertThat(subject.getNetworkSimOperatorName()).isEqualTo("network_sim_operator_name");
-    }
-
-    @Test
-    public void getNetworkSimIsoCountryCode_shouldReturnClientMetaDataNetworkSimIsoCountryCode() throws Exception {
-        assertThat(subject.getNetworkSimIsoCountryCode()).isEqualTo("network_sim_iso_country_code");
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/ErrorEventTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/ErrorEventTest.java
deleted file mode 100644
index 957552b1..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/ErrorEventTest.java
+++ /dev/null
@@ -1,77 +0,0 @@
-package com.mopub.common.event;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.robolectric.annotation.Config;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class ErrorEventTest {
-
-    private ErrorEvent subject;
-
-    @Before
-    public void setUp() {
-        subject = new ErrorEvent.Builder(BaseEvent.Name.AD_REQUEST, BaseEvent.Category.REQUESTS, 0.10000123)
-                .withErrorExceptionClassName("error_exception_class_name")
-                .withErrorMessage("error_message")
-                .withErrorStackTrace("error_stack_trace")
-                .withErrorFileName("error_file_name")
-                .withErrorClassName("error_class_name")
-                .withErrorMethodName("error_method_name")
-                .withErrorLineNumber(123)
-                .build();
-    }
-
-    @Test
-    public void constructor_shouldCorrectlyAssignFieldsFromBuilder() throws Exception {
-        assertThat(subject.getName()).isEqualTo(BaseEvent.Name.AD_REQUEST);
-        assertThat(subject.getCategory()).isEqualTo(BaseEvent.Category.REQUESTS);
-        assertThat(subject.getSamplingRate()).isEqualTo(0.10000123);
-        assertThat(subject.getScribeCategory()).isEqualTo(BaseEvent.ScribeCategory.EXCHANGE_CLIENT_ERROR);
-        assertThat(subject.getErrorExceptionClassName()).isEqualTo("error_exception_class_name");
-        assertThat(subject.getErrorMessage()).isEqualTo("error_message");
-        assertThat(subject.getErrorStackTrace()).isEqualTo("error_stack_trace");
-        assertThat(subject.getErrorFileName()).isEqualTo("error_file_name");
-        assertThat(subject.getErrorClassName()).isEqualTo("error_class_name");
-        assertThat(subject.getErrorMethodName()).isEqualTo("error_method_name");
-        assertThat(subject.getErrorLineNumber()).isEqualTo(123);
-    }
-
-    @Test
-    public void builder_withException_shouldCorrectlyPopulateErrorFields() throws Exception {
-        Exception exception;
-        try {
-            throw new ClassCastException("bad cast");
-        } catch (Exception e)  {
-            exception = e;
-        }
-
-        subject = new ErrorEvent.Builder(BaseEvent.Name.AD_REQUEST, BaseEvent.Category.REQUESTS, 0.10000123)
-                .withException(exception)
-                .build();
-
-        assertThat(subject.getName()).isEqualTo(BaseEvent.Name.AD_REQUEST);
-        assertThat(subject.getCategory()).isEqualTo(BaseEvent.Category.REQUESTS);
-        assertThat(subject.getScribeCategory()).isEqualTo(BaseEvent.ScribeCategory.EXCHANGE_CLIENT_ERROR);
-        assertThat(subject.getErrorExceptionClassName()).isEqualTo("java.lang.ClassCastException");
-        assertThat(subject.getErrorMessage()).isEqualTo("bad cast");
-
-        // We can't reliably check the stack trace since it changes from one run to another
-//        assertThat(subject.getErrorStackTrace()).isEqualTo();
-
-        assertThat(subject.getErrorFileName()).isEqualTo("ErrorEventTest.java");
-        assertThat(subject.getErrorClassName()).isEqualTo("com.mopub.common.event.ErrorEventTest");
-        assertThat(subject.getErrorMethodName()).isEqualTo("builder_withException_shouldCorrectlyPopulateErrorFields");
-
-        // Ideally we check the actual line number here, but since this file is continuously
-        // changing, it makes the test brittle to do so
-        assertThat(subject.getErrorLineNumber()).isNotNull();
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/EventDispatcherTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/EventDispatcherTest.java
deleted file mode 100644
index 9b3fef29..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/EventDispatcherTest.java
+++ /dev/null
@@ -1,67 +0,0 @@
-package com.mopub.common.event;
-
-import android.app.Activity;
-import android.os.HandlerThread;
-import android.os.Looper;
-import android.os.Message;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.robolectric.annotation.Config;
-
-import java.util.ArrayList;
-import java.util.List;
-
-import static org.mockito.Matchers.any;
-import static org.mockito.Matchers.eq;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.never;
-import static org.mockito.Mockito.verify;
-
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class EventDispatcherTest {
-
-    private EventDispatcher subject;
-    private List<EventRecorder> recorders;
-    @Mock private EventRecorder mockEventRecorder1;
-    @Mock private EventRecorder mockEventRecorder2;
-    @Mock private HandlerThread mockHandlerThread;
-
-    @Before
-    public void setUp() {
-        recorders = new ArrayList<EventRecorder>();
-        recorders.add(mockEventRecorder1);
-        recorders.add(mockEventRecorder2);
-    }
-
-    @Test
-    public void handler_handleMessage_shouldCallRecordOnAllRecorders() throws Exception {
-        Message message = new Message();
-        message.obj = mock(Event.class);
-
-        subject = new EventDispatcher(recorders, Looper.getMainLooper());
-        subject.getHandlerCallback().handleMessage(message);
-
-        verify(mockEventRecorder1).record(eq((Event) message.obj));
-        verify(mockEventRecorder2).record(eq((Event) message.obj));
-    }
-
-    @Test
-    public void handler_handleMessage_withNonBaseEventTypeMessageShouldNotRecordOnAnyRecorders() throws Exception {
-        Message message = new Message();
-        message.obj = mock(Activity.class);
-
-        subject = new EventDispatcher(recorders, Looper.getMainLooper());
-        subject.getHandlerCallback().handleMessage(message);
-
-        verify(mockEventRecorder1, never()).record(any(BaseEvent.class));
-        verify(mockEventRecorder2, never()).record(any(BaseEvent.class));
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/EventSamplerTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/EventSamplerTest.java
deleted file mode 100644
index b4b2d15e..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/EventSamplerTest.java
+++ /dev/null
@@ -1,89 +0,0 @@
-package com.mopub.common.event;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.mockito.stubbing.OngoingStubbing;
-import org.robolectric.annotation.Config;
-
-import java.util.Random;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class EventSamplerTest {
-
-    private EventSampler subject;
-    @Mock Random mockRandom;
-    @Mock BaseEvent mockBaseEvent;
-
-    @Before
-    public void setUp() {
-        subject = new EventSampler(mockRandom);
-        when(mockBaseEvent.getSamplingRate()).thenReturn(0.10);
-    }
-
-    @Test
-    public void sample_withRandomNumberLessThan10Percent_shouldReturnTrue() throws Exception {
-        when(mockRandom.nextDouble()).thenReturn(0.09);
-
-        boolean result = subject.sample(mockBaseEvent);
-
-        assertThat(result).isTrue();
-    }
-
-    @Test
-    public void sample_withRandomNumberGreaterOrEqualTo10Percent_shouldReturnFalse() throws Exception {
-        when(mockRandom.nextDouble()).thenReturn(0.10);
-
-        boolean result = subject.sample(mockBaseEvent);
-
-        assertThat(result).isFalse();
-    }
-
-    @Test
-    public void sample_withSameRequestId_shouldReturnSameValueRegardlessOfSampleRate() throws Exception {
-        when(mockRandom.nextDouble()).thenReturn(0.09).thenReturn(0.999);
-        when(mockBaseEvent.getRequestId()).thenReturn("rid");
-
-        boolean firstResult = subject.sample(mockBaseEvent);
-        assertThat(firstResult).isTrue();
-
-        boolean secondResult = subject.sample(mockBaseEvent);
-        assertThat(secondResult).isTrue();
-    }
-
-    @Test
-    public void sample_withDifferentRequestId_shouldReturnResultBasedOnSampleRate() throws Exception {
-        when(mockRandom.nextDouble()).thenReturn(0.09).thenReturn(0.999);
-        when(mockBaseEvent.getRequestId()).thenReturn("rid1").thenReturn("rid2");
-
-        boolean firstResult = subject.sample(mockBaseEvent);
-        assertThat(firstResult).isTrue();
-
-        boolean secondResult = subject.sample(mockBaseEvent);
-        assertThat(secondResult).isFalse();
-    }
-
-    @Test
-    public void sample_withTooManyEvents_shouldHoldAMaximumNumberOfRequestIds() {
-        when(mockRandom.nextDouble()).thenReturn(0.001);
-        OngoingStubbing<String> ongoingStubbing = when(mockBaseEvent.getRequestId()).thenReturn(
-                "rid0");
-        for (int i = 1; i < EventSampler.MAX_SIZE * 3; i++) {
-            ongoingStubbing = ongoingStubbing.thenReturn("rid" + i);
-        }
-
-        for (int i = 0; i < EventSampler.MAX_SIZE * 3; i++) {
-            subject.sample(mockBaseEvent);
-        }
-
-        assertThat(subject.getCacheSize()).isEqualTo(EventSampler.MAX_SIZE);
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/EventSerializerTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/EventSerializerTest.java
deleted file mode 100644
index 34d030ba..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/EventSerializerTest.java
+++ /dev/null
@@ -1,216 +0,0 @@
-package com.mopub.common.event;
-
-import android.app.Activity;
-import android.content.Context;
-
-import com.mopub.common.ClientMetadata;
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-
-import org.json.JSONArray;
-import org.json.JSONObject;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.robolectric.Robolectric;
-import org.robolectric.annotation.Config;
-
-import java.util.ArrayList;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class EventSerializerTest {
-
-    private EventSerializer subject;
-
-    @Mock private Event mockEvent;
-    @Mock private ErrorEvent mockErrorEvent;
-
-    @Before
-    public void setUp() {
-        subject = new EventSerializer();
-
-        // initialize client meta data with context
-        Context context = Robolectric.buildActivity(Activity.class).create().get();
-        ClientMetadata.getInstance(context);
-
-        populateBaseEventFields(mockEvent);
-        populateBaseEventFields(mockErrorEvent);
-
-        when(mockErrorEvent.getErrorExceptionClassName()).thenReturn("error_exception_class_name");
-        when(mockErrorEvent.getErrorMessage()).thenReturn("error_message");
-        when(mockErrorEvent.getErrorStackTrace()).thenReturn("error_stack_trace");
-        when(mockErrorEvent.getErrorFileName()).thenReturn("error_file_name");
-        when(mockErrorEvent.getErrorClassName()).thenReturn("error_class_name");
-        when(mockErrorEvent.getErrorMethodName()).thenReturn("error_method_name");
-        when(mockErrorEvent.getErrorLineNumber()).thenReturn(123);
-    }
-
-    @Test
-    public void serializeAsJson_withAllEventFieldsPopulated_shouldCorrectJsonRepresentation() throws Exception {
-        ArrayList<BaseEvent> events = new ArrayList<BaseEvent>();
-        events.add(mockEvent);
-        JSONArray jsonArray = subject.serializeAsJson(events);
-        assertThat(jsonArray.length()).isEqualTo(1);
-
-        JSONObject jsonObject = jsonArray.getJSONObject(0);
-        validateBaseEventFields(jsonObject);
-    }
-
-    @Test
-    public void serializeAsJson_withAllErrorEventFieldsPopulated_shouldCorrectJsonRepresentation() throws Exception {
-        ArrayList<BaseEvent> events = new ArrayList<BaseEvent>();
-        events.add(mockErrorEvent);
-        JSONArray jsonArray = subject.serializeAsJson(events);
-        assertThat(jsonArray.length()).isEqualTo(1);
-
-        JSONObject jsonObject = jsonArray.getJSONObject(0);
-        validateBaseEventFields(jsonObject);
-
-        assertThat(jsonObject.getString("error_exception_class_name")).isEqualTo("error_exception_class_name");
-        assertThat(jsonObject.getString("error_message")).isEqualTo("error_message");
-        assertThat(jsonObject.getString("error_stack_trace")).isEqualTo("error_stack_trace");
-        assertThat(jsonObject.getString("error_file_name")).isEqualTo("error_file_name");
-        assertThat(jsonObject.getString("error_class_name")).isEqualTo("error_class_name");
-        assertThat(jsonObject.getString("error_method_name")).isEqualTo("error_method_name");
-        assertThat(jsonObject.getInt("error_line_number")).isEqualTo(123);
-    }
-
-    @Test
-    public void serializeAsJson_shouldReturnJsonArrayOfEvents() throws Exception {
-        when(mockEvent.getName()).thenReturn(BaseEvent.Name.AD_REQUEST);
-        when(mockEvent.getCategory()).thenReturn(BaseEvent.Category.REQUESTS);
-        when(mockErrorEvent.getName()).thenReturn(BaseEvent.Name.IMPRESSION_REQUEST);
-        when(mockErrorEvent.getCategory()).thenReturn(BaseEvent.Category.REQUESTS);
-
-        ArrayList<BaseEvent> events = new ArrayList<BaseEvent>();
-        events.add(mockEvent);
-        events.add(mockErrorEvent);
-
-        JSONArray jsonArray = subject.serializeAsJson(events);
-        assertThat(jsonArray.length()).isEqualTo(2);
-
-        JSONObject jsonObject1 = jsonArray.getJSONObject(0);
-        assertThat(jsonObject1.getString("name")).isEqualTo(BaseEvent.Name.AD_REQUEST.getName());
-        assertThat(jsonObject1.getString("name_category")).isEqualTo("requests");
-
-        JSONObject jsonObject2 = jsonArray.getJSONObject(1);
-        assertThat(jsonObject2.getString("name")).isEqualTo("impression_request");
-        assertThat(jsonObject2.getString("name_category")).isEqualTo("requests");
-    }
-
-    private void populateBaseEventFields(BaseEvent mockBaseEvent) {
-        when(mockBaseEvent.getScribeCategory()).thenReturn(BaseEvent.ScribeCategory.EXCHANGE_CLIENT_EVENT);
-        when(mockBaseEvent.getName()).thenReturn(BaseEvent.Name.AD_REQUEST);
-        when(mockBaseEvent.getCategory()).thenReturn(BaseEvent.Category.REQUESTS);
-        when(mockBaseEvent.getSdkProduct()).thenReturn(BaseEvent.SdkProduct.NATIVE);
-        when(mockBaseEvent.getSdkVersion()).thenReturn("3.5.0");
-        when(mockBaseEvent.getAdUnitId()).thenReturn("8cf00598d3664adaaeccd800e46afaca");
-        when(mockBaseEvent.getAdCreativeId()).thenReturn("3c2b887e2c2a4cd0ae6a925440a62f0d");
-        when(mockBaseEvent.getAdType()).thenReturn("html");
-        when(mockBaseEvent.getAdNetworkType()).thenReturn("admob");
-        when(mockBaseEvent.getAdWidthPx()).thenReturn(320.0);
-        when(mockBaseEvent.getAdHeightPx()).thenReturn(50.0);
-        when(mockBaseEvent.getDspCreativeId()).thenReturn("jack!fake234");
-        when(mockBaseEvent.getAppPlatform()).thenReturn(BaseEvent.AppPlatform.ANDROID);
-        when(mockBaseEvent.getAppName()).thenReturn("MoPub Sample App");
-        when(mockBaseEvent.getAppPackageName()).thenReturn("com.mopub.simpleadsdemo");
-        when(mockBaseEvent.getAppVersion()).thenReturn("1.0");
-        when(mockBaseEvent.getObfuscatedClientAdvertisingId()).thenCallRealMethod();
-        when(mockBaseEvent.getClientAdvertisingId()).thenReturn("38400000-8cf0-11bd-b23e-10b96e40000d");
-        when(mockBaseEvent.getClientDoNotTrack()).thenReturn(false);
-        when(mockBaseEvent.getDeviceManufacturer()).thenReturn("LGE");
-        when(mockBaseEvent.getDeviceModel()).thenReturn("Nexus 5");
-        when(mockBaseEvent.getDeviceProduct()).thenReturn("hammerhead");
-        when(mockBaseEvent.getDeviceOsVersion()).thenReturn("5.0");
-        when(mockBaseEvent.getDeviceScreenWidthDip()).thenReturn(1080);
-        when(mockBaseEvent.getDeviceScreenHeightDip()).thenReturn(1920);
-        when(mockBaseEvent.getGeoLat()).thenReturn(37.7833);
-        when(mockBaseEvent.getGeoLon()).thenReturn(-122.4183333);
-        when(mockBaseEvent.getGeoAccuracy()).thenReturn(10.0);
-        when(mockBaseEvent.getPerformanceDurationMs()).thenReturn(100.0);
-        when(mockBaseEvent.getNetworkType()).thenReturn(ClientMetadata.MoPubNetworkType.WIFI);
-        when(mockBaseEvent.getNetworkOperatorCode()).thenReturn("310410");
-        when(mockBaseEvent.getNetworkOperatorName()).thenReturn("AT&T");
-        when(mockBaseEvent.getNetworkIsoCountryCode()).thenReturn("US");
-        when(mockBaseEvent.getNetworkSimCode()).thenReturn("network_sim_code");
-        when(mockBaseEvent.getNetworkSimOperatorName()).thenReturn("network_operator_name");
-        when(mockBaseEvent.getNetworkSimIsoCountryCode()).thenReturn("US");
-        when(mockBaseEvent.getRequestId()).thenReturn("b550796074da4559a27c5072dcba2b27");
-        when(mockBaseEvent.getRequestStatusCode()).thenReturn(200);
-        when(mockBaseEvent.getRequestUri()).thenReturn("https://ads.mopub.com/m/ad?id=8cf00598d3664adaaeccd800e46afaca");
-        when(mockBaseEvent.getRequestRetries()).thenReturn(0);
-        when(mockBaseEvent.getTimestampUtcMs()).thenReturn(1416447053472L);
-    }
-
-    private void validateBaseEventFields(JSONObject jsonObject) throws Exception {
-        assertThat(jsonObject.getString("_category_")).isEqualTo("exchange_client_event");
-        assertThat(jsonObject.getLong("ts")).isEqualTo(1416447053472L);
-
-        // Name Details
-        assertThat(jsonObject.getString("name")).isEqualTo(BaseEvent.Name.AD_REQUEST.getName());
-        assertThat(jsonObject.getString("name_category")).isEqualTo(BaseEvent.Category.REQUESTS.getCategory());
-
-        // SDK Details
-        assertThat(jsonObject.getInt("sdk_product")).isEqualTo(BaseEvent.SdkProduct.NATIVE.getType());
-        assertThat(jsonObject.getString("sdk_version")).isEqualTo("3.5.0");
-
-        // Ad Details
-        assertThat(jsonObject.getString("ad_unit_id")).isEqualTo("8cf00598d3664adaaeccd800e46afaca");
-        assertThat(jsonObject.getString("ad_creative_id")).isEqualTo("3c2b887e2c2a4cd0ae6a925440a62f0d");
-        assertThat(jsonObject.getString("ad_type")).isEqualTo("html");
-        assertThat(jsonObject.getString("ad_network_type")).isEqualTo("admob");
-        assertThat(jsonObject.getDouble("ad_width_px")).isEqualTo(320.0);
-        assertThat(jsonObject.getDouble("ad_height_px")).isEqualTo(50.0);
-        assertThat(jsonObject.getString("dsp_creative_id")).isEqualTo("jack!fake234");
-
-        // App Details
-        assertThat(jsonObject.getInt("app_platform")).isEqualTo(2);
-        assertThat(jsonObject.getString("app_name")).isEqualTo("MoPub Sample App");
-        assertThat(jsonObject.getString("app_package_name")).isEqualTo("com.mopub.simpleadsdemo");
-        assertThat(jsonObject.getString("app_version")).isEqualTo("1.0");
-
-        // Client Details
-        assertThat(jsonObject.getString("client_advertising_id")).isEqualTo("ifa:XXXX");
-        assertThat(jsonObject.getBoolean("client_do_not_track")).isEqualTo(false);
-
-        // Device Details
-        assertThat(jsonObject.getString("device_manufacturer")).isEqualTo("LGE");
-        assertThat(jsonObject.getString("device_model")).isEqualTo("Nexus 5");
-        assertThat(jsonObject.getString("device_product")).isEqualTo("hammerhead");
-        assertThat(jsonObject.getString("device_os_version")).isEqualTo("5.0");
-        assertThat(jsonObject.getInt("device_screen_width_px")).isEqualTo(1080);
-        assertThat(jsonObject.getInt("device_screen_height_px")).isEqualTo(1920);
-
-        // Geo Details
-        assertThat(jsonObject.getDouble("geo_lat")).isEqualTo(37.7833);
-        assertThat(jsonObject.getDouble("geo_lon")).isEqualTo(-122.4183333);
-        assertThat(jsonObject.getDouble("geo_accuracy_radius_meters")).isEqualTo(10.0);
-
-        // Performance Details
-        assertThat(jsonObject.getDouble("perf_duration_ms")).isEqualTo(100.0);
-
-        // Network Details
-        assertThat(jsonObject.getInt("network_type")).isEqualTo(ClientMetadata.MoPubNetworkType.WIFI.getId());
-        assertThat(jsonObject.getString("network_operator_code")).isEqualTo("310410");
-        assertThat(jsonObject.getString("network_operator_name")).isEqualTo("AT&T");
-        assertThat(jsonObject.getString("network_iso_country_code")).isEqualTo("US");
-        assertThat(jsonObject.getString("network_sim_code")).isEqualTo("network_sim_code");
-        assertThat(jsonObject.getString("network_sim_operator_name")).isEqualTo("network_operator_name");
-        assertThat(jsonObject.getString("network_sim_iso_country_code")).isEqualTo("US");
-
-        // Request Details
-        assertThat(jsonObject.getString("req_id")).isEqualTo("b550796074da4559a27c5072dcba2b27");
-        assertThat(jsonObject.getInt("req_status_code")).isEqualTo(200);
-        assertThat(jsonObject.getString("req_uri")).isEqualTo("https://ads.mopub.com/m/ad?id=8cf00598d3664adaaeccd800e46afaca");
-        assertThat(jsonObject.getInt("req_retries")).isEqualTo(0);
-
-        // Timestamp Details
-        assertThat(jsonObject.getLong("timestamp_client")).isEqualTo(1416447053472L);
-    }
-}
-
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/EventTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/EventTest.java
deleted file mode 100644
index 3384f75e..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/EventTest.java
+++ /dev/null
@@ -1,31 +0,0 @@
-package com.mopub.common.event;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.robolectric.annotation.Config;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class EventTest {
-
-    private Event subject;
-
-    @Before
-    public void setUp() {
-        subject = new Event.Builder(BaseEvent.Name.AD_REQUEST, BaseEvent.Category.REQUESTS, 0.10000123).build();
-    }
-
-    @Test
-    public void constructor_shouldCorrectlyAssignScribeCategoryFromBuilder() {
-        assertThat(subject.getName()).isEqualTo(BaseEvent.Name.AD_REQUEST);
-        assertThat(subject.getCategory()).isEqualTo(BaseEvent.Category.REQUESTS);
-        assertThat(subject.getSamplingRate()).isEqualTo(0.10000123);
-        assertThat(subject.getScribeCategory()).isEqualTo(BaseEvent.ScribeCategory.EXCHANGE_CLIENT_EVENT);
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/MoPubEventsTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/MoPubEventsTest.java
deleted file mode 100644
index 2bf68573..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/MoPubEventsTest.java
+++ /dev/null
@@ -1,54 +0,0 @@
-package com.mopub.common.event;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.robolectric.annotation.Config;
-
-import java.util.ArrayList;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.verify;
-
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class MoPubEventsTest {
-
-    @Before
-    public void setUp() {
-        MoPubEvents.setEventDispatcher(null);
-    }
-
-    @Test
-    public void getDispatcher_shouldReturnSingletonEventDispatcherWithScribeEventRecorder() throws Exception {
-        EventDispatcher eventDispatcher = MoPubEvents.getDispatcher();
-        EventDispatcher eventDispatcher2 = MoPubEvents.getDispatcher();
-
-        assertThat(eventDispatcher).isEqualTo(eventDispatcher2);
-
-        Iterable<EventRecorder> eventRecorderIterable = eventDispatcher.getEventRecorders();
-        ArrayList<EventRecorder> eventRecorders = new ArrayList<EventRecorder>();
-        for (EventRecorder recorder : eventRecorderIterable) {
-            eventRecorders.add(recorder);
-        }
-
-        assertThat(eventRecorders.size()).isEqualTo(1);
-        assertThat(eventRecorders.get(0)).isInstanceOf(ScribeEventRecorder.class);
-    }
-
-    @Test
-    public void log_shouldDispatchEvent() throws Exception {
-        EventDispatcher mockEventDispatcher = mock(EventDispatcher.class);
-        MoPubEvents.setEventDispatcher(mockEventDispatcher);
-
-        Event mockEvent = mock(Event.class);
-        MoPubEvents.log(mockEvent);
-
-        verify(mockEventDispatcher).dispatch(mockEvent);
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/event/ScribeEventRecorderTest.java b/mopub-sdk/src/test/java/com/mopub/common/event/ScribeEventRecorderTest.java
deleted file mode 100644
index 7305cc7b..00000000
--- a/mopub-sdk/src/test/java/com/mopub/common/event/ScribeEventRecorderTest.java
+++ /dev/null
@@ -1,213 +0,0 @@
-package com.mopub.common.event;
-
-import android.os.Handler;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-import com.mopub.network.ScribeBackoffPolicy;
-import com.mopub.network.ScribeRequest;
-import com.mopub.network.ScribeRequestManager;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.mockito.invocation.InvocationOnMock;
-import org.mockito.stubbing.Answer;
-import org.robolectric.annotation.Config;
-
-import java.util.List;
-import java.util.Queue;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Matchers.any;
-import static org.mockito.Matchers.anyLong;
-import static org.mockito.Matchers.eq;
-import static org.mockito.Mockito.doAnswer;
-import static org.mockito.Mockito.never;
-import static org.mockito.Mockito.times;
-import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class ScribeEventRecorderTest {
-
-    private ScribeEventRecorder subject;
-    @Mock private EventSampler mockEventSampler;
-    @Mock private Queue<BaseEvent> mockQueue;
-    @Mock private EventSerializer mockEventSerializer;
-    @Mock private ScribeRequestManager mockScribeRequestManager;
-    @Mock private Handler mockHandler;
-    @Mock private Event mockEvent;
-
-    @Before
-    public void setUp() {
-        subject = new ScribeEventRecorder(
-                mockEventSampler,
-                mockQueue,
-                mockEventSerializer,
-                mockScribeRequestManager,
-                mockHandler
-        );
-
-        when(mockEventSampler.sample(any(Event.class))).thenReturn(true);
-    }
-
-    @Test
-    public void record_shouldSampleEvent() throws Exception {
-        subject.record(mockEvent);
-        verify(mockEventSampler).sample(mockEvent);
-    }
-
-    @Test
-    public void record_withQueueSizeBelowSendThreshold_shouldQueueEvent_shouldNotSendEvents_shouldScheduleNextPoll() throws Exception {
-        when(mockQueue.size()).thenReturn(99);
-
-        subject.record(mockEvent);
-
-        verify(mockQueue).add(mockEvent);
-        verify(mockScribeRequestManager, never()).makeRequest(any(ScribeRequest.ScribeRequestFactory.class), any(ScribeBackoffPolicy.class));
-        verify(mockHandler).postDelayed(any(ScribeEventRecorder.PollingRunnable.class), eq(Long.valueOf(120000)));
-    }
-
-    @Test
-    public void record_withQueueSizeAtSendThreshold_shouldQueueEvent_shouldSendEvents_shouldScheduleNextPoll() throws Exception {
-        when(mockQueue.size()).thenReturn(100);
-        when(mockQueue.peek()).thenReturn(mockEvent);
-        when(mockQueue.poll()).thenReturn(mockEvent);
-
-        subject.record(mockEvent);
-
-        verify(mockQueue).add(mockEvent);
-        verify(mockScribeRequestManager).makeRequest(any(ScribeRequest.ScribeRequestFactory.class), any(ScribeBackoffPolicy.class));
-        verify(mockHandler).postDelayed(any(ScribeEventRecorder.PollingRunnable.class), eq(Long.valueOf(120000)));
-    }
-
-    @Test
-    public void record_withQueueSizeAtQueueLimit_shouldNotQueueEvent_shouldNotSendEvents_shouldNotScheduleNextPoll() throws Exception {
-        when(mockQueue.size()).thenReturn(500);
-
-        subject.record(mockEvent);
-
-        verify(mockQueue, never()).add(mockEvent);
-        verify(mockScribeRequestManager, never()).makeRequest(any(ScribeRequest.ScribeRequestFactory.class), any(ScribeBackoffPolicy.class));
-        verify(mockHandler, never()).postDelayed(any(ScribeEventRecorder.PollingRunnable.class), anyLong());
-    }
-
-    @Test
-    public void sendEvents_shouldDequeueEvents_shouldAddRequestToScribeRequestManager() throws Exception {
-        when(mockQueue.size()).thenReturn(1);
-        when(mockQueue.peek()).thenReturn(mockEvent).thenReturn(null);
-        when(mockQueue.poll()).thenReturn(mockEvent).thenReturn(null);
-        doAnswer(new Answer() {
-            @Override
-            public Object answer(InvocationOnMock invocation) throws Throwable {
-                ScribeRequest scribeRequest = ((ScribeRequest.ScribeRequestFactory) invocation.getArguments()[0]).createRequest(null);
-                assertThat(scribeRequest.getUrl()).isEqualTo("https://analytics.mopub.com/i/jot/exchange_client_event");
-                assertThat(scribeRequest.getEvents()).containsOnly(mockEvent);
-                return null;
-            }
-        }).when(mockScribeRequestManager).makeRequest(any(ScribeRequest.ScribeRequestFactory.class), any(ScribeBackoffPolicy.class));
-
-        subject.sendEvents();
-
-        verify(mockQueue, times(2)).peek();
-        verify(mockQueue, times(1)).poll();
-        verify(mockScribeRequestManager).makeRequest(any(ScribeRequest.ScribeRequestFactory.class), any(ScribeBackoffPolicy.class));
-    }
-
-    @Test
-    public void sendEvents_withRequestInFlightShouldReturnFast() throws Exception {
-        when(mockScribeRequestManager.isAtCapacity()).thenReturn(true);
-
-        subject.sendEvents();
-
-        verify(mockQueue, never()).poll();
-        verify(mockScribeRequestManager, never()).makeRequest(any(ScribeRequest.ScribeRequestFactory.class), any(ScribeBackoffPolicy.class));
-    }
-    
-    @Test
-    public void dequeEvents_withQueueSizeGreaterThanEventSendThreshhold_shouldDequeueUpToEventSendThreshhold() throws Exception {
-        when(mockQueue.size()).thenReturn(101);
-        when(mockQueue.peek()).thenReturn(mockEvent);
-        when(mockQueue.poll()).thenReturn(mockEvent);
-
-        List<BaseEvent> events = subject.dequeueEvents();
-
-        verify(mockQueue, times(101)).peek();
-        verify(mockQueue, times(100)).poll();
-        assertThat(events.size()).isEqualTo(100);
-    }
-
-    @Test
-    public void dequeEvents_withQueueSizeLessThanEventSendThreshhold_shouldDequeueQueueSize() throws Exception {
-        when(mockQueue.size()).thenReturn(99);
-
-        when(mockQueue.peek()).thenAnswer(new Answer<BaseEvent>() {
-            int i;
-            @Override
-            public BaseEvent answer(InvocationOnMock invocation) throws Throwable {
-                return i++ < 99 ? mockEvent : null;
-            }
-        });
-
-        when(mockQueue.poll()).thenAnswer(new Answer<BaseEvent>() {
-            int i;
-            @Override
-            public BaseEvent answer(InvocationOnMock invocation) throws Throwable {
-                return i++ < 99 ? mockEvent : null;
-            }
-        });
-
-        List<BaseEvent> events = subject.dequeueEvents();
-
-        verify(mockQueue, times(100)).peek();
-        verify(mockQueue, times(99)).poll();
-        assertThat(events.size()).isEqualTo(99);
-    }
-
-    @Test
-    public void scheduleNextPoll_shouldPostDelayedPollingRunnable() throws Exception {
-        when(mockHandler.hasMessages(0)).thenReturn(false);
-        when(mockQueue.isEmpty()).thenReturn(false);
-
-        subject.scheduleNextPoll();
-
-        verify(mockHandler).postDelayed(any(ScribeEventRecorder.PollingRunnable.class), eq(Long.valueOf(120000)));
-    }
-
-    @Test
-    public void scheduleNextPoll_withPollScheduled_shouldNotPostDelayedPollingRunnable() throws Exception {
-        when(mockHandler.hasMessages(0)).thenReturn(true);
-        when(mockQueue.isEmpty()).thenReturn(false);
-
-        subject.scheduleNextPoll();
-
-        verify(mockHandler, never()).postDelayed(any(ScribeEventRecorder.PollingRunnable.class), anyLong());
-    }
-
-    @Test
-    public void scheduleNextPoll_withEmptyRequestQueue_shouldNotPostDelayedPollingRunnable() throws Exception {
-        when(mockHandler.hasMessages(0)).thenReturn(false);
-        when(mockQueue.isEmpty()).thenReturn(true);
-
-        subject.scheduleNextPoll();
-
-        verify(mockHandler, never()).postDelayed(any(ScribeEventRecorder.PollingRunnable.class), anyLong());
-    }
-
-    @Test
-    public void PollingRunnable_run_shouldSendEvents_shouldScheduleNextPoll() throws Exception {
-        when(mockQueue.size()).thenReturn(100);
-        when(mockQueue.peek()).thenReturn(mockEvent);
-        when(mockQueue.poll()).thenReturn(mockEvent);
-
-        ScribeEventRecorder.PollingRunnable pollingRunnable = subject.new PollingRunnable();
-        pollingRunnable.run();
-
-        verify(mockScribeRequestManager).makeRequest(any(ScribeRequest.ScribeRequestFactory.class), any(ScribeBackoffPolicy.class));
-        verify(mockHandler).postDelayed(any(ScribeEventRecorder.PollingRunnable.class), eq(Long.valueOf(120000)));
-    }
-}
-
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/AdvertisingIdTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/AdvertisingIdTest.java
new file mode 100644
index 00000000..47440e0a
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/AdvertisingIdTest.java
@@ -0,0 +1,127 @@
+package com.mopub.common.privacy;
+
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.annotation.Config;
+
+import java.util.Calendar;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+public class AdvertisingIdTest {
+    private static final long ONE_DAY_MS = 24 * 60 * 60 * 1000;
+    private static final long TEN_SECONDS_MS = 10 * 1000;
+
+    private static final String MOPUB_ID = "test-id-mopub";
+    private static final String ANDROID_ID = "test-id-android";
+
+    private AdvertisingId subject;
+    private Calendar time;
+    private long now;
+
+    @Before
+    public void setup() {
+        time = Calendar.getInstance();
+        now = time.getTimeInMillis();
+    }
+
+    @Test
+    public void constructor_shouldInitializeCorrectly() {
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, false, now);
+        assertThat(subject.mAdvertisingId).isEqualTo(ANDROID_ID);
+        assertThat(subject.mMopubId).isEqualTo(MOPUB_ID);
+        assertThat(subject.mDoNotTrack).isFalse();
+        assertThat(subject.mLastRotation).isEqualTo(time);
+
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, true, now);
+        assertThat(subject.mDoNotTrack).isTrue();
+        // return IFA even when DoNotTrack is true
+        assertThat(subject.getIfaWithPrefix()).isEqualTo("ifa:" + ANDROID_ID);
+    }
+
+    @Test
+    public void isRotationRequired_whenMoreThan24Hours_shouldReturnTrue() {
+        // one day and ten seconds ago
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, false, now - ONE_DAY_MS - TEN_SECONDS_MS);
+        assertThat(subject.isRotationRequired()).isTrue();
+    }
+
+    @Test
+    public void isRotationRequired_whenLessThan24Hours_shouldReturnFalse() {
+        // one day and ten seconds ago
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, false, now - ONE_DAY_MS + TEN_SECONDS_MS);
+        assertThat(subject.isRotationRequired()).isFalse();
+    }
+
+    @Test
+    public void getIdWithPrefix_whenDoNotTrackFalse_shouldReturnIfaString() {
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, false, now);
+        assertThat(subject.getIdWithPrefix(true)).isEqualTo("ifa:" + ANDROID_ID);
+    }
+
+    @Test
+    public void getIdWithPrefix_whenAndroidIdUnavailable_shouldReturnMopubString() {
+        subject = new AdvertisingId("", MOPUB_ID, false, now);
+        assertThat(subject.getIdWithPrefix(true)).isEqualTo("mopub:" + MOPUB_ID);
+    }
+
+    @Test
+    public void getIdWithPrefix_whenUserConsentFalse_shouldReturnMopubString() {
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, false, now);
+        assertThat(subject.getIdWithPrefix(false)).isEqualTo("mopub:" + MOPUB_ID);
+    }
+
+    @Test
+    public void getIdWithPrefix_whenUserConsentTrue_shouldReturnIfaString() {
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, false, now);
+        assertThat(subject.getIdWithPrefix(true)).isEqualTo("ifa:" + ANDROID_ID);
+    }
+
+    @Test
+    public void getIdWithPrefix_whenLimitAdTrackingIsTrue_shouldNotDependOnConsent() {
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, true, now);
+
+        assertThat(subject.getIdWithPrefix(true)).isEqualTo("mopub:" + MOPUB_ID);
+        assertThat(subject.getIdWithPrefix(false)).isEqualTo("mopub:" + MOPUB_ID);
+    }
+
+    @Test
+    public void getIdentifier_whenDoNotTrackIsTrue_shouldReturnMoPubid() {
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, true, now);
+
+        assertThat(subject.getIdentifier(true)).isEqualTo(MOPUB_ID);
+        assertThat(subject.getIdentifier(false)).isEqualTo(MOPUB_ID);
+    }
+
+    @Test
+    public void getIdentifier_whenDoNotTrackIsFalse_shouldAnalyzeConsent() {
+        subject = new AdvertisingId(ANDROID_ID, MOPUB_ID, false, now);
+        
+        assertThat(subject.getIdentifier(true)).isEqualTo(ANDROID_ID);
+        assertThat(subject.getIdentifier(false)).isEqualTo(MOPUB_ID);
+    }
+
+    @Test
+    public void generateExpiredAdvertisingId_shouldGenerateExpiredAdvertisingId() {
+        subject = AdvertisingId.generateExpiredAdvertisingId();
+        assertThat(subject.isRotationRequired()).isTrue();
+    }
+
+    @Test
+    public void generateFreshAdvertisingId_shouldGenerateNonExpiredAdvertisingId() {
+        subject = AdvertisingId.generateFreshAdvertisingId();
+        assertThat(subject.isRotationRequired()).isFalse();
+    }
+
+    @Test
+    public void generateIdString_lengthIs16x2plus4() {
+        String uuid = AdvertisingId.generateIdString();
+        assertThat(uuid.length()).isEqualTo(36);
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogActivityTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogActivityTest.java
new file mode 100644
index 00000000..857c5370
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogActivityTest.java
@@ -0,0 +1,107 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.content.ComponentName;
+import android.content.Context;
+import android.content.Intent;
+import android.os.Handler;
+import android.view.ViewGroup;
+import android.widget.FrameLayout;
+
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
+import org.robolectric.android.controller.ActivityController;
+import org.robolectric.annotation.Config;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.junit.Assert.assertNotNull;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.spy;
+import static org.mockito.Mockito.verify;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+public class ConsentDialogActivityTest {
+    private static final String HTML = "some_html";
+
+    private Context mContext;
+
+    private ActivityController<ConsentDialogActivity> activityController;
+    private ConsentDialogActivity subject;
+
+    @Before
+    public void setUp() throws Exception {
+        mContext = Robolectric.buildActivity(Activity.class).create().get();
+        activityController = Robolectric.buildActivity(ConsentDialogActivity.class);
+    }
+
+    @Test
+    public void start_withValidParameters_shouldStartActivity() {
+        Context context = spy(mContext);
+        ConsentDialogActivity.start(context, HTML);
+        verify(context).startActivity(any(Intent.class));
+    }
+
+    @Test
+    public void createIntent_correctParameters_shouldCreateValidIntent() {
+        Intent intent = ConsentDialogActivity.createIntent(mContext, HTML);
+        assertThat(intent.getStringExtra("html-page-content")).isEqualTo(HTML);
+        ComponentName componentName = intent.getComponent();
+        assertNotNull(componentName);
+        assertThat(componentName.getClassName()).isEqualTo(ConsentDialogActivity.class.getCanonicalName());
+    }
+
+    @Test
+    public void onCreate_shouldSetContentView() {
+        Intent intent = ConsentDialogActivity.createIntent(mContext, HTML);
+        subject = activityController.get();
+        subject.setIntent(intent);
+        subject.onCreate(null);
+
+        ConsentDialogLayout mView = (ConsentDialogLayout) getContentView();
+        assertThat(mView).isNotNull();
+    }
+
+    @Test
+    public void setCloseButtonVisible_shouldCallViewAndClearHandler() {
+        subject = activityController.create().get();
+
+        Handler handler = mock(Handler.class);
+        ConsentDialogLayout dialogLayout = mock(ConsentDialogLayout.class);
+
+        subject.mCloseButtonHandler = handler;
+        subject.mView = dialogLayout;
+
+        subject.setCloseButtonVisibility(true);
+
+        verify(handler).removeCallbacks(any(Runnable.class));
+        verify(dialogLayout).setCloseVisible(true);
+    }
+
+    @Test
+    public void setCloseButtonInvisible_shouldCallViewAndClearHandler() {
+        subject = activityController.create().get();
+
+        Handler handler = mock(Handler.class);
+        ConsentDialogLayout dialogLayout = mock(ConsentDialogLayout.class);
+
+        subject.mCloseButtonHandler = handler;
+        subject.mView = dialogLayout;
+
+        subject.setCloseButtonVisibility(false);
+
+        verify(handler).removeCallbacks(any(Runnable.class));
+        verify(dialogLayout).setCloseVisible(false);
+    }
+
+    private FrameLayout getContentView() {
+        return (FrameLayout) ((ViewGroup) subject.findViewById(android.R.id.content)).getChildAt(0);
+    }
+
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogControllerTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogControllerTest.java
new file mode 100644
index 00000000..3555f355
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogControllerTest.java
@@ -0,0 +1,205 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.content.Context;
+import android.content.Intent;
+import android.net.Uri;
+
+import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Intents;
+import com.mopub.mobileads.BuildConfig;
+import com.mopub.mobileads.MoPubErrorCode;
+import com.mopub.network.MoPubNetworkError;
+import com.mopub.network.MoPubRequestQueue;
+import com.mopub.network.MoPubRequestQueueTest;
+import com.mopub.network.Networking;
+import com.mopub.volley.VolleyError;
+
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.ArgumentCaptor;
+import org.mockito.Mockito;
+import org.powermock.api.mockito.PowerMockito;
+import org.powermock.core.classloader.annotations.PowerMockIgnore;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import static com.mopub.network.MoPubNetworkError.Reason.BAD_BODY;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.verify;
+import static org.powermock.api.mockito.PowerMockito.verifyStatic;
+import static org.powermock.api.mockito.PowerMockito.when;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+@PowerMockIgnore({"org.mockito.*", "org.robolectric.*", "android.*", "org.json.*"})
+@PrepareForTest({Networking.class, Intents.class})
+public class ConsentDialogControllerTest {
+    private static final String AD_UNIT_ID = "ad_unit_id";
+    private static final String HTML_TEXT = "html_text";
+
+    @Rule
+    public PowerMockRule rule = new PowerMockRule();
+
+    private ConsentDialogResponse dialogResponse;
+    private ConsentDialogController subject;
+    private PersonalInfoData personalInfoData;
+
+    // mock objects
+    private MoPubRequestQueue mockRequestQueue;
+    private ConsentDialogListener mockDialogListener;
+
+    @Before
+    public void setup() {
+        Activity activity = Robolectric.buildActivity(Activity.class).get();
+        Context context = activity.getApplicationContext();
+        mockRequestQueue = Mockito.mock(MoPubRequestQueueTest.TestMoPubRequestQueue.class);
+        mockDialogListener = Mockito.mock(ConsentDialogListener.class);
+        dialogResponse = new ConsentDialogResponse(HTML_TEXT);
+        personalInfoData = new PersonalInfoData(context, AD_UNIT_ID);
+
+        PowerMockito.mockStatic(Networking.class);
+        when(Networking.getRequestQueue(context)).thenReturn(mockRequestQueue);
+        when(Networking.getScheme()).thenReturn(Constants.HTTPS);
+
+        PowerMockito.mockStatic(Intents.class);
+
+        subject = new ConsentDialogController(context);
+    }
+
+    @Test
+    public void loadConsentDialog_whenReadyIsFalse_whenRequestInFlightIsFalse_shouldAddRequestToNetworkQueue() {
+        ArgumentCaptor<ConsentDialogRequest> requestCaptor = ArgumentCaptor.forClass(ConsentDialogRequest.class);
+
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+
+        assertThat(subject.mRequestInFlight).isTrue();
+        verify(mockDialogListener, never()).onConsentDialogLoaded();
+        verify(mockRequestQueue).add(requestCaptor.capture());
+        ConsentDialogRequest request = requestCaptor.getValue();
+        String originalUrl = request.getOriginalUrl();
+        String minUrl = generateTestUrl();
+        assertThat(minUrl).isEqualTo(originalUrl);
+    }
+
+    @Test
+    public void loadConsentDialog_whenReadyIsTrue_whenRequestInFlightIsFalse_shouldNotAddRequestToNetworkQueue() {
+        subject.mReady = true;
+
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+
+        assertThat(subject.mRequestInFlight).isFalse();
+        verify(mockDialogListener).onConsentDialogLoaded(); // should call listener immediately
+        verify(mockRequestQueue, never()).add(any(ConsentDialogRequest.class));
+    }
+
+    @Test
+    public void loadConsentDialog_whenReadyIsTrue_withListenerNotSet_shouldNotCrash() {
+        subject.mReady = true;
+
+        subject.loadConsentDialog(null, true, personalInfoData);
+
+        assertThat(subject.mRequestInFlight).isFalse();
+        verify(mockRequestQueue, never()).add(any(ConsentDialogRequest.class));
+    }
+
+    @Test
+    public void loadConsentDialog_whenRequestInFlightIsTrue_shouldNotCreateNewRequest_shouldNotCallListener() {
+        subject.mRequestInFlight = true;
+
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+
+        verify(mockDialogListener, never()).onConsentDialogLoaded();
+        verify(mockRequestQueue, never()).add(any(ConsentDialogRequest.class));
+    }
+
+    @Test
+    public void onSuccess_withValidResponse_shouldCallConsentDialogLoaded() {
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+        subject.onSuccess(dialogResponse);
+
+        assertThat(subject.mReady).isTrue();
+        assertThat(subject.mRequestInFlight).isFalse();
+        verify(mockDialogListener).onConsentDialogLoaded();
+        verify(mockDialogListener, never()).onConsentDialogLoadFailed(any(MoPubErrorCode.class));
+    }
+
+    @Test
+    public void onSuccess_withEmptyResponse_shouldNotCallConsentDialogLoaded() {
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+        subject.onSuccess(new ConsentDialogResponse(""));
+
+        assertThat(subject.mReady).isFalse();
+        assertThat(subject.mRequestInFlight).isFalse();
+        verify(mockDialogListener, never()).onConsentDialogLoaded();
+        verify(mockDialogListener).onConsentDialogLoadFailed(any(MoPubErrorCode.class));
+    }
+
+    @Test
+    public void onErrorResponse_shouldResetState_shouldCallDialogFailed() {
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+        subject.onErrorResponse(new VolleyError());
+
+        assertThat(subject.mReady).isFalse();
+        assertThat(subject.mRequestInFlight).isFalse();
+        verify(mockDialogListener, never()).onConsentDialogLoaded();
+        verify(mockDialogListener).onConsentDialogLoadFailed(any(MoPubErrorCode.class));
+    }
+
+    @Test
+    public void onErrorResponse_withErrorBadBody_shouldResetState_shouldCallDialogFailed() {
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+        subject.onErrorResponse(new MoPubNetworkError(BAD_BODY));
+
+        assertThat(subject.mReady).isFalse();
+        assertThat(subject.mRequestInFlight).isFalse();
+        verify(mockDialogListener, never()).onConsentDialogLoaded();
+        verify(mockDialogListener).onConsentDialogLoadFailed(MoPubErrorCode.INTERNAL_ERROR);
+    }
+
+    @Test
+    public void showConsentDialog_whenDataIsReady_shouldStartActivity_shouldResetControllerState() throws Exception {
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+        subject.onSuccess(dialogResponse);
+
+        subject.showConsentDialog();
+
+        assertThat(subject.mReady).isFalse();
+        assertThat(subject.mRequestInFlight).isFalse();
+        verifyStatic();
+        Intents.startActivity(any(Context.class), any(Intent.class));
+    }
+
+    @Test
+    public void showConsentDialog_whenDataIsNotReady_shouldNotStartActivity() throws Exception {
+        subject.loadConsentDialog(mockDialogListener, true, personalInfoData);
+        subject.onErrorResponse(new MoPubNetworkError(BAD_BODY));
+
+        subject.showConsentDialog();
+
+        assertThat(subject.mReady).isFalse();
+        assertThat(subject.mRequestInFlight).isFalse();
+        verifyStatic(never());
+        Intents.startActivity(any(Context.class), any(Intent.class));
+    }
+
+    // test utils
+    private String generateTestUrl() {
+        return "https://" + Constants.HOST + "/m/gdpr_consent_dialog" +
+                "?id=" + Uri.encode(AD_UNIT_ID) +
+                "&current_consent_status=unknown" +
+                "&nv=" + Uri.encode(MoPub.SDK_VERSION) +
+                "&language=en" +
+                "&gdpr_applies=1" +
+                "&force_gdpr_applies=0" +
+                "&bundle=com.mopub.mobileads";
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogLayoutTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogLayoutTest.java
new file mode 100644
index 00000000..dd963b95
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogLayoutTest.java
@@ -0,0 +1,94 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.webkit.WebView;
+import android.webkit.WebViewClient;
+
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Reflection;
+import com.mopub.mobileads.BuildConfig;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import java.lang.reflect.Field;
+
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.verify;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+public class ConsentDialogLayoutTest {
+
+    @Mock
+    private ConsentDialogLayout.ConsentListener consentListener;
+    @Mock
+    private ConsentDialogLayout.PageLoadListener pageLoadListener;
+    @Mock
+    private WebView mockWebView;
+
+    private ConsentDialogLayout subject;
+    private WebViewClient webViewClient;
+
+    @Before
+    public void setUp() throws Exception {
+        Activity activity = Robolectric.buildActivity(Activity.class).create().get();
+        subject = new ConsentDialogLayout(activity);
+        Field webClientField = Reflection.getPrivateField(ConsentDialogLayout.class, "webViewClient");
+        webViewClient = (WebViewClient) webClientField.get(subject);
+    }
+
+    @Test
+    public void webViewClient_shouldOverrideUrlLoading_withConsentYes_shouldCallConsentClick() {
+        subject.setConsentClickListener(consentListener);
+
+        webViewClient.shouldOverrideUrlLoading(mockWebView, ConsentDialogLayout.URL_CONSENT_YES);
+
+        verify(consentListener).onConsentClick(ConsentStatus.EXPLICIT_YES);
+        verify(consentListener, never()).onCloseClick();
+    }
+
+    @Test
+    public void webViewClient_shouldOverrideUrlLoading_withConsentNo_shouldCallConsentClick() {
+        subject.setConsentClickListener(consentListener);
+
+        webViewClient.shouldOverrideUrlLoading(mockWebView, ConsentDialogLayout.URL_CONSENT_NO);
+
+        verify(consentListener).onConsentClick(ConsentStatus.EXPLICIT_NO);
+        verify(consentListener, never()).onCloseClick();
+    }
+
+    @Test
+    public void webViewClient_shouldOverrideUrlLoading_closeClick_shouldCallCloseClick() {
+        subject.setConsentClickListener(consentListener);
+
+        webViewClient.shouldOverrideUrlLoading(mockWebView, ConsentDialogLayout.URL_CLOSE);
+
+        verify(consentListener, never()).onConsentClick(any(ConsentStatus.class));
+        verify(consentListener).onCloseClick();
+    }
+
+    @Test
+    public void webViewClient_shouldOverrideUrlLoading_withAnyOtherUrls_shouldNotCallListener() {
+        subject.setConsentClickListener(consentListener);
+
+        webViewClient.shouldOverrideUrlLoading(mockWebView, "some other url");
+
+        verify(consentListener, never()).onConsentClick(any(ConsentStatus.class));
+        verify(consentListener, never()).onCloseClick();
+    }
+
+    @Test
+    public void webViewClient_onPageFinished_shouldCall_onLoadProgress() {
+        subject.startLoading("html_page", pageLoadListener);
+
+        webViewClient.onPageFinished(mockWebView, "some_url");
+
+        verify(pageLoadListener).onLoadProgress(ConsentDialogLayout.FINISHED_LOADING);
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogRequestTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogRequestTest.java
new file mode 100644
index 00000000..9d49474d
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogRequestTest.java
@@ -0,0 +1,114 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+
+import com.mopub.common.Constants;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+import com.mopub.network.MoPubNetworkError;
+import com.mopub.volley.DefaultRetryPolicy;
+import com.mopub.volley.NetworkResponse;
+import com.mopub.volley.Response;
+import com.mopub.volley.RetryPolicy;
+import com.mopub.volley.VolleyError;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import java.nio.charset.Charset;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.verify;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+public class ConsentDialogRequestTest {
+    private static final String URL = "https://"+ Constants.HOST+"/m/gdpr_consent_dialog?id=testAdUnitId&nv=5.0.0&language=en";
+    private static final String HTML = "html-body-text";
+    private static final String BODY = "{ dialog_html : '" + HTML + "' }";
+
+    @Mock
+    private ConsentDialogRequest.Listener listener;
+
+    private Activity activity;
+    private ConsentDialogRequest subject;
+
+    @Before
+    public void setup() {
+        activity = Robolectric.buildActivity(Activity.class).create().get();
+        subject = new ConsentDialogRequest(activity, URL, listener);
+    }
+
+    @Test
+    public void constructor_shouldSetParametersCorrectly() {
+        RetryPolicy retryPolicy = subject.getRetryPolicy();
+
+        assertThat(subject.getUrl()).isEqualTo(URL.substring(0, URL.indexOf('?')));
+        assertThat(retryPolicy).isNotNull();
+        assertThat(retryPolicy.getCurrentTimeout()).isEqualTo(DefaultRetryPolicy.DEFAULT_TIMEOUT_MS);
+        assertThat(subject.shouldCache()).isFalse();
+    }
+
+    @Test
+    public void parseNetworkResponse_withValidBody_shouldSucceed() {
+        NetworkResponse testResponse = new NetworkResponse(BODY.getBytes(Charset.defaultCharset()));
+        final Response<ConsentDialogResponse> response = subject.parseNetworkResponse(testResponse);
+
+        assertThat(response.result).isNotNull();
+        assertThat(response.result.getHtml()).isEqualTo(HTML);
+    }
+
+    @Test
+    public void parseNetworkResponse_withEmptyBody_shouldReturnErrorBadBody() {
+        NetworkResponse testResponse = new NetworkResponse("".getBytes(Charset.defaultCharset()));
+        final Response<ConsentDialogResponse> response = subject.parseNetworkResponse(testResponse);
+
+        assertThat(response.error).isNotNull();
+        assertThat(response.error).isInstanceOf(MoPubNetworkError.class);
+        assertThat(((MoPubNetworkError) response.error).getReason()).isEqualTo(MoPubNetworkError.Reason.BAD_BODY);
+    }
+
+    @Test
+    public void parseNetworkResponse_withBrokenJsonBody_shouldReturnErrorBadBody() {
+        NetworkResponse testResponse = new NetworkResponse("{ html - 'body' }".getBytes(Charset.defaultCharset()));
+        final Response<ConsentDialogResponse> response = subject.parseNetworkResponse(testResponse);
+
+        assertThat(response.error).isNotNull();
+        assertThat(response.error).isInstanceOf(MoPubNetworkError.class);
+        assertThat(((MoPubNetworkError) response.error).getReason()).isEqualTo(MoPubNetworkError.Reason.BAD_BODY);
+    }
+
+    @Test
+    public void parseNetworkResponse_withJsonNoHtmlTag_shouldReturnErrorBadBody() {
+        NetworkResponse testResponse = new NetworkResponse("{ k: 1 }".getBytes(Charset.defaultCharset()));
+        final Response<ConsentDialogResponse> response = subject.parseNetworkResponse(testResponse);
+
+        assertThat(response.error).isNotNull();
+        assertThat(response.error).isInstanceOf(MoPubNetworkError.class);
+        assertThat(((MoPubNetworkError) response.error).getReason()).isEqualTo(MoPubNetworkError.Reason.BAD_BODY);
+    }
+
+    @Test
+    public void deliverResponse_withValidListener_shouldCallListener() {
+        ConsentDialogResponse response = new ConsentDialogResponse("html-text");
+        subject.deliverResponse(response);
+
+        verify(listener).onSuccess(response);
+    }
+
+    @Test
+    public void deliverResponse_withNullListener_shouldNotCrash() {
+        subject = new ConsentDialogRequest(activity, URL, null);
+        ConsentDialogResponse response = new ConsentDialogResponse("html-text");
+        subject.deliverResponse(response);
+
+        verify(listener, never()).onSuccess(any(ConsentDialogResponse.class));
+        verify(listener, never()).onErrorResponse(any(VolleyError.class));
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogUrlGeneratorTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogUrlGeneratorTest.java
new file mode 100644
index 00000000..dd507068
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/ConsentDialogUrlGeneratorTest.java
@@ -0,0 +1,152 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.content.Context;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
+import com.mopub.mobileads.BuildConfig;
+
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.powermock.api.mockito.PowerMockito;
+import org.powermock.core.classloader.annotations.PowerMockIgnore;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
+import org.robolectric.Robolectric;
+import org.robolectric.RobolectricTestRunner;
+import org.robolectric.annotation.Config;
+
+import java.util.Map;
+
+import static com.mopub.common.privacy.ConsentStatus.EXPLICIT_NO;
+import static com.mopub.common.privacy.ConsentStatus.EXPLICIT_YES;
+import static com.mopub.common.privacy.ConsentStatus.UNKNOWN;
+import static com.mopub.common.test.support.UrlSupport.HOST_KEY;
+import static com.mopub.common.test.support.UrlSupport.PATH_KEY;
+import static com.mopub.common.test.support.UrlSupport.SCHEME_KEY;
+import static com.mopub.common.test.support.UrlSupport.urlToMap;
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+
+@SuppressWarnings("ConstantConditions")
+@RunWith(RobolectricTestRunner.class)
+@Config(constants = BuildConfig.class)
+@PowerMockIgnore({"org.mockito.*", "org.robolectric.*", "android.*", "org.json.*"})
+@PrepareForTest(ClientMetadata.class)
+public class ConsentDialogUrlGeneratorTest {
+    private static final String AD_UNIT_ID = "ad_unit_id";
+    private static final String CURRENT_LANGUAGE = "current_language";
+    private static final String BUNDLE = "test.bundle";
+    private static final String POLICY_VERSION = "policy.version";
+    private static final String VENDOR_LIST_VERSION = "vendor.list.version";
+
+    @Rule
+    public PowerMockRule rule = new PowerMockRule();
+
+    private Context context;
+    private ConsentDialogUrlGenerator subject;
+
+    @Before
+    public void setup() {
+        Activity activity = Robolectric.buildActivity(Activity.class).get();
+        context = activity.getApplicationContext();
+
+        PowerMockito.mockStatic(ClientMetadata.class);
+        PowerMockito.when(ClientMetadata.getCurrentLanguage(context)).thenReturn(CURRENT_LANGUAGE);
+        ClientMetadata mockClientMetadata = PowerMockito.mock(ClientMetadata.class);
+        PowerMockito.when(mockClientMetadata.getAppPackageName()).thenReturn(BUNDLE);
+        PowerMockito.when(ClientMetadata.getInstance(any(Context.class))).thenReturn(
+                mockClientMetadata);
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void constructor_withContextNull_shouldThrowException() {
+        subject = new ConsentDialogUrlGenerator(null, AD_UNIT_ID, UNKNOWN.getValue());
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void constructor_withAdUnitIdlNull_shouldThrowException() {
+        subject = new ConsentDialogUrlGenerator(context, null, UNKNOWN.getValue());
+    }
+
+    @Test(expected = NullPointerException.class)
+    public void constructor_withConsentStatusNull_shouldThrowException() {
+        subject = new ConsentDialogUrlGenerator(context, AD_UNIT_ID, null);
+    }
+
+    @Test
+    public void generateUrlString_withMinimumParametersSet_shouldGenerateValidUrl() {
+        String validUrl = createTestUrl();
+
+        subject = new ConsentDialogUrlGenerator(context, AD_UNIT_ID, UNKNOWN.getValue());
+        String url = subject.generateUrlString(Constants.HOST);
+        assertThat(url).isEqualTo(validUrl);
+    }
+
+    @Test
+    public void generateUrlString_withAllParameters_shouldGenerateValidUrl() {
+        subject = new ConsentDialogUrlGenerator(context, AD_UNIT_ID, EXPLICIT_YES.getValue());
+        subject.withConsentedPrivacyPolicyVersion(POLICY_VERSION)
+                .withConsentedVendorListVersion(VENDOR_LIST_VERSION)
+                .withForceGdprApplies(true)
+                .withGdprApplies(true);
+
+        String url = subject.generateUrlString(Constants.HOST);
+        Map<String, String> map = urlToMap(url);
+
+        assertThat(map.get(HOST_KEY)).isEqualTo(Constants.HOST);
+        assertThat(map.get(SCHEME_KEY)).isEqualTo(Constants.HTTPS);
+        assertThat(map.get(PATH_KEY)).isEqualTo(Constants.GDPR_CONSENT_HANDLER);
+        assertThat(map.get("id")).isEqualTo(AD_UNIT_ID);
+        assertThat(map.get("current_consent_status")).isEqualTo(EXPLICIT_YES.getValue());
+        assertThat(map.get("nv")).isEqualTo(MoPub.SDK_VERSION);
+        assertThat(map.get("language")).isEqualTo(CURRENT_LANGUAGE);
+        assertThat(map.get("gdpr_applies")).isEqualTo("1");
+        assertThat(map.get("force_gdpr_applies")).isEqualTo("1");
+        assertThat(map.get("consented_vendor_list_version")).isEqualTo(VENDOR_LIST_VERSION);
+        assertThat(map.get("consented_privacy_policy_version")).isEqualTo(POLICY_VERSION);
+        assertThat(map.get("bundle")).isEqualTo(BUNDLE);
+        assertThat(map.size()).isEqualTo(12);
+    }
+
+    @Test
+    public void generateUrlString_withGdprAppliesNotSet_shouldNotIncludeGdprParam() {
+        subject = new ConsentDialogUrlGenerator(context, AD_UNIT_ID, EXPLICIT_NO.getValue());
+        subject.withConsentedPrivacyPolicyVersion(POLICY_VERSION)
+                .withConsentedVendorListVersion(VENDOR_LIST_VERSION)
+                .withForceGdprApplies(false);
+
+        String url = subject.generateUrlString(Constants.HOST);
+        Map<String, String> map = urlToMap(url);
+
+        assertThat(map.get(HOST_KEY)).isEqualTo(Constants.HOST);
+        assertThat(map.get(SCHEME_KEY)).isEqualTo(Constants.HTTPS);
+        assertThat(map.get(PATH_KEY)).isEqualTo(Constants.GDPR_CONSENT_HANDLER);
+        assertThat(map.get("id")).isEqualTo(AD_UNIT_ID);
+        assertThat(map.get("current_consent_status")).isEqualTo(EXPLICIT_NO.getValue());
+        assertThat(map.get("nv")).isEqualTo(MoPub.SDK_VERSION);
+        assertThat(map.get("language")).isEqualTo(CURRENT_LANGUAGE);
+        assertThat(map.get("gdpr_applies")).isEqualTo(null);
+        assertThat(map.get("force_gdpr_applies")).isEqualTo("0");
+        assertThat(map.get("consented_vendor_list_version")).isEqualTo(VENDOR_LIST_VERSION);
+        assertThat(map.get("consented_privacy_policy_version")).isEqualTo(POLICY_VERSION);
+        assertThat(map.get("bundle")).isEqualTo(BUNDLE);
+        assertThat(map.size()).isEqualTo(11);
+    }
+
+    // unit test utils
+    private String createTestUrl() {
+        return "https://" + Constants.HOST + "/m/gdpr_consent_dialog" +
+                "?id=" + AD_UNIT_ID +
+                "&current_consent_status=" + UNKNOWN.getValue() +
+                "&nv=" + MoPub.SDK_VERSION +
+                "&language=" + CURRENT_LANGUAGE +
+                "&force_gdpr_applies=" + "0" +
+                "&bundle=" + BUNDLE;
+    }
+
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/MoPubIdentifierTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/MoPubIdentifierTest.java
new file mode 100644
index 00000000..fcddfac4
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/MoPubIdentifierTest.java
@@ -0,0 +1,481 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.content.ContentResolver;
+import android.content.Context;
+import android.provider.Settings;
+import android.support.annotation.NonNull;
+
+import com.mopub.common.GpsHelper;
+import com.mopub.common.SdkInitializationListener;
+import com.mopub.common.util.Reflection;
+import com.mopub.mobileads.BuildConfig;
+
+import org.junit.After;
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.ArgumentCaptor;
+import org.powermock.api.mockito.PowerMockito;
+import org.powermock.core.classloader.annotations.PowerMockIgnore;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
+import org.robolectric.Robolectric;
+import org.robolectric.RobolectricTestRunner;
+import org.robolectric.RuntimeEnvironment;
+import org.robolectric.annotation.Config;
+
+import java.util.Calendar;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.reset;
+import static org.mockito.Mockito.verify;
+import static org.powermock.api.mockito.PowerMockito.verifyStatic;
+
+@RunWith(RobolectricTestRunner.class)
+@Config(constants = BuildConfig.class)
+@PowerMockIgnore({"org.mockito.*", "org.robolectric.*", "android.*", "org.json.*"})
+@PrepareForTest(GpsHelper.class)
+public class MoPubIdentifierTest {
+    @Rule
+    public PowerMockRule rule = new PowerMockRule();
+
+    private MoPubIdentifier.AdvertisingIdChangeListener idChangeListener;
+    private SdkInitializationListener initializationListener;
+
+    private Context context;
+    private MoPubIdentifier subject;
+
+    private static final String GOOGLE_AD_ID = "google_ad_id";
+    private static final String AMAZON_AD_ID = "amazon_ad_id";
+    private static final String TEST_IFA_ID = "test_ifa_id";
+    public static final String TEST_MOPUB_ID = "test_mopub_id";
+
+    @Before
+    public void setup() {
+        Activity activity = Robolectric.buildActivity(Activity.class).get();
+        context = activity.getApplicationContext();
+        idChangeListener = mock(MoPubIdentifier.AdvertisingIdChangeListener.class);
+        initializationListener = mock(SdkInitializationListener.class);
+    }
+
+    @After
+    public void tearDown() {
+        // delete changes made by setupAmazonAdvertisingInfo
+        ContentResolver resolver = RuntimeEnvironment.application.getContentResolver();
+        Settings.Secure.putString(resolver, "limit_ad_tracking", null);
+        Settings.Secure.putString(resolver, "advertising_id", null);
+        // clear shared preferences
+        MoPubIdentifier.clearStorage(context);
+    }
+
+    @Test
+    public void constructor_withNotExpiredOldId_withNoAmazon_withNoGoogle_shouldReadSharedPref() throws Exception {
+        AdvertisingId savedId = writeAdvertisingInfoToSharedPreferences(context, true);
+
+        subject = new MoPubIdentifier(context);
+
+        AdvertisingId idData = subject.getAdvertisingInfo();
+        assertThat(idData.mAdvertisingId).isEqualTo(savedId.mAdvertisingId);
+        assertThat(idData.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(idData.isRotationRequired()).isEqualTo(savedId.isRotationRequired());
+        assertThat(idData.isDoNotTrack()).isEqualTo(savedId.isDoNotTrack());
+    }
+
+    @Test
+    public void constructor_withExpiredOldId_withNoAmazon_withNoGoogle_shouldCallOnIdChanged() throws Exception {
+        AdvertisingId savedId = writeExpiredAdvertisingInfoToSharedPreferences(context, false);
+
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+
+        subject = new MoPubIdentifier(context, idChangeListener);
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+
+        assertThat(oldId.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(oldId.mAdvertisingId).isEqualTo(savedId.mAdvertisingId);
+        assertThat(oldId.isDoNotTrack()).isEqualTo(savedId.isDoNotTrack());
+
+        assertThat(newId.isDoNotTrack()).isFalse();
+        assertThat(newId.mAdvertisingId).isEmpty();
+        assertThat(newId.getIdWithPrefix(false)).contains("mopub:");
+    }
+
+    @Test
+    public void constructor_withNotExpiredOldid_withNoAmazon_withNoGoogle_shouldCallOnIdChanngedOnlyOnce() throws Exception {
+        AdvertisingId savedId = writeAdvertisingInfoToSharedPreferences(context, false);
+
+        subject = new MoPubIdentifier(context, idChangeListener);
+        verify(idChangeListener).onIdChanged(any(AdvertisingId.class), any(AdvertisingId.class));
+
+        AdvertisingId idData = subject.getAdvertisingInfo();
+        assertThat(idData.getIdWithPrefix(true)).contains("ifa:");
+        assertThat(idData.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(idData.mAdvertisingId).isEqualTo(savedId.mAdvertisingId);
+        assertThat(idData.isDoNotTrack()).isEqualTo(savedId.isDoNotTrack());
+
+        reset(idChangeListener);
+        subject.refreshAdvertisingInfoBackgroundThread();
+        verify(idChangeListener, never()).onIdChanged(any(AdvertisingId.class), any(AdvertisingId.class));
+    }
+
+    @Test
+    public void constructor_withExpiredId_withNoListenerSet_shouldNotCrash_shouldRotateMopubId() throws Exception {
+        AdvertisingId savedId = writeExpiredAdvertisingInfoToSharedPreferences(context, true);
+
+        subject = new MoPubIdentifier(context);
+        subject.setIdChangeListener(null);
+        AdvertisingId newId = subject.getAdvertisingInfo();
+
+        assertThat(newId.mMopubId).isNotEqualTo(savedId.mMopubId);
+        assertThat(newId.mAdvertisingId).isNotEqualTo(savedId.mAdvertisingId);
+        assertThat(newId.isDoNotTrack()).isFalse();
+        assertThat(newId.isRotationRequired()).isFalse();
+    }
+
+    @Test
+    public void constructor_withGoogle_withNoAmazon_withDoNotTrackTrue_shoulUseGoogleId() throws Exception {
+        AdvertisingId savedId = writeAdvertisingInfoToSharedPreferences(context, false);
+        setupGooglePlayService(context, true);
+
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+
+        subject = new MoPubIdentifier(context, idChangeListener);
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+
+        assertThat(oldId.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(oldId.mAdvertisingId).isEqualTo(savedId.mAdvertisingId);
+        assertThat(oldId.isDoNotTrack()).isEqualTo(savedId.isDoNotTrack());
+        assertThat(oldId.getIdWithPrefix(true)).isEqualTo(savedId.getIdWithPrefix(true));
+
+        assertThat(newId.isDoNotTrack()).isTrue();
+        assertThat(newId.mAdvertisingId).isEqualTo(GOOGLE_AD_ID);
+        assertThat(newId.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(newId.getIdWithPrefix(true)).isEqualTo("mopub:" + savedId.mMopubId);
+    }
+
+    @Test
+    public void constructor_withAmazon_withNoGoogle_shoulUseAmazonId() throws Exception {
+        AdvertisingId savedId = writeAdvertisingInfoToSharedPreferences(context, false);
+        setupAmazonAdvertisingInfo(false);
+
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+
+        subject = new MoPubIdentifier(context, idChangeListener);
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+
+        assertThat(oldId.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(oldId.mAdvertisingId).isEqualTo(savedId.mAdvertisingId);
+        assertThat(oldId.isDoNotTrack()).isEqualTo(savedId.isDoNotTrack());
+        assertThat(oldId.getIdWithPrefix(true)).isEqualTo(savedId.getIdWithPrefix(true));
+
+        assertThat(newId.isDoNotTrack()).isFalse();
+        assertThat(newId.mAdvertisingId).isEqualTo(AMAZON_AD_ID);
+        assertThat(newId.mMopubId).isEqualTo(savedId.mMopubId);
+    }
+
+    @Test
+    public void constructor_withGoogle_withNoAmazon_withDoNotTrackFalse_shoulUseGoogleId() throws Exception {
+        AdvertisingId savedId = writeAdvertisingInfoToSharedPreferences(context, true);
+        setupGooglePlayService(context, false);
+
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+
+        subject = new MoPubIdentifier(context, idChangeListener);
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+
+        // verify that oldId is from SharedPreferences
+        assertThat(oldId.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(oldId.mAdvertisingId).isEqualTo(savedId.mAdvertisingId);
+        assertThat(oldId.isDoNotTrack()).isTrue();
+        assertThat(oldId.isDoNotTrack()).isEqualTo(savedId.isDoNotTrack());
+        assertThat(oldId.getIdWithPrefix(true)).isEqualTo(savedId.getIdWithPrefix(true));
+        // verify that newId is from Google Play Services
+        assertThat(newId.isDoNotTrack()).isFalse();
+        assertThat(newId.mAdvertisingId).isEqualTo(GOOGLE_AD_ID);
+        assertThat(newId.mMopubId).isEqualTo(savedId.mMopubId);
+        assertThat(newId.getIdWithPrefix(true)).isEqualTo("ifa:" + GOOGLE_AD_ID);
+    }
+
+    @Test
+    public void sharedPreferences_WriteAndReadAdvertisingId_shouldMatch() throws Exception {
+        final long time = Calendar.getInstance().getTimeInMillis();
+        AdvertisingId adConfig = new AdvertisingId(TEST_IFA_ID,
+                TEST_MOPUB_ID,
+                true,
+                time);
+
+        // save to shared preferences
+        new Reflection.MethodBuilder(null, "writeIdToStorage")
+                .setAccessible()
+                .setStatic(MoPubIdentifier.class)
+                .addParam(Context.class, context)
+                .addParam(AdvertisingId.class, adConfig)
+                .execute();
+
+        // read from shared preferences
+        AdvertisingId adConfig2 = (AdvertisingId) new Reflection.MethodBuilder(null, "readIdFromStorage")
+                .setAccessible()
+                .setStatic(MoPubIdentifier.class)
+                .addParam(Context.class, context)
+                .execute();
+
+        assert null != adConfig2;
+        assertThat(adConfig2.mAdvertisingId).isEqualTo(TEST_IFA_ID);
+        assertThat(adConfig2.mMopubId).isEqualTo(TEST_MOPUB_ID);
+        assertThat(adConfig2.mDoNotTrack).isTrue();
+        assertThat(adConfig2.mLastRotation.getTimeInMillis()).isEqualTo(time);
+    }
+
+    @Test
+    public void isPlayServiceAvailable_whenGoogleAvailable_shouldCallGpsHelper_shouldReturnTrue() {
+        subject = new MoPubIdentifier(context, idChangeListener);
+        assertThat(subject.isPlayServicesAvailable()).isFalse();
+
+        setupGooglePlayService(context, false);
+
+        assertThat(subject.isPlayServicesAvailable()).isTrue();
+        verifyStatic();
+        GpsHelper.isPlayServicesAvailable(any(Context.class));
+    }
+
+    @Test
+    public void setAdvertisingInfo_whenCalledTwice_shouldCallInitializationListenerOnce_validateSavedAdvertisingIds() throws Exception {
+        final AdvertisingId adId1 = new AdvertisingId("ifa1", "mopub1", false, Calendar.getInstance().getTimeInMillis());
+        final AdvertisingId adId2 = new AdvertisingId("ifa2", "mopub2", false, Calendar.getInstance().getTimeInMillis());
+
+        writeAdvertisingInfoToSharedPreferences(context, false);
+        subject = new MoPubIdentifier(context);
+        subject.setIdChangeListener(idChangeListener);
+        subject.setInitializationListener(initializationListener);
+
+        subject.setAdvertisingInfo(adId1);
+
+        verify(idChangeListener).onIdChanged(any(AdvertisingId.class), any(AdvertisingId.class));
+        verify(initializationListener).onInitializationFinished();
+        AdvertisingId storedId = MoPubIdentifier.readIdFromStorage(context);
+        assertThat(adId1.equals(storedId)).isTrue();
+
+        reset(initializationListener);
+        reset(idChangeListener);
+
+        // call setAdvertisingInfo second time
+        subject.setAdvertisingInfo(adId2);
+
+        verify(idChangeListener).onIdChanged(adId1, adId2);
+        verify(initializationListener, never()).onInitializationFinished();
+        assertThat(adId2.equals(MoPubIdentifier.readIdFromStorage(context))).isTrue();
+    }
+
+    @Test
+    public void rotateMopubId_withExpiredOldId_shouldRotateMoPubId() {
+        subject = new MoPubIdentifier(context);
+        AdvertisingId originalId = AdvertisingId.generateExpiredAdvertisingId();
+        subject.setAdvertisingInfo(originalId);
+        subject.setIdChangeListener(idChangeListener);
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+
+        subject.rotateMopubId();
+
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+        assertThat(newId.isRotationRequired()).isFalse();
+        assertThat(originalId.equals(oldId)).isTrue();
+    }
+
+    @Test
+    public void rotateMopubId_withNotExpiredOldId_shouldNotRotateMoPubId() {
+        subject = new MoPubIdentifier(context);
+        AdvertisingId oldId = AdvertisingId.generateFreshAdvertisingId();
+        subject.setAdvertisingInfo(oldId);
+        subject.setIdChangeListener(idChangeListener);
+
+        subject.rotateMopubId();
+
+        verify(idChangeListener, never()).onIdChanged(any(AdvertisingId.class), any(AdvertisingId.class));
+        AdvertisingId newId = subject.getAdvertisingInfo();
+        assertThat(newId.isRotationRequired()).isFalse();
+        assertThat(oldId.equals(newId)).isTrue();
+    }
+
+    @Test
+    public void refreshAdvertisingInfoBackgroundThread_withExpiredId_withGoogle_withNoAmazon_shouldRotateMoPubId() {
+        AdvertisingId expiredId = AdvertisingId.generateExpiredAdvertisingId();
+        subject = new MoPubIdentifier(context);
+        setupGooglePlayService(context, true);
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        subject.setAdvertisingInfo(expiredId);
+        subject.setIdChangeListener(idChangeListener);
+
+        subject.refreshAdvertisingInfoBackgroundThread();
+
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+        assertThat(oldId.equals(expiredId)).isTrue();
+        assertThat(oldId.mMopubId.equals(newId.mMopubId)).isFalse(); // rotation
+        assertThat(newId.mAdvertisingId.equals(GOOGLE_AD_ID)).isTrue();
+        assertThat(newId.mDoNotTrack).isTrue();
+        assertThat(newId.isRotationRequired()).isFalse();
+    }
+
+    @Test
+    public void refreshAdvertisingInfoBackgroundThread_withExpiredId_withNoGoogle_withNoAmazon_shouldRotateMoPubId() {
+        AdvertisingId originalId = AdvertisingId.generateExpiredAdvertisingId();
+        subject = new MoPubIdentifier(context);
+        subject.setAdvertisingInfo(originalId);
+        subject.setIdChangeListener(idChangeListener);
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+
+        subject.refreshAdvertisingInfoBackgroundThread();
+
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+        assertThat(newId.isRotationRequired()).isFalse();
+        assertThat(originalId.equals(oldId)).isTrue();
+    }
+
+    @Test
+    public void refreshAdvertisingInfoBackgroundThread_withNotExpiredId_withGoogle_withNoAmazon_shouldNotRotateMoPubId() {
+        AdvertisingId freshId = AdvertisingId.generateFreshAdvertisingId();
+        subject = new MoPubIdentifier(context);
+        setupGooglePlayService(context, true);
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        subject.setAdvertisingInfo(freshId);
+        subject.setIdChangeListener(idChangeListener);
+
+        subject.refreshAdvertisingInfoBackgroundThread();
+
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+        assertThat(oldId.equals(freshId)).isTrue();
+        assertThat(oldId.mMopubId.equals(newId.mMopubId)).isTrue(); // no rotation
+        assertThat(newId.mAdvertisingId.equals(GOOGLE_AD_ID)).isTrue();
+        assertThat(newId.mDoNotTrack).isTrue();
+        assertThat(newId.isRotationRequired()).isFalse();
+    }
+
+    @Test
+    public void refreshAdvertisingInfoBackgroundThread_withExpiredId_withAmazon_withNoGoogle_shouldRotateMoPubId() {
+        AdvertisingId expiredId = AdvertisingId.generateExpiredAdvertisingId();
+        subject = new MoPubIdentifier(context);
+        setupAmazonAdvertisingInfo(true);
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        subject.setAdvertisingInfo(expiredId);
+        subject.setIdChangeListener(idChangeListener);
+
+        subject.refreshAdvertisingInfoBackgroundThread();
+
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+        assertThat(oldId.equals(expiredId)).isTrue();
+        assertThat(oldId.mMopubId.equals(newId.mMopubId)).isFalse(); // rotation
+        assertThat(newId.mAdvertisingId.equals(AMAZON_AD_ID)).isTrue();
+        assertThat(newId.mDoNotTrack).isTrue();
+        assertThat(newId.isRotationRequired()).isFalse();
+    }
+
+    @Test
+    public void refreshAdvertisingInfoBackgroundThread_withNotExpiredId_withAmazon_withNoGoogle_shouldNotRotateMoPubId() {
+        AdvertisingId freshId = AdvertisingId.generateFreshAdvertisingId();
+        subject = new MoPubIdentifier(context);
+        setupAmazonAdvertisingInfo(true);
+        ArgumentCaptor<AdvertisingId> oldIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        ArgumentCaptor<AdvertisingId> newIdClientCaptor = ArgumentCaptor.forClass(AdvertisingId.class);
+        subject.setAdvertisingInfo(freshId);
+        subject.setIdChangeListener(idChangeListener);
+
+        subject.refreshAdvertisingInfoBackgroundThread();
+
+        verify(idChangeListener).onIdChanged(oldIdClientCaptor.capture(), newIdClientCaptor.capture());
+        AdvertisingId oldId = oldIdClientCaptor.getValue();
+        AdvertisingId newId = newIdClientCaptor.getValue();
+        assertThat(oldId.equals(freshId)).isTrue();
+        assertThat(oldId.mMopubId.equals(newId.mMopubId)).isTrue(); // no rotation
+        assertThat(newId.mAdvertisingId.equals(AMAZON_AD_ID)).isTrue();
+        assertThat(newId.mDoNotTrack).isTrue();
+        assertThat(newId.isRotationRequired()).isFalse();
+    }
+
+    // Unit tests utility functions
+    public static void setupGooglePlayService(Context context, boolean limitAdTracking) {
+        PowerMockito.mockStatic(GpsHelper.class);
+        PowerMockito.when(GpsHelper.isPlayServicesAvailable(context)).thenReturn(true);
+        PowerMockito.when(GpsHelper.isLimitAdTrackingEnabled(context)).thenReturn(limitAdTracking);
+        PowerMockito.when(GpsHelper.fetchAdvertisingInfoSync(context)).thenReturn(new GpsHelper.AdvertisingInfo(GOOGLE_AD_ID, limitAdTracking));
+    }
+
+    public static void setupAmazonAdvertisingInfo(boolean limitAdTracking) {
+        ContentResolver resolver = RuntimeEnvironment.application.getContentResolver();
+        Settings.Secure.putInt(resolver, "limit_ad_tracking", limitAdTracking ? 1 : 0);
+        Settings.Secure.putString(resolver, "advertising_id", AMAZON_AD_ID);
+    }
+
+    // might be useful in other unit tests
+    public static void clearPreferences(@NonNull final Context context) {
+        try {
+            // clear shared preferences between tests
+            new Reflection.MethodBuilder(null, "clearStorage")
+                    .setAccessible()
+                    .setStatic(MoPubIdentifier.class)
+                    .addParam(Context.class, context)
+                    .execute();
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+    }
+
+    public static AdvertisingId writeAdvertisingInfoToSharedPreferences(Context context, boolean doNotTrack) throws Exception {
+        final long time = Calendar.getInstance().getTimeInMillis();
+        return writeAdvertisingInfoToSharedPreferences(context, doNotTrack, time);
+    }
+
+    private static AdvertisingId writeExpiredAdvertisingInfoToSharedPreferences(Context context, boolean doNotTrack) throws Exception {
+        final long time = Calendar.getInstance().getTimeInMillis() - AdvertisingId.ROTATION_TIME_MS;
+        return writeAdvertisingInfoToSharedPreferences(context, doNotTrack, time);
+    }
+
+    private static AdvertisingId writeAdvertisingInfoToSharedPreferences(Context context, boolean doNotTrack, long time) throws Exception {
+        AdvertisingId adConfig = new AdvertisingId(TEST_IFA_ID,
+                TEST_MOPUB_ID,
+                doNotTrack,
+                time);
+
+        // save to shared preferences
+        new Reflection.MethodBuilder(null, "writeIdToStorage")
+                .setAccessible()
+                .setStatic(MoPubIdentifier.class)
+                .addParam(Context.class, context)
+                .addParam(AdvertisingId.class, adConfig)
+                .execute();
+        return adConfig;
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/PersonalInfoDataTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/PersonalInfoDataTest.java
new file mode 100644
index 00000000..bc2e5450
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/PersonalInfoDataTest.java
@@ -0,0 +1,45 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+public class PersonalInfoDataTest {
+
+    Activity activity;
+    PersonalInfoData subject;
+
+    @Before
+    public void setUp() {
+        activity = Robolectric.buildActivity(Activity.class).get();
+        subject = new PersonalInfoData(activity, "adUnit");
+    }
+
+    @Test
+    public void replaceLanguageMacro_withIncorrectLanguageMacro_shouldKeepStringAsIs() {
+        String result = PersonalInfoData.replaceLanguageMacro(
+                "someurl%LANGUAGE%%://%%LANGUAGE%/someLANGUAGE",
+                activity, null);
+
+        assertThat(result).isEqualTo("someurl%LANGUAGE%%://%%LANGUAGE%/someLANGUAGE");
+    }
+
+    @Test
+    public void replaceLanguageMacro_withLanguageMacro_shouldReplaceLanguageMacro() {
+        String result = PersonalInfoData.replaceLanguageMacro("someurl://%%LANGUAGE%%/somepath",
+                activity, null);
+
+        assertThat(result).isEqualTo("someurl://en/somepath");
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/PersonalInfoManagerTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/PersonalInfoManagerTest.java
new file mode 100644
index 00000000..86a3fa65
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/PersonalInfoManagerTest.java
@@ -0,0 +1,822 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.content.Context;
+import android.os.SystemClock;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+import com.mopub.network.MoPubRequestQueue;
+import com.mopub.network.MoPubRequestQueueTest;
+import com.mopub.network.Networking;
+import com.mopub.volley.Request;
+
+import org.junit.After;
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.powermock.api.mockito.PowerMockito;
+import org.powermock.core.classloader.annotations.PowerMockIgnore;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.verifyZeroInteractions;
+import static org.mockito.Mockito.when;
+
+@RunWith(SdkTestRunner.class)
+@PowerMockIgnore({"org.mockito.*", "org.robolectric.*", "android.*", "org.json.*"})
+@Config(constants = BuildConfig.class)
+@PrepareForTest({ClientMetadata.class, Networking.class, AdvertisingId.class})
+public class PersonalInfoManagerTest {
+
+    private static int DEFAULT_TIME_MS = 300000;
+    private static int SHORT_TIME_MS = 150000;
+    private static int LONG_TIME_MS = 310000;
+
+    private Activity activity;
+    private PersonalInfoManager subject;
+    private PersonalInfoData personalInfoData;
+    private ConsentStatusChangeListener mockConsentStatusChangeListener;
+    private ClientMetadata mockClientMetadata;
+    private MoPubIdentifier mockMoPubIdentifier;
+    private AdvertisingId mockAdvertisingId;
+    private MoPubRequestQueue mockRequestQueue;
+
+    @Rule
+    public PowerMockRule rule = new PowerMockRule();
+
+    @Before
+    public void setUp() {
+        activity = Robolectric.buildActivity(Activity.class).get();
+
+        PowerMockito.mockStatic(ClientMetadata.class);
+        mockClientMetadata = PowerMockito.mock(ClientMetadata.class);
+        mockMoPubIdentifier = mock(MoPubIdentifier.class);
+        mockAdvertisingId = PowerMockito.mock(AdvertisingId.class);
+        PowerMockito.when(mockAdvertisingId.getIfaWithPrefix()).thenReturn("udid");
+
+        PowerMockito.when(ClientMetadata.getInstance(any(Context.class))).thenReturn(
+                mockClientMetadata);
+        PowerMockito.when(mockClientMetadata.getMoPubIdentifier()).thenReturn(mockMoPubIdentifier);
+        when(mockMoPubIdentifier.getAdvertisingInfo()).thenReturn(mockAdvertisingId);
+
+        PowerMockito.mockStatic(Networking.class);
+        mockRequestQueue = mock(MoPubRequestQueueTest.TestMoPubRequestQueue2.class);
+        when(Networking.getRequestQueue(any(Context.class))).thenReturn(mockRequestQueue);
+        when(Networking.getScheme()).thenReturn("https");
+
+        subject = new PersonalInfoManager(activity, "adunit", null);
+        personalInfoData = subject.getPersonalInfoData();
+        mockConsentStatusChangeListener = mock(ConsentStatusChangeListener.class);
+        subject.subscribeConsentStatusChangeListener(mockConsentStatusChangeListener);
+    }
+
+    @After
+    public void tearDown() {
+        final PersonalInfoData personalInfoData = subject.getPersonalInfoData();
+        personalInfoData.setConsentStatus(ConsentStatus.UNKNOWN);
+        personalInfoData.setLastSuccessfullySyncedConsentStatus(null);
+        personalInfoData.setConsentChangeReason(null);
+        personalInfoData.setForceGdprApplies(false);
+        personalInfoData.setUdid(null);
+        personalInfoData.setLastChangedMs(null);
+        personalInfoData.setConsentStatusBeforeDnt(null);
+        personalInfoData.setWhitelisted(false);
+        personalInfoData.setCurrentVendorListVersion(null);
+        personalInfoData.setCurrentVendorListLink(null);
+        personalInfoData.setCurrentPrivacyPolicyVersion(null);
+        personalInfoData.setCurrentPrivacyPolicyLink(null);
+        personalInfoData.setCurrentVendorListIabFormat(null);
+        personalInfoData.setCurrentVendorListIabHash(null);
+        personalInfoData.setConsentedVendorListVersion(null);
+        personalInfoData.setConsentedPrivacyPolicyVersion(null);
+        personalInfoData.setConsentedVendorListIabFormat(null);
+        personalInfoData.setExtras(null);
+        personalInfoData.setShouldReacquireConsent(false);
+        personalInfoData.setGdprApplies(null);
+        personalInfoData.writeToDisk();
+    }
+
+    @Test
+    public void shouldShowConsentDialog_withGdprAppliesNull_shouldReturnFalse() {
+        subject.getPersonalInfoData().setGdprApplies(null);
+
+        final boolean actual = subject.shouldShowConsentDialog();
+
+        assertThat(actual).isFalse();
+    }
+
+    @Test
+    public void shouldShowConsentDialog_withGdprAppliesFalse_shouldReturnFalse() {
+        subject.getPersonalInfoData().setGdprApplies(false);
+
+        final boolean actual = subject.shouldShowConsentDialog();
+
+        assertThat(actual).isFalse();
+    }
+
+    @Test
+    public void shouldShowConsentDialog_withGdprAppliesTrue_withVariousConsentStatuses_shouldReturnCorrectValue() {
+        personalInfoData.setGdprApplies(true);
+
+        personalInfoData.setConsentStatus(ConsentStatus.UNKNOWN);
+        assertThat(subject.shouldShowConsentDialog()).isTrue();
+
+        personalInfoData.setConsentStatus(ConsentStatus.POTENTIAL_WHITELIST);
+        assertThat(subject.shouldShowConsentDialog()).isFalse();
+
+        personalInfoData.setConsentStatus(ConsentStatus.DNT);
+        assertThat(subject.shouldShowConsentDialog()).isFalse();
+
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+        assertThat(subject.shouldShowConsentDialog()).isFalse();
+
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_NO);
+        assertThat(subject.shouldShowConsentDialog()).isFalse();
+    }
+
+    @Test
+    public void shouldShowConsentDialog_withGdprAppliesTrue_withShouldReacquireConsentTrue_withConsentStatusYes_withConsentStatusUnknown_shouldReturnTrue() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setShouldReacquireConsent(true);
+
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+        assertThat(subject.shouldShowConsentDialog()).isTrue();
+
+        personalInfoData.setConsentStatus(ConsentStatus.UNKNOWN);
+        assertThat(subject.shouldShowConsentDialog()).isTrue();
+    }
+
+    @Test
+    public void shouldShowConsentDialog_withGdprAppliesTrue_withShouldReacquireConsentTrue_withConsentStatusNotYesOrUnknown_shouldReturnFalse() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setShouldReacquireConsent(true);
+
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_NO);
+        assertThat(subject.shouldShowConsentDialog()).isFalse();
+
+        personalInfoData.setConsentStatus(ConsentStatus.POTENTIAL_WHITELIST);
+        assertThat(subject.shouldShowConsentDialog()).isFalse();
+
+        personalInfoData.setConsentStatus(ConsentStatus.DNT);
+        assertThat(subject.shouldShowConsentDialog()).isFalse();
+    }
+
+    @Test
+    public void canCollectPersonalInformation_withGdprAppliesNull_shouldReturnFalse() {
+        personalInfoData.setGdprApplies(null);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+
+        final boolean actual = subject.canCollectPersonalInformation();
+
+        assertThat(actual).isFalse();
+    }
+
+    @Test
+    public void canCollectPersonalInformation_withGdprAppliesFalse_shouldReturnTrue() {
+        personalInfoData.setGdprApplies(false);
+
+        assertThat(subject.canCollectPersonalInformation()).isTrue();
+
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_NO);
+        assertThat(subject.canCollectPersonalInformation()).isTrue();
+
+        personalInfoData.setConsentStatus(ConsentStatus.DNT);
+        assertThat(subject.canCollectPersonalInformation()).isTrue();
+
+        personalInfoData.setConsentStatus(ConsentStatus.POTENTIAL_WHITELIST);
+        assertThat(subject.canCollectPersonalInformation()).isTrue();
+
+        personalInfoData.setWhitelisted(true);
+        assertThat(subject.canCollectPersonalInformation()).isTrue();
+
+        // It should not matter what is set. GdprApplies false means can collect personal information
+        personalInfoData.setConsentedVendorListIabFormat("abc");
+        assertThat(subject.canCollectPersonalInformation()).isTrue();
+    }
+
+    @Test
+    public void gdprApplies_withForceGdprAppliesTrue_shouldReturnTrue() {
+        personalInfoData.setForceGdprApplies(true);
+
+        personalInfoData.setGdprApplies(null);
+        assertThat(subject.gdprApplies()).isTrue();
+
+        personalInfoData.setGdprApplies(true);
+        assertThat(subject.gdprApplies()).isTrue();
+
+        personalInfoData.setGdprApplies(false);
+        assertThat(subject.gdprApplies()).isTrue();
+
+        personalInfoData.setConsentStatus(ConsentStatus.DNT);
+        assertThat(subject.gdprApplies()).isTrue();
+    }
+
+    @Test
+    public void gdprApplies_withForceGdprAppliesFalse_shouldRespectGdprApplies() {
+        personalInfoData.setForceGdprApplies(false);
+
+        personalInfoData.setGdprApplies(null);
+        assertThat(subject.gdprApplies()).isNull();
+
+        personalInfoData.setGdprApplies(false);
+        assertThat(subject.gdprApplies()).isFalse();
+
+        personalInfoData.setGdprApplies(true);
+        assertThat(subject.gdprApplies()).isTrue();
+    }
+
+    @Test
+    public void forceGdprApplies_withGdprAppliesFalse_shouldForceGdprToTrue_shouldFiresOnConsentStatusChangeListeners() {
+        personalInfoData.setGdprApplies(false);
+        // Precondition just to verify gdprApplies is actually false for now
+        assertThat(subject.gdprApplies()).isFalse();
+        assertThat(subject.canCollectPersonalInformation()).isTrue();
+
+        subject.forceGdprApplies();
+
+        assertThat(subject.gdprApplies()).isTrue();
+        assertThat(personalInfoData.isForceGdprApplies()).isTrue();
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.UNKNOWN, false);
+    }
+
+    @Test
+    public void forceGdprApplies_withForceGdprAppliesAlreadySet_shouldDoNothing() {
+        personalInfoData.setGdprApplies(false);
+        personalInfoData.setForceGdprApplies(true);
+
+        subject.forceGdprApplies();
+
+        assertThat(subject.gdprApplies()).isTrue();
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+    }
+
+    @Test
+    public void forceGdprApplies_withGdprAppliesTrue_shouldSetForceGdprApplies_shouldNotFireOnConsentStatusChangeListeners() {
+        personalInfoData.setGdprApplies(true);
+        // Precondition just to verify gdprApplies is actually true for now
+        assertThat(subject.gdprApplies()).isTrue();
+        assertThat(subject.canCollectPersonalInformation()).isFalse();
+
+        subject.forceGdprApplies();
+
+        assertThat(subject.gdprApplies()).isTrue();
+        assertThat(personalInfoData.isForceGdprApplies()).isTrue();
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+    }
+
+    @Test
+    public void grantConsent_withWhitelistedApp_shouldTransitionToExplicitYes() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setWhitelisted(true);
+
+        subject.grantConsent();
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.EXPLICIT_YES, true);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_YES);
+    }
+
+    @Test
+    public void grantConsent_withNonWhitelistedApp_shouldTransitionToPotentialWhitelist() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setWhitelisted(false);
+
+        subject.grantConsent();
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.POTENTIAL_WHITELIST, false);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.POTENTIAL_WHITELIST);
+    }
+
+    @Test
+    public void grantConsent_withDnt_shouldDoNothing() {
+        when(mockAdvertisingId.isDoNotTrack()).thenReturn(true);
+
+        subject.grantConsent();
+
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.UNKNOWN);
+    }
+
+    @Test
+    public void revokeConsent_shouldSetConsentStatusToNo() {
+        subject.revokeConsent();
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.EXPLICIT_NO, false);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.EXPLICIT_NO);
+    }
+
+    @Test
+    public void revokeConsent_withDnt_shouldDoNothing() {
+        when(mockAdvertisingId.isDoNotTrack()).thenReturn(true);
+
+        subject.revokeConsent();
+
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.UNKNOWN);
+    }
+
+    @Test
+    public void changeConsentStateFromDialog_withYes_shouldChangeStatusToExplicitYes() {
+        personalInfoData.setGdprApplies(true);
+
+        subject.changeConsentStateFromDialog(ConsentStatus.EXPLICIT_YES);
+
+        verify(mockRequestQueue).add(any(Request.class));
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_YES);
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo(
+                ConsentChangeReason.GRANTED_BY_USER.getReason());
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.EXPLICIT_YES, true);
+    }
+
+    @Test
+    public void changeConsentStateFromDialog_withNo_shouldChangeStatusToExplicitNo() {
+        personalInfoData.setGdprApplies(true);
+
+        subject.changeConsentStateFromDialog(ConsentStatus.EXPLICIT_NO);
+
+        verify(mockRequestQueue).add(any(Request.class));
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_NO);
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo(
+                ConsentChangeReason.DENIED_BY_USER.getReason());
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.EXPLICIT_NO, false);
+    }
+
+    @Test
+    public void shouldMakeSyncRequest_withMostMajorCases_shouldReturnCorrectBoolean() {
+        boolean actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false, null, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false, null, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false, null, DEFAULT_TIME_MS,
+                "udid", false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false, null, DEFAULT_TIME_MS,
+                "udid", true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, false,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true, null, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true, null, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true, null, DEFAULT_TIME_MS,
+                "udid", false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true, null, DEFAULT_TIME_MS,
+                "udid", true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, null, true,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false, null, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false, null, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false, null, DEFAULT_TIME_MS,
+                "udid", false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false, null, DEFAULT_TIME_MS,
+                "udid", true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, false,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true, null, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true, null, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true, null, DEFAULT_TIME_MS,
+                "udid", false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true, null, DEFAULT_TIME_MS,
+                "udid", true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, false, true,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false, null, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false, null, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false, null, DEFAULT_TIME_MS,
+                "udid", false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false, null, DEFAULT_TIME_MS,
+                "udid", true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, false,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true, null, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true, null, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true, null, DEFAULT_TIME_MS,
+                "udid", false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true, null, DEFAULT_TIME_MS,
+                "udid", true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(false, true, true,
+                SystemClock.uptimeMillis() - SHORT_TIME_MS, DEFAULT_TIME_MS,
+                null, true);
+        assertThat(actual).isTrue();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(true, true, false,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+
+        actual = PersonalInfoManager.shouldMakeSyncRequest(true, true, true,
+                SystemClock.uptimeMillis() - LONG_TIME_MS, DEFAULT_TIME_MS,
+                null, false);
+        assertThat(actual).isFalse();
+    }
+
+    @Test
+    public void serverOverrideListener_onForceExplicitNo_withNullMessage_shouldChangeStatusToNo() {
+        personalInfoData.setGdprApplies(true);
+
+        subject.getServerOverrideListener().onForceExplicitNo(null);
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.EXPLICIT_NO, false);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.EXPLICIT_NO);
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo(
+                ConsentChangeReason.REVOKED_BY_SERVER.getReason());
+    }
+
+    @Test
+    public void serverOverrideListener_onForceExplicitNo_withAMessage_shouldChangeStatusToNo() {
+        personalInfoData.setGdprApplies(true);
+
+        subject.getServerOverrideListener().onForceExplicitNo("message");
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.EXPLICIT_NO, false);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.EXPLICIT_NO);
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("message");
+    }
+
+    @Test
+    public void serverOverrideListener_onInvalidateConsent_withNullMessage_shouldChangeStatusToUnknown() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+
+        subject.getServerOverrideListener().onInvalidateConsent(null);
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.EXPLICIT_YES,
+                ConsentStatus.UNKNOWN, false);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.UNKNOWN);
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo(
+                ConsentChangeReason.REACQUIRE_BY_SERVER.getReason());
+    }
+
+    @Test
+    public void serverOverrideListener_onInvalidateConsent_withAMessage_shouldChangeStatusToUnknown() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+
+        subject.getServerOverrideListener().onInvalidateConsent("message");
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.EXPLICIT_YES,
+                ConsentStatus.UNKNOWN, false);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.UNKNOWN);
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("message");
+    }
+
+    @Test
+    public void serverOverrideListener_onReacquireConsent_withNullMessage_shouldSetReacquireConsentFlag() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+
+        subject.getServerOverrideListener().onReacquireConsent(null);
+
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+        assertThat(personalInfoData.shouldReacquireConsent()).isTrue();
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_YES);
+        assertThat(personalInfoData.getConsentChangeReason()).isNull();
+    }
+
+    @Test
+    public void serverOverrideListener_onReacquireConsent_withAMessage_shouldSetReacquireConsentFlag_shouldSetConsentChangeReason() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+
+        subject.getServerOverrideListener().onReacquireConsent("message");
+
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+        assertThat(personalInfoData.shouldReacquireConsent()).isTrue();
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_YES);
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("message");
+    }
+
+    @Test
+    public void serverOverrideListener_onForceGdprApplies_shouldForceGdprApplies() {
+        personalInfoData.setGdprApplies(false);
+
+        subject.getServerOverrideListener().onForceGdprApplies();
+
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.UNKNOWN, false);
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.UNKNOWN);
+        assertThat(personalInfoData.isForceGdprApplies()).isTrue();
+        assertThat(subject.gdprApplies()).isTrue();
+    }
+
+    @Test
+    public void attemptStateTransition_withSameConsentStatus_shouldDoNothing() {
+        subject.attemptStateTransition(ConsentStatus.UNKNOWN, "no reason");
+
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+
+        personalInfoData.setCurrentPrivacyPolicyVersion("2");
+        personalInfoData.setConsentedPrivacyPolicyVersion("1");
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+        subject.attemptStateTransition(ConsentStatus.EXPLICIT_YES, "no reason");
+        verifyZeroInteractions(mockConsentStatusChangeListener);
+        assertThat(personalInfoData.getConsentedPrivacyPolicyVersion()).isEqualTo("1");
+    }
+
+    @Test
+    public void attemptStateTransition_withUnknownToYes_shouldSetConsentedVersions_shouldSetUdid() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setCurrentPrivacyPolicyVersion("1");
+        personalInfoData.setCurrentVendorListVersion("2");
+        personalInfoData.setCurrentVendorListIabFormat("3");
+
+        subject.attemptStateTransition(ConsentStatus.EXPLICIT_YES, "reason");
+
+        assertThat(personalInfoData.getConsentedPrivacyPolicyVersion()).isEqualTo("1");
+        assertThat(personalInfoData.getConsentedVendorListVersion()).isEqualTo("2");
+        assertThat(personalInfoData.getConsentedVendorListIabFormat()).isEqualTo("3");
+        assertThat(personalInfoData.getUdid()).isEqualTo("udid");
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("reason");
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_YES);
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.EXPLICIT_YES, true);
+    }
+
+    @Test
+    public void attemptStateTransition_withPotentialWhitelistToYes_shouldNotSetConsentedVersions() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.POTENTIAL_WHITELIST);
+        personalInfoData.setCurrentPrivacyPolicyVersion("1");
+        personalInfoData.setCurrentVendorListVersion("2");
+        personalInfoData.setCurrentVendorListIabFormat("3");
+
+        subject.attemptStateTransition(ConsentStatus.EXPLICIT_YES, "reason");
+
+        assertThat(personalInfoData.getConsentedPrivacyPolicyVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListIabFormat()).isEqualTo(null);
+        assertThat(personalInfoData.getUdid()).isEqualTo("udid");
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("reason");
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_YES);
+        verify(mockConsentStatusChangeListener).onConsentStateChange(
+                ConsentStatus.POTENTIAL_WHITELIST,
+                ConsentStatus.EXPLICIT_YES, true);
+    }
+
+    @Test
+    public void attemptStateTransition_withYesToDnt_shouldClearPersonalDataExceptUdid() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+        personalInfoData.setConsentedPrivacyPolicyVersion("1");
+        personalInfoData.setConsentedVendorListVersion("2");
+        personalInfoData.setConsentedVendorListIabFormat("3");
+        personalInfoData.setUdid("udid");
+
+        subject.attemptStateTransition(ConsentStatus.DNT, "reason");
+
+        assertThat(personalInfoData.getConsentedPrivacyPolicyVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListIabFormat()).isEqualTo(null);
+        assertThat(personalInfoData.getUdid()).isEqualTo("udid");
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("reason");
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.DNT);
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.EXPLICIT_YES,
+                ConsentStatus.DNT, false);
+    }
+
+    @Test
+    public void attemptStateTransition_withUnknownToDnt() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+        personalInfoData.setCurrentPrivacyPolicyVersion("1");
+        personalInfoData.setCurrentVendorListVersion("2");
+        personalInfoData.setCurrentVendorListIabFormat("3");
+
+        subject.attemptStateTransition(ConsentStatus.DNT, "reason");
+
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("reason");
+        assertThat(personalInfoData.getConsentedPrivacyPolicyVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListIabFormat()).isEqualTo(null);
+        assertThat(personalInfoData.getUdid()).isNull();
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.DNT);
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.EXPLICIT_YES,
+                ConsentStatus.DNT, false);
+    }
+
+    @Test
+    public void attemptStateTransition_withYesToNo_shouldClearPersonalDataExceptUdid() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setConsentStatus(ConsentStatus.EXPLICIT_YES);
+        personalInfoData.setConsentedPrivacyPolicyVersion("1");
+        personalInfoData.setConsentedVendorListVersion("2");
+        personalInfoData.setConsentedVendorListIabFormat("3");
+        personalInfoData.setUdid("udid");
+
+        subject.attemptStateTransition(ConsentStatus.EXPLICIT_NO, "reason");
+
+        assertThat(personalInfoData.getConsentedPrivacyPolicyVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListVersion()).isEqualTo(null);
+        assertThat(personalInfoData.getConsentedVendorListIabFormat()).isEqualTo(null);
+        assertThat(personalInfoData.getUdid()).isEqualTo("udid");
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("reason");
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(ConsentStatus.EXPLICIT_NO);
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.EXPLICIT_YES,
+                ConsentStatus.EXPLICIT_NO, false);
+    }
+
+    @Test
+    public void attemptStateTransition_withUnknownToPotentialWhitelist_shouldSetConsentedVersions_shouldSetUdid() {
+        personalInfoData.setGdprApplies(true);
+        personalInfoData.setCurrentPrivacyPolicyVersion("1");
+        personalInfoData.setCurrentVendorListVersion("2");
+        personalInfoData.setCurrentVendorListIabFormat("3");
+
+        subject.attemptStateTransition(ConsentStatus.POTENTIAL_WHITELIST, "reason");
+
+        assertThat(personalInfoData.getConsentedPrivacyPolicyVersion()).isEqualTo("1");
+        assertThat(personalInfoData.getConsentedVendorListVersion()).isEqualTo("2");
+        assertThat(personalInfoData.getConsentedVendorListIabFormat()).isEqualTo("3");
+        assertThat(personalInfoData.getUdid()).isNull();
+        assertThat(personalInfoData.getConsentChangeReason()).isEqualTo("reason");
+        assertThat(subject.getPersonalInfoConsentStatus()).isEqualTo(
+                ConsentStatus.POTENTIAL_WHITELIST);
+        verify(mockConsentStatusChangeListener).onConsentStateChange(ConsentStatus.UNKNOWN,
+                ConsentStatus.POTENTIAL_WHITELIST, false);
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/privacy/SyncUrlGeneratorTest.java b/mopub-sdk/src/test/java/com/mopub/common/privacy/SyncUrlGeneratorTest.java
new file mode 100644
index 00000000..abd1f3e7
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/privacy/SyncUrlGeneratorTest.java
@@ -0,0 +1,133 @@
+package com.mopub.common.privacy;
+
+import android.app.Activity;
+import android.content.Context;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+import com.mopub.nativeads.NativeUrlGeneratorTest;
+import com.mopub.network.PlayServicesUrlRewriter;
+
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.powermock.api.mockito.PowerMockito;
+import org.powermock.core.classloader.annotations.PowerMockIgnore;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.mockito.Matchers.any;
+import static org.powermock.api.mockito.PowerMockito.mock;
+import static org.powermock.api.mockito.PowerMockito.when;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+@PowerMockIgnore({"org.mockito.*", "org.robolectric.*", "android.*", "org.json.*"})
+@PrepareForTest(ClientMetadata.class)
+public class SyncUrlGeneratorTest {
+    private static final String APP_VERSION = "appVersion";
+    private static final String AD_UNIT = "adUnit";
+    private static final String UDID = "udid";
+    private static final String LAST_CHANGED_MS = "lastChangedMs";
+    private static final String CONSENT_CHANGE_REASON = "consentChangeReason";
+    private static final String CONSENTED_VENDOR_LIST_VERSION = "consentedVendorListVersion";
+    private static final String CONSENTED_PRIVACY_POLICY_VERSION = "consentedPrivacyPolicyVersion";
+    private static final String IAB_HASH = "iabHash";
+    private static final String EXTRAS = "extras";
+
+    private Context context;
+    private SyncUrlGenerator subject;
+
+    @Rule
+    public PowerMockRule rule = new PowerMockRule();
+
+    @Before
+    public void setUp() {
+        context = Robolectric.buildActivity(Activity.class).get();
+        subject = new SyncUrlGenerator(context, ConsentStatus.UNKNOWN.getValue());
+
+        ClientMetadata clientMetadata = mock(ClientMetadata.class);
+        when(clientMetadata.getAppVersion()).thenReturn(APP_VERSION);
+
+        PowerMockito.mockStatic(ClientMetadata.class);
+        when(ClientMetadata.getInstance(any(Context.class))).thenReturn(clientMetadata);
+    }
+
+    @Test
+    public void generateUrlString_withAllParams_shouldGenerateFullUrl() {
+        subject.withAdUnitId(AD_UNIT);
+        subject.withUdid(UDID);
+        subject.withGdprApplies(true);
+        subject.withForceGdprApplies(true);
+        subject.withForceGdprAppliesChanged(true);
+        subject.withLastChangedMs(LAST_CHANGED_MS);
+        subject.withLastConsentStatus(ConsentStatus.UNKNOWN);
+        subject.withConsentChangeReason(CONSENT_CHANGE_REASON);
+        subject.withConsentedVendorListVersion(CONSENTED_VENDOR_LIST_VERSION);
+        subject.withConsentedPrivacyPolicyVersion(CONSENTED_PRIVACY_POLICY_VERSION);
+        subject.withCachedVendorListIabHash(IAB_HASH);
+        subject.withExtras(EXTRAS);
+
+        final String url = subject.generateUrlString("hostname");
+
+        assertThat(url).startsWith(
+                Constants.HTTPS + "://" + "hostname" + Constants.GDPR_SYNC_HANDLER);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "id")).isEqualTo(AD_UNIT);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "nv")).isEqualTo(
+                MoPub.SDK_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "udid")).isEqualTo(
+                UDID);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "current_consent_status")).isEqualTo(ConsentStatus.UNKNOWN.getValue());
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "gdpr_applies")).isEqualTo("1");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "force_gdpr_applies")).isEqualTo("1");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "forced_gdpr_applies_changed")).isEqualTo("1");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "last_changed_ms")).isEqualTo(LAST_CHANGED_MS);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "consent_change_reason")).isEqualTo(CONSENT_CHANGE_REASON);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "consented_vendor_list_version")).isEqualTo(CONSENTED_VENDOR_LIST_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "consented_privacy_policy_version")).isEqualTo(CONSENTED_PRIVACY_POLICY_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "cached_vendor_list_iab_hash")).isEqualTo(IAB_HASH);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "extras")).isEqualTo(EXTRAS);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url,
+                "dnt")).isEqualTo(PlayServicesUrlRewriter.DO_NOT_TRACK_TEMPLATE);
+    }
+
+    @Test
+    public void generateUrlString_withMinimumParams_shouldGenerateValidUrl() {
+        final String url = subject.generateUrlString("minurl");
+
+        assertThat(url).isEqualTo("https://minurl/m/gdpr_sync?nv=" + MoPub.SDK_VERSION +
+        "&current_consent_status=unknown&force_gdpr_applies=0&dnt=mp_tmpl_do_not_track");
+    }
+
+    @Test
+    public void generateUrlString_withExtrasThatShouldBeUrlEncoded_shouldGenerateValidUrl() {
+        subject = new SyncUrlGenerator(context, ConsentStatus.EXPLICIT_YES.getValue());
+        subject.withExtras("!@#$%^&*()_;'[]{}|\\");
+
+        final String url = subject.generateUrlString("host");
+
+        assertThat(url).isEqualTo("https://host/m/gdpr_sync?nv=" + MoPub.SDK_VERSION +
+                "&current_consent_status=explicit_yes" +
+                "&extras=!%40%23%24%25%5E%26*()_%3B'%5B%5D%7B%7D%7C%5C" +
+                "&force_gdpr_applies=0&dnt=mp_tmpl_do_not_track");
+    }
+
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/test/support/SdkTestRunner.java b/mopub-sdk/src/test/java/com/mopub/common/test/support/SdkTestRunner.java
index 7a5f2917..a4d42c0a 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/test/support/SdkTestRunner.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/test/support/SdkTestRunner.java
@@ -3,14 +3,10 @@
 import com.mopub.common.CacheService;
 import com.mopub.common.ClientMetadata;
 import com.mopub.common.MoPub;
-import com.mopub.common.MoPubHttpUrlConnection;
 import com.mopub.common.Preconditions;
-import com.mopub.common.event.EventDispatcher;
-import com.mopub.common.event.MoPubEvents;
 import com.mopub.common.factories.MethodBuilderFactory;
 import com.mopub.common.util.AsyncTasks;
 import com.mopub.common.util.DateAndTime;
-import com.mopub.common.util.Reflection;
 import com.mopub.common.util.test.support.ShadowAsyncTasks;
 import com.mopub.common.util.test.support.ShadowMoPubHttpUrlConnection;
 import com.mopub.common.util.test.support.ShadowReflection;
@@ -42,35 +38,18 @@
 import org.junit.runners.model.InitializationError;
 import org.mockito.MockitoAnnotations;
 import org.robolectric.DefaultTestLifecycle;
-import org.robolectric.RobolectricGradleTestRunner;
+import org.robolectric.RobolectricTestRunner;
 import org.robolectric.TestLifecycle;
-import org.robolectric.annotation.Config;
-import org.robolectric.internal.bytecode.InstrumentationConfiguration;
-import org.robolectric.manifest.AndroidManifest;
-import org.robolectric.res.FileFsFile;
-import org.robolectric.res.FsFile;
-import org.robolectric.util.concurrent.RoboExecutorService;
+import org.robolectric.android.util.concurrent.RoboExecutorService;
 
 import static com.mopub.common.MoPub.LocationAwareness;
-import static org.mockito.Mockito.mock;
 
-public class SdkTestRunner extends RobolectricGradleTestRunner {
+public class SdkTestRunner extends RobolectricTestRunner {
 
     public SdkTestRunner(Class<?> testClass) throws InitializationError {
         super(testClass);
     }
 
-    @Override
-    public InstrumentationConfiguration createClassLoaderConfig() {
-        InstrumentationConfiguration.Builder builder = InstrumentationConfiguration.newBuilder();
-        builder.addInstrumentedClass(AsyncTasks.class.getName());
-        builder.addInstrumentedClass(MoPubHttpUrlConnection.class.getName());
-        builder.addInstrumentedClass(Reflection.class.getName());
-        // To mitigate: https://github.com/robolectric/robolectric/issues/2129
-        builder.addInstrumentedPackage("org.xyz.testMp");
-        return builder.build();
-    }
-
     @Override
     protected Class<? extends TestLifecycle> getTestLifecycleClass() {
         return TestLifeCycleWithInjection.class;
@@ -102,7 +81,6 @@ public void prepareTest(Object test) {
             ShadowAsyncTasks.reset();
             ShadowMoPubHttpUrlConnection.reset();
             ShadowReflection.reset();
-            MoPubEvents.setEventDispatcher(mock(EventDispatcher.class));
             MoPub.setLocationAwareness(LocationAwareness.NORMAL);
             MoPub.setLocationPrecision(6);
 
@@ -112,26 +90,4 @@ public void prepareTest(Object test) {
             CacheService.clearAndNullCaches();
         }
     }
-
-    // custom AppManifest logic adapted from:
-    // https://gist.github.com/venator85/282df3677af9ecac56e5e4b91471cd8f
-    @Override
-    protected AndroidManifest getAppManifest(Config config) {
-        final AndroidManifest appManifest = super.getAppManifest(config);
-
-        if (appManifest.getAndroidManifestFile().exists()) {
-            return appManifest;
-        }
-
-        final FsFile androidManifestFile = FileFsFile.from(getModuleRootPath(config),
-                appManifest.getAndroidManifestFile().getPath()
-                        .replace("manifests/full", "manifests/aapt"));
-        return new AndroidManifest(androidManifestFile, appManifest.getResDirectory(),
-                appManifest.getAssetsDirectory());
-    }
-
-    private String getModuleRootPath(Config config) {
-        final String moduleRoot = config.constants().getResource("").toString().replace("file:", "");
-        return moduleRoot.substring(0, moduleRoot.indexOf("/build"));
-    }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/test/support/UrlSupport.java b/mopub-sdk/src/test/java/com/mopub/common/test/support/UrlSupport.java
new file mode 100644
index 00000000..49df0663
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/common/test/support/UrlSupport.java
@@ -0,0 +1,46 @@
+package com.mopub.common.test.support;
+
+import android.net.Uri;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import java.util.HashMap;
+import java.util.Map;
+
+public class UrlSupport {
+    public static final String SCHEME_KEY = "$scheme_key";
+    public static final String USER_INFO_KEY = "$user_info_key";
+    public static final String HOST_KEY = "$host_key";
+    public static final String PORT_KEY = "$port_key";
+    public static final String PATH_KEY = "$path_key";
+    public static final String FRAGMENT_KEY = "$fragment_key";
+
+    public static Map<String, String> urlToMap(final String url) {
+        Map<String, String> map = new HashMap<>();
+        if (TextUtils.isEmpty(url)) {
+            return map;
+        }
+
+        final Uri uri = Uri.parse(url);
+        addPair(map, SCHEME_KEY, uri.getScheme());
+        addPair(map, USER_INFO_KEY, uri.getUserInfo());
+        addPair(map, HOST_KEY, uri.getHost());
+        addPair(map, PORT_KEY, uri.getPort() != -1 ? String.valueOf(uri.getPort()) : "");
+        addPair(map, PATH_KEY, uri.getPath());
+        addPair(map, FRAGMENT_KEY, uri.getFragment());
+
+        for (final String queryParam : uri.getQueryParameterNames()) {
+            map.put(queryParam, TextUtils.join(",", uri.getQueryParameters(queryParam)));
+        }
+        return map;
+    }
+
+    private static void addPair(@NonNull Map<String, String> map, @Nullable String key, @Nullable String value) {
+        if (TextUtils.isEmpty(key) || TextUtils.isEmpty(value)) {
+            return;
+        }
+
+        map.put(key, value);
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java
index 3c8af8cd..fa129c0d 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/DrawablesTest.java
@@ -2,18 +2,22 @@
 
 import android.app.Activity;
 
+import com.mopub.common.test.support.SdkTestRunner;
+
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.robolectric.RobolectricTestRunner;
+import org.robolectric.Robolectric;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 
-@RunWith(RobolectricTestRunner.class)
+@RunWith(SdkTestRunner.class)
 public class DrawablesTest {
     @Test
     public void createDrawable_shouldNotCacheDrawables() throws Exception {
-        assertThat(Drawables.BACKGROUND.createDrawable(new Activity()))
-                .isNotSameAs(Drawables.BACKGROUND.createDrawable(new Activity()));
+        assertThat(Drawables.BACKGROUND.createDrawable(
+                Robolectric.buildActivity(Activity.class).create().get())).isNotSameAs(
+                Drawables.BACKGROUND.createDrawable(
+                        Robolectric.buildActivity(Activity.class).create().get()));
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/IntentsTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/IntentsTest.java
index dd4a3ea5..52737211 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/IntentsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/IntentsTest.java
@@ -11,15 +11,15 @@
 import com.mopub.common.MoPub;
 import com.mopub.common.MoPub.BrowserAgent;
 import com.mopub.common.MoPubBrowser;
+import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.exceptions.IntentNotResolvableException;
 import com.mopub.exceptions.UrlParseException;
 
+import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
-import org.robolectric.RobolectricTestRunner;
-import org.robolectric.RuntimeEnvironment;
 import org.robolectric.shadows.ShadowApplication;
 
 import java.util.ArrayList;
@@ -30,8 +30,9 @@
 import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.stub;
+import static org.robolectric.Shadows.shadowOf;
 
-@RunWith(RobolectricTestRunner.class)
+@RunWith(SdkTestRunner.class)
 public class IntentsTest {
     private Activity activityContext;
     private Context applicationContext;
@@ -43,6 +44,11 @@ public void setUp() {
         MoPub.resetBrowserAgent();
     }
 
+    @After
+    public void tearDown() {
+        MoPub.resetBrowserAgent();
+    }
+
     @Test
     public void startActivity_withActivityContext_shouldStartActivityWithNoNewFlags() throws IntentNotResolvableException {
         Intents.startActivity(activityContext, new Intent());
@@ -53,7 +59,7 @@ public void startActivity_withActivityContext_shouldStartActivityWithNoNewFlags(
 
     @Test
     public void getStartActivityIntent_withActivityContext_shouldReturnIntentWithoutNewTaskFlag() throws Exception {
-        Context context = new Activity();
+        Context context = Robolectric.buildActivity(Activity.class).create().get();
 
         final Intent intent = Intents.getStartActivityIntent(context, MoPubBrowser.class, null);
 
@@ -64,7 +70,8 @@ public void getStartActivityIntent_withActivityContext_shouldReturnIntentWithout
 
     @Test
     public void getStartActivityIntent_withApplicationContext_shouldReturnIntentWithNewTaskFlag() throws Exception {
-        Context context = new Activity().getApplicationContext();
+        Context context = Robolectric.buildActivity(Activity.class)
+                .create().get().getApplicationContext();
 
         final Intent intent = Intents.getStartActivityIntent(context, MoPubBrowser.class, null);
 
@@ -75,7 +82,7 @@ public void getStartActivityIntent_withApplicationContext_shouldReturnIntentWith
 
     @Test
     public void getStartActivityIntent_withBundle_shouldReturnIntentWithExtras() throws Exception {
-        Context context = new Activity();
+        Context context = Robolectric.buildActivity(Activity.class).create().get();
         Bundle bundle = new Bundle();
         bundle.putString("arbitrary key", "even more arbitrary value");
 
@@ -83,7 +90,8 @@ public void getStartActivityIntent_withBundle_shouldReturnIntentWithExtras() thr
 
         assertThat(intent.getComponent().getClassName()).isEqualTo(MoPubBrowser.class.getName());
         assertThat(Utils.bitMaskContainsFlag(intent.getFlags(), FLAG_ACTIVITY_NEW_TASK)).isFalse();
-        assertThat(intent.getExtras()).isEqualTo(bundle);
+        assertThat(intent.getExtras().size()).isEqualTo(1);
+        assertThat(intent.getExtras().get("arbitrary key")).isEqualTo("even more arbitrary value");
     }
 
     @Test
@@ -293,7 +301,7 @@ public void getPlayStoreUri_shouldNotBlowUpWithEmptyPackage() throws Exception {
     }
 
     private void makeUrlResolvable(String url) {
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(
+        shadowOf(activityContext.getPackageManager()).addResolveInfoForIntent(
                 new Intent(Intent.ACTION_VIEW, Uri.parse(url)), new ResolveInfo());
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/ManifestUtilsTest.java b/mopub-sdk/src/test/java/com/mopub/common/util/ManifestUtilsTest.java
index cfaa764b..26a4300f 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/ManifestUtilsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/ManifestUtilsTest.java
@@ -23,7 +23,6 @@
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
 import org.robolectric.RobolectricTestRunner;
-import org.robolectric.RuntimeEnvironment;
 import org.robolectric.shadows.ShadowLog;
 import org.robolectric.shadows.ShadowToast;
 
@@ -37,6 +36,7 @@
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.spy;
 import static org.mockito.Mockito.when;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(RobolectricTestRunner.class)
 public class ManifestUtilsTest {
@@ -94,13 +94,29 @@ public void checkNativeSdkActivitiesDeclared_shouldIncludeOneActivityDeclaration
         );
     }
 
+    @Test
+    public void checSdkActivitiesDeclared_shouldIncludeOneActivityDeclaration() throws Exception {
+        ShadowLog.setupLogging();
+
+        ManifestUtils.checkGdprActivitiesDeclared(context);
+
+        assertLogIncludes("com.mopub.common.privacy.ConsentDialogActivity");
+        assertLogDoesntInclude(
+                "com.mopub.mobileads.MoPubActivity",
+                "com.mopub.mobileads.MraidActivity",
+                "com.mopub.mobileads.MraidVideoPlayerActivity",
+                "com.mopub.mobileads.RewardedMraidActivity",
+                "com.mopub.common.MoPubBrowser"
+        );
+    }
+
     @Test
     public void displayWarningForMissingActivities_withAllActivitiesDeclared_shouldNotShowLogOrToast() throws Exception {
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
 
         ShadowLog.setupLogging();
         setDebugMode(true);
@@ -114,8 +130,8 @@ public void displayWarningForMissingActivities_withAllActivitiesDeclared_shouldN
     @Test
     public void displayWarningForMissingActivities_withoutInterstitialModule_withoutInterstitialActivitiesDeclared_shouldNotShowLogOrToast() throws Exception {
         removeInterstitialModule();
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
 
         ShadowLog.setupLogging();
         setDebugMode(true);
@@ -128,10 +144,10 @@ public void displayWarningForMissingActivities_withoutInterstitialModule_without
 
     @Test
      public void displayWarningForMissingActivities_withOneMissingActivity_shouldLogOnlyThatOne() throws Exception {
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
         // Here, we leave out MoPubBrowser on purpose
 
         ShadowLog.setupLogging();
@@ -194,11 +210,11 @@ public void displayWarningForMisconfiguredActivities_withAllActivitiesConfigured
         when(mockActivitiyConfigCheck.hasFlag(any(Class.class), anyInt(), eq(ActivityInfo.CONFIG_SCREEN_SIZE))).thenReturn(true);
         ManifestUtils.setFlagCheckUtil(mockActivitiyConfigCheck);
 
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
 
         ShadowLog.setupLogging();
         setDebugMode(true);
@@ -228,11 +244,11 @@ public Object answer(InvocationOnMock invocationOnMock) throws Throwable {
         when(mockActivitiyConfigCheck.hasFlag(any(Class.class), anyInt(), eq(ActivityInfo.CONFIG_SCREEN_SIZE))).thenReturn(true);
         ManifestUtils.setFlagCheckUtil(mockActivitiyConfigCheck);
 
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, RewardedMraidActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MraidVideoPlayerActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubBrowser.class), mockResolveInfo);
 
         ShadowLog.setupLogging();
 
@@ -260,7 +276,7 @@ public void displayWarningForMisconfiguredActivities_withOneMisconfiguredActivit
         when(mockActivitiyConfigCheck.hasFlag(any(Class.class), anyInt(), eq(ActivityInfo.CONFIG_SCREEN_SIZE))).thenReturn(false);
         ManifestUtils.setFlagCheckUtil(mockActivitiyConfigCheck);
 
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
 
         ShadowLog.setupLogging();
 
@@ -280,7 +296,7 @@ public void displayWarningForMisconfiguredActivities_withMisconfiguredActivities
         when(mockActivitiyConfigCheck.hasFlag(any(Class.class), anyInt(), eq(ActivityInfo.CONFIG_SCREEN_SIZE))).thenReturn(false);
         ManifestUtils.setFlagCheckUtil(mockActivitiyConfigCheck);
 
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
 
         setDebugMode(true);
 
@@ -300,7 +316,7 @@ public void displayWarningForMisconfiguredActivities_withMisconfiguredActivities
         when(mockActivitiyConfigCheck.hasFlag(any(Class.class), anyInt(), eq(ActivityInfo.CONFIG_SCREEN_SIZE))).thenReturn(false);
         ManifestUtils.setFlagCheckUtil(mockActivitiyConfigCheck);
 
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(context, MoPubActivity.class), mockResolveInfo);
 
         setDebugMode(false);
 
diff --git a/mopub-sdk/src/test/java/com/mopub/common/util/test/support/ShadowReflection.java b/mopub-sdk/src/test/java/com/mopub/common/util/test/support/ShadowReflection.java
index a2971b0f..651f0990 100644
--- a/mopub-sdk/src/test/java/com/mopub/common/util/test/support/ShadowReflection.java
+++ b/mopub-sdk/src/test/java/com/mopub/common/util/test/support/ShadowReflection.java
@@ -8,7 +8,8 @@
 import org.robolectric.annotation.Implements;
 import org.robolectric.util.ReflectionHelpers;
 
-import static org.robolectric.internal.Shadow.directlyOn;
+import static org.robolectric.shadow.api.Shadow.directlyOn;
+
 
 @Implements(Reflection.class)
 public class ShadowReflection {
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java
index b28dc1c4..29dc5dfa 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdTypeTranslatorTest.java
@@ -8,6 +8,8 @@
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.ResponseHeader;
 
+import org.json.JSONException;
+import org.json.JSONObject;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -15,6 +17,7 @@
 import org.robolectric.annotation.Config;
 
 import java.util.HashMap;
+import java.util.Map;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Mockito.mock;
@@ -26,7 +29,7 @@
     private String customEventName;
     private MoPubView moPubView;
     private MoPubInterstitial.MoPubInterstitialView moPubInterstitialView;
-    HashMap<String, String> headers;
+    JSONObject headers;
 
     @Before
     public void setUp() throws Exception {
@@ -37,7 +40,8 @@ public void setUp() throws Exception {
         stub(moPubView.getContext()).toReturn(context);
         stub(moPubInterstitialView.getContext()).toReturn(context);
 
-        headers = new HashMap<String, String>();
+        Map<String, String> stringHeaders = new HashMap<String, String>();
+        headers = new JSONObject(stringHeaders);
     }
 
     @Test
@@ -104,7 +108,7 @@ public void getCustomEventName_shouldBeVastInterstitial() {
     }
 
     @Test
-    public void getCustomEventName_shouldBeCustomClassName() {
+    public void getCustomEventName_shouldBeCustomClassName() throws JSONException {
         headers.put(ResponseHeader.CUSTOM_EVENT_NAME.getKey(), "com.example.CustomClass");
         customEventName = AdTypeTranslator.getCustomEventName(AdFormat.BANNER, AdType.CUSTOM, null, headers);
 
@@ -112,10 +116,10 @@ public void getCustomEventName_shouldBeCustomClassName() {
     }
 
     @Test
-    public void getCustomEventName_whenNameNotInHeaders_shouldBeNull() {
+    public void getCustomEventName_whenNameNotInHeaders_shouldBeEmpty() {
         customEventName = AdTypeTranslator.getCustomEventName(AdFormat.BANNER, AdType.CUSTOM, null, headers);
 
-        assertThat(customEventName).isNull();
+        assertThat(customEventName).isEmpty();
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java
index 2cd5ee27..886f0441 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/AdViewControllerTest.java
@@ -3,15 +3,25 @@
 import android.Manifest;
 import android.app.Activity;
 import android.content.Context;
+import android.location.Location;
 import android.net.ConnectivityManager;
+import android.net.Uri;
+import android.telephony.TelephonyManager;
+import android.text.TextUtils;
 import android.view.Gravity;
 import android.view.View;
 import android.widget.FrameLayout;
 
 import com.mopub.common.AdFormat;
+import com.mopub.common.MoPub;
+import com.mopub.common.SdkConfiguration;
+import com.mopub.common.privacy.ConsentStatus;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Reflection;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
+import com.mopub.mobileads.test.support.MoPubShadowConnectivityManager;
+import com.mopub.mobileads.test.support.MoPubShadowTelephonyManager;
 import com.mopub.mobileads.test.support.ThreadUtils;
 import com.mopub.network.AdRequest;
 import com.mopub.network.AdResponse;
@@ -56,7 +66,7 @@
 
 
 @RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
+@Config(constants = BuildConfig.class, shadows = {MoPubShadowTelephonyManager.class, MoPubShadowConnectivityManager.class})
 public class AdViewControllerTest {
 
     private static final int[] HTML_ERROR_CODES = new int[]{400, 401, 402, 403, 404, 405, 407, 408,
@@ -66,15 +76,29 @@
     @Mock private MoPubView mockMoPubView;
     @Mock private MoPubRequestQueue mockRequestQueue;
     private Reflection.MethodBuilder methodBuilder;
+    private MoPubShadowTelephonyManager shadowTelephonyManager;
+    private MoPubShadowConnectivityManager shadowConnectivityManager;
 
     private AdResponse response;
     private Activity activity;
 
+    private PersonalInfoManager mockPersonalInfoManager;
+
     @Before
-    public void setup() {
+    public void setup() throws Exception {
         activity = Robolectric.buildActivity(Activity.class).create().get();
         Shadows.shadowOf(activity).grantPermissions(android.Manifest.permission.ACCESS_NETWORK_STATE);
 
+        MoPub.initializeSdk(activity, new SdkConfiguration.Builder("adunit").build(), null);
+
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
+        when(mockPersonalInfoManager.getPersonalInfoConsentStatus()).thenReturn(ConsentStatus.UNKNOWN);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         when(mockMoPubView.getAdFormat()).thenReturn(AdFormat.BANNER);
         when(mockMoPubView.getContext()).thenReturn(activity);
         Networking.setRequestQueueForTesting(mockRequestQueue);
@@ -95,11 +119,17 @@ public void setup() {
                 .setResponseBody("testResponseBody")
                 .setServerExtras(Collections.<String, String>emptyMap())
                 .build();
+        shadowTelephonyManager = (MoPubShadowTelephonyManager) Shadows.shadowOf((TelephonyManager) RuntimeEnvironment.application.getSystemService(Context.TELEPHONY_SERVICE));
+        shadowConnectivityManager = (MoPubShadowConnectivityManager) Shadows.shadowOf((ConnectivityManager) RuntimeEnvironment.application.getSystemService(Context.CONNECTIVITY_SERVICE));
     }
 
     @After
     public void tearDown() throws Exception {
         reset(methodBuilder);
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
     }
 
     @Test
@@ -110,6 +140,57 @@ public void cleanup_shouldNotHoldViewOrUrlGenerator() {
         assertThat(subject.generateAdUrl()).isNull();
     }
 
+    @Test
+    public void setUserDataKeywords_shouldNotSetKeywordIfNoUserConsent() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        subject.setUserDataKeywords("user_data_keywords");
+
+        assertThat(subject.getUserDataKeywords()).isNull();
+    }
+
+    @Test
+    public void setUserDataKeywords_shouldSetUserDataKeywordsIfUserConsent() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
+        subject.setUserDataKeywords("user_data_keywords");
+
+        assertThat(subject.getUserDataKeywords()).isEqualTo("user_data_keywords");
+    }
+
+
+    @Test
+    public void generateAdUrl_shouldNotSetUserDataKeywordsIfNoUserConsent() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        subject.setAdUnitId("abc123");
+        subject.setKeywords("keywords");
+        subject.setUserDataKeywords("user_data_keywords");
+        subject.setLocation(new Location(""));
+        WebViewAdUrlGenerator mUrlGenerator = new WebViewAdUrlGenerator(mockMoPubView.getContext(), false);
+
+        final String adUrl = subject.generateAdUrl();
+        assertThat(getParameterFromRequestUrl(adUrl, "q")).isEqualTo("keywords");
+        assertThat(getParameterFromRequestUrl(adUrl, "user_data_keyword_q")).isEqualTo("");
+    }
+
+    @Test
+    public void generateAdUrl_shouldSetUserDataKeywordsIfUserConsent() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        when(mockPersonalInfoManager.getPersonalInfoConsentStatus()).thenReturn(
+                ConsentStatus.EXPLICIT_YES);
+
+        subject.setAdUnitId("abc123");
+        subject.setKeywords("keywords");
+        subject.setUserDataKeywords("user_data_keywords");
+        subject.setLocation(new Location(""));
+        WebViewAdUrlGenerator mUrlGenerator = new WebViewAdUrlGenerator(mockMoPubView.getContext(), false);
+
+        final String adUrl = subject.generateAdUrl();
+        assertThat(getParameterFromRequestUrl(adUrl, "q")).isEqualTo("keywords");
+        assertThat(getParameterFromRequestUrl(adUrl, "user_data_q")).isEqualTo("user_data_keywords");
+    }
+
     @Test
     public void adDidFail_shouldScheduleRefreshTimer_shouldCallMoPubViewAdFailed() throws Exception {
         ShadowLooper.pauseMainLooper();
@@ -677,4 +758,15 @@ public void getErrorCodeFromVolleyError_withErrorReasonBadHeaderData_shouldRetur
 
         assertThat(errorCode).isEqualTo(MoPubErrorCode.UNSPECIFIED);
     }
+
+    private String getParameterFromRequestUrl(String requestString, String key) {
+        Uri requestUri = Uri.parse(requestString);
+        String parameter = requestUri.getQueryParameter(key);
+
+        if (TextUtils.isEmpty(parameter)) {
+            return "";
+        }
+
+        return parameter;
+    }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/BannerVisibilityTrackerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/BannerVisibilityTrackerTest.java
index 73423b79..0fc42a7f 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/BannerVisibilityTrackerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/BannerVisibilityTrackerTest.java
@@ -274,7 +274,7 @@ public void isVisible_whenViewIsNull_shouldReturnFalse() throws Exception {
         assertThat(visibilityChecker.isVisible(null, null)).isFalse();
     }
 
-    static View createViewMock(final int visibility,
+    View createViewMock(final int visibility,
             final int visibleWidth,
             final int visibleHeight,
             final int viewWidth,
@@ -282,7 +282,7 @@ static View createViewMock(final int visibility,
             final boolean isParentSet,
             final boolean isOnScreen) {
         View view = mock(View.class);
-        when(view.getContext()).thenReturn(new Activity());
+        when(view.getContext()).thenReturn(activity);
         when(view.getVisibility()).thenReturn(visibility);
 
         when(view.getGlobalVisibleRect(any(Rect.class)))
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java
index fa3edbba..5a5fff27 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/BaseInterstitialActivityTest.java
@@ -62,8 +62,7 @@ public void getBroadcastIdentifier_shouldReturnBroadcastIdFromIntent() throws Ex
         Intent intent = new Intent(context, TestInterstitialActivity.class);
         intent.putExtra(BROADCAST_IDENTIFIER_KEY, broadcastIdentifier);
 
-        subject = Robolectric.buildActivity(TestInterstitialActivity.class)
-                .withIntent(intent)
+        subject = Robolectric.buildActivity(TestInterstitialActivity.class, intent)
                 .create().get();
         assertThat(subject.getBroadcastIdentifier()).isEqualTo(2222L);
     }
@@ -74,8 +73,7 @@ public void getBroadcastIdentifier_withMissingBroadCastId_shouldReturnNull() thr
         Intent intent = new Intent(context, TestInterstitialActivity.class);
         // This intent is missing a broadcastidentifier extra.
 
-        subject = Robolectric.buildActivity(TestInterstitialActivity.class)
-                .withIntent(intent)
+        subject = Robolectric.buildActivity(TestInterstitialActivity.class, intent)
                 .create().get();
 
         assertThat(subject.getBroadcastIdentifier()).isNull();
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/ConversionUrlGeneratorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/ConversionUrlGeneratorTest.java
new file mode 100644
index 00000000..a4982e7e
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/ConversionUrlGeneratorTest.java
@@ -0,0 +1,99 @@
+package com.mopub.mobileads;
+
+import android.app.Activity;
+import android.content.Context;
+
+import com.mopub.common.ClientMetadata;
+import com.mopub.common.Constants;
+import com.mopub.common.MoPub;
+import com.mopub.nativeads.NativeUrlGeneratorTest;
+
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.powermock.api.mockito.PowerMockito;
+import org.powermock.core.classloader.annotations.PowerMockIgnore;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
+import org.robolectric.Robolectric;
+import org.robolectric.RobolectricTestRunner;
+import org.robolectric.annotation.Config;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+import static org.powermock.api.mockito.PowerMockito.mock;
+import static org.powermock.api.mockito.PowerMockito.when;
+
+@RunWith(RobolectricTestRunner.class)
+@Config(constants = BuildConfig.class)
+@PowerMockIgnore({"org.mockito.*", "org.robolectric.*", "android.*", "org.json.*"})
+@PrepareForTest(ClientMetadata.class)
+public class ConversionUrlGeneratorTest {
+    private static final String APP_VERSION = "app_version";
+    private static final String CONSENT_STATUS = "consent_status";
+    private static final String PRIVACY_VERSION = "privacy_version";
+    private static final String VENDOR_LIST_VERSION = "vendor_list_version";
+
+    @Rule
+    public PowerMockRule rule = new PowerMockRule();
+
+    private Context context;
+
+    @Before
+    public void setUp() throws Exception {
+        context = Robolectric.buildActivity(Activity.class).create().get();
+
+        ClientMetadata clientMetadata = mock(ClientMetadata.class);
+        when(clientMetadata.getAppVersion()).thenReturn(APP_VERSION);
+
+        PowerMockito.mockStatic(ClientMetadata.class);
+        when(ClientMetadata.getInstance(context)).thenReturn(clientMetadata);
+    }
+
+    //https://ads.mopub.com/m/open?v=6&av=app_version&udid=mp_tmpl_advertising_id&dnt=mp_tmpl_do_not_track&id=com.mopub.mobileads&st=1&nv=5.0.0&current_consent_status=consent_status&consented_vendor_list_version=vendor_list_version&consented_privacy_policy_version=privacy_version&gdpr_applies=0
+    @Test
+    public void generateUrlString_allParametersSet_shouldReturnValidUrl() {
+        ConversionUrlGenerator subject = new ConversionUrlGenerator(context);
+
+        String url = subject.withGdprApplies(false)
+                .withCurrentConsentStatus(CONSENT_STATUS)
+                .withConsentedPrivacyPolicyVersion(PRIVACY_VERSION)
+                .withConsentedVendorListVersion(VENDOR_LIST_VERSION)
+                .withSessionTracker(true)
+                .generateUrlString(Constants.HOST);
+
+        assertThat(url).startsWith(Constants.HTTPS + "://" + Constants.HOST + Constants.CONVERSION_TRACKING_HANDLER);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "v")).isEqualTo("6");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "nv")).isEqualTo(MoPub.SDK_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "av")).isEqualTo(APP_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "udid")).isEqualTo("mp_tmpl_advertising_id");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "st")).isEqualTo("1");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "current_consent_status")).isEqualTo(CONSENT_STATUS);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "gdpr_applies")).isEqualTo("0");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "consented_vendor_list_version")).isEqualTo(VENDOR_LIST_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "consented_privacy_policy_version")).isEqualTo(PRIVACY_VERSION);
+    }
+
+    @Test
+    public void generateUrlString_allParametersNoSt_shouldReturnValidUrl() {
+        ConversionUrlGenerator subject = new ConversionUrlGenerator(context);
+
+        String url = subject.withGdprApplies(false)
+                .withCurrentConsentStatus(CONSENT_STATUS)
+                .withConsentedPrivacyPolicyVersion(PRIVACY_VERSION)
+                .withConsentedVendorListVersion(VENDOR_LIST_VERSION)
+                .withSessionTracker(false)
+                .generateUrlString(Constants.HOST);
+
+        assertThat(url).startsWith(Constants.HTTPS + "://" + Constants.HOST + Constants.CONVERSION_TRACKING_HANDLER);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "v")).isEqualTo("6");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "nv")).isEqualTo(MoPub.SDK_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "av")).isEqualTo(APP_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "udid")).isEqualTo("mp_tmpl_advertising_id");
+        assertThat(url.indexOf("&st=")).isEqualTo(-1);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "current_consent_status")).isEqualTo(CONSENT_STATUS);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "gdpr_applies")).isEqualTo("0");
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "consented_vendor_list_version")).isEqualTo(VENDOR_LIST_VERSION);
+        assertThat(NativeUrlGeneratorTest.getParameterFromRequestUrl(url, "consented_privacy_policy_version")).isEqualTo(PRIVACY_VERSION);
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java
index 18dd5961..13c6c4ae 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/CustomEventBannerAdapterTest.java
@@ -63,8 +63,6 @@ public void setUp() throws Exception {
         when(moPubView.getLocalExtras()).thenReturn(localExtras);
 
         serverExtras = new HashMap<String, String>();
-        serverExtras.put("key", "value");
-        serverExtras.put("another_key", "another_value");
         subject = new CustomEventBannerAdapter(moPubView, CLASS_NAME, serverExtras, BROADCAST_IDENTIFIER, mockAdReport);
 
         expectedLocalExtras = new HashMap<String, Object>();
@@ -72,6 +70,7 @@ public void setUp() throws Exception {
         expectedLocalExtras.put("broadcastIdentifier", BROADCAST_IDENTIFIER);
         expectedLocalExtras.put(DataKeys.AD_WIDTH, 320);
         expectedLocalExtras.put(DataKeys.AD_HEIGHT, 50);
+        expectedLocalExtras.put(DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED, false);
 
         expectedServerExtras = new HashMap<String, String>();
 
@@ -149,11 +148,33 @@ public void loadAd_shouldPropagateLocationInLocalExtras() throws Exception {
 
     @Test
     public void loadAd_shouldPropagateServerExtrasToLoadBanner() throws Exception {
+        serverExtras.put("key", "value");
+        serverExtras.put("another_key", "another_value");
+        subject = new CustomEventBannerAdapter(moPubView, CLASS_NAME, serverExtras, BROADCAST_IDENTIFIER, mockAdReport);
+
         subject.loadAd();
 
         expectedServerExtras.put("key", "value");
         expectedServerExtras.put("another_key", "another_value");
+        verify(banner).loadBanner(
+                any(Context.class),
+                eq(subject),
+                eq(expectedLocalExtras),
+                eq(expectedServerExtras)
+        );
+    }
+
+    @Test
+    public void loadAd_withVisibilityImpressionTrackingEnabled_shouldPropagateVisibilityImpressionTrackingEnabledFlagInLocalExtras() {
+        serverExtras.put(DataKeys.BANNER_IMPRESSION_MIN_VISIBLE_DIPS, "1");
+        serverExtras.put(DataKeys.BANNER_IMPRESSION_MIN_VISIBLE_MS, "0");
+        subject = new CustomEventBannerAdapter(moPubView, CLASS_NAME, serverExtras, BROADCAST_IDENTIFIER, mockAdReport);
+
+        subject.loadAd();
 
+        expectedLocalExtras.put(DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED, true);
+        expectedServerExtras.put(DataKeys.BANNER_IMPRESSION_MIN_VISIBLE_DIPS, "1");
+        expectedServerExtras.put(DataKeys.BANNER_IMPRESSION_MIN_VISIBLE_MS, "0");
         verify(banner).loadBanner(
                 any(Context.class),
                 eq(subject),
@@ -286,6 +307,7 @@ public void onBannerLoaded_whenViewIsHtmlBannerWebView_withVisibilityImpressionT
         verify(moPubView).nativeAdLoaded();
         verify(moPubView).setAdContentView(eq(mockHtmlBannerWebView));
         verify(moPubView, never()).trackNativeImpression();
+        verify(moPubView).pauseAutorefresh();
     }
 
     @Test
@@ -307,6 +329,7 @@ public void onBannerLoaded_whenViewIsNotHtmlBannerWebView_withVisibilityImpressi
         verify(moPubView).nativeAdLoaded();
         verify(moPubView).setAdContentView(eq(view));
         verify(moPubView, never()).trackNativeImpression();
+        verify(moPubView).pauseAutorefresh();
     }
 
     @Test
@@ -324,27 +347,27 @@ public void onBannerFailed_whenErrorCodeIsNull_shouldPassUnspecifiedError() thro
     }
 
     @Test
-    public void onBannerExpanded_shouldPauseRefreshAndCallAdPresentOverlay() throws Exception {
+    public void onBannerExpanded_shouldPauseRefreshAndCallAdPresentOverlay_shouldCallExpand() throws Exception {
         subject.onBannerExpanded();
 
-        verify(moPubView).setAutorefreshEnabled(eq(false));
+        verify(moPubView).expand();
         verify(moPubView).adPresentedOverlay();
     }
 
     @Test
-    public void onBannerCollapsed_shouldRestoreRefreshSettingAndCallAdClosed() throws Exception {
+    public void onBannerCollapsed_shouldRestoreRefreshSettingAndCallAdClosed_shouldCallCollapse() throws Exception {
         when(moPubView.getAutorefreshEnabled()).thenReturn(true);
         subject.onBannerExpanded();
         reset(moPubView);
         subject.onBannerCollapsed();
-        verify(moPubView).setAutorefreshEnabled(eq(true));
+        verify(moPubView).collapse();
         verify(moPubView).adClosed();
 
         when(moPubView.getAutorefreshEnabled()).thenReturn(false);
         subject.onBannerExpanded();
         reset(moPubView);
         subject.onBannerCollapsed();
-        verify(moPubView).setAutorefreshEnabled(eq(false));
+        verify(moPubView).collapse();
         verify(moPubView).adClosed();
     }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java
index e5f40f61..9f190751 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/EventForwardingBroadcastReceiverTest.java
@@ -14,6 +14,7 @@
 import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.support.v4.ShadowLocalBroadcastManager;
 
@@ -22,11 +23,11 @@
 import java.util.Map;
 import java.util.Set;
 
-import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_CLICK;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_DISMISS;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_FAIL;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_SHOW;
+import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.mobileads.MoPubInterstitial.InterstitialAdListener;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
@@ -49,7 +50,7 @@ public void setUp() throws Exception {
         customEventInterstitialListener = mock(CustomEventInterstitialListener.class);
         broadcastIdentifier = 27027027;
         subject = new EventForwardingBroadcastReceiver(customEventInterstitialListener, broadcastIdentifier);
-        context = new Activity();
+        context = Robolectric.buildActivity(Activity.class).create().get();
     }
 
     @Ignore("Difficult with the number of test factories and mocking involved.")
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java
index f824f149..90e7c77a 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlBannerTest.java
@@ -4,6 +4,7 @@
 import android.view.Gravity;
 import android.widget.FrameLayout;
 
+import com.mopub.common.DataKeys;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.test.support.TestHtmlBannerWebViewFactory;
 import com.mopub.mobileads.test.support.TestMoPubViewFactory;
@@ -95,6 +96,28 @@ public void loadBanner_shouldPassParametersThrough() throws Exception {
         verify(htmlBannerWebView).loadHtmlResponse(responseBody);
     }
 
+    @Test
+    public void loadBanner_withTrueFlag_shouldSetBannerImpressionPixelCountEnabledTrue() {
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isFalse();
+
+        localExtras.put(DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED, true);
+
+        subject.loadBanner(context, customEventBannerListener, localExtras, serverExtras);
+
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isTrue();
+    }
+
+    @Test
+    public void loadBanner_withFalseFlag_shouldSetBannerImpressionPixelCountEnabledFalse() {
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isFalse();
+
+        localExtras.put(DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED, false);
+
+        subject.loadBanner(context, customEventBannerListener, localExtras, serverExtras);
+
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isFalse();
+    }
+
     @Test
     public void onInvalidate_shouldDestroyTheHtmlWebView() throws Exception {
         subject.loadBanner(context, customEventBannerListener, localExtras, serverExtras);
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java
index d641f19c..851b090d 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlInterstitialTest.java
@@ -10,6 +10,7 @@
 import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowApplication;
 import org.robolectric.shadows.support.v4.ShadowLocalBroadcastManager;
@@ -22,9 +23,9 @@
 import static com.mopub.common.DataKeys.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.common.DataKeys.REDIRECT_URL_KEY;
 import static com.mopub.common.DataKeys.SCROLLABLE_KEY;
-import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_DISMISS;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_SHOW;
+import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.mobileads.EventForwardingBroadcastReceiverTest.getIntentForActionAndIdentifier;
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_INVALID_STATE;
 import static org.fest.assertions.api.Assertions.assertThat;
@@ -50,7 +51,7 @@ public void setUp() throws Exception {
 
         expectedResponse = "this is the response";
         htmlInterstitialWebView = TestHtmlInterstitialWebViewFactory.getSingletonMock();
-        context = new Activity();
+        context = Robolectric.buildActivity(Activity.class).create().get();
         customEventInterstitialListener = mock(CustomEventInterstitialListener.class);
         localExtras = new HashMap<String, Object>();
         serverExtras = new HashMap<String, String>();
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java
index c0bee0bb..a41437c3 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/HtmlWebViewClientTest.java
@@ -1,6 +1,7 @@
 package com.mopub.mobileads;
 
 import android.app.Activity;
+import android.app.Application;
 import android.content.ActivityNotFoundException;
 import android.content.Context;
 import android.content.Intent;
@@ -16,7 +17,6 @@
 import org.junit.runner.RunWith;
 import org.mockito.ArgumentCaptor;
 import org.robolectric.Robolectric;
-import org.robolectric.RuntimeEnvironment;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowApplication;
 
@@ -31,6 +31,7 @@
 import static org.mockito.Mockito.stub;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -52,6 +53,7 @@ public void setUp() throws Exception {
         when(htmlWebView.wasClicked()).thenReturn(true);
         subject = new HtmlWebViewClient(htmlWebViewListener, htmlWebView, CLICKTHROUGH_URL,
                 "redirect", "dsp_creative_id");
+        while(shadowOf((Application) context).getNextStartedActivity() != null) {}
     }
 
     @Test
@@ -94,7 +96,7 @@ public void shouldOverrideUrlLoading_withCustomApplicationIntent_withUserClick_a
         String customUrl = "myintent://something";
         stub(htmlWebView.wasClicked()).toReturn(true);
         subject = new HtmlWebViewClient(htmlWebViewListener, htmlWebView, null, null, null);
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW, Uri.parse(customUrl)), new ResolveInfo());
+        shadowOf(context.getPackageManager()).addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW, Uri.parse(customUrl)), new ResolveInfo());
 
         boolean didOverrideUrl = subject.shouldOverrideUrlLoading(htmlWebView, customUrl);
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/IntentIsEqual.java b/mopub-sdk/src/test/java/com/mopub/mobileads/IntentIsEqual.java
new file mode 100644
index 00000000..318911ba
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/IntentIsEqual.java
@@ -0,0 +1,65 @@
+package com.mopub.mobileads;
+
+import android.content.Intent;
+
+import org.hamcrest.BaseMatcher;
+import org.hamcrest.Description;
+
+/**
+ * Matcher to compare Intents by components of the Intent.
+ */
+public class IntentIsEqual extends BaseMatcher<Intent> {
+
+    private Intent intent;
+
+    public IntentIsEqual(final Intent intent) {
+        this.intent = intent;
+    }
+
+    @Override
+    public boolean matches(final Object item) {
+        if (!(item instanceof Intent)) {
+            return false;
+        }
+        Intent otherIntent = (Intent) item;
+        if (intent.getExtras() == null && otherIntent.getExtras() != null) {
+            return false;
+        } else if (intent.getExtras() != null && otherIntent.getExtras() == null) {
+            return false;
+        } else if (intent.getExtras() != null && otherIntent.getExtras() != null) {
+            if (intent.getExtras().size() != otherIntent.getExtras().size()) {
+                return false;
+            }
+            for(String key : intent.getExtras().keySet()) {
+                if (!intent.getExtras().get(key).equals(otherIntent.getExtras().get(key))) {
+                    return false;
+                }
+            }
+        }
+
+        if (intent.getAction() != null && !intent.getAction().equals(otherIntent.getAction())) {
+            return false;
+        } else if (intent.getAction() == null && otherIntent.getAction() != null) {
+            return false;
+        }
+
+        if (intent.getComponent() != null && !intent.getComponent().equals(otherIntent.getComponent())) {
+            return false;
+        } else if (intent.getComponent() == null && otherIntent.getComponent() != null) {
+            return false;
+        }
+
+        if (intent.getData() != null && !intent.getData().equals(otherIntent.getData())) {
+            return false;
+        } else if (intent.getData() == null && otherIntent.getData() != null) {
+            return false;
+        }
+
+        return true;
+    }
+
+    @Override
+    public void describeTo(final Description description) {
+        description.appendText(intent.toString() + " extras: " + intent.getExtras());
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java
index b4422c18..d2b0381c 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubActivityTest.java
@@ -21,27 +21,28 @@
 import org.mockito.ArgumentCaptor;
 import org.mockito.Mock;
 import org.robolectric.Robolectric;
+import org.robolectric.android.controller.ActivityController;
 import org.robolectric.annotation.Config;
-import org.robolectric.internal.ShadowExtractor;
+import org.robolectric.shadow.api.Shadow;
 import org.robolectric.shadows.ShadowActivity;
 import org.robolectric.shadows.ShadowApplication;
 import org.robolectric.shadows.support.v4.ShadowLocalBroadcastManager;
-import org.robolectric.util.ActivityController;
 
 import static com.mopub.common.DataKeys.CLICKTHROUGH_URL_KEY;
 import static com.mopub.common.DataKeys.CREATIVE_ORIENTATION_KEY;
 import static com.mopub.common.DataKeys.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.common.DataKeys.REDIRECT_URL_KEY;
 import static com.mopub.common.DataKeys.SCROLLABLE_KEY;
-import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_CLICK;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_DISMISS;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_FAIL;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_SHOW;
+import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.mobileads.EventForwardingBroadcastReceiverTest.getIntentForActionAndIdentifier;
 import static com.mopub.mobileads.MoPubErrorCode.UNSPECIFIED;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.argThat;
 import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
@@ -79,7 +80,8 @@ public void setUp() throws Exception {
                 EXPECTED_REDIRECT_URL,
                 EXPECTED_CLICKTHROUGH_URL, EXPECTED_ORIENTATION, testBroadcastIdentifier);
 
-        final ActivityController<MoPubActivity> subjectController = Robolectric.buildActivity(MoPubActivity.class).withIntent(moPubActivityIntent);
+        final ActivityController<MoPubActivity> subjectController = Robolectric.buildActivity(
+                MoPubActivity.class, moPubActivityIntent);
         subject = subjectController.get();
         ShadowLocalBroadcastManager.getInstance(subject).registerReceiver(broadcastReceiver,
                 new EventForwardingBroadcastReceiver(customEventInterstitialListener,
@@ -264,8 +266,8 @@ public void broadcastingInterstitialListener_onInterstitialFailed_shouldBroadcas
         MoPubActivity.BroadcastingInterstitialListener broadcastingInterstitialListener = ((MoPubActivity) subject).new BroadcastingInterstitialListener();
         broadcastingInterstitialListener.onInterstitialFailed(null);
 
-        verify(broadcastReceiver).onReceive(any(Context.class), eq(expectedIntent));
-        assertThat(((ShadowActivity) ShadowExtractor.extract(subject)).isFinishing()).isTrue();
+        verify(broadcastReceiver).onReceive(any(Context.class), argThat(new IntentIsEqual(expectedIntent)));
+        assertThat(((ShadowActivity) Shadow.extract(subject)).isFinishing()).isTrue();
     }
 
     @Test
@@ -275,14 +277,14 @@ public void broadcastingInterstitialListener_onInterstitialClicked_shouldBroadca
         MoPubActivity.BroadcastingInterstitialListener broadcastingInterstitialListener = ((MoPubActivity) subject).new BroadcastingInterstitialListener();
         broadcastingInterstitialListener.onInterstitialClicked();
 
-        verify(broadcastReceiver).onReceive(any(Context.class), eq(expectedIntent));
+        verify(broadcastReceiver).onReceive(any(Context.class), argThat(new IntentIsEqual(expectedIntent)));
     }
 
     @Test
     public void onCreate_shouldBroadcastInterstitialShow() throws Exception {
         Intent expectedIntent = getIntentForActionAndIdentifier(ACTION_INTERSTITIAL_SHOW, testBroadcastIdentifier);
 
-        verify(broadcastReceiver).onReceive(any(Context.class), eq(expectedIntent));
+        verify(broadcastReceiver).onReceive(any(Context.class), argThat(new IntentIsEqual(expectedIntent)));
     }
 
     @Test
@@ -291,7 +293,7 @@ public void onDestroy_shouldBroadcastInterstitialDismiss() throws Exception {
 
         subject.onDestroy();
 
-        verify(broadcastReceiver).onReceive(any(Context.class), eq(expectedIntent));
+        verify(broadcastReceiver).onReceive(any(Context.class), argThat(new IntentIsEqual(expectedIntent)));
     }
 
     private FrameLayout getContentView() {
@@ -304,5 +306,6 @@ protected void resetMockedView(View view) {
                 new FrameLayout.LayoutParams(FrameLayout.LayoutParams.WRAP_CONTENT,
                         FrameLayout.LayoutParams.WRAP_CONTENT));
     }
+
 }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java
index 8e0af80a..f7691214 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubConversionTrackerTest.java
@@ -1,8 +1,15 @@
 package com.mopub.mobileads;
 
 import android.app.Activity;
+import android.content.SharedPreferences;
 
+import com.mopub.common.MoPub;
+import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.privacy.ConsentData;
+import com.mopub.common.privacy.ConsentStatus;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Reflection;
 import com.mopub.network.MoPubRequestQueue;
 import com.mopub.network.Networking;
 import com.mopub.network.TrackingRequest;
@@ -14,12 +21,16 @@
 import org.mockito.ArgumentCaptor;
 import org.mockito.Captor;
 import org.mockito.Mock;
+import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 
+import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -29,41 +40,105 @@
     @Mock
     MoPubRequestQueue mockRequestQueue;
     @Captor
-    ArgumentCaptor<TrackingRequest> requestCaptor;
+    private ArgumentCaptor<TrackingRequest> requestCaptor;
 
-    private String expectedUdid;
-    private boolean dnt = false;
     private static final String TEST_UDID = "20b013c721c";
+    private PersonalInfoManager mockPersonalInfoManager;
+    private SharedPreferences mSharedPreferences;
+    private String mPackageName;
+    private String mWantToTrack;
 
     @Before
     public void setUp() throws Exception {
-        subject = new MoPubConversionTracker();
-        context = new Activity();
+        context = Robolectric.buildActivity(Activity.class).create().get();
         Networking.setRequestQueueForTesting(mockRequestQueue);
+
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
+        final ConsentData mockConsentData = mock(ConsentData.class);
+        when(mockPersonalInfoManager.getConsentData()).thenReturn(mockConsentData);
+        when(mockConsentData.getConsentedPrivacyPolicyVersion()).thenReturn("privacy_policy_version");
+        when(mockConsentData.getConsentedVendorListVersion()).thenReturn("vendor_list_version");
+        when(mockPersonalInfoManager.gdprApplies()).thenReturn(true);
+
+        subject = new MoPubConversionTracker(context);
     }
 
     @Test
-    public void reportAppOpen_Twice_shouldCallOnlyOnce() {
-        subject.reportAppOpen(context);
+    public void reportAppOpen_Twice_shouldCallOnlyOnce() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        when(mockPersonalInfoManager.getPersonalInfoConsentStatus()).thenReturn(ConsentStatus.EXPLICIT_YES);
+
+        prepareMoPub_getPersonalInfoManager();
+
+        subject.reportAppOpen(false);
         verify(mockRequestQueue).add(requestCaptor.capture());
 
         reset(mockRequestQueue);
         requestCaptor.getValue().deliverResponse(null);
 
-        subject.reportAppOpen(context);
+        subject.reportAppOpen(false);
         verify(mockRequestQueue, never()).add(any(TrackingRequest.class));
     }
 
     @Test
-    public void reportAppOpen_fails_shouldCallAgain() {
-        subject.reportAppOpen(context);
+    public void reportAppOpen_fails_shouldCallAgain() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        when(mockPersonalInfoManager.getPersonalInfoConsentStatus()).thenReturn(ConsentStatus.EXPLICIT_YES);
+
+        prepareMoPub_getPersonalInfoManager();
+
+        subject.reportAppOpen(true);
         verify(mockRequestQueue).add(requestCaptor.capture());
 
         reset(mockRequestQueue);
         requestCaptor.getValue().deliverError(new VolleyError());
 
-        subject.reportAppOpen(context);
+        subject.reportAppOpen(true);
         verify(mockRequestQueue).add(any(TrackingRequest.class));
     }
+
+    @Test
+    public void reportAppOpen_shouldNotTrackIfConsentIsFalse() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        prepareMoPub_getPersonalInfoManager();
+
+        subject.reportAppOpen(false);
+        mPackageName = context.getPackageName();
+        mWantToTrack = mPackageName + " wantToTrack";
+        mSharedPreferences = SharedPreferencesHelper.getSharedPreferences(context);
+        assertThat(mSharedPreferences.getBoolean(mWantToTrack, false)).isTrue();
+    }
+
+    @Test
+    public void reportAppOpen_shouldTrackWhenConsentIsFalse() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        prepareMoPub_getPersonalInfoManager();
+
+        assertThat(subject.shouldTrack()).isFalse();
+    }
+
+    @Test
+    public void reportAppOpen_shouldTrackWhenConsentIsTrueAndWantToTrack() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        prepareMoPub_getPersonalInfoManager();
+
+        mPackageName = context.getPackageName();
+        mWantToTrack = mPackageName + " wantToTrack";
+        mSharedPreferences = SharedPreferencesHelper.getSharedPreferences(context);
+        mSharedPreferences
+                .edit()
+                .putBoolean(mWantToTrack, true)
+                .commit();
+
+        assertThat(subject.shouldTrack()).isTrue();
+    }
+
+    private void prepareMoPub_getPersonalInfoManager() throws Exception {
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+    }
 }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java
index 201321c3..30bb636b 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubInterstitialTest.java
@@ -91,18 +91,38 @@ public void forceRefresh_shouldResetInterstitialViewAndMarkNotDestroyed() throws
     }
 
     @Test
-    public void setKeywordsTest() throws Exception {
+    public void setUserDataKeywordsTest() throws Exception {
+        subject.setInterstitialView(interstitialView);
+        String userDataKeywords = "these_are_user_data_keywords";
+
+        subject.setUserDataKeywords(userDataKeywords);
+        verify(interstitialView).setUserDataKeywords(eq(userDataKeywords));
+    }
+
+    @Test
+    public void getUserDataKeywords() throws Exception {
+        subject.setInterstitialView(interstitialView);
+
+        subject.getUserDataKeywords();
+        verify(interstitialView).getUserDataKeywords();
+    }
+
+    @Test
+    public void setKeywords_withNonEmptyKeywords_shouldsetKeywordsOnInterstitialView() throws Exception {
         subject.setInterstitialView(interstitialView);
         String keywords = "these_are_keywords";
 
         subject.setKeywords(keywords);
+
         verify(interstitialView).setKeywords(eq(keywords));
     }
+
     @Test
-    public void getKeywordsTest() throws Exception {
+    public void getKeywordsTest_shouldCallGetKeywordsOnInterstitialView() throws Exception {
         subject.setInterstitialView(interstitialView);
 
         subject.getKeywords();
+
         verify(interstitialView).getKeywords();
     }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubRewardedVideoManagerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubRewardedVideoManagerTest.java
index a0f28b9a..2a4f862f 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubRewardedVideoManagerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MoPubRewardedVideoManagerTest.java
@@ -2,20 +2,27 @@
 
 import android.app.Activity;
 import android.content.SharedPreferences;
-import android.net.Uri;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 
 import com.mopub.common.AdType;
 import com.mopub.common.DataKeys;
 import com.mopub.common.LifecycleListener;
+import com.mopub.common.MoPub;
 import com.mopub.common.MoPubReward;
+import com.mopub.common.SdkConfiguration;
 import com.mopub.common.SharedPreferencesHelper;
+import com.mopub.common.privacy.ConsentStatus;
+import com.mopub.common.privacy.MoPubIdentifierTest;
+import com.mopub.common.privacy.PersonalInfoManager;
+import com.mopub.common.privacy.SyncRequest;
 import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Reflection;
 import com.mopub.network.AdRequest;
 import com.mopub.network.AdResponse;
 import com.mopub.network.MoPubRequestQueue;
 import com.mopub.network.Networking;
+import com.mopub.volley.AuthFailureError;
 import com.mopub.volley.Request;
 import com.mopub.volley.VolleyError;
 
@@ -85,17 +92,38 @@
     private RewardedVideoCompletionRequest rewardedVideoCompletionRequest;
     private Activity mActivity;
     private SharedPreferences mTestCustomEventSharedPrefs;
+    private PersonalInfoManager mockPersonalInfoManager;
 
     @Before
-    public void setup() {
+    public void setup() throws Exception {
         mActivity = Robolectric.buildActivity(Activity.class).create().get();
+
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
+        MoPub.initializeSdk(mActivity, new SdkConfiguration.Builder("adunit").build(), null);
+
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(mActivity, false);
         MoPubRewardedVideoManager.init(mActivity);
+        // The fact that next call fixes issues in multiple tests proves that Robolectric doesn't
+        // teardown singletons properly between tests.
+        MoPubRewardedVideoManager.updateActivity(mActivity);
+
         MoPubRewardedVideoManager.setVideoListener(mockVideoListener);
 
         mTestCustomEventSharedPrefs = SharedPreferencesHelper.getSharedPreferences(
                         mActivity, TEST_CUSTOM_EVENT_PREF_NAME);
         MoPubRewardedVideoManager.setCustomEventSharedPrefs(mTestCustomEventSharedPrefs);
 
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
+        when(mockPersonalInfoManager.getPersonalInfoConsentStatus()).thenReturn(ConsentStatus.UNKNOWN);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         when(mockRequestQueue.add(any(Request.class))).then(new Answer<Object>() {
             @Override
             public Object answer(final InvocationOnMock invocationOnMock) throws Throwable {
@@ -107,6 +135,8 @@ public Object answer(final InvocationOnMock invocationOnMock) throws Throwable {
                 } else if (req.getClass().equals(RewardedVideoCompletionRequest.class)) {
                     rewardedVideoCompletionRequest = (RewardedVideoCompletionRequest) req;
                     return null;
+                } else if(req.getClass().equals(SyncRequest.class)){
+                    return null;
                 } else {
                     throw new Exception(String.format("Request object added to RequestQueue can " +
                             "only be of type AdRequest or RewardedVideoCompletionRequest, " +
@@ -119,12 +149,17 @@ public Object answer(final InvocationOnMock invocationOnMock) throws Throwable {
     }
 
     @After
-    public void tearDown() {
+    public void tearDown() throws Exception {
         // Unpause the main looper in case a test terminated while the looper was paused.
         ShadowLooper.unPauseMainLooper();
         MoPubRewardedVideoManager.getRewardedAdData().clear();
         MoPubRewardedVideoManager.getAdRequestStatusMapping().clearMapping();
         mTestCustomEventSharedPrefs.edit().clear().commit();
+        MoPubIdentifierTest.clearPreferences(mActivity);
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
     }
 
     @Test
@@ -227,14 +262,52 @@ public void initNetworks_shouldObeyOrderDuringInit() {
     }
 
     @Test
-    public void loadVideo_withRequestParameters_shouldGenerateUrlWithKeywords() {
+    public void createRequestParameters_withUserDataKeywordsButNoConsent_shouldNotSetUserDataKeywords() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        MoPubRewardedVideoManager.RequestParameters requestParameters = new MoPubRewardedVideoManager.RequestParameters("keywords", "user_data_keywords",null, "testCustomerId");
+
+        assertThat(requestParameters.mKeywords).isEqualTo("keywords");
+        assertThat(requestParameters.mUserDataKeywords).isEqualTo(null);
+    }
+
+    @Test
+    public void createRequestParameters_withUserDataKeywordsWithConsent_shouldSetUserDataKeywords() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        MoPubRewardedVideoManager.RequestParameters requestParameters = new MoPubRewardedVideoManager.RequestParameters("keywords", "user_data_keywords", null, "testCustomerId");
+
+        assertThat(requestParameters.mKeywords).isEqualTo("keywords");
+        assertThat(requestParameters.mUserDataKeywords).isEqualTo("user_data_keywords");
+    }
+
+    @Test
+    public void loadVideo_withRequestParameters_shouldGenerateUrlWithKeywords() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         // Robolectric executes its handlers immediately, so if we want the async behavior we see
         // in an actual app we have to pause the main looper until we're done successfully loading the ad.
         ShadowLooper.pauseMainLooper();
 
         MoPubRewardedVideoManager.loadVideo("testAdUnit", new MoPubRewardedVideoManager.RequestParameters("nonsense;garbage;keywords"));
 
-        verify(mockRequestQueue).add(argThat(new RequestUrlContains(Uri.encode("nonsense;garbage;keywords"))));
+        verify(mockRequestQueue).add(argThat(new RequestBodyContains("nonsense;garbage;keywords")));
 
         // Finish the request
         requestListener.onErrorResponse(new VolleyError("end test"));
@@ -242,12 +315,19 @@ public void loadVideo_withRequestParameters_shouldGenerateUrlWithKeywords() {
     }
 
     @Test
-    public void loadVideo_withCustomerIdInRequestParameters_shouldSetCustomerId() {
+    public void loadVideo_withCustomerIdInRequestParameters_shouldSetCustomerId() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         // Robolectric executes its handlers immediately, so if we want the async behavior we see
         // in an actual app we have to pause the main looper until we're done successfully loading the ad.
         ShadowLooper.pauseMainLooper();
 
-        MoPubRewardedVideoManager.loadVideo("testAdUnit", new MoPubRewardedVideoManager.RequestParameters("keywords", null, "testCustomerId"));
+        MoPubRewardedVideoManager.loadVideo("testAdUnit", new MoPubRewardedVideoManager.RequestParameters("keywords", "user_data_keywords",null, "testCustomerId"));
 
         assertThat(MoPubRewardedVideoManager.getRewardedAdData().getCustomerId()).isEqualTo("testCustomerId");
 
@@ -411,7 +491,7 @@ public void onAdSuccess_noCEFound_shouldLoadFailUrl() {
 
         MoPubRewardedVideoManager.loadVideo("testAdUnit", null);
 
-        assertThat(request.getUrl()).contains("testAdUnit");
+        assertThat(new String(request.getBody())).contains("testAdUnit");
         requestListener.onSuccess(testResponse);
         assertThat(request.getUrl()).isEqualTo("fail.url");
         // Clear up the static state :(
@@ -1084,7 +1164,7 @@ public void onAdFailure_shouldCallFailCallback() {
 
         MoPubRewardedVideoManager.loadVideo("testAdUnit", null);
 
-        assertThat(request.getUrl()).contains("testAdUnit");
+        assertThat(new String(request.getBody())).contains("testAdUnit");
         requestListener.onErrorResponse(e);
         verify(mockVideoListener).onRewardedVideoLoadFailure(anyString(), any(MoPubErrorCode.class));
         verifyNoMoreInteractions(mockVideoListener);
@@ -1372,18 +1452,22 @@ protected void loadWithSdkInitialized(@NonNull final Activity activity,
         }
     }
 
-    private static class RequestUrlContains extends ArgumentMatcher<Request> {
+    private static class RequestBodyContains extends ArgumentMatcher<Request> {
 
         private final String mMustContain;
 
-        RequestUrlContains(String stringToFind) {
+        RequestBodyContains(String stringToFind) {
             mMustContain = stringToFind;
         }
 
         @Override
         public boolean matches(final Object argument) {
-            return argument instanceof Request
-                    && ((Request) argument).getUrl().contains(mMustContain);
+            try {
+                return argument instanceof Request
+                        && new String(((Request) argument).getBody()).contains(mMustContain);
+            } catch (AuthFailureError authFailureError) {
+                return false;
+            }
         }
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java
index a12135a7..0985504b 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidActivityTest.java
@@ -26,9 +26,9 @@
 import org.mockito.Mock;
 import org.robolectric.Robolectric;
 import org.robolectric.Shadows;
+import org.robolectric.android.controller.ActivityController;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.support.v4.ShadowLocalBroadcastManager;
-import org.robolectric.util.ActivityController;
 
 import static com.mopub.common.DataKeys.BROADCAST_IDENTIFIER_KEY;
 import static com.mopub.common.DataKeys.HTML_RESPONSE_BODY_KEY;
@@ -331,7 +331,8 @@ public void onPause_shouldOnPauseMraidView() throws Exception {
     @Test
     public void onResume_shouldResumeMraidView() throws Exception {
         subject.onCreate(null);
-        Shadows.shadowOf(subject).pauseAndThenResume();
+        activityController.pause();
+        activityController.resume();
 
         verify(mockMraidWebView).onResume();
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java
index 49eea165..9db1e540 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/MraidVideoPlayerActivityTest.java
@@ -171,7 +171,8 @@ public void onStartActivityForResult_shouldStartAnActivityWithRelevantRequestCod
         final ShadowActivity.IntentForResult intentForResult = Shadows.shadowOf(subject).getNextStartedActivityForResult();
 
         assertThat(intentForResult.intent.getComponent().getClassName()).isEqualTo("com.mopub.common.MoPubBrowser");
-        assertThat(intentForResult.intent.getExtras()).isEqualTo(expectedExtras);
+        assertThat(intentForResult.intent.getExtras().getString("hello")).isEqualTo(expectedExtras.getString("hello"));
+        assertThat(intentForResult.intent.getExtras().size()).isEqualTo(expectedExtras.size());
         assertThat(intentForResult.requestCode).isEqualTo(100);
     }
 
@@ -198,8 +199,7 @@ public void createVideoViewController_withNativeVideoViewControllerReflectionCon
     private void initializeSubjectForMraid() {
         intent.putExtra(BaseVideoPlayerActivity.VIDEO_CLASS_EXTRAS_KEY, "mraid");
 
-        subject = Robolectric.buildActivity(MraidVideoPlayerActivity.class)
-                .withIntent(intent)
+        subject = Robolectric.buildActivity(MraidVideoPlayerActivity.class, intent)
                 .create()
                 .get();
     }
@@ -210,8 +210,7 @@ private void initializeSubjectForVast() {
         vastVideoConfig.setDiskMediaFileUrl("video_path");
         intent.putExtra(VastVideoViewController.VAST_VIDEO_CONFIG, vastVideoConfig);
 
-        subject = Robolectric.buildActivity(MraidVideoPlayerActivity.class)
-                .withIntent(intent)
+        subject = Robolectric.buildActivity(MraidVideoPlayerActivity.class, intent)
                 .create()
                 .get();
     }
@@ -235,8 +234,7 @@ private void initializeSubjectForNative() {
         NativeVideoController.setForId(123, mockVideoController);
         intent.putExtras(additionalExtras);
 
-        subject = Robolectric.buildActivity(MraidVideoPlayerActivity.class)
-                .withIntent(intent)
+        subject = Robolectric.buildActivity(MraidVideoPlayerActivity.class, intent)
                 .create()
                 .get();
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/RewardedMraidActivityTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/RewardedMraidActivityTest.java
index 540e6e2b..65c07b52 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/RewardedMraidActivityTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/RewardedMraidActivityTest.java
@@ -43,8 +43,8 @@ public void setup() {
         Context context = Robolectric.buildActivity(Activity.class).create().get();
         Intent intent = RewardedMraidActivity.createIntent(context, mockAdReport, HTML_DATA,
                 broadcastIdentifier, REWARDED_DURATION_IN_SECONDS, shouldRewardOnClick);
-        subject = Robolectric.buildActivity(RewardedMraidActivity.class)
-                .withIntent(intent).create().get();
+        subject = Robolectric.buildActivity(RewardedMraidActivity.class, intent)
+                .create().get();
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastCompanionAdConfigTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastCompanionAdConfigTest.java
index 8ff23e7a..0c9de71e 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastCompanionAdConfigTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastCompanionAdConfigTest.java
@@ -17,13 +17,13 @@
 import org.mockito.Mock;
 import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
-import org.robolectric.shadows.ShadowApplication;
 
 import static com.mopub.common.VolleyRequestMatcher.isUrl;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.argThat;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.verifyNoMoreInteractions;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -81,13 +81,12 @@ public void handleClick_shouldNotTrackClick() throws Exception {
         verifyNoMoreInteractions(mockRequestQueue);
     }
 
-
     @Test
     public void handleClick_shouldOpenMoPubBrowser() throws Exception {
         subject.handleClick(context, 1, null, "dsp_creative_id");
 
-        Robolectric.getBackgroundThreadScheduler().advanceBy(0);
-        Intent startedActivity = ShadowApplication.getInstance().getNextStartedActivity();
+        Robolectric.flushBackgroundThreadScheduler();
+        Intent startedActivity = shadowOf((Activity) context).getNextStartedActivity();
         assertThat(startedActivity.getComponent().getClassName())
                 .isEqualTo("com.mopub.common.MoPubBrowser");
         assertThat(startedActivity.getStringExtra(MoPubBrowser.DESTINATION_URL_KEY))
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastIconConfigTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastIconConfigTest.java
index 3a636ccb..b6375b96 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastIconConfigTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastIconConfigTest.java
@@ -16,13 +16,13 @@
 import org.mockito.Mock;
 import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
-import org.robolectric.shadows.ShadowApplication;
 
 import static com.mopub.common.VolleyRequestMatcher.isUrl;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.argThat;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.verifyNoMoreInteractions;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -97,8 +97,8 @@ public void handleClick_shouldNotTrackClick() throws Exception {
     public void handleClick_shouldOpenMoPubBrowser() throws Exception {
         subject.handleClick(context, null, dspCreativeId);
 
-        Robolectric.getBackgroundThreadScheduler().advanceBy(0);
-        Intent startedActivity = ShadowApplication.getInstance().getNextStartedActivity();
+        Robolectric.flushBackgroundThreadScheduler();
+        Intent startedActivity = shadowOf((Activity) context).getNextStartedActivity();
         assertThat(startedActivity.getComponent().getClassName())
                 .isEqualTo("com.mopub.common.MoPubBrowser");
         assertThat(startedActivity.getStringExtra(MoPubBrowser.DESTINATION_URL_KEY))
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java
index 1fa858ca..3efadc75 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoInterstitialTest.java
@@ -8,10 +8,10 @@
 import com.mopub.common.CacheServiceTest;
 import com.mopub.common.DataKeys;
 import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 import com.mopub.mobileads.test.support.TestVastManagerFactory;
 import com.mopub.mobileads.test.support.VastUtils;
 
+import org.apache.http.HttpResponse;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -28,9 +28,9 @@
 import static com.mopub.common.DataKeys.AD_REPORT_KEY;
 import static com.mopub.common.DataKeys.BROADCAST_IDENTIFIER_KEY;
 import static com.mopub.common.DataKeys.HTML_RESPONSE_BODY_KEY;
-import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_DISMISS;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_SHOW;
+import static com.mopub.mobileads.CustomEventInterstitial.CustomEventInterstitialListener;
 import static com.mopub.mobileads.EventForwardingBroadcastReceiverTest.getIntentForActionAndIdentifier;
 import static com.mopub.mobileads.MoPubErrorCode.NETWORK_INVALID_STATE;
 import static com.mopub.mobileads.VastManager.VastManagerListener;
@@ -51,7 +51,7 @@
     private CustomEventInterstitialListener customEventInterstitialListener;
     private Map<String, Object> localExtras;
     private Map<String, String> serverExtras;
-    private TestHttpResponseWithHeaders response;
+    private HttpResponse response;
     private String expectedResponse;
     private VastManager vastManager;
     private String videoUrl;
@@ -73,7 +73,7 @@ public void setUp() throws Exception {
         serverExtras = new HashMap<String, String>();
         serverExtras.put(DataKeys.HTML_RESPONSE_BODY_KEY, expectedResponse);
 
-        response = new TestHttpResponseWithHeaders(200, expectedResponse);
+        response = mock(HttpResponse.class);
 
         broadcastIdentifier = 2222;
         localExtras.put(BROADCAST_IDENTIFIER_KEY, broadcastIdentifier);
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java
index 461d72a4..80435168 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/VastVideoViewControllerTest.java
@@ -38,14 +38,13 @@
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.robolectric.Robolectric;
-import org.robolectric.Shadows;
 import org.robolectric.annotation.Config;
-import org.robolectric.internal.ShadowExtractor;
+import org.robolectric.shadow.api.Shadow;
 import org.robolectric.shadows.ShadowApplication;
-import org.robolectric.shadows.ShadowImageView;
 import org.robolectric.shadows.ShadowRelativeLayout;
 import org.robolectric.shadows.ShadowTextView;
 import org.robolectric.shadows.ShadowVideoView;
+import org.robolectric.shadows.ShadowView;
 import org.robolectric.shadows.httpclient.FakeHttp;
 import org.robolectric.shadows.httpclient.RequestMatcher;
 import org.robolectric.shadows.httpclient.TestHttpResponse;
@@ -57,8 +56,8 @@
 import java.util.HashMap;
 import java.util.Map;
 
-import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_SENSOR_LANDSCAPE;
 import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;
+import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_SENSOR_LANDSCAPE;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_DISMISS;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_FAIL;
 import static com.mopub.common.IntentActions.ACTION_INTERSTITIAL_SHOW;
@@ -90,6 +89,7 @@
 import static org.mockito.Mockito.verifyNoMoreInteractions;
 import static org.mockito.Mockito.verifyZeroInteractions;
 import static org.mockito.Mockito.when;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class, shadows = {ShadowVastVideoView.class})
@@ -252,7 +252,7 @@ public void constructor_shouldAddCtaButtonWidgetToLayoutAndSetInvisibleWithOnTou
         VastVideoCtaButtonWidget ctaButtonWidget = subject.getCtaButtonWidget();
         assertThat(ctaButtonWidget.getParent()).isEqualTo(subject.getLayout());
         assertThat(ctaButtonWidget.getVisibility()).isEqualTo(View.INVISIBLE);
-        ShadowImageView ctaButtonWidgetShadow = Shadows.shadowOf(ctaButtonWidget);
+        ShadowView ctaButtonWidgetShadow = shadowOf(ctaButtonWidget);
         assertThat(ctaButtonWidgetShadow.getOnTouchListener()).isNotNull();
         assertThat(ctaButtonWidgetShadow.getOnTouchListener()).isEqualTo(
                 getShadowVideoView().getOnTouchListener());
@@ -265,7 +265,7 @@ public void constructor_shouldAddProgressBarWidgetToLayoutAndSetInvisibleWithNoL
         VastVideoProgressBarWidget progressBarWidget = subject.getProgressBarWidget();
         assertThat(progressBarWidget.getParent()).isEqualTo(subject.getLayout());
         assertThat(progressBarWidget.getVisibility()).isEqualTo(View.INVISIBLE);
-        ShadowImageView progressBarWidgetShadow = Shadows.shadowOf(progressBarWidget);
+        ShadowView progressBarWidgetShadow = shadowOf(progressBarWidget);
         assertThat(progressBarWidgetShadow.getOnTouchListener()).isNull();
     }
 
@@ -276,7 +276,7 @@ public void constructor_shouldAddRadialCountdownWidgetToLayoutAndSetInvisibleWit
         VastVideoRadialCountdownWidget radialCountdownWidget = subject.getRadialCountdownWidget();
         assertThat(radialCountdownWidget.getParent()).isEqualTo(subject.getLayout());
         assertThat(radialCountdownWidget.getVisibility()).isEqualTo(View.INVISIBLE);
-        ShadowImageView radialCountdownWidgetShadow = Shadows.shadowOf(radialCountdownWidget);
+        ShadowView radialCountdownWidgetShadow = shadowOf(radialCountdownWidget);
         assertThat(radialCountdownWidgetShadow.getOnTouchListener()).isNull();
     }
 
@@ -320,13 +320,13 @@ public void constructor_shouldAddCloseButtonWidgetToLayoutAndSetToGoneWithOnTouc
         assertThat(closeButtonWidget.getParent()).isEqualTo(subject.getLayout());
         assertThat(closeButtonWidget.getVisibility()).isEqualTo(View.GONE);
 
-        ShadowRelativeLayout closeButtonWidgetShadow = (ShadowRelativeLayout) Shadows.shadowOf(closeButtonWidget);
+        ShadowRelativeLayout closeButtonWidgetShadow = (ShadowRelativeLayout) shadowOf(closeButtonWidget);
         assertThat(closeButtonWidgetShadow.getOnTouchListener()).isNull();
 
-        ShadowImageView closeButtonImageViewShadow = Shadows.shadowOf(closeButtonWidget.getImageView());
+        ShadowView closeButtonImageViewShadow = shadowOf(closeButtonWidget.getImageView());
         assertThat(closeButtonImageViewShadow.getOnTouchListener()).isNotNull();
 
-        ShadowTextView closeButtonTextViewShadow = Shadows.shadowOf(closeButtonWidget.getTextView());
+        ShadowTextView closeButtonTextViewShadow = shadowOf(closeButtonWidget.getTextView());
         assertThat(closeButtonTextViewShadow.getOnTouchListener()).isNotNull();
     }
 
@@ -337,7 +337,7 @@ public void constructor_shouldAddTopGradientStripWidgetToLayoutWithNoListeners()
         VastVideoGradientStripWidget topGradientStripWidget = subject.getTopGradientStripWidget();
         assertThat(topGradientStripWidget.getParent()).isEqualTo(subject.getLayout());
 
-        ShadowImageView topGradientStripWidgetShadow = Shadows.shadowOf(topGradientStripWidget);
+        ShadowView topGradientStripWidgetShadow = shadowOf(topGradientStripWidget);
         assertThat(topGradientStripWidgetShadow.getOnTouchListener()).isNull();
     }
 
@@ -348,7 +348,7 @@ public void constructor_shouldAddBottomGradientStripWidgetToLayoutWithNoListener
         VastVideoGradientStripWidget bottomGradientStripWidget = subject.getBottomGradientStripWidget();
         assertThat(bottomGradientStripWidget.getParent()).isEqualTo(subject.getLayout());
 
-        ShadowImageView bottomGradientStripWidgetShadow = Shadows.shadowOf(bottomGradientStripWidget);
+        ShadowView bottomGradientStripWidgetShadow = shadowOf(bottomGradientStripWidget);
         assertThat(bottomGradientStripWidgetShadow.getOnTouchListener()).isNull();
     }
 
@@ -359,14 +359,14 @@ public void constructor_shouldAddBlurredLastVideoFrameWidgetToLayoutAndSetInvisi
         ImageView blurredLastVideoFrameImageView = subject.getBlurredLastVideoFrameImageView();
         assertThat(blurredLastVideoFrameImageView.getParent()).isEqualTo(subject.getLayout());
         assertThat(blurredLastVideoFrameImageView.getVisibility()).isEqualTo(View.INVISIBLE);
-        ShadowImageView blurredLastVideoFrameImageViewShadow = Shadows.shadowOf(blurredLastVideoFrameImageView);
+        ShadowView blurredLastVideoFrameImageViewShadow = shadowOf(blurredLastVideoFrameImageView);
         assertThat(blurredLastVideoFrameImageViewShadow.getOnTouchListener()).isNull();
     }
 
     @Test
     public void constructor_shouldSetVideoListenersAndVideoPath() throws Exception {
         initializeSubject();
-        ShadowVideoView videoView = Shadows.shadowOf(subject.getVideoView());
+        ShadowVideoView videoView = shadowOf(subject.getVideoView());
 
         assertThat(videoView.getOnCompletionListener()).isNotNull();
         assertThat(videoView.getOnErrorListener()).isNotNull();
@@ -551,7 +551,8 @@ public void onCreate_shouldBroadcastInterstitialShow() throws Exception {
 
         Robolectric.getForegroundThreadScheduler().unPause();
         subject.onCreate();
-        verify(broadcastReceiver).onReceive(any(Context.class), eq(expectedIntent));
+        verify(broadcastReceiver).onReceive(any(Context.class),
+                argThat(new IntentIsEqual(expectedIntent)));
     }
 
     @Test
@@ -665,7 +666,8 @@ public void onDestroy_shouldBroadcastInterstitialDismiss() throws Exception {
         subject.onDestroy();
         Robolectric.getForegroundThreadScheduler().unPause();
 
-        verify(broadcastReceiver).onReceive(any(Context.class), eq(expectedIntent));
+        verify(broadcastReceiver).onReceive(any(Context.class),
+                argThat(new IntentIsEqual(expectedIntent)));
     }
 
     @Test
@@ -784,7 +786,7 @@ public void onTouch_withTouchUp_whenVideoLessThan16Seconds_andClickAfterEnd_shou
         getShadowVideoView().getOnTouchListener().onTouch(null, GestureUtils.createActionUp(0, 0));
 
         Robolectric.getBackgroundThreadScheduler().advanceBy(0);
-        final Intent startedActivity = ShadowApplication.getInstance().peekNextStartedActivity();
+        final Intent startedActivity = shadowOf((Activity) context).peekNextStartedActivity();
         assertThat(startedActivity.getComponent().getClassName())
                 .isEqualTo(MoPubBrowser.class.getName());
         assertThat(startedActivity.getStringExtra(MoPubBrowser.DESTINATION_URL_KEY)).isEqualTo(
@@ -824,7 +826,7 @@ public void onTouch_withTouchUp_whenVideoLongerThan16Seconds_andClickAfter5Secon
         getShadowVideoView().getOnTouchListener().onTouch(null, GestureUtils.createActionUp(0, 0));
 
         Robolectric.getBackgroundThreadScheduler().advanceBy(0);
-        final Intent startedActivity = ShadowApplication.getInstance().peekNextStartedActivity();
+        final Intent startedActivity = shadowOf((Activity) context).peekNextStartedActivity();
         assertThat(startedActivity.getComponent().getClassName())
                 .isEqualTo(MoPubBrowser.class.getName());
         assertThat(startedActivity.getStringExtra(MoPubBrowser.DESTINATION_URL_KEY)).isEqualTo(
@@ -1197,7 +1199,7 @@ public void onPrepared_shouldSetBlurredLastVideoFrame() throws Exception {
         assertThat(
                 ((BitmapDrawable) blurredLastVideoFrameImageView.getDrawable()).getBitmap()).isNotNull();
 
-        ShadowImageView imageView = Shadows.shadowOf(subject.getBlurredLastVideoFrameImageView());
+        ShadowView imageView = shadowOf(subject.getBlurredLastVideoFrameImageView());
         assertThat(imageView.getOnTouchListener()).isNull();
     }
 
@@ -1486,7 +1488,8 @@ public void onError_shouldFireVideoErrorAndReturnFalse() throws Exception {
         Robolectric.getForegroundThreadScheduler().unPause();
 
         assertThat(result).isFalse();
-        verify(broadcastReceiver).onReceive(any(Context.class), eq(expectedIntent));
+        verify(broadcastReceiver).onReceive(any(Context.class),
+                argThat(new IntentIsEqual(expectedIntent)));
         assertThat(subject.getVideoError()).isTrue();
     }
 
@@ -2084,7 +2087,7 @@ public void onClickCloseButtonImageView_whenCloseButtonIsVisible_shouldFireClose
         // We don't have direct access to the CloseButtonWidget icon's close event, so we manually
         // invoke its onTouchListener's onTouch callback with a fake MotionEvent.ACTION_UP action.
         View.OnTouchListener closeButtonImageViewOnTouchListener =
-                Shadows.shadowOf(subject.getCloseButtonWidget().getImageView()).getOnTouchListener();
+                shadowOf(subject.getCloseButtonWidget().getImageView()).getOnTouchListener();
         closeButtonImageViewOnTouchListener.onTouch(null, GestureUtils.createActionUp(0, 0));
 
         verify(mockRequestQueue).add(
@@ -2107,7 +2110,7 @@ public void onClickCloseButtonTextView_whenCloseButtonIsVisible_shouldFireCloseT
         // We don't have direct access to the CloseButtonWidget text's close event, so we manually
         // invoke its onTouchListener's onTouch callback with a fake MotionEvent.ACTION_UP action.
         View.OnTouchListener closeButtonTextViewOnTouchListener =
-                Shadows.shadowOf(subject.getCloseButtonWidget().getTextView()).getOnTouchListener();
+                shadowOf(subject.getCloseButtonWidget().getTextView()).getOnTouchListener();
         closeButtonTextViewOnTouchListener.onTouch(null, GestureUtils.createActionUp(0, 0));
 
         verify(mockRequestQueue).add(
@@ -2239,7 +2242,7 @@ private void setVideoViewParams(int currentPosition, int duration) throws Illega
     }
 
     private ShadowVastVideoView getShadowVideoView() {
-        return (ShadowVastVideoView) ShadowExtractor.extract(subject.getVastVideoView());
+        return (ShadowVastVideoView) Shadow.extract(subject.getVastVideoView());
     }
 
     private void setViewabilityTrackersTracked(VastVideoConfig vastVideoConfig) {
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java
index feb326a2..a284e863 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/ViewGestureDetectorTest.java
@@ -11,6 +11,7 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
+import org.robolectric.Robolectric;
 import org.robolectric.Shadows;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowGestureDetector;
@@ -34,7 +35,7 @@
 
     @Before
     public void setUp() throws Exception {
-        context = new Activity();
+        context = Robolectric.buildActivity(Activity.class).create().get();
         view = mock(View.class);
         stub(view.getWidth()).toReturn(320);
         stub(view.getHeight()).toReturn(50);
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewAdUrlGeneratorTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewAdUrlGeneratorTest.java
index 9053b737..7ab409d2 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewAdUrlGeneratorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/WebViewAdUrlGeneratorTest.java
@@ -2,6 +2,8 @@
 
 import android.app.Activity;
 import android.content.Context;
+import android.content.pm.PackageInfo;
+import android.content.pm.PackageManager;
 import android.content.res.Configuration;
 import android.content.res.Resources;
 import android.graphics.Point;
@@ -19,14 +21,22 @@
 import android.view.WindowManager;
 
 import com.mopub.common.ClientMetadata;
-import com.mopub.common.GpsHelper;
-import com.mopub.common.GpsHelperTest;
 import com.mopub.common.LocationService;
 import com.mopub.common.MoPub;
+import com.mopub.common.MoPubAdvancedBidder;
+import com.mopub.common.SdkConfiguration;
+import com.mopub.common.privacy.AdvertisingId;
+import com.mopub.common.privacy.ConsentData;
+import com.mopub.common.privacy.ConsentStatus;
+import com.mopub.common.privacy.MoPubIdentifier;
+import com.mopub.common.privacy.MoPubIdentifierTest;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Reflection;
 import com.mopub.common.util.Reflection.MethodBuilder;
 import com.mopub.common.util.Utils;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
+import com.mopub.mobileads.test.support.MoPubShadowConnectivityManager;
 import com.mopub.mobileads.test.support.MoPubShadowTelephonyManager;
 import com.mopub.mraid.MraidNativeCommandHandler;
 import com.mopub.network.PlayServicesUrlRewriter;
@@ -41,25 +51,23 @@
 import org.robolectric.RuntimeEnvironment;
 import org.robolectric.Shadows;
 import org.robolectric.annotation.Config;
-import org.robolectric.shadows.ShadowConnectivityManager;
 import org.robolectric.shadows.ShadowLocationManager;
 import org.robolectric.shadows.ShadowNetworkInfo;
 
 import static android.Manifest.permission.ACCESS_COARSE_LOCATION;
 import static android.Manifest.permission.ACCESS_FINE_LOCATION;
 import static android.Manifest.permission.ACCESS_NETWORK_STATE;
+import static android.Manifest.permission.READ_PHONE_STATE;
 import static android.net.ConnectivityManager.TYPE_DUMMY;
 import static android.net.ConnectivityManager.TYPE_ETHERNET;
 import static android.net.ConnectivityManager.TYPE_MOBILE;
-import static android.net.ConnectivityManager.TYPE_MOBILE_DUN;
-import static android.net.ConnectivityManager.TYPE_MOBILE_HIPRI;
-import static android.net.ConnectivityManager.TYPE_MOBILE_MMS;
-import static android.net.ConnectivityManager.TYPE_MOBILE_SUPL;
 import static android.net.ConnectivityManager.TYPE_WIFI;
 import static android.telephony.TelephonyManager.NETWORK_TYPE_UNKNOWN;
 import static com.mopub.common.ClientMetadata.MoPubNetworkType;
+import static com.mopub.common.MoPubTest.INIT_ADUNIT;
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.anyInt;
 import static org.mockito.Mockito.doAnswer;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.reset;
@@ -67,7 +75,7 @@
 import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class, shadows = {MoPubShadowTelephonyManager.class})
+@Config(constants = BuildConfig.class, shadows = {MoPubShadowTelephonyManager.class, MoPubShadowConnectivityManager.class})
 public class WebViewAdUrlGeneratorTest {
 
     private static final String TEST_UDID = "20b013c721c";
@@ -79,16 +87,19 @@
     private String expectedUdid;
     private Configuration configuration;
     private MoPubShadowTelephonyManager shadowTelephonyManager;
-    private ShadowConnectivityManager shadowConnectivityManager;
+    private MoPubShadowConnectivityManager shadowConnectivityManager;
     private Activity context;
     private MethodBuilder methodBuilder;
+    private PersonalInfoManager mockPersonalInfoManager;
+    private ConsentData mockConsentData;
 
     @Before
-    public void setup() {
+    public void setup() throws Exception {
         context = spy(Robolectric.buildActivity(Activity.class).create().get());
         Shadows.shadowOf(context).grantPermissions(ACCESS_NETWORK_STATE);
         Shadows.shadowOf(context).grantPermissions(ACCESS_FINE_LOCATION);
         Shadows.shadowOf(context).grantPermissions(ACCESS_COARSE_LOCATION);
+        Shadows.shadowOf(context).grantPermissions(READ_PHONE_STATE);
 
         // Set the expected screen dimensions to arbitrary numbers
         final Resources spyResources = spy(context.getResources());
@@ -116,30 +127,57 @@ public Object answer(final InvocationOnMock invocationOnMock) throws Throwable {
             }).when(mockDisplay).getRealSize(any(Point.class));
             when(mockWindowManager.getDefaultDisplay()).thenReturn(mockDisplay);
             final Context spyApplicationContext = spy(context.getApplicationContext());
+            when(spyApplicationContext.getResources()).thenReturn(spyResources);
+            when(spyApplicationContext.getPackageName()).thenReturn("testBundle");
+            PackageManager mockPackageManager = mock(PackageManager.class);
+            PackageInfo mockPackageInfo = mock(PackageInfo.class);
+            mockPackageInfo.versionName = BuildConfig.VERSION_NAME;
+            when(mockPackageManager.getPackageInfo(any(String.class), anyInt())).thenReturn(mockPackageInfo);
+            when(spyApplicationContext.getPackageManager()).thenReturn(mockPackageManager);
             when(spyApplicationContext.getSystemService(Context.WINDOW_SERVICE)).thenReturn(mockWindowManager);
             when(context.getApplicationContext()).thenReturn(spyApplicationContext);
+            when(spyApplicationContext.getApplicationContext()).thenReturn(spyApplicationContext);
         }
 
+        mockConsentData = mock(ConsentData.class);
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
+        when(mockPersonalInfoManager.getPersonalInfoConsentStatus()).thenReturn(ConsentStatus.UNKNOWN);
+        when(mockPersonalInfoManager.getConsentData()).thenReturn(mockConsentData);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         subject = new WebViewAdUrlGenerator(context,
                 new MraidNativeCommandHandler().isStorePictureSupported(context));
         Settings.Secure.putString(RuntimeEnvironment.application.getContentResolver(), Settings.Secure.ANDROID_ID, TEST_UDID);
         expectedUdid = "sha%3A" + Utils.sha1(TEST_UDID);
         configuration = RuntimeEnvironment.application.getResources().getConfiguration();
         shadowTelephonyManager = (MoPubShadowTelephonyManager) Shadows.shadowOf((TelephonyManager) RuntimeEnvironment.application.getSystemService(Context.TELEPHONY_SERVICE));
-        shadowConnectivityManager = Shadows.shadowOf((ConnectivityManager) RuntimeEnvironment.application.getSystemService(Context.CONNECTIVITY_SERVICE));
+        shadowConnectivityManager = (MoPubShadowConnectivityManager) Shadows.shadowOf((ConnectivityManager) RuntimeEnvironment.application.getSystemService(Context.CONNECTIVITY_SERVICE));
+        shadowConnectivityManager.clearAllNetworks();
+        shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_MOBILE));
         methodBuilder = TestMethodBuilderFactory.getSingletonMock();
 
         LocationService.clearLastKnownLocation();
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(context, false);
     }
 
     @After
     public void tearDown() throws Exception {
         reset(methodBuilder);
+        ClientMetadata.clearForTesting();
+        MoPubIdentifierTest.clearPreferences(context);
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
     }
 
     @Test
-    public void generateAdUrl_shouldIncludeMinimumFields() throws Exception {
-        String expectedAdUrl = new AdUrlBuilder(expectedUdid).build();
+    public void generateAdUrl_shouldIncludeMinimumFields() {
+        String expectedAdUrl = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue()).build();
 
         String adUrl = generateMinimumUrlString();
 
@@ -147,14 +185,16 @@ public void generateAdUrl_shouldIncludeMinimumFields() throws Exception {
     }
 
     @Test
-    public void generateAdUrl_withHttpsScheme() throws Exception {
+    public void generateAdUrl_withHttpsScheme() {
         String adUrl = generateMinimumUrlString();
-        assertThat(adUrl).startsWith("http://");
+        assertThat(adUrl).startsWith("https://");
     }
 
     @Test
-    public void generateAdUrl_shouldRunMultipleTimes() throws Exception {
-        String expectedAdUrl = new AdUrlBuilder(expectedUdid).build();
+    public void generateAdUrl_shouldRunMultipleTimes() throws Exception{
+        String expectedAdUrl = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue()).build();
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
 
         String adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(expectedAdUrl);
@@ -164,15 +204,151 @@ public void generateAdUrl_shouldRunMultipleTimes() throws Exception {
 
     @Test
     public void generateAdUrl_shouldIncludeAllFields() throws Exception {
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(
+                INIT_ADUNIT).withAdvancedBidder(
+                WebViewAdvancedBidder.class).build();
+        MoPub.initializeSdk(context, sdkConfiguration, null);
+        MoPub.setAdvancedBiddingEnabled(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
+        ClientMetadata.clearForTesting();
+
         final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
                 .withAdUnitId("adUnitId")
-                .withQuery("key%3Avalue")
+                .withKeywordsQuery("keywordsKey%3AkeywordsValue")
+                .withUserDataQuery("userDataKey%3AuserDataValue")
                 .withLatLon("20.1%2C30.0", "1", "101325")
                 .withMcc("123")
                 .withMnc("456")
                 .withCountryIso("expected%20country")
                 .withCarrierName("expected%20carrier")
                 .withExternalStoragePermission(false)
+                .withAbt("{\"UrlGeneratorTest\":{\"token\":\"WebViewAdvancedBidderToken\"}}")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
+
+        shadowTelephonyManager.setNetworkOperator("123456");
+        shadowTelephonyManager.setNetworkCountryIso("expected country");
+        shadowTelephonyManager.setNetworkOperatorName("expected carrier");
+
+        Location location = new Location("");
+        location.setLatitude(20.1);
+        location.setLongitude(30.0);
+        location.setAccuracy(1.23f); // should get rounded to "1"
+        location.setTime(System.currentTimeMillis() - 101325);
+
+        String adUrl = subject
+                .withAdUnitId("adUnitId")
+                .withKeywords("keywordsKey:keywordsValue")
+                .withUserDataKeywords("userDataKey:userDataValue")
+                .withLocation(location)
+                .generateUrlString("ads.mopub.com");
+
+        // Only compare the seconds since millis can be off
+        adUrl = adUrl.replaceFirst("llf=101[0-9]{3}", "llf=101325");
+
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
+
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
+    }
+
+    @Test
+    public void generateAdUrl_shouldNotLocationFieldsWhenConsentIsFalse() throws Exception {
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(
+                INIT_ADUNIT).withAdvancedBidder(WebViewAdvancedBidder.class).build();
+        MoPub.initializeSdk(context, sdkConfiguration, null);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withAdUnitId("adUnitId")
+                .withExternalStoragePermission(false)
+                .withKeywordsQuery("keywordsKey%3AkeywordsValue")
+                .withAbt("{\"UrlGeneratorTest\":{\"token\":\"WebViewAdvancedBidderToken\"}}")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
+
+        shadowTelephonyManager.setNetworkOperator("123456");
+        shadowTelephonyManager.setNetworkCountryIso("expected country");
+        shadowTelephonyManager.setNetworkOperatorName("expected carrier");
+
+        Location location = new Location("");
+        location.setLatitude(20.1);
+        location.setLongitude(30.0);
+        location.setAccuracy(1.23f); // should get rounded to "1"
+        location.setTime(System.currentTimeMillis() - 101325);
+
+        String adUrl = subject
+                .withAdUnitId("adUnitId")
+                .withKeywords("keywordsKey:keywordsValue")
+                .withLocation(location)
+                .generateUrlString("ads.mopub.com");
+
+        // Only compare the seconds since millis can be off
+        adUrl = adUrl.replaceFirst("llf=101[0-9]{3}", "llf=101325");
+
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
+    }
+
+    @Test
+    public void generateAdUrl_withAdvancedBiddingDisabled_shouldNotIncludeAbt() throws Exception {
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(
+                INIT_ADUNIT).withAdvancedBidder(
+                WebViewAdvancedBidder.class).build();
+        MoPub.initializeSdk(context, sdkConfiguration, null);
+        MoPub.setAdvancedBiddingEnabled(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
+
+        String adUrl = subject.generateUrlString("ads.mopub.com");
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
+
+        MoPub.setAdvancedBiddingEnabled(true);
+    }
+
+    @Test
+    public void generateAdUrl_withCollectUserDataDisabled_shouldNotIncludeKeywords() throws Exception {
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(INIT_ADUNIT)
+                .withAdvancedBidder(WebViewAdvancedBidder.class).build();
+        MoPub.initializeSdk(context, sdkConfiguration, null);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        // expected has no keywords
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withAdUnitId("adUnitId")
+                .withKeywordsQuery("keywordsKey%3AkeywordsValue")
+                .withExternalStoragePermission(false)
+                .withAbt("{\"UrlGeneratorTest\":{\"token\":\"WebViewAdvancedBidderToken\"}}")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
                 .build();
 
         shadowTelephonyManager.setNetworkOperator("123456");
@@ -187,7 +363,8 @@ public void generateAdUrl_shouldIncludeAllFields() throws Exception {
 
         String adUrl = subject
                 .withAdUnitId("adUnitId")
-                .withKeywords("key:value")
+                .withUserDataKeywords("key:value")
+                .withKeywords("keywordsKey:keywordsValue")
                 .withLocation(location)
                 .generateUrlString("ads.mopub.com");
 
@@ -195,10 +372,39 @@ public void generateAdUrl_shouldIncludeAllFields() throws Exception {
         adUrl = adUrl.replaceFirst("llf=101[0-9]{3}", "llf=101325");
 
         assertThat(adUrl).isEqualTo(expectedAdUrl);
+
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
     }
 
     @Test
-    public void generateAdUrl_shouldRecognizeOrientation() throws Exception {
+    public void generateAdUrl_withAdvancedBiddingEnabled_shouldIncludeAbt() throws Exception {
+        MoPub.setAdvancedBiddingEnabled(true);
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(
+                "b195f8dd8ded45fe847ad89ed1d016da").withAdvancedBidder(
+                WebViewAdvancedBidder.class).build();
+        MoPub.initializeSdk(context, sdkConfiguration, null);
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withAbt("{\"UrlGeneratorTest\":{\"token\":\"WebViewAdvancedBidderToken\"}}")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
+
+        String adUrl = subject.generateUrlString("ads.mopub.com");
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
+
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
+    }
+
+    @Test
+    public void generateAdUrl_shouldRecognizeOrientation() {
         configuration.orientation = Configuration.ORIENTATION_LANDSCAPE;
         assertThat(generateMinimumUrlString()).contains("&o=l");
         configuration.orientation = Configuration.ORIENTATION_PORTRAIT;
@@ -208,8 +414,8 @@ public void generateAdUrl_shouldRecognizeOrientation() throws Exception {
     }
 
     @Test
-    public void generateAdUrl_shouldHandleFunkyNetworkOperatorCodes() throws Exception {
-        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+    public void generateAdUrl_shouldHandleFunkyNetworkOperatorCodes() {
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue());
 
         shadowTelephonyManager.setNetworkOperator("123456");
         String adUrl = generateMinimumUrlString();
@@ -237,19 +443,71 @@ public void generateAdUrl_shouldHandleFunkyNetworkOperatorCodes() throws Excepti
     }
 
     @Test
-    public void generateAdUrl_needsAndDoesNotHaveReadPhoneState_shouldNotContainOperatorName() {
-        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+    public void generateAdUrl_needsAndDoesNotHaveReadPhoneState_shouldNotContainOperatorName() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withCarrierName("")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
 
         shadowTelephonyManager.setNeedsReadPhoneState(true);
         shadowTelephonyManager.setReadPhoneStatePermission(false);
 
         String adUrl = generateMinimumUrlString();
-        assertThat(adUrl).isEqualTo(urlBuilder.withCarrierName("").build());
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
     }
 
     @Test
-    public void generateAdUrl_needsAndHasReadPhoneState_shouldContainOperatorName() {
-        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+    public void generateAdUrl_shouldIncludeGdprAppliesWhenAvailable() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        when(mockPersonalInfoManager.gdprApplies()).thenReturn(true);
+
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withGdprApplies("1")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
+
+        String adUrl = generateMinimumUrlString();
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
+    }
+
+    @Test
+    public void generateAdUrl_shouldIncludeConsentedPrivacyPolicyVersionWhenAvailable() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        when(mockPersonalInfoManager.getConsentData()).thenReturn(mockConsentData);
+        when(mockConsentData.getConsentedPrivacyPolicyVersion()).thenReturn("10");
+
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withConsentedPrivacyPolicyVersion("10")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
+
+        String adUrl = generateMinimumUrlString();
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
+    }
+
+    @Test
+    public void generateAdUrl_shouldIncludeConsentedVendorListVersionWhenAvailable() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        when(mockPersonalInfoManager.getConsentData()).thenReturn(mockConsentData);
+        when(mockConsentData.getConsentedVendorListVersion()).thenReturn("15");
+
+        final String expectedAdUrl = new AdUrlBuilder(expectedUdid)
+                .withConsentedVendorListVersion("15")
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                .build();
+
+        String adUrl = generateMinimumUrlString();
+        assertThat(adUrl).isEqualTo(expectedAdUrl);
+    }
+
+
+    @Test
+    public void generateAdUrl_needsAndHasReadPhoneState_shouldContainOperatorName() throws Exception {
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue());
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
 
         shadowTelephonyManager.setNeedsReadPhoneState(true);
         shadowTelephonyManager.setReadPhoneStatePermission(true);
@@ -261,7 +519,7 @@ public void generateAdUrl_needsAndHasReadPhoneState_shouldContainOperatorName()
 
     @Test
     public void generateAdUrl_doesNotNeedReadPhoneState_shouldContainOperatorName() {
-        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue());
 
         shadowTelephonyManager.setNeedsReadPhoneState(false);
         shadowTelephonyManager.setReadPhoneStatePermission(false);
@@ -272,8 +530,8 @@ public void generateAdUrl_doesNotNeedReadPhoneState_shouldContainOperatorName()
     }
 
     @Test
-    public void generateAdurl_whenOnCDMA_shouldGetOwnerStringFromSimCard() throws Exception {
-        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+    public void generateAdurl_whenOnCDMA_shouldGetOwnerStringFromSimCard() {
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue());
         shadowTelephonyManager.setPhoneType(TelephonyManager.PHONE_TYPE_CDMA);
         shadowTelephonyManager.setSimState(TelephonyManager.SIM_STATE_READY);
         shadowTelephonyManager.setNetworkOperator("123456");
@@ -283,21 +541,28 @@ public void generateAdurl_whenOnCDMA_shouldGetOwnerStringFromSimCard() throws Ex
     }
 
     @Test
-    public void generateAdurl_whenSimNotReady_shouldDefaultToNetworkOperator() throws Exception {
+    public void generateAdurl_whenSimNotReady_shouldDefaultToNetworkOperator() {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
         AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
         shadowTelephonyManager.setPhoneType(TelephonyManager.PHONE_TYPE_CDMA);
         shadowTelephonyManager.setSimState(TelephonyManager.SIM_STATE_ABSENT);
         shadowTelephonyManager.setNetworkOperator("123456");
         shadowTelephonyManager.setSimOperator("789012");
         String adUrl = generateMinimumUrlString();
-        assertThat(adUrl).isEqualTo(urlBuilder.withMcc("123").withMnc("456").build());
+        assertThat(adUrl).isEqualTo(urlBuilder.withMcc("123")
+                                            .withMnc("456").
+                                            withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
+                                            .build());
     }
 
     @Test
     public void generateAdUrl_shouldSetNetworkType() throws Exception {
-        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue());
         String adUrl;
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
+        shadowConnectivityManager.setActiveNetworkInfo(null);
         shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_DUMMY));
         adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.UNKNOWN).build());
@@ -305,35 +570,40 @@ public void generateAdUrl_shouldSetNetworkType() throws Exception {
         shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_ETHERNET));
         adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.ETHERNET).build());
+        shadowConnectivityManager.clearAllNetworks();
 
         shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_WIFI));
         adUrl = generateMinimumUrlString();
         assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.WIFI).build());
 
-        // bunch of random mobile types just to make life more interesting
+        shadowConnectivityManager.setNetworkInfo(TYPE_WIFI, null);
+        shadowConnectivityManager.clearAllNetworks();
         shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_MOBILE));
-        adUrl = generateMinimumUrlString();
-        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.MOBILE).build());
 
-        shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_MOBILE_DUN));
+        // bunch of random mobile types just to make life more interesting
+        shadowConnectivityManager.setActiveNetworkInfo(
+                createNetworkInfo(TYPE_MOBILE, TelephonyManager.NETWORK_TYPE_GPRS));
         adUrl = generateMinimumUrlString();
-        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.MOBILE).build());
+        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.GG).build());
 
-        shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_MOBILE_HIPRI));
+        shadowConnectivityManager.setActiveNetworkInfo(
+                createNetworkInfo(TYPE_MOBILE, TelephonyManager.NETWORK_TYPE_HSPA));
         adUrl = generateMinimumUrlString();
-        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.MOBILE).build());
+        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.GGG).build());
 
-        shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_MOBILE_MMS));
+        shadowConnectivityManager.setActiveNetworkInfo(
+                createNetworkInfo(TYPE_MOBILE, TelephonyManager.NETWORK_TYPE_EVDO_0));
         adUrl = generateMinimumUrlString();
-        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.MOBILE).build());
+        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.GGG).build());
 
-        shadowConnectivityManager.setActiveNetworkInfo(createNetworkInfo(TYPE_MOBILE_SUPL));
+        shadowConnectivityManager.setActiveNetworkInfo(
+                createNetworkInfo(TYPE_MOBILE, TelephonyManager.NETWORK_TYPE_LTE));
         adUrl = generateMinimumUrlString();
-        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.MOBILE).build());
+        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.GGGG).build());
     }
 
     @Test
-    public void generateAdUrl_whenNoNetworkPermission_shouldGenerateUnknownNetworkType() throws Exception {
+    public void generateAdUrl_whenNoNetworkPermission_shouldGenerateUnknownNetworkType() {
         AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
 
         Shadows.shadowOf(context).denyPermissions(ACCESS_NETWORK_STATE);
@@ -341,41 +611,70 @@ public void generateAdUrl_whenNoNetworkPermission_shouldGenerateUnknownNetworkTy
 
         String adUrl = generateMinimumUrlString();
 
-        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.UNKNOWN).build());
+        assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.UNKNOWN)
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue()).build());
     }
 
     @Test
     public void generateAdUrl_shouldTolerateNullActiveNetwork() throws Exception {
-        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid);
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(INIT_ADUNIT)
+                .withAdvancedBidder(WebViewAdvancedBidder.class).build();
+        MoPub.initializeSdk(context, sdkConfiguration, null);
+        MoPub.setAdvancedBiddingEnabled(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+
+        AdUrlBuilder urlBuilder = new AdUrlBuilder(expectedUdid).withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue());
         shadowConnectivityManager.setActiveNetworkInfo(null);
 
         String adUrl = generateMinimumUrlString();
 
         assertThat(adUrl).isEqualTo(urlBuilder.withNetworkType(MoPubNetworkType.UNKNOWN).build());
+
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
     }
 
 
 
     @Test
-    public void generateAdUrl_whenGooglePlayServicesIsLinkedAndAdInfoIsCached_shouldUseAdInfoParams() throws Exception {
-        GpsHelper.setClassNamesForTesting();
-        when(methodBuilder.setStatic(any(Class.class))).thenReturn(methodBuilder);
-        when(methodBuilder.addParam(any(Class.class), any())).thenReturn(methodBuilder);
-        when(methodBuilder.execute()).thenReturn(GpsHelper.GOOGLE_PLAY_SUCCESS_CODE);
+    public void generateAdUrl_whenAdInfoIsCached_shouldUseAdInfoParams() throws Exception {
+        SdkConfiguration sdkConfiguration = new SdkConfiguration.Builder(INIT_ADUNIT).build();
+        MoPub.initializeSdk(context, sdkConfiguration, null);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(context, false);
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
 
-        GpsHelperTest.TestAdInfo adInfo = new GpsHelperTest.TestAdInfo();
         final ClientMetadata clientMetadata = ClientMetadata.getInstance(context);
-        clientMetadata.setAdvertisingInfo(adInfo.mAdId, adInfo.mLimitAdTrackingEnabled);
+        MoPubIdentifier identifier = clientMetadata.getMoPubIdentifier();
+        AdvertisingId adInfo = identifier.getAdvertisingInfo();
 
-        expectedUdid = "ifa%3A" + adInfo.ADVERTISING_ID;
+        String generatedAdUrl = generateMinimumUrlString();
+        expectedUdid = "ifa%3A" + adInfo.getIdWithPrefix(true);
         String expectedAdUrl = new AdUrlBuilder(expectedUdid)
-                .withDnt(adInfo.LIMIT_AD_TRACKING_ENABLED)
+                .withDnt(adInfo.isDoNotTrack())
+                .withCurrentConsentStatus(ConsentStatus.UNKNOWN.getValue())
                 .build();
-        assertThat(generateMinimumUrlString()).isEqualTo(expectedAdUrl);
+        assertThat(generatedAdUrl).isEqualTo(expectedAdUrl);
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_shouldUseLocationServiceValue() {
+    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_shouldUseLocationServiceValue() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -401,7 +700,9 @@ public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_sh
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_WithFineLocationPermissionOnly_shouldUseLocationServiceValue() {
+    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_WithFineLocationPermissionOnly_shouldUseLocationServiceValue() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Shadows.shadowOf(context).denyPermissions(ACCESS_COARSE_LOCATION);
 
         Location locationFromDeveloper = new Location("");
@@ -429,9 +730,11 @@ public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_Wi
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_WithCoarseLocationPermissionOnly_shouldUseDeveloperSuppliedLocation() {
+    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_WithCoarseLocationPermissionOnly_shouldUseDeveloperSuppliedLocation() throws Exception {
         Shadows.shadowOf(context).denyPermissions(ACCESS_FINE_LOCATION);
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -457,10 +760,12 @@ public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_Wi
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_WithNoLocationPermission_shouldUseDeveloperSuppliedLocation() {
+    public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_WithNoLocationPermission_shouldUseDeveloperSuppliedLocation() throws Exception {
         Shadows.shadowOf(context).denyPermissions(ACCESS_FINE_LOCATION);
         Shadows.shadowOf(context).denyPermissions(ACCESS_COARSE_LOCATION);
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -486,7 +791,9 @@ public void generateAdUrl_whenLocationServiceGpsProviderHasMostRecentLocation_Wi
     }
 
     @Test
-    public void generateAdUrl_whenDeveloperSuppliesMoreRecentLocationThanLocationService_shouldUseDeveloperSuppliedLocation() {
+    public void generateAdUrl_whenDeveloperSuppliesMoreRecentLocationThanLocationService_shouldUseDeveloperSuppliedLocation() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -513,7 +820,10 @@ public void generateAdUrl_whenDeveloperSuppliesMoreRecentLocationThanLocationSer
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_shouldUseLocationServiceValue() {
+    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_shouldUseLocationServiceValue() throws Exception {
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -540,7 +850,9 @@ public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocatio
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_WithFineLocationPermissionOnly_shouldUseLocationServiceValue() {
+    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_WithFineLocationPermissionOnly_shouldUseLocationServiceValue() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Shadows.shadowOf(context).denyPermissions(ACCESS_COARSE_LOCATION);
 
         Location locationFromDeveloper = new Location("");
@@ -569,9 +881,11 @@ public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocatio
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_WithCoarseLocationPermissionOnly_shouldUseLocationServiceValue() {
+    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_WithCoarseLocationPermissionOnly_shouldUseLocationServiceValue() throws Exception {
         Shadows.shadowOf(context).denyPermissions(ACCESS_FINE_LOCATION);
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -598,10 +912,12 @@ public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocatio
     }
 
     @Test
-    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_WithNoLocationPermission_shouldUseDeveloperSuppliedLocation() {
+    public void generateAdUrl_whenLocationServiceNetworkProviderHasMostRecentLocation_WithNoLocationPermission_shouldUseDeveloperSuppliedLocation() throws Exception {
         Shadows.shadowOf(context).denyPermissions(ACCESS_FINE_LOCATION);
         Shadows.shadowOf(context).denyPermissions(ACCESS_COARSE_LOCATION);
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -681,10 +997,14 @@ private String getParameterFromRequestUrl(String requestString, String key) {
         return parameter;
     }
 
-    private NetworkInfo createNetworkInfo(int type) {
+    private NetworkInfo createNetworkInfo(int type, int subtype) {
         return ShadowNetworkInfo.newInstance(null,
                 type,
-                NETWORK_TYPE_UNKNOWN, true, true);
+                subtype, true, true);
+    }
+
+    private NetworkInfo createNetworkInfo(int type) {
+       return createNetworkInfo(type, NETWORK_TYPE_UNKNOWN);
     }
 
     private String generateMinimumUrlString() {
@@ -694,7 +1014,8 @@ private String generateMinimumUrlString() {
     private static class AdUrlBuilder {
         private String expectedUdid;
         private String adUnitId = "";
-        private String query = "";
+        private String keywordsQuery = "";
+        private String userDataQuery = "";
         private String latLon = "";
         private String locationAccuracy = "";
         private String latLonLastUpdated = "";
@@ -705,13 +1026,19 @@ private String generateMinimumUrlString() {
         private String dnt = "";
         private MoPubNetworkType networkType = MoPubNetworkType.MOBILE;
         private int externalStoragePermission;
+        private String abt = "";
+        private String currentConsentStatus = "";
+        private String gdprApplies = "0";
+        private String forceGdprApplies = "0";
+        private String consentedPrivacyPolicyVersion = "";
+        private String consentedVendorListVersion = "";
 
         public AdUrlBuilder(String expectedUdid) {
             this.expectedUdid = expectedUdid;
         }
 
         public String build() {
-            return "http://ads.mopub.com/m/ad" +
+            return "https://ads.mopub.com/m/ad" +
                     "?v=6" +
                     paramIfNotEmpty("id", adUnitId) +
                     "&nv=" + Uri.encode(MoPub.SDK_VERSION) +
@@ -719,22 +1046,29 @@ public String build() {
                     "%2C" + Build.MODEL +
                     "%2C" + Build.PRODUCT +
                     "&bundle=" + "testBundle" +
-                    paramIfNotEmpty("q", query) +
+                    paramIfNotEmpty("q", keywordsQuery) +
+                    paramIfNotEmpty("user_data_q", userDataQuery) +
                     (TextUtils.isEmpty(latLon) ? "" :
                             "&ll=" + latLon + "&lla=" + locationAccuracy + "&llf=" + latLonLastUpdated) +
                     "&z=-0700" +
                     "&o=u" +
                     "&w=" + TEST_SCREEN_WIDTH +
                     "&h=" + TEST_SCREEN_HEIGHT +
-                    "&sc_a=1.0" +
+                    "&sc=1.0" +
                     paramIfNotEmpty("mcc", mcc) +
                     paramIfNotEmpty("mnc", mnc) +
                     paramIfNotEmpty("iso", countryIso) +
                     paramIfNotEmpty("cn", carrierName) +
                     "&ct=" + networkType +
                     "&av=" + Uri.encode(BuildConfig.VERSION_NAME) +
+                    (TextUtils.isEmpty(abt) ? "" : "&abt=" + Uri.encode(abt)) +
                     "&udid=" + PlayServicesUrlRewriter.UDID_TEMPLATE +
                     "&dnt=" + PlayServicesUrlRewriter.DO_NOT_TRACK_TEMPLATE +
+                    paramIfNotEmpty("gdpr_applies", gdprApplies) +
+                    paramIfNotEmpty("force_gdpr_applies", forceGdprApplies) +
+                    paramIfNotEmpty("current_consent_status", currentConsentStatus) +
+                    paramIfNotEmpty("consented_privacy_policy_version", consentedPrivacyPolicyVersion) +
+                    paramIfNotEmpty("consented_vendor_list_version", consentedVendorListVersion) +
                     "&mr=1" +
                     "&android_perms_ext_storage=" + externalStoragePermission +
                     "&vv=3";
@@ -745,8 +1079,12 @@ public AdUrlBuilder withAdUnitId(String adUnitId) {
             return this;
         }
 
-        public AdUrlBuilder withQuery(String query) {
-            this.query = query;
+        public AdUrlBuilder withUserDataQuery(String query) {
+            this.userDataQuery = query;
+            return this;
+        }
+        public AdUrlBuilder withKeywordsQuery(String query) {
+            this.keywordsQuery = query;
             return this;
         }
 
@@ -795,6 +1133,31 @@ public AdUrlBuilder withDnt(boolean dnt) {
             return this;
         }
 
+        public AdUrlBuilder withAbt(String abt) {
+            this.abt = abt;
+            return this;
+        }
+
+        public AdUrlBuilder withCurrentConsentStatus(String currentConsentStatus) {
+            this.currentConsentStatus = currentConsentStatus;
+            return this;
+        }
+
+        public AdUrlBuilder withGdprApplies(String gdprApplies) {
+            this.gdprApplies = gdprApplies;
+            return this;
+        }
+
+        public AdUrlBuilder withConsentedPrivacyPolicyVersion(String consentedPrivacyPolicyVersion) {
+            this.consentedPrivacyPolicyVersion = consentedPrivacyPolicyVersion;
+            return this;
+        }
+
+        public AdUrlBuilder withConsentedVendorListVersion(String consentedVendorListVersion) {
+            this.consentedVendorListVersion = consentedVendorListVersion;
+            return this;
+        }
+
         private String paramIfNotEmpty(String key, String value) {
             if (TextUtils.isEmpty(value)) {
                 return "";
@@ -803,4 +1166,18 @@ private String paramIfNotEmpty(String key, String value) {
             }
         }
     }
+
+    private static class WebViewAdvancedBidder implements MoPubAdvancedBidder {
+
+        @Override
+        public String getToken(final Context context) {
+            return "WebViewAdvancedBidderToken";
+        }
+
+        @Override
+        public String getCreativeNetworkName() {
+            return "UrlGeneratorTest";
+        }
+    }
+
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/MoPubShadowConnectivityManager.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/MoPubShadowConnectivityManager.java
new file mode 100644
index 00000000..b480d308
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/MoPubShadowConnectivityManager.java
@@ -0,0 +1,38 @@
+package com.mopub.mobileads.test.support;
+
+import android.net.ConnectivityManager;
+import android.net.Network;
+import android.net.NetworkCapabilities;
+
+import org.robolectric.Shadows;
+import org.robolectric.annotation.Implementation;
+import org.robolectric.annotation.Implements;
+import org.robolectric.shadows.ShadowConnectivityManager;
+import org.robolectric.shadows.ShadowNetwork;
+
+import static android.net.ConnectivityManager.TYPE_ETHERNET;
+import static android.net.ConnectivityManager.TYPE_WIFI;
+import static android.os.Build.VERSION_CODES.LOLLIPOP;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.when;
+
+@Implements(ConnectivityManager.class)
+public class MoPubShadowConnectivityManager extends ShadowConnectivityManager {
+
+    private final NetworkCapabilities capabilitiesEthernet;
+
+    public MoPubShadowConnectivityManager() {
+        super();
+        capabilitiesEthernet = mock(NetworkCapabilities.class);
+        when(capabilitiesEthernet.hasTransport(NetworkCapabilities.TRANSPORT_ETHERNET)).thenReturn(true);
+    }
+
+    @Implementation(minSdk = LOLLIPOP)
+    public NetworkCapabilities getNetworkCapabilities(Network network) {
+        ShadowNetwork shadowNetwork = Shadows.shadowOf(network);
+        if (shadowNetwork.getNetId() == TYPE_ETHERNET) {
+            return capabilitiesEthernet;
+        }
+        return null;
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpResponseWithHeaders.java b/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpResponseWithHeaders.java
deleted file mode 100644
index 8c3229b5..00000000
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/test/support/TestHttpResponseWithHeaders.java
+++ /dev/null
@@ -1,37 +0,0 @@
-package com.mopub.mobileads.test.support;
-
-import org.apache.http.Header;
-import org.apache.http.message.BasicHeader;
-import org.robolectric.shadows.httpclient.TestHttpResponse;
-
-import java.util.HashMap;
-import java.util.Map;
-
-public class TestHttpResponseWithHeaders extends TestHttpResponse {
-    private Map<String, Header> headers;
-
-    public TestHttpResponseWithHeaders(int statusCode, String responseBody) {
-        super(statusCode, responseBody);
-        headers = new HashMap<String, Header>();
-    }
-
-    public TestHttpResponseWithHeaders(int statusCode, byte[] responseBody) {
-        super(statusCode, responseBody);
-        headers = new HashMap<String, Header>();
-    }
-
-    @Override
-    public void addHeader(String name, String value) {
-        headers.put(name, new BasicHeader(name, value));
-    }
-
-    @Override
-    public Header getFirstHeader(String name) {
-        return headers.get(name);
-    }
-
-    @Override
-    public Header[] getAllHeaders() {
-        return headers.values().toArray(new Header[headers.size()]);
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/mobileads/util/WebViewsTest.java b/mopub-sdk/src/test/java/com/mopub/mobileads/util/WebViewsTest.java
index 4bb1343d..51cea646 100644
--- a/mopub-sdk/src/test/java/com/mopub/mobileads/util/WebViewsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mobileads/util/WebViewsTest.java
@@ -1,24 +1,55 @@
 package com.mopub.mobileads.util;
 
+import android.annotation.TargetApi;
+import android.os.Build;
+import android.webkit.CookieManager;
 import android.webkit.WebView;
 
+import com.mopub.TestSdkHelper;
+import com.mopub.common.MoPub;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BuildConfig;
 
+import org.junit.Before;
+import org.junit.Rule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.Mockito;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
 import org.robolectric.annotation.Config;
 
+import static org.mockito.Matchers.any;
+import static org.mockito.Matchers.anyBoolean;
+import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.verify;
+import static org.powermock.api.mockito.PowerMockito.mockStatic;
+import static org.powermock.api.mockito.PowerMockito.verifyStatic;
+import static org.powermock.api.mockito.PowerMockito.when;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
+@PrepareForTest({MoPub.class, CookieManager.class})
 public class WebViewsTest {
 
+    @Rule
+    public PowerMockRule rule = new PowerMockRule();
+
+    private CookieManager cookieManager;
+
+    @Before
+    public void setup() {
+        mockStatic(MoPub.class);
+        mockStatic(CookieManager.class);
+
+        cookieManager = Mockito.mock(CookieManager.class);
+        when(CookieManager.getInstance()).thenReturn(cookieManager);
+    }
+
     @Test
-    public void pause_withIsFinishingTrue_shouldStopLoading_shouldLoadBlankUrl_shouldPauseWebView() throws Exception {
+    public void pause_withIsFinishingTrue_shouldStopLoading_shouldLoadBlankUrl_shouldPauseWebView() {
         WebView mockWebView = mock(WebView.class);
 
         WebViews.onPause(mockWebView, true);
@@ -29,7 +60,7 @@ public void pause_withIsFinishingTrue_shouldStopLoading_shouldLoadBlankUrl_shoul
     }
 
     @Test
-    public void pause_withIsFinishingFalse_shouldPauseWebView() throws Exception {
+    public void pause_withIsFinishingFalse_shouldPauseWebView() {
         WebView mockWebView = mock(WebView.class);
 
         WebViews.onPause(mockWebView, false);
@@ -38,4 +69,87 @@ public void pause_withIsFinishingFalse_shouldPauseWebView() throws Exception {
         verify(mockWebView, never()).loadUrl("");
         verify(mockWebView).onPause();
     }
+
+    @Test
+    public void manageWebCookies_whenCanCollectPersonaInfoTrue_setsAcceptCookiesTrue() {
+        when(MoPub.canCollectPersonalInformation()).thenReturn(true);
+
+        WebViews.manageWebCookies();
+
+        verify(cookieManager).setAcceptCookie(true);
+        verifyStatic();
+        CookieManager.setAcceptFileSchemeCookies(eq(true));
+    }
+
+    @TargetApi(Build.VERSION_CODES.LOLLIPOP)
+    @Config(sdk = Build.VERSION_CODES.LOLLIPOP)
+    @Test
+    public void manageWebCookies_api21orAbove_whenCanCollectPersonaInfoFalse_shouldRemoveCookies() {
+        TestSdkHelper.setReportedSdkLevel(Build.VERSION_CODES.LOLLIPOP);
+        when(MoPub.canCollectPersonalInformation()).thenReturn(false);
+
+        WebViews.manageWebCookies();
+
+        verify(cookieManager).setAcceptCookie(false);
+        verify(cookieManager).removeSessionCookies(null);
+        verify(cookieManager).removeAllCookies(null);
+        verify(cookieManager).flush();
+        verifyStatic();
+        CookieManager.setAcceptFileSchemeCookies(eq(false));
+    }
+
+    @TargetApi(Build.VERSION_CODES.KITKAT)
+    @Config(sdk = Build.VERSION_CODES.KITKAT)
+    @Test
+    public void manageWebCookies_api20orBelow_whenCanCollectPersonaInfoFalse_shouldRemoveCookies() {
+        TestSdkHelper.setReportedSdkLevel(Build.VERSION_CODES.KITKAT);
+        when(MoPub.canCollectPersonalInformation()).thenReturn(false);
+
+        WebViews.manageWebCookies();
+
+        verify(cookieManager).setAcceptCookie(false);
+        verify(cookieManager).removeSessionCookie();
+        verify(cookieManager).removeAllCookie();
+        verifyStatic();
+        CookieManager.setAcceptFileSchemeCookies(eq(false));
+    }
+
+    @TargetApi(Build.VERSION_CODES.LOLLIPOP)
+    @Config(sdk = Build.VERSION_CODES.LOLLIPOP)
+    @Test
+    public void manageThirdPartyCookies_api21orAbove_whenCanCollectPersonaInfoTrue_shouldAcceptCookies() {
+        TestSdkHelper.setReportedSdkLevel(Build.VERSION_CODES.LOLLIPOP);
+        when(MoPub.canCollectPersonalInformation()).thenReturn(true);
+        WebView mockWebView = mock(WebView.class);
+
+        WebViews.manageThirdPartyCookies(mockWebView);
+
+        verify(cookieManager).setAcceptThirdPartyCookies(eq(mockWebView), eq(true));
+    }
+
+    @TargetApi(Build.VERSION_CODES.LOLLIPOP)
+    @Config(sdk = Build.VERSION_CODES.LOLLIPOP)
+    @Test
+    public void manageThirdPartyCookies_api21orAbove_whenCanCollectPersonaInfoFalse_shouldRemoveCookies() {
+        TestSdkHelper.setReportedSdkLevel(Build.VERSION_CODES.LOLLIPOP);
+        when(MoPub.canCollectPersonalInformation()).thenReturn(false);
+        WebView mockWebView = mock(WebView.class);
+
+        WebViews.manageThirdPartyCookies(mockWebView);
+
+        verify(cookieManager).setAcceptThirdPartyCookies(eq(mockWebView), eq(false));
+    }
+
+    @TargetApi(Build.VERSION_CODES.KITKAT)
+    @Config(sdk = Build.VERSION_CODES.KITKAT)
+    @Test
+    public void manageThirdPartyCookies_api20orBelow_whenCanCollectPersonaInfoFalse_shouldDoNothing() {
+        TestSdkHelper.setReportedSdkLevel(Build.VERSION_CODES.KITKAT);
+        when(MoPub.canCollectPersonalInformation()).thenReturn(false);
+        WebView mockWebView = mock(WebView.class);
+
+        WebViews.manageThirdPartyCookies(mockWebView);
+
+        verify(cookieManager, never()).setAcceptThirdPartyCookies(any(WebView.class), anyBoolean());
+    }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/mraid/MraidBannerTest.java b/mopub-sdk/src/test/java/com/mopub/mraid/MraidBannerTest.java
index ff0c47be..6de66a89 100644
--- a/mopub-sdk/src/test/java/com/mopub/mraid/MraidBannerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mraid/MraidBannerTest.java
@@ -4,6 +4,7 @@
 import android.content.Context;
 import android.view.View;
 
+import com.mopub.common.DataKeys;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BuildConfig;
 import com.mopub.mobileads.test.support.TestMraidControllerFactory;
@@ -22,6 +23,7 @@
 import static com.mopub.common.DataKeys.HTML_RESPONSE_BODY_KEY;
 import static com.mopub.mobileads.CustomEventBanner.CustomEventBannerListener;
 import static com.mopub.mobileads.MoPubErrorCode.MRAID_LOAD_ERROR;
+import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
 import static org.mockito.Matchers.eq;
 import static org.mockito.Mockito.verify;
@@ -61,6 +63,28 @@ public void loadBanner_whenExtrasAreMalformed_shouldNotifyBannerListenerFailureA
         verify(mockBannerListener).onBannerFailed(eq(MRAID_LOAD_ERROR));
     }
 
+    @Test
+    public void loadBanner_withTrueFlag_shouldSetBannerImpressionPixelCountEnabledTrue() {
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isFalse();
+
+        localExtras.put(DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED, true);
+
+        subject.loadBanner(context, mockBannerListener, localExtras, serverExtras);
+
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isTrue();
+    }
+
+    @Test
+    public void loadBanner_withFalseFlag_shouldSetBannerImpressionPixelCountEnabledFalse() {
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isFalse();
+
+        localExtras.put(DataKeys.BANNER_IMPRESSION_PIXEL_COUNT_ENABLED, false);
+
+        subject.loadBanner(context, mockBannerListener, localExtras, serverExtras);
+
+        assertThat(subject.isBannerImpressionPixelCountEnabled()).isFalse();
+    }
+
     @Test
     public void invalidate_shouldDestroyMraidController() {
         subject.loadBanner(context, mockBannerListener, localExtras, serverExtras);
diff --git a/mopub-sdk/src/test/java/com/mopub/mraid/MraidControllerTest.java b/mopub-sdk/src/test/java/com/mopub/mraid/MraidControllerTest.java
index f439272b..2554fe80 100644
--- a/mopub-sdk/src/test/java/com/mopub/mraid/MraidControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mraid/MraidControllerTest.java
@@ -38,7 +38,6 @@
 import org.mockito.invocation.InvocationOnMock;
 import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
-import org.robolectric.RuntimeEnvironment;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowApplication;
 
@@ -57,6 +56,7 @@
 import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
+import static org.robolectric.Shadows.shadowOf;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -508,7 +508,7 @@ public void handleOpen_withMalformedMoPubNativeBrowserUrl_shouldNotStartNewActiv
     @Test
     public void handleOpen_withApplicationUrl_shouldStartNewIntent() {
         String applicationUrl = "amzn://blah";
-        RuntimeEnvironment.getRobolectricPackageManager().addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW, Uri
+        shadowOf(activity.getPackageManager()).addResolveInfoForIntent(new Intent(Intent.ACTION_VIEW, Uri
                 .parse(applicationUrl)), new ResolveInfo());
 
         subject.handleOpen(applicationUrl);
@@ -529,8 +529,8 @@ public void handleOpen_withHttpApplicationUrl_shouldStartMoPubBrowser() {
 
         subject.handleOpen(applicationUrl);
 
-        Robolectric.getBackgroundThreadScheduler().advanceBy(0);
-        Intent startedIntent = ShadowApplication.getInstance().getNextStartedActivity();
+        Robolectric.flushBackgroundThreadScheduler();
+        Intent startedIntent = shadowOf(activity).getNextStartedActivity();
         assertThat(startedIntent).isNotNull();
         // Since we are not using an Activity context, we should have FLAG_ACTIVITY_NEW_TASK
         assertThat(Utils.bitMaskContainsFlag(startedIntent.getFlags(),
diff --git a/mopub-sdk/src/test/java/com/mopub/mraid/MraidNativeCommandHandlerTest.java b/mopub-sdk/src/test/java/com/mopub/mraid/MraidNativeCommandHandlerTest.java
index e9d5b008..0bc60261 100644
--- a/mopub-sdk/src/test/java/com/mopub/mraid/MraidNativeCommandHandlerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/mraid/MraidNativeCommandHandlerTest.java
@@ -20,7 +20,6 @@
 import com.mopub.common.util.test.support.ShadowMoPubHttpUrlConnection;
 import com.mopub.mobileads.BuildConfig;
 import com.mopub.mobileads.test.support.FileUtils;
-import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
 import com.mopub.mraid.MraidNativeCommandHandler.DownloadImageAsyncTask;
 import com.mopub.mraid.MraidNativeCommandHandler.DownloadImageAsyncTask.DownloadImageAsyncTaskListener;
 import com.mopub.mraid.MraidNativeCommandHandler.MraidCommandFailureListener;
@@ -86,7 +85,6 @@
     private File expectedFile;
     private File pictureDirectory;
     private File fileWithoutExtension;
-    private TestHttpResponseWithHeaders response;
 
     @Before
     public void setUp() throws Exception {
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/HttpDiskCompositeDataSourceTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/HttpDiskCompositeDataSourceTest.java
index 96f461f3..3c8b540f 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/HttpDiskCompositeDataSourceTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/HttpDiskCompositeDataSourceTest.java
@@ -49,7 +49,7 @@
     public void setUp() throws Exception {
         Context context = Robolectric.buildActivity(Activity.class).create().get();
         CacheService.initialize(context);
-        subject = new HttpDiskCompositeDataSource(context, "userAgent", null, mockHttpDataSource);
+        subject = new HttpDiskCompositeDataSource(context, "userAgent", mockHttpDataSource);
         uri = new Uri.Builder().scheme("https").path("www.someurl").build();
         dataSpec = new DataSpec(uri, 0, -1, null);
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java
index a4273408..94dd5518 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventNativeTest.java
@@ -49,6 +49,8 @@ public void setUp() throws Exception {
         fakeJsonObject.put("mainimage", "mainimageurl");
         fakeJsonObject.put("iconimage", "iconimageurl");
         fakeJsonObject.put("extraimage", "extraimageurl");
+        fakeJsonObject.put("privacyicon", "privacyiconurl");
+        fakeJsonObject.put("privacyclkurl", "privacyiconclickthroughurl");
 
         localExtras.put(DataKeys.JSON_BODY_KEY, fakeJsonObject);
     }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventVideoNativeTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventVideoNativeTest.java
index df3fb4de..b27cfb92 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventVideoNativeTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubCustomEventVideoNativeTest.java
@@ -53,6 +53,8 @@ public void setUp() throws Exception {
         jsonObject.put("mainimage", "mainimageurl");
         jsonObject.put("iconimage", "iconimageurl");
         jsonObject.put("extraimage", "extraimageurl");
+        jsonObject.put("privacyicon", "privacyiconurl");
+        jsonObject.put("privacyclkurl", "privacyiconclickthroughurl");
         localExtras.put(DataKeys.JSON_BODY_KEY, jsonObject);
         localExtras.put(DataKeys.CLICK_TRACKING_URL_KEY, "clicktrackingurl");
 
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java
index d8bb770b..919a1cfc 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubNativeTest.java
@@ -2,8 +2,12 @@
 
 import android.app.Activity;
 
+import com.mopub.common.MoPub;
+import com.mopub.common.SdkConfiguration;
 import com.mopub.common.logging.MoPubLog;
+import com.mopub.common.privacy.MoPubIdentifierTest;
 import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Reflection;
 import com.mopub.common.util.test.support.ShadowAsyncTasks;
 import com.mopub.common.util.test.support.TestMethodBuilderFactory;
 import com.mopub.mobileads.BuildConfig;
@@ -60,8 +64,10 @@
     @Mock private MoPubStaticNativeAdRenderer mockRenderer;
 
     @Before
-    public void setup() {
+    public void setup() throws Exception {
         context = Robolectric.buildActivity(Activity.class).create().get();
+        MoPub.initializeSdk(context, new SdkConfiguration.Builder("adunit").build(), null);
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(context, false);
         Shadows.shadowOf(context).grantPermissions(ACCESS_NETWORK_STATE);
         Shadows.shadowOf(context).grantPermissions(INTERNET);
         subject = new MoPubNative(context, adUnitId, mockAdRendererRegistry, mockNetworkListener);
@@ -70,8 +76,13 @@ public void setup() {
     }
 
     @After
-    public void tearDown() {
+    public void tearDown() throws Exception {
+        MoPubIdentifierTest.clearPreferences(context);
         reset(methodBuilder);
+        new Reflection.MethodBuilder(null, "clearAdvancedBidders")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .execute();
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubStaticNativeAdTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubStaticNativeAdTest.java
index eb145575..b6ed548e 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubStaticNativeAdTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubStaticNativeAdTest.java
@@ -143,6 +143,8 @@ public void loadAd_shouldSetOptionalExpectedFields() throws Exception {
         fakeJsonObject.put("text", "expected text");
         fakeJsonObject.put("mainimage", "expected mainimage");
         fakeJsonObject.put("iconimage", "expected iconimage");
+        fakeJsonObject.put("privacyicon", "piiimageurl");
+        fakeJsonObject.put("privacyclkurl", "piiclkurl");
 
         fakeJsonObject.put("clk", "expected clk");
 
@@ -164,6 +166,8 @@ public void loadAd_shouldSetOptionalExpectedFields() throws Exception {
         assertThat(subject.getImpressionTrackers()).containsOnly("url1", "url2");
         assertThat(subject.getCallToAction()).isEqualTo("expected ctatext");
         assertThat(subject.getStarRating()).isEqualTo(5.0);
+        assertThat(subject.getPrivacyInformationIconImageUrl()).isEqualTo("piiimageurl");
+        assertThat(subject.getPrivacyInformationIconClickThroughUrl()).isEqualTo("piiclkurl");
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubVideoNativeAdTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubVideoNativeAdTest.java
index f373be7b..c6daec57 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubVideoNativeAdTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/MoPubVideoNativeAdTest.java
@@ -12,7 +12,6 @@
 import android.view.View;
 
 import com.mopub.common.Constants;
-import com.mopub.common.event.EventDetails;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BaseVideoPlayerActivity;
 import com.mopub.mobileads.BuildConfig;
@@ -113,6 +112,8 @@ public void setUp() throws Exception {
         jsonObject.put("ctatext", "ctatext");
         jsonObject.put("video", "video");
         jsonObject.put("extraimage", "extraimageurl");
+        jsonObject.put("privacyicon", "piiimageurl");
+        jsonObject.put("privacyclkurl", "piiclkurl");
 
         serverExtras = new HashMap<String, String>();
         serverExtras.put("Play-Visible-Percent", "10");
@@ -133,13 +134,12 @@ public void setUp() throws Exception {
 
         subject = new MoPubVideoNativeAd(
                 activity, jsonObject, mockCustomEventNativeListener, videoResponseHeaders,
-                mockVisibilityTracker, mockNativeVideoControllerFactory, null,
+                mockVisibilityTracker, mockNativeVideoControllerFactory,
                 "header click tracker", mockVastManager);
         subject.setNativeEventListener(mockNativeEventListener);
         // noinspection unchecked
         when(mockNativeVideoControllerFactory
-                .createForId(anyInt(), any(Context.class), any(List.class), eq(mockVastVideoConfig),
-                        any(EventDetails.class)))
+                .createForId(anyInt(), any(Context.class), any(List.class), eq(mockVastVideoConfig)))
                 .thenReturn(mockNativeVideoController);
 
         when(mockImageLoader.get(anyString(), any(ImageListener.class)))
@@ -199,9 +199,9 @@ public void loadAd_shouldInitializeAssetValues() {
         assertThat(subject.getIconImageUrl()).isEqualTo("iconimageurl");
         assertThat(subject.getClickDestinationUrl()).isEqualTo("clk");
         assertThat(subject.getCallToAction()).isEqualTo("ctatext");
-        assertThat(subject.getPrivacyInformationIconClickThroughUrl()).isEqualTo(
-                "https://www.mopub.com/optout/");
         assertThat(subject.getVastVideo()).isEqualTo("video");
+        assertThat(subject.getPrivacyInformationIconImageUrl()).isEqualTo("piiimageurl");
+        assertThat(subject.getPrivacyInformationIconClickThroughUrl()).isEqualTo("piiclkurl");
         assertThat(subject.getExtra("extraimage")).isEqualTo("extraimageurl");
         assertThat(subject.getExtras()).hasSize(1);
     }
@@ -233,8 +233,7 @@ public void onVastVideoConfigurationPrepared_shouldConstructNativeVideoControlle
         verify(mockNativeVideoControllerFactory).createForId(anyInt(),
                 eq(activity.getApplicationContext()),
                 argumentCaptor.capture(),
-                eq(mockVastVideoConfig),
-                any(EventDetails.class));
+                eq(mockVastVideoConfig));
 
         List<VisibilityTrackingEvent> visibilityTrackingEvents = (List<VisibilityTrackingEvent>) argumentCaptor.getValue();
         assertThat(visibilityTrackingEvents.get(0).strategy).isInstanceOf(HeaderVisibilityStrategy.class);
@@ -256,6 +255,8 @@ public void onVastVideoConfigurationPrepared_shouldConstructNativeVideoControlle
         verify(mockVastVideoConfig).getImpressionTrackers();
         verify(mockVastVideoConfig).addClickTrackers(any(List.class));
         verify(mockVastVideoConfig).setClickThroughUrl("clk");
+        verify(mockVastVideoConfig).setPrivacyInformationIconImageUrl("piiimageurl");
+        verify(mockVastVideoConfig).setPrivacyInformationIconClickthroughUrl("piiclkurl");
         verify(mockCustomEventNativeListener).onNativeAdLoaded(subject);
     }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeFullScreenVideoViewTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeFullScreenVideoViewTest.java
index 9b484696..b7590b34 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeFullScreenVideoViewTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeFullScreenVideoViewTest.java
@@ -8,6 +8,7 @@
 import android.graphics.RectF;
 import android.graphics.SurfaceTexture;
 import android.graphics.drawable.GradientDrawable;
+import android.support.annotation.NonNull;
 import android.view.TextureView;
 import android.view.View;
 import android.widget.ImageView;
@@ -25,25 +26,31 @@
 import com.mopub.nativeads.NativeFullScreenVideoView.Mode;
 
 import org.junit.Before;
+import org.junit.Rule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.mockito.Mock;
+import org.powermock.api.mockito.PowerMockito;
+import org.powermock.core.classloader.annotations.PowerMockIgnore;
+import org.powermock.core.classloader.annotations.PrepareForTest;
+import org.powermock.modules.junit4.rule.PowerMockRule;
 import org.robolectric.Robolectric;
-import org.robolectric.Shadows;
 import org.robolectric.annotation.Config;
-import org.robolectric.shadows.ShadowConfiguration;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
 import static org.mockito.Matchers.anyInt;
+import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.spy;
+import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
+@PowerMockIgnore({ "org.mockito.*", "org.robolectric.*", "android.*", "org.json.*"})
+@PrepareForTest(NativeImageHelper.class)
 public class NativeFullScreenVideoViewTest {
 
     private NativeFullScreenVideoView subject;
@@ -68,21 +75,21 @@
     private ImageView spyCtaButton;
     private ImageView spyCloseControl;
 
-    @Mock TextureView.SurfaceTextureListener mockSurfaceTextureListener;
-    @Mock SurfaceTexture mockSurfaceTexture;
-    @Mock RectF mockRectF;
-    @Mock Paint mockPaint;
-    private ShadowConfiguration shadowConfiguration;
+    @Rule public PowerMockRule rule = new PowerMockRule();
+
+    private TextureView.SurfaceTextureListener mockSurfaceTextureListener;
+    private SurfaceTexture mockSurfaceTexture;
+    private RectF mockRectF;
+    private Paint mockPaint;
+    private Configuration configuration;
 
     @Before
     public void setUp() {
         context = Robolectric.buildActivity(Activity.class).create().get();
 
-        shadowConfiguration = Shadows.shadowOf(context.getResources().getConfiguration());
-        Configuration configuration = new Configuration();
+        configuration = context.getResources().getConfiguration();
         configuration.screenWidthDp = screenWidthDp;
         configuration.screenHeightDp = screenHeightDp;
-        shadowConfiguration.setTo(configuration);
 
         videoWidthLandscapePx = Dips.dipsToIntPixels((float) screenWidthDp, context);
         videoHeightLandscapePx = Dips.dipsToIntPixels((float) screenWidthDp * 9 / 16, context);
@@ -94,19 +101,25 @@ public void setUp() {
         spyLoadingSpinner = spy(new ProgressBar(context));
         spyBottomGradient = spy(new ImageView(context));
         spyTopGradient = spy(new ImageView(context));
-        spyVideoProgress = spy(new VastVideoProgressBarWidget(context));
+        spyVideoProgress = spy(new VastVideoProgressBarWidgetMock(context));
         spyOverlay = spy(new View(context));
         spyPlayButton = spy(new ImageView(context));
         spyPrivacyInformationIcon = spy(new ImageView(context));
         spyCtaButton = spy(new ImageView(context));
         spyCloseControl = spy(new ImageView(context));
 
+        mockSurfaceTextureListener = mock(TextureView.SurfaceTextureListener.class);
+        mockSurfaceTexture = mock(SurfaceTexture.class);
+        mockRectF = mock(RectF.class);
+        mockPaint = mock(Paint.class);
+
         subject = new NativeFullScreenVideoView(context, Configuration.ORIENTATION_LANDSCAPE, "Learn More",
                 spyCachedImage,
                 spyVideoTexture, spyLoadingSpinner, spyBottomGradient, spyTopGradient,
                 spyVideoProgress, spyOverlay, spyPlayButton, spyPrivacyInformationIcon, spyCtaButton,
                 spyCloseControl);
 
+        PowerMockito.mockStatic(NativeImageHelper.class);
     }
 
     @Test
@@ -218,10 +231,10 @@ public void constructor_shouldAddPlayButtonToLayout() throws Exception {
     }
 
     @Test
-    public void constructor_shouldAddPrivacyInformationIconToLayout() throws Exception {
+    public void constructor_shouldSetUpPrivacyInformationIconToLayout() throws Exception {
         assertThat(subject.findViewById(spyPrivacyInformationIcon.getId())).isEqualTo(
                 spyPrivacyInformationIcon);
-        verify(spyPrivacyInformationIcon).setImageDrawable(
+        verify(spyPrivacyInformationIcon, times(0)).setImageDrawable(
                 Drawables.NATIVE_PRIVACY_INFORMATION_ICON.createDrawable(context));
         assertThat(spyPrivacyInformationIcon.getPaddingLeft()).isEqualTo(subject.mClosePaddingPx);
         assertThat(spyPrivacyInformationIcon.getPaddingTop()).isEqualTo(subject.mClosePaddingPx);
@@ -279,6 +292,22 @@ public void constructor_shouldAddCloseControlToLayout() throws Exception {
                 .isEqualTo(spyVideoTexture.getId());
     }
 
+    @Test
+    public void setPrivacyInformationIconImageUrl_withNullUrl_shouldUseDefaultIcon() {
+        subject.setPrivacyInformationIconImageUrl(null);
+
+        verify(spyPrivacyInformationIcon).setImageDrawable(
+                Drawables.NATIVE_PRIVACY_INFORMATION_ICON.createDrawable(context));
+    }
+
+    @Test
+    public void setPrivacyInformationIconImageUrl_withUrl_shouldSetIconImageToUrl() {
+        subject.setPrivacyInformationIconImageUrl("imageurl");
+
+        PowerMockito.verifyStatic();
+        NativeImageHelper.loadImageView("imageurl", spyPrivacyInformationIcon);
+    }
+
     @Test
     public void resetProgress_shouldCallVideoProgressReset() throws Exception {
         subject.resetProgress();
@@ -341,10 +370,8 @@ public void setMode_withModeFinished_shouldUpdateVisibilityAppropriately() throw
 
     @Test
     public void setOrientation_withLandscape_shouldSetWidthAndHeightOfVideoTextureAppropriately() throws Exception {
-        Configuration configuration = new Configuration();
         configuration.screenWidthDp = screenWidthDp;
         configuration.screenHeightDp = screenHeightDp;
-        shadowConfiguration.setTo(configuration);
 
         subject.setOrientation(Configuration.ORIENTATION_LANDSCAPE);
 
@@ -358,10 +385,8 @@ public void setOrientation_withLandscape_shouldSetWidthAndHeightOfVideoTextureAp
 
     @Test
     public void setOrientation_withPortrait_shouldSetWidthAndHeightOfVideoTextureAppropriately() throws Exception {
-        Configuration configuration = new Configuration();
         configuration.screenWidthDp = screenHeightDp;
         configuration.screenHeightDp = screenWidthDp;
-        shadowConfiguration.setTo(configuration);
 
         subject.setOrientation(Configuration.ORIENTATION_PORTRAIT);
 
@@ -497,4 +522,13 @@ public void LoadingBackground_getOpacity_shouldReturn0() throws Exception {
         assertThat(new LoadingBackground(context, mockRectF, mockPaint).getOpacity())
                 .isEqualTo(0);
     }
+
+    // To get around objenesis errors
+    class VastVideoProgressBarWidgetMock extends VastVideoProgressBarWidget {
+
+        public VastVideoProgressBarWidgetMock(
+                @NonNull final Context context) {
+            super(context);
+        }
+    }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java
index 59be34df..ecc0fcf9 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeUrlGeneratorTest.java
@@ -6,6 +6,7 @@
 import android.graphics.Point;
 import android.location.Location;
 import android.location.LocationManager;
+import android.net.ConnectivityManager;
 import android.net.Uri;
 import android.os.Build;
 import android.telephony.TelephonyManager;
@@ -16,10 +17,16 @@
 
 import com.mopub.common.LocationService;
 import com.mopub.common.MoPub;
+import com.mopub.common.privacy.ConsentStatus;
+import com.mopub.common.privacy.MoPubIdentifierTest;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.common.util.Reflection;
 import com.mopub.mobileads.BuildConfig;
+import com.mopub.mobileads.test.support.MoPubShadowConnectivityManager;
 import com.mopub.mobileads.test.support.MoPubShadowTelephonyManager;
 
+import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -30,6 +37,7 @@
 import org.robolectric.Shadows;
 import org.robolectric.annotation.Config;
 import org.robolectric.shadows.ShadowLocationManager;
+import org.robolectric.shadows.ShadowNetworkInfo;
 
 import java.util.ArrayList;
 import java.util.Arrays;
@@ -46,7 +54,7 @@
 import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class, shadows = {MoPubShadowTelephonyManager.class})
+@Config(constants = BuildConfig.class, shadows = {MoPubShadowTelephonyManager.class, MoPubShadowConnectivityManager.class})
 public class NativeUrlGeneratorTest {
     public static final String AD_UNIT_ID = "1234";
     private static final int TEST_SCREEN_WIDTH = 999;
@@ -55,15 +63,22 @@
     private Activity context;
     private NativeUrlGenerator subject;
     private MoPubShadowTelephonyManager shadowTelephonyManager;
+    private MoPubShadowConnectivityManager shadowConnectivityManager;
+    private PersonalInfoManager mockPersonalInfoManager;
 
     @Before
-    public void setup() {
+    public void setup() throws Exception {
         context = spy(Robolectric.buildActivity(Activity.class).create().get());
         Shadows.shadowOf(context).grantPermissions(ACCESS_NETWORK_STATE);
         Shadows.shadowOf(context).grantPermissions(ACCESS_FINE_LOCATION);
         when(context.getPackageName()).thenReturn("testBundle");
         shadowTelephonyManager = (MoPubShadowTelephonyManager)
                 Shadows.shadowOf((TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE));
+        shadowConnectivityManager = (MoPubShadowConnectivityManager)
+                Shadows.shadowOf((ConnectivityManager) RuntimeEnvironment.application.getSystemService(Context.CONNECTIVITY_SERVICE));
+        shadowConnectivityManager.setActiveNetworkInfo(ShadowNetworkInfo.newInstance(null,
+                ConnectivityManager.TYPE_MOBILE, TelephonyManager.NETWORK_TYPE_UNKNOWN, true,
+                true));
 
         // Set the expected screen dimensions to arbitrary numbers
         final Resources spyResources = spy(context.getResources());
@@ -94,7 +109,93 @@ public Object answer(final InvocationOnMock invocationOnMock) throws Throwable {
             when(context.getApplicationContext()).thenReturn(spyApplicationContext);
         }
 
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
+        when(mockPersonalInfoManager.getPersonalInfoConsentStatus()).thenReturn(ConsentStatus.UNKNOWN);
         LocationService.clearLastKnownLocation();
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(context, false);
+    }
+
+    @After
+    public void tearDown(){
+        MoPubIdentifierTest.clearPreferences(context);
+    }
+
+    @Test
+    public void requestParametersBuilder_whenKeywordsHaveBeenProvidedButNoUserConsent_shouldNotSaveKeywords() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        RequestParameters requestParameters = new RequestParameters.Builder()
+                .keywords("keywords")
+                .userDataKeywords("user_data_keywords")
+                .build();
+
+        assertThat(requestParameters.getKeywords()).isEqualTo("keywords");
+        assertThat(requestParameters.getUserDataKeywords()).isNull();
+    }
+
+    @Test
+    public void requestParametersBuilder_whenKeywordsHaveBeenProvidedAndUserConsent_shouldSaveKeywords() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        RequestParameters requestParameters = new RequestParameters.Builder()
+                .keywords("keywords")
+                .userDataKeywords("user_data_keywords")
+                .build();
+
+        assertThat(requestParameters.getKeywords()).isEqualTo("keywords");
+        assertThat(requestParameters.getUserDataKeywords()).isEqualTo("user_data_keywords");
+    }
+
+    @Test
+    public void generateUrlString_whenKeywordsHaveBeenProvidedButNoUserConsent_shouldNotUseKeywords() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        RequestParameters requestParameters = new RequestParameters.Builder()
+                .keywords("keywords")
+                .userDataKeywords("user_data_keywords")
+                .build();
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+        String adUrl = subject.withRequest(requestParameters)
+                .generateUrlString("ads.mopub.com");
+
+        assertThat(getParameterFromRequestUrl(adUrl, "q")).isEqualTo("keywords");
+        assertThat(getParameterFromRequestUrl(adUrl, "user_data_q")).isEqualTo("");
+    }
+
+    @Test
+    public void generateUrlString_whenKeywordsHaveBeenProvidedAndUserConsent_shouldUseKeywords() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        RequestParameters requestParameters = new RequestParameters.Builder()
+                .keywords("keywords")
+                .userDataKeywords("user_data_keywords")
+                .build();
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+        String adUrl = subject.withRequest(requestParameters)
+                .generateUrlString("ads.mopub.com");
+
+        assertThat(getParameterFromRequestUrl(adUrl, "q")).isEqualTo("keywords");
+        assertThat(getParameterFromRequestUrl(adUrl, "user_data_q")).isEqualTo("user_data_keywords");
     }
 
     @Test
@@ -129,6 +230,13 @@ public void generateUrlString_shouldIncludeDesiredAssetsIfSet() throws Exception
     public void generateUrlString_shouldNotIncludeDesiredAssetsIfNotSet() throws Exception {
         subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
 
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         String requestString = generateMinimumUrlString();
         List<String> desiredAssets = getDesiredAssetsListFromRequestUrlString(requestString);
 
@@ -149,7 +257,14 @@ public void generateUrlString_shouldNotIncludeDesiredAssetsIfNoAssetsAreSet() th
     }
 
     @Test
-    public void generateUrlString_needsButDoesNotHaveReadPhoneState_shouldNotContainOperatorName() {
+    public void generateUrlString_needsButDoesNotHaveReadPhoneState_shouldNotContainOperatorName() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         shadowTelephonyManager.setNeedsReadPhoneState(true);
         shadowTelephonyManager.setReadPhoneStatePermission(false);
         shadowTelephonyManager.setNetworkOperatorName("TEST_CARRIER");
@@ -185,7 +300,14 @@ public void generateUrlString_doesNotNeedReadPhoneState_shouldContainOperatorNam
     }
 
     @Test
-    public void generateUrlString_whenLocationServiceGpsProviderHasMostRecentLocation_shouldUseLocationServiceValue() {
+    public void generateUrlString_whenLocationServiceGpsProviderHasMostRecentLocation_shouldUseLocationServiceValue() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -218,7 +340,54 @@ public void generateUrlString_whenLocationServiceGpsProviderHasMostRecentLocatio
     }
 
     @Test
-    public void generateUrlString_whenDeveloperSuppliesMoreRecentLocationThanLocationService_shouldUseDeveloperSuppliedLocation() {
+    public void generateUrlString_whenConsentIsFalse_shouldNotHaveLocationValue() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(false);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        Location locationFromDeveloper = new Location("");
+        locationFromDeveloper.setLatitude(42);
+        locationFromDeveloper.setLongitude(-42);
+        locationFromDeveloper.setAccuracy(3.5f);
+        locationFromDeveloper.setTime(1000);
+
+        // Mock out the LocationManager's last known location to be more recent than the
+        // developer-supplied location.
+        ShadowLocationManager shadowLocationManager = Shadows.shadowOf(
+                (LocationManager) RuntimeEnvironment.application.getSystemService(Context.LOCATION_SERVICE));
+        Location locationFromSdk = new Location("");
+        locationFromSdk.setLatitude(37);
+        locationFromSdk.setLongitude(-122);
+        locationFromSdk.setAccuracy(5.0f);
+        locationFromSdk.setTime(System.currentTimeMillis() - 555555);
+        shadowLocationManager.setLastKnownLocation(LocationManager.GPS_PROVIDER, locationFromSdk);
+
+        RequestParameters requestParameters = new RequestParameters.Builder()
+                .location(locationFromDeveloper)
+                .build();
+        subject = new NativeUrlGenerator(context).withAdUnitId(AD_UNIT_ID);
+        String adUrl = subject.withRequest(requestParameters)
+                .generateUrlString("ads.mopub.com");
+        assertThat(getParameterFromRequestUrl(adUrl, "ll")).isEqualTo("");
+        assertThat(getParameterFromRequestUrl(adUrl, "lla")).isEqualTo("");
+        assertThat(getParameterFromRequestUrl(adUrl, "llsdk")).isEqualTo("");
+        // Only test to the full second (as there may be small differences)
+        assertThat(getParameterFromRequestUrl(adUrl, "llf")).startsWith("");
+    }
+
+    @Test
+    public void generateUrlString_whenDeveloperSuppliesMoreRecentLocationThanLocationService_shouldUseDeveloperSuppliedLocation() throws Exception {
+
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -252,7 +421,14 @@ public void generateUrlString_whenDeveloperSuppliesMoreRecentLocationThanLocatio
     }
 
     @Test
-    public void generateUrlString_whenLocationServiceNetworkProviderHasMostRecentLocation_shouldUseLocationServiceValue() {
+    public void generateUrlString_whenLocationServiceNetworkProviderHasMostRecentLocation_shouldUseLocationServiceValue() throws Exception {
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
         Location locationFromDeveloper = new Location("");
         locationFromDeveloper.setLatitude(42);
         locationFromDeveloper.setLongitude(-42);
@@ -291,9 +467,9 @@ public void generateUrlString_withOnlyAdUnitSet_shouldReturnMinimumUrl() {
         final String adUrl = generateMinimumUrlString();
 
         assertThat(adUrl).isEqualTo(
-                "http://ads.mopub.com/m/ad?id=" +
+                "https://ads.mopub.com/m/ad?id=" +
                         AD_UNIT_ID +
-                        "&nsv=" + Uri.encode(MoPub.SDK_VERSION) +
+                        "&nv=" + Uri.encode(MoPub.SDK_VERSION) +
                         "&dn=unknown%2Cunknown%2Cunknown" +
                         "&bundle=testBundle" +
                         "&z=-0700" +
@@ -302,10 +478,12 @@ public void generateUrlString_withOnlyAdUnitSet_shouldReturnMinimumUrl() {
                         TEST_SCREEN_WIDTH +
                         "&h=" +
                         TEST_SCREEN_HEIGHT +
-                        "&sc_a=" +
+                        "&sc=" +
                         TEST_DENSITY +
                         "&ct=3&av=" + Uri.encode(BuildConfig.VERSION_NAME) +
-                        "&udid=mp_tmpl_advertising_id&dnt=mp_tmpl_do_not_track");
+                        "&udid=mp_tmpl_advertising_id&dnt=mp_tmpl_do_not_track" +
+                        "&gdpr_applies=0" +
+                        "&current_consent_status=unknown");
     }
 
     @Test
@@ -364,7 +542,7 @@ private String getNetworkOperatorNameFromRequestUrl(String requestString) {
         return networkOperatorName;
     }
 
-    private String getParameterFromRequestUrl(String requestString, String key) {
+    public static String getParameterFromRequestUrl(String requestString, String key) {
         Uri requestUri = Uri.parse(requestString);
         String parameter = requestUri.getQueryParameter(key);
 
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoControllerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoControllerTest.java
index a3ef9e69..7e41a369 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoControllerTest.java
@@ -165,7 +165,6 @@ public ExoPlayer newInstance(@NonNull final Renderer[] renderers,
                         return mockExoPlayer;
                     }
                 },
-                null,
                 mockAudioManager);
 
         nativeVideoProgressRunnable = new NativeVideoProgressRunnable(activity,
@@ -184,14 +183,14 @@ public ExoPlayer newInstance(@NonNull final Renderer[] renderers,
     @Test
     public void createForId_shouldAddNativeVideoControllerToMap_shouldReturnNativeVideoController() {
         NativeVideoController nativeVideoController =
-                createForId(123, activity, visibilityTrackingEvents, vastVideoConfig, null);
+                createForId(123, activity, visibilityTrackingEvents, vastVideoConfig);
         assertThat(nativeVideoController).isEqualTo(getForId(123));
     }
 
     @Test
     public void remove_shouldRemoveNativeVideoControllerFromMap() {
         NativeVideoController nativeVideoController =
-                createForId(123, activity, visibilityTrackingEvents, vastVideoConfig, null);
+                createForId(123, activity, visibilityTrackingEvents, vastVideoConfig);
         assertThat(nativeVideoController).isEqualTo(getForId(123));
         remove(123);
         assertThat(getForId(123)).isNull();
@@ -367,7 +366,6 @@ public void prepare_shouldPreparePlayer() {
                 vastVideoConfig,
                 mockNativeVideoProgressRunnable,
                 mockMoPubExoPlayerFactory,
-                null,
                 mockAudioManager);
         subject.prepare(this);
 
@@ -525,7 +523,6 @@ public ExoPlayer newInstance(Renderer[] renderers, TrackSelector trackSelector,
                         return mockExoPlayer;
                     }
                 },
-                null,
                 mockAudioManager);
 
         subject.handleCtaClick(activity);
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoViewControllerTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoViewControllerTest.java
index 6204075d..f6580966 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoViewControllerTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/NativeVideoViewControllerTest.java
@@ -65,6 +65,7 @@ public void setUp() {
         NativeVideoController.setForId(123, mockVideoController);
 
         when(mockVastVideoConfig.getCustomCtaText()).thenReturn("Learn More");
+        when(mockVastVideoConfig.getPrivacyInformationIconImageUrl()).thenReturn("piiimageurl");
         when(mockFullScreenVideoView.getTextureView()).thenReturn(mockTextureView);
         when(mockTextureView.getBitmap()).thenReturn(mockBitmap);
         intentExtras.putSerializable(Constants.NATIVE_VAST_VIDEO_CONFIG, mockVastVideoConfig);
@@ -114,6 +115,7 @@ public void onCreate_shouldSetupVideoView() {
         verify(mockFullScreenVideoView).setCtaClickListener(any(View.OnClickListener.class));
         verify(mockFullScreenVideoView).setPrivacyInformationClickListener(
                 any(View.OnClickListener.class));
+        verify(mockFullScreenVideoView).setPrivacyInformationIconImageUrl("piiimageurl");
         verify(mockFullScreenVideoView).setLayoutParams(any(LayoutParams.class));
         verify(mockBaseVideoViewControllerListener).onSetContentView(mockFullScreenVideoView);
         verify(mockBaseVideoViewControllerListener, never()).onFinish();
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/PositioningRequestTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/PositioningRequestTest.java
index 5f42e4ac..79278d5d 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/PositioningRequestTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/PositioningRequestTest.java
@@ -1,5 +1,7 @@
 package com.mopub.nativeads;
 
+import android.app.Activity;
+
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BuildConfig;
 import com.mopub.network.MoPubNetworkError;
@@ -12,6 +14,7 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
+import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 
 import java.util.TreeMap;
@@ -34,7 +37,8 @@
 
     @Before
     public void setup() {
-        subject = new PositioningRequest(url, mockListener, mockErrorListener);
+        subject = new PositioningRequest(Robolectric.buildActivity(Activity.class).get(),
+                url, mockListener, mockErrorListener);
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/nativeads/ServerPositioningSourceTest.java b/mopub-sdk/src/test/java/com/mopub/nativeads/ServerPositioningSourceTest.java
index 75f71afe..bc5862a0 100644
--- a/mopub-sdk/src/test/java/com/mopub/nativeads/ServerPositioningSourceTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/nativeads/ServerPositioningSourceTest.java
@@ -5,7 +5,6 @@
 import android.content.pm.PackageManager;
 
 import com.mopub.common.ClientMetadata;
-import com.mopub.common.DownloadResponse;
 import com.mopub.common.logging.MoPubLog;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BuildConfig;
@@ -18,7 +17,6 @@
 import com.mopub.volley.Request;
 import com.mopub.volley.VolleyError;
 
-import org.apache.http.HttpStatus;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -49,10 +47,6 @@
 public class ServerPositioningSourceTest {
     @Mock PositioningListener mockPositioningListener;
     @Captor ArgumentCaptor<PositioningRequest> positionRequestCaptor;
-    @Mock DownloadResponse mockValidResponse;
-    @Mock DownloadResponse mockNotFoundResponse;
-    @Mock DownloadResponse mockInvalidJsonResponse;
-    @Mock DownloadResponse mockWarmingUpJsonResponse;
     @Mock Context mockContext;
     @Mock ClientMetadata mockClientMetaData;
     @Mock MoPubRequestQueue mockRequestQueue;
@@ -70,18 +64,6 @@ public void setUp() {
         subject = new ServerPositioningSource(spyActivity);
         setupClientMetadata();
         Networking.setRequestQueueForTesting(mockRequestQueue);
-
-        when(mockValidResponse.getStatusCode()).thenReturn(HttpStatus.SC_OK);
-        when(mockValidResponse.getByteArray()).thenReturn("{fixed: []}".getBytes());
-
-        when(mockInvalidJsonResponse.getStatusCode()).thenReturn(HttpStatus.SC_OK);
-        when(mockInvalidJsonResponse.getByteArray()).thenReturn("blah blah".getBytes());
-
-        when(mockWarmingUpJsonResponse.getStatusCode()).thenReturn(HttpStatus.SC_OK);
-        when(mockWarmingUpJsonResponse.getByteArray()).thenReturn(
-                "{\"error\":\"WARMING_UP\"}".getBytes());
-
-        when(mockNotFoundResponse.getStatusCode()).thenReturn(HttpStatus.SC_NOT_FOUND);
     }
 
     private void setupClientMetadata() {
@@ -89,8 +71,6 @@ private void setupClientMetadata() {
         when(mockClientMetaData.getAppName()).thenReturn("app_name");
         when(mockClientMetaData.getAppPackageName()).thenReturn("app_package_name");
         when(mockClientMetaData.getAppVersion()).thenReturn("app_version");
-        when(mockClientMetaData.getDeviceId()).thenReturn("client_device_id");
-        when(mockClientMetaData.isDoNotTrackSet()).thenReturn(true);
         when(mockClientMetaData.getDeviceManufacturer()).thenReturn("device_manufacturer");
         when(mockClientMetaData.getDeviceModel()).thenReturn("device_model");
         when(mockClientMetaData.getDeviceProduct()).thenReturn("device_product");
diff --git a/mopub-sdk/src/test/java/com/mopub/network/AdRequestTest.java b/mopub-sdk/src/test/java/com/mopub/network/AdRequestTest.java
index 094878e1..8a774cc4 100644
--- a/mopub-sdk/src/test/java/com/mopub/network/AdRequestTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/network/AdRequestTest.java
@@ -1,15 +1,12 @@
 package com.mopub.network;
 
 import android.app.Activity;
-import android.location.Location;
 
 import com.mopub.common.AdFormat;
 import com.mopub.common.AdType;
 import com.mopub.common.DataKeys;
+import com.mopub.common.MoPub;
 import com.mopub.common.MoPub.BrowserAgent;
-import com.mopub.common.event.BaseEvent;
-import com.mopub.common.event.EventDispatcher;
-import com.mopub.common.event.MoPubEvents;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.ResponseHeader;
 import com.mopub.mobileads.BuildConfig;
@@ -22,8 +19,6 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
-import org.mockito.invocation.InvocationOnMock;
-import org.mockito.stubbing.Answer;
 import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 
@@ -35,12 +30,7 @@
 import java.util.TreeMap;
 
 import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Matchers.any;
-import static org.mockito.Mockito.doAnswer;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
@@ -48,7 +38,6 @@
 
     @Mock private AdRequest.Listener mockListener;
     @Mock private AdResponse mockAdResponse;
-    @Mock private EventDispatcher mockEventDispatcher;
 
     private AdRequest subject;
     private HashMap<String, String> defaultHeaders;
@@ -73,15 +62,13 @@ public void setup() {
         defaultHeaders.put(ResponseHeader.IMPRESSION_VISIBLE_MS.getKey(), "2000");
         defaultHeaders.put(ResponseHeader.IMPRESSION_MIN_VISIBLE_PX.getKey(), "1");
         defaultHeaders.put(ResponseHeader.MAX_BUFFER_MS.getKey(), "1000");
-
-        MoPubEvents.setEventDispatcher(mockEventDispatcher);
     }
 
     @After
     public void teardown() {
         // Reset our locale for other tests.
         Locale.setDefault(Locale.US);
-        MoPubEvents.setEventDispatcher(null);
+        MoPub.resetBrowserAgent();
     }
 
     @Test
@@ -95,17 +82,6 @@ public void parseNetworkResponse_stringBody_shouldSucceed() throws Exception {
         assertThat(response.result.getStringBody()).isEqualTo("abc");
     }
 
-    @Test
-    public void parseNetworkResponse_withStringBody_shouldLogScribeEvent() throws Exception {
-        defaultHeaders.put(ResponseHeader.AD_TYPE.getKey(), AdType.HTML);
-        NetworkResponse testResponse =
-                new NetworkResponse(200, "abc".getBytes(Charset.defaultCharset()), defaultHeaders, false);
-
-        subject.parseNetworkResponse(testResponse);
-
-        verify(mockEventDispatcher).dispatch(any(BaseEvent.class));
-    }
-
     @Test
     public void parseNetworkResponse_withServerExtrasInResponseBody_shouldSucceed_shouldCombineServerExtras() throws Exception {
         defaultHeaders.put(ResponseHeader.AD_TYPE.getKey(), AdType.HTML);
@@ -143,17 +119,6 @@ public void parseNetworkResponse_nonJsonStringBodyForNative_jsonParseShouldFail(
         assertThat(((MoPubNetworkError) response.error).getReason()).isEqualTo(MoPubNetworkError.Reason.BAD_BODY);
     }
 
-    @Test
-    public void parseNetworkResponse_nonJsonStringBodyForNative_shouldNotLogScribeEvent() {
-        defaultHeaders.put(ResponseHeader.AD_TYPE.getKey(), AdType.STATIC_NATIVE);
-        NetworkResponse testResponse =
-                new NetworkResponse(200, "abc".getBytes(Charset.defaultCharset()), defaultHeaders, false);
-
-        subject.parseNetworkResponse(testResponse);
-
-        verify(mockEventDispatcher, never()).dispatch(any(BaseEvent.class));
-    }
-
     @Test
     public void parseNetworkResponse_forNativeVideo_shouldSucceed() throws Exception {
         defaultHeaders.put(ResponseHeader.AD_TYPE.getKey(), AdType.VIDEO_NATIVE);
@@ -256,18 +221,6 @@ public void parseNetworkResponse_withWarmupHeaderTrue_shouldError() {
         assertThat(((MoPubNetworkError) response.error).getReason()).isEqualTo(MoPubNetworkError.Reason.WARMING_UP);
     }
 
-    @Test
-    public void parseNetworkResponse_withWarmupHeaderTrue_shouldNotLogScribeEvent() {
-        defaultHeaders.put(ResponseHeader.AD_TYPE.getKey(), AdType.STATIC_NATIVE);
-        defaultHeaders.put(ResponseHeader.WARMUP.getKey(), "1");
-        NetworkResponse testResponse =
-                new NetworkResponse(200, "abc".getBytes(Charset.defaultCharset()), defaultHeaders, false);
-
-        subject.parseNetworkResponse(testResponse);
-
-        verify(mockEventDispatcher, never()).dispatch(any(BaseEvent.class));
-    }
-
     @Test
     public void parseNetworkResponse_withRefreshTime_shouldIncludeRefreshTimeInResult() {
         defaultHeaders.put(ResponseHeader.REFRESH_TIME.getKey(), "13");
@@ -319,17 +272,6 @@ public void parseNetworkResponse_withClearAdType_withNoRefreshTimeHeader_shouldE
         assertThat(moPubNetworkError.getRefreshTimeMillis()).isNull();
     }
 
-    @Test
-    public void parseNetworkResponse_withClearAdType_shouldLogScribeEvent() {
-        defaultHeaders.put(ResponseHeader.AD_TYPE.getKey(), AdType.CLEAR);
-
-        NetworkResponse testResponse =
-                new NetworkResponse(200, "abc".getBytes(Charset.defaultCharset()), defaultHeaders, false);
-        subject.parseNetworkResponse(testResponse);
-
-        verify(mockEventDispatcher).dispatch(any(BaseEvent.class));
-    }
-
     @Test
     public void parseNetworkResponse_withBadJSON_shouldReturnError() {
         defaultHeaders.put(ResponseHeader.AD_TYPE.getKey(), AdType.STATIC_NATIVE);
@@ -470,10 +412,12 @@ public void parseNetworkResponse_forNonBannerAdFormat_withImpTrackingHeaders_sho
         defaultHeaders.put(ResponseHeader.BANNER_IMPRESSION_MIN_VISIBLE_MS.getKey(), "0");
 
         // Non-banner AdFormat
-        subject = new AdRequest("testUrl", AdFormat.INTERSTITIAL, "testAdUnitId", activity, mockListener);
+        subject = new AdRequest("testUrl", AdFormat.INTERSTITIAL, "testAdUnitId", activity,
+                mockListener);
 
         NetworkResponse testResponse =
-                new NetworkResponse(200, "abc".getBytes(Charset.defaultCharset()), defaultHeaders, false);
+                new NetworkResponse(200, "abc".getBytes(Charset.defaultCharset()), defaultHeaders,
+                        false);
 
         final Response<AdResponse> response = subject.parseNetworkResponse(testResponse);
 
@@ -488,6 +432,229 @@ public void parseNetworkResponse_forNonBannerAdFormat_withImpTrackingHeaders_sho
         assertThat(serverExtras.get(DataKeys.BANNER_IMPRESSION_MIN_VISIBLE_MS)).isNull();
     }
 
+    public void parsetNetworkResponse_withAdvancedBiddingBanner_shouldCreateAdResponse() {
+        final Map<String, String> headers = new HashMap<String, String>();
+        headers.put(ResponseHeader.AD_RESPONSE_TYPE.getKey(), "multi");
+
+        String jsonResponse = "{\n" +
+                "\t\"ad-responses\": [{\n" +
+                "\t\t\"adm\": \"adm\",\n" +
+                "\t\t\"body\": \"custom selector:\",\n" +
+                "\t\t\"headers\": {\n" +
+                "\t\t\t\"X-Custom-Event-Class-Name\": \"class.name\",\n" +
+                "\t\t\t\"X-Custom-Event-Class-Data\": \"{\\\"placement_id\\\":\\\"1320352438048021_1377881765628421\\\"}\",\n" +
+                "\t\t\t\"X-Adtype\": \"custom\",\n" +
+                "\t\t\t\"X-Clickthrough\": \"click_tracking\",\n" +
+                "\t\t\t\"X-Width\": 320,\n" +
+                "\t\t\t\"X-Height\": 50,\n" +
+                "\t\t\t\"X-Imptracker\": \"impression\",\n" +
+                "\t\t\t\"X-Failurl\": \"failurl\"\n" +
+                "\t\t}\n" +
+                "\t}]\n" +
+                "}";
+        NetworkResponse testResponse =
+                new NetworkResponse(200, jsonResponse.getBytes(Charset.defaultCharset()), headers, false);
+
+        final Response<AdResponse> response = subject.parseNetworkResponse(testResponse);
+        assertThat(response.result.getBrowserAgent()).isEqualTo(BrowserAgent.IN_APP);
+        assertThat(response.result.getCustomEventClassName()).isEqualTo("class.name");
+        assertThat(response.result.getAdType()).isEqualTo(AdType.CUSTOM);
+        assertThat(response.result.getClickTrackingUrl()).isEqualTo("click_tracking");
+        assertThat(response.result.getFailoverUrl()).isEqualTo("failurl");
+        assertThat(response.result.getHeight()).isEqualTo(50);
+        assertThat(response.result.getWidth()).isEqualTo(320);
+        assertThat(response.result.getImpressionTrackingUrl()).isEqualTo("impression");
+        final Map<String, String> serverExtras = response.result.getServerExtras();
+        assertThat(serverExtras.get(DataKeys.CLICKTHROUGH_URL_KEY)).isEqualToIgnoringCase("click_tracking");
+        assertThat(serverExtras.get(DataKeys.ADM_KEY)).isEqualToIgnoringCase("adm");
+        assertThat(serverExtras.get("placement_id")).isEqualTo("1320352438048021_1377881765628421");
+    }
+
+    @Test
+    public void parsetNetworkResponse_withAdvancedBiddingInterstitial_shouldCreateAdResponse() {
+        final Map<String, String> headers = new HashMap<String, String>();
+        headers.put(ResponseHeader.AD_RESPONSE_TYPE.getKey(), "multi");
+
+        String jsonResponse = "{\n" +
+                "\t\"ad-responses\": [{\n" +
+                "\t\t\"adm\": \"adm\",\n" +
+                "\t\t\"body\": \"custom selector:\",\n" +
+                "\t\t\"headers\": {\n" +
+                "\t\t\t\"X-Custom-Event-Class-Name\": \"class.name\",\n" +
+                "\t\t\t\"X-Custom-Event-Class-Data\": \"{\\\"placement_id\\\":\\\"506317839546454_509738309204407\\\"}\",\n" +
+                "\t\t\t\"X-Adtype\": \"custom\",\n" +
+                "\t\t\t\"X-Clickthrough\": \"click_tracking\",\n" +
+                "\t\t\t\"X-Imptracker\": \"impression\",\n" +
+                "\t\t\t\"X-Failurl\": \"failurl\",\n" +
+                "\t\t\t\"X-Orientation\": \"p\"\n" +
+                "\t\t}\n" +
+                "\t}]\n" +
+                "}";
+        NetworkResponse testResponse =
+                new NetworkResponse(200, jsonResponse.getBytes(Charset.defaultCharset()), headers, false);
+
+        final Response<AdResponse> response = subject.parseNetworkResponse(testResponse);
+        assertThat(response.result.getBrowserAgent()).isEqualTo(BrowserAgent.IN_APP);
+        assertThat(response.result.getCustomEventClassName()).isEqualTo("class.name");
+        assertThat(response.result.getAdType()).isEqualTo(AdType.CUSTOM);
+        assertThat(response.result.getClickTrackingUrl()).isEqualTo("click_tracking");
+        assertThat(response.result.getFailoverUrl()).isEqualTo("failurl");
+        assertThat(response.result.getImpressionTrackingUrl()).isEqualTo("impression");
+        final Map<String, String> serverExtras = response.result.getServerExtras();
+        assertThat(serverExtras.get(DataKeys.CLICKTHROUGH_URL_KEY)).isEqualToIgnoringCase("click_tracking");
+        assertThat(serverExtras.get(DataKeys.CREATIVE_ORIENTATION_KEY)).isNull();
+        assertThat(serverExtras.get(DataKeys.ADM_KEY)).isEqualToIgnoringCase("adm");
+        assertThat(serverExtras.get("placement_id")).isEqualTo("506317839546454_509738309204407");
+    }
+
+    @Test
+    public void parsetNetworkResponse_withAdvancedBiddingRewardedVideo_shouldCreateAdResponse() {
+        final Map<String, String> headers = new HashMap<String, String>();
+        headers.put(ResponseHeader.AD_RESPONSE_TYPE.getKey(), "multi");
+
+        String jsonResponse = "{\n" +
+                "\t\"ad-responses\": [{\n" +
+                "\t\t\"adm\": \"adm\",\n" +
+                "\t\t\"body\": \"custom selector:\",\n" +
+                "\t\t\"headers\": {\n" +
+                "\t\t\t\"X-Custom-Event-Class-Name\": \"class.name\",\n" +
+                "\t\t\t\"X-Custom-Event-Class-Data\": \"{\\\"placement_id\\\":\\\"921244177968627_1427142827378757\\\"}\",\n" +
+                "\t\t\t\"X-Adtype\": \"custom\",\n" +
+                "\t\t\t\"X-Clickthrough\": \"click_tracking\",\n" +
+                "\t\t\t\"X-Width\": 480,\n" +
+                "\t\t\t\"X-Height\": 320,\n" +
+                "\t\t\t\"X-Imptracker\": \"impression\",\n" +
+                "\t\t\t\"X-Failurl\": \"failurl\",\n" +
+                "\t\t\t\"X-Rewarded-Currencies\": \"{\\\"rewards\\\":[{\\\"amount\\\":7,\\\"name\\\":\\\"Coins\\\"}]}\",\n" +
+                "\t\t\t\"X-Rewarded-Duration\": 33\n" +
+                "\t\t}\n" +
+                "\t}]\n" +
+                "}";
+        NetworkResponse testResponse =
+                new NetworkResponse(200, jsonResponse.getBytes(Charset.defaultCharset()), headers, false);
+
+        final Response<AdResponse> response = subject.parseNetworkResponse(testResponse);
+        assertThat(response.result.getBrowserAgent()).isEqualTo(BrowserAgent.IN_APP);
+        assertThat(response.result.getCustomEventClassName()).isEqualTo("class.name");
+        assertThat(response.result.getAdType()).isEqualTo(AdType.CUSTOM);
+        assertThat(response.result.getClickTrackingUrl()).isEqualTo("click_tracking");
+        assertThat(response.result.getFailoverUrl()).isEqualTo("failurl");
+        assertThat(response.result.getImpressionTrackingUrl()).isEqualTo("impression");
+        assertThat(response.result.getWidth()).isEqualTo(480);
+        assertThat(response.result.getHeight()).isEqualTo(320);
+        assertThat(response.result.shouldRewardOnClick()).isFalse();
+        assertThat(response.result.getRewardedCurrencies()).isEqualTo("{\"rewards\":[{\"amount\":7,\"name\":\"Coins\"}]}");
+        assertThat(response.result.getRewardedDuration()).isEqualTo(33);
+        final Map<String, String> serverExtras = response.result.getServerExtras();
+        assertThat(serverExtras.get(DataKeys.CLICKTHROUGH_URL_KEY)).isEqualToIgnoringCase("click_tracking");
+        assertThat(serverExtras.get(DataKeys.ADM_KEY)).isEqualToIgnoringCase("adm");
+        assertThat(serverExtras.get("placement_id")).isEqualTo("921244177968627_1427142827378757");
+    }
+
+    @Test
+    public void parsetNetworkResponse_withAdvancedBiddingNative_shouldCreateAdResponse() {
+        final Map<String, String> headers = new HashMap<String, String>();
+        headers.put(ResponseHeader.AD_RESPONSE_TYPE.getKey(), "multi");
+
+        String jsonResponse = "{\n" +
+                "\t\"ad-responses\": [{\n" +
+                "\t\t\"adm\": \"adm\",\n" +
+                "\t\t\"body\": \"custom selector:\",\n" +
+                "\t\t\"headers\": {\n" +
+                "\t\t\t\"X-Custom-Event-Class-Name\": \"class.name\",\n" +
+                "\t\t\t\"X-Custom-Event-Class-Data\": \"{\\\"placement_id\\\":\\\"619633174799370_623762807719740\\\"}\",\n" +
+                "\t\t\t\"X-Adtype\": \"custom\",\n" +
+                "\t\t\t\"X-Clickthrough\": \"click_tracking\",\n" +
+                "\t\t\t\"X-Imptracker\": \"impression\",\n" +
+                "\t\t\t\"X-Failurl\": \"failurl\"\n" +
+                "\t\t}\n" +
+                "\t}]\n" +
+                "}";
+        NetworkResponse testResponse =
+                new NetworkResponse(200, jsonResponse.getBytes(Charset.defaultCharset()), headers, false);
+
+        final Response<AdResponse> response = subject.parseNetworkResponse(testResponse);
+        assertThat(response.result.getBrowserAgent()).isEqualTo(BrowserAgent.IN_APP);
+        assertThat(response.result.getCustomEventClassName()).isEqualTo("class.name");
+        assertThat(response.result.getAdType()).isEqualTo(AdType.CUSTOM);
+        assertThat(response.result.getClickTrackingUrl()).isEqualTo("click_tracking");
+        assertThat(response.result.getFailoverUrl()).isEqualTo("failurl");
+        assertThat(response.result.getImpressionTrackingUrl()).isEqualTo("impression");
+        final Map<String, String> serverExtras = response.result.getServerExtras();
+        assertThat(serverExtras.get(DataKeys.CLICKTHROUGH_URL_KEY)).isEqualToIgnoringCase("click_tracking");
+        assertThat(serverExtras.get(DataKeys.ADM_KEY)).isEqualToIgnoringCase("adm");
+        assertThat(serverExtras.get("placement_id")).isEqualTo("619633174799370_623762807719740");
+    }
+
+    @Test
+    public void prepareNetworkResponse_withTwoAdResponses_shouldCreateAdResponseForFirstAd() {
+        final Map<String, String> headers = new HashMap<String, String>();
+        headers.put(ResponseHeader.AD_RESPONSE_TYPE.getKey(), "multi");
+
+        String jsonResponse = "{\n" +
+                "\t\"ad-responses\": [{\n" +
+                "\t\t\"adm\": \"adm\",\n" +
+                "\t\t\"body\": \"custom selector:\",\n" +
+                "\t\t\"headers\": {\n" +
+                "\t\t\t\"X-Custom-Event-Class-Name\": \"class.name\",\n" +
+                "\t\t\t\"X-Custom-Event-Class-Data\": \"{\\\"placement_id\\\":\\\"619633174799370_623762807719740\\\"}\",\n" +
+                "\t\t\t\"X-Adtype\": \"custom\",\n" +
+                "\t\t\t\"X-Clickthrough\": \"click_tracking\",\n" +
+                "\t\t\t\"X-Imptracker\": \"impression\",\n" +
+                "\t\t\t\"X-Failurl\": \"failurl\"\n" +
+                "\t\t}\n" +
+                "\t}," +
+                "\t{" +
+                "\t\t\"adm\": \"adm2\",\n" +
+                "\t\t\"body\": \"custom selector:\",\n" +
+                "\t\t\"headers\": {\n" +
+                "\t\t\t\"X-Custom-Event-Class-Name\": \"class.name2\",\n" +
+                "\t\t\t\"X-Custom-Event-Class-Data\": \"{\\\"placement_id\\\":\\\"2\\\"}\",\n" +
+                "\t\t\t\"X-Adtype\": \"custom\",\n" +
+                "\t\t\t\"X-Clickthrough\": \"click_tracking2\",\n" +
+                "\t\t\t\"X-Imptracker\": \"impression2\",\n" +
+                "\t\t\t\"X-Failurl\": \"failurl2\"\n" +
+                "\t\t}\n" +
+                "}]" +
+                "}";
+
+        NetworkResponse testResponse =
+                new NetworkResponse(200, jsonResponse.getBytes(Charset.defaultCharset()), headers,
+                        false);
+
+        final Response<AdResponse> response = subject.parseNetworkResponse(testResponse);
+        assertThat(response.result.getBrowserAgent()).isEqualTo(BrowserAgent.IN_APP);
+        assertThat(response.result.getCustomEventClassName()).isEqualTo("class.name");
+        assertThat(response.result.getAdType()).isEqualTo(AdType.CUSTOM);
+        assertThat(response.result.getClickTrackingUrl()).isEqualTo("click_tracking");
+        assertThat(response.result.getFailoverUrl()).isEqualTo("failurl");
+        assertThat(response.result.getImpressionTrackingUrl()).isEqualTo("impression");
+        final Map<String, String> serverExtras = response.result.getServerExtras();
+        assertThat(serverExtras.get(DataKeys.CLICKTHROUGH_URL_KEY)).isEqualToIgnoringCase("click_tracking");
+        assertThat(serverExtras.get(DataKeys.ADM_KEY)).isEqualToIgnoringCase("adm");
+        assertThat(serverExtras.get("placement_id")).isEqualTo("619633174799370_623762807719740");
+    }
+
+    @Test
+    public void prepareNetworkResponse_withZeroAdResponses_shouldReturnFailureResponse() {
+        final Map<String, String> headers = new HashMap<String, String>();
+        headers.put(ResponseHeader.AD_RESPONSE_TYPE.getKey(), "multi");
+
+        String jsonResponse = "{\n" +
+                "\t\"ad-responses\": []\n" +
+                "}";
+
+        NetworkResponse testResponse =
+                new NetworkResponse(200, jsonResponse.getBytes(Charset.defaultCharset()), headers,
+                        false);
+
+        final Response<AdResponse> response = subject.parseNetworkResponse(testResponse);
+        assertThat(response.error).isNotNull();
+        assertThat(response.error).isExactlyInstanceOf(MoPubNetworkError.class);
+        assertThat(((MoPubNetworkError) response.error).getReason()).isEqualTo(
+                MoPubNetworkError.Reason.BAD_HEADER_DATA);
+    }
+
     @Test
     public void deliverResponse_shouldCallListenerOnSuccess() throws Exception {
         subject.deliverResponse(mockAdResponse);
@@ -564,51 +731,4 @@ public void getHeaders_withLocaleLanguageAsEmptyString_shouldNotAddLanguageHeade
 
         assertThat(subject.getHeaders()).isEqualTo(expectedHeaders);
     }
-
-    @Test
-    public void logScribeEvent_shouldLogEvent() throws Exception {
-        AdResponse mockAdResponse = mock(AdResponse.class);
-        when(mockAdResponse.getDspCreativeId()).thenReturn("dsp_creative_id");
-        when(mockAdResponse.getAdType()).thenReturn("html");
-        when(mockAdResponse.getNetworkType()).thenReturn("network_type");
-        when(mockAdResponse.getWidth()).thenReturn(320);
-        when(mockAdResponse.getHeight()).thenReturn(50);
-        when(mockAdResponse.getRequestId()).thenReturn("ac298c522b0e412b85ff81e4b9b51f03");
-
-        NetworkResponse networkResponse = new NetworkResponse(200, null, null, false, 300);
-
-        Location mockLocation = mock(Location.class);
-        when(mockLocation.getLatitude()).thenReturn(37.7833);
-        when(mockLocation.getLongitude()).thenReturn(-122.4167);
-        when(mockLocation.getAccuracy()).thenReturn((float) 2000.0);
-
-        doAnswer(new Answer() {
-            @Override
-            public Object answer(InvocationOnMock invocation) throws Throwable {
-                Object[] args = invocation.getArguments();
-                BaseEvent baseEvent = (BaseEvent) args[0];
-                assertThat(baseEvent.getName()).isEqualTo(BaseEvent.Name.AD_REQUEST);
-                assertThat(baseEvent.getCategory()).isEqualTo(BaseEvent.Category.REQUESTS);
-                assertThat(baseEvent.getSamplingRate()).isEqualTo(0.1);
-                assertThat(baseEvent.getAdUnitId()).isEqualTo(adUnitId);
-                assertThat(baseEvent.getDspCreativeId()).isEqualTo("dsp_creative_id");
-                assertThat(baseEvent.getAdType()).isEqualTo("html");
-                assertThat(baseEvent.getAdNetworkType()).isEqualTo("network_type");
-                assertThat(baseEvent.getAdWidthPx()).isEqualTo(320);
-                assertThat(baseEvent.getAdHeightPx()).isEqualTo(50);
-                assertThat(baseEvent.getGeoLat()).isEqualTo(37.7833);
-                assertThat(baseEvent.getGeoLon()).isEqualTo(-122.4167);
-                assertThat(baseEvent.getGeoAccuracy()).isEqualTo(2000.0);
-                assertThat(baseEvent.getPerformanceDurationMs()).isEqualTo(300);
-                assertThat(baseEvent.getRequestId()).isEqualTo("ac298c522b0e412b85ff81e4b9b51f03");
-                assertThat(baseEvent.getRequestStatusCode()).isEqualTo(200);
-                assertThat(baseEvent.getRequestUri()).isEqualTo("testUrl");
-                return null;
-            }
-        }).when(mockEventDispatcher).dispatch(any(BaseEvent.class));
-
-        subject.logScribeEvent(mockAdResponse, networkResponse, mockLocation);
-
-        verify(mockEventDispatcher).dispatch(any(BaseEvent.class));
-    }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/network/CustomSSLSocketFactoryTest.java b/mopub-sdk/src/test/java/com/mopub/network/CustomSSLSocketFactoryTest.java
index 01ba66f4..0395851f 100644
--- a/mopub-sdk/src/test/java/com/mopub/network/CustomSSLSocketFactoryTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/network/CustomSSLSocketFactoryTest.java
@@ -9,6 +9,7 @@
 import com.mopub.TestSdkHelper;
 import com.mopub.mobileads.BuildConfig;
 
+import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -45,6 +46,7 @@
     private CustomSSLSocketFactory subject;
     private SSLCertificateSocketFactory mockSSLCertificateSocketFactory;
     private SSLSocketWithSetHostname mockSSLSocket;
+    private int previousSdkVersion;
 
     @SuppressLint("SSLCertificateSocketFactoryCreateSocket")
     @Before
@@ -59,6 +61,12 @@ public void setUp() throws Exception {
                 mockInetAddress);
         subject = CustomSSLSocketFactory.getDefault(0);
         subject.setCertificateSocketFactory(mockSSLCertificateSocketFactory);
+        previousSdkVersion = Build.VERSION.SDK_INT;
+    }
+
+    @After
+    public void tearDown() {
+        TestSdkHelper.setReportedSdkLevel(previousSdkVersion);
     }
 
     @Test
@@ -71,6 +79,11 @@ public void createSocket_withSocketParam_withAutoCloseTrue_shouldCloseOriginalSo
         subject.createSocket(mockSocket, "hostname", 443, true);
 
         verify(mockSocket).close();
+        verify(mockSSLSocket).getSupportedProtocols();
+        verify(mockSSLSocket).setEnabledProtocols(any(String[].class));
+        verify(mockSSLSocket).startHandshake();
+        verify(mockSSLSocket).getSession();
+        verify(mockSSLSocket).setHostname(any(String.class));
         verifyNoMoreInteractions(mockSocket);
     }
 
diff --git a/mopub-sdk/src/test/java/com/mopub/network/HeaderUtilsTest.java b/mopub-sdk/src/test/java/com/mopub/network/HeaderUtilsTest.java
index 5fbf65b7..6b2d011e 100644
--- a/mopub-sdk/src/test/java/com/mopub/network/HeaderUtilsTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/network/HeaderUtilsTest.java
@@ -2,13 +2,17 @@
 
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.mobileads.BuildConfig;
-import com.mopub.mobileads.test.support.TestHttpResponseWithHeaders;
+import com.mopub.volley.Header;
+import com.mopub.volley.toolbox.HttpResponse;
 
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.annotation.Config;
 
+import java.util.ArrayList;
+import java.util.List;
+
 import static com.mopub.common.util.ResponseHeader.AD_TIMEOUT;
 import static com.mopub.common.util.ResponseHeader.SCROLLABLE;
 import static org.fest.assertions.api.Assertions.assertThat;
@@ -16,28 +20,28 @@
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
 public class HeaderUtilsTest {
-    private TestHttpResponseWithHeaders response;
+    private HttpResponse response;
+    private List<Header> headers;
 
     @Before
     public void setup() {
-        response = new TestHttpResponseWithHeaders(200, "all is well");
+        headers = new ArrayList<Header>();
+        response = new HttpResponse(200, headers);
     }
 
     @Test
     public void extractBooleanHeader_whenValueIsZero_shouldReturnFalse() throws Exception {
-        response.addHeader(SCROLLABLE.getKey(), "0");
+        headers.add(new Header(SCROLLABLE.getKey(), "0"));
         assertThat(HeaderUtils.extractBooleanHeader(response, SCROLLABLE, false)).isFalse();
 
-        response.addHeader(SCROLLABLE.getKey(), "0");
         assertThat(HeaderUtils.extractBooleanHeader(response, SCROLLABLE, true)).isFalse();
     }
 
     @Test
     public void extractBooleanHeader_whenValueIsOne_shouldReturnTrue() throws Exception {
-        response.addHeader(SCROLLABLE.getKey(), "1");
+        headers.add(new Header(SCROLLABLE.getKey(), "1"));
         assertThat(HeaderUtils.extractBooleanHeader(response, SCROLLABLE, false)).isTrue();
 
-        response.addHeader(SCROLLABLE.getKey(), "1");
         assertThat(HeaderUtils.extractBooleanHeader(response, SCROLLABLE, true)).isTrue();
     }
 
@@ -51,22 +55,25 @@ public void extractBooleanHeader_shouldReturnDefaultValue() throws Exception {
 
     @Test
     public void extractIntegerHeader_shouldReturnIntegerValue() throws Exception {
-        response.addHeader(AD_TIMEOUT.getKey(), "10");
+        headers.add(new Header(AD_TIMEOUT.getKey(), "10"));
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isEqualTo(10);
 
-        response.addHeader(AD_TIMEOUT.getKey(), "0");
+        headers.clear();
+        headers.add(new Header(AD_TIMEOUT.getKey(), "0"));
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isEqualTo(0);
 
-        response.addHeader(AD_TIMEOUT.getKey(), "-2");
+        headers.clear();
+        headers.add(new Header(AD_TIMEOUT.getKey(), "-2"));
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isEqualTo(-2);
     }
 
     @Test
     public void extractIntegerHeader_withDoubleValue_shouldTruncateValue() throws Exception {
-        response.addHeader(AD_TIMEOUT.getKey(), "3.14");
+        headers.add(new Header(AD_TIMEOUT.getKey(), "3.14"));
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isEqualTo(3);
 
-        response.addHeader(AD_TIMEOUT.getKey(), "-3.14");
+        headers.clear();
+        headers.add(new Header(AD_TIMEOUT.getKey(), "-3.14"));
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isEqualTo(-3);
     }
 
@@ -75,22 +82,23 @@ public void extractIntegerHeader_whenNoHeaderPresent_shouldReturnNull() throws E
         // no header added to response
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isNull();
 
-        response.addHeader(AD_TIMEOUT.getKey(), null);
+        headers.add(new Header(AD_TIMEOUT.getKey(), null));
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isNull();
     }
 
     @Test
     public void extractIntegerHeader_withNonsenseStringValue_shouldReturnNull() throws Exception {
-        response.addHeader(AD_TIMEOUT.getKey(), "llama!!guy");
+        headers.add(new Header(AD_TIMEOUT.getKey(), "llama!!guy"));
         assertThat(HeaderUtils.extractIntegerHeader(response, AD_TIMEOUT)).isNull();
     }
 
     @Test
     public void extractIntHeader_withInvalidHeader_shouldUseDefaultValue() throws Exception {
-        response.addHeader(AD_TIMEOUT.getKey(), "5");
+        headers.add(new Header(AD_TIMEOUT.getKey(), "5"));
         assertThat(HeaderUtils.extractIntHeader(response, AD_TIMEOUT, 10)).isEqualTo(5);
 
-        response.addHeader(AD_TIMEOUT.getKey(), "five!");
+        headers.clear();
+        headers.add(new Header(AD_TIMEOUT.getKey(), "five!"));
         assertThat(HeaderUtils.extractIntHeader(response, AD_TIMEOUT, 10)).isEqualTo(10);
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/network/MoPubRequestQueueTest.java b/mopub-sdk/src/test/java/com/mopub/network/MoPubRequestQueueTest.java
index cd0ab708..ad2295bb 100644
--- a/mopub-sdk/src/test/java/com/mopub/network/MoPubRequestQueueTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/network/MoPubRequestQueueTest.java
@@ -1,205 +1,21 @@
 package com.mopub.network;
 
-import android.app.Activity;
-import android.os.Handler;
-
-import com.mopub.common.ClientMetadata;
-import com.mopub.common.Constants;
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.common.util.DeviceUtils;
-import com.mopub.mobileads.BuildConfig;
 import com.mopub.volley.Cache;
 import com.mopub.volley.Network;
-import com.mopub.volley.Request;
-import com.mopub.volley.RequestQueue;
-import com.mopub.volley.toolbox.BasicNetwork;
-import com.mopub.volley.toolbox.DiskBasedCache;
-import com.mopub.volley.toolbox.HttpStack;
-import com.mopub.volley.toolbox.HurlStack;
-
-import org.junit.After;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.robolectric.Robolectric;
-import org.robolectric.annotation.Config;
-
-import java.io.File;
 
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.never;
-import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
 public class MoPubRequestQueueTest {
 
-    private MoPubRequestQueue subject;
-    private MoPubRequestQueue.DelayedRequestHelper delayedRequestHelper;
-    @Mock private ScribeRequest mockScribeRequest;
-    @Mock private MoPubRequestQueue.DelayedRequestHelper mockDelayedRequestHelper;
-    @Mock private Handler mockHandler;
-
-    @Before
-    public void setUp() {
-        // NOTE: It's possible to start a new test with a queue set from a previous test suite
-        // Make sure we get a fresh one
-        Networking.setRequestQueueForTesting(null);
-
-        Activity activity = Robolectric.buildActivity(Activity.class).create().get();
-
-        // Construct our dependencies & build the object
-        final ClientMetadata clientMetadata = ClientMetadata.getInstance(activity);
-        final HurlStack.UrlRewriter urlRewriter = new PlayServicesUrlRewriter(clientMetadata.getDeviceId(), activity);
-        // No Custom SSL Factory
-
-        HttpStack httpStack = new RequestQueueHttpStack("test_user_agent", urlRewriter);
-
-        Network network = new BasicNetwork(httpStack);
-        File volleyCacheDir = new File(activity.getCacheDir().getPath() + File.separator
-                + Networking.CACHE_DIRECTORY_NAME);
-        Cache cache = new DiskBasedCache(volleyCacheDir, (int) DeviceUtils.diskCacheSizeBytes(volleyCacheDir, Constants.TEN_MB));
-        subject = new MoPubRequestQueue(cache, network);
-        subject.start();
-
-        delayedRequestHelper = subject.new DelayedRequestHelper(mockScribeRequest, 100, mockHandler);
-    }
-
-    @After
-    public void tearDown() {
-        // NOTE: Make sure that we clear the queue after the last test in the test suite runs so
-        // that the next test suite starts fresh
-        Networking.setRequestQueueForTesting(null);
-    }
-
-    @Test
-    public void addDelayedRequest_shouldStartDelayedRequestHelper_shouldPutRequestInMap() throws Exception {
-        subject.addDelayedRequest(mockScribeRequest, mockDelayedRequestHelper);
-
-        verify(mockDelayedRequestHelper).start();
-        assertThat(subject.getDelayedRequests().get(mockScribeRequest)).isEqualTo(mockDelayedRequestHelper);
-        assertThat(subject.getDelayedRequests().entrySet()).hasSize(1);
-    }
-
-    @Test
-    public void addDelayedRequest_shouldCancelPreexistingRequest() throws Exception {
-        subject.addDelayedRequest(mockScribeRequest, mockDelayedRequestHelper);
-
-        verify(mockDelayedRequestHelper, never()).cancel();
-        verify(mockScribeRequest, never()).cancel();
+    public static class TestMoPubRequestQueue extends MoPubRequestQueue {
 
-        subject.addDelayedRequest(mockScribeRequest, mockDelayedRequestHelper);
-
-        verify(mockDelayedRequestHelper).cancel();
-        verify(mockScribeRequest).cancel();
-    }
-
-    @Test
-    public void addDelayedRequest_withUniqueRequest_shouldNotCancelOtherRequests() throws Exception {
-        ScribeRequest mockScribeRequest2 = mock(ScribeRequest.class);
-        MoPubRequestQueue.DelayedRequestHelper mockDelayedRequestHelper2 = mock(MoPubRequestQueue.DelayedRequestHelper.class);
-        subject.addDelayedRequest(mockScribeRequest, mockDelayedRequestHelper);
-        subject.addDelayedRequest(mockScribeRequest2, mockDelayedRequestHelper2);
-
-        verify(mockDelayedRequestHelper, never()).cancel();
-        verify(mockScribeRequest, never()).cancel();
-
-        verify(mockDelayedRequestHelper2).start();
-        assertThat(subject.getDelayedRequests().get(mockScribeRequest)).isEqualTo(mockDelayedRequestHelper);
-        assertThat(subject.getDelayedRequests().get(mockScribeRequest2)).isEqualTo(mockDelayedRequestHelper2);
-        assertThat(subject.getDelayedRequests().entrySet()).hasSize(2);
+        TestMoPubRequestQueue(Cache cache, Network network) {
+            super(cache, network);
+        }
     }
 
-    @Test
-    public void cancelAll_shouldCancelAllRequestsInTheDelayedRequestMapThatPassTheFilter() throws Exception {
-        ScribeRequest mockScribeRequest2 = mock(ScribeRequest.class);
-        MoPubRequestQueue.DelayedRequestHelper mockDelayedRequestHelper2 = mock(MoPubRequestQueue.DelayedRequestHelper.class);
-        subject.addDelayedRequest(mockScribeRequest, mockDelayedRequestHelper);
-        subject.addDelayedRequest(mockScribeRequest2, mockDelayedRequestHelper2);
-
-
-        subject.cancelAll(new RequestQueue.RequestFilter() {
-            @Override
-            public boolean apply(Request<?> request) {
-                return request == mockScribeRequest;
-            }
-        });
-
-        verify(mockDelayedRequestHelper).cancel();
-        verify(mockScribeRequest).cancel();
-
-        verify(mockDelayedRequestHelper2, never()).cancel();
-        verify(mockScribeRequest2, never()).cancel();
-
-        assertThat(subject.getDelayedRequests().entrySet()).hasSize(1);
-        assertThat(subject.getDelayedRequests().get(mockScribeRequest2)).isEqualTo(mockDelayedRequestHelper2);
-    }
-
-    @Test
-    public void cancelAll_shouldCancelAllRequestsWithMatchingObjectTag() throws Exception {
-        ScribeRequest mockScribeRequest2 = mock(ScribeRequest.class);
-        MoPubRequestQueue.DelayedRequestHelper mockDelayedRequestHelper2 = mock(MoPubRequestQueue.DelayedRequestHelper.class);
-        subject.addDelayedRequest(mockScribeRequest, mockDelayedRequestHelper);
-        subject.addDelayedRequest(mockScribeRequest2, mockDelayedRequestHelper2);
-
-        when(mockScribeRequest.getTag()).thenReturn(1);
-        when(mockScribeRequest2.getTag()).thenReturn(2);
-
-        subject.cancelAll(1);
-
-        verify(mockDelayedRequestHelper).cancel();
-        verify(mockScribeRequest).cancel();
-
-        verify(mockDelayedRequestHelper2, never()).cancel();
-        verify(mockScribeRequest2, never()).cancel();
-
-        assertThat(subject.getDelayedRequests().entrySet()).hasSize(1);
-        assertThat(subject.getDelayedRequests().get(mockScribeRequest2)).isEqualTo(mockDelayedRequestHelper2);
-    }
-
-    @Test
-    public void cancel_shouldCancelMatchingRequest() throws Exception {
-        ScribeRequest mockScribeRequest2 = mock(ScribeRequest.class);
-        MoPubRequestQueue.DelayedRequestHelper mockDelayedRequestHelper2 = mock(MoPubRequestQueue.DelayedRequestHelper.class);
-        subject.addDelayedRequest(mockScribeRequest, mockDelayedRequestHelper);
-        subject.addDelayedRequest(mockScribeRequest2, mockDelayedRequestHelper2);
-
-        subject.cancel(mockScribeRequest);
-
-        verify(mockDelayedRequestHelper).cancel();
-        verify(mockScribeRequest).cancel();
-
-        verify(mockDelayedRequestHelper2, never()).cancel();
-        verify(mockScribeRequest2, never()).cancel();
-
-        assertThat(subject.getDelayedRequests().entrySet()).hasSize(1);
-        assertThat(subject.getDelayedRequests().get(mockScribeRequest2)).isEqualTo(mockDelayedRequestHelper2);
-    }
-    
-    @Test
-    public void DelayedRequestHelper_start_shouldPostDelayedRunnable() throws Exception {
-        delayedRequestHelper.start();
-        verify(mockHandler).postDelayed(delayedRequestHelper.mDelayedRunnable, 100);
-    }
-
-    @Test
-    public void DelayedRequestHelper_cancel_shouldCancelDelayedRunnable() throws Exception {
-        delayedRequestHelper.cancel();
-        verify(mockHandler).removeCallbacks(delayedRequestHelper.mDelayedRunnable);
-    }
-
-    @Test
-    public void DelayedRequestHelper_Runnable_run_shouldRemoveRequestFromDelayedRequestsMap_shouldAddRequestToQueue() throws Exception {
-        subject.addDelayedRequest(mockScribeRequest, 100);
-        assertThat(subject.getDelayedRequests().entrySet().size()).isEqualTo(1);
-        MoPubRequestQueue.DelayedRequestHelper delayedRequestHelper = subject.getDelayedRequests().get(mockScribeRequest);
-
-        delayedRequestHelper.mDelayedRunnable.run();
+    public static class TestMoPubRequestQueue2 extends MoPubRequestQueue {
 
-        assertThat(subject.getDelayedRequests().entrySet()).isEmpty();
-        verify(mockScribeRequest).setRequestQueue(subject);
+        TestMoPubRequestQueue2(Cache cache, Network network) {
+            super(cache, network);
+        }
     }
 }
diff --git a/mopub-sdk/src/test/java/com/mopub/network/MoPubRequestUtilsTest.java b/mopub-sdk/src/test/java/com/mopub/network/MoPubRequestUtilsTest.java
new file mode 100644
index 00000000..f7558e8c
--- /dev/null
+++ b/mopub-sdk/src/test/java/com/mopub/network/MoPubRequestUtilsTest.java
@@ -0,0 +1,145 @@
+package com.mopub.network;
+
+import android.app.Activity;
+import android.content.Context;
+
+import com.mopub.common.Constants;
+import com.mopub.common.test.support.SdkTestRunner;
+import com.mopub.mobileads.BuildConfig;
+import com.mopub.volley.Request;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.robolectric.Robolectric;
+import org.robolectric.annotation.Config;
+
+import java.util.HashMap;
+import java.util.Map;
+
+import static org.fest.assertions.api.Assertions.assertThat;
+
+@RunWith(SdkTestRunner.class)
+@Config(constants = BuildConfig.class)
+public class MoPubRequestUtilsTest {
+
+    private Context context;
+    private Map<String, String> params;
+
+    @Before
+    public void setUp() {
+        context = Robolectric.buildActivity(Activity.class).get();
+        params = new HashMap<>();
+        params.put("query1", "value1");
+        params.put("query2", "value2,value3,value4");
+        params.put("query3", "");
+        params.put("query4", "value5%20value6");
+    }
+
+    @Test
+    public void chooseMethod_withMoPubUrl_shouldReturnPost() {
+        final int result = MoPubRequestUtils.chooseMethod("https://" + Constants.HOST);
+
+        assertThat(result).isEqualTo(Request.Method.POST);
+    }
+
+    @Test
+    public void chooseMethod_withNonMoPubUrl_shouldReturnGet() {
+        final int result = MoPubRequestUtils.chooseMethod("https://www.someurl.com");
+
+        assertThat(result).isEqualTo(Request.Method.GET);
+    }
+
+    @Test
+    public void isMoPubRequest_withHttpsMoPubUrl_shouldReturnTrue() {
+        final boolean result = MoPubRequestUtils.isMoPubRequest("https://ads.mopub.com/m/ad");
+
+        assertThat(result).isTrue();
+    }
+
+    @Test
+    public void isMoPubRequest_withHttpMoPubUrl_shouldReturnTrue() {
+        final boolean result = MoPubRequestUtils.isMoPubRequest("http://ads.mopub.com/m/imp");
+
+        assertThat(result).isTrue();
+    }
+
+    @Test
+    public void isMoPubRequest_withHttpsNonMoPubUrl_shouldReturnFalse() {
+        final boolean result = MoPubRequestUtils.isMoPubRequest("https://www.abcdefg.com/xyz");
+
+        assertThat(result).isFalse();
+    }
+
+    @Test
+    public void isMoPubRequest_withHttpNonMoPubUrl_shouldReturnFalse() {
+        final boolean result = MoPubRequestUtils.isMoPubRequest("http://www.notmopub.com/hi");
+
+        assertThat(result).isFalse();
+    }
+
+    @Test
+    public void truncateQueryParamsIfPost_withQueryParams_shouldStripQuery() {
+        final String result = MoPubRequestUtils.truncateQueryParamsIfPost(
+                "https://ads.mopub.com/m/ad?query1=abc&query2=def%20ghi&query3=jkl#fragment");
+
+        assertThat(result).isEqualTo("https://ads.mopub.com/m/ad");
+    }
+
+    @Test
+    public void truncateQueryParamsIfPost_withNonMoPubUrl_shouldDoNothing() {
+        final String result = MoPubRequestUtils.truncateQueryParamsIfPost(
+                "https://www.notmopub.com/m/ad?query1=abc&query2=def%20ghi&query3=jkl#fragment");
+
+        assertThat(result).isEqualTo(
+                "https://www.notmopub.com/m/ad?query1=abc&query2=def%20ghi&query3=jkl#fragment");
+    }
+
+    @Test
+    public void truncateQueryParamsIfPost_withIntent_shouldDoNothing() {
+        final String result = MoPubRequestUtils.truncateQueryParamsIfPost("geo:37.777328,-122.416544");
+
+        assertThat(result).isEqualTo("geo:37.777328,-122.416544");
+    }
+
+    @Test
+    public void convertQueryToMap_withAdRequest_shouldReturnQueryMap() {
+        final Map<String, String> result = MoPubRequestUtils.convertQueryToMap(context,
+                "https://ads.mopub.com/m/ad?query1=abc&query2=def%20ghi&query3=jkl&query1=mno&query4&query4&query4#fragment");
+
+        assertThat(result.size()).isEqualTo(4);
+        assertThat(result.get("query1")).isEqualTo("abc,mno");
+        assertThat(result.get("query2")).isEqualTo("def ghi");
+        assertThat(result.get("query3")).isEqualTo("jkl");
+        assertThat(result.get("query4")).isEqualTo(",,");
+    }
+
+    @Test
+    public void convertQueryToMap_withNoQueryParams_shouldReturnEmptyMap() {
+        final Map<String, String> result = MoPubRequestUtils.convertQueryToMap(context,
+                "https://ads.mopub.com/m/ad");
+
+        assertThat(result).isEmpty();
+    }
+
+    @Test
+    public void generateBodyFromParams_withParamsMap_withMoPubUrl_shouldGenerateJsonString() {
+        final String result = MoPubRequestUtils.generateBodyFromParams(params,
+                "https://ads.mopub.com/m/ad");
+
+        assertThat(result).contains("\"query1\":\"value1\"");
+        assertThat(result).contains("\"query2\":\"value2,value3,value4\"");
+        assertThat(result).contains("\"query3\":\"\"");
+        // Values have already been decoded and should not be decoded again.
+        assertThat(result).contains("\"query4\":\"value5%20value6\"");
+        assertThat(result.length()).isEqualTo(90);
+    }
+
+    @Test
+    public void generateBodyFromParams_withParamsMap_withNotMoPubUrl_shouldReturnNull() {
+        final String result = MoPubRequestUtils.generateBodyFromParams(params,
+                "https://not.mopub.com");
+
+        assertThat(result).isNull();
+    }
+}
diff --git a/mopub-sdk/src/test/java/com/mopub/network/PlayServicesUrlRewriterTest.java b/mopub-sdk/src/test/java/com/mopub/network/PlayServicesUrlRewriterTest.java
index 042df01a..0bc13acf 100644
--- a/mopub-sdk/src/test/java/com/mopub/network/PlayServicesUrlRewriterTest.java
+++ b/mopub-sdk/src/test/java/com/mopub/network/PlayServicesUrlRewriterTest.java
@@ -2,66 +2,77 @@
 
 import android.app.Activity;
 import android.content.Context;
+import android.net.Uri;
 
+import com.mopub.common.ClientMetadata;
 import com.mopub.common.GpsHelper;
-import com.mopub.common.GpsHelperTest;
+import com.mopub.common.MoPub;
+import com.mopub.common.privacy.AdvertisingId;
+import com.mopub.common.privacy.MoPubIdentifier;
+import com.mopub.common.privacy.MoPubIdentifierTest;
+import com.mopub.common.privacy.PersonalInfoManager;
 import com.mopub.common.test.support.SdkTestRunner;
 import com.mopub.common.util.Reflection;
-import com.mopub.common.util.test.support.TestMethodBuilderFactory;
 import com.mopub.mobileads.BuildConfig;
 
+import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.Mock;
 import org.robolectric.Robolectric;
 import org.robolectric.annotation.Config;
 
 import static org.fest.assertions.api.Assertions.assertThat;
 import static org.mockito.Matchers.any;
-import static org.mockito.Mockito.reset;
+import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.when;
 
 @RunWith(SdkTestRunner.class)
 @Config(constants = BuildConfig.class)
 public class PlayServicesUrlRewriterTest {
 
-    private Reflection.MethodBuilder methodBuilder;
+    @Mock
+    private ClientMetadata mockClientMetadata;
+    private PersonalInfoManager mockPersonalInfoManager;
+
+    private Context context;
     private PlayServicesUrlRewriter subject;
 
     @Before
     public void setUp() throws Exception {
-        Context context = Robolectric.buildActivity(Activity.class).create().get();
+        context = Robolectric.buildActivity(Activity.class).create().get();
+        MoPubIdentifierTest.writeAdvertisingInfoToSharedPreferences(context, false);
+        mockPersonalInfoManager = mock(PersonalInfoManager.class);
+        new Reflection.MethodBuilder(null, "setPersonalInfoManager")
+                .setStatic(MoPub.class)
+                .setAccessible()
+                .addParam(PersonalInfoManager.class, mockPersonalInfoManager)
+                .execute();
+
+        ClientMetadata.getInstance(context);
         GpsHelper.setClassNamesForTesting();
-        methodBuilder = TestMethodBuilderFactory.getSingletonMock();
-        reset(methodBuilder);
-        subject = new PlayServicesUrlRewriter("sha:testDeviceID", context);
+        subject = new PlayServicesUrlRewriter();
     }
 
-    @Test
-    public void rewriteUrl_whenPlayServicesPresent_shouldUsePlayServicesValue() throws Exception {
-        GpsHelperTest.TestAdInfo adInfo = new GpsHelperTest.TestAdInfo();
-        when(methodBuilder.setStatic(any(Class.class))).thenReturn(methodBuilder);
-        when(methodBuilder.addParam(any(Class.class), any())).thenReturn(methodBuilder);
-        when(methodBuilder.execute()).thenReturn(
-                GpsHelper.GOOGLE_PLAY_SUCCESS_CODE,
-                adInfo,
-                adInfo.ADVERTISING_ID,
-                adInfo.LIMIT_AD_TRACKING_ENABLED
-        );
-
-        assertThat(subject.rewriteUrl("https://ads.mopub.com/m/ad?ad_id=abcece&udid=mp_tmpl_advertising_id&dnt=mp_tmpl_do_not_track"))
-                .isEqualToIgnoringCase("https://ads.mopub.com/m/ad?ad_id=abcece&udid=ifa%3A38400000-8cf0-11bd-b23e-10b96e40000d&dnt=1");
+    @After
+    public void tearDown(){
+        ClientMetadata.clearForTesting();
+        MoPubIdentifierTest.clearPreferences(context);
     }
 
     @Test
-    public void rewriteUrl_whenPlayServicesNotPresent_shouldUseDeviceValue() throws Exception {
-        when(methodBuilder.setStatic(any(Class.class))).thenReturn(methodBuilder);
-        when(methodBuilder.addParam(any(Class.class), any())).thenReturn(methodBuilder);
-        // return error code so it fails
-        when(methodBuilder.execute()).thenReturn(GpsHelper.GOOGLE_PLAY_SUCCESS_CODE + 1);
+    public void rewriteUrl_shouldUseAdvertisingIdValue(){
+        when(mockClientMetadata.getMoPubIdentifier()).thenReturn(new MoPubIdentifier(context));
+        when(mockPersonalInfoManager.canCollectPersonalInformation()).thenReturn(true);
+
+        MoPubIdentifier identifier = ClientMetadata.getInstance().getMoPubIdentifier();
+        AdvertisingId adId = identifier.getAdvertisingInfo();
+        String encodedId = Uri.encode(adId.getIdWithPrefix(true));
+        String actualUrl = subject.rewriteUrl("https://ads.mopub.com/m/ad?ad_id=abcece&udid=mp_tmpl_advertising_id&dnt=mp_tmpl_do_not_track");
 
-        assertThat(subject.rewriteUrl("https://ads.mopub.com/m/ad?ad_id=abcece&udid=mp_tmpl_advertising_id&dnt=mp_tmpl_do_not_track"))
-                .isEqualToIgnoringCase("https://ads.mopub.com/m/ad?ad_id=abcece&udid=sha%3AtestDeviceId&dnt=0");
+        assertThat(actualUrl)
+                .isEqualToIgnoringCase("https://ads.mopub.com/m/ad?ad_id=abcece&udid="+encodedId+"&dnt=0");
     }
 
     @Test
diff --git a/mopub-sdk/src/test/java/com/mopub/network/RequestManagerTest.java b/mopub-sdk/src/test/java/com/mopub/network/RequestManagerTest.java
deleted file mode 100644
index a9a52e2c..00000000
--- a/mopub-sdk/src/test/java/com/mopub/network/RequestManagerTest.java
+++ /dev/null
@@ -1,141 +0,0 @@
-package com.mopub.network;
-
-import android.os.Looper;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-import com.mopub.volley.Request;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.robolectric.annotation.Config;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Matchers.any;
-import static org.mockito.Matchers.anyInt;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.never;
-import static org.mockito.Mockito.reset;
-import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class RequestManagerTest {
-
-    private ScribeRequestManager subject;
-    @Mock private ScribeRequest.ScribeRequestFactory mockScribeRequestFactory;
-    @Mock private ScribeBackoffPolicy mockScribeBackoffPolicy;
-    @Mock private ScribeRequest mockScribeRequest;
-    @Mock private MoPubRequestQueue mockRequestQueue;
-
-    @Before
-    public void setUp() {
-        Networking.setRequestQueueForTesting(mockRequestQueue);
-
-        subject = new ScribeRequestManager(Looper.getMainLooper());
-        when(mockScribeRequestFactory.createRequest(subject)).thenReturn(mockScribeRequest);
-    }
-
-    @Test
-    public void makeRequest_shouldAddRequestToQueue() throws Exception {
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-
-        verify(mockRequestQueue).add(mockScribeRequest);
-    }
-
-
-    @Test
-    public void makeRequest_shouldCancelTheCurrentRequest() throws Exception {
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-        Request<?> request = subject.getCurrentRequest();
-
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-
-        verify(mockRequestQueue).cancel(request);
-    }
-
-    @Test
-    public void cancelRequest_shouldCancelRequestInQueue_shouldClearRequest() throws Exception {
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-        subject.cancelRequest();
-
-        verify(mockRequestQueue).cancel(mockScribeRequest);
-        assertThat(subject.getCurrentRequest()).isNull();
-    }
-
-    @Test
-    public void cancelRequest_withNullRequestQueue_shouldOnlyClearCurrentRequest() throws Exception {
-        Networking.setRequestQueueForTesting(null);
-
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-        subject.cancelRequest();
-
-        verify(mockRequestQueue, never()).cancel(mockScribeRequest);
-        assertThat(subject.getCurrentRequest()).isNull();
-    }
-
-    @Test
-    public void cancelRequest_withNullCurrentRequest_shouldOnlyClearCurrentRequest() throws Exception {
-        subject.cancelRequest();
-
-        verify(mockRequestQueue, never()).cancel(mockScribeRequest);
-        assertThat(subject.getCurrentRequest()).isNull();
-    }
-
-    @Test
-    public void makeRequestInternal_shouldAddNewRequestToQueue() throws Exception {
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-        reset(mockRequestQueue);
-
-        ScribeRequest previousRequest = (ScribeRequest) subject.getCurrentRequest();
-        ScribeRequest nextRequest = mock(ScribeRequest.class);
-        when(mockScribeRequestFactory.createRequest(subject)).thenReturn(nextRequest);
-
-        subject.makeRequestInternal();
-
-        verify(mockRequestQueue).add(nextRequest);
-        verify(mockRequestQueue, never()).addDelayedRequest(any(Request.class), anyInt());
-        assertThat(previousRequest).isNotEqualTo(nextRequest);
-    }
-
-    @Test
-    public void makeRequestInternal_withRetryCountGreaterThan0_shouldAddNewDelayedRequestToQueue() throws Exception {
-        when(mockScribeBackoffPolicy.getRetryCount()).thenReturn(1);
-        when(mockScribeBackoffPolicy.getBackoffMs()).thenReturn(100);
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-        reset(mockRequestQueue);
-
-        ScribeRequest previousRequest = (ScribeRequest) subject.getCurrentRequest();
-        ScribeRequest nextRequest = mock(ScribeRequest.class);
-        when(mockScribeRequestFactory.createRequest(subject)).thenReturn(nextRequest);
-
-        subject.makeRequestInternal();
-
-        verify(mockRequestQueue).addDelayedRequest(nextRequest, 100);
-        verify(mockRequestQueue, never()).add(any(Request.class));
-        assertThat(previousRequest).isNotEqualTo(nextRequest);
-    }
-
-    @Test
-    public void makeRequestInternal_withNullRequestQueue_shouldClearCurrentRequest_shouldNotAddRequestToQueue() throws Exception {
-        Networking.setRequestQueueForTesting(null);
-
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-
-        verify(mockRequestQueue, never()).add(any(Request.class));
-        verify(mockRequestQueue, never()).addDelayedRequest(any(Request.class), anyInt());
-        assertThat(subject.getCurrentRequest()).isNull();
-    }
-
-    @Test
-    public void clearRequest_shouldSetCurrentRequestToNull() throws Exception {
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-        assertThat(subject.getCurrentRequest()).isNotNull();
-        subject.clearRequest();
-        assertThat(subject.getCurrentRequest()).isNull();
-    }
-}
-
diff --git a/mopub-sdk/src/test/java/com/mopub/network/ScribeBackoffPolicyTest.java b/mopub-sdk/src/test/java/com/mopub/network/ScribeBackoffPolicyTest.java
deleted file mode 100644
index 794121a1..00000000
--- a/mopub-sdk/src/test/java/com/mopub/network/ScribeBackoffPolicyTest.java
+++ /dev/null
@@ -1,132 +0,0 @@
-package com.mopub.network;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-import com.mopub.volley.NetworkResponse;
-import com.mopub.volley.NoConnectionError;
-import com.mopub.volley.VolleyError;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.robolectric.annotation.Config;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.fest.assertions.api.Assertions.fail;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class ScribeBackoffPolicyTest {
-
-    private ScribeBackoffPolicy subject;
-
-    @Before
-    public void setUp() {
-        subject = new ScribeBackoffPolicy();
-    }
-
-    @Test
-    public void backoff_with503Error_shouldUpdateBackoffTime() throws Exception {
-        NetworkResponse networkResponse = new NetworkResponse(503, null, null, false);
-        VolleyError volleyError = new VolleyError(networkResponse);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(0);
-        assertThat(subject.getRetryCount()).isEqualTo(0);
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(60000);
-        assertThat(subject.getRetryCount()).isEqualTo(1);
-    }
-
-    @Test
-    public void backoff_with504Error_shouldUpdateBackoffTime() throws Exception {
-        NetworkResponse networkResponse = new NetworkResponse(504, null, null, false);
-        VolleyError volleyError = new VolleyError(networkResponse);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(0);
-        assertThat(subject.getRetryCount()).isEqualTo(0);
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(60000);
-        assertThat(subject.getRetryCount()).isEqualTo(1);
-    }
-
-    @Test
-    public void backoff_withNoConnectionError_shouldUpdateBackoffTime() throws Exception {
-        VolleyError volleyError = new NoConnectionError();
-
-        assertThat(subject.getBackoffMs()).isEqualTo(0);
-        assertThat(subject.getRetryCount()).isEqualTo(0);
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(60000);
-        assertThat(subject.getRetryCount()).isEqualTo(1);
-    }
-
-    @Test(expected = VolleyError.class)
-    public void backoff_withOtherErrorType_shouldRethrowException() throws Exception {
-        NetworkResponse networkResponse = new NetworkResponse(500, null, null, false);
-        VolleyError volleyError = new VolleyError(networkResponse);
-
-        subject.backoff(volleyError);
-    }
-
-    @Test
-    public void backoff_shouldUpdateBackoffTime5TimesMax() throws Exception {
-        VolleyError volleyError = new NoConnectionError();
-
-        assertThat(subject.getBackoffMs()).isEqualTo(0);
-        assertThat(subject.getRetryCount()).isEqualTo(0);
-        assertThat(subject.hasAttemptRemaining()).isTrue();
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(60000);
-        assertThat(subject.getRetryCount()).isEqualTo(1);
-        assertThat(subject.hasAttemptRemaining()).isTrue();
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(120000);
-        assertThat(subject.getRetryCount()).isEqualTo(2);
-        assertThat(subject.hasAttemptRemaining()).isTrue();
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(240000);
-        assertThat(subject.getRetryCount()).isEqualTo(3);
-        assertThat(subject.hasAttemptRemaining()).isTrue();
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(480000);
-        assertThat(subject.getRetryCount()).isEqualTo(4);
-        assertThat(subject.hasAttemptRemaining()).isTrue();
-
-        subject.backoff(volleyError);
-
-        assertThat(subject.getBackoffMs()).isEqualTo(960000);
-        assertThat(subject.getRetryCount()).isEqualTo(5);
-        assertThat(subject.hasAttemptRemaining()).isFalse();
-    }
-
-    @Test(expected = NoConnectionError.class)
-    public void backoff_withNoAttemptsRemaining_shouldRethrowVolleyException() throws Exception {
-        VolleyError volleyError = new NoConnectionError();
-
-        try {
-            subject.backoff(volleyError);
-            subject.backoff(volleyError);
-            subject.backoff(volleyError);
-            subject.backoff(volleyError);
-            subject.backoff(volleyError);
-        } catch (Exception e) {
-            fail("Exception should not be thrown from above backoffs.");
-        }
-
-        subject.backoff(volleyError);
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/network/ScribeRequestManagerTest.java b/mopub-sdk/src/test/java/com/mopub/network/ScribeRequestManagerTest.java
deleted file mode 100644
index 7fc1b530..00000000
--- a/mopub-sdk/src/test/java/com/mopub/network/ScribeRequestManagerTest.java
+++ /dev/null
@@ -1,80 +0,0 @@
-package com.mopub.network;
-
-import android.os.Looper;
-
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-import com.mopub.volley.NoConnectionError;
-import com.mopub.volley.Request;
-import com.mopub.volley.VolleyError;
-
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.robolectric.annotation.Config;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.doThrow;
-import static org.mockito.Mockito.never;
-import static org.mockito.Mockito.reset;
-import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class ScribeRequestManagerTest {
-
-    private ScribeRequestManager subject;
-    @Mock private ScribeRequest.ScribeRequestFactory mockScribeRequestFactory;
-    @Mock private ScribeBackoffPolicy mockScribeBackoffPolicy;
-    @Mock private ScribeRequest mockScribeRequest;
-    @Mock private MoPubRequestQueue mockRequestQueue;
-
-    @Before
-    public void setUp() {
-        Networking.setRequestQueueForTesting(mockRequestQueue);
-
-        subject = new ScribeRequestManager(Looper.getMainLooper());
-        when(mockScribeRequestFactory.createRequest(subject)).thenReturn(mockScribeRequest);
-        subject.makeRequest(mockScribeRequestFactory, mockScribeBackoffPolicy);
-    }
-
-    @Test
-    public void createRequest_shouldCreateNewScribeRequest() throws Exception {
-        Request request = subject.createRequest();
-        assertThat(request).isEqualTo(mockScribeRequest);
-    }
-
-    @Test
-    public void onResponse_shouldClearRequest() throws Exception {
-        subject.onResponse();
-        assertThat(subject.getCurrentRequest()).isNull();
-    }
-
-    @Test
-    public void onErrorResponse_withBackoffApplied_shouldCallBackoff_shouldMakeDelayedRequest() throws Exception {
-        when(mockScribeBackoffPolicy.getRetryCount()).thenReturn(1);
-        when(mockScribeBackoffPolicy.getBackoffMs()).thenReturn(100);
-
-        VolleyError volleyError = new NoConnectionError();
-        subject.onErrorResponse(volleyError);
-
-        verify(mockScribeBackoffPolicy).backoff(volleyError);
-        verify(mockRequestQueue).addDelayedRequest(mockScribeRequest, 100);
-    }
-
-    @Test
-    public void onErrorResponse_withBackoffNotApplied_shouldClearRequest() throws Exception {
-        reset(mockRequestQueue);
-
-        VolleyError volleyError = new NoConnectionError();
-        doThrow(new VolleyError()).when(mockScribeBackoffPolicy).backoff(volleyError);
-
-        subject.onErrorResponse(volleyError);
-
-        verify(mockScribeBackoffPolicy).backoff(volleyError);
-        verify(mockRequestQueue, never()).add(mockScribeRequest);
-        assertThat(subject.getCurrentRequest()).isNull();
-    }
-}
diff --git a/mopub-sdk/src/test/java/com/mopub/network/ScribeRequestTest.java b/mopub-sdk/src/test/java/com/mopub/network/ScribeRequestTest.java
deleted file mode 100644
index 3af7d466..00000000
--- a/mopub-sdk/src/test/java/com/mopub/network/ScribeRequestTest.java
+++ /dev/null
@@ -1,86 +0,0 @@
-package com.mopub.network;
-
-import android.app.Activity;
-
-import com.mopub.common.event.BaseEvent;
-import com.mopub.common.event.EventSerializer;
-import com.mopub.common.test.support.SdkTestRunner;
-import com.mopub.mobileads.BuildConfig;
-import com.mopub.volley.DefaultRetryPolicy;
-import com.mopub.volley.NetworkResponse;
-import com.mopub.volley.Response;
-
-import org.json.JSONArray;
-import org.junit.Before;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.mockito.Mock;
-import org.robolectric.Robolectric;
-import org.robolectric.annotation.Config;
-
-import java.nio.charset.Charset;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-
-import static org.fest.assertions.api.Assertions.assertThat;
-import static org.mockito.Mockito.mock;
-import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
-
-@RunWith(SdkTestRunner.class)
-@Config(constants = BuildConfig.class)
-public class ScribeRequestTest {
-
-    private ScribeRequest subject;
-    @Mock private List<BaseEvent> mockEvents;
-    @Mock private EventSerializer mockEventSerializer;
-    @Mock private ScribeRequest.Listener mockListener;
-
-    @Before
-    public void setUp() {
-        Activity activity = Robolectric.buildActivity(Activity.class).create().get();
-        Networking.getRequestQueue(activity);
-
-        subject = new ScribeRequest("url", mockEvents, mockEventSerializer, mockListener);
-    }
-
-    @Test
-    public void constructor_shouldSetShouldCacheToFalse() throws Exception {
-        assertThat(subject.shouldCache()).isFalse();
-    }
-
-    @Test
-    public void constructor_shouldSetRetryPolicyToDefaultRetryPolicy() throws Exception {
-        assertThat(subject.getRetryPolicy()).isExactlyInstanceOf(DefaultRetryPolicy.class);
-    }
-
-    @Test
-    public void getParams_returnJsonSerializedEventsInMap() throws Exception {
-        JSONArray mockJsonArray = mock(JSONArray.class);
-        when(mockJsonArray.toString()).thenReturn("jsonArrayToString");
-        when(mockEventSerializer.serializeAsJson(mockEvents)).thenReturn(mockJsonArray);
-
-        Map<String, String> params = subject.getParams();
-
-        verify(mockEventSerializer).serializeAsJson(mockEvents);
-        assertThat(params.keySet().size()).isEqualTo(1);
-        assertThat(params.get("log")).isEqualTo("jsonArrayToString");
-    }
-    
-    @Test
-    public void parseNetworkResponse_shouldReturnSuccessResponse() throws Exception {
-        NetworkResponse networkResponse = new NetworkResponse(200, "abc".getBytes(Charset.defaultCharset()), new HashMap<String, String>(), false);
-
-        Response<Void> response = subject.parseNetworkResponse(networkResponse);
-
-        assertThat(response.isSuccess()).isTrue();
-    }
-
-    @Test
-    public void deliverResponse_shouldNotifyListener() throws Exception {
-        subject.deliverResponse(null);
-
-        verify(mockListener).onResponse();
-    }
-}
diff --git a/mopub-sdk/src/test/resources/robolectric.properties b/mopub-sdk/src/test/resources/com/mopub/robolectric.properties
similarity index 82%
rename from mopub-sdk/src/test/resources/robolectric.properties
rename to mopub-sdk/src/test/resources/com/mopub/robolectric.properties
index f339de43..d6c29dbf 100644
--- a/mopub-sdk/src/test/resources/robolectric.properties
+++ b/mopub-sdk/src/test/resources/com/mopub/robolectric.properties
@@ -1,3 +1,2 @@
-sdk=21
+sdk=26
 shadows=com.mopub.nativeads.test.support.MoPubShadowDisplay,com.mopub.nativeads.test.support.MoPubShadowBitmap,com.mopub.mobileads.test.support.ShadowVastVideoView,com.mopub.common.util.test.support.ShadowReflection
-manifest=src/main/AndroidManifest.xml
diff --git a/pom.xml b/pom.xml
deleted file mode 100644
index be233e50..00000000
--- a/pom.xml
+++ /dev/null
@@ -1,42 +0,0 @@
-<project xmlns="http://maven.apache.org/POM/4.0.0"
-         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
-                      http://maven.apache.org/xsd/maven-4.0.0.xsd">
-    <modelVersion>4.0.0</modelVersion>
-
-    <parent>
-        <groupId>org.sonatype.oss</groupId>
-        <artifactId>oss-parent</artifactId>
-        <version>5</version>
-    </parent>
-
-    <groupId>com.mopub.mobileads</groupId>
-    <artifactId>mopub-android</artifactId>
-    <version>1.0</version>
-    <packaging>pom</packaging>
-
-    <repositories>
-        <repository>
-            <id>jcenter</id>
-            <name>JCenter</name>
-            <url>http://jcenter.bintray.com</url>
-        </repository>
-
-        <repository>
-            <id>andsupport</id>
-            <name>Android Support</name>
-            <url>file:///${env.ANDROID_HOME}/extras/android/m2repository</url>
-        </repository>
-
-        <repository>
-            <id>playservices</id>
-            <name>Android Play Services</name>
-            <url>file:///${env.ANDROID_HOME}/extras/google/m2repository</url>
-        </repository>
-    </repositories>
-
-    <modules>
-        <module>mopub-sdk</module>
-        <module>mopub-sample</module>
-    </modules>
-</project>
