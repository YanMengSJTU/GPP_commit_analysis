diff --git a/TMessagesProj/build.gradle b/TMessagesProj/build.gradle
index 786832dda..033788275 100644
--- a/TMessagesProj/build.gradle
+++ b/TMessagesProj/build.gradle
@@ -80,8 +80,8 @@ android {
     productFlavors {
         Moegram {
             applicationId "me.swineson.moegram.messenger"
-            versionCode 513
-            versionName "0.0.10"
+            versionCode 514
+            versionName "0.0.11"
         }
     }
 }
diff --git a/TMessagesProj/src/main/java/org/telegram/android/Emoji.java b/TMessagesProj/src/main/java/org/telegram/android/Emoji.java
index 6fd47f90c..332bdefaf 100644
--- a/TMessagesProj/src/main/java/org/telegram/android/Emoji.java
+++ b/TMessagesProj/src/main/java/org/telegram/android/Emoji.java
@@ -430,15 +430,20 @@ private static boolean isNextCharIsColor(CharSequence cs, int i) {
     public static CharSequence replaceEmoji(CharSequence cs, Paint.FontMetricsInt fontMetrics, int size) {
         SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences("mainconfig", Activity.MODE_PRIVATE);
         boolean use = preferences.getBoolean("use_system_emoji", false);
-        if (use == true || cs == null || cs.length() == 0) {
-            return cs;
-        }
         Spannable s;
         if (cs instanceof Spannable) {
             s = (Spannable)cs;
         } else {
             s = Spannable.Factory.getInstance().newSpannable(cs);
         }
+        try {
+            if (use == true || cs == null || cs.length() == 0) {
+                return s;
+            }
+        } catch (Exception e) {
+            FileLog.e("tmessages", e);
+            return cs;
+        }
         long buf = 0;
         int emojiCount = 0;
         try {
