diff --git a/TMessagesProj/build.gradle b/TMessagesProj/build.gradle
index 01706651a..d3f256f33 100644
--- a/TMessagesProj/build.gradle
+++ b/TMessagesProj/build.gradle
@@ -121,7 +121,7 @@ android {
         }
     }
 
-    defaultConfig.versionCode = 967
+    defaultConfig.versionCode = 968
 
     sourceSets.debug {
         manifest.srcFile 'config/debug/AndroidManifest.xml'
@@ -193,7 +193,7 @@ android {
     defaultConfig {
         minSdkVersion 14
         targetSdkVersion 25
-        versionName "4.6.3"
+        versionName "4.6.4"
         multiDexEnabled true
 
         externalNativeBuild {
diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/SecretChatHelper.java b/TMessagesProj/src/main/java/org/telegram/messenger/SecretChatHelper.java
index 6e5799ba8..00f884ff7 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/SecretChatHelper.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/SecretChatHelper.java
@@ -12,6 +12,7 @@
 import android.content.Context;
 import android.content.DialogInterface;
 
+import org.cloudveil.messenger.GlobalSecuritySettings;
 import org.telegram.SQLite.SQLiteCursor;
 import org.telegram.tgnet.AbstractSerializedData;
 import org.telegram.tgnet.ConnectionsManager;
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
index 3acc8d525..a3d319831 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
@@ -3703,6 +3703,22 @@ public void onClick(DialogInterface dialogInterface, int i) {
         }
         fixLayoutInternal();
 
+        //CloudVeil start
+        if(currentEncryptedChat != null) {
+            fragmentView.postDelayed(new Runnable() {
+                @Override
+                public void run() {
+                    int oldTtl = currentEncryptedChat.ttl;
+                    currentEncryptedChat.ttl = Math.max(currentEncryptedChat.ttl, GlobalSecuritySettings.getMinSecretChatTtl());
+                    if (oldTtl != currentEncryptedChat.ttl) {
+                        SecretChatHelper.getInstance().sendTTLMessage(currentEncryptedChat, null);
+                        MessagesStorage.getInstance().updateEncryptedChatTTL(currentEncryptedChat);
+                    }
+                }
+            }, 1000);
+        }
+        //CloudVeil end
+
         return fragmentView;
     }
 
