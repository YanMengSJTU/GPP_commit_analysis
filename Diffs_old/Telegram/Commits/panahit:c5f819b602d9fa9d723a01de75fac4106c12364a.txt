diff --git a/TMessagesProj/src/main/java/org/telegram/android/MessagesController.java b/TMessagesProj/src/main/java/org/telegram/android/MessagesController.java
index 8b9aa308e..0d55c4738 100644
--- a/TMessagesProj/src/main/java/org/telegram/android/MessagesController.java
+++ b/TMessagesProj/src/main/java/org/telegram/android/MessagesController.java
@@ -1535,10 +1535,6 @@ public void markDialogAsRead(final long dialog_id, final int max_id, final int m
             req.max_id = max_positive_id;
             req.offset = offset;
             if (offset == 0) {
-                HashMap<Long, Integer> dialogsToUpdate = new HashMap<Long, Integer>();
-                dialogsToUpdate.put(dialog_id, 0);
-                NotificationsController.getInstance().processDialogsUpdateRead(dialogsToUpdate, true);
-
                 NotificationsController.getInstance().processReadMessages(null, dialog_id, 0, max_id);
                 MessagesStorage.getInstance().processPendingRead(dialog_id, max_positive_id, max_date, false);
                 MessagesStorage.getInstance().storageQueue.postRunnable(new Runnable() {
@@ -1556,6 +1552,9 @@ public void run() {
                         });
                     }
                 });
+                HashMap<Long, Integer> dialogsToUpdate = new HashMap<Long, Integer>();
+                dialogsToUpdate.put(dialog_id, 0);
+                NotificationsController.getInstance().processDialogsUpdateRead(dialogsToUpdate, true);
             }
             if (req.max_id != Integer.MAX_VALUE) {
                 ConnectionsManager.getInstance().performRpc(req, new RPCRequest.RPCRequestDelegate() {
@@ -1624,10 +1623,6 @@ public void run(TLObject response, TLRPC.TL_error error) {
             }
             MessagesStorage.getInstance().processPendingRead(dialog_id, max_id, max_date, false);
 
-            HashMap<Long, Integer> dialogsToUpdate = new HashMap<Long, Integer>();
-            dialogsToUpdate.put(dialog_id, 0);
-            NotificationsController.getInstance().processDialogsUpdateRead(dialogsToUpdate, true);
-
             MessagesStorage.getInstance().storageQueue.postRunnable(new Runnable() {
                 @Override
                 public void run() {
@@ -1644,6 +1639,10 @@ public void run() {
                 }
             });
 
+            HashMap<Long, Integer> dialogsToUpdate = new HashMap<Long, Integer>();
+            dialogsToUpdate.put(dialog_id, 0);
+            NotificationsController.getInstance().processDialogsUpdateRead(dialogsToUpdate, true);
+
             if (chat.ttl > 0 && was) {
                 int serverTime = Math.max(ConnectionsManager.getInstance().getCurrentTime(), max_date);
                 MessagesStorage.getInstance().createTaskForDate(chat.id, serverTime, serverTime, 0);
