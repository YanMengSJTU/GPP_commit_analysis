diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
index 3bd74f8c0..5c1f5ba22 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
@@ -89,6 +89,7 @@
 import org.telegram.ui.Components.TypingDotsDrawable;
 
 import java.io.File;
+import java.io.IOException;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.HashMap;
@@ -3068,18 +3069,13 @@ private void processSelectedOption(int option) {
                 String ObjectPath = "";
                 String MimeType = "";
 
-                if (selectedObject.messageOwner.attachPath != null && selectedObject.messageOwner.attachPath.length() != 0) {
-                    ObjectPath = selectedObject.messageOwner.attachPath;
-                }
-
-                File f = new File(ObjectPath);
-                if (!f.exists() || f.length() == 0) {
-                    ObjectPath = AndroidUtilities.getCacheDir().toString() + File.separator + selectedObject.getFileName();
-                }
+                File ObjectFile = FileLoader.getPathToMessage(selectedObject.messageOwner);
 
-                if (ObjectPath == null) {
+                try {
+                    ObjectPath = ObjectFile.getCanonicalPath();
+                } catch (IOException e) {
                     // TODO: Error path not found!
-                    return;
+                    e.printStackTrace();
                 }
 
                 String fileExt = MimeTypeMap.getFileExtensionFromUrl(ObjectPath);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/SettingsUltraFeaturesActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/SettingsUltraFeaturesActivity.java
index c87b79c4d..a97b72da1 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/SettingsUltraFeaturesActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/SettingsUltraFeaturesActivity.java
@@ -19,14 +19,15 @@
 import android.widget.AdapterView;
 import android.widget.FrameLayout;
 import android.widget.ListView;
-import android.widget.TextView;
 import android.widget.SeekBar;
+import android.widget.TextView;
 
 import org.telegram.android.LocaleController;
+import org.telegram.messenger.ApplicationLoader;
 import org.telegram.messenger.R;
-import org.telegram.ui.Adapters.BaseFragmentAdapter;
 import org.telegram.ui.ActionBar.ActionBar;
 import org.telegram.ui.ActionBar.BaseFragment;
+import org.telegram.ui.Adapters.BaseFragmentAdapter;
 import org.telegram.ui.Cells.TextCheckCell;
 import org.telegram.ui.Cells.TextDetailSettingsCell;
 
