diff --git a/TMessagesProj/src/main/AndroidManifest.xml b/TMessagesProj/src/main/AndroidManifest.xml
index 326dc6241..616273aef 100644
--- a/TMessagesProj/src/main/AndroidManifest.xml
+++ b/TMessagesProj/src/main/AndroidManifest.xml
@@ -205,6 +205,7 @@
         <receiver android:name="org.telegram.ui.TelegramMessageWidget" >
             <intent-filter>
                 <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
+                <action android:name="org.telegram.android.DATA_FETCHED" />
             </intent-filter>
 
             <meta-data
diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java b/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java
index d73a110c5..b6b9bdd4b 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java
@@ -12,6 +12,8 @@
 import android.app.Activity;
 import android.app.AlarmManager;
 import android.app.PendingIntent;
+import android.appwidget.AppWidgetManager;
+import android.content.ComponentName;
 import android.content.ContentValues;
 import android.content.Context;
 import android.content.Intent;
@@ -39,6 +41,7 @@
 import org.telegram.tgnet.TLRPC;
 import org.telegram.ui.LaunchActivity;
 import org.telegram.ui.PopupNotificationActivity;
+import org.telegram.ui.TelegramMessageWidget;
 
 import java.util.ArrayList;
 import java.util.Calendar;
@@ -81,6 +84,13 @@
     private boolean soundInLoaded;
     private boolean soundOutLoaded;
     private AlarmManager alarmManager;
+    public WidgetUpdateDelegate widgetUpdateDelegate = null;
+    public Context context = null;
+    public int[] appWidgetIds = null;
+
+    public interface WidgetUpdateDelegate {
+        public void updateWidget(Context context, int[] appWidgetIds);
+    }
 
     public NotificationsController() {
         notificationManager = NotificationManagerCompat.from(ApplicationLoader.applicationContext);
@@ -138,6 +148,14 @@ public static NotificationsController getInstance() {
         return localInstance;
     }
 
+    public void setUpdateWidgetDelegate(Context context, WidgetUpdateDelegate widgetDelegate, int[] appWidgetIds) {
+        if (appWidgetIds != null) {
+            this.context = context;
+            this.widgetUpdateDelegate = widgetDelegate;
+            this.appWidgetIds = appWidgetIds;
+        }
+    }
+
     private static String getLauncherClassName(Context context) {
         try {
             PackageManager pm = context.getPackageManager();
@@ -421,6 +439,8 @@ public void processNewMessages(final ArrayList<MessageObject> messageObjects, fi
             return;
         }
 
+        updateMyWidget();
+
         final ArrayList<MessageObject> popupArray = new ArrayList<>(popupMessages);
         notificationsQueue.postRunnable(new Runnable() {
             @Override
@@ -1127,10 +1147,19 @@ public void run() {
 
     private void showOrUpdateNotification(boolean notifyAboutLast) {
         showOrUpdateNotification(notifyAboutLast, false, "Join", "Cancel");
-
+//        if (notifyAboutLast == true)
+//            updateMyWidget();
         //place to add update call to load new messages
     }
 
+    private void updateMyWidget() {
+        //AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(ApplicationLoader.applicationContext);
+        //ComponentName componentName = new ComponentName(ApplicationLoader.applicationContext, TelegramMessageWidget.class);
+        //appWidgetManager.updateAppWidget(componentName, );
+        if (widgetUpdateDelegate != null && appWidgetIds != null)
+            widgetUpdateDelegate.updateWidget(context, appWidgetIds);
+    }
+
     private void showOrUpdateNotification(boolean notifyAboutLast, boolean isButtonRequired, String leftBtnName, String rightBtnName) {
         if (!UserConfig.isClientActivated() || pushMessages.isEmpty()) {
             dismissNotification();
diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/WidgetServiceDataProvider.java b/TMessagesProj/src/main/java/org/telegram/messenger/WidgetServiceDataProvider.java
index b35cd787e..550c4a9a3 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/WidgetServiceDataProvider.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/WidgetServiceDataProvider.java
@@ -8,8 +8,10 @@
 import android.util.Log;
 import android.widget.RemoteViews;
 import android.widget.RemoteViewsService;
+import android.widget.Toast;
 
 import org.telegram.tgnet.TLRPC;
+import org.telegram.ui.LaunchActivity;
 
 import java.util.ArrayList;
 
@@ -58,13 +60,35 @@ public RemoteViews getViewAt(int position) {
         String packageName = context.getPackageName();
         RemoteViews remoteView = new RemoteViews(packageName, android.R.layout.two_line_list_item);
         TLRPC.Dialog currentDialog = getDialogs().get(position);
-        TLRPC.User user = MessagesController.getInstance().getUser((int)currentDialog.id);
-        String userName = UserObject.getUserName(user);
+        int lowerId = (int)currentDialog.id;
+        Intent intent = new Intent(ApplicationLoader.applicationContext, LaunchActivity.class);
+        intent.setAction("com.tmessages.openchat" + Math.random() + Integer.MAX_VALUE);
+        intent.setFlags(32768);
+
+        if (lowerId < 0) {
+            TLRPC.Chat chat = MessagesController.getInstance().getChat(-lowerId);
+            String chatName = chat.title;
+            remoteView.setTextViewText(android.R.id.text1, chatName);
+            MessageObject messageObject = MessagesController.getInstance().dialogMessage.get(-lowerId);
+            //int chat_id = messageObject.messageOwner.to_id.chat_id != 0 ? messageObject.messageOwner.to_id.chat_id : messageObject.messageOwner.to_id.channel_id;
+            intent.putExtra("chatId", chat.id);
+        } else {
+            TLRPC.User user = MessagesController.getInstance().getUser(lowerId);
+            String userName = UserObject.getUserName(user);
+            remoteView.setTextViewText(android.R.id.text1, userName);
+            int user_id = user.id;
+            intent.putExtra("chatId", user_id);
+        }
 
         String message = MessagesController.getInstance().dialogMessage.get(currentDialog.id).messageText.toString();
 
-        remoteView.setTextViewText(android.R.id.text1, userName);
+
         remoteView.setTextViewText(android.R.id.text2, message);
+        //Toast.makeText(context, "why the hell this is not getting called"+position, Toast.LENGTH_SHORT).show();
+        Log.d("WidgetUpdate", "times this is called " + position);
+
+        remoteView.setOnClickFillInIntent(android.R.id.text2, intent);
+
         return remoteView;
     }
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java b/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java
index df9a641ff..808d38a97 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java
@@ -8,23 +8,35 @@
 import android.net.Uri;
 import android.widget.RemoteViews;
 
+import org.telegram.messenger.NotificationsController;
 import org.telegram.messenger.R;
 import org.telegram.messenger.WidgetService;
 
 /**
  * Implementation of App Widget functionality.
  */
-public class TelegramMessageWidget extends AppWidgetProvider {
+public class TelegramMessageWidget extends AppWidgetProvider implements NotificationsController.WidgetUpdateDelegate {
+
 
     @Override
     public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {
         // There may be multiple widgets active, so update all of them
+        if (NotificationsController.getInstance().widgetUpdateDelegate == null) {
+            NotificationsController.getInstance().setUpdateWidgetDelegate(context,this, appWidgetIds);
+        }
         final int N = appWidgetIds.length;
         for (int i = 0; i < N; i++) {
             updateAppWidget(context, appWidgetManager, appWidgetIds[i]);
         }
     }
 
+//    @Override
+//    public void onReceive(Context context, Intent intent) {
+//        //super.onReceive(context, intent);
+//        int[] ids = intent.getExtras().getIntArray("appWidgetIds");
+//        if (ids != null)
+//            this.onUpdate(context, AppWidgetManager.getInstance(context), ids);
+//    }
 
     @Override
     public void onEnabled(Context context) {
@@ -52,5 +64,10 @@ static void updateAppWidget(Context context, AppWidgetManager appWidgetManager,
         // Instruct the widget manager to update the widget
         appWidgetManager.updateAppWidget(appWidgetId, views);
     }
+
+    @Override
+    public void updateWidget(Context context, int[] appWidgetIds) {
+        this.onUpdate(context, AppWidgetManager.getInstance(context), appWidgetIds);
+    }
 }
 
diff --git a/TMessagesProj/src/main/res/xml/telegram_message_widget_info.xml b/TMessagesProj/src/main/res/xml/telegram_message_widget_info.xml
index cf471433c..b1293b0f2 100644
--- a/TMessagesProj/src/main/res/xml/telegram_message_widget_info.xml
+++ b/TMessagesProj/src/main/res/xml/telegram_message_widget_info.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
-    android:minWidth="250dp" android:minHeight="110dp" android:updatePeriodMillis="86400000"
+    android:minWidth="250dp" android:minHeight="250dp" android:updatePeriodMillis="0"
     android:previewImage="@drawable/example_appwidget_preview"
     android:initialLayout="@layout/telegram_message_widget" android:resizeMode="horizontal|vertical"
     android:widgetCategory="home_screen"
