diff --git a/.gitignore b/.gitignore
index 1af9983d3..9a07be684 100644
--- a/.gitignore
+++ b/.gitignore
@@ -12,3 +12,8 @@ TMessagesProj/src/main/java/org/telegram/messenger/BuildVars.java
 aniways/
 TMessagesProj/TMessagesProj-release.apk
 TMessagesProj/manifest-merger-release-report.txt
+
+TMessagesProj/mapping.txt
+TMessagesProj/proguard-rules.txt
+TMessagesProj/seeds.txt
+TMessagesProj/unused.txt
diff --git a/TMessagesProj/build.gradle b/TMessagesProj/build.gradle
index ccdafa8b5..2fc34fc5c 100644
--- a/TMessagesProj/build.gradle
+++ b/TMessagesProj/build.gradle
@@ -33,7 +33,6 @@ dependencies {
     compile 'net.hockeyapp.android:HockeySDK:3.5.+'
     compile 'com.googlecode.mp4parser:isoparser:1.0.+'
     compile project(':Android-SDK')
-    compile 'com.android.support:multidex:1.0.0'
     compile ('io.intercom.android:intercom-sdk:0.9.3@aar') {
         transitive = true
     }
@@ -100,12 +99,18 @@ android {
             debuggable true
             jniDebuggable true
             signingConfig signingConfigs.debug
+            minifyEnabled true
+            shrinkResources true
+            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
         }
 
         release {
             debuggable false
             jniDebuggable false
             signingConfig signingConfigs.release
+            minifyEnabled true
+            shrinkResources true
+            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
         }
 
         foss {
@@ -141,8 +146,4 @@ android {
         versionName "1.7.9"
         multiDexEnabled true
     }
-
-    dexOptions {
-        javaMaxHeapSize "4g"
-    }
 }
diff --git a/TMessagesProj/proguard-rules.txt b/TMessagesProj/proguard-rules.txt
index 16a52b481..51f4944f1 100644
--- a/TMessagesProj/proguard-rules.txt
+++ b/TMessagesProj/proguard-rules.txt
@@ -25,47 +25,31 @@
 #-dontwarn com.google.analytics.tracking.**
 
 
--keep class org.telegram.SQLite** { *; }
--keep class android.** { *; }
--keep class android.app.** { *; }
--keep class com.google.android.apps** { *; }
+-keep class org.telegram.** { *; }
+-keep class com.aniways.** { *; }
 
+-keep class android.support.v4.** { *; }
+-keep interface android.support.v4.** { *; }
 
-##---------------Begin: proguard configuration for Google play serivces ----------
--keep class * extends java.util.ListResourceBundle {
-    protected Object[][] getContents();
-}
+-keep class !android.support.v7.internal.view.menu.**,android.support.** {*;}  # <-- important
 
--keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
-    public static final *** NULL;
-}
+# --------Start--------Hockey SDK-------------->
+-keep public class javax.net.ssl.**
+-keepclassmembers public class javax.net.ssl.** { *; }
 
--keepnames @com.google.android.gms.common.annotation.KeepName class *
--keepclassmembernames class * {
-    @com.google.android.gms.common.annotation.KeepName *;
-}
+-keep public class org.apache.http.**
+-keepclassmembers public class org.apache.http.** { *; }
 
--keepnames class * implements android.os.Parcelable {
-    public static final ** CREATOR;
-}
-##---------------End: proguard configuration for Google play serivces ----------
+-keepclassmembers class net.hockeyapp.android.UpdateFragment { *; }
 
-##---------------Begin: proguard configuration for Gson ----------
-# Gson uses generic type information stored in a class file when working with
-#fields. Proguard removes such information by default, so configure it to keep
-#all of it.
--keepattributes Signature
+-renamesourcefileattribute SourceFile
+-keepattributes SourceFile,LineNumberTable
+# --------End--------Hockey SDK-------------->
 
-# For using GSON @Expose annotation
--keepattributes *Annotation*
 
-# Gson specific classes
--keep class sun.misc.Unsafe { *; }
-#-keep class com.google.gson.stream.** { *; }
+-dontwarn javax.imageio.**
+-dontwarn java.awt.**
 
-# Application classes that will be serialized/deserialized over Gson
--keep class com.aniways.data.KeywordsFile** { *; }
--keep class com.aniways.data.AniwaysPrivateConfig** { *; }
-
-
-##---------------End: proguard configuration for Gson ----------
+-printseeds seeds.txt
+-printusage unused.txt
+-printmapping mapping.txt
\ No newline at end of file
diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java b/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java
index b60a807c6..e9e558ffc 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java
@@ -246,12 +246,6 @@ public void onConfigurationChanged(Configuration newConfig) {
         }
     }
 
-    @Override
-    protected void attachBaseContext(Context base) {
-        super.attachBaseContext(base);
-        MultiDex.install(this);
-    }
-
     private void initPlayServices() {
         if (checkPlayServices()) {
             gcm = GoogleCloudMessaging.getInstance(this);
