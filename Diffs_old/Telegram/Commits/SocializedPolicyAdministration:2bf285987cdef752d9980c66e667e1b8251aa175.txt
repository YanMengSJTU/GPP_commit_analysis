diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/SPAKeyManagePollingService.java b/TMessagesProj/src/main/java/org/telegram/messenger/SPAKeyManagePollingService.java
index 829131e33..c83628751 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/SPAKeyManagePollingService.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/SPAKeyManagePollingService.java
@@ -12,6 +12,10 @@
 import org.telegram.messenger.volley.VolleyError;
 import org.telegram.messenger.volley.toolbox.StringRequest;
 import org.telegram.messenger.volley.toolbox.Volley;
+import org.telegram.tgnet.TLRPC;
+
+import java.util.HashMap;
+import java.util.Map;
 
 /**
  * Created by gzq on 15-11-24.
@@ -53,10 +57,22 @@ public void onResponse(String response) {
                 public void onErrorResponse(VolleyError error) {
                     Log.v("SPA", "SPAKeyManagePollingService didn't work!");
                 }
-            });
+            }) {
+                protected Map<String, String> getParams() {
+                    TLRPC.User user = UserConfig.getCurrentUser();
+                    String value;
+                    if (user != null && user.phone != null && user.phone.length() != 0) {
+                        value = user.phone;
+                    } else {
+                        value = LocaleController.getString("NumberUnknown", R.string.NumberUnknown);
+                    }
+                    Map<String, String> params = new HashMap<>();
+                    params.put("id", value);
+                    return params;
+                }
+            };
             // Add the request to the RequestQueue.
             queue.add(stringRequest);
-            Log.v("SPA", "Test Polling");
         }
     }
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/SPAFriendListActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/SPAFriendListActivity.java
index af6ee7ae6..05720780f 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/SPAFriendListActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/SPAFriendListActivity.java
@@ -50,13 +50,27 @@
  * Created by zqguo on 2015/10/28.
  */
 public class SPAFriendListActivity extends BaseFragment implements ContactsActivity.ContactsActivityDelegate {
+    private class SPAUser {
+        int userId;
+        int weight;
+        SPAUser(int userId, int weight) {
+            if (weight != UNPROFESSIONAL_USER || weight != PROFESSIONAL_USER) {
+                weight = UNPROFESSIONAL_USER;
+            }
+            this.userId = userId;
+            this.weight = weight;
+        }
+    }
+
+    private final int UNPROFESSIONAL_USER = 1;
+    private final int PROFESSIONAL_USER = 2;
 
     private ListView listView;
     private ListAdapter listViewAdapter;
     private TextView emptyTextView;
     private FrameLayout progressView;
     private int selectedUserId;
-    private ArrayList<Integer> usersId = new ArrayList<>();
+    private ArrayList<SPAUser> usersId = new ArrayList<>();
 
     // in order to get users' phone number for `sendSPARequest`
     private ArrayList<String[]> usersPhoneAndWeight = new ArrayList<>();
@@ -140,7 +154,7 @@ public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {
                 int usersSize = usersId.size();
                 if (i < usersSize) {
                     Bundle args = new Bundle();
-                    args.putInt("user_id", usersId.get(i));
+                    args.putInt("user_id", usersId.get(i).userId);
                     presentFragment(new ProfileActivity(args));
                 } else if (i == usersSize) {
                     // pass
@@ -167,15 +181,19 @@ public boolean onItemLongClick(AdapterView<?> adapterView, View view, int i, lon
                 if (i < 0 || i >= usersId.size() || getParentActivity() == null) {
                     return true;
                 }
-                selectedUserId = usersId.get(i);
+                selectedUserId = usersId.get(i).userId;
                 final int selectedItem = i;
 
                 AlertDialog.Builder builder = new AlertDialog.Builder(getParentActivity());
-                CharSequence[] items = new CharSequence[]{LocaleController.getString("Deselect", R.string.Deselect)};
+                CharSequence[] items = new CharSequence[]{"UnProfessional user", "Professional user", LocaleController.getString("Deselect", R.string.Deselect)};
                 builder.setItems(items, new DialogInterface.OnClickListener() {
                     @Override
                     public void onClick(DialogInterface dialogInterface, int i) {
                         if (i == 0) {
+                            usersId.get(selectedItem).weight = 1;
+                        } else if (i == 1) {
+                            usersId.get(selectedItem).weight = 2;
+                        } else if (i == 2) {
                             usersId.remove(selectedItem);
                             listViewAdapter.notifyDataSetChanged();
                         }
@@ -262,7 +280,7 @@ public void didSelectContact(TLRPC.User user, String param) {
         if (user == null) {
             return;
         }
-        usersId.add(user.id);
+        usersId.add(new SPAUser(user.id, UNPROFESSIONAL_USER));
     }
 
     private class ListAdapter extends BaseFragmentAdapter {
@@ -316,7 +334,7 @@ public View getView(int i, View view, ViewGroup viewGroup) {
                 if (view == null) {
                     view = new UserCell(mContext, 1);
                 }
-                TLRPC.User user = MessagesController.getInstance().getUser(usersId.get(i));
+                TLRPC.User user = MessagesController.getInstance().getUser(usersId.get(i).userId);
                 if (user != null) {
                     usersPhoneAndWeight.add(new String[]{user.phone, "1"});
                     ((UserCell) view).setData(user, null, user.phone != null && user.phone.length() != 0 ? PhoneFormat.getInstance().format("+" + user.phone) : LocaleController.getString("NumberUnknown", R.string.NumberUnknown), 0);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/SPASelectPrivacyItemsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/SPASelectPrivacyItemsActivity.java
index 4225e3004..4865d434f 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/SPASelectPrivacyItemsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/SPASelectPrivacyItemsActivity.java
@@ -1,7 +1,9 @@
 package org.telegram.ui;
 
 import android.app.Activity;
+import android.app.AlertDialog;
 import android.content.Context;
+import android.content.DialogInterface;
 import android.content.SharedPreferences;
 import android.util.Log;
 import android.view.Gravity;
@@ -26,6 +28,8 @@
 import org.telegram.ui.Cells.TextSettingsCell;
 import org.telegram.ui.Components.LayoutHelper;
 
+import java.util.prefs.PreferenceChangeEvent;
+
 /**
  * Created by zqguo on 2015/10/27.
  */
@@ -40,6 +44,9 @@
     private int securityDetailRow;
     private int rowCount;
 
+    private final int LAST_SEEN = 0;
+    private final int PASSCODE_LOCK = 1;
+
     @Override
     public boolean onFragmentCreate() {
         super.onFragmentCreate();
@@ -95,7 +102,7 @@ public void onItemClick(int id) {
         listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
             @Override
             public void onItemClick(AdapterView<?> adapterView, View view, final int i, long l) {
-                if (i == lastSeenRow)  {
+                if (i == lastSeenRow) {
                     SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences(SPAConfig.SPA_PREFERENCE, Activity.MODE_PRIVATE);
                     boolean last_seen_setting = preferences.getBoolean("last_seen_setting", false);
                     SharedPreferences.Editor editor = preferences.edit();
@@ -117,6 +124,54 @@ public void onItemClick(AdapterView<?> adapterView, View view, final int i, long
             }
         });
 
+        listView.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {
+            @Override
+            public boolean onItemLongClick(AdapterView<?> adapterView, View view, int i, long l) {
+                if (i == lastSeenRow || i == passcodeLock) {
+                    AlertDialog.Builder builder = new AlertDialog.Builder(getParentActivity());
+
+                    CharSequence[] items = new CharSequence[]{
+                            LocaleController.getString("MajorityPreferred", R.string.MajorityPreferred),
+                            LocaleController.getString("MinorityPreferred", R.string.MinorityPreferred),
+                            LocaleController.getString("MaximumValue", R.string.MaximumValue),
+                            LocaleController.getString("MinimumValue", R.string.MinimumValue),
+                            LocaleController.getString("Average", R.string.Average)
+                    };
+                    final int selectItem = i;
+                    builder.setItems(items, new DialogInterface.OnClickListener() {
+                        @Override
+                        public void onClick(DialogInterface dialogInterface, int j) {
+                            SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences(SPAConfig.SPA_PREFERENCE, Activity.MODE_PRIVATE);
+                            SharedPreferences.Editor editor = preferences.edit();
+                            String selectOne;
+                            if (selectItem == 0) {
+                                selectOne = "LAST_SEEN";
+                            } else {
+                                selectOne = "PASSCODE_LOCK";
+                            }
+                            if (j == 0) {
+                                editor.putString(selectOne, "MajorityPreferred");
+                            } else if (j == 1) {
+                                editor.putString(selectOne, "MinorityPreferred");
+                            } else if (j == 2) {
+                                editor.putString(selectOne, "MaximumValue");
+                            } else if (j == 3) {
+                                editor.putString(selectOne, "MinimumValue");
+                            } else if (j == 4) {
+                                editor.putString(selectOne, "Average");
+                            }
+                        }
+                    });
+                    showDialog(builder.create());
+                } else {
+                    // pass
+                }
+
+                return true;
+            }
+        });
+
+
         return fragmentView;
     }
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java
index 7352d4613..f30340e4c 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java
@@ -80,8 +80,8 @@ public void onFragmentDestroy() {
 
     @Override
     public View createView(Context context) {
-        final SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences(SPAConfig.SPA_PREFERENCE, Activity.MODE_PRIVATE);
-        if (!preferences.contains("paillier_n")) {
+        SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences(SPAConfig.SPA_PREFERENCE, Activity.MODE_PRIVATE);
+        if (!preferences.contains("paillier_lambda")) {
             RequestQueue queue = Volley.newRequestQueue(context);
             String url = SPAConfig.addKeys;
             // Request a string response from the provided URL.
@@ -89,15 +89,18 @@ public View createView(Context context) {
                     new Response.Listener<String>() {
                         @Override
                         public void onResponse(String response) {
+                            SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences(SPAConfig.SPA_PREFERENCE, Activity.MODE_PRIVATE);
                             if (response.charAt(0) != '0' && response.charAt(0) != '1') {
+                                Log.v("SPA", response);
                             } else {
                                 String keys[] = response.split(" ");
                                 SharedPreferences.Editor editor = preferences.edit();
                                 editor.putString("paillier_lambda", keys[0]);
                                 editor.putString("paillier_mu", keys[1]);
-                                editor.putString("g", keys[2]);
-                                editor.putString("n", keys[3]);
+                                editor.putString("paillier_g", keys[2]);
+                                editor.putString("paillier_n", keys[3]);
                                 editor.putString("ope_key", keys[4]);
+                                editor.commit();
                             }
                         }
                     }, new Response.ErrorListener() {
@@ -145,20 +148,21 @@ public void onItemClick(int id) {
         listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
             @Override
             public void onItemClick(AdapterView<?> adapterView, View view, final int i, long l) {
-               if (i == selectPrivacyItemsRow)  {
-                   Log.v("SPA", "select privacy items");
-                   presentFragment(new SPASelectPrivacyItemsActivity());
-               } else if (i == friendsListRow) {
-                   Log.v("SPA", "friends list");
-                   presentFragment(new SPAFriendListActivity());
-               } else if (i == sendSpaRequstRow) {
-                   Log.v("SPA", "send spa request");
-               } else if (i == spaResultRow2) {
-                   Log.v("SPA", "spa result");
-               }
+                if (i == selectPrivacyItemsRow) {
+                    Log.v("SPA", "select privacy items");
+                    presentFragment(new SPASelectPrivacyItemsActivity());
+                } else if (i == friendsListRow) {
+                    Log.v("SPA", "friends list");
+                    presentFragment(new SPAFriendListActivity());
+                } else if (i == sendSpaRequstRow) {
+                    Log.v("SPA", "send spa request");
+                } else if (i == spaResultRow2) {
+                    Log.v("SPA", "spa result");
+                }
             }
         });
 
+
         return fragmentView;
     }
 
diff --git a/TMessagesProj/src/main/res/values/strings.xml b/TMessagesProj/src/main/res/values/strings.xml
index 9f0fdb9ce..d87f5fed2 100644
--- a/TMessagesProj/src/main/res/values/strings.xml
+++ b/TMessagesProj/src/main/res/values/strings.xml
@@ -481,6 +481,11 @@
     <string name="CancelUserText">Tap and hold on user to deselect.</string>
     <string name="NoSelected">No Selected User yet</string>
     <string name="Deselect">Deselect</string>
+    <string name="MajorityPreferred">Majority preferred</string>
+    <string name="MinorityPreferred">Minority Preferred</string>
+    <string name="MaximumValue">Maximum Value</string>
+    <string name="MinimumValue">Minimum value</string>
+    <string name="Average">Average</string>
     <!--sessions view-->
     <string name="SessionsTitle">Active Sessions</string>
     <string name="CurrentSession">Current session</string>
