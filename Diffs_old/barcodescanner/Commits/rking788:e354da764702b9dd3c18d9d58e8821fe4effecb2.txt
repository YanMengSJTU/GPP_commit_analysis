diff --git a/CHANGELOG.md b/CHANGELOG.md
index 658ee4a..fe4c939 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -1,4 +1,10 @@
 # Change Log
 
+## [1.8.4] - Dec 30, 2015
+* Improve performance by opening camera and handling preview frames in a separate HandlerThread (#1, #99)
+* Do not automatically stopCamera after a result is found #115
+* Update samples to use Material Theme and make sure all samples use the FullScreen theme
+* Update gradle wrapper to v2.10, gradle plugin to v1.5.0, buildToolsVersion to v23.0.2 and targetSdkVersion 23
+
 ## [1.8.3] - October 3, 2015
-Rebuild ZBar libraries with position independent code (#123,#119,#94).
+* Rebuild ZBar libraries with position independent code (#123,#119,#94).
diff --git a/README.md b/README.md
index 46e384d..38f650e 100644
--- a/README.md
+++ b/README.md
@@ -9,6 +9,14 @@ Screenshots
 
 ![Landscape](https://raw.github.com/dm77/barcodescanner/master/screenshots/landscape_small.png)
 
+
+Minor BREAKING CHANGE in 1.8.4
+==============================
+Version 1.8.4 introduces a couple of new changes:
+
+* Open Camera and handle preview frames in a separate HandlerThread (#1, #99): Though this has worked fine in my testing on 3 devices, I would advise you to test on your own devices before blindly releasing apps with this version. If you run into any issues please file a bug report.
+* Do not automatically stopCamera after a result is found #115: This means that upon a successful scan only the cameraPreview is stopped but the camera is not released. So previously if your code was calling mScannerView.startCamera() in the handleResult() method, please replace that with a call to mScannerView.resumeCameraPreview(this);
+
 ZXing
 =====
 
@@ -17,7 +25,7 @@ Installation
 
 Add the following dependency to your build.gradle file.
 
-`compile 'me.dm7.barcodescanner:zxing:1.8.3'`
+`compile 'me.dm7.barcodescanner:zxing:1.8.4'`
 
 Simple Usage
 ------------
@@ -59,6 +67,9 @@ public class SimpleScannerActivity extends Activity implements ZXingScannerView.
         // Do something with the result here
         Log.v(TAG, rawResult.getText()); // Prints scan results
         Log.v(TAG, rawResult.getBarcodeFormat().toString()); // Prints the scan format (qrcode, pdf417 etc.)
+
+        // If you would like to resume scanning, call this method below:
+        mScannerView.resumeCameraPreview(this);
     }
 }
 
@@ -115,7 +126,7 @@ Installation
 
 Add the following dependency to your build.gradle file.
 
-`compile 'me.dm7.barcodescanner:zbar:1.8.3'`
+`compile 'me.dm7.barcodescanner:zbar:1.8.4'`
 
 Simple Usage
 ------------
@@ -157,6 +168,9 @@ public class SimpleScannerActivity extends Activity implements ZBarScannerView.R
         // Do something with the result here
         Log.v(TAG, rawResult.getContents()); // Prints scan results
         Log.v(TAG, rawResult.getBarcodeFormat().getName()); // Prints the scan format (qrcode, pdf417 etc.)
+
+        // If you would like to resume scanning, call this method below:
+        mScannerView.resumeCameraPreview(this);
     }
 }
 
diff --git a/build.gradle b/build.gradle
index 12ad13b..196adea 100644
--- a/build.gradle
+++ b/build.gradle
@@ -4,13 +4,13 @@ buildscript {
     }
 
     dependencies {
-        classpath 'com.android.tools.build:gradle:1.1.0'
+        classpath 'com.android.tools.build:gradle:1.5.0'
     }
 }
 
 allprojects {
     group = 'me.dm7.barcodescanner'
-    version = '1.8.3'
+    version = '1.8.4'
 
     repositories {
         mavenCentral()
@@ -20,7 +20,7 @@ allprojects {
     }
 
     ext {
-        supportLibraryDependency = 'com.android.support:support-v4:23.0.1'
+        supportLibraryDependency = 'com.android.support:support-v4:23.1.1'
         isLibrary = false
     }
 }
@@ -31,7 +31,7 @@ subprojects {
         if(ext.pluginContainer.hasPlugin("com.android.application") || ext.pluginContainer.hasPlugin("com.android.library")) {
             android {
                 compileSdkVersion 23
-                buildToolsVersion '23.0.1'
+                buildToolsVersion '23.0.2'
 
                 android {
                     lintOptions {
@@ -42,8 +42,8 @@ subprojects {
                 defaultConfig {
                     minSdkVersion 9
                     targetSdkVersion 23
-                    versionCode 183
-                    versionName "1.8.3"
+                    versionCode 184
+                    versionName "1.8.4"
                 }
             }
         }
@@ -108,3 +108,7 @@ subprojects {
         }
     }
 }
+
+task wrapper(type: Wrapper) {
+    gradleVersion = '2.10'
+}
diff --git a/core/build.gradle b/core/build.gradle
index e9897ae..968a37f 100644
--- a/core/build.gradle
+++ b/core/build.gradle
@@ -11,9 +11,3 @@ ext {
 dependencies {
     compile supportLibraryDependency
 }
-
-android {
-    defaultConfig {
-        //applicationId "${project.group}.core"
-    }
-}
diff --git a/core/src/main/java/me/dm7/barcodescanner/core/BarcodeScannerView.java b/core/src/main/java/me/dm7/barcodescanner/core/BarcodeScannerView.java
index be5b523..f7b6a8b 100644
--- a/core/src/main/java/me/dm7/barcodescanner/core/BarcodeScannerView.java
+++ b/core/src/main/java/me/dm7/barcodescanner/core/BarcodeScannerView.java
@@ -17,6 +17,9 @@
     private IViewFinder mViewFinderView;
     private Rect mFramingRectInPreview;
     protected boolean mStretchCameraToFill = false;
+    private CameraHandlerThread mCameraHandlerThread;
+    private Boolean mFlashState;
+    private boolean mAutofocusState = true;
 
     public BarcodeScannerView(Context context) {
         this(context, false);
@@ -24,18 +27,18 @@ public BarcodeScannerView(Context context) {
 
     public BarcodeScannerView(Context context, boolean stretchCameraToFill) {
         super(context);
-        mStretchCameraToFill = stretchCameraToFill;
 
-        setupLayout();
+        mStretchCameraToFill = stretchCameraToFill;
     }
 
     public BarcodeScannerView(Context context, AttributeSet attributeSet) {
         super(context, attributeSet);
-        setupLayout();
     }
 
-    public final void setupLayout() {
-        mPreview = new CameraPreview(getContext());
+    public final void setupLayout(Camera camera) {
+            removeAllViews();
+
+        mPreview = new CameraPreview(getContext(), camera, this);
         mPreview.setStretchToFill(mStretchCameraToFill);
         RelativeLayout relativeLayout = new RelativeLayout(getContext());
         relativeLayout.setGravity(Gravity.CENTER);
@@ -64,20 +67,26 @@ protected IViewFinder createViewFinderView(Context context) {
     }
 
     public void startCamera(int cameraId) {
-        startCamera(CameraUtils.getCameraInstance(cameraId));
+        if(mCameraHandlerThread == null) {
+            mCameraHandlerThread = new CameraHandlerThread(this);
+        }
+        mCameraHandlerThread.startCamera(cameraId);
     }
 
-    public void startCamera(Camera camera) {
+    public void setupCameraPreview(Camera camera) {
         mCamera = camera;
         if(mCamera != null) {
+            setupLayout(mCamera);
             mViewFinderView.setupViewFinder();
-            mPreview.setCamera(mCamera, this);
-            mPreview.initCameraPreview();
+            if(mFlashState != null) {
+                setFlash(mFlashState);
+            }
+            setAutoFocus(mAutofocusState);
         }
     }
 
     public void startCamera() {
-        startCamera(CameraUtils.getCameraInstance());
+        startCamera(-1);
     }
 
     public void stopCamera() {
@@ -87,6 +96,22 @@ public void stopCamera() {
             mCamera.release();
             mCamera = null;
         }
+        if(mCameraHandlerThread != null) {
+            mCameraHandlerThread.quit();
+            mCameraHandlerThread = null;
+        }
+    }
+
+    public void stopCameraPreview() {
+        if(mPreview != null) {
+            mPreview.stopCameraPreview();
+        }
+    }
+
+    protected void resumeCameraPreview() {
+        if(mPreview != null) {
+            mPreview.showCameraPreview();
+        }
     }
 
     public synchronized Rect getFramingRectInPreview(int previewWidth, int previewHeight) {
@@ -110,6 +135,7 @@ public synchronized Rect getFramingRectInPreview(int previewWidth, int previewHe
     }
 
     public void setFlash(boolean flag) {
+        mFlashState = flag;
         if(mCamera != null && CameraUtils.isFlashSupported(mCamera)) {
 
             Camera.Parameters parameters = mCamera.getParameters();
@@ -153,6 +179,7 @@ public void toggleFlash() {
     }
 
     public void setAutoFocus(boolean state) {
+        mAutofocusState = state;
         if(mPreview != null) {
             mPreview.setAutoFocus(state);
         }
diff --git a/core/src/main/java/me/dm7/barcodescanner/core/CameraHandlerThread.java b/core/src/main/java/me/dm7/barcodescanner/core/CameraHandlerThread.java
new file mode 100644
index 0000000..5770fcc
--- /dev/null
+++ b/core/src/main/java/me/dm7/barcodescanner/core/CameraHandlerThread.java
@@ -0,0 +1,37 @@
+package me.dm7.barcodescanner.core;
+
+
+import android.hardware.Camera;
+import android.os.Handler;
+import android.os.HandlerThread;
+import android.os.Looper;
+
+// This code is mostly based on the top answer here: http://stackoverflow.com/questions/18149964/best-use-of-handlerthread-over-other-similar-classes
+public class CameraHandlerThread extends HandlerThread {
+    private static final String LOG_TAG = "CameraHandlerThread";
+
+    private BarcodeScannerView mScannerView;
+
+    public CameraHandlerThread(BarcodeScannerView scannerView) {
+        super("CameraHandlerThread");
+        mScannerView = scannerView;
+        start();
+    }
+
+    public void startCamera(final int cameraId) {
+        Handler localHandler = new Handler(getLooper());
+        localHandler.post(new Runnable() {
+            @Override
+            public void run() {
+                final Camera camera = CameraUtils.getCameraInstance(cameraId);
+                Handler mainHandler = new Handler(Looper.getMainLooper());
+                mainHandler.post(new Runnable() {
+                    @Override
+                    public void run() {
+                        mScannerView.setupCameraPreview(camera);
+                    }
+                });
+            }
+        });
+    }
+}
diff --git a/core/src/main/java/me/dm7/barcodescanner/core/CameraPreview.java b/core/src/main/java/me/dm7/barcodescanner/core/CameraPreview.java
index 1bebe1c..0018a92 100644
--- a/core/src/main/java/me/dm7/barcodescanner/core/CameraPreview.java
+++ b/core/src/main/java/me/dm7/barcodescanner/core/CameraPreview.java
@@ -28,17 +28,19 @@
     private boolean mStretchToFill = false;
     private Camera.PreviewCallback mPreviewCallback;
 
-    public CameraPreview(Context context) {
-        this(context, false);
+    public CameraPreview(Context context, Camera camera, Camera.PreviewCallback previewCallback) {
+        this(context, camera, previewCallback, false);
     }
 
-    public CameraPreview(Context context, boolean stretchToFill) {
+    public CameraPreview(Context context, Camera camera, Camera.PreviewCallback previewCallback, boolean stretchToFill) {
         super(context);
         mStretchToFill = stretchToFill;
+        init(camera, previewCallback);
     }
 
-    public CameraPreview(Context context, AttributeSet attributeSet) {
+    public CameraPreview(Context context, AttributeSet attributeSet, Camera camera, Camera.PreviewCallback previewCallback) {
         super(context, attributeSet);
+        init(camera, previewCallback);
 
         TypedArray attrs = context.getTheme().obtainStyledAttributes(
                 attributeSet,
@@ -47,28 +49,21 @@ public CameraPreview(Context context, AttributeSet attributeSet) {
 
         try {
             mStretchToFill = attrs.getBoolean(R.styleable.CameraPreview_stretchToFill, false);
-        }
-        finally {
+        } finally {
             attrs.recycle();
         }
     }
 
-    public void setCamera(Camera camera, Camera.PreviewCallback previewCallback) {
-        mCamera = camera;
-        mPreviewCallback = previewCallback;
+    public void init(Camera camera, Camera.PreviewCallback previewCallback) {
+        setCamera(camera, previewCallback);
         mAutoFocusHandler = new Handler();
+        getHolder().addCallback(this);
+        getHolder().setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);
     }
 
-    public void initCameraPreview() {
-        if(mCamera != null) {
-            getHolder().addCallback(this);
-            getHolder().setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);
-            if(mPreviewing) {
-                requestLayout();
-            } else {
-                showCameraPreview();
-            }
-        }
+    public void setCamera(Camera camera, Camera.PreviewCallback previewCallback) {
+        mCamera = camera;
+        mPreviewCallback = previewCallback;
     }
 
     @Override
@@ -94,6 +89,7 @@ public void surfaceDestroyed(SurfaceHolder surfaceHolder) {
     public void showCameraPreview() {
         if(mCamera != null) {
             try {
+                getHolder().addCallback(this);
                 mPreviewing = true;
                 setupCameraParameters();
                 mCamera.setPreviewDisplay(getHolder());
@@ -127,6 +123,7 @@ public void stopCameraPreview() {
         if(mCamera != null) {
             try {
                 mPreviewing = false;
+                getHolder().removeCallback(this);
                 mCamera.cancelAutoFocus();
                 mCamera.setOneShotPreviewCallback(null);
                 mCamera.stopPreview();
diff --git a/gradle/wrapper/gradle-wrapper.jar b/gradle/wrapper/gradle-wrapper.jar
index 0087cd3..2322723 100644
Binary files a/gradle/wrapper/gradle-wrapper.jar and b/gradle/wrapper/gradle-wrapper.jar differ
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index 0573dea..beb5ebc 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,6 +1,6 @@
-#Wed Dec 17 06:07:23 MST 2014
+#Wed Dec 30 05:01:23 MST 2015
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-2.2-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-2.10-bin.zip
diff --git a/gradlew.bat b/gradlew.bat
index 8a0b282..aec9973 100644
--- a/gradlew.bat
+++ b/gradlew.bat
@@ -1,90 +1,90 @@
-@if "%DEBUG%" == "" @echo off
-@rem ##########################################################################
-@rem
-@rem  Gradle startup script for Windows
-@rem
-@rem ##########################################################################
-
-@rem Set local scope for the variables with windows NT shell
-if "%OS%"=="Windows_NT" setlocal
-
-@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
-set DEFAULT_JVM_OPTS=
-
-set DIRNAME=%~dp0
-if "%DIRNAME%" == "" set DIRNAME=.
-set APP_BASE_NAME=%~n0
-set APP_HOME=%DIRNAME%
-
-@rem Find java.exe
-if defined JAVA_HOME goto findJavaFromJavaHome
-
-set JAVA_EXE=java.exe
-%JAVA_EXE% -version >NUL 2>&1
-if "%ERRORLEVEL%" == "0" goto init
-
-echo.
-echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
-echo.
-echo Please set the JAVA_HOME variable in your environment to match the
-echo location of your Java installation.
-
-goto fail
-
-:findJavaFromJavaHome
-set JAVA_HOME=%JAVA_HOME:"=%
-set JAVA_EXE=%JAVA_HOME%/bin/java.exe
-
-if exist "%JAVA_EXE%" goto init
-
-echo.
-echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
-echo.
-echo Please set the JAVA_HOME variable in your environment to match the
-echo location of your Java installation.
-
-goto fail
-
-:init
-@rem Get command-line arguments, handling Windowz variants
-
-if not "%OS%" == "Windows_NT" goto win9xME_args
-if "%@eval[2+2]" == "4" goto 4NT_args
-
-:win9xME_args
-@rem Slurp the command line arguments.
-set CMD_LINE_ARGS=
-set _SKIP=2
-
-:win9xME_args_slurp
-if "x%~1" == "x" goto execute
-
-set CMD_LINE_ARGS=%*
-goto execute
-
-:4NT_args
-@rem Get arguments from the 4NT Shell from JP Software
-set CMD_LINE_ARGS=%$
-
-:execute
-@rem Setup the command line
-
-set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar
-
-@rem Execute Gradle
-"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %CMD_LINE_ARGS%
-
-:end
-@rem End local scope for the variables with windows NT shell
-if "%ERRORLEVEL%"=="0" goto mainEnd
-
-:fail
-rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
-rem the _cmd.exe /c_ return code!
-if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
-exit /b 1
-
-:mainEnd
-if "%OS%"=="Windows_NT" endlocal
-
-:omega
+@if "%DEBUG%" == "" @echo off
+@rem ##########################################################################
+@rem
+@rem  Gradle startup script for Windows
+@rem
+@rem ##########################################################################
+
+@rem Set local scope for the variables with windows NT shell
+if "%OS%"=="Windows_NT" setlocal
+
+@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
+set DEFAULT_JVM_OPTS=
+
+set DIRNAME=%~dp0
+if "%DIRNAME%" == "" set DIRNAME=.
+set APP_BASE_NAME=%~n0
+set APP_HOME=%DIRNAME%
+
+@rem Find java.exe
+if defined JAVA_HOME goto findJavaFromJavaHome
+
+set JAVA_EXE=java.exe
+%JAVA_EXE% -version >NUL 2>&1
+if "%ERRORLEVEL%" == "0" goto init
+
+echo.
+echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
+echo.
+echo Please set the JAVA_HOME variable in your environment to match the
+echo location of your Java installation.
+
+goto fail
+
+:findJavaFromJavaHome
+set JAVA_HOME=%JAVA_HOME:"=%
+set JAVA_EXE=%JAVA_HOME%/bin/java.exe
+
+if exist "%JAVA_EXE%" goto init
+
+echo.
+echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
+echo.
+echo Please set the JAVA_HOME variable in your environment to match the
+echo location of your Java installation.
+
+goto fail
+
+:init
+@rem Get command-line arguments, handling Windowz variants
+
+if not "%OS%" == "Windows_NT" goto win9xME_args
+if "%@eval[2+2]" == "4" goto 4NT_args
+
+:win9xME_args
+@rem Slurp the command line arguments.
+set CMD_LINE_ARGS=
+set _SKIP=2
+
+:win9xME_args_slurp
+if "x%~1" == "x" goto execute
+
+set CMD_LINE_ARGS=%*
+goto execute
+
+:4NT_args
+@rem Get arguments from the 4NT Shell from JP Software
+set CMD_LINE_ARGS=%$
+
+:execute
+@rem Setup the command line
+
+set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar
+
+@rem Execute Gradle
+"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %CMD_LINE_ARGS%
+
+:end
+@rem End local scope for the variables with windows NT shell
+if "%ERRORLEVEL%"=="0" goto mainEnd
+
+:fail
+rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
+rem the _cmd.exe /c_ return code!
+if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
+exit /b 1
+
+:mainEnd
+if "%OS%"=="Windows_NT" endlocal
+
+:omega
diff --git a/settings.gradle b/settings.gradle
index a70b2f9..8b363d8 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -1 +1 @@
-include "core", "zxing:zxing", "zxing:sample", "zbar:zbar", "zbar:sample"
\ No newline at end of file
+include "core", "zxing", "zxing-sample", "zbar", "zbar-sample"
diff --git a/zbar/sample/build.gradle b/zbar-sample/build.gradle
similarity index 50%
rename from zbar/sample/build.gradle
rename to zbar-sample/build.gradle
index d5ecd08..deb57aa 100644
--- a/zbar/sample/build.gradle
+++ b/zbar-sample/build.gradle
@@ -1,10 +1,11 @@
 apply plugin: 'com.android.application'
 
 dependencies {
-    //compile project(":zbar:zbar")
-    compile 'me.dm7.barcodescanner:zbar:1.8.3'
+    compile project(":zbar")
+    //compile 'me.dm7.barcodescanner:zbar:1.8.4'
     compile supportLibraryDependency
-    compile 'com.android.support:appcompat-v7:23.0.1'
+    compile 'com.android.support:appcompat-v7:23.1.1'
+    compile 'com.android.support:design:23.1.1'
 }
 
 android {
diff --git a/zbar/sample/src/main/AndroidManifest.xml b/zbar-sample/src/main/AndroidManifest.xml
similarity index 93%
rename from zbar/sample/src/main/AndroidManifest.xml
rename to zbar-sample/src/main/AndroidManifest.xml
index 84bb944..1b5a9c0 100644
--- a/zbar/sample/src/main/AndroidManifest.xml
+++ b/zbar-sample/src/main/AndroidManifest.xml
@@ -15,7 +15,7 @@
             </intent-filter>
         </activity>
 
-        <activity android:name=".ScannerActivity"
+        <activity android:name=".FullScannerActivity"
                   android:theme="@style/AppOverlayTheme"
                   android:uiOptions="splitActionBarWhenNarrow"
                   android:label="@string/scanner_activity">
@@ -23,7 +23,7 @@
                        android:value="splitActionBarWhenNarrow" />
         </activity>
 
-        <activity android:name=".ScannerFragmentActivity"
+        <activity android:name=".FullScannerFragmentActivity"
                   android:theme="@style/AppOverlayTheme"
                   android:uiOptions="splitActionBarWhenNarrow"
                   android:label="@string/scanner_fragment_activity">
diff --git a/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/BaseScannerActivity.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/BaseScannerActivity.java
new file mode 100644
index 0000000..0655793
--- /dev/null
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/BaseScannerActivity.java
@@ -0,0 +1,28 @@
+package me.dm7.barcodescanner.zbar.sample;
+
+import android.support.v7.app.ActionBar;
+import android.support.v7.app.AppCompatActivity;
+import android.support.v7.widget.Toolbar;
+import android.view.MenuItem;
+
+public class BaseScannerActivity extends AppCompatActivity {
+    public void setupToolbar() {
+        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
+        setSupportActionBar(toolbar);
+        final ActionBar ab = getSupportActionBar();
+        if(ab != null) {
+            ab.setDisplayHomeAsUpEnabled(true);
+        }
+    }
+
+    @Override
+    public boolean onOptionsItemSelected(MenuItem item) {
+        switch (item.getItemId()) {
+            // Respond to the action bar's Up/Home button
+            case android.R.id.home:
+                finish();
+                return true;
+        }
+        return super.onOptionsItemSelected(item);
+    }
+}
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/CameraSelectorDialogFragment.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/CameraSelectorDialogFragment.java
similarity index 100%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/CameraSelectorDialogFragment.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/CameraSelectorDialogFragment.java
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FormatSelectorDialogFragment.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FormatSelectorDialogFragment.java
similarity index 100%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FormatSelectorDialogFragment.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FormatSelectorDialogFragment.java
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerActivity.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerActivity.java
similarity index 93%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerActivity.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerActivity.java
index ef683a2..a3db043 100644
--- a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerActivity.java
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerActivity.java
@@ -7,9 +7,10 @@
 import android.support.v4.app.DialogFragment;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.view.MenuItemCompat;
-import android.support.v7.app.ActionBarActivity;
+import android.support.v7.app.AppCompatActivity;
 import android.view.Menu;
 import android.view.MenuItem;
+import android.view.ViewGroup;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -18,7 +19,7 @@
 import me.dm7.barcodescanner.zbar.Result;
 import me.dm7.barcodescanner.zbar.ZBarScannerView;
 
-public class ScannerActivity extends ActionBarActivity implements MessageDialogFragment.MessageDialogListener,
+public class FullScannerActivity extends BaseScannerActivity implements MessageDialogFragment.MessageDialogListener,
         ZBarScannerView.ResultHandler, FormatSelectorDialogFragment.FormatSelectorDialogListener,
         CameraSelectorDialogFragment.CameraSelectorDialogListener {
     private static final String FLASH_STATE = "FLASH_STATE";
@@ -46,9 +47,12 @@ public void onCreate(Bundle state) {
             mCameraId = -1;
         }
 
+        setContentView(R.layout.activity_full_scanner);
+        setupToolbar();
+        ViewGroup contentFrame = (ViewGroup) findViewById(R.id.content_frame);
         mScannerView = new ZBarScannerView(this);
         setupFormats();
-        setContentView(mScannerView);
+        contentFrame.addView(mScannerView);
     }
 
     @Override
@@ -78,7 +82,7 @@ public boolean onCreateOptionsMenu(Menu menu) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_flash, 0, R.string.flash_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
 
         if(mAutoFocus) {
@@ -86,13 +90,13 @@ public boolean onCreateOptionsMenu(Menu menu) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_auto_focus, 0, R.string.auto_focus_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_formats, 0, R.string.formats);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_camera_selector, 0, R.string.select_camera);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         return super.onCreateOptionsMenu(menu);
     }
@@ -167,9 +171,7 @@ public void closeDialog(String dialogName) {
     @Override
     public void onDialogPositiveClick(DialogFragment dialog) {
         // Resume the camera
-        mScannerView.startCamera(mCameraId);
-        mScannerView.setFlash(mFlash);
-        mScannerView.setAutoFocus(mAutoFocus);
+        mScannerView.resumeCameraPreview(this);
     }
 
     @Override
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerFragment.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerFragment.java
similarity index 96%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerFragment.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerFragment.java
index fe5ebfe..f64f8f6 100644
--- a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerFragment.java
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerFragment.java
@@ -22,7 +22,7 @@
 import me.dm7.barcodescanner.zbar.Result;
 import me.dm7.barcodescanner.zbar.ZBarScannerView;
 
-public class ScannerFragment extends Fragment implements MessageDialogFragment.MessageDialogListener,
+public class FullScannerFragment extends Fragment implements MessageDialogFragment.MessageDialogListener,
         ZBarScannerView.ResultHandler, FormatSelectorDialogFragment.FormatSelectorDialogListener,
         CameraSelectorDialogFragment.CameraSelectorDialogListener {
     private static final String FLASH_STATE = "FLASH_STATE";
@@ -69,7 +69,7 @@ public void onCreateOptionsMenu (Menu menu, MenuInflater inflater) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_flash, 0, R.string.flash_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
 
         if(mAutoFocus) {
@@ -77,13 +77,13 @@ public void onCreateOptionsMenu (Menu menu, MenuInflater inflater) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_auto_focus, 0, R.string.auto_focus_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_formats, 0, R.string.formats);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_camera_selector, 0, R.string.select_camera);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
     }
 
     @Override
@@ -174,9 +174,7 @@ public void closeDialog(String dialogName) {
     @Override
     public void onDialogPositiveClick(DialogFragment dialog) {
         // Resume the camera
-        mScannerView.startCamera(mCameraId);
-        mScannerView.setFlash(mFlash);
-        mScannerView.setAutoFocus(mAutoFocus);
+        mScannerView.resumeCameraPreview(this);
     }
 
     @Override
diff --git a/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerFragmentActivity.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerFragmentActivity.java
new file mode 100644
index 0000000..352d722
--- /dev/null
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/FullScannerFragmentActivity.java
@@ -0,0 +1,12 @@
+package me.dm7.barcodescanner.zbar.sample;
+
+import android.os.Bundle;
+
+public class FullScannerFragmentActivity extends BaseScannerActivity {
+    @Override
+    public void onCreate(Bundle state) {
+        super.onCreate(state);
+        setContentView(R.layout.activity_full_scanner_fragment);
+        setupToolbar();
+    }
+}
\ No newline at end of file
diff --git a/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MainActivity.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MainActivity.java
new file mode 100644
index 0000000..a8cb01a
--- /dev/null
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MainActivity.java
@@ -0,0 +1,73 @@
+package me.dm7.barcodescanner.zbar.sample;
+
+import android.Manifest;
+import android.content.Intent;
+import android.content.pm.PackageManager;
+import android.os.Bundle;
+import android.support.v4.app.ActivityCompat;
+import android.support.v4.content.ContextCompat;
+import android.support.v7.app.AppCompatActivity;
+import android.support.v7.widget.Toolbar;
+import android.view.View;
+import android.widget.Toast;
+
+public class MainActivity extends AppCompatActivity {
+    private static final int ZBAR_CAMERA_PERMISSION = 1;
+    private Class<?> mClss;
+
+    @Override
+    public void onCreate(Bundle state) {
+        super.onCreate(state);
+        setContentView(R.layout.activity_main);
+        setupToolbar();
+    }
+
+    public void setupToolbar() {
+        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
+        setSupportActionBar(toolbar);
+    }
+
+    public void launchSimpleActivity(View v) {
+        launchActivity(SimpleScannerActivity.class);
+    }
+
+    public void launchSimpleFragmentActivity(View v) {
+        launchActivity(SimpleScannerFragmentActivity.class);
+    }
+
+    public void launchFullActivity(View v) {
+        launchActivity(FullScannerActivity.class);
+    }
+
+    public void launchFullFragmentActivity(View v) {
+        launchActivity(FullScannerFragmentActivity.class);
+    }
+
+    public void launchActivity(Class<?> clss) {
+        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)
+                != PackageManager.PERMISSION_GRANTED) {
+            mClss = clss;
+            ActivityCompat.requestPermissions(this,
+                    new String[]{Manifest.permission.CAMERA}, ZBAR_CAMERA_PERMISSION);
+        } else {
+            Intent intent = new Intent(this, clss);
+            startActivity(intent);
+        }
+    }
+
+    @Override
+    public void onRequestPermissionsResult(int requestCode,  String permissions[], int[] grantResults) {
+        switch (requestCode) {
+            case ZBAR_CAMERA_PERMISSION:
+                if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
+                    if(mClss != null) {
+                        Intent intent = new Intent(this, mClss);
+                        startActivity(intent);
+                    }
+                } else {
+                    Toast.makeText(this, "Please grant camera permission to use the QR Scanner", Toast.LENGTH_SHORT).show();
+                }
+                return;
+        }
+    }
+}
\ No newline at end of file
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MessageDialogFragment.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MessageDialogFragment.java
similarity index 100%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MessageDialogFragment.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MessageDialogFragment.java
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerActivity.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerActivity.java
similarity index 50%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerActivity.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerActivity.java
index 1a2be6e..fb40235 100644
--- a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerActivity.java
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerActivity.java
@@ -1,20 +1,24 @@
 package me.dm7.barcodescanner.zbar.sample;
 
 import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
+import android.os.Handler;
+import android.view.ViewGroup;
 import android.widget.Toast;
 
 import me.dm7.barcodescanner.zbar.Result;
 import me.dm7.barcodescanner.zbar.ZBarScannerView;
 
-public class SimpleScannerActivity extends ActionBarActivity implements ZBarScannerView.ResultHandler {
+public class SimpleScannerActivity extends BaseScannerActivity implements ZBarScannerView.ResultHandler {
     private ZBarScannerView mScannerView;
 
     @Override
     public void onCreate(Bundle state) {
         super.onCreate(state);
+        setContentView(R.layout.activity_simple_scanner);
+        setupToolbar();
+        ViewGroup contentFrame = (ViewGroup) findViewById(R.id.content_frame);
         mScannerView = new ZBarScannerView(this);
-        setContentView(mScannerView);
+        contentFrame.addView(mScannerView);
     }
 
     @Override
@@ -34,6 +38,16 @@ public void onPause() {
     public void handleResult(Result rawResult) {
         Toast.makeText(this, "Contents = " + rawResult.getContents() +
                 ", Format = " + rawResult.getBarcodeFormat().getName(), Toast.LENGTH_SHORT).show();
-        mScannerView.startCamera();
+        // Note:
+        // * Wait 2 seconds to resume the preview.
+        // * On older devices continuously stopping and resuming camera preview can result in freezing the app.
+        // * I don't know why this is the case but I don't have the time to figure out.
+        Handler handler = new Handler();
+        handler.postDelayed(new Runnable() {
+            @Override
+            public void run() {
+                mScannerView.resumeCameraPreview(SimpleScannerActivity.this);
+            }
+        }, 2000);
     }
 }
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragment.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragment.java
similarity index 68%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragment.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragment.java
index 5647ab5..82a10b8 100644
--- a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragment.java
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragment.java
@@ -1,6 +1,7 @@
 package me.dm7.barcodescanner.zbar.sample;
 
 import android.os.Bundle;
+import android.os.Handler;
 import android.support.v4.app.Fragment;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -30,7 +31,17 @@ public void onResume() {
     public void handleResult(Result rawResult) {
         Toast.makeText(getActivity(), "Contents = " + rawResult.getContents() +
                 ", Format = " + rawResult.getBarcodeFormat().getName(), Toast.LENGTH_SHORT).show();
-        mScannerView.startCamera();
+        // Note:
+        // * Wait 2 seconds to resume the preview.
+        // * On older devices continuously stopping and resuming camera preview can result in freezing the app.
+        // * I don't know why this is the case but I don't have the time to figure out.
+        Handler handler = new Handler();
+        handler.postDelayed(new Runnable() {
+            @Override
+            public void run() {
+                mScannerView.resumeCameraPreview(SimpleScannerFragment.this);
+            }
+        }, 2000);
     }
 
     @Override
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragmentActivity.java b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragmentActivity.java
similarity index 65%
rename from zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragmentActivity.java
rename to zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragmentActivity.java
index 7f3b553..e737c64 100644
--- a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragmentActivity.java
+++ b/zbar-sample/src/main/java/me/dm7/barcodescanner/zbar/sample/SimpleScannerFragmentActivity.java
@@ -1,12 +1,12 @@
 package me.dm7.barcodescanner.zbar.sample;
 
 import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
 
-public class SimpleScannerFragmentActivity extends ActionBarActivity {
+public class SimpleScannerFragmentActivity extends BaseScannerActivity {
     @Override
     public void onCreate(Bundle state) {
         super.onCreate(state);
         setContentView(R.layout.activity_simple_scanner_fragment);
+        setupToolbar();
     }
 }
\ No newline at end of file
diff --git a/zbar/sample/src/main/res/drawable-hdpi/ic_launcher.png b/zbar-sample/src/main/res/drawable-hdpi/ic_launcher.png
similarity index 100%
rename from zbar/sample/src/main/res/drawable-hdpi/ic_launcher.png
rename to zbar-sample/src/main/res/drawable-hdpi/ic_launcher.png
diff --git a/zbar/sample/src/main/res/drawable-mdpi/ic_launcher.png b/zbar-sample/src/main/res/drawable-mdpi/ic_launcher.png
similarity index 100%
rename from zbar/sample/src/main/res/drawable-mdpi/ic_launcher.png
rename to zbar-sample/src/main/res/drawable-mdpi/ic_launcher.png
diff --git a/zbar/sample/src/main/res/drawable-xhdpi/ic_launcher.png b/zbar-sample/src/main/res/drawable-xhdpi/ic_launcher.png
similarity index 100%
rename from zbar/sample/src/main/res/drawable-xhdpi/ic_launcher.png
rename to zbar-sample/src/main/res/drawable-xhdpi/ic_launcher.png
diff --git a/zbar/sample/src/main/res/drawable-xxhdpi/ic_launcher.png b/zbar-sample/src/main/res/drawable-xxhdpi/ic_launcher.png
similarity index 100%
rename from zbar/sample/src/main/res/drawable-xxhdpi/ic_launcher.png
rename to zbar-sample/src/main/res/drawable-xxhdpi/ic_launcher.png
diff --git a/zbar-sample/src/main/res/layout/activity_full_scanner.xml b/zbar-sample/src/main/res/layout/activity_full_scanner.xml
new file mode 100644
index 0000000..eb66dd7
--- /dev/null
+++ b/zbar-sample/src/main/res/layout/activity_full_scanner.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <FrameLayout
+        android:id="@+id/content_frame"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zbar-sample/src/main/res/layout/activity_full_scanner_fragment.xml b/zbar-sample/src/main/res/layout/activity_full_scanner_fragment.xml
new file mode 100644
index 0000000..64f0559
--- /dev/null
+++ b/zbar-sample/src/main/res/layout/activity_full_scanner_fragment.xml
@@ -0,0 +1,23 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <fragment android:name="me.dm7.barcodescanner.zbar.sample.FullScannerFragment"
+              android:id="@+id/scanner_fragment"
+              android:layout_weight="1"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zbar-sample/src/main/res/layout/activity_main.xml b/zbar-sample/src/main/res/layout/activity_main.xml
new file mode 100644
index 0000000..f23aea0
--- /dev/null
+++ b/zbar-sample/src/main/res/layout/activity_main.xml
@@ -0,0 +1,42 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:orientation="vertical"
+    android:layout_width="fill_parent"
+    android:layout_height="fill_parent">
+    <android.support.design.widget.AppBarLayout
+        app:popupTheme="@style/ThemeOverlay.AppCompat.Light"
+        app:theme="@style/ThemeOverlay.AppCompat.Dark.ActionBar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+        <android.support.v7.widget.Toolbar
+            android:id="@+id/toolbar"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"/>
+    </android.support.design.widget.AppBarLayout>
+
+    <LinearLayout
+        android:orientation="vertical"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"
+        android:gravity="center">
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/simple_activity_sample"
+                android:onClick="launchSimpleActivity" />
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/simple_fragment_sample"
+                android:onClick="launchSimpleFragmentActivity" />
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/activity_sample"
+                android:onClick="launchFullActivity" />
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/fragment_sample"
+                android:onClick="launchFullFragmentActivity" />
+    </LinearLayout>
+</LinearLayout>
\ No newline at end of file
diff --git a/zbar-sample/src/main/res/layout/activity_simple_scanner.xml b/zbar-sample/src/main/res/layout/activity_simple_scanner.xml
new file mode 100644
index 0000000..eb66dd7
--- /dev/null
+++ b/zbar-sample/src/main/res/layout/activity_simple_scanner.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <FrameLayout
+        android:id="@+id/content_frame"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zbar-sample/src/main/res/layout/activity_simple_scanner_fragment.xml b/zbar-sample/src/main/res/layout/activity_simple_scanner_fragment.xml
new file mode 100644
index 0000000..321c8f0
--- /dev/null
+++ b/zbar-sample/src/main/res/layout/activity_simple_scanner_fragment.xml
@@ -0,0 +1,23 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <fragment android:name="me.dm7.barcodescanner.zbar.sample.SimpleScannerFragment"
+              android:id="@+id/scanner_fragment"
+              android:layout_weight="1"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zbar-sample/src/main/res/values/colors.xml b/zbar-sample/src/main/res/values/colors.xml
new file mode 100644
index 0000000..1a64799
--- /dev/null
+++ b/zbar-sample/src/main/res/values/colors.xml
@@ -0,0 +1,12 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>
+    <color name="actionbar_opacity">#33000000</color>
+    <color name="primary">#3F51B5</color>
+    <color name="primary_dark">#303F9F</color>
+    <color name="primary_light">#C5CAE9</color>
+    <color name="accent">#E040FB</color>
+    <color name="primary_text">#212121</color>
+    <color name="secondary_text">#727272</color>
+    <color name="icons">#FFFFFF</color>
+    <color name="divider">#B6B6B6</color>
+</resources>
\ No newline at end of file
diff --git a/zbar/sample/src/main/res/values/ids.xml b/zbar-sample/src/main/res/values/ids.xml
similarity index 100%
rename from zbar/sample/src/main/res/values/ids.xml
rename to zbar-sample/src/main/res/values/ids.xml
diff --git a/zbar/sample/src/main/res/values/strings.xml b/zbar-sample/src/main/res/values/strings.xml
similarity index 100%
rename from zbar/sample/src/main/res/values/strings.xml
rename to zbar-sample/src/main/res/values/strings.xml
diff --git a/zbar-sample/src/main/res/values/styles.xml b/zbar-sample/src/main/res/values/styles.xml
new file mode 100644
index 0000000..abab8ed
--- /dev/null
+++ b/zbar-sample/src/main/res/values/styles.xml
@@ -0,0 +1,36 @@
+<resources>
+    <style name="AppTheme" parent="Theme.AppCompat.Light.NoActionBar">
+        <item name="colorPrimary">@color/primary</item>
+        <!-- darker variant for the status bar and contextual app bars -->
+        <item name="colorPrimaryDark">@color/primary_dark</item>
+        <!--   theme UI controls like checkboxes and text fields e.g. FloatActionButton -->
+        <item name="colorAccent">@color/accent</item>
+        <!-- Title Text Color -->
+        <item name="android:textColorPrimary">@color/primary_text</item>
+        <!-- color of the menu overflow icon (three vertical dots) -->
+        <item name="android:textColorSecondary">@color/secondary_text</item>
+    </style>
+
+    <style name="AppOverlayTheme" parent="@style/Theme.AppCompat.Light">
+        <item name="windowNoTitle">true</item>
+        <item name="windowActionBar">false</item>
+        <item name="android:windowFullscreen">true</item>
+        <item name="android:windowContentOverlay">@null</item>
+
+        <item name="colorPrimary">@color/primary</item>
+        <!-- darker variant for the status bar and contextual app bars -->
+        <item name="colorPrimaryDark">@color/primary_dark</item>
+        <!--   theme UI controls like checkboxes and text fields e.g. FloatActionButton -->
+        <item name="colorAccent">@color/accent</item>
+        <!-- Title Text Color -->
+        <item name="android:textColorPrimary">@color/primary_text</item>
+        <!-- color of the menu overflow icon (three vertical dots) -->
+        <item name="android:textColorSecondary">@color/secondary_text</item>
+    </style>
+
+    <style name="TransparentToolbar" parent="@style/ThemeOverlay.AppCompat.Dark.ActionBar">
+        <item name="android:windowActionBarOverlay">true</item>
+        <!-- Support Library compability -->
+        <item name="windowActionBarOverlay">true</item>
+    </style>
+</resources>
diff --git a/zbar/zbar/build.gradle b/zbar/build.gradle
similarity index 65%
rename from zbar/zbar/build.gradle
rename to zbar/build.gradle
index 1bfc7ac..62478e2 100644
--- a/zbar/zbar/build.gradle
+++ b/zbar/build.gradle
@@ -9,13 +9,7 @@ ext {
 }
 
 dependencies {
-    //compile project(":core")
-    compile 'me.dm7.barcodescanner:core:1.8.3'
+    compile project(":core")
+    //compile 'me.dm7.barcodescanner:core:1.8.4'
     compile fileTree(dir: 'libs', include: '*.jar')
 }
-
-android {
-    defaultConfig {
-        //applicationId "${project.group}.zbar"
-    }
-}
diff --git a/zbar/zbar/libs/zbar.jar b/zbar/libs/zbar.jar
similarity index 100%
rename from zbar/zbar/libs/zbar.jar
rename to zbar/libs/zbar.jar
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MainActivity.java b/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MainActivity.java
deleted file mode 100644
index 1d3b3fd..0000000
--- a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/MainActivity.java
+++ /dev/null
@@ -1,34 +0,0 @@
-package me.dm7.barcodescanner.zbar.sample;
-
-import android.content.Intent;
-import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
-import android.view.View;
-
-public class MainActivity extends ActionBarActivity {
-    @Override
-    public void onCreate(Bundle state) {
-        super.onCreate(state);
-        setContentView(R.layout.activity_main);
-    }
-
-    public void launchSimpleActivity(View v) {
-        Intent intent = new Intent(this, SimpleScannerActivity.class);
-        startActivity(intent);
-    }
-
-    public void launchSimpleFragmentActivity(View v) {
-        Intent intent = new Intent(this, SimpleScannerFragmentActivity.class);
-        startActivity(intent);
-    }
-
-    public void launchActivity(View v) {
-        Intent intent = new Intent(this, ScannerActivity.class);
-        startActivity(intent);
-    }
-
-    public void launchFragmentActivity(View v) {
-        Intent intent = new Intent(this, ScannerFragmentActivity.class);
-        startActivity(intent);
-    }
-}
\ No newline at end of file
diff --git a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerFragmentActivity.java b/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerFragmentActivity.java
deleted file mode 100644
index 282ae6e..0000000
--- a/zbar/sample/src/main/java/me/dm7/barcodescanner/zbar/sample/ScannerFragmentActivity.java
+++ /dev/null
@@ -1,12 +0,0 @@
-package me.dm7.barcodescanner.zbar.sample;
-
-import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
-
-public class ScannerFragmentActivity extends ActionBarActivity {
-    @Override
-    public void onCreate(Bundle state) {
-        super.onCreate(state);
-        setContentView(R.layout.activity_scanner_fragment);
-    }
-}
\ No newline at end of file
diff --git a/zbar/sample/src/main/res/layout/activity_main.xml b/zbar/sample/src/main/res/layout/activity_main.xml
deleted file mode 100644
index 8b30617..0000000
--- a/zbar/sample/src/main/res/layout/activity_main.xml
+++ /dev/null
@@ -1,25 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              xmlns:tools="http://schemas.android.com/tools"
-              android:orientation="vertical"
-              android:layout_width="match_parent"
-              android:layout_height="match_parent"
-              android:gravity="center">
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/simple_activity_sample"
-            android:onClick="launchSimpleActivity" />
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/simple_fragment_sample"
-            android:onClick="launchSimpleFragmentActivity" />
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/activity_sample"
-            android:onClick="launchActivity" />
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/fragment_sample"
-            android:onClick="launchFragmentActivity" />
-</LinearLayout>
\ No newline at end of file
diff --git a/zbar/sample/src/main/res/layout/activity_scanner_fragment.xml b/zbar/sample/src/main/res/layout/activity_scanner_fragment.xml
deleted file mode 100644
index 97477d6..0000000
--- a/zbar/sample/src/main/res/layout/activity_scanner_fragment.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              xmlns:tools="http://schemas.android.com/tools"
-              android:orientation="vertical"
-              android:layout_width="match_parent"
-              android:layout_height="match_parent">
-    <fragment android:name="me.dm7.barcodescanner.zbar.sample.ScannerFragment"
-              android:id="@+id/scanner_fragment"
-              android:layout_weight="1"
-              android:layout_width="match_parent"
-              android:layout_height="0dip" />
-</LinearLayout>
diff --git a/zbar/sample/src/main/res/layout/activity_simple_scanner_fragment.xml b/zbar/sample/src/main/res/layout/activity_simple_scanner_fragment.xml
deleted file mode 100644
index 8962b1d..0000000
--- a/zbar/sample/src/main/res/layout/activity_simple_scanner_fragment.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              xmlns:tools="http://schemas.android.com/tools"
-              android:orientation="vertical"
-              android:layout_width="match_parent"
-              android:layout_height="match_parent">
-    <fragment android:name="me.dm7.barcodescanner.zbar.sample.SimpleScannerFragment"
-              android:id="@+id/scanner_fragment"
-              android:layout_weight="1"
-              android:layout_width="match_parent"
-              android:layout_height="0dip" />
-</LinearLayout>
diff --git a/zbar/sample/src/main/res/values/colors.xml b/zbar/sample/src/main/res/values/colors.xml
deleted file mode 100644
index 424abd1..0000000
--- a/zbar/sample/src/main/res/values/colors.xml
+++ /dev/null
@@ -1,4 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<resources>    
-    <color name="actionbar_opacity">#DD000000</color>
-</resources>
\ No newline at end of file
diff --git a/zbar/sample/src/main/res/values/styles.xml b/zbar/sample/src/main/res/values/styles.xml
deleted file mode 100644
index 310d451..0000000
--- a/zbar/sample/src/main/res/values/styles.xml
+++ /dev/null
@@ -1,25 +0,0 @@
-<resources>
-    <style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
-    </style>
-
-    <!-- Base application theme. -->
-    <style name="AppOverlayTheme" parent="Theme.AppCompat.Light.DarkActionBar">
-        <!-- Customize your theme here. -->
-        <item name="android:windowActionBarOverlay">true</item>
-        <item name="android:actionBarStyle">@style/ActionBarStyle.Transparent</item>
-
-        <!-- Support library compatibility -->
-        <item name="windowActionBarOverlay">true</item>
-    </style>
-
-    <style name="ActionBarStyle.Transparent" parent="@android:Widget.ActionBar">
-        <item name="android:background">#99000000</item>
-        <item name="android:titleTextStyle">@style/ActionBarStyle.Transparent.TitleTextStyle</item>
-        <item name="android:backgroundSplit">#99000000</item>
-    </style>
-
-    <style name="ActionBarStyle.Transparent.TitleTextStyle" parent="@android:style/TextAppearance.Holo.Widget.ActionBar.Title">
-        <item name="android:textColor">@android:color/white</item>
-    </style>
-
-</resources>
diff --git a/zbar/zbar/src/main/AndroidManifest.xml b/zbar/src/main/AndroidManifest.xml
similarity index 100%
rename from zbar/zbar/src/main/AndroidManifest.xml
rename to zbar/src/main/AndroidManifest.xml
diff --git a/zbar/zbar/src/main/java/me/dm7/barcodescanner/zbar/BarcodeFormat.java b/zbar/src/main/java/me/dm7/barcodescanner/zbar/BarcodeFormat.java
similarity index 100%
rename from zbar/zbar/src/main/java/me/dm7/barcodescanner/zbar/BarcodeFormat.java
rename to zbar/src/main/java/me/dm7/barcodescanner/zbar/BarcodeFormat.java
diff --git a/zbar/zbar/src/main/java/me/dm7/barcodescanner/zbar/Result.java b/zbar/src/main/java/me/dm7/barcodescanner/zbar/Result.java
similarity index 100%
rename from zbar/zbar/src/main/java/me/dm7/barcodescanner/zbar/Result.java
rename to zbar/src/main/java/me/dm7/barcodescanner/zbar/Result.java
diff --git a/zbar/zbar/src/main/java/me/dm7/barcodescanner/zbar/ZBarScannerView.java b/zbar/src/main/java/me/dm7/barcodescanner/zbar/ZBarScannerView.java
similarity index 56%
rename from zbar/zbar/src/main/java/me/dm7/barcodescanner/zbar/ZBarScannerView.java
rename to zbar/src/main/java/me/dm7/barcodescanner/zbar/ZBarScannerView.java
index 71cf279..ea35913 100644
--- a/zbar/zbar/src/main/java/me/dm7/barcodescanner/zbar/ZBarScannerView.java
+++ b/zbar/src/main/java/me/dm7/barcodescanner/zbar/ZBarScannerView.java
@@ -3,10 +3,12 @@
 import android.content.Context;
 import android.content.res.Configuration;
 import android.content.res.TypedArray;
-import android.graphics.Rect;
 import android.hardware.Camera;
+import android.os.Handler;
+import android.os.Looper;
 import android.text.TextUtils;
 import android.util.AttributeSet;
+import android.util.Log;
 
 import net.sourceforge.zbar.Config;
 import net.sourceforge.zbar.Image;
@@ -14,16 +16,15 @@
 import net.sourceforge.zbar.Symbol;
 import net.sourceforge.zbar.SymbolSet;
 
-import java.util.ArrayList;
 import java.util.Collection;
-import java.util.EnumMap;
 import java.util.List;
-import java.util.Map;
 
 import me.dm7.barcodescanner.core.BarcodeScannerView;
 import me.dm7.barcodescanner.core.DisplayUtils;
 
 public class ZBarScannerView extends BarcodeScannerView {
+    private static final String TAG = "ZBarScannerView";
+
     public interface ResultHandler {
         public void handleResult(Result rawResult);
     }
@@ -94,33 +95,36 @@ public void setupScanner() {
 
     @Override
     public void onPreviewFrame(byte[] data, Camera camera) {
-        Camera.Parameters parameters = camera.getParameters();
-        Camera.Size size = parameters.getPreviewSize();
-        int width = size.width;
-        int height = size.height;
-
-        if(DisplayUtils.getScreenOrientation(getContext()) == Configuration.ORIENTATION_PORTRAIT) {
-            byte[] rotatedData = new byte[data.length];
-            for (int y = 0; y < height; y++) {
-                for (int x = 0; x < width; x++)
-                    rotatedData[x * height + height - y - 1] = data[x + y * width];
-            }
-            int tmp = width;
-            width = height;
-            height = tmp;
-            data = rotatedData;
+        if(mResultHandler == null) {
+            return;
         }
 
-        Image barcode = new Image(width, height, "Y800");
-        barcode.setData(data);
+        try {
+            Camera.Parameters parameters = camera.getParameters();
+            Camera.Size size = parameters.getPreviewSize();
+            int width = size.width;
+            int height = size.height;
+
+            if(DisplayUtils.getScreenOrientation(getContext()) == Configuration.ORIENTATION_PORTRAIT) {
+                byte[] rotatedData = new byte[data.length];
+                for (int y = 0; y < height; y++) {
+                    for (int x = 0; x < width; x++)
+                        rotatedData[x * height + height - y - 1] = data[x + y * width];
+                }
+                int tmp = width;
+                width = height;
+                height = tmp;
+                data = rotatedData;
+            }
+
+            Image barcode = new Image(width, height, "Y800");
+            barcode.setData(data);
 
-        int result = mScanner.scanImage(barcode);
+            int result = mScanner.scanImage(barcode);
 
-        if (result != 0) {
-            stopCamera();
-            if(mResultHandler != null) {
+            if (result != 0) {
                 SymbolSet syms = mScanner.getResults();
-                Result rawResult = new Result();
+                final Result rawResult = new Result();
                 for (Symbol sym : syms) {
                     String symData = sym.getData();
                     if (!TextUtils.isEmpty(symData)) {
@@ -129,10 +133,34 @@ public void onPreviewFrame(byte[] data, Camera camera) {
                         break;
                     }
                 }
-                mResultHandler.handleResult(rawResult);
+
+                Handler handler = new Handler(Looper.getMainLooper());
+                handler.post(new Runnable() {
+                    @Override
+                    public void run() {
+                        // Stopping the preview can take a little long.
+                        // So we want to set result handler to null to discard subsequent calls to
+                        // onPreviewFrame.
+                        ResultHandler tmpResultHandler = mResultHandler;
+                        mResultHandler = null;
+                        
+                        stopCameraPreview();
+                        if (tmpResultHandler != null) {
+                            tmpResultHandler.handleResult(rawResult);
+                        }
+                    }
+                });
+            } else {
+                camera.setOneShotPreviewCallback(this);
             }
-        } else {
-            camera.setOneShotPreviewCallback(this);
+        } catch(RuntimeException e) {
+            // TODO: Terrible hack. It is possible that this method is invoked after camera is released.
+            Log.e(TAG, e.toString(), e);
         }
     }
-}
\ No newline at end of file
+
+    public void resumeCameraPreview(ResultHandler resultHandler) {
+        mResultHandler = resultHandler;
+        super.resumeCameraPreview();
+    }
+}
diff --git a/zbar/zbar/src/main/jniLibs/arm64-v8a/libiconv.so b/zbar/src/main/jniLibs/arm64-v8a/libiconv.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/arm64-v8a/libiconv.so
rename to zbar/src/main/jniLibs/arm64-v8a/libiconv.so
diff --git a/zbar/zbar/src/main/jniLibs/arm64-v8a/libzbarjni.so b/zbar/src/main/jniLibs/arm64-v8a/libzbarjni.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/arm64-v8a/libzbarjni.so
rename to zbar/src/main/jniLibs/arm64-v8a/libzbarjni.so
diff --git a/zbar/zbar/src/main/jniLibs/armeabi-v7a/libiconv.so b/zbar/src/main/jniLibs/armeabi-v7a/libiconv.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/armeabi-v7a/libiconv.so
rename to zbar/src/main/jniLibs/armeabi-v7a/libiconv.so
diff --git a/zbar/zbar/src/main/jniLibs/armeabi-v7a/libzbarjni.so b/zbar/src/main/jniLibs/armeabi-v7a/libzbarjni.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/armeabi-v7a/libzbarjni.so
rename to zbar/src/main/jniLibs/armeabi-v7a/libzbarjni.so
diff --git a/zbar/zbar/src/main/jniLibs/armeabi/libiconv.so b/zbar/src/main/jniLibs/armeabi/libiconv.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/armeabi/libiconv.so
rename to zbar/src/main/jniLibs/armeabi/libiconv.so
diff --git a/zbar/zbar/src/main/jniLibs/armeabi/libzbarjni.so b/zbar/src/main/jniLibs/armeabi/libzbarjni.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/armeabi/libzbarjni.so
rename to zbar/src/main/jniLibs/armeabi/libzbarjni.so
diff --git a/zbar/zbar/src/main/jniLibs/mips/libiconv.so b/zbar/src/main/jniLibs/mips/libiconv.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/mips/libiconv.so
rename to zbar/src/main/jniLibs/mips/libiconv.so
diff --git a/zbar/zbar/src/main/jniLibs/mips/libzbarjni.so b/zbar/src/main/jniLibs/mips/libzbarjni.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/mips/libzbarjni.so
rename to zbar/src/main/jniLibs/mips/libzbarjni.so
diff --git a/zbar/zbar/src/main/jniLibs/mips64/libiconv.so b/zbar/src/main/jniLibs/mips64/libiconv.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/mips64/libiconv.so
rename to zbar/src/main/jniLibs/mips64/libiconv.so
diff --git a/zbar/zbar/src/main/jniLibs/mips64/libzbarjni.so b/zbar/src/main/jniLibs/mips64/libzbarjni.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/mips64/libzbarjni.so
rename to zbar/src/main/jniLibs/mips64/libzbarjni.so
diff --git a/zbar/zbar/src/main/jniLibs/x86/libiconv.so b/zbar/src/main/jniLibs/x86/libiconv.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/x86/libiconv.so
rename to zbar/src/main/jniLibs/x86/libiconv.so
diff --git a/zbar/zbar/src/main/jniLibs/x86/libzbarjni.so b/zbar/src/main/jniLibs/x86/libzbarjni.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/x86/libzbarjni.so
rename to zbar/src/main/jniLibs/x86/libzbarjni.so
diff --git a/zbar/zbar/src/main/jniLibs/x86_64/libiconv.so b/zbar/src/main/jniLibs/x86_64/libiconv.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/x86_64/libiconv.so
rename to zbar/src/main/jniLibs/x86_64/libiconv.so
diff --git a/zbar/zbar/src/main/jniLibs/x86_64/libzbarjni.so b/zbar/src/main/jniLibs/x86_64/libzbarjni.so
similarity index 100%
rename from zbar/zbar/src/main/jniLibs/x86_64/libzbarjni.so
rename to zbar/src/main/jniLibs/x86_64/libzbarjni.so
diff --git a/zbar/zbar/src/main/res/values/attrs.xml b/zbar/src/main/res/values/attrs.xml
similarity index 93%
rename from zbar/zbar/src/main/res/values/attrs.xml
rename to zbar/src/main/res/values/attrs.xml
index 21d855f..cf10571 100644
--- a/zbar/zbar/src/main/res/values/attrs.xml
+++ b/zbar/src/main/res/values/attrs.xml
@@ -3,4 +3,4 @@
     <declare-styleable name="ZBarScannerView">
         <attr name="stretchCameraToFill" format="boolean" />
     </declare-styleable>
-</resources>
\ No newline at end of file
+</resources>
diff --git a/zxing/sample/build.gradle b/zxing-sample/build.gradle
similarity index 50%
rename from zxing/sample/build.gradle
rename to zxing-sample/build.gradle
index 702d1dc..df58fbb 100644
--- a/zxing/sample/build.gradle
+++ b/zxing-sample/build.gradle
@@ -1,10 +1,11 @@
 apply plugin: 'com.android.application'
 
 dependencies {
-    //compile project(":zxing:zxing")
-    compile 'me.dm7.barcodescanner:zxing:1.8.3'
+    compile project(":zxing")
+    //compile 'me.dm7.barcodescanner:zxing:1.8.4'
     compile supportLibraryDependency
-    compile 'com.android.support:appcompat-v7:23.0.1'
+    compile 'com.android.support:appcompat-v7:23.1.1'
+    compile 'com.android.support:design:23.1.1'
 }
 
 android {
diff --git a/zxing/sample/src/main/AndroidManifest.xml b/zxing-sample/src/main/AndroidManifest.xml
similarity index 91%
rename from zxing/sample/src/main/AndroidManifest.xml
rename to zxing-sample/src/main/AndroidManifest.xml
index 269e607..3ae7e18 100644
--- a/zxing/sample/src/main/AndroidManifest.xml
+++ b/zxing-sample/src/main/AndroidManifest.xml
@@ -15,7 +15,7 @@
             </intent-filter>
         </activity>
 
-        <activity android:name=".ScannerActivity"
+        <activity android:name=".FullScannerActivity"
                   android:theme="@style/AppOverlayTheme"
                   android:uiOptions="splitActionBarWhenNarrow"
                   android:label="@string/scanner_activity">
@@ -23,7 +23,7 @@
                        android:value="splitActionBarWhenNarrow" />
         </activity>
 
-        <activity android:name=".ScannerFragmentActivity"
+        <activity android:name=".FullScannerFragmentActivity"
                   android:theme="@style/AppOverlayTheme"
                   android:uiOptions="splitActionBarWhenNarrow"
                   android:label="@string/scanner_fragment_activity">
@@ -42,7 +42,7 @@
         </activity>
 
         <activity android:name=".FullScreenScannerFragmentActivity"
-                android:theme="@style/AppFullScreenTheme"
+                  android:theme="@style/AppOverlayTheme"
                 android:label="@string/full_screen_scanner_fragment_activity">
           </activity>
     </application>
diff --git a/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/BaseScannerActivity.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/BaseScannerActivity.java
new file mode 100644
index 0000000..ed80d56
--- /dev/null
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/BaseScannerActivity.java
@@ -0,0 +1,28 @@
+package me.dm7.barcodescanner.zxing.sample;
+
+import android.support.v7.app.ActionBar;
+import android.support.v7.app.AppCompatActivity;
+import android.support.v7.widget.Toolbar;
+import android.view.MenuItem;
+
+public class BaseScannerActivity extends AppCompatActivity {
+    public void setupToolbar() {
+        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
+        setSupportActionBar(toolbar);
+        final ActionBar ab = getSupportActionBar();
+        if(ab != null) {
+            ab.setDisplayHomeAsUpEnabled(true);
+        }
+    }
+
+    @Override
+    public boolean onOptionsItemSelected(MenuItem item) {
+        switch (item.getItemId()) {
+            // Respond to the action bar's Up/Home button
+            case android.R.id.home:
+                finish();
+                return true;
+        }
+        return super.onOptionsItemSelected(item);
+    }
+}
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/CameraSelectorDialogFragment.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/CameraSelectorDialogFragment.java
similarity index 100%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/CameraSelectorDialogFragment.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/CameraSelectorDialogFragment.java
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FormatSelectorDialogFragment.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FormatSelectorDialogFragment.java
similarity index 100%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FormatSelectorDialogFragment.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FormatSelectorDialogFragment.java
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerActivity.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerActivity.java
similarity index 93%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerActivity.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerActivity.java
index e656d1f..ec15b78 100644
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerActivity.java
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerActivity.java
@@ -7,9 +7,9 @@
 import android.support.v4.app.DialogFragment;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.view.MenuItemCompat;
-import android.support.v7.app.ActionBarActivity;
 import android.view.Menu;
 import android.view.MenuItem;
+import android.view.ViewGroup;
 
 import com.google.zxing.BarcodeFormat;
 import com.google.zxing.Result;
@@ -19,7 +19,7 @@
 
 import me.dm7.barcodescanner.zxing.ZXingScannerView;
 
-public class ScannerActivity extends ActionBarActivity implements MessageDialogFragment.MessageDialogListener,
+public class FullScannerActivity extends BaseScannerActivity implements MessageDialogFragment.MessageDialogListener,
         ZXingScannerView.ResultHandler, FormatSelectorDialogFragment.FormatSelectorDialogListener,
         CameraSelectorDialogFragment.CameraSelectorDialogListener {
     private static final String FLASH_STATE = "FLASH_STATE";
@@ -47,9 +47,13 @@ public void onCreate(Bundle state) {
             mCameraId = -1;
         }
 
+        setContentView(R.layout.activity_simple_scanner);
+        setupToolbar();
+
+        ViewGroup contentFrame = (ViewGroup) findViewById(R.id.content_frame);
         mScannerView = new ZXingScannerView(this);
         setupFormats();
-        setContentView(mScannerView);
+        contentFrame.addView(mScannerView);
     }
 
     @Override
@@ -79,7 +83,7 @@ public boolean onCreateOptionsMenu(Menu menu) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_flash, 0, R.string.flash_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
 
         if(mAutoFocus) {
@@ -87,13 +91,13 @@ public boolean onCreateOptionsMenu(Menu menu) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_auto_focus, 0, R.string.auto_focus_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_formats, 0, R.string.formats);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_camera_selector, 0, R.string.select_camera);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         return super.onCreateOptionsMenu(menu);
     }
@@ -168,9 +172,7 @@ public void closeDialog(String dialogName) {
     @Override
     public void onDialogPositiveClick(DialogFragment dialog) {
         // Resume the camera
-        mScannerView.startCamera(mCameraId);
-        mScannerView.setFlash(mFlash);
-        mScannerView.setAutoFocus(mAutoFocus);
+        mScannerView.resumeCameraPreview(this);
     }
 
     @Override
@@ -211,4 +213,4 @@ public void onPause() {
         closeMessageDialog();
         closeFormatsDialog();
     }
-}
\ No newline at end of file
+}
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerFragment.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerFragment.java
similarity index 96%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerFragment.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerFragment.java
index 6ee13a2..fc22686 100644
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerFragment.java
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerFragment.java
@@ -23,7 +23,7 @@
 
 import me.dm7.barcodescanner.zxing.ZXingScannerView;
 
-public class ScannerFragment extends Fragment implements MessageDialogFragment.MessageDialogListener,
+public class FullScannerFragment extends Fragment implements MessageDialogFragment.MessageDialogListener,
         ZXingScannerView.ResultHandler, FormatSelectorDialogFragment.FormatSelectorDialogListener,
         CameraSelectorDialogFragment.CameraSelectorDialogListener {
     private static final String FLASH_STATE = "FLASH_STATE";
@@ -70,7 +70,7 @@ public void onCreateOptionsMenu (Menu menu, MenuInflater inflater) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_flash, 0, R.string.flash_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
 
         if(mAutoFocus) {
@@ -78,13 +78,13 @@ public void onCreateOptionsMenu (Menu menu, MenuInflater inflater) {
         } else {
             menuItem = menu.add(Menu.NONE, R.id.menu_auto_focus, 0, R.string.auto_focus_off);
         }
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_formats, 0, R.string.formats);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
 
         menuItem = menu.add(Menu.NONE, R.id.menu_camera_selector, 0, R.string.select_camera);
-        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_ALWAYS);
+        MenuItemCompat.setShowAsAction(menuItem, MenuItem.SHOW_AS_ACTION_NEVER);
     }
 
     @Override
@@ -175,9 +175,7 @@ public void closeDialog(String dialogName) {
     @Override
     public void onDialogPositiveClick(DialogFragment dialog) {
         // Resume the camera
-        mScannerView.startCamera(mCameraId);
-        mScannerView.setFlash(mFlash);
-        mScannerView.setAutoFocus(mAutoFocus);
+        mScannerView.resumeCameraPreview(this);
     }
 
     @Override
diff --git a/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerFragmentActivity.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerFragmentActivity.java
new file mode 100644
index 0000000..16839e7
--- /dev/null
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScannerFragmentActivity.java
@@ -0,0 +1,12 @@
+package me.dm7.barcodescanner.zxing.sample;
+
+import android.os.Bundle;
+
+public class FullScannerFragmentActivity extends BaseScannerActivity {
+    @Override
+    public void onCreate(Bundle state) {
+        super.onCreate(state);
+        setContentView(R.layout.activity_full_scanner_fragment);
+        setupToolbar();
+    }
+}
\ No newline at end of file
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScreenScannerFragmentActivity.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScreenScannerFragmentActivity.java
similarity index 68%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScreenScannerFragmentActivity.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScreenScannerFragmentActivity.java
index 82c5e67..886e38e 100644
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScreenScannerFragmentActivity.java
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/FullScreenScannerFragmentActivity.java
@@ -2,9 +2,9 @@
 
 
 import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
+import android.support.v7.app.AppCompatActivity;
 
-public class FullScreenScannerFragmentActivity extends ActionBarActivity {
+public class FullScreenScannerFragmentActivity extends AppCompatActivity {
     @Override
     public void onCreate(Bundle state) {
         super.onCreate(state);
diff --git a/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MainActivity.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MainActivity.java
new file mode 100644
index 0000000..912b2f9
--- /dev/null
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MainActivity.java
@@ -0,0 +1,77 @@
+package me.dm7.barcodescanner.zxing.sample;
+
+import android.Manifest;
+import android.content.Intent;
+import android.content.pm.PackageManager;
+import android.os.Bundle;
+import android.support.v4.app.ActivityCompat;
+import android.support.v4.content.ContextCompat;
+import android.support.v7.app.AppCompatActivity;
+import android.support.v7.widget.Toolbar;
+import android.view.View;
+import android.widget.Toast;
+
+public class MainActivity extends AppCompatActivity {
+    private static final int ZXING_CAMERA_PERMISSION = 1;
+    private Class<?> mClss;
+
+    @Override
+    public void onCreate(Bundle state) {
+        super.onCreate(state);
+        setContentView(R.layout.activity_main);
+        setupToolbar();
+    }
+
+    public void setupToolbar() {
+        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
+        setSupportActionBar(toolbar);
+    }
+
+    public void launchSimpleActivity(View v) {
+        launchActivity(SimpleScannerActivity.class);
+    }
+
+    public void launchSimpleFragmentActivity(View v) {
+        launchActivity(SimpleScannerFragmentActivity.class);
+    }
+
+    public void launchFullActivity(View v) {
+        launchActivity(FullScannerActivity.class);
+    }
+
+    public void launchFullFragmentActivity(View v) {
+        launchActivity(FullScannerFragmentActivity.class);
+    }
+
+    public void launchFullScreenScannerFragmentActivity(View v) {
+        launchActivity(FullScreenScannerFragmentActivity.class);
+    }
+
+    public void launchActivity(Class<?> clss) {
+        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)
+                != PackageManager.PERMISSION_GRANTED) {
+            mClss = clss;
+            ActivityCompat.requestPermissions(this,
+                    new String[]{Manifest.permission.CAMERA}, ZXING_CAMERA_PERMISSION);
+        } else {
+            Intent intent = new Intent(this, clss);
+            startActivity(intent);
+        }
+    }
+
+    @Override
+    public void onRequestPermissionsResult(int requestCode,  String permissions[], int[] grantResults) {
+        switch (requestCode) {
+            case ZXING_CAMERA_PERMISSION:
+                if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
+                    if(mClss != null) {
+                        Intent intent = new Intent(this, mClss);
+                        startActivity(intent);
+                    }
+                } else {
+                    Toast.makeText(this, "Please grant camera permission to use the QR Scanner", Toast.LENGTH_SHORT).show();
+                }
+                return;
+        }
+    }
+}
\ No newline at end of file
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MessageDialogFragment.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MessageDialogFragment.java
similarity index 100%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MessageDialogFragment.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MessageDialogFragment.java
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerActivity.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerActivity.java
similarity index 72%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerActivity.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerActivity.java
index 079898e..a34b779 100644
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerActivity.java
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerActivity.java
@@ -6,9 +6,16 @@
 import android.graphics.Paint;
 import android.graphics.Rect;
 import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
+import android.os.Handler;
+import android.support.v4.app.NavUtils;
+import android.support.v7.app.ActionBar;
+import android.support.v7.app.AppCompatActivity;
+import android.support.v7.widget.Toolbar;
 import android.util.AttributeSet;
 import android.util.TypedValue;
+import android.view.MenuItem;
+import android.view.View;
+import android.view.ViewGroup;
 import android.widget.Toast;
 
 import com.google.zxing.Result;
@@ -17,19 +24,23 @@
 import me.dm7.barcodescanner.core.ViewFinderView;
 import me.dm7.barcodescanner.zxing.ZXingScannerView;
 
-public class SimpleScannerActivity extends ActionBarActivity implements ZXingScannerView.ResultHandler {
+public class SimpleScannerActivity extends BaseScannerActivity implements ZXingScannerView.ResultHandler {
     private ZXingScannerView mScannerView;
 
     @Override
     public void onCreate(Bundle state) {
         super.onCreate(state);
+        setContentView(R.layout.activity_simple_scanner);
+        setupToolbar();
+
+        ViewGroup contentFrame = (ViewGroup) findViewById(R.id.content_frame);
         mScannerView = new ZXingScannerView(this) {
             @Override
             protected IViewFinder createViewFinderView(Context context) {
                 return new CustomViewFinderView(context);
             }
         };
-        setContentView(mScannerView);
+        contentFrame.addView(mScannerView);
     }
 
     @Override
@@ -49,7 +60,18 @@ public void onPause() {
     public void handleResult(Result rawResult) {
         Toast.makeText(this, "Contents = " + rawResult.getText() +
                 ", Format = " + rawResult.getBarcodeFormat().toString(), Toast.LENGTH_SHORT).show();
-        mScannerView.startCamera();
+
+        // Note:
+        // * Wait 2 seconds to resume the preview.
+        // * On older devices continuously stopping and resuming camera preview can result in freezing the app.
+        // * I don't know why this is the case but I don't have the time to figure out.
+        Handler handler = new Handler();
+        handler.postDelayed(new Runnable() {
+            @Override
+            public void run() {
+                mScannerView.resumeCameraPreview(SimpleScannerActivity.this);
+            }
+        }, 2000);
     }
 
     private static class CustomViewFinderView extends ViewFinderView {
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragment.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragment.java
similarity index 68%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragment.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragment.java
index 70816da..46196eb 100644
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragment.java
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragment.java
@@ -1,6 +1,7 @@
 package me.dm7.barcodescanner.zxing.sample;
 
 import android.os.Bundle;
+import android.os.Handler;
 import android.support.v4.app.Fragment;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -31,7 +32,17 @@ public void onResume() {
     public void handleResult(Result rawResult) {
         Toast.makeText(getActivity(), "Contents = " + rawResult.getText() +
                 ", Format = " + rawResult.getBarcodeFormat().toString(), Toast.LENGTH_SHORT).show();
-        mScannerView.startCamera();
+        // Note:
+        // * Wait 2 seconds to resume the preview.
+        // * On older devices continuously stopping and resuming camera preview can result in freezing the app.
+        // * I don't know why this is the case but I don't have the time to figure out.
+        Handler handler = new Handler();
+        handler.postDelayed(new Runnable() {
+            @Override
+            public void run() {
+                mScannerView.resumeCameraPreview(SimpleScannerFragment.this);
+            }
+        }, 2000);
     }
 
     @Override
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragmentActivity.java b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragmentActivity.java
similarity index 65%
rename from zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragmentActivity.java
rename to zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragmentActivity.java
index d182e22..e1778f9 100644
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragmentActivity.java
+++ b/zxing-sample/src/main/java/me/dm7/barcodescanner/zxing/sample/SimpleScannerFragmentActivity.java
@@ -1,12 +1,12 @@
 package me.dm7.barcodescanner.zxing.sample;
 
 import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
 
-public class SimpleScannerFragmentActivity extends ActionBarActivity {
+public class SimpleScannerFragmentActivity extends BaseScannerActivity {
     @Override
     public void onCreate(Bundle state) {
         super.onCreate(state);
         setContentView(R.layout.activity_simple_scanner_fragment);
+        setupToolbar();
     }
 }
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/drawable-hdpi/ic_launcher.png b/zxing-sample/src/main/res/drawable-hdpi/ic_launcher.png
similarity index 100%
rename from zxing/sample/src/main/res/drawable-hdpi/ic_launcher.png
rename to zxing-sample/src/main/res/drawable-hdpi/ic_launcher.png
diff --git a/zxing/sample/src/main/res/drawable-mdpi/ic_launcher.png b/zxing-sample/src/main/res/drawable-mdpi/ic_launcher.png
similarity index 100%
rename from zxing/sample/src/main/res/drawable-mdpi/ic_launcher.png
rename to zxing-sample/src/main/res/drawable-mdpi/ic_launcher.png
diff --git a/zxing/sample/src/main/res/drawable-xhdpi/ic_launcher.png b/zxing-sample/src/main/res/drawable-xhdpi/ic_launcher.png
similarity index 100%
rename from zxing/sample/src/main/res/drawable-xhdpi/ic_launcher.png
rename to zxing-sample/src/main/res/drawable-xhdpi/ic_launcher.png
diff --git a/zxing/sample/src/main/res/drawable-xxhdpi/ic_launcher.png b/zxing-sample/src/main/res/drawable-xxhdpi/ic_launcher.png
similarity index 100%
rename from zxing/sample/src/main/res/drawable-xxhdpi/ic_launcher.png
rename to zxing-sample/src/main/res/drawable-xxhdpi/ic_launcher.png
diff --git a/zxing-sample/src/main/res/layout/activity_full_scanner.xml b/zxing-sample/src/main/res/layout/activity_full_scanner.xml
new file mode 100644
index 0000000..eb66dd7
--- /dev/null
+++ b/zxing-sample/src/main/res/layout/activity_full_scanner.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <FrameLayout
+        android:id="@+id/content_frame"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zxing-sample/src/main/res/layout/activity_full_scanner_fragment.xml b/zxing-sample/src/main/res/layout/activity_full_scanner_fragment.xml
new file mode 100644
index 0000000..1d3c224
--- /dev/null
+++ b/zxing-sample/src/main/res/layout/activity_full_scanner_fragment.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <fragment android:name="me.dm7.barcodescanner.zxing.sample.FullScannerFragment"
+              android:id="@+id/scanner_fragment"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/layout/activity_full_screen_scanner_fragment.xml b/zxing-sample/src/main/res/layout/activity_full_screen_scanner_fragment.xml
similarity index 89%
rename from zxing/sample/src/main/res/layout/activity_full_screen_scanner_fragment.xml
rename to zxing-sample/src/main/res/layout/activity_full_screen_scanner_fragment.xml
index a852e5f..9cd7937 100644
--- a/zxing/sample/src/main/res/layout/activity_full_screen_scanner_fragment.xml
+++ b/zxing-sample/src/main/res/layout/activity_full_screen_scanner_fragment.xml
@@ -5,7 +5,7 @@
     android:orientation="vertical"
     android:layout_width="match_parent"
     android:layout_height="match_parent">
-    <fragment android:name="me.dm7.barcodescanner.zxing.sample.ScannerFragment"
+    <fragment android:name="me.dm7.barcodescanner.zxing.sample.FullScannerFragment"
         android:id="@+id/scanner_fragment"
         android:layout_width="match_parent"
         android:layout_height="match_parent" />
diff --git a/zxing-sample/src/main/res/layout/activity_main.xml b/zxing-sample/src/main/res/layout/activity_main.xml
new file mode 100644
index 0000000..7b2f3c1
--- /dev/null
+++ b/zxing-sample/src/main/res/layout/activity_main.xml
@@ -0,0 +1,46 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:orientation="vertical"
+    android:layout_width="fill_parent"
+    android:layout_height="fill_parent">
+    <android.support.design.widget.AppBarLayout
+        app:popupTheme="@style/ThemeOverlay.AppCompat.Light"
+        app:theme="@style/ThemeOverlay.AppCompat.Dark.ActionBar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content">
+        <android.support.v7.widget.Toolbar
+            android:id="@+id/toolbar"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"/>
+    </android.support.design.widget.AppBarLayout>
+
+    <LinearLayout
+              android:orientation="vertical"
+              android:layout_width="match_parent"
+              android:layout_height="match_parent"
+              android:gravity="center">
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/simple_activity_sample"
+                android:onClick="launchSimpleActivity" />
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/simple_fragment_sample"
+                android:onClick="launchSimpleFragmentActivity" />
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/activity_sample"
+                android:onClick="launchFullActivity" />
+        <Button android:layout_height="wrap_content"
+                android:layout_width="match_parent"
+                android:text="@string/fragment_sample"
+                android:onClick="launchFullFragmentActivity" />
+        <Button android:layout_height="wrap_content"
+            android:layout_width="match_parent"
+            android:text="@string/full_screen_sample"
+            android:onClick="launchFullScreenScannerFragmentActivity" />
+    </LinearLayout>
+</LinearLayout>
\ No newline at end of file
diff --git a/zxing-sample/src/main/res/layout/activity_simple_scanner.xml b/zxing-sample/src/main/res/layout/activity_simple_scanner.xml
new file mode 100644
index 0000000..eb66dd7
--- /dev/null
+++ b/zxing-sample/src/main/res/layout/activity_simple_scanner.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <FrameLayout
+        android:id="@+id/content_frame"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zxing-sample/src/main/res/layout/activity_simple_scanner_fragment.xml b/zxing-sample/src/main/res/layout/activity_simple_scanner_fragment.xml
new file mode 100644
index 0000000..e06d09e
--- /dev/null
+++ b/zxing-sample/src/main/res/layout/activity_simple_scanner_fragment.xml
@@ -0,0 +1,23 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<FrameLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <fragment android:name="me.dm7.barcodescanner.zxing.sample.SimpleScannerFragment"
+          android:id="@+id/scanner_fragment"
+          android:layout_weight="1"
+          android:layout_width="match_parent"
+          android:layout_height="match_parent" />
+
+    <android.support.v7.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_gravity="top"
+        android:minHeight="?attr/actionBarSize"
+        android:background="@color/actionbar_opacity"
+        app:theme="@style/TransparentToolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"/>
+</FrameLayout>
\ No newline at end of file
diff --git a/zxing-sample/src/main/res/values/colors.xml b/zxing-sample/src/main/res/values/colors.xml
new file mode 100644
index 0000000..f509d89
--- /dev/null
+++ b/zxing-sample/src/main/res/values/colors.xml
@@ -0,0 +1,12 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>    
+    <color name="actionbar_opacity">#33000000</color>
+    <color name="primary">#3F51B5</color>
+    <color name="primary_dark">#303F9F</color>
+    <color name="primary_light">#C5CAE9</color>
+    <color name="accent">#E040FB</color>
+    <color name="primary_text">#212121</color>
+    <color name="secondary_text">#727272</color>
+    <color name="icons">#FFFFFF</color>
+    <color name="divider">#B6B6B6</color>
+</resources>
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/values/ids.xml b/zxing-sample/src/main/res/values/ids.xml
similarity index 100%
rename from zxing/sample/src/main/res/values/ids.xml
rename to zxing-sample/src/main/res/values/ids.xml
diff --git a/zxing/sample/src/main/res/values/strings.xml b/zxing-sample/src/main/res/values/strings.xml
similarity index 100%
rename from zxing/sample/src/main/res/values/strings.xml
rename to zxing-sample/src/main/res/values/strings.xml
diff --git a/zxing-sample/src/main/res/values/styles.xml b/zxing-sample/src/main/res/values/styles.xml
new file mode 100644
index 0000000..abab8ed
--- /dev/null
+++ b/zxing-sample/src/main/res/values/styles.xml
@@ -0,0 +1,36 @@
+<resources>
+    <style name="AppTheme" parent="Theme.AppCompat.Light.NoActionBar">
+        <item name="colorPrimary">@color/primary</item>
+        <!-- darker variant for the status bar and contextual app bars -->
+        <item name="colorPrimaryDark">@color/primary_dark</item>
+        <!--   theme UI controls like checkboxes and text fields e.g. FloatActionButton -->
+        <item name="colorAccent">@color/accent</item>
+        <!-- Title Text Color -->
+        <item name="android:textColorPrimary">@color/primary_text</item>
+        <!-- color of the menu overflow icon (three vertical dots) -->
+        <item name="android:textColorSecondary">@color/secondary_text</item>
+    </style>
+
+    <style name="AppOverlayTheme" parent="@style/Theme.AppCompat.Light">
+        <item name="windowNoTitle">true</item>
+        <item name="windowActionBar">false</item>
+        <item name="android:windowFullscreen">true</item>
+        <item name="android:windowContentOverlay">@null</item>
+
+        <item name="colorPrimary">@color/primary</item>
+        <!-- darker variant for the status bar and contextual app bars -->
+        <item name="colorPrimaryDark">@color/primary_dark</item>
+        <!--   theme UI controls like checkboxes and text fields e.g. FloatActionButton -->
+        <item name="colorAccent">@color/accent</item>
+        <!-- Title Text Color -->
+        <item name="android:textColorPrimary">@color/primary_text</item>
+        <!-- color of the menu overflow icon (three vertical dots) -->
+        <item name="android:textColorSecondary">@color/secondary_text</item>
+    </style>
+
+    <style name="TransparentToolbar" parent="@style/ThemeOverlay.AppCompat.Dark.ActionBar">
+        <item name="android:windowActionBarOverlay">true</item>
+        <!-- Support Library compability -->
+        <item name="windowActionBarOverlay">true</item>
+    </style>
+</resources>
diff --git a/zxing/zxing/build.gradle b/zxing/build.gradle
similarity index 65%
rename from zxing/zxing/build.gradle
rename to zxing/build.gradle
index 9155dd0..1cf2916 100644
--- a/zxing/zxing/build.gradle
+++ b/zxing/build.gradle
@@ -9,13 +9,7 @@ ext {
 }
 
 dependencies {
-    //compile project(":core")
-    compile 'me.dm7.barcodescanner:core:1.8.3'
+    compile project(":core")
+    //compile 'me.dm7.barcodescanner:core:1.8.4'
     compile 'com.google.zxing:core:3.2.1'
 }
-
-android {
-    defaultConfig {
-        //applicationId "${project.group}.zxing"
-    }
-}
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MainActivity.java b/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MainActivity.java
deleted file mode 100644
index ffe6fca..0000000
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/MainActivity.java
+++ /dev/null
@@ -1,39 +0,0 @@
-package me.dm7.barcodescanner.zxing.sample;
-
-import android.content.Intent;
-import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
-import android.view.View;
-
-public class MainActivity extends ActionBarActivity {
-    @Override
-    public void onCreate(Bundle state) {
-        super.onCreate(state);
-        setContentView(R.layout.activity_main);
-    }
-
-    public void launchSimpleActivity(View v) {
-        Intent intent = new Intent(this, SimpleScannerActivity.class);
-        startActivity(intent);
-    }
-
-    public void launchSimpleFragmentActivity(View v) {
-        Intent intent = new Intent(this, SimpleScannerFragmentActivity.class);
-        startActivity(intent);
-    }
-
-    public void launchActivity(View v) {
-        Intent intent = new Intent(this, ScannerActivity.class);
-        startActivity(intent);
-    }
-
-    public void launchFragmentActivity(View v) {
-        Intent intent = new Intent(this, ScannerFragmentActivity.class);
-        startActivity(intent);
-    }
-
-    public void launchFullScreenScannerFragmentActivity(View v) {
-        Intent intent = new Intent(this, FullScreenScannerFragmentActivity.class);
-        startActivity(intent);
-    }
-}
\ No newline at end of file
diff --git a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerFragmentActivity.java b/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerFragmentActivity.java
deleted file mode 100644
index 92317b9..0000000
--- a/zxing/sample/src/main/java/me/dm7/barcodescanner/zxing/sample/ScannerFragmentActivity.java
+++ /dev/null
@@ -1,12 +0,0 @@
-package me.dm7.barcodescanner.zxing.sample;
-
-import android.os.Bundle;
-import android.support.v7.app.ActionBarActivity;
-
-public class ScannerFragmentActivity extends ActionBarActivity {
-    @Override
-    public void onCreate(Bundle state) {
-        super.onCreate(state);
-        setContentView(R.layout.activity_scanner_fragment);
-    }
-}
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/layout/activity_main.xml b/zxing/sample/src/main/res/layout/activity_main.xml
deleted file mode 100644
index 6743760..0000000
--- a/zxing/sample/src/main/res/layout/activity_main.xml
+++ /dev/null
@@ -1,29 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              xmlns:tools="http://schemas.android.com/tools"
-              android:orientation="vertical"
-              android:layout_width="match_parent"
-              android:layout_height="match_parent"
-              android:gravity="center">
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/simple_activity_sample"
-            android:onClick="launchSimpleActivity" />
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/simple_fragment_sample"
-            android:onClick="launchSimpleFragmentActivity" />
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/activity_sample"
-            android:onClick="launchActivity" />
-    <Button android:layout_height="wrap_content"
-            android:layout_width="match_parent"
-            android:text="@string/fragment_sample"
-            android:onClick="launchFragmentActivity" />
-    <Button android:layout_height="wrap_content"
-        android:layout_width="match_parent"
-        android:text="@string/full_screen_sample"
-        android:onClick="launchFullScreenScannerFragmentActivity" />
-</LinearLayout>
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/layout/activity_scanner_fragment.xml b/zxing/sample/src/main/res/layout/activity_scanner_fragment.xml
deleted file mode 100644
index 05ea74f..0000000
--- a/zxing/sample/src/main/res/layout/activity_scanner_fragment.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              xmlns:tools="http://schemas.android.com/tools"
-              android:orientation="vertical"
-              android:layout_width="match_parent"
-              android:layout_height="match_parent">
-    <fragment android:name="me.dm7.barcodescanner.zxing.sample.ScannerFragment"
-              android:id="@+id/scanner_fragment"
-              android:layout_weight="1"
-              android:layout_width="match_parent"
-              android:layout_height="0dip" />
-</LinearLayout>
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/layout/activity_simple_scanner_fragment.xml b/zxing/sample/src/main/res/layout/activity_simple_scanner_fragment.xml
deleted file mode 100644
index d56c4a1..0000000
--- a/zxing/sample/src/main/res/layout/activity_simple_scanner_fragment.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              xmlns:tools="http://schemas.android.com/tools"
-              android:orientation="vertical"
-              android:layout_width="match_parent"
-              android:layout_height="match_parent">
-    <fragment android:name="me.dm7.barcodescanner.zxing.sample.SimpleScannerFragment"
-              android:id="@+id/scanner_fragment"
-              android:layout_weight="1"
-              android:layout_width="match_parent"
-              android:layout_height="0dip" />
-</LinearLayout>
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/values/colors.xml b/zxing/sample/src/main/res/values/colors.xml
deleted file mode 100644
index 424abd1..0000000
--- a/zxing/sample/src/main/res/values/colors.xml
+++ /dev/null
@@ -1,4 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<resources>    
-    <color name="actionbar_opacity">#DD000000</color>
-</resources>
\ No newline at end of file
diff --git a/zxing/sample/src/main/res/values/styles.xml b/zxing/sample/src/main/res/values/styles.xml
deleted file mode 100644
index 515020e..0000000
--- a/zxing/sample/src/main/res/values/styles.xml
+++ /dev/null
@@ -1,32 +0,0 @@
-<resources>
-    <style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
-    </style>
-
-    <!-- Base application theme. -->
-    <style name="AppOverlayTheme" parent="Theme.AppCompat.Light.DarkActionBar">
-        <!-- Customize your theme here. -->
-        <item name="android:windowActionBarOverlay">true</item>
-        <item name="android:actionBarStyle">@style/ActionBarStyle.Transparent</item>
-
-        <!-- Support library compatibility -->
-        <item name="windowActionBarOverlay">true</item>
-    </style>
-
-    <style name="AppFullScreenTheme" parent="@style/Theme.AppCompat.Light.NoActionBar">
-        <item name="android:windowNoTitle">true</item>
-        <item name="windowActionBar">false</item>
-        <item name="android:windowFullscreen">true</item>
-        <item name="android:windowContentOverlay">@null</item>
-    </style>
-
-    <style name="ActionBarStyle.Transparent" parent="@android:Widget.ActionBar">
-        <item name="android:background">#99000000</item>
-        <item name="android:titleTextStyle">@style/ActionBarStyle.Transparent.TitleTextStyle</item>
-        <item name="android:backgroundSplit">#99000000</item>
-    </style>
-
-    <style name="ActionBarStyle.Transparent.TitleTextStyle" parent="@android:style/TextAppearance.Holo.Widget.ActionBar.Title">
-        <item name="android:textColor">@android:color/white</item>
-    </style>
-
-</resources>
diff --git a/zxing/zxing/src/main/AndroidManifest.xml b/zxing/src/main/AndroidManifest.xml
similarity index 100%
rename from zxing/zxing/src/main/AndroidManifest.xml
rename to zxing/src/main/AndroidManifest.xml
diff --git a/zxing/zxing/src/main/java/me/dm7/barcodescanner/zxing/ZXingScannerView.java b/zxing/src/main/java/me/dm7/barcodescanner/zxing/ZXingScannerView.java
similarity index 58%
rename from zxing/zxing/src/main/java/me/dm7/barcodescanner/zxing/ZXingScannerView.java
rename to zxing/src/main/java/me/dm7/barcodescanner/zxing/ZXingScannerView.java
index 05a3c1d..fd0462f 100644
--- a/zxing/zxing/src/main/java/me/dm7/barcodescanner/zxing/ZXingScannerView.java
+++ b/zxing/src/main/java/me/dm7/barcodescanner/zxing/ZXingScannerView.java
@@ -5,7 +5,10 @@
 import android.content.res.TypedArray;
 import android.graphics.Rect;
 import android.hardware.Camera;
+import android.os.Handler;
+import android.os.Looper;
 import android.util.AttributeSet;
+import android.util.Log;
 
 import com.google.zxing.BarcodeFormat;
 import com.google.zxing.BinaryBitmap;
@@ -26,6 +29,8 @@
 import me.dm7.barcodescanner.core.DisplayUtils;
 
 public class ZXingScannerView extends BarcodeScannerView {
+    private static final String TAG = "ZXingScannerView";
+
     public interface ResultHandler {
         public void handleResult(Result rawResult);
     }
@@ -105,51 +110,79 @@ private void initMultiFormatReader() {
 
     @Override
     public void onPreviewFrame(byte[] data, Camera camera) {
-        Camera.Parameters parameters = camera.getParameters();
-        Camera.Size size = parameters.getPreviewSize();
-        int width = size.width;
-        int height = size.height;
-
-        if(DisplayUtils.getScreenOrientation(getContext()) == Configuration.ORIENTATION_PORTRAIT) {
-            byte[] rotatedData = new byte[data.length];
-            for (int y = 0; y < height; y++) {
-                for (int x = 0; x < width; x++)
-                    rotatedData[x * height + height - y - 1] = data[x + y * width];
-            }
-            int tmp = width;
-            width = height;
-            height = tmp;
-            data = rotatedData;
+        if(mResultHandler == null) {
+            return;
         }
+        
+        try {
+            Camera.Parameters parameters = camera.getParameters();
+            Camera.Size size = parameters.getPreviewSize();
+            int width = size.width;
+            int height = size.height;
+
+            if (DisplayUtils.getScreenOrientation(getContext()) == Configuration.ORIENTATION_PORTRAIT) {
+                byte[] rotatedData = new byte[data.length];
+                for (int y = 0; y < height; y++) {
+                    for (int x = 0; x < width; x++)
+                        rotatedData[x * height + height - y - 1] = data[x + y * width];
+                }
+                int tmp = width;
+                width = height;
+                height = tmp;
+                data = rotatedData;
+            }
 
-        Result rawResult = null;
-        PlanarYUVLuminanceSource source = buildLuminanceSource(data, width, height);
-
-        if(source != null) {
-            BinaryBitmap bitmap = new BinaryBitmap(new HybridBinarizer(source));
-            try {
-                rawResult = mMultiFormatReader.decodeWithState(bitmap);
-            } catch (ReaderException re) {
-                // continue
-            } catch (NullPointerException npe) {
-                // This is terrible
-            } catch (ArrayIndexOutOfBoundsException aoe) {
-
-            } finally {
-                mMultiFormatReader.reset();
+            Result rawResult = null;
+            PlanarYUVLuminanceSource source = buildLuminanceSource(data, width, height);
+
+            if (source != null) {
+                BinaryBitmap bitmap = new BinaryBitmap(new HybridBinarizer(source));
+                try {
+                    rawResult = mMultiFormatReader.decodeWithState(bitmap);
+                } catch (ReaderException re) {
+                    // continue
+                } catch (NullPointerException npe) {
+                    // This is terrible
+                } catch (ArrayIndexOutOfBoundsException aoe) {
+
+                } finally {
+                    mMultiFormatReader.reset();
+                }
             }
-        }
 
-        if (rawResult != null) {
-            stopCamera();
-            if(mResultHandler != null) {
-                mResultHandler.handleResult(rawResult);
+            final Result finalRawResult = rawResult;
+
+            if (finalRawResult != null) {
+                Handler handler = new Handler(Looper.getMainLooper());
+                handler.post(new Runnable() {
+                    @Override
+                    public void run() {
+                        // Stopping the preview can take a little long.
+                        // So we want to set result handler to null to discard subsequent calls to
+                        // onPreviewFrame.
+                        ResultHandler tmpResultHandler = mResultHandler;
+                        mResultHandler = null;
+
+                        stopCameraPreview();
+                        if (tmpResultHandler != null) {
+                            tmpResultHandler.handleResult(finalRawResult);
+                        }
+                    }
+                });
+            } else {
+                camera.setOneShotPreviewCallback(this);
             }
-        } else {
-            camera.setOneShotPreviewCallback(this);
+        } catch(RuntimeException e) {
+            // TODO: Terrible hack. It is possible that this method is invoked after camera is released.
+            Log.e(TAG, e.toString(), e);
         }
     }
 
+    public void resumeCameraPreview(ResultHandler resultHandler) {
+        mResultHandler = resultHandler;
+        super.resumeCameraPreview();
+    }
+
     public PlanarYUVLuminanceSource buildLuminanceSource(byte[] data, int width, int height) {
         Rect rect = getFramingRectInPreview(width, height);
         if (rect == null) {
@@ -166,4 +199,4 @@ public PlanarYUVLuminanceSource buildLuminanceSource(byte[] data, int width, int
 
         return source;
     }
-}
\ No newline at end of file
+}
diff --git a/zxing/zxing/src/main/res/values/attrs.xml b/zxing/src/main/res/values/attrs.xml
similarity index 100%
rename from zxing/zxing/src/main/res/values/attrs.xml
rename to zxing/src/main/res/values/attrs.xml
