diff --git a/build.gradle b/build.gradle
index 94df0e4f..f65867b8 100644
--- a/build.gradle
+++ b/build.gradle
@@ -5,7 +5,7 @@ buildscript {
         jcenter()
     }
     dependencies {
-        classpath 'com.android.tools.build:gradle:1.0.0'
+        classpath 'com.android.tools.build:gradle-experimental:0.4.0'
     }
 }
 
diff --git a/gradle.properties b/gradle.properties
index 7647072e..1f728bd9 100644
--- a/gradle.properties
+++ b/gradle.properties
@@ -6,14 +6,11 @@ COMPILE_SDK_VERSION=22
 BUILD_TOOLS_VERSION=22.0.1
 TARGET_SDK_VERSION=22
 MIN_SDK_VERSION=8
-
+POM_DEVELOPER_NAME=Patrick Boos
+POM_LICENCE_URL=http\://www.apache.org/licenses/LICENSE-2.0.txt
 POM_DESCRIPTION=Image filters for Android with OpenGL (based on GPUImage for iOS)
-POM_URL=https://github.com/cyberagent/android-gpuimage
-POM_SCM_URL=scm:git@github.com:CyberAgent/android-gpuimage.git
-POM_SCM_CONNECTION=scm:git@github.com:CyberAgent/android-gpuimage.git
-POM_SCM_DEV_CONNECTION=scm:git@github.com:CyberAgent/android-gpuimage.git
 POM_LICENCE_NAME=The Apache Software License, Version 2.0
-POM_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt
-POM_LICENCE_DIST=repo
-POM_DEVELOPER_ID=pboos
-POM_DEVELOPER_NAME=Patrick Boos
+POM_SCM_DEV_CONNECTION=scm\:git@github.com\:CyberAgent/android-gpuimage.git
+POM_URL=https\://github.com/cyberagent/android-gpuimage
+POM_SCM_CONNECTION=scm\:git@github.com\:CyberAgent/android-gpuimage.git
+systemProp.http.proxyPort=1080
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index 2cd9fedd..5e0f0851 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -3,4 +3,4 @@ distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-2.2.1-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-2.8-all.zip
diff --git a/library/build.gradle b/library/build.gradle
index 3cd5e8c4..3cf52f39 100644
--- a/library/build.gradle
+++ b/library/build.gradle
@@ -1,61 +1,64 @@
-apply plugin: 'com.android.library'
+apply plugin: 'com.android.model.library'
 
-android {
-    compileSdkVersion COMPILE_SDK_VERSION as int
-    buildToolsVersion BUILD_TOOLS_VERSION
+model {
+    android {
+        compileSdkVersion = 23
+        buildToolsVersion = "23.0.0"
 
-    defaultConfig {
-        minSdkVersion MIN_SDK_VERSION as int
-        targetSdkVersion TARGET_SDK_VERSION as int
+        defaultConfig.with {
+            minSdkVersion.apiLevel = 15
+            targetSdkVersion.apiLevel = 23
 
-        versionCode = VERSION_CODE
-        versionName = VERSION_NAME
-
-        ndk {
-            moduleName "gpuimage-library"
-            stl "gnustl_shared"
-            abiFilters "all"
-            ldLibs "log"
+            versionCode = VERSION_CODE
+            versionName = VERSION_NAME
         }
     }
 
-    sourceSets {
-        main {
-            manifest.srcFile 'AndroidManifest.xml'
-            java.srcDirs = ['src']
-            resources.srcDirs = ['src']
-            aidl.srcDirs = ['src']
-            renderscript.srcDirs = ['src']
-            res.srcDirs = ['res']
-            assets.srcDirs = ['assets']
-            jni.srcDirs = ['jni']
-        }
+    android.ndk {
+        moduleName = "gpuimage-library"
+        stl = "gnustl_shared"
+        //abiFilters "all"
+        ldLibs.add("log")
 
-        instrumentTest.setRoot('tests')
     }
-
-    lintOptions {
-        abortOnError false
+    android.buildTypes {
+        release {
+            minifyEnabled = false
+            proguardFiles.add(file('proguard-rules.txt'))
+        }
     }
-
-    android.libraryVariants.all { variant ->
-        if (variant.buildType.isDebuggable()) {
-            return; // Skip debug builds.
+    android.productFlavors {
+        // for detailed abiFilter descriptions, refer to "Supported ABIs" @
+        // https://developer.android.com/ndk/guides/abis.html#sa
+        create("arm") {
+            ndk.abiFilters.add("armeabi")
         }
-        task("javadoc${variant.name.capitalize()}", type: Javadoc) {
-            description "Generates Javadoc for $variant.name."
-            source = variant.javaCompile.source
-            ext.androidJar = System.getenv("ANDROID_HOME") + "/platforms/${android.compileSdkVersion}/android.jar"
-            classpath = files(variant.javaCompile.classpath.files) + files(ext.androidJar)
+        create("arm7") {
+            ndk.abiFilters.add("armeabi-v7a")
         }
-
-        task("bundleJavadoc${variant.name.capitalize()}", type: Jar) {
-            description "Bundles Javadoc into zip for $variant.name."
-            classifier = "javadoc"
-            from tasks["javadoc${variant.name.capitalize()}"]
+        /*create("arm8") {
+            ndk.abiFilters.add("arm64-v8a")
         }
+        create("x86") {
+            ndk.abiFilters.add("x86")
+        }
+        create("x86-64") {
+            ndk.abiFilters.add("x86_64")
+        }
+        create("mips") {
+            ndk.abiFilters.add("mips")
+        }
+        create("mips-64") {
+            ndk.abiFilters.add("mips64")
+        }*/
+        // To include all cpu architectures, leaves abiFilters empty
+        create("all")
+    }
+
+    android.lintOptions {
+        abortOnError = false
     }
 }
 
-apply from: 'android-artifacts.gradle'
-apply from: 'central-publish.gradle'
\ No newline at end of file
+//apply from: 'android-artifacts.gradle'
+//apply from: 'central-publish.gradle'
\ No newline at end of file
diff --git a/library/AndroidManifest.xml b/library/src/main/AndroidManifest.xml
similarity index 100%
rename from library/AndroidManifest.xml
rename to library/src/main/AndroidManifest.xml
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImage.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImage.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImage.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImage.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImage3x3ConvolutionFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImage3x3ConvolutionFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImage3x3ConvolutionFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImage3x3ConvolutionFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImage3x3TextureSamplingFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImage3x3TextureSamplingFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImage3x3TextureSamplingFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImage3x3TextureSamplingFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageAddBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageAddBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageAddBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageAddBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageAlphaBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageAlphaBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageAlphaBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageAlphaBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageBoxBlurFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageBoxBlurFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageBoxBlurFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageBoxBlurFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageBrightnessFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageBrightnessFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageBrightnessFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageBrightnessFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageBulgeDistortionFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageBulgeDistortionFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageBulgeDistortionFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageBulgeDistortionFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageCGAColorspaceFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageCGAColorspaceFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageCGAColorspaceFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageCGAColorspaceFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageChromaKeyBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageChromaKeyBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageChromaKeyBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageChromaKeyBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorBalanceFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorBalanceFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorBalanceFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorBalanceFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorBurnBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorBurnBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorBurnBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorBurnBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorDodgeBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorDodgeBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorDodgeBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorDodgeBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorInvertFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorInvertFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorInvertFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorInvertFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorMatrixFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorMatrixFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageColorMatrixFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageColorMatrixFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageContrastFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageContrastFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageContrastFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageContrastFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageCrosshatchFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageCrosshatchFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageCrosshatchFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageCrosshatchFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageDarkenBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDarkenBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageDarkenBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDarkenBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageDifferenceBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDifferenceBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageDifferenceBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDifferenceBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageDilationFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDilationFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageDilationFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDilationFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageDirectionalSobelEdgeDetectionFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDirectionalSobelEdgeDetectionFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageDirectionalSobelEdgeDetectionFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDirectionalSobelEdgeDetectionFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageDissolveBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDissolveBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageDissolveBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDissolveBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageDivideBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDivideBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageDivideBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageDivideBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageEmbossFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageEmbossFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageEmbossFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageEmbossFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageExclusionBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageExclusionBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageExclusionBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageExclusionBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageExposureFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageExposureFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageExposureFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageExposureFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageFalseColorFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageFalseColorFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageFalseColorFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageFalseColorFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageFilterGroup.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageFilterGroup.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageFilterGroup.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageFilterGroup.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageGammaFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGammaFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageGammaFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGammaFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageGaussianBlurFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGaussianBlurFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageGaussianBlurFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGaussianBlurFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageGlassSphereFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGlassSphereFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageGlassSphereFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGlassSphereFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageGrayscaleFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGrayscaleFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageGrayscaleFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageGrayscaleFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageHardLightBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHardLightBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageHardLightBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHardLightBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageHazeFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHazeFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageHazeFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHazeFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageHighlightShadowFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHighlightShadowFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageHighlightShadowFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHighlightShadowFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageHueBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHueBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageHueBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHueBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageHueFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHueFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageHueFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageHueFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageKuwaharaFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageKuwaharaFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageKuwaharaFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageKuwaharaFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageLaplacianFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLaplacianFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageLaplacianFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLaplacianFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageLevelsFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLevelsFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageLevelsFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLevelsFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageLightenBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLightenBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageLightenBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLightenBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageLinearBurnBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLinearBurnBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageLinearBurnBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLinearBurnBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageLookupFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLookupFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageLookupFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLookupFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageLuminosityBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLuminosityBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageLuminosityBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageLuminosityBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageMixBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageMixBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageMixBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageMixBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageMonochromeFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageMonochromeFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageMonochromeFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageMonochromeFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageMultiplyBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageMultiplyBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageMultiplyBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageMultiplyBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageNativeLibrary.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageNativeLibrary.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageNativeLibrary.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageNativeLibrary.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageNonMaximumSuppressionFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageNonMaximumSuppressionFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageNonMaximumSuppressionFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageNonMaximumSuppressionFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageNormalBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageNormalBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageNormalBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageNormalBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageOpacityFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageOpacityFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageOpacityFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageOpacityFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageOverlayBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageOverlayBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageOverlayBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageOverlayBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImagePixelationFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImagePixelationFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImagePixelationFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImagePixelationFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImagePosterizeFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImagePosterizeFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImagePosterizeFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImagePosterizeFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageRGBDilationFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageRGBDilationFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageRGBDilationFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageRGBDilationFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageRGBFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageRGBFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageRGBFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageRGBFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageRenderer.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageRenderer.java
similarity index 88%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageRenderer.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageRenderer.java
index fd26a5f3..c755d57c 100644
--- a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageRenderer.java
+++ b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageRenderer.java
@@ -25,6 +25,7 @@
 import android.hardware.Camera.Size;
 import android.opengl.GLES20;
 import android.opengl.GLSurfaceView.Renderer;
+import android.util.Log;
 
 import jp.co.cyberagent.android.gpuimage.util.TextureRotationUtil;
 
@@ -36,12 +37,16 @@
 import java.nio.FloatBuffer;
 import java.nio.IntBuffer;
 import java.util.LinkedList;
+import java.util.Locale;
 import java.util.Queue;
+import java.util.concurrent.TimeUnit;
 
 import static jp.co.cyberagent.android.gpuimage.util.TextureRotationUtil.TEXTURE_NO_ROTATION;
 
 @TargetApi(11)
 public class GPUImageRenderer implements Renderer, PreviewCallback {
+
+    private static final String TAG = "GPUImageRenderer";
     public static final int NO_IMAGE = -1;
     static final float CUBE[] = {
             -1.0f, -1.0f,
@@ -91,6 +96,8 @@ public GPUImageRenderer(final GPUImageFilter filter) {
 
     @Override
     public void onSurfaceCreated(final GL10 unused, final EGLConfig config) {
+        Log.d(TAG, "onSurfaceCreated() called with: " + "unused = [" + unused + "], config = ["
+                + config + "]");
         GLES20.glDisable(GL10.GL_DITHER);
         GLES20.glClearColor(0,0,0,0);
         GLES20.glEnable(GL10.GL_CULL_FACE);
@@ -100,6 +107,8 @@ public void onSurfaceCreated(final GL10 unused, final EGLConfig config) {
 
     @Override
     public void onSurfaceChanged(final GL10 gl, final int width, final int height) {
+        Log.d(TAG, "onSurfaceChanged() called with: " + "gl = [" + gl + "], width = [" + width
+                + "], height = [" + height + "]");
         mOutputWidth = width;
         mOutputHeight = height;
         GLES20.glViewport(0, 0, width, height);
@@ -113,6 +122,7 @@ public void onSurfaceChanged(final GL10 gl, final int width, final int height) {
 
     @Override
     public void onDrawFrame(final GL10 gl) {
+        Log.d(TAG, "onDrawFrame() called with: " + "gl = [" + gl + "]");
         GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT | GLES20.GL_DEPTH_BUFFER_BIT);
         runAll(mRunOnDraw);
         mFilter.onDraw(mGLTextureId, mGLCubeBuffer, mGLTextureBuffer);
@@ -130,8 +140,11 @@ private void runAll(Queue<Runnable> queue) {
         }
     }
 
+
+
     @Override
     public void onPreviewFrame(final byte[] data, final Camera camera) {
+        Log.d(TAG, "onPreviewFrame() called with: " + "data = [" + data.length + "]");
         final Size previewSize = camera.getParameters().getPreviewSize();
         if (mGLRgbBuffer == null) {
             mGLRgbBuffer = IntBuffer.allocate(previewSize.width * previewSize.height);
@@ -140,8 +153,11 @@ public void onPreviewFrame(final byte[] data, final Camera camera) {
             runOnDraw(new Runnable() {
                 @Override
                 public void run() {
+                    long startT = System.nanoTime();
                     GPUImageNativeLibrary.YUVtoRBGA(data, previewSize.width, previewSize.height,
                             mGLRgbBuffer.array());
+                    Log.d(TAG, "YUVtoRBGA cost: " + TimeUnit.NANOSECONDS
+                            .toMillis(System.nanoTime() - startT));
                     mGLTextureId = OpenGlUtils.loadTexture(mGLRgbBuffer, previewSize, mGLTextureId);
                     camera.addCallbackBuffer(data);
 
@@ -339,4 +355,25 @@ protected void runOnDrawEnd(final Runnable runnable) {
             mRunOnDrawEnd.add(runnable);
         }
     }
+    private static String byteArrayToString(byte[] bytes) {
+        StringBuilder builder = new StringBuilder("[");
+        for (int i = 0; i < bytes.length && builder.length() < 20; i++) {
+            if (builder.length() > 20) {
+                return builder.append("] (" + i + ":" + bytes.length + ")").toString();
+            }
+            if (i > 0) {
+                builder.append(", ");
+            }
+            builder.append(byteToString(bytes[i]));
+        }
+        return builder.append(']').toString();
+    }
+
+    private static String byteToString(Byte b) {
+        if (b == null) {
+            return "null";
+        }
+        return "0x" + String.format("%02x", b).toUpperCase(Locale.US);
+    }
+
 }
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSaturationBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSaturationBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSaturationBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSaturationBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSaturationFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSaturationFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSaturationFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSaturationFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageScreenBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageScreenBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageScreenBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageScreenBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSepiaFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSepiaFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSepiaFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSepiaFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSharpenFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSharpenFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSharpenFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSharpenFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSketchFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSketchFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSketchFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSketchFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSmoothToonFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSmoothToonFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSmoothToonFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSmoothToonFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSobelEdgeDetection.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSobelEdgeDetection.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSobelEdgeDetection.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSobelEdgeDetection.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSobelThresholdFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSobelThresholdFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSobelThresholdFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSobelThresholdFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSoftLightBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSoftLightBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSoftLightBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSoftLightBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSourceOverBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSourceOverBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSourceOverBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSourceOverBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSphereRefractionFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSphereRefractionFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSphereRefractionFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSphereRefractionFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSubtractBlendFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSubtractBlendFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSubtractBlendFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSubtractBlendFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageSwirlFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSwirlFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageSwirlFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageSwirlFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageThresholdEdgeDetection.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageThresholdEdgeDetection.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageThresholdEdgeDetection.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageThresholdEdgeDetection.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageToneCurveFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageToneCurveFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageToneCurveFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageToneCurveFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageToonFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageToonFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageToonFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageToonFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageTwoInputFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageTwoInputFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageTwoInputFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageTwoInputFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassTextureSamplingFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassTextureSamplingFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassTextureSamplingFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageTwoPassTextureSamplingFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageView.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageView.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageView.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageView.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageVignetteFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageVignetteFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageVignetteFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageVignetteFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageWeakPixelInclusionFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageWeakPixelInclusionFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageWeakPixelInclusionFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageWeakPixelInclusionFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/GPUImageWhiteBalanceFilter.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageWhiteBalanceFilter.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/GPUImageWhiteBalanceFilter.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/GPUImageWhiteBalanceFilter.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/OpenGlUtils.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/OpenGlUtils.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/OpenGlUtils.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/OpenGlUtils.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/PixelBuffer.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/PixelBuffer.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/PixelBuffer.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/PixelBuffer.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/Rotation.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/Rotation.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/Rotation.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/Rotation.java
diff --git a/library/src/jp/co/cyberagent/android/gpuimage/util/TextureRotationUtil.java b/library/src/main/java/jp/co/cyberagent/android/gpuimage/util/TextureRotationUtil.java
similarity index 100%
rename from library/src/jp/co/cyberagent/android/gpuimage/util/TextureRotationUtil.java
rename to library/src/main/java/jp/co/cyberagent/android/gpuimage/util/TextureRotationUtil.java
diff --git a/library/jni/yuv-decoder.c b/library/src/main/jni/yuv-decoder.c
similarity index 100%
rename from library/jni/yuv-decoder.c
rename to library/src/main/jni/yuv-decoder.c
diff --git a/sample/build.gradle b/sample/build.gradle
index 5057072e..3f54845d 100644
--- a/sample/build.gradle
+++ b/sample/build.gradle
@@ -1,39 +1,36 @@
-apply plugin: 'com.android.application'
+apply plugin: 'com.android.model.application'
 
-android {
-    compileSdkVersion COMPILE_SDK_VERSION as int
-    buildToolsVersion BUILD_TOOLS_VERSION
+model {
+    android {
+        compileSdkVersion = 23
+        buildToolsVersion = "23.0.0"
 
-    defaultConfig {
-        minSdkVersion MIN_SDK_VERSION as int
-        targetSdkVersion TARGET_SDK_VERSION as int
-    }
-
-    sourceSets {
-        main {
-            manifest.srcFile 'AndroidManifest.xml'
-            java.srcDirs = ['src']
-            resources.srcDirs = ['src']
-            aidl.srcDirs = ['src']
-            renderscript.srcDirs = ['src']
-            res.srcDirs = ['res']
-            assets.srcDirs = ['assets']
+        defaultConfig.with {
+            minSdkVersion.apiLevel = 15
+            targetSdkVersion.apiLevel = 23
         }
+    }
 
-        instrumentTest.setRoot('tests')
+    compileOptions.with {
+        sourceCompatibility = JavaVersion.VERSION_1_7
+        targetCompatibility = JavaVersion.VERSION_1_7
     }
 
-    lintOptions {
-        abortOnError true
+    android.lintOptions {
+        abortOnError = false
     }
 }
 repositories {
     jcenter()
     maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
+    flatDir {
+        dirs '../library/build/outputs/aar'
+    }
 }
 
 dependencies {
     compile project(':library')
+    compile(name:'library-all-release', ext:'aar')
 //    compile 'jp.co.cyberagent.android.gpuimage:gpuimage-library:+@aar'
     compile 'com.android.support:support-v4:21.+'
 }
\ No newline at end of file
diff --git a/sample/AndroidManifest.xml b/sample/src/main/AndroidManifest.xml
similarity index 100%
rename from sample/AndroidManifest.xml
rename to sample/src/main/AndroidManifest.xml
diff --git a/sample/src/jp/co/cyberagent/android/gpuimage/sample/GPUImageFilterTools.java b/sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/GPUImageFilterTools.java
similarity index 100%
rename from sample/src/jp/co/cyberagent/android/gpuimage/sample/GPUImageFilterTools.java
rename to sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/GPUImageFilterTools.java
diff --git a/sample/src/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityCamera.java b/sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityCamera.java
similarity index 100%
rename from sample/src/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityCamera.java
rename to sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityCamera.java
diff --git a/sample/src/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityGallery.java b/sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityGallery.java
similarity index 100%
rename from sample/src/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityGallery.java
rename to sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityGallery.java
diff --git a/sample/src/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityMain.java b/sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityMain.java
similarity index 100%
rename from sample/src/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityMain.java
rename to sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/activity/ActivityMain.java
diff --git a/sample/src/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelper.java b/sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelper.java
similarity index 100%
rename from sample/src/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelper.java
rename to sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelper.java
diff --git a/sample/src/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperBase.java b/sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperBase.java
similarity index 100%
rename from sample/src/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperBase.java
rename to sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperBase.java
diff --git a/sample/src/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperGB.java b/sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperGB.java
similarity index 100%
rename from sample/src/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperGB.java
rename to sample/src/main/java/jp/co/cyberagent/android/gpuimage/sample/utils/CameraHelperGB.java
diff --git a/sample/res/drawable-hdpi/ic_action_search.png b/sample/src/main/res/drawable-hdpi/ic_action_search.png
similarity index 100%
rename from sample/res/drawable-hdpi/ic_action_search.png
rename to sample/src/main/res/drawable-hdpi/ic_action_search.png
diff --git a/sample/res/drawable-hdpi/ic_launcher.png b/sample/src/main/res/drawable-hdpi/ic_launcher.png
similarity index 100%
rename from sample/res/drawable-hdpi/ic_launcher.png
rename to sample/src/main/res/drawable-hdpi/ic_launcher.png
diff --git a/sample/res/drawable-hdpi/ic_switch_camera.png b/sample/src/main/res/drawable-hdpi/ic_switch_camera.png
similarity index 100%
rename from sample/res/drawable-hdpi/ic_switch_camera.png
rename to sample/src/main/res/drawable-hdpi/ic_switch_camera.png
diff --git a/sample/res/drawable-ldpi/ic_launcher.png b/sample/src/main/res/drawable-ldpi/ic_launcher.png
similarity index 100%
rename from sample/res/drawable-ldpi/ic_launcher.png
rename to sample/src/main/res/drawable-ldpi/ic_launcher.png
diff --git a/sample/res/drawable-mdpi/ic_action_search.png b/sample/src/main/res/drawable-mdpi/ic_action_search.png
similarity index 100%
rename from sample/res/drawable-mdpi/ic_action_search.png
rename to sample/src/main/res/drawable-mdpi/ic_action_search.png
diff --git a/sample/res/drawable-mdpi/ic_launcher.png b/sample/src/main/res/drawable-mdpi/ic_launcher.png
similarity index 100%
rename from sample/res/drawable-mdpi/ic_launcher.png
rename to sample/src/main/res/drawable-mdpi/ic_launcher.png
diff --git a/sample/res/drawable-nodpi/lookup_amatorka.png b/sample/src/main/res/drawable-nodpi/lookup_amatorka.png
similarity index 100%
rename from sample/res/drawable-nodpi/lookup_amatorka.png
rename to sample/src/main/res/drawable-nodpi/lookup_amatorka.png
diff --git a/sample/res/drawable-xhdpi/ic_action_search.png b/sample/src/main/res/drawable-xhdpi/ic_action_search.png
similarity index 100%
rename from sample/res/drawable-xhdpi/ic_action_search.png
rename to sample/src/main/res/drawable-xhdpi/ic_action_search.png
diff --git a/sample/res/drawable-xhdpi/ic_launcher.png b/sample/src/main/res/drawable-xhdpi/ic_launcher.png
similarity index 100%
rename from sample/res/drawable-xhdpi/ic_launcher.png
rename to sample/src/main/res/drawable-xhdpi/ic_launcher.png
diff --git a/sample/res/layout/activity_camera.xml b/sample/src/main/res/layout/activity_camera.xml
similarity index 100%
rename from sample/res/layout/activity_camera.xml
rename to sample/src/main/res/layout/activity_camera.xml
diff --git a/sample/res/layout/activity_gallery.xml b/sample/src/main/res/layout/activity_gallery.xml
similarity index 100%
rename from sample/res/layout/activity_gallery.xml
rename to sample/src/main/res/layout/activity_gallery.xml
diff --git a/sample/res/layout/activity_main.xml b/sample/src/main/res/layout/activity_main.xml
similarity index 100%
rename from sample/res/layout/activity_main.xml
rename to sample/src/main/res/layout/activity_main.xml
diff --git a/sample/res/raw/tone_cuver_sample.acv b/sample/src/main/res/raw/tone_cuver_sample.acv
similarity index 100%
rename from sample/res/raw/tone_cuver_sample.acv
rename to sample/src/main/res/raw/tone_cuver_sample.acv
diff --git a/sample/res/values-v11/styles.xml b/sample/src/main/res/values-v11/styles.xml
similarity index 100%
rename from sample/res/values-v11/styles.xml
rename to sample/src/main/res/values-v11/styles.xml
diff --git a/sample/res/values-v14/styles.xml b/sample/src/main/res/values-v14/styles.xml
similarity index 100%
rename from sample/res/values-v14/styles.xml
rename to sample/src/main/res/values-v14/styles.xml
diff --git a/sample/res/values/strings.xml b/sample/src/main/res/values/strings.xml
similarity index 100%
rename from sample/res/values/strings.xml
rename to sample/src/main/res/values/strings.xml
diff --git a/sample/res/values/styles.xml b/sample/src/main/res/values/styles.xml
similarity index 100%
rename from sample/res/values/styles.xml
rename to sample/src/main/res/values/styles.xml
diff --git a/settings.gradle b/settings.gradle
index 612d9e44..e6209efa 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -1,2 +1,2 @@
 include ':library'
-include ':sample'
+include ':sample'
\ No newline at end of file
