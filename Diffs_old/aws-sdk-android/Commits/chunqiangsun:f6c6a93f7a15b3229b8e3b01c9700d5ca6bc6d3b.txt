diff --git a/.circleci/config.yml b/.circleci/config.yml
index 4252507ee2..e3761126ce 100644
--- a/.circleci/config.yml
+++ b/.circleci/config.yml
@@ -30,8 +30,8 @@ jobs:
       - run:
           name: run unit tests
           command: |
-            bash ./gradlew --stop
-            python3 CircleciScripts/run_unittest.py test_results
+            currentfolder=$(pwd)
+            python3 CircleciScripts/run_unittest.py test_results "$currentfolder"
       - run:
           name : check unit test result 
           command : bash CircleciScripts/check_test_result.sh test_results
@@ -63,7 +63,14 @@ jobs:
       JVM_OPTS: -Xmx3200m     
     steps:
       - checkout   
-
+      - run: 
+          name: install json parser
+          command: |
+            sudo apt-get update
+            sudo apt-get -y install python3-pip
+      - run: 
+          name: install json parser
+          command: sudo pip3 install demjson
       - run:
           name: install aws cli
           command: |
@@ -78,18 +85,32 @@ jobs:
           name: set version
           command: |
             export release_tag=${CIRCLE_TAG}
-            export release_version=$(echo "$release_tag" | sed 's|.*v\([0-9\.]*\).*|\1|')
-            echo "version:$release_version"
+            echo "release_tag=$release_tag" >> $BASH_ENV
+            export release_version=$(echo "$release_tag" | sed 's|.*v\([0-9\.]*\).*|\1|') 
+            echo "release_version=$release_version" >> $BASH_ENV
       - run:
           name: generate documents
           command: |
             currentfolder=$(pwd)
-            python3 CircleciScripts/generatejavadoc.py CircleciScripts/ReleaseConfiguration.json /Users/sdechunq/Documents/github/android/bk/aws-sdk-android/  build/javadoc libs "$release_version"
+            python3 CircleciScripts/generatejavadoc.py CircleciScripts/ReleaseConfiguration.json "$currentfolder" build/javadoc libs "$release_version"
+      
+
       - run:
-          name: copy documents
+          name: check out gh-pages and preserve old document
           command: |
             git config --local user.name "${GITHUB_USER}"
             git checkout  gh-pages
+            git checkout master CircleciScripts/preserveolddocument.sh
+            set +e
+            bash CircleciScripts/preserveolddocument.sh
+      - run:
+          name: copy new document
+          command: |
+            cp -R build/javadoc/*   docs/reference/
+
+      - run:
+          name: check out gh-pages
+          command: |
             cp -R build/javadoc/*   docs/reference/
 
       - run:
@@ -97,7 +118,13 @@ jobs:
           command: |
             git add docs/reference
             git commit -m "AWS SDK for Android $release_version"
-            git push -q https://${GITHUB_TOKEN}@github.com/aws-amplify/aws-sdk-android.git  
+            git push -q https://${GITHUB_TOKEN}@github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}.git  
+      - save_cache:
+          key: API-Reference-{{ .Revision }}
+          paths:
+            - docs/reference/
+
+
 
   tag_doc:
     docker:
@@ -109,9 +136,10 @@ jobs:
       - run:
           name: Add documentation tags to gh-pages
           command: |
+            git config --local user.name "${GITHUB_USER}"
             git checkout  gh-pages
             git tag -a ${CIRCLE_TAG}_api_docs  -m "Add documentation tags to version ${CIRCLE_TAG}"            
-            git push --tags -q https://${GITHUB_TOKEN}@github.com/sunchunqiang/aws-sdk-android.git     
+            git push --tags -q https://${GITHUB_TOKEN}@github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}.git     
 
   release_maven:
     macos: 
@@ -174,61 +202,116 @@ jobs:
             echo "$M2_HOME"
             bash CircleciScripts/maven-release.sh
 
+  release_s3:
+    docker:
+      - image: circleci/android:api-27-alpha
+    environment:
+      JVM_OPTS: -Xmx1024m     
+    steps:
+      - checkout   
+      - run:
+          name: download sdk resource
+          command: |
+            version=2.10.0
+            sdkversion="aws-android-sdk-$version"
+            echo "sdkversion=$sdkversion" >> $BASH_ENV
+            git checkout resource aws-android-sdk
+            mv aws-android-sdk "$sdkversion"
+      - run:
+          name: copy libs
+          command:
+             bash gradlew build -x test
+             rootfolder=$(pwd)
+             python3 CircleciScripts/copylibs.py  "$sdkversion/lib"
+      - restore_cache:
+          key: API-Reference-{{ .Revision }}
+      - run:
+          name: copy documents
+          command: |
+            mkdir -p "$sdkversion/documentation/javadoc"
+            cp -R docs/reference/*  "$sdkversion/documentation/javadoc"
+      - run:
+          name: zip sdk folder
+            zip -r "$sdkversion.zip" "$sdkversion"
+      - run:
+          name: install aws cli
+          command: |
+            sudo pip install awscli
 
+      - run:
+          name: upload to s3
+          command: |
+            aws configure --profile android_stage set region us-east-1
+            echo -e "[android_stage]\naws_access_key_id=${AWS_ACCESS_KEY_ID_ANDROID}\naws_secret_access_key=${AWS_SECRET_ACCESS_KEY_ANDROID}\n" >> ~/.aws/credentials
+            aws s3 cp "$sdkversion.zip" s3:///mylistname/test  --profile android_stage          
 workflows:
   version: 2
-
-  
-  release_sdk:
+  version: 2
+  build_test:
     jobs: 
-      - build:
-          filters:
-            branches:
-              ignore: /.*/            
-            tags:
-              only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
-
+      - build 
       - unittest:
           requires:
             - build         
+ 
+  #   jobs: 
+  #     - build:
+  #         filters:
+  #           branches:
+  #             ignore: /.*/            
+  #           tags:
+  #             only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
+
+  #     - unittest:
+  #         requires:
+  #           - build         
+  #         filters:
+  #           branches:
+  #             ignore: /.*/            
+  #           tags:
+  #             only: /^release_v[0-9]+.[0-9]+.[0-9]+$/ 
+  release_sdk:
+    jobs:
+      - release_tag:                    
           filters:
             branches:
               ignore: /.*/            
             tags:
               only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
 
-      - release_tag:
+      - release_maven:    
           requires:
-            - unittest
+            - release_tag  
           filters:
             branches:
               ignore: /.*/            
             tags:
               only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
 
-      - release_maven:    
+      - release_javadoc:    
           requires:
-            - release_tag  
+            - release_maven  
           filters:
             branches:
               ignore: /.*/            
             tags:
               only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
 
-      - release_javadoc:    
+      - tag_doc:    
           requires:
-            - release_tag  
+            - release_javadoc  
           filters:
             branches:
               ignore: /.*/            
             tags:
               only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
 
-      - tag_doc:    
+      - release_s3:    
           requires:
             - release_javadoc  
           filters:
             branches:
               ignore: /.*/            
             tags:
-              only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
\ No newline at end of file
+              only: /^release_v[0-9]+.[0-9]+.[0-9]+$/
+
diff --git a/CircleciScripts/__pycache__/functions.cpython-37.pyc b/CircleciScripts/__pycache__/functions.cpython-37.pyc
new file mode 100644
index 0000000000..3ab6e78faf
Binary files /dev/null and b/CircleciScripts/__pycache__/functions.cpython-37.pyc differ
diff --git a/CircleciScripts/copylibs.py b/CircleciScripts/copylibs.py
new file mode 100644
index 0000000000..5605a1f3be
--- /dev/null
+++ b/CircleciScripts/copylibs.py
@@ -0,0 +1,27 @@
+import os
+import sys
+from functions import getmodules
+from functions import runcommand
+from shutil import copyfile
+
+root = sys.argv[1]
+dest = sys.argv[2]
+if not os.path.exists(dest):
+	os.makedirs(dest)
+modules = getmodules(root)
+print(modules)
+for module in modules:
+	print(module)
+	jarfile = os.path.join(root,module,"build/libs/{0}.jar".format(module))
+	if os.path.isfile(jarfile) :
+		destfile = os.path.join(dest, "{0}.jar".format(module))
+		copyfile(jarfile, destfile)
+	else:
+		aarfile = os.path.join(root,module,"build/outputs/aar/{0}-release.aar".format(module))
+		if os.path.isfile(aarfile) :
+			destfile = os.path.join(dest, "{0}.aar".format(module))
+			copyfile(aarfile, destfile)
+		else:
+			print("Did not find build result for {0}".format(module))
+			exit(1)
+
diff --git a/CircleciScripts/functions.py b/CircleciScripts/functions.py
index 388a1bbec7..464827dd16 100644
--- a/CircleciScripts/functions.py
+++ b/CircleciScripts/functions.py
@@ -6,6 +6,7 @@
 from datetime import datetime
 from enum import Enum
 from collections import namedtuple
+import re
 
 TestType  = namedtuple('TestType', ['value', 'testAction', 'displayString'])
 class TestTypes(Enum):
@@ -61,6 +62,18 @@ def runtest(module, testtype, results):
             return 1
 
     return 0
-   # xcprettyoutput.close()
+
+def getmodules(root):
+    with open(os.path.join(root, "settings.gradle")) as f:
+        lines = f.readlines()
+    modules = []
+    for line in lines:
+        m = re.match(".*':(aws-android-sdk-.*).*'", line)
+        if m is not None:
+            modules.append(m.group(1))
+        else:
+            print("{0} is not a sdk module ".format(line)) 
+    return modules ;
+
 
 
diff --git a/CircleciScripts/generatejavadoc.py b/CircleciScripts/generatejavadoc.py
index c48aeaef2a..a49054c06e 100644
--- a/CircleciScripts/generatejavadoc.py
+++ b/CircleciScripts/generatejavadoc.py
@@ -132,6 +132,8 @@ def copylib(root, modules, target):
 dest = sys.argv[3]
 libs = sys.argv[4]
 sdkVersion = sys.argv[5] 
+print("jsonfilename={0};root={1};dest={2};libs={3};sdkVersion={4}".format(jsonfilename,root,dest,libs,sdkVersion))
+
 with open(jsonfilename, 'r') as jsonfile:
     jsonstring = jsonfile.read()
 rootelement =  demjson.decode(jsonstring)
@@ -184,5 +186,5 @@ def copylib(root, modules, target):
 commandline = getCommandline(dest, root, modules, packages,sourthfiles, subpackages,excludes, groups, otheroptions, otherargs)
 returncode = runcommand(commandline)
 print("return code:" , returncode)
-exit(returndcode)
+exit(returncode)
 #print(commandline)
diff --git a/CircleciScripts/maven-release.sh b/CircleciScripts/maven-release.sh
index da9997e9b6..ba8709f96b 100644
--- a/CircleciScripts/maven-release.sh
+++ b/CircleciScripts/maven-release.sh
@@ -25,6 +25,10 @@ echo "enviroment:     ;  $sonatype_password  ;   "
 # Perm gen space is increased for maven command
 MAVEN_OPTS="-Xms1024m -Xmx2048m -XX:PermSize=512m -XX:MaxPermSize=1024m"
 
+gpg_keyname="D5503EEA"
+gpg_passphrase="%3kE}\LPf-8|F'D"
+sonatype_username="amazonwebservices"
+sonatype_password="qI@ia573\$0An"
 
 mvn clean deploy -X -e -Ppublishing \
     -f "$pom" \
diff --git a/CircleciScripts/preserveolddocument.sh b/CircleciScripts/preserveolddocument.sh
new file mode 100644
index 0000000000..574dff55c6
--- /dev/null
+++ b/CircleciScripts/preserveolddocument.sh
@@ -0,0 +1,36 @@
+echo "release_version=$release_version"
+grep -o "AWS SDK for Android - [0-9]\+.[0-9]\+.[0-9]*" docs/reference/allclasses-frame.html 
+previousversion=$(grep -o "AWS SDK for Android - [0-9]\+.[0-9]\+.[0-9]*" docs/reference/allclasses-frame.html | grep -o "[0-9]\+.[0-9]\+.[0-9]")
+echo "previousversion=$previousversion"
+previousminorversion=$(echo  "$previousversion" | sed  -e 's|[0-9]*\.\([0-9]*\)\.[0-9]*$|\1|')
+echo "previousminorversion=$previousminorversion"
+if [ "$previousversion" == "$previousminorversion" ]
+then
+    previousminorversion=""
+fi
+echo "previousminorversion=$previousminorversion"
+
+currentminorversion=$(echo  "$release_version" | sed  -e 's|[0-9]*\.\([0-9]*\)\.[0-9]*$|\1|')
+echo "currentminorversion=$currentminorversion"
+if [ "$release_version" == "$currentminorversion" ]
+then
+    currentminorversion=""
+fi
+echo "currentminorversion=$currentminorversion"
+if  [ -z "$currentminorversion" ] 
+then 
+    echo "currentminorversion is empty"
+    exit 1
+fi
+
+if [ "$previousminorversion" != "$currentminorversion" ] 
+then
+  echo "preserve current document to docs/$previousversion/reference"
+  mkdir -p  "docs/$previousversion"
+  mkdir -p "docs/$previousversion/reference"
+  cp -R  docs/reference/* docs/$previousversion/reference
+  git add "docs/$previousversion/reference"
+else 
+    echo "don't preserve old document"
+fi
+ls docs
\ No newline at end of file
diff --git a/CircleciScripts/run_unittest.py b/CircleciScripts/run_unittest.py
index 26700f4a6c..83d8c7d7d0 100644
--- a/CircleciScripts/run_unittest.py
+++ b/CircleciScripts/run_unittest.py
@@ -16,17 +16,18 @@
         print(line)
 
  
-testmodules = [
-    # "aws-android-sdk-sdb",
-    # "aws-android-sdk-polly",
-    "aws-android-sdk-kinesis" 
-    # "aws-android-sdk-pinpoint",
-    # "aws-android-sdk-ddb-mapper",
-    # "aws-android-sdk-mobileanalytics",
-    # "aws-android-sdk-core",
-    # "aws-android-sdk-lambda",
-    # "aws-android-sdk-s3"
-] 
+# testmodules = [
+#     # "aws-android-sdk-sdb",
+#     # "aws-android-sdk-polly",
+#     "aws-android-sdk-kinesis" 
+#     # "aws-android-sdk-pinpoint",
+#     # "aws-android-sdk-ddb-mapper",
+#     # "aws-android-sdk-mobileanalytics",
+#     # "aws-android-sdk-core",
+#     # "aws-android-sdk-lambda",
+#     # "aws-android-sdk-s3"
+# ] 
+
  
 test_results = sys.argv[1]
 runcommand("rm -rf {0}".format(test_results))
diff --git a/aws-android-sdk-auth-core/pom.xml b/aws-android-sdk-auth-core/pom.xml
index 88315f4283..7194362ba8 100644
--- a/aws-android-sdk-auth-core/pom.xml
+++ b/aws-android-sdk-auth-core/pom.xml
@@ -49,8 +49,8 @@
         <extensions>true</extensions>
         <configuration>
           <sdk>
-            <platform>11</platform>
-            <buildTools>19.1.0</buildTools>
+            <platform>${env.ANDROID_PLATFORM}</platform>
+            <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
           </sdk>
         </configuration>
       </plugin>
diff --git a/aws-android-sdk-auth-facebook/pom.xml b/aws-android-sdk-auth-facebook/pom.xml
index ae1855bd02..92bcb87ebc 100644
--- a/aws-android-sdk-auth-facebook/pom.xml
+++ b/aws-android-sdk-auth-facebook/pom.xml
@@ -80,8 +80,8 @@
         <extensions>true</extensions>
         <configuration>
           <sdk>
-            <platform>25</platform>
-            <buildTools>19.1.0</buildTools>
+            <platform>${env.ANDROID_PLATFORM}</platform>
+            <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
           </sdk>
         </configuration>
       </plugin>
diff --git a/aws-android-sdk-auth-google/pom.xml b/aws-android-sdk-auth-google/pom.xml
index 4e202e6834..4bb2e77bca 100644
--- a/aws-android-sdk-auth-google/pom.xml
+++ b/aws-android-sdk-auth-google/pom.xml
@@ -77,8 +77,8 @@
         <extensions>true</extensions>
         <configuration>
           <sdk>
-            <platform>25</platform>
-            <buildTools>19.1.0</buildTools>
+            <platform>${env.ANDROID_PLATFORM}</platform>
+            <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
           </sdk>
         </configuration>
       </plugin>
diff --git a/aws-android-sdk-auth-ui/pom.xml b/aws-android-sdk-auth-ui/pom.xml
index b052a94712..03526300a9 100644
--- a/aws-android-sdk-auth-ui/pom.xml
+++ b/aws-android-sdk-auth-ui/pom.xml
@@ -84,8 +84,8 @@
         <extensions>true</extensions>
         <configuration>
           <sdk>
-            <platform>25</platform>
-            <buildTools>19.1.0</buildTools>
+            <platform>${env.ANDROID_PLATFORM}</platform>
+            <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
           </sdk>
         </configuration>
       </plugin>
diff --git a/aws-android-sdk-auth-userpools/pom.xml b/aws-android-sdk-auth-userpools/pom.xml
index b54531357c..1f594cf2eb 100644
--- a/aws-android-sdk-auth-userpools/pom.xml
+++ b/aws-android-sdk-auth-userpools/pom.xml
@@ -72,8 +72,8 @@
         <extensions>true</extensions>
         <configuration>
           <sdk>
-            <platform>25</platform>
-            <buildTools>19.1.0</buildTools>
+            <platform>${env.ANDROID_PLATFORM}</platform>
+            <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
           </sdk>
         </configuration>
       </plugin>
diff --git a/aws-android-sdk-cognitoauth/pom.xml b/aws-android-sdk-cognitoauth/pom.xml
index 6fefd6366b..7e61935463 100644
--- a/aws-android-sdk-cognitoauth/pom.xml
+++ b/aws-android-sdk-cognitoauth/pom.xml
@@ -60,15 +60,16 @@
   <build>
     <plugins>
       <plugin>
-                <groupId>com.simpligility.maven.plugins</groupId>
-                <artifactId>android-maven-plugin</artifactId>
-                <version>4.5.0</version>
-                <extensions>true</extensions>
-                <configuration>
-                    <sdk>
-                        <platform>15</platform>
-                    </sdk>
-                </configuration>
+          <groupId>com.simpligility.maven.plugins</groupId>
+          <artifactId>android-maven-plugin</artifactId>
+          <version>4.5.0</version>
+          <extensions>true</extensions>
+          <configuration>
+            <sdk>
+              <platform>${env.ANDROID_PLATFORM}</platform>
+              <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
+            </sdk>
+          </configuration>
       </plugin>
       <plugin>
         <groupId>org.apache.maven.plugins</groupId>
diff --git a/aws-android-sdk-kinesisvideo/pom.xml b/aws-android-sdk-kinesisvideo/pom.xml
index 44158fee14..f250f4a494 100644
--- a/aws-android-sdk-kinesisvideo/pom.xml
+++ b/aws-android-sdk-kinesisvideo/pom.xml
@@ -57,7 +57,7 @@
        <artifactId>android</artifactId>
        <version>5.0</version>
        <scope>system</scope>
-       <systemPath>${basedir}/../android-21-linux.jar</systemPath>
+       <systemPath>${env.ANDROID_HOME}/platforms/android-${env.ANDROID_PLATFORM}/android.jar</systemPath>
      </dependency>
 
     <dependency>
@@ -76,7 +76,8 @@
          <extensions>true</extensions>
          <configuration>
            <sdk>
-             <platform>21</platform>
+              <platform>${env.ANDROID_PLATFORM}</platform>
+              <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
            </sdk>
            <nativeLibrariesDirectory>${project.basedir}/src/main/jni</nativeLibrariesDirectory>
          </configuration>
diff --git a/aws-android-sdk-lex/pom.xml b/aws-android-sdk-lex/pom.xml
index f9b3a7cbfc..e0f610f687 100644
--- a/aws-android-sdk-lex/pom.xml
+++ b/aws-android-sdk-lex/pom.xml
@@ -69,7 +69,8 @@
                 <extensions>true</extensions>
                 <configuration>
                     <sdk>
-                        <platform>11</platform>
+                        <platform>${env.ANDROID_PLATFORM}</platform>
+                        <buildTools>${env.ANDROID_BUILDTOOL_VERSION}</buildTools>
                     </sdk>
                     <nativeLibrariesDirectory>${project.basedir}/src/main/jni</nativeLibrariesDirectory>
                 </configuration>
diff --git a/aws-android-sdk-mobile-client/pom.xml b/aws-android-sdk-mobile-client/pom.xml
index bc46c15cee..7f3a6c3ddf 100644
--- a/aws-android-sdk-mobile-client/pom.xml
+++ b/aws-android-sdk-mobile-client/pom.xml
@@ -112,7 +112,7 @@
         <extensions>true</extensions>
         <configuration>
           <sdk>
-            <platform>25</platform>
+            <platform>${env.ANDROID_PLATFORM}</platform>
           </sdk>
         </configuration>
       </plugin>
diff --git a/aws-android-sdk-pinpoint/pom.xml b/aws-android-sdk-pinpoint/pom.xml
index 9372ab5ddb..543e105de0 100644
--- a/aws-android-sdk-pinpoint/pom.xml
+++ b/aws-android-sdk-pinpoint/pom.xml
@@ -69,7 +69,7 @@
             <artifactId>android</artifactId>
             <version>5.0</version>
             <scope>system</scope>
-            <systemPath>${basedir}/../android-21-linux.jar</systemPath>
+            <systemPath>${env.ANDROID_HOME}/platforms/android-21/android.jar</systemPath>
         </dependency>
     </dependencies>
 
diff --git a/pom.xml b/pom.xml
index cd8a031f1c..9099ded0e6 100644
--- a/pom.xml
+++ b/pom.xml
@@ -107,6 +107,13 @@
             <forceJavacCompilerUse>true</forceJavacCompilerUse>
           </configuration>
         </plugin>
+        <plugin>
+            <groupId>org.apache.maven.plugins</groupId>
+            <artifactId>maven-surefire-plugin</artifactId>
+            <configuration>
+                <useSystemClassLoader>false</useSystemClassLoader>
+            </configuration>
+        </plugin>           
         <plugin>
           <groupId>org.apache.maven.plugins</groupId>
           <artifactId>maven-javadoc-plugin</artifactId>
@@ -151,6 +158,13 @@
                 </goals>
               </execution>
             </executions>
+            <configuration>
+              <!-- This is necessary for gpg to not try to use the pinentry programs -->
+              <gpgArguments>
+                  <arg>--pinentry-mode</arg>
+                  <arg>loopback</arg>
+              </gpgArguments>
+            </configuration>
           </plugin>
           <plugin>
             <groupId>org.sonatype.plugins</groupId>
