diff --git a/README.mdown b/README.mdown
index b86902191..c9fcc23fb 100644
--- a/README.mdown
+++ b/README.mdown
@@ -8,7 +8,7 @@ Learn more about about the provided samples, documentation, integrating the SDK
 TRY IT OUT
 ----------
 1. Check-out the tutorials available online at https://developers.facebook.com/docs/getting-started/facebook-sdk-for-android/3.0/
-2. Start coding! Visit https://developers.facebook.com/android for tutorials and reference documentation.
+2. Start coding! Visit https://developers.facebook.com/docs/android/ for tutorials and reference documentation.
 
 FEATURES
 --------
diff --git a/build.gradle b/build.gradle
index f11e79ebd..1296bf37b 100644
--- a/build.gradle
+++ b/build.gradle
@@ -4,7 +4,7 @@ buildscript {
         mavenCentral()
     }
     dependencies {
-        classpath 'com.android.tools.build:gradle:0.14.+'
+        classpath 'com.android.tools.build:gradle:1.0.0'
     }
 }
 
diff --git a/facebook/TestApp/build.gradle b/facebook/TestApp/build.gradle
index 024c5b289..88bdbbed3 100644
--- a/facebook/TestApp/build.gradle
+++ b/facebook/TestApp/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android-library'
+apply plugin: 'com.android.library'
 
 dependencies {
     compile project(':facebook')
diff --git a/facebook/TestApp/res/drawable-hdpi/ic_launcher.png b/facebook/TestApp/res/drawable-hdpi/ic_launcher.png
index 8074c4c57..9005e98b5 100644
Binary files a/facebook/TestApp/res/drawable-hdpi/ic_launcher.png and b/facebook/TestApp/res/drawable-hdpi/ic_launcher.png differ
diff --git a/facebook/TestApp/res/drawable-ldpi/ic_launcher.png b/facebook/TestApp/res/drawable-ldpi/ic_launcher.png
index 1095584ec..13fd7e396 100644
Binary files a/facebook/TestApp/res/drawable-ldpi/ic_launcher.png and b/facebook/TestApp/res/drawable-ldpi/ic_launcher.png differ
diff --git a/facebook/TestApp/res/drawable-mdpi/ic_launcher.png b/facebook/TestApp/res/drawable-mdpi/ic_launcher.png
index a07c69fa5..6a65afa2b 100644
Binary files a/facebook/TestApp/res/drawable-mdpi/ic_launcher.png and b/facebook/TestApp/res/drawable-mdpi/ic_launcher.png differ
diff --git a/facebook/build.gradle b/facebook/build.gradle
index f9cb07199..406130a74 100644
--- a/facebook/build.gradle
+++ b/facebook/build.gradle
@@ -1,4 +1,8 @@
-apply plugin: 'android-library'
+apply plugin: 'com.android.library'
+
+repositories {
+  mavenCentral()
+}
 
 project.group = 'com.facebook.android'
 
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png b/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png
index cf60eb0ac..aa002f0a0 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png b/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png
index ece0c4c94..4c114b48d 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png
index a123c2555..9c936b60c 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png b/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png
index 2e6f66dbc..c655580f0 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png b/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png
index 6098f0b0e..efe802fd9 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png b/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png
index 23b9757d1..38acc4799 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_background.png b/facebook/res/drawable-hdpi/com_facebook_button_like_background.png
index 32814c82a..9486c01a7 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_background.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png b/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png
index b2c580e2a..e128c1b99 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png b/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png
index 1dc9f6d24..c0d4688e5 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png b/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png
index 722362ae8..5e8ac3c99 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_close.png b/facebook/res/drawable-hdpi/com_facebook_close.png
index d925cb7b2..d81f040d7 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_close.png and b/facebook/res/drawable-hdpi/com_facebook_close.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png b/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png
index a7289c112..ecc6962aa 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png and b/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_logo.png b/facebook/res/drawable-hdpi/com_facebook_logo.png
index 26ab7945f..161bef08b 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_logo.png and b/facebook/res/drawable-hdpi/com_facebook_logo.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png b/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png
index d6ec37d04..0dcd013d6 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png and b/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png
index 4707ba20c..2c5b1bbad 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png
index 83bf9694b..972010ec2 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png
index 0d8fb82b6..5d595c5a3 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png
index 5bebe5e35..e2903b6de 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png
index 0f8c5dffc..a42b3cd92 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png
index 21145bca6..2d292f2ca 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png
index 8b534773d..b2dcc4089 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png
index 9f341075c..1285a1665 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png differ
diff --git a/facebook/res/drawable-ldpi/com_facebook_close.png b/facebook/res/drawable-ldpi/com_facebook_close.png
index fe4be250e..5f8bc5905 100644
Binary files a/facebook/res/drawable-ldpi/com_facebook_close.png and b/facebook/res/drawable-ldpi/com_facebook_close.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png b/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png
index cfb7a015c..86bd87740 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png b/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png
index 1e9390133..74e5ce199 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png
index d8427fdef..8fd28f704 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png b/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png
index a806a2f5d..b4afa5443 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png and b/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png b/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png
index c5170c18b..3013a5519 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png and b/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png
index 59f263982..d10e30391 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png
index 4c97bf923..9378512ce 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png
index 7fdf08201..d94fa9688 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png
index 21ad6a54e..51454e5a3 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png
index bd54278da..bf60245bb 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png
index 299afc24e..e0ac8fea8 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png
index cb29b55f3..e09406081 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png
index 73695f03b..85699f8ec 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png
index 5a47068d7..0524c9325 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png
index 1449c8a13..f5d0e58b5 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png
index 28bd184ed..3d1c11075 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png
index bfd883f92..e5b15f9c5 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png
index aa9895432..02f28bdd5 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png
index 92f2ad12a..40e6b04e3 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png
index 3c25c433e..37bb852d2 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png
index accfdfc6e..954b3f7d1 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png
index db8fcad20..c4d7016b4 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png
index 96e9a308b..ccb98d5e3 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_close.png b/facebook/res/drawable-xhdpi/com_facebook_close.png
index e3aff5ae5..b603ef892 100755
Binary files a/facebook/res/drawable-xhdpi/com_facebook_close.png and b/facebook/res/drawable-xhdpi/com_facebook_close.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png b/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png
index 4192c4887..4b35eb436 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png and b/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_logo.png b/facebook/res/drawable-xhdpi/com_facebook_logo.png
index 24d7fc56b..401d7bfec 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_logo.png and b/facebook/res/drawable-xhdpi/com_facebook_logo.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png b/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png
index a5b372468..a5eb056a1 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png and b/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png
index d6f89a731..43b14c999 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png
index 71abe544b..87f9795bc 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png
index 2ac32dbc2..4d3f58f6e 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png
index e3d562b60..6cd7bc8d9 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png
index a1978044c..7614b95c3 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png
index cee80f129..d29b95242 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png
index 2ec445e5d..d2dc678ee 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png
index 7fd57632d..e9bc616f1 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png
index bead08dc5..02d902cfe 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png
index 85e4e873c..cb76c177a 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png
index 1d67cab7b..88d2169da 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png
index 45319d90b..41137fc92 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable/com_facebook_button_blue_focused.9.png b/facebook/res/drawable/com_facebook_button_blue_focused.9.png
index cfb7a015c..86bd87740 100644
Binary files a/facebook/res/drawable/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_blue_normal.9.png b/facebook/res/drawable/com_facebook_button_blue_normal.9.png
index 1e9390133..74e5ce199 100644
Binary files a/facebook/res/drawable/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable/com_facebook_button_blue_pressed.9.png
index d8427fdef..8fd28f704 100644
Binary files a/facebook/res/drawable/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_check_off.png b/facebook/res/drawable/com_facebook_button_check_off.png
index e9737df5c..c25695d53 100644
Binary files a/facebook/res/drawable/com_facebook_button_check_off.png and b/facebook/res/drawable/com_facebook_button_check_off.png differ
diff --git a/facebook/res/drawable/com_facebook_button_grey_focused.9.png b/facebook/res/drawable/com_facebook_button_grey_focused.9.png
index 56f603571..becfe54fd 100644
Binary files a/facebook/res/drawable/com_facebook_button_grey_focused.9.png and b/facebook/res/drawable/com_facebook_button_grey_focused.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_grey_normal.9.png b/facebook/res/drawable/com_facebook_button_grey_normal.9.png
index dff3b7d73..f0a07f85c 100644
Binary files a/facebook/res/drawable/com_facebook_button_grey_normal.9.png and b/facebook/res/drawable/com_facebook_button_grey_normal.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_grey_pressed.9.png b/facebook/res/drawable/com_facebook_button_grey_pressed.9.png
index 46648efcd..d1c966313 100644
Binary files a/facebook/res/drawable/com_facebook_button_grey_pressed.9.png and b/facebook/res/drawable/com_facebook_button_grey_pressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_background.png b/facebook/res/drawable/com_facebook_button_like_background.png
index e7723b5a0..899da5272 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_background.png and b/facebook/res/drawable/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_background_selected.png b/facebook/res/drawable/com_facebook_button_like_background_selected.png
index 68c70bcee..798364730 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_background_selected.png and b/facebook/res/drawable/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_icon.png b/facebook/res/drawable/com_facebook_button_like_icon.png
index 30a955592..51d72dd32 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_icon.png and b/facebook/res/drawable/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_icon_selected.png b/facebook/res/drawable/com_facebook_button_like_icon_selected.png
index ead35ca29..9834a4c14 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable/com_facebook_close.png b/facebook/res/drawable/com_facebook_close.png
index ad0147460..4ffc94cdc 100755
Binary files a/facebook/res/drawable/com_facebook_close.png and b/facebook/res/drawable/com_facebook_close.png differ
diff --git a/facebook/res/drawable/com_facebook_inverse_icon.png b/facebook/res/drawable/com_facebook_inverse_icon.png
index a806a2f5d..b4afa5443 100644
Binary files a/facebook/res/drawable/com_facebook_inverse_icon.png and b/facebook/res/drawable/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable/com_facebook_list_divider.9.png b/facebook/res/drawable/com_facebook_list_divider.9.png
index 7d4c46c47..4c0df0768 100644
Binary files a/facebook/res/drawable/com_facebook_list_divider.9.png and b/facebook/res/drawable/com_facebook_list_divider.9.png differ
diff --git a/facebook/res/drawable/com_facebook_list_section_header_background.9.png b/facebook/res/drawable/com_facebook_list_section_header_background.9.png
index 1763c4a64..0ee16ffb6 100644
Binary files a/facebook/res/drawable/com_facebook_list_section_header_background.9.png and b/facebook/res/drawable/com_facebook_list_section_header_background.9.png differ
diff --git a/facebook/res/drawable/com_facebook_logo.png b/facebook/res/drawable/com_facebook_logo.png
index 785acf9ea..8e6a514a6 100644
Binary files a/facebook/res/drawable/com_facebook_logo.png and b/facebook/res/drawable/com_facebook_logo.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_focused.9.png b/facebook/res/drawable/com_facebook_picker_list_focused.9.png
index 7c0599e3a..3efadc352 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_focused.9.png and b/facebook/res/drawable/com_facebook_picker_list_focused.9.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png b/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png
index 3bf8e0362..5fcd5b207 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png and b/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_pressed.9.png b/facebook/res/drawable/com_facebook_picker_list_pressed.9.png
index 6e77525d2..0e557469e 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_pressed.9.png and b/facebook/res/drawable/com_facebook_picker_list_pressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png b/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png
index 42cb6463e..10851f6c8 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png and b/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png differ
diff --git a/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png b/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png
index 107d7f89e..27a6f7a74 100644
Binary files a/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png and b/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png differ
diff --git a/facebook/res/drawable/com_facebook_profile_picture_blank_square.png b/facebook/res/drawable/com_facebook_profile_picture_blank_square.png
index 8b4a76a0e..77554e01f 100644
Binary files a/facebook/res/drawable/com_facebook_profile_picture_blank_square.png and b/facebook/res/drawable/com_facebook_profile_picture_blank_square.png differ
diff --git a/facebook/res/values-es/strings.xml b/facebook/res/values-es/strings.xml
index 556a7a4f9..7f1558718 100644
--- a/facebook/res/values-es/strings.xml
+++ b/facebook/res/values-es/strings.xml
@@ -41,4 +41,5 @@
     <string name="com_facebook_requesterror_password_changed">Su contraseña de Facebook ha cambiado, por favor vuelva a conectar la aplicación con Facebook.</string>
     <string name="com_facebook_requesterror_reconnect">Se produjo un error al conectar con Facebook, por favor vuelva a conectar la aplicación con Facebook.</string>
     <string name="com_facebook_requesterror_permissions">Una conexión de aplicación con Facebook falló debido a permisos insuficientes, por favor, conceda los permisos de aplicaciones para realizar la operación.</string>
+    <string name="com_facebook_image_download_unknown_error">Error al descargar la imagen.</string>
 </resources>
diff --git a/facebook/res/values-he/strings.xml b/facebook/res/values-he/strings.xml
index 4ab34a3e2..48f29e328 100644
--- a/facebook/res/values-he/strings.xml
+++ b/facebook/res/values-he/strings.xml
@@ -41,4 +41,5 @@
     <string name="com_facebook_requesterror_reconnect">.ארעה שגיאה בעת החיבור עם פייסבוק, חבר בבקשה מחדש את האפליקציה עם פייסבוק</string>
     <string name="com_facebook_requesterror_permissions">.חיבור האפליקציה עם פייסבוק נכשל בשל הרשאות לא מספקות, אנא הענק הרשאות לאפליקציה בכדי שהפעולה תוכל להתבצע</string>
     <string name="com_facebook_dialogloginactivity_ok_button">אישור</string>
+    <string name="com_facebook_image_download_unknown_error">שגיאה בעת הורדת תמונה</string>
 </resources>
diff --git a/facebook/res/values-iw/strings.xml b/facebook/res/values-iw/strings.xml
index 4ab34a3e2..48f29e328 100644
--- a/facebook/res/values-iw/strings.xml
+++ b/facebook/res/values-iw/strings.xml
@@ -41,4 +41,5 @@
     <string name="com_facebook_requesterror_reconnect">.ארעה שגיאה בעת החיבור עם פייסבוק, חבר בבקשה מחדש את האפליקציה עם פייסבוק</string>
     <string name="com_facebook_requesterror_permissions">.חיבור האפליקציה עם פייסבוק נכשל בשל הרשאות לא מספקות, אנא הענק הרשאות לאפליקציה בכדי שהפעולה תוכל להתבצע</string>
     <string name="com_facebook_dialogloginactivity_ok_button">אישור</string>
+    <string name="com_facebook_image_download_unknown_error">שגיאה בעת הורדת תמונה</string>
 </resources>
diff --git a/facebook/res/values/strings.xml b/facebook/res/values/strings.xml
index ee6445ebf..efa3b79b4 100644
--- a/facebook/res/values/strings.xml
+++ b/facebook/res/values/strings.xml
@@ -44,4 +44,5 @@
     <string name="com_facebook_requesterror_reconnect">Please log into this app again to reconnect your Facebook account.</string>
     <string name="com_facebook_requesterror_permissions">This app doesn’t have permission to do this. To change permissions, try logging into the app again.</string>
     <string name="com_facebook_tooltip_default">New! You\'re in control - choose what info you want to share with apps.</string>
+    <string name="com_facebook_image_download_unknown_error">Unexpected error while downloading an image.</string>
 </resources>
diff --git a/facebook/src/com/facebook/AppEventsLogger.java b/facebook/src/com/facebook/AppEventsLogger.java
index cf3ebf607..5fa481ffb 100644
--- a/facebook/src/com/facebook/AppEventsLogger.java
+++ b/facebook/src/com/facebook/AppEventsLogger.java
@@ -20,6 +20,7 @@
 import android.content.ComponentName;
 import android.content.Context;
 import android.content.Intent;
+import android.content.SharedPreferences;
 import android.os.Bundle;
 import android.support.v4.content.LocalBroadcastManager;
 import android.util.Log;
@@ -48,6 +49,7 @@
 import java.util.List;
 import java.util.Map;
 import java.util.Set;
+import java.util.UUID;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.ScheduledThreadPoolExecutor;
 import java.util.concurrent.TimeUnit;
@@ -151,6 +153,9 @@
     private static final int APP_SUPPORTS_ATTRIBUTION_ID_RECHECK_PERIOD_IN_SECONDS = 60 * 60 * 24;
     private static final int FLUSH_APP_SESSION_INFO_IN_SECONDS = 30;
 
+    // Package visible
+    static final String APP_EVENT_PREFERENCES = "com.facebook.sdk.appEventPreferences";
+
     private static final String SOURCE_APPLICATION_HAS_BEEN_SET_BY_THIS_INTENT = "_fbSourceApplicationHasBeenSet";
 
     // Instance member variables
@@ -164,7 +169,7 @@
     private static boolean requestInFlight;
     private static Context applicationContext;
     private static Object staticLock = new Object();
-    private static String hashedDeviceAndAppId;
+    private static String anonymousAppDeviceGUID;
     private static String sourceApplication;
     private static boolean isOpenedByApplink;
 
@@ -612,7 +617,6 @@ public String getApplicationId() {
      * Constructor is private, newLogger() methods should be used to build an instance.
      */
     private AppEventsLogger(Context context, String applicationId, Session session) {
-
         Validate.notNull(context, "context");
         this.context = context;
 
@@ -635,10 +639,6 @@ private AppEventsLogger(Context context, String applicationId, Session session)
 
         synchronized (staticLock) {
 
-            if (hashedDeviceAndAppId == null) {
-                hashedDeviceAndAppId = Utility.getHashedDeviceAndAppID(context, applicationId);
-            }
-
             if (applicationContext == null) {
                 applicationContext = context.getApplicationContext();
             }
@@ -755,7 +755,7 @@ private static SessionEventsState getSessionEventsState(Context context, AccessT
             // Check state again while we're locked.
             state = stateMap.get(accessTokenAppId);
             if (state == null) {
-                state = new SessionEventsState(attributionIdentifiers, context.getPackageName(), hashedDeviceAndAppId);
+                state = new SessionEventsState(attributionIdentifiers, context.getPackageName(), getAnonymousAppDeviceGUID(context));
                 stateMap.put(accessTokenAppId, state);
             }
             return state;
@@ -875,8 +875,11 @@ private static Request buildRequestForSession(final AccessTokenAppIdPair accessT
             return null;
         }
 
-        int numEvents = sessionEventsState.populateRequest(postRequest, fetchedAppSettings.supportsImplicitLogging(),
-                fetchedAppSettings.supportsAttribution(), limitEventUsage);
+        int numEvents = sessionEventsState.populateRequest(
+                postRequest,
+                fetchedAppSettings.supportsImplicitLogging(),
+                limitEventUsage);
+
         if (numEvents == 0) {
             return null;
         }
@@ -1043,6 +1046,32 @@ static void resetSourceApplication() {
         isOpenedByApplink = false;
     }
 
+    // Each app/device pair gets an GUID that is sent back with App Events and persisted with this
+    // app/device pair.
+    static String getAnonymousAppDeviceGUID(Context context) {
+
+        if (anonymousAppDeviceGUID == null) {
+            synchronized (staticLock) {
+                if (anonymousAppDeviceGUID == null) {
+
+                    SharedPreferences preferences = context.getSharedPreferences(APP_EVENT_PREFERENCES, Context.MODE_PRIVATE);
+                    anonymousAppDeviceGUID = preferences.getString("anonymousAppDeviceGUID", null);
+                    if (anonymousAppDeviceGUID == null) {
+                        // Arbitrarily prepend XZ to distinguish from device supplied identifiers.
+                        anonymousAppDeviceGUID = "XZ" + UUID.randomUUID().toString();
+
+                        context.getSharedPreferences(APP_EVENT_PREFERENCES, Context.MODE_PRIVATE)
+                                .edit()
+                                .putString("anonymousAppDeviceGUID", anonymousAppDeviceGUID)
+                                .apply();
+                    }
+                }
+            }
+        }
+
+        return anonymousAppDeviceGUID;
+    }
+
     //
     // Deprecated Stuff
     //
@@ -1054,7 +1083,7 @@ static void resetSourceApplication() {
         private int numSkippedEventsDueToFullBuffer;
         private AttributionIdentifiers attributionIdentifiers;
         private String packageName;
-        private String hashedDeviceAndAppId;
+        private String anonymousAppDeviceGUID;
 
         public static final String EVENT_COUNT_KEY = "event_count";
         public static final String ENCODED_EVENTS_KEY = "encoded_events";
@@ -1062,10 +1091,10 @@ static void resetSourceApplication() {
 
         private final int MAX_ACCUMULATED_LOG_EVENTS = 1000;
 
-        public SessionEventsState(AttributionIdentifiers identifiers, String packageName, String hashedDeviceAndAppId) {
+        public SessionEventsState(AttributionIdentifiers identifiers, String packageName, String anonymousGUID) {
             this.attributionIdentifiers = identifiers;
             this.packageName = packageName;
-            this.hashedDeviceAndAppId = hashedDeviceAndAppId;
+            this.anonymousAppDeviceGUID = anonymousGUID;
         }
 
         // Synchronize here and in other methods on this class, because could be coming in from different
@@ -1091,7 +1120,7 @@ public synchronized void clearInFlightAndStats(boolean moveToAccumulated) {
         }
 
         public int populateRequest(Request request, boolean includeImplicitEvents,
-                                   boolean includeAttribution, boolean limitEventUsage) {
+                                   boolean limitEventUsage) {
 
             int numSkipped;
             JSONArray jsonArray;
@@ -1114,7 +1143,7 @@ public int populateRequest(Request request, boolean includeImplicitEvents,
                 }
             }
 
-            populateRequest(request, numSkipped, jsonArray, includeAttribution, limitEventUsage);
+            populateRequest(request, numSkipped, jsonArray, limitEventUsage);
             return jsonArray.length();
         }
 
@@ -1133,7 +1162,7 @@ public synchronized void accumulatePersistedEvents(List<AppEvent> events) {
             accumulatedEvents.addAll(events);
         }
 
-        private void populateRequest(Request request, int numSkipped, JSONArray events, boolean includeAttribution,
+        private void populateRequest(Request request, int numSkipped, JSONArray events,
                                      boolean limitEventUsage) {
             GraphObject publishParams = GraphObject.Factory.create();
             publishParams.setProperty("event", "CUSTOM_APP_EVENTS");
@@ -1142,10 +1171,8 @@ private void populateRequest(Request request, int numSkipped, JSONArray events,
                 publishParams.setProperty("num_skipped_events", numSkipped);
             }
 
-            if (includeAttribution) {
-                Utility.setAppEventAttributionParameters(publishParams, attributionIdentifiers,
-                        hashedDeviceAndAppId, limitEventUsage);
-            }
+            Utility.setAppEventAttributionParameters(publishParams, attributionIdentifiers,
+                    anonymousAppDeviceGUID, limitEventUsage);
 
             // The code to get all the Extended info is safe but just in case we can wrap the whole
             // call in its own try/catch block since some of the things it does might cause
diff --git a/facebook/src/com/facebook/AppLinkData.java b/facebook/src/com/facebook/AppLinkData.java
index 5dd213556..1a2e0aaac 100644
--- a/facebook/src/com/facebook/AppLinkData.java
+++ b/facebook/src/com/facebook/AppLinkData.java
@@ -132,7 +132,7 @@ private static void fetchDeferredAppLinkFromServer(
         deferredApplinkParams.setProperty("event", DEFERRED_APP_LINK_EVENT);
         Utility.setAppEventAttributionParameters(deferredApplinkParams,
                 AttributionIdentifiers.getAttributionIdentifiers(context),
-                Utility.getHashedDeviceAndAppID(context, applicationId),
+                AppEventsLogger.getAnonymousAppDeviceGUID(context),
                 Settings.getLimitEventAndDataUsage(context));
         deferredApplinkParams.setProperty("application_package_name", context.getPackageName());
 
diff --git a/facebook/src/com/facebook/AuthorizationClient.java b/facebook/src/com/facebook/AuthorizationClient.java
index 8b05e00fa..3e8e56222 100644
--- a/facebook/src/com/facebook/AuthorizationClient.java
+++ b/facebook/src/com/facebook/AuthorizationClient.java
@@ -175,7 +175,7 @@ void cancelCurrentHandler() {
     }
 
     boolean onActivityResult(int requestCode, int resultCode, Intent data) {
-        if (requestCode == pendingRequest.getRequestCode()) {
+        if (pendingRequest != null && requestCode == pendingRequest.getRequestCode()) {
             return currentHandler.onActivityResult(requestCode, resultCode, data);
         }
         return false;
@@ -681,14 +681,12 @@ void onWebDialogComplete(AuthorizationRequest request, Bundle values,
 
         private void saveCookieToken(String token) {
             Context context = getStartActivityDelegate().getActivityContext();
-            SharedPreferences sharedPreferences = context.getSharedPreferences(
+            context.getSharedPreferences(
                     WEB_VIEW_AUTH_HANDLER_STORE,
-                    Context.MODE_PRIVATE);
-            SharedPreferences.Editor editor = sharedPreferences.edit();
-            editor.putString(WEB_VIEW_AUTH_HANDLER_TOKEN_KEY, token);
-            if (!editor.commit()) {
-                Utility.logd(TAG, "Could not update saved web view auth handler token.");
-            }
+                    Context.MODE_PRIVATE)
+                .edit()
+                .putString(WEB_VIEW_AUTH_HANDLER_TOKEN_KEY, token)
+                .apply();
         }
 
         private String loadCookieToken() {
diff --git a/facebook/src/com/facebook/FacebookSdkVersion.java b/facebook/src/com/facebook/FacebookSdkVersion.java
index 9b9671ece..19669281e 100644
--- a/facebook/src/com/facebook/FacebookSdkVersion.java
+++ b/facebook/src/com/facebook/FacebookSdkVersion.java
@@ -17,5 +17,5 @@
 package com.facebook;
 
 final class FacebookSdkVersion {
-    public static final String BUILD = "3.19.1";
+    public static final String BUILD = "3.23.0";
 }
diff --git a/facebook/src/com/facebook/NativeAppCallAttachmentStore.java b/facebook/src/com/facebook/NativeAppCallAttachmentStore.java
index 3704be274..aa7f39ed7 100644
--- a/facebook/src/com/facebook/NativeAppCallAttachmentStore.java
+++ b/facebook/src/com/facebook/NativeAppCallAttachmentStore.java
@@ -76,22 +76,22 @@ public void processAttachment(Bitmap attachment, File outputFile) throws IOExcep
     }
 
     /**
-     * Adds a number of bitmap attachment files associated with a native app call. The attachments will be
+     * Adds a number of bitmap/video attachment files associated with a native app call. The attachments will be
      * served via {@link NativeAppCallContentProvider#openFile(android.net.Uri, String) openFile}.
      *
      * @param context the Context the call is being made from
      * @param callId the unique ID of the call
-     * @param imageAttachments a Map of attachment names to Files containing the bitmaps; the attachment names will be
-     *                         part of the URI processed by openFile
+     * @param mediaAttachmentFiles a Map of attachment names to Files containing the bitmaps/videos; the attachment
+     *                             names will be part of the URI processed by openFile
      * @throws java.io.IOException
      */
-    public void addAttachmentFilesForCall(Context context, UUID callId, Map<String, File> imageAttachmentFiles) {
+    public void addAttachmentFilesForCall(Context context, UUID callId, Map<String, File> mediaAttachmentFiles) {
         Validate.notNull(context, "context");
         Validate.notNull(callId, "callId");
-        Validate.containsNoNulls(imageAttachmentFiles.values(), "imageAttachmentFiles");
-        Validate.containsNoNullOrEmpty(imageAttachmentFiles.keySet(), "imageAttachmentFiles");
+        Validate.containsNoNulls(mediaAttachmentFiles.values(), "mediaAttachmentFiles");
+        Validate.containsNoNullOrEmpty(mediaAttachmentFiles.keySet(), "mediaAttachmentFiles");
 
-        addAttachments(context, callId, imageAttachmentFiles, new ProcessAttachment<File>() {
+        addAttachments(context, callId, mediaAttachmentFiles, new ProcessAttachment<File>() {
             @Override
             public void processAttachment(File attachment, File outputFile) throws IOException {
                 FileOutputStream outputStream = new FileOutputStream(outputFile);
diff --git a/facebook/src/com/facebook/NativeAppCallContentProvider.java b/facebook/src/com/facebook/NativeAppCallContentProvider.java
index 374547a1c..9140c2702 100644
--- a/facebook/src/com/facebook/NativeAppCallContentProvider.java
+++ b/facebook/src/com/facebook/NativeAppCallContentProvider.java
@@ -31,8 +31,8 @@
 /**
  * <p>Implements a <a href="http://developer.android.com/reference/android/content/ContentProvider.html">
  * ContentProvider</a> that can be used to provide binary attachments (e.g., images) to calls made
- * via @link FacebookDialog}. The {@link NativeAppCallAttachmentStore} class provides methods to attach
- * and clean up the attachments.
+ * via {@link com.facebook.widget.FacebookDialog}. The {@link NativeAppCallAttachmentStore}
+ * class provides methods to attach and clean up the attachments.
  *
  * <p>Note that this ContentProvider is only necessary if an application wishes to attach images, etc., that are
  * stored in memory and do not have another way to be referenced by a content URI. For images obtained from,
@@ -42,7 +42,7 @@
  * <p>If an application wishes to attach images that are stored in-memory within the application, this content
  * provider must be listed in the application's AndroidManifest.xml, and it should be named according to the
  * pattern <code>"com.facebook.app.NativeAppCallContentProvider{FACEBOOK_APP_ID}"</code>. See the
- * {@link NativeAppCallContentProvider#getAttachmentUrl(String) getContentProviderName} method.</p>
+ * {@link NativeAppCallContentProvider#getAttachmentUrl getContentProviderName} method.</p>
  */
 public class NativeAppCallContentProvider extends ContentProvider {
     private static final String TAG = NativeAppCallContentProvider.class.getName();
diff --git a/facebook/src/com/facebook/Request.java b/facebook/src/com/facebook/Request.java
index 32fcfd050..53db060f8 100644
--- a/facebook/src/com/facebook/Request.java
+++ b/facebook/src/com/facebook/Request.java
@@ -40,6 +40,7 @@
 import java.util.Map.Entry;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
+import java.util.zip.GZIPOutputStream;
 
 /**
  * A single request to be sent to the Facebook Platform through the <a
@@ -83,6 +84,7 @@
     private static final String USER_AGENT_HEADER = "User-Agent";
     private static final String CONTENT_TYPE_HEADER = "Content-Type";
     private static final String ACCEPT_LANGUAGE_HEADER = "Accept-Language";
+    private static final String CONTENT_ENCODING_HEADER = "Content-Encoding";
 
     // Parameter names/values
     private static final String PICTURE_PARAM = "picture";
@@ -1684,12 +1686,11 @@ public void run() {
         }
     }
 
-    static HttpURLConnection createConnection(URL url) throws IOException {
+    private static HttpURLConnection createConnection(URL url) throws IOException {
         HttpURLConnection connection;
         connection = (HttpURLConnection) url.openConnection();
 
         connection.setRequestProperty(USER_AGENT_HEADER, getUserAgent());
-        connection.setRequestProperty(CONTENT_TYPE_HEADER, getMimeContentType());
         connection.setRequestProperty(ACCEPT_LANGUAGE_HEADER, Locale.getDefault().toString());
 
         connection.setChunkedStreamingMode(0);
@@ -1870,14 +1871,37 @@ private static boolean hasOnProgressCallbacks(RequestBatch requests) {
         return false;
     }
 
+    private static void setConnectionContentType(HttpURLConnection connection, boolean shouldUseGzip) {
+        if (shouldUseGzip) {
+            connection.setRequestProperty(CONTENT_TYPE_HEADER, "application/x-www-form-urlencoded");
+            connection.setRequestProperty(CONTENT_ENCODING_HEADER, "gzip");
+        } else {
+            connection.setRequestProperty(CONTENT_TYPE_HEADER, getMimeContentType());
+        }
+    }
+
+    private static boolean isGzipCompressible(RequestBatch requests) {
+        for(Request request : requests) {
+            for (String key : request.parameters.keySet()) {
+                Object value = request.parameters.get(key);
+                if (isSupportedAttachmentType(value)) {
+                    return false;
+                }
+            }
+        }
+        return true;
+    }
+
     final static void serializeToUrlConnection(RequestBatch requests, HttpURLConnection connection)
     throws IOException, JSONException {
         Logger logger = new Logger(LoggingBehavior.REQUESTS, "Request");
 
         int numRequests = requests.size();
+        boolean shouldUseGzip = isGzipCompressible(requests);
 
         HttpMethod connectionHttpMethod = (numRequests == 1) ? requests.get(0).httpMethod : HttpMethod.POST;
         connection.setRequestMethod(connectionHttpMethod.name());
+        setConnectionContentType(connection, shouldUseGzip);
 
         URL url = connection.getURL();
         logger.append("Request:\n");
@@ -1902,22 +1926,23 @@ final static void serializeToUrlConnection(RequestBatch requests, HttpURLConnect
 
         OutputStream outputStream = null;
         try {
+            outputStream = new BufferedOutputStream(connection.getOutputStream());
+            if (shouldUseGzip) {
+                outputStream = new GZIPOutputStream(outputStream);
+            }
+
             if (hasOnProgressCallbacks(requests)) {
                 ProgressNoopOutputStream countingStream = null;
                 countingStream = new ProgressNoopOutputStream(requests.getCallbackHandler());
-                processRequest(requests, null, numRequests, url, countingStream);
+                processRequest(requests, null, numRequests, url, countingStream, shouldUseGzip);
 
                 int max = countingStream.getMaxProgress();
                 Map<Request, RequestProgress> progressMap = countingStream.getProgressMap();
 
-                BufferedOutputStream buffered = new BufferedOutputStream(connection.getOutputStream());
-                outputStream = new ProgressOutputStream(buffered, requests, progressMap, max);
-            }
-            else {
-                outputStream = new BufferedOutputStream(connection.getOutputStream());
+                outputStream = new ProgressOutputStream(outputStream, requests, progressMap, max);
             }
 
-            processRequest(requests, logger, numRequests, url, outputStream);
+            processRequest(requests, logger, numRequests, url, outputStream, shouldUseGzip);
         }
         finally {
             if (outputStream != null) {
@@ -1928,10 +1953,10 @@ final static void serializeToUrlConnection(RequestBatch requests, HttpURLConnect
         logger.log();
     }
 
-    private static void processRequest(RequestBatch requests, Logger logger, int numRequests, URL url, OutputStream outputStream)
+    private static void processRequest(RequestBatch requests, Logger logger, int numRequests, URL url, OutputStream outputStream, boolean shouldUseGzip)
             throws IOException, JSONException
     {
-        Serializer serializer = new Serializer(outputStream, logger);
+        Serializer serializer = new Serializer(outputStream, logger, shouldUseGzip);
 
         if (numRequests == 1) {
             Request request = requests.get(0);
@@ -2172,10 +2197,12 @@ private static String parameterToString(Object value) {
         private final OutputStream outputStream;
         private final Logger logger;
         private boolean firstWrite = true;
+        private boolean useUrlEncode = false;
 
-        public Serializer(OutputStream outputStream, Logger logger) {
+        public Serializer(OutputStream outputStream, Logger logger, boolean useUrlEncode) {
             this.outputStream = outputStream;
             this.logger = logger;
+            this.useUrlEncode = useUrlEncode;
         }
 
         public void writeObject(String key, Object value, Request request) throws IOException {
@@ -2301,35 +2328,49 @@ public void writeFile(String key, ParcelFileDescriptor descriptor, String mimeTy
         }
 
         public void writeRecordBoundary() throws IOException {
-            writeLine("--%s", MIME_BOUNDARY);
+            if (!useUrlEncode) {
+                writeLine("--%s", MIME_BOUNDARY);
+            } else {
+                this.outputStream.write("&".getBytes());
+            }
         }
 
         public void writeContentDisposition(String name, String filename, String contentType) throws IOException {
-            write("Content-Disposition: form-data; name=\"%s\"", name);
-            if (filename != null) {
-                write("; filename=\"%s\"", filename);
-            }
-            writeLine(""); // newline after Content-Disposition
-            if (contentType != null) {
-                writeLine("%s: %s", CONTENT_TYPE_HEADER, contentType);
+            if (!useUrlEncode) {
+                write("Content-Disposition: form-data; name=\"%s\"", name);
+                if (filename != null) {
+                    write("; filename=\"%s\"", filename);
+                }
+                writeLine(""); // newline after Content-Disposition
+                if (contentType != null) {
+                    writeLine("%s: %s", CONTENT_TYPE_HEADER, contentType);
+                }
+                writeLine(""); // blank line before content
+            } else {
+                this.outputStream.write(String.format("%s=", name).getBytes());
             }
-            writeLine(""); // blank line before content
         }
 
         public void write(String format, Object... args) throws IOException {
-            if (firstWrite) {
-                // Prepend all of our output with a boundary string.
-                this.outputStream.write("--".getBytes());
-                this.outputStream.write(MIME_BOUNDARY.getBytes());
-                this.outputStream.write("\r\n".getBytes());
-                firstWrite = false;
+            if (!useUrlEncode) {
+                if (firstWrite) {
+                    // Prepend all of our output with a boundary string.
+                    this.outputStream.write("--".getBytes());
+                    this.outputStream.write(MIME_BOUNDARY.getBytes());
+                    this.outputStream.write("\r\n".getBytes());
+                    firstWrite = false;
+                }
+                this.outputStream.write(String.format(format, args).getBytes());
+            } else {
+                this.outputStream.write(URLEncoder.encode(String.format(format, args), "UTF-8").getBytes());
             }
-            this.outputStream.write(String.format(format, args).getBytes());
         }
 
         public void writeLine(String format, Object... args) throws IOException {
             write(format, args);
-            write("\r\n");
+            if (!useUrlEncode) {
+                write("\r\n");
+            }
         }
 
     }
diff --git a/facebook/src/com/facebook/RequestAsyncTask.java b/facebook/src/com/facebook/RequestAsyncTask.java
index db60a18f9..62a2cf158 100644
--- a/facebook/src/com/facebook/RequestAsyncTask.java
+++ b/facebook/src/com/facebook/RequestAsyncTask.java
@@ -32,7 +32,6 @@
  * Defines an AsyncTask suitable for executing a Request in the background. May be subclassed
  * by applications having unique threading model needs.
  */
-@TargetApi(3)
 public class RequestAsyncTask extends AsyncTask<Void, Void, List<Response>> {
     private static final String TAG = RequestAsyncTask.class.getCanonicalName();
     private static Method executeOnExecutorMethod;
@@ -172,18 +171,18 @@ protected void onPostExecute(List<Response> result) {
     }
 
     RequestAsyncTask executeOnSettingsExecutor() {
-        try {
-            if (executeOnExecutorMethod != null) {
+        if (executeOnExecutorMethod != null) {
+            try {
                 executeOnExecutorMethod.invoke(this, Settings.getExecutor(), null);
-                return this;
+            } catch (InvocationTargetException e) {
+                // fall-through
+            } catch (IllegalAccessException e) {
+                // fall-through
             }
-        } catch (InvocationTargetException e) {
-            // fall-through
-        } catch (IllegalAccessException e) {
-            // fall-through
+        } else {
+          this.execute();
         }
 
-        this.execute();
         return this;
     }
 }
diff --git a/facebook/src/com/facebook/Session.java b/facebook/src/com/facebook/Session.java
index 4fe231168..3ce90666e 100644
--- a/facebook/src/com/facebook/Session.java
+++ b/facebook/src/com/facebook/Session.java
@@ -147,7 +147,6 @@
     private volatile Bundle authorizationBundle;
     private final List<StatusCallback> callbacks;
     private Handler handler;
-    private AutoPublishAsyncTask autoPublishAsyncTask;
     // This is the object that synchronizes access to state and tokenInfo
     private final Object lock = new Object();
     private TokenCachingStrategy tokenCachingStrategy;
@@ -551,8 +550,6 @@ public final void open(AccessToken accessToken, StatusCallback callback) {
             state = SessionState.OPENED;
             this.postStateChange(oldState, state, null);
         }
-
-        autoPublishAsync();
     }
 
     /**
@@ -1152,8 +1149,6 @@ void authorize(AuthorizationRequest request) {
 
         request.setApplicationId(applicationId);
 
-        autoPublishAsync();
-
         logAuthorizationStart();
 
         started = tryLoginActivity(request);
@@ -1672,9 +1667,13 @@ public void onServiceConnected(ComponentName className, IBinder service) {
         public void onServiceDisconnected(ComponentName arg) {
             cleanup();
 
-            // We returned an error so there's no point in
-            // keeping the binding open.
-            staticContext.unbindService(TokenRefreshRequest.this);
+            try {
+                // We returned an error so there's no point in
+                // keeping the binding open.
+                staticContext.unbindService(TokenRefreshRequest.this);
+            } catch (IllegalArgumentException ex) {
+                // Do nothing, the connection was already unbound
+            }
         }
 
         private void cleanup() {
@@ -1741,6 +1740,12 @@ public void handleMessage(Message msg) {
      * @see Session#open open
      */
     public interface StatusCallback {
+        /**
+         * The function that is called when status of the session changes.
+         * @param session   The session that was updated.
+         * @param state     The new state of the session.
+         * @param exception The exception that is related to state change, may be null.
+         */
         public void call(Session session, SessionState state, Exception exception);
     }
 
@@ -1825,57 +1830,6 @@ public Session build() {
         public Activity getActivityContext();
     }
 
-    @SuppressWarnings("deprecation")
-    private void autoPublishAsync() {
-        AutoPublishAsyncTask asyncTask = null;
-        synchronized (this) {
-            if (autoPublishAsyncTask == null && Settings.getShouldAutoPublishInstall()) {
-                // copy the application id to guarantee thread safety against our container.
-                String applicationId = Session.this.applicationId;
-
-                // skip publish if we don't have an application id.
-                if (applicationId != null) {
-                    asyncTask = autoPublishAsyncTask = new AutoPublishAsyncTask(applicationId, staticContext);
-                }
-            }
-        }
-
-        if (asyncTask != null) {
-            asyncTask.execute();
-        }
-    }
-
-    /**
-     * Async implementation to allow auto publishing to not block the ui thread.
-     */
-    private class AutoPublishAsyncTask extends AsyncTask<Void, Void, Void> {
-        private final String mApplicationId;
-        private final Context mApplicationContext;
-
-        public AutoPublishAsyncTask(String applicationId, Context context) {
-            mApplicationId = applicationId;
-            mApplicationContext = context.getApplicationContext();
-        }
-
-        @Override
-        protected Void doInBackground(Void... voids) {
-            try {
-                Settings.publishInstallAndWaitForResponse(mApplicationContext, mApplicationId, true);
-            } catch (Exception e) {
-                Utility.logd("Facebook-publish", e);
-            }
-            return null;
-        }
-
-        @Override
-        protected void onPostExecute(Void result) {
-            // always clear out the publisher to allow other invocations.
-            synchronized (Session.this) {
-                autoPublishAsyncTask = null;
-            }
-        }
-    }
-
     /**
      * Base class for authorization requests {@link OpenRequest} and {@link NewPermissionsRequest}.
      */
diff --git a/facebook/src/com/facebook/Settings.java b/facebook/src/com/facebook/Settings.java
index 7a2d943c5..b53c11c37 100644
--- a/facebook/src/com/facebook/Settings.java
+++ b/facebook/src/com/facebook/Settings.java
@@ -57,7 +57,6 @@
     private static final HashSet<LoggingBehavior> loggingBehaviors =
             new HashSet<LoggingBehavior>(Arrays.asList(LoggingBehavior.DEVELOPER_ERRORS));
     private static volatile Executor executor;
-    private static volatile boolean shouldAutoPublishInstall;
     private static volatile String appVersion;
     private static volatile String applicationId;
     private static volatile String appClientToken;
@@ -81,9 +80,6 @@
     private static final String PUBLISH_ACTIVITY_PATH = "%s/activities";
     private static final String MOBILE_INSTALL_EVENT = "MOBILE_APP_INSTALL";
     private static final String ANALYTICS_EVENT = "event";
-    private static final String AUTO_PUBLISH = "auto_publish";
-
-    private static final String APP_EVENT_PREFERENCES = "com.facebook.sdk.appEventPreferences";
 
     private static final BlockingQueue<Runnable> DEFAULT_WORK_QUEUE = new LinkedBlockingQueue<Runnable>(10);
 
@@ -323,7 +319,7 @@ static void publishInstallAsync(final Context context, final String applicationI
         Settings.getExecutor().execute(new Runnable() {
             @Override
             public void run() {
-                final Response response = Settings.publishInstallAndWaitForResponse(applicationContext, applicationId, false);
+                final Response response = Settings.publishInstallAndWaitForResponse(applicationContext, applicationId);
                 if (callback != null) {
                     // invoke the callback on the main thread.
                     Handler handler = new Handler(Looper.getMainLooper());
@@ -338,34 +334,9 @@ public void run() {
         });
     }
 
-    /**
-     * Sets whether opening a Session should automatically publish install attribution to the Facebook graph.
-     *
-     * @param shouldAutoPublishInstall true to automatically publish, false to not
-     *
-     * This method is deprecated.  See {@link AppEventsLogger#activateApp(Context, String)} for more info.
-     */
-    @Deprecated
-    public static void setShouldAutoPublishInstall(boolean shouldAutoPublishInstall) {
-        Settings.shouldAutoPublishInstall = shouldAutoPublishInstall;
-    }
-
-    /**
-     * Gets whether opening a Session should automatically publish install attribution to the Facebook graph.
-     *
-     * @return true to automatically publish, false to not
-     *
-     * This method is deprecated.  See {@link AppEventsLogger#activateApp(Context, String)} for more info.
-     */
-    @Deprecated
-    public static boolean getShouldAutoPublishInstall() {
-        return shouldAutoPublishInstall;
-    }
-
     static Response publishInstallAndWaitForResponse(
             final Context context,
-            final String applicationId,
-            final boolean isAutoPublish) {
+            final String applicationId) {
         try {
             if (context == null || applicationId == null) {
                 throw new IllegalArgumentException("Both context and applicationId must be non-null");
@@ -377,19 +348,14 @@ static Response publishInstallAndWaitForResponse(
             long lastPing = preferences.getLong(pingKey, 0);
             String lastResponseJSON = preferences.getString(jsonKey, null);
 
-            // prevent auto publish from occurring if we have an explicit call.
-            if (!isAutoPublish) {
-                setShouldAutoPublishInstall(false);
-            }
-
             GraphObject publishParams = GraphObject.Factory.create();
             publishParams.setProperty(ANALYTICS_EVENT, MOBILE_INSTALL_EVENT);
 
-            Utility.setAppEventAttributionParameters(publishParams,
+            Utility.setAppEventAttributionParameters(
+                    publishParams,
                     identifiers,
-                    Utility.getHashedDeviceAndAppID(context, applicationId),
+                    AppEventsLogger.getAnonymousAppDeviceGUID(context),
                     getLimitEventAndDataUsage(context));
-            publishParams.setProperty(AUTO_PUBLISH, isAutoPublish);
             publishParams.setProperty("application_package_name", context.getPackageName());
 
             String publishUrl = String.format(PUBLISH_ACTIVITY_PATH, applicationId);
@@ -410,13 +376,8 @@ static Response publishInstallAndWaitForResponse(
                 } else {
                     return new Response(null, null, null, graphObject, true);
                 }
-            } else if (identifiers == null ||
-                       (identifiers.getAndroidAdvertiserId() == null && identifiers.getAttributionId() == null)) {
-                throw new FacebookException("No attribution id available to send to server.");
+
             } else {
-                if (!Utility.queryAppSettings(applicationId, false).supportsAttribution()) {
-                    throw new FacebookException("Install attribution has been disabled on the server.");
-                }
 
                 Response publishResponse = publishRequest.executeAndWait();
 
@@ -430,7 +391,7 @@ static Response publishInstallAndWaitForResponse(
                     publishResponse.getGraphObject().getInnerJSONObject() != null) {
                     editor.putString(jsonKey, publishResponse.getGraphObject().getInnerJSONObject().toString());
                 }
-                editor.commit();
+                editor.apply();
 
                 return publishResponse;
             }
@@ -446,18 +407,22 @@ static Response publishInstallAndWaitForResponse(
      * @return returns null if the facebook app is not present on the phone.
      */
     public static String getAttributionId(ContentResolver contentResolver) {
+        Cursor c = null;
         try {
             String [] projection = {ATTRIBUTION_ID_COLUMN_NAME};
-            Cursor c = contentResolver.query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
+            c = contentResolver.query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
             if (c == null || !c.moveToFirst()) {
                 return null;
             }
             String attributionId = c.getString(c.getColumnIndex(ATTRIBUTION_ID_COLUMN_NAME));
-            c.close();
             return attributionId;
         } catch (Exception e) {
             Log.d(TAG, "Caught unexpected exception in getAttributionId(): " + e.toString());
             return null;
+        } finally {
+            if (c != null) {
+                c.close();
+            }
         }
     }
 
@@ -497,7 +462,7 @@ public static String getSdkVersion() {
      * @param context   Used to read the value.
      */
     public static boolean getLimitEventAndDataUsage(Context context) {
-        SharedPreferences preferences = context.getSharedPreferences(APP_EVENT_PREFERENCES, Context.MODE_PRIVATE);
+        SharedPreferences preferences = context.getSharedPreferences(AppEventsLogger.APP_EVENT_PREFERENCES, Context.MODE_PRIVATE);
         return preferences.getBoolean("limitEventUsage", false);
     }
 
@@ -510,10 +475,10 @@ public static boolean getLimitEventAndDataUsage(Context context) {
      * @param context   Used to persist this value across app runs.
      */
     public static void setLimitEventAndDataUsage(Context context, boolean limitEventUsage) {
-        SharedPreferences preferences = context.getSharedPreferences(APP_EVENT_PREFERENCES, Context.MODE_PRIVATE);
-        SharedPreferences.Editor editor = preferences.edit();
-        editor.putBoolean("limitEventUsage", limitEventUsage);
-        editor.commit();
+        context.getSharedPreferences(AppEventsLogger.APP_EVENT_PREFERENCES, Context.MODE_PRIVATE)
+            .edit()
+            .putBoolean("limitEventUsage", limitEventUsage)
+            .apply();
     }
 
     /**
diff --git a/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java b/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
index 0286d3c1f..10eca8b80 100644
--- a/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
+++ b/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
@@ -163,18 +163,14 @@ public void save(Bundle bundle) {
                 return;
             }
         }
-
-        boolean successfulCommit = editor.commit();
-        if (!successfulCommit) {
-            Logger.log(LoggingBehavior.CACHE, Log.WARN, TAG, "SharedPreferences.Editor.commit() was not successful");
-        }
+        editor.apply();
     }
 
     /**
      * Clears out all token information stored in this cache.
      */
     public void clear() {
-        cache.edit().clear().commit();
+        cache.edit().clear().apply();
     }
 
     private void serializeKey(String key, Bundle bundle, SharedPreferences.Editor editor)
diff --git a/facebook/src/com/facebook/android/Facebook.java b/facebook/src/com/facebook/android/Facebook.java
index 4680f364d..ab11035a5 100644
--- a/facebook/src/com/facebook/android/Facebook.java
+++ b/facebook/src/com/facebook/android/Facebook.java
@@ -531,9 +531,13 @@ public void onServiceConnected(ComponentName className, IBinder service) {
         @Override
         public void onServiceDisconnected(ComponentName arg) {
             serviceListener.onError(new Error("Service disconnected"));
-            // We returned an error so there's no point in
-            // keeping the binding open.
-            applicationsContext.unbindService(TokenRefreshServiceConnection.this);
+            try {
+                // We returned an error so there's no point in
+                // keeping the binding open.
+                applicationsContext.unbindService(TokenRefreshServiceConnection.this);
+            } catch (IllegalArgumentException ex) {
+                // Do nothing, the connection was already unbound
+            }
         }
 
         private void refreshToken() {
@@ -1197,32 +1201,6 @@ public static String getAttributionId(ContentResolver contentResolver) {
         return Settings.getAttributionId(contentResolver);
     }
 
-    /**
-     * Get the auto install publish setting.  If true, an install event will be published during authorize(), unless
-     * it has occurred previously or the app does not have install attribution enabled on the application's developer
-     * config page.
-     * <p/>
-     * This method is deprecated.  See {@link Facebook} and {@link Settings} for more info.
-     *
-     * @return a Boolean indicating whether installation of the app should be auto-published.
-     */
-    @Deprecated
-    public boolean getShouldAutoPublishInstall() {
-        return Settings.getShouldAutoPublishInstall();
-    }
-
-    /**
-     * Sets whether auto publishing of installs will occur.
-     * <p/>
-     * This method is deprecated.  See {@link Facebook} and {@link Settings} for more info.
-     *
-     * @param value a Boolean indicating whether installation of the app should be auto-published.
-     */
-    @Deprecated
-    public void setShouldAutoPublishInstall(boolean value) {
-        Settings.setShouldAutoPublishInstall(value);
-    }
-
     /**
      * Callback interface for dialog requests.
      * <p/>
diff --git a/facebook/src/com/facebook/internal/AnalyticsEvents.java b/facebook/src/com/facebook/internal/AnalyticsEvents.java
index a7b8038ee..9488e0c8d 100644
--- a/facebook/src/com/facebook/internal/AnalyticsEvents.java
+++ b/facebook/src/com/facebook/internal/AnalyticsEvents.java
@@ -37,6 +37,7 @@
     public static final String EVENT_NATIVE_DIALOG_TYPE_OG_MESSAGE      = "fb_dialogs_present_message_og";
     public static final String EVENT_NATIVE_DIALOG_TYPE_PHOTO_SHARE     = "fb_dialogs_present_share_photo";
     public static final String EVENT_NATIVE_DIALOG_TYPE_PHOTO_MESSAGE   = "fb_dialogs_present_message_photo";
+    public static final String EVENT_NATIVE_DIALOG_TYPE_VIDEO_SHARE     = "fb_dialogs_present_share_video";
     public static final String EVENT_NATIVE_DIALOG_TYPE_LIKE            = "fb_dialogs_present_like";
 
     public static final String EVENT_LIKE_VIEW_CANNOT_PRESENT_DIALOG    = "fb_like_control_cannot_present_dialog";
diff --git a/facebook/src/com/facebook/internal/AttributionIdentifiers.java b/facebook/src/com/facebook/internal/AttributionIdentifiers.java
index 4efe7a3e6..b00c4e6f8 100644
--- a/facebook/src/com/facebook/internal/AttributionIdentifiers.java
+++ b/facebook/src/com/facebook/internal/AttributionIdentifiers.java
@@ -108,12 +108,12 @@ public static AttributionIdentifiers getAttributionIdentifiers(Context context)
         }
 
         AttributionIdentifiers identifiers = getAndroidId(context);
-
+        Cursor c = null;
         try {
             String [] projection = {ATTRIBUTION_ID_COLUMN_NAME, ANDROID_ID_COLUMN_NAME, LIMIT_TRACKING_COLUMN_NAME};
-            Cursor c = context.getContentResolver().query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
+            c = context.getContentResolver().query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
             if (c == null || !c.moveToFirst()) {
-                return null;
+                return identifiers;
             }
             int attributionColumnIndex = c.getColumnIndex(ATTRIBUTION_ID_COLUMN_NAME);
             int androidIdColumnIndex = c.getColumnIndex(ANDROID_ID_COLUMN_NAME);
@@ -127,10 +127,13 @@ public static AttributionIdentifiers getAttributionIdentifiers(Context context)
                 identifiers.androidAdvertiserId = c.getString(androidIdColumnIndex);
                 identifiers.limitTracking = Boolean.parseBoolean(c.getString(limitTrackingColumnIndex));
             }
-            c.close();
         } catch (Exception e) {
             Log.d(TAG, "Caught unexpected exception in getAttributionId(): " + e.toString());
             return null;
+        } finally {
+            if (c != null) {
+                c.close();
+            }
         }
 
         identifiers.fetchTime = System.currentTimeMillis();
@@ -149,4 +152,4 @@ public String getAndroidAdvertiserId() {
     public boolean isTrackingLimited() {
         return limitTracking;
     }
-}
\ No newline at end of file
+}
diff --git a/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java b/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java
index 5333187dc..a042c918e 100644
--- a/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java
+++ b/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java
@@ -20,15 +20,15 @@
 import android.content.Intent;
 import android.net.Uri;
 import android.os.Bundle;
+import android.os.Handler;
+import android.os.Looper;
+import android.webkit.WebView;
 import com.facebook.FacebookException;
-import com.facebook.android.Util;
 import com.facebook.widget.FacebookDialog;
 import com.facebook.widget.WebDialog;
 import org.json.JSONException;
 import org.json.JSONObject;
 
-import java.util.EnumSet;
-
 /**
  * com.facebook.internal is solely for the use of other packages within the Facebook SDK for Android. Use of
  * any of the classes in this package is unsupported, and they may be modified or removed without warning at
@@ -39,6 +39,9 @@
  */
 public class FacebookWebFallbackDialog extends WebDialog {
     private static final String TAG = FacebookWebFallbackDialog.class.getName();
+    private static final int OS_BACK_BUTTON_RESPONSE_TIMEOUT_MILLISECONDS = 1500;
+
+    private boolean waitingForDialogToClose;
 
     public static boolean presentWebFallback(final Context context,
                                              String dialogUrl,
@@ -121,4 +124,48 @@ protected Bundle parseResponseUri(String url) {
 
         return queryParams;
     }
+
+    @Override
+    public void dismiss() {
+        WebView webView = getWebView();
+
+        if (isListenerCalled() || webView == null || !webView.isShown()) {
+            // If the listener has been called, or if the WebView isn't visible, we cannot give the dialog a chance
+            // to respond. So defer to the parent implementation.
+            super.dismiss();
+            return;
+        }
+
+        // If we have already notified the dialog to close, then ignore this request to dismiss. The timer will
+        // honor the request.
+        if (waitingForDialogToClose) {
+            return;
+        }
+        waitingForDialogToClose = true;
+
+        // Now fire off the event that will tell the dialog to wind down.
+        String eventJS =
+                "(function() {" +
+                "  var event = document.createEvent('Event');" +
+                "  event.initEvent('fbPlatformDialogMustClose',true,true);" +
+                "  document.dispatchEvent(event);" +
+                "})();";
+        webView.loadUrl("javascript:" + eventJS);
+
+        // Set up a timeout for the dialog to respond. If the timer expires, we need to honor the user's desire to
+        // dismiss the dialog.
+        Handler handler = new Handler(Looper.getMainLooper());
+        handler.postDelayed(
+                new Runnable() {
+                    @Override
+                    public void run() {
+                        if (!isListenerCalled()) {
+                            // If we get here, then the dialog did not close quickly enough. So we need to honor the user's
+                            // wish to cancel.
+                            sendCancelToListener();
+                        }
+                    }
+                },
+                OS_BACK_BUTTON_RESPONSE_TIMEOUT_MILLISECONDS);
+    }
 }
diff --git a/facebook/src/com/facebook/internal/ImageDownloader.java b/facebook/src/com/facebook/internal/ImageDownloader.java
index 69bea7f4a..058c55bc8 100644
--- a/facebook/src/com/facebook/internal/ImageDownloader.java
+++ b/facebook/src/com/facebook/internal/ImageDownloader.java
@@ -22,6 +22,7 @@
 import android.os.Handler;
 import android.os.Looper;
 import com.facebook.FacebookException;
+import com.facebook.android.R;
 
 import java.io.IOException;
 import java.io.InputStream;
@@ -246,15 +247,19 @@ private static void download(RequestKey key, Context context) {
 
                 default:
                     stream = connection.getErrorStream();
-                    InputStreamReader reader = new InputStreamReader(stream);
-                    char[] buffer = new char[128];
-                    int bufferLength;
                     StringBuilder errorMessageBuilder = new StringBuilder();
-                    while ((bufferLength = reader.read(buffer, 0, buffer.length)) > 0) {
-                        errorMessageBuilder.append(buffer, 0, bufferLength);
+                    if (stream != null) {
+                        InputStreamReader reader = new InputStreamReader(stream);
+                        char[] buffer = new char[128];
+                        int bufferLength;
+                        while ((bufferLength = reader.read(buffer, 0, buffer.length)) > 0) {
+                            errorMessageBuilder.append(buffer, 0, bufferLength);
+                        }
+                        Utility.closeQuietly(reader);
+                    } else {
+                        errorMessageBuilder.append(
+                            context.getString(R.string.com_facebook_image_download_unknown_error));
                     }
-                    Utility.closeQuietly(reader);
-
                     error = new FacebookException(errorMessageBuilder.toString());
                     break;
             }
diff --git a/facebook/src/com/facebook/internal/LikeActionController.java b/facebook/src/com/facebook/internal/LikeActionController.java
index d16af520d..308a2db07 100644
--- a/facebook/src/com/facebook/internal/LikeActionController.java
+++ b/facebook/src/com/facebook/internal/LikeActionController.java
@@ -167,7 +167,7 @@ public void onComplete(LikeActionController likeActionController) {
      * Called by the LikeView when an object-id is set on it.
      * @param context context
      * @param objectId Object Id
-     * @return A LikeActionController for the specified object id
+     * @param callback Callback to be invoked when the LikeActionController has been created.
      */
     public static void getControllerForObjectId(
             Context context,
@@ -562,7 +562,7 @@ public void toggleLike(Activity activity, Bundle analyticsParameters) {
         appEventsLogger.logSdkEvent(AnalyticsEvents.EVENT_LIKE_VIEW_DID_TAP, null, analyticsParameters);
 
         boolean shouldLikeObject = !this.isObjectLiked;
-        if (canUseOGPublish(shouldLikeObject)) {
+        if (canUseOGPublish()) {
             // Update UI state optimistically
             updateState(shouldLikeObject,
                     this.likeCountStringWithLike,
@@ -583,17 +583,41 @@ public void toggleLike(Activity activity, Bundle analyticsParameters) {
     }
 
     private void performLikeOrUnlike(Activity activity, boolean shouldLikeObject, Bundle analyticsParameters) {
-        if (canUseOGPublish(shouldLikeObject)) {
+        if (canUseOGPublish()) {
             if (shouldLikeObject) {
                 publishLikeAsync(activity, analyticsParameters);
             } else {
-                publishUnlikeAsync(activity, analyticsParameters);
+                if (!Utility.isNullOrEmpty(this.unlikeToken)) {
+                    publishUnlikeAsync(activity, analyticsParameters);
+                } else {
+                    // If we don't have an unlikeToken, we must fall back to the dialog.
+                    fallbackToDialog(activity, analyticsParameters, true);
+                }
             }
         } else {
             presentLikeDialog(activity, analyticsParameters);
         }
     }
 
+    /**
+     * Only to be called after an OG-publish was attempted and something went wrong. The Button state is reverted
+     * and the dialog is presented.
+     */
+    private void fallbackToDialog(
+            Activity activity,
+            Bundle analyticsParameters,
+            boolean oldLikeState) {
+        updateState(
+                oldLikeState,
+                this.likeCountStringWithLike,
+                this.likeCountStringWithoutLike,
+                this.socialSentenceWithLike,
+                this.socialSentenceWithoutLike,
+                this.unlikeToken);
+
+        presentLikeDialog(activity, analyticsParameters);
+    }
+
     private void updateState(boolean isObjectLiked,
                              String likeCountStringWithLike,
                              String likeCountStringWithoutLike,
@@ -683,15 +707,31 @@ private boolean onActivityResult(int requestCode, int resultCode, Intent data, U
         return new FacebookDialog.Callback() {
             @Override
             public void onComplete(FacebookDialog.PendingCall pendingCall, Bundle data) {
-                if (!data.containsKey(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY)) {
-                    // This is an empty result that we can't handle. Don't lose like state.
+                if (data == null || !data.containsKey(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY)) {
+                    // This is an empty result that we can't handle.
                     return;
                 }
 
                 boolean isObjectLiked = data.getBoolean(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY);
-                String likeCountString = data.getString(LIKE_DIALOG_RESPONSE_LIKE_COUNT_STRING_KEY);
-                String socialSentence = data.getString(LIKE_DIALOG_RESPONSE_SOCIAL_SENTENCE_KEY);
-                String unlikeToken = data.getString(LIKE_DIALOG_RESPONSE_UNLIKE_TOKEN_KEY);
+
+                // Default to known/cached state, if properties are missing.
+                String likeCountStringWithLike = LikeActionController.this.likeCountStringWithLike;
+                String likeCountStringWithoutLike = LikeActionController.this.likeCountStringWithoutLike;
+                if (data.containsKey(LIKE_DIALOG_RESPONSE_LIKE_COUNT_STRING_KEY)) {
+                    likeCountStringWithLike = data.getString(LIKE_DIALOG_RESPONSE_LIKE_COUNT_STRING_KEY);
+                    likeCountStringWithoutLike = likeCountStringWithLike;
+                }
+
+                String socialSentenceWithLike = LikeActionController.this.socialSentenceWithLike;
+                String socialSentenceWithoutWithoutLike = LikeActionController.this.socialSentenceWithoutLike;
+                if (data.containsKey(LIKE_DIALOG_RESPONSE_SOCIAL_SENTENCE_KEY)) {
+                    socialSentenceWithLike = data.getString(LIKE_DIALOG_RESPONSE_SOCIAL_SENTENCE_KEY);
+                    socialSentenceWithoutWithoutLike = socialSentenceWithLike;
+                }
+
+                String unlikeToken = data.containsKey(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY)
+                        ? data.getString(LIKE_DIALOG_RESPONSE_UNLIKE_TOKEN_KEY)
+                        : LikeActionController.this.unlikeToken;
 
                 Bundle logParams = (analyticsParameters == null) ? new Bundle() : analyticsParameters;
                 logParams.putString(AnalyticsEvents.PARAMETER_CALL_ID, pendingCall.getCallId().toString());
@@ -699,10 +739,10 @@ public void onComplete(FacebookDialog.PendingCall pendingCall, Bundle data) {
 
                 updateState(
                         isObjectLiked,
-                        likeCountString,
-                        likeCountString,
-                        socialSentence,
-                        socialSentence,
+                        likeCountStringWithLike,
+                        likeCountStringWithoutLike,
+                        socialSentenceWithLike,
+                        socialSentenceWithoutWithoutLike,
                         unlikeToken);
             }
 
@@ -752,15 +792,14 @@ private void storeObjectIdForPendingController(String objectId) {
                 .apply();
     }
 
-    private boolean canUseOGPublish(boolean willPerformLike) {
+    private boolean canUseOGPublish() {
         // Verify that the object isn't a Page, that we have permissions and that, if we're unliking, then
         // we have an unlike token.
         return !objectIsPage &&
                 verifiedObjectId != null &&
                 session != null &&
                 session.getPermissions() != null &&
-                session.getPermissions().contains("publish_actions") &&
-                (willPerformLike || !Utility.isNullOrEmpty(unlikeToken));
+                session.getPermissions().contains("publish_actions");
     }
 
     private void publishLikeAsync(final Activity activity, final Bundle analyticsParameters) {
@@ -792,15 +831,7 @@ public void onBatchCompleted(RequestBatch batch) {
                             // revert back to the Unliked state and show the dialog. We need to do this because the
                             // dialog-flow expects the button to only be updated once the dialog returns
 
-                            updateState(
-                                    false,
-                                    likeCountStringWithLike,
-                                    likeCountStringWithoutLike,
-                                    socialSentenceWithLike,
-                                    socialSentenceWithoutLike,
-                                    unlikeToken);
-
-                            presentLikeDialog(activity, analyticsParameters);
+                            fallbackToDialog(activity, analyticsParameters, false);
                         } else {
                             unlikeToken = Utility.coerceValueIfNullOrEmpty(likeRequest.unlikeToken, null);
                             isObjectLikedOnServer = true;
@@ -834,15 +865,7 @@ public void onBatchCompleted(RequestBatch batch) {
                     // revert back to the Liked state and show the dialog. We need to do this because the
                     // dialog-flow expects the button to only be updated once the dialog returns
 
-                    updateState(
-                            true,
-                            likeCountStringWithLike,
-                            likeCountStringWithoutLike,
-                            socialSentenceWithLike,
-                            socialSentenceWithoutLike,
-                            unlikeToken);
-
-                    presentLikeDialog(activity, analyticsParameters);
+                    fallbackToDialog(activity, analyticsParameters, true);
                 } else {
                     unlikeToken = null;
                     isObjectLikedOnServer = false;
@@ -864,6 +887,12 @@ private void refreshStatusAsync() {
             // to make sure we get the correct like state.
             refreshStatusViaService();
             return;
+        } else if (!session.isOpened()) {
+            // The session might be OPENING. In this case, we don't have an access token yet and
+            // cannot make server requests. We hit this code path during login when the
+            // Session.ACTION_ACTIVE_SESSION_UNSET broadcast fires, which LikeActionController
+            // responds to by resetting.
+            return;
         }
 
         fetchVerifiedObjectId(new RequestCompletionCallback() {
@@ -918,17 +947,37 @@ private void refreshStatusViaService() {
         LikeStatusClient.CompletedListener callback = new LikeStatusClient.CompletedListener() {
             @Override
             public void completed(Bundle result) {
+                // Don't lose old state if the service response is incomplete.
                 if (result == null || !result.containsKey(NativeProtocol.EXTRA_OBJECT_IS_LIKED)) {
-                    // Don't lose old state if the service response is incomplete.
                     return;
                 }
 
                 boolean objectIsLiked = result.getBoolean(NativeProtocol.EXTRA_OBJECT_IS_LIKED);
-                String likeCountWithLike = result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITH_LIKE);
-                String likeCountWithoutLike = result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITHOUT_LIKE);
-                String socialSentenceWithLike = result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITH_LIKE);
-                String socialSentenceWithoutLike = result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITHOUT_LIKE);
-                String unlikeToken = result.getString(NativeProtocol.EXTRA_UNLIKE_TOKEN);
+
+                String likeCountWithLike =
+                        result.containsKey(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITH_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITH_LIKE)
+                                : LikeActionController.this.likeCountStringWithLike;
+
+                String likeCountWithoutLike =
+                        result.containsKey(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITHOUT_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITHOUT_LIKE)
+                                : LikeActionController.this.likeCountStringWithoutLike;
+
+                String socialSentenceWithLike =
+                        result.containsKey(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITH_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITH_LIKE)
+                                : LikeActionController.this.socialSentenceWithLike;
+
+                String socialSentenceWithoutLike =
+                        result.containsKey(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITHOUT_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITHOUT_LIKE)
+                                : LikeActionController.this.socialSentenceWithoutLike;
+
+                String unlikeToken =
+                        result.containsKey(NativeProtocol.EXTRA_UNLIKE_TOKEN)
+                                ? result.getString(NativeProtocol.EXTRA_UNLIKE_TOKEN)
+                                : LikeActionController.this.unlikeToken;
 
                 updateState(
                         objectIsLiked,
@@ -1162,7 +1211,9 @@ protected void processError(FacebookRequestError error) {
     }
 
     private class GetOGObjectLikesRequestWrapper extends AbstractRequestWrapper {
-        boolean objectIsLiked;
+        // Initialize the like status to what we currently have. This way, empty/error responses don't end
+        // up clearing out the state.
+        boolean objectIsLiked = LikeActionController.this.isObjectLiked;
         String unlikeToken;
 
         GetOGObjectLikesRequestWrapper(String objectId) {
@@ -1204,10 +1255,12 @@ protected void processError(FacebookRequestError error) {
     }
 
     private class GetEngagementRequestWrapper extends AbstractRequestWrapper {
-        String likeCountStringWithLike;
-        String likeCountStringWithoutLike;
-        String socialSentenceStringWithLike;
-        String socialSentenceStringWithoutLike;
+        // Initialize the like status to what we currently have. This way, empty/error responses don't end
+        // up clearing out the state.
+        String likeCountStringWithLike = LikeActionController.this.likeCountStringWithLike;
+        String likeCountStringWithoutLike = LikeActionController.this.likeCountStringWithoutLike;
+        String socialSentenceStringWithLike = LikeActionController.this.socialSentenceWithLike;
+        String socialSentenceStringWithoutLike = LikeActionController.this.socialSentenceWithoutLike;
 
         GetEngagementRequestWrapper(String objectId) {
             super(objectId);
@@ -1228,10 +1281,18 @@ protected void processError(FacebookRequestError error) {
         protected void processSuccess(Response response) {
             JSONObject engagementResults = Utility.tryGetJSONObjectFromResponse(response.getGraphObject(), "engagement");
             if (engagementResults != null) {
-                likeCountStringWithLike = engagementResults.optString("count_string_with_like");
-                likeCountStringWithoutLike = engagementResults.optString("count_string_without_like");
-                socialSentenceStringWithLike = engagementResults.optString("social_sentence_with_like");
-                socialSentenceStringWithoutLike = engagementResults.optString("social_sentence_without_like");
+                // Missing properties in the response should default to cached like status
+                likeCountStringWithLike =
+                        engagementResults.optString("count_string_with_like", likeCountStringWithLike);
+
+                likeCountStringWithoutLike =
+                        engagementResults.optString("count_string_without_like", likeCountStringWithoutLike);
+
+                socialSentenceStringWithLike =
+                        engagementResults.optString("social_sentence_with_like", socialSentenceStringWithLike);
+
+                socialSentenceStringWithoutLike =
+                        engagementResults.optString("social_sentence_without_like", socialSentenceStringWithoutLike);
             }
         }
 
diff --git a/facebook/src/com/facebook/internal/NativeProtocol.java b/facebook/src/com/facebook/internal/NativeProtocol.java
index 50ca6f88a..e0e22f70a 100644
--- a/facebook/src/com/facebook/internal/NativeProtocol.java
+++ b/facebook/src/com/facebook/internal/NativeProtocol.java
@@ -62,6 +62,9 @@
     public static final int PROTOCOL_VERSION_20140324 = 20140324;
     public static final int PROTOCOL_VERSION_20140701 = 20140701;
     public static final int PROTOCOL_VERSION_20141001 = 20141001;
+    public static final int PROTOCOL_VERSION_20141028 = 20141028;
+    public static final int PROTOCOL_VERSION_20141107 = 20141107; // Bucketed Result Intents
+    public static final int PROTOCOL_VERSION_20141218 = 20141218;
 
     public static final String EXTRA_PROTOCOL_VERSION = "com.facebook.platform.protocol.PROTOCOL_VERSION";
     public static final String EXTRA_PROTOCOL_ACTION = "com.facebook.platform.protocol.PROTOCOL_ACTION";
@@ -150,6 +153,11 @@
             "com.facebook.platform.extra.EXPIRES_SECONDS_SINCE_EPOCH";
     // EXTRA_PERMISSIONS
 
+    public static final String RESULT_ARGS_ACCESS_TOKEN = "access_token";
+    public static final String RESULT_ARGS_EXPIRES_SECONDS_SINCE_EPOCH =
+            "expires_seconds_since_epoch";
+    public static final String RESULT_ARGS_PERMISSIONS = "permissions";
+
     // Extras supported for ACTION_FEED_DIALOG:
     public static final String EXTRA_PLACE_TAG = "com.facebook.platform.extra.PLACE";
     public static final String EXTRA_FRIEND_TAGS = "com.facebook.platform.extra.FRIENDS";
@@ -172,6 +180,7 @@
     public static final String METHOD_ARGS_REF = "REF";
     public static final String METHOD_ARGS_DATA_FAILURES_FATAL = "DATA_FAILURES_FATAL";
     public static final String METHOD_ARGS_PHOTOS = "PHOTOS";
+    public static final String METHOD_ARGS_VIDEO = "VIDEO";
 
     // Extras supported for ACTION_OGACTIONPUBLISH_DIALOG:
     public static final String EXTRA_ACTION = "com.facebook.platform.extra.ACTION";
@@ -213,6 +222,12 @@
     public static final String STATUS_ERROR_SUBCODE = "com.facebook.platform.status.ERROR_SUBCODE";
     public static final String STATUS_ERROR_JSON = "com.facebook.platform.status.ERROR_JSON";
 
+    public static final String BRIDGE_ARG_ERROR_TYPE = "error_type";
+    public static final String BRIDGE_ARG_ERROR_DESCRIPTION = "error_description";
+    public static final String BRIDGE_ARG_ERROR_CODE = "error_code";
+    public static final String BRIDGE_ARG_ERROR_SUBCODE = "error_subcode";
+    public static final String BRIDGE_ARG_ERROR_JSON = "error_json";
+
     // Expected values for ERROR_KEY_TYPE.  Clients should tolerate other values:
     public static final String ERROR_UNKNOWN_ERROR = "UnknownError";
     public static final String ERROR_PROTOCOL_ERROR = "ProtocolError";
@@ -428,6 +443,9 @@ public static final int getLatestKnownVersion() {
     // Note: be sure this stays sorted in descending order; add new versions at the beginning
     private static final List<Integer> KNOWN_PROTOCOL_VERSIONS =
             Arrays.asList(
+                    PROTOCOL_VERSION_20141218,
+                    PROTOCOL_VERSION_20141107,
+                    PROTOCOL_VERSION_20141028,
                     PROTOCOL_VERSION_20141001,
                     PROTOCOL_VERSION_20140701,
                     PROTOCOL_VERSION_20140324,
@@ -578,8 +596,6 @@ public static Bundle getErrorDataFromResultIntent(Intent resultIntent) {
         Bundle bridgeArgs = getBridgeArgumentsFromIntent(resultIntent);
         if (bridgeArgs != null) {
             return bridgeArgs.getBundle(BRIDGE_ARG_ERROR_BUNDLE);
-
-
         }
 
         return resultIntent.getExtras();
@@ -590,10 +606,15 @@ public static Exception getExceptionFromErrorData(Bundle errorData) {
             return null;
         }
 
-        // TODO This is not going to work for JS dialogs, where the keys are not STATUS_ERROR_TYPE etc.
-        // TODO However, it should keep existing dialogs functional
-        String type = errorData.getString(STATUS_ERROR_TYPE);
-        String description = errorData.getString(STATUS_ERROR_DESCRIPTION);
+        String type = errorData.getString(BRIDGE_ARG_ERROR_TYPE);
+        if (type == null) {
+            type = errorData.getString(STATUS_ERROR_TYPE);
+        }
+
+        String description = errorData.getString(BRIDGE_ARG_ERROR_DESCRIPTION);
+        if (description == null) {
+            description = errorData.getString(STATUS_ERROR_DESCRIPTION);
+        }
 
         if (type != null && type.equalsIgnoreCase(ERROR_USER_CANCELED)) {
             return new FacebookOperationCanceledException(description);
@@ -634,6 +655,15 @@ private static int getLatestAvailableProtocolVersionForAppInfo(
             Context context,
             NativeAppInfo appInfo,
             int[] versionSpec) {
+        TreeSet<Integer> fbAppVersions = getAllAvailableProtocolVersionsForAppInfo(context, appInfo);
+        return computeLatestAvailableVersionFromVersionSpec(fbAppVersions, getLatestKnownVersion(), versionSpec);
+    }
+
+    private static TreeSet<Integer> getAllAvailableProtocolVersionsForAppInfo(
+            Context context,
+            NativeAppInfo appInfo) {
+        TreeSet<Integer> allAvailableVersions = new TreeSet<Integer>();
+
         ContentResolver contentResolver = context.getContentResolver();
 
         String [] projection = new String[]{ PLATFORM_PROVIDER_VERSION_COLUMN };
@@ -641,50 +671,62 @@ private static int getLatestAvailableProtocolVersionForAppInfo(
         Cursor c = null;
         try {
             c = contentResolver.query(uri, projection, null, null, null);
-            if (c == null) {
-                return NO_PROTOCOL_AVAILABLE;
+            if (c != null) {
+                while (c.moveToNext()) {
+                    int version = c.getInt(c.getColumnIndex(PLATFORM_PROVIDER_VERSION_COLUMN));
+                    allAvailableVersions.add(version);
+                }
             }
-
-            TreeSet<Integer> fbAppVersions = new TreeSet<Integer>();
-            while (c.moveToNext()) {
-                int version = c.getInt(c.getColumnIndex(PLATFORM_PROVIDER_VERSION_COLUMN));
-                fbAppVersions.add(version);
+        } finally {
+            if (c != null) {
+                c.close();
             }
+        }
 
-            // Remember that these ranges are sorted in ascending order and can be unbounded. So we are starting
-            // from the end of the version-spec array and working backwards, to try get the newest possible version
-            int versionSpecIndex = versionSpec.length - 1;
-            Iterator<Integer> fbAppVersionsIterator = fbAppVersions.descendingIterator();
-            int latestAllowedVersion = getLatestKnownVersion();
-            while (fbAppVersionsIterator.hasNext()) {
-                int fbAppVersion = fbAppVersionsIterator.next();
-
-                // If there is a newer version in the versionSpec, throw it away, we don't have it
-                while (versionSpecIndex >= 0 && versionSpec[versionSpecIndex] > fbAppVersion) {
-                    versionSpecIndex--;
-                }
+        return allAvailableVersions;
+    }
 
-                if (versionSpecIndex < 0) {
-                    // There was no fb app version that fell into any range in the versionSpec - or - the
-                    // versionSpec was empty, which means that this action is not supported.
-                    return NO_PROTOCOL_AVAILABLE;
-                }
+    /**
+     * This is public to allow for testing. Developers are discouraged from using this method, since it may change without
+     * notice.
+     */
+    public static int computeLatestAvailableVersionFromVersionSpec(
+            TreeSet<Integer> allAvailableFacebookAppVersions,
+            int latestSdkVersion,
+            int[] versionSpec) {
+        // Remember that these ranges are sorted in ascending order and can be unbounded. So we are starting
+        // from the end of the version-spec array and working backwards, to try get the newest possible version
+        int versionSpecIndex = versionSpec.length - 1;
+        Iterator<Integer> fbAppVersionsIterator = allAvailableFacebookAppVersions.descendingIterator();
+        int latestFacebookAppVersion = -1;
 
-                // If we are here, we know we are within a range specified in the versionSpec. We should see if it is
-                // a disabled or enabled range.
+        while (fbAppVersionsIterator.hasNext()) {
+            int fbAppVersion = fbAppVersionsIterator.next();
 
-                if (versionSpec[versionSpecIndex] == fbAppVersion) {
-                    // if the versionSpecIndex is even, it is enabled; if odd, disabled
-                    return (
-                            versionSpecIndex % 2 == 0 ?
-                                    Math.min(fbAppVersion, latestAllowedVersion) :
-                                    NO_PROTOCOL_AVAILABLE
-                    );
-                }
+            // We're holding on to the greatest fb-app version available.
+            latestFacebookAppVersion = Math.max(latestFacebookAppVersion, fbAppVersion);
+
+            // If there is a newer version in the versionSpec, throw it away, we don't have it
+            while (versionSpecIndex >= 0 && versionSpec[versionSpecIndex] > fbAppVersion) {
+                versionSpecIndex--;
             }
-        } finally {
-            if (c != null) {
-                c.close();
+
+            if (versionSpecIndex < 0) {
+                // There was no fb app version that fell into any range in the versionSpec - or - the
+                // versionSpec was empty, which means that this action is not supported.
+                return NO_PROTOCOL_AVAILABLE;
+            }
+
+            // If we are here, we know we are within a range specified in the versionSpec. We should see if it is
+            // a disabled or enabled range.
+
+            if (versionSpec[versionSpecIndex] == fbAppVersion) {
+                // if the versionSpecIndex is even, it is enabled; if odd, disabled
+                return (
+                        versionSpecIndex % 2 == 0 ?
+                                Math.min(latestFacebookAppVersion, latestSdkVersion) :
+                                NO_PROTOCOL_AVAILABLE
+                );
             }
         }
 
diff --git a/facebook/src/com/facebook/internal/PlatformServiceClient.java b/facebook/src/com/facebook/internal/PlatformServiceClient.java
index 16d619c3b..df75fc5e5 100644
--- a/facebook/src/com/facebook/internal/PlatformServiceClient.java
+++ b/facebook/src/com/facebook/internal/PlatformServiceClient.java
@@ -96,7 +96,11 @@ public void onServiceConnected(ComponentName name, IBinder service) {
 
     public void onServiceDisconnected(ComponentName name) {
         sender = null;
-        context.unbindService(this);
+        try {
+            context.unbindService(this);
+        } catch (IllegalArgumentException ex) {
+            // Do nothing, the connection was already unbound
+        }
         callback(null);
     }
 
diff --git a/facebook/src/com/facebook/internal/ServerProtocol.java b/facebook/src/com/facebook/internal/ServerProtocol.java
index 46931353d..7583f015d 100644
--- a/facebook/src/com/facebook/internal/ServerProtocol.java
+++ b/facebook/src/com/facebook/internal/ServerProtocol.java
@@ -64,7 +64,7 @@
     // URL components
     private static final String GRAPH_VIDEO_URL_FORMAT = "https://graph-video.%s";
     private static final String GRAPH_URL_FORMAT = "https://graph.%s";
-    public static final String GRAPH_API_VERSION = "v2.1";
+    public static final String GRAPH_API_VERSION = "v2.2";
 
     private static final String LEGACY_API_VERSION = "v1.0";
 
diff --git a/facebook/src/com/facebook/internal/Utility.java b/facebook/src/com/facebook/internal/Utility.java
index 91f627b02..148108bac 100644
--- a/facebook/src/com/facebook/internal/Utility.java
+++ b/facebook/src/com/facebook/internal/Utility.java
@@ -61,7 +61,6 @@
     private static final String URL_SCHEME = "https";
     private static final String APP_SETTINGS_PREFS_STORE = "com.facebook.internal.preferences.APP_SETTINGS";
     private static final String APP_SETTINGS_PREFS_KEY_FORMAT = "com.facebook.internal.APP_SETTINGS.%s";
-    private static final String APP_SETTING_SUPPORTS_ATTRIBUTION = "supports_attribution";
     private static final String APP_SETTING_SUPPORTS_IMPLICIT_SDK_LOGGING = "supports_implicit_sdk_logging";
     private static final String APP_SETTING_NUX_CONTENT = "gdpv4_nux_content";
     private static final String APP_SETTING_NUX_ENABLED = "gdpv4_nux_enabled";
@@ -75,7 +74,6 @@
     private final static String UTF8 = "UTF-8";
 
     private static final String[] APP_SETTING_FIELDS = new String[] {
-            APP_SETTING_SUPPORTS_ATTRIBUTION,
             APP_SETTING_SUPPORTS_IMPLICIT_SDK_LOGGING,
             APP_SETTING_NUX_CONTENT,
             APP_SETTING_NUX_ENABLED,
@@ -92,28 +90,21 @@
     private static AsyncTask<Void, Void, GraphObject> initialAppSettingsLoadTask;
 
     public static class FetchedAppSettings {
-        private boolean supportsAttribution;
         private boolean supportsImplicitLogging;
         private String nuxContent;
         private boolean nuxEnabled;
         private Map<String, Map<String, DialogFeatureConfig>> dialogConfigMap;
 
-        private FetchedAppSettings(boolean supportsAttribution,
-                                   boolean supportsImplicitLogging,
+        private FetchedAppSettings(boolean supportsImplicitLogging,
                                    String nuxContent,
                                    boolean nuxEnabled,
                                    Map<String, Map<String, DialogFeatureConfig>> dialogConfigMap) {
-            this.supportsAttribution = supportsAttribution;
             this.supportsImplicitLogging = supportsImplicitLogging;
             this.nuxContent = nuxContent;
             this.nuxEnabled = nuxEnabled;
             this.dialogConfigMap = dialogConfigMap;
         }
 
-        public boolean supportsAttribution() {
-            return supportsAttribution;
-        }
-
         public boolean supportsImplicitLogging() {
             return supportsImplicitLogging;
         }
@@ -639,7 +630,9 @@ protected void onPostExecute(GraphObject result) {
                     SharedPreferences sharedPrefs = context.getSharedPreferences(
                             APP_SETTINGS_PREFS_STORE,
                             Context.MODE_PRIVATE);
-                    sharedPrefs.edit().putString(settingsKey, resultJSON.toString()).apply();
+                    sharedPrefs.edit()
+                        .putString(settingsKey, resultJSON.toString())
+                        .apply();
                 }
 
                 initialAppSettingsLoadTask = null;
@@ -682,7 +675,6 @@ public static FetchedAppSettings queryAppSettings(final String applicationId, fi
 
     private static FetchedAppSettings parseAppSettingsFromJSON(String applicationId, JSONObject settingsJSON) {
         FetchedAppSettings result = new FetchedAppSettings(
-                settingsJSON.optBoolean(APP_SETTING_SUPPORTS_ATTRIBUTION, false),
                 settingsJSON.optBoolean(APP_SETTING_SUPPORTS_IMPLICIT_SDK_LOGGING, false),
                 settingsJSON.optString(APP_SETTING_NUX_CONTENT, ""),
                 settingsJSON.optBoolean(APP_SETTING_NUX_ENABLED, false),
@@ -819,23 +811,11 @@ public static void deleteDirectory(File directoryOrFile) {
         return result;
     }
 
-    // Return a hash of the android_id combined with the appid.  Intended to dedupe requests on the server side
-    // in order to do counting of users unknown to Facebook.  Because we put the appid into the key prior to hashing,
-    // we cannot do correlation of the same user across multiple apps -- this is intentional.  When we transition to
-    // the Google advertising ID, we'll get rid of this and always send that up.
-    public static String getHashedDeviceAndAppID(Context context, String applicationId) {
-        String androidId = Secure.getString(context.getContentResolver(), Secure.ANDROID_ID);
-
-        if (androidId == null) {
-            return null;
-        } else {
-            return sha1hash(androidId + applicationId);
-        }
-    }
-
-    public static void setAppEventAttributionParameters(GraphObject params,
-                                                        AttributionIdentifiers attributionIdentifiers, String hashedDeviceAndAppId, boolean limitEventUsage) {
-        // Send attributionID if it exists, otherwise send a hashed device+appid specific value as the advertiser_id.
+    public static void setAppEventAttributionParameters(
+            GraphObject params,
+            AttributionIdentifiers attributionIdentifiers,
+            String anonymousAppDeviceGUID,
+            boolean limitEventUsage) {
         if (attributionIdentifiers != null && attributionIdentifiers.getAttributionId() != null) {
             params.setProperty("attribution", attributionIdentifiers.getAttributionId());
         }
@@ -843,10 +823,9 @@ public static void setAppEventAttributionParameters(GraphObject params,
         if (attributionIdentifiers != null && attributionIdentifiers.getAndroidAdvertiserId() != null) {
             params.setProperty("advertiser_id", attributionIdentifiers.getAndroidAdvertiserId());
             params.setProperty("advertiser_tracking_enabled", !attributionIdentifiers.isTrackingLimited());
-        } else if (hashedDeviceAndAppId != null) {
-            params.setProperty("advertiser_id", hashedDeviceAndAppId);
         }
 
+        params.setProperty("anon_id", anonymousAppDeviceGUID);
         params.setProperty("application_tracking_enabled", !limitEventUsage);
     }
 
diff --git a/facebook/src/com/facebook/widget/FacebookDialog.java b/facebook/src/com/facebook/widget/FacebookDialog.java
index 44ef2ceec..19bec3402 100644
--- a/facebook/src/com/facebook/widget/FacebookDialog.java
+++ b/facebook/src/com/facebook/widget/FacebookDialog.java
@@ -52,6 +52,10 @@
             "com.facebook.platform.extra.COMPLETION_GESTURE";
     private static final String EXTRA_DIALOG_COMPLETION_ID_KEY = "com.facebook.platform.extra.POST_ID";
 
+    public static final String RESULT_ARGS_DIALOG_COMPLETE_KEY = "didComplete";
+    public static final String RESULT_ARGS_DIALOG_COMPLETION_GESTURE_KEY = "completionGesture";
+    public static final String RESULT_ARGS_DIALOG_COMPLETION_ID_KEY = "postId";
+
     private static NativeAppCallAttachmentStore attachmentStore;
 
     /**
@@ -123,6 +127,10 @@
          * Indicates whether the native Share dialog supports sharing of photo images.
          */
         PHOTOS(NativeProtocol.PROTOCOL_VERSION_20140204),
+        /**
+         * Indicates whether the native Share dialog supports sharing of videos.
+         */
+        VIDEO(NativeProtocol.PROTOCOL_VERSION_20141028),
         ;
 
         private int minVersion;
@@ -165,6 +173,10 @@ public int getMinVersion() {
          * Indicates whether the native Message dialog supports sharing of photo images.
          */
         PHOTOS(NativeProtocol.PROTOCOL_VERSION_20140324),
+        /**
+         * Indicates whether the native Message dialog supports sharing of videos.
+         */
+        VIDEO(NativeProtocol.PROTOCOL_VERSION_20141218),
         ;
 
         private int minVersion;
@@ -274,6 +286,9 @@ public int getMinVersion() {
      * @return true if the native dialog completed normally
      */
     public static boolean getNativeDialogDidComplete(Bundle result) {
+        if (result.containsKey(RESULT_ARGS_DIALOG_COMPLETE_KEY)) {
+            return result.getBoolean(RESULT_ARGS_DIALOG_COMPLETE_KEY);
+        }
         return result.getBoolean(EXTRA_DIALOG_COMPLETE_KEY, false);
     }
 
@@ -285,6 +300,9 @@ public static boolean getNativeDialogDidComplete(Bundle result) {
      * @return "post" or "cancel" as the completion gesture
      */
     public static String getNativeDialogCompletionGesture(Bundle result) {
+        if (result.containsKey(RESULT_ARGS_DIALOG_COMPLETION_GESTURE_KEY)) {
+            return result.getString(RESULT_ARGS_DIALOG_COMPLETION_GESTURE_KEY);
+        }
         return result.getString(EXTRA_DIALOG_COMPLETION_GESTURE_KEY);
     }
 
@@ -296,6 +314,9 @@ public static String getNativeDialogCompletionGesture(Bundle result) {
      * @return the id of the published post
      */
     public static String getNativeDialogPostId(Bundle result) {
+        if (result.containsKey(RESULT_ARGS_DIALOG_COMPLETION_ID_KEY)) {
+            return result.getString(RESULT_ARGS_DIALOG_COMPLETION_ID_KEY);
+        }
         return result.getString(EXTRA_DIALOG_COMPLETION_ID_KEY);
     }
 
@@ -503,14 +524,29 @@ private static void logDialogActivity(Activity activity, Fragment fragment, Stri
     static private String getEventName(Intent intent) {
         String action = intent.getStringExtra(NativeProtocol.EXTRA_PROTOCOL_ACTION);
         boolean hasPhotos = intent.hasExtra(NativeProtocol.EXTRA_PHOTOS);
-        return getEventName(action, hasPhotos);
+        boolean hasVideo = false;
+
+        Bundle extras = intent.getBundleExtra(NativeProtocol.EXTRA_PROTOCOL_METHOD_ARGS);
+        if (extras != null) {
+            ArrayList<String> photo = extras.getStringArrayList(NativeProtocol.METHOD_ARGS_PHOTOS);
+            String video = extras.getString(NativeProtocol.METHOD_ARGS_VIDEO);
+            if (photo != null && !photo.isEmpty()) {
+                hasPhotos = true;
+            }
+            if (video != null && !video.isEmpty()) {
+                hasVideo = true;
+            }
+        }
+        return getEventName(action, hasPhotos, hasVideo);
     }
 
-    static private String getEventName(String action, boolean hasPhotos) {
+    static private String getEventName(String action, boolean hasPhotos, boolean hasVideo) {
         String eventName;
 
         if (action.equals(NativeProtocol.ACTION_FEED_DIALOG)) {
-            eventName = hasPhotos ?
+            eventName = hasVideo ?
+                    AnalyticsEvents.EVENT_NATIVE_DIALOG_TYPE_VIDEO_SHARE :
+                    hasPhotos ?
                     AnalyticsEvents.EVENT_NATIVE_DIALOG_TYPE_PHOTO_SHARE :
                     AnalyticsEvents.EVENT_NATIVE_DIALOG_TYPE_SHARE;
         } else if (action.equals(NativeProtocol.ACTION_MESSAGE_DIALOG)) {
@@ -543,7 +579,7 @@ static private String getEventName(String action, boolean hasPhotos) {
         protected Fragment fragment;
         protected String applicationName;
         protected HashMap<String, Bitmap> imageAttachments = new HashMap<String, Bitmap>();
-        protected HashMap<String, File> imageAttachmentFiles = new HashMap<String, File>();
+        protected HashMap<String, File> mediaAttachmentFiles = new HashMap<String, File>();
 
         /**
          * Constructor.
@@ -632,7 +668,7 @@ public FacebookDialog build() {
                     extras);
             if (intent == null) {
                 logDialogActivity(activity, fragment,
-                        getEventName(action, extras.containsKey(NativeProtocol.EXTRA_PHOTOS)),
+                        getEventName(action, extras.containsKey(NativeProtocol.EXTRA_PHOTOS), false),
                         AnalyticsEvents.PARAMETER_DIALOG_OUTCOME_VALUE_FAILED);
 
                 throw new FacebookException(
@@ -714,9 +750,9 @@ public void onPresent(Context context) throws Exception {
                     if (imageAttachments != null && imageAttachments.size() > 0) {
                         getAttachmentStore().addAttachmentsForCall(context, appCall.getCallId(), imageAttachments);
                     }
-                    if (imageAttachmentFiles != null && imageAttachmentFiles.size() > 0) {
+                    if (mediaAttachmentFiles != null && mediaAttachmentFiles.size() > 0) {
                         getAttachmentStore().addAttachmentFilesForCall(context, appCall.getCallId(),
-                                imageAttachmentFiles);
+                                mediaAttachmentFiles);
                     }
                 }
             };
@@ -752,6 +788,14 @@ public void onPresent(Context context) throws Exception {
             return attachmentUrls;
         }
 
+        protected String addVideoAttachmentFile(File videoFile) {
+            String attachmentName = UUID.randomUUID().toString();
+            addVideoAttachment(attachmentName, videoFile);
+            String url = NativeAppCallContentProvider.getAttachmentUrl(applicationId, appCall.getCallId(),
+                    attachmentName);
+            return url;
+        }
+
         List<String> getImageAttachmentNames() {
             return new ArrayList<String>(imageAttachments.keySet());
         }
@@ -779,7 +823,14 @@ protected CONCRETE addImageAttachment(String imageName, Bitmap bitmap) {
         }
 
         protected CONCRETE addImageAttachment(String imageName, File attachment) {
-            imageAttachmentFiles.put(imageName, attachment);
+            mediaAttachmentFiles.put(imageName, attachment);
+            @SuppressWarnings("unchecked")
+            CONCRETE result = (CONCRETE) this;
+            return result;
+        }
+
+        protected CONCRETE addVideoAttachment(String videoName, File attachment) {
+            mediaAttachmentFiles.put(videoName, attachment);
             @SuppressWarnings("unchecked")
             CONCRETE result = (CONCRETE) this;
             return result;
@@ -807,9 +858,9 @@ public ShareDialogBuilderBase(Activity activity) {
         }
 
         /**
-         * Sets the title of the item to be shared.
+         * Sets the name of the URL to be shared. This method only has effect if setLink is called.
          *
-         * @param name the title
+         * @param name the name
          * @return this instance of the builder
          */
         public CONCRETE setName(String name) {
@@ -820,9 +871,9 @@ public CONCRETE setName(String name) {
         }
 
         /**
-         * Sets the subtitle of the item to be shared.
+         * Sets the caption of the URL to be shared. This method only has effect if setLink is called.
          *
-         * @param caption the subtitle
+         * @param caption the caption
          * @return this instance of the builder
          */
         public CONCRETE setCaption(String caption) {
@@ -833,7 +884,7 @@ public CONCRETE setCaption(String caption) {
         }
 
         /**
-         * Sets the description of the item to be shared.
+         * Sets the description of the URL to be shared. This method only has effect if setLink is called.
          *
          * @param description the description
          * @return this instance of the builder
@@ -859,7 +910,7 @@ public CONCRETE setLink(String link) {
         }
 
         /**
-         * Sets the URL of the image of the item to be shared.
+         * Sets the URL of the image of the URL to be shared. This method only has effect if setLink is called.
          *
          * @param picture the URL of the image
          * @return this instance of the builder
@@ -891,7 +942,7 @@ public CONCRETE setPlace(String place) {
          * @return this instance of the builder
          */
         public CONCRETE setFriends(List<String> friends) {
-            this.friends = new ArrayList<String>(friends);
+            this.friends = (friends == null ? null : new ArrayList<String>(friends));
             @SuppressWarnings("unchecked")
             CONCRETE result = (CONCRETE) this;
             return result;
@@ -934,7 +985,6 @@ protected Bundle setBundleExtras(Bundle extras) {
             putExtra(extras, NativeProtocol.EXTRA_LINK, link);
             putExtra(extras, NativeProtocol.EXTRA_IMAGE, picture);
             putExtra(extras, NativeProtocol.EXTRA_PLACE_TAG, place);
-            putExtra(extras, NativeProtocol.EXTRA_TITLE, name);
             putExtra(extras, NativeProtocol.EXTRA_REF, ref);
 
             extras.putBoolean(NativeProtocol.EXTRA_DATA_FAILURES_FATAL, dataErrorsFatal);
@@ -954,7 +1004,6 @@ protected Bundle getMethodArguments() {
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_LINK, link);
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_IMAGE, picture);
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_PLACE_TAG, place);
-            putExtra(methodArguments, NativeProtocol.METHOD_ARGS_TITLE, name);
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_REF, ref);
 
             methodArguments.putBoolean(NativeProtocol.METHOD_ARGS_DATA_FAILURES_FATAL, dataErrorsFatal);
@@ -1025,7 +1074,7 @@ public CONCRETE setPlace(String place) {
          * @return this instance of the builder
          */
         public CONCRETE setFriends(List<String> friends) {
-            this.friends = new ArrayList<String>(friends);
+            this.friends = (friends == null ? null : new ArrayList<String>(friends));
             @SuppressWarnings("unchecked")
             CONCRETE result = (CONCRETE) this;
             return result;
@@ -1186,6 +1235,136 @@ public PhotoMessageDialogBuilder setFriends(List<String> friends) {
         }
     }
 
+    private static abstract class VideoDialogBuilderBase<CONCRETE extends VideoDialogBuilderBase<?>>
+            extends Builder<CONCRETE> {
+        private String place;
+        private String videoAttachmentUrl;
+
+        /**
+         * Constructor.
+         *
+         * @param activity the Activity which is presenting the native Share dialog; must not be null
+         */
+        public VideoDialogBuilderBase(Activity activity) {
+            super(activity);
+        }
+
+        /**
+         * Sets the place for the item to be shared.
+         *
+         * @param place the Facebook ID of the place
+         * @return this instance of the builder
+         */
+        public CONCRETE setPlace(String place) {
+            this.place = place;
+            @SuppressWarnings("unchecked")
+            CONCRETE result = (CONCRETE) this;
+            return result;
+        }
+
+        /**
+         * Adds a video to display in the native Share dialog, by specifying the location in the file system.
+         * The dialog's callback will be called once the user has shared the video, but the video may be uploaded
+         * in the background by the Facebook app; apps wishing to be notified when the video upload has succeeded
+         * or failed should extend the FacebookBroadcastReceiver class and register it in their AndroidManifest.xml.
+         * @param video a Files representing the video to be uploaded
+         * @return this instance of the builder
+         */
+        public CONCRETE addVideoFile(File video) {
+            this.videoAttachmentUrl = addVideoAttachmentFile(video);
+            @SuppressWarnings("unchecked")
+            CONCRETE result = (CONCRETE) this;
+            return result;
+        }
+
+        /**
+         * Sets the video url to display in the native Share dialog, by specifying the content:// or file:/// uri.
+         * The dialog's callback will be called once the user has shared the video, but the video may be uploaded
+         * in the background by the Facebook app; apps wishing to be notified when the video upload has succeeded
+         * or failed should extend the FacebookBroadcastReceiver class and register it in their AndroidManifest.xml.
+         * @param videoUrl a url of the video in the form of content:// or file:///
+         * @return this instance of the builder
+         */
+        public CONCRETE setVideoUrl(String videoUrl) {
+            this.videoAttachmentUrl = videoUrl;
+            @SuppressWarnings("unchecked")
+            CONCRETE result = (CONCRETE) this;
+            return result;
+        }
+
+        @Override
+        void validate() {
+            super.validate();
+
+            if (videoAttachmentUrl == null || videoAttachmentUrl.isEmpty()) {
+                throw new FacebookException("Must specify at least one video.");
+            }
+        }
+
+        @Override
+        protected Bundle getMethodArguments() {
+            Bundle methodArgs = new Bundle();
+            putExtra(methodArgs, NativeProtocol.METHOD_ARGS_PLACE_TAG, place);
+            methodArgs.putString(NativeProtocol.METHOD_ARGS_VIDEO, videoAttachmentUrl);
+            return methodArgs;
+        }
+    }
+
+    /**
+     * Provides a builder which can construct a FacebookDialog instance suitable for presenting the native
+     * Share dialog for sharing videos. This builder will throw an exception if the Facebook application is not
+     * installed, so it should only be used if {@link FacebookDialog#canPresentShareDialog(android.content.Context,
+     * com.facebook.widget.FacebookDialog.ShareDialogFeature...)} indicates the capability is available.
+     */
+    public static class VideoShareDialogBuilder extends VideoDialogBuilderBase<VideoShareDialogBuilder> {
+        /**
+         * Constructor.
+         *
+         * @param activity the Activity which is presenting the native Share dialog; must not be null
+         */
+        public VideoShareDialogBuilder(Activity activity) {
+            super(activity);
+        }
+
+        @Override
+        protected EnumSet<? extends DialogFeature> getDialogFeatures() {
+            return EnumSet.of(ShareDialogFeature.SHARE_DIALOG, ShareDialogFeature.VIDEO);
+        }
+    }
+
+    /**
+     * Provides a builder which can construct a FacebookDialog instance suitable for presenting the native
+     * Message dialog for sharing videos. This builder will throw an exception if the Messenger application is not
+     * installed, so it should only be used if {@link FacebookDialog#canPresentMessageDialog(android.content.Context,
+     * com.facebook.widget.FacebookDialog.MessageDialogFeature...)} indicates the capability is available.
+     */
+    public static class VideoMessageDialogBuilder extends VideoDialogBuilderBase<VideoMessageDialogBuilder> {
+        /**
+         * Constructor.
+         *
+         * @param activity the Activity which is presenting the native Message dialog; must not be null
+         */
+        public VideoMessageDialogBuilder(Activity activity) {
+            super(activity);
+        }
+
+        @Override
+        protected EnumSet<MessageDialogFeature> getDialogFeatures() {
+            return EnumSet.of(MessageDialogFeature.MESSAGE_DIALOG, MessageDialogFeature.VIDEO);
+        }
+
+        /**
+         * setPlace is not supported for the photo message dialog, setting this method will have no effect.
+         *
+         * @param place will be ignored
+         * @return this instance of the builder
+         */
+        @Override
+        public VideoMessageDialogBuilder setPlace(String place) {
+            return this;
+        }
+    }
+
     /**
      * Provides a builder which can construct a FacebookDialog instance suitable for presenting the native
      * Message dialog. This builder will throw an exception if the Facebook Messenger application is not installed, so it
diff --git a/facebook/src/com/facebook/widget/LikeView.java b/facebook/src/com/facebook/widget/LikeView.java
index 8b1b8280e..b8088b2fc 100644
--- a/facebook/src/com/facebook/widget/LikeView.java
+++ b/facebook/src/com/facebook/widget/LikeView.java
@@ -19,6 +19,7 @@
 import android.app.Activity;
 import android.content.BroadcastReceiver;
 import android.content.Context;
+import android.content.ContextWrapper;
 import android.content.Intent;
 import android.content.IntentFilter;
 import android.content.res.TypedArray;
@@ -327,7 +328,7 @@ public void setForegroundColor(int foregroundColor) {
     }
 
     /**
-     * Sets an OnErrorListener for this instance of LoginButton to call into when
+     * Sets an OnErrorListener for this instance of LikeView to call into when
      * certain exceptions occur.
      *
      * @param onErrorListener The listener object to set
@@ -337,7 +338,7 @@ public void setOnErrorListener(OnErrorListener onErrorListener) {
     }
 
     /**
-     * Returns the current OnErrorListener for this instance of LoginButton.
+     * Returns the current OnErrorListener for this instance of LikeView.
      *
      * @return The OnErrorListener
      */
@@ -464,8 +465,20 @@ private void initializeLikeCountView(Context context) {
 
     private void toggleLike() {
         if (likeActionController != null) {
-            Activity activity = (Activity)getContext();
-            likeActionController.toggleLike(activity, getAnalyticsParameters());
+            Context context = getContext();
+            Activity activity = null;
+            if (context instanceof Activity) {
+                activity = (Activity)context;
+            } else if (context instanceof ContextWrapper) {
+                Context baseContext = ((ContextWrapper) context).getBaseContext();
+                if (baseContext instanceof Activity) {
+                    activity = (Activity)baseContext;
+                }
+            }
+
+            if (activity != null) {
+                likeActionController.toggleLike(activity, getAnalyticsParameters());
+            }
         }
     }
 
diff --git a/facebook/src/com/facebook/widget/LoginButton.java b/facebook/src/com/facebook/widget/LoginButton.java
index 6f548f4dc..9fcb25c92 100644
--- a/facebook/src/com/facebook/widget/LoginButton.java
+++ b/facebook/src/com/facebook/widget/LoginButton.java
@@ -19,6 +19,7 @@
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.Context;
+import android.content.ContextWrapper;
 import android.content.DialogInterface;
 import android.content.Intent;
 import android.content.res.TypedArray;
@@ -381,7 +382,7 @@ public void setReadPermissions(String... permissions) {
      * manage the setting of permissions outside of the LoginButton class altogether
      * (by managing the session explicitly).
      *
-     * @param permissions the read permissions to use
+     * @param permissions the publish permissions to use
      *
      * @throws UnsupportedOperationException if setReadPermissions has been called
      * @throws IllegalArgumentException if permissions is null or empty
@@ -407,7 +408,7 @@ public void setPublishPermissions(List<String> permissions) {
      * manage the setting of permissions outside of the LoginButton class altogether
      * (by managing the session explicitly).
      *
-     * @param permissions the read permissions to use
+     * @param permissions the publish permissions to use
      *
      * @throws UnsupportedOperationException if setReadPermissions has been called
      * @throws IllegalArgumentException if permissions is null or empty
@@ -843,6 +844,11 @@ public void onClick(DialogInterface dialog, int which) {
                         openRequest = new Session.OpenRequest(parentFragment);
                     } else if (context instanceof Activity) {
                         openRequest = new Session.OpenRequest((Activity)context);
+                    } else if (context instanceof ContextWrapper) {
+                        Context baseContext = ((ContextWrapper)context).getBaseContext();
+                        if (baseContext instanceof Activity) {
+                            openRequest = new Session.OpenRequest((Activity)baseContext);
+                        }
                     }
 
                     if (openRequest != null) {
diff --git a/facebook/src/com/facebook/widget/PickerFragment.java b/facebook/src/com/facebook/widget/PickerFragment.java
index 4ef6cbd23..536c0c783 100644
--- a/facebook/src/com/facebook/widget/PickerFragment.java
+++ b/facebook/src/com/facebook/widget/PickerFragment.java
@@ -97,6 +97,7 @@
     private final Class<T> graphObjectClass;
     private LoadingStrategy loadingStrategy;
     private SelectionStrategy selectionStrategy;
+    private Set<String> selectionHint;
     private ProgressBar activityCircle;
     private SessionTracker sessionTracker;
     private String titleText;
@@ -487,9 +488,21 @@ public String getDoneButtonText() {
      *                    if false, data will not be re-loaded if it is already displayed (or loading)
      */
     public void loadData(boolean forceReload) {
+        loadData(forceReload, null);
+    }
+
+    /**
+     * Causes the picker to load data from the service and display it to the user.
+     *
+     * @param forceReload if true, data will be loaded even if there is already data being displayed (or loading);
+     *                    if false, data will not be re-loaded if it is already displayed (or loading)
+     * @param selectIds ids to select, if they are present in the loaded data
+     */
+    public void loadData(boolean forceReload, Set<String> selectIds) {
         if (!forceReload && loadingStrategy.isDataPresentOrLoading()) {
             return;
         }
+        selectionHint = selectIds;
         loadDataSkippingRoundTripIfCached();
     }
 
@@ -751,6 +764,32 @@ void updateAdapter(SimpleGraphObjectCursor<T> data) {
             if (dataChanged && onDataChangedListener != null) {
                 onDataChangedListener.onDataChanged(PickerFragment.this);
             }
+            if (selectionHint != null && !selectionHint.isEmpty() && data != null) {
+                data.moveToFirst();
+                boolean changed = false;
+                for (int i = 0; i < data.getCount(); i++) {
+                    data.moveToPosition(i);
+                    T graphObject = data.getGraphObject();
+                    if (!graphObject.asMap().containsKey("id"))
+                        continue;
+                    Object obj = graphObject.getProperty("id");
+                    if (!(obj instanceof String)) {
+                        continue;
+                    }
+                    String id = (String) obj;
+                    if (selectionHint.contains(id)) {
+                        selectionStrategy.toggleSelection(id);
+                        selectionHint.remove(id);
+                        changed = true;
+                    }
+                    if (selectionHint.isEmpty()) {
+                        break;
+                    }
+                }
+                if (onSelectionChangedListener != null && changed) {
+                    onSelectionChangedListener.onSelectionChanged(PickerFragment.this);
+                }
+            }
         }
     }
 
diff --git a/facebook/src/com/facebook/widget/WebDialog.java b/facebook/src/com/facebook/widget/WebDialog.java
index bdfb3811c..cf54a850a 100644
--- a/facebook/src/com/facebook/widget/WebDialog.java
+++ b/facebook/src/com/facebook/widget/WebDialog.java
@@ -785,7 +785,7 @@ public FeedDialogBuilder setSource(String source) {
         }
 
         /**
-         * Sets the name of the item being shared.
+         * Sets the name of the URL being shared. This method only has effect if setLink is called.
          *
          * @param name the name
          * @return the builder
@@ -796,7 +796,7 @@ public FeedDialogBuilder setName(String name) {
         }
 
         /**
-         * Sets the caption to be displayed.
+         * Sets the caption of the URL being shared. This method only has effect if setLink is called.
          *
          * @param caption the caption
          * @return the builder
@@ -807,7 +807,7 @@ public FeedDialogBuilder setCaption(String caption) {
         }
 
         /**
-         * Sets the description to be displayed.
+         * Sets the description of the URL being shared. This method only has effect if setLink is called.
          *
          * @param description the description
          * @return the builder
diff --git a/facebook/tests/build.gradle b/facebook/tests/build.gradle
index 97494f6b4..df41829e9 100644
--- a/facebook/tests/build.gradle
+++ b/facebook/tests/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/facebook/tests/src/com/facebook/RequestTests.java b/facebook/tests/src/com/facebook/RequestTests.java
index 458689f19..cca70cb6b 100644
--- a/facebook/tests/src/com/facebook/RequestTests.java
+++ b/facebook/tests/src/com/facebook/RequestTests.java
@@ -390,6 +390,43 @@ public void testExecuteSingleGet() {
         assertEquals("Paris", graphPlace.getLocation().getCity());
     }
 
+    @LargeTest
+    public void testBuildsUploadPhotoHttpURLConnection() throws Exception {
+        TestSession session = openTestSessionWithSharedUser();
+        Bitmap image = createTestBitmap(128);
+
+        Request request = Request.newUploadPhotoRequest(session, image, null);
+        HttpURLConnection connection = Request.toHttpConnection(request);
+
+        assertTrue(connection != null);
+        assertNotSame("gzip", connection.getRequestProperty("Content-Encoding"));
+        assertNotSame("application/x-www-form-urlencoded", connection.getRequestProperty("Content-Type"));
+    }
+
+    @LargeTest
+    public void testBuildsUploadVideoHttpURLConnection() throws IOException, URISyntaxException {
+        File tempFile = null;
+        try {
+            TestSession session = openTestSessionWithSharedUser();
+            tempFile = createTempFileFromAsset("DarkScreen.mov");
+
+            Request request = Request.newUploadVideoRequest(session, tempFile, null);
+            HttpURLConnection connection = Request.toHttpConnection(request);
+
+            assertTrue(connection != null);
+            assertNotSame("gzip", connection.getRequestProperty("Content-Encoding"));
+            assertNotSame("application/x-www-form-urlencoded", connection.getRequestProperty("Content-Type"));
+
+        } catch (Exception ex) {
+            return;
+        } finally {
+            if (tempFile != null) {
+                tempFile.delete();
+            }
+        }
+    }
+
+
     @MediumTest
     @LargeTest
     public void testExecuteSingleGetUsingHttpURLConnection() throws IOException {
@@ -397,6 +434,9 @@ public void testExecuteSingleGetUsingHttpURLConnection() throws IOException {
         Request request = new Request(session, "TourEiffel");
         HttpURLConnection connection = Request.toHttpConnection(request);
 
+        assertEquals("gzip", connection.getRequestProperty("Content-Encoding"));
+        assertEquals("application/x-www-form-urlencoded", connection.getRequestProperty("Content-Type"));
+
         List<Response> responses = Request.executeConnectionAndWait(connection, Arrays.asList(new Request[]{request}));
         assertNotNull(responses);
         assertEquals(1, responses.size());
@@ -853,7 +893,7 @@ public void testPaging() {
         TestSession session = openTestSessionWithSharedUser();
         final List<GraphPlace> returnedPlaces = new ArrayList<GraphPlace>();
         Request request = Request
-                .newPlacesSearchRequest(session, SEATTLE_LOCATION, 1000, 5, null, new Request.GraphPlaceListCallback() {
+                .newPlacesSearchRequest(session, SEATTLE_LOCATION, 1000, 3, null, new Request.GraphPlaceListCallback() {
                     @Override
                     public void onCompleted(List<GraphPlace> places, Response response) {
                         returnedPlaces.addAll(places);
diff --git a/facebook/tests/src/com/facebook/internal/NativeProtocolVersionTests.java b/facebook/tests/src/com/facebook/internal/NativeProtocolVersionTests.java
new file mode 100644
index 000000000..e08245ab3
--- /dev/null
+++ b/facebook/tests/src/com/facebook/internal/NativeProtocolVersionTests.java
@@ -0,0 +1,157 @@
+/**
+ * Copyright 2010-present Facebook.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.facebook.internal;
+
+import android.test.AndroidTestCase;
+import android.test.suitebuilder.annotation.SmallTest;
+
+import java.util.TreeSet;
+
+public class NativeProtocolVersionTests extends AndroidTestCase {
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecOpen() {
+        // Base case where a feature was enabled a while ago and the SDK and Native app have been updated
+        // since then.
+        int[] versionSpec = new int[] {3};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecOpen() {
+        // Base case where a feature was enabled a while ago and the SDK and Native app have been updated
+        // since then.
+        int[] versionSpec = new int[] {3};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecDisabled() {
+        // Case where a feature was enabled AND disabled a while ago and the SDK and Native app have been
+        // updated since then.
+        int[] versionSpec = new int[] {1,3,7,8};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecDisabled() {
+        // Case where a feature was enabled AND disabled a while ago and the SDK and Native app have been
+        // updated since then.
+        int[] versionSpec = new int[] {1,3,6,7};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecNewerAndEnabled() {
+        // Case where the sdk and app are older, but the app is still enabled
+        int[] versionSpec = new int[] {1,3,7,9,10,11,12,13};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecNewerAndEnabled() {
+        // Case where the sdk and app are older, but the app is still enabled
+        int[] versionSpec = new int[] {1,3,7,9,10,11,12,13};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecNewerAndDisabled() {
+        // Case where the sdk and app are older, and the app is a disabled version
+        int[] versionSpec = new int[] {1,3,7,8,10,11,12,13};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecNewerAndDisabled() {
+        // Case where the sdk and app are older, and the app is a disabled version
+        int[] versionSpec = new int[] {1,3,6,7,10,11,12,13};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    private TreeSet<Integer> getTreeSetFromIntArray(int[] array) {
+        TreeSet<Integer> treeSet = new TreeSet<Integer>();
+        for (int a : array) {
+            treeSet.add(a);
+        }
+
+        return treeSet;
+    }
+}
diff --git a/gradle.properties b/gradle.properties
index cfaccf33a..6acd9c358 100644
--- a/gradle.properties
+++ b/gradle.properties
@@ -1,4 +1,4 @@
 ANDROID_BUILD_MIN_SDK_VERSION=9
-ANDROID_BUILD_TARGET_SDK_VERSION=20
-ANDROID_BUILD_TOOLS_VERSION=20.0.0
-ANDROID_BUILD_SDK_VERSION=20
+ANDROID_BUILD_TARGET_SDK_VERSION=21
+ANDROID_BUILD_TOOLS_VERSION=21.1.2
+ANDROID_BUILD_SDK_VERSION=21
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index 23bdf0c69..53bda0123 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,6 +1,6 @@
-#Tue Jun 17 21:31:41 PDT 2014
+#Fri Dec 12 09:32:22 PST 2014
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
-distributionUrl=http\://services.gradle.org/distributions/gradle-1.12-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-2.2.1-all.zip
diff --git a/samples/FriendPickerSample/build.gradle b/samples/FriendPickerSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/FriendPickerSample/build.gradle
+++ b/samples/FriendPickerSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/FriendPickerSample/res/drawable-hdpi/icon.png b/samples/FriendPickerSample/res/drawable-hdpi/icon.png
index 6a930c6c6..7d5a0608c 100644
Binary files a/samples/FriendPickerSample/res/drawable-hdpi/icon.png and b/samples/FriendPickerSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/FriendPickerSample/res/drawable-mdpi/icon.png b/samples/FriendPickerSample/res/drawable-mdpi/icon.png
index 33b418b7a..bdfec2583 100644
Binary files a/samples/FriendPickerSample/res/drawable-mdpi/icon.png and b/samples/FriendPickerSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/FriendPickerSample/res/drawable-xhdpi/icon.png b/samples/FriendPickerSample/res/drawable-xhdpi/icon.png
index 494e37a8d..b9c184918 100644
Binary files a/samples/FriendPickerSample/res/drawable-xhdpi/icon.png and b/samples/FriendPickerSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/FriendPickerSample/res/drawable/icon.png b/samples/FriendPickerSample/res/drawable/icon.png
index 33b418b7a..bdfec2583 100644
Binary files a/samples/FriendPickerSample/res/drawable/icon.png and b/samples/FriendPickerSample/res/drawable/icon.png differ
diff --git a/samples/HelloFacebookSample/build.gradle b/samples/HelloFacebookSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/HelloFacebookSample/build.gradle
+++ b/samples/HelloFacebookSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/HelloFacebookSample/res/drawable-hdpi/icon.png b/samples/HelloFacebookSample/res/drawable-hdpi/icon.png
index e603120e1..0a0d7cc73 100644
Binary files a/samples/HelloFacebookSample/res/drawable-hdpi/icon.png and b/samples/HelloFacebookSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/HelloFacebookSample/res/drawable-mdpi/icon.png b/samples/HelloFacebookSample/res/drawable-mdpi/icon.png
index f2fc84fb6..b4507c0e7 100644
Binary files a/samples/HelloFacebookSample/res/drawable-mdpi/icon.png and b/samples/HelloFacebookSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png b/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png
index 143a69f21..6e8424602 100644
Binary files a/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png and b/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/HelloFacebookSample/res/drawable/icon.png b/samples/HelloFacebookSample/res/drawable/icon.png
index f2fc84fb6..b4507c0e7 100644
Binary files a/samples/HelloFacebookSample/res/drawable/icon.png and b/samples/HelloFacebookSample/res/drawable/icon.png differ
diff --git a/samples/PlacePickerSample/build.gradle b/samples/PlacePickerSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/PlacePickerSample/build.gradle
+++ b/samples/PlacePickerSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/PlacePickerSample/res/drawable-hdpi/icon.png b/samples/PlacePickerSample/res/drawable-hdpi/icon.png
index 4059334b5..72320cacd 100644
Binary files a/samples/PlacePickerSample/res/drawable-hdpi/icon.png and b/samples/PlacePickerSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/PlacePickerSample/res/drawable-mdpi/icon.png b/samples/PlacePickerSample/res/drawable-mdpi/icon.png
index 1fa3834d0..9012b57a2 100644
Binary files a/samples/PlacePickerSample/res/drawable-mdpi/icon.png and b/samples/PlacePickerSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/PlacePickerSample/res/drawable-xhdpi/icon.png b/samples/PlacePickerSample/res/drawable-xhdpi/icon.png
index 2b3083d44..40cd9480c 100644
Binary files a/samples/PlacePickerSample/res/drawable-xhdpi/icon.png and b/samples/PlacePickerSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/PlacePickerSample/res/drawable/icon.png b/samples/PlacePickerSample/res/drawable/icon.png
index 1fa3834d0..9012b57a2 100644
Binary files a/samples/PlacePickerSample/res/drawable/icon.png and b/samples/PlacePickerSample/res/drawable/icon.png differ
diff --git a/samples/RPSSample/AndroidManifest.xml b/samples/RPSSample/AndroidManifest.xml
index 06c1fc4c0..5e81e5104 100644
--- a/samples/RPSSample/AndroidManifest.xml
+++ b/samples/RPSSample/AndroidManifest.xml
@@ -32,6 +32,7 @@
                   android:label="@string/app_name" />
         <meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/app_id"/>
         <provider android:authorities="com.facebook.app.NativeAppCallContentProvider157578437735213"
-                  android:name="com.facebook.NativeAppCallContentProvider" />
+                  android:name="com.facebook.NativeAppCallContentProvider"
+                  android:exported="true" />
     </application>
 </manifest>
diff --git a/samples/RPSSample/build.gradle b/samples/RPSSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/RPSSample/build.gradle
+++ b/samples/RPSSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/RPSSample/res/drawable-hdpi/icon.png b/samples/RPSSample/res/drawable-hdpi/icon.png
index 5bc5b2cea..9e70a87f3 100644
Binary files a/samples/RPSSample/res/drawable-hdpi/icon.png and b/samples/RPSSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/RPSSample/res/drawable-mdpi/icon.png b/samples/RPSSample/res/drawable-mdpi/icon.png
index f621e908c..f8ac7a2db 100644
Binary files a/samples/RPSSample/res/drawable-mdpi/icon.png and b/samples/RPSSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/RPSSample/res/drawable-xhdpi/icon.png b/samples/RPSSample/res/drawable-xhdpi/icon.png
index 1adb6bfa3..ea8da121a 100644
Binary files a/samples/RPSSample/res/drawable-xhdpi/icon.png and b/samples/RPSSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/RPSSample/res/drawable/fb_logo.png b/samples/RPSSample/res/drawable/fb_logo.png
index b4b29948c..42c619123 100755
Binary files a/samples/RPSSample/res/drawable/fb_logo.png and b/samples/RPSSample/res/drawable/fb_logo.png differ
diff --git a/samples/RPSSample/res/drawable/icon.png b/samples/RPSSample/res/drawable/icon.png
index f621e908c..f8ac7a2db 100644
Binary files a/samples/RPSSample/res/drawable/icon.png and b/samples/RPSSample/res/drawable/icon.png differ
diff --git a/samples/RPSSample/res/drawable/left_paper.png b/samples/RPSSample/res/drawable/left_paper.png
index 7336fd246..813e925da 100755
Binary files a/samples/RPSSample/res/drawable/left_paper.png and b/samples/RPSSample/res/drawable/left_paper.png differ
diff --git a/samples/RPSSample/res/drawable/left_rock.png b/samples/RPSSample/res/drawable/left_rock.png
index bee7abe89..4226ab074 100755
Binary files a/samples/RPSSample/res/drawable/left_rock.png and b/samples/RPSSample/res/drawable/left_rock.png differ
diff --git a/samples/RPSSample/res/drawable/left_scissors.png b/samples/RPSSample/res/drawable/left_scissors.png
index dac525200..0ed1b1c16 100755
Binary files a/samples/RPSSample/res/drawable/left_scissors.png and b/samples/RPSSample/res/drawable/left_scissors.png differ
diff --git a/samples/RPSSample/res/drawable/right_paper.png b/samples/RPSSample/res/drawable/right_paper.png
index d243567a9..54431fe6a 100755
Binary files a/samples/RPSSample/res/drawable/right_paper.png and b/samples/RPSSample/res/drawable/right_paper.png differ
diff --git a/samples/RPSSample/res/drawable/right_rock.png b/samples/RPSSample/res/drawable/right_rock.png
index 9168b4b74..51203c4bc 100755
Binary files a/samples/RPSSample/res/drawable/right_rock.png and b/samples/RPSSample/res/drawable/right_rock.png differ
diff --git a/samples/RPSSample/res/drawable/right_scissors.png b/samples/RPSSample/res/drawable/right_scissors.png
index 083c47590..7c55471e6 100755
Binary files a/samples/RPSSample/res/drawable/right_scissors.png and b/samples/RPSSample/res/drawable/right_scissors.png differ
diff --git a/samples/Scrumptious/AndroidManifest.xml b/samples/Scrumptious/AndroidManifest.xml
index f5fadc8c7..715d5bc7b 100644
--- a/samples/Scrumptious/AndroidManifest.xml
+++ b/samples/Scrumptious/AndroidManifest.xml
@@ -29,6 +29,7 @@
                   android:label="@string/app_name" />
         <meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/app_id"/>
         <provider android:authorities="com.facebook.app.NativeAppCallContentProvider233936543368280"
-                  android:name="com.facebook.NativeAppCallContentProvider" />
+                  android:name="com.facebook.NativeAppCallContentProvider"
+                  android:exported="true" />
     </application>
 </manifest> 
diff --git a/samples/Scrumptious/build.gradle b/samples/Scrumptious/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/Scrumptious/build.gradle
+++ b/samples/Scrumptious/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/Scrumptious/res/drawable-hdpi/icon.png b/samples/Scrumptious/res/drawable-hdpi/icon.png
index 0320aeb54..383503ce9 100644
Binary files a/samples/Scrumptious/res/drawable-hdpi/icon.png and b/samples/Scrumptious/res/drawable-hdpi/icon.png differ
diff --git a/samples/Scrumptious/res/drawable-mdpi/icon.png b/samples/Scrumptious/res/drawable-mdpi/icon.png
index 5c4b0095f..b14f00b4d 100644
Binary files a/samples/Scrumptious/res/drawable-mdpi/icon.png and b/samples/Scrumptious/res/drawable-mdpi/icon.png differ
diff --git a/samples/Scrumptious/res/drawable-mdpi/logo.png b/samples/Scrumptious/res/drawable-mdpi/logo.png
index 27fd9ffc1..a6f07865e 100644
Binary files a/samples/Scrumptious/res/drawable-mdpi/logo.png and b/samples/Scrumptious/res/drawable-mdpi/logo.png differ
diff --git a/samples/Scrumptious/res/drawable-xhdpi/icon.png b/samples/Scrumptious/res/drawable-xhdpi/icon.png
index 796e14ec2..c86c5f0f3 100644
Binary files a/samples/Scrumptious/res/drawable-xhdpi/icon.png and b/samples/Scrumptious/res/drawable-xhdpi/icon.png differ
diff --git a/samples/Scrumptious/res/drawable-xhdpi/logo.png b/samples/Scrumptious/res/drawable-xhdpi/logo.png
index 0fff04bb9..aea4d819e 100644
Binary files a/samples/Scrumptious/res/drawable-xhdpi/logo.png and b/samples/Scrumptious/res/drawable-xhdpi/logo.png differ
diff --git a/samples/Scrumptious/res/drawable/add_food.png b/samples/Scrumptious/res/drawable/add_food.png
index b556dd6e3..aeb1ae315 100644
Binary files a/samples/Scrumptious/res/drawable/add_food.png and b/samples/Scrumptious/res/drawable/add_food.png differ
diff --git a/samples/Scrumptious/res/drawable/add_friends.png b/samples/Scrumptious/res/drawable/add_friends.png
index 1cafe3625..b728ebfd9 100644
Binary files a/samples/Scrumptious/res/drawable/add_friends.png and b/samples/Scrumptious/res/drawable/add_friends.png differ
diff --git a/samples/Scrumptious/res/drawable/add_location.png b/samples/Scrumptious/res/drawable/add_location.png
index 2df780552..45a30b3e5 100644
Binary files a/samples/Scrumptious/res/drawable/add_location.png and b/samples/Scrumptious/res/drawable/add_location.png differ
diff --git a/samples/Scrumptious/res/drawable/add_photo.png b/samples/Scrumptious/res/drawable/add_photo.png
index 48f5740a6..f48ea0680 100644
Binary files a/samples/Scrumptious/res/drawable/add_photo.png and b/samples/Scrumptious/res/drawable/add_photo.png differ
diff --git a/samples/Scrumptious/res/drawable/facebook.png b/samples/Scrumptious/res/drawable/facebook.png
index daf8097b1..88c2ed6a8 100755
Binary files a/samples/Scrumptious/res/drawable/facebook.png and b/samples/Scrumptious/res/drawable/facebook.png differ
diff --git a/samples/Scrumptious/res/drawable/icon.png b/samples/Scrumptious/res/drawable/icon.png
index 5c4b0095f..739392fc0 100644
Binary files a/samples/Scrumptious/res/drawable/icon.png and b/samples/Scrumptious/res/drawable/icon.png differ
diff --git a/samples/Scrumptious/res/drawable/title_bar_logo.png b/samples/Scrumptious/res/drawable/title_bar_logo.png
index 27fd9ffc1..3fe6e8b97 100644
Binary files a/samples/Scrumptious/res/drawable/title_bar_logo.png and b/samples/Scrumptious/res/drawable/title_bar_logo.png differ
diff --git a/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java b/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java
index e496de8cc..964760c75 100644
--- a/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java
+++ b/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java
@@ -22,8 +22,6 @@
 import android.support.v4.app.FragmentActivity;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.app.FragmentTransaction;
-import android.view.Menu;
-import android.view.MenuItem;
 import com.facebook.AppEventsLogger;
 import com.facebook.Session;
 import com.facebook.SessionState;
@@ -39,7 +37,6 @@
     private static final int FRAGMENT_COUNT = SETTINGS +1;
 
     private Fragment[] fragments = new Fragment[FRAGMENT_COUNT];
-    private MenuItem settings;
     private boolean isResumed = false;
     private boolean userSkippedLogin = false;
     private UiLifecycleHelper uiHelper;
@@ -142,30 +139,6 @@ protected void onResumeFragments() {
         }
     }
 
-    @Override
-    public boolean onPrepareOptionsMenu(Menu menu) {
-        // only add the menu when the selection fragment is showing
-        if (fragments[SELECTION].isVisible()) {
-            if (menu.size() == 0) {
-                settings = menu.add(R.string.settings);
-            }
-            return true;
-        } else {
-            menu.clear();
-            settings = null;
-        }
-        return false;
-    }
-
-    @Override
-    public boolean onOptionsItemSelected(MenuItem item) {
-        if (item.equals(settings)) {
-            showSettingsFragment();
-            return true;
-        }
-        return false;
-    }
-
     public void showSettingsFragment() {
         showFragment(SETTINGS, true);
     }
diff --git a/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java b/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java
index f6f572ce8..3cc1ad7a9 100644
--- a/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java
+++ b/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java
@@ -158,6 +158,12 @@ public void onClick(View view) {
                 handleAnnounce(true);
             }
         });
+        profilePictureView.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                activity.showSettingsFragment();
+            }
+        });
 
         init(savedInstanceState);
 
diff --git a/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java b/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java
index 2eaaede2a..ba1b6442b 100644
--- a/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java
+++ b/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java
@@ -22,9 +22,11 @@
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.TextView;
+import com.facebook.widget.LoginButton;
 
 public class SplashFragment extends Fragment {
 
+    private LoginButton loginButton;
     private TextView skipLoginButton;
     private SkipLoginCallback skipLoginCallback;
 
@@ -37,6 +39,9 @@
     public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
         View view = inflater.inflate(R.layout.splash, container, false);
 
+        loginButton = (LoginButton) view.findViewById(R.id.login_button);
+        loginButton.setReadPermissions("user_friends");
+
         skipLoginButton = (TextView) view.findViewById(R.id.skip_login_button);
         skipLoginButton.setOnClickListener(new View.OnClickListener() {
             @Override
diff --git a/samples/SwitchUserSample/build.gradle b/samples/SwitchUserSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/SwitchUserSample/build.gradle
+++ b/samples/SwitchUserSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/SwitchUserSample/res/drawable-hdpi/icon.png b/samples/SwitchUserSample/res/drawable-hdpi/icon.png
index cda826b7f..8e4f7040c 100644
Binary files a/samples/SwitchUserSample/res/drawable-hdpi/icon.png and b/samples/SwitchUserSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/SwitchUserSample/res/drawable-mdpi/icon.png b/samples/SwitchUserSample/res/drawable-mdpi/icon.png
index ffd35f432..e193802b2 100644
Binary files a/samples/SwitchUserSample/res/drawable-mdpi/icon.png and b/samples/SwitchUserSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/SwitchUserSample/res/drawable-xhdpi/icon.png b/samples/SwitchUserSample/res/drawable-xhdpi/icon.png
index be63ade0b..e49838d03 100644
Binary files a/samples/SwitchUserSample/res/drawable-xhdpi/icon.png and b/samples/SwitchUserSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/SwitchUserSample/res/drawable/icon.png b/samples/SwitchUserSample/res/drawable/icon.png
index ffd35f432..e193802b2 100644
Binary files a/samples/SwitchUserSample/res/drawable/icon.png and b/samples/SwitchUserSample/res/drawable/icon.png differ
diff --git a/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java b/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java
index 0dab22ade..125a649c2 100644
--- a/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java
+++ b/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java
@@ -269,7 +269,7 @@ Slot getSlot(int slot) {
 
         private void setSelectedSlotNumber(int slot) {
             // Store the selected slot number for when the app is closed and restarted
-            settings.edit().putInt(SETTINGS_CURRENT_SLOT_KEY, slot).commit();
+            settings.edit().putInt(SETTINGS_CURRENT_SLOT_KEY, slot).apply();
             selectedSlotNumber = slot;
         }
 
