diff --git a/facebook/src/com/facebook/AccessToken.java b/facebook/src/com/facebook/AccessToken.java
index 28cbeb481..2e10bd0d5 100644
--- a/facebook/src/com/facebook/AccessToken.java
+++ b/facebook/src/com/facebook/AccessToken.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/AccessTokenSource.java b/facebook/src/com/facebook/AccessTokenSource.java
index 8d231f1b1..263111285 100644
--- a/facebook/src/com/facebook/AccessTokenSource.java
+++ b/facebook/src/com/facebook/AccessTokenSource.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -49,7 +49,11 @@
      * Indicates an access token is for a test user rather than an actual
      * Facebook user.
      */
-    TEST_USER(true);
+    TEST_USER(true),
+    /**
+     * Indicates an access token constructed with a Client Token.
+     */
+    CLIENT_TOKEN(true);
 
     private final boolean canExtendToken;
 
diff --git a/facebook/src/com/facebook/AuthorizationClient.java b/facebook/src/com/facebook/AuthorizationClient.java
index f1f4348f9..13c8e5c9a 100644
--- a/facebook/src/com/facebook/AuthorizationClient.java
+++ b/facebook/src/com/facebook/AuthorizationClient.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -21,6 +21,7 @@
 import android.content.ActivityNotFoundException;
 import android.content.Context;
 import android.content.Intent;
+import android.content.SharedPreferences;
 import android.content.pm.PackageManager;
 import android.os.Bundle;
 import android.text.TextUtils;
@@ -40,6 +41,10 @@
 
 class AuthorizationClient implements Serializable {
     private static final long serialVersionUID = 1L;
+    private static final String TAG = "Facebook-AuthorizationClient";
+    private static final String WEB_VIEW_AUTH_HANDLER_STORE =
+            "com.facebook.AuthorizationClient.WebViewAuthHandler.TOKEN_STORE_KEY";
+    private static final String WEB_VIEW_AUTH_HANDLER_TOKEN_KEY = "TOKEN";
 
     List<AuthHandler> handlersToTry;
     AuthHandler currentHandler;
@@ -444,8 +449,13 @@ boolean tryAuthorize(final AuthorizationRequest request) {
                 parameters.putString(ServerProtocol.DIALOG_PARAM_SCOPE, TextUtils.join(",", request.getPermissions()));
             }
 
-            // The call to clear cookies will create the first instance of CookieSyncManager if necessary
-            Utility.clearFacebookCookies(context);
+            String previousToken = request.getPreviousAccessToken();
+            if (!Utility.isNullOrEmpty(previousToken) && (previousToken.equals(loadCookieToken()))) {
+                parameters.putString(ServerProtocol.DIALOG_PARAM_ACCESS_TOKEN, previousToken);
+            } else {
+                // The call to clear cookies will create the first instance of CookieSyncManager if necessary
+                Utility.clearFacebookCookies(context);
+            }
 
             WebDialog.OnCompleteListener listener = new WebDialog.OnCompleteListener() {
                 @Override
@@ -467,16 +477,16 @@ void onWebDialogComplete(AuthorizationRequest request, Bundle values,
                 FacebookException error) {
             Result outcome;
             if (values != null) {
+                AccessToken token = AccessToken
+                        .createFromWebBundle(request.getPermissions(), values, AccessTokenSource.WEB_VIEW);
+                outcome = Result.createTokenResult(token);
+
                 // Ensure any cookies set by the dialog are saved
                 // This is to work around a bug where CookieManager may fail to instantiate if CookieSyncManager
                 // has never been created.
                 CookieSyncManager syncManager = CookieSyncManager.createInstance(context);
                 syncManager.sync();
-
-                AccessToken token = AccessToken
-                        .createFromWebBundle(request.getPermissions(), values, AccessTokenSource.WEB_VIEW);
-                outcome = Result.createTokenResult(token);
-
+                saveCookieToken(token.getToken());
             } else {
                 if (error instanceof FacebookOperationCanceledException) {
                     outcome = Result.createCancelResult("User canceled log in.");
@@ -486,6 +496,26 @@ void onWebDialogComplete(AuthorizationRequest request, Bundle values,
             }
             completeAndValidate(outcome);
         }
+
+        private void saveCookieToken(String token) {
+            Context context = getStartActivityDelegate().getActivityContext();
+            SharedPreferences sharedPreferences = context.getSharedPreferences(
+                    WEB_VIEW_AUTH_HANDLER_STORE,
+                    Context.MODE_PRIVATE);
+            SharedPreferences.Editor editor = sharedPreferences.edit();
+            editor.putString(WEB_VIEW_AUTH_HANDLER_TOKEN_KEY, token);
+            if (!editor.commit()) {
+                Utility.logd(TAG, "Could not update saved web view auth handler token.");
+            }
+        }
+
+        private String loadCookieToken() {
+            Context context = getStartActivityDelegate().getActivityContext();
+            SharedPreferences sharedPreferences = context.getSharedPreferences(
+                    WEB_VIEW_AUTH_HANDLER_STORE,
+                    Context.MODE_PRIVATE);
+            return sharedPreferences.getString(WEB_VIEW_AUTH_HANDLER_TOKEN_KEY, "");
+        }
     }
 
     class GetTokenAuthHandler extends AuthHandler {
@@ -584,28 +614,28 @@ boolean tryAuthorize(AuthorizationRequest request) {
 
         @Override
         boolean onActivityResult(int requestCode, int resultCode, Intent data) {
-            if (NativeProtocol.isServiceDisabledResult20121101(data)) {
-                tryNextHandler();
+            Result outcome;
+
+            if (data == null) {
+                // This happens if the user presses 'Back'.
+                outcome = Result.createCancelResult("Operation canceled");
+            } else if (NativeProtocol.isServiceDisabledResult20121101(data)) {
+                outcome = null;
+            } else if (resultCode == Activity.RESULT_CANCELED) {
+                outcome = Result.createCancelResult(
+                        data.getStringExtra(NativeProtocol.STATUS_ERROR_DESCRIPTION));
+            } else if (resultCode != Activity.RESULT_OK) {
+                outcome = Result.createErrorResult("Unexpected resultCode from authorization.", null);
             } else {
-                // Handle stuff
-                Result outcome = null;
-
-                if (resultCode == Activity.RESULT_CANCELED) {
-                    outcome = Result.createCancelResult(
-                            data.getStringExtra(NativeProtocol.STATUS_ERROR_DESCRIPTION));
-                } else if (resultCode != Activity.RESULT_OK) {
-                    outcome = Result
-                            .createErrorResult("Unexpected resultCode from authorization.", null);
-                } else {
-                    outcome = handleResultOk(data);
-                }
+                outcome = handleResultOk(data);
+            }
 
-                if (outcome != null) {
-                    completeAndValidate(outcome);
-                } else {
-                    tryNextHandler();
-                }
+            if (outcome != null) {
+                completeAndValidate(outcome);
+            } else {
+                tryNextHandler();
             }
+
             return true;
         }
 
@@ -639,9 +669,12 @@ boolean tryAuthorize(AuthorizationRequest request) {
         @Override
         boolean onActivityResult(int requestCode, int resultCode, Intent data) {
             // Handle stuff
-            Result outcome = null;
+            Result outcome;
 
-            if (resultCode == Activity.RESULT_CANCELED) {
+            if (data == null) {
+                // This happens if the user presses 'Back'.
+                outcome = Result.createCancelResult("Operation canceled");
+            } else if (resultCode == Activity.RESULT_CANCELED) {
                 outcome = Result.createCancelResult(data.getStringExtra("error"));
             } else if (resultCode != Activity.RESULT_OK) {
                 outcome = Result.createErrorResult("Unexpected resultCode from authorization.", null);
diff --git a/facebook/src/com/facebook/FacebookAuthorizationException.java b/facebook/src/com/facebook/FacebookAuthorizationException.java
index b8273e500..59ef9742a 100644
--- a/facebook/src/com/facebook/FacebookAuthorizationException.java
+++ b/facebook/src/com/facebook/FacebookAuthorizationException.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/FacebookDialogException.java b/facebook/src/com/facebook/FacebookDialogException.java
index 0285837ad..f59b99c8f 100644
--- a/facebook/src/com/facebook/FacebookDialogException.java
+++ b/facebook/src/com/facebook/FacebookDialogException.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/FacebookException.java b/facebook/src/com/facebook/FacebookException.java
index 3525dbe47..4caeda7f7 100644
--- a/facebook/src/com/facebook/FacebookException.java
+++ b/facebook/src/com/facebook/FacebookException.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/FacebookGraphObjectException.java b/facebook/src/com/facebook/FacebookGraphObjectException.java
index a03828a9f..b513706de 100644
--- a/facebook/src/com/facebook/FacebookGraphObjectException.java
+++ b/facebook/src/com/facebook/FacebookGraphObjectException.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/FacebookOperationCanceledException.java b/facebook/src/com/facebook/FacebookOperationCanceledException.java
index ed6d998db..9fcf11dd4 100644
--- a/facebook/src/com/facebook/FacebookOperationCanceledException.java
+++ b/facebook/src/com/facebook/FacebookOperationCanceledException.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/FacebookRequestError.java b/facebook/src/com/facebook/FacebookRequestError.java
index f4946c583..5e9187904 100644
--- a/facebook/src/com/facebook/FacebookRequestError.java
+++ b/facebook/src/com/facebook/FacebookRequestError.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -83,6 +83,7 @@ boolean contains(int value) {
     private static final int EC_APP_NOT_INSTALLED = 458;
     private static final int EC_USER_CHECKPOINTED = 459;
     private static final int EC_PASSWORD_CHANGED = 460;
+    private static final int EC_EXPIRED = 463;
     private static final int EC_UNCONFIRMED_USER = 464;
 
     private static final Range HTTP_RANGE_SUCCESS = new Range(200, 299);
@@ -149,12 +150,13 @@ private FacebookRequestError(int requestStatusCode, int errorCode,
                 } else {
                     errorCategory = Category.AUTHENTICATION_REOPEN_SESSION;
 
-                    if (subErrorCode == EC_APP_NOT_INSTALLED) {
+                    if ((subErrorCode == EC_APP_NOT_INSTALLED) || (subErrorCode == EC_EXPIRED)) {
                         messageId = R.string.com_facebook_requesterror_relogin;
                     } else if (subErrorCode == EC_PASSWORD_CHANGED) {
                         messageId = R.string.com_facebook_requesterror_password_changed;
                     } else {
                         messageId = R.string.com_facebook_requesterror_reconnect;
+                        shouldNotify = true;
                     }
                 }
             }
diff --git a/facebook/src/com/facebook/FacebookSdkVersion.java b/facebook/src/com/facebook/FacebookSdkVersion.java
index f315c7c52..288cf7131 100644
--- a/facebook/src/com/facebook/FacebookSdkVersion.java
+++ b/facebook/src/com/facebook/FacebookSdkVersion.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/FacebookServiceException.java b/facebook/src/com/facebook/FacebookServiceException.java
index d8a342941..0ff4f84f8 100644
--- a/facebook/src/com/facebook/FacebookServiceException.java
+++ b/facebook/src/com/facebook/FacebookServiceException.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/GetTokenClient.java b/facebook/src/com/facebook/GetTokenClient.java
index 6a284a77e..f7d23cdc8 100644
--- a/facebook/src/com/facebook/GetTokenClient.java
+++ b/facebook/src/com/facebook/GetTokenClient.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/HttpMethod.java b/facebook/src/com/facebook/HttpMethod.java
index 83936b091..bf355bd9d 100644
--- a/facebook/src/com/facebook/HttpMethod.java
+++ b/facebook/src/com/facebook/HttpMethod.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/InsightsLogger.java b/facebook/src/com/facebook/InsightsLogger.java
new file mode 100644
index 000000000..4634f4ed0
--- /dev/null
+++ b/facebook/src/com/facebook/InsightsLogger.java
@@ -0,0 +1,355 @@
+/**
+ * Copyright 2010-present Facebook.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.facebook;
+
+import android.content.Context;
+import android.os.Bundle;
+import com.facebook.internal.Logger;
+import com.facebook.internal.Utility;
+import com.facebook.internal.Validate;
+import com.facebook.model.GraphObject;
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+
+import java.math.BigDecimal;
+import java.util.Currency;
+import java.util.Set;
+
+/**
+ * The InsightsLogger class allows the developer to log various types of events back to Facebook.  In order to log
+ * events, the app must create an instance of this class via a {@link #newLogger newLogger} method, and then call
+ * the various "log" methods off of that.  Note that a Client Token for the app is required in calls to newLogger so
+ * apps that have not authenticated their users can still get meaningful user-demographics from the logged events
+ * on Facebook.
+ */
+public class InsightsLogger {
+
+    // Constants
+
+    // Event names, these match what the server expects.
+    private static final String EVENT_NAME_LOG_CONVERSION_PIXEL = "fb_log_offsite_pixel";
+    private static final String EVENT_NAME_LOG_MOBILE_PURCHASE  = "fb_mobile_purchase";
+
+    // Event parameter names, these match what the server expects.
+    private static final String EVENT_PARAMETER_CURRENCY        = "fb_currency";
+    private static final String EVENT_PARAMETER_PIXEL_ID        = "fb_offsite_pixel_id";
+    private static final String EVENT_PARAMETER_PIXEL_VALUE     = "fb_offsite_pixel_value";
+
+    // Static member variables
+    private static Session appAuthSession = null;
+
+    // Instance member variables
+    private final Context context;
+    private final String  clientToken;
+    private final String  applicationId;
+    private final Session specifiedSession;
+
+
+    /**
+     * Constructor is private, newLogger() methods should be used to build an instance.
+     */
+    private InsightsLogger(Context context, String clientToken, String applicationId, Session session) {
+
+        Validate.notNull(context, "context");
+
+        // Always ensure the client token is present, even if not needed for this particular logging (because at
+        // some point it will be required).  Be harsh by throwing an exception because this is all too easy to miss
+        // and things will work with authenticated sessions, but start failing with users that don't have
+        // authenticated sessions.
+        Validate.notNullOrEmpty(clientToken, "clientToken");
+
+        if (applicationId == null) {
+            applicationId = Utility.getMetadataApplicationId(context);
+        }
+
+        this.context = context;
+        this.clientToken = clientToken;
+        this.applicationId = applicationId;
+        this.specifiedSession = session;
+    }
+
+    /**
+     * Build an InsightsLogger instance to log events through.  The Facebook app that these events are targeted at
+     * comes from this application's metadata.
+     *
+     * @param context      Used to access the applicationId and the attributionId for non-authenticated users.
+     * @param clientToken  The Facebook app's "client token", which, for a given appid can be found in the Security
+     *                     section of the Advanced tab of the Facebook App settings found
+     *                     at <https://developers.facebook.com/apps/[your-app-id]>.
+     *
+     * @return          InsightsLogger instance to invoke log* methods on.
+     */
+    public static InsightsLogger newLogger(Context context, String clientToken) {
+        return new InsightsLogger(context, clientToken, null, null);
+    }
+
+    /**
+     * Build an InsightsLogger instance to log events through.  Allow explicit specification of an Facebook app
+     * to target.
+     *
+     * @param context        Used to access the attributionId for non-authenticated users.
+     * @param clientToken    The Facebook app's "client token", which, for a given appid can be found in the Security
+     *                       section of the Advanced tab of the Facebook App settings found
+     *                       at <https://developers.facebook.com/apps/[your-app-id]>
+     * @param applicationId  Explicitly specified Facebook applicationId to log events against.  If null, the
+     *                       applicationId embedded in the application metadata accessible from 'context' will
+     *                       be used.
+     *
+     * @return          InsightsLogger instance to invoke log* methods on.
+     */
+    public static InsightsLogger newLogger(Context context, String clientToken, String applicationId) {
+        return new InsightsLogger(context, clientToken, applicationId, null);
+    }
+
+    /**
+     * Build an InsightsLogger instance to log events through.
+     *
+     * @param context        Used to access the attributionId for non-authenticated users.
+     * @param clientToken    The Facebook app's "client token", which, for a given appid can be found in the Security
+     *                       section of the Advanced tab of the Facebook App settings found
+     *                       at <https://developers.facebook.com/apps/[your-app-id]>
+     * @param applicationId  Explicitly specified Facebook applicationId to log events against.  If null, the
+     *                       applicationId embedded in the application metadata accessible from 'context' will
+     *                       be used.
+     * @param session        Explicitly specified Session to log events against.  If null, the activeSession
+     *                       will be used if it's open, otherwise the logging will happen via the "clientToken"
+     *                       and specified appId.
+     *
+     * @return          InsightsLogger instance to invoke log* methods on.
+     */
+    public static InsightsLogger newLogger(Context context, String clientToken, String applicationId, Session session) {
+        return new InsightsLogger(context, clientToken, applicationId, session);
+    }
+
+    /**
+     * Logs a purchase event with Facebook, in the specified amount and with the specified currency.
+     *
+     * @param purchaseAmount  Amount of purchase, in the currency specified by the 'currency' parameter. This value
+     *                        will be rounded to the thousandths place (e.g., 12.34567 becomes 12.346).
+     * @param currency        Currency used to specify the amount.
+     */
+    public void logPurchase(BigDecimal purchaseAmount, Currency currency) {
+        logPurchase(purchaseAmount, currency, null);
+    }
+
+    /**
+     * Logs a purchase event with Facebook, in the specified amount and with the specified currency.  Additional
+     * detail about the purchase can be passed in through the parameters bundle.
+     *
+     * @param purchaseAmount  Amount of purchase, in the currency specified by the 'currency' parameter. This value
+     *                        will be rounded to the thousandths place (e.g., 12.34567 becomes 12.346).
+     * @param currency        Currency used to specify the amount.
+     * @param parameters      Arbitrary additional information for describing this event.  Should have no more than
+     *                        10 entries, and keys should be mostly consistent from one purchase event to the next.
+     */
+    public void logPurchase(BigDecimal purchaseAmount, Currency currency, Bundle parameters) {
+
+        if (purchaseAmount == null) {
+            notifyDeveloperError("purchaseAmount cannot be null");
+            return;
+        } else if (currency == null) {
+            notifyDeveloperError("currency cannot be null");
+            return;
+        }
+
+        if (parameters == null) {
+            parameters = new Bundle();
+        }
+        parameters.putString(EVENT_PARAMETER_CURRENCY, currency.getCurrencyCode());
+
+        logEventNow(EVENT_NAME_LOG_MOBILE_PURCHASE, purchaseAmount.doubleValue(), parameters);
+    }
+
+    /**
+     * Log, or "Fire" a Conversion Pixel.  Conversion Pixels are used for Ads Conversion Tracking.  See
+     * https://www.facebook.com/help/435189689870514 to learn more.
+     *
+     * @param pixelId      Numeric ID for the conversion pixel to be logged.  See
+     *                     https://www.facebook.com/help/435189689870514 to learn how to create a conversion pixel.
+     * @param valueOfPixel Value of what the logging of this pixel is worth to the calling app.  The currency that this
+     *                     is expressed in doesn't matter, so long as it is consistent across all logging for this
+     *                     pixel. This value will be rounded to the thousandths place (e.g., 12.34567 becomes 12.346).
+     */
+    public void logConversionPixel(String pixelId, double valueOfPixel) {
+
+        if (pixelId == null) {
+            notifyDeveloperError("pixelID cannot be null");
+            return;
+        }
+
+        Bundle parameters = new Bundle();
+        parameters.putString(EVENT_PARAMETER_PIXEL_ID, pixelId);
+        parameters.putDouble(EVENT_PARAMETER_PIXEL_VALUE, valueOfPixel);
+
+        logEventNow(EVENT_NAME_LOG_CONVERSION_PIXEL, valueOfPixel, parameters);
+    }
+
+    /**
+     * This is the workhorse function of the InsightsLogger class and does the packaging and POST.  As InsightsLogger
+     * is expanded to support more custom app events, this logic will become more complicated and allow for batching
+     * and flushing of multiple events, of persisting to disk so as to survive network outages, implicitly logging
+     * (with the dev's permission) SDK actions, etc.
+     */
+    private void logEventNow(
+            final String eventName,
+            final double valueToSum,
+            final Bundle parameters) {
+
+        // Run everything synchronously on a worker thread.
+        Settings.getExecutor().execute(new Runnable() {
+
+            @Override
+            public void run() {
+
+                final String eventJSON = buildJSONForEvent(eventName, valueToSum, parameters);
+                if (eventJSON == null) {
+                    // Failure in building JSON, already reported, so just return.
+                    return;
+                }
+
+                GraphObject publishParams = GraphObject.Factory.create();
+                publishParams.setProperty("event", "CUSTOM_APP_EVENTS");
+                publishParams.setProperty("custom_events", eventJSON);
+
+                if (Utility.queryAppAttributionSupportAndWait(applicationId)) {
+                    String attributionId = Settings.getAttributionId(context.getContentResolver());
+                    if (attributionId != null) {
+                        publishParams.setProperty("attribution", attributionId);
+                    }
+                }
+
+                String publishUrl = String.format("%s/activities", applicationId);
+
+                try {
+
+                    Request postRequest = Request.newPostRequest(sessionToLogTo(), publishUrl, publishParams, null);
+                    Response response = postRequest.executeAndWait();
+
+                    // A -1 error code happens if there is no connectivity.  No need to notify the
+                    // developer in that case.
+                    final int NO_CONNECTIVITY_ERROR_CODE = -1;
+                    if (response.getError() != null &&
+                        response.getError().getErrorCode() != NO_CONNECTIVITY_ERROR_CODE) {
+                        notifyDeveloperError(
+                                String.format(
+                                        "Error publishing Insights event '%s'\n  Response: %s\n  Error: %s",
+                                        eventJSON,
+                                        response.toString(),
+                                        response.getError().toString()));
+                    }
+
+                } catch (Exception e) {
+
+                    Utility.logd("Insights-exception: ", e);
+
+                }
+            }
+        });
+
+    }
+
+    private static String buildJSONForEvent(String eventName, double valueToSum, Bundle parameters) {
+        String result;
+        try {
+
+            // Build custom event payload
+            JSONObject eventObject = new JSONObject();
+            eventObject.put("_eventName", eventName);
+            if (valueToSum != 1.0) {
+                eventObject.put("_valueToSum", valueToSum);
+            }
+
+            if (parameters != null) {
+
+                Set<String> keys = parameters.keySet();
+                for (String key : keys) {
+                    Object value = parameters.get(key);
+
+                    if (!(value instanceof String) &&
+                        !(value instanceof Number)) {
+
+                        notifyDeveloperError(
+                                String.format("Parameter '%s' must be a string or a numeric type.", key));
+                    }
+
+                    eventObject.put(key, value);
+                }
+            }
+
+            JSONArray eventArray = new JSONArray();
+            eventArray.put(eventObject);
+
+            result = eventArray.toString();
+
+        } catch (JSONException exception) {
+
+            notifyDeveloperError(exception.toString());
+            result = null;
+
+        }
+
+        return result;
+    }
+
+    /**
+     * Using the specifiedSession member variable (which may be nil), find the real session to log to
+     * (with an access token).  Precedence: 1) specified session, 2) activeSession, 3) app authenticated
+     * session via Client Token.
+     */
+    private Session sessionToLogTo() {
+
+        synchronized (this) {
+
+            Session session = specifiedSession;
+
+            // Require an open session.
+
+            if (session == null || !session.isOpened()) {
+                session = Session.getActiveSession();
+            }
+
+            if (session == null || !session.isOpened() || session.getAccessToken() == null) {
+
+                if (appAuthSession == null) {
+
+                    // Build and stash a client-token based session.
+
+                    // Form the clientToken based access token from appID and client token.
+                    String tokenString = String.format("%s|%s", applicationId, clientToken);
+                    AccessToken token = AccessToken.createFromString(tokenString, null, AccessTokenSource.CLIENT_TOKEN);
+
+                    appAuthSession = new Session(null, applicationId, new NonCachingTokenCachingStrategy(), false);
+                    appAuthSession.open(token, null);
+                }
+
+                session = appAuthSession;
+            }
+
+            return session;
+        }
+    }
+
+    /**
+     * Invoke this method, rather than throwing an Exception, for situations where user/server input might reasonably
+     * cause this to occur, and thus don't want an exception thrown at production time, but do want logging
+     * notification.
+     */
+    private static void notifyDeveloperError(String message) {
+        Logger.log(LoggingBehavior.DEVELOPER_ERRORS, "Insights", message);
+    }
+}
diff --git a/facebook/src/com/facebook/LegacyHelper.java b/facebook/src/com/facebook/LegacyHelper.java
index afcda0b26..dcdfd8561 100644
--- a/facebook/src/com/facebook/LegacyHelper.java
+++ b/facebook/src/com/facebook/LegacyHelper.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/LoggingBehavior.java b/facebook/src/com/facebook/LoggingBehavior.java
index 621bf64f8..5c251d017 100644
--- a/facebook/src/com/facebook/LoggingBehavior.java
+++ b/facebook/src/com/facebook/LoggingBehavior.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -37,5 +37,9 @@
     /**
      * Indicates that cache operations should be logged.
      */
-    CACHE
+    CACHE,
+    /**
+     * Indicates that likely developer errors should be logged.  (This is set by default in LoggingBehavior.)
+     */
+    DEVELOPER_ERRORS
 }
diff --git a/facebook/src/com/facebook/LoginActivity.java b/facebook/src/com/facebook/LoginActivity.java
index 2b45eeb08..26e769a88 100644
--- a/facebook/src/com/facebook/LoginActivity.java
+++ b/facebook/src/com/facebook/LoginActivity.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/NativeProtocol.java b/facebook/src/com/facebook/NativeProtocol.java
index c416b37f0..279d08972 100644
--- a/facebook/src/com/facebook/NativeProtocol.java
+++ b/facebook/src/com/facebook/NativeProtocol.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/NonCachingTokenCachingStrategy.java b/facebook/src/com/facebook/NonCachingTokenCachingStrategy.java
index f055d5e92..1f4c56216 100644
--- a/facebook/src/com/facebook/NonCachingTokenCachingStrategy.java
+++ b/facebook/src/com/facebook/NonCachingTokenCachingStrategy.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/Request.java b/facebook/src/com/facebook/Request.java
index 837ce4a65..ac5fe2bdd 100644
--- a/facebook/src/com/facebook/Request.java
+++ b/facebook/src/com/facebook/Request.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/RequestAsyncTask.java b/facebook/src/com/facebook/RequestAsyncTask.java
index 359836db0..db60a18f9 100644
--- a/facebook/src/com/facebook/RequestAsyncTask.java
+++ b/facebook/src/com/facebook/RequestAsyncTask.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/RequestBatch.java b/facebook/src/com/facebook/RequestBatch.java
index de3f5517a..7183a2ddb 100644
--- a/facebook/src/com/facebook/RequestBatch.java
+++ b/facebook/src/com/facebook/RequestBatch.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/Response.java b/facebook/src/com/facebook/Response.java
index dd13cf592..cea5ed18a 100644
--- a/facebook/src/com/facebook/Response.java
+++ b/facebook/src/com/facebook/Response.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -333,6 +333,11 @@ static FileLruCache getResponseCache() {
                 "Response (raw)\n  Size: %d\n  Response:\n%s\n", responseString.length(),
                 responseString);
 
+        return createResponsesFromString(responseString, connection, requests, isFromCache);
+    }
+
+    static List<Response> createResponsesFromString(String responseString, HttpURLConnection connection,
+            RequestBatch requests, boolean isFromCache) throws FacebookException, JSONException, IOException {
         JSONTokener tokener = new JSONTokener(responseString);
         Object resultObject = tokener.nextValue();
 
diff --git a/facebook/src/com/facebook/Session.java b/facebook/src/com/facebook/Session.java
index 694ccf3fb..8e3f4d410 100644
--- a/facebook/src/com/facebook/Session.java
+++ b/facebook/src/com/facebook/Session.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -1089,7 +1089,13 @@ private boolean tryLegacyAuth(final AuthorizationRequest request) {
         authorizationClient.setOnCompletedListener(new AuthorizationClient.OnCompletedListener() {
             @Override
             public void onCompleted(AuthorizationClient.Result result) {
-                handleAuthorizationResult(Activity.RESULT_OK, result);
+                int activityResult;
+                if (result.code == AuthorizationClient.Result.Code.CANCEL) {
+                    activityResult = Activity.RESULT_CANCELED;
+                } else {
+                    activityResult = Activity.RESULT_OK;
+                }
+                handleAuthorizationResult(activityResult, result);
             }
         });
         authorizationClient.setContext(getStaticContext());
@@ -1158,7 +1164,12 @@ private void saveTokenToCache(AccessToken newToken) {
     }
 
     void postStateChange(final SessionState oldState, final SessionState newState, final Exception exception) {
-        if (oldState == newState && exception == null) {
+        // When we request new permissions, we stay in SessionState.OPENED_TOKEN_UPDATED,
+        // but we still want notifications of the state change since permissions are
+        // different now.
+        if ((oldState == newState) &&
+                (oldState != SessionState.OPENED_TOKEN_UPDATED) &&
+                (exception == null)) {
             return;
         }
 
@@ -1486,7 +1497,7 @@ protected Void doInBackground(Void... voids) {
             try {
                 Settings.publishInstallAndWait(mApplicationContext, mApplicationId);
             } catch (Exception e) {
-                Utility.logd("Facebook-publish", e.getMessage());
+                Utility.logd("Facebook-publish", e);
             }
             return null;
         }
diff --git a/facebook/src/com/facebook/SessionDefaultAudience.java b/facebook/src/com/facebook/SessionDefaultAudience.java
index eaac2b369..b07d93584 100644
--- a/facebook/src/com/facebook/SessionDefaultAudience.java
+++ b/facebook/src/com/facebook/SessionDefaultAudience.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/SessionLoginBehavior.java b/facebook/src/com/facebook/SessionLoginBehavior.java
index cc300dbd2..17dd09658 100644
--- a/facebook/src/com/facebook/SessionLoginBehavior.java
+++ b/facebook/src/com/facebook/SessionLoginBehavior.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/SessionState.java b/facebook/src/com/facebook/SessionState.java
index 45250624f..99ac70187 100644
--- a/facebook/src/com/facebook/SessionState.java
+++ b/facebook/src/com/facebook/SessionState.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/Settings.java b/facebook/src/com/facebook/Settings.java
index f0a8f7ed0..066c58ddf 100644
--- a/facebook/src/com/facebook/Settings.java
+++ b/facebook/src/com/facebook/Settings.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -22,14 +22,17 @@
 import android.database.Cursor;
 import android.net.Uri;
 import android.os.AsyncTask;
-import android.os.Bundle;
+import android.os.Handler;
+import android.os.Looper;
 import com.facebook.android.BuildConfig;
 import com.facebook.internal.Utility;
 import com.facebook.model.GraphObject;
 import com.facebook.internal.Validate;
 import org.json.JSONException;
+import org.json.JSONObject;
 
 import java.lang.reflect.Field;
+import java.util.Arrays;
 import java.util.Collections;
 import java.util.HashSet;
 import java.util.Set;
@@ -40,7 +43,8 @@
  * Allows some customization of sdk behavior.
  */
 public final class Settings {
-    private static final HashSet<LoggingBehavior> loggingBehaviors = new HashSet<LoggingBehavior>();
+    private static final HashSet<LoggingBehavior> loggingBehaviors =
+            new HashSet<LoggingBehavior>(Arrays.asList(LoggingBehavior.DEVELOPER_ERRORS));
     private static volatile Executor executor;
     private static volatile boolean shouldAutoPublishInstall;
 
@@ -56,8 +60,6 @@
     private static final String ATTRIBUTION_PREFERENCES = "com.facebook.sdk.attributionTracking";
     private static final String PUBLISH_ACTIVITY_PATH = "%s/activities";
     private static final String MOBILE_INSTALL_EVENT = "MOBILE_APP_INSTALL";
-    private static final String SUPPORTS_ATTRIBUTION = "supports_attribution";
-    private static final String APPLICATION_FIELDS = "fields";
     private static final String ANALYTICS_EVENT = "event";
     private static final String ATTRIBUTION_KEY = "attribution";
 
@@ -209,13 +211,41 @@ private static Executor getAsyncTaskExecutor() {
         return (Executor) executorObject;
     }
 
+    /**
+     * Manually publish install attribution to the Facebook graph.  Internally handles tracking repeat calls to prevent
+     * multiple installs being published to the graph.
+     * @param context the current Context
+     * @param applicationId the fb application being published.
+     */
     public static void publishInstallAsync(final Context context, final String applicationId) {
+       publishInstallAsync(context, applicationId, null);
+    }
+
+    /**
+     * Manually publish install attribution to the Facebook graph.  Internally handles tracking repeat calls to prevent
+     * multiple installs being published to the graph.
+     * @param context the current Context
+     * @param applicationId the fb application being published.
+     * @param callback a callback to invoke with a Response object, carrying the server response, or an error.
+     */
+    public static void publishInstallAsync(final Context context, final String applicationId,
+        final Request.Callback callback) {
         // grab the application context ahead of time, since we will return to the caller immediately.
         final Context applicationContext = context.getApplicationContext();
         Settings.getExecutor().execute(new Runnable() {
             @Override
             public void run() {
-                Settings.publishInstallAndWait(applicationContext, applicationId);
+                final Response response = Settings.publishInstallAndWaitForResponse(applicationContext, applicationId);
+                if (callback != null) {
+                    // invoke the callback on the main thread.
+                    Handler handler = new Handler(Looper.getMainLooper());
+                    handler.post(new Runnable() {
+                        @Override
+                        public void run() {
+                            callback.onCompleted(response);
+                        }
+                    });
+                }
             }
         });
     }
@@ -242,57 +272,91 @@ public static boolean getShouldAutoPublishInstall() {
      * Manually publish install attribution to the Facebook graph.  Internally handles tracking repeat calls to prevent
      * multiple installs being published to the graph.
      * @param context the current Context
+     * @param applicationId the fb application being published.
      * @return returns false on error.  Applications should retry until true is returned.  Safe to call again after
      * true is returned.
      */
     public static boolean publishInstallAndWait(final Context context, final String applicationId) {
+        Response response = publishInstallAndWaitForResponse(context, applicationId);
+        return response != null && response.getError() == null;
+    }
+
+    /**
+     * Manually publish install attribution to the Facebook graph.  Internally handles caching repeat calls to prevent
+     * multiple installs being published to the graph.
+     * @param context the current Context
+     * @param applicationId the fb application being published.
+     * @return returns a Response object, carrying the server response, or an error.
+     */
+    public static Response publishInstallAndWaitForResponse(final Context context, final String applicationId) {
         try {
-            if (applicationId == null) {
-                return false;
+            if (context == null || applicationId == null) {
+                throw new IllegalArgumentException("Both context and applicationId must be non-null");
             }
             String attributionId = Settings.getAttributionId(context.getContentResolver());
             SharedPreferences preferences = context.getSharedPreferences(ATTRIBUTION_PREFERENCES, Context.MODE_PRIVATE);
             String pingKey = applicationId+"ping";
+            String jsonKey = applicationId+"json";
             long lastPing = preferences.getLong(pingKey, 0);
-            if (lastPing == 0 && attributionId != null) {
-                Bundle supportsAttributionParams = new Bundle();
-                supportsAttributionParams.putString(APPLICATION_FIELDS, SUPPORTS_ATTRIBUTION);
-                Request pingRequest = Request.newGraphPathRequest(null, applicationId, null);
-                pingRequest.setParameters(supportsAttributionParams);
-
-                GraphObject supportResponse = pingRequest.executeAndWait().getGraphObject();
-                Object doesSupportAttribution = supportResponse.getProperty(SUPPORTS_ATTRIBUTION);
-
-                if (!(doesSupportAttribution instanceof Boolean)) {
-                    throw new JSONException(String.format(
-                            "%s contains %s instead of a Boolean", SUPPORTS_ATTRIBUTION, doesSupportAttribution));
+            String lastResponseJSON = preferences.getString(jsonKey, null);
+
+            GraphObject publishParams = GraphObject.Factory.create();
+            publishParams.setProperty(ANALYTICS_EVENT, MOBILE_INSTALL_EVENT);
+            publishParams.setProperty(ATTRIBUTION_KEY, attributionId);
+
+            String publishUrl = String.format(PUBLISH_ACTIVITY_PATH, applicationId);
+            Request publishRequest = Request.newPostRequest(null, publishUrl, publishParams, null);
+
+            if (lastPing != 0) {
+                GraphObject graphObject = null;
+                try {
+                    if (lastResponseJSON != null) {
+                        graphObject = GraphObject.Factory.create(new JSONObject(lastResponseJSON));
+                    }
+                }
+                catch (JSONException je) {
+                    // return the default graph object if there is any problem reading the data.
+                }
+                if (graphObject == null) {
+                    return Response.createResponsesFromString("true", null, new RequestBatch(publishRequest), true).get(0);
+                } else {
+                    return new Response(null, null, graphObject, true);
                 }
+            } else if (attributionId == null) {
+                throw new FacebookException("No attribution id returned from the Facebook application");
+            } else {
 
-                if ((Boolean)doesSupportAttribution) {
-                    GraphObject publishParams = GraphObject.Factory.create();
-                    publishParams.setProperty(ANALYTICS_EVENT, MOBILE_INSTALL_EVENT);
-                    publishParams.setProperty(ATTRIBUTION_KEY, attributionId);
+                if (!Utility.queryAppAttributionSupportAndWait(applicationId)) {
+                    throw new FacebookException("Install attribution has been disabled on the server.");
+                }
 
-                    String publishUrl = String.format(PUBLISH_ACTIVITY_PATH, applicationId);
+                Response publishResponse = publishRequest.executeAndWait();
 
-                    Request publishRequest = Request.newPostRequest(null, publishUrl, publishParams, null);
-                    publishRequest.executeAndWait();
+                // denote success since no error threw from the post.
+                SharedPreferences.Editor editor = preferences.edit();
+                lastPing = System.currentTimeMillis();
+                editor.putLong(pingKey, lastPing);
 
-                    // denote success since no error threw from the post.
-                    SharedPreferences.Editor editor = preferences.edit();
-                    lastPing = System.currentTimeMillis();
-                    editor.putLong(pingKey, lastPing);
-                    editor.commit();
+                // if we got an object response back, cache the string of the JSON.
+                if (publishResponse.getGraphObject() != null &&
+                    publishResponse.getGraphObject().getInnerJSONObject() != null) {
+                    editor.putString(jsonKey, publishResponse.getGraphObject().getInnerJSONObject().toString());
                 }
+                editor.commit();
+
+                return publishResponse;
             }
-            return lastPing != 0;
         } catch (Exception e) {
             // if there was an error, fall through to the failure case.
-            Utility.logd("Facebook-publish", e.getMessage());
+            Utility.logd("Facebook-publish", e);
+            return new Response(null, null, new FacebookRequestError(null, e));
         }
-        return false;
     }
 
+    /**
+     * Acquire the current attribution id from the facebook app.
+     * @return returns null if the facebook app is not present on the phone.
+     */
     public static String getAttributionId(ContentResolver contentResolver) {
         String [] projection = {ATTRIBUTION_ID_COLUMN_NAME};
         Cursor c = contentResolver.query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
@@ -303,4 +367,24 @@ public static String getAttributionId(ContentResolver contentResolver) {
         c.close();
         return attributionId;
     }
+
+    /**
+     * Gets the current version of the Facebook SDK for Android as a string.
+     *
+     * @return the current version of the SDK
+     */
+    public static String getSdkVersion() {
+        return FacebookSdkVersion.BUILD;
+    }
+
+    /**
+     * Gets the current Facebook migration bundle string; this string can be passed to Graph API
+     * endpoints to specify a set of platform migrations that are explicitly turned on or off for
+     * that call, in order to ensure compatibility between a given version of the SDK and the
+     * Graph API.
+     * @return the migration bundle supported by this version of the SDK
+     */
+    public static String getMigrationBundle() {
+        return FacebookSdkVersion.MIGRATION_BUNDLE;
+    }
 }
diff --git a/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java b/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
index 9a1683528..0286d3c1f 100644
--- a/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
+++ b/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/TestSession.java b/facebook/src/com/facebook/TestSession.java
index 0c6651812..9133cb91f 100644
--- a/facebook/src/com/facebook/TestSession.java
+++ b/facebook/src/com/facebook/TestSession.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/TokenCachingStrategy.java b/facebook/src/com/facebook/TokenCachingStrategy.java
index cb3271ac8..6f18cc3fe 100644
--- a/facebook/src/com/facebook/TokenCachingStrategy.java
+++ b/facebook/src/com/facebook/TokenCachingStrategy.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/UiLifecycleHelper.java b/facebook/src/com/facebook/UiLifecycleHelper.java
index 5d42267f6..5dceca9ab 100644
--- a/facebook/src/com/facebook/UiLifecycleHelper.java
+++ b/facebook/src/com/facebook/UiLifecycleHelper.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -74,15 +74,6 @@ public void onCreate(Bundle savedInstanceState) {
             }
             Session.setActiveSession(session);
         }
-
-        // add the broadcast receiver
-        IntentFilter filter = new IntentFilter();
-        filter.addAction(Session.ACTION_ACTIVE_SESSION_SET);
-        filter.addAction(Session.ACTION_ACTIVE_SESSION_UNSET);
-
-        // Add a broadcast receiver to listen to when the active Session
-        // is set or unset, and add/remove our callback as appropriate
-        broadcastManager.registerReceiver(receiver, filter);
     }
 
     /**
@@ -99,6 +90,14 @@ public void onResume() {
             }
         }
 
+        // add the broadcast receiver
+        IntentFilter filter = new IntentFilter();
+        filter.addAction(Session.ACTION_ACTIVE_SESSION_SET);
+        filter.addAction(Session.ACTION_ACTIVE_SESSION_UNSET);
+
+        // Add a broadcast receiver to listen to when the active Session
+        // is set or unset, and add/remove our callback as appropriate
+        broadcastManager.registerReceiver(receiver, filter);
     }
 
     /**
@@ -128,6 +127,9 @@ public void onSaveInstanceState(Bundle outState) {
      * To be called from an Activity or Fragment's onPause method.
      */
     public void onPause() {
+        // remove the broadcast receiver
+        broadcastManager.unregisterReceiver(receiver);
+
         if (callback != null) {
             Session session = Session.getActiveSession();
             if (session != null) {
@@ -140,8 +142,6 @@ public void onPause() {
      * To be called from an Activity or Fragment's onDestroy method.
      */
     public void onDestroy() {
-        // remove the broadcast receiver
-        broadcastManager.unregisterReceiver(receiver);
     }
 
     /**
diff --git a/facebook/src/com/facebook/internal/CacheableRequestBatch.java b/facebook/src/com/facebook/internal/CacheableRequestBatch.java
index 26a1595c2..83e2d2f44 100644
--- a/facebook/src/com/facebook/internal/CacheableRequestBatch.java
+++ b/facebook/src/com/facebook/internal/CacheableRequestBatch.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/internal/FileLruCache.java b/facebook/src/com/facebook/internal/FileLruCache.java
index 1fe81b5e1..3d1a8d774 100644
--- a/facebook/src/com/facebook/internal/FileLruCache.java
+++ b/facebook/src/com/facebook/internal/FileLruCache.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/internal/Logger.java b/facebook/src/com/facebook/internal/Logger.java
index 6a232c6c8..a0d43fbbf 100644
--- a/facebook/src/com/facebook/internal/Logger.java
+++ b/facebook/src/com/facebook/internal/Logger.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -67,6 +67,12 @@ public static void log(LoggingBehavior behavior, int priority, String tag, Strin
                 tag = LOG_TAG_BASE + tag;
             }
             Log.println(priority, tag, string);
+
+            // Developer errors warrant special treatment by printing out a stack trace, to make both more noticeable,
+            // and let the source of the problem be more easily pinpointed.
+            if (behavior == LoggingBehavior.DEVELOPER_ERRORS) {
+                (new Exception()).printStackTrace();
+            }
         }
     }
 
diff --git a/facebook/src/com/facebook/internal/ServerProtocol.java b/facebook/src/com/facebook/internal/ServerProtocol.java
index 6cb65324d..e2ab2c045 100644
--- a/facebook/src/com/facebook/internal/ServerProtocol.java
+++ b/facebook/src/com/facebook/internal/ServerProtocol.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -34,6 +34,8 @@
     public static final String DIALOG_PARAM_DISPLAY = "display";
     public static final String DIALOG_PARAM_REDIRECT_URI = "redirect_uri";
     public static final String DIALOG_PARAM_TYPE = "type";
+    public static final String DIALOG_PARAM_ACCESS_TOKEN = "access_token";
+    public static final String DIALOG_PARAM_APP_ID = "app_id";
 
     // URL components
     public static final String GRAPH_URL = "https://graph." + FACEBOOK_COM;
diff --git a/facebook/src/com/facebook/internal/SessionAuthorizationType.java b/facebook/src/com/facebook/internal/SessionAuthorizationType.java
index 6684019a1..85083b8d6 100644
--- a/facebook/src/com/facebook/internal/SessionAuthorizationType.java
+++ b/facebook/src/com/facebook/internal/SessionAuthorizationType.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/internal/SessionTracker.java b/facebook/src/com/facebook/internal/SessionTracker.java
index e013de5c5..5584ef3be 100644
--- a/facebook/src/com/facebook/internal/SessionTracker.java
+++ b/facebook/src/com/facebook/internal/SessionTracker.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/internal/Utility.java b/facebook/src/com/facebook/internal/Utility.java
index 371e5d056..04b853e15 100644
--- a/facebook/src/com/facebook/internal/Utility.java
+++ b/facebook/src/com/facebook/internal/Utility.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -26,9 +26,9 @@
 import android.util.Log;
 import android.webkit.CookieManager;
 import android.webkit.CookieSyncManager;
-import com.facebook.FacebookException;
-import com.facebook.Session;
+import com.facebook.*;
 import com.facebook.android.BuildConfig;
+import com.facebook.model.GraphObject;
 import org.json.JSONArray;
 import org.json.JSONException;
 import org.json.JSONObject;
@@ -50,10 +50,16 @@
     static final String LOG_TAG = "FacebookSDK";
     private static final String HASH_ALGORITHM_MD5 = "MD5";
     private static final String URL_SCHEME = "https";
+    private static final String SUPPORTS_ATTRIBUTION = "supports_attribution";
+    private static final String APPLICATION_FIELDS = "fields";
 
     // This is the default used by the buffer streams, but they trace a warning if you do not specify.
     public static final int DEFAULT_STREAM_BUFFER_SIZE = 8192;
 
+    private static final Object LOCK = new Object();
+    private static volatile boolean attributionAllowedForLastAppChecked = false;
+    private static volatile String lastAppCheckedForAttributionStatus = "";
+
     // Returns true iff all items in subset are in superset, treating null and
     // empty collections as
     // the same.
@@ -282,9 +288,48 @@ public static void clearFacebookCookies(Context context) {
         clearCookiesForDomain(context, "https://.facebook.com");
     }
 
+    public static void logd(String tag, Exception e) {
+        if (BuildConfig.DEBUG && tag != null && e != null) {
+            Log.d(tag, e.getClass().getSimpleName() + ": " + e.getMessage());
+        }
+    }
+
     public static void logd(String tag, String msg) {
-        if (BuildConfig.DEBUG) {
+        if (BuildConfig.DEBUG && tag != null && msg != null) {
             Log.d(tag, msg);
         }
     }
+
+    public static boolean queryAppAttributionSupportAndWait(final String applicationId) {
+
+        synchronized (LOCK) {
+
+            // Cache the last app checked results.
+            if (applicationId.equals(lastAppCheckedForAttributionStatus)) {
+                return attributionAllowedForLastAppChecked;
+            }
+
+            Bundle supportsAttributionParams = new Bundle();
+            supportsAttributionParams.putString(APPLICATION_FIELDS, SUPPORTS_ATTRIBUTION);
+            Request pingRequest = Request.newGraphPathRequest(null, applicationId, null);
+            pingRequest.setParameters(supportsAttributionParams);
+
+            GraphObject supportResponse = pingRequest.executeAndWait().getGraphObject();
+
+            Object doesSupportAttribution = false;
+            if (supportResponse != null) {
+                doesSupportAttribution = supportResponse.getProperty(SUPPORTS_ATTRIBUTION);
+            }
+
+            if (!(doesSupportAttribution instanceof Boolean)) {
+                // Should never happen, but be safe in case server returns non-Boolean
+                doesSupportAttribution = false;
+            }
+
+            lastAppCheckedForAttributionStatus = applicationId;
+            attributionAllowedForLastAppChecked = ((Boolean)doesSupportAttribution == true);
+            return attributionAllowedForLastAppChecked;
+        }
+    }
+
 }
diff --git a/facebook/src/com/facebook/internal/Validate.java b/facebook/src/com/facebook/internal/Validate.java
index c66dee731..57bed08a6 100644
--- a/facebook/src/com/facebook/internal/Validate.java
+++ b/facebook/src/com/facebook/internal/Validate.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -26,7 +26,7 @@
 public final class Validate {
     public static void notNull(Object arg, String name) {
         if (arg == null) {
-            throw new NullPointerException("Argument " + name + " cannot be null");
+            throw new NullPointerException("Argument '" + name + "' cannot be null");
         }
     }
 
@@ -52,7 +52,7 @@ public static void notNull(Object arg, String name) {
 
     public static void notNullOrEmpty(String arg, String name) {
         if (Utility.isNullOrEmpty(arg)) {
-            throw new IllegalArgumentException("Argument " + name + " cannot be null or empty");
+            throw new IllegalArgumentException("Argument '" + name + "' cannot be null or empty");
         }
     }
 
@@ -68,6 +68,6 @@ public static void oneOf(Object arg, String name, Object... values) {
                 }
             }
         }
-        throw new IllegalArgumentException("Argument " + name + " was not one of the allowed values");
+        throw new IllegalArgumentException("Argument '" + name + "' was not one of the allowed values");
     }
 }
diff --git a/facebook/src/com/facebook/internal/package-info.java b/facebook/src/com/facebook/internal/package-info.java
index 4392d0f35..b3d145ce4 100644
--- a/facebook/src/com/facebook/internal/package-info.java
+++ b/facebook/src/com/facebook/internal/package-info.java
@@ -3,4 +3,4 @@
  * any of the classes in this package is unsupported, and they may be modified or removed without warning at
  * any time.
  */
-package com.facebook.internal;
\ No newline at end of file
+package com.facebook.internal;
diff --git a/facebook/src/com/facebook/model/GraphLocation.java b/facebook/src/com/facebook/model/GraphLocation.java
index 7fec04b96..9074a4976 100644
--- a/facebook/src/com/facebook/model/GraphLocation.java
+++ b/facebook/src/com/facebook/model/GraphLocation.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/GraphMultiResult.java b/facebook/src/com/facebook/model/GraphMultiResult.java
index f5d65569f..dbcdbad3e 100644
--- a/facebook/src/com/facebook/model/GraphMultiResult.java
+++ b/facebook/src/com/facebook/model/GraphMultiResult.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/GraphObject.java b/facebook/src/com/facebook/model/GraphObject.java
index 9b78f062a..7231ea547 100644
--- a/facebook/src/com/facebook/model/GraphObject.java
+++ b/facebook/src/com/facebook/model/GraphObject.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/GraphObjectList.java b/facebook/src/com/facebook/model/GraphObjectList.java
index 311e0dcd9..e4184fa34 100644
--- a/facebook/src/com/facebook/model/GraphObjectList.java
+++ b/facebook/src/com/facebook/model/GraphObjectList.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/GraphPlace.java b/facebook/src/com/facebook/model/GraphPlace.java
index c4ef6889d..1d624b7f1 100644
--- a/facebook/src/com/facebook/model/GraphPlace.java
+++ b/facebook/src/com/facebook/model/GraphPlace.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/GraphUser.java b/facebook/src/com/facebook/model/GraphUser.java
index cc684d3ae..c2daca049 100644
--- a/facebook/src/com/facebook/model/GraphUser.java
+++ b/facebook/src/com/facebook/model/GraphUser.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/JsonUtil.java b/facebook/src/com/facebook/model/JsonUtil.java
index bd46f6e2a..6d2012236 100644
--- a/facebook/src/com/facebook/model/JsonUtil.java
+++ b/facebook/src/com/facebook/model/JsonUtil.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/OpenGraphAction.java b/facebook/src/com/facebook/model/OpenGraphAction.java
index 9e007a89d..5b40e5780 100644
--- a/facebook/src/com/facebook/model/OpenGraphAction.java
+++ b/facebook/src/com/facebook/model/OpenGraphAction.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/model/PropertyName.java b/facebook/src/com/facebook/model/PropertyName.java
index 36da6edda..1e705fe6f 100644
--- a/facebook/src/com/facebook/model/PropertyName.java
+++ b/facebook/src/com/facebook/model/PropertyName.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -31,4 +31,4 @@
 @Retention(RetentionPolicy.RUNTIME)
 public @interface PropertyName {
     String value();
-}
\ No newline at end of file
+}
diff --git a/facebook/src/com/facebook/widget/FacebookFragment.java b/facebook/src/com/facebook/widget/FacebookFragment.java
index 1084185c5..e9849a8ab 100644
--- a/facebook/src/com/facebook/widget/FacebookFragment.java
+++ b/facebook/src/com/facebook/widget/FacebookFragment.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/FriendPickerFragment.java b/facebook/src/com/facebook/widget/FriendPickerFragment.java
index 831b3a0c4..7867a5ea8 100644
--- a/facebook/src/com/facebook/widget/FriendPickerFragment.java
+++ b/facebook/src/com/facebook/widget/FriendPickerFragment.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/GraphObjectAdapter.java b/facebook/src/com/facebook/widget/GraphObjectAdapter.java
index dbf66809c..42643d6a0 100644
--- a/facebook/src/com/facebook/widget/GraphObjectAdapter.java
+++ b/facebook/src/com/facebook/widget/GraphObjectAdapter.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -60,12 +60,16 @@
     private Context context;
     private Map<String, ImageResponse> prefetchedPictureCache = new HashMap<String, ImageResponse>();
     private ArrayList<String> prefetchedProfilePictureIds = new ArrayList<String>();
-
+    private OnErrorListener onErrorListener;
 
     public interface DataNeededListener {
         public void onDataNeeded();
     }
 
+    public interface OnErrorListener {
+        void onError(GraphObjectAdapter<?> adapter, FacebookException error);
+    }
+
     public static class SectionAndItem<T extends GraphObject> {
         public String sectionKey;
         public T graphObject;
@@ -141,6 +145,14 @@ public void setDataNeededListener(DataNeededListener dataNeededListener) {
         this.dataNeededListener = dataNeededListener;
     }
 
+    public OnErrorListener getOnErrorListener() {
+        return onErrorListener;
+    }
+
+    public void setOnErrorListener(OnErrorListener onErrorListener) {
+        this.onErrorListener = onErrorListener;
+    }
+
     public GraphObjectCursor<T> getCursor() {
         return cursor;
     }
@@ -745,8 +757,21 @@ public void onCompleted(ImageResponse response) {
         }
     }
 
+    private void callOnErrorListener(Exception exception) {
+        if (onErrorListener != null) {
+            if (!(exception instanceof FacebookException)) {
+                exception = new FacebookException(exception);
+            }
+            onErrorListener.onError(this, (FacebookException) exception);
+        }
+    }
+
     private void processImageResponse(ImageResponse response, String graphObjectId, ImageView imageView) {
         pendingRequests.remove(graphObjectId);
+        if (response.getError() != null) {
+            callOnErrorListener(response.getError());
+        }
+
         if (imageView == null) {
             // This was a pre-fetch request.
             if (response.getBitmap() != null) {
diff --git a/facebook/src/com/facebook/widget/GraphObjectCursor.java b/facebook/src/com/facebook/widget/GraphObjectCursor.java
index a86e4a302..9495535e0 100644
--- a/facebook/src/com/facebook/widget/GraphObjectCursor.java
+++ b/facebook/src/com/facebook/widget/GraphObjectCursor.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/GraphObjectPagingLoader.java b/facebook/src/com/facebook/widget/GraphObjectPagingLoader.java
index f36eeb48e..26b33c99d 100644
--- a/facebook/src/com/facebook/widget/GraphObjectPagingLoader.java
+++ b/facebook/src/com/facebook/widget/GraphObjectPagingLoader.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/ImageDownloader.java b/facebook/src/com/facebook/widget/ImageDownloader.java
index 4ea4b5494..6fef68043 100644
--- a/facebook/src/com/facebook/widget/ImageDownloader.java
+++ b/facebook/src/com/facebook/widget/ImageDownloader.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/ImageRequest.java b/facebook/src/com/facebook/widget/ImageRequest.java
index 81494109d..5c45ff723 100644
--- a/facebook/src/com/facebook/widget/ImageRequest.java
+++ b/facebook/src/com/facebook/widget/ImageRequest.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/ImageResponse.java b/facebook/src/com/facebook/widget/ImageResponse.java
index 98c52e8b8..ae47eec9d 100644
--- a/facebook/src/com/facebook/widget/ImageResponse.java
+++ b/facebook/src/com/facebook/widget/ImageResponse.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/ImageResponseCache.java b/facebook/src/com/facebook/widget/ImageResponseCache.java
index 05799e53a..53b8d824f 100644
--- a/facebook/src/com/facebook/widget/ImageResponseCache.java
+++ b/facebook/src/com/facebook/widget/ImageResponseCache.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/LoginButton.java b/facebook/src/com/facebook/widget/LoginButton.java
index ea65d0a81..818f6f9b7 100644
--- a/facebook/src/com/facebook/widget/LoginButton.java
+++ b/facebook/src/com/facebook/widget/LoginButton.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -198,22 +198,20 @@ public LoginButton(Context context, AttributeSet attrs) {
         super(context, attrs);
 
         if (attrs.getStyleAttribute() == 0) {
-                // apparently there's no method of setting a default style in xml,
-                // so in case the users do not explicitly specify a style, we need
-                // to use sensible defaults.
-                this.setTextColor(getResources().getColor(R.color.com_facebook_loginview_text_color));
-                this.setTextSize(TypedValue.COMPLEX_UNIT_PX,
-                        getResources().getDimension(R.dimen.com_facebook_loginview_text_size));
-                this.setPadding(getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_left),
-                        getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_top),
-                        getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_right),
-                        getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_bottom));
-                this.setWidth(getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_width));
-                this.setHeight(getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_height));
-                this.setGravity(Gravity.CENTER);
-
-            parseAttributes(attrs);
-            if(isInEditMode()) {
+            // apparently there's no method of setting a default style in xml,
+            // so in case the users do not explicitly specify a style, we need
+            // to use sensible defaults.
+            this.setTextColor(getResources().getColor(R.color.com_facebook_loginview_text_color));
+            this.setTextSize(TypedValue.COMPLEX_UNIT_PX,
+                    getResources().getDimension(R.dimen.com_facebook_loginview_text_size));
+            this.setPadding(getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_left),
+                    getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_top),
+                    getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_right),
+                    getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_padding_bottom));
+            this.setWidth(getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_width));
+            this.setHeight(getResources().getDimensionPixelSize(R.dimen.com_facebook_loginview_height));
+            this.setGravity(Gravity.CENTER);
+            if (isInEditMode()) {
                 // cannot use a drawable in edit mode, so setting the background color instead
                 // of a background resource.
                 this.setBackgroundColor(getResources().getColor(R.color.com_facebook_blue));
@@ -221,9 +219,12 @@ public LoginButton(Context context, AttributeSet attrs) {
                 loginText = "Log in";
             } else {
                 this.setBackgroundResource(R.drawable.com_facebook_loginbutton_blue);
-                initializeActiveSessionWithCachedToken(context);
             }
         }
+        parseAttributes(attrs);
+        if (!isInEditMode()) {
+            initializeActiveSessionWithCachedToken(context);
+        }        
     }
 
     /**
diff --git a/facebook/src/com/facebook/widget/PickerFragment.java b/facebook/src/com/facebook/widget/PickerFragment.java
index bea02692f..c084cc0ad 100644
--- a/facebook/src/com/facebook/widget/PickerFragment.java
+++ b/facebook/src/com/facebook/widget/PickerFragment.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -847,10 +847,19 @@ public void onError(FacebookException error, GraphObjectPagingLoader<?> loader)
             this.adapter = adapter;
             // Tell the adapter about any data we might already have.
             this.adapter.changeCursor(loader.getCursor());
+            this.adapter.setOnErrorListener(new GraphObjectAdapter.OnErrorListener() {
+                @Override
+                public void onError(GraphObjectAdapter<?> adapter, FacebookException error) {
+                    if (onErrorListener != null) {
+                        onErrorListener.onError(PickerFragment.this, error);
+                    }
+                }
+            });
         }
 
         public void detach() {
             adapter.setDataNeededListener(null);
+            adapter.setOnErrorListener(null);
             loader.setOnErrorListener(null);
 
             loader = null;
diff --git a/facebook/src/com/facebook/widget/PlacePickerFragment.java b/facebook/src/com/facebook/widget/PlacePickerFragment.java
index b08208c7f..0ae78c0fa 100644
--- a/facebook/src/com/facebook/widget/PlacePickerFragment.java
+++ b/facebook/src/com/facebook/widget/PlacePickerFragment.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/ProfilePictureView.java b/facebook/src/com/facebook/widget/ProfilePictureView.java
index d599f5d7b..b6878588b 100644
--- a/facebook/src/com/facebook/widget/ProfilePictureView.java
+++ b/facebook/src/com/facebook/widget/ProfilePictureView.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/SimpleGraphObjectCursor.java b/facebook/src/com/facebook/widget/SimpleGraphObjectCursor.java
index 08c46b4ba..04c98ba6d 100644
--- a/facebook/src/com/facebook/widget/SimpleGraphObjectCursor.java
+++ b/facebook/src/com/facebook/widget/SimpleGraphObjectCursor.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/UrlRedirectCache.java b/facebook/src/com/facebook/widget/UrlRedirectCache.java
index 278e3e4e1..bd4598983 100644
--- a/facebook/src/com/facebook/widget/UrlRedirectCache.java
+++ b/facebook/src/com/facebook/widget/UrlRedirectCache.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/UserSettingsFragment.java b/facebook/src/com/facebook/widget/UserSettingsFragment.java
index 74d7aa5e9..3ba4359d9 100644
--- a/facebook/src/com/facebook/widget/UserSettingsFragment.java
+++ b/facebook/src/com/facebook/widget/UserSettingsFragment.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
diff --git a/facebook/src/com/facebook/widget/WebDialog.java b/facebook/src/com/facebook/widget/WebDialog.java
index 7aea576c7..d14f0568b 100644
--- a/facebook/src/com/facebook/widget/WebDialog.java
+++ b/facebook/src/com/facebook/widget/WebDialog.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -55,6 +55,7 @@
     private static final String USER_AGENT = "user_agent";
     static final String REDIRECT_URI = "fbconnect://success";
     static final String CANCEL_URI = "fbconnect://cancel";
+    static final boolean DISABLE_SSL_CHECK_FOR_TESTING = false;
 
     public static final int DEFAULT_THEME = android.R.style.Theme_Translucent_NoTitleBar;
 
@@ -342,11 +343,15 @@ public void onReceivedError(WebView view, int errorCode,
 
         @Override
         public void onReceivedSslError(WebView view, SslErrorHandler handler, SslError error) {
-            super.onReceivedSslError(view, handler, error);
+            if (DISABLE_SSL_CHECK_FOR_TESTING) {
+                handler.proceed();
+            } else {
+                super.onReceivedSslError(view, handler, error);
 
-            sendErrorToListener(new FacebookDialogException(null, ERROR_FAILED_SSL_HANDSHAKE, null));
-            handler.cancel();
-            WebDialog.this.dismiss();
+                sendErrorToListener(new FacebookDialogException(null, ERROR_FAILED_SSL_HANDSHAKE, null));
+                handler.cancel();
+                WebDialog.this.dismiss();
+            }
         }
 
         @Override
@@ -375,9 +380,6 @@ public void onPageFinished(WebView view, String url) {
     }
 
     private static class BuilderBase<CONCRETE extends BuilderBase<?>> {
-        private static final String APP_ID_PARAM = "app_id";
-        public static final String ACCESS_TOKEN = "access_token";
-
         private Context context;
         private Session session;
         private String applicationId;
@@ -437,10 +439,10 @@ public CONCRETE setOnCompleteListener(OnCompleteListener listener) {
          */
         public WebDialog build() {
             if (session != null && session.isOpened()) {
-                parameters.putString(APP_ID_PARAM, session.getApplicationId());
-                parameters.putString(ACCESS_TOKEN, session.getAccessToken());
+                parameters.putString(ServerProtocol.DIALOG_PARAM_APP_ID, session.getApplicationId());
+                parameters.putString(ServerProtocol.DIALOG_PARAM_ACCESS_TOKEN, session.getAccessToken());
             } else {
-                parameters.putString(APP_ID_PARAM, applicationId);
+                parameters.putString(ServerProtocol.DIALOG_PARAM_APP_ID, applicationId);
             }
 
             if (!parameters.containsKey(ServerProtocol.DIALOG_PARAM_REDIRECT_URI)) {
diff --git a/facebook/src/com/facebook/widget/WorkQueue.java b/facebook/src/com/facebook/widget/WorkQueue.java
index adcee1d71..d5e8a4640 100644
--- a/facebook/src/com/facebook/widget/WorkQueue.java
+++ b/facebook/src/com/facebook/widget/WorkQueue.java
@@ -1,5 +1,5 @@
 /**
- * Copyright 2012 Facebook
+ * Copyright 2010-present Facebook.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
