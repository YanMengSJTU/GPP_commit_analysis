diff --git a/facebook/TestApp/build.gradle b/facebook/TestApp/build.gradle
index b76fed903..88bdbbed3 100644
--- a/facebook/TestApp/build.gradle
+++ b/facebook/TestApp/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.library'
 
 dependencies {
     compile project(':facebook')
diff --git a/facebook/TestApp/res/drawable-hdpi/ic_launcher.png b/facebook/TestApp/res/drawable-hdpi/ic_launcher.png
index 8074c4c57..9005e98b5 100644
Binary files a/facebook/TestApp/res/drawable-hdpi/ic_launcher.png and b/facebook/TestApp/res/drawable-hdpi/ic_launcher.png differ
diff --git a/facebook/TestApp/res/drawable-ldpi/ic_launcher.png b/facebook/TestApp/res/drawable-ldpi/ic_launcher.png
index 1095584ec..13fd7e396 100644
Binary files a/facebook/TestApp/res/drawable-ldpi/ic_launcher.png and b/facebook/TestApp/res/drawable-ldpi/ic_launcher.png differ
diff --git a/facebook/TestApp/res/drawable-mdpi/ic_launcher.png b/facebook/TestApp/res/drawable-mdpi/ic_launcher.png
index a07c69fa5..6a65afa2b 100644
Binary files a/facebook/TestApp/res/drawable-mdpi/ic_launcher.png and b/facebook/TestApp/res/drawable-mdpi/ic_launcher.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png b/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png
index cf60eb0ac..aa002f0a0 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png b/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png
index ece0c4c94..4c114b48d 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png
index a123c2555..9c936b60c 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png b/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png
index 2e6f66dbc..c655580f0 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_grey_focused.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png b/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png
index 6098f0b0e..efe802fd9 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_grey_normal.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png b/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png
index 23b9757d1..38acc4799 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png and b/facebook/res/drawable-hdpi/com_facebook_button_grey_pressed.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_background.png b/facebook/res/drawable-hdpi/com_facebook_button_like_background.png
index 32814c82a..9486c01a7 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_background.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png b/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png
index b2c580e2a..e128c1b99 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png b/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png
index 1dc9f6d24..c0d4688e5 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png b/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png
index 722362ae8..5e8ac3c99 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable-hdpi/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_close.png b/facebook/res/drawable-hdpi/com_facebook_close.png
index d925cb7b2..d81f040d7 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_close.png and b/facebook/res/drawable-hdpi/com_facebook_close.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png b/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png
index a7289c112..ecc6962aa 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png and b/facebook/res/drawable-hdpi/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_logo.png b/facebook/res/drawable-hdpi/com_facebook_logo.png
index 26ab7945f..161bef08b 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_logo.png and b/facebook/res/drawable-hdpi/com_facebook_logo.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png b/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png
index d6ec37d04..0dcd013d6 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png and b/facebook/res/drawable-hdpi/com_facebook_picker_magnifier.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png
index 4707ba20c..2c5b1bbad 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_background.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png
index 83bf9694b..972010ec2 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_bottomnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png
index 0d8fb82b6..5d595c5a3 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_topnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png
index 5bebe5e35..e2903b6de 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_black_xout.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png
index 0f8c5dffc..a42b3cd92 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_background.9.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png
index 21145bca6..2d292f2ca 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_bottomnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png
index 8b534773d..b2dcc4089 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_topnub.png differ
diff --git a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png
index 9f341075c..1285a1665 100644
Binary files a/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png and b/facebook/res/drawable-hdpi/com_facebook_tooltip_blue_xout.png differ
diff --git a/facebook/res/drawable-ldpi/com_facebook_close.png b/facebook/res/drawable-ldpi/com_facebook_close.png
index fe4be250e..5f8bc5905 100644
Binary files a/facebook/res/drawable-ldpi/com_facebook_close.png and b/facebook/res/drawable-ldpi/com_facebook_close.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png b/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png
index cfb7a015c..86bd87740 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable-mdpi/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png b/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png
index 1e9390133..74e5ce199 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable-mdpi/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png
index d8427fdef..8fd28f704 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable-mdpi/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png b/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png
index a806a2f5d..b4afa5443 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png and b/facebook/res/drawable-mdpi/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png b/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png
index c5170c18b..3013a5519 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png and b/facebook/res/drawable-mdpi/com_facebook_picker_magnifier.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png
index 59f263982..d10e30391 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_background.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png
index 4c97bf923..9378512ce 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_bottomnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png
index 7fdf08201..d94fa9688 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_topnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png
index 21ad6a54e..51454e5a3 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_black_xout.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png
index bd54278da..bf60245bb 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_background.9.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png
index 299afc24e..e0ac8fea8 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_bottomnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png
index cb29b55f3..e09406081 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_topnub.png differ
diff --git a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png
index 73695f03b..85699f8ec 100644
Binary files a/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png and b/facebook/res/drawable-mdpi/com_facebook_tooltip_blue_xout.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png
index 5a47068d7..0524c9325 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png
index 1449c8a13..f5d0e58b5 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png
index 28bd184ed..3d1c11075 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png
index bfd883f92..e5b15f9c5 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_grey_focused.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png
index aa9895432..02f28bdd5 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_grey_normal.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png b/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png
index 92f2ad12a..40e6b04e3 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png and b/facebook/res/drawable-xhdpi/com_facebook_button_grey_pressed.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png
index 3c25c433e..37bb852d2 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png
index accfdfc6e..954b3f7d1 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png
index db8fcad20..c4d7016b4 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png
index 96e9a308b..ccb98d5e3 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable-xhdpi/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_close.png b/facebook/res/drawable-xhdpi/com_facebook_close.png
index e3aff5ae5..b603ef892 100755
Binary files a/facebook/res/drawable-xhdpi/com_facebook_close.png and b/facebook/res/drawable-xhdpi/com_facebook_close.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png b/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png
index 4192c4887..4b35eb436 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png and b/facebook/res/drawable-xhdpi/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_logo.png b/facebook/res/drawable-xhdpi/com_facebook_logo.png
index 24d7fc56b..401d7bfec 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_logo.png and b/facebook/res/drawable-xhdpi/com_facebook_logo.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png b/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png
index a5b372468..a5eb056a1 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png and b/facebook/res/drawable-xhdpi/com_facebook_picker_magnifier.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png
index d6f89a731..43b14c999 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_background.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png
index 71abe544b..87f9795bc 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_bottomnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png
index 2ac32dbc2..4d3f58f6e 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_topnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png
index e3d562b60..6cd7bc8d9 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_black_xout.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png
index a1978044c..7614b95c3 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_background.9.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png
index cee80f129..d29b95242 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_bottomnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png
index 2ec445e5d..d2dc678ee 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_topnub.png differ
diff --git a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png
index 7fd57632d..e9bc616f1 100644
Binary files a/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png and b/facebook/res/drawable-xhdpi/com_facebook_tooltip_blue_xout.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png
index bead08dc5..02d902cfe 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png
index 85e4e873c..cb76c177a 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png
index 1d67cab7b..88d2169da 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png
index 45319d90b..41137fc92 100644
Binary files a/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable-xxhdpi/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable/com_facebook_button_blue_focused.9.png b/facebook/res/drawable/com_facebook_button_blue_focused.9.png
index cfb7a015c..86bd87740 100644
Binary files a/facebook/res/drawable/com_facebook_button_blue_focused.9.png and b/facebook/res/drawable/com_facebook_button_blue_focused.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_blue_normal.9.png b/facebook/res/drawable/com_facebook_button_blue_normal.9.png
index 1e9390133..74e5ce199 100644
Binary files a/facebook/res/drawable/com_facebook_button_blue_normal.9.png and b/facebook/res/drawable/com_facebook_button_blue_normal.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_blue_pressed.9.png b/facebook/res/drawable/com_facebook_button_blue_pressed.9.png
index d8427fdef..8fd28f704 100644
Binary files a/facebook/res/drawable/com_facebook_button_blue_pressed.9.png and b/facebook/res/drawable/com_facebook_button_blue_pressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_check_off.png b/facebook/res/drawable/com_facebook_button_check_off.png
index e9737df5c..c25695d53 100644
Binary files a/facebook/res/drawable/com_facebook_button_check_off.png and b/facebook/res/drawable/com_facebook_button_check_off.png differ
diff --git a/facebook/res/drawable/com_facebook_button_grey_focused.9.png b/facebook/res/drawable/com_facebook_button_grey_focused.9.png
index 56f603571..becfe54fd 100644
Binary files a/facebook/res/drawable/com_facebook_button_grey_focused.9.png and b/facebook/res/drawable/com_facebook_button_grey_focused.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_grey_normal.9.png b/facebook/res/drawable/com_facebook_button_grey_normal.9.png
index dff3b7d73..f0a07f85c 100644
Binary files a/facebook/res/drawable/com_facebook_button_grey_normal.9.png and b/facebook/res/drawable/com_facebook_button_grey_normal.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_grey_pressed.9.png b/facebook/res/drawable/com_facebook_button_grey_pressed.9.png
index 46648efcd..d1c966313 100644
Binary files a/facebook/res/drawable/com_facebook_button_grey_pressed.9.png and b/facebook/res/drawable/com_facebook_button_grey_pressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_background.png b/facebook/res/drawable/com_facebook_button_like_background.png
index e7723b5a0..899da5272 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_background.png and b/facebook/res/drawable/com_facebook_button_like_background.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_background_selected.png b/facebook/res/drawable/com_facebook_button_like_background_selected.png
index 68c70bcee..798364730 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_background_selected.png and b/facebook/res/drawable/com_facebook_button_like_background_selected.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_icon.png b/facebook/res/drawable/com_facebook_button_like_icon.png
index 30a955592..51d72dd32 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_icon.png and b/facebook/res/drawable/com_facebook_button_like_icon.png differ
diff --git a/facebook/res/drawable/com_facebook_button_like_icon_selected.png b/facebook/res/drawable/com_facebook_button_like_icon_selected.png
index ead35ca29..9834a4c14 100644
Binary files a/facebook/res/drawable/com_facebook_button_like_icon_selected.png and b/facebook/res/drawable/com_facebook_button_like_icon_selected.png differ
diff --git a/facebook/res/drawable/com_facebook_close.png b/facebook/res/drawable/com_facebook_close.png
index ad0147460..4ffc94cdc 100755
Binary files a/facebook/res/drawable/com_facebook_close.png and b/facebook/res/drawable/com_facebook_close.png differ
diff --git a/facebook/res/drawable/com_facebook_inverse_icon.png b/facebook/res/drawable/com_facebook_inverse_icon.png
index a806a2f5d..b4afa5443 100644
Binary files a/facebook/res/drawable/com_facebook_inverse_icon.png and b/facebook/res/drawable/com_facebook_inverse_icon.png differ
diff --git a/facebook/res/drawable/com_facebook_list_divider.9.png b/facebook/res/drawable/com_facebook_list_divider.9.png
index 7d4c46c47..4c0df0768 100644
Binary files a/facebook/res/drawable/com_facebook_list_divider.9.png and b/facebook/res/drawable/com_facebook_list_divider.9.png differ
diff --git a/facebook/res/drawable/com_facebook_list_section_header_background.9.png b/facebook/res/drawable/com_facebook_list_section_header_background.9.png
index 1763c4a64..0ee16ffb6 100644
Binary files a/facebook/res/drawable/com_facebook_list_section_header_background.9.png and b/facebook/res/drawable/com_facebook_list_section_header_background.9.png differ
diff --git a/facebook/res/drawable/com_facebook_logo.png b/facebook/res/drawable/com_facebook_logo.png
index 785acf9ea..8e6a514a6 100644
Binary files a/facebook/res/drawable/com_facebook_logo.png and b/facebook/res/drawable/com_facebook_logo.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_focused.9.png b/facebook/res/drawable/com_facebook_picker_list_focused.9.png
index 7c0599e3a..3efadc352 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_focused.9.png and b/facebook/res/drawable/com_facebook_picker_list_focused.9.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png b/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png
index 3bf8e0362..5fcd5b207 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png and b/facebook/res/drawable/com_facebook_picker_list_longpressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_pressed.9.png b/facebook/res/drawable/com_facebook_picker_list_pressed.9.png
index 6e77525d2..0e557469e 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_pressed.9.png and b/facebook/res/drawable/com_facebook_picker_list_pressed.9.png differ
diff --git a/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png b/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png
index 42cb6463e..10851f6c8 100644
Binary files a/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png and b/facebook/res/drawable/com_facebook_picker_list_selector_disabled.9.png differ
diff --git a/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png b/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png
index 107d7f89e..27a6f7a74 100644
Binary files a/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png and b/facebook/res/drawable/com_facebook_profile_picture_blank_portrait.png differ
diff --git a/facebook/res/drawable/com_facebook_profile_picture_blank_square.png b/facebook/res/drawable/com_facebook_profile_picture_blank_square.png
index 8b4a76a0e..77554e01f 100644
Binary files a/facebook/res/drawable/com_facebook_profile_picture_blank_square.png and b/facebook/res/drawable/com_facebook_profile_picture_blank_square.png differ
diff --git a/facebook/res/values-es/strings.xml b/facebook/res/values-es/strings.xml
index 556a7a4f9..7f1558718 100644
--- a/facebook/res/values-es/strings.xml
+++ b/facebook/res/values-es/strings.xml
@@ -41,4 +41,5 @@
     <string name="com_facebook_requesterror_password_changed">Su contraseña de Facebook ha cambiado, por favor vuelva a conectar la aplicación con Facebook.</string>
     <string name="com_facebook_requesterror_reconnect">Se produjo un error al conectar con Facebook, por favor vuelva a conectar la aplicación con Facebook.</string>
     <string name="com_facebook_requesterror_permissions">Una conexión de aplicación con Facebook falló debido a permisos insuficientes, por favor, conceda los permisos de aplicaciones para realizar la operación.</string>
+    <string name="com_facebook_image_download_unknown_error">Error al descargar la imagen.</string>
 </resources>
diff --git a/facebook/res/values-he/strings.xml b/facebook/res/values-he/strings.xml
index 4ab34a3e2..48f29e328 100644
--- a/facebook/res/values-he/strings.xml
+++ b/facebook/res/values-he/strings.xml
@@ -41,4 +41,5 @@
     <string name="com_facebook_requesterror_reconnect">.ארעה שגיאה בעת החיבור עם פייסבוק, חבר בבקשה מחדש את האפליקציה עם פייסבוק</string>
     <string name="com_facebook_requesterror_permissions">.חיבור האפליקציה עם פייסבוק נכשל בשל הרשאות לא מספקות, אנא הענק הרשאות לאפליקציה בכדי שהפעולה תוכל להתבצע</string>
     <string name="com_facebook_dialogloginactivity_ok_button">אישור</string>
+    <string name="com_facebook_image_download_unknown_error">שגיאה בעת הורדת תמונה</string>
 </resources>
diff --git a/facebook/res/values-iw/strings.xml b/facebook/res/values-iw/strings.xml
index 4ab34a3e2..48f29e328 100644
--- a/facebook/res/values-iw/strings.xml
+++ b/facebook/res/values-iw/strings.xml
@@ -41,4 +41,5 @@
     <string name="com_facebook_requesterror_reconnect">.ארעה שגיאה בעת החיבור עם פייסבוק, חבר בבקשה מחדש את האפליקציה עם פייסבוק</string>
     <string name="com_facebook_requesterror_permissions">.חיבור האפליקציה עם פייסבוק נכשל בשל הרשאות לא מספקות, אנא הענק הרשאות לאפליקציה בכדי שהפעולה תוכל להתבצע</string>
     <string name="com_facebook_dialogloginactivity_ok_button">אישור</string>
+    <string name="com_facebook_image_download_unknown_error">שגיאה בעת הורדת תמונה</string>
 </resources>
diff --git a/facebook/res/values/strings.xml b/facebook/res/values/strings.xml
index ee6445ebf..efa3b79b4 100644
--- a/facebook/res/values/strings.xml
+++ b/facebook/res/values/strings.xml
@@ -44,4 +44,5 @@
     <string name="com_facebook_requesterror_reconnect">Please log into this app again to reconnect your Facebook account.</string>
     <string name="com_facebook_requesterror_permissions">This app doesn’t have permission to do this. To change permissions, try logging into the app again.</string>
     <string name="com_facebook_tooltip_default">New! You\'re in control - choose what info you want to share with apps.</string>
+    <string name="com_facebook_image_download_unknown_error">Unexpected error while downloading an image.</string>
 </resources>
diff --git a/facebook/src/com/facebook/AuthorizationClient.java b/facebook/src/com/facebook/AuthorizationClient.java
index 00a0c0726..3e8e56222 100644
--- a/facebook/src/com/facebook/AuthorizationClient.java
+++ b/facebook/src/com/facebook/AuthorizationClient.java
@@ -175,7 +175,7 @@ void cancelCurrentHandler() {
     }
 
     boolean onActivityResult(int requestCode, int resultCode, Intent data) {
-        if (requestCode == pendingRequest.getRequestCode()) {
+        if (pendingRequest != null && requestCode == pendingRequest.getRequestCode()) {
             return currentHandler.onActivityResult(requestCode, resultCode, data);
         }
         return false;
@@ -582,6 +582,9 @@ boolean needsInternetPermission() {
         @Override
         void cancel() {
             if (loginDialog != null) {
+                // Since we are calling dismiss explicitly, we need to remove the completion listener to prevent
+                // responding to the upcoming "Cancel" result.
+                loginDialog.setOnCompleteListener(null);
                 loginDialog.dismiss();
                 loginDialog = null;
             }
@@ -678,14 +681,12 @@ void onWebDialogComplete(AuthorizationRequest request, Bundle values,
 
         private void saveCookieToken(String token) {
             Context context = getStartActivityDelegate().getActivityContext();
-            SharedPreferences sharedPreferences = context.getSharedPreferences(
+            context.getSharedPreferences(
                     WEB_VIEW_AUTH_HANDLER_STORE,
-                    Context.MODE_PRIVATE);
-            SharedPreferences.Editor editor = sharedPreferences.edit();
-            editor.putString(WEB_VIEW_AUTH_HANDLER_TOKEN_KEY, token);
-            if (!editor.commit()) {
-                Utility.logd(TAG, "Could not update saved web view auth handler token.");
-            }
+                    Context.MODE_PRIVATE)
+                .edit()
+                .putString(WEB_VIEW_AUTH_HANDLER_TOKEN_KEY, token)
+                .apply();
         }
 
         private String loadCookieToken() {
diff --git a/facebook/src/com/facebook/FacebookSdkVersion.java b/facebook/src/com/facebook/FacebookSdkVersion.java
index f91b92eba..82398e7a7 100644
--- a/facebook/src/com/facebook/FacebookSdkVersion.java
+++ b/facebook/src/com/facebook/FacebookSdkVersion.java
@@ -17,5 +17,5 @@
 package com.facebook;
 
 final class FacebookSdkVersion {
-    public static final String BUILD = "3.19.0";
+    public static final String BUILD = "3.21.1";
 }
diff --git a/facebook/src/com/facebook/NativeAppCallAttachmentStore.java b/facebook/src/com/facebook/NativeAppCallAttachmentStore.java
index 3704be274..aa7f39ed7 100644
--- a/facebook/src/com/facebook/NativeAppCallAttachmentStore.java
+++ b/facebook/src/com/facebook/NativeAppCallAttachmentStore.java
@@ -76,22 +76,22 @@ public void processAttachment(Bitmap attachment, File outputFile) throws IOExcep
     }
 
     /**
-     * Adds a number of bitmap attachment files associated with a native app call. The attachments will be
+     * Adds a number of bitmap/video attachment files associated with a native app call. The attachments will be
      * served via {@link NativeAppCallContentProvider#openFile(android.net.Uri, String) openFile}.
      *
      * @param context the Context the call is being made from
      * @param callId the unique ID of the call
-     * @param imageAttachments a Map of attachment names to Files containing the bitmaps; the attachment names will be
-     *                         part of the URI processed by openFile
+     * @param mediaAttachmentFiles a Map of attachment names to Files containing the bitmaps/videos; the attachment
+     *                             names will be part of the URI processed by openFile
      * @throws java.io.IOException
      */
-    public void addAttachmentFilesForCall(Context context, UUID callId, Map<String, File> imageAttachmentFiles) {
+    public void addAttachmentFilesForCall(Context context, UUID callId, Map<String, File> mediaAttachmentFiles) {
         Validate.notNull(context, "context");
         Validate.notNull(callId, "callId");
-        Validate.containsNoNulls(imageAttachmentFiles.values(), "imageAttachmentFiles");
-        Validate.containsNoNullOrEmpty(imageAttachmentFiles.keySet(), "imageAttachmentFiles");
+        Validate.containsNoNulls(mediaAttachmentFiles.values(), "mediaAttachmentFiles");
+        Validate.containsNoNullOrEmpty(mediaAttachmentFiles.keySet(), "mediaAttachmentFiles");
 
-        addAttachments(context, callId, imageAttachmentFiles, new ProcessAttachment<File>() {
+        addAttachments(context, callId, mediaAttachmentFiles, new ProcessAttachment<File>() {
             @Override
             public void processAttachment(File attachment, File outputFile) throws IOException {
                 FileOutputStream outputStream = new FileOutputStream(outputFile);
diff --git a/facebook/src/com/facebook/RequestAsyncTask.java b/facebook/src/com/facebook/RequestAsyncTask.java
index db60a18f9..62a2cf158 100644
--- a/facebook/src/com/facebook/RequestAsyncTask.java
+++ b/facebook/src/com/facebook/RequestAsyncTask.java
@@ -32,7 +32,6 @@
  * Defines an AsyncTask suitable for executing a Request in the background. May be subclassed
  * by applications having unique threading model needs.
  */
-@TargetApi(3)
 public class RequestAsyncTask extends AsyncTask<Void, Void, List<Response>> {
     private static final String TAG = RequestAsyncTask.class.getCanonicalName();
     private static Method executeOnExecutorMethod;
@@ -172,18 +171,18 @@ protected void onPostExecute(List<Response> result) {
     }
 
     RequestAsyncTask executeOnSettingsExecutor() {
-        try {
-            if (executeOnExecutorMethod != null) {
+        if (executeOnExecutorMethod != null) {
+            try {
                 executeOnExecutorMethod.invoke(this, Settings.getExecutor(), null);
-                return this;
+            } catch (InvocationTargetException e) {
+                // fall-through
+            } catch (IllegalAccessException e) {
+                // fall-through
             }
-        } catch (InvocationTargetException e) {
-            // fall-through
-        } catch (IllegalAccessException e) {
-            // fall-through
+        } else {
+          this.execute();
         }
 
-        this.execute();
         return this;
     }
 }
diff --git a/facebook/src/com/facebook/Session.java b/facebook/src/com/facebook/Session.java
index 4fe231168..6711b8837 100644
--- a/facebook/src/com/facebook/Session.java
+++ b/facebook/src/com/facebook/Session.java
@@ -1672,9 +1672,13 @@ public void onServiceConnected(ComponentName className, IBinder service) {
         public void onServiceDisconnected(ComponentName arg) {
             cleanup();
 
-            // We returned an error so there's no point in
-            // keeping the binding open.
-            staticContext.unbindService(TokenRefreshRequest.this);
+            try {
+                // We returned an error so there's no point in
+                // keeping the binding open.
+                staticContext.unbindService(TokenRefreshRequest.this);
+            } catch (IllegalArgumentException ex) {
+                // Do nothing, the connection was already unbound
+            }
         }
 
         private void cleanup() {
diff --git a/facebook/src/com/facebook/Settings.java b/facebook/src/com/facebook/Settings.java
index 7a2d943c5..2961576b2 100644
--- a/facebook/src/com/facebook/Settings.java
+++ b/facebook/src/com/facebook/Settings.java
@@ -430,7 +430,7 @@ static Response publishInstallAndWaitForResponse(
                     publishResponse.getGraphObject().getInnerJSONObject() != null) {
                     editor.putString(jsonKey, publishResponse.getGraphObject().getInnerJSONObject().toString());
                 }
-                editor.commit();
+                editor.apply();
 
                 return publishResponse;
             }
@@ -446,18 +446,22 @@ static Response publishInstallAndWaitForResponse(
      * @return returns null if the facebook app is not present on the phone.
      */
     public static String getAttributionId(ContentResolver contentResolver) {
+        Cursor c = null;
         try {
             String [] projection = {ATTRIBUTION_ID_COLUMN_NAME};
-            Cursor c = contentResolver.query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
+            c = contentResolver.query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
             if (c == null || !c.moveToFirst()) {
                 return null;
             }
             String attributionId = c.getString(c.getColumnIndex(ATTRIBUTION_ID_COLUMN_NAME));
-            c.close();
             return attributionId;
         } catch (Exception e) {
             Log.d(TAG, "Caught unexpected exception in getAttributionId(): " + e.toString());
             return null;
+        } finally {
+            if (c != null) {
+                c.close();
+            }
         }
     }
 
@@ -510,10 +514,10 @@ public static boolean getLimitEventAndDataUsage(Context context) {
      * @param context   Used to persist this value across app runs.
      */
     public static void setLimitEventAndDataUsage(Context context, boolean limitEventUsage) {
-        SharedPreferences preferences = context.getSharedPreferences(APP_EVENT_PREFERENCES, Context.MODE_PRIVATE);
-        SharedPreferences.Editor editor = preferences.edit();
-        editor.putBoolean("limitEventUsage", limitEventUsage);
-        editor.commit();
+        context.getSharedPreferences(APP_EVENT_PREFERENCES, Context.MODE_PRIVATE)
+            .edit()
+            .putBoolean("limitEventUsage", limitEventUsage)
+            .apply();
     }
 
     /**
diff --git a/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java b/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
index 0286d3c1f..10eca8b80 100644
--- a/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
+++ b/facebook/src/com/facebook/SharedPreferencesTokenCachingStrategy.java
@@ -163,18 +163,14 @@ public void save(Bundle bundle) {
                 return;
             }
         }
-
-        boolean successfulCommit = editor.commit();
-        if (!successfulCommit) {
-            Logger.log(LoggingBehavior.CACHE, Log.WARN, TAG, "SharedPreferences.Editor.commit() was not successful");
-        }
+        editor.apply();
     }
 
     /**
      * Clears out all token information stored in this cache.
      */
     public void clear() {
-        cache.edit().clear().commit();
+        cache.edit().clear().apply();
     }
 
     private void serializeKey(String key, Bundle bundle, SharedPreferences.Editor editor)
diff --git a/facebook/src/com/facebook/android/Facebook.java b/facebook/src/com/facebook/android/Facebook.java
index 4680f364d..0c9c0aa51 100644
--- a/facebook/src/com/facebook/android/Facebook.java
+++ b/facebook/src/com/facebook/android/Facebook.java
@@ -531,9 +531,13 @@ public void onServiceConnected(ComponentName className, IBinder service) {
         @Override
         public void onServiceDisconnected(ComponentName arg) {
             serviceListener.onError(new Error("Service disconnected"));
-            // We returned an error so there's no point in
-            // keeping the binding open.
-            applicationsContext.unbindService(TokenRefreshServiceConnection.this);
+            try {
+                // We returned an error so there's no point in
+                // keeping the binding open.
+                applicationsContext.unbindService(TokenRefreshServiceConnection.this);
+            } catch (IllegalArgumentException ex) {
+                // Do nothing, the connection was already unbound
+            }
         }
 
         private void refreshToken() {
diff --git a/facebook/src/com/facebook/internal/AnalyticsEvents.java b/facebook/src/com/facebook/internal/AnalyticsEvents.java
index a7b8038ee..9488e0c8d 100644
--- a/facebook/src/com/facebook/internal/AnalyticsEvents.java
+++ b/facebook/src/com/facebook/internal/AnalyticsEvents.java
@@ -37,6 +37,7 @@
     public static final String EVENT_NATIVE_DIALOG_TYPE_OG_MESSAGE      = "fb_dialogs_present_message_og";
     public static final String EVENT_NATIVE_DIALOG_TYPE_PHOTO_SHARE     = "fb_dialogs_present_share_photo";
     public static final String EVENT_NATIVE_DIALOG_TYPE_PHOTO_MESSAGE   = "fb_dialogs_present_message_photo";
+    public static final String EVENT_NATIVE_DIALOG_TYPE_VIDEO_SHARE     = "fb_dialogs_present_share_video";
     public static final String EVENT_NATIVE_DIALOG_TYPE_LIKE            = "fb_dialogs_present_like";
 
     public static final String EVENT_LIKE_VIEW_CANNOT_PRESENT_DIALOG    = "fb_like_control_cannot_present_dialog";
diff --git a/facebook/src/com/facebook/internal/AttributionIdentifiers.java b/facebook/src/com/facebook/internal/AttributionIdentifiers.java
index 4efe7a3e6..b00c4e6f8 100644
--- a/facebook/src/com/facebook/internal/AttributionIdentifiers.java
+++ b/facebook/src/com/facebook/internal/AttributionIdentifiers.java
@@ -108,12 +108,12 @@ public static AttributionIdentifiers getAttributionIdentifiers(Context context)
         }
 
         AttributionIdentifiers identifiers = getAndroidId(context);
-
+        Cursor c = null;
         try {
             String [] projection = {ATTRIBUTION_ID_COLUMN_NAME, ANDROID_ID_COLUMN_NAME, LIMIT_TRACKING_COLUMN_NAME};
-            Cursor c = context.getContentResolver().query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
+            c = context.getContentResolver().query(ATTRIBUTION_ID_CONTENT_URI, projection, null, null, null);
             if (c == null || !c.moveToFirst()) {
-                return null;
+                return identifiers;
             }
             int attributionColumnIndex = c.getColumnIndex(ATTRIBUTION_ID_COLUMN_NAME);
             int androidIdColumnIndex = c.getColumnIndex(ANDROID_ID_COLUMN_NAME);
@@ -127,10 +127,13 @@ public static AttributionIdentifiers getAttributionIdentifiers(Context context)
                 identifiers.androidAdvertiserId = c.getString(androidIdColumnIndex);
                 identifiers.limitTracking = Boolean.parseBoolean(c.getString(limitTrackingColumnIndex));
             }
-            c.close();
         } catch (Exception e) {
             Log.d(TAG, "Caught unexpected exception in getAttributionId(): " + e.toString());
             return null;
+        } finally {
+            if (c != null) {
+                c.close();
+            }
         }
 
         identifiers.fetchTime = System.currentTimeMillis();
@@ -149,4 +152,4 @@ public String getAndroidAdvertiserId() {
     public boolean isTrackingLimited() {
         return limitTracking;
     }
-}
\ No newline at end of file
+}
diff --git a/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java b/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java
index 5333187dc..a042c918e 100644
--- a/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java
+++ b/facebook/src/com/facebook/internal/FacebookWebFallbackDialog.java
@@ -20,15 +20,15 @@
 import android.content.Intent;
 import android.net.Uri;
 import android.os.Bundle;
+import android.os.Handler;
+import android.os.Looper;
+import android.webkit.WebView;
 import com.facebook.FacebookException;
-import com.facebook.android.Util;
 import com.facebook.widget.FacebookDialog;
 import com.facebook.widget.WebDialog;
 import org.json.JSONException;
 import org.json.JSONObject;
 
-import java.util.EnumSet;
-
 /**
  * com.facebook.internal is solely for the use of other packages within the Facebook SDK for Android. Use of
  * any of the classes in this package is unsupported, and they may be modified or removed without warning at
@@ -39,6 +39,9 @@
  */
 public class FacebookWebFallbackDialog extends WebDialog {
     private static final String TAG = FacebookWebFallbackDialog.class.getName();
+    private static final int OS_BACK_BUTTON_RESPONSE_TIMEOUT_MILLISECONDS = 1500;
+
+    private boolean waitingForDialogToClose;
 
     public static boolean presentWebFallback(final Context context,
                                              String dialogUrl,
@@ -121,4 +124,48 @@ protected Bundle parseResponseUri(String url) {
 
         return queryParams;
     }
+
+    @Override
+    public void dismiss() {
+        WebView webView = getWebView();
+
+        if (isListenerCalled() || webView == null || !webView.isShown()) {
+            // If the listener has been called, or if the WebView isn't visible, we cannot give the dialog a chance
+            // to respond. So defer to the parent implementation.
+            super.dismiss();
+            return;
+        }
+
+        // If we have already notified the dialog to close, then ignore this request to dismiss. The timer will
+        // honor the request.
+        if (waitingForDialogToClose) {
+            return;
+        }
+        waitingForDialogToClose = true;
+
+        // Now fire off the event that will tell the dialog to wind down.
+        String eventJS =
+                "(function() {" +
+                "  var event = document.createEvent('Event');" +
+                "  event.initEvent('fbPlatformDialogMustClose',true,true);" +
+                "  document.dispatchEvent(event);" +
+                "})();";
+        webView.loadUrl("javascript:" + eventJS);
+
+        // Set up a timeout for the dialog to respond. If the timer expires, we need to honor the user's desire to
+        // dismiss the dialog.
+        Handler handler = new Handler(Looper.getMainLooper());
+        handler.postDelayed(
+                new Runnable() {
+                    @Override
+                    public void run() {
+                        if (!isListenerCalled()) {
+                            // If we get here, then the dialog did not close quickly enough. So we need to honor the user's
+                            // wish to cancel.
+                            sendCancelToListener();
+                        }
+                    }
+                },
+                OS_BACK_BUTTON_RESPONSE_TIMEOUT_MILLISECONDS);
+    }
 }
diff --git a/facebook/src/com/facebook/internal/ImageDownloader.java b/facebook/src/com/facebook/internal/ImageDownloader.java
index 69bea7f4a..058c55bc8 100644
--- a/facebook/src/com/facebook/internal/ImageDownloader.java
+++ b/facebook/src/com/facebook/internal/ImageDownloader.java
@@ -22,6 +22,7 @@
 import android.os.Handler;
 import android.os.Looper;
 import com.facebook.FacebookException;
+import com.facebook.android.R;
 
 import java.io.IOException;
 import java.io.InputStream;
@@ -246,15 +247,19 @@ private static void download(RequestKey key, Context context) {
 
                 default:
                     stream = connection.getErrorStream();
-                    InputStreamReader reader = new InputStreamReader(stream);
-                    char[] buffer = new char[128];
-                    int bufferLength;
                     StringBuilder errorMessageBuilder = new StringBuilder();
-                    while ((bufferLength = reader.read(buffer, 0, buffer.length)) > 0) {
-                        errorMessageBuilder.append(buffer, 0, bufferLength);
+                    if (stream != null) {
+                        InputStreamReader reader = new InputStreamReader(stream);
+                        char[] buffer = new char[128];
+                        int bufferLength;
+                        while ((bufferLength = reader.read(buffer, 0, buffer.length)) > 0) {
+                            errorMessageBuilder.append(buffer, 0, bufferLength);
+                        }
+                        Utility.closeQuietly(reader);
+                    } else {
+                        errorMessageBuilder.append(
+                            context.getString(R.string.com_facebook_image_download_unknown_error));
                     }
-                    Utility.closeQuietly(reader);
-
                     error = new FacebookException(errorMessageBuilder.toString());
                     break;
             }
diff --git a/facebook/src/com/facebook/internal/LikeActionController.java b/facebook/src/com/facebook/internal/LikeActionController.java
index d16af520d..70e9fecfc 100644
--- a/facebook/src/com/facebook/internal/LikeActionController.java
+++ b/facebook/src/com/facebook/internal/LikeActionController.java
@@ -683,15 +683,31 @@ private boolean onActivityResult(int requestCode, int resultCode, Intent data, U
         return new FacebookDialog.Callback() {
             @Override
             public void onComplete(FacebookDialog.PendingCall pendingCall, Bundle data) {
-                if (!data.containsKey(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY)) {
-                    // This is an empty result that we can't handle. Don't lose like state.
+                if (data == null || !data.containsKey(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY)) {
+                    // This is an empty result that we can't handle.
                     return;
                 }
 
                 boolean isObjectLiked = data.getBoolean(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY);
-                String likeCountString = data.getString(LIKE_DIALOG_RESPONSE_LIKE_COUNT_STRING_KEY);
-                String socialSentence = data.getString(LIKE_DIALOG_RESPONSE_SOCIAL_SENTENCE_KEY);
-                String unlikeToken = data.getString(LIKE_DIALOG_RESPONSE_UNLIKE_TOKEN_KEY);
+
+                // Default to known/cached state, if properties are missing.
+                String likeCountStringWithLike = LikeActionController.this.likeCountStringWithLike;
+                String likeCountStringWithoutLike = LikeActionController.this.likeCountStringWithoutLike;
+                if (data.containsKey(LIKE_DIALOG_RESPONSE_LIKE_COUNT_STRING_KEY)) {
+                    likeCountStringWithLike = data.getString(LIKE_DIALOG_RESPONSE_LIKE_COUNT_STRING_KEY);
+                    likeCountStringWithoutLike = likeCountStringWithLike;
+                }
+
+                String socialSentenceWithLike = LikeActionController.this.socialSentenceWithLike;
+                String socialSentenceWithoutWithoutLike = LikeActionController.this.socialSentenceWithoutLike;
+                if (data.containsKey(LIKE_DIALOG_RESPONSE_SOCIAL_SENTENCE_KEY)) {
+                    socialSentenceWithLike = data.getString(LIKE_DIALOG_RESPONSE_SOCIAL_SENTENCE_KEY);
+                    socialSentenceWithoutWithoutLike = socialSentenceWithLike;
+                }
+
+                String unlikeToken = data.containsKey(LIKE_DIALOG_RESPONSE_OBJECT_IS_LIKED_KEY)
+                        ? data.getString(LIKE_DIALOG_RESPONSE_UNLIKE_TOKEN_KEY)
+                        : LikeActionController.this.unlikeToken;
 
                 Bundle logParams = (analyticsParameters == null) ? new Bundle() : analyticsParameters;
                 logParams.putString(AnalyticsEvents.PARAMETER_CALL_ID, pendingCall.getCallId().toString());
@@ -699,10 +715,10 @@ public void onComplete(FacebookDialog.PendingCall pendingCall, Bundle data) {
 
                 updateState(
                         isObjectLiked,
-                        likeCountString,
-                        likeCountString,
-                        socialSentence,
-                        socialSentence,
+                        likeCountStringWithLike,
+                        likeCountStringWithoutLike,
+                        socialSentenceWithLike,
+                        socialSentenceWithoutWithoutLike,
                         unlikeToken);
             }
 
@@ -918,17 +934,37 @@ private void refreshStatusViaService() {
         LikeStatusClient.CompletedListener callback = new LikeStatusClient.CompletedListener() {
             @Override
             public void completed(Bundle result) {
+                // Don't lose old state if the service response is incomplete.
                 if (result == null || !result.containsKey(NativeProtocol.EXTRA_OBJECT_IS_LIKED)) {
-                    // Don't lose old state if the service response is incomplete.
                     return;
                 }
 
                 boolean objectIsLiked = result.getBoolean(NativeProtocol.EXTRA_OBJECT_IS_LIKED);
-                String likeCountWithLike = result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITH_LIKE);
-                String likeCountWithoutLike = result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITHOUT_LIKE);
-                String socialSentenceWithLike = result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITH_LIKE);
-                String socialSentenceWithoutLike = result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITHOUT_LIKE);
-                String unlikeToken = result.getString(NativeProtocol.EXTRA_UNLIKE_TOKEN);
+
+                String likeCountWithLike =
+                        result.containsKey(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITH_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITH_LIKE)
+                                : LikeActionController.this.likeCountStringWithLike;
+
+                String likeCountWithoutLike =
+                        result.containsKey(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITHOUT_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_LIKE_COUNT_STRING_WITHOUT_LIKE)
+                                : LikeActionController.this.likeCountStringWithoutLike;
+
+                String socialSentenceWithLike =
+                        result.containsKey(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITH_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITH_LIKE)
+                                : LikeActionController.this.socialSentenceWithLike;
+
+                String socialSentenceWithoutLike =
+                        result.containsKey(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITHOUT_LIKE)
+                                ? result.getString(NativeProtocol.EXTRA_SOCIAL_SENTENCE_WITHOUT_LIKE)
+                                : LikeActionController.this.socialSentenceWithoutLike;
+
+                String unlikeToken =
+                        result.containsKey(NativeProtocol.EXTRA_UNLIKE_TOKEN)
+                                ? result.getString(NativeProtocol.EXTRA_UNLIKE_TOKEN)
+                                : LikeActionController.this.unlikeToken;
 
                 updateState(
                         objectIsLiked,
@@ -1162,7 +1198,9 @@ protected void processError(FacebookRequestError error) {
     }
 
     private class GetOGObjectLikesRequestWrapper extends AbstractRequestWrapper {
-        boolean objectIsLiked;
+        // Initialize the like status to what we currently have. This way, empty/error responses don't end
+        // up clearing out the state.
+        boolean objectIsLiked = LikeActionController.this.isObjectLiked;
         String unlikeToken;
 
         GetOGObjectLikesRequestWrapper(String objectId) {
@@ -1204,10 +1242,12 @@ protected void processError(FacebookRequestError error) {
     }
 
     private class GetEngagementRequestWrapper extends AbstractRequestWrapper {
-        String likeCountStringWithLike;
-        String likeCountStringWithoutLike;
-        String socialSentenceStringWithLike;
-        String socialSentenceStringWithoutLike;
+        // Initialize the like status to what we currently have. This way, empty/error responses don't end
+        // up clearing out the state.
+        String likeCountStringWithLike = LikeActionController.this.likeCountStringWithLike;
+        String likeCountStringWithoutLike = LikeActionController.this.likeCountStringWithoutLike;
+        String socialSentenceStringWithLike = LikeActionController.this.socialSentenceWithLike;
+        String socialSentenceStringWithoutLike = LikeActionController.this.socialSentenceWithoutLike;
 
         GetEngagementRequestWrapper(String objectId) {
             super(objectId);
@@ -1228,10 +1268,18 @@ protected void processError(FacebookRequestError error) {
         protected void processSuccess(Response response) {
             JSONObject engagementResults = Utility.tryGetJSONObjectFromResponse(response.getGraphObject(), "engagement");
             if (engagementResults != null) {
-                likeCountStringWithLike = engagementResults.optString("count_string_with_like");
-                likeCountStringWithoutLike = engagementResults.optString("count_string_without_like");
-                socialSentenceStringWithLike = engagementResults.optString("social_sentence_with_like");
-                socialSentenceStringWithoutLike = engagementResults.optString("social_sentence_without_like");
+                // Missing properties in the response should default to cached like status
+                likeCountStringWithLike =
+                        engagementResults.optString("count_string_with_like", likeCountStringWithLike);
+
+                likeCountStringWithoutLike =
+                        engagementResults.optString("count_string_without_like", likeCountStringWithoutLike);
+
+                socialSentenceStringWithLike =
+                        engagementResults.optString("social_sentence_with_like", socialSentenceStringWithLike);
+
+                socialSentenceStringWithoutLike =
+                        engagementResults.optString("social_sentence_without_like", socialSentenceStringWithoutLike);
             }
         }
 
diff --git a/facebook/src/com/facebook/internal/NativeProtocol.java b/facebook/src/com/facebook/internal/NativeProtocol.java
index 50ca6f88a..66795855a 100644
--- a/facebook/src/com/facebook/internal/NativeProtocol.java
+++ b/facebook/src/com/facebook/internal/NativeProtocol.java
@@ -62,6 +62,8 @@
     public static final int PROTOCOL_VERSION_20140324 = 20140324;
     public static final int PROTOCOL_VERSION_20140701 = 20140701;
     public static final int PROTOCOL_VERSION_20141001 = 20141001;
+    public static final int PROTOCOL_VERSION_20141028 = 20141028;
+    public static final int PROTOCOL_VERSION_20141107 = 20141107; // Bucketed Result Intents
 
     public static final String EXTRA_PROTOCOL_VERSION = "com.facebook.platform.protocol.PROTOCOL_VERSION";
     public static final String EXTRA_PROTOCOL_ACTION = "com.facebook.platform.protocol.PROTOCOL_ACTION";
@@ -150,6 +152,11 @@
             "com.facebook.platform.extra.EXPIRES_SECONDS_SINCE_EPOCH";
     // EXTRA_PERMISSIONS
 
+    public static final String RESULT_ARGS_ACCESS_TOKEN = "access_token";
+    public static final String RESULT_ARGS_EXPIRES_SECONDS_SINCE_EPOCH =
+            "expires_seconds_since_epoch";
+    public static final String RESULT_ARGS_PERMISSIONS = "permissions";
+
     // Extras supported for ACTION_FEED_DIALOG:
     public static final String EXTRA_PLACE_TAG = "com.facebook.platform.extra.PLACE";
     public static final String EXTRA_FRIEND_TAGS = "com.facebook.platform.extra.FRIENDS";
@@ -172,6 +179,7 @@
     public static final String METHOD_ARGS_REF = "REF";
     public static final String METHOD_ARGS_DATA_FAILURES_FATAL = "DATA_FAILURES_FATAL";
     public static final String METHOD_ARGS_PHOTOS = "PHOTOS";
+    public static final String METHOD_ARGS_VIDEO = "VIDEO";
 
     // Extras supported for ACTION_OGACTIONPUBLISH_DIALOG:
     public static final String EXTRA_ACTION = "com.facebook.platform.extra.ACTION";
@@ -213,6 +221,12 @@
     public static final String STATUS_ERROR_SUBCODE = "com.facebook.platform.status.ERROR_SUBCODE";
     public static final String STATUS_ERROR_JSON = "com.facebook.platform.status.ERROR_JSON";
 
+    public static final String BRIDGE_ARG_ERROR_TYPE = "error_type";
+    public static final String BRIDGE_ARG_ERROR_DESCRIPTION = "error_description";
+    public static final String BRIDGE_ARG_ERROR_CODE = "error_code";
+    public static final String BRIDGE_ARG_ERROR_SUBCODE = "error_subcode";
+    public static final String BRIDGE_ARG_ERROR_JSON = "error_json";
+
     // Expected values for ERROR_KEY_TYPE.  Clients should tolerate other values:
     public static final String ERROR_UNKNOWN_ERROR = "UnknownError";
     public static final String ERROR_PROTOCOL_ERROR = "ProtocolError";
@@ -428,6 +442,8 @@ public static final int getLatestKnownVersion() {
     // Note: be sure this stays sorted in descending order; add new versions at the beginning
     private static final List<Integer> KNOWN_PROTOCOL_VERSIONS =
             Arrays.asList(
+                    PROTOCOL_VERSION_20141107,
+                    PROTOCOL_VERSION_20141028,
                     PROTOCOL_VERSION_20141001,
                     PROTOCOL_VERSION_20140701,
                     PROTOCOL_VERSION_20140324,
@@ -578,8 +594,6 @@ public static Bundle getErrorDataFromResultIntent(Intent resultIntent) {
         Bundle bridgeArgs = getBridgeArgumentsFromIntent(resultIntent);
         if (bridgeArgs != null) {
             return bridgeArgs.getBundle(BRIDGE_ARG_ERROR_BUNDLE);
-
-
         }
 
         return resultIntent.getExtras();
@@ -590,10 +604,15 @@ public static Exception getExceptionFromErrorData(Bundle errorData) {
             return null;
         }
 
-        // TODO This is not going to work for JS dialogs, where the keys are not STATUS_ERROR_TYPE etc.
-        // TODO However, it should keep existing dialogs functional
-        String type = errorData.getString(STATUS_ERROR_TYPE);
-        String description = errorData.getString(STATUS_ERROR_DESCRIPTION);
+        String type = errorData.getString(BRIDGE_ARG_ERROR_TYPE);
+        if (type == null) {
+            type = errorData.getString(STATUS_ERROR_TYPE);
+        }
+
+        String description = errorData.getString(BRIDGE_ARG_ERROR_DESCRIPTION);
+        if (description == null) {
+            description = errorData.getString(STATUS_ERROR_DESCRIPTION);
+        }
 
         if (type != null && type.equalsIgnoreCase(ERROR_USER_CANCELED)) {
             return new FacebookOperationCanceledException(description);
@@ -634,6 +653,15 @@ private static int getLatestAvailableProtocolVersionForAppInfo(
             Context context,
             NativeAppInfo appInfo,
             int[] versionSpec) {
+        TreeSet<Integer> fbAppVersions = getAllAvailableProtocolVersionsForAppInfo(context, appInfo);
+        return computeLatestAvailableVersionFromVersionSpec(fbAppVersions, getLatestKnownVersion(), versionSpec);
+    }
+
+    private static TreeSet<Integer> getAllAvailableProtocolVersionsForAppInfo(
+            Context context,
+            NativeAppInfo appInfo) {
+        TreeSet<Integer> allAvailableVersions = new TreeSet<Integer>();
+
         ContentResolver contentResolver = context.getContentResolver();
 
         String [] projection = new String[]{ PLATFORM_PROVIDER_VERSION_COLUMN };
@@ -641,50 +669,62 @@ private static int getLatestAvailableProtocolVersionForAppInfo(
         Cursor c = null;
         try {
             c = contentResolver.query(uri, projection, null, null, null);
-            if (c == null) {
-                return NO_PROTOCOL_AVAILABLE;
+            if (c != null) {
+                while (c.moveToNext()) {
+                    int version = c.getInt(c.getColumnIndex(PLATFORM_PROVIDER_VERSION_COLUMN));
+                    allAvailableVersions.add(version);
+                }
             }
-
-            TreeSet<Integer> fbAppVersions = new TreeSet<Integer>();
-            while (c.moveToNext()) {
-                int version = c.getInt(c.getColumnIndex(PLATFORM_PROVIDER_VERSION_COLUMN));
-                fbAppVersions.add(version);
+        } finally {
+            if (c != null) {
+                c.close();
             }
+        }
 
-            // Remember that these ranges are sorted in ascending order and can be unbounded. So we are starting
-            // from the end of the version-spec array and working backwards, to try get the newest possible version
-            int versionSpecIndex = versionSpec.length - 1;
-            Iterator<Integer> fbAppVersionsIterator = fbAppVersions.descendingIterator();
-            int latestAllowedVersion = getLatestKnownVersion();
-            while (fbAppVersionsIterator.hasNext()) {
-                int fbAppVersion = fbAppVersionsIterator.next();
-
-                // If there is a newer version in the versionSpec, throw it away, we don't have it
-                while (versionSpecIndex >= 0 && versionSpec[versionSpecIndex] > fbAppVersion) {
-                    versionSpecIndex--;
-                }
+        return allAvailableVersions;
+    }
 
-                if (versionSpecIndex < 0) {
-                    // There was no fb app version that fell into any range in the versionSpec - or - the
-                    // versionSpec was empty, which means that this action is not supported.
-                    return NO_PROTOCOL_AVAILABLE;
-                }
+    /**
+     * This is public to allow for testing. Developers are discouraged from using this method, since it may change without
+     * notice.
+     */
+    public static int computeLatestAvailableVersionFromVersionSpec(
+            TreeSet<Integer> allAvailableFacebookAppVersions,
+            int latestSdkVersion,
+            int[] versionSpec) {
+        // Remember that these ranges are sorted in ascending order and can be unbounded. So we are starting
+        // from the end of the version-spec array and working backwards, to try get the newest possible version
+        int versionSpecIndex = versionSpec.length - 1;
+        Iterator<Integer> fbAppVersionsIterator = allAvailableFacebookAppVersions.descendingIterator();
+        int latestFacebookAppVersion = -1;
 
-                // If we are here, we know we are within a range specified in the versionSpec. We should see if it is
-                // a disabled or enabled range.
+        while (fbAppVersionsIterator.hasNext()) {
+            int fbAppVersion = fbAppVersionsIterator.next();
 
-                if (versionSpec[versionSpecIndex] == fbAppVersion) {
-                    // if the versionSpecIndex is even, it is enabled; if odd, disabled
-                    return (
-                            versionSpecIndex % 2 == 0 ?
-                                    Math.min(fbAppVersion, latestAllowedVersion) :
-                                    NO_PROTOCOL_AVAILABLE
-                    );
-                }
+            // We're holding on to the greatest fb-app version available.
+            latestFacebookAppVersion = Math.max(latestFacebookAppVersion, fbAppVersion);
+
+            // If there is a newer version in the versionSpec, throw it away, we don't have it
+            while (versionSpecIndex >= 0 && versionSpec[versionSpecIndex] > fbAppVersion) {
+                versionSpecIndex--;
             }
-        } finally {
-            if (c != null) {
-                c.close();
+
+            if (versionSpecIndex < 0) {
+                // There was no fb app version that fell into any range in the versionSpec - or - the
+                // versionSpec was empty, which means that this action is not supported.
+                return NO_PROTOCOL_AVAILABLE;
+            }
+
+            // If we are here, we know we are within a range specified in the versionSpec. We should see if it is
+            // a disabled or enabled range.
+
+            if (versionSpec[versionSpecIndex] == fbAppVersion) {
+                // if the versionSpecIndex is even, it is enabled; if odd, disabled
+                return (
+                        versionSpecIndex % 2 == 0 ?
+                                Math.min(latestFacebookAppVersion, latestSdkVersion) :
+                                NO_PROTOCOL_AVAILABLE
+                );
             }
         }
 
diff --git a/facebook/src/com/facebook/internal/PlatformServiceClient.java b/facebook/src/com/facebook/internal/PlatformServiceClient.java
index 16d619c3b..df75fc5e5 100644
--- a/facebook/src/com/facebook/internal/PlatformServiceClient.java
+++ b/facebook/src/com/facebook/internal/PlatformServiceClient.java
@@ -96,7 +96,11 @@ public void onServiceConnected(ComponentName name, IBinder service) {
 
     public void onServiceDisconnected(ComponentName name) {
         sender = null;
-        context.unbindService(this);
+        try {
+            context.unbindService(this);
+        } catch (IllegalArgumentException ex) {
+            // Do nothing, the connection was already unbound
+        }
         callback(null);
     }
 
diff --git a/facebook/src/com/facebook/internal/ServerProtocol.java b/facebook/src/com/facebook/internal/ServerProtocol.java
index 46931353d..7583f015d 100644
--- a/facebook/src/com/facebook/internal/ServerProtocol.java
+++ b/facebook/src/com/facebook/internal/ServerProtocol.java
@@ -64,7 +64,7 @@
     // URL components
     private static final String GRAPH_VIDEO_URL_FORMAT = "https://graph-video.%s";
     private static final String GRAPH_URL_FORMAT = "https://graph.%s";
-    public static final String GRAPH_API_VERSION = "v2.1";
+    public static final String GRAPH_API_VERSION = "v2.2";
 
     private static final String LEGACY_API_VERSION = "v1.0";
 
diff --git a/facebook/src/com/facebook/internal/Utility.java b/facebook/src/com/facebook/internal/Utility.java
index 91f627b02..3735e0cce 100644
--- a/facebook/src/com/facebook/internal/Utility.java
+++ b/facebook/src/com/facebook/internal/Utility.java
@@ -639,7 +639,9 @@ protected void onPostExecute(GraphObject result) {
                     SharedPreferences sharedPrefs = context.getSharedPreferences(
                             APP_SETTINGS_PREFS_STORE,
                             Context.MODE_PRIVATE);
-                    sharedPrefs.edit().putString(settingsKey, resultJSON.toString()).apply();
+                    sharedPrefs.edit()
+                        .putString(settingsKey, resultJSON.toString())
+                        .apply();
                 }
 
                 initialAppSettingsLoadTask = null;
diff --git a/facebook/src/com/facebook/widget/FacebookDialog.java b/facebook/src/com/facebook/widget/FacebookDialog.java
index 44ef2ceec..ee6a5950b 100644
--- a/facebook/src/com/facebook/widget/FacebookDialog.java
+++ b/facebook/src/com/facebook/widget/FacebookDialog.java
@@ -52,6 +52,10 @@
             "com.facebook.platform.extra.COMPLETION_GESTURE";
     private static final String EXTRA_DIALOG_COMPLETION_ID_KEY = "com.facebook.platform.extra.POST_ID";
 
+    public static final String RESULT_ARGS_DIALOG_COMPLETE_KEY = "didComplete";
+    public static final String RESULT_ARGS_DIALOG_COMPLETION_GESTURE_KEY = "completionGesture";
+    public static final String RESULT_ARGS_DIALOG_COMPLETION_ID_KEY = "postId";
+
     private static NativeAppCallAttachmentStore attachmentStore;
 
     /**
@@ -123,6 +127,10 @@
          * Indicates whether the native Share dialog supports sharing of photo images.
          */
         PHOTOS(NativeProtocol.PROTOCOL_VERSION_20140204),
+        /**
+         * Indicates whether the native Share dialog supports sharing of videos.
+         */
+        VIDEO(NativeProtocol.PROTOCOL_VERSION_20141028),
         ;
 
         private int minVersion;
@@ -274,6 +282,9 @@ public int getMinVersion() {
      * @return true if the native dialog completed normally
      */
     public static boolean getNativeDialogDidComplete(Bundle result) {
+        if (result.containsKey(RESULT_ARGS_DIALOG_COMPLETE_KEY)) {
+            return result.getBoolean(RESULT_ARGS_DIALOG_COMPLETE_KEY);
+        }
         return result.getBoolean(EXTRA_DIALOG_COMPLETE_KEY, false);
     }
 
@@ -285,6 +296,9 @@ public static boolean getNativeDialogDidComplete(Bundle result) {
      * @return "post" or "cancel" as the completion gesture
      */
     public static String getNativeDialogCompletionGesture(Bundle result) {
+        if (result.containsKey(RESULT_ARGS_DIALOG_COMPLETION_GESTURE_KEY)) {
+            return result.getString(RESULT_ARGS_DIALOG_COMPLETION_GESTURE_KEY);
+        }
         return result.getString(EXTRA_DIALOG_COMPLETION_GESTURE_KEY);
     }
 
@@ -296,6 +310,9 @@ public static String getNativeDialogCompletionGesture(Bundle result) {
      * @return the id of the published post
      */
     public static String getNativeDialogPostId(Bundle result) {
+        if (result.containsKey(RESULT_ARGS_DIALOG_COMPLETION_ID_KEY)) {
+            return result.getString(RESULT_ARGS_DIALOG_COMPLETION_ID_KEY);
+        }
         return result.getString(EXTRA_DIALOG_COMPLETION_ID_KEY);
     }
 
@@ -503,14 +520,29 @@ private static void logDialogActivity(Activity activity, Fragment fragment, Stri
     static private String getEventName(Intent intent) {
         String action = intent.getStringExtra(NativeProtocol.EXTRA_PROTOCOL_ACTION);
         boolean hasPhotos = intent.hasExtra(NativeProtocol.EXTRA_PHOTOS);
-        return getEventName(action, hasPhotos);
+        boolean hasVideo = false;
+
+        Bundle extras = intent.getBundleExtra(NativeProtocol.EXTRA_PROTOCOL_METHOD_ARGS);
+        if (extras != null) {
+            ArrayList<String> photo = extras.getStringArrayList(NativeProtocol.METHOD_ARGS_PHOTOS);
+            String video = extras.getString(NativeProtocol.METHOD_ARGS_VIDEO);
+            if (photo != null && !photo.isEmpty()) {
+                hasPhotos = true;
+            }
+            if (video != null && !video.isEmpty()) {
+                hasVideo = true;
+            }
+        }
+        return getEventName(action, hasPhotos, hasVideo);
     }
 
-    static private String getEventName(String action, boolean hasPhotos) {
+    static private String getEventName(String action, boolean hasPhotos, boolean hasVideo) {
         String eventName;
 
         if (action.equals(NativeProtocol.ACTION_FEED_DIALOG)) {
-            eventName = hasPhotos ?
+            eventName = hasVideo ?
+                    AnalyticsEvents.EVENT_NATIVE_DIALOG_TYPE_VIDEO_SHARE :
+                    hasPhotos ?
                     AnalyticsEvents.EVENT_NATIVE_DIALOG_TYPE_PHOTO_SHARE :
                     AnalyticsEvents.EVENT_NATIVE_DIALOG_TYPE_SHARE;
         } else if (action.equals(NativeProtocol.ACTION_MESSAGE_DIALOG)) {
@@ -543,7 +575,7 @@ static private String getEventName(String action, boolean hasPhotos) {
         protected Fragment fragment;
         protected String applicationName;
         protected HashMap<String, Bitmap> imageAttachments = new HashMap<String, Bitmap>();
-        protected HashMap<String, File> imageAttachmentFiles = new HashMap<String, File>();
+        protected HashMap<String, File> mediaAttachmentFiles = new HashMap<String, File>();
 
         /**
          * Constructor.
@@ -632,7 +664,7 @@ public FacebookDialog build() {
                     extras);
             if (intent == null) {
                 logDialogActivity(activity, fragment,
-                        getEventName(action, extras.containsKey(NativeProtocol.EXTRA_PHOTOS)),
+                        getEventName(action, extras.containsKey(NativeProtocol.EXTRA_PHOTOS), false),
                         AnalyticsEvents.PARAMETER_DIALOG_OUTCOME_VALUE_FAILED);
 
                 throw new FacebookException(
@@ -714,9 +746,9 @@ public void onPresent(Context context) throws Exception {
                     if (imageAttachments != null && imageAttachments.size() > 0) {
                         getAttachmentStore().addAttachmentsForCall(context, appCall.getCallId(), imageAttachments);
                     }
-                    if (imageAttachmentFiles != null && imageAttachmentFiles.size() > 0) {
+                    if (mediaAttachmentFiles != null && mediaAttachmentFiles.size() > 0) {
                         getAttachmentStore().addAttachmentFilesForCall(context, appCall.getCallId(),
-                                imageAttachmentFiles);
+                                mediaAttachmentFiles);
                     }
                 }
             };
@@ -752,6 +784,14 @@ public void onPresent(Context context) throws Exception {
             return attachmentUrls;
         }
 
+        protected String addVideoAttachmentFile(File videoFile) {
+            String attachmentName = UUID.randomUUID().toString();
+            addVideoAttachment(attachmentName, videoFile);
+            String url = NativeAppCallContentProvider.getAttachmentUrl(applicationId, appCall.getCallId(),
+                    attachmentName);
+            return url;
+        }
+
         List<String> getImageAttachmentNames() {
             return new ArrayList<String>(imageAttachments.keySet());
         }
@@ -779,7 +819,14 @@ protected CONCRETE addImageAttachment(String imageName, Bitmap bitmap) {
         }
 
         protected CONCRETE addImageAttachment(String imageName, File attachment) {
-            imageAttachmentFiles.put(imageName, attachment);
+            mediaAttachmentFiles.put(imageName, attachment);
+            @SuppressWarnings("unchecked")
+            CONCRETE result = (CONCRETE) this;
+            return result;
+        }
+
+        protected CONCRETE addVideoAttachment(String videoName, File attachment) {
+            mediaAttachmentFiles.put(videoName, attachment);
             @SuppressWarnings("unchecked")
             CONCRETE result = (CONCRETE) this;
             return result;
@@ -807,9 +854,9 @@ public ShareDialogBuilderBase(Activity activity) {
         }
 
         /**
-         * Sets the title of the item to be shared.
+         * Sets the name of the URL to be shared. This method only has effect if setLink is called.
          *
-         * @param name the title
+         * @param name the name
          * @return this instance of the builder
          */
         public CONCRETE setName(String name) {
@@ -820,9 +867,9 @@ public CONCRETE setName(String name) {
         }
 
         /**
-         * Sets the subtitle of the item to be shared.
+         * Sets the caption of the URL to be shared. This method only has effect if setLink is called.
          *
-         * @param caption the subtitle
+         * @param caption the caption
          * @return this instance of the builder
          */
         public CONCRETE setCaption(String caption) {
@@ -833,7 +880,7 @@ public CONCRETE setCaption(String caption) {
         }
 
         /**
-         * Sets the description of the item to be shared.
+         * Sets the description of the URL to be shared. This method only has effect if setLink is called.
          *
          * @param description the description
          * @return this instance of the builder
@@ -859,7 +906,7 @@ public CONCRETE setLink(String link) {
         }
 
         /**
-         * Sets the URL of the image of the item to be shared.
+         * Sets the URL of the image of the URL to be shared. This method only has effect if setLink is called.
          *
          * @param picture the URL of the image
          * @return this instance of the builder
@@ -891,7 +938,7 @@ public CONCRETE setPlace(String place) {
          * @return this instance of the builder
          */
         public CONCRETE setFriends(List<String> friends) {
-            this.friends = new ArrayList<String>(friends);
+            this.friends = (friends == null ? null : new ArrayList<String>(friends));
             @SuppressWarnings("unchecked")
             CONCRETE result = (CONCRETE) this;
             return result;
@@ -934,7 +981,6 @@ protected Bundle setBundleExtras(Bundle extras) {
             putExtra(extras, NativeProtocol.EXTRA_LINK, link);
             putExtra(extras, NativeProtocol.EXTRA_IMAGE, picture);
             putExtra(extras, NativeProtocol.EXTRA_PLACE_TAG, place);
-            putExtra(extras, NativeProtocol.EXTRA_TITLE, name);
             putExtra(extras, NativeProtocol.EXTRA_REF, ref);
 
             extras.putBoolean(NativeProtocol.EXTRA_DATA_FAILURES_FATAL, dataErrorsFatal);
@@ -954,7 +1000,6 @@ protected Bundle getMethodArguments() {
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_LINK, link);
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_IMAGE, picture);
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_PLACE_TAG, place);
-            putExtra(methodArguments, NativeProtocol.METHOD_ARGS_TITLE, name);
             putExtra(methodArguments, NativeProtocol.METHOD_ARGS_REF, ref);
 
             methodArguments.putBoolean(NativeProtocol.METHOD_ARGS_DATA_FAILURES_FATAL, dataErrorsFatal);
@@ -1025,7 +1070,7 @@ public CONCRETE setPlace(String place) {
          * @return this instance of the builder
          */
         public CONCRETE setFriends(List<String> friends) {
-            this.friends = new ArrayList<String>(friends);
+            this.friends = (friends == null ? null : new ArrayList<String>(friends));
             @SuppressWarnings("unchecked")
             CONCRETE result = (CONCRETE) this;
             return result;
@@ -1186,6 +1231,88 @@ public PhotoMessageDialogBuilder setFriends(List<String> friends) {
         }
     }
 
+    private static abstract class VideoDialogBuilderBase<CONCRETE extends VideoDialogBuilderBase<?>>
+            extends Builder<CONCRETE> {
+        private String place;
+        private String videoAttachmentUrl;
+
+        /**
+         * Constructor.
+         *
+         * @param activity the Activity which is presenting the native Share dialog; must not be null
+         */
+        public VideoDialogBuilderBase(Activity activity) {
+            super(activity);
+        }
+
+        /**
+         * Sets the place for the item to be shared.
+         *
+         * @param place the Facebook ID of the place
+         * @return this instance of the builder
+         */
+        public CONCRETE setPlace(String place) {
+            this.place = place;
+            @SuppressWarnings("unchecked")
+            CONCRETE result = (CONCRETE) this;
+            return result;
+        }
+
+        /**
+         * Adds a video to display in the native Share dialog, by specifying the location in the file system.
+         * The dialog's callback will be called once the user has shared the video, but the video may be uploaded
+         * in the background by the Facebook app; apps wishing to be notified when the video upload has succeeded
+         * or failed should extend the FacebookBroadcastReceiver class and register it in their AndroidManifest.xml.
+         * @param video a Files representing the video to be uploaded
+         * @return this instance of the builder
+         */
+        public CONCRETE addVideoFile(File video) {
+            this.videoAttachmentUrl = addVideoAttachmentFile(video);
+            @SuppressWarnings("unchecked")
+            CONCRETE result = (CONCRETE) this;
+            return result;
+        }
+
+        @Override
+        void validate() {
+            super.validate();
+
+            if (videoAttachmentUrl == null || videoAttachmentUrl.isEmpty()) {
+                throw new FacebookException("Must specify at least one video.");
+            }
+        }
+
+        @Override
+        protected Bundle getMethodArguments() {
+            Bundle methodArgs = new Bundle();
+            putExtra(methodArgs, NativeProtocol.METHOD_ARGS_PLACE_TAG, place);
+            methodArgs.putString(NativeProtocol.METHOD_ARGS_VIDEO, videoAttachmentUrl);
+            return methodArgs;
+        }
+    }
+
+    /**
+     * Provides a builder which can construct a FacebookDialog instance suitable for presenting the native
+     * Share dialog for sharing videos. This builder will throw an exception if the Facebook application is not
+     * installed, so it should only be used if {@link FacebookDialog#canPresentShareDialog(android.content.Context,
+     * com.facebook.widget.FacebookDialog.ShareDialogFeature...)} indicates the capability is available.
+     */
+    public static class VideoShareDialogBuilder extends VideoDialogBuilderBase<VideoShareDialogBuilder> {
+        /**
+         * Constructor.
+         *
+         * @param activity the Activity which is presenting the native Share dialog; must not be null
+         */
+        public VideoShareDialogBuilder(Activity activity) {
+            super(activity);
+        }
+
+        @Override
+        protected EnumSet<? extends DialogFeature> getDialogFeatures() {
+            return EnumSet.of(ShareDialogFeature.SHARE_DIALOG, ShareDialogFeature.VIDEO);
+        }
+    }
+
     /**
      * Provides a builder which can construct a FacebookDialog instance suitable for presenting the native
      * Message dialog. This builder will throw an exception if the Facebook Messenger application is not installed, so it
diff --git a/facebook/src/com/facebook/widget/LikeView.java b/facebook/src/com/facebook/widget/LikeView.java
index 8b1b8280e..349f12ab9 100644
--- a/facebook/src/com/facebook/widget/LikeView.java
+++ b/facebook/src/com/facebook/widget/LikeView.java
@@ -327,7 +327,7 @@ public void setForegroundColor(int foregroundColor) {
     }
 
     /**
-     * Sets an OnErrorListener for this instance of LoginButton to call into when
+     * Sets an OnErrorListener for this instance of LikeView to call into when
      * certain exceptions occur.
      *
      * @param onErrorListener The listener object to set
@@ -337,7 +337,7 @@ public void setOnErrorListener(OnErrorListener onErrorListener) {
     }
 
     /**
-     * Returns the current OnErrorListener for this instance of LoginButton.
+     * Returns the current OnErrorListener for this instance of LikeView.
      *
      * @return The OnErrorListener
      */
diff --git a/facebook/src/com/facebook/widget/LoginButton.java b/facebook/src/com/facebook/widget/LoginButton.java
index 6f548f4dc..9fcb25c92 100644
--- a/facebook/src/com/facebook/widget/LoginButton.java
+++ b/facebook/src/com/facebook/widget/LoginButton.java
@@ -19,6 +19,7 @@
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.content.Context;
+import android.content.ContextWrapper;
 import android.content.DialogInterface;
 import android.content.Intent;
 import android.content.res.TypedArray;
@@ -381,7 +382,7 @@ public void setReadPermissions(String... permissions) {
      * manage the setting of permissions outside of the LoginButton class altogether
      * (by managing the session explicitly).
      *
-     * @param permissions the read permissions to use
+     * @param permissions the publish permissions to use
      *
      * @throws UnsupportedOperationException if setReadPermissions has been called
      * @throws IllegalArgumentException if permissions is null or empty
@@ -407,7 +408,7 @@ public void setPublishPermissions(List<String> permissions) {
      * manage the setting of permissions outside of the LoginButton class altogether
      * (by managing the session explicitly).
      *
-     * @param permissions the read permissions to use
+     * @param permissions the publish permissions to use
      *
      * @throws UnsupportedOperationException if setReadPermissions has been called
      * @throws IllegalArgumentException if permissions is null or empty
@@ -843,6 +844,11 @@ public void onClick(DialogInterface dialog, int which) {
                         openRequest = new Session.OpenRequest(parentFragment);
                     } else if (context instanceof Activity) {
                         openRequest = new Session.OpenRequest((Activity)context);
+                    } else if (context instanceof ContextWrapper) {
+                        Context baseContext = ((ContextWrapper)context).getBaseContext();
+                        if (baseContext instanceof Activity) {
+                            openRequest = new Session.OpenRequest((Activity)baseContext);
+                        }
                     }
 
                     if (openRequest != null) {
diff --git a/facebook/src/com/facebook/widget/PickerFragment.java b/facebook/src/com/facebook/widget/PickerFragment.java
index 4ef6cbd23..536c0c783 100644
--- a/facebook/src/com/facebook/widget/PickerFragment.java
+++ b/facebook/src/com/facebook/widget/PickerFragment.java
@@ -97,6 +97,7 @@
     private final Class<T> graphObjectClass;
     private LoadingStrategy loadingStrategy;
     private SelectionStrategy selectionStrategy;
+    private Set<String> selectionHint;
     private ProgressBar activityCircle;
     private SessionTracker sessionTracker;
     private String titleText;
@@ -487,9 +488,21 @@ public String getDoneButtonText() {
      *                    if false, data will not be re-loaded if it is already displayed (or loading)
      */
     public void loadData(boolean forceReload) {
+        loadData(forceReload, null);
+    }
+
+    /**
+     * Causes the picker to load data from the service and display it to the user.
+     *
+     * @param forceReload if true, data will be loaded even if there is already data being displayed (or loading);
+     *                    if false, data will not be re-loaded if it is already displayed (or loading)
+     * @param selectIds ids to select, if they are present in the loaded data
+     */
+    public void loadData(boolean forceReload, Set<String> selectIds) {
         if (!forceReload && loadingStrategy.isDataPresentOrLoading()) {
             return;
         }
+        selectionHint = selectIds;
         loadDataSkippingRoundTripIfCached();
     }
 
@@ -751,6 +764,32 @@ void updateAdapter(SimpleGraphObjectCursor<T> data) {
             if (dataChanged && onDataChangedListener != null) {
                 onDataChangedListener.onDataChanged(PickerFragment.this);
             }
+            if (selectionHint != null && !selectionHint.isEmpty() && data != null) {
+                data.moveToFirst();
+                boolean changed = false;
+                for (int i = 0; i < data.getCount(); i++) {
+                    data.moveToPosition(i);
+                    T graphObject = data.getGraphObject();
+                    if (!graphObject.asMap().containsKey("id"))
+                        continue;
+                    Object obj = graphObject.getProperty("id");
+                    if (!(obj instanceof String)) {
+                        continue;
+                    }
+                    String id = (String) obj;
+                    if (selectionHint.contains(id)) {
+                        selectionStrategy.toggleSelection(id);
+                        selectionHint.remove(id);
+                        changed = true;
+                    }
+                    if (selectionHint.isEmpty()) {
+                        break;
+                    }
+                }
+                if (onSelectionChangedListener != null && changed) {
+                    onSelectionChangedListener.onSelectionChanged(PickerFragment.this);
+                }
+            }
         }
     }
 
diff --git a/facebook/src/com/facebook/widget/WebDialog.java b/facebook/src/com/facebook/widget/WebDialog.java
index 81fb28286..cf54a850a 100644
--- a/facebook/src/com/facebook/widget/WebDialog.java
+++ b/facebook/src/com/facebook/widget/WebDialog.java
@@ -51,6 +51,7 @@
 public class WebDialog extends Dialog {
     private static final String LOG_TAG = Logger.LOG_TAG_BASE + "WebDialog";
     private static final String DISPLAY_TOUCH = "touch";
+    private static final int API_EC_DIALOG_CANCEL = 4201;
     static final String REDIRECT_URI = "fbconnect://success";
     static final String CANCEL_URI = "fbconnect://cancel";
     static final boolean DISABLE_SSL_CHECK_FOR_TESTING = false;
@@ -80,6 +81,7 @@
     private FrameLayout contentFrameLayout;
     private boolean listenerCalled = false;
     private boolean isDetached = false;
+    private boolean isDismissed = false;
 
     /**
      * Interface that implements a listener to be called when the user's interaction with the
@@ -169,6 +171,19 @@ public OnCompleteListener getOnCompleteListener() {
 
     @Override
     public void dismiss() {
+        if (isDismissed) {
+            // Some paths may cause dismiss() to be called recursively. Break the loop here.
+            return;
+        }
+        isDismissed = true;
+
+        // If dismiss() was called without sending a result to the listener, let's default to a "cancel" result.
+        // This will be the case when the user taps the OS-back-button, or the cross-image, or outside the loading
+        // interstitial.
+        if (!listenerCalled) {
+            sendCancelToListener();
+        }
+
         if (webView != null) {
             webView.stopLoading();
         }
@@ -196,21 +211,13 @@ public void onAttachedToWindow() {
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
 
-        setOnCancelListener(new OnCancelListener() {
-            @Override
-            public void onCancel(DialogInterface dialogInterface) {
-                sendCancelToListener();
-            }
-        });
-
         spinner = new ProgressDialog(getContext());
         spinner.requestWindowFeature(Window.FEATURE_NO_TITLE);
         spinner.setMessage(getContext().getString(R.string.com_facebook_loading));
         spinner.setOnCancelListener(new OnCancelListener() {
             @Override
             public void onCancel(DialogInterface dialogInterface) {
-                sendCancelToListener();
-                WebDialog.this.dismiss();
+                dismiss();
             }
         });
 
@@ -259,6 +266,14 @@ protected Bundle parseResponseUri(String urlString) {
         return b;
     }
 
+    protected boolean isListenerCalled() {
+        return listenerCalled;
+    }
+
+    protected WebView getWebView() {
+        return webView;
+    }
+
     private void calculateSize() {
         WindowManager wm = (WindowManager) getContext().getSystemService(Context.WINDOW_SERVICE);
         Display display = wm.getDefaultDisplay();
@@ -305,14 +320,16 @@ private int getScaledSize(int screenSize, float density, int noPaddingSize, int
         return (int) (screenSize * scaleFactor);
     }
 
-    private void sendSuccessToListener(Bundle values) {
+    protected void sendSuccessToListener(Bundle values) {
         if (onCompleteListener != null && !listenerCalled) {
             listenerCalled = true;
             onCompleteListener.onComplete(values, null);
+
+            dismiss();
         }
     }
 
-    private void sendErrorToListener(Throwable error) {
+    protected void sendErrorToListener(Throwable error) {
         if (onCompleteListener != null && !listenerCalled) {
             listenerCalled = true;
             FacebookException facebookException = null;
@@ -322,10 +339,12 @@ private void sendErrorToListener(Throwable error) {
                 facebookException = new FacebookException(error);
             }
             onCompleteListener.onComplete(null, facebookException);
+
+            dismiss();
         }
     }
 
-    private void sendCancelToListener() {
+    protected void sendCancelToListener() {
         sendErrorToListener(new FacebookOperationCanceledException());
     }
 
@@ -335,8 +354,7 @@ private void createCrossImage() {
         crossImageView.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
-                sendCancelToListener();
-                WebDialog.this.dismiss();
+                dismiss();
             }
         });
         Drawable crossDrawable = getContext().getResources().getDrawable(R.drawable.com_facebook_close);
@@ -350,7 +368,18 @@ public void onClick(View v) {
     @SuppressLint("SetJavaScriptEnabled")
     private void setUpWebView(int margin) {
         LinearLayout webViewContainer = new LinearLayout(getContext());
-        webView = new WebView(getContext());
+        webView = new WebView(getContext()) {
+            /* Prevent NPE on Motorola 2.2 devices
+             * See https://groups.google.com/forum/?fromgroups=#!topic/android-developers/ktbwY2gtLKQ
+             */
+            @Override
+            public void onWindowFocusChanged(boolean hasWindowFocus) {
+                try {
+                    super.onWindowFocusChanged(hasWindowFocus);
+                } catch (NullPointerException e) {
+                }
+            }
+        };
         webView.setVerticalScrollBarEnabled(false);
         webView.setHorizontalScrollBarEnabled(false);
         webView.setWebViewClient(new DialogWebViewClient());
@@ -401,16 +430,15 @@ public boolean shouldOverrideUrlLoading(WebView view, String url) {
                 } else if (error != null && (error.equals("access_denied") ||
                         error.equals("OAuthAccessDeniedException"))) {
                     sendCancelToListener();
+                } else if (errorCode == API_EC_DIALOG_CANCEL) {
+                    sendCancelToListener();
                 } else {
                     FacebookRequestError requestError = new FacebookRequestError(errorCode, error, errorMessage);
                     sendErrorToListener(new FacebookServiceException(requestError, errorMessage));
                 }
-
-                WebDialog.this.dismiss();
                 return true;
             } else if (url.startsWith(WebDialog.CANCEL_URI)) {
                 sendCancelToListener();
-                WebDialog.this.dismiss();
                 return true;
             } else if (url.contains(DISPLAY_TOUCH)) {
                 return false;
@@ -426,7 +454,6 @@ public void onReceivedError(WebView view, int errorCode,
                 String description, String failingUrl) {
             super.onReceivedError(view, errorCode, description, failingUrl);
             sendErrorToListener(new FacebookDialogException(description, errorCode, failingUrl));
-            WebDialog.this.dismiss();
         }
 
         @Override
@@ -436,9 +463,8 @@ public void onReceivedSslError(WebView view, SslErrorHandler handler, SslError e
             } else {
                 super.onReceivedSslError(view, handler, error);
 
-                sendErrorToListener(new FacebookDialogException(null, ERROR_FAILED_SSL_HANDSHAKE, null));
                 handler.cancel();
-                WebDialog.this.dismiss();
+                sendErrorToListener(new FacebookDialogException(null, ERROR_FAILED_SSL_HANDSHAKE, null));
             }
         }
 
@@ -759,7 +785,7 @@ public FeedDialogBuilder setSource(String source) {
         }
 
         /**
-         * Sets the name of the item being shared.
+         * Sets the name of the URL being shared. This method only has effect if setLink is called.
          *
          * @param name the name
          * @return the builder
@@ -770,7 +796,7 @@ public FeedDialogBuilder setName(String name) {
         }
 
         /**
-         * Sets the caption to be displayed.
+         * Sets the caption of the URL being shared. This method only has effect if setLink is called.
          *
          * @param caption the caption
          * @return the builder
@@ -781,7 +807,7 @@ public FeedDialogBuilder setCaption(String caption) {
         }
 
         /**
-         * Sets the description to be displayed.
+         * Sets the description of the URL being shared. This method only has effect if setLink is called.
          *
          * @param description the description
          * @return the builder
diff --git a/facebook/tests/build.gradle b/facebook/tests/build.gradle
index 97494f6b4..df41829e9 100644
--- a/facebook/tests/build.gradle
+++ b/facebook/tests/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/facebook/tests/src/com/facebook/AppEventsLoggerTests.java b/facebook/tests/src/com/facebook/AppEventsLoggerTests.java
index 203eb041e..360b0d668 100644
--- a/facebook/tests/src/com/facebook/AppEventsLoggerTests.java
+++ b/facebook/tests/src/com/facebook/AppEventsLoggerTests.java
@@ -108,8 +108,6 @@ public void run() {
 
             assertTrue(obj instanceof HashMap);
 
-            logger1.flush();
-
             logger1.logEvent("another_event");
 
             waitForBroadcastReceiver.incrementExpectCount();
diff --git a/facebook/tests/src/com/facebook/WaitForBroadcastReceiver.java b/facebook/tests/src/com/facebook/WaitForBroadcastReceiver.java
index 412917b8b..5d9b998c9 100644
--- a/facebook/tests/src/com/facebook/WaitForBroadcastReceiver.java
+++ b/facebook/tests/src/com/facebook/WaitForBroadcastReceiver.java
@@ -21,6 +21,7 @@
 import android.content.Intent;
 import android.os.ConditionVariable;
 import android.os.Looper;
+
 import junit.framework.Assert;
 
 import java.util.ArrayList;
@@ -74,11 +75,14 @@ public static void waitForExpectedCalls(WaitForBroadcastReceiver... receivers) {
 
     @Override
     public void onReceive(Context context, Intent intent) {
+        receivedIntents.add(intent);
+
         if (++actualCount == expectCount) {
             condition.open();
         }
-        receivedIntents.add(intent);
-        Assert.assertTrue("expecting " + expectCount + "broadcasts, but received " + actualCount,                actualCount <= expectCount);
+
+        Assert.assertTrue("expecting " + expectCount + "broadcasts, but received " + actualCount,
+                actualCount <= expectCount);
         Assert.assertEquals("BroadcastReceiver should receive on main UI thread",
                 Thread.currentThread(), Looper.getMainLooper().getThread());
     }
diff --git a/facebook/tests/src/com/facebook/internal/NativeProtocolVersionTests.java b/facebook/tests/src/com/facebook/internal/NativeProtocolVersionTests.java
new file mode 100644
index 000000000..e08245ab3
--- /dev/null
+++ b/facebook/tests/src/com/facebook/internal/NativeProtocolVersionTests.java
@@ -0,0 +1,157 @@
+/**
+ * Copyright 2010-present Facebook.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.facebook.internal;
+
+import android.test.AndroidTestCase;
+import android.test.suitebuilder.annotation.SmallTest;
+
+import java.util.TreeSet;
+
+public class NativeProtocolVersionTests extends AndroidTestCase {
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecOpen() {
+        // Base case where a feature was enabled a while ago and the SDK and Native app have been updated
+        // since then.
+        int[] versionSpec = new int[] {3};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecOpen() {
+        // Base case where a feature was enabled a while ago and the SDK and Native app have been updated
+        // since then.
+        int[] versionSpec = new int[] {3};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecDisabled() {
+        // Case where a feature was enabled AND disabled a while ago and the SDK and Native app have been
+        // updated since then.
+        int[] versionSpec = new int[] {1,3,7,8};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecDisabled() {
+        // Case where a feature was enabled AND disabled a while ago and the SDK and Native app have been
+        // updated since then.
+        int[] versionSpec = new int[] {1,3,6,7};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecNewerAndEnabled() {
+        // Case where the sdk and app are older, but the app is still enabled
+        int[] versionSpec = new int[] {1,3,7,9,10,11,12,13};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecNewerAndEnabled() {
+        // Case where the sdk and app are older, but the app is still enabled
+        int[] versionSpec = new int[] {1,3,7,9,10,11,12,13};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, 7);
+    }
+
+    @SmallTest
+    public void testSdkOlderThanApp_versionSpecNewerAndDisabled() {
+        // Case where the sdk and app are older, and the app is a disabled version
+        int[] versionSpec = new int[] {1,3,7,8,10,11,12,13};
+        int latestSdkVersion = 7;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7,8};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    @SmallTest
+    public void testSdkNewerThanApp_versionSpecNewerAndDisabled() {
+        // Case where the sdk and app are older, and the app is a disabled version
+        int[] versionSpec = new int[] {1,3,6,7,10,11,12,13};
+        int latestSdkVersion = 8;
+        int[] availableFbAppVersions = new int[] {1,2,3,4,5,6,7};
+
+        int resultVersion = NativeProtocol.computeLatestAvailableVersionFromVersionSpec(
+                getTreeSetFromIntArray(availableFbAppVersions),
+                latestSdkVersion,
+                versionSpec);
+
+        assertEquals(resultVersion, NativeProtocol.NO_PROTOCOL_AVAILABLE);
+    }
+
+    private TreeSet<Integer> getTreeSetFromIntArray(int[] array) {
+        TreeSet<Integer> treeSet = new TreeSet<Integer>();
+        for (int a : array) {
+            treeSet.add(a);
+        }
+
+        return treeSet;
+    }
+}
diff --git a/libs/bolts-android-1.1.2.jar b/libs/bolts-android-1.1.2.jar
new file mode 100644
index 000000000..88a01a30b
Binary files /dev/null and b/libs/bolts-android-1.1.2.jar differ
diff --git a/samples/FriendPickerSample/build.gradle b/samples/FriendPickerSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/FriendPickerSample/build.gradle
+++ b/samples/FriendPickerSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/FriendPickerSample/res/drawable-hdpi/icon.png b/samples/FriendPickerSample/res/drawable-hdpi/icon.png
index 6a930c6c6..7d5a0608c 100644
Binary files a/samples/FriendPickerSample/res/drawable-hdpi/icon.png and b/samples/FriendPickerSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/FriendPickerSample/res/drawable-mdpi/icon.png b/samples/FriendPickerSample/res/drawable-mdpi/icon.png
index 33b418b7a..bdfec2583 100644
Binary files a/samples/FriendPickerSample/res/drawable-mdpi/icon.png and b/samples/FriendPickerSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/FriendPickerSample/res/drawable-xhdpi/icon.png b/samples/FriendPickerSample/res/drawable-xhdpi/icon.png
index 494e37a8d..b9c184918 100644
Binary files a/samples/FriendPickerSample/res/drawable-xhdpi/icon.png and b/samples/FriendPickerSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/FriendPickerSample/res/drawable/icon.png b/samples/FriendPickerSample/res/drawable/icon.png
index 33b418b7a..bdfec2583 100644
Binary files a/samples/FriendPickerSample/res/drawable/icon.png and b/samples/FriendPickerSample/res/drawable/icon.png differ
diff --git a/samples/HelloFacebookSample/build.gradle b/samples/HelloFacebookSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/HelloFacebookSample/build.gradle
+++ b/samples/HelloFacebookSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/HelloFacebookSample/res/drawable-hdpi/icon.png b/samples/HelloFacebookSample/res/drawable-hdpi/icon.png
index e603120e1..0a0d7cc73 100644
Binary files a/samples/HelloFacebookSample/res/drawable-hdpi/icon.png and b/samples/HelloFacebookSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/HelloFacebookSample/res/drawable-mdpi/icon.png b/samples/HelloFacebookSample/res/drawable-mdpi/icon.png
index f2fc84fb6..b4507c0e7 100644
Binary files a/samples/HelloFacebookSample/res/drawable-mdpi/icon.png and b/samples/HelloFacebookSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png b/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png
index 143a69f21..6e8424602 100644
Binary files a/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png and b/samples/HelloFacebookSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/HelloFacebookSample/res/drawable/icon.png b/samples/HelloFacebookSample/res/drawable/icon.png
index f2fc84fb6..b4507c0e7 100644
Binary files a/samples/HelloFacebookSample/res/drawable/icon.png and b/samples/HelloFacebookSample/res/drawable/icon.png differ
diff --git a/samples/PlacePickerSample/build.gradle b/samples/PlacePickerSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/PlacePickerSample/build.gradle
+++ b/samples/PlacePickerSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/PlacePickerSample/res/drawable-hdpi/icon.png b/samples/PlacePickerSample/res/drawable-hdpi/icon.png
index 4059334b5..72320cacd 100644
Binary files a/samples/PlacePickerSample/res/drawable-hdpi/icon.png and b/samples/PlacePickerSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/PlacePickerSample/res/drawable-mdpi/icon.png b/samples/PlacePickerSample/res/drawable-mdpi/icon.png
index 1fa3834d0..9012b57a2 100644
Binary files a/samples/PlacePickerSample/res/drawable-mdpi/icon.png and b/samples/PlacePickerSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/PlacePickerSample/res/drawable-xhdpi/icon.png b/samples/PlacePickerSample/res/drawable-xhdpi/icon.png
index 2b3083d44..40cd9480c 100644
Binary files a/samples/PlacePickerSample/res/drawable-xhdpi/icon.png and b/samples/PlacePickerSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/PlacePickerSample/res/drawable/icon.png b/samples/PlacePickerSample/res/drawable/icon.png
index 1fa3834d0..9012b57a2 100644
Binary files a/samples/PlacePickerSample/res/drawable/icon.png and b/samples/PlacePickerSample/res/drawable/icon.png differ
diff --git a/samples/RPSSample/AndroidManifest.xml b/samples/RPSSample/AndroidManifest.xml
index 06c1fc4c0..5e81e5104 100644
--- a/samples/RPSSample/AndroidManifest.xml
+++ b/samples/RPSSample/AndroidManifest.xml
@@ -32,6 +32,7 @@
                   android:label="@string/app_name" />
         <meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/app_id"/>
         <provider android:authorities="com.facebook.app.NativeAppCallContentProvider157578437735213"
-                  android:name="com.facebook.NativeAppCallContentProvider" />
+                  android:name="com.facebook.NativeAppCallContentProvider"
+                  android:exported="true" />
     </application>
 </manifest>
diff --git a/samples/RPSSample/build.gradle b/samples/RPSSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/RPSSample/build.gradle
+++ b/samples/RPSSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/RPSSample/res/drawable-hdpi/icon.png b/samples/RPSSample/res/drawable-hdpi/icon.png
index 5bc5b2cea..9e70a87f3 100644
Binary files a/samples/RPSSample/res/drawable-hdpi/icon.png and b/samples/RPSSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/RPSSample/res/drawable-mdpi/icon.png b/samples/RPSSample/res/drawable-mdpi/icon.png
index f621e908c..f8ac7a2db 100644
Binary files a/samples/RPSSample/res/drawable-mdpi/icon.png and b/samples/RPSSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/RPSSample/res/drawable-xhdpi/icon.png b/samples/RPSSample/res/drawable-xhdpi/icon.png
index 1adb6bfa3..ea8da121a 100644
Binary files a/samples/RPSSample/res/drawable-xhdpi/icon.png and b/samples/RPSSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/RPSSample/res/drawable/fb_logo.png b/samples/RPSSample/res/drawable/fb_logo.png
index b4b29948c..42c619123 100755
Binary files a/samples/RPSSample/res/drawable/fb_logo.png and b/samples/RPSSample/res/drawable/fb_logo.png differ
diff --git a/samples/RPSSample/res/drawable/icon.png b/samples/RPSSample/res/drawable/icon.png
index f621e908c..f8ac7a2db 100644
Binary files a/samples/RPSSample/res/drawable/icon.png and b/samples/RPSSample/res/drawable/icon.png differ
diff --git a/samples/RPSSample/res/drawable/left_paper.png b/samples/RPSSample/res/drawable/left_paper.png
index 7336fd246..813e925da 100755
Binary files a/samples/RPSSample/res/drawable/left_paper.png and b/samples/RPSSample/res/drawable/left_paper.png differ
diff --git a/samples/RPSSample/res/drawable/left_rock.png b/samples/RPSSample/res/drawable/left_rock.png
index bee7abe89..4226ab074 100755
Binary files a/samples/RPSSample/res/drawable/left_rock.png and b/samples/RPSSample/res/drawable/left_rock.png differ
diff --git a/samples/RPSSample/res/drawable/left_scissors.png b/samples/RPSSample/res/drawable/left_scissors.png
index dac525200..0ed1b1c16 100755
Binary files a/samples/RPSSample/res/drawable/left_scissors.png and b/samples/RPSSample/res/drawable/left_scissors.png differ
diff --git a/samples/RPSSample/res/drawable/right_paper.png b/samples/RPSSample/res/drawable/right_paper.png
index d243567a9..54431fe6a 100755
Binary files a/samples/RPSSample/res/drawable/right_paper.png and b/samples/RPSSample/res/drawable/right_paper.png differ
diff --git a/samples/RPSSample/res/drawable/right_rock.png b/samples/RPSSample/res/drawable/right_rock.png
index 9168b4b74..51203c4bc 100755
Binary files a/samples/RPSSample/res/drawable/right_rock.png and b/samples/RPSSample/res/drawable/right_rock.png differ
diff --git a/samples/RPSSample/res/drawable/right_scissors.png b/samples/RPSSample/res/drawable/right_scissors.png
index 083c47590..7c55471e6 100755
Binary files a/samples/RPSSample/res/drawable/right_scissors.png and b/samples/RPSSample/res/drawable/right_scissors.png differ
diff --git a/samples/Scrumptious/AndroidManifest.xml b/samples/Scrumptious/AndroidManifest.xml
index f5fadc8c7..715d5bc7b 100644
--- a/samples/Scrumptious/AndroidManifest.xml
+++ b/samples/Scrumptious/AndroidManifest.xml
@@ -29,6 +29,7 @@
                   android:label="@string/app_name" />
         <meta-data android:name="com.facebook.sdk.ApplicationId" android:value="@string/app_id"/>
         <provider android:authorities="com.facebook.app.NativeAppCallContentProvider233936543368280"
-                  android:name="com.facebook.NativeAppCallContentProvider" />
+                  android:name="com.facebook.NativeAppCallContentProvider"
+                  android:exported="true" />
     </application>
 </manifest> 
diff --git a/samples/Scrumptious/build.gradle b/samples/Scrumptious/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/Scrumptious/build.gradle
+++ b/samples/Scrumptious/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/Scrumptious/res/drawable-hdpi/icon.png b/samples/Scrumptious/res/drawable-hdpi/icon.png
index 0320aeb54..383503ce9 100644
Binary files a/samples/Scrumptious/res/drawable-hdpi/icon.png and b/samples/Scrumptious/res/drawable-hdpi/icon.png differ
diff --git a/samples/Scrumptious/res/drawable-mdpi/icon.png b/samples/Scrumptious/res/drawable-mdpi/icon.png
index 5c4b0095f..b14f00b4d 100644
Binary files a/samples/Scrumptious/res/drawable-mdpi/icon.png and b/samples/Scrumptious/res/drawable-mdpi/icon.png differ
diff --git a/samples/Scrumptious/res/drawable-mdpi/logo.png b/samples/Scrumptious/res/drawable-mdpi/logo.png
index 27fd9ffc1..a6f07865e 100644
Binary files a/samples/Scrumptious/res/drawable-mdpi/logo.png and b/samples/Scrumptious/res/drawable-mdpi/logo.png differ
diff --git a/samples/Scrumptious/res/drawable-xhdpi/icon.png b/samples/Scrumptious/res/drawable-xhdpi/icon.png
index 796e14ec2..c86c5f0f3 100644
Binary files a/samples/Scrumptious/res/drawable-xhdpi/icon.png and b/samples/Scrumptious/res/drawable-xhdpi/icon.png differ
diff --git a/samples/Scrumptious/res/drawable-xhdpi/logo.png b/samples/Scrumptious/res/drawable-xhdpi/logo.png
index 0fff04bb9..aea4d819e 100644
Binary files a/samples/Scrumptious/res/drawable-xhdpi/logo.png and b/samples/Scrumptious/res/drawable-xhdpi/logo.png differ
diff --git a/samples/Scrumptious/res/drawable/add_food.png b/samples/Scrumptious/res/drawable/add_food.png
index b556dd6e3..aeb1ae315 100644
Binary files a/samples/Scrumptious/res/drawable/add_food.png and b/samples/Scrumptious/res/drawable/add_food.png differ
diff --git a/samples/Scrumptious/res/drawable/add_friends.png b/samples/Scrumptious/res/drawable/add_friends.png
index 1cafe3625..b728ebfd9 100644
Binary files a/samples/Scrumptious/res/drawable/add_friends.png and b/samples/Scrumptious/res/drawable/add_friends.png differ
diff --git a/samples/Scrumptious/res/drawable/add_location.png b/samples/Scrumptious/res/drawable/add_location.png
index 2df780552..45a30b3e5 100644
Binary files a/samples/Scrumptious/res/drawable/add_location.png and b/samples/Scrumptious/res/drawable/add_location.png differ
diff --git a/samples/Scrumptious/res/drawable/add_photo.png b/samples/Scrumptious/res/drawable/add_photo.png
index 48f5740a6..f48ea0680 100644
Binary files a/samples/Scrumptious/res/drawable/add_photo.png and b/samples/Scrumptious/res/drawable/add_photo.png differ
diff --git a/samples/Scrumptious/res/drawable/facebook.png b/samples/Scrumptious/res/drawable/facebook.png
index daf8097b1..88c2ed6a8 100755
Binary files a/samples/Scrumptious/res/drawable/facebook.png and b/samples/Scrumptious/res/drawable/facebook.png differ
diff --git a/samples/Scrumptious/res/drawable/icon.png b/samples/Scrumptious/res/drawable/icon.png
index 5c4b0095f..739392fc0 100644
Binary files a/samples/Scrumptious/res/drawable/icon.png and b/samples/Scrumptious/res/drawable/icon.png differ
diff --git a/samples/Scrumptious/res/drawable/title_bar_logo.png b/samples/Scrumptious/res/drawable/title_bar_logo.png
index 27fd9ffc1..3fe6e8b97 100644
Binary files a/samples/Scrumptious/res/drawable/title_bar_logo.png and b/samples/Scrumptious/res/drawable/title_bar_logo.png differ
diff --git a/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java b/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java
index e496de8cc..964760c75 100644
--- a/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java
+++ b/samples/Scrumptious/src/com/facebook/scrumptious/MainActivity.java
@@ -22,8 +22,6 @@
 import android.support.v4.app.FragmentActivity;
 import android.support.v4.app.FragmentManager;
 import android.support.v4.app.FragmentTransaction;
-import android.view.Menu;
-import android.view.MenuItem;
 import com.facebook.AppEventsLogger;
 import com.facebook.Session;
 import com.facebook.SessionState;
@@ -39,7 +37,6 @@
     private static final int FRAGMENT_COUNT = SETTINGS +1;
 
     private Fragment[] fragments = new Fragment[FRAGMENT_COUNT];
-    private MenuItem settings;
     private boolean isResumed = false;
     private boolean userSkippedLogin = false;
     private UiLifecycleHelper uiHelper;
@@ -142,30 +139,6 @@ protected void onResumeFragments() {
         }
     }
 
-    @Override
-    public boolean onPrepareOptionsMenu(Menu menu) {
-        // only add the menu when the selection fragment is showing
-        if (fragments[SELECTION].isVisible()) {
-            if (menu.size() == 0) {
-                settings = menu.add(R.string.settings);
-            }
-            return true;
-        } else {
-            menu.clear();
-            settings = null;
-        }
-        return false;
-    }
-
-    @Override
-    public boolean onOptionsItemSelected(MenuItem item) {
-        if (item.equals(settings)) {
-            showSettingsFragment();
-            return true;
-        }
-        return false;
-    }
-
     public void showSettingsFragment() {
         showFragment(SETTINGS, true);
     }
diff --git a/samples/Scrumptious/src/com/facebook/scrumptious/PickerActivity.java b/samples/Scrumptious/src/com/facebook/scrumptious/PickerActivity.java
index 3522da5b2..e795698e4 100644
--- a/samples/Scrumptious/src/com/facebook/scrumptious/PickerActivity.java
+++ b/samples/Scrumptious/src/com/facebook/scrumptious/PickerActivity.java
@@ -147,8 +147,12 @@ protected void onStart() {
                         locationListener = new LocationListener() {
                             @Override
                             public void onLocationChanged(Location location) {
-                                float distance = location.distanceTo(placePickerFragment.getLocation());
-                                if (distance >= LOCATION_CHANGE_THRESHOLD) {
+                                boolean updateLocation = true;
+                                Location prevLocation = placePickerFragment.getLocation();
+                                if (prevLocation != null) {
+                                    updateLocation = location.distanceTo(prevLocation) >= LOCATION_CHANGE_THRESHOLD;
+                                }
+                                if (updateLocation) {
                                     placePickerFragment.setLocation(location);
                                     placePickerFragment.loadData(true);
                                 }
diff --git a/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java b/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java
index f6f572ce8..3cc1ad7a9 100644
--- a/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java
+++ b/samples/Scrumptious/src/com/facebook/scrumptious/SelectionFragment.java
@@ -158,6 +158,12 @@ public void onClick(View view) {
                 handleAnnounce(true);
             }
         });
+        profilePictureView.setOnClickListener(new View.OnClickListener() {
+            @Override
+            public void onClick(View view) {
+                activity.showSettingsFragment();
+            }
+        });
 
         init(savedInstanceState);
 
diff --git a/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java b/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java
index 2eaaede2a..ba1b6442b 100644
--- a/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java
+++ b/samples/Scrumptious/src/com/facebook/scrumptious/SplashFragment.java
@@ -22,9 +22,11 @@
 import android.view.View;
 import android.view.ViewGroup;
 import android.widget.TextView;
+import com.facebook.widget.LoginButton;
 
 public class SplashFragment extends Fragment {
 
+    private LoginButton loginButton;
     private TextView skipLoginButton;
     private SkipLoginCallback skipLoginCallback;
 
@@ -37,6 +39,9 @@
     public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
         View view = inflater.inflate(R.layout.splash, container, false);
 
+        loginButton = (LoginButton) view.findViewById(R.id.login_button);
+        loginButton.setReadPermissions("user_friends");
+
         skipLoginButton = (TextView) view.findViewById(R.id.skip_login_button);
         skipLoginButton.setOnClickListener(new View.OnClickListener() {
             @Override
diff --git a/samples/SwitchUserSample/build.gradle b/samples/SwitchUserSample/build.gradle
index b76fed903..41125c44d 100644
--- a/samples/SwitchUserSample/build.gradle
+++ b/samples/SwitchUserSample/build.gradle
@@ -1,4 +1,4 @@
-apply plugin: 'android'
+apply plugin: 'com.android.application'
 
 dependencies {
     compile project(':facebook')
diff --git a/samples/SwitchUserSample/res/drawable-hdpi/icon.png b/samples/SwitchUserSample/res/drawable-hdpi/icon.png
index cda826b7f..8e4f7040c 100644
Binary files a/samples/SwitchUserSample/res/drawable-hdpi/icon.png and b/samples/SwitchUserSample/res/drawable-hdpi/icon.png differ
diff --git a/samples/SwitchUserSample/res/drawable-mdpi/icon.png b/samples/SwitchUserSample/res/drawable-mdpi/icon.png
index ffd35f432..e193802b2 100644
Binary files a/samples/SwitchUserSample/res/drawable-mdpi/icon.png and b/samples/SwitchUserSample/res/drawable-mdpi/icon.png differ
diff --git a/samples/SwitchUserSample/res/drawable-xhdpi/icon.png b/samples/SwitchUserSample/res/drawable-xhdpi/icon.png
index be63ade0b..e49838d03 100644
Binary files a/samples/SwitchUserSample/res/drawable-xhdpi/icon.png and b/samples/SwitchUserSample/res/drawable-xhdpi/icon.png differ
diff --git a/samples/SwitchUserSample/res/drawable/icon.png b/samples/SwitchUserSample/res/drawable/icon.png
index ffd35f432..e193802b2 100644
Binary files a/samples/SwitchUserSample/res/drawable/icon.png and b/samples/SwitchUserSample/res/drawable/icon.png differ
diff --git a/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java b/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java
index 0dab22ade..125a649c2 100644
--- a/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java
+++ b/samples/SwitchUserSample/src/com/facebook/samples/switchuser/SettingsFragment.java
@@ -269,7 +269,7 @@ Slot getSlot(int slot) {
 
         private void setSelectedSlotNumber(int slot) {
             // Store the selected slot number for when the app is closed and restarted
-            settings.edit().putInt(SETTINGS_CURRENT_SLOT_KEY, slot).commit();
+            settings.edit().putInt(SETTINGS_CURRENT_SLOT_KEY, slot).apply();
             selectedSlotNumber = slot;
         }
 
