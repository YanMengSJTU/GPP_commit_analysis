diff --git a/core/src/main/java/com/graphhopper/util/shapes/GHPoint3D.java b/core/src/main/java/com/graphhopper/util/shapes/GHPoint3D.java
index cab721686c..56d8a19372 100644
--- a/core/src/main/java/com/graphhopper/util/shapes/GHPoint3D.java
+++ b/core/src/main/java/com/graphhopper/util/shapes/GHPoint3D.java
@@ -57,14 +57,18 @@ public boolean equals( Object obj )
         if (obj == null)
             return false;
 
-        @SuppressWarnings("unchecked")
-        final GHPoint3D other = (GHPoint3D) obj;
-        if (Double.isNaN(ele))
-            // very special case necessary in QueryGraph, asserted via test
-            return NumHelper.equalsEps(lat, other.lat) && NumHelper.equalsEps(lon, other.lon);
-        else
-            return NumHelper.equalsEps(lat, other.lat) && NumHelper.equalsEps(lon, other.lon)
-                    && NumHelper.equalsEps(ele, other.ele);
+        if (obj instanceof GHPoint3D) {
+            @SuppressWarnings("unchecked")
+            final GHPoint3D other = (GHPoint3D) obj;
+            if (Double.isNaN(ele))
+                // very special case necessary in QueryGraph, asserted via test
+                return NumHelper.equalsEps(lat, other.lat) && NumHelper.equalsEps(lon, other.lon);
+            else
+                return NumHelper.equalsEps(lat, other.lat) && NumHelper.equalsEps(lon, other.lon)
+                        && NumHelper.equalsEps(ele, other.ele);
+        } else {
+            return false;
+        }
     }
 
     @Override
