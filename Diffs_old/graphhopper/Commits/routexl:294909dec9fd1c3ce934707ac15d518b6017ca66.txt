diff --git a/.dockerignore b/.dockerignore
new file mode 100644
index 0000000000..191381ee74
--- /dev/null
+++ b/.dockerignore
@@ -0,0 +1 @@
+.git
\ No newline at end of file
diff --git a/.gitattributes b/.gitattributes
index 9229c31f2c..daa2b71758 100644
--- a/.gitattributes
+++ b/.gitattributes
@@ -3,8 +3,9 @@
 
 # Explicitly declare text files we want to always be normalized and converted 
 # to native line endings on checkout.
-*.sh text
+*.css text
+*.html text
 *.java text
-*.xml text
 *.js text
-*.css text
\ No newline at end of file
+*.sh text
+*.xml text
diff --git a/.github/CONTRIBUTING.md b/.github/CONTRIBUTING.md
index f7c4b04192..62f766591c 100644
--- a/.github/CONTRIBUTING.md
+++ b/.github/CONTRIBUTING.md
@@ -34,9 +34,11 @@ keep in mind that this requires storing your Email there. The same applies if yo
 Note, our CLA does not influence your rights on your contribution but it makes sure for others that you agree to the Apache License, Version 2.
 After this you'll appear in the <a href="CONTRIBUTORS.md">contributors list</a> and your pull request can also be discussed technically.
 
+For companies that would like that their developers work for us, we need an additional [corporate CLA signed](https://graphhopper.com/agreements/corporate-cla.html).
+
 ## Code formatting
 
-We use IntelliJ defaults and a very similar configuration for NetBeans defined in the root pom.xml. Also for other IDEs 
+We use IntelliJ defaults and a very similar configuration for NetBeans defined in the root pom.xml. For eclipse there is this [configuration](https://github.com/graphhopper/graphhopper/files/481920/GraphHopper.Formatter.zip). Also for other IDEs 
 it should be simple to match:
 
  * Java indent is 4 spaces
diff --git a/.gitignore b/.gitignore
index fd877b1f67..421982e426 100644
--- a/.gitignore
+++ b/.gitignore
@@ -41,3 +41,5 @@ local.properties
 .DS_Store
 /core/nbproject/
 /reader-overlay-data/nbproject/
+!malta-latest.osm.pbf
+/reader-json/nbproject/
diff --git a/.jitpack.yml b/.jitpack.yml
new file mode 100644
index 0000000000..266d72be4f
--- /dev/null
+++ b/.jitpack.yml
@@ -0,0 +1,2 @@
+jdk:
+  - oraclejdk8
diff --git a/.travis.yml b/.travis.yml
index e8040b6cc7..120fa58565 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,12 +1,68 @@
 language: java
+sudo: false
+matrix:
+  fast_finish: true
+  include:
+      # Java 9 needs to be manually installed/upgraded
+      # see: https://github.com/travis-ci/travis-ci/issues/2968#issuecomment-149164058
+    - jdk: oraclejdk9
+      env: JVM=latest
+      sudo: required
+      dist: trusty
+      group: edge
+  allow_failures:
+    - jdk: oraclejdk9
+
+env:
+  global:
+    - BASEURL=https://www-eu.apache.org/dist/maven/maven-3/VERSION/binaries/apache-maven-VERSION-bin.zip
+    - FILE=apache-maven-VERSION-bin.zip
+    - DIR=apache-maven-VERSION
+    - VERSION=3.3.9
+    - secure: "j6a61/qnfFcSjx5XxmxO2hqBOwtVx5HWrD1+4Atl7WG/pRKz9+jSga1Y7oDAFb2SIl8S65kDmPQB/vC8aHxUDj/Wizjxnxn1FhPqoe9yO6Ztft+984FKFyvj7s6tsBJKcehGec+chTOwZQpH4oI4rU6IlepDHnGLHiOd0Iviryg="
+    - secure: "GiFr+v2lTQk/sTQB7CYjju1/mupS8LSJupmizLqY454utiZkabDMBOZQnF9ukpy7WhveB9hKQyEKf9iP2w7HSYEjgvogT26vZ5f2MeLnR4SWvqEtf/WBvvh+W+k/rb2f6YgitkB4Jlxn2izemBEDuKplGJphzGW41lf8XZ2IxVI="
+
 jdk:
   - oraclejdk8
-# do not install anything instead return true via unix command true
+
+before_install:
+   # update maven
+   - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
+         wget --no-check-certificate $(echo -n $BASEURL | sed -e 's#VERSION#'$VERSION'#g');
+         unzip -qq $(echo -n $FILE | sed -e 's#VERSION#'$VERSION'#');
+         export M2_HOME=$PWD/$(echo -n $DIR | sed -e 's#VERSION#'$VERSION'#');
+         export PATH=$M2_HOME/bin:$PATH;
+     fi
+   # update java 9
+   - if [ "$TRAVIS_OS_NAME" == "linux" ] && [ "$JVM" == "latest" ]; then
+         sudo apt-get update -qq;
+         sudo /bin/echo -e oracle-java9-installer shared/accepted-oracle-license-v1-1 select true | sudo debconf-set-selections;
+         sudo apt-get -o Dpkg::Options::="--force-confnew" install -y oracle-java9-installer oracle-java9-set-default oracle-java9-unlimited-jce-policy;
+         sudo update-java-alternatives -s java-9-oracle;
+     fi
+#   - if [ "$TRAVIS_JDK_VERSION" == oraclejdk9 ]; then
+#         sudo rm /etc/mavenrc;
+#     fi
+
 install: true
-script: ./core/files/travis-build.sh
+
+script:
+  - mvn clean test verify -B
+
+after_success:
+  # deploy snapshot artifacts to maven central
+  - if [ "$TRAVIS_JDK_VERSION" == "oraclejdk8" ] &&
+       [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
+         travis_wait mvn deploy --settings core/files/settings.xml -DskipTests=true -B;
+    else
+        echo "Not deploying snapshot artifact for $TRAVIS_BRANCH";
+    fi
+
 notifications:
   email:
     - github@graphhopper.com
 
-# enable container-based stack
-sudo: false
+cache:
+  directories:
+  - $HOME/.m2
+
diff --git a/CONTRIBUTORS.md b/CONTRIBUTORS.md
index d96b6f5aee..317909fbd6 100644
--- a/CONTRIBUTORS.md
+++ b/CONTRIBUTORS.md
@@ -14,6 +14,7 @@ Most of the contributors are mentioned at Github as [Members](https://github.com
  * dardin88, instructions improved
  * dewos, web API bug fixes
  * devemux86, improvements regarding Android, GPX and more
+ * edy, improvements regarding docker #849
  * elibar, fix for alternative route calculation
  * dos65, bug fixes in routing algo
  * drnextgis, ru translation and JS fixes
@@ -32,16 +33,20 @@ Most of the contributors are mentioned at Github as [Members](https://github.com
  * karussell, one of the core developers
  * khuebner, initial turn costs support
  * lmar, improved instructions
+ * michaz, public transport
+ * mprins, improvements for travis CI and regarding JDK9 #806
  * NopMap, massive improvements regarding OSM, parsing and encoding, route relations
  * ocampana, initial implementation for instructions
+ * PGWelch, shapefile reader #874
  * ratrun, route relations, GPX information, bike handling etc
  * rajanski, script to do routing via PostGIS
  * rodneyodonnell, improved dead end removal and fords
  * rodo, more descriptions
- * seeebiii, motorcycle improvements 
+ * seeebiii, motorcycle improvements
+ * stefanholder, Stefan Holder, BMW AG, refactored unfavoring of virtual edges #885
  * Svantulden, improved documentation and nearest API
  * thehereward, code cleanups like #620
- * vvikas, ideas for many to many improvements
+ * vvikas, ideas for many to many improvements and #616
 
 ## Translations
 
diff --git a/Dockerfile b/Dockerfile
new file mode 100644
index 0000000000..d592a049ed
--- /dev/null
+++ b/Dockerfile
@@ -0,0 +1,13 @@
+FROM openjdk:8-jdk
+
+RUN mkdir -p /data
+
+COPY . /graphhopper/
+
+RUN cd /graphhopper && \
+    ./graphhopper.sh buildweb
+
+WORKDIR /graphhopper
+VOLUME ["/data"]
+
+EXPOSE 8989
diff --git a/NOTICE.md b/NOTICE.md
index 2ef950426a..e74c28e66d 100644
--- a/NOTICE.md
+++ b/NOTICE.md
@@ -1,33 +1,44 @@
 GraphHopper licensed under the Apache license, Version 2.0
 
-Copyright 2012 - 2016 GraphHopper GmbH
+Copyright 2012 - 2017 GraphHopper GmbH
 
 The core module includes the following software:
 
  * slf4j.org - SLF4J distributed under the MIT license. 
- * trove.starlight-systems.com - GNU Trove library (LGPL license)
+ * hppc (Apache license)
  * SparseArray from the Android project (Apache license)
  * Snippets regarding mmap, vint/vlong and compression from Lucene (Apache license)
+ * XMLGraphics-Commons for CGIAR elevation files (Apache License)
+ * Apache Commons Lang - we copied the implementation of the Levenshtein Distance (Apache License)
+ * Apache Commons Collections - we copied parts of the BinaryHeap (Apache License)
+ * java-string-similarity - we copied the implementation of JaroWinkler (MIT license)
+
+reader-osm:
+
  * protobuf - New BSD license
  * OSM-binary - LGPL license
  * Osmosis - public domain, see osmosis-copying.txt under core/files
- * XMLGraphics-Commons for CGIAR elevation files - (Apache License)
 
-tools:
+reader-overlay-data:
 
- * apache-compress
+ * com.google.code.gson:gson (Apache license)
 
-tools-lgpl:
+reader-shp:
+ 
+ * org.geotools:gt-shapefile (LGPL)
+
+tools:
 
- * tools from OpenTripPlanner licensed under LGPL
+ * uses Apache Compress (Apache license)
 
 web:
 
  * org.json, MIT style license
- * com.google.inject, Apache License 2.0
+ * com.google.inject (Apache license)
  * images from mapbox https://www.mapbox.com/maki/, BSD License, see core/files
 
 android:
 
- * android, Apache License 2.0
+ * android (Apache license)
  * org.mapsforge, LGPL
+ * VTM, LGPL
diff --git a/README.md b/README.md
index 9d93635a7d..eefd15b61d 100644
--- a/README.md
+++ b/README.md
@@ -11,7 +11,7 @@ We have a prosper community and welcome everyone. Let us know your problems, use
 
 ## Get Started
 
-To get started read through our documentation ([0.7](https://github.com/graphhopper/graphhopper/blob/0.7/docs/index.md), [unstable](https://github.com/graphhopper/graphhopper/blob/master/docs/index.md)). 
+To get started read through our documentation ([0.8](https://github.com/graphhopper/graphhopper/blob/0.8/docs/index.md), [unstable](https://github.com/graphhopper/graphhopper/blob/master/docs/index.md)). 
 
 ## Questions
 
@@ -51,13 +51,16 @@ Furthermore it allows you to use
 **speed mode** and in contrast to the speed mode we call everything without CH the
 **flexibility mode**. BTW: This does not mean that the flexibility mode is *slow*.
 
-The speed mode comes with much faster and lightweight (less RAM) responses and that although it does not use heuristics in its default settings. The downsides are that the speed mode allows only pre-defined vehicle profiles (multiple possible in GraphHopper) and requires a time consuming and resource intense preparation. And implementing certain features are not possible or very complex compared to the flexibility mode. 
+The speed mode comes with much faster and lightweight (less RAM) responses and that although it does not use heuristics in its default settings. 
+The downsides are that the speed mode allows only pre-defined vehicle profiles (multiple possible in GraphHopper) 
+and requires a time consuming and resource intense preparation. And implementing certain features are not possible 
+or very complex compared to the flexibility mode. 
 
 You can use both modes at the same time.
 
 ## License
 
-We chose the Apache License to make it easy for you to embed GraphHopper in your products.
+We chose the Apache License to make it easy for you to embed GraphHopper in your products, even closed source.
 We suggest to contribute back your changes, as GraphHopper evolves fast,
 but of course this is not necessary.
 
@@ -66,17 +69,30 @@ but of course this is not necessary.
 OpenStreetMap is directly supported from GraphHopper. Without the amazing data from
 OpenStreetMap GraphHopper wouldn't be possible at all.
 Other map data will need a custom import procedure, see e.g. <a href="https://github.com/graphhopper/graphhopper/issues/277">Ordnance Survey</a>,
-<a href="https://github.com/graphhopper/graphhopper/pull/616">Shapefile like ESRI</a> or <a href="https://github.com/knowname/morituri">Navteq</a>.
+<a href="https://github.com/graphhopper/graphhopper/tree/master/reader-shp">Shapefile like ESRI</a> or <a href="https://github.com/knowname/morituri">Navteq</a>.
 
 ## Written in Java
 
 GraphHopper is written in Java and runs on Linux, Mac OS X,
-Windows, BSD, Solaris, Raspberry Pi,  Android, Blackberry and even iOS. Other 
-environments which supports at least Java 7 will work too.
+Windows, BSD, Solaris, Raspberry Pi, Android, Blackberry and even iOS.
+
+### Maven
+
+Embed the core of GraphHopper into your Java application via the following
+snippet
+
+```xml
+<dependency>
+    <groupId>com.graphhopper</groupId>
+    <artifactId>graphhopper-core</artifactId>
+    <version>0.8.2</version>
+</dependency>
+```
 
 ## Customizable
 
-We've build the GraphHopper class which makes simple things easy and complex things like multi-modal routing possible. Still you can use the low level API of GraphHopper and you'll see that
+We've build the GraphHopper class which makes simple things easy and complex things like multi-modal routing possible. 
+Still you can use the low level API of GraphHopper and you'll see that
 it was created to allow fast and memory efficient use of the underlying datastructures and algorithms.
 
 ### Android / Blackberry
@@ -102,6 +118,10 @@ E.g. you could use the rough user interface called MiniGraphUI provided in the t
 visualizations done with it [here](https://graphhopper.com/blog/2016/01/19/alternative-roads-to-rome/).
 A fast and production ready map visualization for the Desktop can be easily implemented via mapsforge.
 
+### Docker
+
+Install GraphHopper via [Docker](https://github.com/graphhopper/graphhopper/pull/849).
+
 # Features
 
 Here is a list of the more detailed features including a link to the documentation:
@@ -112,16 +132,17 @@ Here is a list of the more detailed features including a link to the documentati
  * GraphHopper is fast. And with the so called "Contraction Hierarchies" it can be even faster (enabled by default).
  * Memory efficient data structures, algorithms and [the low and high level API](./docs/core/low-level-api.md) is tuned towards ease of use and efficiency
  * Provides a simple [web API](./docs/web/api-doc.md) including JavaScript and Java clients
+ * Multiple weightings (fastest/shortest/...) and pre-built routing profiles: car, bike, racingbike, mountain bike, foot, motorcycle, ...
  * Offers turn instructions in more than 35 languages, contribute or improve [here](./docs/core/translations.md)
  * Displays and takes into account [elevation data](./docs/core/elevation.md) (per default disabled)
  * Can apply [real time changes to edge weights](https://graphhopper.com/blog/2015/04/08/visualize-and-handle-traffic-information-with-graphhopper-in-real-time-for-cologne-germany-koln/) (flexibility only)
- * Customized routing profiles per request (flexibility only)
+ * Customize vehicle profiles per request (flexibility only)
  * Possibility to specify a '[heading parameter](./docs/core/routing.md)' for start, end and via points for navigation applications via `pass_through` or `heading` parameters (flexibility only)
- * [alternative routes](https://discuss.graphhopper.com/t/alternative-routes/424) (flexibility only)
- * [turn costs and restrictions](https://github.com/graphhopper/graphhopper/pull/55#issuecomment-31089096) (flexibility only)
- * multiple profiles and weightings (flexibility and speed mode since 0.5)
- * several pre-built routing profiles: car, bike, racingbike, mountain bike, foot, motorcycle
- * the core uses only a few dependencies (trove4j and slf4j)
- * scales from small indoor-sized to world-wide-sized graphs
+ * [Alternative routes](https://discuss.graphhopper.com/t/alternative-routes/424) (flexibility only)
+ * [Turn costs and restrictions](https://github.com/graphhopper/graphhopper/pull/55#issuecomment-31089096) (flexibility only)
+ * Multiple profiles and weightings (flexibility and speed mode)
+ * Several pre-built routing profiles: car, bike, racingbike, mountain bike, foot, motorcycle, ...
+ * The core uses only a few dependencies (trove4j and slf4j)
+ * Scales from small indoor-sized to world-wide-sized graphs
  * Find nearest point on street e.g. to get elevation or 'snapp to road'
- * Enables the [map matching component](https://github.com/graphhopper/map-matching) (flexibility only)
+ * Do [map matching](https://github.com/graphhopper/map-matching) with GraphHopper (flexibility only)
diff --git a/android/README.md b/android/README.md
index f896af0373..d7be6f08b8 100644
--- a/android/README.md
+++ b/android/README.md
@@ -1,6 +1,5 @@
-This maven module can be used for various IDEs like NetBeans or Eclipse to
-make GraphHopper offline routing working on Android. For offline
-maps the mapsforge project is used. For more information see the 
-[android docs](https://github.com/graphhopper/graphhopper/blob/master/docs/android/index.md).
+# Android Demo
 
-![simple routing](http://karussell.files.wordpress.com/2012/09/graphhopper-android.png)
+Please visit the documentation [here](../docs/android/index.md)
+
+![simple routing](https://graphhopper.com/blog/wp-content/uploads/2016/10/android-demo-screenshot-2.png)
\ No newline at end of file
diff --git a/android/app/build.gradle b/android/app/build.gradle
index f18e75a378..2487373b34 100644
--- a/android/app/build.gradle
+++ b/android/app/build.gradle
@@ -1,8 +1,8 @@
 apply plugin: 'com.android.application'
 
 android {
-    compileSdkVersion 24
-    buildToolsVersion "24.0.2"
+    compileSdkVersion 25
+    buildToolsVersion "25.0.2"
 
     defaultConfig {
         applicationId "com.graphhopper.android"
@@ -35,17 +35,22 @@ configurations.all {
  **/
 
 dependencies {
-    compile(group: 'com.graphhopper', name: 'graphhopper', version: '0.8-SNAPSHOT') {
+    compile(group: 'com.graphhopper', name: 'graphhopper-core', version: '0.9-SNAPSHOT') {
        exclude group: 'com.google.protobuf', module: 'protobuf-java'
        exclude group: 'org.openstreetmap.osmosis', module: 'osmosis-osm-binary'
        exclude group: 'org.apache.xmlgraphics', module: 'xmlgraphics-commons'
     }
 
-    compile group: 'org.mapsforge', name: 'mapsforge-core', version: '0.6.1'
-    compile group: 'org.mapsforge', name: 'mapsforge-map', version: '0.6.1'
-    compile group: 'org.mapsforge', name: 'mapsforge-map-android', version: '0.6.1'
-    compile group: 'org.mapsforge', name: 'mapsforge-map-reader', version: '0.6.1'
-
-    compile group: 'org.slf4j', name: 'slf4j-android', version: '1.7.12'
-    compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.12'
+    compile 'org.mapsforge:vtm:0.6.0'
+    compile 'org.mapsforge:vtm-android:0.6.0'
+    compile 'org.mapsforge:vtm-android:0.6.0:natives-armeabi'
+    compile 'org.mapsforge:vtm-android:0.6.0:natives-armeabi-v7a'
+    compile 'org.mapsforge:vtm-android:0.6.0:natives-x86'
+    compile 'org.mapsforge:vtm-jts:0.6.0'
+    compile 'org.mapsforge:vtm-themes:0.6.0'
+    compile 'com.caverock:androidsvg:1.2.2-beta-1'
+    compile 'com.vividsolutions:jts:1.13'
+
+    compile 'org.slf4j:slf4j-api:1.7.21'
+    compile 'org.slf4j:slf4j-android:1.7.21'
 }
diff --git a/android/app/pom.xml b/android/app/pom.xml
index 99cb632bf6..7a94ad7ac1 100644
--- a/android/app/pom.xml
+++ b/android/app/pom.xml
@@ -4,7 +4,7 @@
     <modelVersion>4.0.0</modelVersion>
     <groupId>com.graphhopper</groupId>
     <artifactId>graphhopper-android</artifactId>
-    <version>0.8-SNAPSHOT</version>
+    <version>0.9-SNAPSHOT</version>
     <name>GraphHopper Android</name>
     <packaging>apk</packaging>    
     <organization>
@@ -16,10 +16,10 @@
         <relativePath>../..</relativePath>
         <groupId>com.graphhopper</groupId>
         <artifactId>graphhopper-parent</artifactId>    	
-        <version>0.8-SNAPSHOT</version>
+        <version>0.9-SNAPSHOT</version>
     </parent>
     <properties>
-        <mapsforge.version>0.6.1</mapsforge.version>
+        <vtm.version>0.6.0</vtm.version>
         <!-- do not put the properties here as it differs from dev to dev <android.sdk.path>/home/peterk/Programme/android-sdk-linux_x86</android.sdk.path>
         instead use your IDE to set it up or specify android sdk via command line
         using -Dandroid.sdk.path=... or by setting environment variable ANDROID_HOME
@@ -46,24 +46,54 @@
         -->          
         <dependency>
             <groupId>org.mapsforge</groupId>            
-            <artifactId>mapsforge-core</artifactId>
-            <version>${mapsforge.version}</version>
+            <artifactId>vtm</artifactId>
+            <version>${vtm.version}</version>
         </dependency>    
         <dependency>
             <groupId>org.mapsforge</groupId>            
-            <artifactId>mapsforge-map</artifactId>
-            <version>${mapsforge.version}</version>
+            <artifactId>vtm-android</artifactId>
+            <version>${vtm.version}</version>
         </dependency>
+        
         <dependency>
             <groupId>org.mapsforge</groupId>            
-            <artifactId>mapsforge-map-android</artifactId>
-            <version>${mapsforge.version}</version>
+            <artifactId>vtm-android</artifactId>
+            <version>${vtm.version}</version>
+            <classifier>natives-armeabi</classifier>
+        </dependency>  
+         <dependency>
+            <groupId>org.mapsforge</groupId>            
+            <artifactId>vtm-android</artifactId>
+            <version>${vtm.version}</version>
+            <classifier>natives-armeabi-v7a</classifier>
+        </dependency>  
+         <dependency>
+            <groupId>org.mapsforge</groupId>            
+            <artifactId>vtm-android</artifactId>
+            <version>${vtm.version}</version>
+            <classifier>natives-x86</classifier>
         </dependency>        
+        
         <dependency>
             <groupId>org.mapsforge</groupId>            
-            <artifactId>mapsforge-map-reader</artifactId>
-            <version>${mapsforge.version}</version>
+            <artifactId>vtm-jts</artifactId>
+            <version>${vtm.version}</version>
         </dependency>
+        <dependency>
+            <groupId>org.mapsforge</groupId>            
+            <artifactId>vtm-themes</artifactId>
+            <version>${vtm.version}</version>
+        </dependency> 
+        <dependency>
+            <groupId>com.caverock</groupId>            
+            <artifactId>androidsvg</artifactId>
+            <version>1.2.2-beta-1</version>
+        </dependency> 
+        <dependency>
+            <groupId>com.vividsolutions</groupId>            
+            <artifactId>jts</artifactId>
+            <version>1.13</version>            
+        </dependency> 
         
         <dependency>
             <groupId>org.slf4j</groupId>
@@ -110,15 +140,15 @@
                 </configuration>
             </plugin>       
             <plugin>
-                <!-- See http://code.google.com/p/maven-android-plugin/ -->
-                <groupId>com.jayway.maven.plugins.android.generation2</groupId>
+                <!-- See http://simpligility.github.io/android-maven-plugin/ -->
+                <groupId>com.simpligility.maven.plugins</groupId>
                 <artifactId>android-maven-plugin</artifactId>
-                <version>4.0.0-rc.2</version>
+                <version>4.4.3</version>
                 <extensions>true</extensions>
                 <configuration>
                     <sdk>
                         <!-- platform or api level (api level 8 = platform 2.2) -->                        
-                        <platform>22</platform>
+                        <platform>25</platform>
                     </sdk>
                     <deleteConflictingFiles>true</deleteConflictingFiles>
                     <undeployBeforeDeploy>true</undeployBeforeDeploy>
diff --git a/android/app/src/main/AndroidManifest.xml b/android/app/src/main/AndroidManifest.xml
index aa1cea3964..c407c842d2 100644
--- a/android/app/src/main/AndroidManifest.xml
+++ b/android/app/src/main/AndroidManifest.xml
@@ -3,7 +3,7 @@
     android:versionCode="1"
     android:versionName="0.1" >
 
-    <!-- mapsforge cache and saving maps -->
+    <!-- saving maps -->
     <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
 
     <!-- necessary to easily download maps via wifi -->
@@ -15,15 +15,14 @@
         android:targetSdkVersion="22" />
 
     <application
-        android:hardwareAccelerated="false"
-        android:allowBackup="true"        
+        android:allowBackup="true"
         android:icon="@drawable/logo"
         android:label="@string/app_name"
         android:theme="@style/AppTheme" >
         <activity
             android:name=".MainActivity"
             android:label="@string/title_activity_main"
-            android:screenOrientation="portrait" >
+            android:configChanges="keyboardHidden|orientation|screenSize">
             <intent-filter>
                 <action android:name="android.intent.action.MAIN" />
 
diff --git a/android/app/src/main/java/com/graphhopper/android/MainActivity.java b/android/app/src/main/java/com/graphhopper/android/MainActivity.java
index 29b48f29d4..9f2b708422 100644
--- a/android/app/src/main/java/com/graphhopper/android/MainActivity.java
+++ b/android/app/src/main/java/com/graphhopper/android/MainActivity.java
@@ -3,7 +3,6 @@
 import android.app.Activity;
 import android.app.ProgressDialog;
 import android.content.Intent;
-import android.graphics.Color;
 import android.graphics.Path;
 import android.graphics.drawable.Drawable;
 import android.net.Uri;
@@ -17,33 +16,49 @@
 import android.view.View;
 import android.view.View.OnClickListener;
 import android.view.Window;
-import android.widget.*;
+import android.widget.ArrayAdapter;
+import android.widget.Button;
+import android.widget.EditText;
+import android.widget.Spinner;
+import android.widget.TextView;
+import android.widget.Toast;
+
 import com.graphhopper.GHRequest;
 import com.graphhopper.GHResponse;
 import com.graphhopper.GraphHopper;
 import com.graphhopper.PathWrapper;
-import com.graphhopper.util.Parameters.*;
-import org.mapsforge.core.graphics.Bitmap;
-import org.mapsforge.core.graphics.Paint;
-import org.mapsforge.core.graphics.Style;
-import org.mapsforge.core.model.LatLong;
-import org.mapsforge.core.model.MapPosition;
-import org.mapsforge.core.model.Point;
-import org.mapsforge.map.android.graphics.AndroidGraphicFactory;
-import org.mapsforge.map.android.util.AndroidUtil;
-import org.mapsforge.map.android.view.MapView;
-import org.mapsforge.map.datastore.MapDataStore;
-import org.mapsforge.map.layer.Layers;
-import org.mapsforge.map.layer.cache.TileCache;
-import org.mapsforge.map.layer.overlay.Marker;
-import org.mapsforge.map.layer.overlay.Polyline;
-import org.mapsforge.map.layer.renderer.TileRendererLayer;
-import org.mapsforge.map.reader.MapFile;
-import org.mapsforge.map.rendertheme.InternalRenderTheme;
+import com.graphhopper.util.Constants;
+import com.graphhopper.util.Helper;
+import com.graphhopper.util.Parameters.Algorithms;
+import com.graphhopper.util.Parameters.Routing;
+import com.graphhopper.util.PointList;
+import com.graphhopper.util.ProgressListener;
+import com.graphhopper.util.StopWatch;
+
+import org.oscim.android.MapView;
+import org.oscim.android.canvas.AndroidGraphics;
+import org.oscim.backend.canvas.Bitmap;
+import org.oscim.core.GeoPoint;
+import org.oscim.core.Tile;
+import org.oscim.event.Gesture;
+import org.oscim.event.GestureListener;
+import org.oscim.event.MotionEvent;
+import org.oscim.layers.Layer;
+import org.oscim.layers.marker.ItemizedLayer;
+import org.oscim.layers.marker.MarkerItem;
+import org.oscim.layers.marker.MarkerSymbol;
+import org.oscim.layers.tile.buildings.BuildingLayer;
+import org.oscim.layers.tile.vector.VectorTileLayer;
+import org.oscim.layers.tile.vector.labeling.LabelLayer;
+import org.oscim.layers.vector.PathLayer;
+import org.oscim.layers.vector.geometries.Style;
+import org.oscim.theme.VtmThemes;
+import org.oscim.tiling.source.mapfile.MapFileTileSource;
 
 import java.io.File;
 import java.io.FilenameFilter;
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.List;
 import java.util.Map;
 import java.util.TreeMap;
@@ -52,8 +67,8 @@
     private static final int NEW_MENU_ID = Menu.FIRST + 1;
     private MapView mapView;
     private GraphHopper hopper;
-    private LatLong start;
-    private LatLong end;
+    private GeoPoint start;
+    private GeoPoint end;
     private Spinner localSpinner;
     private Button localButton;
     private Spinner remoteSpinner;
@@ -65,9 +80,10 @@
     private String prefixURL = fileListURL;
     private String downloadURL;
     private File mapsFolder;
-    private TileCache tileCache;
+    private ItemizedLayer<MarkerItem> itemizedLayer;
+    private PathLayer pathLayer;
 
-    protected boolean onMapTap(LatLong tapLatLong) {
+    protected boolean onLongPress(GeoPoint p) {
         if (!isReady())
             return false;
 
@@ -75,30 +91,24 @@ protected boolean onMapTap(LatLong tapLatLong) {
             logUser("Calculation still in progress");
             return false;
         }
-        Layers layers = mapView.getLayerManager().getLayers();
 
         if (start != null && end == null) {
-            end = tapLatLong;
+            end = p;
             shortestPathRunning = true;
-            Marker marker = createMarker(tapLatLong, R.drawable.flag_red);
-            if (marker != null) {
-                layers.add(marker);
-            }
+            itemizedLayer.addItem(createMarkerItem(p, R.drawable.marker_icon_red));
+            mapView.map().updateMap(true);
 
-            calcPath(start.latitude, start.longitude, end.latitude,
-                    end.longitude);
+            calcPath(start.getLatitude(), start.getLongitude(), end.getLatitude(),
+                    end.getLongitude());
         } else {
-            start = tapLatLong;
+            start = p;
             end = null;
-            // remove all layers but the first one, which is the map
-            while (layers.size() > 1) {
-                layers.remove(1);
-            }
+            // remove routing layers
+            mapView.map().layers().remove(pathLayer);
+            itemizedLayer.removeAllItems();
 
-            Marker marker = createMarker(start, R.drawable.flag_green);
-            if (marker != null) {
-                layers.add(marker);
-            }
+            itemizedLayer.addItem(createMarkerItem(start, R.drawable.marker_icon_green));
+            mapView.map().updateMap(true);
         }
         return true;
     }
@@ -108,14 +118,9 @@ protected void onCreate(Bundle savedInstanceState) {
         requestWindowFeature(Window.FEATURE_NO_TITLE);
         super.onCreate(savedInstanceState);
         setContentView(R.layout.main);
-        AndroidGraphicFactory.createInstance(getApplication());
 
+        Tile.SIZE = Tile.calculateTileSize(getResources().getDisplayMetrics().scaledDensity);
         mapView = new MapView(this);
-        mapView.setClickable(true);
-        mapView.setBuiltInZoomControls(true);
-
-        tileCache = AndroidUtil.createTileCache(this, getClass().getSimpleName(), mapView.getModel().displayModel.getTileSize(),
-                1f, mapView.getModel().frameBufferModel.getOverdrawFactor());
 
         final EditText input = new EditText(this);
         input.setText(currentArea);
@@ -146,6 +151,18 @@ protected void onCreate(Bundle savedInstanceState) {
         chooseAreaFromLocal();
     }
 
+    @Override
+    protected void onResume() {
+        super.onResume();
+        mapView.onResume();
+    }
+
+    @Override
+    protected void onPause() {
+        super.onPause();
+        mapView.onPause();
+    }
+
     @Override
     protected void onDestroy() {
         super.onDestroy();
@@ -156,9 +173,8 @@ protected void onDestroy() {
         // necessary?
         System.gc();
 
-        // Cleanup Mapsforge
-        this.mapView.destroyAll();
-        AndroidGraphicFactory.clearResourceMemoryCache();
+        // Cleanup VTM
+        mapView.map().destroy();
     }
 
     boolean isReady() {
@@ -190,20 +206,18 @@ public boolean accept(File dir, String filename) {
                         .endsWith("-gh"));
             }
         });
-        for (String file : files) {
-            nameList.add(file);
-        }
+        Collections.addAll(nameList, files);
 
         if (nameList.isEmpty())
             return;
 
         chooseArea(localButton, localSpinner, nameList,
                 new MySpinnerListener() {
-            @Override
-            public void onSelect(String selectedArea, String selectedFile) {
-                initFiles(selectedArea);
-            }
-        });
+                    @Override
+                    public void onSelect(String selectedArea, String selectedFile) {
+                        initFiles(selectedArea);
+                    }
+                });
     }
 
     private void chooseAreaFromRemote() {
@@ -311,11 +325,11 @@ protected Object saveDoInBackground(Void... _ignore)
                 downloader.setTimeout(30000);
                 downloader.downloadAndUnzip(downloadURL, localFolder,
                         new ProgressListener() {
-                    @Override
-                    public void update(long val) {
-                        publishProgress((int) val);
-                    }
-                });
+                            @Override
+                            public void update(long val) {
+                                publishProgress((int) val);
+                            }
+                        });
                 return null;
             }
 
@@ -339,21 +353,25 @@ protected void onPostExecute(Object _ignore) {
 
     void loadMap(File areaFolder) {
         logUser("loading map");
-        MapDataStore mapDataStore = new MapFile(new File(areaFolder, currentArea + ".map"));
 
-        mapView.getLayerManager().getLayers().clear();
+        // Long press receiver
+        mapView.map().layers().add(new LongPressLayer(mapView.map()));
 
-        TileRendererLayer tileRendererLayer = new TileRendererLayer(tileCache, mapDataStore,
-                mapView.getModel().mapViewPosition, false, true, false, AndroidGraphicFactory.INSTANCE) {
-            @Override
-            public boolean onLongPress(LatLong tapLatLong, Point layerXY, Point tapXY) {
-                return onMapTap(tapLatLong);
-            }
-        };
-        tileRendererLayer.setTextScale(1.5f);
-        tileRendererLayer.setXmlRenderTheme(InternalRenderTheme.OSMARENDER);
-        mapView.getModel().mapViewPosition.setMapPosition(new MapPosition(mapDataStore.boundingBox().getCenterPoint(), (byte) 15));
-        mapView.getLayerManager().getLayers().add(tileRendererLayer);
+        // Map file source
+        MapFileTileSource tileSource = new MapFileTileSource();
+        tileSource.setMapFile(new File(areaFolder, currentArea + ".map").getAbsolutePath());
+        VectorTileLayer l = mapView.map().setBaseMap(tileSource);
+        mapView.map().setTheme(VtmThemes.DEFAULT);
+        mapView.map().layers().add(new BuildingLayer(mapView.map(), l));
+        mapView.map().layers().add(new LabelLayer(mapView.map(), l));
+
+        // Markers layer
+        itemizedLayer = new ItemizedLayer<>(mapView.map(), (MarkerSymbol) null);
+        mapView.map().layers().add(itemizedLayer);
+
+        // Map position
+        GeoPoint mapCenter = tileSource.getMapInfo().boundingBox.getCenterPoint();
+        mapView.map().setMapPosition(mapCenter.getLatitude(), mapCenter.getLongitude(), 1 << 15);
 
         setContentView(mapView);
         loadGraphStorage();
@@ -387,28 +405,29 @@ private void finishPrepare() {
         prepareInProgress = false;
     }
 
-    private Polyline createPolyline(PathWrapper response) {
-        Paint paintStroke = AndroidGraphicFactory.INSTANCE.createPaint();
-        paintStroke.setStyle(Style.STROKE);
-        paintStroke.setColor(Color.argb(128, 0, 0xCC, 0x33));
-        paintStroke.setDashPathEffect(new float[]{25, 15});
-        paintStroke.setStrokeWidth(8);
-
-        Polyline line = new Polyline(paintStroke, AndroidGraphicFactory.INSTANCE);
-        List<LatLong> geoPoints = line.getLatLongs();
-        PointList tmp = response.getPoints();
-        for (int i = 0; i < response.getPoints().getSize(); i++) {
-            geoPoints.add(new LatLong(tmp.getLatitude(i), tmp.getLongitude(i)));
-        }
-
-        return line;
+    private PathLayer createPathLayer(PathWrapper response) {
+        Style style = Style.builder()
+                .generalization(Style.GENERALIZATION_SMALL)
+                .strokeColor(0x9900cc33)
+                .strokeWidth(4 * getResources().getDisplayMetrics().density)
+                .build();
+        PathLayer pathLayer = new PathLayer(mapView.map(), style);
+        List<GeoPoint> geoPoints = new ArrayList<>();
+        PointList pointList = response.getPoints();
+        for (int i = 0; i < pointList.getSize(); i++)
+            geoPoints.add(new GeoPoint(pointList.getLatitude(i), pointList.getLongitude(i)));
+        pathLayer.setPoints(geoPoints);
+        return pathLayer;
     }
 
     @SuppressWarnings("deprecation")
-    private Marker createMarker(LatLong p, int resource) {
+    private MarkerItem createMarkerItem(GeoPoint p, int resource) {
         Drawable drawable = getResources().getDrawable(resource);
-        Bitmap bitmap = AndroidGraphicFactory.convertToBitmap(drawable);
-        return new Marker(p, bitmap, 0, -bitmap.getHeight() / 2);
+        Bitmap bitmap = AndroidGraphics.drawableToBitmap(drawable);
+        MarkerSymbol markerSymbol = new MarkerSymbol(bitmap, 0.5f, 1);
+        MarkerItem markerItem = new MarkerItem("", "", p);
+        markerItem.setMarker(markerSymbol);
+        return markerItem;
     }
 
     public void calcPath(final double fromLat, final double fromLon,
@@ -438,8 +457,9 @@ protected void onPostExecute(PathWrapper resp) {
                     logUser("the route is " + (int) (resp.getDistance() / 100) / 10f
                             + "km long, time:" + resp.getTime() / 60000f + "min, debug:" + time);
 
-                    mapView.getLayerManager().getLayers().add(createPolyline(resp));
-                    //mapView.redraw();
+                    pathLayer = createPathLayer(resp);
+                    mapView.map().layers().add(pathLayer);
+                    mapView.map().updateMap(true);
                 } else {
                     logUser("Error:" + resp.getErrors());
                 }
@@ -481,8 +501,8 @@ public boolean onOptionsItemSelected(MenuItem item) {
                 intent.setClassName("com.google.android.apps.maps",
                         "com.google.android.maps.MapsActivity");
                 intent.setData(Uri.parse("http://maps.google.com/maps?saddr="
-                        + start.latitude + "," + start.longitude + "&daddr="
-                        + end.latitude + "," + end.longitude));
+                        + start.getLatitude() + "," + start.getLongitude() + "&daddr="
+                        + end.getLatitude() + "," + end.getLongitude()));
                 startActivity(intent);
                 break;
         }
@@ -492,4 +512,20 @@ public boolean onOptionsItemSelected(MenuItem item) {
     public interface MySpinnerListener {
         void onSelect(String selectedArea, String selectedFile);
     }
+
+    class LongPressLayer extends Layer implements GestureListener {
+
+        LongPressLayer(org.oscim.map.Map map) {
+            super(map);
+        }
+
+        @Override
+        public boolean onGesture(Gesture g, MotionEvent e) {
+            if (g instanceof Gesture.LongPress) {
+                GeoPoint p = mMap.viewport().fromScreenPoint(e.getX(), e.getY());
+                return onLongPress(p);
+            }
+            return false;
+        }
+    }
 }
diff --git a/android/app/src/main/res/drawable-hdpi/marker_icon_green.png b/android/app/src/main/res/drawable-hdpi/marker_icon_green.png
new file mode 100644
index 0000000000..4dd6e35506
Binary files /dev/null and b/android/app/src/main/res/drawable-hdpi/marker_icon_green.png differ
diff --git a/android/app/src/main/res/drawable-hdpi/marker_icon_red.png b/android/app/src/main/res/drawable-hdpi/marker_icon_red.png
new file mode 100644
index 0000000000..364ac35ad1
Binary files /dev/null and b/android/app/src/main/res/drawable-hdpi/marker_icon_red.png differ
diff --git a/android/app/src/main/res/drawable/flag_green.png b/android/app/src/main/res/drawable/flag_green.png
deleted file mode 100644
index e4bc611f87..0000000000
Binary files a/android/app/src/main/res/drawable/flag_green.png and /dev/null differ
diff --git a/android/app/src/main/res/drawable/flag_red.png b/android/app/src/main/res/drawable/flag_red.png
deleted file mode 100644
index e8a602da7b..0000000000
Binary files a/android/app/src/main/res/drawable/flag_red.png and /dev/null differ
diff --git a/android/build.gradle b/android/build.gradle
index 7cf5efcfc9..11a13c7c5b 100644
--- a/android/build.gradle
+++ b/android/build.gradle
@@ -4,7 +4,7 @@ buildscript {
         jcenter()
     }
     dependencies {
-        classpath 'com.android.tools.build:gradle:2.2.0'
+        classpath 'com.android.tools.build:gradle:2.2.3'
     }
 }
 
diff --git a/config-example.properties b/config-example.properties
index 8a94e59c36..a0ccae69e5 100644
--- a/config-example.properties
+++ b/config-example.properties
@@ -53,7 +53,12 @@ prepare.min_one_way_network_size=200
 # A possible attacker might exploit this to slow down your service. Only enable it if you need it and with routing.maxVisitedNodes
 # routing.ch.disabling_allowed=true
 
+# You can limit the max distance between two consecutive waypoints of flexible routing requests to be less or equal
+# the given distance in meter. Default is set to 1000km.
+routing.non_ch.max_waypoint_distance = 1000000
 
+# You can permanently block certain areas from routing
+# e.g. you can block certain areas with block_area=lat1,lon1,lat2,lon2
 
 ##### Web #####
 
diff --git a/core/files/Laufamholzstrasse.osm.xml b/core/files/Laufamholzstrasse.osm.xml
new file mode 100644
index 0000000000..8842c67ff2
--- /dev/null
+++ b/core/files/Laufamholzstrasse.osm.xml
@@ -0,0 +1,7301 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<osm version="0.6" generator="CGImap 0.5.6 (25792 thorn-02.openstreetmap.org)" copyright="OpenStreetMap and contributors" attribution="http://www.openstreetmap.org/copyright" license="http://opendatacommons.org/licenses/odbl/1-0/">
+ <bounds minlat="49.4649900" minlon="11.1519900" maxlat="49.4670200" maxlon="11.1589900"/>
+ <node id="21643335" visible="true" version="6" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611" lat="49.4678148" lon="11.1587184"/>
+ <node id="40790390" visible="true" version="5" changeset="6534085" timestamp="2010-12-04T03:14:15Z" user="kellerma" uid="202858" lat="49.4690217" lon="11.1666526"/>
+ <node id="249773807" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4635639" lon="11.1590576"/>
+ <node id="249773789" visible="true" version="4" changeset="10296216" timestamp="2012-01-04T22:36:47Z" user="pyram" uid="497849" lat="49.4643750" lon="11.1565257">
+  <tag k="highway" v="turning_circle"/>
+ </node>
+ <node id="249773783" visible="true" version="3" changeset="12070289" timestamp="2012-06-30T21:29:44Z" user="pyram" uid="497849" lat="49.4633913" lon="11.1570912"/>
+ <node id="249773882" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611" lat="49.4648500" lon="11.1547462"/>
+ <node id="249773960" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4657142" lon="11.1616838"/>
+ <node id="249846782" visible="true" version="4" changeset="29961708" timestamp="2015-04-03T21:39:03Z" user="pyram" uid="497849" lat="49.4641795" lon="11.1343625"/>
+ <node id="250942529" visible="true" version="2" changeset="521544" timestamp="2008-10-23T02:34:57Z" user="rsl" uid="70581" lat="49.4702168" lon="11.1416463"/>
+ <node id="250942532" visible="true" version="5" changeset="32241699" timestamp="2015-06-27T12:00:04Z" user="kartler175" uid="834127" lat="49.4682926" lon="11.1440414"/>
+ <node id="253128161" visible="true" version="2" changeset="521544" timestamp="2008-10-23T02:34:57Z" user="rsl" uid="70581" lat="49.4705408" lon="11.1388890"/>
+ <node id="265760615" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4677961" lon="11.1443436"/>
+ <node id="265760610" visible="true" version="2" changeset="7720690" timestamp="2011-03-30T21:01:00Z" user="kukuk" uid="346758" lat="49.4687861" lon="11.1460893"/>
+ <node id="265760608" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:23:05Z" user="CaptainCrunch" uid="13363" lat="49.4684778" lon="11.1447018"/>
+ <node id="270963244" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:21Z" user="kellerma" uid="202858" lat="49.4659640" lon="11.1565469"/>
+ <node id="270970193" visible="true" version="3" changeset="14933873" timestamp="2013-02-06T14:06:41Z" user="geodreieck4711" uid="479256" lat="49.4690150" lon="11.1656019"/>
+ <node id="270971206" visible="true" version="3" changeset="26563807" timestamp="2014-11-05T05:17:18Z" user="theophrastos" uid="96069" lat="49.4686335" lon="11.1619183"/>
+ <node id="270973166" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:51:54Z" user="kellerma" uid="202858" lat="49.4654612" lon="11.1530720"/>
+ <node id="270978222" visible="true" version="3" changeset="24231363" timestamp="2014-07-18T22:53:58Z" user="pyram" uid="497849" lat="49.4627456" lon="11.1513716"/>
+ <node id="304292370" visible="true" version="3" changeset="42404513" timestamp="2016-09-24T12:44:15Z" user="pyram" uid="497849" lat="49.4667561" lon="11.1288329"/>
+ <node id="306532161" visible="true" version="1" changeset="521544" timestamp="2008-10-23T02:34:55Z" user="rsl" uid="70581" lat="49.4701722" lon="11.1402916"/>
+ <node id="306532163" visible="true" version="1" changeset="521544" timestamp="2008-10-23T02:34:56Z" user="rsl" uid="70581" lat="49.4697745" lon="11.1400658"/>
+ <node id="309246633" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4682649" lon="11.1377692"/>
+ <node id="339438798" visible="true" version="3" changeset="37987008" timestamp="2016-03-21T21:30:18Z" user="pyram" uid="497849" lat="49.4634773" lon="11.1618585"/>
+ <node id="339438785" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:27Z" user="kellerma" uid="202858" lat="49.4635829" lon="11.1579552"/>
+ <node id="375751464" visible="true" version="3" changeset="37959435" timestamp="2016-03-20T17:00:08Z" user="pyram" uid="497849" lat="49.4603455" lon="11.1618239"/>
+ <node id="375751456" visible="true" version="3" changeset="25678296" timestamp="2014-09-26T05:43:10Z" user="geodreieck4711" uid="479256" lat="49.4605804" lon="11.1618566"/>
+ <node id="411043136" visible="true" version="4" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4607530" lon="11.1633592"/>
+ <node id="411043142" visible="true" version="5" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4637823" lon="11.1720836"/>
+ <node id="411043126" visible="true" version="4" changeset="6762485" timestamp="2010-12-25T17:20:37Z" user="kellerma" uid="202858" lat="49.4635426" lon="11.1579588"/>
+ <node id="411043140" visible="true" version="3" changeset="1886492" timestamp="2009-07-20T17:18:01Z" user="hummellde" uid="147835" lat="49.4611925" lon="11.1668118"/>
+ <node id="411043121" visible="true" version="4" changeset="20808607" timestamp="2014-02-27T13:08:30Z" user="kaddo graffie" uid="517355" lat="49.4648286" lon="11.1505388"/>
+ <node id="411043145" visible="true" version="3" changeset="5791620" timestamp="2010-09-15T22:45:24Z" user="kellerma" uid="202858" lat="49.4677225" lon="11.1805289"/>
+ <node id="419915031" visible="true" version="1" changeset="1508963" timestamp="2009-06-13T22:26:53Z" user="Universalmapper" uid="133024" lat="49.4651363" lon="11.1589239">
+  <tag k="amenity" v="bench"/>
+ </node>
+ <node id="419915032" visible="true" version="1" changeset="1508963" timestamp="2009-06-13T22:26:53Z" user="Universalmapper" uid="133024" lat="49.4651445" lon="11.1589747">
+  <tag k="amenity" v="bench"/>
+ </node>
+ <node id="419915033" visible="true" version="2" changeset="14642788" timestamp="2013-01-13T23:47:47Z" user="pyram" uid="497849" lat="49.4653676" lon="11.1595966"/>
+ <node id="419915035" visible="true" version="2" changeset="14642788" timestamp="2013-01-13T23:47:47Z" user="pyram" uid="497849" lat="49.4654787" lon="11.1582946"/>
+ <node id="419915091" visible="true" version="1" changeset="1508963" timestamp="2009-06-13T22:26:54Z" user="Universalmapper" uid="133024" lat="49.4650122" lon="11.1524681">
+  <tag k="amenity" v="grit_bin"/>
+ </node>
+ <node id="419915039" visible="true" version="2" changeset="12070289" timestamp="2012-06-30T21:29:50Z" user="pyram" uid="497849" lat="49.4644846" lon="11.1565539"/>
+ <node id="419915100" visible="true" version="1" changeset="1508963" timestamp="2009-06-13T22:26:55Z" user="Universalmapper" uid="133024" lat="49.4644920" lon="11.1526040"/>
+ <node id="251402734" visible="true" version="4" changeset="6678528" timestamp="2010-12-16T16:52:01Z" user="kellerma" uid="202858" lat="49.4654858" lon="11.1581874">
+  <tag k="highway" v="turning_circle"/>
+ </node>
+ <node id="419915043" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4651109" lon="11.1558569"/>
+ <node id="171750542" visible="true" version="3" changeset="1508963" timestamp="2009-06-13T22:27:01Z" user="Universalmapper" uid="133024" lat="49.4648962" lon="11.1586224">
+  <tag k="barrier" v="bollard"/>
+ </node>
+ <node id="171750573" visible="true" version="4" changeset="6678528" timestamp="2010-12-16T16:52:30Z" user="kellerma" uid="202858" lat="49.4653386" lon="11.1568511"/>
+ <node id="249773958" visible="true" version="5" changeset="14642788" timestamp="2013-01-13T23:47:47Z" user="pyram" uid="497849" lat="49.4654951" lon="11.1601571"/>
+ <node id="148426975" visible="true" version="7" changeset="15272386" timestamp="2013-03-06T16:11:24Z" user="geodreieck4711" uid="479256" lat="49.4666217" lon="11.1599169">
+  <tag k="crossing" v="uncontrolled"/>
+  <tag k="crossing_ref" v="zebra"/>
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="336271420" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4658489" lon="11.1555366"/>
+ <node id="148436862" visible="true" version="3" changeset="1886492" timestamp="2009-07-20T17:18:03Z" user="hummellde" uid="147835" lat="49.4665888" lon="11.1537500"/>
+ <node id="171750535" visible="true" version="5" changeset="35079420" timestamp="2015-11-04T14:22:35Z" user="marek kleciak" uid="338611" lat="49.4648561" lon="11.1585886"/>
+ <node id="171750538" visible="true" version="5" changeset="17165139" timestamp="2013-07-31T11:54:16Z" user="geodreieck4711" uid="479256" lat="49.4650976" lon="11.1584998"/>
+ <node id="171750546" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:16Z" user="geodreieck4711" uid="479256" lat="49.4647281" lon="11.1572963"/>
+ <node id="419915132" visible="true" version="2" changeset="1522845" timestamp="2009-06-15T09:58:45Z" user="Universalmapper" uid="133024" lat="49.4666525" lon="11.1551988"/>
+ <node id="419915133" visible="true" version="2" changeset="1522845" timestamp="2009-06-15T09:58:45Z" user="Universalmapper" uid="133024" lat="49.4666360" lon="11.1563490"/>
+ <node id="148436873" visible="true" version="4" changeset="5833180" timestamp="2010-09-20T21:31:32Z" user="kellerma" uid="202858" lat="49.4666755" lon="11.1542261"/>
+ <node id="411043154" visible="true" version="3" changeset="1886492" timestamp="2009-07-20T17:18:04Z" user="hummellde" uid="147835" lat="49.4661769" lon="11.1496272"/>
+ <node id="419878681" visible="true" version="3" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4613624" lon="11.1685934"/>
+ <node id="411043147" visible="true" version="6" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4692378" lon="11.1821309"/>
+ <node id="497078299" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4659952" lon="11.1589272"/>
+ <node id="497078294" visible="true" version="3" changeset="14642788" timestamp="2013-01-13T23:47:47Z" user="pyram" uid="497849" lat="49.4656575" lon="11.1590936"/>
+ <node id="501844347" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4659086" lon="11.1593755"/>
+ <node id="501844348" visible="true" version="2" changeset="14642788" timestamp="2013-01-13T23:47:48Z" user="pyram" uid="497849" lat="49.4659175" lon="11.1594229"/>
+ <node id="501844346" visible="true" version="2" changeset="15272871" timestamp="2013-03-06T16:50:50Z" user="geodreieck4711" uid="479256" lat="49.4661729" lon="11.1592401"/>
+ <node id="1428414878" visible="true" version="2" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4700867" lon="11.1673008"/>
+ <node id="1428414886" visible="true" version="2" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4691792" lon="11.1660343"/>
+ <node id="1428414870" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:56Z" user="pyram" uid="497849" lat="49.4669251" lon="11.1550175"/>
+ <node id="1428414871" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:56Z" user="pyram" uid="497849" lat="49.4682708" lon="11.1590515"/>
+ <node id="1428414873" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:56Z" user="pyram" uid="497849" lat="49.4667996" lon="11.1562084"/>
+ <node id="1428414880" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4669530" lon="11.1574009"/>
+ <node id="1428414881" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4669670" lon="11.1539875"/>
+ <node id="1428414883" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4689545" lon="11.1600799"/>
+ <node id="1428414885" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4667996" lon="11.1574653"/>
+ <node id="1428414889" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4690594" lon="11.1649615"/>
+ <node id="1428414892" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4688781" lon="11.1590386"/>
+ <node id="1428414893" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4690329" lon="11.1586717"/>
+ <node id="1428414894" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4686271" lon="11.1602821"/>
+ <node id="1428414895" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4688914" lon="11.1573043"/>
+ <node id="1428414896" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4690657" lon="11.1559847"/>
+ <node id="1428414897" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:57Z" user="pyram" uid="497849" lat="49.4690517" lon="11.1550835"/>
+ <node id="411043150" visible="true" version="4" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4690677" lon="11.1654804"/>
+ <node id="1428414905" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:58Z" user="pyram" uid="497849" lat="49.4687728" lon="11.1558436"/>
+ <node id="1428414906" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:58Z" user="pyram" uid="497849" lat="49.4690099" lon="11.1544167"/>
+ <node id="411043151" visible="true" version="3" changeset="9258457" timestamp="2011-09-09T22:24:59Z" user="pyram" uid="497849" lat="49.4682084" lon="11.1593192"/>
+ <node id="411043152" visible="true" version="3" changeset="9258457" timestamp="2011-09-09T22:24:59Z" user="pyram" uid="497849" lat="49.4666333" lon="11.1562931"/>
+ <node id="521209588" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4660909" lon="11.1588762"/>
+ <node id="521209584" visible="true" version="2" changeset="17166312" timestamp="2013-07-31T13:34:22Z" user="geodreieck4711" uid="479256" lat="49.4635155" lon="11.1629591"/>
+ <node id="521209591" visible="true" version="3" changeset="6521747" timestamp="2010-12-03T01:03:54Z" user="kellerma" uid="202858" lat="49.4664059" lon="11.1587346"/>
+ <node id="521209586" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:13Z" user="kellerma" uid="202858" lat="49.4656946" lon="11.1580816"/>
+ <node id="521209579" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4635200" lon="11.1602520"/>
+ <node id="529675403" visible="true" version="2" changeset="37987008" timestamp="2016-03-21T21:30:18Z" user="pyram" uid="497849" lat="49.4630986" lon="11.1619595"/>
+ <node id="529675405" visible="true" version="2" changeset="37987008" timestamp="2016-03-21T21:30:18Z" user="pyram" uid="497849" lat="49.4631709" lon="11.1619418"/>
+ <node id="529675410" visible="true" version="2" changeset="37987008" timestamp="2016-03-21T21:30:18Z" user="pyram" uid="497849" lat="49.4627081" lon="11.1621322"/>
+ <node id="529675411" visible="true" version="2" changeset="37987008" timestamp="2016-03-21T21:30:18Z" user="pyram" uid="497849" lat="49.4627505" lon="11.1620067"/>
+ <node id="529678584" visible="true" version="2" changeset="9896912" timestamp="2011-11-21T12:57:08Z" user="mogstar" uid="418206" lat="49.4642876" lon="11.1332801"/>
+ <node id="529678564" visible="true" version="2" changeset="42404513" timestamp="2016-09-24T12:44:15Z" user="pyram" uid="497849" lat="49.4666283" lon="11.1285706"/>
+ <node id="529678561" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4631528" lon="11.1275109"/>
+ <node id="529678562" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4637165" lon="11.1289650"/>
+ <node id="529678563" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4660179" lon="11.1291326"/>
+ <node id="529678565" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4667695" lon="11.1288603"/>
+ <node id="529678568" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4617425" lon="11.1304984"/>
+ <node id="529678571" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4625123" lon="11.1315418"/>
+ <node id="529678574" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4621910" lon="11.1311591"/>
+ <node id="529678576" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4619978" lon="11.1307761"/>
+ <node id="529678578" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4630187" lon="11.1334639"/>
+ <node id="529678579" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:39Z" user="rsl" uid="70581" lat="49.4642966" lon="11.1295266"/>
+ <node id="529678582" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4636656" lon="11.1334050"/>
+ <node id="529678583" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4635464" lon="11.1337782"/>
+ <node id="529678587" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4666307" lon="11.1346412"/>
+ <node id="529678588" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4708816" lon="11.1344336"/>
+ <node id="529678589" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4669112" lon="11.1348650"/>
+ <node id="529678590" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4663917" lon="11.1346892"/>
+ <node id="529678592" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4679189" lon="11.1354085"/>
+ <node id="529678593" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4681163" lon="11.1356323"/>
+ <node id="529678594" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4679708" lon="11.1371509"/>
+ <node id="529678597" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4681682" lon="11.1378223"/>
+ <node id="529678607" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4715325" lon="11.1359297"/>
+ <node id="529678609" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:40Z" user="rsl" uid="70581" lat="49.4719464" lon="11.1373251"/>
+ <node id="529678611" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4721751" lon="11.1385697"/>
+ <node id="529678613" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4717067" lon="11.1388546"/>
+ <node id="529678615" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4670192" lon="11.1447575"/>
+ <node id="529678617" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4664807" lon="11.1471003"/>
+ <node id="529678619" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4663171" lon="11.1511174"/>
+ <node id="529678621" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4663543" lon="11.1485633"/>
+ <node id="529678623" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4663863" lon="11.1516494"/>
+ <node id="529678625" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4667533" lon="11.1541621"/>
+ <node id="529678642" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:41Z" user="rsl" uid="70581" lat="49.4670671" lon="11.1566333"/>
+ <node id="529678645" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4684560" lon="11.1588467"/>
+ <node id="529678647" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4717830" lon="11.1414276"/>
+ <node id="529678651" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4722514" lon="11.1421484"/>
+ <node id="529678595" visible="true" version="2" changeset="5760810" timestamp="2010-09-12T15:46:27Z" user="kellerma" uid="202858" lat="49.4686409" lon="11.1386175"/>
+ <node id="529678653" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4724964" lon="11.1440551"/>
+ <node id="529678655" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4737175" lon="11.1522505"/>
+ <node id="529678656" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4692326" lon="11.1675224"/>
+ <node id="529678657" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4693815" lon="11.1655663"/>
+ <node id="529678658" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4691209" lon="11.1721631"/>
+ <node id="529678659" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4691528" lon="11.1710009"/>
+ <node id="529678660" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4692804" lon="11.1753551"/>
+ <node id="529678661" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4694209" lon="11.1761359"/>
+ <node id="529678666" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4695868" lon="11.1836723"/>
+ <node id="529678668" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4706548" lon="11.1840127"/>
+ <node id="529678669" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4700761" lon="11.1836592"/>
+ <node id="529678670" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4707952" lon="11.1839734"/>
+ <node id="529678671" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:42Z" user="rsl" uid="70581" lat="49.4755965" lon="11.1660748"/>
+ <node id="529678672" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4763283" lon="11.1715224"/>
+ <node id="529678673" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4764392" lon="11.1723519"/>
+ <node id="529678674" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4764392" lon="11.1732654"/>
+ <node id="529678675" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4757857" lon="11.1747028"/>
+ <node id="529678676" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4757857" lon="11.1751805"/>
+ <node id="529678677" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4760199" lon="11.1772254"/>
+ <node id="529678678" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4759845" lon="11.1776613"/>
+ <node id="529678679" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4756904" lon="11.1781474"/>
+ <node id="529678680" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4715360" lon="11.1832868"/>
+ <node id="529678681" visible="true" version="1" changeset="2830126" timestamp="2009-10-12T20:40:43Z" user="rsl" uid="70581" lat="49.4751595" lon="11.1789016"/>
+ <node id="529678663" visible="true" version="2" changeset="6763335" timestamp="2010-12-25T19:13:18Z" user="kellerma" uid="202858" lat="49.4693996" lon="11.1820327"/>
+ <node id="529683737" visible="true" version="1" changeset="2830302" timestamp="2009-10-12T20:54:26Z" user="rsl" uid="70581" lat="49.4673246" lon="11.1844384"/>
+ <node id="529683739" visible="true" version="1" changeset="2830302" timestamp="2009-10-12T20:54:27Z" user="rsl" uid="70581" lat="49.4657289" lon="11.1783982"/>
+ <node id="529683740" visible="true" version="1" changeset="2830302" timestamp="2009-10-12T20:54:27Z" user="rsl" uid="70581" lat="49.4692085" lon="11.1844969"/>
+ <node id="529683741" visible="true" version="1" changeset="2830302" timestamp="2009-10-12T20:54:27Z" user="rsl" uid="70581" lat="49.4689940" lon="11.1828655"/>
+ <node id="529683743" visible="true" version="1" changeset="2830302" timestamp="2009-10-12T20:54:27Z" user="rsl" uid="70581" lat="49.4690930" lon="11.1835884"/>
+ <node id="529683744" visible="true" version="1" changeset="2830302" timestamp="2009-10-12T20:54:27Z" user="rsl" uid="70581" lat="49.4680446" lon="11.1821629"/>
+ <node id="539237096" visible="true" version="3" changeset="32227711" timestamp="2015-06-26T15:24:02Z" user="CaptainCrunch" uid="13363" lat="49.4634337" lon="11.1336735"/>
+ <node id="539237106" visible="true" version="1" changeset="2933959" timestamp="2009-10-24T00:15:38Z" user="rsl" uid="70581" lat="49.4690889" lon="11.1396763"/>
+ <node id="539237105" visible="true" version="2" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4696399" lon="11.1390424"/>
+ <node id="529678598" visible="true" version="2" changeset="2933959" timestamp="2009-10-24T00:15:39Z" user="rsl" uid="70581" lat="49.4694900" lon="11.1379490"/>
+ <node id="529678604" visible="true" version="2" changeset="2933959" timestamp="2009-10-24T00:15:39Z" user="rsl" uid="70581" lat="49.4695167" lon="11.1390888"/>
+ <node id="529678600" visible="true" version="2" changeset="2933959" timestamp="2009-10-24T00:15:39Z" user="rsl" uid="70581" lat="49.4683562" lon="11.1412171"/>
+ <node id="529678602" visible="true" version="2" changeset="2933959" timestamp="2009-10-24T00:15:39Z" user="rsl" uid="70581" lat="49.4691604" lon="11.1409130"/>
+ <node id="359882432" visible="true" version="7" changeset="39407181" timestamp="2016-05-18T17:48:14Z" user="danidoedel" uid="3164012" lat="49.4662667" lon="11.1576267">
+  <tag k="bus" v="yes"/>
+  <tag k="highway" v="bus_stop"/>
+  <tag k="name" v="Grünreuther Straße"/>
+  <tag k="operator" v="VAG"/>
+  <tag k="public_transport" v="platform"/>
+ </node>
+ <node id="734779068" visible="true" version="5" changeset="39407181" timestamp="2016-05-18T17:48:15Z" user="danidoedel" uid="3164012" lat="49.4650704" lon="11.1519166">
+  <tag k="bus" v="yes"/>
+  <tag k="name" v="Happurger Straße"/>
+  <tag k="public_transport" v="stop_position"/>
+ </node>
+ <node id="734788923" visible="true" version="5" changeset="39407181" timestamp="2016-05-18T17:48:15Z" user="danidoedel" uid="3164012" lat="49.4652650" lon="11.1526291">
+  <tag k="bus" v="yes"/>
+  <tag k="name" v="Happurger Straße"/>
+  <tag k="public_transport" v="stop_position"/>
+ </node>
+ <node id="21643334" visible="true" version="6" changeset="14933873" timestamp="2013-02-06T14:06:41Z" user="geodreieck4711" uid="479256" lat="49.4689488" lon="11.1642690"/>
+ <node id="419915093" visible="true" version="12" changeset="39407181" timestamp="2016-05-18T17:48:15Z" user="danidoedel" uid="3164012" lat="49.4651883" lon="11.1527083">
+  <tag k="bench" v="yes"/>
+  <tag k="bin" v="yes"/>
+  <tag k="bus" v="yes"/>
+  <tag k="highway" v="bus_stop"/>
+  <tag k="name" v="Happurger Straße"/>
+  <tag k="operator" v="VAG"/>
+  <tag k="public_transport" v="platform"/>
+  <tag k="shelter" v="yes"/>
+  <tag k="tactile_paving" v="no"/>
+ </node>
+ <node id="582582407" visible="true" version="5" changeset="39407181" timestamp="2016-05-18T17:48:14Z" user="danidoedel" uid="3164012" lat="49.4662625" lon="11.1581702">
+  <tag k="bus" v="yes"/>
+  <tag k="highway" v="bus_stop"/>
+  <tag k="name" v="Grünreuther Straße"/>
+  <tag k="operator" v="VAG"/>
+  <tag k="public_transport" v="platform"/>
+ </node>
+ <node id="734788926" visible="true" version="4" changeset="39407181" timestamp="2016-05-18T17:48:14Z" user="danidoedel" uid="3164012" lat="49.4663044" lon="11.1581465">
+  <tag k="bus" v="yes"/>
+  <tag k="name" v="Grünreuther Straße"/>
+  <tag k="public_transport" v="stop_position"/>
+ </node>
+ <node id="270965681" visible="true" version="3" changeset="6521747" timestamp="2010-12-03T01:03:53Z" user="kellerma" uid="202858" lat="49.4685206" lon="11.1611958"/>
+ <node id="249773996" visible="true" version="4" changeset="6521747" timestamp="2010-12-03T01:03:54Z" user="kellerma" uid="202858" lat="49.4687355" lon="11.1625896"/>
+ <node id="148426952" visible="true" version="5" changeset="6521747" timestamp="2010-12-03T01:03:54Z" user="kellerma" uid="202858" lat="49.4666840" lon="11.1603261"/>
+ <node id="914905189" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:25Z" user="geodreieck4711" uid="479256" lat="49.4669230" lon="11.1581858"/>
+ <node id="914905463" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4663992" lon="11.1582769"/>
+ <node id="40790381" visible="true" version="5" changeset="6521747" timestamp="2010-12-03T01:03:55Z" user="kellerma" uid="202858" lat="49.4683353" lon="11.1601045"/>
+ <node id="270971205" visible="true" version="3" changeset="14933873" timestamp="2013-02-06T14:06:41Z" user="geodreieck4711" uid="479256" lat="49.4688532" lon="11.1634106"/>
+ <node id="914905260" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:25Z" user="geodreieck4711" uid="479256" lat="49.4670519" lon="11.1581796"/>
+ <node id="914905402" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:25Z" user="geodreieck4711" uid="479256" lat="49.4663570" lon="11.1578530"/>
+ <node id="914906409" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4665245" lon="11.1585049"/>
+ <node id="847193248" visible="true" version="3" changeset="14933873" timestamp="2013-02-06T14:06:44Z" user="geodreieck4711" uid="479256" lat="49.4688762" lon="11.1635863"/>
+ <node id="96630335" visible="true" version="5" changeset="6534085" timestamp="2010-12-04T03:14:19Z" user="kellerma" uid="202858" lat="49.4689680" lon="11.1677078"/>
+ <node id="727734688" visible="true" version="3" changeset="30517738" timestamp="2015-04-26T20:53:20Z" user="pyram" uid="497849" lat="49.4689919" lon="11.1674703">
+  <tag k="crossing" v="traffic_signals"/>
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="889214823" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:05Z" user="kellerma" uid="202858" lat="49.4651131" lon="11.1526528"/>
+ <node id="889215177" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4656181" lon="11.1529157"/>
+ <node id="889215216" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:07Z" user="kellerma" uid="202858" lat="49.4651418" lon="11.1528781"/>
+ <node id="889215324" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:22Z" user="kellerma" uid="202858" lat="49.4651372" lon="11.1526061"/>
+ <node id="889215011" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4651256" lon="11.1527050"/>
+ <node id="889215034" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4651802" lon="11.1529639"/>
+ <node id="889215472" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4651919" lon="11.1529249"/>
+ <node id="889215019" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:51Z" user="kellerma" uid="202858" lat="49.4653083" lon="11.1531328"/>
+ <node id="889215362" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:40Z" user="kellerma" uid="202858" lat="49.4652389" lon="11.1530475"/>
+ <node id="889214731" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:14Z" user="kellerma" uid="202858" lat="49.4652639" lon="11.1531089"/>
+ <node id="529678586" visible="true" version="5" changeset="42404513" timestamp="2016-09-24T12:44:16Z" user="pyram" uid="497849" lat="49.4653458" lon="11.1350437"/>
+ <node id="529678585" visible="true" version="3" changeset="9896912" timestamp="2011-11-21T12:57:08Z" user="mogstar" uid="418206" lat="49.4647955" lon="11.1336903"/>
+ <node id="910988546" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:25Z" user="kellerma" uid="202858" lat="49.4662320" lon="11.1530599"/>
+ <node id="910988941" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:22Z" user="kellerma" uid="202858" lat="49.4662697" lon="11.1532966"/>
+ <node id="910989082" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4653722" lon="11.1535200"/>
+ <node id="910988904" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4662834" lon="11.1520345"/>
+ <node id="910989287" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:51:56Z" user="kellerma" uid="202858" lat="49.4663836" lon="11.1532536"/>
+ <node id="910989952" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4653073" lon="11.1537364"/>
+ <node id="910989805" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4663565" lon="11.1536281"/>
+ <node id="910990201" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4659242" lon="11.1533147"/>
+ <node id="910991047" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4661983" lon="11.1523091"/>
+ <node id="910990888" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:23Z" user="kellerma" uid="202858" lat="49.4663459" lon="11.1530170"/>
+ <node id="910991129" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4657334" lon="11.1518891"/>
+ <node id="910991184" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4655310" lon="11.1518822"/>
+ <node id="910991211" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4659593" lon="11.1535393"/>
+ <node id="914038046" visible="true" version="1" changeset="5791620" timestamp="2010-09-15T22:45:00Z" user="kellerma" uid="202858" lat="49.4668915" lon="11.1798325"/>
+ <node id="529683738" visible="true" version="2" changeset="5791620" timestamp="2010-09-15T22:45:24Z" user="kellerma" uid="202858" lat="49.4668866" lon="11.1798594"/>
+ <node id="411043144" visible="true" version="4" changeset="5791620" timestamp="2010-09-15T22:45:26Z" user="kellerma" uid="202858" lat="49.4656470" lon="11.1781827"/>
+ <node id="529683742" visible="true" version="2" changeset="5791620" timestamp="2010-09-15T22:45:26Z" user="kellerma" uid="202858" lat="49.4677098" lon="11.1805463"/>
+ <node id="914905302" visible="true" version="2" changeset="6534085" timestamp="2010-12-04T03:14:27Z" user="kellerma" uid="202858" lat="49.4690038" lon="11.1672851"/>
+ <node id="914905570" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4659662" lon="11.1583074"/>
+ <node id="914905800" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4651768" lon="11.1583954"/>
+ <node id="914905675" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4661336" lon="11.1579737"/>
+ <node id="914905877" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4659233" lon="11.1581332"/>
+ <node id="914905732" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4669747" lon="11.1580855"/>
+ <node id="914906092" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4660630" lon="11.1582056"/>
+ <node id="914906038" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4664362" lon="11.1578213"/>
+ <node id="914906518" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4661730" lon="11.1581467"/>
+ <node id="914906899" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4653307" lon="11.1581301"/>
+ <node id="914906941" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4660237" lon="11.1580326"/>
+ <node id="914907139" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4658157" lon="11.1581956"/>
+ <node id="914907416" visible="true" version="4" changeset="29781608" timestamp="2015-03-27T16:27:51Z" user="pyram" uid="497849" lat="49.4665354" lon="11.1590149"/>
+ <node id="914907266" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4657716" lon="11.1577439"/>
+ <node id="914907439" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4690154" lon="11.1669231"/>
+ <node id="914907511" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4664846" lon="11.1581092"/>
+ <node id="270973175" visible="true" version="2" changeset="6590074" timestamp="2010-12-08T21:59:11Z" user="kellerma" uid="202858" lat="49.4664301" lon="11.1570552"/>
+ <node id="270973176" visible="true" version="4" changeset="6590074" timestamp="2010-12-08T21:59:11Z" user="kellerma" uid="202858" lat="49.4668289" lon="11.1575360"/>
+ <node id="270963172" visible="true" version="4" changeset="23043375" timestamp="2014-06-20T12:40:58Z" user="kukuk" uid="346758" lat="49.4672198" lon="11.1580589"/>
+ <node id="917756544" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4650566" lon="11.1565249"/>
+ <node id="917756580" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:40Z" user="kellerma" uid="202858" lat="49.4649943" lon="11.1544812"/>
+ <node id="917756566" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4667008" lon="11.1570143"/>
+ <node id="917756569" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4666744" lon="11.1568732"/>
+ <node id="917756567" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4661719" lon="11.1548245"/>
+ <node id="917756583" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4666163" lon="11.1555785"/>
+ <node id="917756591" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4661874" lon="11.1555168"/>
+ <node id="917756652" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4662533" lon="11.1553278"/>
+ <node id="917756671" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4661503" lon="11.1546793"/>
+ <node id="917756679" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4662032" lon="11.1549723"/>
+ <node id="917756698" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4661674" lon="11.1553526"/>
+ <node id="917756633" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4663562" lon="11.1566176"/>
+ <node id="917756670" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4666297" lon="11.1570458"/>
+ <node id="917756627" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4651464" lon="11.1556863"/>
+ <node id="917756630" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4652316" lon="11.1567837"/>
+ <node id="917756683" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:52Z" user="kellerma" uid="202858" lat="49.4648793" lon="11.1545226"/>
+ <node id="917756681" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:59Z" user="kellerma" uid="202858" lat="49.4648548" lon="11.1543619"/>
+ <node id="917756741" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4662984" lon="11.1564843"/>
+ <node id="917756775" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4666033" lon="11.1569047"/>
+ <node id="917756715" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4660936" lon="11.1550073"/>
+ <node id="917756731" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4660941" lon="11.1548518"/>
+ <node id="917756749" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4665928" lon="11.1554091"/>
+ <node id="917756759" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4662733" lon="11.1554920"/>
+ <node id="917756776" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4660725" lon="11.1547066"/>
+ <node id="917756784" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4662254" lon="11.1551371"/>
+ <node id="917756744" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:34Z" user="kellerma" uid="202858" lat="49.4649698" lon="11.1543205"/>
+ <node id="171750512" visible="true" version="6" changeset="8067653" timestamp="2011-05-06T18:48:14Z" user="klabauter05" uid="157416" lat="49.4657237" lon="11.1625344"/>
+ <node id="224088857" visible="true" version="5" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4636563" lon="11.1532005"/>
+ <node id="224088906" visible="true" version="4" changeset="37987008" timestamp="2016-03-21T21:30:17Z" user="pyram" uid="497849" lat="49.4635715" lon="11.1640407"/>
+ <node id="224088874" visible="true" version="7" changeset="12070289" timestamp="2012-06-30T21:29:44Z" user="pyram" uid="497849" lat="49.4630527" lon="11.1548233"/>
+ <node id="171750549" visible="true" version="4" changeset="7864550" timestamp="2011-04-14T20:06:29Z" user="klabauter05" uid="157416" lat="49.4647819" lon="11.1577462"/>
+ <node id="171750555" visible="true" version="4" changeset="7864550" timestamp="2011-04-14T20:06:30Z" user="klabauter05" uid="157416" lat="49.4648718" lon="11.1580617"/>
+ <node id="148436854" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611" lat="49.4661202" lon="11.1538775"/>
+ <node id="224088860" visible="true" version="5" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4632636" lon="11.1537361"/>
+ <node id="224088895" visible="true" version="6" changeset="37987008" timestamp="2016-03-21T21:30:17Z" user="pyram" uid="497849" lat="49.4634800" lon="11.1617371"/>
+ <node id="148436860" visible="true" version="2" changeset="5833180" timestamp="2010-09-20T21:31:12Z" user="kellerma" uid="202858" lat="49.4659509" lon="11.1528827"/>
+ <node id="87043195" visible="true" version="5" changeset="9896677" timestamp="2011-11-21T12:34:38Z" user="geodreieck4711" uid="479256" lat="49.4690658" lon="11.1542748"/>
+ <node id="148436869" visible="true" version="4" changeset="5833180" timestamp="2010-09-20T21:31:25Z" user="kellerma" uid="202858" lat="49.4666697" lon="11.1537383">
+  <tag k="barrier" v="gate"/>
+ </node>
+ <node id="148436849" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4663488" lon="11.1558880"/>
+ <node id="419915020" visible="true" version="4" changeset="14104246" timestamp="2012-11-30T21:14:31Z" user="pyram" uid="497849" lat="49.4666477" lon="11.1600976"/>
+ <node id="529678667" visible="true" version="2" changeset="6628545" timestamp="2010-12-11T19:33:40Z" user="kellerma" uid="202858" lat="49.4694476" lon="11.1834484"/>
+ <node id="1041370555" visible="true" version="1" changeset="6678528" timestamp="2010-12-16T16:51:53Z" user="kellerma" uid="202858" lat="49.4654530" lon="11.1567589"/>
+ <node id="889214989" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4654568" lon="11.1520072"/>
+ <node id="270965358" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:51:54Z" user="kellerma" uid="202858" lat="49.4657782" lon="11.1551129"/>
+ <node id="917756813" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:51:58Z" user="kellerma" uid="202858" lat="49.4654579" lon="11.1553720"/>
+ <node id="270973169" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:00Z" user="kellerma" uid="202858" lat="49.4658376" lon="11.1550543"/>
+ <node id="917756560" visible="true" version="3" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4654410" lon="11.1538996"/>
+ <node id="917756616" visible="true" version="3" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4653848" lon="11.1542664"/>
+ <node id="270973167" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:02Z" user="kellerma" uid="202858" lat="49.4656104" lon="11.1537310"/>
+ <node id="917756605" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:04Z" user="kellerma" uid="202858" lat="49.4657750" lon="11.1522598"/>
+ <node id="917756772" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:06Z" user="kellerma" uid="202858" lat="49.4657750" lon="11.1520649"/>
+ <node id="270973170" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:08Z" user="kellerma" uid="202858" lat="49.4659697" lon="11.1557909"/>
+ <node id="889215123" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:09Z" user="kellerma" uid="202858" lat="49.4653866" lon="11.1530782"/>
+ <node id="917756726" visible="true" version="3" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4654936" lon="11.1542247"/>
+ <node id="148436843" visible="true" version="7" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611" lat="49.4659693" lon="11.1561616"/>
+ <node id="270973172" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:11Z" user="kellerma" uid="202858" lat="49.4661099" lon="11.1564233"/>
+ <node id="171750567" visible="true" version="3" changeset="6678528" timestamp="2010-12-16T16:52:13Z" user="kellerma" uid="202858" lat="49.4659203" lon="11.1565817"/>
+ <node id="171750592" visible="true" version="4" changeset="6678528" timestamp="2010-12-16T16:52:17Z" user="kellerma" uid="202858" lat="49.4650021" lon="11.1516347"/>
+ <node id="910989985" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:17Z" user="kellerma" uid="202858" lat="49.4658476" lon="11.1528838"/>
+ <node id="270973173" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:18Z" user="kellerma" uid="202858" lat="49.4662306" lon="11.1567237"/>
+ <node id="917756586" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:19Z" user="kellerma" uid="202858" lat="49.4654891" lon="11.1555336"/>
+ <node id="917756751" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:21Z" user="kellerma" uid="202858" lat="49.4654069" lon="11.1555712"/>
+ <node id="270973164" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:24Z" user="kellerma" uid="202858" lat="49.4652861" lon="11.1523815"/>
+ <node id="910989710" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:24Z" user="kellerma" uid="202858" lat="49.4658108" lon="11.1526927"/>
+ <node id="889214932" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4655022" lon="11.1529597"/>
+ <node id="224088839" visible="true" version="7" changeset="8935894" timestamp="2011-08-06T08:47:26Z" user="kellerma" uid="202858" lat="49.4644241" lon="11.1491532"/>
+ <node id="910990468" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4654017" lon="11.1536995"/>
+ <node id="270971892" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4654695" lon="11.1534166"/>
+ <node id="889215096" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4652349" lon="11.1525180"/>
+ <node id="917756663" visible="true" version="3" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4653322" lon="11.1539413"/>
+ <node id="914905803" visible="true" version="3" changeset="10223496" timestamp="2011-12-28T09:05:17Z" user="kellerma" uid="202858" lat="49.4660967" lon="11.1575646"/>
+ <node id="917756645" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:26Z" user="kellerma" uid="202858" lat="49.4653757" lon="11.1554096"/>
+ <node id="910990623" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:27Z" user="kellerma" uid="202858" lat="49.4657316" lon="11.1529367"/>
+ <node id="917756712" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:28Z" user="kellerma" uid="202858" lat="49.4658595" lon="11.1522598"/>
+ <node id="910990121" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:29Z" user="kellerma" uid="202858" lat="49.4656948" lon="11.1527456"/>
+ <node id="917756555" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4657773" lon="11.1558277"/>
+ <node id="889215107" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4655673" lon="11.1525993"/>
+ <node id="917756667" visible="true" version="2" changeset="6678528" timestamp="2010-12-16T16:52:32Z" user="kellerma" uid="202858" lat="49.4658595" lon="11.1520649"/>
+ <node id="910988767" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4658582" lon="11.1535728"/>
+ <node id="857291223" visible="true" version="3" changeset="6762485" timestamp="2010-12-25T17:20:09Z" user="kellerma" uid="202858" lat="49.4646116" lon="11.1525191"/>
+ <node id="419915053" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:17Z" user="kellerma" uid="202858" lat="49.4649678" lon="11.1553148"/>
+ <node id="889215315" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4651040" lon="11.1529915"/>
+ <node id="521209565" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4635479" lon="11.1594916"/>
+ <node id="249851124" visible="true" version="2" changeset="6762485" timestamp="2010-12-25T17:20:57Z" user="kellerma" uid="202858" lat="49.4635045" lon="11.1606891"/>
+ <node id="917756550" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4651611" lon="11.1526932"/>
+ <node id="529678664" visible="true" version="2" changeset="6763335" timestamp="2010-12-25T19:13:19Z" user="kellerma" uid="202858" lat="49.4696819" lon="11.1824876"/>
+ <node id="529678665" visible="true" version="2" changeset="6763335" timestamp="2010-12-25T19:13:22Z" user="kellerma" uid="202858" lat="49.4696776" lon="11.1820518"/>
+ <node id="529678662" visible="true" version="2" changeset="6763335" timestamp="2010-12-25T19:13:26Z" user="kellerma" uid="202858" lat="49.4694103" lon="11.1824712"/>
+ <node id="1249743052" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:12Z" user="klabauter05" uid="157416" lat="49.4670461" lon="11.1583798"/>
+ <node id="1249743054" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:12Z" user="klabauter05" uid="157416" lat="49.4670677" lon="11.1585114"/>
+ <node id="1249743115" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:14Z" user="klabauter05" uid="157416" lat="49.4653213" lon="11.1574873"/>
+ <node id="1249743135" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:23Z" user="geodreieck4711" uid="479256" lat="49.4665645" lon="11.1577501"/>
+ <node id="1249743167" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:23Z" user="geodreieck4711" uid="479256" lat="49.4671260" lon="11.1587617"/>
+ <node id="1249743230" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:16Z" user="klabauter05" uid="157416" lat="49.4653467" lon="11.1570715"/>
+ <node id="1249743234" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:16Z" user="klabauter05" uid="157416" lat="49.4652327" lon="11.1571404"/>
+ <node id="1249743299" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:18Z" user="klabauter05" uid="157416" lat="49.4654796" lon="11.1575918"/>
+ <node id="1249743246" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:23Z" user="geodreieck4711" uid="479256" lat="49.4666103" lon="11.1576609"/>
+ <node id="1249743332" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:19Z" user="klabauter05" uid="157416" lat="49.4652770" lon="11.1573139"/>
+ <node id="1249743429" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:23Z" user="klabauter05" uid="157416" lat="49.4654353" lon="11.1574183"/>
+ <node id="1249743342" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:23Z" user="geodreieck4711" uid="479256" lat="49.4666427" lon="11.1578453"/>
+ <node id="1249743394" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:24Z" user="geodreieck4711" uid="479256" lat="49.4669941" lon="11.1586438"/>
+ <node id="1249743426" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:24Z" user="geodreieck4711" uid="479256" lat="49.4671036" lon="11.1586064"/>
+ <node id="1249743468" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:24Z" user="klabauter05" uid="157416" lat="49.4669935" lon="11.1585401"/>
+ <node id="1249743500" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:25Z" user="klabauter05" uid="157416" lat="49.4653656" lon="11.1576607"/>
+ <node id="1249743535" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:26Z" user="klabauter05" uid="157416" lat="49.4669719" lon="11.1584085"/>
+ <node id="1249743565" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:27Z" user="klabauter05" uid="157416" lat="49.4653910" lon="11.1572449"/>
+ <node id="1249743527" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:24Z" user="geodreieck4711" uid="479256" lat="49.4670165" lon="11.1587991"/>
+ <node id="914906487" visible="true" version="2" changeset="7895391" timestamp="2011-04-18T10:10:59Z" user="klabauter05" uid="157416" lat="49.4654318" lon="11.1583943"/>
+ <node id="976638945" visible="true" version="3" changeset="9579176" timestamp="2011-10-17T07:22:09Z" user="geodreieck4711" uid="479256" lat="49.4658032" lon="11.1556877">
+  <tag k="emergency" v="fire_hydrant"/>
+  <tag k="fire_hydrant:diameter" v="80"/>
+  <tag k="fire_hydrant:position" v="sidewalk"/>
+  <tag k="fire_hydrant:type" v="pillar"/>
+ </node>
+ <node id="148426963" visible="true" version="7" changeset="7602896" timestamp="2011-03-19T09:54:05Z" user="kellerma" uid="202858" lat="49.4666693" lon="11.1612898"/>
+ <node id="1225946508" visible="true" version="1" changeset="7720690" timestamp="2011-03-30T21:00:59Z" user="kukuk" uid="346758" lat="49.4688779" lon="11.1450812"/>
+ <node id="1225946510" visible="true" version="1" changeset="7720690" timestamp="2011-03-30T21:00:59Z" user="kukuk" uid="346758" lat="49.4688029" lon="11.1457430"/>
+ <node id="265760609" visible="true" version="2" changeset="7720690" timestamp="2011-03-30T21:01:00Z" user="kukuk" uid="346758" lat="49.4687272" lon="11.1453546"/>
+ <node id="1268926957" visible="true" version="1" changeset="8021548" timestamp="2011-05-01T13:56:13Z" user="kellerma" uid="202858" lat="49.4648261" lon="11.1508812"/>
+ <node id="1268926982" visible="true" version="1" changeset="8021548" timestamp="2011-05-01T13:56:14Z" user="kellerma" uid="202858" lat="49.4662411" lon="11.1508094"/>
+ <node id="1268926959" visible="true" version="2" changeset="8907262" timestamp="2011-08-03T06:56:57Z" user="kellerma" uid="202858" lat="49.4646162" lon="11.1500397"/>
+ <node id="1370391777" visible="true" version="1" changeset="8800621" timestamp="2011-07-22T19:25:02Z" user="kellerma" uid="202858" lat="49.4692502" lon="11.1542182"/>
+ <node id="1370391694" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4666368" lon="11.1536472"/>
+ <node id="539237101" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4682777" lon="11.1354437"/>
+ <node id="1467362001" visible="true" version="1" changeset="9557139" timestamp="2011-10-14T16:48:09Z" user="geodreieck4711" uid="479256" lat="49.4656615" lon="11.1537700">
+  <tag k="amenity" v="grit_bin"/>
+ </node>
+ <node id="1470605760" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4663083" lon="11.1575117"/>
+ <node id="1470605762" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4663541" lon="11.1576171"/>
+ <node id="1470605766" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4664226" lon="11.1575503"/>
+ <node id="1470605767" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4664101" lon="11.1568650"/>
+ <node id="1511439560" visible="true" version="1" changeset="9896677" timestamp="2011-11-21T12:33:44Z" user="geodreieck4711" uid="479256" lat="49.4667820" lon="11.1537301"/>
+ <node id="1511439568" visible="true" version="1" changeset="9896677" timestamp="2011-11-21T12:33:44Z" user="geodreieck4711" uid="479256" lat="49.4670148" lon="11.1537690"/>
+ <node id="1511439615" visible="true" version="1" changeset="9896677" timestamp="2011-11-21T12:33:45Z" user="geodreieck4711" uid="479256" lat="49.4676836" lon="11.1539778"/>
+ <node id="1511439712" visible="true" version="1" changeset="9896677" timestamp="2011-11-21T12:33:47Z" user="geodreieck4711" uid="479256" lat="49.4689356" lon="11.1542702"/>
+ <node id="529678654" visible="true" version="3" changeset="9896677" timestamp="2011-11-21T12:34:35Z" user="geodreieck4711" uid="479256" lat="49.4729607" lon="11.1472255"/>
+ <node id="87043190" visible="true" version="4" changeset="9896677" timestamp="2011-11-21T12:34:38Z" user="geodreieck4711" uid="479256" lat="49.4682591" lon="11.1540993"/>
+ <node id="1511466837" visible="true" version="1" changeset="9896912" timestamp="2011-11-21T12:57:06Z" user="mogstar" uid="418206" lat="49.4644919" lon="11.1332750"/>
+ <node id="249846785" visible="true" version="3" changeset="26613710" timestamp="2014-11-07T12:45:33Z" user="CaptainCrunch" uid="13363" lat="49.4632820" lon="11.1344284"/>
+ <node id="539237098" visible="true" version="5" changeset="26613710" timestamp="2014-11-07T12:45:33Z" user="CaptainCrunch" uid="13363" lat="49.4648107" lon="11.1336844"/>
+ <node id="1470605777" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4665192" lon="11.1543367"/>
+ <node id="1468258067" visible="true" version="3" changeset="32227711" timestamp="2015-06-26T15:24:01Z" user="CaptainCrunch" uid="13363" lat="49.4617083" lon="11.1303631"/>
+ <node id="1522932697" visible="true" version="1" changeset="9985757" timestamp="2011-11-29T09:26:22Z" user="Taroc" uid="71557" lat="49.4624895" lon="11.1316169"/>
+ <node id="1525143724" visible="true" version="1" changeset="10002607" timestamp="2011-11-30T20:06:58Z" user="Taroc" uid="71557" lat="49.4665124" lon="11.1342878"/>
+ <node id="1525143743" visible="true" version="1" changeset="10002607" timestamp="2011-11-30T20:06:58Z" user="Taroc" uid="71557" lat="49.4680837" lon="11.1371139"/>
+ <node id="1525143738" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4672311" lon="11.1445011"/>
+ <node id="1564890417" visible="true" version="1" changeset="10223496" timestamp="2011-12-28T09:05:01Z" user="kellerma" uid="202858" lat="49.4664913" lon="11.1574494"/>
+ <node id="1564890419" visible="true" version="1" changeset="10223496" timestamp="2011-12-28T09:05:01Z" user="kellerma" uid="202858" lat="49.4665049" lon="11.1574313"/>
+ <node id="1470605772" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4664476" lon="11.1569381"/>
+ <node id="1470605774" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4664586" lon="11.1573463"/>
+ <node id="1470605776" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4664663" lon="11.1567972"/>
+ <node id="1470605778" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4664955" lon="11.1576945"/>
+ <node id="1470605780" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:15Z" user="kellerma" uid="202858" lat="49.4665038" lon="11.1568703"/>
+ <node id="1470605781" visible="true" version="2" changeset="10223496" timestamp="2011-12-28T09:05:16Z" user="kellerma" uid="202858" lat="49.4665685" lon="11.1575963"/>
+ <node id="914906244" visible="true" version="3" changeset="10223496" timestamp="2011-12-28T09:05:17Z" user="kellerma" uid="202858" lat="49.4661284" lon="11.1576949"/>
+ <node id="1564890409" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4661576" lon="11.1572201"/>
+ <node id="1564949352" visible="true" version="1" changeset="10223704" timestamp="2011-12-28T09:56:41Z" user="kellerma" uid="202858" lat="49.4661930" lon="11.1569665"/>
+ <node id="1564949361" visible="true" version="1" changeset="10223704" timestamp="2011-12-28T09:56:41Z" user="kellerma" uid="202858" lat="49.4662390" lon="11.1572220">
+  <tag k="highway" v="traffic_signals"/>
+ </node>
+ <node id="1564949380" visible="true" version="1" changeset="10223704" timestamp="2011-12-28T09:56:42Z" user="kellerma" uid="202858" lat="49.4664193" lon="11.1571646">
+  <tag k="highway" v="traffic_signals"/>
+ </node>
+ <node id="1564949354" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4662212" lon="11.1574234"/>
+ <node id="1564890408" visible="true" version="3" changeset="10224049" timestamp="2011-12-28T10:22:31Z" user="kellerma" uid="202858" lat="49.4661504" lon="11.1569185">
+  <tag k="highway" v="traffic_signals"/>
+ </node>
+ <node id="1564949359" visible="true" version="2" changeset="10224049" timestamp="2011-12-28T10:22:32Z" user="kellerma" uid="202858" lat="49.4662306" lon="11.1569525"/>
+ <node id="1564949378" visible="true" version="2" changeset="10224049" timestamp="2011-12-28T10:22:32Z" user="kellerma" uid="202858" lat="49.4662754" lon="11.1569618"/>
+ <node id="1564949379" visible="true" version="2" changeset="10224049" timestamp="2011-12-28T10:22:32Z" user="kellerma" uid="202858" lat="49.4662926" lon="11.1569898"/>
+ <node id="148426970" visible="true" version="7" changeset="10224049" timestamp="2011-12-28T10:22:31Z" user="kellerma" uid="202858" lat="49.4662440" lon="11.1577997"/>
+ <node id="270971629" visible="true" version="5" changeset="10224049" timestamp="2011-12-28T10:22:32Z" user="kellerma" uid="202858" lat="49.4661247" lon="11.1566718"/>
+ <node id="1565016612" visible="true" version="1" changeset="10224312" timestamp="2011-12-28T10:53:13Z" user="kellerma" uid="202858" lat="49.4661827" lon="11.1576377">
+  <tag k="amenity" v="grit_bin"/>
+ </node>
+ <node id="1565389266" visible="true" version="1" changeset="10227001" timestamp="2011-12-28T15:30:13Z" user="kellerma" uid="202858" lat="49.4661678" lon="11.1573786"/>
+ <node id="1564890413" visible="true" version="2" changeset="10227001" timestamp="2011-12-28T15:30:50Z" user="kellerma" uid="202858" lat="49.4661838" lon="11.1575166"/>
+ <node id="734779065" visible="true" version="6" changeset="10227001" timestamp="2011-12-28T15:30:50Z" user="kellerma" uid="202858" lat="49.4662184" lon="11.1576068"/>
+ <node id="1565389238" visible="true" version="2" changeset="39407181" timestamp="2016-05-18T17:48:14Z" user="danidoedel" uid="3164012" lat="49.4662241" lon="11.1576453">
+  <tag k="bus" v="yes"/>
+  <tag k="name" v="Grünreuther Straße"/>
+  <tag k="public_transport" v="stop_position"/>
+ </node>
+ <node id="1581758713" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4660401" lon="11.1561256">
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="1581758715" visible="true" version="1" changeset="10326908" timestamp="2012-01-07T23:18:45Z" user="Taroc" uid="71557" lat="49.4662172" lon="11.1568615">
+  <tag k="highway" v="traffic_signals"/>
+ </node>
+ <node id="1581758710" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4656730" lon="11.1540651">
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="1581758695" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4651413" lon="11.1521723">
+  <tag k="highway" v="traffic_signals"/>
+  <tag k="TMC:cid_58:tabcd_1:Class" v="Point"/>
+  <tag k="TMC:cid_58:tabcd_1:Direction" v="both"/>
+  <tag k="TMC:cid_58:tabcd_1:LCLversion" v="9.00"/>
+  <tag k="TMC:cid_58:tabcd_1:LocationCode" v="42254"/>
+  <tag k="TMC:cid_58:tabcd_1:NextLocationCode" v="27820"/>
+  <tag k="TMC:cid_58:tabcd_1:PrevLocationCode" v="42253"/>
+ </node>
+ <node id="265760614" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4662797" lon="11.1481220"/>
+ <node id="1525143728" visible="true" version="2" changeset="11122072" timestamp="2012-03-27T23:33:20Z" user="pyram" uid="497849" lat="49.4669734" lon="11.1342352"/>
+ <node id="1693942641" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4676140" lon="11.1448059"/>
+ <node id="1699296506" visible="true" version="1" changeset="11163406" timestamp="2012-03-31T08:36:49Z" user="kukuk" uid="346758" lat="49.4685400" lon="11.1436583"/>
+ <node id="1699296507" visible="true" version="1" changeset="11163406" timestamp="2012-03-31T08:36:49Z" user="kukuk" uid="346758" lat="49.4687354" lon="11.1436606"/>
+ <node id="1699296527" visible="true" version="1" changeset="11163406" timestamp="2012-03-31T08:36:50Z" user="kukuk" uid="346758" lat="49.4702250" lon="11.1421974"/>
+ <node id="250942530" visible="true" version="3" changeset="11163406" timestamp="2012-03-31T08:37:14Z" user="kukuk" uid="346758" lat="49.4700098" lon="11.1425027"/>
+ <node id="250942531" visible="true" version="2" changeset="11163406" timestamp="2012-03-31T08:37:14Z" user="kukuk" uid="346758" lat="49.4692961" lon="11.1424007"/>
+ <node id="1724594233" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4652137" lon="11.1524399"/>
+ <node id="1724594228" visible="true" version="1" changeset="11368481" timestamp="2012-04-20T20:56:24Z" user="masp" uid="394313" lat="49.4645615" lon="11.1528606"/>
+ <node id="1724594213" visible="true" version="2" changeset="12070289" timestamp="2012-06-30T21:29:43Z" user="pyram" uid="497849" lat="49.4636937" lon="11.1532885"/>
+ <node id="1724594218" visible="true" version="2" changeset="26060088" timestamp="2014-10-13T21:27:14Z" user="pyram" uid="497849" lat="49.4638546" lon="11.1531666"/>
+ <node id="1724594224" visible="true" version="2" changeset="26060088" timestamp="2014-10-13T21:27:14Z" user="pyram" uid="497849" lat="49.4639455" lon="11.1532494"/>
+ <node id="1724605550" visible="true" version="1" changeset="11368615" timestamp="2012-04-20T21:09:58Z" user="masp" uid="394313" lat="49.4649531" lon="11.1523991"/>
+ <node id="1724605551" visible="true" version="1" changeset="11368615" timestamp="2012-04-20T21:09:58Z" user="masp" uid="394313" lat="49.4650033" lon="11.1525756"/>
+ <node id="914906674" visible="true" version="3" changeset="11495651" timestamp="2012-05-04T08:43:31Z" user="Jörg Roth" uid="24047" lat="49.4655853" lon="11.1590887"/>
+ <node id="914907509" visible="true" version="3" changeset="11495651" timestamp="2012-05-04T08:43:31Z" user="Jörg Roth" uid="24047" lat="49.4654860" lon="11.1591477"/>
+ <node id="914905642" visible="true" version="3" changeset="11495651" timestamp="2012-05-04T08:43:31Z" user="Jörg Roth" uid="24047" lat="49.4653326" lon="11.1584490"/>
+ <node id="908569549" visible="true" version="5" changeset="27806976" timestamp="2014-12-30T18:50:16Z" user="pyram" uid="497849" lat="49.4618138" lon="11.1366999"/>
+ <node id="1581758692" visible="true" version="3" changeset="11736805" timestamp="2012-05-29T11:30:13Z" user="geodreieck4711" uid="479256" lat="49.4650993" lon="11.1516056">
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="1754709769" visible="true" version="1" changeset="11612901" timestamp="2012-05-16T10:32:44Z" user="geodreieck4711" uid="479256" lat="49.4651309" lon="11.1516994"/>
+ <node id="1764304685" visible="true" version="1" changeset="11690682" timestamp="2012-05-24T15:19:06Z" user="geodreieck4711" uid="479256" lat="49.4694979" lon="11.1835531"/>
+ <node id="1769300561" visible="true" version="1" changeset="11735738" timestamp="2012-05-29T09:28:06Z" user="geodreieck4711" uid="479256" lat="49.4671473" lon="11.1444184"/>
+ <node id="538254512" visible="true" version="3" changeset="11736805" timestamp="2012-05-29T11:30:23Z" user="geodreieck4711" uid="479256" lat="49.4662712" lon="11.1509369">
+  <tag k="barrier" v="bollard"/>
+ </node>
+ <node id="171750600" visible="true" version="4" changeset="11736805" timestamp="2012-05-29T11:30:13Z" user="geodreieck4711" uid="479256" lat="49.4662993" lon="11.1516141"/>
+ <node id="171750610" visible="true" version="5" changeset="11736805" timestamp="2012-05-29T11:30:13Z" user="geodreieck4711" uid="479256" lat="49.4662752" lon="11.1508369"/>
+ <node id="1783838456" visible="true" version="1" changeset="11868250" timestamp="2012-06-11T19:38:04Z" user="geodreieck4711" uid="479256" lat="49.4650597" lon="11.1524183">
+  <tag k="emergency" v="fire_hydrant"/>
+  <tag k="fire_hydrant:diameter" v="100"/>
+  <tag k="fire_hydrant:position" v="sidewalk"/>
+  <tag k="fire_hydrant:type" v="pillar"/>
+ </node>
+ <node id="1794190549" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4642878" lon="11.1530345"/>
+ <node id="1808107798" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:28:46Z" user="pyram" uid="497849" lat="49.4632622" lon="11.1566182"/>
+ <node id="1808107848" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:28:47Z" user="pyram" uid="497849" lat="49.4633992" lon="11.1534739"/>
+ <node id="1808107912" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:28:50Z" user="pyram" uid="497849" lat="49.4635280" lon="11.1533162"/>
+ <node id="1808108066" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:28:55Z" user="pyram" uid="497849" lat="49.4637940" lon="11.1530870"/>
+ <node id="1808108244" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:29:02Z" user="pyram" uid="497849" lat="49.4645178" lon="11.1565688"/>
+ <node id="1808108271" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:29:03Z" user="pyram" uid="497849" lat="49.4647653" lon="11.1561852"/>
+ <node id="1808108275" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:29:04Z" user="pyram" uid="497849" lat="49.4647901" lon="11.1511624"/>
+ <node id="1808108278" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:29:04Z" user="pyram" uid="497849" lat="49.4648146" lon="11.1560356"/>
+ <node id="1808108281" visible="true" version="1" changeset="12070289" timestamp="2012-06-30T21:29:04Z" user="pyram" uid="497849" lat="49.4648365" lon="11.1561419"/>
+ <node id="1569002933" visible="true" version="2" changeset="12070289" timestamp="2012-06-30T21:29:43Z" user="pyram" uid="497849" lat="49.4649788" lon="11.1521017"/>
+ <node id="1724594226" visible="true" version="2" changeset="12070289" timestamp="2012-06-30T21:29:43Z" user="pyram" uid="497849" lat="49.4639572" lon="11.1529815"/>
+ <node id="1802925467" visible="true" version="2" changeset="12070289" timestamp="2012-06-30T21:29:44Z" user="pyram" uid="497849" lat="49.4633749" lon="11.1535037"/>
+ <node id="249851538" visible="true" version="3" changeset="12070289" timestamp="2012-06-30T21:29:44Z" user="pyram" uid="497849" lat="49.4630612" lon="11.1560731"/>
+ <node id="1569002929" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4645131" lon="11.1513175"/>
+ <node id="270978221" visible="true" version="3" changeset="12070289" timestamp="2012-06-30T21:29:45Z" user="pyram" uid="497849" lat="49.4635974" lon="11.1512192"/>
+ <node id="336271421" visible="true" version="3" changeset="12070289" timestamp="2012-06-30T21:29:45Z" user="pyram" uid="497849" lat="49.4647839" lon="11.1560976">
+  <tag k="highway" v="turning_circle"/>
+ </node>
+ <node id="224088877" visible="true" version="5" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4631254" lon="11.1559849"/>
+ <node id="1116216224" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4630961" lon="11.1557831">
+  <tag k="traffic_calming" v="chicane"/>
+ </node>
+ <node id="1116216228" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4637082" lon="11.1531536">
+  <tag k="traffic_calming" v="chicane"/>
+ </node>
+ <node id="419878598" visible="true" version="3" changeset="12070289" timestamp="2012-06-30T21:29:50Z" user="pyram" uid="497849" lat="49.4644491" lon="11.1526350"/>
+ <node id="419915040" visible="true" version="2" changeset="12070289" timestamp="2012-06-30T21:29:50Z" user="pyram" uid="497849" lat="49.4645761" lon="11.1566714"/>
+ <node id="419915084" visible="true" version="2" changeset="12070289" timestamp="2012-06-30T21:29:51Z" user="pyram" uid="497849" lat="49.4641980" lon="11.1528075"/>
+ <node id="1963694865" visible="true" version="2" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4702539" lon="11.1681085"/>
+ <node id="336271422" visible="true" version="5" changeset="14104246" timestamp="2012-11-30T21:14:31Z" user="pyram" uid="497849" lat="49.4666414" lon="11.1600527"/>
+ <node id="2109912683" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4655054" lon="11.1583027"/>
+ <node id="2109912690" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4655224" lon="11.1583824"/>
+ <node id="2109912707" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4655457" lon="11.1584791"/>
+ <node id="2109912758" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4655636" lon="11.1585611"/>
+ <node id="2109912533" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:15Z" user="pyram" uid="497849" lat="49.4652927" lon="11.1592906"/>
+ <node id="2109912598" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:15Z" user="pyram" uid="497849" lat="49.4653502" lon="11.1580363"/>
+ <node id="2109912612" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:15Z" user="pyram" uid="497849" lat="49.4653673" lon="11.1581091"/>
+ <node id="2109912703" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:15Z" user="pyram" uid="497849" lat="49.4655423" lon="11.1579293"/>
+ <node id="2109912716" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:15Z" user="pyram" uid="497849" lat="49.4655595" lon="11.1580021"/>
+ <node id="2109912838" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4656598" lon="11.1582326"/>
+ <node id="2109913152" visible="true" version="2" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4685618" lon="11.1820456"/>
+ <node id="2109912851" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4656754" lon="11.1583056"/>
+ <node id="2109912864" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4656947" lon="11.1585818"/>
+ <node id="2109912870" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657119" lon="11.1586609"/>
+ <node id="2109912883" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657470" lon="11.1583759"/>
+ <node id="2109913280" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:18Z" user="pyram" uid="497849" lat="49.4695372" lon="11.1796046"/>
+ <node id="2109913290" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:18Z" user="pyram" uid="497849" lat="49.4697801" lon="11.1814191"/>
+ <node id="2109913307" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:18Z" user="pyram" uid="497849" lat="49.4698030" lon="11.1803865"/>
+ <node id="2109913310" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:18Z" user="pyram" uid="497849" lat="49.4699772" lon="11.1803367"/>
+ <node id="2109913312" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:18Z" user="pyram" uid="497849" lat="49.4700681" lon="11.1812418"/>
+ <node id="2109913314" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:18Z" user="pyram" uid="497849" lat="49.4700727" lon="11.1806610"/>
+ <node id="1747735474" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4657960" lon="11.1584969">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="11"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="1747735473" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4658090" lon="11.1585565">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="13"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="1747735472" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4658299" lon="11.1586525">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="15"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="1747735476" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4658664" lon="11.1587041">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="17"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="249773957" visible="true" version="3" changeset="14642788" timestamp="2013-01-13T23:47:47Z" user="pyram" uid="497849" lat="49.4654358" lon="11.1598659"/>
+ <node id="249773959" visible="true" version="3" changeset="14642788" timestamp="2013-01-13T23:47:47Z" user="pyram" uid="497849" lat="49.4656872" lon="11.1615007"/>
+ <node id="411043146" visible="true" version="5" changeset="14642788" timestamp="2013-01-13T23:47:47Z" user="pyram" uid="497849" lat="49.4683206" lon="11.1819173"/>
+ <node id="742479422" visible="true" version="2" changeset="14642788" timestamp="2013-01-13T23:47:48Z" user="pyram" uid="497849" lat="49.4656483" lon="11.1612599"/>
+ <node id="742479444" visible="true" version="2" changeset="14642788" timestamp="2013-01-13T23:47:48Z" user="pyram" uid="497849" lat="49.4655420" lon="11.1605330"/>
+ <node id="249852392" visible="true" version="5" changeset="14933873" timestamp="2013-02-06T14:06:41Z" user="geodreieck4711" uid="479256" lat="49.4690027" lon="11.1650986"/>
+ <node id="2185627722" visible="true" version="1" changeset="15247432" timestamp="2013-03-04T14:53:40Z" user="geodreieck4711" uid="479256" lat="49.4660181" lon="11.1567741"/>
+ <node id="2185627723" visible="true" version="1" changeset="15247432" timestamp="2013-03-04T14:53:40Z" user="geodreieck4711" uid="479256" lat="49.4660633" lon="11.1569268"/>
+ <node id="2185627724" visible="true" version="1" changeset="15247432" timestamp="2013-03-04T14:53:40Z" user="geodreieck4711" uid="479256" lat="49.4661097" lon="11.1569983"/>
+ <node id="2188622803" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:06Z" user="geodreieck4711" uid="479256" lat="49.4667275" lon="11.1572256"/>
+ <node id="2188622807" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:06Z" user="geodreieck4711" uid="479256" lat="49.4667387" lon="11.1572219"/>
+ <node id="2188622810" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4667485" lon="11.1572909"/>
+ <node id="2188622814" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4667828" lon="11.1579996"/>
+ <node id="2188622818" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668009" lon="11.1582508"/>
+ <node id="2188622822" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668237" lon="11.1579091"/>
+ <node id="2188622824" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668242" lon="11.1582781"/>
+ <node id="2188622826" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668396" lon="11.1581504"/>
+ <node id="2188622827" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668446" lon="11.1580658"/>
+ <node id="2188622829" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668466" lon="11.1581586"/>
+ <node id="2188622831" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668614" lon="11.1580660"/>
+ <node id="2188622835" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668741" lon="11.1580809"/>
+ <node id="2188622838" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668855" lon="11.1579753"/>
+ <node id="2188622848" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4668938" lon="11.1580007"/>
+ <node id="914907178" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4664771" lon="11.1582415"/>
+ <node id="917756697" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4663605" lon="11.1564206"/>
+ <node id="917756801" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:27Z" user="geodreieck4711" uid="479256" lat="49.4664183" lon="11.1565540"/>
+ <node id="2188622697" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:55:12Z" user="jacobbraeutigam" uid="1260280" lat="49.4665283" lon="11.1560349">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="13"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="2188622698" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:55:33Z" user="jacobbraeutigam" uid="1260280" lat="49.4665834" lon="11.1588928">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="13"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+ </node>
+ <node id="2188622699" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:58:13Z" user="jacobbraeutigam" uid="1260280" lat="49.4662925" lon="11.1561567">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="15"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="2188622708" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:04:19Z" user="jacobbraeutigam" uid="1260280" lat="49.4663596" lon="11.1565236">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="197"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622713" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:07:54Z" user="jacobbraeutigam" uid="1260280" lat="49.4666512" lon="11.1569617">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="201"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622714" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:07:54Z" user="jacobbraeutigam" uid="1260280" lat="49.4666952" lon="11.1572041">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="203"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622715" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:08:33Z" user="jacobbraeutigam" uid="1260280" lat="49.4666288" lon="11.1577513">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="212"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622732" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:17:58Z" user="jacobbraeutigam" uid="1260280" lat="49.4664045" lon="11.1579224">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+ </node>
+ <node id="2188622734" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:28:38Z" user="jacobbraeutigam" uid="1260280" lat="49.4664266" lon="11.1580584">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="5"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+ </node>
+ <node id="2188622736" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:34:50Z" user="jacobbraeutigam" uid="1260280" lat="49.4664498" lon="11.1583201">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="7"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+ </node>
+ <node id="2188622785" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4666715" lon="11.1585599"/>
+ <node id="2188622741" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4662410" lon="11.1561231"/>
+ <node id="2188622742" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4662688" lon="11.1562376"/>
+ <node id="2188622743" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4663138" lon="11.1560812"/>
+ <node id="2188622744" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4663416" lon="11.1561957"/>
+ <node id="2188622745" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664718" lon="11.1581138"/>
+ <node id="2188622746" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664734" lon="11.1557691"/>
+ <node id="2188622747" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664773" lon="11.1558280"/>
+ <node id="2188622748" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664773" lon="11.1580623"/>
+ <node id="2188622749" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664863" lon="11.1583012"/>
+ <node id="2188622750" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664901" lon="11.1586864"/>
+ <node id="2188622751" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664907" lon="11.1582365"/>
+ <node id="2188622752" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:04Z" user="geodreieck4711" uid="479256" lat="49.4664958" lon="11.1561042"/>
+ <node id="2188622753" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4664979" lon="11.1580548"/>
+ <node id="2188622754" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4664980" lon="11.1559751"/>
+ <node id="2188622755" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4664986" lon="11.1582502"/>
+ <node id="2188622756" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4664986" lon="11.1587566"/>
+ <node id="2188622757" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665054" lon="11.1582943"/>
+ <node id="2188622758" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665112" lon="11.1581413"/>
+ <node id="2188622759" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665238" lon="11.1558208"/>
+ <node id="2188622760" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665267" lon="11.1558638"/>
+ <node id="2188622761" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665367" lon="11.1565566"/>
+ <node id="2188622762" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665430" lon="11.1581297"/>
+ <node id="2188622763" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665545" lon="11.1566798"/>
+ <node id="2188622764" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665571" lon="11.1557561"/>
+ <node id="2188622765" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665582" lon="11.1582285"/>
+ <node id="2188622767" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665638" lon="11.1558580"/>
+ <node id="2188622768" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665652" lon="11.1586650"/>
+ <node id="2188622769" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665736" lon="11.1587352"/>
+ <node id="2188622770" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665763" lon="11.1561074"/>
+ <node id="2188622772" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4665785" lon="11.1559784"/>
+ <node id="2188622775" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4666136" lon="11.1565304"/>
+ <node id="2188622779" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4666313" lon="11.1566537"/>
+ <node id="2188622780" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4666517" lon="11.1571148"/>
+ <node id="2188622786" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4666720" lon="11.1572580"/>
+ <node id="2188622788" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4666885" lon="11.1577562"/>
+ <node id="2188622790" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4667015" lon="11.1572481"/>
+ <node id="2188622792" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4667046" lon="11.1570971"/>
+ <node id="2188622794" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4667095" lon="11.1573040"/>
+ <node id="2188622795" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4667103" lon="11.1571373"/>
+ <node id="2188622796" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:05Z" user="geodreieck4711" uid="479256" lat="49.4667148" lon="11.1571358"/>
+ <node id="2188622738" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:39:13Z" user="jacobbraeutigam" uid="1260280" lat="49.4664931" lon="11.1555169">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="9"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="2188622787" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4666880" lon="11.1587105"/>
+ <node id="2188622739" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:50:19Z" user="jacobbraeutigam" uid="1260280" lat="49.4664791" lon="11.1584501">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="9"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+ </node>
+ <node id="2188622859" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:07Z" user="geodreieck4711" uid="479256" lat="49.4669368" lon="11.1580512"/>
+ <node id="2188623015" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:14Z" user="geodreieck4711" uid="479256" lat="49.4680440" lon="11.1590783"/>
+ <node id="2188623013" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4678865" lon="11.1588136"/>
+ <node id="914905644" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4664056" lon="11.1581406"/>
+ <node id="914906758" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4664472" lon="11.1585385"/>
+ <node id="914906799" visible="true" version="3" changeset="15272386" timestamp="2013-03-06T16:11:26Z" user="geodreieck4711" uid="479256" lat="49.4670002" lon="11.1582799"/>
+ <node id="2197676127" visible="true" version="1" changeset="15340439" timestamp="2013-03-12T14:06:03Z" user="geodreieck4711" uid="479256" lat="49.4668844" lon="11.1575119"/>
+ <node id="2197676130" visible="true" version="1" changeset="15340439" timestamp="2013-03-12T14:06:03Z" user="geodreieck4711" uid="479256" lat="49.4668903" lon="11.1575631"/>
+ <node id="2197676133" visible="true" version="1" changeset="15340439" timestamp="2013-03-12T14:06:03Z" user="geodreieck4711" uid="479256" lat="49.4669114" lon="11.1575046"/>
+ <node id="2197676136" visible="true" version="1" changeset="15340439" timestamp="2013-03-12T14:06:03Z" user="geodreieck4711" uid="479256" lat="49.4669172" lon="11.1575559"/>
+ <node id="2197676113" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:07:55Z" user="jacobbraeutigam" uid="1260280" lat="49.4669002" lon="11.1575325">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="205a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2215265113" visible="true" version="1" changeset="15459854" timestamp="2013-03-22T22:07:32Z" user="geodreieck4711" uid="479256" lat="49.4668394" lon="11.1574955">
+  <tag k="barrier" v="bollard"/>
+ </node>
+ <node id="2215265114" visible="true" version="1" changeset="15459854" timestamp="2013-03-22T22:07:32Z" user="geodreieck4711" uid="479256" lat="49.4679421" lon="11.1588980"/>
+ <node id="2215265115" visible="true" version="1" changeset="15459854" timestamp="2013-03-22T22:07:32Z" user="geodreieck4711" uid="479256" lat="49.4679518" lon="11.1588191"/>
+ <node id="917756727" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4655190" lon="11.1561484"/>
+ <node id="917756730" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4654436" lon="11.1569342"/>
+ <node id="917756735" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4652295" lon="11.1556486"/>
+ <node id="917756738" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4652048" lon="11.1566048"/>
+ <node id="917756740" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4649240" lon="11.1575829"/>
+ <node id="917756745" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4656904" lon="11.1564909"/>
+ <node id="917756748" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4655900" lon="11.1568187"/>
+ <node id="917756754" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4650837" lon="11.1563230"/>
+ <node id="917756761" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4650853" lon="11.1529769"/>
+ <node id="917756763" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4654739" lon="11.1565962"/>
+ <node id="917756765" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4656882" lon="11.1557418"/>
+ <node id="917756774" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4658516" lon="11.1568792"/>
+ <node id="917756777" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4650807" lon="11.1550474"/>
+ <node id="917756779" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4650560" lon="11.1562268"/>
+ <node id="917756781" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4651088" lon="11.1562018"/>
+ <node id="917756782" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4654779" lon="11.1558752"/>
+ <node id="917756786" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4655743" lon="11.1558408"/>
+ <node id="917756790" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4655462" lon="11.1570844"/>
+ <node id="917756794" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4656545" lon="11.1550086"/>
+ <node id="917756795" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4651175" lon="11.1555359"/>
+ <node id="917756798" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4651503" lon="11.1568125"/>
+ <node id="917756800" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4651000" lon="11.1573435"/>
+ <node id="917756802" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4649352" lon="11.1558217"/>
+ <node id="917756805" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4655468" lon="11.1563041"/>
+ <node id="917756808" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4657166" lon="11.1570263"/>
+ <node id="917756812" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:21Z" user="geodreieck4711" uid="479256" lat="49.4654992" lon="11.1548048"/>
+ <node id="2402375592" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:47:14Z" user="jacobbraeutigam" uid="1260280" lat="49.4658925" lon="11.1567759">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="1"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375603" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:48:24Z" user="jacobbraeutigam" uid="1260280" lat="49.4657326" lon="11.1557780">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="1"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402375609" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4660828" lon="11.1581949">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="10"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2402375618" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4661572" lon="11.1581551">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="10a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2402375637" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4662284" lon="11.1583387">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="12"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2402375622" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:51:39Z" user="jacobbraeutigam" uid="1260280" lat="49.4651797" lon="11.1567069">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="11"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375632" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:53:31Z" user="jacobbraeutigam" uid="1260280" lat="49.4658167" lon="11.1577947">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="12"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375649" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:55:07Z" user="jacobbraeutigam" uid="1260280" lat="49.4650814" lon="11.1564321">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="13"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375698" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:58:49Z" user="jacobbraeutigam" uid="1260280" lat="49.4653503" lon="11.1536909">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="150a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375719" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:00:12Z" user="jacobbraeutigam" uid="1260280" lat="49.4657430" lon="11.1578703">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="16"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375723" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:00:48Z" user="jacobbraeutigam" uid="1260280" lat="49.4655908" lon="11.1549971">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="160"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375749" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:04:51Z" user="jacobbraeutigam" uid="1260280" lat="49.4658523" lon="11.1563992">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="2"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375754" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:06:02Z" user="jacobbraeutigam" uid="1260280" lat="49.4660820" lon="11.1576499">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="2"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375762" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:06:25Z" user="jacobbraeutigam" uid="1260280" lat="49.4659094" lon="11.1571868">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="2"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+ </node>
+ <node id="2402375774" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:11:24Z" user="jacobbraeutigam" uid="1260280" lat="49.4653900" lon="11.1584598">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="23"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375792" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:12:31Z" user="jacobbraeutigam" uid="1260280" lat="49.4654612" lon="11.1577487">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="24"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375810" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:17:08Z" user="jacobbraeutigam" uid="1260280" lat="49.4656342" lon="11.1568834">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375815" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:18:02Z" user="jacobbraeutigam" uid="1260280" lat="49.4655432" lon="11.1559126">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402375872" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:22:52Z" user="jacobbraeutigam" uid="1260280" lat="49.4653094" lon="11.1571461">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="38a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375881" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:23:13Z" user="jacobbraeutigam" uid="1260280" lat="49.4655552" lon="11.1560012">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402375885" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:23:15Z" user="jacobbraeutigam" uid="1260280" lat="49.4655648" lon="11.1560916">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3b"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402375890" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:23:22Z" user="jacobbraeutigam" uid="1260280" lat="49.4656300" lon="11.1564555">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="4"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375895" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:24:35Z" user="jacobbraeutigam" uid="1260280" lat="49.4659493" lon="11.1573929">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="4"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+ </node>
+ <node id="2402375904" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:24:39Z" user="jacobbraeutigam" uid="1260280" lat="49.4654331" lon="11.1554787">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="4"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402375908" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:25:08Z" user="jacobbraeutigam" uid="1260280" lat="49.4653211" lon="11.1582249">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="40"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375917" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:26:57Z" user="jacobbraeutigam" uid="1260280" lat="49.4651798" lon="11.1583117">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="46"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375926" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:27:17Z" user="jacobbraeutigam" uid="1260280" lat="49.4652072" lon="11.1578181">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="48"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375941" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:27:46Z" user="jacobbraeutigam" uid="1260280" lat="49.4656072" lon="11.1563421">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="4a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375945" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:28:01Z" user="jacobbraeutigam" uid="1260280" lat="49.4654933" lon="11.1570070">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="5"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375954" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:28:43Z" user="jacobbraeutigam" uid="1260280" lat="49.4653308" lon="11.1559728">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="5"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402375958" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:29:23Z" user="jacobbraeutigam" uid="1260280" lat="49.4651260" lon="11.1551435">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="5"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Vorrastraße"/>
+ </node>
+ <node id="2402375962" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:30:11Z" user="jacobbraeutigam" uid="1260280" lat="49.4650659" lon="11.1579050">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="54"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375969" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:30:53Z" user="jacobbraeutigam" uid="1260280" lat="49.4650873" lon="11.1574142">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="56"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375973" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:31:32Z" user="jacobbraeutigam" uid="1260280" lat="49.4654280" lon="11.1565588">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="6"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="2402375982" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:32:25Z" user="jacobbraeutigam" uid="1260280" lat="49.4651773" lon="11.1555891">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="6"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402375985" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:32:58Z" user="jacobbraeutigam" uid="1260280" lat="49.4649460" lon="11.1575010">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="62"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375998" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:37:36Z" user="jacobbraeutigam" uid="1260280" lat="49.4650119" lon="11.1556998">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="8"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Plecher Straße"/>
+ </node>
+ <node id="2402376132" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4649548" lon="11.1554230"/>
+ <node id="2402376134" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4649680" lon="11.1555068"/>
+ <node id="2402376136" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4650034" lon="11.1554049"/>
+ <node id="2402376138" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4650091" lon="11.1553444"/>
+ <node id="2402376140" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4650166" lon="11.1554886"/>
+ <node id="2402376142" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4650366" lon="11.1551533"/>
+ <node id="2402376144" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4650408" lon="11.1570783"/>
+ <node id="2402376149" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4650928" lon="11.1551349"/>
+ <node id="2402376151" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4652831" lon="11.1555331"/>
+ <node id="2402376153" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4652886" lon="11.1559149"/>
+ <node id="2402376155" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4652985" lon="11.1556389"/>
+ <node id="2402376157" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653117" lon="11.1578849"/>
+ <node id="2402376159" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653153" lon="11.1560482"/>
+ <node id="2402376161" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653240" lon="11.1555190"/>
+ <node id="2402376163" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653268" lon="11.1579499"/>
+ <node id="2402376165" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653394" lon="11.1556248"/>
+ <node id="2402376167" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653414" lon="11.1558899"/>
+ <node id="2402376169" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653681" lon="11.1560232"/>
+ <node id="2402376170" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653682" lon="11.1565701"/>
+ <node id="2402376172" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653832" lon="11.1565636"/>
+ <node id="2402376174" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4653994" lon="11.1564148"/>
+ <node id="2402376176" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4654126" lon="11.1564862"/>
+ <node id="2402376178" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4654234" lon="11.1562632"/>
+ <node id="2402376180" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4654468" lon="11.1564019"/>
+ <node id="2402376182" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4654556" lon="11.1562504"/>
+ <node id="2402376184" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4654790" lon="11.1563891"/>
+ <node id="2402376186" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4655539" lon="11.1577515"/>
+ <node id="2402376188" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:52Z" user="geodreieck4711" uid="479256" lat="49.4655690" lon="11.1578166"/>
+ <node id="2402376200" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4657511" lon="11.1581825"/>
+ <node id="2402376206" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4657656" lon="11.1582470"/>
+ <node id="2402376210" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4657743" lon="11.1564494"/>
+ <node id="2402376212" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4657855" lon="11.1565146"/>
+ <node id="2402376215" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4657953" lon="11.1581591"/>
+ <node id="2402376216" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658098" lon="11.1582236"/>
+ <node id="2402376217" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658105" lon="11.1563448"/>
+ <node id="2402376218" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658250" lon="11.1564286"/>
+ <node id="2402376219" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658439" lon="11.1568213"/>
+ <node id="2402376220" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658498" lon="11.1564600"/>
+ <node id="2402376221" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658543" lon="11.1564864"/>
+ <node id="2402376222" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658620" lon="11.1571479"/>
+ <node id="2402376223" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658660" lon="11.1568143"/>
+ <node id="2402376224" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658743" lon="11.1563187"/>
+ <node id="2402376225" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658855" lon="11.1572488"/>
+ <node id="2402376226" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658952" lon="11.1573612"/>
+ <node id="2402376227" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4658955" lon="11.1564412"/>
+ <node id="2402376228" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4659196" lon="11.1574713"/>
+ <node id="2402376229" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4659338" lon="11.1571084"/>
+ <node id="2402376230" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4659481" lon="11.1580768"/>
+ <node id="2402376231" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4659573" lon="11.1572093"/>
+ <node id="2402376232" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4659649" lon="11.1581471"/>
+ <node id="2402376233" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4659805" lon="11.1573165"/>
+ <node id="2402376234" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4659983" lon="11.1580483"/>
+ <node id="2402376235" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4660048" lon="11.1574267"/>
+ <node id="2402376236" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256" lat="49.4660151" lon="11.1581186"/>
+ <node id="1747735470" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:27Z" user="pyram" uid="497849" lat="49.4658832" lon="11.1587817">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="19"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="1747735471" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:27Z" user="pyram" uid="497849" lat="49.4659009" lon="11.1588626">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="21"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="1249743321" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:15Z" user="geodreieck4711" uid="479256" lat="49.4655246" lon="11.1577676"/>
+ <node id="1249743369" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:16Z" user="geodreieck4711" uid="479256" lat="49.4654092" lon="11.1578312"/>
+ <node id="171750578" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:16Z" user="geodreieck4711" uid="479256" lat="49.4651132" lon="11.1570927">
+  <tag k="highway" v="turning_circle"/>
+ </node>
+ <node id="171750586" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4648126" lon="11.1572476"/>
+ <node id="339438796" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4649728" lon="11.1583013"/>
+ <node id="419915042" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4646622" lon="11.1569753"/>
+ <node id="501844345" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4660948" lon="11.1588903"/>
+ <node id="889214749" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4651415" lon="11.1532366"/>
+ <node id="889215060" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:17Z" user="geodreieck4711" uid="479256" lat="49.4652176" lon="11.1532091"/>
+ <node id="910989550" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4652777" lon="11.1535568"/>
+ <node id="914905249" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4653677" lon="11.1582917"/>
+ <node id="914905330" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4650043" lon="11.1578492"/>
+ <node id="2402376190" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4656749" lon="11.1576944"/>
+ <node id="2402376192" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4657061" lon="11.1579264"/>
+ <node id="2402376194" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4657158" lon="11.1579683"/>
+ <node id="2402376196" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4657210" lon="11.1576693"/>
+ <node id="2402376198" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4657262" lon="11.1579154"/>
+ <node id="914905401" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4652546" lon="11.1578734"/>
+ <node id="914905508" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4658033" lon="11.1578678"/>
+ <node id="914905539" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4651398" lon="11.1582338"/>
+ <node id="914907012" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4650394" lon="11.1579957"/>
+ <node id="914907096" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4652195" lon="11.1577268"/>
+ <node id="917756552" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4653572" lon="11.1565105"/>
+ <node id="917756565" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4659259" lon="11.1566767"/>
+ <node id="917756572" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:18Z" user="geodreieck4711" uid="479256" lat="49.4652006" lon="11.1554981"/>
+ <node id="917756575" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4651290" lon="11.1574796"/>
+ <node id="917756581" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4655834" lon="11.1565316"/>
+ <node id="917756585" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4655184" lon="11.1549000"/>
+ <node id="917756592" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4650206" lon="11.1556143"/>
+ <node id="917756595" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4651942" lon="11.1529427"/>
+ <node id="917756597" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4653956" lon="11.1566304"/>
+ <node id="917756601" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4655821" lon="11.1546072"/>
+ <node id="917756606" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4658508" lon="11.1567004"/>
+ <node id="917756609" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4650494" lon="11.1552457"/>
+ <node id="917756612" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4650293" lon="11.1560935"/>
+ <node id="917756619" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4656155" lon="11.1561141"/>
+ <node id="917756622" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4654658" lon="11.1571086"/>
+ <node id="917756626" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4655463" lon="11.1550548"/>
+ <node id="917756632" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4648950" lon="11.1574468"/>
+ <node id="917756635" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4649012" lon="11.1556843"/>
+ <node id="917756638" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4656539" lon="11.1562635"/>
+ <node id="917756641" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4656352" lon="11.1570621"/>
+ <node id="917756644" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4656090" lon="11.1547587"/>
+ <node id="917756647" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4651185" lon="11.1564954"/>
+ <node id="917756656" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4650522" lon="11.1527274"/>
+ <node id="917756657" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4654373" lon="11.1563982"/>
+ <node id="917756660" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4657069" lon="11.1558551"/>
+ <node id="917756669" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4659488" lon="11.1568485"/>
+ <node id="917756673" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4651540" lon="11.1550234"/>
+ <node id="917756676" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4650821" lon="11.1560685"/>
+ <node id="917756687" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4655240" lon="11.1569100"/>
+ <node id="917756692" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4656266" lon="11.1548538"/>
+ <node id="917756694" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4651235" lon="11.1566337"/>
+ <node id="917756699" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4650546" lon="11.1557518"/>
+ <node id="917756705" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:19Z" user="geodreieck4711" uid="479256" lat="49.4656714" lon="11.1567829"/>
+ <node id="917756709" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4654723" lon="11.1546533"/>
+ <node id="917756711" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4650219" lon="11.1563525"/>
+ <node id="917756717" visible="true" version="2" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4651789" lon="11.1552034"/>
+ <node id="917756722" visible="true" version="3" changeset="17165139" timestamp="2013-07-31T11:54:20Z" user="geodreieck4711" uid="479256" lat="49.4657586" lon="11.1557143"/>
+ <node id="914905381" visible="true" version="2" changeset="17166312" timestamp="2013-07-31T13:34:24Z" user="geodreieck4711" uid="479256" lat="49.4650054" lon="11.1588635"/>
+ <node id="914906657" visible="true" version="2" changeset="17166312" timestamp="2013-07-31T13:34:25Z" user="geodreieck4711" uid="479256" lat="49.4649595" lon="11.1587185"/>
+ <node id="914907083" visible="true" version="2" changeset="17166312" timestamp="2013-07-31T13:34:25Z" user="geodreieck4711" uid="479256" lat="49.4649187" lon="11.1589285"/>
+ <node id="914907504" visible="true" version="2" changeset="17166312" timestamp="2013-07-31T13:34:26Z" user="geodreieck4711" uid="479256" lat="49.4648728" lon="11.1587835"/>
+ <node id="2405179995" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4650469" lon="11.1542496"/>
+ <node id="2405179999" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4650743" lon="11.1544189"/>
+ <node id="2405180001" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4652771" lon="11.1541614"/>
+ <node id="2405180003" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4653045" lon="11.1543307"/>
+ <node id="2405180005" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4653053" lon="11.1543005"/>
+ <node id="2405180008" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4653248" lon="11.1544206"/>
+ <node id="2405180010" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4653569" lon="11.1542808"/>
+ <node id="2405180012" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4653763" lon="11.1544009"/>
+ <node id="2405180014" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4653964" lon="11.1546172"/>
+ <node id="2405180016" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4654068" lon="11.1546815"/>
+ <node id="2405180018" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4654125" lon="11.1542678"/>
+ <node id="2405180020" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4654311" lon="11.1543831"/>
+ <node id="2405180023" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4654511" lon="11.1545963"/>
+ <node id="2405180024" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4654615" lon="11.1546606"/>
+ <node id="2405180026" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4654722" lon="11.1542450"/>
+ <node id="2405180029" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645" lat="49.4654908" lon="11.1543603"/>
+ <node id="917756593" visible="true" version="4" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4653861" lon="11.1548557"/>
+ <node id="917756654" visible="true" version="4" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4652554" lon="11.1547183"/>
+ <node id="917756700" visible="true" version="4" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4653529" lon="11.1546757"/>
+ <node id="917756760" visible="true" version="4" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645" lat="49.4652886" lon="11.1548984"/>
+ <node id="2617614108" visible="true" version="1" changeset="19921576" timestamp="2014-01-10T17:47:23Z" user="haytigran" uid="360562" lat="49.4627243" lon="11.1544057"/>
+ <node id="2617614116" visible="true" version="1" changeset="19921576" timestamp="2014-01-10T17:47:23Z" user="haytigran" uid="360562" lat="49.4627425" lon="11.1544289"/>
+ <node id="339438788" visible="true" version="6" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4630473" lon="11.1549568">
+  <tag k="highway" v="traffic_signals"/>
+ </node>
+ <node id="249851542" visible="true" version="5" changeset="20808607" timestamp="2014-02-27T13:08:30Z" user="kaddo graffie" uid="517355" lat="49.4626836" lon="11.1560404"/>
+ <node id="1569002923" visible="true" version="3" changeset="20808607" timestamp="2014-02-27T13:08:30Z" user="kaddo graffie" uid="517355" lat="49.4642495" lon="11.1514947"/>
+ <node id="1808108239" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:30Z" user="kaddo graffie" uid="517355" lat="49.4644639" lon="11.1511360"/>
+ <node id="1808108238" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:30Z" user="kaddo graffie" uid="517355" lat="49.4644160" lon="11.1511670"/>
+ <node id="1569002925" visible="true" version="3" changeset="20808607" timestamp="2014-02-27T13:08:30Z" user="kaddo graffie" uid="517355" lat="49.4643057" lon="11.1507622"/>
+ <node id="529675409" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:30Z" user="kaddo graffie" uid="517355" lat="49.4627142" lon="11.1624841"/>
+ <node id="1569002927" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4645148" lon="11.1524595"/>
+ <node id="411043133" visible="true" version="5" changeset="37959435" timestamp="2016-03-20T17:00:09Z" user="pyram" uid="497849" lat="49.4610080" lon="11.1606344"/>
+ <node id="2109913133" visible="true" version="3" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4685342" lon="11.1826071"/>
+ <node id="411043134" visible="true" version="5" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4599058" lon="11.1617671"/>
+ <node id="419878682" visible="true" version="4" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4610741" lon="11.1633994"/>
+ <node id="411043127" visible="true" version="5" changeset="37987008" timestamp="2016-03-21T21:30:18Z" user="pyram" uid="497849" lat="49.4634675" lon="11.1618067"/>
+ <node id="2109913266" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4693067" lon="11.1824754"/>
+ <node id="2109913287" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4697434" lon="11.1825102"/>
+ <node id="1963694786" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4691786" lon="11.1689107"/>
+ <node id="1428414890" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4701458" lon="11.1688469"/>
+ <node id="1963694864" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4700454" lon="11.1688012"/>
+ <node id="148436879" visible="true" version="6" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4664245" lon="11.1526875"/>
+ <node id="538254577" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4664131" lon="11.1525909">
+  <tag k="barrier" v="bollard"/>
+ </node>
+ <node id="411043155" visible="true" version="5" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4666911" lon="11.1460035"/>
+ <node id="1963694788" visible="true" version="3" changeset="30517738" timestamp="2015-04-26T20:53:19Z" user="pyram" uid="497849" lat="49.4692553" lon="11.1689078"/>
+ <node id="1522932696" visible="true" version="3" changeset="32227711" timestamp="2015-06-26T15:24:02Z" user="CaptainCrunch" uid="13363" lat="49.4618904" lon="11.1305148"/>
+ <node id="1693942639" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4676457" lon="11.1348863"/>
+ <node id="539237108" visible="true" version="2" changeset="20808607" timestamp="2014-02-27T13:08:31Z" user="kaddo graffie" uid="517355" lat="49.4682778" lon="11.1411939"/>
+ <node id="1428414887" visible="true" version="3" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4690315" lon="11.1690617"/>
+ <node id="1428414903" visible="true" version="4" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4692523" lon="11.1694720"/>
+ <node id="1428414904" visible="true" version="4" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4694502" lon="11.1701384"/>
+ <node id="539237099" visible="true" version="6" changeset="26613710" timestamp="2014-11-07T12:45:33Z" user="CaptainCrunch" uid="13363" lat="49.4642925" lon="11.1333242"/>
+ <node id="1693942549" visible="true" version="3" changeset="20882108" timestamp="2014-03-03T07:08:38Z" user="FvGordon" uid="161619" lat="49.4670799" lon="11.1444602"/>
+ <node id="2188655619" visible="true" version="3" changeset="29781608" timestamp="2015-03-27T16:27:49Z" user="pyram" uid="497849" lat="49.4663294" lon="11.1588610">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="18"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2188655620" visible="true" version="3" changeset="29781608" timestamp="2015-03-27T16:27:49Z" user="pyram" uid="497849" lat="49.4663482" lon="11.1589475">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="18a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2188622776" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:50Z" user="pyram" uid="497849" lat="49.4666160" lon="11.1589923"/>
+ <node id="2188622777" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:50Z" user="pyram" uid="497849" lat="49.4666248" lon="11.1590661"/>
+ <node id="2188622781" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:50Z" user="pyram" uid="497849" lat="49.4666597" lon="11.1589801"/>
+ <node id="2188622782" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:50Z" user="pyram" uid="497849" lat="49.4666685" lon="11.1590540"/>
+ <node id="2188655784" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:50Z" user="pyram" uid="497849" lat="49.4662253" lon="11.1588897"/>
+ <node id="2188655857" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:50Z" user="pyram" uid="497849" lat="49.4663246" lon="11.1588388"/>
+ <node id="914905597" visible="true" version="4" changeset="29781608" timestamp="2015-03-27T16:27:51Z" user="pyram" uid="497849" lat="49.4666387" lon="11.1589860"/>
+ <node id="914905744" visible="true" version="4" changeset="29781608" timestamp="2015-03-27T16:27:51Z" user="pyram" uid="497849" lat="49.4666126" lon="11.1587661"/>
+ <node id="914906620" visible="true" version="4" changeset="29781608" timestamp="2015-03-27T16:27:51Z" user="pyram" uid="497849" lat="49.4665093" lon="11.1587949"/>
+ <node id="2924643699" visible="true" version="1" changeset="23043375" timestamp="2014-06-20T12:40:55Z" user="kukuk" uid="346758" lat="49.4677352" lon="11.1585239"/>
+ <node id="2924643700" visible="true" version="1" changeset="23043375" timestamp="2014-06-20T12:40:55Z" user="kukuk" uid="346758" lat="49.4682502" lon="11.1596294"/>
+ <node id="2188622904" visible="true" version="2" changeset="23043375" timestamp="2014-06-20T12:40:58Z" user="kukuk" uid="346758" lat="49.4671349" lon="11.1579641"/>
+ <node id="270963171" visible="true" version="4" changeset="23043375" timestamp="2014-06-20T12:40:58Z" user="kukuk" uid="346758" lat="49.4681504" lon="11.1593284"/>
+ <node id="270973177" visible="true" version="3" changeset="23043375" timestamp="2014-06-20T12:40:58Z" user="kukuk" uid="346758" lat="49.4672145" lon="11.1579665"/>
+ <node id="270973178" visible="true" version="3" changeset="23043375" timestamp="2014-06-20T12:40:58Z" user="kukuk" uid="346758" lat="49.4678753" lon="11.1586958"/>
+ <node id="1512643191" visible="true" version="2" changeset="29961708" timestamp="2015-04-03T21:39:03Z" user="pyram" uid="497849" lat="49.4640410" lon="11.1350738"/>
+ <node id="249846784" visible="true" version="3" changeset="29961708" timestamp="2015-04-03T21:39:03Z" user="pyram" uid="497849" lat="49.4639542" lon="11.1350926"/>
+ <node id="419878578" visible="true" version="4" changeset="40329862" timestamp="2016-06-27T20:18:52Z" user="pyram" uid="497849" lat="49.4627784" lon="11.1411069"/>
+ <node id="419878581" visible="true" version="3" changeset="40329862" timestamp="2016-06-27T20:18:52Z" user="pyram" uid="497849" lat="49.4628931" lon="11.1416036"/>
+ <node id="2996656916" visible="true" version="1" changeset="24543948" timestamp="2014-08-04T20:54:09Z" user="geodreieck4711" uid="479256" lat="49.4663036" lon="11.1550579">
+  <tag k="emergency" v="fire_hydrant"/>
+  <tag k="fire_hydrant:diameter" v="100"/>
+  <tag k="fire_hydrant:position" v="sidewalk"/>
+  <tag k="fire_hydrant:type" v="pillar"/>
+ </node>
+ <node id="2188622694" visible="true" version="3" changeset="37614145" timestamp="2016-03-04T18:28:24Z" user="pyram" uid="497849" lat="49.4667465" lon="11.1585405">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="11"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2402375667" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:57:35Z" user="jacobbraeutigam" uid="1260280" lat="49.4651884" lon="11.1531457">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="146"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375672" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:57:35Z" user="jacobbraeutigam" uid="1260280" lat="49.4650333" lon="11.1530766">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="146a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375689" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:57:36Z" user="jacobbraeutigam" uid="1260280" lat="49.4653283" lon="11.1535696">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="148"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375693" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:57:51Z" user="jacobbraeutigam" uid="1260280" lat="49.4650790" lon="11.1561480">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="15"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Artelshofer Straße"/>
+ </node>
+ <node id="1462097915" visible="true" version="3" changeset="25181325" timestamp="2014-09-02T14:58:49Z" user="jacobbraeutigam" uid="1260280" lat="49.4653417" lon="11.1536435">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="150"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375706" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:58:52Z" user="jacobbraeutigam" uid="1260280" lat="49.4655279" lon="11.1546618">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="154"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375711" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:58:54Z" user="jacobbraeutigam" uid="1260280" lat="49.4655407" lon="11.1547322">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="156"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375714" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T14:58:56Z" user="jacobbraeutigam" uid="1260280" lat="49.4655805" lon="11.1549070">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="158"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622709" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:04:19Z" user="jacobbraeutigam" uid="1260280" lat="49.4665825" lon="11.1566025">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="199"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622716" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:08:34Z" user="jacobbraeutigam" uid="1260280" lat="49.4668292" lon="11.1579910">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="214"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622717" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:08:34Z" user="jacobbraeutigam" uid="1260280" lat="49.4669963" lon="11.1581760">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="214a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2188622718" visible="true" version="2" changeset="25181325" timestamp="2014-09-02T15:08:34Z" user="jacobbraeutigam" uid="1260280" lat="49.4670190" lon="11.1584550">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="216"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+ </node>
+ <node id="2402375855" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:22:05Z" user="jacobbraeutigam" uid="1260280" lat="49.4655281" lon="11.1590624">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="37"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375868" visible="true" version="2" changeset="25185559" timestamp="2014-09-02T16:22:23Z" user="jacobbraeutigam" uid="1260280" lat="49.4653247" lon="11.1572139">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="38"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="3059040763" visible="true" version="1" changeset="25223975" timestamp="2014-09-04T11:17:10Z" user="marek kleciak" uid="338611" lat="49.4696850" lon="11.1412083"/>
+ <node id="253128160" visible="true" version="3" changeset="25223975" timestamp="2014-09-04T11:17:12Z" user="marek kleciak" uid="338611" lat="49.4694256" lon="11.1413568"/>
+ <node id="250942534" visible="true" version="2" changeset="25223975" timestamp="2014-09-04T11:17:12Z" user="marek kleciak" uid="338611" lat="49.4687845" lon="11.1419703"/>
+ <node id="250942535" visible="true" version="2" changeset="25223975" timestamp="2014-09-04T11:17:12Z" user="marek kleciak" uid="338611" lat="49.4689821" lon="11.1417769"/>
+ <node id="3128477490" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:49Z" user="pyram" uid="497849" lat="49.4637063" lon="11.1532511"/>
+ <node id="3128477497" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:49Z" user="pyram" uid="497849" lat="49.4639104" lon="11.1532905"/>
+ <node id="3128477499" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:49Z" user="pyram" uid="497849" lat="49.4639298" lon="11.1536836"/>
+ <node id="3128477506" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:49Z" user="pyram" uid="497849" lat="49.4640381" lon="11.1544868"/>
+ <node id="3128477515" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:49Z" user="pyram" uid="497849" lat="49.4641284" lon="11.1544291"/>
+ <node id="3128482129" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:49Z" user="pyram" uid="497849" lat="49.4643775" lon="11.1558504"/>
+ <node id="3128482130" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:49Z" user="pyram" uid="497849" lat="49.4644579" lon="11.1563144"/>
+ <node id="3128482133" visible="true" version="1" changeset="26060088" timestamp="2014-10-13T21:26:50Z" user="pyram" uid="497849" lat="49.4645633" lon="11.1562570"/>
+ <node id="3128508647" visible="true" version="1" changeset="26060592" timestamp="2014-10-13T21:53:12Z" user="pyram" uid="497849" lat="49.4644646" lon="11.1563605"/>
+ <node id="3128508648" visible="true" version="1" changeset="26060592" timestamp="2014-10-13T21:53:12Z" user="pyram" uid="497849" lat="49.4645503" lon="11.1563087"/>
+ <node id="3128508649" visible="true" version="1" changeset="26060592" timestamp="2014-10-13T21:53:12Z" user="pyram" uid="497849" lat="49.4648159" lon="11.1571749"/>
+ <node id="3128508650" visible="true" version="1" changeset="26060592" timestamp="2014-10-13T21:53:12Z" user="pyram" uid="497849" lat="49.4648411" lon="11.1574449"/>
+ <node id="3128508651" visible="true" version="1" changeset="26060592" timestamp="2014-10-13T21:53:12Z" user="pyram" uid="497849" lat="49.4649021" lon="11.1585859"/>
+ <node id="3128508652" visible="true" version="1" changeset="26060592" timestamp="2014-10-13T21:53:12Z" user="pyram" uid="497849" lat="49.4651260" lon="11.1584578"/>
+ <node id="3157273528" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4678505" lon="11.1607831"/>
+ <node id="3157273533" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4680098" lon="11.1602493"/>
+ <node id="3157273534" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4680479" lon="11.1609384"/>
+ <node id="3157273535" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4680804" lon="11.1598218"/>
+ <node id="1428414907" visible="true" version="4" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4697493" lon="11.1703015"/>
+ <node id="1525213431" visible="true" version="3" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4692631" lon="11.1390998"/>
+ <node id="1963694822" visible="true" version="3" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4695633" lon="11.1695811"/>
+ <node id="2109913259" visible="true" version="3" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4689932" lon="11.1821158"/>
+ <node id="295093024" visible="true" version="28" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4689758" lon="11.1826398"/>
+ <node id="411043149" visible="true" version="5" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4688799" lon="11.1690319"/>
+ <node id="539237103" visible="true" version="4" changeset="26426675" timestamp="2014-10-30T00:53:31Z" user="pyram" uid="497849" lat="49.4686777" lon="11.1385379"/>
+ <node id="171750562" visible="true" version="7" changeset="26563807" timestamp="2014-11-05T05:17:17Z" user="theophrastos" uid="96069" lat="49.4660544" lon="11.1564864"/>
+ <node id="1522932715" visible="true" version="3" changeset="42404513" timestamp="2016-09-24T12:44:14Z" user="pyram" uid="497849" lat="49.4645089" lon="11.1332982"/>
+ <node id="1370391749" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4696395" lon="11.1511377"/>
+ <node id="1370391751" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4695447" lon="11.1494203"/>
+ <node id="1370391752" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4694372" lon="11.1486175"/>
+ <node id="1370391753" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4697502" lon="11.1474012"/>
+ <node id="1370391755" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4692402" lon="11.1470107"/>
+ <node id="1370391759" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4691526" lon="11.1474936"/>
+ <node id="1370391770" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4687353" lon="11.1474061"/>
+ <node id="1370391772" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4690181" lon="11.1542451"/>
+ <node id="1370391779" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4693863" lon="11.1532462"/>
+ <node id="1370391782" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4697554" lon="11.1536844"/>
+ <node id="1428414882" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4667382" lon="11.1542544"/>
+ <node id="148479657" visible="true" version="5" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4685923" lon="11.1470601"/>
+ <node id="1525143740" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4675318" lon="11.1447436"/>
+ <node id="1525143746" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4683239" lon="11.1414917"/>
+ <node id="1693942417" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:18Z" user="CaptainCrunch" uid="13363" lat="49.4668000" lon="11.1460688"/>
+ <node id="1769374949" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4663243" lon="11.1516417"/>
+ <node id="306532162" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4696580" lon="11.1390666"/>
+ <node id="539237104" visible="true" version="3" changeset="32121688" timestamp="2015-06-21T17:08:19Z" user="CaptainCrunch" uid="13363" lat="49.4695710" lon="11.1378296"/>
+ <node id="1225946505" visible="true" version="2" changeset="32121688" timestamp="2015-06-21T17:23:04Z" user="CaptainCrunch" uid="13363" lat="49.4685649" lon="11.1450556"/>
+ <node id="87027665" visible="true" version="4" changeset="32121688" timestamp="2015-06-21T17:23:05Z" user="CaptainCrunch" uid="13363" lat="49.4696202" lon="11.1543817"/>
+ <node id="1522932703" visible="true" version="2" changeset="32227711" timestamp="2015-06-26T15:24:02Z" user="CaptainCrunch" uid="13363" lat="49.4630689" lon="11.1333889"/>
+ <node id="1470605761" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4663108" lon="11.1549140"/>
+ <node id="1470605763" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4663228" lon="11.1550085"/>
+ <node id="1470605764" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4663634" lon="11.1548984"/>
+ <node id="1470605765" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4663753" lon="11.1549928"/>
+ <node id="1470605779" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4665415" lon="11.1545192"/>
+ <node id="1470605788" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4666169" lon="11.1543085"/>
+ <node id="1470605789" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:40Z" user="geodreieck4711" uid="479256" lat="49.4666391" lon="11.1544910"/>
+ <node id="889214708" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4653632" lon="11.1523204"/>
+ <node id="889215014" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4654576" lon="11.1523198"/>
+ <node id="889215442" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4654482" lon="11.1526445"/>
+ <node id="910988680" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4662924" lon="11.1523016"/>
+ <node id="910988724" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4657316" lon="11.1520167"/>
+ <node id="910988928" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4658867" lon="11.1531001"/>
+ <node id="910989087" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:41Z" user="geodreieck4711" uid="479256" lat="49.4658851" lon="11.1537652"/>
+ <node id="910989248" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4657760" lon="11.1531079"/>
+ <node id="910989301" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4663192" lon="11.1534183"/>
+ <node id="910989584" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4659863" lon="11.1537317"/>
+ <node id="910989787" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4658199" lon="11.1533594"/>
+ <node id="910990236" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4664229" lon="11.1533747"/>
+ <node id="910990250" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4664601" lon="11.1535845"/>
+ <node id="917756589" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4660064" lon="11.1520448"/>
+ <node id="917756599" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4666185" lon="11.1548384"/>
+ <node id="917756607" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4661159" lon="11.1551726"/>
+ <node id="917756648" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4659279" lon="11.1522305"/>
+ <node id="917756688" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4664639" lon="11.1556286"/>
+ <node id="917756695" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:42Z" user="geodreieck4711" uid="479256" lat="49.4659208" lon="11.1520529"/>
+ <node id="917756706" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4665360" lon="11.1548655"/>
+ <node id="917756755" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4660135" lon="11.1522224"/>
+ <node id="917756766" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4665975" lon="11.1546866"/>
+ <node id="917756791" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4664404" lon="11.1554592"/>
+ <node id="917756809" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:43Z" user="geodreieck4711" uid="479256" lat="49.4665150" lon="11.1547136"/>
+ <node id="497173463" visible="true" version="7" changeset="42967796" timestamp="2016-10-17T19:39:09Z" user="mechanischer_Basstoelpel" uid="4733311" lat="49.4656327" lon="11.1588754">
+  <tag k="genus" v="Quercus"/>
+  <tag k="genus:de" v="Eiche"/>
+  <tag k="genus:en" v="Oak"/>
+  <tag k="leaf_type" v="broadleaved"/>
+  <tag k="natural" v="tree"/>
+ </node>
+ <node id="249773878" visible="true" version="5" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611" lat="49.4656567" lon="11.1544396"/>
+ <node id="305537489" visible="true" version="6" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4665136" lon="11.1572641"/>
+ <node id="1368601583" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4655968" lon="11.1540965"/>
+ <node id="1564890415" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4663353" lon="11.1572698">
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="270963246" visible="true" version="7" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4664098" lon="11.1572467"/>
+ <node id="270963173" visible="true" version="8" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4666063" lon="11.1573708"/>
+ <node id="1564890412" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4661522" lon="11.1570327">
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="1808108283" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4650089" lon="11.1520152"/>
+ <node id="2402376147" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4650652" lon="11.1531504"/>
+ <node id="2402376146" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4650465" lon="11.1530202"/>
+ <node id="2402376130" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4649485" lon="11.1531901"/>
+ <node id="2402376128" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:48Z" user="marek kleciak" uid="338611" lat="49.4649298" lon="11.1530598"/>
+ <node id="224088868" visible="true" version="7" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4631889" lon="11.1539333"/>
+ <node id="224088888" visible="true" version="6" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4635889" lon="11.1580467"/>
+ <node id="375768277" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4630859" lon="11.1544267"/>
+ <node id="521209581" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4635369" lon="11.1598535"/>
+ <node id="1808107781" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4631975" lon="11.1563412"/>
+ <node id="339438794" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T14:04:41Z" user="marek kleciak" uid="338611" lat="49.4630466" lon="11.1552219"/>
+ <node id="339438795" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T14:04:41Z" user="marek kleciak" uid="338611" lat="49.4630694" lon="11.1555335"/>
+ <node id="2188622700" visible="true" version="3" changeset="37614145" timestamp="2016-03-04T18:28:24Z" user="pyram" uid="497849" lat="49.4668355" lon="11.1588229">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="15"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2188622793" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4667060" lon="11.1587059"/>
+ <node id="2188622806" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4667381" lon="11.1589980"/>
+ <node id="2188622813" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4667863" lon="11.1585302"/>
+ <node id="2188622817" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4668028" lon="11.1586809"/>
+ <node id="2188622819" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4668130" lon="11.1586783"/>
+ <node id="2188622828" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:25Z" user="pyram" uid="497849" lat="49.4668450" lon="11.1589703"/>
+ <node id="2402375654" visible="true" version="8" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4657388" lon="11.1579303">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="14"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+ </node>
+ <node id="2402375659" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:26Z" user="pyram" uid="497849" lat="49.4662362" lon="11.1583803">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="14"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2402375994" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:28Z" user="pyram" uid="497849" lat="49.4658910" lon="11.1583510">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="8"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="2402376002" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4659454" lon="11.1583194">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="8a"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="1740065296" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4659120" lon="11.1589137"/>
+ <node id="1740065297" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4658040" lon="11.1589690"/>
+ <node id="1740065298" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657516" lon="11.1587285"/>
+ <node id="1740065299" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4658596" lon="11.1586732"/>
+ <node id="1740070375" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657853" lon="11.1584475"/>
+ <node id="1740070378" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4658369" lon="11.1586848"/>
+ <node id="1740070380" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657292" lon="11.1587401"/>
+ <node id="1740070382" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4656775" lon="11.1585027"/>
+ <node id="2109912890" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657649" lon="11.1584579"/>
+ <node id="2109912923" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657691" lon="11.1588087"/>
+ <node id="2109912931" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4658025" lon="11.1585266"/>
+ <node id="2109912936" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4657865" lon="11.1588889"/>
+ <node id="2109912941" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4658197" lon="11.1586057"/>
+ <node id="2109912969" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4658771" lon="11.1587534"/>
+ <node id="2109912982" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:29Z" user="pyram" uid="497849" lat="49.4658945" lon="11.1588335"/>
+ <node id="2402376202" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4657553" lon="11.1578995"/>
+ <node id="2402376204" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4657651" lon="11.1579414"/>
+ <node id="2402376208" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4657722" lon="11.1578903"/>
+ <node id="914905364" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4661144" lon="11.1582845"/>
+ <node id="914905992" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4661580" lon="11.1585140"/>
+ <node id="914906357" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4658586" lon="11.1583698"/>
+ <node id="914906857" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4662535" lon="11.1584713"/>
+ <node id="914907066" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:31Z" user="pyram" uid="497849" lat="49.4662100" lon="11.1582418"/>
+ <node id="249851541" visible="true" version="6" changeset="37959435" timestamp="2016-03-20T17:00:06Z" user="pyram" uid="497849" lat="49.4624166" lon="11.1625094"/>
+ <node id="295093017" visible="true" version="27" changeset="37959435" timestamp="2016-03-20T17:00:06Z" user="pyram" uid="497849" lat="49.4635458" lon="11.1722839"/>
+ <node id="3096580838" visible="true" version="2" changeset="37959435" timestamp="2016-03-20T17:00:07Z" user="pyram" uid="497849" lat="49.4607976" lon="11.1613370"/>
+ <node id="3096593131" visible="true" version="2" changeset="37959435" timestamp="2016-03-20T17:00:07Z" user="pyram" uid="497849" lat="49.4607688" lon="11.1618924"/>
+ <node id="419878673" visible="true" version="2" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4629805" lon="11.1719891"/>
+ <node id="419878674" visible="true" version="2" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4621380" lon="11.1721480"/>
+ <node id="419878690" visible="true" version="3" changeset="37959435" timestamp="2016-03-20T17:00:10Z" user="pyram" uid="497849" lat="49.4603454" lon="11.1625864"/>
+ <node id="1522932706" visible="true" version="2" changeset="42404513" timestamp="2016-09-24T12:44:14Z" user="pyram" uid="497849" lat="49.4634460" lon="11.1282674"/>
+ <node id="1522932713" visible="true" version="3" changeset="42404513" timestamp="2016-09-24T12:44:14Z" user="pyram" uid="497849" lat="49.4642784" lon="11.1295090"/>
+ <node id="1522932717" visible="true" version="2" changeset="42404513" timestamp="2016-09-24T12:44:14Z" user="pyram" uid="497849" lat="49.4648236" lon="11.1296736"/>
+ <node id="1525143712" visible="true" version="3" changeset="42404513" timestamp="2016-09-24T12:44:14Z" user="pyram" uid="497849" lat="49.4653457" lon="11.1350511"/>
+ <node id="1525143717" visible="true" version="2" changeset="42404513" timestamp="2016-09-24T12:44:15Z" user="pyram" uid="497849" lat="49.4662492" lon="11.1352638"/>
+ <node id="1525143760" visible="true" version="3" changeset="42404513" timestamp="2016-09-24T12:44:15Z" user="pyram" uid="497849" lat="49.4691681" lon="11.1408736"/>
+ <node id="529678580" visible="true" version="2" changeset="42404513" timestamp="2016-09-24T12:44:15Z" user="pyram" uid="497849" lat="49.4648012" lon="11.1296682"/>
+ <node id="529678581" visible="true" version="2" changeset="42404513" timestamp="2016-09-24T12:44:16Z" user="pyram" uid="497849" lat="49.4655222" lon="11.1296849"/>
+ <node id="529678591" visible="true" version="4" changeset="42404513" timestamp="2016-09-24T12:44:16Z" user="pyram" uid="497849" lat="49.4662488" lon="11.1352642"/>
+ <node id="529678649" visible="true" version="2" changeset="42404513" timestamp="2016-09-24T12:44:16Z" user="pyram" uid="497849" lat="49.4716172" lon="11.1423089"/>
+ <node id="539237102" visible="true" version="3" changeset="42404513" timestamp="2016-09-24T12:44:16Z" user="pyram" uid="497849" lat="49.4680391" lon="11.1373833"/>
+ <node id="539237109" visible="true" version="4" changeset="42404513" timestamp="2016-09-24T12:44:16Z" user="pyram" uid="497849" lat="49.4689688" lon="11.1409854"/>
+ <node id="3421803778" visible="true" version="1" changeset="29781608" timestamp="2015-03-27T16:27:44Z" user="pyram" uid="497849" lat="49.4662438" lon="11.1589749"/>
+ <node id="3421803779" visible="true" version="1" changeset="29781608" timestamp="2015-03-27T16:27:44Z" user="pyram" uid="497849" lat="49.4662623" lon="11.1590601"/>
+ <node id="3421803784" visible="true" version="1" changeset="29781608" timestamp="2015-03-27T16:27:44Z" user="pyram" uid="497849" lat="49.4663431" lon="11.1589239"/>
+ <node id="3421803786" visible="true" version="1" changeset="29781608" timestamp="2015-03-27T16:27:44Z" user="pyram" uid="497849" lat="49.4663616" lon="11.1590090"/>
+ <node id="3435839402" visible="true" version="1" changeset="29961708" timestamp="2015-04-03T21:38:43Z" user="pyram" uid="497849" lat="49.4639511" lon="11.1351047"/>
+ <node id="3435839404" visible="true" version="1" changeset="29961708" timestamp="2015-04-03T21:38:43Z" user="pyram" uid="497849" lat="49.4640244" lon="11.1351366"/>
+ <node id="3435839405" visible="true" version="1" changeset="29961708" timestamp="2015-04-03T21:38:43Z" user="pyram" uid="497849" lat="49.4640423" lon="11.1350689"/>
+ <node id="3435839406" visible="true" version="1" changeset="29961708" timestamp="2015-04-03T21:38:43Z" user="pyram" uid="497849" lat="49.4640732" lon="11.1348853"/>
+ <node id="3435839407" visible="true" version="1" changeset="29961708" timestamp="2015-04-03T21:38:43Z" user="pyram" uid="497849" lat="49.4640850" lon="11.1348955"/>
+ <node id="4268755508" visible="true" version="1" changeset="40329862" timestamp="2016-06-27T20:18:18Z" user="pyram" uid="497849" lat="49.4624268" lon="11.1412756"/>
+ <node id="4268755510" visible="true" version="1" changeset="40329862" timestamp="2016-06-27T20:18:18Z" user="pyram" uid="497849" lat="49.4624870" lon="11.1419124"/>
+ <node id="4268755512" visible="true" version="1" changeset="40329862" timestamp="2016-06-27T20:18:19Z" user="pyram" uid="497849" lat="49.4628143" lon="11.1410773"/>
+ <node id="4268755515" visible="true" version="1" changeset="40329862" timestamp="2016-06-27T20:18:19Z" user="pyram" uid="497849" lat="49.4629292" lon="11.1415800"/>
+ <node id="3157273537" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4681027" lon="11.1605524"/>
+ <node id="3157273538" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4681798" lon="11.1602593"/>
+ <node id="3157273540" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4681854" lon="11.1597503"/>
+ <node id="3157273541" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4682514" lon="11.1602207"/>
+ <node id="3157273542" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4683074" lon="11.1596910"/>
+ <node id="3157273543" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:15Z" user="pyram" uid="497849" lat="49.4683920" lon="11.1600859"/>
+ <node id="3157273552" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4690103" lon="11.1730337"/>
+ <node id="3157273553" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4690280" lon="11.1748506"/>
+ <node id="3157273554" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4690461" lon="11.1739716"/>
+ <node id="3157273557" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4691759" lon="11.1657925"/>
+ <node id="3157273560" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4692268" lon="11.1396559"/>
+ <node id="3157273565" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4693984" lon="11.1748144"/>
+ <node id="3157273566" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4694214" lon="11.1665222"/>
+ <node id="3157273575" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4699910" lon="11.1678916"/>
+ <node id="3157273576" visible="true" version="1" changeset="26426675" timestamp="2014-10-30T00:53:16Z" user="pyram" uid="497849" lat="49.4700969" lon="11.1668148"/>
+ <node id="3167978658" visible="true" version="1" changeset="26563807" timestamp="2014-11-05T05:16:50Z" user="theophrastos" uid="96069" lat="49.4641775" lon="11.1478643"/>
+ <node id="3167978659" visible="true" version="1" changeset="26563807" timestamp="2014-11-05T05:16:50Z" user="theophrastos" uid="96069" lat="49.4670045" lon="11.1578202"/>
+ <node id="3172155498" visible="true" version="1" changeset="26613710" timestamp="2014-11-07T12:45:26Z" user="CaptainCrunch" uid="13363" lat="49.4637376" lon="11.1348890">
+  <tag k="barrier" v="gate"/>
+ </node>
+ <node id="3497710759" visible="true" version="1" changeset="30789430" timestamp="2015-05-04T19:44:37Z" user="pyram" uid="497849" lat="49.4656960" lon="11.1552419">
+  <tag k="addr:housenumber" v="162"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+  <tag k="entrance" v="main"/>
+ </node>
+ <node id="3497710761" visible="true" version="1" changeset="30789430" timestamp="2015-05-04T19:44:37Z" user="pyram" uid="497849" lat="49.4655640" lon="11.1551486"/>
+ <node id="3497710762" visible="true" version="1" changeset="30789430" timestamp="2015-05-04T19:44:37Z" user="pyram" uid="497849" lat="49.4656159" lon="11.1554366"/>
+ <node id="3497710763" visible="true" version="1" changeset="30789430" timestamp="2015-05-04T19:44:37Z" user="pyram" uid="497849" lat="49.4656710" lon="11.1551029"/>
+ <node id="3497710764" visible="true" version="1" changeset="30789430" timestamp="2015-05-04T19:44:37Z" user="pyram" uid="497849" lat="49.4657229" lon="11.1553909"/>
+ <node id="3609297501" visible="true" version="1" changeset="32121688" timestamp="2015-06-21T17:08:10Z" user="CaptainCrunch" uid="13363" lat="49.4664371" lon="11.1526795"/>
+ <node id="3655753635" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:39Z" user="marek kleciak" uid="338611" lat="49.4611959" lon="11.1320164"/>
+ <node id="3655753641" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:39Z" user="marek kleciak" uid="338611" lat="49.4613517" lon="11.1313054"/>
+ <node id="3655753659" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:40Z" user="marek kleciak" uid="338611" lat="49.4612391" lon="11.1316312"/>
+ <node id="3655753697" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:40Z" user="marek kleciak" uid="338611" lat="49.4615098" lon="11.1342580"/>
+ <node id="3655758895" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:42Z" user="marek kleciak" uid="338611" lat="49.4612162" lon="11.1317109"/>
+ <node id="3655758910" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:42Z" user="marek kleciak" uid="338611" lat="49.4612851" lon="11.1323817"/>
+ <node id="3655758912" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:42Z" user="marek kleciak" uid="338611" lat="49.4613993" lon="11.1330195"/>
+ <node id="3655758926" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:43Z" user="marek kleciak" uid="338611" lat="49.4614650" lon="11.1337953"/>
+ <node id="3655758927" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:43Z" user="marek kleciak" uid="338611" lat="49.4614199" lon="11.1332304"/>
+ <node id="3655758934" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:43Z" user="marek kleciak" uid="338611" lat="49.4612391" lon="11.1322055"/>
+ <node id="3655758944" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:43Z" user="marek kleciak" uid="338611" lat="49.4611936" lon="11.1318718"/>
+ <node id="3655758945" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:43Z" user="marek kleciak" uid="338611" lat="49.4613366" lon="11.1326092"/>
+ <node id="3655758957" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:43Z" user="marek kleciak" uid="338611" lat="49.4613660" lon="11.1327836"/>
+ <node id="3655758959" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:43Z" user="marek kleciak" uid="338611" lat="49.4614385" lon="11.1334689"/>
+ <node id="3655759017" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:44Z" user="marek kleciak" uid="338611" lat="49.4611936" lon="11.1319493"/>
+ <node id="3655759019" visible="true" version="1" changeset="32702242" timestamp="2015-07-17T17:06:44Z" user="marek kleciak" uid="338611" lat="49.4612046" lon="11.1320883"/>
+ <node id="3734882609" visible="true" version="1" changeset="33889783" timestamp="2015-09-08T18:18:19Z" user="geodreieck4711" uid="479256" lat="49.4657117" lon="11.1541090">
+  <tag k="emergency" v="fire_hydrant"/>
+  <tag k="fire_hydrant:diameter" v="100"/>
+  <tag k="fire_hydrant:position" v="sidewalk"/>
+  <tag k="fire_hydrant:type" v="pillar"/>
+ </node>
+ <node id="3734909044" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:29Z" user="geodreieck4711" uid="479256" lat="49.4659274" lon="11.1536564">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="1"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909046" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:29Z" user="geodreieck4711" uid="479256" lat="49.4662583" lon="11.1557102">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="10"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="3734909047" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:29Z" user="geodreieck4711" uid="479256" lat="49.4659656" lon="11.1521321">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="10"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Sendelbacher Weg"/>
+ </node>
+ <node id="3734909049" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:30Z" user="geodreieck4711" uid="479256" lat="49.4663195" lon="11.1531461">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="11"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909054" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:30Z" user="geodreieck4711" uid="479256" lat="49.4662428" lon="11.1521635">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="14"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Sendelbacher Weg"/>
+ </node>
+ <node id="3734909056" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:30Z" user="geodreieck4711" uid="479256" lat="49.4660637" lon="11.1544304">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="2"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="3734909057" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:30Z" user="geodreieck4711" uid="479256" lat="49.4660173" lon="11.1540792">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="2"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909058" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:30Z" user="geodreieck4711" uid="479256" lat="49.4654133" lon="11.1521636">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="2"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Sendelbacher Weg"/>
+ </node>
+ <node id="3734909061" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4665750" lon="11.1544116">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="3734909062" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4658889" lon="11.1533536">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909064" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4665231" lon="11.1540161">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="30"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzer Kirchensteig"/>
+ </node>
+ <node id="3734909065" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4661274" lon="11.1547691">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="4"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="3734909066" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4662771" lon="11.1540821">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="4"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909069" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4665652" lon="11.1547849">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="5"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="3734909070" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4658529" lon="11.1531514">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="5"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909073" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:31Z" user="geodreieck4711" uid="479256" lat="49.4661633" lon="11.1550650">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="6"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="3734909076" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4657809" lon="11.1528010">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="7"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909078" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4662166" lon="11.1554197">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="8"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Ellenbacher Weg"/>
+ </node>
+ <node id="3734909079" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4658180" lon="11.1521637">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="8"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Sendelbacher Weg"/>
+ </node>
+ <node id="3734909081" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4661306" lon="11.1528430">
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="9"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Pegnitzweg"/>
+ </node>
+ <node id="3734909085" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4653003" lon="11.1517403"/>
+ <node id="3734909086" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4653032" lon="11.1519378"/>
+ <node id="3734909087" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4653624" lon="11.1520078"/>
+ <node id="3734909088" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:32Z" user="geodreieck4711" uid="479256" lat="49.4653756" lon="11.1519354"/>
+ <node id="3734909089" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4653767" lon="11.1520084"/>
+ <node id="3734909090" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4654184" lon="11.1517363"/>
+ <node id="3734909091" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4654223" lon="11.1520068"/>
+ <node id="3734909092" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4654490" lon="11.1527218"/>
+ <node id="3734909093" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4654600" lon="11.1527177"/>
+ <node id="3734909094" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4654774" lon="11.1528988"/>
+ <node id="3734909095" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4654916" lon="11.1528934"/>
+ <node id="3734909097" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4655291" lon="11.1520098"/>
+ <node id="3734909104" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4657978" lon="11.1533685"/>
+ <node id="3734909105" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4658166" lon="11.1534762"/>
+ <node id="3734909106" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4658227" lon="11.1530362"/>
+ <node id="3734909107" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4658312" lon="11.1530850"/>
+ <node id="3734909108" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4658949" lon="11.1530064"/>
+ <node id="3734909109" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659021" lon="11.1540663"/>
+ <node id="3734909110" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659096" lon="11.1530906"/>
+ <node id="3734909111" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659136" lon="11.1541566"/>
+ <node id="3734909112" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659487" lon="11.1533046"/>
+ <node id="3734909113" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659678" lon="11.1534137"/>
+ <node id="3734909114" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659958" lon="11.1528774"/>
+ <node id="3734909115" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659901" lon="11.1541336"/>
+ <node id="3734909116" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4659991" lon="11.1542038"/>
+ <node id="3734909117" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660016" lon="11.1543731"/>
+ <node id="3734909118" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660197" lon="11.1527738"/>
+ <node id="3734909119" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660215" lon="11.1527831"/>
+ <node id="3734909120" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660360" lon="11.1528592"/>
+ <node id="3734909121" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660187" lon="11.1529973"/>
+ <node id="3734909122" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660296" lon="11.1545529"/>
+ <node id="3734909123" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660549" lon="11.1541092"/>
+ <node id="3734909124" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660644" lon="11.1541841"/>
+ <node id="3734909225" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660699" lon="11.1540158"/>
+ <node id="3734909226" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660808" lon="11.1541014"/>
+ <node id="3734909227" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4660998" lon="11.1543369"/>
+ <node id="3734909228" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661082" lon="11.1551751"/>
+ <node id="3734909229" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661198" lon="11.1552614"/>
+ <node id="3734909230" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661300" lon="11.1529470"/>
+ <node id="3734909231" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661383" lon="11.1529904"/>
+ <node id="3734909232" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661277" lon="11.1545167"/>
+ <node id="3734909233" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661585" lon="11.1551585"/>
+ <node id="3734909234" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661702" lon="11.1552454"/>
+ <node id="3734909235" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661893" lon="11.1520420"/>
+ <node id="3734909236" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661828" lon="11.1527001"/>
+ <node id="3734909237" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4662074" lon="11.1528288"/>
+ <node id="3734909238" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4661956" lon="11.1555822"/>
+ <node id="3734909239" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4662058" lon="11.1556635"/>
+ <node id="3734909240" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4662185" lon="11.1539401"/>
+ <node id="3734909241" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4662169" lon="11.1556956"/>
+ <node id="3734909242" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4662246" lon="11.1557681"/>
+ <node id="3734909243" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:33Z" user="geodreieck4711" uid="479256" lat="49.4662201" lon="11.1557939"/>
+ <node id="3734909244" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662287" lon="11.1557958"/>
+ <node id="3734909246" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662365" lon="11.1547347"/>
+ <node id="3734909247" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662521" lon="11.1555652"/>
+ <node id="3734909248" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662611" lon="11.1556534"/>
+ <node id="3734909249" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662365" lon="11.1558526"/>
+ <node id="3734909251" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662749" lon="11.1527983"/>
+ <node id="3734909252" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662854" lon="11.1539181"/>
+ <node id="3734909253" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662687" lon="11.1543019"/>
+ <node id="3734909254" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662902" lon="11.1557895"/>
+ <node id="3734909257" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662979" lon="11.1529183"/>
+ <node id="3734909258" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663029" lon="11.1539873"/>
+ <node id="3734909259" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663094" lon="11.1552213"/>
+ <node id="3734909260" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662918" lon="11.1556458"/>
+ <node id="3734909261" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663049" lon="11.1557845"/>
+ <node id="3734909262" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4662967" lon="11.1558406"/>
+ <node id="3734909264" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663264" lon="11.1539741"/>
+ <node id="3734909265" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663313" lon="11.1539879"/>
+ <node id="3734909266" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663325" lon="11.1542116"/>
+ <node id="3734909267" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663559" lon="11.1542027"/>
+ <node id="3734909268" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663548" lon="11.1541876"/>
+ <node id="3734909271" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663968" lon="11.1539545"/>
+ <node id="3734909272" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4663927" lon="11.1539647"/>
+ <node id="3734909273" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664275" lon="11.1539509"/>
+ <node id="3734909274" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664304" lon="11.1541635"/>
+ <node id="3734909275" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664338" lon="11.1539759"/>
+ <node id="3734909276" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664315" lon="11.1541746"/>
+ <node id="3734909277" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664680" lon="11.1539723"/>
+ <node id="3734909278" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664590" lon="11.1541430"/>
+ <node id="3734909279" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664643" lon="11.1541684"/>
+ <node id="3734909280" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664914" lon="11.1538504"/>
+ <node id="3734909281" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4665008" lon="11.1539181"/>
+ <node id="3734909282" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4664880" lon="11.1541140"/>
+ <node id="3734909283" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4665402" lon="11.1539051"/>
+ <node id="3734909284" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4665276" lon="11.1541408"/>
+ <node id="3734909285" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4665377" lon="11.1542135"/>
+ <node id="3734909286" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256" lat="49.4665710" lon="11.1541265"/>
+ <node id="3817182298" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4659204" lon="11.1556268"/>
+ <node id="3817182299" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4669859" lon="11.1578926"/>
+ <node id="3817182300" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4658075" lon="11.1556457"/>
+ <node id="3817182301" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4660390" lon="11.1562362"/>
+ <node id="3817182302" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4659572" lon="11.1563768"/>
+ <node id="3817182303" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4653999" lon="11.1533628"/>
+ <node id="3817182304" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4654551" lon="11.1531043"/>
+ <node id="3817182305" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4664477" lon="11.1573147"/>
+ <node id="3817182307" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4661998" lon="11.1566858"/>
+ <node id="3817182308" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4664138" lon="11.1573147"/>
+ <node id="3817182309" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4660042" lon="11.1560520"/>
+ <node id="3817182310" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:40Z" user="marek kleciak" uid="338611" lat="49.4662724" lon="11.1570773"/>
+ <node id="3817182311" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4654415" lon="11.1535625"/>
+ <node id="3817182312" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4655655" lon="11.1536099"/>
+ <node id="3817182313" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4678589" lon="11.1588614"/>
+ <node id="3817182314" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663362" lon="11.1558215"/>
+ <node id="3817182315" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4664177" lon="11.1570539"/>
+ <node id="3817182316" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663664" lon="11.1555026"/>
+ <node id="3817182317" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4650066" lon="11.1558723"/>
+ <node id="3817182318" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4659538" lon="11.1564876"/>
+ <node id="3817182320" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4657523" lon="11.1555504"/>
+ <node id="3817182321" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4661494" lon="11.1574204"/>
+ <node id="3817182322" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4660767" lon="11.1561360"/>
+ <node id="3817182324" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4659034" lon="11.1566083"/>
+ <node id="3817182325" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4661484" lon="11.1539470"/>
+ <node id="3817182326" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4662511" lon="11.1575710"/>
+ <node id="3817182327" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663799" lon="11.1559065"/>
+ <node id="3817182328" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4655777" lon="11.1543218"/>
+ <node id="3817182329" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4664961" lon="11.1571507"/>
+ <node id="3817182330" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4662582" lon="11.1571390">
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="3817182331" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4655278" lon="11.1537060"/>
+ <node id="3817182332" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663353" lon="11.1569347"/>
+ <node id="3817182333" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663576" lon="11.1571999"/>
+ <node id="3817182334" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4678041" lon="11.1587862"/>
+ <node id="3817182335" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4662210" lon="11.1576246"/>
+ <node id="3817182336" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4651683" lon="11.1519132"/>
+ <node id="3817182337" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4652188" lon="11.1524584"/>
+ <node id="3817182338" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4657585" lon="11.1555824"/>
+ <node id="3817182339" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663344" lon="11.1559282"/>
+ <node id="3817182340" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4659440" lon="11.1560395"/>
+ <node id="3817182341" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663063" lon="11.1559064"/>
+ <node id="3817182342" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4660494" lon="11.1561654"/>
+ <node id="3817182343" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4662666" lon="11.1572700"/>
+ <node id="3817182344" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4651422" lon="11.1558723"/>
+ <node id="3817182345" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4677401" lon="11.1587085"/>
+ <node id="3817182346" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663160" lon="11.1572446"/>
+ <node id="3817182347" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4657804" lon="11.1554908"/>
+ <node id="3817182348" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4655771" lon="11.1543001"/>
+ <node id="3817182349" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4662262" lon="11.1573086"/>
+ <node id="3817182350" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4665354" lon="11.1572892"/>
+ <node id="3817182351" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4654735" lon="11.1537249"/>
+ <node id="3817182352" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4648536" lon="11.1560466"/>
+ <node id="3817182353" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663925" lon="11.1557458"/>
+ <node id="3817182354" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4662927" lon="11.1571522"/>
+ <node id="3817182355" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4656153" lon="11.1545790"/>
+ <node id="3817182356" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4664996" lon="11.1573580"/>
+ <node id="3817182857" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4663944" lon="11.1558051"/>
+ <node id="3817182858" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4660080" lon="11.1566068"/>
+ <node id="3817182859" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4665649" lon="11.1572327"/>
+ <node id="3817182860" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4666239" lon="11.1575024"/>
+ <node id="3817182861" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4657573" lon="11.1555760"/>
+ <node id="3817182862" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4664593" lon="11.1571075"/>
+ <node id="3817182863" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4660611" lon="11.1566723"/>
+ <node id="3817182864" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4658947" lon="11.1565428"/>
+ <node id="3817182865" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:41Z" user="marek kleciak" uid="338611" lat="49.4662143" lon="11.1570271"/>
+ <node id="3817182867" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4659286" lon="11.1565264"/>
+ <node id="3817182868" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663799" lon="11.1556055"/>
+ <node id="3817182869" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4657631" lon="11.1556059"/>
+ <node id="3817182870" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4661842" lon="11.1571001"/>
+ <node id="3817182871" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663639" lon="11.1558218"/>
+ <node id="3817182872" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4655296" lon="11.1545285"/>
+ <node id="3817182873" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4660487" lon="11.1560794"/>
+ <node id="3817182874" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4661304" lon="11.1539529"/>
+ <node id="3817182875" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4654889" lon="11.1556577"/>
+ <node id="3817182876" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4662840" lon="11.1573981"/>
+ <node id="3817182877" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4649360" lon="11.1559795"/>
+ <node id="3817182878" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4652809" lon="11.1524211"/>
+ <node id="3817182879" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4660361" lon="11.1566322"/>
+ <node id="3817182880" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4655229" lon="11.1544899"/>
+ <node id="3817182881" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663458" lon="11.1557339"/>
+ <node id="3817182882" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4656283" lon="11.1542791"/>
+ <node id="3817182883" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4648382" lon="11.1560838"/>
+ <node id="3817182884" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4661252" lon="11.1569227"/>
+ <node id="3817182885" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4660429" lon="11.1561882"/>
+ <node id="3817182886" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4659972" lon="11.1560333"/>
+ <node id="3817182887" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4660114" lon="11.1560647"/>
+ <node id="3817182888" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4658313" lon="11.1554368"/>
+ <node id="3817182889" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4648698" lon="11.1539400"/>
+ <node id="3817182890" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4660201" lon="11.1560727"/>
+ <node id="3817182891" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4659606" lon="11.1564102"/>
+ <node id="3817182892" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4662404" lon="11.1570449"/>
+ <node id="3817182893" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4648352" lon="11.1561137"/>
+ <node id="3817182894" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4658820" lon="11.1554151"/>
+ <node id="3817182895" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4657804" lon="11.1556085"/>
+ <node id="3817182896" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4662250" lon="11.1571388"/>
+ <node id="3817182897" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4647529" lon="11.1561941"/>
+ <node id="3817182898" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4656790" lon="11.1542582"/>
+ <node id="3817182899" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4657342" lon="11.1545760"/>
+ <node id="3817182900" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4656844" lon="11.1545965"/>
+ <node id="3817182901" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663383" lon="11.1572297"/>
+ <node id="3817182902" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4662559" lon="11.1576097"/>
+ <node id="3817182903" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4676387" lon="11.1585934"/>
+ <node id="3817182904" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4672171" lon="11.1580015"/>
+ <node id="3817182906" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4670316" lon="11.1577974"/>
+ <node id="3817182907" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663055" lon="11.1571271"/>
+ <node id="3817182908" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663411" lon="11.1573415"/>
+ <node id="3817182909" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4662840" lon="11.1572744"/>
+ <node id="3817182910" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4662841" lon="11.1573151"/>
+ <node id="3817182911" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4655151" lon="11.1539380"/>
+ <node id="3817182912" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4662753" lon="11.1572208"/>
+ <node id="3817182913" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4648446" lon="11.1537965"/>
+ <node id="3817182914" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4651929" lon="11.1546555"/>
+ <node id="3817182915" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4664974" lon="11.1573668"/>
+ <node id="3817182916" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4664662" lon="11.1573297"/>
+ <node id="3817182917" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4655620" lon="11.1543999"/>
+ <node id="3817182918" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4646450" lon="11.1505509"/>
+ <node id="3817182919" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663005" lon="11.1572565"/>
+ <node id="3817182920" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4649447" lon="11.1547531"/>
+ <node id="3817182921" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4663886" lon="11.1558662"/>
+ <node id="3817182922" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4649301" lon="11.1546757"/>
+ <node id="3817182923" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4677868" lon="11.1586144"/>
+ <node id="3817182924" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4656323" lon="11.1546180"/>
+ <node id="3817182925" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4658884" lon="11.1560666"/>
+ <node id="3817182926" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4649527" lon="11.1536173"/>
+ <node id="3817182927" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4660134" lon="11.1563430"/>
+ <node id="3817182928" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:42Z" user="marek kleciak" uid="338611" lat="49.4661242" lon="11.1571478"/>
+ <node id="3817182929" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662482" lon="11.1567827"/>
+ <node id="3817182930" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4660395" lon="11.1560810"/>
+ <node id="3817182931" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4651046" lon="11.1558249"/>
+ <node id="3817182932" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659441" lon="11.1565085"/>
+ <node id="3817182933" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661071" lon="11.1539606"/>
+ <node id="3817182934" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659019" lon="11.1565887"/>
+ <node id="3817182935" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4650000" lon="11.1538857"/>
+ <node id="3817182936" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4651810" lon="11.1545803"/>
+ <node id="3817182937" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655751" lon="11.1543494"/>
+ <node id="3817182938" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663324" lon="11.1559840"/>
+ <node id="3817182939" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662404" lon="11.1570733"/>
+ <node id="3817182940" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655167" lon="11.1544538"/>
+ <node id="3817182941" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661930" lon="11.1576350"/>
+ <node id="3817182942" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663437" lon="11.1556790"/>
+ <node id="3817182943" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659373" lon="11.1565965"/>
+ <node id="3817182944" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655659" lon="11.1545304"/>
+ <node id="3817182945" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4678536" lon="11.1586955"/>
+ <node id="3817182946" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662404" lon="11.1570599"/>
+ <node id="3817182947" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4648740" lon="11.1560227"/>
+ <node id="3817182948" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663382" lon="11.1556164"/>
+ <node id="3817182949" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662871" lon="11.1559353"/>
+ <node id="3817182950" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4658687" lon="11.1556490"/>
+ <node id="3817182951" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662259" lon="11.1570271"/>
+ <node id="3817182952" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4648868" lon="11.1536447"/>
+ <node id="3817182953" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661011" lon="11.1564445"/>
+ <node id="3817182954" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661543" lon="11.1565815"/>
+ <node id="3817182955" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655075" lon="11.1533027"/>
+ <node id="3817182956" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4660622" lon="11.1560734"/>
+ <node id="3817183057" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659935" lon="11.1560153"/>
+ <node id="3817183058" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661330" lon="11.1572848"/>
+ <node id="3817183059" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655699" lon="11.1543769"/>
+ <node id="3817183060" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661252" lon="11.1568602"/>
+ <node id="3817183061" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4679101" lon="11.1587730"/>
+ <node id="3817183062" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4671725" lon="11.1580979"/>
+ <node id="3817183063" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661823" lon="11.1572714"/>
+ <node id="3817183064" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659353" lon="11.1562939"/>
+ <node id="3817183065" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4660599" lon="11.1563151"/>
+ <node id="3817183066" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662491" lon="11.1575397"/>
+ <node id="3817183067" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659596" lon="11.1564623"/>
+ <node id="3817183068" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4649459" lon="11.1559413"/>
+ <node id="3817183069" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663455" lon="11.1571821"/>
+ <node id="3817183070" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662534" lon="11.1550142"/>
+ <node id="3817183071" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4657678" lon="11.1555325"/>
+ <node id="3817183072" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659625" lon="11.1564385"/>
+ <node id="3817183073" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4659757" lon="11.1565961"/>
+ <node id="3817183074" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4660376" lon="11.1562121"/>
+ <node id="3817183075" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4668428" lon="11.1575754"/>
+ <node id="3817183076" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661862" lon="11.1572803"/>
+ <node id="3817183078" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662521" lon="11.1574875"/>
+ <node id="3817183079" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4667789" lon="11.1576648"/>
+ <node id="3817183080" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4677308" lon="11.1586225"/>
+ <node id="3817183081" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663809" lon="11.1570032"/>
+ <node id="3817183082" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662641" lon="11.1559549"/>
+ <node id="3817183083" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663276" lon="11.1558534"/>
+ <node id="3817183084" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655993" lon="11.1545565"/>
+ <node id="3817183085" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655507" lon="11.1535101"/>
+ <node id="3817183086" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4662375" lon="11.1570315"/>
+ <node id="3817183087" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663799" lon="11.1573221"/>
+ <node id="3817183088" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4663250" lon="11.1555161"/>
+ <node id="3817183089" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4661949" lon="11.1570599"/>
+ <node id="3817183090" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4655520" lon="11.1544203"/>
+ <node id="3817183091" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:43Z" user="marek kleciak" uid="338611" lat="49.4657940" lon="11.1556248"/>
+ <node id="3817183092" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4661833" lon="11.1575784"/>
+ <node id="3817183093" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4655360" lon="11.1544388"/>
+ <node id="3817183094" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4662947" lon="11.1550005"/>
+ <node id="3817183095" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4662046" lon="11.1570405"/>
+ <node id="3817183096" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4661968" lon="11.1572744"/>
+ <node id="3817183097" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663437" lon="11.1557786"/>
+ <node id="3817183098" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4658169" lon="11.1556712"/>
+ <node id="3817183099" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4661236" lon="11.1570096"/>
+ <node id="3817183100" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4660302" lon="11.1560784"/>
+ <node id="3817183101" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4662714" lon="11.1572819"/>
+ <node id="3817183102" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4662772" lon="11.1572803"/>
+ <node id="3817183103" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663721" lon="11.1559348"/>
+ <node id="3817183104" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4661102" lon="11.1567849"/>
+ <node id="3817183105" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4657765" lon="11.1555146"/>
+ <node id="3817183106" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4662937" lon="11.1568661"/>
+ <node id="3817183107" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4649088" lon="11.1537698"/>
+ <node id="3817183108" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663595" lon="11.1559571"/>
+ <node id="3817183109" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4647151" lon="11.1560570"/>
+ <node id="3817183110" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4660622" lon="11.1561464"/>
+ <node id="3817183111" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663184" lon="11.1558791"/>
+ <node id="3817183112" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4673834" lon="11.1583272"/>
+ <node id="3817183113" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4660762" lon="11.1563709"/>
+ <node id="3817183114" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4676831" lon="11.1584967"/>
+ <node id="3817183115" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4653495" lon="11.1531721"/>
+ <node id="3817183116" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4655485" lon="11.1545281"/>
+ <node id="3817183117" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4661823" lon="11.1571239"/>
+ <node id="3817183118" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4674271" lon="11.1582298"/>
+ <node id="3817183120" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4651974" lon="11.1557843"/>
+ <node id="3817183121" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4660703" lon="11.1561080"/>
+ <node id="3817183122" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663871" lon="11.1556727"/>
+ <node id="3817183123" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663101" lon="11.1573683"/>
+ <node id="3817183124" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4655834" lon="11.1545402"/>
+ <node id="3817183127" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663758" lon="11.1571046">
+  <tag k="highway" v="crossing"/>
+ </node>
+ <node id="3817183130" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4651616" lon="11.1524931"/>
+ <node id="3817183131" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663610" lon="11.1556473"/>
+ <node id="3817183132" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4662627" lon="11.1574428"/>
+ <node id="3817183133" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4663537" lon="11.1572208"/>
+ <node id="3817183134" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611" lat="49.4657785" lon="11.1554595"/>
+ <node id="3734909263" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4663025" lon="11.1559653"/>
+ <node id="3734909269" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4663503" lon="11.1555441"/>
+ <node id="3734909270" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:47Z" user="marek kleciak" uid="338611" lat="49.4663669" lon="11.1557410"/>
+ <node id="3817216568" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4634946" lon="11.1609528"/>
+ <node id="3817216569" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4631385" lon="11.1541229"/>
+ <node id="3817216570" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4635552" lon="11.1577808"/>
+ <node id="3817216571" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T14:04:40Z" user="marek kleciak" uid="338611" lat="49.4635891" lon="11.1582039"/>
+ <node id="4040571251" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4664794" lon="11.1591370"/>
+ <node id="4040571252" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4665510" lon="11.1595294"/>
+ <node id="4040571253" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4667021" lon="11.1587719"/>
+ <node id="4040571254" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4667130" lon="11.1587691"/>
+ <node id="4040571255" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4667201" lon="11.1589359"/>
+ <node id="4040571257" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4667309" lon="11.1589331"/>
+ <node id="4040571264" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4668270" lon="11.1588056"/>
+ <node id="4040571265" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4668315" lon="11.1588472"/>
+ <node id="4040571267" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4668334" lon="11.1588039"/>
+ <node id="4040571268" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849" lat="49.4668380" lon="11.1588456"/>
+ <node id="4067357875" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:13Z" user="pyram" uid="497849" lat="49.4655425" lon="11.1584277"/>
+ <node id="4067357876" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:13Z" user="pyram" uid="497849" lat="49.4655808" lon="11.1582648"/>
+ <node id="4067357877" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:13Z" user="pyram" uid="497849" lat="49.4655823" lon="11.1582715"/>
+ <node id="4067357878" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:13Z" user="pyram" uid="497849" lat="49.4655978" lon="11.1583445"/>
+ <node id="4067357880" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4657470" lon="11.1583161"/>
+ <node id="4067357882" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4657832" lon="11.1583581"/>
+ <node id="4067357883" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4658695" lon="11.1581644"/>
+ <node id="4067358890" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4659124" lon="11.1583386"/>
+ <node id="4067358894" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4659250" lon="11.1583733"/>
+ <node id="4067358915" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4660786" lon="11.1580031"/>
+ <node id="4067358922" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4661092" lon="11.1582301"/>
+ <node id="4067358923" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4661180" lon="11.1581761"/>
+ <node id="4067358924" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4661362" lon="11.1583992"/>
+ <node id="4067358925" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4661685" lon="11.1586317"/>
+ <node id="4067358928" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4661930" lon="11.1587683"/>
+ <node id="4067358932" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4662317" lon="11.1583566"/>
+ <node id="4067358934" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4662799" lon="11.1585845"/>
+ <node id="4067358936" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4662865" lon="11.1586213"/>
+ <node id="4067358940" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4662970" lon="11.1586800"/>
+ <node id="4067358941" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4663013" lon="11.1586150"/>
+ <node id="4067358942" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4663033" lon="11.1581400"/>
+ <node id="4067358943" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:14Z" user="pyram" uid="497849" lat="49.4663043" lon="11.1587210"/>
+ <node id="4067358945" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:15Z" user="pyram" uid="497849" lat="49.4663118" lon="11.1586737"/>
+ <node id="4070049270" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4608629" lon="11.1607699"/>
+ <node id="4070049271" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4608828" lon="11.1634079"/>
+ <node id="4070049274" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4610789" lon="11.1638507"/>
+ <node id="4070049275" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4611382" lon="11.1650910"/>
+ <node id="4070049276" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4611526" lon="11.1639277"/>
+ <node id="4070049277" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4611538" lon="11.1658708"/>
+ <node id="4070049389" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4614522" lon="11.1695123"/>
+ <node id="4070049394" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:41Z" user="pyram" uid="497849" lat="49.4614743" lon="11.1695017"/>
+ <node id="4070049424" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4618459" lon="11.1721389"/>
+ <node id="4070049436" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4622918" lon="11.1625156"/>
+ <node id="4070049437" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4623365" lon="11.1609056"/>
+ <node id="4070049438" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4623947" lon="11.1720077"/>
+ <node id="4070049443" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4626058" lon="11.1719630"/>
+ <node id="4070049447" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4629106" lon="11.1693506"/>
+ <node id="4070049450" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4630488" lon="11.1720585"/>
+ <node id="4070049451" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4631525" lon="11.1691961"/>
+ <node id="4070049452" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4632402" lon="11.1709390"/>
+ <node id="4070049453" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4632810" lon="11.1696151"/>
+ <node id="4070049454" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4633634" lon="11.1723513"/>
+ <node id="4070049455" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4634388" lon="11.1706618"/>
+ <node id="4070049456" visible="true" version="1" changeset="37959435" timestamp="2016-03-20T16:59:42Z" user="pyram" uid="497849" lat="49.4634499" lon="11.1717387"/>
+ <node id="4072413393" visible="true" version="1" changeset="37987008" timestamp="2016-03-21T21:30:08Z" user="pyram" uid="497849" lat="49.4634927" lon="11.1624752"/>
+ <node id="4072413394" visible="true" version="1" changeset="37987008" timestamp="2016-03-21T21:30:08Z" user="pyram" uid="497849" lat="49.4635144" lon="11.1629279"/>
+ <way id="15048945" visible="true" version="6" changeset="8021548" timestamp="2011-05-01T13:56:14Z" user="kellerma" uid="202858">
+  <nd ref="148436862"/>
+  <nd ref="148436879"/>
+  <nd ref="538254577"/>
+  <nd ref="171750600"/>
+  <nd ref="538254512"/>
+  <nd ref="1268926982"/>
+  <tag k="foot" v="designated"/>
+  <tag k="highway" v="path"/>
+  <tag k="name" v="Laufamholzer Kirchensteig"/>
+  <tag k="surface" v="paved"/>
+ </way>
+ <way id="15048943" visible="true" version="2" changeset="5816180" timestamp="2010-09-19T00:04:26Z" user="kellerma" uid="202858">
+  <nd ref="148436873"/>
+  <nd ref="148436862"/>
+  <tag k="highway" v="service"/>
+  <tag k="name" v="Laufamholzer Kirchensteig"/>
+ </way>
+ <way id="16628255" visible="true" version="2" changeset="5833160" timestamp="2010-09-20T21:29:27Z" user="kellerma" uid="202858">
+  <nd ref="171750538"/>
+  <nd ref="171750542"/>
+  <nd ref="171750535"/>
+  <tag k="highway" v="footway"/>
+ </way>
+ <way id="23236693" visible="true" version="5" changeset="17165139" timestamp="2013-07-31T11:54:14Z" user="geodreieck4711" uid="479256">
+  <nd ref="148426970"/>
+  <nd ref="521209586"/>
+  <nd ref="251402734"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Grünreuther Straße"/>
+ </way>
+ <way id="32029799" visible="true" version="14" changeset="35079420" timestamp="2015-11-04T13:55:51Z" user="marek kleciak" uid="338611">
+  <nd ref="96630335"/>
+  <nd ref="727734688"/>
+  <nd ref="914905302"/>
+  <nd ref="914907439"/>
+  <nd ref="40790390"/>
+  <nd ref="270970193"/>
+  <nd ref="249852392"/>
+  <nd ref="21643334"/>
+  <nd ref="847193248"/>
+  <nd ref="270971205"/>
+  <nd ref="249773996"/>
+  <nd ref="270971206"/>
+  <nd ref="270965681"/>
+  <nd ref="40790381"/>
+  <nd ref="2924643700"/>
+  <nd ref="270963171"/>
+  <nd ref="2188623015"/>
+  <nd ref="2215265114"/>
+  <nd ref="2188623013"/>
+  <nd ref="21643335"/>
+  <nd ref="3817183080"/>
+  <nd ref="270963172"/>
+  <nd ref="2188622904"/>
+  <nd ref="3167978659"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="2"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+ </way>
+ <way id="40926731" visible="true" version="2" changeset="2746545" timestamp="2009-10-05T08:26:59Z" user="staehler" uid="118856">
+  <nd ref="171750573"/>
+  <nd ref="521209586"/>
+  <tag k="highway" v="footway"/>
+ </way>
+ <way id="35922720" visible="true" version="1" changeset="1508963" timestamp="2009-06-13T22:26:59Z" user="Universalmapper" uid="133024">
+  <nd ref="148436873"/>
+  <nd ref="419915132"/>
+  <tag k="highway" v="path"/>
+  <tag k="name" v="Laufamholzer Kirchensteig"/>
+  <tag k="surface" v="gravel"/>
+  <tag k="width" v="0.6"/>
+ </way>
+ <way id="35922705" visible="true" version="4" changeset="14642788" timestamp="2013-01-13T23:47:39Z" user="pyram" uid="497849">
+  <nd ref="249773789"/>
+  <nd ref="419915039"/>
+  <nd ref="1808108244"/>
+  <nd ref="419915040"/>
+  <nd ref="419915042"/>
+  <nd ref="171750546"/>
+  <nd ref="171750549"/>
+  <nd ref="171750555"/>
+  <nd ref="339438796"/>
+  <nd ref="171750538"/>
+  <nd ref="2109912533"/>
+  <nd ref="419915033"/>
+  <nd ref="249773957"/>
+  <nd ref="249773958"/>
+  <nd ref="742479444"/>
+  <nd ref="742479422"/>
+  <nd ref="249773959"/>
+  <nd ref="249773960"/>
+  <nd ref="171750512"/>
+  <tag k="bicycle" v="yes"/>
+  <tag k="foot" v="yes"/>
+  <tag k="highway" v="path"/>
+  <tag k="name" v="Seeweiherweg"/>
+  <tag k="surface" v="gravel"/>
+ </way>
+ <way id="35922721" visible="true" version="2" changeset="15459854" timestamp="2013-03-22T22:07:32Z" user="geodreieck4711" uid="479256">
+  <nd ref="419915132"/>
+  <nd ref="419915133"/>
+  <nd ref="2215265113"/>
+  <nd ref="270973176"/>
+  <tag k="highway" v="path"/>
+  <tag k="name" v="Laufamholzer Kirchensteig"/>
+  <tag k="surface" v="ground"/>
+  <tag k="width" v="0.6"/>
+ </way>
+ <way id="40852983" visible="true" version="2" changeset="2746545" timestamp="2009-10-05T08:26:58Z" user="staehler" uid="118856">
+  <nd ref="521209591"/>
+  <nd ref="521209588"/>
+  <nd ref="497078299"/>
+  <nd ref="497078294"/>
+  <tag k="highway" v="footway"/>
+ </way>
+ <way id="40852984" visible="true" version="3" changeset="37928213" timestamp="2016-03-18T21:16:25Z" user="pyram" uid="497849">
+  <nd ref="4067357880"/>
+  <nd ref="4067357882"/>
+  <nd ref="497078299"/>
+  <tag k="highway" v="path"/>
+  <tag k="surface" v="paving_stones"/>
+ </way>
+ <way id="40852982" visible="true" version="3" changeset="14642788" timestamp="2013-01-13T23:47:40Z" user="pyram" uid="497849">
+  <nd ref="497078294"/>
+  <nd ref="419915035"/>
+  <tag k="highway" v="footway"/>
+ </way>
+ <way id="42975560" visible="true" version="2" changeset="5467876" timestamp="2010-08-11T22:58:12Z" user="kellerma" uid="202858">
+  <nd ref="148436854"/>
+  <nd ref="148436860"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Pegnitzweg"/>
+  <tag k="noexit" v="yes"/>
+ </way>
+ <way id="45739282" visible="true" version="4" changeset="26563807" timestamp="2014-11-05T05:17:14Z" user="theophrastos" uid="96069">
+  <nd ref="1564949379"/>
+  <nd ref="1564949378"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="4"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="ref" v="St 2241"/>
+ </way>
+ <way id="45739281" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T13:55:55Z" user="marek kleciak" uid="338611">
+  <nd ref="305537489"/>
+  <nd ref="1564949380"/>
+  <nd ref="3817183127"/>
+  <nd ref="1564949379"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="4"/>
+  <tag k="lanes:backward" v="2"/>
+  <tag k="lanes:forward" v="2"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="ref" v="St 2241"/>
+ </way>
+ <way id="75302568" visible="true" version="8" changeset="33890681" timestamp="2015-09-08T18:48:39Z" user="geodreieck4711" uid="479256">
+  <nd ref="889215107"/>
+  <nd ref="889215177"/>
+  <nd ref="889214932"/>
+  <nd ref="3734909095"/>
+  <nd ref="3734909094"/>
+  <nd ref="3734909092"/>
+  <nd ref="3734909093"/>
+  <nd ref="889215442"/>
+  <nd ref="889215107"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="171"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="75302565" visible="true" version="6" changeset="33890681" timestamp="2015-09-08T18:48:39Z" user="geodreieck4711" uid="479256">
+  <nd ref="889214989"/>
+  <nd ref="889215014"/>
+  <nd ref="889214708"/>
+  <nd ref="3734909087"/>
+  <nd ref="3734909089"/>
+  <nd ref="3734909091"/>
+  <nd ref="889214989"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="75302563" visible="true" version="5" changeset="5639425" timestamp="2010-08-30T19:25:49Z" user="kellerma" uid="202858">
+  <nd ref="889215123"/>
+  <nd ref="889215019"/>
+  <nd ref="889214731"/>
+  <nd ref="889215362"/>
+  <nd ref="889215472"/>
+  <nd ref="889215216"/>
+  <nd ref="889215011"/>
+  <nd ref="889214823"/>
+  <nd ref="889215324"/>
+  <nd ref="889215096"/>
+  <tag k="highway" v="service"/>
+ </way>
+ <way id="75302576" visible="true" version="11" changeset="25181325" timestamp="2014-09-02T13:16:43Z" user="jacobbraeutigam" uid="1260280">
+  <nd ref="889215034"/>
+  <nd ref="889215060"/>
+  <nd ref="889214749"/>
+  <nd ref="889215315"/>
+  <nd ref="889215034"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="146"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzstraße"/>
+  <tag k="amenity" v="fuel"/>
+  <tag k="brand" v="Total"/>
+  <tag k="building" v="yes"/>
+  <tag k="fax" v="+49 911 504686"/>
+  <tag k="fuel:diesel" v="yes"/>
+  <tag k="fuel:e10" v="yes"/>
+  <tag k="fuel:octane_91" v="yes"/>
+  <tag k="fuel:octane_95" v="yes"/>
+  <tag k="fuel:octane_98" v="no"/>
+  <tag k="phone" v="+49 911 501968"/>
+  <tag k="source" v="yahoo_wms"/>
+ </way>
+ <way id="77392241" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:38Z" user="geodreieck4711" uid="479256">
+  <nd ref="910988904"/>
+  <nd ref="910988680"/>
+  <nd ref="910991047"/>
+  <nd ref="3734909235"/>
+  <nd ref="910988904"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77392149" visible="true" version="3" changeset="33890681" timestamp="2015-09-08T18:48:38Z" user="geodreieck4711" uid="479256">
+  <nd ref="910991129"/>
+  <nd ref="910988724"/>
+  <nd ref="3734909097"/>
+  <nd ref="910991184"/>
+  <nd ref="910991129"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77392451" visible="true" version="5" changeset="25181325" timestamp="2014-09-02T13:43:06Z" user="jacobbraeutigam" uid="1260280">
+  <nd ref="910990236"/>
+  <nd ref="910990250"/>
+  <nd ref="910989805"/>
+  <nd ref="910989301"/>
+  <nd ref="910990236"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="28"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Laufamholzer Kirchensteig"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110355" visible="true" version="6" changeset="12015383" timestamp="2012-06-25T19:29:51Z" user="derstefan" uid="114324">
+  <nd ref="917756550"/>
+  <nd ref="889215472"/>
+  <nd ref="917756595"/>
+  <nd ref="917756761"/>
+  <nd ref="917756656"/>
+  <nd ref="889215011"/>
+  <nd ref="917756550"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="building" v="roof"/>
+  <tag k="layer" v="1"/>
+ </way>
+ <way id="143021335" visible="true" version="2" changeset="10224049" timestamp="2011-12-28T10:22:30Z" user="kellerma" uid="202858">
+  <nd ref="734779065"/>
+  <nd ref="1564949354"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Moritzbergstraße"/>
+  <tag k="oneway" v="yes"/>
+ </way>
+ <way id="143021336" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:54Z" user="marek kleciak" uid="338611">
+  <nd ref="1564949354"/>
+  <nd ref="3817182349"/>
+  <nd ref="1564949361"/>
+  <nd ref="3817182330"/>
+  <nd ref="3817182310"/>
+  <nd ref="1564949379"/>
+  <tag k="highway" v="residential"/>
+  <tag k="lanes" v="2"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Moritzbergstraße"/>
+  <tag k="oneway" v="yes"/>
+ </way>
+ <way id="143021337" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:54Z" user="marek kleciak" uid="338611">
+  <nd ref="1564949354"/>
+  <nd ref="3817182910"/>
+  <nd ref="1564890415"/>
+  <nd ref="270963246"/>
+  <nd ref="305537489"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Moritzbergstraße"/>
+  <tag k="oneway" v="yes"/>
+ </way>
+ <way id="143054447" visible="true" version="1" changeset="10227001" timestamp="2011-12-28T15:30:13Z" user="kellerma" uid="202858">
+  <nd ref="1565389266"/>
+  <nd ref="1564890413"/>
+  <nd ref="734779065"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Moritzbergstraße"/>
+  <tag k="oneway" v="yes"/>
+ </way>
+ <way id="143021333" visible="true" version="2" changeset="10227001" timestamp="2011-12-28T15:30:48Z" user="kellerma" uid="202858">
+  <nd ref="1564949378"/>
+  <nd ref="1564949359"/>
+  <nd ref="1564949352"/>
+  <nd ref="1564890412"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="oneway" v="yes"/>
+ </way>
+ <way id="143016727" visible="true" version="4" changeset="10227001" timestamp="2011-12-28T15:30:49Z" user="kellerma" uid="202858">
+  <nd ref="270971629"/>
+  <nd ref="1564890408"/>
+  <nd ref="1564890412"/>
+  <nd ref="1564890409"/>
+  <nd ref="1565389266"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Moritzbergstraße"/>
+  <tag k="oneway" v="yes"/>
+ </way>
+ <way id="143021334" visible="true" version="6" changeset="37928213" timestamp="2016-03-18T21:16:24Z" user="pyram" uid="497849">
+  <nd ref="734779065"/>
+  <nd ref="3817182335"/>
+  <nd ref="1565389238"/>
+  <nd ref="148426970"/>
+  <nd ref="4067358942"/>
+  <nd ref="734788926"/>
+  <nd ref="521209591"/>
+  <nd ref="4040571251"/>
+  <nd ref="4040571252"/>
+  <nd ref="148426975"/>
+  <nd ref="336271422"/>
+  <nd ref="419915020"/>
+  <nd ref="148426952"/>
+  <nd ref="148426963"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Moritzbergstraße"/>
+ </way>
+ <way id="143379638" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:53Z" user="marek kleciak" uid="338611">
+  <nd ref="1569002927"/>
+  <nd ref="1569002923"/>
+  <nd ref="1569002929"/>
+  <nd ref="1808108239"/>
+  <nd ref="1808108238"/>
+  <nd ref="1569002925"/>
+  <nd ref="3817182918"/>
+  <nd ref="1808108275"/>
+  <nd ref="1808108283"/>
+  <nd ref="1569002933"/>
+  <nd ref="1569002927"/>
+  <tag k="landuse" v="retail"/>
+ </way>
+ <way id="144161528" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:51Z" user="marek kleciak" uid="338611">
+  <nd ref="336271420"/>
+  <nd ref="3817182861"/>
+  <nd ref="419915043"/>
+  <nd ref="3817183068"/>
+  <nd ref="1808108278"/>
+  <nd ref="336271421"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Plecher Straße"/>
+  <tag k="surface" v="paved"/>
+ </way>
+ <way id="144655106" visible="true" version="1" changeset="10326908" timestamp="2012-01-07T23:18:48Z" user="Taroc" uid="71557">
+  <nd ref="148436862"/>
+  <nd ref="148436854"/>
+  <nd ref="1581758710"/>
+  <nd ref="1368601583"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Pegnitzweg"/>
+  <tag k="surface" v="paved"/>
+ </way>
+ <way id="144655091" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:52Z" user="marek kleciak" uid="338611">
+  <nd ref="148436843"/>
+  <nd ref="1581758713"/>
+  <nd ref="3817183121"/>
+  <nd ref="3734909263"/>
+  <nd ref="3817182339"/>
+  <nd ref="148436849"/>
+  <nd ref="3817182871"/>
+  <nd ref="3734909270"/>
+  <nd ref="3817183131"/>
+  <nd ref="3734909269"/>
+  <nd ref="3734909259"/>
+  <nd ref="3734909246"/>
+  <nd ref="3817182874"/>
+  <nd ref="148436854"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Ellenbacher Weg"/>
+ </way>
+ <way id="144655099" visible="true" version="6" changeset="37987008" timestamp="2016-03-21T21:30:12Z" user="pyram" uid="497849">
+  <nd ref="1581758695"/>
+  <nd ref="857291223"/>
+  <nd ref="419915100"/>
+  <nd ref="419878598"/>
+  <nd ref="419915084"/>
+  <nd ref="1724594226"/>
+  <nd ref="1808108066"/>
+  <nd ref="1116216228"/>
+  <nd ref="224088857"/>
+  <nd ref="1808107912"/>
+  <nd ref="1808107848"/>
+  <nd ref="1802925467"/>
+  <nd ref="224088860"/>
+  <nd ref="224088868"/>
+  <nd ref="3817216569"/>
+  <nd ref="375768277"/>
+  <nd ref="224088874"/>
+  <nd ref="339438788"/>
+  <nd ref="339438794"/>
+  <nd ref="339438795"/>
+  <nd ref="1116216224"/>
+  <nd ref="224088877"/>
+  <nd ref="1808107781"/>
+  <nd ref="1808107798"/>
+  <nd ref="249773783"/>
+  <nd ref="3817216570"/>
+  <nd ref="339438785"/>
+  <nd ref="224088888"/>
+  <nd ref="3817216571"/>
+  <nd ref="249773807"/>
+  <nd ref="521209565"/>
+  <nd ref="521209581"/>
+  <nd ref="521209579"/>
+  <nd ref="249851124"/>
+  <nd ref="3817216568"/>
+  <nd ref="224088895"/>
+  <nd ref="339438798"/>
+  <nd ref="4072413393"/>
+  <nd ref="4072413394"/>
+  <nd ref="521209584"/>
+  <nd ref="224088906"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Happurger Straße"/>
+  <tag k="traffic_sign" v="DE:274.1[30]"/>
+  <tag k="zone:maxspeed" v="DE:30"/>
+ </way>
+ <way id="109071455" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:28Z" user="klabauter05" uid="157416">
+  <nd ref="1249743429"/>
+  <nd ref="1249743565"/>
+  <nd ref="1249743332"/>
+  <nd ref="1249743115"/>
+  <nd ref="1249743429"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="109071487" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:33Z" user="klabauter05" uid="157416">
+  <nd ref="1249743321"/>
+  <nd ref="1249743299"/>
+  <nd ref="1249743500"/>
+  <nd ref="1249743369"/>
+  <nd ref="1249743321"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="109071537" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:40Z" user="klabauter05" uid="157416">
+  <nd ref="1249743565"/>
+  <nd ref="1249743230"/>
+  <nd ref="1249743234"/>
+  <nd ref="1249743332"/>
+  <nd ref="1249743565"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="109071536" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:17Z" user="geodreieck4711" uid="479256">
+  <nd ref="1249743052"/>
+  <nd ref="1249743535"/>
+  <nd ref="1249743468"/>
+  <nd ref="1249743054"/>
+  <nd ref="1249743052"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="109071478" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:18Z" user="geodreieck4711" uid="479256">
+  <nd ref="1249743426"/>
+  <nd ref="1249743394"/>
+  <nd ref="1249743527"/>
+  <nd ref="1249743167"/>
+  <nd ref="1249743426"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="109071508" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:18Z" user="geodreieck4711" uid="479256">
+  <nd ref="1249743246"/>
+  <nd ref="1249743135"/>
+  <nd ref="1249743342"/>
+  <nd ref="2188622788"/>
+  <nd ref="1249743246"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="109071551" visible="true" version="1" changeset="7895391" timestamp="2011-04-18T10:08:42Z" user="klabauter05" uid="157416">
+  <nd ref="1249743299"/>
+  <nd ref="1249743429"/>
+  <nd ref="1249743115"/>
+  <nd ref="1249743500"/>
+  <nd ref="1249743299"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77392190" visible="true" version="4" changeset="8971377" timestamp="2011-08-09T20:50:23Z" user="kellerma" uid="202858">
+  <nd ref="910990888"/>
+  <nd ref="910989287"/>
+  <nd ref="910988941"/>
+  <nd ref="910988546"/>
+  <nd ref="910990888"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815671" visible="true" version="4" changeset="15272386" timestamp="2013-03-06T16:11:19Z" user="geodreieck4711" uid="479256">
+  <nd ref="914906758"/>
+  <nd ref="914905463"/>
+  <nd ref="914907178"/>
+  <nd ref="2188622749"/>
+  <nd ref="914906409"/>
+  <nd ref="914906758"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815822" visible="true" version="4" changeset="15272386" timestamp="2013-03-06T16:11:19Z" user="geodreieck4711" uid="479256">
+  <nd ref="914905744"/>
+  <nd ref="914905597"/>
+  <nd ref="2188622776"/>
+  <nd ref="914907416"/>
+  <nd ref="914906620"/>
+  <nd ref="914905744"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815658" visible="true" version="4" changeset="15272386" timestamp="2013-03-06T16:11:17Z" user="geodreieck4711" uid="479256">
+  <nd ref="914905260"/>
+  <nd ref="914906799"/>
+  <nd ref="914905189"/>
+  <nd ref="914905732"/>
+  <nd ref="914905260"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815695" visible="true" version="4" changeset="15272386" timestamp="2013-03-06T16:11:19Z" user="geodreieck4711" uid="479256">
+  <nd ref="914907511"/>
+  <nd ref="2188622745"/>
+  <nd ref="914905644"/>
+  <nd ref="914905402"/>
+  <nd ref="914906038"/>
+  <nd ref="2188622748"/>
+  <nd ref="914907511"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77392427" visible="true" version="5" changeset="33890681" timestamp="2015-09-08T18:48:38Z" user="geodreieck4711" uid="479256">
+  <nd ref="910991211"/>
+  <nd ref="910989584"/>
+  <nd ref="910989087"/>
+  <nd ref="910988767"/>
+  <nd ref="910991211"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77392429" visible="true" version="5" changeset="17165139" timestamp="2013-07-31T11:54:11Z" user="geodreieck4711" uid="479256">
+  <nd ref="910989082"/>
+  <nd ref="910990468"/>
+  <nd ref="910989952"/>
+  <nd ref="910989550"/>
+  <nd ref="910989082"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77392253" visible="true" version="5" changeset="33890681" timestamp="2015-09-08T18:48:37Z" user="geodreieck4711" uid="479256">
+  <nd ref="910989710"/>
+  <nd ref="910989985"/>
+  <nd ref="910990623"/>
+  <nd ref="910990121"/>
+  <nd ref="910989710"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110239" visible="true" version="4" changeset="33890681" timestamp="2015-09-08T18:48:38Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756766"/>
+  <nd ref="917756599"/>
+  <nd ref="917756706"/>
+  <nd ref="917756809"/>
+  <nd ref="917756766"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815674" visible="true" version="5" changeset="35079420" timestamp="2015-11-04T13:55:55Z" user="marek kleciak" uid="338611">
+  <nd ref="914907266"/>
+  <nd ref="914905803"/>
+  <nd ref="914906244"/>
+  <nd ref="914905508"/>
+  <nd ref="914907266"/>
+  <tag k="building" v="yes"/>
+  <tag k="roof:colour" v="brown"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="77815943" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:22Z" user="pyram" uid="497849">
+  <nd ref="4067357883"/>
+  <nd ref="914905877"/>
+  <nd ref="914905570"/>
+  <nd ref="2402376002"/>
+  <nd ref="4067358890"/>
+  <nd ref="4067357883"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="1.5"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="77815899" visible="true" version="4" changeset="11495913" timestamp="2012-05-04T09:06:55Z" user="Jörg Roth" uid="24047">
+  <nd ref="914906674"/>
+  <nd ref="914907509"/>
+  <nd ref="914905642"/>
+  <nd ref="914906487"/>
+  <nd ref="914906674"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Grünreuther Straße"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815887" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:11Z" user="geodreieck4711" uid="479256">
+  <nd ref="914907096"/>
+  <nd ref="914905401"/>
+  <nd ref="914907012"/>
+  <nd ref="914905330"/>
+  <nd ref="914907096"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77392198" visible="true" version="5" changeset="33890681" timestamp="2015-09-08T18:48:37Z" user="geodreieck4711" uid="479256">
+  <nd ref="910988928"/>
+  <nd ref="910990201"/>
+  <nd ref="3734909112"/>
+  <nd ref="3734909113"/>
+  <nd ref="3734909105"/>
+  <nd ref="3734909104"/>
+  <nd ref="910989787"/>
+  <nd ref="910989248"/>
+  <nd ref="3734909107"/>
+  <nd ref="3734909106"/>
+  <nd ref="3734909108"/>
+  <nd ref="3734909110"/>
+  <nd ref="910988928"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815637" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:22Z" user="pyram" uid="497849">
+  <nd ref="4067358924"/>
+  <nd ref="914905364"/>
+  <nd ref="914907066"/>
+  <nd ref="2402375637"/>
+  <nd ref="4067358932"/>
+  <nd ref="4067358924"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="2"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="77815547" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:10Z" user="geodreieck4711" uid="479256">
+  <nd ref="914906899"/>
+  <nd ref="914905249"/>
+  <nd ref="914905800"/>
+  <nd ref="914905539"/>
+  <nd ref="914906899"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110372" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:11Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756805"/>
+  <nd ref="917756638"/>
+  <nd ref="917756745"/>
+  <nd ref="917756581"/>
+  <nd ref="917756805"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="122704363" visible="true" version="5" changeset="33890681" timestamp="2015-09-08T18:48:36Z" user="geodreieck4711" uid="479256">
+  <nd ref="250942532"/>
+  <nd ref="265760608"/>
+  <nd ref="1225946505"/>
+  <nd ref="1225946508"/>
+  <nd ref="265760609"/>
+  <nd ref="1225946510"/>
+  <nd ref="265760610"/>
+  <nd ref="148479657"/>
+  <nd ref="1370391770"/>
+  <nd ref="1370391759"/>
+  <nd ref="1370391755"/>
+  <nd ref="1370391753"/>
+  <nd ref="1370391752"/>
+  <nd ref="1370391751"/>
+  <nd ref="1370391749"/>
+  <nd ref="1370391779"/>
+  <nd ref="1370391782"/>
+  <nd ref="87027665"/>
+  <nd ref="1370391777"/>
+  <nd ref="1370391772"/>
+  <nd ref="1370391694"/>
+  <nd ref="3609297501"/>
+  <nd ref="1769374949"/>
+  <nd ref="171750610"/>
+  <nd ref="411043154"/>
+  <nd ref="265760614"/>
+  <nd ref="1693942417"/>
+  <nd ref="411043155"/>
+  <nd ref="1693942549"/>
+  <nd ref="1525143738"/>
+  <nd ref="1525143740"/>
+  <nd ref="1693942641"/>
+  <nd ref="265760615"/>
+  <nd ref="250942534"/>
+  <nd ref="250942535"/>
+  <nd ref="253128160"/>
+  <nd ref="3059040763"/>
+  <nd ref="306532163"/>
+  <nd ref="306532162"/>
+  <nd ref="253128161"/>
+  <nd ref="306532161"/>
+  <nd ref="250942529"/>
+  <nd ref="1699296527"/>
+  <nd ref="250942530"/>
+  <nd ref="250942531"/>
+  <nd ref="1699296507"/>
+  <nd ref="1699296506"/>
+  <nd ref="250942532"/>
+ </way>
+ <way id="78110231" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:10Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756786"/>
+  <nd ref="917756619"/>
+  <nd ref="917756727"/>
+  <nd ref="917756782"/>
+  <nd ref="917756786"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110240" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:11Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756722"/>
+  <nd ref="917756555"/>
+  <nd ref="917756660"/>
+  <nd ref="917756765"/>
+  <nd ref="917756722"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110235" visible="true" version="4" changeset="15272386" timestamp="2013-03-06T16:11:17Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756569"/>
+  <nd ref="917756566"/>
+  <nd ref="917756670"/>
+  <nd ref="917756775"/>
+  <nd ref="917756569"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110271" visible="true" version="3" changeset="8971377" timestamp="2011-08-09T20:50:48Z" user="kellerma" uid="202858">
+  <nd ref="917756694"/>
+  <nd ref="917756738"/>
+  <nd ref="917756630"/>
+  <nd ref="917756798"/>
+  <nd ref="917756694"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110296" visible="true" version="3" changeset="8971377" timestamp="2011-08-09T20:50:50Z" user="kellerma" uid="202858">
+  <nd ref="917756744"/>
+  <nd ref="917756580"/>
+  <nd ref="917756683"/>
+  <nd ref="917756681"/>
+  <nd ref="917756744"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110312" visible="true" version="3" changeset="8971377" timestamp="2011-08-09T20:50:51Z" user="kellerma" uid="202858">
+  <nd ref="917756616"/>
+  <nd ref="917756663"/>
+  <nd ref="917756560"/>
+  <nd ref="917756726"/>
+  <nd ref="917756616"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110282" visible="true" version="4" changeset="33890681" timestamp="2015-09-08T18:48:39Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756652"/>
+  <nd ref="917756759"/>
+  <nd ref="917756591"/>
+  <nd ref="917756698"/>
+  <nd ref="917756652"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110272" visible="true" version="4" changeset="33890681" timestamp="2015-09-08T18:48:39Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756679"/>
+  <nd ref="917756784"/>
+  <nd ref="3734909233"/>
+  <nd ref="3734909234"/>
+  <nd ref="3734909229"/>
+  <nd ref="3734909228"/>
+  <nd ref="917756607"/>
+  <nd ref="917756715"/>
+  <nd ref="917756679"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110269" visible="true" version="4" changeset="15272386" timestamp="2013-03-06T16:11:18Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756697"/>
+  <nd ref="917756801"/>
+  <nd ref="917756633"/>
+  <nd ref="917756741"/>
+  <nd ref="917756697"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110344" visible="true" version="4" changeset="33890681" timestamp="2015-09-08T18:48:38Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756731"/>
+  <nd ref="917756776"/>
+  <nd ref="917756671"/>
+  <nd ref="917756567"/>
+  <nd ref="917756731"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110374" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:10Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756800"/>
+  <nd ref="917756575"/>
+  <nd ref="917756740"/>
+  <nd ref="917756632"/>
+  <nd ref="917756800"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110363" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:12Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756592"/>
+  <nd ref="917756699"/>
+  <nd ref="917756802"/>
+  <nd ref="917756635"/>
+  <nd ref="917756592"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110380" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:12Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756795"/>
+  <nd ref="917756572"/>
+  <nd ref="917756735"/>
+  <nd ref="917756627"/>
+  <nd ref="917756795"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110369" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:13Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756813"/>
+  <nd ref="917756586"/>
+  <nd ref="917756751"/>
+  <nd ref="917756645"/>
+  <nd ref="917756813"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110358" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:13Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756601"/>
+  <nd ref="917756644"/>
+  <nd ref="917756812"/>
+  <nd ref="917756709"/>
+  <nd ref="917756601"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="129475860" visible="true" version="1" changeset="9258457" timestamp="2011-09-09T22:24:58Z" user="pyram" uid="497849">
+  <nd ref="1428414881"/>
+  <nd ref="1428414870"/>
+  <nd ref="1428414873"/>
+  <nd ref="1428414880"/>
+  <nd ref="1428414871"/>
+  <nd ref="1428414894"/>
+  <nd ref="1428414883"/>
+  <nd ref="1428414892"/>
+  <nd ref="1428414893"/>
+  <nd ref="1428414895"/>
+  <nd ref="1428414896"/>
+  <nd ref="1428414905"/>
+  <nd ref="1428414897"/>
+  <nd ref="1428414906"/>
+  <nd ref="1428414881"/>
+  <tag k="landuse" v="meadow"/>
+ </way>
+ <way id="133603504" visible="true" version="1" changeset="9579176" timestamp="2011-10-17T07:21:56Z" user="geodreieck4711" uid="479256">
+  <nd ref="1470605776"/>
+  <nd ref="1470605780"/>
+  <nd ref="1470605772"/>
+  <nd ref="1470605767"/>
+  <nd ref="1470605776"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="133603485" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:37Z" user="geodreieck4711" uid="479256">
+  <nd ref="1470605788"/>
+  <nd ref="1470605789"/>
+  <nd ref="1470605779"/>
+  <nd ref="1470605777"/>
+  <nd ref="1470605788"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="133603517" visible="true" version="2" changeset="15272386" timestamp="2013-03-06T16:11:19Z" user="geodreieck4711" uid="479256">
+  <nd ref="1470605764"/>
+  <nd ref="1470605765"/>
+  <nd ref="1470605763"/>
+  <nd ref="1470605761"/>
+  <nd ref="1470605764"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="45715476" visible="true" version="25" changeset="35079420" timestamp="2015-11-04T13:55:49Z" user="marek kleciak" uid="338611">
+  <nd ref="270971629"/>
+  <nd ref="171750562"/>
+  <nd ref="3817182927"/>
+  <nd ref="148436843"/>
+  <nd ref="3817182340"/>
+  <nd ref="3817182950"/>
+  <nd ref="336271420"/>
+  <nd ref="3817182888"/>
+  <nd ref="270965358"/>
+  <nd ref="3817182900"/>
+  <nd ref="249773878"/>
+  <nd ref="3817182882"/>
+  <nd ref="1368601583"/>
+  <nd ref="3817182331"/>
+  <nd ref="270971892"/>
+  <nd ref="889215123"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="4"/>
+  <tag k="lanes:backward" v="2"/>
+  <tag k="lanes:forward" v="2"/>
+  <tag k="lit" v="yes"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="ref" v="St 2241"/>
+  <tag k="source" v="yahoo; extrapolation"/>
+  <tag k="surface" v="asphalt"/>
+ </way>
+ <way id="160414788" visible="true" version="3" changeset="26060088" timestamp="2014-10-13T21:27:07Z" user="pyram" uid="497849">
+  <nd ref="3128477490"/>
+  <nd ref="1724605550"/>
+  <nd ref="1724605551"/>
+  <nd ref="1794190549"/>
+  <nd ref="3128477497"/>
+  <nd ref="3128477499"/>
+  <nd ref="3128477515"/>
+  <nd ref="3128482133"/>
+  <nd ref="3128482130"/>
+  <nd ref="3128482129"/>
+  <nd ref="3128477506"/>
+  <nd ref="3128477490"/>
+  <tag k="landuse" v="grass"/>
+  <tag k="source" v="Bing"/>
+ </way>
+ <way id="160413616" visible="true" version="3" changeset="11946232" timestamp="2012-06-19T09:46:49Z" user="kukuk" uid="346758">
+  <nd ref="1724594233"/>
+  <nd ref="1724605551"/>
+  <nd ref="1724594228"/>
+  <nd ref="1794190549"/>
+  <nd ref="1724594224"/>
+  <nd ref="1724594218"/>
+  <nd ref="1724594213"/>
+  <tag k="highway" v="footway"/>
+  <tag k="source" v="Bing;survey"/>
+  <tag k="surface" v="paving_stones"/>
+ </way>
+ <way id="163793702" visible="true" version="5" changeset="35079420" timestamp="2015-11-04T13:55:53Z" user="marek kleciak" uid="338611">
+  <nd ref="1581758692"/>
+  <nd ref="1754709769"/>
+  <nd ref="270973164"/>
+  <nd ref="270973166"/>
+  <nd ref="270973167"/>
+  <nd ref="1581758710"/>
+  <nd ref="270973169"/>
+  <nd ref="270973170"/>
+  <nd ref="3817183100"/>
+  <nd ref="1581758713"/>
+  <tag k="bicycle" v="designated"/>
+  <tag k="cycle_direction" v="both"/>
+  <tag k="foot" v="designated"/>
+  <tag k="highway" v="path"/>
+  <tag k="segregated" v="no"/>
+ </way>
+ <way id="42425192" visible="true" version="10" changeset="42404513" timestamp="2016-09-24T12:44:12Z" user="pyram" uid="497849">
+  <nd ref="529678561"/>
+  <nd ref="1522932706"/>
+  <nd ref="529678562"/>
+  <nd ref="1522932713"/>
+  <nd ref="529678579"/>
+  <nd ref="529678580"/>
+  <nd ref="1522932717"/>
+  <nd ref="529678581"/>
+  <nd ref="529678563"/>
+  <nd ref="529678564"/>
+  <nd ref="304292370"/>
+  <nd ref="529678565"/>
+  <nd ref="529678588"/>
+  <nd ref="529678607"/>
+  <nd ref="529678609"/>
+  <nd ref="529678611"/>
+  <nd ref="529678613"/>
+  <nd ref="529678647"/>
+  <nd ref="529678649"/>
+  <nd ref="529678651"/>
+  <nd ref="529678653"/>
+  <nd ref="529678654"/>
+  <nd ref="529678655"/>
+  <nd ref="529678671"/>
+  <nd ref="529678672"/>
+  <nd ref="529678673"/>
+  <nd ref="529678674"/>
+  <nd ref="529678675"/>
+  <nd ref="529678676"/>
+  <nd ref="529678677"/>
+  <nd ref="529678678"/>
+  <nd ref="529678679"/>
+  <nd ref="529678681"/>
+  <nd ref="529678680"/>
+  <nd ref="529678670"/>
+  <nd ref="529678668"/>
+  <nd ref="529678669"/>
+  <nd ref="529678666"/>
+  <nd ref="1764304685"/>
+  <nd ref="529678667"/>
+  <nd ref="529683743"/>
+  <nd ref="529683740"/>
+  <nd ref="529683737"/>
+  <nd ref="529683739"/>
+  <nd ref="529683738"/>
+  <nd ref="529683742"/>
+  <nd ref="529683744"/>
+  <nd ref="529683741"/>
+  <nd ref="529678662"/>
+  <nd ref="529678664"/>
+  <nd ref="529678665"/>
+  <nd ref="529678663"/>
+  <nd ref="529678661"/>
+  <nd ref="529678660"/>
+  <nd ref="529678658"/>
+  <nd ref="529678659"/>
+  <nd ref="529678656"/>
+  <nd ref="529678657"/>
+  <nd ref="529678645"/>
+  <nd ref="529678642"/>
+  <nd ref="529678625"/>
+  <nd ref="529678623"/>
+  <nd ref="529678619"/>
+  <nd ref="529678621"/>
+  <nd ref="529678617"/>
+  <nd ref="529678615"/>
+  <nd ref="1769300561"/>
+  <nd ref="529678600"/>
+  <nd ref="539237109"/>
+  <nd ref="529678602"/>
+  <nd ref="1525143760"/>
+  <nd ref="529678604"/>
+  <nd ref="529678598"/>
+  <nd ref="529678595"/>
+  <nd ref="529678597"/>
+  <nd ref="539237102"/>
+  <nd ref="529678594"/>
+  <nd ref="529678593"/>
+  <nd ref="529678592"/>
+  <nd ref="529678589"/>
+  <nd ref="529678587"/>
+  <nd ref="529678590"/>
+  <nd ref="1525143717"/>
+  <nd ref="529678591"/>
+  <nd ref="1525143712"/>
+  <nd ref="529678586"/>
+  <nd ref="529678585"/>
+  <nd ref="1522932715"/>
+  <nd ref="1511466837"/>
+  <nd ref="529678584"/>
+  <nd ref="529678582"/>
+  <nd ref="529678583"/>
+  <nd ref="529678578"/>
+  <nd ref="529678571"/>
+  <nd ref="529678574"/>
+  <nd ref="529678576"/>
+  <nd ref="529678568"/>
+  <nd ref="529678561"/>
+  <tag k="area" v="yes"/>
+  <tag k="boundary" v="protected_area"/>
+  <tag k="loc_ref" v="325.520"/>
+  <tag k="name" v="Landschaftsschutzgebiet Pegnitztal Ost"/>
+  <tag k="protect_class" v="5"/>
+  <tag k="protect_id" v="5"/>
+  <tag k="protection_level" v="5"/>
+  <tag k="protection_title" v="Landschaftsschutzgebiet"/>
+  <tag k="source" v="Verordnung vom 28.6.2000 mit Anlage 4"/>
+ </way>
+ <way id="201039162" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:19Z" user="pyram" uid="497849">
+  <nd ref="2109912703"/>
+  <nd ref="2109912716"/>
+  <nd ref="2109912612"/>
+  <nd ref="2109912598"/>
+  <nd ref="2109912703"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="201039236" visible="true" version="1" changeset="14642788" timestamp="2013-01-13T23:47:21Z" user="pyram" uid="497849">
+  <nd ref="2109912883"/>
+  <nd ref="2109912890"/>
+  <nd ref="1740070382"/>
+  <nd ref="2109912758"/>
+  <nd ref="2109912707"/>
+  <nd ref="2109912883"/>
+  <tag k="building" v="garages"/>
+ </way>
+ <way id="35922701" visible="true" version="2" changeset="14642788" timestamp="2013-01-13T23:47:41Z" user="pyram" uid="497849">
+  <nd ref="251402734"/>
+  <nd ref="419915035"/>
+  <nd ref="171750538"/>
+  <tag k="highway" v="path"/>
+ </way>
+ <way id="204558966" visible="true" version="1" changeset="14947316" timestamp="2013-02-07T17:20:14Z" user="geodreieck4711" uid="479256">
+  <nd ref="87043195"/>
+  <nd ref="1511439712"/>
+  <nd ref="87043190"/>
+  <nd ref="1511439615"/>
+  <nd ref="1511439568"/>
+  <nd ref="1511439560"/>
+  <nd ref="148436869"/>
+  <nd ref="148436862"/>
+  <tag k="foot" v="yes"/>
+  <tag k="highway" v="cycleway"/>
+  <tag k="name" v="Pegnitzweg"/>
+  <tag k="surface" v="unpaved"/>
+  <tag k="tracktype" v="grade2"/>
+ </way>
+ <way id="208580244" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:14Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622792"/>
+  <nd ref="2188622795"/>
+  <nd ref="2188622796"/>
+  <nd ref="2188622803"/>
+  <nd ref="2188622807"/>
+  <nd ref="2188622810"/>
+  <nd ref="2188622794"/>
+  <nd ref="2188622790"/>
+  <nd ref="2188622786"/>
+  <nd ref="2188622780"/>
+  <nd ref="2188622792"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580247" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:14Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622753"/>
+  <nd ref="2188622758"/>
+  <nd ref="2188622762"/>
+  <nd ref="2188622765"/>
+  <nd ref="2188622755"/>
+  <nd ref="2188622757"/>
+  <nd ref="2188622749"/>
+  <nd ref="914907178"/>
+  <nd ref="2188622751"/>
+  <nd ref="2188622745"/>
+  <nd ref="914907511"/>
+  <nd ref="2188622748"/>
+  <nd ref="2188622753"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580251" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:15Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622775"/>
+  <nd ref="2188622779"/>
+  <nd ref="2188622763"/>
+  <nd ref="2188622761"/>
+  <nd ref="2188622775"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580260" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:15Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622772"/>
+  <nd ref="2188622770"/>
+  <nd ref="2188622752"/>
+  <nd ref="2188622754"/>
+  <nd ref="2188622772"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580264" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:15Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622822"/>
+  <nd ref="2188622838"/>
+  <nd ref="2188622827"/>
+  <nd ref="2188622814"/>
+  <nd ref="2188622822"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580267" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:15Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622743"/>
+  <nd ref="2188622744"/>
+  <nd ref="2188622742"/>
+  <nd ref="2188622741"/>
+  <nd ref="2188622743"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580271" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:15Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622764"/>
+  <nd ref="2188622767"/>
+  <nd ref="2188622760"/>
+  <nd ref="2188622759"/>
+  <nd ref="2188622747"/>
+  <nd ref="2188622746"/>
+  <nd ref="2188622764"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580276" visible="true" version="1" changeset="15272386" timestamp="2013-03-06T16:11:16Z" user="geodreieck4711" uid="479256">
+  <nd ref="2188622848"/>
+  <nd ref="2188622859"/>
+  <nd ref="2188622824"/>
+  <nd ref="2188622818"/>
+  <nd ref="2188622829"/>
+  <nd ref="2188622826"/>
+  <nd ref="2188622835"/>
+  <nd ref="2188622831"/>
+  <nd ref="2188622848"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110263" visible="true" version="4" changeset="15272386" timestamp="2013-03-06T16:11:18Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756749"/>
+  <nd ref="917756583"/>
+  <nd ref="917756688"/>
+  <nd ref="917756791"/>
+  <nd ref="917756749"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="208580262" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:46Z" user="pyram" uid="497849">
+  <nd ref="2188622768"/>
+  <nd ref="2188622769"/>
+  <nd ref="2188622756"/>
+  <nd ref="2188622750"/>
+  <nd ref="2188622768"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="1"/>
+  <tag k="roof:shape" v="flat"/>
+ </way>
+ <way id="208580269" visible="true" version="2" changeset="29781608" timestamp="2015-03-27T16:27:47Z" user="pyram" uid="497849">
+  <nd ref="2188622781"/>
+  <nd ref="2188622782"/>
+  <nd ref="2188622777"/>
+  <nd ref="2188622776"/>
+  <nd ref="914905597"/>
+  <nd ref="2188622781"/>
+  <tag k="building" v="garages"/>
+  <tag k="building:levels" v="1"/>
+  <tag k="roof:shape" v="flat"/>
+ </way>
+ <way id="208580284" visible="true" version="4" changeset="35079420" timestamp="2015-11-04T13:55:51Z" user="marek kleciak" uid="338611">
+  <nd ref="1581758713"/>
+  <nd ref="3817182342"/>
+  <nd ref="270973172"/>
+  <nd ref="270973173"/>
+  <nd ref="270973175"/>
+  <nd ref="270973176"/>
+  <nd ref="270973177"/>
+  <nd ref="2924643699"/>
+  <nd ref="270973178"/>
+  <nd ref="2215265115"/>
+  <tag k="bicycle" v="yes"/>
+  <tag k="cycle_direction" v="both"/>
+  <tag k="foot" v="designated"/>
+  <tag k="highway" v="path"/>
+  <tag k="traffic_sign" v="DE:239;DE1022-10"/>
+ </way>
+ <way id="208580273" visible="true" version="2" changeset="37614145" timestamp="2016-03-04T18:28:23Z" user="pyram" uid="497849">
+  <nd ref="2188622793"/>
+  <nd ref="2188622787"/>
+  <nd ref="2188622785"/>
+  <nd ref="2188622694"/>
+  <nd ref="2188622813"/>
+  <nd ref="2188622817"/>
+  <nd ref="2188622793"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="209564119" visible="true" version="1" changeset="15340439" timestamp="2013-03-12T14:06:03Z" user="geodreieck4711" uid="479256">
+  <nd ref="2197676133"/>
+  <nd ref="2197676127"/>
+  <nd ref="2197676130"/>
+  <nd ref="2197676136"/>
+  <nd ref="2197676133"/>
+  <tag k="building" v="yes"/>
+  <tag k="power" v="sub_station"/>
+ </way>
+ <way id="231911433" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376146"/>
+  <nd ref="2402376147"/>
+  <nd ref="2402376130"/>
+  <nd ref="2402376128"/>
+  <nd ref="2402376146"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911437" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376233"/>
+  <nd ref="2402376235"/>
+  <nd ref="2402376228"/>
+  <nd ref="2402376226"/>
+  <nd ref="2402376233"/>
+  <tag k="building" v="garage"/>
+ </way>
+ <way id="231911438" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:53Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376215"/>
+  <nd ref="2402376216"/>
+  <nd ref="2402376206"/>
+  <nd ref="2402376200"/>
+  <nd ref="2402376215"/>
+  <tag k="building" v="garage"/>
+ </way>
+ <way id="231911442" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:54Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376161"/>
+  <nd ref="2402376165"/>
+  <nd ref="2402376155"/>
+  <nd ref="2402376151"/>
+  <nd ref="2402376161"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911445" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:53:54Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376182"/>
+  <nd ref="2402376184"/>
+  <nd ref="2402376180"/>
+  <nd ref="2402376178"/>
+  <nd ref="2402376182"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911639" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:08Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376229"/>
+  <nd ref="2402376231"/>
+  <nd ref="2402376225"/>
+  <nd ref="2402376222"/>
+  <nd ref="2402376229"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911643" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:08Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376167"/>
+  <nd ref="2402376169"/>
+  <nd ref="2402376159"/>
+  <nd ref="2402376153"/>
+  <nd ref="2402376167"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911647" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:08Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376136"/>
+  <nd ref="2402376140"/>
+  <nd ref="2402376134"/>
+  <nd ref="2402376132"/>
+  <nd ref="2402376136"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911649" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:08Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376234"/>
+  <nd ref="2402376236"/>
+  <nd ref="2402376232"/>
+  <nd ref="2402376230"/>
+  <nd ref="2402376234"/>
+  <tag k="building" v="garage"/>
+ </way>
+ <way id="231911653" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:08Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376186"/>
+  <nd ref="2402376188"/>
+  <nd ref="2402376163"/>
+  <nd ref="2402376157"/>
+  <nd ref="1249743369"/>
+  <nd ref="1249743321"/>
+  <nd ref="2402376186"/>
+  <tag k="building" v="garage"/>
+ </way>
+ <way id="231911661" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:09Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402376224"/>
+  <nd ref="2402376227"/>
+  <nd ref="2402376220"/>
+  <nd ref="2402376221"/>
+  <nd ref="2402376212"/>
+  <nd ref="2402376210"/>
+  <nd ref="2402376218"/>
+  <nd ref="2402376217"/>
+  <nd ref="2402376224"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911665" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:09Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402375926"/>
+  <nd ref="2402375962"/>
+  <tag k="addr:interpolation" v="even"/>
+ </way>
+ <way id="231911673" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:09Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402375754"/>
+  <nd ref="2402375632"/>
+  <tag k="addr:interpolation" v="even"/>
+ </way>
+ <way id="231911681" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:09Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402375908"/>
+  <nd ref="2402375917"/>
+  <tag k="addr:interpolation" v="even"/>
+ </way>
+ <way id="231911684" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:09Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402375855"/>
+  <nd ref="2402375774"/>
+  <tag k="addr:interpolation" v="odd"/>
+ </way>
+ <way id="231911688" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:09Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402375792"/>
+  <nd ref="2402375868"/>
+  <tag k="addr:interpolation" v="even"/>
+ </way>
+ <way id="231911690" visible="true" version="1" changeset="17165139" timestamp="2013-07-31T11:54:09Z" user="geodreieck4711" uid="479256">
+  <nd ref="2402375969"/>
+  <nd ref="2402375985"/>
+  <tag k="addr:interpolation" v="even"/>
+ </way>
+ <way id="78110316" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:10Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756585"/>
+  <nd ref="917756692"/>
+  <nd ref="917756794"/>
+  <nd ref="917756626"/>
+  <nd ref="917756585"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110322" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:10Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756676"/>
+  <nd ref="917756781"/>
+  <nd ref="917756779"/>
+  <nd ref="917756612"/>
+  <nd ref="917756676"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110262" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:12Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756711"/>
+  <nd ref="917756754"/>
+  <nd ref="917756647"/>
+  <nd ref="917756544"/>
+  <nd ref="917756711"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110311" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:12Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756687"/>
+  <nd ref="917756790"/>
+  <nd ref="917756622"/>
+  <nd ref="917756730"/>
+  <nd ref="917756687"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110265" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:12Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756705"/>
+  <nd ref="917756808"/>
+  <nd ref="917756641"/>
+  <nd ref="917756748"/>
+  <nd ref="917756705"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110256" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:14Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756673"/>
+  <nd ref="917756717"/>
+  <nd ref="917756609"/>
+  <nd ref="2402376142"/>
+  <nd ref="2402376149"/>
+  <nd ref="917756777"/>
+  <nd ref="917756673"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110323" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:14Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756565"/>
+  <nd ref="917756669"/>
+  <nd ref="917756774"/>
+  <nd ref="2402376219"/>
+  <nd ref="2402376223"/>
+  <nd ref="917756606"/>
+  <nd ref="917756565"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110333" visible="true" version="4" changeset="17165139" timestamp="2013-07-31T11:54:14Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756552"/>
+  <nd ref="2402376176"/>
+  <nd ref="2402376174"/>
+  <nd ref="917756657"/>
+  <nd ref="917756763"/>
+  <nd ref="917756597"/>
+  <nd ref="2402376172"/>
+  <nd ref="2402376170"/>
+  <nd ref="917756552"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110290" visible="true" version="5" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645">
+  <nd ref="917756654"/>
+  <nd ref="917756700"/>
+  <nd ref="917756593"/>
+  <nd ref="917756760"/>
+  <nd ref="917756654"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="3"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Vorrastraße"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="35922703" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:50Z" user="marek kleciak" uid="338611">
+  <nd ref="171750573"/>
+  <nd ref="419915043"/>
+  <nd ref="3817182931"/>
+  <nd ref="2402376138"/>
+  <nd ref="419915053"/>
+  <tag k="highway" v="footway"/>
+ </way>
+ <way id="144655082" visible="true" version="3" changeset="35079420" timestamp="2015-11-04T13:55:53Z" user="marek kleciak" uid="338611">
+  <nd ref="171750562"/>
+  <nd ref="270963244"/>
+  <nd ref="171750567"/>
+  <nd ref="3817182934"/>
+  <nd ref="1041370555"/>
+  <nd ref="171750573"/>
+  <nd ref="171750578"/>
+  <nd ref="2402376144"/>
+  <nd ref="171750586"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Artelshofer Straße"/>
+ </way>
+ <way id="133603529" visible="true" version="4" changeset="25181325" timestamp="2014-09-02T12:59:03Z" user="jacobbraeutigam" uid="1260280">
+  <nd ref="1470605774"/>
+  <nd ref="1564890419"/>
+  <nd ref="1564890417"/>
+  <nd ref="1470605781"/>
+  <nd ref="1470605778"/>
+  <nd ref="1470605766"/>
+  <nd ref="1470605762"/>
+  <nd ref="1470605760"/>
+  <nd ref="1470605774"/>
+  <tag k="addr:city" v="Nürnberg"/>
+  <tag k="addr:country" v="DE"/>
+  <tag k="addr:housenumber" v="1"/>
+  <tag k="addr:postcode" v="90482"/>
+  <tag k="addr:street" v="Moritzbergstraße"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="231911659" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:21Z" user="pyram" uid="497849">
+  <nd ref="2402376198"/>
+  <nd ref="2402376190"/>
+  <nd ref="2402376196"/>
+  <nd ref="2402376208"/>
+  <nd ref="2402376202"/>
+  <nd ref="2402376198"/>
+  <tag k="building" v="garages"/>
+  <tag k="building:levels" v="1"/>
+  <tag k="roof:shape" v="flat"/>
+ </way>
+ <way id="77815892" visible="true" version="5" changeset="37928213" timestamp="2016-03-18T21:16:22Z" user="pyram" uid="497849">
+  <nd ref="4067358915"/>
+  <nd ref="914905675"/>
+  <nd ref="914906518"/>
+  <nd ref="2402375618"/>
+  <nd ref="4067358923"/>
+  <nd ref="4067358915"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="1.5"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="201039222" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:22Z" user="pyram" uid="497849">
+  <nd ref="2109912982"/>
+  <nd ref="1747735471"/>
+  <nd ref="1740065296"/>
+  <nd ref="1740065297"/>
+  <nd ref="2109912936"/>
+  <nd ref="2109912982"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="201039241" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:23Z" user="pyram" uid="497849">
+  <nd ref="2109912941"/>
+  <nd ref="1747735472"/>
+  <nd ref="1740070378"/>
+  <nd ref="1740065298"/>
+  <nd ref="1740070380"/>
+  <nd ref="2109912870"/>
+  <nd ref="2109912941"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="201039238" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:23Z" user="pyram" uid="497849">
+  <nd ref="1740065299"/>
+  <nd ref="1747735476"/>
+  <nd ref="2109912969"/>
+  <nd ref="2109912923"/>
+  <nd ref="1740065298"/>
+  <nd ref="1740070378"/>
+  <nd ref="1740065299"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="201039234" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:23Z" user="pyram" uid="497849">
+  <nd ref="1740070375"/>
+  <nd ref="1747735474"/>
+  <nd ref="2109912931"/>
+  <nd ref="2109912864"/>
+  <nd ref="1740070382"/>
+  <nd ref="2109912890"/>
+  <nd ref="1740070375"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="77815812" visible="true" version="4" changeset="17166312" timestamp="2013-07-31T13:34:13Z" user="geodreieck4711" uid="479256">
+  <nd ref="914906657"/>
+  <nd ref="914905381"/>
+  <nd ref="914907083"/>
+  <nd ref="914907504"/>
+  <nd ref="914906657"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="232146947" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645">
+  <nd ref="2405180023"/>
+  <nd ref="2405180024"/>
+  <nd ref="2405180016"/>
+  <nd ref="2405180014"/>
+  <nd ref="2405180023"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="232146948" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645">
+  <nd ref="2405180010"/>
+  <nd ref="2405180012"/>
+  <nd ref="2405180008"/>
+  <nd ref="2405180005"/>
+  <nd ref="2405180010"/>
+  <tag k="building" v="garages"/>
+ </way>
+ <way id="232146949" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:32Z" user="frauzack" uid="1172645">
+  <nd ref="2405180001"/>
+  <nd ref="2405180003"/>
+  <nd ref="2405179999"/>
+  <nd ref="2405179995"/>
+  <nd ref="2405180001"/>
+  <tag k="building" v="residential"/>
+ </way>
+ <way id="232146950" visible="true" version="1" changeset="17192358" timestamp="2013-08-02T13:50:33Z" user="frauzack" uid="1172645">
+  <nd ref="2405180026"/>
+  <nd ref="2405180029"/>
+  <nd ref="2405180020"/>
+  <nd ref="2405180018"/>
+  <nd ref="2405180026"/>
+  <tag k="building" v="garages"/>
+ </way>
+ <way id="311214199" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:55Z" user="marek kleciak" uid="338611">
+  <nd ref="889215123"/>
+  <nd ref="734788923"/>
+  <nd ref="889215096"/>
+  <nd ref="3817182337"/>
+  <nd ref="1724594233"/>
+  <nd ref="1581758695"/>
+  <tag k="change:lanes:backward" v="not_left|yes"/>
+  <tag k="change:lanes:forward" v="not_left|yes"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="4"/>
+  <tag k="lanes:backward" v="2"/>
+  <tag k="lanes:forward" v="2"/>
+  <tag k="lit" v="yes"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="ref" v="St 2241"/>
+  <tag k="source" v="yahoo; extrapolation"/>
+  <tag k="surface" v="asphalt"/>
+ </way>
+ <way id="311214193" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:55Z" user="marek kleciak" uid="338611">
+  <nd ref="270963173"/>
+  <nd ref="3817182350"/>
+  <nd ref="305537489"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="4"/>
+  <tag k="lanes:backward" v="2"/>
+  <tag k="lanes:forward" v="2"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+ </way>
+ <way id="311214192" visible="true" version="1" changeset="26563807" timestamp="2014-11-05T05:16:50Z" user="theophrastos" uid="96069">
+  <nd ref="3167978659"/>
+  <nd ref="270963173"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="3"/>
+  <tag k="lanes:backward" v="2"/>
+  <tag k="lanes:forward" v="1"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="turn:lanes:backward" v="merge_to_right|none"/>
+ </way>
+ <way id="311214197" visible="true" version="1" changeset="26563807" timestamp="2014-11-05T05:16:51Z" user="theophrastos" uid="96069">
+  <nd ref="1564949378"/>
+  <nd ref="1581758715"/>
+  <nd ref="270971629"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="4"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="ref" v="St 2241"/>
+ </way>
+ <way id="311214200" visible="true" version="1" changeset="26563807" timestamp="2014-11-05T05:16:52Z" user="theophrastos" uid="96069">
+  <nd ref="1581758695"/>
+  <nd ref="734779068"/>
+  <nd ref="171750592"/>
+  <nd ref="1268926957"/>
+  <nd ref="1268926959"/>
+  <nd ref="224088839"/>
+  <nd ref="3167978658"/>
+  <tag k="highway" v="secondary"/>
+  <tag k="lanes" v="4"/>
+  <tag k="lanes:backward" v="2"/>
+  <tag k="lanes:forward" v="2"/>
+  <tag k="lit" v="yes"/>
+  <tag k="maxspeed" v="50"/>
+  <tag k="name" v="Laufamholzstraße"/>
+  <tag k="ref" v="St 2241"/>
+  <tag k="source" v="yahoo; extrapolation"/>
+  <tag k="surface" v="asphalt"/>
+ </way>
+ <way id="335051227" visible="true" version="1" changeset="29781608" timestamp="2015-03-27T16:27:45Z" user="pyram" uid="497849">
+  <nd ref="3421803784"/>
+  <nd ref="2188655620"/>
+  <nd ref="3421803786"/>
+  <nd ref="3421803779"/>
+  <nd ref="3421803778"/>
+  <nd ref="3421803784"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="1.5"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="335051236" visible="true" version="1" changeset="29781608" timestamp="2015-03-27T16:27:46Z" user="pyram" uid="497849">
+  <nd ref="3421803778"/>
+  <nd ref="2188655784"/>
+  <nd ref="2188655857"/>
+  <nd ref="2188655619"/>
+  <nd ref="3421803784"/>
+  <nd ref="3421803778"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="1.5"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="342813848" visible="true" version="1" changeset="30789430" timestamp="2015-05-04T19:44:37Z" user="pyram" uid="497849">
+  <nd ref="3497710763"/>
+  <nd ref="3497710759"/>
+  <nd ref="3497710764"/>
+  <nd ref="3497710762"/>
+  <nd ref="3497710761"/>
+  <nd ref="3497710763"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="2"/>
+  <tag k="roof:orientation" v="along"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="307653043" visible="true" version="1" changeset="26060592" timestamp="2014-10-13T21:53:12Z" user="pyram" uid="497849">
+  <nd ref="3128508648"/>
+  <nd ref="3128508647"/>
+  <nd ref="3128508651"/>
+  <nd ref="3128508652"/>
+  <nd ref="3128508650"/>
+  <nd ref="3128508649"/>
+  <nd ref="3128508648"/>
+  <tag k="landuse" v="grass"/>
+ </way>
+ <way id="361052622" visible="true" version="8" changeset="42404513" timestamp="2016-09-24T12:44:10Z" user="pyram" uid="497849">
+  <nd ref="3655753641"/>
+  <nd ref="3655753659"/>
+  <nd ref="3655758895"/>
+  <nd ref="3655758944"/>
+  <nd ref="3655759017"/>
+  <nd ref="3655753635"/>
+  <nd ref="3655759019"/>
+  <nd ref="3655758934"/>
+  <nd ref="3655758910"/>
+  <nd ref="3655758945"/>
+  <nd ref="3655758957"/>
+  <nd ref="3655758912"/>
+  <nd ref="3655758927"/>
+  <nd ref="3655758959"/>
+  <nd ref="3655758926"/>
+  <nd ref="3655753697"/>
+  <nd ref="908569549"/>
+  <nd ref="4268755512"/>
+  <nd ref="419878578"/>
+  <nd ref="4268755508"/>
+  <nd ref="4268755510"/>
+  <nd ref="419878581"/>
+  <nd ref="4268755515"/>
+  <nd ref="411043121"/>
+  <nd ref="3817182336"/>
+  <nd ref="1808108283"/>
+  <nd ref="1569002933"/>
+  <nd ref="1569002927"/>
+  <nd ref="1569002923"/>
+  <nd ref="1569002929"/>
+  <nd ref="1808108239"/>
+  <nd ref="1808108238"/>
+  <nd ref="1569002925"/>
+  <nd ref="270978221"/>
+  <nd ref="270978222"/>
+  <nd ref="2617614108"/>
+  <nd ref="2617614116"/>
+  <nd ref="249851542"/>
+  <nd ref="249851538"/>
+  <nd ref="411043126"/>
+  <nd ref="3817216568"/>
+  <nd ref="411043127"/>
+  <nd ref="529675405"/>
+  <nd ref="529675403"/>
+  <nd ref="529675411"/>
+  <nd ref="529675410"/>
+  <nd ref="529675409"/>
+  <nd ref="249851541"/>
+  <nd ref="4070049436"/>
+  <nd ref="4070049437"/>
+  <nd ref="411043133"/>
+  <nd ref="4070049270"/>
+  <nd ref="3096580838"/>
+  <nd ref="3096593131"/>
+  <nd ref="375751456"/>
+  <nd ref="375751464"/>
+  <nd ref="411043134"/>
+  <nd ref="419878690"/>
+  <nd ref="411043136"/>
+  <nd ref="4070049271"/>
+  <nd ref="419878682"/>
+  <nd ref="4070049274"/>
+  <nd ref="4070049276"/>
+  <nd ref="4070049275"/>
+  <nd ref="4070049277"/>
+  <nd ref="411043140"/>
+  <nd ref="419878681"/>
+  <nd ref="4070049394"/>
+  <nd ref="4070049389"/>
+  <nd ref="4070049424"/>
+  <nd ref="419878674"/>
+  <nd ref="4070049438"/>
+  <nd ref="4070049443"/>
+  <nd ref="419878673"/>
+  <nd ref="4070049450"/>
+  <nd ref="4070049454"/>
+  <nd ref="295093017"/>
+  <nd ref="4070049456"/>
+  <nd ref="4070049452"/>
+  <nd ref="4070049447"/>
+  <nd ref="4070049451"/>
+  <nd ref="4070049453"/>
+  <nd ref="4070049455"/>
+  <nd ref="411043142"/>
+  <nd ref="411043144"/>
+  <nd ref="914038046"/>
+  <nd ref="411043145"/>
+  <nd ref="411043146"/>
+  <nd ref="2109913152"/>
+  <nd ref="2109913133"/>
+  <nd ref="295093024"/>
+  <nd ref="2109913259"/>
+  <nd ref="411043147"/>
+  <nd ref="2109913266"/>
+  <nd ref="2109913287"/>
+  <nd ref="2109913290"/>
+  <nd ref="2109913312"/>
+  <nd ref="2109913314"/>
+  <nd ref="2109913310"/>
+  <nd ref="2109913307"/>
+  <nd ref="2109913280"/>
+  <nd ref="3157273565"/>
+  <nd ref="3157273553"/>
+  <nd ref="3157273554"/>
+  <nd ref="3157273552"/>
+  <nd ref="411043149"/>
+  <nd ref="1428414887"/>
+  <nd ref="1963694786"/>
+  <nd ref="1963694788"/>
+  <nd ref="1428414903"/>
+  <nd ref="1963694822"/>
+  <nd ref="1428414904"/>
+  <nd ref="1428414907"/>
+  <nd ref="1428414890"/>
+  <nd ref="1963694864"/>
+  <nd ref="1963694865"/>
+  <nd ref="3157273575"/>
+  <nd ref="1428414878"/>
+  <nd ref="3157273576"/>
+  <nd ref="3157273566"/>
+  <nd ref="1428414886"/>
+  <nd ref="3157273557"/>
+  <nd ref="411043150"/>
+  <nd ref="1428414889"/>
+  <nd ref="3157273543"/>
+  <nd ref="3157273541"/>
+  <nd ref="3157273538"/>
+  <nd ref="3157273537"/>
+  <nd ref="3157273534"/>
+  <nd ref="3157273528"/>
+  <nd ref="3157273533"/>
+  <nd ref="3157273535"/>
+  <nd ref="3157273540"/>
+  <nd ref="3157273542"/>
+  <nd ref="411043151"/>
+  <nd ref="1428414885"/>
+  <nd ref="411043152"/>
+  <nd ref="1428414882"/>
+  <nd ref="3609297501"/>
+  <nd ref="1769374949"/>
+  <nd ref="171750610"/>
+  <nd ref="411043154"/>
+  <nd ref="265760614"/>
+  <nd ref="1693942417"/>
+  <nd ref="411043155"/>
+  <nd ref="1693942549"/>
+  <nd ref="1525143738"/>
+  <nd ref="1525143746"/>
+  <nd ref="539237108"/>
+  <nd ref="539237109"/>
+  <nd ref="539237106"/>
+  <nd ref="3157273560"/>
+  <nd ref="1525213431"/>
+  <nd ref="539237105"/>
+  <nd ref="539237104"/>
+  <nd ref="539237103"/>
+  <nd ref="309246633"/>
+  <nd ref="539237102"/>
+  <nd ref="1525143743"/>
+  <nd ref="539237101"/>
+  <nd ref="1693942639"/>
+  <nd ref="1525143728"/>
+  <nd ref="1525143724"/>
+  <nd ref="1525143717"/>
+  <nd ref="529678591"/>
+  <nd ref="1525143712"/>
+  <nd ref="529678586"/>
+  <nd ref="539237098"/>
+  <nd ref="1522932715"/>
+  <nd ref="539237099"/>
+  <nd ref="249846782"/>
+  <nd ref="3435839406"/>
+  <nd ref="3435839407"/>
+  <nd ref="3435839405"/>
+  <nd ref="1512643191"/>
+  <nd ref="3435839404"/>
+  <nd ref="249846784"/>
+  <nd ref="3435839402"/>
+  <nd ref="3172155498"/>
+  <nd ref="249846785"/>
+  <nd ref="539237096"/>
+  <nd ref="1522932703"/>
+  <nd ref="1522932697"/>
+  <nd ref="1522932696"/>
+  <nd ref="1468258067"/>
+  <nd ref="3655753641"/>
+  <tag k="landuse" v="residential"/>
+  <tag k="note" v="Sehr grob, bitte weiter verfeinern... :-)"/>
+ </way>
+ <way id="369721052" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256">
+  <nd ref="3734909258"/>
+  <nd ref="3734909266"/>
+  <nd ref="3734909267"/>
+  <nd ref="3734909268"/>
+  <nd ref="3734909274"/>
+  <nd ref="3734909276"/>
+  <nd ref="3734909279"/>
+  <nd ref="3734909278"/>
+  <nd ref="3734909282"/>
+  <nd ref="3734909277"/>
+  <nd ref="3734909275"/>
+  <nd ref="3734909273"/>
+  <nd ref="3734909271"/>
+  <nd ref="3734909272"/>
+  <nd ref="3734909265"/>
+  <nd ref="3734909264"/>
+  <nd ref="3734909258"/>
+ </way>
+ <way id="369721053" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256">
+  <nd ref="3734909283"/>
+  <nd ref="3734909286"/>
+  <nd ref="3734909284"/>
+  <nd ref="3734909285"/>
+  <nd ref="3734909253"/>
+  <nd ref="3734909240"/>
+  <nd ref="3734909252"/>
+  <nd ref="3734909280"/>
+  <nd ref="3734909281"/>
+  <nd ref="3734909283"/>
+ </way>
+ <way id="369721054" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256">
+  <nd ref="3734909119"/>
+  <nd ref="3734909120"/>
+  <nd ref="3734909114"/>
+  <nd ref="3734909121"/>
+  <nd ref="3734909230"/>
+  <nd ref="3734909231"/>
+  <nd ref="3734909257"/>
+  <nd ref="3734909251"/>
+  <nd ref="3734909237"/>
+  <nd ref="3734909236"/>
+  <nd ref="3734909118"/>
+  <nd ref="3734909119"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="369721055" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:34Z" user="geodreieck4711" uid="479256">
+  <nd ref="3734909260"/>
+  <nd ref="3734909261"/>
+  <nd ref="3734909254"/>
+  <nd ref="3734909262"/>
+  <nd ref="3734909249"/>
+  <nd ref="3734909244"/>
+  <nd ref="3734909243"/>
+  <nd ref="3734909242"/>
+  <nd ref="3734909241"/>
+  <nd ref="3734909239"/>
+  <nd ref="3734909238"/>
+  <nd ref="3734909247"/>
+  <nd ref="3734909248"/>
+  <nd ref="3734909260"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="369721056" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:35Z" user="geodreieck4711" uid="479256">
+  <nd ref="3734909122"/>
+  <nd ref="3734909117"/>
+  <nd ref="3734909227"/>
+  <nd ref="3734909232"/>
+  <nd ref="3734909122"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="369721058" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:35Z" user="geodreieck4711" uid="479256">
+  <nd ref="3734909091"/>
+  <nd ref="3734909090"/>
+  <nd ref="3734909085"/>
+  <nd ref="3734909086"/>
+  <nd ref="3734909088"/>
+  <nd ref="3734909089"/>
+  <nd ref="3734909091"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="369721059" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:35Z" user="geodreieck4711" uid="479256">
+  <nd ref="3734909225"/>
+  <nd ref="3734909226"/>
+  <nd ref="3734909123"/>
+  <nd ref="3734909124"/>
+  <nd ref="3734909116"/>
+  <nd ref="3734909115"/>
+  <nd ref="3734909111"/>
+  <nd ref="3734909109"/>
+  <nd ref="3734909225"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110284" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:39Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756667"/>
+  <nd ref="917756712"/>
+  <nd ref="917756605"/>
+  <nd ref="917756772"/>
+  <nd ref="917756667"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="78110301" visible="true" version="2" changeset="33890681" timestamp="2015-09-08T18:48:39Z" user="geodreieck4711" uid="479256">
+  <nd ref="917756648"/>
+  <nd ref="917756695"/>
+  <nd ref="917756589"/>
+  <nd ref="917756755"/>
+  <nd ref="917756648"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="378314246" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182872"/>
+  <nd ref="3817182880"/>
+  <nd ref="3817182940"/>
+  <nd ref="3817182936"/>
+  <nd ref="3817182922"/>
+  <nd ref="3817182920"/>
+  <nd ref="3817182914"/>
+  <nd ref="3817182872"/>
+  <tag k="area:highway" v="residential"/>
+ </way>
+ <way id="378314247" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611">
+  <nd ref="3817183057"/>
+  <nd ref="3817182340"/>
+  <nd ref="3817182925"/>
+  <nd ref="3817183098"/>
+  <nd ref="3817182950"/>
+  <nd ref="3817182298"/>
+  <nd ref="3817183057"/>
+  <tag k="area:highway" v="secondary"/>
+ </way>
+ <way id="378314248" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:44Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182859"/>
+  <nd ref="3817182350"/>
+  <nd ref="3817182356"/>
+  <nd ref="3817182860"/>
+  <nd ref="3817183079"/>
+  <nd ref="3817182299"/>
+  <nd ref="3817183062"/>
+  <nd ref="3817183112"/>
+  <nd ref="3817182903"/>
+  <nd ref="3817182345"/>
+  <nd ref="3817182334"/>
+  <nd ref="3817182313"/>
+  <nd ref="2188623013"/>
+  <nd ref="3817183061"/>
+  <nd ref="3817182945"/>
+  <nd ref="3817182923"/>
+  <nd ref="3817183114"/>
+  <nd ref="3817183118"/>
+  <nd ref="3817182904"/>
+  <nd ref="3817182906"/>
+  <nd ref="3817183075"/>
+  <nd ref="3817182859"/>
+  <tag k="area:highway" v="secondary"/>
+ </way>
+ <way id="378314249" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182896"/>
+  <nd ref="3817182870"/>
+  <nd ref="3817183089"/>
+  <nd ref="3817183095"/>
+  <nd ref="3817182865"/>
+  <nd ref="3817182951"/>
+  <nd ref="3817183086"/>
+  <nd ref="3817182892"/>
+  <nd ref="3817182946"/>
+  <nd ref="3817182939"/>
+  <nd ref="3817182896"/>
+  <tag k="area:highway" v="footway"/>
+  <tag k="kerb" v="yes"/>
+ </way>
+ <way id="378314250" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182926"/>
+  <nd ref="3817182935"/>
+  <nd ref="3817182889"/>
+  <nd ref="3817182913"/>
+  <nd ref="3817183107"/>
+  <nd ref="3817182952"/>
+  <nd ref="3817182926"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="378314251" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182940"/>
+  <nd ref="3817183093"/>
+  <nd ref="3817183090"/>
+  <nd ref="3817182917"/>
+  <nd ref="3817183059"/>
+  <nd ref="3817182937"/>
+  <nd ref="3817182328"/>
+  <nd ref="3817182348"/>
+  <nd ref="3817182882"/>
+  <nd ref="3817182898"/>
+  <nd ref="3817182899"/>
+  <nd ref="3817182900"/>
+  <nd ref="3817182924"/>
+  <nd ref="3817182355"/>
+  <nd ref="3817183084"/>
+  <nd ref="3817183124"/>
+  <nd ref="3817182944"/>
+  <nd ref="3817183116"/>
+  <nd ref="3817182872"/>
+  <nd ref="3817182880"/>
+  <nd ref="3817182940"/>
+  <tag k="area:highway" v="secondary"/>
+  <tag k="junction" v="yes"/>
+ </way>
+ <way id="378314252" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182859"/>
+  <nd ref="3817182350"/>
+  <nd ref="3817182915"/>
+  <nd ref="3817182916"/>
+  <nd ref="3817182305"/>
+  <nd ref="3817182308"/>
+  <nd ref="3817183087"/>
+  <nd ref="3817182908"/>
+  <nd ref="3817183123"/>
+  <nd ref="3817182876"/>
+  <nd ref="3817183132"/>
+  <nd ref="3817183078"/>
+  <nd ref="3817183066"/>
+  <nd ref="3817182326"/>
+  <nd ref="3817182902"/>
+  <nd ref="3817182335"/>
+  <nd ref="3817182941"/>
+  <nd ref="3817183092"/>
+  <nd ref="3817182321"/>
+  <nd ref="3817183058"/>
+  <nd ref="3817182928"/>
+  <nd ref="3817183099"/>
+  <nd ref="3817182884"/>
+  <nd ref="3817183060"/>
+  <nd ref="3817183104"/>
+  <nd ref="3817182863"/>
+  <nd ref="3817182879"/>
+  <nd ref="3817182858"/>
+  <nd ref="3817183073"/>
+  <nd ref="3817182943"/>
+  <nd ref="3817182324"/>
+  <nd ref="3817182934"/>
+  <nd ref="3817182864"/>
+  <nd ref="3817182867"/>
+  <nd ref="3817182932"/>
+  <nd ref="3817182318"/>
+  <nd ref="3817183067"/>
+  <nd ref="3817183072"/>
+  <nd ref="3817182891"/>
+  <nd ref="3817182302"/>
+  <nd ref="3817182927"/>
+  <nd ref="3817183065"/>
+  <nd ref="3817183113"/>
+  <nd ref="3817182953"/>
+  <nd ref="3817182954"/>
+  <nd ref="3817182307"/>
+  <nd ref="3817182929"/>
+  <nd ref="3817183106"/>
+  <nd ref="3817182332"/>
+  <nd ref="3817183081"/>
+  <nd ref="3817182315"/>
+  <nd ref="3817182862"/>
+  <nd ref="3817182329"/>
+  <nd ref="3817182859"/>
+  <tag k="area:highway" v="secondary"/>
+  <tag k="junction" v="yes"/>
+ </way>
+ <way id="378314253" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182896"/>
+  <nd ref="3817182870"/>
+  <nd ref="3817183117"/>
+  <nd ref="3817183063"/>
+  <nd ref="3817183076"/>
+  <nd ref="3817183096"/>
+  <nd ref="3817182896"/>
+  <tag k="area:highway" v="footway"/>
+  <tag k="kerb" v="yes"/>
+  <tag k="landuse" v="grass"/>
+ </way>
+ <way id="378314254" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182869"/>
+  <nd ref="3817182338"/>
+  <nd ref="3817182861"/>
+  <nd ref="3817182320"/>
+  <nd ref="3817182875"/>
+  <nd ref="3817183120"/>
+  <nd ref="3817182931"/>
+  <nd ref="3817182317"/>
+  <nd ref="3817183109"/>
+  <nd ref="3817182897"/>
+  <nd ref="1808108271"/>
+  <nd ref="1808108281"/>
+  <nd ref="3817182893"/>
+  <nd ref="3817182883"/>
+  <nd ref="3817182352"/>
+  <nd ref="3817182947"/>
+  <nd ref="3817182877"/>
+  <nd ref="3817182344"/>
+  <nd ref="3817182869"/>
+  <tag k="area:highway" v="residential"/>
+ </way>
+ <way id="378314256" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182320"/>
+  <nd ref="3817182338"/>
+  <nd ref="3817182869"/>
+  <nd ref="3817182895"/>
+  <nd ref="3817183091"/>
+  <nd ref="3817182300"/>
+  <nd ref="3817183098"/>
+  <nd ref="3817182950"/>
+  <nd ref="3817182298"/>
+  <nd ref="3817182894"/>
+  <nd ref="3817182888"/>
+  <nd ref="3817183134"/>
+  <nd ref="3817182347"/>
+  <nd ref="3817183105"/>
+  <nd ref="3817183071"/>
+  <nd ref="3817182320"/>
+  <tag k="area:highway" v="secondary"/>
+  <tag k="junction" v="yes"/>
+ </way>
+ <way id="378314257" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:45Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182956"/>
+  <nd ref="3817183082"/>
+  <nd ref="3817182949"/>
+  <nd ref="3817182341"/>
+  <nd ref="3817183111"/>
+  <nd ref="3817183083"/>
+  <nd ref="3817182314"/>
+  <nd ref="3817183097"/>
+  <nd ref="3817182881"/>
+  <nd ref="3817182942"/>
+  <nd ref="3817182948"/>
+  <nd ref="3817183088"/>
+  <nd ref="3817183070"/>
+  <nd ref="3817182933"/>
+  <nd ref="3817182874"/>
+  <nd ref="3817182325"/>
+  <nd ref="3817183094"/>
+  <nd ref="3817182316"/>
+  <nd ref="3817182868"/>
+  <nd ref="3817183122"/>
+  <nd ref="3817182353"/>
+  <nd ref="3817182857"/>
+  <nd ref="3817182921"/>
+  <nd ref="3817182327"/>
+  <nd ref="3817183103"/>
+  <nd ref="3817183108"/>
+  <nd ref="3817182938"/>
+  <nd ref="3817182322"/>
+  <nd ref="3817183121"/>
+  <nd ref="3817182956"/>
+  <tag k="area:highway" v="residential"/>
+ </way>
+ <way id="378314258" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182924"/>
+  <nd ref="3817182900"/>
+  <nd ref="3817182899"/>
+  <nd ref="3817182894"/>
+  <nd ref="3817182888"/>
+  <nd ref="3817183134"/>
+  <nd ref="3817182924"/>
+  <tag k="area:highway" v="secondary"/>
+ </way>
+ <way id="378314261" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611">
+  <nd ref="3817182343"/>
+  <nd ref="3817182912"/>
+  <nd ref="3817182354"/>
+  <nd ref="3817182907"/>
+  <nd ref="3817183069"/>
+  <nd ref="3817182333"/>
+  <nd ref="3817183133"/>
+  <nd ref="3817182901"/>
+  <nd ref="3817182346"/>
+  <nd ref="3817182919"/>
+  <nd ref="3817182909"/>
+  <nd ref="3817183102"/>
+  <nd ref="3817183101"/>
+  <nd ref="3817182343"/>
+  <tag k="area:highway" v="footway"/>
+  <tag k="kerb" v="yes"/>
+ </way>
+ <way id="378314255" visible="true" version="2" changeset="35324919" timestamp="2015-11-15T10:56:50Z" user="nafl" uid="671934">
+  <nd ref="3817182348"/>
+  <nd ref="3817182911"/>
+  <nd ref="3817182351"/>
+  <nd ref="3817182311"/>
+  <nd ref="3817182303"/>
+  <nd ref="3817183115"/>
+  <nd ref="3817183130"/>
+  <tag k="fixme" v="tags"/>
+ </way>
+ <way id="378314262" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611">
+  <nd ref="3817183057"/>
+  <nd ref="3817182886"/>
+  <nd ref="3817182309"/>
+  <nd ref="3817182887"/>
+  <nd ref="3817182890"/>
+  <nd ref="3817183100"/>
+  <nd ref="3817182930"/>
+  <nd ref="3817182873"/>
+  <nd ref="3817182956"/>
+  <nd ref="3817183121"/>
+  <nd ref="3817182322"/>
+  <nd ref="3817183110"/>
+  <nd ref="3817182342"/>
+  <nd ref="3817182885"/>
+  <nd ref="3817183074"/>
+  <nd ref="3817182301"/>
+  <nd ref="3817183065"/>
+  <nd ref="3817182927"/>
+  <nd ref="3817182302"/>
+  <nd ref="3817183064"/>
+  <nd ref="3817182925"/>
+  <nd ref="3817182340"/>
+  <nd ref="3817183057"/>
+  <tag k="area:highway" v="secondary"/>
+  <tag k="junction" v="yes"/>
+ </way>
+ <way id="208246939" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:50Z" user="marek kleciak" uid="338611">
+  <nd ref="270963244"/>
+  <nd ref="3817183073"/>
+  <nd ref="2185627722"/>
+  <nd ref="2185627723"/>
+  <nd ref="2185627724"/>
+  <nd ref="3817183099"/>
+  <nd ref="1564890412"/>
+  <tag k="foot" v="designated"/>
+  <tag k="highway" v="path"/>
+  <tag k="traffic_sign" v="DE:239"/>
+ </way>
+ <way id="144655122" visible="true" version="2" changeset="35079420" timestamp="2015-11-04T13:55:53Z" user="marek kleciak" uid="338611">
+  <nd ref="249773878"/>
+  <nd ref="3817182880"/>
+  <nd ref="249773882"/>
+  <tag k="highway" v="residential"/>
+  <tag k="maxspeed" v="30"/>
+  <tag k="name" v="Vorrastraße"/>
+ </way>
+ <way id="378314264" visible="true" version="2" changeset="35324919" timestamp="2015-11-15T10:56:50Z" user="nafl" uid="671934">
+  <nd ref="3817182898"/>
+  <nd ref="3817182312"/>
+  <nd ref="3817183085"/>
+  <nd ref="3817182955"/>
+  <nd ref="3817182304"/>
+  <nd ref="3817182878"/>
+  <tag k="fixme" v="tags"/>
+ </way>
+ <way id="401646328" visible="true" version="1" changeset="37614145" timestamp="2016-03-04T18:28:21Z" user="pyram" uid="497849">
+  <nd ref="4040571253"/>
+  <nd ref="4040571254"/>
+  <nd ref="2188622793"/>
+  <nd ref="2188622817"/>
+  <nd ref="2188622819"/>
+  <nd ref="4040571264"/>
+  <nd ref="4040571267"/>
+  <nd ref="2188622700"/>
+  <nd ref="4040571268"/>
+  <nd ref="4040571265"/>
+  <nd ref="2188622828"/>
+  <nd ref="2188622806"/>
+  <nd ref="4040571257"/>
+  <nd ref="4040571255"/>
+  <nd ref="4040571253"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="404460937" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:16Z" user="pyram" uid="497849">
+  <nd ref="4067357877"/>
+  <nd ref="2109912838"/>
+  <nd ref="2109912851"/>
+  <nd ref="4067357878"/>
+  <nd ref="4067357877"/>
+  <tag k="building" v="garages"/>
+  <tag k="building:levels" v="1"/>
+  <tag k="roof:shape" v="flat"/>
+ </way>
+ <way id="404460939" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:16Z" user="pyram" uid="497849">
+  <nd ref="4067358923"/>
+  <nd ref="2402375609"/>
+  <nd ref="914906092"/>
+  <nd ref="914906941"/>
+  <nd ref="4067358915"/>
+  <nd ref="4067358923"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="1.5"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="404460940" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:16Z" user="pyram" uid="497849">
+  <nd ref="2402376202"/>
+  <nd ref="2402376204"/>
+  <nd ref="2402376194"/>
+  <nd ref="2402376192"/>
+  <nd ref="2402376198"/>
+  <nd ref="2402376202"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="1"/>
+  <tag k="power" v="substation"/>
+  <tag k="roof:shape" v="flat"/>
+ </way>
+ <way id="404460944" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:17Z" user="pyram" uid="497849">
+  <nd ref="4067358932"/>
+  <nd ref="2402375659"/>
+  <nd ref="914906857"/>
+  <nd ref="914905992"/>
+  <nd ref="4067358924"/>
+  <nd ref="4067358932"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="2"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="404460946" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:17Z" user="pyram" uid="497849">
+  <nd ref="4067358890"/>
+  <nd ref="2402375994"/>
+  <nd ref="914906357"/>
+  <nd ref="914907139"/>
+  <nd ref="4067357883"/>
+  <nd ref="4067358890"/>
+  <tag k="building" v="yes"/>
+  <tag k="building:levels" v="2"/>
+  <tag k="roof:levels" v="1.5"/>
+  <tag k="roof:orientation" v="across"/>
+  <tag k="roof:shape" v="gabled"/>
+ </way>
+ <way id="404460960" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:18Z" user="pyram" uid="497849">
+  <nd ref="4067358936"/>
+  <nd ref="4067358941"/>
+  <nd ref="4067358945"/>
+  <nd ref="4067358940"/>
+  <nd ref="4067358943"/>
+  <nd ref="4067358928"/>
+  <nd ref="4067358925"/>
+  <nd ref="4067358934"/>
+  <nd ref="4067358936"/>
+  <tag k="building" v="yes"/>
+  <tag k="source" v="BayernDOP80"/>
+ </way>
+ <way id="404460964" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:18Z" user="pyram" uid="497849">
+  <nd ref="4067358894"/>
+  <nd ref="4067358922"/>
+  <nd ref="4067358942"/>
+  <tag k="highway" v="path"/>
+  <tag k="surface" v="paving_stones"/>
+ </way>
+ <way id="404460965" visible="true" version="1" changeset="37928213" timestamp="2016-03-18T21:16:18Z" user="pyram" uid="497849">
+  <nd ref="4067357875"/>
+  <nd ref="4067357880"/>
+  <nd ref="521209586"/>
+  <tag k="highway" v="service"/>
+  <tag k="service" v="parking_aisle"/>
+ </way>
+ <way id="201039165" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:20Z" user="pyram" uid="497849">
+  <nd ref="2109912969"/>
+  <nd ref="1747735470"/>
+  <nd ref="2109912982"/>
+  <nd ref="2109912936"/>
+  <nd ref="2109912923"/>
+  <nd ref="2109912969"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="201039159" visible="true" version="4" changeset="37928213" timestamp="2016-03-18T21:16:21Z" user="pyram" uid="497849">
+  <nd ref="2109912931"/>
+  <nd ref="1747735473"/>
+  <nd ref="2109912941"/>
+  <nd ref="2109912870"/>
+  <nd ref="2109912864"/>
+  <nd ref="2109912931"/>
+  <tag k="building" v="yes"/>
+ </way>
+ <way id="201039217" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:21Z" user="pyram" uid="497849">
+  <nd ref="4067357878"/>
+  <nd ref="2109912690"/>
+  <nd ref="2109912683"/>
+  <nd ref="4067357876"/>
+  <nd ref="4067357877"/>
+  <nd ref="4067357878"/>
+  <tag k="building" v="garages"/>
+  <tag k="building:levels" v="1"/>
+  <tag k="roof:shape" v="flat"/>
+ </way>
+ <way id="41124383" visible="true" version="2" changeset="37928213" timestamp="2016-03-18T21:16:25Z" user="pyram" uid="497849">
+  <nd ref="501844348"/>
+  <nd ref="501844347"/>
+  <nd ref="501844346"/>
+  <nd ref="501844345"/>
+  <nd ref="521209588"/>
+  <tag k="highway" v="path"/>
+  <tag k="surface" v="paving_stones"/>
+ </way>
+ <relation id="368583" visible="true" version="74" changeset="22364639" timestamp="2014-05-16T05:34:04Z" user="theophrastos" uid="96069">
+  <member type="relation" ref="284208" role=""/>
+  <member type="relation" ref="370754" role=""/>
+  <member type="relation" ref="54172" role=""/>
+  <member type="relation" ref="54188" role=""/>
+  <member type="relation" ref="178589" role=""/>
+  <member type="relation" ref="284230" role=""/>
+  <member type="relation" ref="284951" role=""/>
+  <member type="relation" ref="368684" role=""/>
+  <member type="relation" ref="368544" role=""/>
+  <member type="relation" ref="285099" role=""/>
+  <member type="relation" ref="179391" role=""/>
+  <member type="relation" ref="179411" role=""/>
+  <member type="relation" ref="30968" role=""/>
+  <member type="relation" ref="178641" role=""/>
+  <member type="relation" ref="178617" role=""/>
+  <member type="relation" ref="179426" role=""/>
+  <member type="relation" ref="286912" role=""/>
+  <member type="relation" ref="286930" role=""/>
+  <member type="relation" ref="287116" role=""/>
+  <member type="relation" ref="287117" role=""/>
+  <member type="relation" ref="287145" role=""/>
+  <member type="relation" ref="32259" role=""/>
+  <member type="relation" ref="287615" role=""/>
+  <member type="relation" ref="287776" role=""/>
+  <member type="relation" ref="287798" role=""/>
+  <member type="relation" ref="271522" role=""/>
+  <member type="relation" ref="59301" role=""/>
+  <member type="relation" ref="288538" role=""/>
+  <member type="relation" ref="368845" role=""/>
+  <member type="relation" ref="369675" role=""/>
+  <member type="relation" ref="148282" role=""/>
+  <member type="relation" ref="179387" role=""/>
+  <member type="relation" ref="58563" role=""/>
+  <member type="relation" ref="368519" role=""/>
+  <member type="relation" ref="58542" role=""/>
+  <member type="relation" ref="58537" role=""/>
+  <member type="relation" ref="356794" role=""/>
+  <member type="relation" ref="271512" role=""/>
+  <member type="relation" ref="133862" role=""/>
+  <member type="relation" ref="179404" role=""/>
+  <member type="relation" ref="222385" role=""/>
+  <member type="relation" ref="369733" role=""/>
+  <member type="relation" ref="135594" role=""/>
+  <member type="relation" ref="377682" role=""/>
+  <member type="relation" ref="116583" role=""/>
+  <member type="relation" ref="133886" role=""/>
+  <member type="relation" ref="358392" role=""/>
+  <member type="relation" ref="58543" role=""/>
+  <member type="relation" ref="369772" role=""/>
+  <member type="relation" ref="368680" role=""/>
+  <member type="relation" ref="179448" role=""/>
+  <member type="relation" ref="54170" role=""/>
+  <member type="relation" ref="370018" role=""/>
+  <member type="relation" ref="370029" role=""/>
+  <member type="relation" ref="370030" role=""/>
+  <member type="relation" ref="62110" role=""/>
+  <member type="relation" ref="370032" role=""/>
+  <member type="relation" ref="370052" role=""/>
+  <member type="relation" ref="370054" role=""/>
+  <member type="relation" ref="370056" role=""/>
+  <member type="relation" ref="370260" role=""/>
+  <member type="relation" ref="370285" role=""/>
+  <member type="relation" ref="179424" role=""/>
+  <member type="relation" ref="178623" role=""/>
+  <member type="relation" ref="274170" role=""/>
+  <member type="relation" ref="370306" role=""/>
+  <member type="relation" ref="370317" role=""/>
+  <member type="relation" ref="179374" role=""/>
+  <member type="relation" ref="370320" role=""/>
+  <member type="relation" ref="58540" role=""/>
+  <member type="relation" ref="365405" role=""/>
+  <member type="relation" ref="370334" role=""/>
+  <member type="relation" ref="370336" role=""/>
+  <member type="relation" ref="370338" role=""/>
+  <member type="relation" ref="133883" role=""/>
+  <member type="relation" ref="370752" role=""/>
+  <member type="way" ref="62020488" role=""/>
+  <tag k="is_in" v="Franken, Bayern, Deutschland, Europe"/>
+  <tag k="name" v="Staatstraßen in Mittelfranken"/>
+  <tag k="operator" v="Freistaat Bayern"/>
+  <tag k="type" v="network"/>
+ </relation>
+ <relation id="370746" visible="true" version="13" changeset="14951107" timestamp="2013-02-07T23:47:10Z" user="geodreieck4711" uid="479256">
+  <member type="relation" ref="370751" role=""/>
+  <member type="relation" ref="370745" role=""/>
+  <member type="relation" ref="61406" role=""/>
+  <member type="relation" ref="370287" role=""/>
+  <member type="relation" ref="370742" role=""/>
+  <member type="relation" ref="370744" role=""/>
+  <member type="relation" ref="370741" role=""/>
+  <member type="relation" ref="370743" role=""/>
+  <tag k="addr:city" v="Schwaig b.Nürnberg"/>
+  <tag k="by_night" v="no"/>
+  <tag k="description" v="Mögeldorf - Laufamholz - Schwaig Am Bahnhof - Max-Reger-Straße bzw. Behringersdorf"/>
+  <tag k="name" v="Stadtbus 40"/>
+  <tag k="on_demand" v="no"/>
+  <tag k="operator" v="VAG"/>
+  <tag k="ref" v="40"/>
+  <tag k="route_master" v="bus"/>
+  <tag k="type" v="route_master"/>
+  <tag k="website" v="http://www.vgn.de/komfortauskunft/ttb/?lineName=40&amp;exactMatch=1"/>
+ </relation>
+ <relation id="103550" visible="true" version="81" changeset="41578197" timestamp="2016-08-20T15:39:06Z" user="pyram" uid="497849">
+  <member type="node" ref="7431110" role="start"/>
+  <member type="way" ref="147118585" role="forward"/>
+  <member type="way" ref="223120636" role="forward"/>
+  <member type="way" ref="147118549" role="forward"/>
+  <member type="way" ref="32474797" role="forward"/>
+  <member type="way" ref="223120632" role="forward"/>
+  <member type="way" ref="223120633" role="forward"/>
+  <member type="way" ref="55700635" role="forward"/>
+  <member type="way" ref="47457425" role="forward"/>
+  <member type="way" ref="223120629" role="forward"/>
+  <member type="way" ref="318988515" role="forward"/>
+  <member type="way" ref="39964883" role="forward"/>
+  <member type="way" ref="39964884" role="forward"/>
+  <member type="way" ref="250919998" role="forward"/>
+  <member type="way" ref="39964880" role="forward"/>
+  <member type="way" ref="31982100" role="forward"/>
+  <member type="way" ref="39964886" role="forward"/>
+  <member type="way" ref="250920006" role="forward"/>
+  <member type="way" ref="12698833" role="forward"/>
+  <member type="way" ref="248948039" role="forward"/>
+  <member type="way" ref="248948043" role="forward"/>
+  <member type="way" ref="4054261" role="forward"/>
+  <member type="way" ref="70828311" role="forward"/>
+  <member type="way" ref="250920005" role="forward"/>
+  <member type="way" ref="218168225" role="forward"/>
+  <member type="way" ref="55465562" role="forward"/>
+  <member type="way" ref="139451823" role="forward"/>
+  <member type="way" ref="139451822" role="forward"/>
+  <member type="way" ref="250920001" role="forward"/>
+  <member type="way" ref="250920003" role="forward"/>
+  <member type="way" ref="250920007" role="forward"/>
+  <member type="way" ref="136510150" role="forward"/>
+  <member type="way" ref="250919996" role="forward"/>
+  <member type="way" ref="138994130" role="forward"/>
+  <member type="way" ref="138994132" role="forward"/>
+  <member type="way" ref="250920008" role="forward"/>
+  <member type="way" ref="250920010" role="forward"/>
+  <member type="way" ref="136510153" role="forward"/>
+  <member type="way" ref="71966299" role="forward"/>
+  <member type="way" ref="318988516" role="forward"/>
+  <member type="way" ref="138996180" role="forward"/>
+  <member type="way" ref="53378141" role="forward"/>
+  <member type="way" ref="138996181" role="forward"/>
+  <member type="way" ref="30439534" role="forward"/>
+  <member type="way" ref="250920014" role="forward"/>
+  <member type="way" ref="55188407" role="forward"/>
+  <member type="way" ref="250920011" role="forward"/>
+  <member type="way" ref="250920013" role="forward"/>
+  <member type="way" ref="250920015" role="forward"/>
+  <member type="way" ref="70829879" role="forward"/>
+  <member type="way" ref="250920016" role="forward"/>
+  <member type="way" ref="30702061" role="forward"/>
+  <member type="way" ref="30439535" role="forward"/>
+  <member type="way" ref="31106312" role="forward"/>
+  <member type="way" ref="250920012" role="forward"/>
+  <member type="way" ref="31107062" role="forward"/>
+  <member type="way" ref="250920009" role="forward"/>
+  <member type="way" ref="70882048" role="forward"/>
+  <member type="way" ref="136510155" role="forward"/>
+  <member type="way" ref="138236776" role="forward"/>
+  <member type="way" ref="31107064" role="forward"/>
+  <member type="way" ref="251116707" role="forward"/>
+  <member type="way" ref="251116698" role="forward"/>
+  <member type="way" ref="338697374" role="forward"/>
+  <member type="way" ref="338697375" role="forward"/>
+  <member type="way" ref="251116703" role="forward"/>
+  <member type="way" ref="251116702" role="forward"/>
+  <member type="way" ref="251117886" role="forward"/>
+  <member type="way" ref="251117876" role="forward"/>
+  <member type="way" ref="251117884" role="forward"/>
+  <member type="way" ref="251117879" role="forward"/>
+  <member type="way" ref="30169145" role="forward"/>
+  <member type="way" ref="30648090" role="forward"/>
+  <member type="way" ref="136351884" role="forward"/>
+  <member type="way" ref="69165922" role="forward"/>
+  <member type="way" ref="250935142" role="forward"/>
+  <member type="way" ref="32564874" role="forward"/>
+  <member type="way" ref="135934770" role="forward"/>
+  <member type="way" ref="250935151" role="forward"/>
+  <member type="way" ref="135934769" role="forward"/>
+  <member type="way" ref="250935155" role="forward"/>
+  <member type="way" ref="250935146" role="forward"/>
+  <member type="way" ref="435618758" role="forward"/>
+  <member type="way" ref="4437688" role="forward"/>
+  <member type="way" ref="250935148" role="forward"/>
+  <member type="way" ref="250935145" role="forward"/>
+  <member type="way" ref="250935150" role="forward"/>
+  <member type="way" ref="4443667" role="forward"/>
+  <member type="way" ref="72753575" role="forward"/>
+  <member type="way" ref="250936936" role="forward"/>
+  <member type="way" ref="250936935" role="forward"/>
+  <member type="way" ref="29319842" role="forward"/>
+  <member type="way" ref="138439158" role="forward"/>
+  <member type="way" ref="138366600" role="forward"/>
+  <member type="way" ref="250936933" role="forward"/>
+  <member type="way" ref="250936938" role="forward"/>
+  <member type="way" ref="32642819" role="forward"/>
+  <member type="way" ref="32642818" role="forward"/>
+  <member type="way" ref="29898687" role="forward"/>
+  <member type="way" ref="138366603" role="forward"/>
+  <member type="way" ref="138366606" role="forward"/>
+  <member type="way" ref="208574543" role="backward"/>
+  <member type="way" ref="47003634" role="backward"/>
+  <member type="way" ref="138915066" role="backward"/>
+  <member type="way" ref="138915067" role="forward"/>
+  <member type="way" ref="29320045" role="forward"/>
+  <member type="way" ref="49782557" role="forward"/>
+  <member type="way" ref="379326602" role="forward"/>
+  <member type="way" ref="59242848" role="forward"/>
+  <member type="way" ref="34248813" role="backward"/>
+  <member type="way" ref="33477197" role="backward"/>
+  <member type="way" ref="30320079" role="backward"/>
+  <member type="way" ref="30324350" role="backward"/>
+  <member type="way" ref="311214201" role="backward"/>
+  <member type="way" ref="138916744" role="backward"/>
+  <member type="way" ref="30320105" role="backward"/>
+  <member type="way" ref="311214195" role="backward"/>
+  <member type="way" ref="30324349" role="backward"/>
+  <member type="way" ref="130541737" role="backward"/>
+  <member type="way" ref="129994853" role="backward"/>
+  <member type="way" ref="129994854" role="backward"/>
+  <member type="way" ref="311214198" role="backward"/>
+  <member type="way" ref="311214194" role="backward"/>
+  <member type="way" ref="133332408" role="backward"/>
+  <member type="way" ref="45715476" role="backward"/>
+  <member type="way" ref="311214199" role="backward"/>
+  <member type="way" ref="311214200" role="backward"/>
+  <member type="way" ref="311214191" role="backward"/>
+  <member type="way" ref="311214197" role="backward"/>
+  <member type="way" ref="45739282" role="backward"/>
+  <member type="way" ref="45739281" role="backward"/>
+  <member type="way" ref="311214193" role="backward"/>
+  <member type="way" ref="311214192" role="backward"/>
+  <member type="way" ref="32029799" role="backward"/>
+  <member type="way" ref="46949806" role="backward"/>
+  <member type="way" ref="345711090" role="backward"/>
+  <member type="way" ref="311214196" role="backward"/>
+  <member type="way" ref="226336375" role="backward"/>
+  <member type="way" ref="72886683" role="backward"/>
+  <member type="way" ref="47625544" role="backward"/>
+  <member type="way" ref="44283629" role="backward"/>
+  <member type="way" ref="328876093" role="backward"/>
+  <member type="way" ref="328876092" role="backward"/>
+  <member type="way" ref="47625545" role="backward"/>
+  <member type="way" ref="32084588" role="backward"/>
+  <member type="way" ref="9418243" role="forward"/>
+  <member type="node" ref="71756130" role="end"/>
+  <tag k="detour" v="A 3"/>
+  <tag k="name" v="U 27 (A 3)"/>
+  <tag k="operator" v="Bayern"/>
+  <tag k="ref" v="U 27"/>
+  <tag k="route" v="detour"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="898587" visible="true" version="2" changeset="4741403" timestamp="2010-05-18T18:31:52Z" user="husky610" uid="281958">
+  <member type="relation" ref="898584" role="TMC:Segment"/>
+  <member type="relation" ref="898585" role="TMC:Segment"/>
+  <member type="node" ref="247101467" role="TMC:RoadEnd"/>
+  <tag k="ref" v="St 2241"/>
+  <tag k="route" v="road"/>
+  <tag k="TMC:cid_58:tabcd_1:Class" v="Road"/>
+  <tag k="TMC:cid_58:tabcd_1:LCLversion" v="9.00"/>
+  <tag k="TMC:cid_58:tabcd_1:LocationCode" v="50807"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="916313" visible="true" version="1" changeset="4714532" timestamp="2010-05-16T09:02:35Z" user="kellerma" uid="202858">
+  <member type="node" ref="419915096" role=""/>
+  <member type="node" ref="734779068" role=""/>
+  <member type="node" ref="419915093" role=""/>
+  <member type="node" ref="734788923" role=""/>
+  <tag k="name" v="Happurger Straße"/>
+  <tag k="operator" v="VAG"/>
+  <tag k="public_transport" v="stop_area"/>
+  <tag k="type" v="public_transport"/>
+ </relation>
+ <relation id="1935866" visible="true" version="2" changeset="26563807" timestamp="2014-11-05T05:16:53Z" user="theophrastos" uid="96069">
+  <member type="way" ref="143021336" role="from"/>
+  <member type="node" ref="1564949379" role="via"/>
+  <member type="way" ref="45739282" role="to"/>
+  <tag k="restriction" v="only_left_turn"/>
+  <tag k="type" v="restriction"/>
+ </relation>
+ <relation id="916303" visible="true" version="2" changeset="10227001" timestamp="2011-12-28T15:30:48Z" user="kellerma" uid="202858">
+  <member type="node" ref="359882432" role=""/>
+  <member type="node" ref="1565389238" role=""/>
+  <member type="node" ref="582582407" role=""/>
+  <member type="node" ref="734788926" role=""/>
+  <tag k="name" v="Grünreuther Straße"/>
+  <tag k="operator" v="VAG"/>
+  <tag k="public_transport" v="stop_area"/>
+  <tag k="type" v="public_transport"/>
+ </relation>
+ <relation id="370745" visible="true" version="28" changeset="35186901" timestamp="2015-11-09T09:14:24Z" user="FanTasMo" uid="78454">
+  <member type="way" ref="29320338" role=""/>
+  <member type="way" ref="15047256" role=""/>
+  <member type="way" ref="46949806" role=""/>
+  <member type="way" ref="10874018" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="143021335" role=""/>
+  <member type="way" ref="143021336" role=""/>
+  <member type="way" ref="45739282" role=""/>
+  <member type="way" ref="311214197" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="117475635" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="138916743" role=""/>
+  <member type="way" ref="31359583" role=""/>
+  <member type="way" ref="34148802" role=""/>
+  <member type="way" ref="138915064" role=""/>
+  <member type="way" ref="133377162" role=""/>
+  <member type="way" ref="138915068" role=""/>
+  <member type="way" ref="31359584" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="node" ref="734779060" role="stop"/>
+  <member type="way" ref="129992736" role="platform"/>
+  <member type="node" ref="734779061" role="stop"/>
+  <member type="way" ref="129992735" role="platform"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="734779066" role="stop"/>
+  <member type="node" ref="1565389238" role="stop"/>
+  <member type="node" ref="734779068" role="stop"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="734779067" role="stop"/>
+  <member type="way" ref="127411566" role="platform"/>
+  <member type="node" ref="734779046" role="stop"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="node" ref="225390488" role="platform"/>
+  <member type="node" ref="359882433" role="platform"/>
+  <member type="node" ref="359882432" role="platform"/>
+  <member type="node" ref="419915096" role="platform"/>
+  <member type="node" ref="581949244" role="platform"/>
+  <member type="node" ref="599200983" role="platform"/>
+  <member type="node" ref="390356060" role="platform"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <tag k="from" v="Nürnberg Henfenfelder Straße Wende"/>
+  <tag k="name" v="Stadtbus 40 Nürnberg Henfenfelder Straße Wende - Nürnberg Mögeldorf"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Nürnberg Mögeldorf"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="378270" visible="true" version="79" changeset="37839700" timestamp="2016-03-15T10:23:33Z" user="bastibay" uid="84839">
+  <member type="relation" ref="61954" role=""/>
+  <member type="relation" ref="378290" role=""/>
+  <member type="relation" ref="284951" role=""/>
+  <member type="relation" ref="76006" role=""/>
+  <member type="relation" ref="76033" role=""/>
+  <member type="relation" ref="75367" role=""/>
+  <member type="relation" ref="75597" role=""/>
+  <member type="relation" ref="76015" role=""/>
+  <member type="relation" ref="378297" role=""/>
+  <member type="relation" ref="378301" role=""/>
+  <member type="relation" ref="378302" role=""/>
+  <member type="relation" ref="378304" role=""/>
+  <member type="relation" ref="378308" role=""/>
+  <member type="relation" ref="378309" role=""/>
+  <member type="relation" ref="1944300" role=""/>
+  <member type="relation" ref="295065" role=""/>
+  <member type="relation" ref="378323" role=""/>
+  <member type="relation" ref="378388" role=""/>
+  <member type="relation" ref="378762" role=""/>
+  <member type="relation" ref="378777" role=""/>
+  <member type="relation" ref="378781" role=""/>
+  <member type="relation" ref="378791" role=""/>
+  <member type="relation" ref="378797" role=""/>
+  <member type="relation" ref="378800" role=""/>
+  <member type="relation" ref="295465" role=""/>
+  <member type="relation" ref="358397" role=""/>
+  <member type="relation" ref="172078" role=""/>
+  <member type="relation" ref="379522" role=""/>
+  <member type="relation" ref="379523" role=""/>
+  <member type="relation" ref="379524" role=""/>
+  <member type="relation" ref="172071" role=""/>
+  <member type="relation" ref="1952586" role=""/>
+  <member type="relation" ref="379525" role=""/>
+  <member type="relation" ref="358406" role=""/>
+  <member type="relation" ref="284896" role=""/>
+  <member type="relation" ref="379528" role=""/>
+  <member type="relation" ref="287615" role=""/>
+  <member type="relation" ref="59301" role=""/>
+  <member type="relation" ref="288538" role=""/>
+  <member type="relation" ref="368845" role=""/>
+  <member type="relation" ref="369675" role=""/>
+  <member type="relation" ref="148282" role=""/>
+  <member type="relation" ref="133862" role=""/>
+  <member type="relation" ref="358224" role=""/>
+  <member type="relation" ref="135594" role=""/>
+  <member type="relation" ref="377682" role=""/>
+  <member type="relation" ref="116583" role=""/>
+  <member type="relation" ref="295058" role=""/>
+  <member type="relation" ref="133886" role=""/>
+  <member type="relation" ref="358392" role=""/>
+  <member type="relation" ref="295048" role=""/>
+  <member type="relation" ref="295007" role=""/>
+  <member type="relation" ref="339277" role=""/>
+  <member type="relation" ref="358232" role=""/>
+  <member type="relation" ref="358231" role=""/>
+  <member type="relation" ref="60001" role=""/>
+  <member type="relation" ref="379547" role=""/>
+  <member type="relation" ref="379549" role=""/>
+  <member type="relation" ref="379552" role=""/>
+  <member type="relation" ref="379562" role=""/>
+  <member type="relation" ref="379569" role=""/>
+  <member type="relation" ref="379572" role=""/>
+  <member type="relation" ref="379578" role=""/>
+  <member type="relation" ref="379580" role=""/>
+  <member type="relation" ref="379583" role=""/>
+  <member type="relation" ref="379529" role=""/>
+  <member type="relation" ref="370338" role=""/>
+  <member type="relation" ref="379588" role=""/>
+  <member type="relation" ref="379591" role=""/>
+  <member type="relation" ref="295453" role=""/>
+  <member type="relation" ref="379596" role=""/>
+  <member type="relation" ref="295448" role=""/>
+  <member type="relation" ref="295443" role=""/>
+  <member type="relation" ref="2059369" role=""/>
+  <member type="way" ref="42723021" role=""/>
+  <member type="way" ref="196126382" role=""/>
+  <member type="way" ref="123177213" role=""/>
+  <member type="way" ref="38344607" role=""/>
+  <member type="way" ref="138955901" role=""/>
+  <member type="way" ref="44107208" role=""/>
+  <member type="way" ref="44107705" role=""/>
+  <member type="way" ref="138955904" role=""/>
+  <member type="way" ref="123177211" role=""/>
+  <member type="way" ref="123177209" role=""/>
+  <member type="way" ref="45424335" role=""/>
+  <member type="way" ref="123177215" role=""/>
+  <member type="way" ref="192890503" role=""/>
+  <member type="way" ref="61860169" role=""/>
+  <member type="way" ref="298468152" role=""/>
+  <member type="way" ref="75898815" role=""/>
+  <member type="way" ref="181090750" role=""/>
+  <member type="way" ref="75898819" role=""/>
+  <member type="way" ref="181090749" role=""/>
+  <member type="way" ref="75898775" role=""/>
+  <member type="way" ref="75898823" role=""/>
+  <member type="way" ref="75898834" role=""/>
+  <member type="way" ref="75898799" role=""/>
+  <member type="way" ref="75898810" role=""/>
+  <member type="way" ref="76565899" role=""/>
+  <member type="way" ref="379693204" role=""/>
+  <member type="way" ref="252127761" role=""/>
+  <member type="way" ref="76565900" role=""/>
+  <member type="way" ref="82254973" role=""/>
+  <member type="way" ref="192890504" role=""/>
+  <member type="way" ref="123180728" role=""/>
+  <member type="relation" ref="5503216" role=""/>
+  <member type="relation" ref="6053832" role=""/>
+  <tag k="name" v="Staatstraßen in Oberfranken"/>
+  <tag k="operator" v="Freistaat Bayern"/>
+  <tag k="type" v="network"/>
+ </relation>
+ <relation id="374399" visible="true" version="27" changeset="39407181" timestamp="2016-05-18T17:46:56Z" user="danidoedel" uid="3164012">
+  <member type="relation" ref="546540" role=""/>
+  <member type="relation" ref="374412" role=""/>
+  <tag k="by_night" v="only"/>
+  <tag k="colour" v="#006ca9"/>
+  <tag k="description" v="Nürnberg Hauptbahnhof - Mögeldorf - Schwaig - Rückersdorf - Lauf - Hersbruck"/>
+  <tag k="name" v="NightLiner N2: Nürnberg Hauptbahnhof &lt;=&gt; Hersbruck Bahnhof (links der Pegnitz)"/>
+  <tag k="network" v="VGN"/>
+  <tag k="opening_hours" v="Sa-Su 01:00-05:00"/>
+  <tag k="operator" v="VAG"/>
+  <tag k="public_transport" v="2"/>
+  <tag k="ref" v="N2"/>
+  <tag k="route_master" v="bus"/>
+  <tag k="service" v="night"/>
+  <tag k="type" v="route_master"/>
+  <tag k="website" v="http://www.vgn.de/komfortauskunft/ttb/?lineName=N2&amp;exactMatch=1"/>
+ </relation>
+ <relation id="370742" visible="true" version="58" changeset="39407181" timestamp="2016-05-18T17:47:59Z" user="danidoedel" uid="3164012">
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="143016727" role=""/>
+  <member type="way" ref="143054447" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="32029796" role=""/>
+  <member type="way" ref="24496856" role=""/>
+  <member type="way" ref="59239327" role=""/>
+  <member type="way" ref="29320338" role=""/>
+  <member type="way" ref="15047256" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="211518074" role=""/>
+  <member type="way" ref="204045963" role=""/>
+  <member type="way" ref="211518073" role=""/>
+  <member type="way" ref="251520594" role=""/>
+  <member type="way" ref="251520597" role=""/>
+  <member type="way" ref="251520595" role=""/>
+  <member type="way" ref="251520598" role=""/>
+  <member type="way" ref="61410708" role=""/>
+  <member type="way" ref="28033092" role=""/>
+  <member type="way" ref="50442035" role="forward"/>
+  <member type="way" ref="201846262" role="forward"/>
+  <member type="way" ref="121497445" role="forward"/>
+  <member type="way" ref="201846262" role="backward"/>
+  <member type="way" ref="50442035" role="backward"/>
+  <member type="way" ref="5115308" role=""/>
+  <member type="way" ref="162741249" role=""/>
+  <member type="way" ref="23238098" role=""/>
+  <member type="way" ref="28033088" role=""/>
+  <member type="way" ref="46986956" role=""/>
+  <member type="way" ref="24436449" role=""/>
+  <member type="way" ref="127411561" role="platform"/>
+  <member type="way" ref="129992736" role="platform"/>
+  <member type="node" ref="4193915974" role="platform"/>
+  <member type="way" ref="127215273" role="platform"/>
+  <member type="way" ref="129988884" role="platform"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="node" ref="734788925" role="stop"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="734788923" role="stop"/>
+  <member type="node" ref="734788926" role="stop"/>
+  <member type="node" ref="734788922" role="stop"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="734779060" role="stop"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="735530732" role="stop"/>
+  <member type="node" ref="735530690" role="stop"/>
+  <member type="node" ref="766753212" role="stop"/>
+  <member type="node" ref="599200984" role="platform"/>
+  <member type="node" ref="599183026" role="platform"/>
+  <member type="node" ref="419915093" role="platform"/>
+  <member type="node" ref="582582407" role="platform"/>
+  <member type="node" ref="1405404988" role="platform"/>
+  <member type="node" ref="599598209" role="platform"/>
+  <member type="node" ref="766753196" role="platform"/>
+  <member type="node" ref="599598242" role="platform"/>
+  <member type="node" ref="1437584706" role="stop"/>
+  <member type="node" ref="2990622546" role="stop"/>
+  <member type="node" ref="1507283333" role="platform"/>
+  <tag k="addr:city" v="Schwaig b.Nürnberg"/>
+  <tag k="from" v="Nürnberg Mögeldorf"/>
+  <tag k="name" v="Stadtbus 40 Nürnberg Mögeldorf - Schwaig Max-Reger-Straße"/>
+  <tag k="public_transport:version" v="2"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Schwaig Max-Reger-Straße"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="370744" visible="true" version="53" changeset="39407181" timestamp="2016-05-18T17:48:00Z" user="danidoedel" uid="3164012">
+  <member type="way" ref="46991738" role=""/>
+  <member type="way" ref="46986956" role=""/>
+  <member type="way" ref="46991735" role=""/>
+  <member type="way" ref="101335989" role=""/>
+  <member type="way" ref="46986957" role=""/>
+  <member type="way" ref="24498376" role=""/>
+  <member type="way" ref="147116024" role=""/>
+  <member type="way" ref="61410708" role=""/>
+  <member type="way" ref="251520598" role=""/>
+  <member type="way" ref="211518073" role=""/>
+  <member type="way" ref="251520594" role=""/>
+  <member type="way" ref="251520597" role=""/>
+  <member type="way" ref="251520595" role=""/>
+  <member type="way" ref="204045963" role=""/>
+  <member type="way" ref="211518074" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="46949806" role=""/>
+  <member type="way" ref="10874018" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="143021335" role=""/>
+  <member type="way" ref="143021336" role=""/>
+  <member type="way" ref="45739282" role=""/>
+  <member type="way" ref="311214197" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="138916743" role=""/>
+  <member type="way" ref="31359583" role=""/>
+  <member type="way" ref="34148802" role=""/>
+  <member type="way" ref="138915064" role=""/>
+  <member type="way" ref="133377162" role=""/>
+  <member type="way" ref="138915068" role=""/>
+  <member type="way" ref="31359584" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="node" ref="766753221" role="stop"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="734779066" role="stop"/>
+  <member type="node" ref="1565389238" role="stop"/>
+  <member type="node" ref="734779068" role="stop"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="734779067" role="stop"/>
+  <member type="way" ref="127411566" role="platform"/>
+  <member type="node" ref="734779046" role="stop"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="node" ref="599598242" role="platform"/>
+  <member type="node" ref="766753233" role="platform"/>
+  <member type="node" ref="735530695" role="stop"/>
+  <member type="way" ref="129988885" role="platform"/>
+  <member type="node" ref="1408631181" role="stop"/>
+  <member type="way" ref="127215276" role="platform"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="4193915975" role="platform"/>
+  <member type="node" ref="734779061" role="stop"/>
+  <member type="way" ref="129992735" role="platform"/>
+  <member type="node" ref="225390488" role="platform"/>
+  <member type="node" ref="359882433" role="platform"/>
+  <member type="node" ref="359882432" role="platform"/>
+  <member type="node" ref="419915096" role="platform"/>
+  <member type="node" ref="581949244" role="platform"/>
+  <member type="node" ref="599200983" role="platform"/>
+  <member type="node" ref="390356060" role="platform"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="node" ref="1437584706" role="stop"/>
+  <tag k="addr:city" v="Schwaig b.Nürnberg"/>
+  <tag k="from" v="Schwaig Max-Reger-Straße"/>
+  <tag k="name" v="Stadtbus 40 Schwaig Max-Reger-Straße - Nürnberg Mögeldorf"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Nürnberg Mögeldorf"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="370741" visible="true" version="60" changeset="39407181" timestamp="2016-05-18T17:47:58Z" user="danidoedel" uid="3164012">
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="143016727" role=""/>
+  <member type="way" ref="143054447" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="32029796" role=""/>
+  <member type="way" ref="24496856" role=""/>
+  <member type="way" ref="59239327" role=""/>
+  <member type="way" ref="29320338" role=""/>
+  <member type="way" ref="15047256" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="211518074" role=""/>
+  <member type="way" ref="204045963" role=""/>
+  <member type="way" ref="251520595" role=""/>
+  <member type="way" ref="251520597" role=""/>
+  <member type="way" ref="251520594" role=""/>
+  <member type="way" ref="211518073" role=""/>
+  <member type="way" ref="251520598" role=""/>
+  <member type="way" ref="61410708" role=""/>
+  <member type="way" ref="28033092" role=""/>
+  <member type="way" ref="5115308" role=""/>
+  <member type="way" ref="162741249" role=""/>
+  <member type="way" ref="23238098" role=""/>
+  <member type="way" ref="28033088" role=""/>
+  <member type="way" ref="46986956" role=""/>
+  <member type="way" ref="24436449" role=""/>
+  <member type="way" ref="46991738" role=""/>
+  <member type="way" ref="46986956" role=""/>
+  <member type="way" ref="28033088" role=""/>
+  <member type="way" ref="345233056" role=""/>
+  <member type="way" ref="38037346" role=""/>
+  <member type="way" ref="23240599" role=""/>
+  <member type="way" ref="59384644" role=""/>
+  <member type="way" ref="24342047" role=""/>
+  <member type="way" ref="24342049" role=""/>
+  <member type="way" ref="20879061" role=""/>
+  <member type="way" ref="24341996" role=""/>
+  <member type="way" ref="131893266" role=""/>
+  <member type="way" ref="34866978" role=""/>
+  <member type="way" ref="35764102" role=""/>
+  <member type="way" ref="14808844" role=""/>
+  <member type="way" ref="4047967" role=""/>
+  <member type="way" ref="339552602" role=""/>
+  <member type="way" ref="4047879" role=""/>
+  <member type="way" ref="37196036" role=""/>
+  <member type="way" ref="45263074" role=""/>
+  <member type="way" ref="34206284" role=""/>
+  <member type="way" ref="32029798" role=""/>
+  <member type="way" ref="32029797" role=""/>
+  <member type="way" ref="34206317" role=""/>
+  <member type="way" ref="34177301" role=""/>
+  <member type="way" ref="23196133" role=""/>
+  <member type="way" ref="27090589" role=""/>
+  <member type="way" ref="121497445" role="forward"/>
+  <member type="way" ref="201846262" role="backward"/>
+  <member type="way" ref="201846262" role="forward"/>
+  <member type="way" ref="50442035" role="backward"/>
+  <member type="way" ref="50442035" role="forward"/>
+  <member type="way" ref="127411561" role="platform"/>
+  <member type="way" ref="129992736" role="platform"/>
+  <member type="node" ref="4193915974" role="platform"/>
+  <member type="way" ref="127215273" role="platform"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="node" ref="734788925" role="stop"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="734788923" role="stop"/>
+  <member type="node" ref="734788926" role="stop"/>
+  <member type="node" ref="734788922" role="stop"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="734779060" role="stop"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="735530732" role="stop"/>
+  <member type="node" ref="735530690" role="stop"/>
+  <member type="node" ref="766753212" role="stop"/>
+  <member type="node" ref="766753221" role="stop"/>
+  <member type="node" ref="736140568" role="stop"/>
+  <member type="node" ref="734791663" role="stop"/>
+  <member type="node" ref="599200984" role="platform"/>
+  <member type="node" ref="599183026" role="platform"/>
+  <member type="node" ref="419915093" role="platform"/>
+  <member type="node" ref="582582407" role="platform"/>
+  <member type="node" ref="1405404988" role="platform"/>
+  <member type="node" ref="599598209" role="platform"/>
+  <member type="node" ref="766753196" role="platform"/>
+  <member type="node" ref="599598242" role="platform"/>
+  <member type="node" ref="766753233" role="platform"/>
+  <member type="node" ref="765382546" role="platform"/>
+  <member type="node" ref="599551314" role="platform"/>
+  <member type="node" ref="1437584706" role="stop"/>
+  <member type="node" ref="2990622546" role="stop"/>
+  <member type="node" ref="1507283333" role="platform"/>
+  <tag k="addr:city" v="Schwaig b.Nürnberg"/>
+  <tag k="from" v="Nürnberg Mögeldorf"/>
+  <tag k="name" v="Stadtbus 40 Nürnberg Mögeldorf - Behringersdorf Am Neubruch [über Schwaig Max-Reger-Straße]"/>
+  <tag k="public_transport:version" v="2"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Behringersdorf Am Neubruch"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="288538" visible="true" version="171" changeset="42668132" timestamp="2016-10-05T20:09:07Z" user="geodreieck4711" uid="479256">
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="129994855" role=""/>
+  <member type="way" ref="427684487" role=""/>
+  <member type="way" ref="117475635" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="138915067" role=""/>
+  <member type="way" ref="138915066" role=""/>
+  <member type="way" ref="47003634" role=""/>
+  <member type="way" ref="208574543" role=""/>
+  <member type="way" ref="139717125" role=""/>
+  <member type="way" ref="209759118" role=""/>
+  <member type="way" ref="138366604" role=""/>
+  <member type="way" ref="132379026" role=""/>
+  <member type="way" ref="138366602" role=""/>
+  <member type="way" ref="251301393" role=""/>
+  <member type="way" ref="29898623" role=""/>
+  <member type="way" ref="192749551" role=""/>
+  <member type="way" ref="255852511" role=""/>
+  <member type="way" ref="255852510" role=""/>
+  <member type="way" ref="4047784" role=""/>
+  <member type="way" ref="60712372" role=""/>
+  <member type="way" ref="45187465" role=""/>
+  <member type="way" ref="56155877" role=""/>
+  <member type="way" ref="138366606" role=""/>
+  <member type="way" ref="138366603" role=""/>
+  <member type="way" ref="29898687" role=""/>
+  <member type="way" ref="32642818" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="311214197" role=""/>
+  <member type="way" ref="45739282" role=""/>
+  <member type="way" ref="45739281" role=""/>
+  <member type="way" ref="311214193" role=""/>
+  <member type="way" ref="311214192" role=""/>
+  <member type="way" ref="32029799" role=""/>
+  <member type="way" ref="46949806" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="211518074" role=""/>
+  <member type="way" ref="204045963" role=""/>
+  <member type="way" ref="251520595" role=""/>
+  <member type="way" ref="251520597" role=""/>
+  <member type="way" ref="251520594" role=""/>
+  <member type="way" ref="211518073" role=""/>
+  <member type="way" ref="251520598" role=""/>
+  <member type="way" ref="61410708" role=""/>
+  <member type="way" ref="147116024" role=""/>
+  <member type="way" ref="24498376" role=""/>
+  <member type="way" ref="46986957" role=""/>
+  <member type="way" ref="101335986" role=""/>
+  <member type="way" ref="101335983" role=""/>
+  <member type="way" ref="127407922" role=""/>
+  <member type="way" ref="147082590" role=""/>
+  <member type="way" ref="101332854" role=""/>
+  <member type="way" ref="101332855" role=""/>
+  <member type="way" ref="101332856" role=""/>
+  <member type="way" ref="145117467" role=""/>
+  <member type="way" ref="144877105" role=""/>
+  <member type="way" ref="129985651" role=""/>
+  <member type="way" ref="144877089" role=""/>
+  <member type="way" ref="144877103" role=""/>
+  <member type="way" ref="36910617" role=""/>
+  <member type="way" ref="161853023" role=""/>
+  <member type="way" ref="60957233" role=""/>
+  <member type="way" ref="38330429" role=""/>
+  <member type="way" ref="38330428" role=""/>
+  <member type="way" ref="144877076" role=""/>
+  <member type="way" ref="47036779" role=""/>
+  <member type="way" ref="144877083" role=""/>
+  <member type="way" ref="144877100" role=""/>
+  <member type="way" ref="162043315" role=""/>
+  <member type="way" ref="162043314" role=""/>
+  <member type="way" ref="144868519" role=""/>
+  <member type="way" ref="23778315" role=""/>
+  <member type="way" ref="131623950" role=""/>
+  <member type="way" ref="131623946" role=""/>
+  <member type="way" ref="130552129" role=""/>
+  <member type="way" ref="130552130" role=""/>
+  <member type="way" ref="255837770" role=""/>
+  <member type="way" ref="59109768" role=""/>
+  <member type="way" ref="23144081" role=""/>
+  <member type="way" ref="23144082" role=""/>
+  <member type="way" ref="37606298" role=""/>
+  <member type="way" ref="208721857" role=""/>
+  <member type="way" ref="37606295" role=""/>
+  <member type="way" ref="127571309" role=""/>
+  <member type="way" ref="162856444" role=""/>
+  <member type="way" ref="97066331" role=""/>
+  <member type="way" ref="255841892" role=""/>
+  <member type="way" ref="255841893" role=""/>
+  <member type="way" ref="81634382" role=""/>
+  <member type="way" ref="93987898" role=""/>
+  <member type="way" ref="93987901" role=""/>
+  <member type="way" ref="58448722" role=""/>
+  <member type="way" ref="58448724" role=""/>
+  <member type="way" ref="47335133" role=""/>
+  <member type="way" ref="58262934" role=""/>
+  <member type="way" ref="162856448" role=""/>
+  <member type="way" ref="442933473" role=""/>
+  <member type="way" ref="38245222" role=""/>
+  <member type="way" ref="58262852" role=""/>
+  <member type="way" ref="58262853" role=""/>
+  <member type="way" ref="40398346" role=""/>
+  <member type="way" ref="58262851" role=""/>
+  <member type="way" ref="442933474" role=""/>
+  <member type="way" ref="120680980" role=""/>
+  <member type="way" ref="40398361" role=""/>
+  <member type="way" ref="162856453" role=""/>
+  <member type="way" ref="45344300" role=""/>
+  <member type="way" ref="45344303" role=""/>
+  <member type="way" ref="96131946" role=""/>
+  <member type="way" ref="42434949" role=""/>
+  <member type="way" ref="45342601" role=""/>
+  <member type="way" ref="96131944" role=""/>
+  <member type="way" ref="58363999" role=""/>
+  <member type="way" ref="58364001" role=""/>
+  <member type="way" ref="62177275" role=""/>
+  <member type="way" ref="162856450" role=""/>
+  <member type="way" ref="46601874" role=""/>
+  <member type="way" ref="46601873" role=""/>
+  <member type="way" ref="390059264" role=""/>
+  <member type="way" ref="150409793" role=""/>
+  <member type="way" ref="314979915" role=""/>
+  <member type="way" ref="42434950" role=""/>
+  <member type="way" ref="162856457" role=""/>
+  <member type="way" ref="141146453" role=""/>
+  <member type="way" ref="162856449" role=""/>
+  <member type="way" ref="141146452" role=""/>
+  <member type="way" ref="141193386" role=""/>
+  <member type="way" ref="141193387" role=""/>
+  <member type="way" ref="6269563" role=""/>
+  <member type="way" ref="25605665" role=""/>
+  <member type="way" ref="162856429" role=""/>
+  <member type="way" ref="32395230" role=""/>
+  <member type="way" ref="445995647" role=""/>
+  <member type="way" ref="28228129" role=""/>
+  <member type="way" ref="25633023" role=""/>
+  <member type="way" ref="25633022" role=""/>
+  <member type="way" ref="25605663" role=""/>
+  <member type="way" ref="28228123" role=""/>
+  <member type="way" ref="41669249" role=""/>
+  <member type="way" ref="25605664" role=""/>
+  <member type="way" ref="445815946" role=""/>
+  <member type="way" ref="445815945" role=""/>
+  <member type="way" ref="8067796" role=""/>
+  <member type="way" ref="141697607" role=""/>
+  <member type="way" ref="63171986" role=""/>
+  <member type="way" ref="54263672" role=""/>
+  <member type="way" ref="64122146" role=""/>
+  <member type="way" ref="54263671" role=""/>
+  <member type="way" ref="34294060" role=""/>
+  <member type="way" ref="141864472" role=""/>
+  <member type="way" ref="66435862" role=""/>
+  <member type="way" ref="64243148" role=""/>
+  <member type="way" ref="64241236" role=""/>
+  <member type="way" ref="64241235" role=""/>
+  <member type="way" ref="141727870" role=""/>
+  <member type="way" ref="141727869" role=""/>
+  <member type="way" ref="28231941" role=""/>
+  <member type="way" ref="141864474" role=""/>
+  <member type="way" ref="32394831" role=""/>
+  <member type="way" ref="141727871" role=""/>
+  <member type="way" ref="445799837" role=""/>
+  <member type="way" ref="141864473" role=""/>
+  <member type="way" ref="146195003" role=""/>
+  <member type="way" ref="204389942" role=""/>
+  <member type="way" ref="204389941" role=""/>
+  <member type="way" ref="378335109" role=""/>
+  <member type="way" ref="36741295" role=""/>
+  <tag k="description" v="Staatsstraße St 2241: B 4R Nürnberg - Lauf a.d.Pegnitz - Schnaittach - Hiltpoltstein B 2"/>
+  <tag k="ref" v="St 2241"/>
+  <tag k="route" v="road"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="370287" visible="true" version="61" changeset="42804614" timestamp="2016-10-11T14:21:27Z" user="mappedit" uid="46855">
+  <member type="way" ref="59243017" role=""/>
+  <member type="way" ref="161123736" role=""/>
+  <member type="way" ref="23196133" role=""/>
+  <member type="way" ref="34177301" role=""/>
+  <member type="way" ref="34206317" role=""/>
+  <member type="way" ref="32029797" role=""/>
+  <member type="way" ref="32029798" role=""/>
+  <member type="way" ref="34206284" role=""/>
+  <member type="way" ref="45263074" role=""/>
+  <member type="way" ref="37196036" role=""/>
+  <member type="way" ref="4047879" role=""/>
+  <member type="way" ref="339552602" role=""/>
+  <member type="way" ref="4047967" role=""/>
+  <member type="way" ref="14808844" role=""/>
+  <member type="way" ref="35764102" role=""/>
+  <member type="way" ref="34866978" role=""/>
+  <member type="way" ref="131893266" role=""/>
+  <member type="way" ref="24341996" role=""/>
+  <member type="way" ref="20879061" role=""/>
+  <member type="way" ref="24342049" role=""/>
+  <member type="way" ref="24342047" role=""/>
+  <member type="way" ref="24342054" role=""/>
+  <member type="way" ref="37196738" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="46949806" role=""/>
+  <member type="way" ref="10874018" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="143021335" role=""/>
+  <member type="way" ref="143021336" role=""/>
+  <member type="way" ref="45739282" role=""/>
+  <member type="way" ref="311214197" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="117475635" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="138916743" role=""/>
+  <member type="way" ref="31359583" role=""/>
+  <member type="way" ref="34148802" role=""/>
+  <member type="way" ref="138915064" role=""/>
+  <member type="way" ref="133377162" role=""/>
+  <member type="way" ref="138915068" role=""/>
+  <member type="way" ref="31359584" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="node" ref="734791663" role="stop"/>
+  <member type="node" ref="736140568" role="stop"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="734779066" role="stop"/>
+  <member type="node" ref="1565389238" role="stop"/>
+  <member type="node" ref="734779068" role="stop"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="734779067" role="stop"/>
+  <member type="way" ref="127411566" role="platform"/>
+  <member type="node" ref="734779046" role="stop"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="node" ref="599551314" role="platform"/>
+  <member type="node" ref="359424703" role="platform"/>
+  <member type="node" ref="766753189" role="platform"/>
+  <member type="node" ref="735530695" role="stop"/>
+  <member type="way" ref="129988885" role="platform"/>
+  <member type="node" ref="1408631181" role="stop"/>
+  <member type="way" ref="127215276" role="platform"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="4193915975" role="platform"/>
+  <member type="node" ref="734779061" role="stop"/>
+  <member type="way" ref="129992735" role="platform"/>
+  <member type="node" ref="225390488" role="platform"/>
+  <member type="node" ref="359882433" role="platform"/>
+  <member type="node" ref="359882432" role="platform"/>
+  <member type="node" ref="419915096" role="platform"/>
+  <member type="node" ref="581949244" role="platform"/>
+  <member type="node" ref="599200983" role="platform"/>
+  <member type="node" ref="390356060" role="platform"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="node" ref="1437584701" role="stop"/>
+  <tag k="from" v="Behringersdorf Am Neubruch"/>
+  <tag k="name" v="Stadtbus 40 Behringersdorf Am Neubruch - Nürnberg Mögeldorf"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Nürnberg Mögeldorf"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="374412" visible="true" version="162" changeset="42124117" timestamp="2016-09-13T12:18:29Z" user="Weltstaat" uid="3080626">
+  <member type="node" ref="4193915972" role="stop"/>
+  <member type="node" ref="4193915971" role="platform"/>
+  <member type="node" ref="250059182" role="stop"/>
+  <member type="node" ref="364409800" role="platform"/>
+  <member type="node" ref="1437446658" role="stop"/>
+  <member type="node" ref="4193915981" role="stop"/>
+  <member type="node" ref="735530748" role="stop"/>
+  <member type="node" ref="364525648" role="platform"/>
+  <member type="node" ref="735608749" role="stop"/>
+  <member type="node" ref="279595795" role="platform"/>
+  <member type="node" ref="735608743" role="stop"/>
+  <member type="node" ref="364648600" role="platform"/>
+  <member type="node" ref="2609738897" role="stop"/>
+  <member type="node" ref="1437479275" role="platform"/>
+  <member type="node" ref="1437499128" role="stop"/>
+  <member type="node" ref="4193915976" role="stop"/>
+  <member type="node" ref="1369106321" role="stop"/>
+  <member type="node" ref="1437514803" role="platform"/>
+  <member type="node" ref="1388336291" role="stop"/>
+  <member type="node" ref="2188928083" role="stop"/>
+  <member type="way" ref="127678833" role="platform"/>
+  <member type="node" ref="1412644253" role="stop"/>
+  <member type="way" ref="127683424" role="platform"/>
+  <member type="node" ref="501803635" role="stop"/>
+  <member type="way" ref="127683802" role="platform"/>
+  <member type="node" ref="1434839509" role="stop"/>
+  <member type="node" ref="4193915983" role="platform"/>
+  <member type="node" ref="265692532" role="stop"/>
+  <member type="way" ref="24446436" role="platform"/>
+  <member type="node" ref="1437431069" role="stop"/>
+  <member type="node" ref="4193915978" role="platform"/>
+  <member type="node" ref="1437431070" role="stop"/>
+  <member type="way" ref="130539891" role="platform"/>
+  <member type="node" ref="1448301283" role="stop"/>
+  <member type="node" ref="1448301285" role="platform"/>
+  <member type="node" ref="1437584701" role="stop"/>
+  <member type="node" ref="766753189" role="platform"/>
+  <member type="node" ref="735530695" role="stop"/>
+  <member type="way" ref="129988885" role="platform"/>
+  <member type="node" ref="1408631181" role="stop"/>
+  <member type="way" ref="127215276" role="platform"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="4193915975" role="platform"/>
+  <member type="node" ref="734779061" role="stop"/>
+  <member type="way" ref="129992735" role="platform"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="225390488" role="platform"/>
+  <member type="node" ref="734779066" role="stop"/>
+  <member type="node" ref="359882433" role="platform"/>
+  <member type="node" ref="1565389238" role="stop"/>
+  <member type="node" ref="359882432" role="platform"/>
+  <member type="node" ref="734779068" role="stop"/>
+  <member type="node" ref="419915096" role="platform"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="581949244" role="platform"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="599200983" role="platform"/>
+  <member type="node" ref="734779067" role="stop"/>
+  <member type="way" ref="127411566" role="platform"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="way" ref="442187925" role="platform"/>
+  <member type="node" ref="1471798350" role="stop"/>
+  <member type="node" ref="1410336185" role="stop"/>
+  <member type="way" ref="442180394" role="platform"/>
+  <member type="node" ref="2215474873" role="stop"/>
+  <member type="way" ref="442178599" role="platform"/>
+  <member type="node" ref="1410344856" role="stop"/>
+  <member type="way" ref="442177441" role="platform"/>
+  <member type="node" ref="4193915984" role="stop"/>
+  <member type="way" ref="442176066" role="platform"/>
+  <member type="node" ref="1580718852" role="stop"/>
+  <member type="node" ref="4193915973" role="platform"/>
+  <member type="node" ref="1410370191" role="stop"/>
+  <member type="way" ref="433292863" role="platform"/>
+  <member type="way" ref="127678826" role="platform"/>
+  <member type="way" ref="30086053" role=""/>
+  <member type="way" ref="143017894" role=""/>
+  <member type="way" ref="31988211" role=""/>
+  <member type="way" ref="38963384" role=""/>
+  <member type="way" ref="38717594" role=""/>
+  <member type="way" ref="39932410" role=""/>
+  <member type="way" ref="39932407" role=""/>
+  <member type="way" ref="39932408" role=""/>
+  <member type="way" ref="39932409" role=""/>
+  <member type="way" ref="43960880" role=""/>
+  <member type="way" ref="31978895" role=""/>
+  <member type="way" ref="31978894" role=""/>
+  <member type="way" ref="46670617" role=""/>
+  <member type="way" ref="32393327" role=""/>
+  <member type="way" ref="44384086" role=""/>
+  <member type="way" ref="44384085" role=""/>
+  <member type="way" ref="204099709" role=""/>
+  <member type="way" ref="44023044" role=""/>
+  <member type="way" ref="145821361" role=""/>
+  <member type="way" ref="30077558" role=""/>
+  <member type="way" ref="47205117" role=""/>
+  <member type="way" ref="47521526" role=""/>
+  <member type="way" ref="145821368" role=""/>
+  <member type="way" ref="38740693" role=""/>
+  <member type="way" ref="38740694" role=""/>
+  <member type="way" ref="32427196" role=""/>
+  <member type="way" ref="100867504" role=""/>
+  <member type="way" ref="100867512" role=""/>
+  <member type="way" ref="254556200" role=""/>
+  <member type="way" ref="42927819" role=""/>
+  <member type="way" ref="37081897" role=""/>
+  <member type="way" ref="56158206" role=""/>
+  <member type="way" ref="39267793" role=""/>
+  <member type="way" ref="354580456" role=""/>
+  <member type="way" ref="142172699" role=""/>
+  <member type="way" ref="354580457" role=""/>
+  <member type="way" ref="175037997" role=""/>
+  <member type="way" ref="35693769" role=""/>
+  <member type="way" ref="255265876" role=""/>
+  <member type="way" ref="79483683" role=""/>
+  <member type="way" ref="254654079" role=""/>
+  <member type="way" ref="255265878" role=""/>
+  <member type="way" ref="255157605" role=""/>
+  <member type="way" ref="255157606" role=""/>
+  <member type="way" ref="255157607" role=""/>
+  <member type="way" ref="66862351" role=""/>
+  <member type="way" ref="354578417" role=""/>
+  <member type="way" ref="175037995" role=""/>
+  <member type="way" ref="175037986" role=""/>
+  <member type="way" ref="254654078" role=""/>
+  <member type="way" ref="255156536" role=""/>
+  <member type="way" ref="205902856" role=""/>
+  <member type="way" ref="42435018" role=""/>
+  <member type="way" ref="255156535" role=""/>
+  <member type="way" ref="255156534" role=""/>
+  <member type="way" ref="205902854" role=""/>
+  <member type="way" ref="141426137" role=""/>
+  <member type="way" ref="255156533" role=""/>
+  <member type="way" ref="141427023" role=""/>
+  <member type="way" ref="205902862" role=""/>
+  <member type="way" ref="99521721" role=""/>
+  <member type="way" ref="99521727" role=""/>
+  <member type="way" ref="100057741" role=""/>
+  <member type="way" ref="100057743" role=""/>
+  <member type="way" ref="23251119" role=""/>
+  <member type="way" ref="23251106" role=""/>
+  <member type="way" ref="132902252" role=""/>
+  <member type="way" ref="261421423" role=""/>
+  <member type="way" ref="205902848" role=""/>
+  <member type="way" ref="254654077" role=""/>
+  <member type="way" ref="175037996" role=""/>
+  <member type="way" ref="44017933" role=""/>
+  <member type="way" ref="44017934" role=""/>
+  <member type="way" ref="38509758" role=""/>
+  <member type="way" ref="45185303" role=""/>
+  <member type="way" ref="45185203" role=""/>
+  <member type="way" ref="162582309" role=""/>
+  <member type="way" ref="138950436" role=""/>
+  <member type="way" ref="255129254" role=""/>
+  <member type="way" ref="60712373" role=""/>
+  <member type="way" ref="255129255" role=""/>
+  <member type="way" ref="255129250" role=""/>
+  <member type="way" ref="60712368" role=""/>
+  <member type="way" ref="192749547" role=""/>
+  <member type="way" ref="192749540" role=""/>
+  <member type="way" ref="78470976" role=""/>
+  <member type="way" ref="45185204" role=""/>
+  <member type="way" ref="45185205" role=""/>
+  <member type="way" ref="196292737" role=""/>
+  <member type="way" ref="205902846" role=""/>
+  <member type="way" ref="49523445" role=""/>
+  <member type="way" ref="196295113" role=""/>
+  <member type="way" ref="255120213" role=""/>
+  <member type="way" ref="127681088" role=""/>
+  <member type="way" ref="124857073" role=""/>
+  <member type="way" ref="122546248" role=""/>
+  <member type="way" ref="122546246" role=""/>
+  <member type="way" ref="255117536" role=""/>
+  <member type="way" ref="255117539" role=""/>
+  <member type="way" ref="124859493" role=""/>
+  <member type="way" ref="255117543" role=""/>
+  <member type="way" ref="23777967" role=""/>
+  <member type="way" ref="40451232" role=""/>
+  <member type="way" ref="208303408" role=""/>
+  <member type="way" ref="255109856" role=""/>
+  <member type="way" ref="37407947" role=""/>
+  <member type="way" ref="255114801" role=""/>
+  <member type="way" ref="255114800" role=""/>
+  <member type="way" ref="205615798" role=""/>
+  <member type="way" ref="60845273" role=""/>
+  <member type="way" ref="60962199" role=""/>
+  <member type="way" ref="4047890" role=""/>
+  <member type="way" ref="35581322" role=""/>
+  <member type="way" ref="53860650" role=""/>
+  <member type="way" ref="255114799" role=""/>
+  <member type="way" ref="62209551" role=""/>
+  <member type="way" ref="258296056" role=""/>
+  <member type="way" ref="37606294" role=""/>
+  <member type="way" ref="205640318" role=""/>
+  <member type="way" ref="258296058" role=""/>
+  <member type="way" ref="42477377" role=""/>
+  <member type="way" ref="258307769" role=""/>
+  <member type="way" ref="46872904" role=""/>
+  <member type="way" ref="37407946" role=""/>
+  <member type="way" ref="92670591" role=""/>
+  <member type="way" ref="4047884" role=""/>
+  <member type="way" ref="4047787" role=""/>
+  <member type="way" ref="275621176" role=""/>
+  <member type="way" ref="275621177" role=""/>
+  <member type="way" ref="47335140" role=""/>
+  <member type="way" ref="275621172" role=""/>
+  <member type="way" ref="122959059" role=""/>
+  <member type="way" ref="122504050" role=""/>
+  <member type="way" ref="275621174" role=""/>
+  <member type="way" ref="122504058" role=""/>
+  <member type="way" ref="122959060" role=""/>
+  <member type="way" ref="122504055" role=""/>
+  <member type="way" ref="258313567" role=""/>
+  <member type="way" ref="258313571" role=""/>
+  <member type="way" ref="258313565" role=""/>
+  <member type="way" ref="258313573" role=""/>
+  <member type="way" ref="260750431" role=""/>
+  <member type="way" ref="260750432" role=""/>
+  <member type="way" ref="57378549" role=""/>
+  <member type="way" ref="57378553" role=""/>
+  <member type="way" ref="150641209" role=""/>
+  <member type="way" ref="108947080" role=""/>
+  <member type="way" ref="108846141" role=""/>
+  <member type="way" ref="4047783" role=""/>
+  <member type="way" ref="5006981" role=""/>
+  <member type="way" ref="4048008" role=""/>
+  <member type="way" ref="14808844" role=""/>
+  <member type="way" ref="35764102" role=""/>
+  <member type="way" ref="34866978" role=""/>
+  <member type="way" ref="131893266" role=""/>
+  <member type="way" ref="24341996" role=""/>
+  <member type="way" ref="20879061" role=""/>
+  <member type="way" ref="24342049" role=""/>
+  <member type="way" ref="24342047" role=""/>
+  <member type="way" ref="24342054" role=""/>
+  <member type="way" ref="37196738" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="46949806" role=""/>
+  <member type="way" ref="10874018" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="143021335" role=""/>
+  <member type="way" ref="143021336" role=""/>
+  <member type="way" ref="45739282" role=""/>
+  <member type="way" ref="311214197" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="138915067" role=""/>
+  <member type="way" ref="138915066" role=""/>
+  <member type="way" ref="47003634" role=""/>
+  <member type="way" ref="208574543" role=""/>
+  <member type="way" ref="139717125" role=""/>
+  <member type="way" ref="209759118" role=""/>
+  <member type="way" ref="138366604" role=""/>
+  <member type="way" ref="132379026" role=""/>
+  <member type="way" ref="138366602" role=""/>
+  <member type="way" ref="251301393" role=""/>
+  <member type="way" ref="29898623" role=""/>
+  <member type="way" ref="138390398" role=""/>
+  <member type="way" ref="181012678" role=""/>
+  <member type="way" ref="181012677" role=""/>
+  <member type="way" ref="134822172" role=""/>
+  <member type="way" ref="134822179" role=""/>
+  <member type="way" ref="250939869" role=""/>
+  <member type="way" ref="134822170" role=""/>
+  <member type="way" ref="250939870" role=""/>
+  <member type="way" ref="134822174" role=""/>
+  <member type="way" ref="164056093" role=""/>
+  <member type="way" ref="250939872" role=""/>
+  <member type="way" ref="138578062" role=""/>
+  <member type="way" ref="186758821" role=""/>
+  <member type="way" ref="250939865" role=""/>
+  <member type="way" ref="250939867" role=""/>
+  <member type="way" ref="188250867" role=""/>
+  <member type="way" ref="188250868" role=""/>
+  <member type="way" ref="142958709" role=""/>
+  <member type="way" ref="142958704" role=""/>
+  <member type="way" ref="60712378" role=""/>
+  <member type="way" ref="232785758" role=""/>
+  <member type="way" ref="193477890" role=""/>
+  <member type="way" ref="193477892" role=""/>
+  <member type="way" ref="140505649" role=""/>
+  <member type="way" ref="78480720" role=""/>
+  <member type="way" ref="78480721" role=""/>
+  <member type="way" ref="78480722" role=""/>
+  <member type="way" ref="140505651" role=""/>
+  <member type="way" ref="250745810" role=""/>
+  <member type="way" ref="30581979" role=""/>
+  <member type="way" ref="31992107" role=""/>
+  <tag k="colour" v="#006ca9"/>
+  <tag k="from" v="Hersbruck Bahnhof (links der Pegnitz)"/>
+  <tag k="name" v="NightLiner N2: Hersbruck Bahnhof (links der Pegnitz) =&gt; Nürnberg Hauptbahnhof"/>
+  <tag k="network" v="VGN"/>
+  <tag k="public_transport:version" v="2"/>
+  <tag k="ref" v="N2"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Nürnberg Hauptbahnhof"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="357463" visible="true" version="3" changeset="26563807" timestamp="2014-11-05T05:16:53Z" user="theophrastos" uid="96069">
+  <member type="way" ref="143021337" role="from"/>
+  <member type="node" ref="305537489" role="via"/>
+  <member type="way" ref="311214193" role="to"/>
+  <tag k="restriction" v="only_right_turn"/>
+  <tag k="type" v="restriction"/>
+ </relation>
+ <relation id="105758" visible="true" version="57" changeset="41611802" timestamp="2016-08-22T11:02:12Z" user="Bim62" uid="3712492">
+  <member type="node" ref="5890934" role="start"/>
+  <member type="way" ref="5026228" role="forward"/>
+  <member type="way" ref="5026229" role="forward"/>
+  <member type="way" ref="226336381" role="forward"/>
+  <member type="way" ref="5026230" role="forward"/>
+  <member type="way" ref="44285606" role="forward"/>
+  <member type="way" ref="144657134" role="forward"/>
+  <member type="way" ref="27472848" role="forward"/>
+  <member type="way" ref="47688588" role="forward"/>
+  <member type="way" ref="44283629" role="forward"/>
+  <member type="way" ref="47625544" role="forward"/>
+  <member type="way" ref="72886683" role="forward"/>
+  <member type="way" ref="226336375" role="forward"/>
+  <member type="way" ref="311214196" role="forward"/>
+  <member type="way" ref="345711090" role="forward"/>
+  <member type="way" ref="46949806" role="forward"/>
+  <member type="way" ref="32029799" role="forward"/>
+  <member type="way" ref="311214192" role="forward"/>
+  <member type="way" ref="311214193" role="forward"/>
+  <member type="way" ref="45739281" role="forward"/>
+  <member type="way" ref="45739282" role="forward"/>
+  <member type="way" ref="311214197" role="forward"/>
+  <member type="way" ref="45715476" role="forward"/>
+  <member type="way" ref="311214199" role="forward"/>
+  <member type="way" ref="311214200" role="forward"/>
+  <member type="way" ref="311214191" role="forward"/>
+  <member type="way" ref="133332408" role="forward"/>
+  <member type="way" ref="311214194" role="forward"/>
+  <member type="way" ref="129994854" role="forward"/>
+  <member type="way" ref="311214198" role="forward"/>
+  <member type="way" ref="129994853" role="forward"/>
+  <member type="way" ref="130541737" role="forward"/>
+  <member type="way" ref="30324349" role="forward"/>
+  <member type="way" ref="311214195" role="forward"/>
+  <member type="way" ref="30320105" role="forward"/>
+  <member type="way" ref="138916744" role="forward"/>
+  <member type="way" ref="311214201" role="forward"/>
+  <member type="way" ref="30324350" role="forward"/>
+  <member type="way" ref="30320079" role="forward"/>
+  <member type="way" ref="33477197" role="forward"/>
+  <member type="way" ref="34248813" role="forward"/>
+  <member type="way" ref="59242848" role="backward"/>
+  <member type="way" ref="379326602" role="backward"/>
+  <member type="way" ref="49782557" role="backward"/>
+  <member type="way" ref="29320045" role="backward"/>
+  <member type="way" ref="138915067" role="backward"/>
+  <member type="way" ref="138915066" role="forward"/>
+  <member type="way" ref="47003634" role="forward"/>
+  <member type="way" ref="208574543" role="forward"/>
+  <member type="way" ref="139717125" role="forward"/>
+  <member type="way" ref="209759118" role="forward"/>
+  <member type="way" ref="138366604" role="forward"/>
+  <member type="way" ref="132379026" role="forward"/>
+  <member type="way" ref="138366602" role="forward"/>
+  <member type="way" ref="251301393" role="forward"/>
+  <member type="way" ref="226336370" role="forward"/>
+  <member type="way" ref="69726034" role="forward"/>
+  <member type="way" ref="250936931" role="forward"/>
+  <member type="way" ref="138320807" role="forward"/>
+  <member type="way" ref="29406504" role="forward"/>
+  <member type="way" ref="250936934" role="forward"/>
+  <member type="way" ref="83894902" role="forward"/>
+  <member type="way" ref="250936937" role="forward"/>
+  <member type="way" ref="4437689" role="forward"/>
+  <member type="way" ref="32642826" role="forward"/>
+  <member type="way" ref="435618747" role="forward"/>
+  <member type="way" ref="250935153" role="forward"/>
+  <member type="way" ref="135934768" role="forward"/>
+  <member type="way" ref="250935154" role="forward"/>
+  <member type="way" ref="250935147" role="forward"/>
+  <member type="way" ref="250935152" role="forward"/>
+  <member type="way" ref="29406688" role="forward"/>
+  <member type="way" ref="250935144" role="forward"/>
+  <member type="way" ref="250935149" role="forward"/>
+  <member type="way" ref="4443371" role="forward"/>
+  <member type="way" ref="32564872" role="forward"/>
+  <member type="way" ref="250935141" role="forward"/>
+  <member type="way" ref="250935143" role="forward"/>
+  <member type="way" ref="10770410" role=""/>
+  <member type="way" ref="136351893" role=""/>
+  <member type="way" ref="251117880" role=""/>
+  <member type="way" ref="251117877" role=""/>
+  <member type="way" ref="251116701" role=""/>
+  <member type="way" ref="251116704" role=""/>
+  <member type="way" ref="251116699" role=""/>
+  <member type="way" ref="251116708" role=""/>
+  <member type="way" ref="251116700" role=""/>
+  <member type="way" ref="251116706" role=""/>
+  <member type="way" ref="251116705" role=""/>
+  <member type="way" ref="47313948" role=""/>
+  <member type="way" ref="250915122" role=""/>
+  <member type="way" ref="70419645" role=""/>
+  <member type="way" ref="250915126" role=""/>
+  <member type="way" ref="250915125" role=""/>
+  <member type="way" ref="438394129" role=""/>
+  <member type="way" ref="31916949" role=""/>
+  <member type="way" ref="31106313" role=""/>
+  <member type="way" ref="30045822" role=""/>
+  <member type="way" ref="250915123" role=""/>
+  <member type="way" ref="250915127" role=""/>
+  <member type="way" ref="250915116" role=""/>
+  <member type="way" ref="250915117" role=""/>
+  <member type="way" ref="41912377" role=""/>
+  <member type="way" ref="250915119" role=""/>
+  <member type="way" ref="250915121" role=""/>
+  <member type="way" ref="136510154" role=""/>
+  <member type="way" ref="138996182" role=""/>
+  <member type="way" ref="71966220" role=""/>
+  <member type="way" ref="71966257" role=""/>
+  <member type="way" ref="250915124" role=""/>
+  <member type="way" ref="250915118" role=""/>
+  <member type="way" ref="250915120" role=""/>
+  <member type="way" ref="250915128" role=""/>
+  <member type="way" ref="139451824" role=""/>
+  <member type="way" ref="139451828" role=""/>
+  <member type="way" ref="250915113" role=""/>
+  <member type="way" ref="250915112" role=""/>
+  <member type="way" ref="136510149" role=""/>
+  <member type="way" ref="250915111" role=""/>
+  <member type="way" ref="139451825" role=""/>
+  <member type="way" ref="139451829" role=""/>
+  <member type="way" ref="218168226" role=""/>
+  <member type="way" ref="250915115" role=""/>
+  <member type="way" ref="41933224" role=""/>
+  <member type="way" ref="218168227" role=""/>
+  <member type="way" ref="4047232" role=""/>
+  <member type="way" ref="248948046" role=""/>
+  <member type="way" ref="378515131" role=""/>
+  <member type="way" ref="50434125" role=""/>
+  <member type="way" ref="250915114" role=""/>
+  <member type="way" ref="143140693" role=""/>
+  <member type="way" ref="39964881" role=""/>
+  <member type="way" ref="39964882" role=""/>
+  <member type="way" ref="223120634" role=""/>
+  <member type="way" ref="47458143" role=""/>
+  <member type="way" ref="41934618" role=""/>
+  <member type="way" ref="223120631" role=""/>
+  <member type="way" ref="223120630" role=""/>
+  <member type="way" ref="5064781" role=""/>
+  <member type="way" ref="150456622" role=""/>
+  <member type="way" ref="35407566" role=""/>
+  <member type="way" ref="32493525" role=""/>
+  <member type="way" ref="47328659" role=""/>
+  <member type="way" ref="223120619" role=""/>
+  <member type="way" ref="223120626" role=""/>
+  <member type="node" ref="24669316" role="end"/>
+  <tag k="detour" v="A 3"/>
+  <tag k="name" v="U 72 (A 3)"/>
+  <tag k="operator" v="Bayern"/>
+  <tag k="ref" v="U 72"/>
+  <tag k="route" v="detour"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="898584" visible="true" version="56" changeset="41833989" timestamp="2016-08-31T19:32:16Z" user="BernhardBraun" uid="2277877">
+  <member type="way" ref="32642818" role="forward"/>
+  <member type="way" ref="29898687" role="forward"/>
+  <member type="way" ref="138366602" role="backward"/>
+  <member type="way" ref="251301393" role="backward"/>
+  <member type="way" ref="29898623" role="backward"/>
+  <member type="way" ref="138366604" role=""/>
+  <member type="way" ref="132379026" role=""/>
+  <member type="way" ref="139717125" role=""/>
+  <member type="way" ref="209759118" role=""/>
+  <member type="way" ref="138366606" role=""/>
+  <member type="way" ref="138366603" role=""/>
+  <member type="way" ref="47003634" role=""/>
+  <member type="way" ref="208574543" role=""/>
+  <member type="way" ref="138915066" role=""/>
+  <member type="way" ref="138915067" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="117475635" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="45739282" role=""/>
+  <member type="way" ref="311214197" role=""/>
+  <member type="way" ref="45739281" role=""/>
+  <member type="way" ref="311214193" role=""/>
+  <member type="way" ref="311214192" role=""/>
+  <member type="way" ref="32029799" role=""/>
+  <member type="way" ref="46949806" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="211518074" role=""/>
+  <member type="way" ref="204045963" role=""/>
+  <member type="way" ref="211518073" role=""/>
+  <member type="way" ref="251520594" role=""/>
+  <member type="way" ref="251520597" role=""/>
+  <member type="way" ref="251520595" role=""/>
+  <member type="way" ref="251520598" role=""/>
+  <member type="way" ref="61410708" role=""/>
+  <member type="way" ref="147116024" role=""/>
+  <member type="way" ref="24498376" role=""/>
+  <member type="way" ref="46986957" role=""/>
+  <member type="way" ref="101335986" role=""/>
+  <member type="way" ref="101335983" role=""/>
+  <member type="way" ref="127407922" role=""/>
+  <member type="way" ref="147082590" role=""/>
+  <member type="way" ref="101332854" role=""/>
+  <member type="way" ref="101332855" role=""/>
+  <member type="way" ref="101332856" role=""/>
+  <member type="way" ref="145117467" role=""/>
+  <member type="way" ref="144877105" role=""/>
+  <member type="way" ref="144877089" role=""/>
+  <member type="way" ref="129985651" role=""/>
+  <member type="way" ref="144877103" role=""/>
+  <member type="way" ref="36910617" role=""/>
+  <member type="way" ref="161853023" role=""/>
+  <member type="way" ref="60957233" role=""/>
+  <member type="way" ref="38330429" role=""/>
+  <member type="way" ref="38330428" role=""/>
+  <member type="way" ref="144877076" role=""/>
+  <member type="way" ref="47036779" role=""/>
+  <member type="way" ref="144877083" role=""/>
+  <member type="way" ref="144877100" role=""/>
+  <member type="way" ref="144868519" role=""/>
+  <member type="way" ref="162043314" role=""/>
+  <member type="way" ref="162043315" role=""/>
+  <member type="way" ref="23778315" role=""/>
+  <member type="way" ref="131623950" role=""/>
+  <member type="way" ref="131623946" role=""/>
+  <member type="way" ref="130552129" role=""/>
+  <member type="way" ref="130552130" role=""/>
+  <member type="way" ref="255837770" role=""/>
+  <member type="way" ref="59109768" role=""/>
+  <member type="way" ref="23144081" role=""/>
+  <member type="way" ref="23144082" role=""/>
+  <member type="way" ref="37606298" role=""/>
+  <member type="way" ref="208721857" role=""/>
+  <member type="way" ref="37606295" role=""/>
+  <member type="way" ref="127571309" role=""/>
+  <member type="way" ref="227964131" role=""/>
+  <member type="way" ref="60927986" role=""/>
+  <member type="way" ref="23778313" role=""/>
+  <member type="way" ref="45260224" role=""/>
+  <member type="way" ref="32067598" role=""/>
+  <member type="way" ref="206125734" role=""/>
+  <member type="way" ref="206125735" role=""/>
+  <member type="way" ref="42497422" role=""/>
+  <member type="way" ref="161950624" role=""/>
+  <member type="way" ref="60834373" role=""/>
+  <member type="way" ref="440081193" role=""/>
+  <member type="way" ref="23740021" role=""/>
+  <member type="way" ref="45162719" role=""/>
+  <member type="way" ref="45162718" role=""/>
+  <member type="way" ref="23159479" role=""/>
+  <member type="way" ref="37407951" role=""/>
+  <member type="way" ref="45833911" role=""/>
+  <member type="way" ref="33870507" role=""/>
+  <member type="way" ref="23260829" role=""/>
+  <member type="way" ref="255032767" role=""/>
+  <tag k="ref" v="St 2241"/>
+  <tag k="TMC:cid_58:tabcd_1:Class" v="Segment"/>
+  <tag k="TMC:cid_58:tabcd_1:Direction" v="both"/>
+  <tag k="TMC:cid_58:tabcd_1:LCLversion" v="9.00"/>
+  <tag k="TMC:cid_58:tabcd_1:LocationCode" v="9512"/>
+  <tag k="TMC:cid_58:tabcd_1:NextLocationCode" v="31596"/>
+  <tag k="type" v="TMC"/>
+ </relation>
+ <relation id="1519495" visible="true" version="5" changeset="40638531" timestamp="2016-07-10T21:10:56Z" user="pyram" uid="497849">
+  <member type="way" ref="15051245" role="inner"/>
+  <member type="way" ref="355309880" role="inner"/>
+  <member type="way" ref="122704363" role="outer"/>
+  <member type="way" ref="81344882" role="inner"/>
+  <member type="way" ref="430242619" role="inner"/>
+  <tag k="landuse" v="forest"/>
+  <tag k="source" v="yahoo"/>
+  <tag k="type" v="multipolygon"/>
+ </relation>
+ <relation id="61406" visible="true" version="91" changeset="39407181" timestamp="2016-05-18T17:47:59Z" user="danidoedel" uid="3164012">
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="143016727" role=""/>
+  <member type="way" ref="143054447" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="32029796" role=""/>
+  <member type="way" ref="24496856" role=""/>
+  <member type="way" ref="59239327" role=""/>
+  <member type="way" ref="29320338" role=""/>
+  <member type="way" ref="15047256" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="37196738" role=""/>
+  <member type="way" ref="24342054" role=""/>
+  <member type="way" ref="24342047" role=""/>
+  <member type="way" ref="24342049" role=""/>
+  <member type="way" ref="20879061" role=""/>
+  <member type="way" ref="24341996" role=""/>
+  <member type="way" ref="131893266" role=""/>
+  <member type="way" ref="34866978" role=""/>
+  <member type="way" ref="35764102" role=""/>
+  <member type="way" ref="14808844" role=""/>
+  <member type="way" ref="4047967" role=""/>
+  <member type="way" ref="339552602" role=""/>
+  <member type="way" ref="4047879" role=""/>
+  <member type="way" ref="37196036" role=""/>
+  <member type="way" ref="45263074" role=""/>
+  <member type="way" ref="34206284" role=""/>
+  <member type="way" ref="32029798" role=""/>
+  <member type="way" ref="32029797" role=""/>
+  <member type="way" ref="34206317" role=""/>
+  <member type="way" ref="34177301" role=""/>
+  <member type="way" ref="23196133" role=""/>
+  <member type="way" ref="27090589" role=""/>
+  <member type="way" ref="127411561" role="platform"/>
+  <member type="node" ref="4193915974" role="platform"/>
+  <member type="way" ref="127215273" role="platform"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="way" ref="129992736" role="platform"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="node" ref="734788925" role="stop"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="734788923" role="stop"/>
+  <member type="node" ref="734788926" role="stop"/>
+  <member type="node" ref="734788922" role="stop"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="735530732" role="stop"/>
+  <member type="node" ref="735530690" role="stop"/>
+  <member type="way" ref="129988884" role="platform"/>
+  <member type="node" ref="736140568" role="stop"/>
+  <member type="node" ref="734791663" role="stop"/>
+  <member type="node" ref="599200984" role="platform"/>
+  <member type="node" ref="599183026" role="platform"/>
+  <member type="node" ref="419915093" role="platform"/>
+  <member type="node" ref="582582407" role="platform"/>
+  <member type="node" ref="1405404988" role="platform"/>
+  <member type="node" ref="599598209" role="platform"/>
+  <member type="node" ref="734779060" role="stop"/>
+  <member type="node" ref="765382546" role="platform"/>
+  <member type="node" ref="599551314" role="platform"/>
+  <tag k="from" v="Nürnberg Mögeldorf"/>
+  <tag k="name" v="Stadtbus 40 Nürnberg Mögeldorf - Behringersdorf Am Neubruch"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Behringersdorf Am Neubruch"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="370743" visible="true" version="62" changeset="39407181" timestamp="2016-05-18T17:47:56Z" user="danidoedel" uid="3164012">
+  <member type="way" ref="59243017" role=""/>
+  <member type="way" ref="161123736" role=""/>
+  <member type="way" ref="23196133" role=""/>
+  <member type="way" ref="34177301" role=""/>
+  <member type="way" ref="34206317" role=""/>
+  <member type="way" ref="32029797" role=""/>
+  <member type="way" ref="32029798" role=""/>
+  <member type="way" ref="34206284" role=""/>
+  <member type="way" ref="45263074" role=""/>
+  <member type="way" ref="37196036" role=""/>
+  <member type="way" ref="4047879" role=""/>
+  <member type="way" ref="339552602" role=""/>
+  <member type="way" ref="4047967" role=""/>
+  <member type="way" ref="14808844" role=""/>
+  <member type="way" ref="35764102" role=""/>
+  <member type="way" ref="34866978" role=""/>
+  <member type="way" ref="131893266" role=""/>
+  <member type="way" ref="24341996" role=""/>
+  <member type="way" ref="20879061" role=""/>
+  <member type="way" ref="24342049" role=""/>
+  <member type="way" ref="24342047" role=""/>
+  <member type="way" ref="24342054" role=""/>
+  <member type="way" ref="37196738" role=""/>
+  <member type="way" ref="211518074" role=""/>
+  <member type="way" ref="204045963" role=""/>
+  <member type="way" ref="211518073" role=""/>
+  <member type="way" ref="251520594" role=""/>
+  <member type="way" ref="251520597" role=""/>
+  <member type="way" ref="251520595" role=""/>
+  <member type="way" ref="251520598" role=""/>
+  <member type="way" ref="61410708" role=""/>
+  <member type="way" ref="28033092" role=""/>
+  <member type="way" ref="5115308" role=""/>
+  <member type="way" ref="162741249" role=""/>
+  <member type="way" ref="23238098" role=""/>
+  <member type="way" ref="28033088" role=""/>
+  <member type="way" ref="46986956" role=""/>
+  <member type="way" ref="24436449" role=""/>
+  <member type="way" ref="46991738" role=""/>
+  <member type="way" ref="46986956" role=""/>
+  <member type="way" ref="46991735" role=""/>
+  <member type="way" ref="101335989" role=""/>
+  <member type="way" ref="46986957" role=""/>
+  <member type="way" ref="24498376" role=""/>
+  <member type="way" ref="147116024" role=""/>
+  <member type="way" ref="61410708" role=""/>
+  <member type="way" ref="251520598" role=""/>
+  <member type="way" ref="211518073" role=""/>
+  <member type="way" ref="251520594" role=""/>
+  <member type="way" ref="251520597" role=""/>
+  <member type="way" ref="251520595" role=""/>
+  <member type="way" ref="204045963" role=""/>
+  <member type="way" ref="211518074" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="46949806" role=""/>
+  <member type="way" ref="10874018" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="143021335" role=""/>
+  <member type="way" ref="143021336" role=""/>
+  <member type="way" ref="45739282" role=""/>
+  <member type="way" ref="311214197" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="129994854" role=""/>
+  <member type="way" ref="311214198" role=""/>
+  <member type="way" ref="129994853" role=""/>
+  <member type="way" ref="117475635" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="138916743" role=""/>
+  <member type="way" ref="31359583" role=""/>
+  <member type="way" ref="34148802" role=""/>
+  <member type="way" ref="138915064" role=""/>
+  <member type="way" ref="133377162" role=""/>
+  <member type="way" ref="138915068" role=""/>
+  <member type="way" ref="31359584" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="node" ref="734791663" role="stop"/>
+  <member type="node" ref="736140568" role="stop"/>
+  <member type="node" ref="766753212" role="stop"/>
+  <member type="node" ref="766753221" role="stop"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="734779066" role="stop"/>
+  <member type="node" ref="1565389238" role="stop"/>
+  <member type="node" ref="734779068" role="stop"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="734779067" role="stop"/>
+  <member type="way" ref="127411566" role="platform"/>
+  <member type="node" ref="734779046" role="stop"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="node" ref="599551314" role="platform"/>
+  <member type="node" ref="359424703" role="platform"/>
+  <member type="node" ref="735530695" role="stop"/>
+  <member type="node" ref="766753189" role="platform"/>
+  <member type="node" ref="766753196" role="platform"/>
+  <member type="node" ref="599598242" role="platform"/>
+  <member type="node" ref="766753233" role="platform"/>
+  <member type="way" ref="129988885" role="platform"/>
+  <member type="node" ref="1408631181" role="stop"/>
+  <member type="way" ref="127215276" role="platform"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="4193915975" role="platform"/>
+  <member type="node" ref="734779061" role="stop"/>
+  <member type="way" ref="129992735" role="platform"/>
+  <member type="node" ref="225390488" role="platform"/>
+  <member type="node" ref="359882433" role="platform"/>
+  <member type="node" ref="359882432" role="platform"/>
+  <member type="node" ref="419915096" role="platform"/>
+  <member type="node" ref="581949244" role="platform"/>
+  <member type="node" ref="599200983" role="platform"/>
+  <member type="node" ref="390356060" role="platform"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="node" ref="1437584706" role="stop"/>
+  <member type="node" ref="1437584701" role="stop"/>
+  <tag k="addr:city" v="Schwaig b.Nürnberg"/>
+  <tag k="from" v="Behringersdorf Am Neubruch"/>
+  <tag k="name" v="Stadtbus 40 Behringersdorf Am Neubruch - Nürnberg Mögeldorf [über Schwaig Max-Reger-Straße]"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Nürnberg Mögeldorf"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="546540" visible="true" version="166" changeset="42438071" timestamp="2016-09-26T07:30:46Z" user="geodreieck4711" uid="479256">
+  <member type="way" ref="433292863" role="platform"/>
+  <member type="node" ref="1410370189" role="stop"/>
+  <member type="node" ref="848765751" role="stop"/>
+  <member type="node" ref="848765779" role="platform"/>
+  <member type="node" ref="1410358677" role="stop"/>
+  <member type="way" ref="442173804" role="platform"/>
+  <member type="node" ref="1519568523" role="stop"/>
+  <member type="way" ref="442177443" role="platform"/>
+  <member type="node" ref="2215474870" role="stop"/>
+  <member type="way" ref="442178596" role="platform"/>
+  <member type="node" ref="1410336184" role="stop"/>
+  <member type="node" ref="1471798349" role="stop"/>
+  <member type="way" ref="442184917" role="platform"/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="node" ref="734788925" role="stop"/>
+  <member type="way" ref="127411561" role="platform"/>
+  <member type="node" ref="1433123312" role="stop"/>
+  <member type="node" ref="599200984" role="platform"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="599183026" role="platform"/>
+  <member type="node" ref="734788923" role="stop"/>
+  <member type="node" ref="419915093" role="platform"/>
+  <member type="node" ref="734788926" role="stop"/>
+  <member type="node" ref="582582407" role="platform"/>
+  <member type="node" ref="734788922" role="stop"/>
+  <member type="node" ref="1405404988" role="platform"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="599598209" role="platform"/>
+  <member type="node" ref="734779060" role="stop"/>
+  <member type="way" ref="129992736" role="platform"/>
+  <member type="node" ref="734788924" role="stop"/>
+  <member type="node" ref="4193915974" role="platform"/>
+  <member type="node" ref="735530732" role="stop"/>
+  <member type="way" ref="127215273" role="platform"/>
+  <member type="node" ref="735530690" role="stop"/>
+  <member type="way" ref="129988884" role="platform"/>
+  <member type="node" ref="1437584693" role="stop"/>
+  <member type="node" ref="1448301283" role="stop"/>
+  <member type="node" ref="1448301282" role="platform"/>
+  <member type="node" ref="4418550712" role="stop"/>
+  <member type="node" ref="4418550711" role="platform"/>
+  <member type="node" ref="1437414362" role="stop"/>
+  <member type="node" ref="4193915979" role="platform"/>
+  <member type="node" ref="735530740" role="stop"/>
+  <member type="way" ref="130182722" role="platform"/>
+  <member type="node" ref="1434839509" role="stop"/>
+  <member type="node" ref="4193915982" role="platform"/>
+  <member type="node" ref="437049680" role="stop"/>
+  <member type="way" ref="127683800" role="platform"/>
+  <member type="node" ref="1412644252" role="stop"/>
+  <member type="way" ref="127683425" role="platform"/>
+  <member type="node" ref="763153994" role="stop"/>
+  <member type="way" ref="127678832" role="platform"/>
+  <member type="node" ref="732622018" role="stop"/>
+  <member type="way" ref="127678825" role="platform"/>
+  <member type="node" ref="1437499128" role="platform"/>
+  <member type="node" ref="4193915976" role="stop"/>
+  <member type="node" ref="2609738896" role="stop"/>
+  <member type="node" ref="1437479273" role="platform"/>
+  <member type="node" ref="735530702" role="stop"/>
+  <member type="node" ref="364412596" role="platform"/>
+  <member type="node" ref="735530748" role="stop"/>
+  <member type="node" ref="364411726" role="platform"/>
+  <member type="node" ref="4193915980" role="stop"/>
+  <member type="node" ref="2603550451" role="platform"/>
+  <member type="node" ref="2603550328" role="stop"/>
+  <member type="node" ref="605012945" role="platform"/>
+  <member type="node" ref="4193915972" role="stop"/>
+  <member type="node" ref="4193915971" role="platform"/>
+  <member type="way" ref="79262142" role=""/>
+  <member type="way" ref="137011591" role=""/>
+  <member type="way" ref="137013054" role=""/>
+  <member type="way" ref="31057775" role=""/>
+  <member type="way" ref="136307006" role=""/>
+  <member type="way" ref="250745813" role=""/>
+  <member type="way" ref="228076956" role=""/>
+  <member type="way" ref="376470380" role=""/>
+  <member type="way" ref="142958707" role=""/>
+  <member type="way" ref="233634785" role=""/>
+  <member type="way" ref="442170173" role=""/>
+  <member type="way" ref="60712371" role=""/>
+  <member type="way" ref="233634786" role=""/>
+  <member type="way" ref="142958703" role=""/>
+  <member type="way" ref="47338646" role=""/>
+  <member type="way" ref="138584141" role=""/>
+  <member type="way" ref="47338647" role=""/>
+  <member type="way" ref="250939866" role=""/>
+  <member type="way" ref="168354365" role=""/>
+  <member type="way" ref="250939864" role=""/>
+  <member type="way" ref="250939868" role=""/>
+  <member type="way" ref="138578064" role=""/>
+  <member type="way" ref="164056094" role=""/>
+  <member type="way" ref="134822168" role=""/>
+  <member type="way" ref="134822181" role=""/>
+  <member type="way" ref="134822166" role=""/>
+  <member type="way" ref="138390397" role=""/>
+  <member type="way" ref="250939871" role=""/>
+  <member type="way" ref="32642818" role=""/>
+  <member type="way" ref="29898687" role=""/>
+  <member type="way" ref="138366603" role=""/>
+  <member type="way" ref="138366606" role=""/>
+  <member type="way" ref="208574543" role=""/>
+  <member type="way" ref="47003634" role=""/>
+  <member type="way" ref="138915066" role=""/>
+  <member type="way" ref="138915067" role=""/>
+  <member type="way" ref="29320045" role=""/>
+  <member type="way" ref="49782557" role=""/>
+  <member type="way" ref="379326602" role=""/>
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="117475635" role=""/>
+  <member type="way" ref="129994855" role=""/>
+  <member type="way" ref="427684487" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="143016727" role=""/>
+  <member type="way" ref="143054447" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="32029796" role=""/>
+  <member type="way" ref="24496856" role=""/>
+  <member type="way" ref="59239327" role=""/>
+  <member type="way" ref="29320338" role=""/>
+  <member type="way" ref="15047256" role=""/>
+  <member type="way" ref="345711090" role=""/>
+  <member type="way" ref="311214196" role=""/>
+  <member type="way" ref="226336375" role=""/>
+  <member type="way" ref="72886683" role=""/>
+  <member type="way" ref="47625544" role=""/>
+  <member type="way" ref="44283629" role=""/>
+  <member type="way" ref="47688588" role=""/>
+  <member type="way" ref="27472848" role=""/>
+  <member type="way" ref="144657134" role=""/>
+  <member type="way" ref="44285606" role=""/>
+  <member type="way" ref="47625602" role=""/>
+  <member type="way" ref="127407914" role=""/>
+  <member type="way" ref="45704462" role=""/>
+  <member type="way" ref="144657136" role=""/>
+  <member type="way" ref="127215277" role=""/>
+  <member type="way" ref="251520593" role=""/>
+  <member type="way" ref="24502088" role=""/>
+  <member type="way" ref="37196738" role=""/>
+  <member type="way" ref="24342054" role=""/>
+  <member type="way" ref="24342047" role=""/>
+  <member type="way" ref="24342049" role=""/>
+  <member type="way" ref="20879061" role=""/>
+  <member type="way" ref="24341996" role=""/>
+  <member type="way" ref="131893266" role=""/>
+  <member type="way" ref="34866978" role=""/>
+  <member type="way" ref="35764102" role=""/>
+  <member type="way" ref="14808844" role=""/>
+  <member type="way" ref="4048008" role=""/>
+  <member type="way" ref="5006981" role=""/>
+  <member type="way" ref="4047783" role=""/>
+  <member type="way" ref="108846141" role=""/>
+  <member type="way" ref="108947080" role=""/>
+  <member type="way" ref="150641209" role=""/>
+  <member type="way" ref="57378553" role=""/>
+  <member type="way" ref="57378549" role=""/>
+  <member type="way" ref="260750432" role=""/>
+  <member type="way" ref="260750431" role=""/>
+  <member type="way" ref="258313573" role=""/>
+  <member type="way" ref="258313565" role=""/>
+  <member type="way" ref="258313571" role=""/>
+  <member type="way" ref="258313567" role=""/>
+  <member type="way" ref="122504055" role=""/>
+  <member type="way" ref="122959060" role=""/>
+  <member type="way" ref="122504058" role=""/>
+  <member type="way" ref="275621174" role=""/>
+  <member type="way" ref="122504050" role=""/>
+  <member type="way" ref="122959059" role=""/>
+  <member type="way" ref="275621172" role=""/>
+  <member type="way" ref="4047882" role=""/>
+  <member type="way" ref="24365141" role=""/>
+  <member type="way" ref="23267364" role=""/>
+  <member type="way" ref="23267363" role=""/>
+  <member type="way" ref="52824487" role=""/>
+  <member type="way" ref="4047884" role=""/>
+  <member type="way" ref="92670591" role=""/>
+  <member type="way" ref="37407946" role=""/>
+  <member type="way" ref="46872904" role=""/>
+  <member type="way" ref="258307769" role=""/>
+  <member type="way" ref="42477377" role=""/>
+  <member type="way" ref="258296058" role=""/>
+  <member type="way" ref="205640318" role=""/>
+  <member type="way" ref="258296057" role=""/>
+  <member type="way" ref="258296056" role=""/>
+  <member type="way" ref="62209551" role=""/>
+  <member type="way" ref="255114799" role=""/>
+  <member type="way" ref="53860650" role=""/>
+  <member type="way" ref="35581322" role=""/>
+  <member type="way" ref="4047890" role=""/>
+  <member type="way" ref="60962199" role=""/>
+  <member type="way" ref="60845273" role=""/>
+  <member type="way" ref="205615798" role=""/>
+  <member type="way" ref="255114800" role=""/>
+  <member type="way" ref="255114801" role=""/>
+  <member type="way" ref="37407947" role=""/>
+  <member type="way" ref="255109856" role=""/>
+  <member type="way" ref="208303408" role=""/>
+  <member type="way" ref="40451232" role=""/>
+  <member type="way" ref="23777967" role=""/>
+  <member type="way" ref="255117543" role=""/>
+  <member type="way" ref="124859493" role=""/>
+  <member type="way" ref="127681089" role=""/>
+  <member type="way" ref="255117534" role=""/>
+  <member type="way" ref="385235781" role=""/>
+  <member type="way" ref="385235780" role=""/>
+  <member type="way" ref="385235779" role=""/>
+  <member type="way" ref="40451233" role=""/>
+  <member type="way" ref="122546249" role=""/>
+  <member type="way" ref="35694121" role=""/>
+  <member type="way" ref="122546247" role=""/>
+  <member type="way" ref="385235778" role=""/>
+  <member type="way" ref="385235777" role=""/>
+  <member type="way" ref="124857074" role=""/>
+  <member type="way" ref="255120212" role=""/>
+  <member type="way" ref="141691911" role=""/>
+  <member type="way" ref="141691912" role=""/>
+  <member type="way" ref="45182926" role=""/>
+  <member type="way" ref="255120211" role=""/>
+  <member type="way" ref="23187292" role=""/>
+  <member type="way" ref="23187293" role=""/>
+  <member type="way" ref="255129252" role=""/>
+  <member type="way" ref="78448690" role=""/>
+  <member type="way" ref="192749542" role=""/>
+  <member type="way" ref="192749541" role=""/>
+  <member type="way" ref="138950435" role=""/>
+  <member type="way" ref="255129251" role=""/>
+  <member type="way" ref="60712376" role=""/>
+  <member type="way" ref="138950437" role=""/>
+  <member type="way" ref="255129258" role=""/>
+  <member type="way" ref="45185303" role=""/>
+  <member type="way" ref="38509758" role=""/>
+  <member type="way" ref="44017934" role=""/>
+  <member type="way" ref="44017933" role=""/>
+  <member type="way" ref="175037996" role=""/>
+  <member type="way" ref="254654077" role=""/>
+  <member type="way" ref="205902848" role=""/>
+  <member type="way" ref="261421423" role=""/>
+  <member type="way" ref="255156533" role=""/>
+  <member type="way" ref="141427023" role=""/>
+  <member type="way" ref="205902862" role=""/>
+  <member type="way" ref="99521721" role=""/>
+  <member type="way" ref="99521727" role=""/>
+  <member type="way" ref="100057741" role=""/>
+  <member type="way" ref="100057743" role=""/>
+  <member type="way" ref="23251119" role=""/>
+  <member type="way" ref="23251106" role=""/>
+  <member type="way" ref="132902252" role=""/>
+  <member type="way" ref="141426137" role=""/>
+  <member type="way" ref="205902854" role=""/>
+  <member type="way" ref="255156534" role=""/>
+  <member type="way" ref="255156535" role=""/>
+  <member type="way" ref="42435018" role=""/>
+  <member type="way" ref="205902856" role=""/>
+  <member type="way" ref="255156536" role=""/>
+  <member type="way" ref="254654078" role=""/>
+  <member type="way" ref="175037986" role=""/>
+  <member type="way" ref="175037995" role=""/>
+  <member type="way" ref="354578417" role=""/>
+  <member type="way" ref="66862351" role=""/>
+  <member type="way" ref="255157607" role=""/>
+  <member type="way" ref="255157606" role=""/>
+  <member type="way" ref="255157605" role=""/>
+  <member type="way" ref="255265878" role=""/>
+  <member type="way" ref="254654079" role=""/>
+  <member type="way" ref="79483683" role=""/>
+  <member type="way" ref="255265876" role=""/>
+  <member type="way" ref="35693769" role=""/>
+  <member type="way" ref="175037997" role=""/>
+  <member type="way" ref="354580457" role=""/>
+  <member type="way" ref="142172699" role=""/>
+  <member type="way" ref="354580456" role=""/>
+  <member type="way" ref="42927818" role=""/>
+  <member type="way" ref="56158206" role=""/>
+  <member type="way" ref="39267794" role=""/>
+  <member type="way" ref="42927819" role=""/>
+  <member type="way" ref="254556200" role=""/>
+  <member type="way" ref="100867512" role=""/>
+  <member type="way" ref="100867504" role=""/>
+  <member type="way" ref="32427196" role=""/>
+  <member type="way" ref="38740694" role=""/>
+  <member type="way" ref="38740693" role=""/>
+  <member type="way" ref="145821368" role=""/>
+  <member type="way" ref="47521526" role=""/>
+  <member type="way" ref="47205117" role=""/>
+  <member type="way" ref="30077558" role=""/>
+  <member type="way" ref="145821361" role=""/>
+  <member type="way" ref="44023044" role=""/>
+  <member type="way" ref="204099709" role=""/>
+  <member type="way" ref="44384085" role=""/>
+  <member type="way" ref="44384086" role=""/>
+  <member type="way" ref="32393327" role=""/>
+  <member type="way" ref="46670617" role=""/>
+  <member type="way" ref="31978894" role=""/>
+  <member type="way" ref="31978895" role=""/>
+  <member type="way" ref="43960880" role=""/>
+  <member type="way" ref="39932409" role=""/>
+  <member type="way" ref="39932408" role=""/>
+  <member type="way" ref="39932407" role=""/>
+  <member type="way" ref="39932410" role=""/>
+  <member type="way" ref="38717594" role=""/>
+  <member type="way" ref="38963384" role=""/>
+  <member type="way" ref="31988211" role=""/>
+  <member type="way" ref="143017894" role=""/>
+  <member type="way" ref="388737748" role=""/>
+  <member type="way" ref="59305836" role=""/>
+  <member type="way" ref="419291192" role=""/>
+  <member type="way" ref="419291194" role=""/>
+  <tag k="colour" v="#006ca9"/>
+  <tag k="from" v="Nürnberg Hauptbahnhof"/>
+  <tag k="name" v="NightLiner N2: Nürnberg Hauptbahnhof =&gt; Hersbruck Bahnhof (links der Pegnitz)"/>
+  <tag k="network" v="VGN"/>
+  <tag k="public_transport:version" v="2"/>
+  <tag k="ref" v="N2"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Hersbruck Bahnhof (links der Pegnitz)"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="376651" visible="true" version="48" changeset="35186901" timestamp="2015-11-09T09:14:37Z" user="FanTasMo" uid="78454">
+  <member type="node" ref="40790404" role="start"/>
+  <member type="way" ref="5543808" role="forward"/>
+  <member type="way" ref="32084588" role="forward"/>
+  <member type="way" ref="43599021" role="forward"/>
+  <member type="way" ref="47625544" role="forward"/>
+  <member type="way" ref="72886683" role="forward"/>
+  <member type="way" ref="226336375" role="forward"/>
+  <member type="way" ref="311214196" role="forward"/>
+  <member type="way" ref="345711090" role="forward"/>
+  <member type="way" ref="46949806" role="forward"/>
+  <member type="way" ref="32029799" role="forward"/>
+  <member type="way" ref="311214192" role="forward"/>
+  <member type="way" ref="311214193" role="forward"/>
+  <member type="way" ref="45739281" role="forward"/>
+  <member type="way" ref="45739282" role="forward"/>
+  <member type="way" ref="311214197" role="forward"/>
+  <member type="way" ref="45715476" role="forward"/>
+  <member type="way" ref="311214199" role="forward"/>
+  <member type="way" ref="311214200" role="forward"/>
+  <member type="way" ref="311214191" role="forward"/>
+  <member type="way" ref="133332408" role="forward"/>
+  <member type="way" ref="311214194" role="forward"/>
+  <member type="way" ref="129994854" role="forward"/>
+  <member type="way" ref="311214198" role="forward"/>
+  <member type="way" ref="129994853" role="forward"/>
+  <member type="way" ref="130541737" role="forward"/>
+  <member type="way" ref="30324349" role="forward"/>
+  <member type="way" ref="311214195" role="forward"/>
+  <member type="way" ref="30320105" role="forward"/>
+  <member type="way" ref="138916744" role="forward"/>
+  <member type="way" ref="311214201" role="forward"/>
+  <member type="way" ref="30324350" role="forward"/>
+  <member type="way" ref="30320079" role="forward"/>
+  <member type="way" ref="33477197" role="forward"/>
+  <member type="way" ref="34248813" role="forward"/>
+  <member type="way" ref="59242848" role="backward"/>
+  <member type="way" ref="379326602" role="backward"/>
+  <member type="way" ref="49782557" role="backward"/>
+  <member type="way" ref="29320045" role="backward"/>
+  <member type="way" ref="138915067" role="backward"/>
+  <member type="way" ref="138915066" role="forward"/>
+  <member type="way" ref="47003634" role="forward"/>
+  <member type="way" ref="208574543" role="forward"/>
+  <member type="way" ref="139717125" role="forward"/>
+  <member type="way" ref="209759118" role="forward"/>
+  <member type="way" ref="138366604" role="forward"/>
+  <member type="way" ref="132379026" role="forward"/>
+  <member type="way" ref="138366602" role="forward"/>
+  <member type="way" ref="251301393" role="forward"/>
+  <member type="way" ref="29898623" role="forward"/>
+  <member type="way" ref="32642819" role="forward"/>
+  <member type="way" ref="32642820" role="forward"/>
+  <member type="way" ref="251301387" role="forward"/>
+  <member type="way" ref="20897851" role="forward"/>
+  <member type="way" ref="251301399" role="forward"/>
+  <member type="way" ref="251301394" role="forward"/>
+  <member type="way" ref="251301396" role="forward"/>
+  <member type="way" ref="251301398" role="forward"/>
+  <member type="way" ref="26284127" role="forward"/>
+  <member type="way" ref="35040951" role="forward"/>
+  <member type="way" ref="251290925" role="forward"/>
+  <member type="way" ref="166665276" role="forward"/>
+  <member type="way" ref="4437315" role="forward"/>
+  <member type="way" ref="251290922" role="forward"/>
+  <member type="way" ref="251290923" role="forward"/>
+  <member type="way" ref="60659820" role="forward"/>
+  <member type="way" ref="143187238" role="forward"/>
+  <member type="way" ref="53181115" role="forward"/>
+  <member type="way" ref="249628823" role="forward"/>
+  <member type="way" ref="249628824" role="forward"/>
+  <member type="way" ref="250714475" role="backward"/>
+  <member type="way" ref="376351063" role="backward"/>
+  <member type="way" ref="376351067" role="backward"/>
+  <member type="way" ref="250714494" role="backward"/>
+  <member type="way" ref="250714485" role="backward"/>
+  <member type="way" ref="250714469" role="backward"/>
+  <member type="way" ref="31357913" role="backward"/>
+  <member type="way" ref="73070140" role="forward"/>
+  <member type="way" ref="250714478" role="forward"/>
+  <member type="way" ref="31350767" role="forward"/>
+  <member type="way" ref="31350765" role="forward"/>
+  <member type="way" ref="287330572" role="forward"/>
+  <member type="way" ref="31350768" role="forward"/>
+  <member type="way" ref="28930900" role="forward"/>
+  <member type="way" ref="250714473" role="forward"/>
+  <member type="way" ref="250714486" role="forward"/>
+  <member type="way" ref="28930899" role="forward"/>
+  <member type="way" ref="134263456" role="forward"/>
+  <member type="way" ref="250714472" role="forward"/>
+  <member type="way" ref="28930897" role="forward"/>
+  <member type="way" ref="70793944" role="forward"/>
+  <member type="way" ref="28930896" role="forward"/>
+  <member type="way" ref="250714479" role="forward"/>
+  <member type="way" ref="250714471" role="forward"/>
+  <member type="way" ref="43097274" role="forward"/>
+  <member type="way" ref="43097272" role="forward"/>
+  <member type="way" ref="250714474" role="forward"/>
+  <member type="way" ref="27336421" role="forward"/>
+  <member type="way" ref="27336420" role="forward"/>
+  <member type="way" ref="47625543" role="forward"/>
+  <member type="way" ref="141504540" role="forward"/>
+  <member type="node" ref="5905109" role="end"/>
+  <tag k="detour" v="A 3"/>
+  <tag k="name" v="U 33 (A 3)"/>
+  <tag k="operator" v="Bayern"/>
+  <tag k="ref" v="U 33"/>
+  <tag k="route" v="detour"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="5493620" visible="true" version="1" changeset="33890681" timestamp="2015-09-08T18:48:35Z" user="geodreieck4711" uid="479256">
+  <member type="way" ref="369721053" role="outer"/>
+  <member type="way" ref="369721052" role="inner"/>
+  <tag k="building" v="yes"/>
+  <tag k="type" v="multipolygon"/>
+ </relation>
+ <relation id="5638882" visible="true" version="1" changeset="35079420" timestamp="2015-11-04T13:55:46Z" user="marek kleciak" uid="338611">
+  <member type="way" ref="378314252" role="outer"/>
+  <member type="way" ref="378314249" role="inner"/>
+  <member type="way" ref="378314253" role="inner"/>
+  <member type="way" ref="378314261" role="inner"/>
+  <tag k="type" v="multipolygon"/>
+ </relation>
+ <relation id="370751" visible="true" version="28" changeset="40329862" timestamp="2016-06-27T20:18:36Z" user="pyram" uid="497849">
+  <member type="way" ref="59242848" role=""/>
+  <member type="way" ref="34248813" role=""/>
+  <member type="way" ref="33477197" role=""/>
+  <member type="way" ref="30320079" role=""/>
+  <member type="way" ref="30324350" role=""/>
+  <member type="way" ref="311214201" role=""/>
+  <member type="way" ref="138916744" role=""/>
+  <member type="way" ref="30320105" role=""/>
+  <member type="way" ref="311214195" role=""/>
+  <member type="way" ref="30324349" role=""/>
+  <member type="way" ref="130541737" role=""/>
+  <member type="way" ref="117475635" role=""/>
+  <member type="way" ref="129994855" role=""/>
+  <member type="way" ref="427684487" role=""/>
+  <member type="way" ref="311214194" role=""/>
+  <member type="way" ref="133332408" role=""/>
+  <member type="way" ref="45715476" role=""/>
+  <member type="way" ref="311214199" role=""/>
+  <member type="way" ref="311214200" role=""/>
+  <member type="way" ref="311214191" role=""/>
+  <member type="way" ref="143016727" role=""/>
+  <member type="way" ref="143054447" role=""/>
+  <member type="way" ref="143021334" role=""/>
+  <member type="way" ref="47124598" role=""/>
+  <member type="way" ref="47124599" role=""/>
+  <member type="way" ref="32029796" role=""/>
+  <member type="way" ref="24496856" role=""/>
+  <member type="way" ref="59239327" role=""/>
+  <member type="node" ref="734779059" role="stop"/>
+  <member type="way" ref="49782553" role="platform"/>
+  <member type="node" ref="734788925" role="stop"/>
+  <member type="way" ref="127411561" role="platform"/>
+  <member type="node" ref="734779063" role="stop"/>
+  <member type="node" ref="599200984" role="platform"/>
+  <member type="node" ref="734779062" role="stop"/>
+  <member type="node" ref="599183026" role="platform"/>
+  <member type="node" ref="734788923" role="stop"/>
+  <member type="node" ref="419915093" role="platform"/>
+  <member type="node" ref="734788926" role="stop"/>
+  <member type="node" ref="582582407" role="platform"/>
+  <member type="node" ref="734788922" role="stop"/>
+  <member type="node" ref="1405404988" role="platform"/>
+  <member type="node" ref="734779064" role="stop"/>
+  <member type="node" ref="599598209" role="platform"/>
+  <member type="node" ref="734779060" role="stop"/>
+  <member type="way" ref="129992736" role="platform"/>
+  <tag k="from" v="Nürnberg Mögeldorf"/>
+  <tag k="name" v="Stadtbus 40 Nürnberg Mögeldorf - Nürnberg Henfenfelder Straße Wende"/>
+  <tag k="ref" v="40"/>
+  <tag k="route" v="bus"/>
+  <tag k="to" v="Nürnberg Henfenfelder Straße Wende"/>
+  <tag k="type" v="route"/>
+ </relation>
+ <relation id="6167027" visible="true" version="1" changeset="38836530" timestamp="2016-04-24T15:52:34Z" user="h66" uid="2168054">
+  <member type="way" ref="311214197" role="from"/>
+  <member type="node" ref="1564949378" role="via"/>
+  <member type="way" ref="143021333" role="to"/>
+  <tag k="restriction" v="no_right_turn"/>
+  <tag k="type" v="restriction"/>
+ </relation>
+</osm>
diff --git a/core/files/changelog.txt b/core/files/changelog.txt
index 1eeb989cb8..949828341a 100644
--- a/core/files/changelog.txt
+++ b/core/files/changelog.txt
@@ -1,4 +1,8 @@
+0.9
+    
 0.8
+    refactoring to Weighting class, see #807
+    removed FlagEncoder from parameters as weighting.getFlagEncoder can and is used
     all properties with prefix "osmreader." changed to "datareader." and osmreader.osm changed to datareader.file
     maven/gradle dependency graphhopper is now splitted into graphhopper-core and graphhopper-reader-osm, i.e. if you previouls depend on 'graphhopper' artificat you should now use graphhopper-reader-osm except environments like Android where you just load the graph and do no import
     use GraphHopperOSM as base class instead of GraphHopper
diff --git a/core/files/settings.xml b/core/files/settings.xml
new file mode 100644
index 0000000000..80d2efb46d
--- /dev/null
+++ b/core/files/settings.xml
@@ -0,0 +1,10 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">
+  <servers>
+    <server>
+      <id>ossrh</id>
+      <username>${env.CI_DEPLOY_USERNAME}</username>
+      <password>${env.CI_DEPLOY_PASSWORD}</password>
+    </server>
+  </servers>
+</settings>
diff --git a/core/files/travis-build.sh b/core/files/travis-build.sh
index e0641fe52a..60b1deacce 100755
--- a/core/files/travis-build.sh
+++ b/core/files/travis-build.sh
@@ -1,11 +1,9 @@
 HOME=$(dirname $0)
 cd $HOME/../..
 
-mvn clean test verify
-
 # npm tests disabled due to #632
 # cd $HOME/../../web
-# 
+#
 # sudo chown -R $USER ~/.npm
 # npm install
 # npm test && npm run lint
@@ -14,14 +12,14 @@ mvn clean test verify
 #for module in $modules; do
 #  echo "====== INSTALL $module ====="
 #  mvn -pl $module clean install -DskipTests=true
-#  EXIT_VAL="$?"    
+#  EXIT_VAL="$?"
 #  if [[ "x$EXIT_VAL" != "x0" ]]; then
 #    exit $EXIT_VAL
-#  fi 
-#  
+#  fi
+#
 #  echo "====== TEST $module ====="
 #  # verify necessary for failsafe, otherwise it won't fail the build!?
-#  mvn -pl $module test failsafe:integration-test verify  
+#  mvn -pl $module test failsafe:integration-test verify
 #  EXIT_VAL="$?"
 #  if [[ "x$EXIT_VAL" != "x0" ]]; then
 #    exit $EXIT_VAL
diff --git a/core/pom.xml b/core/pom.xml
index 220c5487eb..36155ba7ad 100644
--- a/core/pom.xml
+++ b/core/pom.xml
@@ -6,26 +6,26 @@
     <groupId>com.graphhopper</groupId>
     <artifactId>graphhopper-core</artifactId>
     <name>GraphHopper Core</name>
-    <version>0.8-SNAPSHOT</version>
-    <packaging>jar</packaging> 
+    <version>0.9-SNAPSHOT</version>
+    <packaging>jar</packaging>
     <description>
-        GraphHopper is a fast and memory efficient Java road routing engine 
+        GraphHopper is a fast and memory efficient Java road routing engine
         working seamlessly with OpenStreetMap data.
     </description>
     <parent>
         <groupId>com.graphhopper</groupId>
-        <artifactId>graphhopper-parent</artifactId>    	
-        <version>0.8-SNAPSHOT</version>
+        <artifactId>graphhopper-parent</artifactId>
+        <version>0.9-SNAPSHOT</version>
     </parent>
-        
+
     <properties>
-        <netbeans.hint.license>apache20</netbeans.hint.license>        
+        <netbeans.hint.license>apache20</netbeans.hint.license>
         <!-- Make sure that we use the same format as for Helper.createFormatter.
              We cannot force the UTC TimeZone so it will just throw away the local offset or is this
              fixed due to https://issues.apache.org/jira/browse/MNG-5647 ?
         -->
-        <maven.build.timestamp.format>yyyy-MM-dd'T'HH:mm:ss'Z'</maven.build.timestamp.format>        
-        <builddate>${maven.build.timestamp}</builddate>        
+        <maven.build.timestamp.format>yyyy-MM-dd'T'HH:mm:ss'Z'</maven.build.timestamp.format>
+        <builddate>${maven.build.timestamp}</builddate>
     </properties>
     <licenses>
         <license>
@@ -34,20 +34,13 @@
             <distribution>repo</distribution>
             <comments>A business-friendly OSS license</comments>
         </license>
-    </licenses> 
+    </licenses>
     <dependencies>
         <dependency>
-            <groupId>com.graphhopper</groupId>
-            <artifactId>graphhopper-tools-lgpl</artifactId>
-            <version>${project.parent.version}</version>
+            <groupId>com.carrotsearch</groupId>
+            <artifactId>hppc</artifactId>
+            <version>0.7.2</version>
         </dependency>
-        
-        <!-- Trove is LGPL and slightly big (~3MB) -->        
-        <dependency>
-            <groupId>net.sf.trove4j</groupId>
-            <artifactId>trove4j</artifactId>
-            <version>3.0.3</version>
-        </dependency>        
         <dependency>
             <groupId>org.slf4j</groupId>
             <artifactId>slf4j-api</artifactId>
@@ -61,7 +54,7 @@
             <scope>test</scope>
         </dependency>
         -->
-        
+
         <dependency>
             <groupId>org.slf4j</groupId>
             <artifactId>slf4j-log4j12</artifactId>
@@ -74,13 +67,13 @@
             <version>${log4j.version}</version>
             <scope>test</scope>
         </dependency>
-        
+
         <!-- for using CGIAR: elevation data importing via tif files-->
         <dependency>
             <groupId>org.apache.xmlgraphics</groupId>
             <artifactId>xmlgraphics-commons</artifactId>
             <version>2.1</version>
-        </dependency>        
+        </dependency>
 
         <dependency>
             <groupId>org.json</groupId>
@@ -88,27 +81,28 @@
             <version>${json.org.version}</version>
             <scope>test</scope>
         </dependency>
-        
     </dependencies>
-        
+
     <build>
         <pluginManagement>
             <plugins>
                 <plugin>
                     <groupId>org.apache.maven.plugins</groupId>
                     <artifactId>maven-assembly-plugin</artifactId>
-                    <configuration>                     
+                    <version>2.6</version>
+                    <configuration>
                         <!-- for usage on android -->
                         <descriptors>
                             <descriptor>src/main/assembly/android.xml</descriptor>
                         </descriptors>
                     </configuration>
-                </plugin>                
-                
-                <!-- create jar with test classes to be reused in other projects like external or our reader-osm -->                
+                </plugin>
+
+                <!-- create jar with test classes to be reused in other projects like external or our reader-osm -->
                 <plugin>
                     <groupId>org.apache.maven.plugins</groupId>
                     <artifactId>maven-jar-plugin</artifactId>
+                    <version>3.0.2</version>
                     <executions>
                         <execution>
                             <goals>
@@ -117,10 +111,10 @@
                         </execution>
                     </executions>
                 </plugin>
-                
+
             </plugins>
         </pluginManagement>
-        
+
         <!-- make version available at runtime via version file -->
         <resources>
             <resource>
diff --git a/core/src/main/java/com/graphhopper/GHRequest.java b/core/src/main/java/com/graphhopper/GHRequest.java
index 783c07a035..477cc80903 100644
--- a/core/src/main/java/com/graphhopper/GHRequest.java
+++ b/core/src/main/java/com/graphhopper/GHRequest.java
@@ -39,6 +39,7 @@
     // List of favored start (1st element) and arrival heading (all other).
     // Headings are north based azimuth (clockwise) in (0, 360) or NaN for equal preference
     private final List<Double> favoredHeadings;
+    private List<String> pointHints = new ArrayList<>();
     private String algo = "";
     private boolean possibleToAdd = false;
     private Locale locale = Locale.US;
@@ -99,11 +100,9 @@ public GHRequest(GHPoint startPlace, GHPoint endPlace) {
     /**
      * Set routing request
      * <p>
-     *
      * @param points          List of stopover points in order: start, 1st stop, 2nd stop, ..., end
      * @param favoredHeadings List of favored headings for starting (start point) and arrival (via
      *                        and end points) Headings are north based azimuth (clockwise) in (0, 360) or NaN for equal
-     *                        preference
      */
     public GHRequest(List<GHPoint> points, List<Double> favoredHeadings) {
         if (points.size() != favoredHeadings.size())
@@ -230,13 +229,30 @@ public String getVehicle() {
     }
 
     /**
-     * Specifiy car, bike or foot. Or specify empty to use default.
+     * Specify car, bike or foot. Or specify empty to use default.
      */
     public GHRequest setVehicle(String vehicle) {
         hints.setVehicle(vehicle);
         return this;
     }
 
+    public HintsMap getHints() {
+        return hints;
+    }
+
+    public GHRequest setPointHints(List<String> pointHints) {
+        this.pointHints = pointHints;
+        return this;
+    }
+
+    public List<String> getPointHints() {
+        return pointHints;
+    }
+
+    public boolean hasPointHints() {
+        return pointHints.size() == points.size();
+    }
+
     @Override
     public String toString() {
         String res = "";
@@ -249,8 +265,4 @@ public String toString() {
         }
         return res + "(" + algo + ")";
     }
-
-    public HintsMap getHints() {
-        return hints;
-    }
 }
diff --git a/core/src/main/java/com/graphhopper/GHResponse.java b/core/src/main/java/com/graphhopper/GHResponse.java
index 9c69411efd..72c8fb00f9 100644
--- a/core/src/main/java/com/graphhopper/GHResponse.java
+++ b/core/src/main/java/com/graphhopper/GHResponse.java
@@ -88,7 +88,7 @@ public String getDebugInfo() {
 
     /**
      * This method returns true if one of the paths has an error or if the response itself is
-     * errornous.
+     * erroneous.
      */
     public boolean hasErrors() {
         if (!errors.isEmpty())
@@ -103,7 +103,7 @@ public boolean hasErrors() {
     }
 
     /**
-     * This method returns all the explicitely added errors and the errors of all paths.
+     * This method returns all the explicitly added errors and the errors of all paths.
      */
     public List<Throwable> getErrors() {
         List<Throwable> list = new ArrayList<Throwable>();
diff --git a/core/src/main/java/com/graphhopper/GraphHopper.java b/core/src/main/java/com/graphhopper/GraphHopper.java
index 6f85a26b12..0cb5051aac 100644
--- a/core/src/main/java/com/graphhopper/GraphHopper.java
+++ b/core/src/main/java/com/graphhopper/GraphHopper.java
@@ -17,10 +17,15 @@
  */
 package com.graphhopper;
 
+import com.graphhopper.json.geo.JsonFeature;
 import com.graphhopper.reader.DataReader;
+import com.graphhopper.reader.dem.BridgeElevationInterpolator;
 import com.graphhopper.reader.dem.CGIARProvider;
 import com.graphhopper.reader.dem.ElevationProvider;
 import com.graphhopper.reader.dem.SRTMProvider;
+import com.graphhopper.reader.dem.TunnelElevationInterpolator;
+import com.graphhopper.storage.change.ChangeGraphHelper;
+import com.graphhopper.storage.change.ChangeGraphResponse;
 import com.graphhopper.routing.*;
 import com.graphhopper.routing.ch.CHAlgoFactoryDecorator;
 import com.graphhopper.routing.ch.PrepareContractionHierarchies;
@@ -38,6 +43,7 @@
 import com.graphhopper.util.*;
 import com.graphhopper.util.Parameters.CH;
 import com.graphhopper.util.Parameters.Routing;
+import com.graphhopper.util.exceptions.PointDistanceExceededException;
 import com.graphhopper.util.exceptions.PointOutOfBoundsException;
 import com.graphhopper.util.shapes.BBox;
 import com.graphhopper.util.shapes.GHPoint;
@@ -51,6 +57,10 @@
 
 import static com.graphhopper.util.Parameters.Algorithms.*;
 
+import java.util.concurrent.locks.Lock;
+import java.util.concurrent.locks.ReadWriteLock;
+import java.util.concurrent.locks.ReentrantReadWriteLock;
+
 /**
  * Easy to use access point to configure import and (offline) routing.
  *
@@ -84,6 +94,9 @@
     private boolean simplifyResponse = true;
     private TraversalMode traversalMode = TraversalMode.NODE_BASED;
     private int maxVisitedNodes = Integer.MAX_VALUE;
+    private String blockedRectangularAreas = "";
+
+    private int nonChMaxWaypointDistance = Integer.MAX_VALUE;
     // for index
     private LocationIndex locationIndex;
     private int preciseIndexResolution = 300;
@@ -94,10 +107,11 @@
     // for data reader
     private String dataReaderFile;
     private double dataReaderWayPointMaxDistance = 1;
-    private int dataReaderWorkerThreads = -1;
+    private int dataReaderWorkerThreads = 2;
     private boolean calcPoints = true;
     private ElevationProvider eleProvider = ElevationProvider.NOOP;
     private FlagEncoderFactory flagEncoderFactory = FlagEncoderFactory.DEFAULT;
+    private final ReadWriteLock readWriteLock = new ReentrantReadWriteLock();
 
     public GraphHopper() {
         chFactoryDecorator.setEnabled(true);
@@ -636,6 +650,8 @@ public GraphHopper init(CmdArgs args) {
         // routing
         maxVisitedNodes = args.getInt(Routing.INIT_MAX_VISITED_NODES, Integer.MAX_VALUE);
         maxRoundTripRetries = args.getInt(RoundTrip.INIT_MAX_RETRIES, maxRoundTripRetries);
+        nonChMaxWaypointDistance = args.getInt(Parameters.NON_CH.MAX_NON_CH_POINT_DISTANCE, Integer.MAX_VALUE);
+        blockedRectangularAreas = args.get(Routing.BLOCK_AREA, "");
 
         return this;
     }
@@ -666,7 +682,7 @@ public GraphHopper importOrLoad() {
      */
     private GraphHopper process(String graphHopperLocation) {
         setGraphHopperLocation(graphHopperLocation);
-        Lock lock = null;
+        GHLock lock = null;
         try {
             if (ghStorage.getDirectory().getDefaultType().isStoring()) {
                 lockFactory.setLockDir(new File(graphHopperLocation));
@@ -729,7 +745,7 @@ protected DataReader initDataReader(DataReader reader) {
     }
 
     /**
-     * Opens existing graph.
+     * Opens existing graph folder.
      *
      * @param graphHopperFolder is the folder containing graphhopper files. Can be a compressed file
      *                          too ala folder-content.ghz.
@@ -742,13 +758,10 @@ public boolean load(String graphHopperFolder) {
         if (fullyLoaded)
             throw new IllegalStateException("graph is already successfully loaded");
 
-        if (graphHopperFolder.endsWith("-gh")) {
-            // do nothing  
-        } else if (graphHopperFolder.endsWith(".osm") || graphHopperFolder.endsWith(".xml")) {
-            throw new IllegalArgumentException("GraphHopperLocation cannot be the OSM file. Instead you need to use importOrLoad");
-        } else if (!graphHopperFolder.contains(".")) {
-            if (new File(graphHopperFolder + "-gh").exists())
-                graphHopperFolder += "-gh";
+        File tmpFileOrFolder = new File(graphHopperFolder);
+
+        if (!tmpFileOrFolder.isDirectory() && tmpFileOrFolder.exists()) {
+            throw new IllegalArgumentException("GraphHopperLocation cannot be an existing file. Has to be either non-existing or a folder.");
         } else {
             File compressed = new File(graphHopperFolder + ".ghz");
             if (compressed.exists() && !compressed.isDirectory()) {
@@ -785,7 +798,7 @@ public boolean load(String graphHopperFolder) {
         if (!new File(graphHopperFolder).exists())
             return false;
 
-        Lock lock = null;
+        GHLock lock = null;
         try {
             // create locks only if writes are allowed, if they are not allowed a lock cannot be created 
             // (e.g. on a read only filesystem locks would fail)
@@ -833,14 +846,14 @@ private void initCHAlgoFactoryDecorator() {
         if (!chFactoryDecorator.hasWeightings())
             for (FlagEncoder encoder : encodingManager.fetchEdgeEncoders()) {
                 for (String chWeightingStr : chFactoryDecorator.getWeightingsAsStrings()) {
-                    Weighting weighting = createWeighting(new HintsMap(chWeightingStr), encoder);
+                    Weighting weighting = createWeighting(new HintsMap(chWeightingStr), encoder, null);
                     chFactoryDecorator.addWeighting(weighting);
                 }
             }
     }
 
     /**
-     * This method creates prepations.
+     * This method creates preparations.
      *
      * @deprecated use getCHFactoryDecorator().createPreparations() instead. Will be removed in 0.8.
      */
@@ -864,6 +877,10 @@ public void postProcessing() {
             ghStorage = newGraph;
         }
 
+        if (hasElevation()) {
+            interpolateBridgesAndOrTunnels();
+        }
+
         initLocationIndex();
         if (chFactoryDecorator.isEnabled())
             createCHPreparations();
@@ -872,40 +889,75 @@ public void postProcessing() {
             prepare();
     }
 
+    private void interpolateBridgesAndOrTunnels() {
+        if (ghStorage.getEncodingManager().supports("generic")) {
+            final FlagEncoder genericFlagEncoder = ghStorage.getEncodingManager()
+                    .getEncoder("generic");
+            if (!(genericFlagEncoder instanceof DataFlagEncoder)) {
+                throw new IllegalStateException("'generic' flag encoder for elevation interpolation of "
+                        + "bridges and tunnels is enabled but does not have the expected type "
+                        + DataFlagEncoder.class.getName() + ".");
+            }
+            final DataFlagEncoder dataFlagEncoder = (DataFlagEncoder) genericFlagEncoder;
+            StopWatch sw = new StopWatch().start();
+            new TunnelElevationInterpolator(ghStorage, dataFlagEncoder).execute();
+            float tunnel = sw.stop().getSeconds();
+            sw = new StopWatch().start();
+            new BridgeElevationInterpolator(ghStorage, dataFlagEncoder).execute();
+            logger.info("Bridge interpolation " + (int) sw.stop().getSeconds() + "s, "
+                    + "tunnel interpolation " + (int) tunnel + "s");
+        }
+    }
+
     private boolean isPrepared() {
         return "true".equals(ghStorage.getProperties().get("prepare.done"));
     }
 
     /**
-     * Based on the weightingParameters and the specified vehicle a Weighting instance can be
-     * created. Note that all URL parameters are available in the weightingParameters as String if
-     * you use the GraphHopper Web module.
+     * Based on the hintsMap and the specified encoder a Weighting instance can be
+     * created. Note that all URL parameters are available in the hintsMap as String if
+     * you use the web module.
      *
-     * @param weightingMap all parameters influencing the weighting. E.g. parameters coming via
-     *                     GHRequest.getHints or directly via "&amp;api.xy=" from the URL of the web UI
-     * @param encoder      the required vehicle
+     * @param hintsMap all parameters influencing the weighting. E.g. parameters coming via
+     *                 GHRequest.getHints or directly via "&amp;api.xy=" from the URL of the web UI
+     * @param encoder  the required vehicle
+     * @param graph    The Graph enables the Weighting for NodeAccess and more
      * @return the weighting to be used for route calculation
      * @see HintsMap
      */
-    public Weighting createWeighting(HintsMap weightingMap, FlagEncoder encoder) {
-        String weighting = weightingMap.getWeighting().toLowerCase();
+    public Weighting createWeighting(HintsMap hintsMap, FlagEncoder encoder, Graph graph) {
+        String weighting = hintsMap.getWeighting().toLowerCase();
 
         if (encoder.supports(GenericWeighting.class)) {
             DataFlagEncoder dataEncoder = (DataFlagEncoder) encoder;
-            return new GenericWeighting(dataEncoder, dataEncoder.readStringMap(weightingMap));
+            ConfigMap cMap = dataEncoder.readStringMap(hintsMap);
+
+            // add default blocked rectangular areas from config properties
+            if (!this.blockedRectangularAreas.isEmpty()) {
+                String val = this.blockedRectangularAreas;
+                String blockedAreasFromRequest = hintsMap.get(Parameters.Routing.BLOCK_AREA, "");
+                if (!blockedAreasFromRequest.isEmpty())
+                    val += ";" + blockedAreasFromRequest;
+                hintsMap.put(Parameters.Routing.BLOCK_AREA, val);
+            }
+
+            cMap = new GraphEdgeIdFinder(graph, locationIndex).parseStringHints(cMap, hintsMap, new DefaultEdgeFilter(encoder));
+            GenericWeighting genericWeighting = new GenericWeighting(dataEncoder, cMap);
+            genericWeighting.setGraph(graph);
+            return genericWeighting;
         } else if ("shortest".equalsIgnoreCase(weighting)) {
             return new ShortestWeighting(encoder);
         } else if ("fastest".equalsIgnoreCase(weighting) || weighting.isEmpty()) {
             if (encoder.supports(PriorityWeighting.class))
-                return new PriorityWeighting(encoder, weightingMap);
+                return new PriorityWeighting(encoder, hintsMap);
             else
-                return new FastestWeighting(encoder, weightingMap);
+                return new FastestWeighting(encoder, hintsMap);
         } else if ("curvature".equalsIgnoreCase(weighting)) {
             if (encoder.supports(CurvatureWeighting.class))
-                return new CurvatureWeighting(encoder, weightingMap);
+                return new CurvatureWeighting(encoder, hintsMap);
 
         } else if ("short_fastest".equalsIgnoreCase(weighting)) {
-            return new ShortFastestWeighting(encoder, weightingMap);
+            return new ShortFastestWeighting(encoder, hintsMap);
         }
 
         throw new IllegalArgumentException("weighting " + weighting + " not supported");
@@ -914,9 +966,10 @@ public Weighting createWeighting(HintsMap weightingMap, FlagEncoder encoder) {
     /**
      * Potentially wraps the specified weighting into a TurnWeighting instance.
      */
-    public Weighting createTurnWeighting(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode) {
+    public Weighting createTurnWeighting(Graph graph, Weighting weighting, TraversalMode tMode) {
+        FlagEncoder encoder = weighting.getFlagEncoder();
         if (encoder.supports(TurnWeighting.class) && !tMode.equals(TraversalMode.NODE_BASED))
-            return new TurnWeighting(weighting, encoder, (TurnCostExtension) graph.getExtension());
+            return new TurnWeighting(weighting, (TurnCostExtension) graph.getExtension());
         return weighting;
     }
 
@@ -941,6 +994,8 @@ public GHResponse route(GHRequest request) {
             request.setVehicle(vehicle);
         }
 
+        Lock readLock = readWriteLock.readLock();
+        readLock.lock();
         try {
             if (!encodingManager.supports(vehicle))
                 throw new IllegalArgumentException("Vehicle " + vehicle + " unsupported. "
@@ -981,8 +1036,8 @@ else if (ALT_ROUTE.equalsIgnoreCase(algoStr))
                     return Collections.emptyList();
 
                 RoutingAlgorithmFactory tmpAlgoFactory = getAlgorithmFactory(hints);
-                Weighting weighting = null;
-                Graph routingGraph = ghStorage;
+                Weighting weighting;
+                QueryGraph queryGraph;
 
                 boolean forceFlexibleMode = hints.getBool(CH.DISABLE, false);
                 if (!chFactoryDecorator.isDisablingAllowed() && forceFlexibleMode)
@@ -997,10 +1052,13 @@ else if (!(tmpAlgoFactory instanceof PrepareContractionHierarchies))
 
                     tMode = getCHFactoryDecorator().getNodeBase();
                     weighting = ((PrepareContractionHierarchies) tmpAlgoFactory).getWeighting();
-                    routingGraph = ghStorage.getGraph(CHGraph.class, weighting);
-
+                    queryGraph = new QueryGraph(ghStorage.getGraph(CHGraph.class, weighting));
+                    queryGraph.lookup(qResults);
                 } else {
-                    weighting = createWeighting(hints, encoder);
+                    checkNonChMaxWaypointDistance(points);
+                    queryGraph = new QueryGraph(ghStorage);
+                    queryGraph.lookup(qResults);
+                    weighting = createWeighting(hints, encoder, queryGraph);
                     ghRsp.addDebugInfo("tmode:" + tMode.toString());
                 }
 
@@ -1008,12 +1066,10 @@ else if (!(tmpAlgoFactory instanceof PrepareContractionHierarchies))
                 if (maxVisitedNodesForRequest > maxVisitedNodes)
                     throw new IllegalArgumentException("The max_visited_nodes parameter has to be below or equal to:" + maxVisitedNodes);
 
-                QueryGraph queryGraph = new QueryGraph(routingGraph);
-                queryGraph.lookup(qResults);
-                weighting = createTurnWeighting(queryGraph, encoder, weighting, tMode);
+                weighting = createTurnWeighting(queryGraph, weighting, tMode);
 
                 AlgorithmOptions algoOpts = AlgorithmOptions.start().
-                        algorithm(algoStr).traversalMode(tMode).flagEncoder(encoder).weighting(weighting).
+                        algorithm(algoStr).traversalMode(tMode).weighting(weighting).
                         maxVisitedNodes(maxVisitedNodesForRequest).
                         hints(hints).
                         build();
@@ -1039,9 +1095,36 @@ else if (!(tmpAlgoFactory instanceof PrepareContractionHierarchies))
         } catch (IllegalArgumentException ex) {
             ghRsp.addError(ex);
             return Collections.emptyList();
+        } finally {
+            readLock.unlock();
         }
     }
 
+    /**
+     * This method applies the changes to the graph specified as feature collection. It does so by locking the routing
+     * to avoid concurrent changes which could result in incorrect routing (like when done while a Dijkstra search) or
+     * also while just reading one edge row (inconsistent edge properties).
+     */
+    public ChangeGraphResponse changeGraph(Collection<JsonFeature> collection) {
+        // TODO allow calling this method if called before CH preparation
+        if (getCHFactoryDecorator().isEnabled())
+            throw new IllegalArgumentException("To use the changeGraph API you need to turn off CH");
+
+        Lock writeLock = readWriteLock.writeLock();
+        writeLock.lock();
+        try {
+            ChangeGraphHelper overlay = createChangeGraphHelper(ghStorage, locationIndex);
+            long updateCount = overlay.applyChanges(encodingManager, collection);
+            return new ChangeGraphResponse(updateCount);
+        } finally {
+            writeLock.unlock();
+        }
+    }
+
+    protected ChangeGraphHelper createChangeGraphHelper(Graph graph, LocationIndex locationIndex) {
+        return new ChangeGraphHelper(graph, locationIndex);
+    }
+
     private void checkIfPointsAreInBounds(List<GHPoint> points) {
         BBox bounds = getGraphHopperStorage().getBounds();
         for (int i = 0; i < points.size(); i++) {
@@ -1052,6 +1135,27 @@ private void checkIfPointsAreInBounds(List<GHPoint> points) {
         }
     }
 
+    private void checkNonChMaxWaypointDistance(List<GHPoint> points) {
+        if (nonChMaxWaypointDistance == Integer.MAX_VALUE) {
+            return;
+        }
+        GHPoint lastPoint = points.get(0);
+        GHPoint point;
+        double dist;
+        DistanceCalc calc = Helper.DIST_3D;
+        for (int i = 1; i < points.size(); i++) {
+            point = points.get(i);
+            dist = calc.calcDist(lastPoint.getLat(), lastPoint.getLon(), point.getLat(), point.getLon());
+            if (dist > nonChMaxWaypointDistance) {
+                Map<String, Object> detailMap = new HashMap<>(2);
+                detailMap.put("from", i - 1);
+                detailMap.put("to", i);
+                throw new PointDistanceExceededException("Point " + i + " is too far from Point " + (i - 1) + ": " + point, detailMap);
+            }
+            lastPoint = point;
+        }
+    }
+
     protected LocationIndex createLocationIndex(Directory dir) {
         LocationIndexTree tmpIndex = new LocationIndexTree(ghStorage, dir);
         tmpIndex.setResolution(preciseIndexResolution);
@@ -1152,4 +1256,9 @@ protected void ensureWriteAccess() {
         if (!allowWrites)
             throw new IllegalStateException("Writes are not allowed!");
     }
+
+    public void setNonChMaxWaypointDistance(int nonChMaxWaypointDistance) {
+        this.nonChMaxWaypointDistance = nonChMaxWaypointDistance;
+    }
+
 }
diff --git a/core/src/main/java/com/graphhopper/PathWrapper.java b/core/src/main/java/com/graphhopper/PathWrapper.java
index bb4d9034d2..3e44d37665 100644
--- a/core/src/main/java/com/graphhopper/PathWrapper.java
+++ b/core/src/main/java/com/graphhopper/PathWrapper.java
@@ -138,8 +138,8 @@ public double getAscend() {
     }
 
     public PathWrapper setAscend(double ascend) {
-        if (ascend < 0)
-            throw new IllegalArgumentException("ascend has to be strictly positive");
+        if (ascend < 0 || Double.isNaN(ascend))
+            throw new IllegalStateException("ascend has to be positive but was " + ascend);
 
         this.ascend = ascend;
         return this;
@@ -156,8 +156,8 @@ public double getDescend() {
     }
 
     public PathWrapper setDescend(double descend) {
-        if (descend < 0)
-            throw new IllegalArgumentException("descend has to be strictly positive");
+        if (descend < 0 || Double.isNaN(descend))
+            throw new IllegalStateException("descend has to be positive but was " + descend);
 
         this.descend = descend;
         return this;
diff --git a/core/src/main/java/com/graphhopper/apache/commons/collections/IntDoubleBinaryHeap.java b/core/src/main/java/com/graphhopper/apache/commons/collections/IntDoubleBinaryHeap.java
new file mode 100644
index 0000000000..d45cb92373
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/apache/commons/collections/IntDoubleBinaryHeap.java
@@ -0,0 +1,216 @@
+/*
+ *  Copyright 2001-2004 The Apache Software Foundation
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.apache.commons.collections;
+
+import com.graphhopper.coll.BinHeapWrapper;
+import java.util.Arrays;
+import java.util.NoSuchElementException;
+
+/**
+ * This class is a partial copy of the class org.apache.commons.collections.BinaryHeap for
+ * just the min heap and primitive, sorted double keys and associated int elements.
+ *
+ * The library can be found here: https://commons.apache.org/proper/commons-collections/
+ */
+public class IntDoubleBinaryHeap implements BinHeapWrapper<Number, Integer> {
+
+    private static final int GROW_FACTOR = 2;
+    private int size;
+    private int[] elements;
+    private float[] keys;
+
+    public IntDoubleBinaryHeap() {
+        this(1000);
+    }
+
+    public IntDoubleBinaryHeap(int initialCapacity) {
+        //+1 as element 0 is noop
+        elements = new int[initialCapacity + 1];
+        keys = new float[initialCapacity + 1];
+        // make minimum to avoid zero array check in while loop
+        keys[0] = Float.NEGATIVE_INFINITY;
+    }
+
+    private boolean isFull() {
+        //+1 as element 0 is noop
+        return elements.length == size + 1;
+    }
+
+    @Override
+    public void update(Number key, Integer element) {
+        update_(key.doubleValue(), element);
+    }
+
+    public void update_(double key, int element) {
+        int i;
+        // we have no clue about the element order, so we need to search the full array
+        for (i = 1; i <= size; i++) {
+            if (elements[i] == element)
+                break;
+        }
+
+        if (i > size)
+            return;
+
+        if (key > keys[i]) {
+            keys[i] = (float) key;
+            percolateDownMinHeap(i);
+        } else {
+            keys[i] = (float) key;
+            percolateUpMinHeap(i);
+        }
+    }
+
+    @Override
+    public void insert(Number key, Integer element) {
+        insert_(key.doubleValue(), element);
+    }
+
+    public void insert_(double key, int element) {
+        if (isFull()) {
+            ensureCapacity((int) (elements.length * GROW_FACTOR));
+        }
+
+        size++;
+        elements[size] = element;
+        keys[size] = (float) key;
+        percolateUpMinHeap(size);
+    }
+
+    @Override
+    public Integer peekElement() {
+        return peek_element();
+    }
+
+    public int peek_element() {
+        if (isEmpty()) {
+            throw new NoSuchElementException("Heap is empty. Cannot peek element.");
+        } else {
+            return elements[1];
+        }
+    }
+
+    @Override
+    public Number peekKey() {
+        return peek_key();
+    }
+
+    public float peek_key() {
+        if (isEmpty())
+            throw new NoSuchElementException("Heap is empty. Cannot peek key.");
+        else
+            return keys[1];
+    }
+
+    @Override
+    public Integer pollElement() {
+        return poll_element();
+    }
+
+    public int poll_element() {
+        final int result = peek_element();
+        elements[1] = elements[size];
+        keys[1] = keys[size];
+        size--;
+
+        if (size != 0)
+            percolateDownMinHeap(1);
+
+        return result;
+    }
+
+    /**
+     * Percolates element down heap from the array position given by the index.
+     */
+    final void percolateDownMinHeap(final int index) {
+        final int element = elements[index];
+        final float key = keys[index];
+        int hole = index;
+
+        while (hole * 2 <= size) {
+            int child = hole * 2;
+
+            // if we have a right child and that child can not be percolated
+            // up then move onto other child
+            if (child != size && keys[child + 1] < keys[child]) {
+                child++;
+            }
+
+            // if we found resting place of bubble then terminate search
+            if (keys[child] >= key) {
+                break;
+            }
+
+            elements[hole] = elements[child];
+            keys[hole] = keys[child];
+            hole = child;
+        }
+
+        elements[hole] = element;
+        keys[hole] = key;
+    }
+    
+    final void percolateUpMinHeap(final int index) {
+        int hole = index;
+        int element = elements[hole];
+        float key = keys[hole];
+        // parent == hole/2
+        while (key < keys[hole / 2]) {
+            final int next = hole / 2;
+            elements[hole] = elements[next];
+            keys[hole] = keys[next];
+            hole = next;
+        }
+        elements[hole] = element;
+        keys[hole] = key;
+    }
+
+    @Override
+    public boolean isEmpty() {
+        return size == 0;
+    }
+
+    @Override
+    public int getSize() {
+        return size;
+    }
+
+    @Override
+    public void clear() {
+        trimTo(0);
+    }
+
+    void trimTo(int toSize) {
+        this.size = toSize;
+        toSize++;
+        // necessary as we currently do not init arrays when inserting
+        Arrays.fill(elements, toSize, size + 1, 0);
+    }
+
+    @Override
+    public void ensureCapacity(int capacity) {
+        if (capacity < size) {
+            throw new IllegalStateException("IntDoubleBinaryHeap contains too many elements to fit in new capacity.");
+        }
+
+        elements = Arrays.copyOf(elements, capacity + 1);
+        keys = Arrays.copyOf(keys, capacity + 1);
+    }
+
+    public long getCapacity() {
+        return elements.length;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/apache/commons/lang3/StringUtils.java b/core/src/main/java/com/graphhopper/apache/commons/lang3/StringUtils.java
new file mode 100644
index 0000000000..12581c66be
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/apache/commons/lang3/StringUtils.java
@@ -0,0 +1,114 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package com.graphhopper.apache.commons.lang3;
+
+
+/**
+ * This class is a partial Copy of the org.apache.commons.lang3.StringUtils
+ * that can be found here: https://github.com/apache/commons-lang/blob/master/src/main/java/org/apache/commons/lang3/StringUtils.java
+ *
+ * The library can be found here: https://commons.apache.org/proper/commons-lang/
+ */
+public class StringUtils {
+
+    /**
+     * <p>Find the Levenshtein distance between two Strings.</p>
+     *
+     * <p>This is the number of changes needed to change one String into
+     * another, where each change is a single character modification (deletion,
+     * insertion or substitution).</p>
+     *
+     * <p>The implementation uses a single-dimensional array of length s.length() + 1. See
+     * <a href="http://blog.softwx.net/2014/12/optimizing-levenshtein-algorithm-in-c.html">
+     * http://blog.softwx.net/2014/12/optimizing-levenshtein-algorithm-in-c.html</a> for details.</p>
+     *
+     * <pre>
+     * StringUtils.getLevenshteinDistance(null, *)             = IllegalArgumentException
+     * StringUtils.getLevenshteinDistance(*, null)             = IllegalArgumentException
+     * StringUtils.getLevenshteinDistance("","")               = 0
+     * StringUtils.getLevenshteinDistance("","a")              = 1
+     * StringUtils.getLevenshteinDistance("aaapppp", "")       = 7
+     * StringUtils.getLevenshteinDistance("frog", "fog")       = 1
+     * StringUtils.getLevenshteinDistance("fly", "ant")        = 3
+     * StringUtils.getLevenshteinDistance("elephant", "hippo") = 7
+     * StringUtils.getLevenshteinDistance("hippo", "elephant") = 7
+     * StringUtils.getLevenshteinDistance("hippo", "zzzzzzzz") = 8
+     * StringUtils.getLevenshteinDistance("hello", "hallo")    = 1
+     * </pre>
+     *
+     * @param s  the first String, must not be null
+     * @param t  the second String, must not be null
+     * @return result distance
+     * @throws IllegalArgumentException if either String input {@code null}
+     * @since 3.0 Changed signature from getLevenshteinDistance(String, String) to
+     * getLevenshteinDistance(CharSequence, CharSequence)
+     */
+    public static int getLevenshteinDistance(CharSequence s, CharSequence t) {
+        if (s == null || t == null) {
+            throw new IllegalArgumentException("Strings must not be null");
+        }
+
+        int n = s.length();
+        int m = t.length();
+
+        if (n == 0) {
+            return m;
+        } else if (m == 0) {
+            return n;
+        }
+
+        if (n > m) {
+            // swap the input strings to consume less memory
+            final CharSequence tmp = s;
+            s = t;
+            t = tmp;
+            n = m;
+            m = t.length();
+        }
+
+        final int p[] = new int[n + 1];
+        // indexes into strings s and t
+        int i; // iterates through s
+        int j; // iterates through t
+        int upper_left;
+        int upper;
+
+        char t_j; // jth character of t
+        int cost;
+
+        for (i = 0; i <= n; i++) {
+            p[i] = i;
+        }
+
+        for (j = 1; j <= m; j++) {
+            upper_left = p[0];
+            t_j = t.charAt(j - 1);
+            p[0] = j;
+
+            for (i = 1; i <= n; i++) {
+                upper = p[i];
+                cost = s.charAt(i - 1) == t_j ? 0 : 1;
+                // minimum of cell to the left+1, to the top+1, diagonally left and up +cost
+                p[i] = Math.min(Math.min(p[i - 1] + 1, p[i] + 1), upper_left + cost);
+                upper_left = upper;
+            }
+        }
+
+        return p[n];
+    }
+
+}
diff --git a/core/src/main/java/com/graphhopper/coll/CompressedArray.java b/core/src/main/java/com/graphhopper/coll/CompressedArray.java
index 9e9443f79d..4c72d0b657 100644
--- a/core/src/main/java/com/graphhopper/coll/CompressedArray.java
+++ b/core/src/main/java/com/graphhopper/coll/CompressedArray.java
@@ -30,7 +30,7 @@
 import java.util.zip.Inflater;
 
 /**
- * Stores the entries in compressed segments. The methods de(compress) are taken from lucene
+ * Stores the entries in compressed segments. The methods de(compress) are taken from Lucene
  * CompressionTools. Before accessing the stored values be sure you called flush.
  * <p>
  *
@@ -52,7 +52,7 @@ public CompressedArray() {
     /**
      * @param _segments           initialize with this number of segments
      * @param entriesPerSeg       a static number which sets the entries per segment
-     * @param approxBytesPerEntry an *approximative* number (as entries can have different lengths)
+     * @param approxBytesPerEntry an *approximate* number (as entries can have different lengths)
      */
     public CompressedArray(int _segments, int entriesPerSeg, int approxBytesPerEntry) {
         if (entriesPerSeg < 1) {
diff --git a/core/src/main/java/com/graphhopper/coll/GHBitSet.java b/core/src/main/java/com/graphhopper/coll/GHBitSet.java
index 74f8e1ad00..3748e2bf32 100644
--- a/core/src/main/java/com/graphhopper/coll/GHBitSet.java
+++ b/core/src/main/java/com/graphhopper/coll/GHBitSet.java
@@ -21,6 +21,8 @@
  * Wrapper interface of an integer container for different implementations like OpenBitset, BitSet,
  * ...
  * <p>
+ * Loop via<br/>
+ * <code>for (int i = set.next(0); i >= 0; i = set.next(i + 1)) {...}</code>
  *
  * @author Peter Karich
  */
diff --git a/core/src/main/java/com/graphhopper/coll/GHBitSetImpl.java b/core/src/main/java/com/graphhopper/coll/GHBitSetImpl.java
index 26a83fd969..6f9cac1cc7 100644
--- a/core/src/main/java/com/graphhopper/coll/GHBitSetImpl.java
+++ b/core/src/main/java/com/graphhopper/coll/GHBitSetImpl.java
@@ -24,6 +24,7 @@
  */
 public class GHBitSetImpl extends BitSet implements GHBitSet {
     public GHBitSetImpl() {
+        super();
     }
 
     public GHBitSetImpl(int nbits) {
diff --git a/core/src/main/java/com/graphhopper/coll/GHIntArrayList.java b/core/src/main/java/com/graphhopper/coll/GHIntArrayList.java
new file mode 100644
index 0000000000..e5e1de3ddd
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHIntArrayList.java
@@ -0,0 +1,78 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.IntArrayList;
+import java.util.Random;
+
+/**
+ *
+ * @author Peter Karich
+ */
+public class GHIntArrayList extends IntArrayList {
+    public GHIntArrayList() {
+        super(10);
+    }
+
+    public GHIntArrayList(int capacity) {
+        super(capacity);
+    }
+
+    public GHIntArrayList(GHIntArrayList list) {
+        super(list);
+    }
+
+    public final GHIntArrayList reverse() {
+        final int[] buffer = this.buffer;
+        int tmp;
+        for (int start = 0, end = size() - 1; start < end; start++, end--) {
+            // swap the values
+            tmp = buffer[start];
+            buffer[start] = buffer[end];
+            buffer[end] = tmp;
+        }
+        return this;
+    }
+
+    public final GHIntArrayList fill(final int max, final int value) {
+        // TODO fill 100 then copy using System.arraycopy, then duplicate this via copying again etc
+        for (int i = 0; i < max; i++) {
+            add(value);
+        }
+        return this;
+    }
+
+    public final GHIntArrayList shuffle(Random random) {
+        int[] buffer = this.buffer;
+        int max = size();
+        int maxHalf = max / 2;
+        for (int x1 = 0; x1 < maxHalf; x1++) {
+            int x2 = random.nextInt(maxHalf) + maxHalf;
+            int tmp = buffer[x1];
+            buffer[x1] = buffer[x2];
+            buffer[x2] = tmp;
+        }
+        return this;
+    }
+
+    public static GHIntArrayList from(int... elements) {
+        final GHIntArrayList list = new GHIntArrayList(elements.length);
+        list.add(elements);
+        return list;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHIntHashSet.java b/core/src/main/java/com/graphhopper/coll/GHIntHashSet.java
new file mode 100644
index 0000000000..2571610f5e
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHIntHashSet.java
@@ -0,0 +1,58 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.HashOrderMixingStrategy;
+import com.carrotsearch.hppc.IntContainer;
+import com.carrotsearch.hppc.IntHashSet;
+import static com.graphhopper.coll.GHIntObjectHashMap.DETERMINISTIC;
+
+/**
+ * Prefer GHTBitSet or GHBitSetImpl over this class.
+ *
+ * @author Peter Karich
+ */
+public class GHIntHashSet extends IntHashSet {
+
+    public GHIntHashSet() {
+        super(10, 0.75, DETERMINISTIC);
+    }
+
+    public GHIntHashSet(int capacity) {
+        super(capacity, 0.75, DETERMINISTIC);
+    }
+
+    public GHIntHashSet(int capacity, double loadFactor) {
+        super(capacity, loadFactor, DETERMINISTIC);
+    }
+
+    public GHIntHashSet(int capacity, double loadFactor, HashOrderMixingStrategy hashOrderMixer) {
+        super(capacity, loadFactor, hashOrderMixer);
+    }
+
+    public GHIntHashSet(IntContainer container) {
+        this(container.size());
+        addAll(container);
+    }
+
+    public static IntHashSet from(int... elements) {
+        final GHIntHashSet set = new GHIntHashSet(elements.length);
+        set.addAll(elements);
+        return set;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHIntLongHashMap.java b/core/src/main/java/com/graphhopper/coll/GHIntLongHashMap.java
new file mode 100644
index 0000000000..7a7d810d2d
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHIntLongHashMap.java
@@ -0,0 +1,44 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.HashOrderMixingStrategy;
+import com.carrotsearch.hppc.IntLongHashMap;
+import static com.graphhopper.coll.GHIntObjectHashMap.DETERMINISTIC;
+
+/**
+ *
+ * @author Peter Karich
+ */
+public class GHIntLongHashMap extends IntLongHashMap {
+    public GHIntLongHashMap() {
+        super(10, 0.75, DETERMINISTIC);
+    }
+
+    public GHIntLongHashMap(int capacity) {
+        super(capacity, 0.75, DETERMINISTIC);
+    }
+
+    public GHIntLongHashMap(int capacity, double loadFactor) {
+        super(capacity, loadFactor, DETERMINISTIC);
+    }
+
+    public GHIntLongHashMap(int capacity, double loadFactor, HashOrderMixingStrategy hashOrderMixer) {
+        super(capacity, loadFactor, hashOrderMixer);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHIntObjectHashMap.java b/core/src/main/java/com/graphhopper/coll/GHIntObjectHashMap.java
new file mode 100644
index 0000000000..6d52e783a0
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHIntObjectHashMap.java
@@ -0,0 +1,47 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.HashOrderMixing;
+import com.carrotsearch.hppc.HashOrderMixingStrategy;
+
+/**
+ * We often do not mix maps but really need to avoid randomness or that threads can influence each
+ * other and so we do not use the default HashOrderMixing employed in HPPC (which does this in a thread-safe manner).
+ *
+ * @author Peter Karich
+ */
+public class GHIntObjectHashMap<T> extends com.carrotsearch.hppc.IntObjectHashMap<T> {
+    static final HashOrderMixingStrategy DETERMINISTIC = HashOrderMixing.constant(123321123321123312L);
+
+    public GHIntObjectHashMap() {
+        super(10, 0.75, DETERMINISTIC);
+    }
+
+    public GHIntObjectHashMap(int capacity) {
+        super(capacity, 0.75, DETERMINISTIC);
+    }
+
+    public GHIntObjectHashMap(int capacity, double loadFactor) {
+        super(capacity, loadFactor, DETERMINISTIC);
+    }
+
+    public GHIntObjectHashMap(int capacity, double loadFactor, HashOrderMixingStrategy hashOrderMixer) {
+        super(capacity, loadFactor, hashOrderMixer);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHLongHashSet.java b/core/src/main/java/com/graphhopper/coll/GHLongHashSet.java
new file mode 100644
index 0000000000..7e93db140d
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHLongHashSet.java
@@ -0,0 +1,44 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.HashOrderMixingStrategy;
+import com.carrotsearch.hppc.LongHashSet;
+import static com.graphhopper.coll.GHIntObjectHashMap.DETERMINISTIC;
+
+/**
+ *
+ * @author Peter Karich
+ */
+public class GHLongHashSet extends LongHashSet {
+    public GHLongHashSet() {
+        super(10, 0.75, DETERMINISTIC);
+    }
+
+    public GHLongHashSet(int capacity) {
+        super(capacity, 0.75, DETERMINISTIC);
+    }
+
+    public GHLongHashSet(int capacity, double loadFactor) {
+        super(capacity, loadFactor, DETERMINISTIC);
+    }
+
+    public GHLongHashSet(int capacity, double loadFactor, HashOrderMixingStrategy hashOrderMixer) {
+        super(capacity, loadFactor, hashOrderMixer);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHLongLongHashMap.java b/core/src/main/java/com/graphhopper/coll/GHLongLongHashMap.java
new file mode 100644
index 0000000000..a0d2667eb3
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHLongLongHashMap.java
@@ -0,0 +1,44 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.HashOrderMixingStrategy;
+import com.carrotsearch.hppc.LongLongHashMap;
+import static com.graphhopper.coll.GHIntObjectHashMap.DETERMINISTIC;
+
+/**
+ *
+ * @author Peter Karich
+ */
+public class GHLongLongHashMap extends LongLongHashMap {
+    public GHLongLongHashMap() {
+        super(10, 0.75, DETERMINISTIC);
+    }
+
+    public GHLongLongHashMap(int capacity) {
+        super(capacity, 0.75, DETERMINISTIC);
+    }
+
+    public GHLongLongHashMap(int capacity, double loadFactor) {
+        super(capacity, loadFactor, DETERMINISTIC);
+    }
+
+    public GHLongLongHashMap(int capacity, double loadFactor, HashOrderMixingStrategy hashOrderMixer) {
+        super(capacity, loadFactor, hashOrderMixer);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHLongObjectHashMap.java b/core/src/main/java/com/graphhopper/coll/GHLongObjectHashMap.java
new file mode 100644
index 0000000000..13275f1674
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHLongObjectHashMap.java
@@ -0,0 +1,44 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.HashOrderMixingStrategy;
+import com.carrotsearch.hppc.LongObjectHashMap;
+import static com.graphhopper.coll.GHIntObjectHashMap.DETERMINISTIC;
+
+/**
+ *
+ * @author Peter Karich
+ */
+public class GHLongObjectHashMap<T> extends LongObjectHashMap<T> {
+    public GHLongObjectHashMap() {
+        super(10, 0.75, DETERMINISTIC);
+    }
+
+    public GHLongObjectHashMap(int capacity) {
+        super(capacity, 0.75, DETERMINISTIC);
+    }
+
+    public GHLongObjectHashMap(int capacity, double loadFactor) {
+        super(capacity, loadFactor, DETERMINISTIC);
+    }
+
+    public GHLongObjectHashMap(int capacity, double loadFactor, HashOrderMixingStrategy hashOrderMixer) {
+        super(capacity, loadFactor, hashOrderMixer);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHObjectIntHashMap.java b/core/src/main/java/com/graphhopper/coll/GHObjectIntHashMap.java
new file mode 100644
index 0000000000..cbf0144361
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/coll/GHObjectIntHashMap.java
@@ -0,0 +1,50 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import com.carrotsearch.hppc.HashOrderMixingStrategy;
+import com.carrotsearch.hppc.ObjectIntAssociativeContainer;
+import com.carrotsearch.hppc.ObjectIntHashMap;
+import static com.graphhopper.coll.GHIntObjectHashMap.DETERMINISTIC;
+
+/**
+ *
+ * @author Peter Karich
+ */
+public class GHObjectIntHashMap<T> extends ObjectIntHashMap<T> {
+    public GHObjectIntHashMap() {
+        super(10, 0.75, DETERMINISTIC);
+    }
+
+    public GHObjectIntHashMap(int capacity) {
+        super(capacity, 0.75, DETERMINISTIC);
+    }
+
+    public GHObjectIntHashMap(int capacity, double loadFactor) {
+        super(capacity, loadFactor, DETERMINISTIC);
+    }
+
+    public GHObjectIntHashMap(int capacity, double loadFactor, HashOrderMixingStrategy hashOrderMixer) {
+        super(capacity, loadFactor, hashOrderMixer);
+    }
+
+    public GHObjectIntHashMap(ObjectIntAssociativeContainer container) {
+        this(container.size());
+        putAll(container);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/coll/GHSortedCollection.java b/core/src/main/java/com/graphhopper/coll/GHSortedCollection.java
index 16bf8a2b61..4ee75c3c4e 100644
--- a/core/src/main/java/com/graphhopper/coll/GHSortedCollection.java
+++ b/core/src/main/java/com/graphhopper/coll/GHSortedCollection.java
@@ -17,9 +17,10 @@
  */
 package com.graphhopper.coll;
 
-import gnu.trove.iterator.TIntIterator;
-import gnu.trove.set.hash.TIntHashSet;
-
+import com.carrotsearch.hppc.LongArrayList;
+import com.carrotsearch.hppc.cursors.IntCursor;
+import com.carrotsearch.hppc.predicates.IntPredicate;
+import java.util.Iterator;
 import java.util.Map.Entry;
 import java.util.TreeMap;
 
@@ -32,12 +33,12 @@
  */
 public class GHSortedCollection {
     private final int slidingMeanValue = 20;
-    private final TreeMap<Integer, TIntHashSet> map;
+    private final TreeMap<Integer, GHIntHashSet> map;
     private int size;
 
     public GHSortedCollection() {
         // use size as indicator for maxEntries => try radix sort?
-        map = new TreeMap<Integer, TIntHashSet>();
+        map = new TreeMap<Integer, GHIntHashSet>();
     }
 
     public void clear() {
@@ -46,7 +47,7 @@ public void clear() {
     }
 
     void remove(int key, int value) {
-        TIntHashSet set = map.get(value);
+        GHIntHashSet set = map.get(value);
         if (set == null || !set.remove(key)) {
             throw new IllegalStateException("cannot remove key " + key + " with value " + value
                     + " - did you insert " + key + "," + value + " before?");
@@ -63,9 +64,9 @@ public void update(int key, int oldValue, int value) {
     }
 
     public void insert(int key, int value) {
-        TIntHashSet set = map.get(value);
+        GHIntHashSet set = map.get(value);
         if (set == null) {
-            map.put(value, set = new TIntHashSet(slidingMeanValue));
+            map.put(value, set = new GHIntHashSet(slidingMeanValue));
         }
 //        else
 //            slidingMeanValue = Math.max(5, (slidingMeanValue + set.size()) / 2);
@@ -79,7 +80,7 @@ public int peekValue() {
         if (size == 0) {
             throw new IllegalStateException("collection is already empty!?");
         }
-        Entry<Integer, TIntHashSet> e = map.firstEntry();
+        Entry<Integer, GHIntHashSet> e = map.firstEntry();
         if (e.getValue().isEmpty()) {
             throw new IllegalStateException("internal set is already empty!?");
         }
@@ -90,11 +91,11 @@ public int peekKey() {
         if (size == 0) {
             throw new IllegalStateException("collection is already empty!?");
         }
-        TIntHashSet set = map.firstEntry().getValue();
+        GHIntHashSet set = map.firstEntry().getValue();
         if (set.isEmpty()) {
             throw new IllegalStateException("internal set is already empty!?");
         }
-        return set.iterator().next();
+        return set.iterator().next().value;
     }
 
     /**
@@ -105,14 +106,16 @@ public int pollKey() {
         if (size < 0) {
             throw new IllegalStateException("collection is already empty!?");
         }
-        Entry<Integer, TIntHashSet> e = map.firstEntry();
-        TIntHashSet set = e.getValue();
-        TIntIterator iter = set.iterator();
+
+        Entry<Integer, GHIntHashSet> e = map.firstEntry();
+        GHIntHashSet set = e.getValue();
         if (set.isEmpty()) {
             throw new IllegalStateException("internal set is already empty!?");
         }
-        int val = iter.next();
-        iter.remove();
+
+        Iterator<IntCursor> iter = set.iterator();
+        final int val = iter.next().value;        
+        set.remove(val);
         if (set.isEmpty()) {
             map.remove(e.getKey());
         }
@@ -135,7 +138,7 @@ public int getSlidingMeanValue() {
     public String toString() {
         int min = Integer.MAX_VALUE;
         int max = Integer.MIN_VALUE;
-        for (Entry<Integer, TIntHashSet> e : map.entrySet()) {
+        for (Entry<Integer, GHIntHashSet> e : map.entrySet()) {
             int tmpSize = e.getValue().size();
             if (min > tmpSize) {
                 min = tmpSize;
diff --git a/core/src/main/java/com/graphhopper/coll/GHTBitSet.java b/core/src/main/java/com/graphhopper/coll/GHTBitSet.java
index 0cf1c615d3..77498a2e46 100644
--- a/core/src/main/java/com/graphhopper/coll/GHTBitSet.java
+++ b/core/src/main/java/com/graphhopper/coll/GHTBitSet.java
@@ -17,24 +17,24 @@
  */
 package com.graphhopper.coll;
 
-import gnu.trove.iterator.TIntIterator;
-import gnu.trove.set.hash.TIntHashSet;
+import com.carrotsearch.hppc.cursors.IntCursor;
+import java.util.Iterator;
 
 /**
- * Implements the bitset interface via a trove THashSet. More efficient for a few entries.
+ * Implements the bitset interface via a hash set. It is more efficient for only a few entries.
  * <p>
  *
  * @author Peter Karich
  */
 public class GHTBitSet implements GHBitSet {
-    private final TIntHashSet tHash;
+    private final GHIntHashSet tHash;
 
-    public GHTBitSet(TIntHashSet set) {
+    public GHTBitSet(GHIntHashSet set) {
         tHash = set;
     }
 
     public GHTBitSet(int no) {
-        tHash = new TIntHashSet(no, 0.7f, -1);
+        tHash = new GHIntHashSet(no, 0.7f);
     }
 
     public GHTBitSet() {
@@ -77,9 +77,9 @@ public final GHBitSet copyTo(GHBitSet bs) {
         if (bs instanceof GHTBitSet) {
             ((GHTBitSet) bs).tHash.addAll(this.tHash);
         } else {
-            TIntIterator iter = tHash.iterator();
+            Iterator<IntCursor> iter = tHash.iterator();
             while (iter.hasNext()) {
-                bs.add(iter.next());
+                bs.add(iter.next().value);
             }
         }
         return bs;
diff --git a/core/src/main/java/com/graphhopper/coll/SparseIntIntArray.java b/core/src/main/java/com/graphhopper/coll/SparseIntIntArray.java
index a60d8fd920..066a66c70d 100644
--- a/core/src/main/java/com/graphhopper/coll/SparseIntIntArray.java
+++ b/core/src/main/java/com/graphhopper/coll/SparseIntIntArray.java
@@ -75,7 +75,7 @@ static int binarySearch(int[] a, int start, int len, int key) {
     }
 
     /**
-     * Gets the Object mapped from the specified key, or <code>null</code> if no such mapping has
+     * Gets the Object mapped from the specified key, or <code>-1</code> if no such mapping has
      * been made.
      */
     public int get(int key) {
diff --git a/core/src/main/java/com/graphhopper/debatty/java/stringsimilarity/JaroWinkler.java b/core/src/main/java/com/graphhopper/debatty/java/stringsimilarity/JaroWinkler.java
new file mode 100644
index 0000000000..f73c51bf1d
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/debatty/java/stringsimilarity/JaroWinkler.java
@@ -0,0 +1,153 @@
+/*
+Copyright 2015 Thibault Debatty.
+
+Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
+documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
+rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
+persons to whom the Software is furnished to do so, subject to the following conditions:
+
+The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
+Software.
+
+THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
+WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
+COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
+OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+package com.graphhopper.debatty.java.stringsimilarity;
+
+import java.util.Arrays;
+
+/**
+ * This class is copied from: https://github.com/tdebatty/java-string-similarity/blob/master/src/main/java/info/debatty/java/stringsimilarity/JaroWinkler.java
+ * and slightly modified. *
+ *
+ * The Jaro–Winkler distance metric is designed and best suited for short
+ * strings such as person names, and to detect typos; it is (roughly) a
+ * variation of Damerau-Levenshtein, where the substitution of 2 close
+ * characters is considered less important then the substitution of 2 characters
+ * that a far from each other.
+ * Jaro-Winkler was developed in the area of record linkage (duplicate
+ * detection) (Winkler, 1990). It returns a value in the interval [0.0, 1.0].
+ * The distance is computed as 1 - Jaro-Winkler similarity.
+ * @author Thibault Debatty
+ */
+public class JaroWinkler {
+
+    private static final double DEFAULT_THRESHOLD = 0.7;
+    private static final int THREE = 3;
+    private static final double JW_COEF = 0.1;
+    private final double threshold;
+
+    /**
+     * Instantiate with default threshold (0.7).
+     *
+     */
+    public JaroWinkler() {
+        this.threshold = DEFAULT_THRESHOLD;
+    }
+
+    /**
+     * Instantiate with given threshold to determine when Winkler bonus should
+     * be used.
+     * Set threshold to a negative value to get the Jaro distance.
+     */
+    public JaroWinkler(final double threshold) {
+        this.threshold = threshold;
+    }
+
+    /**
+     * Returns the current value of the threshold used for adding the Winkler
+     * bonus. The default value is 0.7.
+     *
+     * @return the current value of the threshold
+     */
+    public final double getThreshold() {
+        return threshold;
+    }
+
+    /**
+     * Compute JW similarity.
+     */
+    public final double similarity(final String s1, final String s2) {
+        int[] mtp = matches(s1, s2);
+        float m = mtp[0];
+        if (m == 0) {
+            return 0f;
+        }
+        double j = ((m / s1.length() + m / s2.length() + (m - mtp[1]) / m))
+                / THREE;
+        double jw = j;
+
+        if (j > getThreshold()) {
+            jw = j + Math.min(JW_COEF, 1.0 / mtp[THREE]) * mtp[2] * (1 - j);
+        }
+        return jw;
+    }
+
+
+    /**
+     * Return 1 - similarity.
+     */
+    public final double distance(final String s1, final String s2) {
+        return 1.0 - similarity(s1, s2);
+    }
+
+    private int[] matches(final String s1, final String s2) {
+        String max, min;
+        if (s1.length() > s2.length()) {
+            max = s1;
+            min = s2;
+        } else {
+            max = s2;
+            min = s1;
+        }
+        int range = Math.max(max.length() / 2 - 1, 0);
+        int[] matchIndexes = new int[min.length()];
+        Arrays.fill(matchIndexes, -1);
+        boolean[] matchFlags = new boolean[max.length()];
+        int matches = 0;
+        for (int mi = 0; mi < min.length(); mi++) {
+            char c1 = min.charAt(mi);
+            for (int xi = Math.max(mi - range, 0),
+                 xn = Math.min(mi + range + 1, max.length()); xi < xn; xi++) {
+                if (!matchFlags[xi] && c1 == max.charAt(xi)) {
+                    matchIndexes[mi] = xi;
+                    matchFlags[xi] = true;
+                    matches++;
+                    break;
+                }
+            }
+        }
+        char[] ms1 = new char[matches];
+        char[] ms2 = new char[matches];
+        for (int i = 0, si = 0; i < min.length(); i++) {
+            if (matchIndexes[i] != -1) {
+                ms1[si] = min.charAt(i);
+                si++;
+            }
+        }
+        for (int i = 0, si = 0; i < max.length(); i++) {
+            if (matchFlags[i]) {
+                ms2[si] = max.charAt(i);
+                si++;
+            }
+        }
+        int transpositions = 0;
+        for (int mi = 0; mi < ms1.length; mi++) {
+            if (ms1[mi] != ms2[mi]) {
+                transpositions++;
+            }
+        }
+        int prefix = 0;
+        for (int mi = 0; mi < min.length(); mi++) {
+            if (s1.charAt(mi) == s2.charAt(mi)) {
+                prefix++;
+            } else {
+                break;
+            }
+        }
+        return new int[]{matches, transpositions / 2, prefix, max.length()};
+    }
+
+}
diff --git a/core/src/main/java/com/graphhopper/geohash/SpatialKeyAlgo.java b/core/src/main/java/com/graphhopper/geohash/SpatialKeyAlgo.java
index 49b08fef9d..73abc1cafb 100644
--- a/core/src/main/java/com/graphhopper/geohash/SpatialKeyAlgo.java
+++ b/core/src/main/java/com/graphhopper/geohash/SpatialKeyAlgo.java
@@ -28,7 +28,7 @@
  * <p>
  * lat0 lon0 | lat1 lon1 | lat2 lon2
  * <p>
- * This works similar to how BIG endianess works for bytes to int packing. Detailed information is
+ * This works similar to how BIG endianness works for bytes to int packing. Detailed information is
  * available in this blog post:
  * http://karussell.wordpress.com/2012/05/23/spatial-keys-memory-efficient-geohashes/
  * <p>
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/GHson.java b/core/src/main/java/com/graphhopper/json/GHJson.java
similarity index 97%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/GHson.java
rename to core/src/main/java/com/graphhopper/json/GHJson.java
index 7225ce9f93..76ac65ff63 100644
--- a/reader-overlay-data/src/main/java/com/graphhopper/json/GHson.java
+++ b/core/src/main/java/com/graphhopper/json/GHJson.java
@@ -25,7 +25,7 @@
  *
  * @author Peter Karich
  */
-public interface GHson {
+public interface GHJson {
     /**
      * This method reads JSON data from the provided source and creates an instance of the provided
      * class.
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/Geometry.java b/core/src/main/java/com/graphhopper/json/geo/Geometry.java
similarity index 91%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/geo/Geometry.java
rename to core/src/main/java/com/graphhopper/json/geo/Geometry.java
index e8eeefb72d..0427332dea 100644
--- a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/Geometry.java
+++ b/core/src/main/java/com/graphhopper/json/geo/Geometry.java
@@ -21,6 +21,8 @@
 import com.graphhopper.util.shapes.GHPoint;
 
 /**
+ * This interface is used to define an area or location being used to block or change areas in the graph.
+ *
  * @author Peter Karich
  */
 public interface Geometry {
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/JsonFeature.java b/core/src/main/java/com/graphhopper/json/geo/JsonFeature.java
similarity index 75%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/geo/JsonFeature.java
rename to core/src/main/java/com/graphhopper/json/geo/JsonFeature.java
index 466d30a3a7..28ab5f7c10 100644
--- a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/JsonFeature.java
+++ b/core/src/main/java/com/graphhopper/json/geo/JsonFeature.java
@@ -22,14 +22,24 @@
 import java.util.Map;
 
 /**
+ * This class defines a properties where a geometry is associated. Typically read from GeoJSON but also from in-memory is possible.
+ *
  * @author Peter Karich
  */
 public class JsonFeature {
-    String id;
-    String type;
-    BBox bbox;
-    Geometry geometry;
-    Map<String, Object> properties;
+    final String id;
+    final String type;
+    final BBox bbox;
+    final Geometry geometry;
+    final Map<String, Object> properties;
+
+    public JsonFeature(String id, String type, BBox bbox, Geometry geometry, Map<String, Object> properties) {
+        this.id = id;
+        this.type = type;
+        this.bbox = bbox;
+        this.geometry = geometry;
+        this.properties = properties;
+    }
 
     public String getId() {
         return id;
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/JsonFeatureCollection.java b/core/src/main/java/com/graphhopper/json/geo/JsonFeatureCollection.java
similarity index 100%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/geo/JsonFeatureCollection.java
rename to core/src/main/java/com/graphhopper/json/geo/JsonFeatureCollection.java
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/LineString.java b/core/src/main/java/com/graphhopper/json/geo/LineString.java
similarity index 100%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/geo/LineString.java
rename to core/src/main/java/com/graphhopper/json/geo/LineString.java
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/Point.java b/core/src/main/java/com/graphhopper/json/geo/Point.java
similarity index 100%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/geo/Point.java
rename to core/src/main/java/com/graphhopper/json/geo/Point.java
diff --git a/core/src/main/java/com/graphhopper/reader/ReaderElement.java b/core/src/main/java/com/graphhopper/reader/ReaderElement.java
index 2f7cd6b2e6..b21c8e296b 100644
--- a/core/src/main/java/com/graphhopper/reader/ReaderElement.java
+++ b/core/src/main/java/com/graphhopper/reader/ReaderElement.java
@@ -37,11 +37,16 @@
     public static final int FILEHEADER = 3;
     private final int type;
     private final long id;
-    private final Map<String, Object> properties = new HashMap<String, Object>(5);
+    private final Map<String, Object> properties;
 
     protected ReaderElement(long id, int type) {
+        this(id, type, 4);
+    }
+
+    protected ReaderElement(long id, int type, int propertyMapSize) {
         this.id = id;
         this.type = type;
+        properties = new HashMap<>(propertyMapSize);
     }
 
     public long getId() {
diff --git a/core/src/main/java/com/graphhopper/reader/ReaderRelation.java b/core/src/main/java/com/graphhopper/reader/ReaderRelation.java
index 32f1a7e959..d42157f3ee 100644
--- a/core/src/main/java/com/graphhopper/reader/ReaderRelation.java
+++ b/core/src/main/java/com/graphhopper/reader/ReaderRelation.java
@@ -18,6 +18,7 @@
 package com.graphhopper.reader;
 
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.List;
 
 /**
@@ -27,54 +28,37 @@
  * @author Nop
  */
 public class ReaderRelation extends ReaderElement {
-    protected final List<Member> members = new ArrayList<Member>(5);
+    protected List<Member> members;
 
     public ReaderRelation(long id) {
-        super(id, RELATION);
+        super(id, RELATION, 2);
     }
 
     @Override
     public String toString() {
-        return "Relation (" + getId() + ", " + members.size() + " members)";
+        return "Relation (" + getId() + ", " + ((members == null) ? 0 : members.size()) + " members)";
     }
 
     public List<Member> getMembers() {
+        if (members == null)
+            return Collections.emptyList();
+
         return members;
     }
 
     public boolean isMetaRelation() {
-        for (Member member : members) {
-            if (member.getType() == RELATION) {
-                return true;
+        if (members != null)
+            for (Member member : members) {
+                if (member.getType() == RELATION) {
+                    return true;
+                }
             }
-        }
         return false;
     }
 
-    public boolean isMixedRelation() {
-        boolean hasRel = false;
-        boolean hasOther = false;
-
-        for (Member member : members) {
-            if (member.getType() == RELATION)
-                hasRel = true;
-            else
-                hasOther = true;
-
-            if (hasRel && hasOther)
-                return true;
-        }
-        return false;
-    }
-
-    public void removeRelations() {
-        for (int i = members.size() - 1; i >= 0; i--) {
-            if (members.get(i).getType() == RELATION)
-                members.remove(i);
-        }
-    }
-
     public void add(Member member) {
+        if (members == null)
+            members = new ArrayList<>(3);
         members.add(member);
     }
 
@@ -89,12 +73,6 @@ public void add(Member member) {
         private final long ref;
         private final String role;
 
-        public Member(Member input) {
-            type = input.type;
-            ref = input.ref;
-            role = input.role;
-        }
-
         public Member(int type, long ref, String role) {
             this.type = type;
             this.ref = ref;
diff --git a/core/src/main/java/com/graphhopper/reader/ReaderWay.java b/core/src/main/java/com/graphhopper/reader/ReaderWay.java
index 4a40fe3126..eb7e2ca0e6 100644
--- a/core/src/main/java/com/graphhopper/reader/ReaderWay.java
+++ b/core/src/main/java/com/graphhopper/reader/ReaderWay.java
@@ -17,8 +17,7 @@
  */
 package com.graphhopper.reader;
 
-import gnu.trove.list.TLongList;
-import gnu.trove.list.array.TLongArrayList;
+import com.carrotsearch.hppc.LongArrayList;
 
 /**
  * Represents a way received from the reader.
@@ -27,13 +26,13 @@
  * @author Nop
  */
 public class ReaderWay extends ReaderElement {
-    protected final TLongList nodes = new TLongArrayList(5);
+    protected final LongArrayList nodes = new LongArrayList(5);
 
     public ReaderWay(long id) {
         super(id, WAY);
     }
 
-    public TLongList getNodes() {
+    public LongArrayList getNodes() {
         return nodes;
     }
 
diff --git a/core/src/main/java/com/graphhopper/reader/dem/AbstractEdgeElevationInterpolator.java b/core/src/main/java/com/graphhopper/reader/dem/AbstractEdgeElevationInterpolator.java
new file mode 100644
index 0000000000..b74808e279
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/reader/dem/AbstractEdgeElevationInterpolator.java
@@ -0,0 +1,159 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import com.carrotsearch.hppc.IntSet;
+import com.graphhopper.coll.GHBitSet;
+import com.graphhopper.coll.GHBitSetImpl;
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.routing.util.AllEdgesIterator;
+import com.graphhopper.routing.util.DataFlagEncoder;
+import com.graphhopper.storage.GraphHopperStorage;
+import com.graphhopper.storage.NodeAccess;
+import com.graphhopper.util.BreadthFirstSearch;
+import com.graphhopper.util.EdgeExplorer;
+import com.graphhopper.util.EdgeIterator;
+import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.util.PointList;
+
+/**
+ * Abstract base class for tunnel/bridge edge elevation interpolators. This
+ * class estimates elevation of inner nodes of a tunnel/bridge based on
+ * elevations of entry nodes. See #713 for more information.
+ *
+ * <p>
+ * Since inner nodes of tunnel or bridge do not lie on the Earth surface, we
+ * should not use elevations returned by the elevation provider for these
+ * points. Instead, we'll estimate elevations of these points based on
+ * elevations of entry/exit nodes of the tunnel/bridge.
+ * <p>
+ * To do this, we'll iterate over the graph looking for tunnel or bridge edges
+ * using {@link #isInterpolatableEdge(EdgeIteratorState)}. Once such an edge is
+ * found, we'll calculate a connected component of tunnel/bridge edges starting
+ * from the base node of this edge, using simple {@link BreadthFirstSearch}.
+ * Nodes which only have interpolatabe edges connected to them are inner nodes
+ * and are considered to not lie on the Earth surface. Nodes which also have
+ * non-interpolatable edges are outer nodes and are considered to lie on the
+ * Earth surface. Elevations of inner nodes are then interpolated from the outer
+ * nodes using {@link NodeElevationInterpolator}. Elevations of pillar nodes are
+ * calculated using linear interpolation on distances from tower nodes.
+ *
+ * @author Alexey Valikov
+ */
+public abstract class AbstractEdgeElevationInterpolator {
+
+    private final GraphHopperStorage storage;
+    protected final DataFlagEncoder dataFlagEncoder;
+    private final NodeElevationInterpolator nodeElevationInterpolator;
+    private final ElevationInterpolator elevationInterpolator = new ElevationInterpolator();
+
+    public AbstractEdgeElevationInterpolator(GraphHopperStorage storage,
+                                             DataFlagEncoder dataFlagEncoder) {
+        this.storage = storage;
+        this.dataFlagEncoder = dataFlagEncoder;
+        this.nodeElevationInterpolator = new NodeElevationInterpolator(storage);
+    }
+
+    protected abstract boolean isInterpolatableEdge(EdgeIteratorState edge);
+
+    public GraphHopperStorage getStorage() {
+        return storage;
+    }
+
+    public void execute() {
+        interpolateElevationsOfTowerNodes();
+        interpolateElevationsOfPillarNodes();
+    }
+
+    private void interpolateElevationsOfTowerNodes() {
+        final AllEdgesIterator edge = storage.getAllEdges();
+        final GHBitSet visitedEdgeIds = new GHBitSetImpl(edge.getMaxId());
+        final EdgeExplorer edgeExplorer = storage.createEdgeExplorer();
+
+        while (edge.next()) {
+            final int edgeId = edge.getEdge();
+            if (isInterpolatableEdge(edge)) {
+                if (!visitedEdgeIds.contains(edgeId)) {
+                    interpolateEdge(edge, visitedEdgeIds, edgeExplorer);
+                }
+            }
+            visitedEdgeIds.add(edgeId);
+        }
+    }
+
+    private void interpolateEdge(final EdgeIteratorState interpolatableEdge,
+                                 final GHBitSet visitedEdgeIds, final EdgeExplorer edgeExplorer) {
+        final IntSet outerNodeIds = new GHIntHashSet();
+        final GHIntHashSet innerNodeIds = new GHIntHashSet();
+        gatherOuterAndInnerNodeIds(edgeExplorer, interpolatableEdge, visitedEdgeIds, outerNodeIds,
+                innerNodeIds);
+        nodeElevationInterpolator.interpolateElevationsOfInnerNodes(outerNodeIds.toArray(),
+                innerNodeIds.toArray());
+    }
+
+    public void gatherOuterAndInnerNodeIds(final EdgeExplorer edgeExplorer,
+                                           final EdgeIteratorState interpolatableEdge, final GHBitSet visitedEdgesIds,
+                                           final IntSet outerNodeIds, final GHIntHashSet innerNodeIds) {
+        final BreadthFirstSearch gatherOuterAndInnerNodeIdsSearch = new BreadthFirstSearch() {
+            @Override
+            protected boolean checkAdjacent(EdgeIteratorState edge) {
+                visitedEdgesIds.add(edge.getEdge());
+                final int baseNodeId = edge.getBaseNode();
+                boolean isInterpolatableEdge = isInterpolatableEdge(edge);
+                if (!isInterpolatableEdge) {
+                    innerNodeIds.remove(baseNodeId);
+                    outerNodeIds.add(baseNodeId);
+                } else if (!outerNodeIds.contains(baseNodeId)) {
+                    innerNodeIds.add(baseNodeId);
+                }
+                return isInterpolatableEdge;
+            }
+        };
+        gatherOuterAndInnerNodeIdsSearch.start(edgeExplorer, interpolatableEdge.getBaseNode());
+    }
+
+    private void interpolateElevationsOfPillarNodes() {
+        final EdgeIterator edge = storage.getAllEdges();
+        final NodeAccess nodeAccess = storage.getNodeAccess();
+        while (edge.next()) {
+            if (isInterpolatableEdge(edge)) {
+                int firstNodeId = edge.getBaseNode();
+                int secondNodeId = edge.getAdjNode();
+
+                double lat0 = nodeAccess.getLat(firstNodeId);
+                double lon0 = nodeAccess.getLon(firstNodeId);
+                double ele0 = nodeAccess.getEle(firstNodeId);
+
+                double lat1 = nodeAccess.getLat(secondNodeId);
+                double lon1 = nodeAccess.getLon(secondNodeId);
+                double ele1 = nodeAccess.getEle(secondNodeId);
+
+                final PointList pointList = edge.fetchWayGeometry(0);
+                final int count = pointList.size();
+                for (int index = 0; index < count; index++) {
+                    double lat = pointList.getLat(index);
+                    double lon = pointList.getLon(index);
+                    double ele = elevationInterpolator.calculateElevationBasedOnTwoPoints(lat, lon,
+                            lat0, lon0, ele0, lat1, lon1, ele1);
+                    pointList.set(index, lat, lon, ele);
+                }
+                edge.setWayGeometry(pointList);
+            }
+        }
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/reader/dem/BridgeElevationInterpolator.java b/core/src/main/java/com/graphhopper/reader/dem/BridgeElevationInterpolator.java
new file mode 100644
index 0000000000..33885583a5
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/reader/dem/BridgeElevationInterpolator.java
@@ -0,0 +1,41 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import com.graphhopper.routing.util.DataFlagEncoder;
+import com.graphhopper.storage.GraphHopperStorage;
+import com.graphhopper.util.EdgeIteratorState;
+
+/**
+ * Elevation interpolator for bridges. Estimates elevations of inner nodes of
+ * the bridge based on elevations of entry/exit nodes of the bridge.
+ *
+ * @author Alexey Valikov
+ */
+public class BridgeElevationInterpolator extends AbstractEdgeElevationInterpolator {
+
+    public BridgeElevationInterpolator(GraphHopperStorage storage,
+                    DataFlagEncoder dataFlagEncoder) {
+        super(storage, dataFlagEncoder);
+    }
+
+    @Override
+    protected boolean isInterpolatableEdge(EdgeIteratorState edge) {
+        return dataFlagEncoder.isTransportModeBridge(edge);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/reader/dem/ElevationInterpolator.java b/core/src/main/java/com/graphhopper/reader/dem/ElevationInterpolator.java
new file mode 100644
index 0000000000..a92c71e652
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/reader/dem/ElevationInterpolator.java
@@ -0,0 +1,152 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import com.graphhopper.util.PointList;
+import static com.graphhopper.util.Helper.round2;
+
+/**
+ * Elevation interpolator calculates elevation for the given lat/lon coordinates
+ * based on lat/lon/ele coordinates of the given points.
+ * 
+ * <p>
+ * In case of two points, elevation is calculated using linear interpolation
+ * (see
+ * {@link #calculateElevationBasedOnTwoPoints(double, double, double, double, double, double, double, double)}).
+ * <p>
+ * In case of three points, elevation is calculated using planar interpolation
+ * (see
+ * {@link #calculateElevationBasedOnThreePoints(double, double, double, double, double, double, double, double, double, double, double)}).
+ * <p>
+ * In case of more than three points, elevation is calculated using the
+ * interpolation method described in the
+ * <a href="http://math.stackexchange.com/a/1930758/140512">following post</a>
+ * (see {@link #calculateElevationBasedOnPointList(double, double, PointList)}.
+ *
+ * @author Alexey Valikov
+ */
+
+public class ElevationInterpolator {
+
+    public static final double EPSILON = 0.00001;
+    public static final double EPSILON2 = EPSILON * EPSILON;
+
+    public double calculateElevationBasedOnTwoPoints(double lat, double lon, double lat0,
+                    double lon0, double ele0, double lat1, double lon1, double ele1) {
+        double dlat0 = lat0 - lat;
+        double dlon0 = lon0 - lon;
+        double dlat1 = lat1 - lat;
+        double dlon1 = lon1 - lon;
+        double l0 = Math.sqrt(dlon0 * dlon0 + dlat0 * dlat0);
+        double l1 = Math.sqrt(dlon1 * dlon1 + dlat1 * dlat1);
+        double l = l0 + l1;
+        if (l < EPSILON) {
+            // If points are too close to each other, return elevation of the
+            // point which is closer;
+            return l0 <= l1 ? ele0 : ele1;
+        } else {
+            // Otherwise do linear interpolation
+            return round2(ele0 + (ele1 - ele0) * l0 / l);
+        }
+    }
+
+    public double calculateElevationBasedOnThreePoints(double lat, double lon, double lat0,
+                    double lon0, double ele0, double lat1, double lon1, double ele1, double lat2,
+                    double lon2, double ele2) {
+
+        double dlat10 = lat1 - lat0;
+        double dlon10 = lon1 - lon0;
+        double dele10 = ele1 - ele0;
+        double dlat20 = lat2 - lat0;
+        double dlon20 = lon2 - lon0;
+        double dele20 = ele2 - ele0;
+
+        double a = dlon10 * dele20 - dele10 * dlon20;
+        double b = dele10 * dlat20 - dlat10 * dele20;
+        double c = dlat10 * dlon20 - dlon10 * dlat20;
+
+        if (Math.abs(c) < EPSILON) {
+            double dlat21 = lat2 - lat1;
+            double dlon21 = lon2 - lon1;
+            double dele21 = ele2 - ele1;
+
+            double l10 = dlat10 * dlat10 + dlon10 * dlon10 + dele10 * dele10;
+            double l20 = dlat20 * dlat20 + dlon20 * dlon20 + dele20 * dele20;
+            double l21 = dlat21 * dlat21 + dlon21 * dlon21 + dele21 * dele21;
+
+            if (l21 > l10 && l21 > l20) {
+                return calculateElevationBasedOnTwoPoints(lat, lon, lat1, lon1, ele1, lat2, lon2,
+                                ele2);
+            } else if (l20 > l10 && l20 > l21) {
+                return calculateElevationBasedOnTwoPoints(lat, lon, lat0, lon0, ele0, lat2, lon2,
+                                ele2);
+            } else {
+                return calculateElevationBasedOnTwoPoints(lat, lon, lat0, lon0, ele0, lat1, lon1,
+                                ele1);
+            }
+
+        } else {
+            double d = a * lat0 + b * lon0 + c * ele0;
+            double ele = (d - a * lat - b * lon) / c;
+            return round2(ele);
+        }
+    }
+
+    public double calculateElevationBasedOnPointList(double lat, double lon, PointList pointList) {
+        // See http://math.stackexchange.com/a/1930758/140512 for the
+        // explanation
+        final int size = pointList.size();
+        if (size == 0) {
+            throw new IllegalArgumentException("At least one point is required in the pointList.");
+        } else if (size == 1) {
+            return pointList.getEle(0);
+        } else if (size == 2) {
+            return calculateElevationBasedOnTwoPoints(lat, lon, pointList.getLat(0),
+                            pointList.getLon(0), pointList.getEle(0), pointList.getLat(1),
+                            pointList.getLon(1), pointList.getEle(1));
+        } else if (size == 3) {
+            return calculateElevationBasedOnThreePoints(lat, lon, pointList.getLat(0),
+                            pointList.getLon(0), pointList.getEle(0), pointList.getLat(1),
+                            pointList.getLon(1), pointList.getEle(1), pointList.getLat(2),
+                            pointList.getLon(2), pointList.getEle(2));
+        } else {
+            double[] vs = new double[size];
+            double[] eles = new double[size];
+            double v = 0;
+            for (int index = 0; index < size; index++) {
+                double lati = pointList.getLat(index);
+                double loni = pointList.getLon(index);
+                double dlati = lati - lat;
+                double dloni = loni - lon;
+                double l2 = (dlati * dlati + dloni * dloni);
+                eles[index] = pointList.getEle(index);
+                if (l2 < EPSILON2) {
+                    return eles[index];
+                }
+                vs[index] = 1 / l2;
+                v += vs[index];
+            }
+
+            double ele = 0;
+            for (int index = 0; index < size; index++) {
+                ele += eles[index] * vs[index] / v;
+            }
+            return round2(ele);
+        }
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/reader/dem/ElevationProvider.java b/core/src/main/java/com/graphhopper/reader/dem/ElevationProvider.java
index 5afa5794fa..5c8726cf28 100644
--- a/core/src/main/java/com/graphhopper/reader/dem/ElevationProvider.java
+++ b/core/src/main/java/com/graphhopper/reader/dem/ElevationProvider.java
@@ -56,7 +56,7 @@ public void setCalcMean(boolean eleCalcMean) {
     };
 
     /**
-     * @return returns the hight in meter or Double.NaN if invalid
+     * @return returns the height in meters or Double.NaN if invalid
      */
     double getEle(double lat, double lon);
 
diff --git a/core/src/main/java/com/graphhopper/reader/dem/NodeElevationInterpolator.java b/core/src/main/java/com/graphhopper/reader/dem/NodeElevationInterpolator.java
new file mode 100644
index 0000000000..a255137f03
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/reader/dem/NodeElevationInterpolator.java
@@ -0,0 +1,126 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import com.graphhopper.storage.GraphHopperStorage;
+import com.graphhopper.storage.NodeAccess;
+import com.graphhopper.util.PointList;
+
+/**
+ * Interpolates elevations of inner nodes based on elevations of outer nodes.
+ * 
+ * @author Alexey Valikov
+ */
+public class NodeElevationInterpolator {
+
+    private final GraphHopperStorage storage;
+    private final ElevationInterpolator elevationInterpolator = new ElevationInterpolator();
+
+    public NodeElevationInterpolator(GraphHopperStorage storage) {
+        this.storage = storage;
+    }
+
+    public void interpolateElevationsOfInnerNodes(int[] outerNodeIds, int[] innerNodeIds) {
+        final int numberOfOuterNodes = outerNodeIds.length;
+        if (numberOfOuterNodes == 0) {
+            // do nothing
+        } else if (numberOfOuterNodes == 1) {
+            interpolateElevationsOfInnerNodesForOneOuterNode(outerNodeIds[0], innerNodeIds);
+        } else if (numberOfOuterNodes == 2) {
+            interpolateElevationsOfInnerNodesForTwoOuterNodes(outerNodeIds[0], outerNodeIds[1],
+                            innerNodeIds);
+        } else if (numberOfOuterNodes == 3) {
+            interpolateElevationsOfInnerNodesForThreeOuterNodes(outerNodeIds[0], outerNodeIds[1],
+                            outerNodeIds[2], innerNodeIds);
+        } else if (numberOfOuterNodes > 3) {
+            interpolateElevationsOfInnerNodesForNOuterNodes(outerNodeIds, innerNodeIds);
+        }
+    }
+
+    private void interpolateElevationsOfInnerNodesForOneOuterNode(int outerNodeId,
+                    int[] innerNodeIds) {
+        NodeAccess nodeAccess = storage.getNodeAccess();
+        double ele = nodeAccess.getEle(outerNodeId);
+        for (int innerNodeId : innerNodeIds) {
+            double lat = nodeAccess.getLat(innerNodeId);
+            double lon = nodeAccess.getLon(innerNodeId);
+            nodeAccess.setNode(innerNodeId, lat, lon, ele);
+        }
+    }
+
+    private void interpolateElevationsOfInnerNodesForTwoOuterNodes(int firstOuterNodeId,
+                    int secondOuterNodeId, int[] innerNodeIds) {
+        final NodeAccess nodeAccess = storage.getNodeAccess();
+        double lat0 = nodeAccess.getLat(firstOuterNodeId);
+        double lon0 = nodeAccess.getLon(firstOuterNodeId);
+        double ele0 = nodeAccess.getEle(firstOuterNodeId);
+
+        double lat1 = nodeAccess.getLat(secondOuterNodeId);
+        double lon1 = nodeAccess.getLon(secondOuterNodeId);
+        double ele1 = nodeAccess.getEle(secondOuterNodeId);
+
+        for (int innerNodeId : innerNodeIds) {
+            double lat = nodeAccess.getLat(innerNodeId);
+            double lon = nodeAccess.getLon(innerNodeId);
+            double ele = elevationInterpolator.calculateElevationBasedOnTwoPoints(lat, lon, lat0,
+                            lon0, ele0, lat1, lon1, ele1);
+            nodeAccess.setNode(innerNodeId, lat, lon, ele);
+        }
+    }
+
+    private void interpolateElevationsOfInnerNodesForThreeOuterNodes(int firstOuterNodeId,
+                    int secondOuterNodeId, int thirdOuterNodeId, int[] innerNodeIds) {
+        NodeAccess nodeAccess = storage.getNodeAccess();
+        double lat0 = nodeAccess.getLat(firstOuterNodeId);
+        double lon0 = nodeAccess.getLon(firstOuterNodeId);
+        double ele0 = nodeAccess.getEle(firstOuterNodeId);
+
+        double lat1 = nodeAccess.getLat(secondOuterNodeId);
+        double lon1 = nodeAccess.getLon(secondOuterNodeId);
+        double ele1 = nodeAccess.getEle(secondOuterNodeId);
+
+        double lat2 = nodeAccess.getLat(thirdOuterNodeId);
+        double lon2 = nodeAccess.getLon(thirdOuterNodeId);
+        double ele2 = nodeAccess.getEle(thirdOuterNodeId);
+
+        for (int innerNodeId : innerNodeIds) {
+            double lat = nodeAccess.getLat(innerNodeId);
+            double lon = nodeAccess.getLon(innerNodeId);
+            double ele = elevationInterpolator.calculateElevationBasedOnThreePoints(lat, lon, lat0,
+                            lon0, ele0, lat1, lon1, ele1, lat2, lon2, ele2);
+            nodeAccess.setNode(innerNodeId, lat, lon, ele);
+        }
+    }
+
+    private void interpolateElevationsOfInnerNodesForNOuterNodes(int[] outerNodeIds,
+                    int[] innerNodeIds) {
+        NodeAccess nodeAccess = storage.getNodeAccess();
+        PointList pointList = new PointList(outerNodeIds.length, true);
+        for (int outerNodeId : outerNodeIds) {
+            pointList.add(nodeAccess.getLat(outerNodeId), nodeAccess.getLon(outerNodeId),
+                            nodeAccess.getEle(outerNodeId));
+        }
+        for (int innerNodeId : innerNodeIds) {
+            double lat = nodeAccess.getLat(innerNodeId);
+            double lon = nodeAccess.getLon(innerNodeId);
+            double ele = elevationInterpolator.calculateElevationBasedOnPointList(lat, lon,
+                            pointList);
+            nodeAccess.setNode(innerNodeId, lat, lon, ele);
+        }
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/reader/dem/SRTMProvider.java b/core/src/main/java/com/graphhopper/reader/dem/SRTMProvider.java
index 88c67bc64d..7c1fc29c16 100644
--- a/core/src/main/java/com/graphhopper/reader/dem/SRTMProvider.java
+++ b/core/src/main/java/com/graphhopper/reader/dem/SRTMProvider.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.reader.dem;
 
+import com.graphhopper.coll.GHIntObjectHashMap;
 import com.graphhopper.storage.DAType;
 import com.graphhopper.storage.DataAccess;
 import com.graphhopper.storage.Directory;
@@ -24,7 +25,6 @@
 import com.graphhopper.util.BitUtil;
 import com.graphhopper.util.Downloader;
 import com.graphhopper.util.Helper;
-import gnu.trove.map.hash.TIntObjectHashMap;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -49,8 +49,8 @@
     private final int DEFAULT_WIDTH = 1201;
     private final int WIDTH_BYTE_INDEX = 0;
     // use a map as an array is not quite useful if we want to hold only parts of the world
-    private final TIntObjectHashMap<HeightTile> cacheData = new TIntObjectHashMap<HeightTile>();
-    private final TIntObjectHashMap<String> areas = new TIntObjectHashMap<String>();
+    private final GHIntObjectHashMap<HeightTile> cacheData = new GHIntObjectHashMap<HeightTile>();
+    private final GHIntObjectHashMap<String> areas = new GHIntObjectHashMap<String>();
     private final double precision = 1e7;
     private final double invPrecision = 1 / precision;
     private Directory dir;
diff --git a/core/src/main/java/com/graphhopper/reader/dem/TunnelElevationInterpolator.java b/core/src/main/java/com/graphhopper/reader/dem/TunnelElevationInterpolator.java
new file mode 100644
index 0000000000..645dce6e99
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/reader/dem/TunnelElevationInterpolator.java
@@ -0,0 +1,41 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import com.graphhopper.routing.util.DataFlagEncoder;
+import com.graphhopper.storage.GraphHopperStorage;
+import com.graphhopper.util.EdgeIteratorState;
+
+/**
+ * Elevation interpolator for tunnels. Estimates elevations of inner nodes of
+ * the tunnel based on elevations of entry/exit nodes of the tunnel.
+ *
+ * @author Alexey Valikov
+ */
+public class TunnelElevationInterpolator extends AbstractEdgeElevationInterpolator {
+
+    public TunnelElevationInterpolator(GraphHopperStorage storage,
+                    DataFlagEncoder dataFlagEncoder) {
+        super(storage, dataFlagEncoder);
+    }
+
+    @Override
+    protected boolean isInterpolatableEdge(EdgeIteratorState edge) {
+        return dataFlagEncoder.isTransportModeTunnel(edge);
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalOSMTagInspector.java b/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalOSMTagInspector.java
index db9d1dd2aa..e150d466c5 100644
--- a/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalOSMTagInspector.java
+++ b/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalOSMTagInspector.java
@@ -33,19 +33,17 @@
 public class ConditionalOSMTagInspector implements ConditionalTagInspector {
     private final Logger logger = LoggerFactory.getLogger(getClass());
     private final List<String> tagsToCheck;
-    private final Map<String, Object> valueMap;
     private final ConditionalParser permitParser, restrictiveParser;
     // enabling by default makes noise but could improve OSM data
     private boolean enabledLogs = true;
 
     public ConditionalOSMTagInspector(Object value, List<String> tagsToCheck,
                                       Set<String> restrictiveValues, Set<String> permittedValues) {
-        this(tagsToCheck, createDefaultMapping(value), restrictiveValues, permittedValues, false);
+        this(tagsToCheck, Arrays.asList(new DateRangeParser((Calendar) value)), restrictiveValues, permittedValues, false);
     }
 
-    public ConditionalOSMTagInspector(List<String> tagsToCheck, Map<String, Object> valueMap,
+    public ConditionalOSMTagInspector(List<String> tagsToCheck, List<? extends ConditionalValueParser> valueParsers,
                                       Set<String> restrictiveValues, Set<String> permittedValues, boolean enabledLogs) {
-        this.valueMap = valueMap;
         this.tagsToCheck = new ArrayList<>(tagsToCheck.size());
         for (String tagToCheck : tagsToCheck) {
             this.tagsToCheck.add(tagToCheck + ":conditional");
@@ -57,13 +55,15 @@ public ConditionalOSMTagInspector(List<String> tagsToCheck, Map<String, Object>
         boolean logUnsupportedFeatures = false;
         this.permitParser = new ConditionalParser(permittedValues, logUnsupportedFeatures);
         this.restrictiveParser = new ConditionalParser(restrictiveValues, logUnsupportedFeatures);
+        for (ConditionalValueParser cvp : valueParsers) {
+            permitParser.addConditionalValueParser(cvp);
+            restrictiveParser.addConditionalValueParser(cvp);
+        }
     }
 
-    static Map<String, Object> createDefaultMapping(Object value) {
-        // parse date range and value is the time
-        Map<String, Object> map = new HashMap<String, Object>(1);
-        map.put(DateRange.KEY, value);
-        return map;
+    public void addValueParser(ConditionalValueParser vp) {
+        permitParser.addConditionalValueParser(vp);
+        restrictiveParser.addConditionalValueParser(vp);
     }
 
     @Override
@@ -84,22 +84,19 @@ protected boolean applies(ReaderWay way, boolean checkPermissiveValues) {
                 continue;
 
             try {
-                ValueRange valueRange;
-                if (checkPermissiveValues)
-                    valueRange = permitParser.getRange(val);
-                else
-                    valueRange = restrictiveParser.getRange(val);
-
-                if (valueRange != null) {
-                    Object value = valueMap.get(valueRange.getKey());
-                    if (value != null && valueRange.isInRange(value))
+                if (checkPermissiveValues) {
+                    if (permitParser.checkCondition(val))
+                        return true;
+                } else {
+                    if (restrictiveParser.checkCondition(val))
                         return true;
                 }
+
             } catch (Exception e) {
                 if (enabledLogs) {
                     // log only if no date ala 21:00 as currently date and numbers do not support time precise restrictions
                     if (!val.contains(":"))
-                        logger.warn(way.getId() + " - could not parse the conditional value:" + val + " of tag:" + tagToCheck + ". Exception:" + e.getMessage());
+                        logger.warn("for way " + way.getId() + " could not parse the conditional value '" + val + "' of tag '" + tagToCheck + "'. Exception:" + e.getMessage());
                 }
             }
         }
diff --git a/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalParser.java b/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalParser.java
index b39009d4bc..81f407d8f2 100644
--- a/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalParser.java
+++ b/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalParser.java
@@ -21,6 +21,9 @@
 import org.slf4j.LoggerFactory;
 
 import java.text.ParseException;
+import java.util.ArrayList;
+import java.util.Calendar;
+import java.util.List;
 import java.util.Set;
 
 /**
@@ -33,6 +36,7 @@
 public class ConditionalParser {
     private final Logger logger = LoggerFactory.getLogger(getClass());
     private final Set<String> restrictedTags;
+    private final List<ConditionalValueParser> valueParsers = new ArrayList<>(5);
     private final boolean enabledLogs;
 
     public ConditionalParser(Set<String> restrictedTags) {
@@ -45,14 +49,69 @@ public ConditionalParser(Set<String> restrictedTags, boolean enabledLogs) {
         this.enabledLogs = enabledLogs;
     }
 
-    public ValueRange getRange(String conditionalTag) throws ParseException {
+    public static ConditionalValueParser createNumberParser(final String assertKey, final Number obj) {
+        return new ConditionalValueParser() {
+            @Override
+            public ConditionState checkCondition(String conditionalValue) throws ParseException {
+                int indexLT = conditionalValue.indexOf("<");
+                if (indexLT > 0 && conditionalValue.length() > 2) {
+                    final String key = conditionalValue.substring(0, indexLT).trim();
+                    if (!assertKey.equals(key))
+                        return ConditionState.INVALID;
+
+                    if (conditionalValue.charAt(indexLT + 1) == '=')
+                        indexLT++;
+                    final double value = parseNumber(conditionalValue.substring(indexLT + 1));
+                    if (obj.doubleValue() < value)
+                        return ConditionState.TRUE;
+                    else
+                        return ConditionState.FALSE;
+                }
+
+                int indexGT = conditionalValue.indexOf(">");
+                if (indexGT > 0 && conditionalValue.length() > 2) {
+                    final String key = conditionalValue.substring(0, indexGT).trim();
+                    if (!assertKey.equals(key))
+                        return ConditionState.INVALID;
+
+                    // for now just ignore equals sign
+                    if (conditionalValue.charAt(indexGT + 1) == '=')
+                        indexGT++;
+
+                    final double value = parseNumber(conditionalValue.substring(indexGT + 1));
+                    if (obj.doubleValue() > value)
+                        return ConditionState.TRUE;
+                    else
+                        return ConditionState.FALSE;
+                }
+
+                return ConditionState.INVALID;
+            }
+        };
+    }
+
+    /**
+     * This method adds a new value parser. The one added last has a higher priority.
+     */
+    public ConditionalParser addConditionalValueParser(ConditionalValueParser vp) {
+        valueParsers.add(0, vp);
+        return this;
+    }
+
+    public ConditionalParser setConditionalValueParser(ConditionalValueParser vp) {
+        valueParsers.clear();
+        valueParsers.add(vp);
+        return this;
+    }
+
+    public boolean checkCondition(String conditionalTag) throws ParseException {
         if (conditionalTag == null || conditionalTag.isEmpty() || !conditionalTag.contains("@"))
-            return null;
+            return false;
 
         if (conditionalTag.contains(";")) {
             if (enabledLogs)
                 logger.warn("We do not support multiple conditions yet: " + conditionalTag);
-            return null;
+            return false;
         }
 
         String[] conditionalArr = conditionalTag.split("@");
@@ -62,59 +121,22 @@ public ValueRange getRange(String conditionalTag) throws ParseException {
 
         String restrictiveValue = conditionalArr[0].trim();
         if (!restrictedTags.contains(restrictiveValue))
-            return null;
-
-        String conditional = conditionalArr[1];
-        conditional = conditional.replace('(', ' ');
-        conditional = conditional.replace(')', ' ');
-        conditional = conditional.trim();
-
-        int index = conditional.indexOf(">");
-        if (index > 0 && conditional.length() > 2) {
-            final String key = conditional.substring(0, index).trim();
-            // for now just ignore equals sign
-            if (conditional.charAt(index + 1) == '=')
-                index++;
-
-            final double value = parseNumber(conditional.substring(index + 1));
-            return new ValueRange<Number>() {
-                @Override
-                public boolean isInRange(Number obj) {
-                    return obj.doubleValue() > value;
-                }
-
-                @Override
-                public String getKey() {
-                    return key;
-                }
-            };
-        }
-
-        index = conditional.indexOf("<");
-        if (index > 0 && conditional.length() > 2) {
-            final String key = conditional.substring(0, index).trim();
-            if (conditional.charAt(index + 1) == '=')
-                index++;
+            return false;
 
-            final double value = parseNumber(conditional.substring(index + 1));
-            return new ValueRange<Number>() {
+        String conditionalValue = conditionalArr[1];
+        conditionalValue = conditionalValue.replace('(', ' ');
+        conditionalValue = conditionalValue.replace(')', ' ');
+        conditionalValue = conditionalValue.trim();
 
-                @Override
-                public boolean isInRange(Number obj) {
-                    return obj.doubleValue() < value;
-                }
-
-                @Override
-                public String getKey() {
-                    return key;
-                }
-            };
+        for (ConditionalValueParser valueParser : valueParsers) {
+            ConditionalValueParser.ConditionState c = valueParser.checkCondition(conditionalValue);
+            if (c.isValid())
+                return c.isCheckPassed();
         }
-
-        return DateRangeParser.parseDateRange(conditional);
+        return false;
     }
 
-    protected double parseNumber(String str) {
+    protected static double parseNumber(String str) {
         int untilIndex = str.length() - 1;
         for (; untilIndex >= 0; untilIndex--) {
             if (Character.isDigit(str.charAt(untilIndex)))
diff --git a/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalValueParser.java b/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalValueParser.java
new file mode 100644
index 0000000000..6d1925da48
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/reader/osm/conditional/ConditionalValueParser.java
@@ -0,0 +1,39 @@
+package com.graphhopper.reader.osm.conditional;
+
+import java.text.ParseException;
+
+/**
+ * This interface defines how to parse a OSM value from conditional restrictions.
+ */
+public interface ConditionalValueParser {
+
+    /**
+     * This method checks if the condition is satisfied for this parser.
+     */
+    ConditionState checkCondition(String conditionalValue) throws ParseException;
+
+    enum ConditionState {
+        TRUE(true, true),
+        FALSE(true, false),
+        INVALID(false, false);
+
+        boolean valid;
+        boolean checkPassed;
+
+        ConditionState(boolean valid, boolean checkPassed) {
+            this.valid = valid;
+            this.checkPassed = checkPassed;
+        }
+
+        public boolean isValid() {
+            return valid;
+        }
+
+        public boolean isCheckPassed() {
+            if (!isValid())
+                throw new IllegalStateException("Cannot call this method for invalid state");
+
+            return checkPassed;
+        }
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRange.java b/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRange.java
index c8e5aeb600..2cc4dd51e8 100644
--- a/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRange.java
+++ b/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRange.java
@@ -24,12 +24,10 @@
 
 /**
  * This class represents a date range and is able to determine if a given date is in that range.
- * <p>
  *
  * @author Robin Boldt
  */
-public class DateRange implements ValueRange<Calendar> {
-    public static final String KEY = "DateRange";
+public class DateRange {
     private final Calendar from;
     private final Calendar to;
     // Do not compare years
@@ -43,7 +41,7 @@ public DateRange(ParsedCalendar from, ParsedCalendar to) {
 
         // This should never happen
         if (fromCal.get(Calendar.ERA) != toCal.get(Calendar.ERA)) {
-            throw new IllegalArgumentException("Different ERAs are not allowed. From:" + from + " To:" + to);
+            throw new IllegalArgumentException("Different calendar eras are not allowed. From:" + from + " To:" + to);
         }
 
         if (from.isYearless() && to.isYearless()) {
@@ -56,7 +54,7 @@ public DateRange(ParsedCalendar from, ParsedCalendar to) {
 
         if (fromCal.getTimeInMillis() > toCal.getTimeInMillis()) {
             if (!yearless && !dayOnly) {
-                throw new IllegalArgumentException("From after to makes no sense, except for isYearless and isDayOnly DateRanges. From:" + from + " To:" + to);
+                throw new IllegalArgumentException("'from' after 'to' not allowed, except for isYearless and isDayOnly DateRanges. From:" + from + " To:" + to);
             } else {
                 reverse = true;
             }
@@ -66,12 +64,6 @@ public DateRange(ParsedCalendar from, ParsedCalendar to) {
         this.to = to.getMax();
     }
 
-    @Override
-    public String getKey() {
-        return KEY;
-    }
-
-    @Override
     public boolean isInRange(Calendar date) {
         if (!yearless && !dayOnly)
             return date.after(from) && date.before(to);
diff --git a/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRangeParser.java b/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRangeParser.java
index a496697e54..03eb23ef7b 100644
--- a/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRangeParser.java
+++ b/core/src/main/java/com/graphhopper/reader/osm/conditional/DateRangeParser.java
@@ -36,16 +36,26 @@
  *
  * @author Robin Boldt
  */
-public class DateRangeParser {
+public class DateRangeParser implements ConditionalValueParser {
     private static final DateFormat YEAR_MONTH_DAY_DF = createFormatter("yyyy MMM dd");
     private static final DateFormat MONTH_DAY_DF = createFormatter("MMM dd");
     private static final DateFormat MONTH_DAY2_DF = createFormatter("dd.MM");
     private static final DateFormat YEAR_MONTH_DF = createFormatter("yyyy MMM");
     private static final DateFormat MONTH_DF = createFormatter("MMM");
     private static final List<String> DAY_NAMES = Arrays.asList(new String[]{
-        "Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"
+            "Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"
     });
 
+    private Calendar date;
+
+    public DateRangeParser() {
+        this(createCalendar());
+    }
+
+    public DateRangeParser(Calendar date) {
+        this.date = date;
+    }
+
     public static Calendar createCalendar() {
         // Use locale US as exception here (instead of UK) to match week order "Su-Sa" used in Calendar for day_of_week.
         // Inconsistent but we should not use US for other date handling stuff like strange default formatting, related to #647.
@@ -94,13 +104,14 @@ static ParsedCalendar parseDateString(String dateString) throws ParseException {
         return parsedCalendar;
     }
 
-    public static DateRange parseDateRange(String dateRangeString) throws ParseException {
+    public DateRange getRange(String dateRangeString) throws ParseException {
         if (dateRangeString == null || dateRangeString.isEmpty())
             throw new IllegalArgumentException("Passing empty Strings is not allowed");
 
         String[] dateArr = dateRangeString.split("-");
         if (dateArr.length > 2 || dateArr.length < 1)
-            throw new IllegalArgumentException("Only Strings containing two Date separated by a '-' or a single Date are allowed");
+            return null;
+        // throw new IllegalArgumentException("Only Strings containing two Date separated by a '-' or a single Date are allowed");
 
         ParsedCalendar from = parseDateString(dateArr[0]);
         ParsedCalendar to;
@@ -114,4 +125,15 @@ public static DateRange parseDateRange(String dateRangeString) throws ParseExcep
         return new DateRange(from, to);
     }
 
+    @Override
+    public ConditionState checkCondition(String dateRangeString) throws ParseException {
+        DateRange dr = getRange(dateRangeString);
+        if (dr == null)
+            return ConditionState.INVALID;
+
+        if (dr.isInRange(date))
+            return ConditionState.TRUE;
+        else
+            return ConditionState.FALSE;
+    }
 }
diff --git a/core/src/main/java/com/graphhopper/reader/osm/conditional/ValueRange.java b/core/src/main/java/com/graphhopper/reader/osm/conditional/ValueRange.java
deleted file mode 100644
index 5867d3e19d..0000000000
--- a/core/src/main/java/com/graphhopper/reader/osm/conditional/ValueRange.java
+++ /dev/null
@@ -1,30 +0,0 @@
-/*
- *  Licensed to GraphHopper GmbH under one or more contributor
- *  license agreements. See the NOTICE file distributed with this work for 
- *  additional information regarding copyright ownership.
- * 
- *  GraphHopper GmbH licenses this file to you under the Apache License, 
- *  Version 2.0 (the "License"); you may not use this file except in 
- *  compliance with the License. You may obtain a copy of the License at
- * 
- *       http://www.apache.org/licenses/LICENSE-2.0
- * 
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package com.graphhopper.reader.osm.conditional;
-
-/**
- * @author Peter Karich
- */
-public interface ValueRange<T> {
-    /**
-     * Checks if the value is in range of this ValueRange check method.
-     */
-    boolean isInRange(T value);
-
-    String getKey();
-}
diff --git a/core/src/main/java/com/graphhopper/routing/AStar.java b/core/src/main/java/com/graphhopper/routing/AStar.java
index f416263162..a189eea4c5 100644
--- a/core/src/main/java/com/graphhopper/routing/AStar.java
+++ b/core/src/main/java/com/graphhopper/routing/AStar.java
@@ -17,7 +17,8 @@
  */
 package com.graphhopper.routing;
 
-import com.graphhopper.routing.util.FlagEncoder;
+import com.carrotsearch.hppc.IntObjectMap;
+import com.graphhopper.coll.GHIntObjectHashMap;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.BeelineWeightApproximator;
 import com.graphhopper.routing.weighting.WeightApproximator;
@@ -27,9 +28,8 @@
 import com.graphhopper.util.DistancePlaneProjection;
 import com.graphhopper.util.EdgeExplorer;
 import com.graphhopper.util.EdgeIterator;
+import com.graphhopper.util.Helper;
 import com.graphhopper.util.Parameters;
-import gnu.trove.map.TIntObjectMap;
-import gnu.trove.map.hash.TIntObjectHashMap;
 
 import java.util.PriorityQueue;
 
@@ -45,17 +45,17 @@
 public class AStar extends AbstractRoutingAlgorithm {
     private WeightApproximator weightApprox;
     private int visitedCount;
-    private TIntObjectMap<AStarEntry> fromMap;
+    private IntObjectMap<AStarEntry> fromMap;
     private PriorityQueue<AStarEntry> prioQueueOpenSet;
     private AStarEntry currEdge;
     private int to1 = -1;
 
-    public AStar(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode) {
-        super(graph, encoder, weighting, tMode);
+    public AStar(Graph graph, Weighting weighting, TraversalMode tMode) {
+        super(graph, weighting, tMode);
         int size = Math.min(Math.max(200, graph.getNodes() / 10), 2000);
         initCollections(size);
         BeelineWeightApproximator defaultApprox = new BeelineWeightApproximator(nodeAccess, weighting);
-        defaultApprox.setDistanceCalc(new DistancePlaneProjection());
+        defaultApprox.setDistanceCalc(Helper.DIST_PLANE);
         setApproximation(defaultApprox);
     }
 
@@ -68,7 +68,7 @@ public AStar setApproximation(WeightApproximator approx) {
     }
 
     protected void initCollections(int size) {
-        fromMap = new TIntObjectHashMap<AStarEntry>();
+        fromMap = new GHIntObjectHashMap<AStarEntry>();
         prioQueueOpenSet = new PriorityQueue<AStarEntry>(size);
     }
 
@@ -147,7 +147,8 @@ private Path runAlgo() {
 
     @Override
     protected Path extractPath() {
-        return new Path(graph, flagEncoder).setWeight(currEdge.weight).setSPTEntry(currEdge).extract();
+        return new Path(graph, weighting).
+                setWeight(currEdge.weight).setSPTEntry(currEdge).extract();
     }
 
     @Override
@@ -167,7 +168,7 @@ public int getVisitedNodes() {
 
     @Override
     public String getName() {
-        return Parameters.Algorithms.ASTAR;
+        return Parameters.Algorithms.ASTAR + "|" + weightApprox;
     }
 
     public static class AStarEntry extends SPTEntry {
diff --git a/core/src/main/java/com/graphhopper/routing/AStarBidirection.java b/core/src/main/java/com/graphhopper/routing/AStarBidirection.java
index ef9478570d..03bde3071e 100644
--- a/core/src/main/java/com/graphhopper/routing/AStarBidirection.java
+++ b/core/src/main/java/com/graphhopper/routing/AStarBidirection.java
@@ -17,8 +17,9 @@
  */
 package com.graphhopper.routing;
 
+import com.carrotsearch.hppc.IntObjectMap;
+import com.graphhopper.coll.GHIntObjectHashMap;
 import com.graphhopper.routing.AStar.AStarEntry;
-import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.BeelineWeightApproximator;
 import com.graphhopper.routing.weighting.ConsistentWeightApproximator;
@@ -27,8 +28,6 @@
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.SPTEntry;
 import com.graphhopper.util.*;
-import gnu.trove.map.TIntObjectMap;
-import gnu.trove.map.hash.TIntObjectHashMap;
 
 import java.util.PriorityQueue;
 
@@ -59,35 +58,35 @@
  * @author jansoe
  */
 public class AStarBidirection extends AbstractBidirAlgo {
-    protected TIntObjectMap<AStarEntry> bestWeightMapFrom;
-    protected TIntObjectMap<AStarEntry> bestWeightMapTo;
+    protected IntObjectMap<AStarEntry> bestWeightMapFrom;
+    protected IntObjectMap<AStarEntry> bestWeightMapTo;
     protected AStarEntry currFrom;
     protected AStarEntry currTo;
     protected PathBidirRef bestPath;
     private ConsistentWeightApproximator weightApprox;
     private PriorityQueue<AStarEntry> prioQueueOpenSetFrom;
     private PriorityQueue<AStarEntry> prioQueueOpenSetTo;
-    private TIntObjectMap<AStarEntry> bestWeightMapOther;
+    private IntObjectMap<AStarEntry> bestWeightMapOther;
 
-    public AStarBidirection(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode) {
-        super(graph, encoder, weighting, tMode);
-        int size = Math.min(Math.max(200, graph.getNodes() / 10), 2000);
+    public AStarBidirection(Graph graph, Weighting weighting, TraversalMode tMode) {
+        super(graph, weighting, tMode);
+        int size = Math.min(Math.max(200, graph.getNodes() / 10), 150_000);
         initCollections(size);
         BeelineWeightApproximator defaultApprox = new BeelineWeightApproximator(nodeAccess, weighting);
-        defaultApprox.setDistanceCalc(new DistancePlaneProjection());
+        defaultApprox.setDistanceCalc(Helper.DIST_PLANE);
         setApproximation(defaultApprox);
     }
 
     protected void initCollections(int size) {
         prioQueueOpenSetFrom = new PriorityQueue<AStarEntry>(size);
-        bestWeightMapFrom = new TIntObjectHashMap<AStarEntry>(size);
+        bestWeightMapFrom = new GHIntObjectHashMap<AStarEntry>(size);
 
         prioQueueOpenSetTo = new PriorityQueue<AStarEntry>(size);
-        bestWeightMapTo = new TIntObjectHashMap<AStarEntry>(size);
+        bestWeightMapTo = new GHIntObjectHashMap<AStarEntry>(size);
     }
 
     /**
-     * @param approx if true it enables approximative distance calculation from lat,lon values
+     * @param approx if true it enables approximate distance calculation from lat,lon values
      */
     public AStarBidirection setApproximation(WeightApproximator approx) {
         weightApprox = new ConsistentWeightApproximator(approx);
@@ -153,7 +152,7 @@ public void initTo(int to, double weight) {
 
     @Override
     protected Path createAndInitPath() {
-        bestPath = new PathBidirRef(graph, flagEncoder);
+        bestPath = new PathBidirRef(graph, weighting);
         return bestPath;
     }
 
@@ -209,7 +208,7 @@ boolean fillEdgesTo() {
     }
 
     private void fillEdges(AStarEntry currEdge, PriorityQueue<AStarEntry> prioQueueOpenSet,
-                           TIntObjectMap<AStarEntry> bestWeightMap, EdgeExplorer explorer, boolean reverse) {
+                           IntObjectMap<AStarEntry> bestWeightMap, EdgeExplorer explorer, boolean reverse) {
 
         int currNode = currEdge.adjNode;
         EdgeIterator iter = explorer.setBaseNode(currNode);
@@ -281,6 +280,6 @@ public void updateBestPath(EdgeIteratorState edgeState, AStarEntry entryCurrent,
 
     @Override
     public String getName() {
-        return Parameters.Algorithms.ASTAR_BI;
+        return Parameters.Algorithms.ASTAR_BI + "|" + weightApprox;
     }
 }
diff --git a/core/src/main/java/com/graphhopper/routing/AbstractBidirAlgo.java b/core/src/main/java/com/graphhopper/routing/AbstractBidirAlgo.java
index 82499bcc25..edece875d8 100644
--- a/core/src/main/java/com/graphhopper/routing/AbstractBidirAlgo.java
+++ b/core/src/main/java/com/graphhopper/routing/AbstractBidirAlgo.java
@@ -34,8 +34,8 @@
     int visitedCountFrom;
     int visitedCountTo;
 
-    public AbstractBidirAlgo(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode) {
-        super(graph, encoder, weighting, tMode);
+    public AbstractBidirAlgo(Graph graph, Weighting weighting, TraversalMode tMode) {
+        super(graph, weighting, tMode);
     }
 
     abstract void initFrom(int from, double dist);
diff --git a/core/src/main/java/com/graphhopper/routing/AbstractRoutingAlgorithm.java b/core/src/main/java/com/graphhopper/routing/AbstractRoutingAlgorithm.java
index a83f4e8f7a..490b8812c9 100644
--- a/core/src/main/java/com/graphhopper/routing/AbstractRoutingAlgorithm.java
+++ b/core/src/main/java/com/graphhopper/routing/AbstractRoutingAlgorithm.java
@@ -49,13 +49,12 @@
 
     /**
      * @param graph         specifies the graph where this algorithm will run on
-     * @param encoder       sets the used vehicle (bike, car, foot)
      * @param weighting     set the used weight calculation (e.g. fastest, shortest).
      * @param traversalMode how the graph is traversed e.g. if via nodes or edges.
      */
-    public AbstractRoutingAlgorithm(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode traversalMode) {
+    public AbstractRoutingAlgorithm(Graph graph, Weighting weighting, TraversalMode traversalMode) {
         this.weighting = weighting;
-        this.flagEncoder = encoder;
+        this.flagEncoder = weighting.getFlagEncoder();
         this.traversalMode = traversalMode;
         this.graph = graph;
         this.nodeAccess = graph.getNodeAccess();
@@ -118,7 +117,7 @@ protected SPTEntry createSPTEntry(int node, double weight) {
     }
 
     protected Path createEmptyPath() {
-        return new Path(graph, flagEncoder);
+        return new Path(graph, weighting);
     }
 
     @Override
diff --git a/core/src/main/java/com/graphhopper/routing/AlgorithmOptions.java b/core/src/main/java/com/graphhopper/routing/AlgorithmOptions.java
index de9127ab6f..a15de5c33b 100644
--- a/core/src/main/java/com/graphhopper/routing/AlgorithmOptions.java
+++ b/core/src/main/java/com/graphhopper/routing/AlgorithmOptions.java
@@ -17,7 +17,6 @@
  */
 package com.graphhopper.routing;
 
-import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.util.PMap;
@@ -40,7 +39,6 @@
     private String algorithm = Parameters.Algorithms.DIJKSTRA_BI;
     private Weighting weighting;
     private TraversalMode traversalMode = TraversalMode.NODE_BASED;
-    private FlagEncoder flagEncoder;
     private int maxVisitedNodes = Integer.MAX_VALUE;
 
     private AlgorithmOptions() {
@@ -49,16 +47,14 @@ private AlgorithmOptions() {
     /**
      * Default traversal mode NODE_BASED is used.
      */
-    public AlgorithmOptions(String algorithm, FlagEncoder flagEncoder, Weighting weighting) {
+    public AlgorithmOptions(String algorithm, Weighting weighting) {
         this.algorithm = algorithm;
         this.weighting = weighting;
-        this.flagEncoder = flagEncoder;
     }
 
-    public AlgorithmOptions(String algorithm, FlagEncoder flagEncoder, Weighting weighting, TraversalMode tMode) {
+    public AlgorithmOptions(String algorithm, Weighting weighting, TraversalMode tMode) {
         this.algorithm = algorithm;
         this.weighting = weighting;
-        this.flagEncoder = flagEncoder;
         this.traversalMode = tMode;
     }
 
@@ -77,14 +73,15 @@ public static Builder start(AlgorithmOptions opts) {
         Builder b = new Builder();
         if (opts.algorithm != null)
             b.algorithm(opts.getAlgorithm());
-        if (opts.flagEncoder != null)
-            b.flagEncoder(opts.getFlagEncoder());
         if (opts.traversalMode != null)
             b.traversalMode(opts.getTraversalMode());
         if (opts.weighting != null)
             b.weighting(opts.getWeighting());
         if (opts.maxVisitedNodes >= 0)
             b.maxVisitedNodes(opts.maxVisitedNodes);
+        if (!opts.hints.isEmpty())
+            b.hints(opts.hints);
+
         return b;
     }
 
@@ -95,6 +92,10 @@ public TraversalMode getTraversalMode() {
         return traversalMode;
     }
 
+    public boolean hasWeighting() {
+        return weighting != null;
+    }
+
     public Weighting getWeighting() {
         assertNotNull(weighting, "weighting");
         return weighting;
@@ -105,11 +106,6 @@ public String getAlgorithm() {
         return algorithm;
     }
 
-    public FlagEncoder getFlagEncoder() {
-        assertNotNull(flagEncoder, "flagEncoder");
-        return flagEncoder;
-    }
-
     public int getMaxVisitedNodes() {
         return maxVisitedNodes;
     }
@@ -125,7 +121,7 @@ private void assertNotNull(Object optionValue, String optionName) {
 
     @Override
     public String toString() {
-        return algorithm + ", " + weighting + ", " + flagEncoder + ", " + traversalMode;
+        return algorithm + ", " + weighting + ", " + traversalMode;
     }
 
     public static class Builder {
@@ -152,11 +148,6 @@ public Builder algorithm(String algorithm) {
             return this;
         }
 
-        public Builder flagEncoder(FlagEncoder flagEncoder) {
-            this.opts.flagEncoder = flagEncoder;
-            return this;
-        }
-
         public Builder maxVisitedNodes(int maxVisitedNodes) {
             this.opts.maxVisitedNodes = maxVisitedNodes;
             return this;
diff --git a/core/src/main/java/com/graphhopper/routing/AlternativeRoute.java b/core/src/main/java/com/graphhopper/routing/AlternativeRoute.java
index e118e7af80..cb433f574c 100644
--- a/core/src/main/java/com/graphhopper/routing/AlternativeRoute.java
+++ b/core/src/main/java/com/graphhopper/routing/AlternativeRoute.java
@@ -17,8 +17,12 @@
  */
 package com.graphhopper.routing;
 
+import com.carrotsearch.hppc.IntObjectMap;
+import com.carrotsearch.hppc.IntSet;
+import com.carrotsearch.hppc.predicates.IntObjectPredicate;
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.coll.GHIntObjectHashMap;
 import com.graphhopper.routing.AStar.AStarEntry;
-import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
@@ -27,22 +31,17 @@
 import com.graphhopper.util.EdgeIteratorState;
 import com.graphhopper.util.GHUtility;
 import com.graphhopper.util.Parameters;
-import gnu.trove.map.TIntObjectMap;
-import gnu.trove.map.hash.TIntObjectHashMap;
-import gnu.trove.procedure.TIntObjectProcedure;
-import gnu.trove.procedure.TObjectProcedure;
-import gnu.trove.set.TIntSet;
-import gnu.trove.set.hash.TIntHashSet;
 
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.Comparator;
 import java.util.List;
+import java.util.concurrent.atomic.AtomicBoolean;
 import java.util.concurrent.atomic.AtomicInteger;
 
 /**
  * This class implements the alternative paths search using the "plateau" and partially the
- * "penalty" method discribed in the following papers.
+ * "penalty" method described in the following papers.
  * <p>
  * <ul>
  * <li>Choice Routing Explanation - Camvit 2009:
@@ -68,7 +67,6 @@ public int compare(AlternativeInfo o1, AlternativeInfo o2) {
         }
     };
     private final Graph graph;
-    private final FlagEncoder flagEncoder;
     private final Weighting weighting;
     private final TraversalMode traversalMode;
     private int visitedNodes;
@@ -81,9 +79,8 @@ public int compare(AlternativeInfo o1, AlternativeInfo o2) {
     private double minPlateauFactor = 0.2;
     private int maxPaths = 2;
 
-    public AlternativeRoute(Graph graph, FlagEncoder flagEncoder, Weighting weighting, TraversalMode traversalMode) {
+    public AlternativeRoute(Graph graph, Weighting weighting, TraversalMode traversalMode) {
         this.graph = graph;
-        this.flagEncoder = flagEncoder;
         this.weighting = weighting;
         this.traversalMode = traversalMode;
     }
@@ -164,7 +161,7 @@ public void setMaxPaths(int maxPaths) {
      */
     public List<AlternativeInfo> calcAlternatives(int from, int to) {
         AlternativeBidirSearch altBidirDijktra = new AlternativeBidirSearch(
-                graph, flagEncoder, weighting, traversalMode, maxExplorationFactor * 2);
+                graph, weighting, traversalMode, maxExplorationFactor * 2);
         altBidirDijktra.setMaxVisitedNodes(maxVisitedNodes);
         altBidirDijktra.searchBest(from, to);
         visitedNodes = altBidirDijktra.getVisitedNodes();
@@ -250,17 +247,17 @@ public String toString() {
     public static class AlternativeBidirSearch extends AStarBidirection {
         private final double explorationFactor;
 
-        public AlternativeBidirSearch(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode,
+        public AlternativeBidirSearch(Graph graph, Weighting weighting, TraversalMode tMode,
                                       double explorationFactor) {
-            super(graph, encoder, weighting, tMode);
+            super(graph, weighting, tMode);
             this.explorationFactor = explorationFactor;
         }
 
-        public TIntObjectMap<AStarEntry> getBestWeightMapFrom() {
+        public IntObjectMap<AStarEntry> getBestWeightMapFrom() {
             return bestWeightMapFrom;
         }
 
-        public TIntObjectMap<AStarEntry> getBestWeightMapTo() {
+        public IntObjectMap<AStarEntry> getBestWeightMapTo() {
             return bestWeightMapTo;
         }
 
@@ -302,7 +299,7 @@ public Path searchBest(int to, int from) {
                                                       final double maxShareFactor, final double shareInfluence,
                                                       final double minPlateauFactor, final double plateauInfluence) {
             final double maxWeight = maxWeightFactor * bestPath.getWeight();
-            final TIntObjectHashMap<TIntSet> traversalIDMap = new TIntObjectHashMap<TIntSet>();
+            final GHIntObjectHashMap<IntSet> traversalIDMap = new GHIntObjectHashMap<IntSet>();
             final AtomicInteger startTID = addToMap(traversalIDMap, bestPath);
 
             // find all 'good' alternatives from forward-SPT matching the backward-SPT and optimize by
@@ -321,9 +318,9 @@ public Path searchBest(int to, int from) {
             alternatives.add(bestAlt);
             final List<SPTEntry> bestPathEntries = new ArrayList<SPTEntry>(2);
 
-            bestWeightMapFrom.forEachEntry(new TIntObjectProcedure<SPTEntry>() {
+            bestWeightMapFrom.forEach(new IntObjectPredicate<SPTEntry>() {
                 @Override
-                public boolean execute(final int traversalId, final SPTEntry fromSPTEntry) {
+                public boolean apply(final int traversalId, final SPTEntry fromSPTEntry) {
                     SPTEntry toSPTEntry = bestWeightMapTo.get(traversalId);
                     if (toSPTEntry == null)
                         return true;
@@ -337,8 +334,8 @@ public boolean execute(final int traversalId, final SPTEntry fromSPTEntry) {
                         // TODO else if fromSPTEntry.parent != null fromSPTEntry = fromSPTEntry.parent;
 
                     } else // The alternative path is suboptimal when both entries are parallel
-                        if (fromSPTEntry.edge == toSPTEntry.edge)
-                            return true;
+                    if (fromSPTEntry.edge == toSPTEntry.edge)
+                        return true;
 
                     // (1) skip too long paths
                     final double weight = fromSPTEntry.getWeightOfVisitedPath() + toSPTEntry.getWeightOfVisitedPath();
@@ -423,7 +420,7 @@ public boolean execute(final int traversalId, final SPTEntry fromSPTEntry) {
 
                         // plateaus.add(new PlateauInfo(altName, plateauEdges));
                         if (sortBy < worstSortBy || alternatives.size() < maxPaths) {
-                            Path path = new PathBidirRef(graph, flagEncoder).
+                            Path path = new PathBidirRef(graph, weighting).
                                     setSPTEntryTo(toSPTEntry).setSPTEntry(fromSPTEntry).
                                     setWeight(weight);
                             path.extract();
@@ -466,12 +463,19 @@ SPTEntry getFirstShareEE(SPTEntry startEE, boolean reverse) {
                  * traversalIDMap
                  */
                 boolean isAlreadyExisting(final int tid) {
-                    return !traversalIDMap.forEachValue(new TObjectProcedure<TIntSet>() {
+                    final AtomicBoolean exists = new AtomicBoolean(false);
+                    traversalIDMap.forEach(new IntObjectPredicate<IntSet>() {
                         @Override
-                        public boolean execute(TIntSet set) {
-                            return !set.contains(tid);
+                        public boolean apply(int key, IntSet set) {
+                            if (set.contains(tid)) {
+                                exists.set(true);
+                                return false;
+                            }
+                            return true;
                         }
                     });
+
+                    return exists.get();
                 }
 
                 /**
@@ -515,8 +519,8 @@ boolean isBestPath(SPTEntry fromSPTEntry, Path bestPath) {
         /**
          * This method adds the traversal IDs of the specified path as set to the specified map.
          */
-        AtomicInteger addToMap(TIntObjectHashMap<TIntSet> map, Path path) {
-            TIntSet set = new TIntHashSet();
+        AtomicInteger addToMap(GHIntObjectHashMap<IntSet> map, Path path) {
+            IntSet set = new GHIntHashSet();
             final AtomicInteger startTID = new AtomicInteger(-1);
             for (EdgeIteratorState iterState : path.calcEdges()) {
                 int tid = traversalMode.createTraversalId(iterState, false);
diff --git a/core/src/main/java/com/graphhopper/routing/Dijkstra.java b/core/src/main/java/com/graphhopper/routing/Dijkstra.java
index c8583f3655..b57650f9e6 100644
--- a/core/src/main/java/com/graphhopper/routing/Dijkstra.java
+++ b/core/src/main/java/com/graphhopper/routing/Dijkstra.java
@@ -17,7 +17,8 @@
  */
 package com.graphhopper.routing;
 
-import com.graphhopper.routing.util.FlagEncoder;
+import com.carrotsearch.hppc.IntObjectMap;
+import com.graphhopper.coll.GHIntObjectHashMap;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
@@ -25,8 +26,6 @@
 import com.graphhopper.util.EdgeExplorer;
 import com.graphhopper.util.EdgeIterator;
 import com.graphhopper.util.Parameters;
-import gnu.trove.map.TIntObjectMap;
-import gnu.trove.map.hash.TIntObjectHashMap;
 
 import java.util.PriorityQueue;
 
@@ -38,21 +37,21 @@
  * @author Peter Karich
  */
 public class Dijkstra extends AbstractRoutingAlgorithm {
-    protected TIntObjectMap<SPTEntry> fromMap;
+    protected IntObjectMap<SPTEntry> fromMap;
     protected PriorityQueue<SPTEntry> fromHeap;
     protected SPTEntry currEdge;
     private int visitedNodes;
     private int to = -1;
 
-    public Dijkstra(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode) {
-        super(graph, encoder, weighting, tMode);
+    public Dijkstra(Graph graph, Weighting weighting, TraversalMode tMode) {
+        super(graph, weighting, tMode);
         int size = Math.min(Math.max(200, graph.getNodes() / 10), 2000);
         initCollections(size);
     }
 
     protected void initCollections(int size) {
         fromHeap = new PriorityQueue<SPTEntry>(size);
-        fromMap = new TIntObjectHashMap<SPTEntry>(size);
+        fromMap = new GHIntObjectHashMap<SPTEntry>(size);
     }
 
     @Override
@@ -122,7 +121,8 @@ protected Path extractPath() {
         if (currEdge == null || !finished())
             return createEmptyPath();
 
-        return new Path(graph, flagEncoder).setWeight(currEdge.weight).setSPTEntry(currEdge).extract();
+        return new Path(graph, weighting).
+                setWeight(currEdge.weight).setSPTEntry(currEdge).extract();
     }
 
     @Override
diff --git a/core/src/main/java/com/graphhopper/routing/DijkstraBidirectionRef.java b/core/src/main/java/com/graphhopper/routing/DijkstraBidirectionRef.java
index 2b126e2b55..253b58fdf9 100644
--- a/core/src/main/java/com/graphhopper/routing/DijkstraBidirectionRef.java
+++ b/core/src/main/java/com/graphhopper/routing/DijkstraBidirectionRef.java
@@ -17,14 +17,13 @@
  */
 package com.graphhopper.routing;
 
-import com.graphhopper.routing.util.FlagEncoder;
+import com.carrotsearch.hppc.IntObjectMap;
+import com.graphhopper.coll.GHIntObjectHashMap;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.SPTEntry;
 import com.graphhopper.util.*;
-import gnu.trove.map.TIntObjectMap;
-import gnu.trove.map.hash.TIntObjectHashMap;
 
 import java.util.PriorityQueue;
 
@@ -37,9 +36,9 @@
  * @author Peter Karich
  */
 public class DijkstraBidirectionRef extends AbstractBidirAlgo {
-    protected TIntObjectMap<SPTEntry> bestWeightMapFrom;
-    protected TIntObjectMap<SPTEntry> bestWeightMapTo;
-    protected TIntObjectMap<SPTEntry> bestWeightMapOther;
+    protected IntObjectMap<SPTEntry> bestWeightMapFrom;
+    protected IntObjectMap<SPTEntry> bestWeightMapTo;
+    protected IntObjectMap<SPTEntry> bestWeightMapOther;
     protected SPTEntry currFrom;
     protected SPTEntry currTo;
     protected PathBidirRef bestPath;
@@ -47,18 +46,18 @@
     private PriorityQueue<SPTEntry> openSetTo;
     private boolean updateBestPath = true;
 
-    public DijkstraBidirectionRef(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode) {
-        super(graph, encoder, weighting, tMode);
-        int size = Math.min(Math.max(200, graph.getNodes() / 10), 2000);
+    public DijkstraBidirectionRef(Graph graph, Weighting weighting, TraversalMode tMode) {
+        super(graph, weighting, tMode);
+        int size = Math.min(Math.max(200, graph.getNodes() / 10), 150_000);
         initCollections(size);
     }
 
     protected void initCollections(int size) {
         openSetFrom = new PriorityQueue<SPTEntry>(size);
-        bestWeightMapFrom = new TIntObjectHashMap<SPTEntry>(size);
+        bestWeightMapFrom = new GHIntObjectHashMap<SPTEntry>(size);
 
-        openSetTo = new PriorityQueue<SPTEntry>(size / 10);
-        bestWeightMapTo = new TIntObjectHashMap<SPTEntry>(size);
+        openSetTo = new PriorityQueue<SPTEntry>(size);
+        bestWeightMapTo = new GHIntObjectHashMap<SPTEntry>(size);
     }
 
     @Override
@@ -101,7 +100,7 @@ public void initTo(int to, double weight) {
 
     @Override
     protected Path createAndInitPath() {
-        bestPath = new PathBidirRef(graph, flagEncoder);
+        bestPath = new PathBidirRef(graph, weighting);
         return bestPath;
     }
 
@@ -159,7 +158,7 @@ public boolean finished() {
     }
 
     void fillEdges(SPTEntry currEdge, PriorityQueue<SPTEntry> prioQueue,
-                   TIntObjectMap<SPTEntry> shortestWeightMap, EdgeExplorer explorer, boolean reverse) {
+                   IntObjectMap<SPTEntry> shortestWeightMap, EdgeExplorer explorer, boolean reverse) {
         EdgeIterator iter = explorer.setBaseNode(currEdge.adjNode);
         while (iter.next()) {
             if (!accept(iter, currEdge.edge))
@@ -221,15 +220,15 @@ protected void updateBestPath(EdgeIteratorState edgeState, SPTEntry entryCurrent
         }
     }
 
-    TIntObjectMap<SPTEntry> getBestFromMap() {
+    IntObjectMap<SPTEntry> getBestFromMap() {
         return bestWeightMapFrom;
     }
 
-    TIntObjectMap<SPTEntry> getBestToMap() {
+    IntObjectMap<SPTEntry> getBestToMap() {
         return bestWeightMapTo;
     }
 
-    void setBestOtherMap(TIntObjectMap<SPTEntry> other) {
+    void setBestOtherMap(IntObjectMap<SPTEntry> other) {
         bestWeightMapOther = other;
     }
 
diff --git a/core/src/main/java/com/graphhopper/routing/DijkstraOneToMany.java b/core/src/main/java/com/graphhopper/routing/DijkstraOneToMany.java
index 20c9991a3b..5c6fbc9f66 100644
--- a/core/src/main/java/com/graphhopper/routing/DijkstraOneToMany.java
+++ b/core/src/main/java/com/graphhopper/routing/DijkstraOneToMany.java
@@ -17,15 +17,14 @@
  */
 package com.graphhopper.routing;
 
-import com.graphhopper.coll.IntDoubleBinHeap;
-import com.graphhopper.routing.util.FlagEncoder;
+import com.carrotsearch.hppc.IntArrayList;
+import com.graphhopper.apache.commons.collections.IntDoubleBinaryHeap;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.util.EdgeIterator;
 import com.graphhopper.util.Helper;
 import com.graphhopper.util.Parameters;
-import gnu.trove.list.array.TIntArrayList;
 
 import java.util.Arrays;
 
@@ -39,19 +38,19 @@
 public class DijkstraOneToMany extends AbstractRoutingAlgorithm {
     private static final int EMPTY_PARENT = -1;
     private static final int NOT_FOUND = -1;
-    private final TIntArrayListWithCap changedNodes;
+    private final IntArrayListWithCap changedNodes;
     protected double[] weights;
     private int[] parents;
     private int[] edgeIds;
-    private IntDoubleBinHeap heap;
+    private IntDoubleBinaryHeap heap;
     private int visitedNodes;
     private boolean doClear = true;
     private int endNode;
     private int currNode, fromNode, to;
     private double weightLimit = Double.MAX_VALUE;
 
-    public DijkstraOneToMany(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode) {
-        super(graph, encoder, weighting, tMode);
+    public DijkstraOneToMany(Graph graph, Weighting weighting, TraversalMode tMode) {
+        super(graph, weighting, tMode);
 
         parents = new int[graph.getNodes()];
         Arrays.fill(parents, EMPTY_PARENT);
@@ -63,8 +62,8 @@ public DijkstraOneToMany(Graph graph, FlagEncoder encoder, Weighting weighting,
 
         Arrays.fill(weights, Double.MAX_VALUE);
 
-        heap = new IntDoubleBinHeap();
-        changedNodes = new TIntArrayListWithCap();
+        heap = new IntDoubleBinaryHeap(1000);
+        changedNodes = new IntArrayListWithCap();
     }
 
     @Override
@@ -76,7 +75,7 @@ public Path calcPath(int from, int to) {
 
     @Override
     public Path extractPath() {
-        PathNative p = new PathNative(graph, flagEncoder, parents, edgeIds);
+        PathNative p = new PathNative(graph, weighting, parents, edgeIds);
         if (endNode >= 0)
             p.setWeight(weights[endNode]);
         p.setFromNode(fromNode);
@@ -115,7 +114,9 @@ public int findEndNode(int from, int to) {
             }
 
             heap.clear();
-            changedNodes.reset();
+
+            // changedNodes.clear();
+            changedNodes.elementsCount = 0;
 
             currNode = from;
             if (!traversalMode.isEdgeBased()) {
@@ -227,12 +228,12 @@ public String getMemoryUsageAsString() {
                 + "MB";
     }
 
-    private static class TIntArrayListWithCap extends TIntArrayList {
-        public TIntArrayListWithCap() {
+    private static class IntArrayListWithCap extends IntArrayList {
+        public IntArrayListWithCap() {
         }
 
         public int getCapacity() {
-            return _data.length;
+            return buffer.length;
         }
     }
 }
diff --git a/core/src/main/java/com/graphhopper/routing/Path.java b/core/src/main/java/com/graphhopper/routing/Path.java
index 745112693a..f303eae9ce 100644
--- a/core/src/main/java/com/graphhopper/routing/Path.java
+++ b/core/src/main/java/com/graphhopper/routing/Path.java
@@ -17,14 +17,16 @@
  */
 package com.graphhopper.routing;
 
+import com.carrotsearch.hppc.IntArrayList;
+import com.carrotsearch.hppc.IntIndexedContainer;
+import com.graphhopper.coll.GHIntArrayList;
 import com.graphhopper.routing.util.DefaultEdgeFilter;
 import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.NodeAccess;
 import com.graphhopper.storage.SPTEntry;
 import com.graphhopper.util.*;
-import gnu.trove.list.TIntList;
-import gnu.trove.list.array.TIntArrayList;
 
 import java.util.ArrayList;
 import java.util.Collections;
@@ -54,28 +56,30 @@
     protected SPTEntry sptEntry;
     protected int endNode = -1;
     private List<String> description;
+    protected Weighting weighting;
     private FlagEncoder encoder;
     private boolean found;
     private int fromNode = -1;
-    private TIntList edgeIds;
+    private GHIntArrayList edgeIds;
     private double weight;
     private NodeAccess nodeAccess;
 
-    public Path(Graph graph, FlagEncoder encoder) {
+    public Path(Graph graph, Weighting weighting) {
         this.weight = Double.MAX_VALUE;
         this.graph = graph;
         this.nodeAccess = graph.getNodeAccess();
-        this.encoder = encoder;
-        this.edgeIds = new TIntArrayList();
+        this.weighting = weighting;
+        this.encoder = weighting.getFlagEncoder();
+        this.edgeIds = new GHIntArrayList();
     }
 
     /**
      * Populates an unextracted path instances from the specified path p.
      */
     Path(Path p) {
-        this(p.graph, p.encoder);
+        this(p.graph, p.weighting);
         weight = p.weight;
-        edgeIds = new TIntArrayList(p.edgeIds);
+        edgeIds = new GHIntArrayList(p.edgeIds);
         sptEntry = p.sptEntry;
     }
 
@@ -147,6 +151,11 @@ void reverseOrder() {
         edgeIds.reverse();
     }
 
+    public Path setDistance(double distance) {
+        this.distance = distance;
+        return this;
+    }
+
     /**
      * @return distance in meter
      */
@@ -182,9 +191,11 @@ public Path extract() {
 
         extractSW.start();
         SPTEntry goalEdge = sptEntry;
+        int prevEdge = EdgeIterator.NO_EDGE;
         setEndNode(goalEdge.adjNode);
         while (EdgeIterator.Edge.isValid(goalEdge.edge)) {
-            processEdge(goalEdge.edge, goalEdge.adjNode);
+            processEdge(goalEdge.edge, goalEdge.adjNode, prevEdge);
+            prevEdge = goalEdge.edge;
             goalEdge = goalEdge.parent;
         }
 
@@ -215,33 +226,21 @@ public String getDebugInfo() {
     /**
      * Calls getDistance and adds the edgeId.
      */
-    protected void processEdge(int edgeId, int adjNode) {
+    protected void processEdge(int edgeId, int adjNode, int prevEdgeId) {
         EdgeIteratorState iter = graph.getEdgeIteratorState(edgeId, adjNode);
-        double dist = iter.getDistance();
-        distance += dist;
-        // TODO calculate time based on weighting -> weighting.calcMillis
-        time += calcMillis(dist, iter.getFlags(), false);
+        distance += iter.getDistance();
+        time += weighting.calcMillis(iter, false, prevEdgeId);
         addEdge(edgeId);
     }
 
     /**
      * Calculates the time in millis for the specified distance in meter and speed (in km/h) via
      * flags.
+     *
+     * @deprecated use Weighting
      */
-    protected long calcMillis(double distance, long flags, boolean revert) {
-        if (revert && !encoder.isBackward(flags)
-                || !revert && !encoder.isForward(flags))
-            throw new IllegalStateException("Calculating time should not require to read speed from edge in wrong direction. "
-                    + "Reverse:" + revert + ", fwd:" + encoder.isForward(flags) + ", bwd:" + encoder.isBackward(flags));
-
-        double speed = revert ? encoder.getReverseSpeed(flags) : encoder.getSpeed(flags);
-        if (Double.isInfinite(speed) || Double.isNaN(speed) || speed < 0)
-            throw new IllegalStateException("Invalid speed stored in edge! " + speed);
-
-        if (speed == 0)
-            throw new IllegalStateException("Speed cannot be 0 for unblocked edge, use access properties to mark edge blocked! Should only occur for shortest path calculation. See #242.");
-
-        return (long) (distance * 3600 / speed);
+    protected long calcMillis(EdgeIteratorState edge, boolean reverse) {
+        return weighting.calcMillis(edge, reverse, EdgeIterator.NO_EDGE);
     }
 
     /**
@@ -288,8 +287,8 @@ public void next(EdgeIteratorState eb, int i) {
     /**
      * @return the uncached node indices of the tower nodes in this path.
      */
-    public TIntList calcNodes() {
-        final TIntArrayList nodes = new TIntArrayList(edgeIds.size() + 1);
+    public IntIndexedContainer calcNodes() {
+        final IntArrayList nodes = new IntArrayList(edgeIds.size() + 1);
         if (edgeIds.isEmpty()) {
             if (isFound()) {
                 nodes.add(endNode);
@@ -401,8 +400,8 @@ public void next(EdgeIteratorState edge, int index) {
                 } else {
                     latitude = wayGeo.getLatitude(1);
                     longitude = wayGeo.getLongitude(1);
-                    assert java.lang.Double.compare(prevLat, nodeAccess.getLatitude(baseNode)) == 0;
-                    assert java.lang.Double.compare(prevLon, nodeAccess.getLongitude(baseNode)) == 0;
+                    assert Double.compare(prevLat, nodeAccess.getLatitude(baseNode)) == 0;
+                    assert Double.compare(prevLon, nodeAccess.getLongitude(baseNode)) == 0;
                 }
 
                 name = edge.getName();
@@ -562,8 +561,8 @@ private void updatePointsAndInstruction(EdgeIteratorState edge, PointList pl) {
                 }
                 double newDist = edge.getDistance();
                 prevInstruction.setDistance(newDist + prevInstruction.getDistance());
-                long flags = edge.getFlags();
-                prevInstruction.setTime(calcMillis(newDist, flags, false) + prevInstruction.getTime());
+                prevInstruction.setTime(weighting.calcMillis(edge, false, EdgeIterator.NO_EDGE)
+                        + prevInstruction.getTime());
             }
         });
 
diff --git a/core/src/main/java/com/graphhopper/routing/PathBidirRef.java b/core/src/main/java/com/graphhopper/routing/PathBidirRef.java
index d22c2ff500..09ac9a9f54 100644
--- a/core/src/main/java/com/graphhopper/routing/PathBidirRef.java
+++ b/core/src/main/java/com/graphhopper/routing/PathBidirRef.java
@@ -17,7 +17,7 @@
  */
 package com.graphhopper.routing;
 
-import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.SPTEntry;
 import com.graphhopper.util.EdgeIterator;
@@ -30,20 +30,20 @@
  */
 public class PathBidirRef extends Path {
     protected SPTEntry edgeTo;
-    private boolean switchWrapper = false;
+    private boolean switchFromAndToSPTEntry = false;
 
-    public PathBidirRef(Graph g, FlagEncoder encoder) {
-        super(g, encoder);
+    public PathBidirRef(Graph g, Weighting weighting) {
+        super(g, weighting);
     }
 
     PathBidirRef(PathBidirRef p) {
         super(p);
         edgeTo = p.edgeTo;
-        switchWrapper = p.switchWrapper;
+        switchFromAndToSPTEntry = p.switchFromAndToSPTEntry;
     }
 
     public PathBidirRef setSwitchToFrom(boolean b) {
-        switchWrapper = b;
+        switchFromAndToSPTEntry = b;
         return this;
     }
 
@@ -64,15 +64,17 @@ public Path extract() {
             throw new IllegalStateException("Locations of the 'to'- and 'from'-Edge has to be the same." + toString() + ", fromEntry:" + sptEntry + ", toEntry:" + edgeTo);
 
         extractSW.start();
-        if (switchWrapper) {
+        if (switchFromAndToSPTEntry) {
             SPTEntry ee = sptEntry;
             sptEntry = edgeTo;
             edgeTo = ee;
         }
 
+        int prevEdge = EdgeIterator.NO_EDGE;
         SPTEntry currEdge = sptEntry;
         while (EdgeIterator.Edge.isValid(currEdge.edge)) {
-            processEdge(currEdge.edge, currEdge.adjNode);
+            processEdge(currEdge.edge, currEdge.adjNode, prevEdge);
+            prevEdge = currEdge.edge;
             currEdge = currEdge.parent;
         }
         setFromNode(currEdge.adjNode);
@@ -81,7 +83,7 @@ public Path extract() {
         int tmpEdge = currEdge.edge;
         while (EdgeIterator.Edge.isValid(tmpEdge)) {
             currEdge = currEdge.parent;
-            processEdge(tmpEdge, currEdge.adjNode);
+            processEdge(tmpEdge, currEdge.adjNode, currEdge.edge);
             tmpEdge = currEdge.edge;
         }
         setEndNode(currEdge.adjNode);
diff --git a/core/src/main/java/com/graphhopper/routing/PathNative.java b/core/src/main/java/com/graphhopper/routing/PathNative.java
index 310969d8a3..9df6a3c8ed 100644
--- a/core/src/main/java/com/graphhopper/routing/PathNative.java
+++ b/core/src/main/java/com/graphhopper/routing/PathNative.java
@@ -18,6 +18,7 @@
 package com.graphhopper.routing;
 
 import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.util.EdgeIterator;
 
@@ -31,8 +32,8 @@
     private final int[] parentNodes;
     private final int[] parentEdges;
 
-    public PathNative(Graph g, FlagEncoder encoder, int[] parentNodes, int[] parentEdges) {
-        super(g, encoder);
+    public PathNative(Graph g, Weighting weighting, int[] parentNodes, int[] parentEdges) {
+        super(g, weighting);
         this.parentNodes = parentNodes;
         this.parentEdges = parentEdges;
     }
@@ -44,13 +45,15 @@ public PathNative(Graph g, FlagEncoder encoder, int[] parentNodes, int[] parentE
     public Path extract() {
         if (endNode < 0)
             return this;
-
+        
+        int prevEdge = EdgeIterator.NO_EDGE;        
         while (true) {
             int edgeId = parentEdges[endNode];
             if (!EdgeIterator.Edge.isValid(edgeId))
                 break;
 
-            processEdge(edgeId, endNode);
+            processEdge(edgeId, endNode, prevEdge);
+            prevEdge = edgeId;
             endNode = parentNodes[endNode];
         }
         reverseOrder();
diff --git a/core/src/main/java/com/graphhopper/routing/QueryGraph.java b/core/src/main/java/com/graphhopper/routing/QueryGraph.java
index 4acb3453f8..af1e86376c 100644
--- a/core/src/main/java/com/graphhopper/routing/QueryGraph.java
+++ b/core/src/main/java/com/graphhopper/routing/QueryGraph.java
@@ -17,6 +17,12 @@
  */
 package com.graphhopper.routing;
 
+import com.carrotsearch.hppc.IntArrayList;
+import com.carrotsearch.hppc.IntObjectMap;
+import com.carrotsearch.hppc.predicates.IntObjectPredicate;
+import com.carrotsearch.hppc.procedures.IntProcedure;
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.coll.GHIntObjectHashMap;
 import com.graphhopper.routing.util.AllEdgesIterator;
 import com.graphhopper.routing.util.DefaultEdgeFilter;
 import com.graphhopper.routing.util.EdgeFilter;
@@ -29,12 +35,6 @@
 import com.graphhopper.util.shapes.BBox;
 import com.graphhopper.util.shapes.GHPoint;
 import com.graphhopper.util.shapes.GHPoint3D;
-import gnu.trove.list.array.TIntArrayList;
-import gnu.trove.map.TIntObjectMap;
-import gnu.trove.map.hash.TIntObjectHashMap;
-import gnu.trove.procedure.TIntProcedure;
-import gnu.trove.procedure.TObjectProcedure;
-import gnu.trove.set.hash.TIntHashSet;
 
 import java.util.*;
 
@@ -43,6 +43,11 @@
  * introducing virtual nodes and edges. It is lightweight in order to be created every time a new
  * query comes in, which makes the behaviour thread safe.
  * <p>
+ * Calling any <tt>lookup</tt> method creates virtual edges between the tower nodes of the existing
+ * graph and new virtual tower nodes. Every virtual node has two adjacent nodes and is connected
+ * to each adjacent nodes via 2 virtual edges with opposite base node / adjacent node encoding.
+ * However, the edge explorer returned by {@link #createEdgeExplorer()} only returns two
+ * virtual edges per virtual node (the ones with correct base node).
  *
  * @author Peter Karich
  */
@@ -57,10 +62,8 @@
     private final GraphExtension wrappedExtension;
     // TODO when spreading it on different threads we need multiple independent explorers
     private final Map<Integer, EdgeExplorer> cacheMap = new HashMap<Integer, EdgeExplorer>(4);
-    /**
-     * Virtual edges are created between existing graph and new virtual tower nodes. For every
-     * virtual node there are 4 edges: base-snap, snap-base, snap-adj, adj-snap.
-     */
+
+    // For every virtual node there are 4 edges: base-snap, snap-base, snap-adj, adj-snap.
     List<VirtualEdgeIteratorState> virtualEdges;
     private List<QueryResult> queryResults;
     /**
@@ -141,7 +144,10 @@ public double getEle(int nodeId) {
             return getElevation(nodeId);
         }
     };
-    private List<VirtualEdgeIteratorState> modifiedEdges = new ArrayList<VirtualEdgeIteratorState>(5);
+
+    // Use LinkedHashSet for predictable iteration order.
+    private final Set<VirtualEdgeIteratorState> unfavoredEdges = new LinkedHashSet<>(5);
+
     private boolean useEdgeExplorerCache = false;
 
     public QueryGraph(Graph graph) {
@@ -180,6 +186,8 @@ private QueryGraph(Graph graph, QueryGraph superQueryGraph) {
 
     /**
      * Convenient method to initialize this QueryGraph with the two specified query results.
+     *
+     * @see #lookup(List)
      */
     public QueryGraph lookup(QueryResult fromRes, QueryResult toRes) {
         List<QueryResult> results = new ArrayList<QueryResult>(2);
@@ -190,8 +198,11 @@ public QueryGraph lookup(QueryResult fromRes, QueryResult toRes) {
     }
 
     /**
-     * For all specified query results calculate snapped point and set closest node and edge to a
-     * virtual one if necessary. Additionally the wayIndex can change if an edge is swapped.
+     * For all specified query results calculate snapped point and if necessary set closest node
+     * to a virtual one and reverse closest edge. Additionally the wayIndex can change if an edge is
+     * swapped.
+     *
+     * @see QueryGraph
      */
     public void lookup(List<QueryResult> resList) {
         if (isInitialized())
@@ -205,7 +216,7 @@ public void lookup(List<QueryResult> resList) {
         baseGraph.virtualNodes = virtualNodes;
         baseGraph.queryResults = queryResults;
 
-        TIntObjectMap<List<QueryResult>> edge2res = new TIntObjectHashMap<List<QueryResult>>(resList.size());
+        GHIntObjectHashMap<List<QueryResult>> edge2res = new GHIntObjectHashMap<List<QueryResult>>(resList.size());
 
         // Phase 1
         // calculate snapped point and swap direction of closest edge if necessary
@@ -258,9 +269,9 @@ public void lookup(List<QueryResult> resList) {
         // Phase 2 - now it is clear which points cut one edge
         // 1. create point lists
         // 2. create virtual edges between virtual nodes and its neighbor (virtual or normal nodes)
-        edge2res.forEachValue(new TObjectProcedure<List<QueryResult>>() {
+        edge2res.forEach(new IntObjectPredicate<List<QueryResult>>() {
             @Override
-            public boolean execute(List<QueryResult> results) {
+            public boolean apply(int edgeId, List<QueryResult> results) {
                 // we can expect at least one entry in the results
                 EdgeIteratorState closestEdge = results.get(0).getClosestEdge();
                 final PointList fullPL = closestEdge.fetchWayGeometry(3);
@@ -407,7 +418,7 @@ private void createEdges(int origTraversalKey, int origRevTraversalKey,
 
     /**
      * Set those edges at the virtual node (nodeId) to 'unfavored' that require at least a turn of
-     * 100° from favoredHeading
+     * 100° from favoredHeading.
      * <p>
      *
      * @param nodeId         VirtualNode at which edges get unfavored
@@ -451,11 +462,11 @@ public boolean enforceHeading(int nodeId, double favoredHeading, boolean incomin
             if (Math.abs(delta) > 1.74) // penalize if a turn of more than 100°
             {
                 edge.setUnfavored(true);
-                modifiedEdges.add(edge);
+                unfavoredEdges.add(edge);
                 //also apply to opposite edge for reverse routing
                 VirtualEdgeIteratorState reverseEdge = virtualEdges.get(virtNodeIDintern * 4 + getPosOfReverseEdge(edgePos));
                 reverseEdge.setUnfavored(true);
-                modifiedEdges.add(reverseEdge);
+                unfavoredEdges.add(reverseEdge);
                 enforcementOccurred = true;
             }
 
@@ -464,35 +475,49 @@ public boolean enforceHeading(int nodeId, double favoredHeading, boolean incomin
     }
 
     /**
-     * Set one specific edge at the virtual node with nodeId to 'unfavored' to enforce routing along
-     * other edges
+     * Sets the virtual edge with virtualEdgeId and its reverse edge to 'unfavored', which
+     * effectively penalizes both virtual edges towards an adjacent node of virtualNodeId.
+     * This makes it more likely (but does not guarantee) that the router chooses a route towards
+     * the other adjacent node of virtualNodeId.
      * <p>
      *
-     * @param nodeId   VirtualNode at which edges get unfavored
-     * @param edgeId   edge to become unfavored
-     * @param incoming if true, incoming edge is unfavored, else outgoing edge
-     * @return boolean indicating if enforcement took place
+     * @param virtualNodeId  virtual node at which edges get unfavored
+     * @param virtualEdgeId  this edge and the reverse virtual edge become unfavored
      */
-    public boolean enforceHeadingByEdgeId(int nodeId, int edgeId, boolean incoming) {
-        if (!isVirtualNode(nodeId))
-            return false;
+    public void unfavorVirtualEdgePair(int virtualNodeId, int virtualEdgeId) {
+        if (!isVirtualNode(virtualNodeId)) {
+            throw new IllegalArgumentException("Node id " + virtualNodeId
+                    + " must be a virtual node.");
+        }
 
-        VirtualEdgeIteratorState incomingEdge = (VirtualEdgeIteratorState) getEdgeIteratorState(edgeId, nodeId);
-        VirtualEdgeIteratorState reverseEdge = (VirtualEdgeIteratorState) getEdgeIteratorState(edgeId, incomingEdge.getBaseNode());
+        VirtualEdgeIteratorState incomingEdge =
+                (VirtualEdgeIteratorState) getEdgeIteratorState(virtualEdgeId, virtualNodeId);
+        VirtualEdgeIteratorState reverseEdge = (VirtualEdgeIteratorState) getEdgeIteratorState(
+                virtualEdgeId, incomingEdge.getBaseNode());
         incomingEdge.setUnfavored(true);
-        modifiedEdges.add(incomingEdge);
+        unfavoredEdges.add(incomingEdge);
         reverseEdge.setUnfavored(true);
-        modifiedEdges.add(reverseEdge);
-        return true;
+        unfavoredEdges.add(reverseEdge);
+    }
+
+    /**
+     * Returns all virtual edges that have been unfavored via
+     * {@link #enforceHeading(int, double, boolean)} or {@link #unfavorVirtualEdgePair(int, int)}.
+     */
+    public Set<EdgeIteratorState> getUnfavoredVirtualEdges() {
+        // Need to create a new set to convert Set<VirtualEdgeIteratorState> to
+        // Set<EdgeIteratorState>.
+        return new LinkedHashSet<EdgeIteratorState>(unfavoredEdges);
     }
 
     /**
      * Removes the 'unfavored' status of all virtual edges.
      */
     public void clearUnfavoredStatus() {
-        for (VirtualEdgeIteratorState edge : modifiedEdges) {
+        for (VirtualEdgeIteratorState edge : unfavoredEdges) {
             edge.setUnfavored(false);
         }
+        unfavoredEdges.clear();
     }
 
     @Override
@@ -577,11 +602,11 @@ private EdgeExplorer createUncachedEdgeExplorer(EdgeFilter edgeFilter) {
         // so we need to create the mapping on EVERY call!
         // This needs to be a HashMap (and cannot be an array) as we also need to tweak edges for some mainNodes!
         // The more query points we have the more inefficient this map could be. Hmmh.
-        final TIntObjectMap<VirtualEdgeIterator> node2EdgeMap
-                = new TIntObjectHashMap<VirtualEdgeIterator>(queryResults.size() * 3);
+        final IntObjectMap<VirtualEdgeIterator> node2EdgeMap
+                = new GHIntObjectHashMap<VirtualEdgeIterator>(queryResults.size() * 3);
 
         final EdgeExplorer mainExplorer = mainGraph.createEdgeExplorer(edgeFilter);
-        final TIntHashSet towerNodesToChange = new TIntHashSet(queryResults.size());
+        final GHIntHashSet towerNodesToChange = new GHIntHashSet(queryResults.size());
 
         // 1. virtualEdges should also get fresh EdgeIterators on every createEdgeExplorer call!
         for (int i = 0; i < queryResults.size(); i++) {
@@ -618,11 +643,10 @@ private EdgeExplorer createUncachedEdgeExplorer(EdgeFilter edgeFilter) {
         // 2. the connected tower nodes from mainGraph need fresh EdgeIterators with possible fakes
         // where 'fresh' means independent of previous call and respecting the edgeFilter
         // -> setup fake iterators of detected tower nodes (virtual edges are already added)
-        towerNodesToChange.forEach(new TIntProcedure() {
+        towerNodesToChange.forEach(new IntProcedure() {
             @Override
-            public boolean execute(int value) {
+            public void apply(int value) {
                 fillVirtualEdges(node2EdgeMap, value, mainExplorer);
-                return true;
             }
         });
 
@@ -641,7 +665,7 @@ public EdgeIterator setBaseNode(int baseNode) {
     /**
      * Creates a fake edge iterator pointing to multiple edge states.
      */
-    private void addVirtualEdges(TIntObjectMap<VirtualEdgeIterator> node2EdgeMap, EdgeFilter filter, boolean base,
+    private void addVirtualEdges(IntObjectMap<VirtualEdgeIterator> node2EdgeMap, EdgeFilter filter, boolean base,
                                  int node, int virtNode) {
         VirtualEdgeIterator existingIter = node2EdgeMap.get(node);
         if (existingIter == null) {
@@ -655,12 +679,12 @@ private void addVirtualEdges(TIntObjectMap<VirtualEdgeIterator> node2EdgeMap, Ed
             existingIter.add(edge);
     }
 
-    void fillVirtualEdges(TIntObjectMap<VirtualEdgeIterator> node2Edge, int towerNode, EdgeExplorer mainExpl) {
+    void fillVirtualEdges(IntObjectMap<VirtualEdgeIterator> node2Edge, int towerNode, EdgeExplorer mainExpl) {
         if (isVirtualNode(towerNode))
             throw new IllegalStateException("Node should not be virtual:" + towerNode + ", " + node2Edge);
 
         VirtualEdgeIterator vIter = node2Edge.get(towerNode);
-        TIntArrayList ignoreEdges = new TIntArrayList(vIter.count() * 2);
+        IntArrayList ignoreEdges = new IntArrayList(vIter.count() * 2);
         while (vIter.next()) {
             EdgeIteratorState edge = queryResults.get(vIter.getAdjNode() - mainNodes).getClosestEdge();
             ignoreEdges.add(edge.getEdge());
@@ -678,6 +702,9 @@ private boolean isInitialized() {
     }
 
     @Override
+    /**
+     * @see QueryGraph
+     */
     public EdgeExplorer createEdgeExplorer() {
         return createEdgeExplorer(EdgeFilter.ALL_EDGES);
     }
diff --git a/core/src/main/java/com/graphhopper/routing/RoutingAlgorithmFactorySimple.java b/core/src/main/java/com/graphhopper/routing/RoutingAlgorithmFactorySimple.java
index 2bd37dde6b..cdaec92b1e 100644
--- a/core/src/main/java/com/graphhopper/routing/RoutingAlgorithmFactorySimple.java
+++ b/core/src/main/java/com/graphhopper/routing/RoutingAlgorithmFactorySimple.java
@@ -38,26 +38,26 @@ public RoutingAlgorithm createAlgo(Graph g, AlgorithmOptions opts) {
         RoutingAlgorithm ra;
         String algoStr = opts.getAlgorithm();
         if (DIJKSTRA_BI.equalsIgnoreCase(algoStr)) {
-            ra = new DijkstraBidirectionRef(g, opts.getFlagEncoder(), opts.getWeighting(), opts.getTraversalMode());
+            ra = new DijkstraBidirectionRef(g, opts.getWeighting(), opts.getTraversalMode());
         } else if (DIJKSTRA.equalsIgnoreCase(algoStr)) {
-            ra = new Dijkstra(g, opts.getFlagEncoder(), opts.getWeighting(), opts.getTraversalMode());
+            ra = new Dijkstra(g, opts.getWeighting(), opts.getTraversalMode());
 
         } else if (ASTAR_BI.equalsIgnoreCase(algoStr)) {
-            AStarBidirection aStarBi = new AStarBidirection(g, opts.getFlagEncoder(), opts.getWeighting(),
+            AStarBidirection aStarBi = new AStarBidirection(g, opts.getWeighting(),
                     opts.getTraversalMode());
             aStarBi.setApproximation(getApproximation(ASTAR_BI, opts, g.getNodeAccess()));
             ra = aStarBi;
 
         } else if (DIJKSTRA_ONE_TO_MANY.equalsIgnoreCase(algoStr)) {
-            ra = new DijkstraOneToMany(g, opts.getFlagEncoder(), opts.getWeighting(), opts.getTraversalMode());
+            ra = new DijkstraOneToMany(g, opts.getWeighting(), opts.getTraversalMode());
 
         } else if (ASTAR.equalsIgnoreCase(algoStr)) {
-            AStar aStar = new AStar(g, opts.getFlagEncoder(), opts.getWeighting(), opts.getTraversalMode());
+            AStar aStar = new AStar(g, opts.getWeighting(), opts.getTraversalMode());
             aStar.setApproximation(getApproximation(ASTAR, opts, g.getNodeAccess()));
             ra = aStar;
 
         } else if (ALT_ROUTE.equalsIgnoreCase(algoStr)) {
-            AlternativeRoute altRouteAlgo = new AlternativeRoute(g, opts.getFlagEncoder(), opts.getWeighting(), opts.getTraversalMode());
+            AlternativeRoute altRouteAlgo = new AlternativeRoute(g, opts.getWeighting(), opts.getTraversalMode());
             altRouteAlgo.setMaxPaths(opts.getHints().getInt(MAX_PATHS, 2));
             altRouteAlgo.setMaxWeightFactor(opts.getHints().getDouble(MAX_WEIGHT, 1.4));
             altRouteAlgo.setMaxShareFactor(opts.getHints().getDouble(MAX_SHARE, 0.6));
@@ -73,7 +73,7 @@ public RoutingAlgorithm createAlgo(Graph g, AlgorithmOptions opts) {
         return ra;
     }
 
-    private WeightApproximator getApproximation(String prop, AlgorithmOptions opts, NodeAccess na) {
+    public static WeightApproximator getApproximation(String prop, AlgorithmOptions opts, NodeAccess na) {
         String approxAsStr = opts.getHints().get(prop + ".approximation", "BeelineSimplification");
         double epsilon = opts.getHints().getDouble(prop + ".epsilon", 1);
 
@@ -84,7 +84,7 @@ private WeightApproximator getApproximation(String prop, AlgorithmOptions opts,
         else if ("BeelineAccurate".equals(approxAsStr))
             approx.setDistanceCalc(Helper.DIST_EARTH);
         else
-            throw new IllegalArgumentException("Approximation " + approxAsStr + " not found in " + getClass().getName());
+            throw new IllegalArgumentException("Approximation " + approxAsStr + " not found in " + RoutingAlgorithmFactorySimple.class.getName());
 
         return approx;
     }
diff --git a/core/src/main/java/com/graphhopper/routing/ch/CHAlgoFactoryDecorator.java b/core/src/main/java/com/graphhopper/routing/ch/CHAlgoFactoryDecorator.java
index d00df1eed5..c34dadf441 100644
--- a/core/src/main/java/com/graphhopper/routing/ch/CHAlgoFactoryDecorator.java
+++ b/core/src/main/java/com/graphhopper/routing/ch/CHAlgoFactoryDecorator.java
@@ -22,6 +22,7 @@
 import com.graphhopper.routing.util.HintsMap;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.AbstractWeighting;
+import com.graphhopper.routing.weighting.GenericWeighting;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.*;
 import com.graphhopper.util.CmdArgs;
@@ -30,10 +31,7 @@
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Date;
-import java.util.List;
+import java.util.*;
 import java.util.concurrent.ExecutorService;
 import java.util.concurrent.TimeUnit;
 
@@ -51,7 +49,7 @@
     // we need to decouple weighting objects from the weighting list of strings 
     // as we need the strings to create the GraphHopperStorage and the GraphHopperStorage to create the preparations from the Weighting objects currently requiring the encoders
     private final List<Weighting> weightings = new ArrayList<>();
-    private final List<String> weightingsAsStrings = new ArrayList<>();
+    private final Set<String> weightingsAsStrings = new LinkedHashSet<>();
     private boolean disablingAllowed = false;
     // for backward compatibility enable CH by default.
     private boolean enabled = true;
@@ -214,7 +212,7 @@ public CHAlgoFactoryDecorator setWeightingsAsStrings(String... weightingNames) {
         if (this.weightingsAsStrings.isEmpty())
             throw new IllegalStateException("Potential bug: chWeightingList is empty");
 
-        return this.weightingsAsStrings;
+        return new ArrayList<>(this.weightingsAsStrings);
     }
 
     /**
@@ -237,7 +235,7 @@ public CHAlgoFactoryDecorator setWeightingsAsStrings(List<String> weightingList)
     }
 
     private String getDefaultWeighting() {
-        return weightingsAsStrings.isEmpty() ? "fastest" : weightingsAsStrings.get(0);
+        return weightingsAsStrings.isEmpty() ? "fastest" : weightingsAsStrings.iterator().next();
     }
 
     public List<PrepareContractionHierarchies> getPreparations() {
@@ -322,9 +320,12 @@ public void createPreparations(GraphHopperStorage ghStorage, TraversalMode trave
         traversalMode = getNodeBase();
 
         for (Weighting weighting : getWeightings()) {
+            if (weighting instanceof GenericWeighting) {
+                ((GenericWeighting) weighting).setGraph(ghStorage);
+            }
             PrepareContractionHierarchies tmpPrepareCH = new PrepareContractionHierarchies(
                     new GHDirectory("", DAType.RAM_INT), ghStorage, ghStorage.getGraph(CHGraph.class, weighting),
-                    weighting.getFlagEncoder(), weighting, traversalMode);
+                    weighting, traversalMode);
             tmpPrepareCH.setPeriodicUpdates(preparationPeriodicUpdates).
                     setLazyUpdates(preparationLazyUpdates).
                     setNeighborUpdates(preparationNeighborUpdates).
diff --git a/core/src/main/java/com/graphhopper/routing/ch/Path4CH.java b/core/src/main/java/com/graphhopper/routing/ch/Path4CH.java
index 112bbbe2c6..23f7f70543 100644
--- a/core/src/main/java/com/graphhopper/routing/ch/Path4CH.java
+++ b/core/src/main/java/com/graphhopper/routing/ch/Path4CH.java
@@ -19,11 +19,13 @@
 
 import com.graphhopper.routing.PathBidirRef;
 import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.util.CHEdgeIteratorState;
+import com.graphhopper.util.EdgeIterator;
 
 /**
- * Recursivly unpack shortcuts.
+ * Recursively unpack shortcuts.
  * <p>
  *
  * @author Peter Karich
@@ -32,13 +34,13 @@
 public class Path4CH extends PathBidirRef {
     private final Graph routingGraph;
 
-    public Path4CH(Graph routingGraph, Graph baseGraph, FlagEncoder encoder) {
-        super(baseGraph, encoder);
+    public Path4CH(Graph routingGraph, Graph baseGraph, Weighting weighting) {
+        super(baseGraph, weighting);
         this.routingGraph = routingGraph;
     }
 
     @Override
-    protected final void processEdge(int tmpEdge, int endNode) {
+    protected final void processEdge(int tmpEdge, int endNode, int prevEdgeId) {
         // Shortcuts do only contain valid weight so first expand before adding
         // to distance and time
         expandEdge((CHEdgeIteratorState) routingGraph.getEdgeIteratorState(tmpEdge, endNode), false);
@@ -46,10 +48,8 @@ protected final void processEdge(int tmpEdge, int endNode) {
 
     private void expandEdge(CHEdgeIteratorState mainEdgeState, boolean reverse) {
         if (!mainEdgeState.isShortcut()) {
-            double dist = mainEdgeState.getDistance();
-            distance += dist;
-            long flags = mainEdgeState.getFlags();
-            time += calcMillis(dist, flags, reverse);
+            distance += mainEdgeState.getDistance();
+            time += weighting.calcMillis(mainEdgeState, reverse, EdgeIterator.NO_EDGE);
             addEdge(mainEdgeState.getEdge());
             return;
         }
diff --git a/core/src/main/java/com/graphhopper/routing/ch/PreparationWeighting.java b/core/src/main/java/com/graphhopper/routing/ch/PreparationWeighting.java
index 25e97e2132..e937edeb49 100644
--- a/core/src/main/java/com/graphhopper/routing/ch/PreparationWeighting.java
+++ b/core/src/main/java/com/graphhopper/routing/ch/PreparationWeighting.java
@@ -52,6 +52,11 @@ public double calcWeight(EdgeIteratorState edgeState, boolean reverse, int prevO
         return userWeighting.calcWeight(edgeState, reverse, prevOrNextEdgeId);
     }
 
+    @Override
+    public long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
+        return userWeighting.calcMillis(edgeState, reverse, prevOrNextEdgeId);
+    }
+
     @Override
     public FlagEncoder getFlagEncoder() {
         return userWeighting.getFlagEncoder();
diff --git a/core/src/main/java/com/graphhopper/routing/ch/PrepareContractionHierarchies.java b/core/src/main/java/com/graphhopper/routing/ch/PrepareContractionHierarchies.java
index ea91eb86fa..0ad5ce7bb3 100644
--- a/core/src/main/java/com/graphhopper/routing/ch/PrepareContractionHierarchies.java
+++ b/core/src/main/java/com/graphhopper/routing/ch/PrepareContractionHierarchies.java
@@ -51,7 +51,6 @@
 public class PrepareContractionHierarchies extends AbstractAlgoPreparation implements RoutingAlgorithmFactory {
     private final Logger logger = LoggerFactory.getLogger(getClass());
     private final PreparationWeighting prepareWeighting;
-    private final FlagEncoder prepareFlagEncoder;
     private final TraversalMode traversalMode;
     private final LevelEdgeFilter levelFilter;
     private final GraphHopperStorage ghStorage;
@@ -81,7 +80,6 @@
     private int periodicUpdatesPercentage = 20;
     private int lastNodesLazyUpdatePercentage = 10;
     private int neighborUpdatePercentage = 20;
-    private int initialCollectionSize = 5000;
     private double nodesContractedPercentage = 100;
     private double logMessagesPercentage = 20;
     private double dijkstraTime;
@@ -91,11 +89,10 @@
     private int maxEdgesCount;
 
     public PrepareContractionHierarchies(Directory dir, GraphHopperStorage ghStorage, CHGraph chGraph,
-                                         FlagEncoder encoder, Weighting weighting, TraversalMode traversalMode) {
+                                         Weighting weighting, TraversalMode traversalMode) {
         this.ghStorage = ghStorage;
         this.prepareGraph = (CHGraphImpl) chGraph;
         this.traversalMode = traversalMode;
-        this.prepareFlagEncoder = encoder;
         levelFilter = new LevelEdgeFilter(prepareGraph);
 
         prepareWeighting = new PreparationWeighting(weighting);
@@ -175,20 +172,8 @@ public PrepareContractionHierarchies setContractedNodes(double nodesContracted)
         return this;
     }
 
-    /**
-     * While creating an algorithm out of this preparation class 10 000 nodes are assumed which can
-     * be too high for your mobile application. E.g. A 500km query only traverses roughly 2000
-     * nodes.
-     */
-    public void setInitialCollectionSize(int initialCollectionSize) {
-        this.initialCollectionSize = initialCollectionSize;
-    }
-
     @Override
     public void doWork() {
-        if (prepareFlagEncoder == null)
-            throw new IllegalStateException("No vehicle encoder set.");
-
         if (prepareWeighting == null)
             throw new IllegalStateException("No weight calculation set.");
 
@@ -348,7 +333,6 @@ void contractNodes() {
         logger.info("took:" + (int) allSW.stop().getSeconds()
                 + ", new shortcuts: " + Helper.nf(newShortcuts)
                 + ", " + prepareWeighting
-                + ", " + prepareFlagEncoder
                 + ", dijkstras:" + dijkstraCount
                 + ", " + getTimesAsString()
                 + ", meanDegree:" + (long) meanDegree
@@ -581,6 +565,7 @@ String getCoords(EdgeIteratorState e, Graph g) {
     PrepareContractionHierarchies initFromGraph() {
         ghStorage.freeze();
         maxEdgesCount = ghStorage.getAllEdges().getMaxId();
+        FlagEncoder prepareFlagEncoder = prepareWeighting.getFlagEncoder();
         vehicleInExplorer = prepareGraph.createEdgeExplorer(new DefaultEdgeFilter(prepareFlagEncoder, true, false));
         vehicleOutExplorer = prepareGraph.createEdgeExplorer(new DefaultEdgeFilter(prepareFlagEncoder, false, true));
         final EdgeFilter allFilter = new DefaultEdgeFilter(prepareFlagEncoder, true, true);
@@ -609,7 +594,7 @@ public final boolean accept(EdgeIteratorState edgeState) {
         //   but we need the additional oldPriorities array to keep the old value which is necessary for the update method
         sortedNodes = new GHTreeMapComposed();
         oldPriorities = new int[prepareGraph.getNodes()];
-        prepareAlgo = new DijkstraOneToMany(prepareGraph, prepareFlagEncoder, prepareWeighting, traversalMode);
+        prepareAlgo = new DijkstraOneToMany(prepareGraph, prepareWeighting, traversalMode);
         return this;
     }
 
@@ -646,7 +631,10 @@ private int getOrigEdgeCount(int edgeId) {
     public RoutingAlgorithm createAlgo(Graph graph, AlgorithmOptions opts) {
         AbstractBidirAlgo algo;
         if (ASTAR_BI.equals(opts.getAlgorithm())) {
-            algo = createAStarBidirection(graph);
+            AStarBidirection tmpAlgo = createAStarBidirection(graph);
+            tmpAlgo.setApproximation(RoutingAlgorithmFactorySimple.getApproximation(ASTAR_BI, opts, graph.getNodeAccess()));
+            algo = tmpAlgo;
+
         } else if (DIJKSTRA_BI.equals(opts.getAlgorithm())) {
             algo = createDijkstraBidirection(graph);
         } else {
@@ -659,11 +647,10 @@ public RoutingAlgorithm createAlgo(Graph graph, AlgorithmOptions opts) {
     }
 
     private AStarBidirection createAStarBidirection(final Graph graph) {
-        return new AStarBidirection(graph, prepareFlagEncoder, prepareWeighting, traversalMode) {
+        return new AStarBidirection(graph, prepareWeighting, traversalMode) {
             @Override
-            protected void initCollections(int nodes) {
-                // algorithm with CH does not need that much memory pre allocated
-                super.initCollections(Math.min(initialCollectionSize, nodes));
+            protected void initCollections(int size) {
+                super.initCollections(Math.min(size, 2000));
             }
 
             @Override
@@ -678,13 +665,13 @@ protected boolean finished() {
 
             @Override
             protected Path createAndInitPath() {
-                bestPath = new Path4CH(graph, graph.getBaseGraph(), flagEncoder);
+                bestPath = new Path4CH(graph, graph.getBaseGraph(), weighting);
                 return bestPath;
             }
 
             @Override
             public String getName() {
-                return "astarbiCH";
+                return "astarbi|ch";
             }
 
             @Override
@@ -696,11 +683,10 @@ public String toString() {
     }
 
     private AbstractBidirAlgo createDijkstraBidirection(final Graph graph) {
-        return new DijkstraBidirectionRef(graph, prepareFlagEncoder, prepareWeighting, traversalMode) {
+        return new DijkstraBidirectionRef(graph, prepareWeighting, traversalMode) {
             @Override
-            protected void initCollections(int nodes) {
-                // algorithm with CH does not need that much memory pre allocated
-                super.initCollections(Math.min(initialCollectionSize, nodes));
+            protected void initCollections(int size) {
+                super.initCollections(Math.min(size, 2000));
             }
 
             @Override
@@ -715,13 +701,13 @@ public boolean finished() {
 
             @Override
             protected Path createAndInitPath() {
-                bestPath = new Path4CH(graph, graph.getBaseGraph(), flagEncoder);
+                bestPath = new Path4CH(graph, graph.getBaseGraph(), weighting);
                 return bestPath;
             }
 
             @Override
             public String getName() {
-                return "dijkstrabiCH";
+                return "dijkstrabi|ch";
             }
 
             @Override
diff --git a/core/src/main/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworks.java b/core/src/main/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworks.java
index 3ac78fc2c2..b5aa7ca87b 100644
--- a/core/src/main/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworks.java
+++ b/core/src/main/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworks.java
@@ -17,6 +17,8 @@
  */
 package com.graphhopper.routing.subnetwork;
 
+import com.carrotsearch.hppc.IntArrayList;
+import com.carrotsearch.hppc.IntIndexedContainer;
 import com.graphhopper.coll.GHBitSet;
 import com.graphhopper.coll.GHBitSetImpl;
 import com.graphhopper.routing.util.DefaultEdgeFilter;
@@ -24,8 +26,6 @@
 import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.storage.GraphHopperStorage;
 import com.graphhopper.util.*;
-import gnu.trove.list.TIntList;
-import gnu.trove.list.array.TIntArrayList;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -76,7 +76,7 @@ public void doWork() {
             if (minOneWayNetworkSize > 0)
                 unvisitedDeadEnds += removeDeadEndUnvisitedNetworks(filter);
 
-            List<TIntArrayList> components = findSubnetworks(filter);
+            List<IntArrayList> components = findSubnetworks(filter);
             keepLargeNetworks(filter, components);
             subnetworks = Math.max(components.size(), subnetworks);
             logger.info(components.size() + " subnetworks found for " + encoder + ", " + Helper.getMemInfo());
@@ -97,17 +97,17 @@ public int getMaxSubnetworks() {
     /**
      * This method finds the double linked components according to the specified filter.
      */
-    List<TIntArrayList> findSubnetworks(PrepEdgeFilter filter) {
+    List<IntArrayList> findSubnetworks(PrepEdgeFilter filter) {
         final FlagEncoder encoder = filter.getEncoder();
         final EdgeExplorer explorer = ghStorage.createEdgeExplorer(filter);
         int locs = ghStorage.getNodes();
-        List<TIntArrayList> list = new ArrayList<TIntArrayList>(100);
+        List<IntArrayList> list = new ArrayList<IntArrayList>(100);
         final GHBitSet bs = new GHBitSetImpl(locs);
         for (int start = 0; start < locs; start++) {
             if (bs.contains(start))
                 continue;
 
-            final TIntArrayList intList = new TIntArrayList(20);
+            final IntArrayList intList = new IntArrayList(20);
             list.add(intList);
             new BreadthFirstSearch() {
                 int tmpCounter = 0;
@@ -145,16 +145,16 @@ protected final boolean checkAdjacent(EdgeIteratorState edge) {
     /**
      * Deletes all but the largest subnetworks.
      */
-    int keepLargeNetworks(PrepEdgeFilter filter, List<TIntArrayList> components) {
+    int keepLargeNetworks(PrepEdgeFilter filter, List<IntArrayList> components) {
         if (components.size() <= 1)
             return 0;
 
         int maxCount = -1;
-        TIntList oldComponent = null;
+        IntIndexedContainer oldComponent = null;
         int allRemoved = 0;
         FlagEncoder encoder = filter.getEncoder();
         EdgeExplorer explorer = ghStorage.createEdgeExplorer(filter);
-        for (TIntArrayList component : components) {
+        for (IntArrayList component : components) {
             if (maxCount < 0) {
                 maxCount = component.size();
                 oldComponent = component;
@@ -222,7 +222,7 @@ int removeDeadEndUnvisitedNetworks(final PrepEdgeFilter bothFilter) {
 
         // partition graph into strongly connected components using Tarjan's algorithm        
         TarjansSCCAlgorithm tarjan = new TarjansSCCAlgorithm(ghStorage, ignoreSet, outFilter);
-        List<TIntArrayList> components = tarjan.findComponents();
+        List<IntArrayList> components = tarjan.findComponents();
         logger.info(sw.stop() + ", size:" + components.size());
 
         return removeEdges(bothFilter, components, minOneWayNetworkSize);
@@ -235,18 +235,18 @@ int removeDeadEndUnvisitedNetworks(final PrepEdgeFilter bothFilter) {
      *
      * @return number of removed edges
      */
-    int removeEdges(final PrepEdgeFilter bothFilter, List<TIntArrayList> components, int min) {
+    int removeEdges(final PrepEdgeFilter bothFilter, List<IntArrayList> components, int min) {
         // remove edges determined from nodes but only if less than minimum size
         FlagEncoder encoder = bothFilter.getEncoder();
         EdgeExplorer explorer = ghStorage.createEdgeExplorer(bothFilter);
         int removedEdges = 0;
-        for (TIntArrayList component : components) {
+        for (IntArrayList component : components) {
             removedEdges += removeEdges(explorer, encoder, component, min);
         }
         return removedEdges;
     }
 
-    int removeEdges(EdgeExplorer explorer, FlagEncoder encoder, TIntList component, int min) {
+    int removeEdges(EdgeExplorer explorer, FlagEncoder encoder, IntIndexedContainer component, int min) {
         int removedEdges = 0;
         if (component.size() < min)
             for (int i = 0; i < component.size(); i++) {
diff --git a/core/src/main/java/com/graphhopper/routing/subnetwork/TarjansSCCAlgorithm.java b/core/src/main/java/com/graphhopper/routing/subnetwork/TarjansSCCAlgorithm.java
index 959e77ba06..b614c2bbcc 100644
--- a/core/src/main/java/com/graphhopper/routing/subnetwork/TarjansSCCAlgorithm.java
+++ b/core/src/main/java/com/graphhopper/routing/subnetwork/TarjansSCCAlgorithm.java
@@ -17,13 +17,13 @@
  */
 package com.graphhopper.routing.subnetwork;
 
+import com.carrotsearch.hppc.IntArrayDeque;
+import com.carrotsearch.hppc.IntArrayList;
 import com.graphhopper.coll.GHBitSet;
 import com.graphhopper.coll.GHBitSetImpl;
 import com.graphhopper.routing.util.EdgeFilter;
 import com.graphhopper.storage.GraphHopperStorage;
 import com.graphhopper.util.EdgeIterator;
-import gnu.trove.list.array.TIntArrayList;
-import gnu.trove.stack.array.TIntArrayStack;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -38,9 +38,9 @@
  * http://www.timl.id.au/?p=327 and http://homepages.ecs.vuw.ac.nz/~djp/files/P05.pdf
  */
 public class TarjansSCCAlgorithm {
-    private final ArrayList<TIntArrayList> components = new ArrayList<TIntArrayList>();
+    private final ArrayList<IntArrayList> components = new ArrayList<IntArrayList>();
     private final GraphHopperStorage graph;
-    private final TIntArrayStack nodeStack;
+    private final IntArrayDeque nodeStack;
     private final GHBitSet onStack;
     private final GHBitSet ignoreSet;
     private final int[] nodeIndex;
@@ -51,7 +51,7 @@
     public TarjansSCCAlgorithm(GraphHopperStorage graph, GHBitSet ignoreSet,
                                final EdgeFilter edgeFilter) {
         this.graph = graph;
-        this.nodeStack = new TIntArrayStack();
+        this.nodeStack = new IntArrayDeque();
         this.onStack = new GHBitSetImpl(graph.getNodes());
         this.nodeIndex = new int[graph.getNodes()];
         this.nodeLowLink = new int[graph.getNodes()];
@@ -62,7 +62,7 @@ public TarjansSCCAlgorithm(GraphHopperStorage graph, GHBitSet ignoreSet,
     /**
      * Find and return list of all strongly connected components in g.
      */
-    public List<TIntArrayList> findComponents() {
+    public List<IntArrayList> findComponents() {
         int nodes = graph.getNodes();
         for (int start = 0; start < nodes; start++) {
             if (nodeIndex[start] == 0
@@ -97,7 +97,7 @@ private void strongConnect(int firstNode) {
                 nodeIndex[start] = index;
                 nodeLowLink[start] = index;
                 index++;
-                nodeStack.push(start);
+                nodeStack.addLast(start);
                 onStack.add(start);
 
                 iter = graph.createEdgeExplorer(edgeFilter).setBaseNode(start);
@@ -131,9 +131,9 @@ private void strongConnect(int firstNode) {
             // If nodeLowLink == nodeIndex, then we are the first element in a component.
             // Add all nodes higher up on nodeStack to this component.
             if (nodeIndex[start] == nodeLowLink[start]) {
-                TIntArrayList component = new TIntArrayList();
+                IntArrayList component = new IntArrayList();
                 int node;
-                while ((node = nodeStack.pop()) != start) {
+                while ((node = nodeStack.removeLast()) != start) {
                     component.add(node);
                     onStack.remove(node);
                 }
diff --git a/core/src/main/java/com/graphhopper/routing/template/AlternativeRoutingTemplate.java b/core/src/main/java/com/graphhopper/routing/template/AlternativeRoutingTemplate.java
index 0eec83e01a..64f7246b14 100644
--- a/core/src/main/java/com/graphhopper/routing/template/AlternativeRoutingTemplate.java
+++ b/core/src/main/java/com/graphhopper/routing/template/AlternativeRoutingTemplate.java
@@ -24,7 +24,9 @@
 import com.graphhopper.routing.Path;
 import com.graphhopper.routing.QueryGraph;
 import com.graphhopper.routing.RoutingAlgorithmFactory;
+import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.storage.index.LocationIndex;
+import com.graphhopper.storage.index.QueryResult;
 import com.graphhopper.util.Parameters.Routing;
 import com.graphhopper.util.PathMerger;
 import com.graphhopper.util.PointList;
@@ -34,6 +36,7 @@
 import java.util.List;
 
 import static com.graphhopper.util.Parameters.Routing.PASS_THROUGH;
+import com.graphhopper.util.shapes.GHPoint;
 
 /**
  * Implementation of a route with no via points but multiple path lists ('alternatives').
@@ -45,6 +48,14 @@ public AlternativeRoutingTemplate(GHRequest ghRequest, GHResponse ghRsp, Locatio
         super(ghRequest, ghRsp, locationIndex);
     }
 
+    @Override
+    public List<QueryResult> lookup(List<GHPoint> points, FlagEncoder encoder) {
+        if (points.size() > 2)
+            throw new IllegalArgumentException("Currently alternative routes work only with start and end point. You tried to use: " + points.size() + " points");
+        
+        return super.lookup(points, encoder);
+    }
+
     @Override
     public List<Path> calcPaths(QueryGraph queryGraph, RoutingAlgorithmFactory algoFactory, AlgorithmOptions algoOpts) {
         boolean withViaTurnPenalty = ghRequest.getHints().getBool(Routing.PASS_THROUGH, false);
diff --git a/core/src/main/java/com/graphhopper/routing/template/RoundTripRoutingTemplate.java b/core/src/main/java/com/graphhopper/routing/template/RoundTripRoutingTemplate.java
index d7014461e5..3c0958af8d 100644
--- a/core/src/main/java/com/graphhopper/routing/template/RoundTripRoutingTemplate.java
+++ b/core/src/main/java/com/graphhopper/routing/template/RoundTripRoutingTemplate.java
@@ -35,7 +35,7 @@
 import com.graphhopper.util.Parameters.Algorithms.RoundTrip;
 import com.graphhopper.util.PathMerger;
 import com.graphhopper.util.Translation;
-import com.graphhopper.util.exceptions.CannotFindPointException;
+import com.graphhopper.util.exceptions.PointNotFoundException;
 import com.graphhopper.util.shapes.GHPoint;
 
 import java.util.ArrayList;
@@ -80,7 +80,7 @@ public RoundTripRoutingTemplate(GHRequest request, GHResponse ghRsp, LocationInd
         EdgeFilter edgeFilter = new DefaultEdgeFilter(encoder);
         QueryResult startQR = locationIndex.findClosest(start.lat, start.lon, edgeFilter);
         if (!startQR.isValid())
-            throw new CannotFindPointException("Cannot find point 0: " + start, 0);
+            throw new PointNotFoundException("Cannot find point 0: " + start, 0);
 
         queryResults.add(startQR);
 
diff --git a/core/src/main/java/com/graphhopper/routing/template/ViaRoutingTemplate.java b/core/src/main/java/com/graphhopper/routing/template/ViaRoutingTemplate.java
index 1f75dc7bf4..cfa22fb937 100644
--- a/core/src/main/java/com/graphhopper/routing/template/ViaRoutingTemplate.java
+++ b/core/src/main/java/com/graphhopper/routing/template/ViaRoutingTemplate.java
@@ -21,9 +21,7 @@
 import com.graphhopper.GHResponse;
 import com.graphhopper.PathWrapper;
 import com.graphhopper.routing.*;
-import com.graphhopper.routing.util.DefaultEdgeFilter;
-import com.graphhopper.routing.util.EdgeFilter;
-import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.util.*;
 import com.graphhopper.storage.index.LocationIndex;
 import com.graphhopper.storage.index.QueryResult;
 import com.graphhopper.util.EdgeIteratorState;
@@ -31,7 +29,7 @@
 import com.graphhopper.util.PathMerger;
 import com.graphhopper.util.StopWatch;
 import com.graphhopper.util.Translation;
-import com.graphhopper.util.exceptions.CannotFindPointException;
+import com.graphhopper.util.exceptions.PointNotFoundException;
 import com.graphhopper.util.shapes.GHPoint;
 
 import java.util.ArrayList;
@@ -65,9 +63,17 @@ public ViaRoutingTemplate(GHRequest ghRequest, GHResponse ghRsp, LocationIndex l
         queryResults = new ArrayList<>(points.size());
         for (int placeIndex = 0; placeIndex < points.size(); placeIndex++) {
             GHPoint point = points.get(placeIndex);
-            QueryResult res = locationIndex.findClosest(point.lat, point.lon, edgeFilter);
+            QueryResult res;
+            if (ghRequest.hasPointHints()) {
+                res = locationIndex.findClosest(point.lat, point.lon, new NameSimilarityEdgeFilter(edgeFilter, ghRequest.getPointHints().get(placeIndex)));
+                if (!res.isValid()) {
+                    res = locationIndex.findClosest(point.lat, point.lon, edgeFilter);
+                }
+            } else {
+                res = locationIndex.findClosest(point.lat, point.lon, edgeFilter);
+            }
             if (!res.isValid())
-                ghResponse.addError(new CannotFindPointException("Cannot find point " + placeIndex + ": " + point, placeIndex));
+                ghResponse.addError(new PointNotFoundException("Cannot find point " + placeIndex + ": " + point, placeIndex));
 
             queryResults.add(res);
         }
@@ -92,7 +98,7 @@ public ViaRoutingTemplate(GHRequest ghRequest, GHResponse ghRsp, LocationIndex l
                 Path prevRoute = pathList.get(placeIndex - 2);
                 if (prevRoute.getEdgeCount() > 0) {
                     EdgeIteratorState incomingVirtualEdge = prevRoute.getFinalEdge();
-                    queryGraph.enforceHeadingByEdgeId(fromQResult.getClosestNode(), incomingVirtualEdge.getEdge(), false);
+                    queryGraph.unfavorVirtualEdgePair(fromQResult.getClosestNode(), incomingVirtualEdge.getEdge());
                 }
             }
 
diff --git a/core/src/main/java/com/graphhopper/routing/util/AbstractFlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/AbstractFlagEncoder.java
index 89331b5e24..000d51db2f 100644
--- a/core/src/main/java/com/graphhopper/routing/util/AbstractFlagEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/AbstractFlagEncoder.java
@@ -472,8 +472,11 @@ protected double getFerrySpeed(ReaderWay way, double unknownSpeed, double shortT
                             shortTripsSpeed = speedEncoder.factor / 2;
                         }
                     } else {
-                        logger.warn("Unrealistic long duration ignored in way with way ID=" + way.getId() + " : Duration tag value="
-                                + way.getTag("duration") + " (=" + Math.round(duration / 60d) + " minutes)");
+                        long lastId = way.getNodes().isEmpty() ? -1 : way.getNodes().get(way.getNodes().size() - 1);
+                        long firstId = way.getNodes().isEmpty() ? -1 : way.getNodes().get(0);
+                        if (firstId != lastId)
+                            logger.warn("Unrealistic long duration ignored in way with way ID=" + way.getId() + " : Duration tag value="
+                                    + way.getTag("duration") + " (=" + Math.round(duration / 60d) + " minutes)");
                         durationInHours = 0;
                     }
                 }
@@ -529,7 +532,7 @@ public int defineTurnBits(int index, int shift) {
         if (maxTurnCosts == 0)
             return shift;
 
-        // optimization for turn restrictions only
+            // optimization for turn restrictions only
         else if (maxTurnCosts == 1) {
             turnRestrictionBit = 1L << shift;
             return shift + 1;
diff --git a/core/src/main/java/com/graphhopper/routing/util/BikeCommonFlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/BikeCommonFlagEncoder.java
index 25f77ff975..da67f474be 100644
--- a/core/src/main/java/com/graphhopper/routing/util/BikeCommonFlagEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/BikeCommonFlagEncoder.java
@@ -248,8 +248,19 @@ public long acceptWay(ReaderWay way) {
         if (!highwaySpeeds.containsKey(highwayValue))
             return 0;
 
+        String sacScale = way.getTag("sac_scale");
+        if (sacScale != null) {
+            if ((way.hasTag("highway", "cycleway"))
+                    && (way.hasTag("sac_scale", "hiking")))
+                return acceptBit;
+            if (!isSacScaleAllowed(sacScale))
+                return 0;
+        }
+
         // use the way if it is tagged for bikes
-        if (way.hasTag("bicycle", intendedValues) || way.hasTag("bicycle", "dismount"))
+        if (way.hasTag("bicycle", intendedValues) || 
+            way.hasTag("bicycle", "dismount") || 
+            way.hasTag("highway", "cycleway"))
             return acceptBit;
 
         // accept only if explicitly tagged for bike usage
@@ -267,15 +278,6 @@ public long acceptWay(ReaderWay way) {
         if (way.hasTag(restrictions, restrictedValues) && !getConditionalTagInspector().isRestrictedWayConditionallyPermitted(way))
             return 0;
 
-        String sacScale = way.getTag("sac_scale");
-        if (sacScale != null) {
-            if ((way.hasTag("highway", "cycleway"))
-                    && (way.hasTag("sac_scale", "hiking")))
-                return acceptBit;
-            if (!isSacScaleAllowed(sacScale))
-                return 0;
-        }
-
         if (getConditionalTagInspector().isPermittedWayConditionallyRestricted(way))
             return 0;
         else
@@ -294,6 +296,8 @@ public long handleRelationTags(ReaderRelation relation, long oldRelationFlags) {
             Integer val = bikeNetworkToCode.get(relation.getTag("network"));
             if (val != null)
                 code = val;
+            else
+                code = PriorityCode.PREFER.getValue();  // Assume priority of network "lcn" as bicycle route default
         } else if (relation.hasTag("route", "ferry")) {
             code = AVOID_IF_POSSIBLE.getValue();
         }
@@ -312,7 +316,7 @@ public long handleRelationTags(ReaderRelation relation, long oldRelationFlags) {
      *
      * @param way:   needed to retrieve tags
      * @param speed: speed guessed e.g. from the road type or other tags
-     * @return The assumed avererage speed.
+     * @return The assumed average speed.
      */
     @Override
     protected double applyMaxSpeed(ReaderWay way, double speed) {
@@ -364,14 +368,19 @@ int getSpeed(ReaderWay way) {
         String highwayTag = way.getTag("highway");
         Integer highwaySpeed = highwaySpeeds.get(highwayTag);
 
+        // Under certain conditions we need to increase the speed of pushing sections to the speed of a "highway=cycleway"
+        if (way.hasTag("highway", pushingSectionsHighways)
+                && ((way.hasTag("foot", "yes") && way.hasTag("segregated", "yes"))
+                || way.hasTag("bicycle", "designated") || way.hasTag("bicycle", "official")))
+            highwaySpeed = getHighwaySpeed("cycleway");
+
         String s = way.getTag("surface");
         if (!Helper.isEmpty(s)) {
             Integer surfaceSpeed = surfaceSpeeds.get(s);
             if (surfaceSpeed != null) {
                 speed = surfaceSpeed;
-                // Boost handling for good surfaces
+                // boost handling for good surfaces but avoid boosting if pushing section
                 if (highwaySpeed != null && surfaceSpeed > highwaySpeed) {
-                    // Avoid boosting if pushing section
                     if (pushingSectionsHighways.contains(highwayTag))
                         speed = highwaySpeed;
                     else
@@ -397,13 +406,19 @@ int getSpeed(ReaderWay way) {
         if (speed > PUSHING_SECTION_SPEED
                 && (way.hasTag("highway", pushingSectionsHighways) || way.hasTag("bicycle", "dismount"))) {
             if (!way.hasTag("bicycle", intendedValues)) {
+                // Here we set the speed for pushing sections and set speed for steps as even lower:
                 if (way.hasTag("highway", "steps"))
                     speed = PUSHING_SECTION_SPEED / 2;
                 else
                     speed = PUSHING_SECTION_SPEED;
-            } else if (way.hasTag("bicycle", "designated") || way.hasTag("bicycle", "official"))
-                speed = getHighwaySpeed("cycleway");
-            else
+            } else if (way.hasTag("bicycle", "designated") || way.hasTag("bicycle", "official")) {
+                // Here we handle the cases where the OSM tagging results in something similar to "highway=cycleway"
+                speed = highwaySpeeds.get("cycleway");
+            } else {
+                speed = PUSHING_SECTION_SPEED;
+            }
+            // Increase speed in case of segregated
+            if (speed <= PUSHING_SECTION_SPEED && way.hasTag("segregated", "yes"))
                 speed = PUSHING_SECTION_SPEED * 2;
         }
 
@@ -515,8 +530,12 @@ void collect(ReaderWay way, double wayTypeSpeed, TreeMap<Double, Integer> weight
                 weightToPrioMap.put(100d, PREFER.getValue());
         }
 
-        if ("cycleway".equals(highway))
-            weightToPrioMap.put(100d, VERY_NICE.getValue());
+        if ("cycleway".equals(highway)) {
+            if (way.hasTag("foot", intendedValues) && !way.hasTag("segregated", "yes"))
+                weightToPrioMap.put(100d, PREFER.getValue());
+            else
+                weightToPrioMap.put(100d, VERY_NICE.getValue());
+        }
 
         double maxSpeed = getMaxSpeed(way);
         if (preferHighwayTags.contains(highway) || maxSpeed > 0 && maxSpeed <= 30) {
@@ -535,10 +554,17 @@ void collect(ReaderWay way, double wayTypeSpeed, TreeMap<Double, Integer> weight
         if (pushingSectionsHighways.contains(highway)
                 || way.hasTag("bicycle", "use_sidepath")
                 || "parking_aisle".equals(service)) {
-            if (way.hasTag("bicycle", "yes"))
-                weightToPrioMap.put(100d, UNCHANGED.getValue());
-            else
-                weightToPrioMap.put(50d, AVOID_IF_POSSIBLE.getValue());
+            int pushingSectionPrio = AVOID_IF_POSSIBLE.getValue();
+            if (way.hasTag("bicycle", "yes") || way.hasTag("bicycle", "permissive"))
+                pushingSectionPrio = PREFER.getValue();
+            if (way.hasTag("bicycle", "designated") || way.hasTag("bicycle", "official"))
+                pushingSectionPrio = VERY_NICE.getValue();
+            if (way.hasTag("foot", "yes")) {
+                pushingSectionPrio = Math.max(pushingSectionPrio - 1, WORST.getValue());
+                if (way.hasTag("segregated", "yes"))
+                    pushingSectionPrio = Math.min(pushingSectionPrio + 1, BEST.getValue());
+            }
+            weightToPrioMap.put(100d, pushingSectionPrio);
         }
 
         if (way.hasTag("railway", "tram"))
@@ -555,7 +581,7 @@ void collect(ReaderWay way, double wayTypeSpeed, TreeMap<Double, Integer> weight
         }
 
         // Increase the priority for scenic routes or in case that maxspeed limits our average speed as compensation. See #630
-        if (way.hasTag("scenic", "yes") || ((maxSpeed > 0) && (maxSpeed < wayTypeSpeed))) {
+        if (way.hasTag("scenic", "yes") || maxSpeed > 0 && maxSpeed < wayTypeSpeed) {
             if (weightToPrioMap.lastEntry().getValue() < BEST.getValue())
                 // Increase the prio by one step
                 weightToPrioMap.put(110d, weightToPrioMap.lastEntry().getValue() + 1);
@@ -645,7 +671,9 @@ protected long handleSpeed(ReaderWay way, double speed, long encoded) {
         if ((isOneway || way.hasTag("junction", "roundabout"))
                 && !way.hasTag("oneway:bicycle", "no")
                 && !way.hasTag("bicycle:backward")
-                && !way.hasTag("cycleway", oppositeLanes)) {
+                && !way.hasTag("cycleway", oppositeLanes)
+                && !way.hasTag("cycleway:left", oppositeLanes)
+                && !way.hasTag("cycleway:right", oppositeLanes)) {
             boolean isBackward = way.hasTag("oneway", "-1")
                     || way.hasTag("oneway:bicycle", "-1")
                     || way.hasTag("vehicle:forward", "no")
diff --git a/core/src/main/java/com/graphhopper/routing/util/Car4WDFlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/Car4WDFlagEncoder.java
new file mode 100644
index 0000000000..5a0a678be2
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/routing/util/Car4WDFlagEncoder.java
@@ -0,0 +1,101 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.routing.util;
+
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.util.PMap;
+
+/**
+ * Defines bit layout for cars with four wheel drive
+ *
+ * @author zstadler
+ */
+public class Car4WDFlagEncoder extends CarFlagEncoder {
+
+    public Car4WDFlagEncoder() {
+        this(5, 5, 0);
+    }
+
+    public Car4WDFlagEncoder(PMap properties) {
+        super(properties);
+    }
+
+    public Car4WDFlagEncoder(String propertiesStr) {
+        this(new PMap(propertiesStr));
+    }
+
+    public Car4WDFlagEncoder(int speedBits, double speedFactor, int maxTurnCosts) {
+        super(speedBits, speedFactor, maxTurnCosts);
+
+        init();
+
+        trackTypeSpeedMap.put("grade4", 5); // ... some hard or compressed materials
+        trackTypeSpeedMap.put("grade5", 5); // ... no hard materials. soil/sand/grass
+    }
+
+    @Override
+    public int getVersion() {
+        return 1;
+    }
+
+    @Override
+    public long acceptWay(ReaderWay way) {
+        // TODO: Ferries have conditionals, like opening hours or are closed during some time in the year
+        String highwayValue = way.getTag("highway");
+        if (highwayValue == null) {
+            if (way.hasTag("route", ferries)) {
+                String motorcarTag = way.getTag("motorcar");
+                if (motorcarTag == null)
+                    motorcarTag = way.getTag("motor_vehicle");
+
+                if (motorcarTag == null && !way.hasTag("foot") && !way.hasTag("bicycle") || "yes".equals(motorcarTag))
+                    return acceptBit | ferryBit;
+            }
+            return 0;
+        }
+
+        if (!defaultSpeedMap.containsKey(highwayValue))
+            return 0;
+
+        if (way.hasTag("impassable", "yes") || way.hasTag("status", "impassable"))
+            return 0;
+
+        // multiple restrictions needs special handling compared to foot and bike, see also motorcycle
+        String firstValue = way.getFirstPriorityTag(restrictions);
+        if (!firstValue.isEmpty()) {
+            if (restrictedValues.contains(firstValue) && !getConditionalTagInspector().isRestrictedWayConditionallyPermitted(way))
+                return 0;
+            if (intendedValues.contains(firstValue))
+                return acceptBit;
+        }
+
+        // do not drive street cars into fords
+        if (isBlockFords() && ("ford".equals(highwayValue) || way.hasTag("ford")))
+            return 0;
+
+        if (getConditionalTagInspector().isPermittedWayConditionallyRestricted(way))
+            return 0;
+        else
+            return acceptBit;
+    }
+
+    @Override
+    public String toString() {
+        return "car4wd";
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/routing/util/CarFlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/CarFlagEncoder.java
index d9e4a7722c..956edc9598 100644
--- a/core/src/main/java/com/graphhopper/routing/util/CarFlagEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/CarFlagEncoder.java
@@ -34,6 +34,12 @@
 public class CarFlagEncoder extends AbstractFlagEncoder {
     protected final Map<String, Integer> trackTypeSpeedMap = new HashMap<String, Integer>();
     protected final Set<String> badSurfaceSpeedMap = new HashSet<String>();
+
+    // This value determines the maximal possible on roads with bad surfaces
+    protected int badSurfaceSpeed;
+
+    // This value determines the speed for roads with access=destination
+    protected int destinationSpeed;
     /**
      * A map which associates string to speed. Get some impression:
      * http://www.itoworld.com/map/124#fullscreen
@@ -51,6 +57,7 @@ public CarFlagEncoder(PMap properties) {
                 properties.getBool("turn_costs", false) ? 1 : 0);
         this.properties = properties;
         this.setBlockFords(properties.getBool("block_fords", true));
+        this.setBlockByDefault(properties.getBool("block_barriers", true));        
     }
 
     public CarFlagEncoder(String propertiesStr) {
@@ -88,9 +95,7 @@ public CarFlagEncoder(int speedBits, double speedFactor, int maxTurnCosts) {
 
         trackTypeSpeedMap.put("grade1", 20); // paved
         trackTypeSpeedMap.put("grade2", 15); // now unpaved - gravel mixed with ...
-        trackTypeSpeedMap.put("grade3", 10); // ... hard and soft materials
-        trackTypeSpeedMap.put("grade4", 5); // ... some hard or compressed materials
-        trackTypeSpeedMap.put("grade5", 5); // ... no hard materials. soil/sand/grass
+        trackTypeSpeedMap.put("grade3", 10); // ... hard and soft materials        
 
         badSurfaceSpeedMap.add("cobblestone");
         badSurfaceSpeedMap.add("grass_paver");
@@ -100,6 +105,13 @@ public CarFlagEncoder(int speedBits, double speedFactor, int maxTurnCosts) {
         badSurfaceSpeedMap.add("dirt");
         badSurfaceSpeedMap.add("ground");
         badSurfaceSpeedMap.add("grass");
+        badSurfaceSpeedMap.add("unpaved");
+        badSurfaceSpeedMap.add("compacted");
+
+        // limit speed on bad surfaces to 30 km/h
+        badSurfaceSpeed = 30;
+
+        destinationSpeed = 5;
 
         maxPossibleSpeed = 140;
 
@@ -151,6 +163,10 @@ public int defineWayBits(int index, int shift) {
 
     protected double getSpeed(ReaderWay way) {
         String highwayValue = way.getTag("highway");
+        if (!Helper.isEmpty(highwayValue) && way.hasTag("motorroad", "yes")
+                && highwayValue != "motorway" && highwayValue != "motorway_link") {
+            highwayValue = "motorroad";
+        }
         Integer speed = defaultSpeedMap.get(highwayValue);
         if (speed == null)
             throw new IllegalStateException(toString() + ", no speed found for: " + highwayValue + ", tags: " + way);
@@ -230,9 +246,7 @@ public long handleWayTags(ReaderWay way, long allowed, long relationFlags) {
             double speed = getSpeed(way);
             speed = applyMaxSpeed(way, speed);
 
-            // limit speed to max 30 km/h if bad surface
-            if (speed > 30 && way.hasTag("surface", badSurfaceSpeedMap))
-                speed = 30;
+            speed = applyBadSurfaceSpeed(way, speed);
 
             flags = setSpeed(flags, speed);
 
@@ -255,6 +269,13 @@ public long handleWayTags(ReaderWay way, long allowed, long relationFlags) {
             flags |= directionBitMask;
         }
 
+        for (String restriction: restrictions) {
+            if(way.hasTag(restriction, "destination")){
+                // This is problematic as Speed != Time
+                flags = this.speedEncoder.setDoubleValue(flags, destinationSpeed);
+            }
+        }
+
         return flags;
     }
 
@@ -312,6 +333,17 @@ public String getWayInfo(ReaderWay way) {
         else
             return "destination: " + str;
     }
+    /**
+     * @param way:   needed to retrieve tags
+     * @param speed: speed guessed e.g. from the road type or other tags
+     * @return The assumed speed
+     */
+    protected double applyBadSurfaceSpeed(ReaderWay way, double speed) {
+        // limit speed if bad surface
+        if (badSurfaceSpeed > 0 && speed > badSurfaceSpeed && way.hasTag("surface", badSurfaceSpeedMap))
+            speed = badSurfaceSpeed;
+        return speed;
+    }
 
     @Override
     public String toString() {
diff --git a/core/src/main/java/com/graphhopper/routing/util/DataFlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/DataFlagEncoder.java
index 59b8d00c04..e58f96a861 100644
--- a/core/src/main/java/com/graphhopper/routing/util/DataFlagEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/DataFlagEncoder.java
@@ -22,7 +22,10 @@
 import com.graphhopper.routing.weighting.GenericWeighting;
 import com.graphhopper.util.ConfigMap;
 import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.util.Helper;
 import com.graphhopper.util.PMap;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 import java.util.*;
 import java.util.Map.Entry;
@@ -37,6 +40,9 @@
  * @author Peter Karich
  */
 public class DataFlagEncoder extends AbstractFlagEncoder {
+
+    private static final Logger LOG = LoggerFactory.getLogger(DataFlagEncoder.class);
+
     private static final Map<String, Double> DEFAULT_SPEEDS = new LinkedHashMap<String, Double>() {
         {
             put("motorway", 100d);
@@ -61,6 +67,7 @@
     };
     private final Map<String, Integer> surfaceMap = new HashMap<>();
     private final Map<String, Integer> highwayMap = new HashMap<>();
+    private final Map<String, Integer> accessMap = new HashMap<>();
     private final List<String> transportModeList = new ArrayList<>();
     private final Map<String, Integer> transportModeMap = new HashMap<>();
     private final int transportModeTunnelValue;
@@ -68,28 +75,49 @@
     private long bit0;
     private EncodedDoubleValue carFwdMaxspeedEncoder;
     private EncodedDoubleValue carBwdMaxspeedEncoder;
+    private EncodedDoubleValue heightEncoder;
+    private EncodedDoubleValue weightEncoder;
+    private EncodedDoubleValue widthEncoder;
     private EncodedValue surfaceEncoder;
     private EncodedValue highwayEncoder;
     private EncodedValue transportModeEncoder;
+    private EncodedValue accessEncoder;
+    private boolean storeHeight = false;
+    private boolean storeWeight = false;
+    private boolean storeWidth = false;
 
     public DataFlagEncoder() {
+        this(5, 5, 0);
+    }
+
+    public DataFlagEncoder(PMap properties) {
+        this((int) properties.getLong("speed_bits", 5),
+                properties.getDouble("speed_factor", 5),
+                properties.getBool("turn_costs", false) ? 1 : 0);
+        this.properties = properties;
+        this.setStoreHeight(properties.getBool("store_height", false));
+        this.setStoreWeight(properties.getBool("store_weight", false));
+        this.setStoreWidth(properties.getBool("store_width", false));
+    }
+
+    public DataFlagEncoder(int speedBits, double speedFactor, int maxTurnCosts) {
         // TODO include turn information
-        super(5, 5, 0);
+        super(speedBits, speedFactor, maxTurnCosts);
 
         maxPossibleSpeed = 140;
         //
-        // TODO restrictions (forestry, agricultural, emergency, destination, private, delivery, customers)
+        // TODO restrictions (agricultural, emergency, destination, private, delivery, customers)
         //
 
         // highway and certain tags like ferry and shuttle_train which can be used here (no logical overlap)
         List<String> highwayList = Arrays.asList(
                 /* reserve index=0 for unset roads (not accessible) */
                 "_default",
-                "motorway", "motorway_link",
+                "motorway", "motorway_link", "motorroad",
                 "trunk", "trunk_link",
                 "primary", "primary_link", "secondary", "secondary_link", "tertiary", "tertiary_link",
                 "unclassified", "residential", "living_street", "service", "road", "track",
-                "cycleway", "steps", "path", "footway", "pedestrian",
+                "forestry", "cycleway", "steps", "path", "footway", "pedestrian",
                 "ferry", "shuttle_train");
         int counter = 0;
         for (String hw : highwayList) {
@@ -113,6 +141,26 @@ public DataFlagEncoder() {
             surfaceMap.put(s, counter++);
         }
 
+        restrictions.addAll(Arrays.asList("motorcar", "motor_vehicle", "vehicle", "access"));
+
+        //Ordered in increasingly restrictive order (currently done subjective
+        List<String> accessList = Arrays.asList(
+                //"designated",
+                "yes",
+                //"permissive",
+                // From here on, we should add weight
+                "customers",
+                "destination",
+                "delivery",
+                "agricultural",
+                "no"
+        );
+
+        counter = 0;
+        for (String s : accessList) {
+            accessMap.put(s, counter++);
+        }
+
         // hiking or biking or bus routes
         // detect border crossing -> barrier:border_control
     }
@@ -132,6 +180,24 @@ public int defineWayBits(int index, int shift) {
         carBwdMaxspeedEncoder = new EncodedDoubleValue("car bwd maxspeed", shift, speedBits, speedFactor, 0, maxPossibleSpeed, true);
         shift += carBwdMaxspeedEncoder.getBits();
 
+        /* Value range: [3.0m, 5.4m] */
+        if (isStoreHeight()) {
+            heightEncoder = new EncodedDoubleValue("height restriction", shift, 7, 0.1, 0, 12, true);
+            shift += heightEncoder.getBits();
+        }
+
+        /* Value range: [1.0t, 59.5t] */
+        if (isStoreWeight()) {
+            weightEncoder = new EncodedDoubleValue("weight restriction", shift, 10, 0.1, 0, 100, true);
+            shift += weightEncoder.getBits();
+        }
+
+        /* Value range: [2.5m, 3.5m] */
+        if (isStoreWidth()) {
+            widthEncoder = new EncodedDoubleValue("width restriction", shift, 6, 0.1, 0, 6, true);
+            shift += widthEncoder.getBits();
+        }
+
         highwayEncoder = new EncodedValue("highway", shift, 5, 1, 0, highwayMap.size(), true);
         shift += highwayEncoder.getBits();
 
@@ -141,6 +207,9 @@ public int defineWayBits(int index, int shift) {
         transportModeEncoder = new EncodedValue("transport mode", shift, 3, 1, 0, transportModeMap.size(), true);
         shift += transportModeEncoder.getBits();
 
+        accessEncoder = new EncodedValue("access car", shift, 3, 1, 1, accessMap.size(), true);
+        shift += accessEncoder.getBits();
+
         return shift;
     }
 
@@ -151,56 +220,119 @@ public long handleRelationTags(ReaderRelation relation, long oldRelationFlags) {
 
     @Override
     public long acceptWay(ReaderWay way) {
-        return 1;
+        // important to skip unsupported highways, otherwise too many have to be removed after graph creation
+        // and node removal is not yet designed for that
+        if (getHighwayValue(way) == 0)
+            return 0;
+
+        return acceptBit;
+    }
+
+    int getHighwayValue(ReaderWay way) {
+        String highwayValue = way.getTag("highway");
+        Integer hwValue = highwayMap.get(highwayValue);
+        if (way.hasTag("impassable", "yes") || way.hasTag("status", "impassable"))
+            hwValue = 0;
+
+        if (hwValue == null) {
+            hwValue = 0;
+            if (way.hasTag("route", ferries)) {
+                String motorcarTag = way.getTag("motorcar");
+                if (motorcarTag == null)
+                    motorcarTag = way.getTag("motor_vehicle");
+
+                if (motorcarTag == null && !way.hasTag("foot") && !way.hasTag("bicycle")
+                        || "yes".equals(motorcarTag))
+                    hwValue = highwayMap.get("ferry");
+            }
+        }
+        return hwValue;
+    }
+
+    int getAccessValue(ReaderWay way) {
+        int accessValue = 0;
+        Integer tmpAccessValue = 0;
+        for (String restriction : restrictions) {
+            tmpAccessValue = accessMap.get(way.getTag(restriction, "yes"));
+            if (tmpAccessValue != null && tmpAccessValue > accessValue) {
+                accessValue = tmpAccessValue;
+            }
+        }
+
+        return accessValue;
+    }
+
+    //TODO It is bad that it's a bit static right now. If anyone changes the accessMap this method won't work anymore...
+    public AccessValue getEdgeAccessValue(long flags) {
+        int accessValue = (int) accessEncoder.getValue(flags);
+        switch (accessValue) {
+            case 0:
+                return AccessValue.ACCESSIBLE;
+            case 5:
+                return AccessValue.NOT_ACCESSIBLE;
+            default:
+                return AccessValue.EVENTUALLY_ACCESSIBLE;
+        }
     }
 
     @Override
     public long handleWayTags(ReaderWay way, long allowed, long relationFlags) {
+        if (!isAccept(allowed))
+            return 0;
+
         try {
             // HIGHWAY
-            String highwayValue = way.getTag("highway");
-            Integer hwValue = highwayMap.get(highwayValue);
-            if (way.hasTag("impassable", "yes") || way.hasTag("status", "impassable"))
-                hwValue = 0;
-
-            if (hwValue == null) {
-                hwValue = 0;
-                if (way.hasTag("route", ferries)) {
-                    String motorcarTag = way.getTag("motorcar");
-                    if (motorcarTag == null)
-                        motorcarTag = way.getTag("motor_vehicle");
-
-                    if (motorcarTag == null && !way.hasTag("foot") && !way.hasTag("bicycle")
-                            || "yes".equals(motorcarTag))
-                        hwValue = highwayMap.get("ferry");
-                }
-            }
-
+            int hwValue = getHighwayValue(way);
             // exclude any routing like if you have car and need to exclude all rails or ships
             if (hwValue == 0)
                 return 0;
 
             long flags = 0;
+            if (isFerry(allowed)) {
+                hwValue = highwayMap.get("ferry");
+            }
+
+            flags = highwayEncoder.setValue(0, hwValue);
 
             // MAXSPEED
             double maxSpeed = parseSpeed(way.getTag("maxspeed"));
             double fwdSpeed = parseSpeed(way.getTag("maxspeed:forward"));
             if (fwdSpeed < 0 || maxSpeed > 0 && maxSpeed < fwdSpeed)
                 fwdSpeed = maxSpeed;
+            if (fwdSpeed > getMaxPossibleSpeed())
+                fwdSpeed = getMaxPossibleSpeed();
+
 
             double bwdSpeed = parseSpeed(way.getTag("maxspeed:backward"));
             if (bwdSpeed < 0 || maxSpeed > 0 && maxSpeed < bwdSpeed)
                 bwdSpeed = maxSpeed;
+            if (bwdSpeed > getMaxPossibleSpeed())
+                bwdSpeed = getMaxPossibleSpeed();
 
-            // 0 is reserved for default i.e. no maxspeed sign
-            // TODO currently 140 is used for "none" speed limit
+
+            // 0 is reserved for default i.e. no maxspeed sign (does not imply no speed limit)
+            // TODO and 140 should be used for "none" speed limit on German Autobahn
             if (fwdSpeed > 0)
                 flags = carFwdMaxspeedEncoder.setDoubleValue(flags, fwdSpeed);
 
             if (bwdSpeed > 0)
                 flags = carBwdMaxspeedEncoder.setDoubleValue(flags, bwdSpeed);
 
-            flags = highwayEncoder.setValue(flags, hwValue);
+            // Road attributes (height, weight, width)
+            if (isStoreHeight()) {
+                List<String> heightTags = Arrays.asList("maxheight", "maxheight:physical");
+                flags = extractMeter(way, flags, heightEncoder, heightTags);
+            }
+
+            if (isStoreWeight()) {
+                List<String> weightTags = Arrays.asList("maxweight", "maxgcweight");
+                flags = extractTons(way, flags, weightEncoder, weightTags);
+            }
+
+            if (isStoreWidth()) {
+                List<String> widthTags = Arrays.asList("maxwidth", "maxwidth:physical");
+                flags = extractMeter(way, flags, widthEncoder, widthTags);
+            }
 
             // SURFACE
             String surfaceValue = way.getTag("surface");
@@ -245,26 +377,113 @@ public long handleWayTags(ReaderWay way, long allowed, long relationFlags) {
             if (!isBit0Empty(flags))
                 throw new IllegalStateException("bit0 has to be empty on creation");
 
+            flags = accessEncoder.setValue(flags, getAccessValue(way));
+
             return flags;
         } catch (Exception ex) {
             throw new RuntimeException("Error while parsing way " + way.toString(), ex);
         }
     }
 
+    private long extractMeter(ReaderWay way, long flags, EncodedDoubleValue valueEncoder, List<String> keys) {
+        String value = way.getFirstPriorityTag(keys);
+        if (Helper.isEmpty(value)) return flags;
+
+        double val;
+        try {
+            val = stringToMeter(value);
+        } catch (Exception ex) {
+            LOG.warn("Unable to extract meter from malformed road attribute '{}' for way (OSM_ID = {}).", value, way.getId(), ex);
+            return flags;
+        }
+
+        try {
+            flags = valueEncoder.setDoubleValue(flags, val);
+        }
+        catch (IllegalArgumentException e) {
+            LOG.warn("Unable to process value '{}' for way (OSM_ID = {}).", val, way.getId(), e);
+        }
+
+        return flags;
+    }
+
+    private long extractTons(ReaderWay way, long flags, EncodedDoubleValue valueEncoder, List<String> keys) {
+        String value = way.getFirstPriorityTag(keys);
+        if (Helper.isEmpty(value)) return flags;
+
+        double val;
+        try {
+            val = stringToTons(value);
+        } catch (Throwable t) {
+            LOG.warn("Unable to extract tons from malformed road attribute '{}' for way (OSM_ID = {}).", value, way.getId(), t);
+            return flags;
+        }
+
+        try {
+            flags = valueEncoder.setDoubleValue(flags, val);
+        } catch (IllegalArgumentException e) {
+            LOG.warn("Unable to process tons value '{}' for way (OSM_ID = {}).", val, way.getId(), e);
+        }
+
+        return flags;
+    }
+
+    public static double stringToTons(String value) {
+        value = value.toLowerCase().replaceAll(" ", "").replaceAll("(tons|ton)", "t");
+        value = value.replace("mgw", "").trim();
+        double factor = 1;
+        if (value.endsWith("t")) {
+            value = value.substring(0, value.length() - 1);
+        } else if (value.endsWith("lbs")) {
+            value = value.substring(0, value.length() - 3);
+            factor = 0.00045359237;
+        }
+
+        return Double.parseDouble(value) * factor;
+    }
+
+    public static double stringToMeter(String value) {
+        value = value.toLowerCase().replaceAll(" ", "").replaceAll("(meters|meter|mtrs|mtr|mt|m\\.)", "m");
+        double factor = 1;
+        double offset = 0;
+        value = value.replaceAll("(\\\"|\'\')", "in").replaceAll("(\'|feet)", "ft");
+        if (value.startsWith("~") || value.contains("approx")) {
+            value = value.replaceAll("(\\~|approx)", "").trim();
+            factor = 0.8;
+        }
+
+        if (value.endsWith("in")) {
+            int startIndex = value.indexOf("ft");
+            String inchValue;
+            if (startIndex < 0) {
+                startIndex = 0;
+            } else {
+                startIndex += 2;
+            }
+
+            inchValue = value.substring(startIndex, value.length() - 2);
+            value = value.substring(0, startIndex);
+            offset = Double.parseDouble(inchValue) * 0.0254;
+        }
+
+        if (value.endsWith("ft")) {
+            value = value.substring(0, value.length() - 2);
+            factor *= 0.3048;
+        } else if (value.endsWith("m")) {
+            value = value.substring(0, value.length() - 1);
+        }
+
+        if (value.isEmpty()) {
+            return offset;
+        } else {
+            return Double.parseDouble(value) * factor + offset;
+        }
+    }
+
     @Override
     public long reverseFlags(long flags) {
         // see #728 for an explanation
         return flags ^ bit0;
-
-        // old version which does not required isBit0Empty checks when reading:
-        //
-//        flags = super.reverseFlags(flags);
-//
-//        // lower level swapping of speeds
-//        double bwd = carBwdMaxspeedEncoder.getDoubleValue(flags);
-//        flags = carBwdMaxspeedEncoder.setDoubleValue(flags, carFwdMaxspeedEncoder.getDoubleValue(flags));
-//        flags = carFwdMaxspeedEncoder.setDoubleValue(flags, bwd);
-//        return flags;
     }
 
     /**
@@ -289,6 +508,9 @@ public String getHighwayAsString(EdgeIteratorState edge) {
     }
 
     public double[] getHighwaySpeedMap(Map<String, Double> map) {
+        if (map == null)
+            throw new IllegalArgumentException("Map cannot be null when calling getHighwaySpeedMap");
+
         double[] res = new double[highwayMap.size()];
         for (Entry<String, Double> e : map.entrySet()) {
             Integer integ = highwayMap.get(e.getKey());
@@ -319,13 +541,13 @@ public String getSurfaceAsString(EdgeIteratorState edge) {
     public int getTransportMode(EdgeIteratorState edge) {
         return (int) transportModeEncoder.getValue(edge.getFlags());
     }
-    
+
     public boolean isTransportModeTunnel(EdgeIteratorState edge) {
-    	return transportModeEncoder.getValue(edge.getFlags()) == this.transportModeTunnelValue;
+        return transportModeEncoder.getValue(edge.getFlags()) == this.transportModeTunnelValue;
     }
 
     public boolean isTransportModeBridge(EdgeIteratorState edge) {
-    	return transportModeEncoder.getValue(edge.getFlags()) == this.transportModeBridgeValue;
+        return transportModeEncoder.getValue(edge.getFlags()) == this.transportModeBridgeValue;
     }
 
     public String getTransportModeAsString(EdgeIteratorState edge) {
@@ -406,15 +628,43 @@ public double getMaxspeed(EdgeIteratorState edge, int accessType, boolean revers
         return val;
     }
 
+    public double getHeight(EdgeIteratorState edge) {
+        long flags = edge.getFlags();
+        return heightEncoder.getDoubleValue(flags);
+    }
+
+    public double getWeight(EdgeIteratorState edge) {
+        long flags = edge.getFlags();
+        return weightEncoder.getDoubleValue(flags);
+    }
+
+    public double getWidth(EdgeIteratorState edge) {
+        long flags = edge.getFlags();
+        return widthEncoder.getDoubleValue(flags);
+    }
+
     @Override
     public long flagsDefault(boolean forward, boolean backward) {
         // just pick car mode to set access values?
-        throw new RuntimeException("do not call flagsDefault");
+        // throw new RuntimeException("do not call flagsDefault");
+        // TODO This is called on each of the encoders so I had to replace the runtime 
+        // exception with something, but I'm not sure this is correct.        
+        return setAccess(0, forward, backward);
     }
 
     @Override
     public long setAccess(long flags, boolean forward, boolean backward) {
-        // TODO in subnetwork we need to remove access for certain profiles or set of roads?
+        // TODO we should interpret access for *any* vehicle
+        // TODO in subnetwork we need to remove access for certain weighting profiles (or set of roads?)
+        boolean isForward = isBit0Empty(flags);
+        if (!isForward) {
+            boolean tmp = forward;
+            forward = backward;
+            backward = tmp;
+        }
+
+        flags = forward ? flags | forwardBit : flags & ~forwardBit;
+        flags = backward ? flags | backwardBit : flags & ~backwardBit;
         return flags;
     }
 
@@ -430,9 +680,7 @@ protected long setLowSpeed(long flags, double speed, boolean reverse) {
 
     @Override
     public double getSpeed(long flags) {
-        // TODO fix Path.calcMillis(Path.java:255)
-        // use pluggable weighting.calcMillis but include reverse somehow
-        return 50;
+        throw new UnsupportedOperationException("Calculate speed via more customizable Weighting.calcMillis method");
     }
 
     @Override
@@ -473,6 +721,41 @@ public boolean supports(Class<?> feature) {
         return GenericWeighting.class.isAssignableFrom(feature);
     }
 
+    public DataFlagEncoder setStoreHeight(boolean storeHeight) {
+        this.storeHeight = storeHeight;
+        return this;
+    }
+
+    public boolean isStoreHeight() {
+        return storeHeight;
+    }
+
+    public DataFlagEncoder setStoreWeight(boolean storeWeight) {
+        this.storeWeight = storeWeight;
+        return this;
+    }
+
+    public boolean isStoreWeight() {
+        return storeWeight;
+    }
+
+    public DataFlagEncoder setStoreWidth(boolean storeWidth) {
+        this.storeWidth = storeWidth;
+        return this;
+    }
+
+    public boolean isStoreWidth() {
+        return storeWidth;
+    }
+
+    @Override
+    protected String getPropertiesString() {
+        return super.getPropertiesString() +
+                "|store_height=" + storeHeight +
+                "|store_weight=" + storeWeight +
+                "|store_width=" + storeWidth;
+    }
+
     @Override
     public int getVersion() {
         return 1;
@@ -495,6 +778,25 @@ public ConfigMap readStringMap(PMap weightingMap) {
 
         ConfigMap cMap = new ConfigMap();
         cMap.put("highways", map);
+
+        cloneDoubleAttribute(weightingMap, cMap, GenericWeighting.HEIGHT_LIMIT, 0d);
+        cloneDoubleAttribute(weightingMap, cMap, GenericWeighting.WEIGHT_LIMIT, 0d);
+        cloneDoubleAttribute(weightingMap, cMap, GenericWeighting.WIDTH_LIMIT, 0d);
+
         return cMap;
     }
+
+    private void cloneDoubleAttribute(PMap weightingMap, ConfigMap cMap, String key, double _default) {
+        if (weightingMap.has(key))
+            cMap.put(key, weightingMap.getDouble(key, _default));
+
+    }
+
+    public enum AccessValue {
+
+        ACCESSIBLE,
+        EVENTUALLY_ACCESSIBLE,
+        NOT_ACCESSIBLE
+
+    }
 }
diff --git a/core/src/main/java/com/graphhopper/routing/util/DefaultFlagEncoderFactory.java b/core/src/main/java/com/graphhopper/routing/util/DefaultFlagEncoderFactory.java
index 3455ea07d1..2da33085b2 100644
--- a/core/src/main/java/com/graphhopper/routing/util/DefaultFlagEncoderFactory.java
+++ b/core/src/main/java/com/graphhopper/routing/util/DefaultFlagEncoderFactory.java
@@ -28,11 +28,14 @@
     @Override
     public FlagEncoder createFlagEncoder(String name, PMap configuration) {
         if (name.equals(GENERIC))
-            return new DataFlagEncoder();
+            return new DataFlagEncoder(configuration);
 
         else if (name.equals(CAR))
             return new CarFlagEncoder(configuration);
 
+        else if (name.equals(CAR4WD))
+            return new Car4WDFlagEncoder(configuration);
+
         if (name.equals(BIKE))
             return new BikeFlagEncoder(configuration);
 
diff --git a/core/src/main/java/com/graphhopper/routing/util/EncodedDoubleValue.java b/core/src/main/java/com/graphhopper/routing/util/EncodedDoubleValue.java
index 2773a961b9..1afc77a23d 100644
--- a/core/src/main/java/com/graphhopper/routing/util/EncodedDoubleValue.java
+++ b/core/src/main/java/com/graphhopper/routing/util/EncodedDoubleValue.java
@@ -50,7 +50,7 @@ public long setDefaultValue(long flags) {
 
     public long setDoubleValue(long flags, double value) {
         if (Double.isNaN(value))
-            throw new IllegalStateException("Value cannot be NaN");
+            throw new IllegalArgumentException("Value cannot be NaN");
 
         // scale value
         long tmpValue = Math.round(value / factor);
diff --git a/core/src/main/java/com/graphhopper/routing/util/EncodedValue.java b/core/src/main/java/com/graphhopper/routing/util/EncodedValue.java
index f6d9074ad0..db8faf9ef7 100644
--- a/core/src/main/java/com/graphhopper/routing/util/EncodedValue.java
+++ b/core/src/main/java/com/graphhopper/routing/util/EncodedValue.java
@@ -85,6 +85,10 @@ public long setValue(long flags, long value) {
         return flags | value;
     }
 
+    public String getName() {
+        return name;
+    }
+
     public long getValue(long flags) {
         // find value
         flags &= mask;
diff --git a/core/src/main/java/com/graphhopper/routing/util/EncodingManager.java b/core/src/main/java/com/graphhopper/routing/util/EncodingManager.java
index a47905b454..682eb585c4 100644
--- a/core/src/main/java/com/graphhopper/routing/util/EncodingManager.java
+++ b/core/src/main/java/com/graphhopper/routing/util/EncodingManager.java
@@ -40,7 +40,7 @@
  * @author Nop
  */
 public class EncodingManager {
-    private static final String ERR = "Encoders are requesting more than %s bits of %s flags. ";
+    private static final String ERR = "Encoders are requesting %s bits, more than %s bits of %s flags. ";
     private static final String WAY_ERR = "Decrease the number of vehicles or increase the flags to take long via graph.bytes_for_flags=8";
     private final List<AbstractFlagEncoder> edgeEncoders = new ArrayList<AbstractFlagEncoder>();
     private final int bitsForEdgeFlags;
@@ -60,7 +60,11 @@
      * @param flagEncodersStr comma delimited list of encoders. The order does not matter.
      */
     public EncodingManager(String flagEncodersStr) {
-        this(FlagEncoderFactory.DEFAULT, flagEncodersStr, 4);
+        this(flagEncodersStr, 4);
+    }
+
+    public EncodingManager(String flagEncodersStr, int bytesForEdgeFlags) {
+        this(FlagEncoderFactory.DEFAULT, flagEncodersStr, bytesForEdgeFlags);
     }
 
     public EncodingManager(FlagEncoderFactory factory, String flagEncodersStr, int bytesForEdgeFlags) {
@@ -182,26 +186,26 @@ private void registerEncoder(AbstractFlagEncoder encoder) {
         int encoderCount = edgeEncoders.size();
         int usedBits = encoder.defineNodeBits(encoderCount, nextNodeBit);
         if (usedBits > bitsForEdgeFlags)
-            throw new IllegalArgumentException(String.format(ERR, bitsForEdgeFlags, "node"));
+            throw new IllegalArgumentException(String.format(ERR, usedBits, bitsForEdgeFlags, "node"));
         encoder.setNodeBitMask(usedBits - nextNodeBit, nextNodeBit);
         nextNodeBit = usedBits;
 
         usedBits = encoder.defineWayBits(encoderCount, nextWayBit);
         if (usedBits > bitsForEdgeFlags)
-            throw new IllegalArgumentException(String.format(ERR, bitsForEdgeFlags, "way") + WAY_ERR);
+            throw new IllegalArgumentException(String.format(ERR, usedBits, bitsForEdgeFlags, "way") + WAY_ERR);
         encoder.setWayBitMask(usedBits - nextWayBit, nextWayBit);
         nextWayBit = usedBits;
 
         usedBits = encoder.defineRelationBits(encoderCount, nextRelBit);
         if (usedBits > bitsForEdgeFlags)
-            throw new IllegalArgumentException(String.format(ERR, bitsForEdgeFlags, "relation"));
+            throw new IllegalArgumentException(String.format(ERR, usedBits, bitsForEdgeFlags, "relation"));
         encoder.setRelBitMask(usedBits - nextRelBit, nextRelBit);
         nextRelBit = usedBits;
 
         // turn flag bits are independent from edge encoder bits
         usedBits = encoder.defineTurnBits(encoderCount, nextTurnBit);
         if (usedBits > bitsForTurnFlags)
-            throw new IllegalArgumentException(String.format(ERR, bitsForTurnFlags, "turn"));
+            throw new IllegalArgumentException(String.format(ERR, usedBits, bitsForTurnFlags, "turn"));
         nextTurnBit = usedBits;
 
         edgeEncoders.add(encoder);
diff --git a/core/src/main/java/com/graphhopper/routing/util/FlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/FlagEncoder.java
index a9d8ac1a06..4605505172 100644
--- a/core/src/main/java/com/graphhopper/routing/util/FlagEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/FlagEncoder.java
@@ -84,7 +84,8 @@
     long setProperties(double speed, boolean forward, boolean backward);
 
     /**
-     * Reports whether the edge is available in forward direction for a certain vehicle
+     * Reports whether the edge is available in forward direction (i.e. from base node to adj node)
+     * for a certain vehicle.
      */
     boolean isForward(long flags);
 
@@ -94,7 +95,8 @@
      * Currently this means starting from 100, and subclasses of this class start from 10000 and so on.
      */
     /**
-     * Reports whether the edge is available in backward direction for a certain vehicle
+     * Reports whether the edge is available in backward direction (i.e. from adj node to base node)
+     * for a certain vehicle.
      */
     boolean isBackward(long flags);
 
diff --git a/core/src/main/java/com/graphhopper/routing/util/FlagEncoderFactory.java b/core/src/main/java/com/graphhopper/routing/util/FlagEncoderFactory.java
index feee82647f..82e8b45d71 100644
--- a/core/src/main/java/com/graphhopper/routing/util/FlagEncoderFactory.java
+++ b/core/src/main/java/com/graphhopper/routing/util/FlagEncoderFactory.java
@@ -24,6 +24,7 @@
  */
 public interface FlagEncoderFactory {
     final String CAR = "car";
+    final String CAR4WD = "car4wd";
     final String BIKE = "bike";
     final String BIKE2 = "bike2";
     final String RACINGBIKE = "racingbike";
diff --git a/core/src/main/java/com/graphhopper/routing/util/FootFlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/FootFlagEncoder.java
index 79b0bf95ee..ae346ae670 100644
--- a/core/src/main/java/com/graphhopper/routing/util/FootFlagEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/FootFlagEncoder.java
@@ -61,7 +61,7 @@ public FootFlagEncoder(PMap properties) {
         this((int) properties.getLong("speedBits", 4),
                 properties.getDouble("speedFactor", 1));
         this.properties = properties;
-        this.setBlockFords(properties.getBool("blockFords", true));
+        this.setBlockFords(properties.getBool("block_fords", true));
     }
 
     public FootFlagEncoder(String propertiesStr) {
diff --git a/core/src/main/java/com/graphhopper/routing/util/HikeFlagEncoder.java b/core/src/main/java/com/graphhopper/routing/util/HikeFlagEncoder.java
index 693fe65360..1b499de038 100644
--- a/core/src/main/java/com/graphhopper/routing/util/HikeFlagEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/HikeFlagEncoder.java
@@ -42,7 +42,7 @@ public HikeFlagEncoder(PMap properties) {
         this((int) properties.getLong("speedBits", 4),
                 properties.getDouble("speedFactor", 1));
         this.properties = properties;
-        this.setBlockFords(properties.getBool("blockFords", true));
+        this.setBlockFords(properties.getBool("block_fords", true));
     }
 
     public HikeFlagEncoder(String propertiesStr) {
diff --git a/core/src/main/java/com/graphhopper/routing/util/HintsMap.java b/core/src/main/java/com/graphhopper/routing/util/HintsMap.java
index cf107b074e..f00228cd2f 100644
--- a/core/src/main/java/com/graphhopper/routing/util/HintsMap.java
+++ b/core/src/main/java/com/graphhopper/routing/util/HintsMap.java
@@ -35,6 +35,10 @@ public HintsMap(String weighting) {
         setWeighting(weighting);
     }
 
+    public HintsMap(HintsMap map) {
+        super(map.toMap());
+    }
+
     @Override
     public HintsMap put(String key, Object str) {
         super.put(key, str);
diff --git a/core/src/main/java/com/graphhopper/routing/util/NameSimilarityEdgeFilter.java b/core/src/main/java/com/graphhopper/routing/util/NameSimilarityEdgeFilter.java
new file mode 100644
index 0000000000..50a1f10d51
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/routing/util/NameSimilarityEdgeFilter.java
@@ -0,0 +1,135 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.routing.util;
+
+import com.graphhopper.debatty.java.stringsimilarity.JaroWinkler;
+import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.apache.commons.lang3.StringUtils;
+
+import java.util.*;
+import java.util.regex.Pattern;
+
+/**
+ * This class defines the basis for NameSimilarity matching using an EdgeFilter.
+ * The typical use-case is to match not the nearest edge in
+ * {@link com.graphhopper.storage.index.LocationIndex#findClosest(double, double, EdgeFilter)}
+ * but the match the edge which name is closest to the pointHint
+ *
+ * Names that are similar to each other are (n1 name1, n2 name2):
+ * <ul>
+ *     <li>n1 == n2</li>
+ *     <li>n1 is significant substring of n2, e.g: n1="Main Road", n2="Main Road, New York"</li>
+ *     <li>n1 and n2 contain a reasonable longest common substring, e.g.: n1="Cape Point / Cape of Good Hope", n2="Cape Point Rd, Cape Peninsula, Cape Town, 8001, Afrique du Sud"</li>
+ * </ul>
+ *
+ * We aim for allowing slight typos/differences of the substrings, without having too much false positives.
+ *
+ * @author Robin Boldt
+ */
+public class NameSimilarityEdgeFilter implements EdgeFilter {
+
+    private static final Pattern NON_WORD_CHAR = Pattern.compile("[^\\p{L}]+");
+    private final double JARO_WINKLER_ACCEPT_FACTOR = .79;
+    private final JaroWinkler jaroWinkler = new JaroWinkler();
+
+    private final EdgeFilter edgeFilter;
+    private final String pointHint;
+
+    public NameSimilarityEdgeFilter(EdgeFilter edgeFilter, String pointHint) {
+        this.edgeFilter = edgeFilter;
+        this.pointHint = prepareName(pointHint == null ? "" : pointHint);
+    }
+
+    /**
+     * Removes any characters in the String that we don't care about in the matching procedure
+     * TODO: Remove common street names like: street, road, avenue?
+     */
+    private String prepareName(String name) {
+        // TODO make this better, also split at ',' and others?
+        // TODO This limits the approach to certain 'western' languages
+        // \s = A whitespace character: [ \t\n\x0B\f\r]
+        String[] arr = name.split("\\s");
+        String tmp;
+        List<String> list = new ArrayList<>(arr.length);
+        for (int i = 0; i < arr.length; i++) {
+            tmp = NON_WORD_CHAR.matcher(arr[i].toLowerCase()).replaceAll("");
+            // Ignore matching short frases like, de, rue, st, etc.
+            if(!tmp.isEmpty() && tmp.length() > 3){
+                list.add(tmp);
+            }
+        }
+        return listToString(list);
+    }
+
+    private String removeRelation(String edgeName) {
+        if (edgeName != null && edgeName.contains(", ")) {
+            edgeName = edgeName.substring(0, edgeName.lastIndexOf(','));
+        }
+        return edgeName;
+    }
+
+    @Override
+    public final boolean accept(EdgeIteratorState iter) {
+        if (!edgeFilter.accept(iter)) {
+            return false;
+        }
+
+        if (pointHint.isEmpty()) {
+            return true;
+        }
+
+        String name = iter.getName();
+        if (name == null || name.isEmpty()) {
+            return false;
+        }
+
+        name = removeRelation(name);
+        String edgeName = prepareName(name);
+
+        return isJaroWinklerSimilar(pointHint, edgeName);
+    }
+
+    private boolean isJaroWinklerSimilar(String str1, String str2) {
+        double jwSimilarity = jaroWinkler.similarity(str1, str2);
+        // System.out.println(str1 + " vs. edge:" + str2 + ", " + jwSimilarity);
+        return jwSimilarity > JARO_WINKLER_ACCEPT_FACTOR;
+    }
+
+    private final String listToString(List<String> list){
+        StringBuilder b = new StringBuilder();
+        for (int i = 0; i<list.size(); i++) {
+            b.append(list.get(i));
+        }
+        return b.toString();
+    }
+
+
+    private boolean isLevenshteinSimilar(String hint, String name) {
+        // too big length difference
+        if (Math.min(name.length(), hint.length()) * 4 < Math.max(name.length(), hint.length()))
+            return false;
+
+        // The part 'abs(pointHint.length - name.length)' tries to make differences regarding length less important
+        // Ie. 'hauptstraßedresden' vs. 'hauptstr.' should be considered a match, but 'hauptstraßedresden' vs. 'klingestraßedresden' should not match
+        int factor = 1 + Math.abs(hint.length() - name.length());
+        int levDistance = StringUtils.getLevenshteinDistance(hint, name);
+        // System.out.println(hint + " vs. edge:" + name + ", " + levDistance + " <= " + factor);
+        return levDistance <= factor;
+    }
+
+}
diff --git a/core/src/main/java/com/graphhopper/routing/util/TestAlgoCollector.java b/core/src/main/java/com/graphhopper/routing/util/TestAlgoCollector.java
index 9a8995c95e..0d5150fcc7 100644
--- a/core/src/main/java/com/graphhopper/routing/util/TestAlgoCollector.java
+++ b/core/src/main/java/com/graphhopper/routing/util/TestAlgoCollector.java
@@ -47,18 +47,28 @@ public TestAlgoCollector(String name) {
 
     public TestAlgoCollector assertDistance(AlgoHelperEntry algoEntry, List<QueryResult> queryList,
                                             OneRun oneRun) {
-        List<Path> altPaths = new ArrayList<Path>();
-        QueryGraph queryGraph = new QueryGraph(algoEntry.getQueryGraph());
+        List<Path> altPaths = new ArrayList<>();
+        QueryGraph queryGraph = new QueryGraph(algoEntry.getForQueryGraph());
         queryGraph.lookup(queryList);
-        AlgorithmOptions opts = algoEntry.opts;
-        FlagEncoder encoder = opts.getFlagEncoder();
-        if (encoder.supports(TurnWeighting.class))
-            algoEntry.setAlgorithmOptions(AlgorithmOptions.start(opts).weighting(new TurnWeighting(opts.getWeighting(), opts.getFlagEncoder(), (TurnCostExtension) queryGraph.getExtension())).build());
+        AlgorithmOptions opts = algoEntry.getAlgorithmOptions();
+        FlagEncoder encoder = opts.getWeighting().getFlagEncoder();
+        if (encoder.supports(TurnWeighting.class)) {
+            if (!opts.getTraversalMode().isEdgeBased()) {
+                errors.add("Cannot use TurnWeighting with a node based traversal");
+                return this;
+            }
+            algoEntry.setAlgorithmOptions(AlgorithmOptions.start(opts).weighting(new TurnWeighting(opts.getWeighting(), (TurnCostExtension) queryGraph.getExtension())).build());
+        }
 
+        RoutingAlgorithmFactory factory = algoEntry.createRoutingFactory();
         for (int i = 0; i < queryList.size() - 1; i++) {
-            RoutingAlgorithm algo = algoEntry.createAlgo(queryGraph);
+            RoutingAlgorithm algo = factory.createAlgo(queryGraph, algoEntry.getAlgorithmOptions());
+//            if (!algoEntry.getExpectedAlgo().equals(algo.toString())) {
+//                errors.add("Algorithm expected " + algoEntry.getExpectedAlgo() + " but was " + algo.toString());
+//                return this;
+//            }
+
             Path path = algo.calcPath(queryList.get(i).getClosestNode(), queryList.get(i + 1).getClosestNode());
-            // System.out.println(path.calcInstructions().createGPX("temp", 0, "GMT"));
             altPaths.add(path);
         }
 
@@ -70,7 +80,7 @@ public TestAlgoCollector assertDistance(AlgoHelperEntry algoEntry, List<QueryRes
         pathMerger.doWork(rsp, altPaths, trMap.getWithFallBack(Locale.US));
 
         if (rsp.hasErrors()) {
-            errors.add(algoEntry + " response contains errors. Expected distance: " + rsp.getDistance()
+            errors.add("response for " + algoEntry + " contains errors. Expected distance: " + oneRun.getDistance()
                     + ", expected points: " + oneRun + ". " + queryList + ", errors:" + rsp.getErrors());
             return this;
         }
@@ -134,45 +144,45 @@ void printSummary() {
     }
 
     public static class AlgoHelperEntry {
-        private final Graph baseGraph;
         private final LocationIndex idx;
-        private Graph queryGraph;
+        private Graph forQueryGraph;
+        private String expectedAlgo;
         private AlgorithmOptions opts;
 
-        public AlgoHelperEntry(Graph g, Graph baseGraph, AlgorithmOptions opts, LocationIndex idx) {
-            this.queryGraph = g;
-            this.baseGraph = baseGraph;
+        public AlgoHelperEntry(Graph g, AlgorithmOptions opts, LocationIndex idx, String expectedAlgo) {
+            this.forQueryGraph = g;
             this.opts = opts;
             this.idx = idx;
+            this.expectedAlgo = expectedAlgo;
         }
 
-        public Graph getQueryGraph() {
-            return queryGraph;
+        public Graph getForQueryGraph() {
+            return forQueryGraph;
         }
 
-        public void setQueryGraph(Graph queryGraph) {
-            this.queryGraph = queryGraph;
+        public void setAlgorithmOptions(AlgorithmOptions opts) {
+            this.opts = opts;
         }
 
-        public Graph getBaseGraph() {
-            return baseGraph;
+        public RoutingAlgorithmFactory createRoutingFactory() {
+            return new RoutingAlgorithmFactorySimple();
         }
 
-        public void setAlgorithmOptions(AlgorithmOptions opts) {
-            this.opts = opts;
+        public AlgorithmOptions getAlgorithmOptions() {
+            return opts;
         }
 
         public LocationIndex getIdx() {
             return idx;
         }
 
-        public RoutingAlgorithm createAlgo(Graph qGraph) {
-            return new RoutingAlgorithmFactorySimple().createAlgo(qGraph, opts);
+        public String getExpectedAlgo() {
+            return expectedAlgo;
         }
 
         @Override
         public String toString() {
-            return opts.getAlgorithm() + (queryGraph instanceof CHGraph ? "CH" : "");
+            return "algoEntry(" + opts.getAlgorithm() + (forQueryGraph instanceof CHGraph ? "|ch" : "") + ")";
         }
     }
 
diff --git a/core/src/main/java/com/graphhopper/routing/util/TurnCostEncoder.java b/core/src/main/java/com/graphhopper/routing/util/TurnCostEncoder.java
index fadc4f1b24..d0d05d8f0b 100644
--- a/core/src/main/java/com/graphhopper/routing/util/TurnCostEncoder.java
+++ b/core/src/main/java/com/graphhopper/routing/util/TurnCostEncoder.java
@@ -45,8 +45,7 @@
     long getTurnFlags(boolean restricted, double costs);
 
     /**
-     * whether turn costs nor turn restrictions will be encoded by this encoder, should be used for
-     * pedestrians
+     * No turn costs will be enabled by this encoder, should be used for pedestrians
      */
     class NoTurnCostsEncoder implements TurnCostEncoder {
 
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/AbstractAdjustedWeighting.java b/core/src/main/java/com/graphhopper/routing/weighting/AbstractAdjustedWeighting.java
index 0583990232..0e606140b7 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/AbstractAdjustedWeighting.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/AbstractAdjustedWeighting.java
@@ -19,6 +19,7 @@
 
 import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.HintsMap;
+import com.graphhopper.util.EdgeIteratorState;
 
 /**
  * The AdjustedWeighting wraps another Weighting.
@@ -34,8 +35,13 @@ public AbstractAdjustedWeighting(Weighting superWeighting) {
         this.superWeighting = superWeighting;
     }
 
+    @Override
+    public long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
+        return superWeighting.calcMillis(edgeState, reverse, prevOrNextEdgeId);
+    }
+
     /**
-     * Returns the flagEncoder of the superWeighting. Usually we do not have a Flagencoder here.
+     * Returns the flagEncoder of the superWeighting. Usually we do not have a FlagEncoder here.
      */
     @Override
     public FlagEncoder getFlagEncoder() {
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/AbstractWeighting.java b/core/src/main/java/com/graphhopper/routing/weighting/AbstractWeighting.java
index 4ed8950f2d..55ddc7dd27 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/AbstractWeighting.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/AbstractWeighting.java
@@ -19,6 +19,7 @@
 
 import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.HintsMap;
+import com.graphhopper.util.EdgeIteratorState;
 
 /**
  * @author Peter Karich
@@ -34,18 +35,21 @@ public AbstractWeighting(FlagEncoder encoder) {
             throw new IllegalStateException("Not a valid name for a Weighting: " + getName());
     }
 
-    static final boolean isValidName(String name) {
-        if (name == null || name.isEmpty())
-            return false;
+    @Override
+    public long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
+        long flags = edgeState.getFlags();
+        if (reverse && !flagEncoder.isBackward(flags)
+                || !reverse && !flagEncoder.isForward(flags))
+            throw new IllegalStateException("Calculating time should not require to read speed from edge in wrong direction. "
+                    + "Reverse:" + reverse + ", fwd:" + flagEncoder.isForward(flags) + ", bwd:" + flagEncoder.isBackward(flags));
 
-        return name.matches("[\\|_a-z]+");
-    }
+        double speed = reverse ? flagEncoder.getReverseSpeed(flags) : flagEncoder.getSpeed(flags);
+        if (Double.isInfinite(speed) || Double.isNaN(speed) || speed < 0)
+            throw new IllegalStateException("Invalid speed stored in edge! " + speed);
+        if (speed == 0)
+            throw new IllegalStateException("Speed cannot be 0 for unblocked edge, use access properties to mark edge blocked! Should only occur for shortest path calculation. See #242.");        
 
-    /**
-     * Replaces all characters which are not numbers, characters or underscores with underscores
-     */
-    public static String weightingToFileName(Weighting w) {
-        return w.toString().toLowerCase().replaceAll("\\|", "_");
+        return (long) (edgeState.getDistance() * 3600 / speed);
     }
 
     @Override
@@ -76,6 +80,20 @@ public boolean equals(Object obj) {
         return toString().equals(other.toString());
     }
 
+    static final boolean isValidName(String name) {
+        if (name == null || name.isEmpty())
+            return false;
+
+        return name.matches("[\\|_a-z]+");
+    }
+
+    /**
+     * Replaces all characters which are not numbers, characters or underscores with underscores
+     */
+    public static String weightingToFileName(Weighting w) {
+        return w.toString().toLowerCase().replaceAll("\\|", "_");
+    }
+
     @Override
     public String toString() {
         return getName() + "|" + flagEncoder;
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/AvoidEdgesWeighting.java b/core/src/main/java/com/graphhopper/routing/weighting/AvoidEdgesWeighting.java
index 74e8032f7f..ed83145f89 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/AvoidEdgesWeighting.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/AvoidEdgesWeighting.java
@@ -17,20 +17,20 @@
  */
 package com.graphhopper.routing.weighting;
 
+import com.carrotsearch.hppc.IntSet;
+import com.graphhopper.coll.GHIntHashSet;
 import com.graphhopper.util.EdgeIteratorState;
-import gnu.trove.set.TIntSet;
-import gnu.trove.set.hash.TIntHashSet;
 
 import java.util.Collection;
 
 /**
  * Rates already used Paths worse.
  *
- * @author RobinBoldt
+ * @author Robin Boldt
  */
 public class AvoidEdgesWeighting extends AbstractAdjustedWeighting {
     // contains the edge IDs of the already visited edges
-    protected final TIntSet visitedEdges = new TIntHashSet();
+    protected final IntSet visitedEdges = new GHIntHashSet();
 
     private double edgePenaltyFactor = 5.0;
 
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/BeelineWeightApproximator.java b/core/src/main/java/com/graphhopper/routing/weighting/BeelineWeightApproximator.java
index d0238466a1..2cdfe663f6 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/BeelineWeightApproximator.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/BeelineWeightApproximator.java
@@ -69,4 +69,9 @@ public BeelineWeightApproximator setDistanceCalc(DistanceCalc distanceCalc) {
         this.distanceCalc = distanceCalc;
         return this;
     }
+
+    @Override
+    public String toString() {
+        return "beeline";
+    }
 }
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/ConsistentWeightApproximator.java b/core/src/main/java/com/graphhopper/routing/weighting/ConsistentWeightApproximator.java
index 5160e1bf1b..8bfbc73829 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/ConsistentWeightApproximator.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/ConsistentWeightApproximator.java
@@ -52,4 +52,9 @@ public double approximate(int fromNode, boolean reverse) {
 
         return weightApproximation;
     }
+
+    @Override
+    public String toString() {
+        return uniDirApproximatorForward.toString();
+    }
 }
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/FastestWeighting.java b/core/src/main/java/com/graphhopper/routing/weighting/FastestWeighting.java
index 0e013f5728..98d4a7183b 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/FastestWeighting.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/FastestWeighting.java
@@ -36,11 +36,13 @@
      */
     protected final static double SPEED_CONV = 3.6;
     private final double headingPenalty;
+    private final long headingPenaltyMillis;
     private final double maxSpeed;
 
     public FastestWeighting(FlagEncoder encoder, PMap pMap) {
         super(encoder);
         headingPenalty = pMap.getDouble(Routing.HEADING_PENALTY, Routing.DEFAULT_HEADING_PENALTY);
+        headingPenaltyMillis = Math.round(headingPenalty * 1000);
         maxSpeed = encoder.getMaxSpeed() / SPEED_CONV;
     }
 
@@ -69,6 +71,17 @@ public double calcWeight(EdgeIteratorState edge, boolean reverse, int prevOrNext
         return time;
     }
 
+    @Override
+    public long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
+        // TODO move this to AbstractWeighting?
+        long time = 0;
+        boolean unfavoredEdge = edgeState.getBool(EdgeIteratorState.K_UNFAVORED_EDGE, false);
+        if (unfavoredEdge)
+            time += headingPenaltyMillis;
+
+        return time + super.calcMillis(edgeState, reverse, prevOrNextEdgeId);
+    }
+
     @Override
     public String getName() {
         return "fastest";
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/GenericWeighting.java b/core/src/main/java/com/graphhopper/routing/weighting/GenericWeighting.java
index a965765609..3b9fa3fb9d 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/GenericWeighting.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/GenericWeighting.java
@@ -17,10 +17,18 @@
  */
 package com.graphhopper.routing.weighting;
 
+import com.graphhopper.coll.GHIntHashSet;
 import com.graphhopper.routing.util.DataFlagEncoder;
+import com.graphhopper.storage.Graph;
+import com.graphhopper.storage.GraphEdgeIdFinder;
+import com.graphhopper.storage.NodeAccess;
 import com.graphhopper.util.ConfigMap;
 import com.graphhopper.util.EdgeIteratorState;
 import com.graphhopper.util.Parameters.Routing;
+import com.graphhopper.util.shapes.Shape;
+
+import java.util.Collections;
+import java.util.List;
 
 /**
  * Calculates the best route according to a configurable weighting.
@@ -29,21 +37,34 @@
  * @author Peter Karich
  */
 public class GenericWeighting extends AbstractWeighting {
+
+    public static final String HEIGHT_LIMIT = "height";
+    public static final String WEIGHT_LIMIT = "weight";
+    public static final String WIDTH_LIMIT = "width";
     /**
-     * Converting to seconds is not necessary but makes adding other penalties easier (e.g. turn
-     * costs or traffic light costs etc)
+     * Convert to milliseconds for correct calcMillis.
      */
-    protected final static double SPEED_CONV = 3.6;
-    private final double headingPenalty;
-    private final double maxSpeed;
-    private final DataFlagEncoder gEncoder;
-    private final double[] speedArray;
-    private final int accessType;
+    protected final static double SPEED_CONV = 3600;
+    protected final double headingPenalty;
+    protected final long headingPenaltyMillis;
+    protected final double maxSpeed;
+    protected final DataFlagEncoder gEncoder;
+    protected final double[] speedArray;
+    protected final int accessType;
+    protected final int eventuallAccessiblePenalty = 10;
+
+    protected final double height;
+    protected final double weight;
+    protected final double width;
+    protected final GHIntHashSet blockedEdges;
+    protected final List<Shape> blockedShapes;
+    protected NodeAccess na;
 
     public GenericWeighting(DataFlagEncoder encoder, ConfigMap cMap) {
         super(encoder);
         gEncoder = encoder;
         headingPenalty = cMap.getDouble(Routing.HEADING_PENALTY, Routing.DEFAULT_HEADING_PENALTY);
+        headingPenaltyMillis = Math.round(headingPenalty * 1000);
 
         speedArray = gEncoder.getHighwaySpeedMap(cMap.getMap("highways", Double.class));
         double tmpSpeed = 0;
@@ -56,6 +77,11 @@ public GenericWeighting(DataFlagEncoder encoder, ConfigMap cMap) {
 
         maxSpeed = tmpSpeed / SPEED_CONV;
         accessType = gEncoder.getAccessType("motor_vehicle");
+        blockedEdges = cMap.get(GraphEdgeIdFinder.BLOCKED_EDGES, new GHIntHashSet(0));
+        blockedShapes = cMap.get(GraphEdgeIdFinder.BLOCKED_SHAPES, Collections.EMPTY_LIST);
+        height = cMap.getDouble(HEIGHT_LIMIT, 0d);
+        weight = cMap.getDouble(WEIGHT_LIMIT, 0d);
+        width = cMap.getDouble(WIDTH_LIMIT, 0d);
     }
 
     @Override
@@ -64,50 +90,99 @@ public double getMinWeight(double distance) {
     }
 
     @Override
-    public double calcWeight(EdgeIteratorState edge, boolean reverse, int prevOrNextEdgeId) {
+    public double calcWeight(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
         // handle oneways and removed edges via subnetwork removal (existing and allowed highway tags but 'island' edges)
         if (reverse) {
-            if (!gEncoder.isBackward(edge, accessType))
+            if (!gEncoder.isBackward(edgeState, accessType))
                 return Double.POSITIVE_INFINITY;
-        } else if (!gEncoder.isForward(edge, accessType))
+        } else if (!gEncoder.isForward(edgeState, accessType))
+            return Double.POSITIVE_INFINITY;
+
+        if ((gEncoder.isStoreHeight() && overLimit(height, gEncoder.getHeight(edgeState))) ||
+                (gEncoder.isStoreWeight() && overLimit(weight, gEncoder.getWeight(edgeState))) ||
+                (gEncoder.isStoreWidth() && overLimit(width, gEncoder.getWidth(edgeState))))
+            return Double.POSITIVE_INFINITY;
+
+        if(!blockedEdges.isEmpty() && blockedEdges.contains(edgeState.getEdge())){
             return Double.POSITIVE_INFINITY;
+        }
+
+        if(!blockedShapes.isEmpty() && na != null){
+            for (Shape shape: blockedShapes) {
+                if(shape.contains(na.getLatitude(edgeState.getAdjNode()), na.getLongitude(edgeState.getAdjNode()))){
+                    return Double.POSITIVE_INFINITY;
+                }
+            }
+        }
+
+        long time = calcMillis(edgeState, reverse, prevOrNextEdgeId);
+        if (time == Long.MAX_VALUE)
+            return Double.POSITIVE_INFINITY;
+
+        switch (gEncoder.getEdgeAccessValue(edgeState.getFlags())){
+            case NOT_ACCESSIBLE:
+                return Double.POSITIVE_INFINITY;
+            case EVENTUALLY_ACCESSIBLE:
+                time = time * eventuallAccessiblePenalty;
+        }
 
+        return time;
+    }
+
+    private boolean overLimit(double height, double heightLimit) {
+        return height > 0 && heightLimit > 0 && height >= heightLimit;
+    }
+
+    @Override
+    public long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
         // TODO to avoid expensive reverse flags include oneway accessibility
         // but how to include e.g. maxspeed as it depends on direction? Does highway depend on direction?
         // reverse = edge.isReverse()? !reverse : reverse;
-        int highwayVal = gEncoder.getHighway(edge);
+        int highwayVal = gEncoder.getHighway(edgeState);
         double speed = speedArray[highwayVal];
         if (speed < 0)
-            throw new IllegalStateException("speed was negative? " + edge.getEdge() + ", highway:" + highwayVal + ", reverse:" + reverse);
+            throw new IllegalStateException("speed was negative? " + edgeState.getEdge()
+                    + ", highway:" + highwayVal + ", reverse:" + reverse);
         if (speed == 0)
-            return Double.POSITIVE_INFINITY;
+            return Long.MAX_VALUE;
 
         // TODO inner city guessing -> lit, maxspeed <= 50, residential etc => create new encoder.isInnerCity(edge)
         // See #472 use edge.getDouble((encoder), K_MAXSPEED_MOTORVEHICLE_FORWARD, _default) or edge.getMaxSpeed(...) instead?
         // encoder could be made optional via passing to EdgeExplorer
-        double maxspeed = gEncoder.getMaxspeed(edge, accessType, reverse);
+        double maxspeed = gEncoder.getMaxspeed(edgeState, accessType, reverse);
         if (maxspeed > 0 && speed > maxspeed)
             speed = maxspeed;
 
-        double time = edge.getDistance() / speed * SPEED_CONV;
+        // TODO test performance difference for rounding
+        long timeInMillis = (long) (edgeState.getDistance() / speed * SPEED_CONV);
 
         // add direction penalties at start/stop/via points
-        boolean unfavoredEdge = edge.getBool(EdgeIteratorState.K_UNFAVORED_EDGE, false);
+        boolean unfavoredEdge = edgeState.getBool(EdgeIteratorState.K_UNFAVORED_EDGE, false);
         if (unfavoredEdge)
-            time += headingPenalty;
-
-        if (time < 0)
-            throw new IllegalStateException("Some problem with weight calculation: time:" + time + ", speed:" + speed);
+            timeInMillis += headingPenaltyMillis;
 
         // TODO avoid a certain (or multiple) bounding boxes (less efficient for just a few edges) or a list of edgeIDs (not good for large areas)
         // bbox.contains(nodeAccess.getLatitude(edge.getBaseNode()), nodeAccess.getLongitude(edge.getBaseNode())) time+=avoidPenalty;
         // TODO surfaces can reduce average speed
         // TODO prefer or avoid bike and hike routes
-        return time;
+        if (timeInMillis < 0)
+            throw new IllegalStateException("Some problem with weight calculation: time:"
+                    + timeInMillis + ", speed:" + speed);
+
+        return timeInMillis;
     }
 
     @Override
     public String getName() {
         return "generic";
     }
+
+    /**
+     * Use this method to associate a graph with this weighting to calculate e.g. node locations too.
+     */
+    public void setGraph(Graph graph) {
+        if(graph == null)
+            return;
+        this.na = graph.getNodeAccess();
+    }
 }
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/TurnWeighting.java b/core/src/main/java/com/graphhopper/routing/weighting/TurnWeighting.java
index ae2b89d0d9..f95b088e9a 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/TurnWeighting.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/TurnWeighting.java
@@ -43,12 +43,11 @@
     /**
      * @param turnCostExt the turn cost storage to be used
      */
-    public TurnWeighting(Weighting superWeighting, TurnCostEncoder encoder, TurnCostExtension turnCostExt) {
-        this.turnCostEncoder = encoder;
+    public TurnWeighting(Weighting superWeighting, TurnCostExtension turnCostExt) {
+        this.turnCostEncoder = (TurnCostEncoder) superWeighting.getFlagEncoder();
         this.superWeighting = superWeighting;
         this.turnCostExt = turnCostExt;
-        if (encoder == null)
-            throw new IllegalArgumentException("No encoder set to calculate turn weight");
+
         if (turnCostExt == null)
             throw new RuntimeException("No storage set to calculate turn weight");
     }
@@ -86,6 +85,26 @@ public double calcWeight(EdgeIteratorState edgeState, boolean reverse, int prevO
         return weight + turnCosts;
     }
 
+    @Override
+    public long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
+        long millis = superWeighting.calcMillis(edgeState, reverse, prevOrNextEdgeId);
+        if (prevOrNextEdgeId == EdgeIterator.NO_EDGE)
+            return millis;
+
+        // TODO for now assume turn costs are returned in milliseconds?
+        // should we also separate weighting vs. time for turn? E.g. a fast but dangerous turn - is this common?
+        long turnCostsInMillis;
+        if (reverse)
+            turnCostsInMillis = (long) calcTurnWeight(edgeState.getEdge(), edgeState.getBaseNode(), prevOrNextEdgeId);
+        else
+            turnCostsInMillis = (long) calcTurnWeight(prevOrNextEdgeId, edgeState.getBaseNode(), edgeState.getEdge());
+
+        return millis + turnCostsInMillis;
+    }
+
+    /**
+     * This method calculates the turn weight separately.
+     */
     public double calcTurnWeight(int edgeFrom, int nodeVia, int edgeTo) {
         long turnFlags = turnCostExt.getTurnCostFlags(edgeFrom, nodeVia, edgeTo);
         if (turnCostEncoder.isTurnRestricted(turnFlags))
@@ -105,6 +124,11 @@ public boolean matches(HintsMap weightingMap) {
         return superWeighting.matches(weightingMap);
     }
 
+    @Override
+    public String toString() {
+        return "turn|" + superWeighting.toString();
+    }
+
     @Override
     public String getName() {
         return "turn|" + superWeighting.getName();
diff --git a/core/src/main/java/com/graphhopper/routing/weighting/Weighting.java b/core/src/main/java/com/graphhopper/routing/weighting/Weighting.java
index 1b29050f3a..fb2c5272d3 100644
--- a/core/src/main/java/com/graphhopper/routing/weighting/Weighting.java
+++ b/core/src/main/java/com/graphhopper/routing/weighting/Weighting.java
@@ -37,6 +37,11 @@
     double getMinWeight(double distance);
 
     /**
+     * This method calculates the weighting a certain edgeState should be associated. E.g. a high
+     * value indicates that the edge should be avoided. Make sure that this method is very fast and
+     * optimized as this is called potentially millions of times for one route or a lot more for
+     * nearly any preprocessing phase.
+     *
      * @param edgeState        the edge for which the weight should be calculated
      * @param reverse          if the specified edge is specified in reverse direction e.g. from the reverse
      *                         case of a bidirectional search.
@@ -47,6 +52,13 @@
      */
     double calcWeight(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId);
 
+    /**
+     * This method calculates the time taken (in milli seconds) for the specified edgeState and
+     * optionally include the turn costs (in seconds) of the previous (or next) edgeId via
+     * prevOrNextEdgeId. Typically used for post-processing and on only a few thousand edges.
+     */
+    long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId);
+
     FlagEncoder getFlagEncoder();
 
     String getName();
diff --git a/core/src/main/java/com/graphhopper/search/NameIndex.java b/core/src/main/java/com/graphhopper/search/NameIndex.java
index cbd4dc11a2..a605bae915 100644
--- a/core/src/main/java/com/graphhopper/search/NameIndex.java
+++ b/core/src/main/java/com/graphhopper/search/NameIndex.java
@@ -43,8 +43,8 @@ public NameIndex(Directory dir) {
     }
 
     @Override
-    public NameIndex create(long cap) {
-        names.create(cap);
+    public NameIndex create(long initBytes) {
+        names.create(initBytes);
         return this;
     }
 
diff --git a/core/src/main/java/com/graphhopper/storage/BaseGraph.java b/core/src/main/java/com/graphhopper/storage/BaseGraph.java
index ac19abc545..1d812c022e 100644
--- a/core/src/main/java/com/graphhopper/storage/BaseGraph.java
+++ b/core/src/main/java/com/graphhopper/storage/BaseGraph.java
@@ -30,6 +30,9 @@
 
 import static com.graphhopper.util.Helper.nf;
 
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
 /**
  * The base graph handles nodes and edges file format. It can be used with different Directory
  * implementations like RAMDirectory for fast access or via MMapDirectory for virtual-memory and not
@@ -353,8 +356,10 @@ public void checkFreeze() {
     void create(long initSize) {
         nodes.create(initSize);
         edges.create(initSize);
+
+        initSize = Math.min(initSize, 2000);
         wayGeometry.create(initSize);
-        nameIndex.create(1000);
+        nameIndex.create(initSize);
         extStorage.create(initSize);
         initStorage();
         // 0 stands for no separate geoRef
@@ -587,7 +592,12 @@ void inPlaceNodeRemove(int removeNodeCount) {
         GHBitSet toRemoveSet = new GHBitSetImpl(removeNodeCount);
         removedNodes.copyTo(toRemoveSet);
 
-        EdgeExplorer delExplorer = createEdgeExplorer(EdgeFilter.ALL_EDGES);
+        Logger logger = LoggerFactory.getLogger(getClass());
+        if (removeNodeCount > getNodes() / 2.0)
+            logger.warn("More than a half of the network should be removed!? "
+                    + "Nodes:" + getNodes() + ", remove:" + removeNodeCount);
+
+        EdgeExplorer delExplorer = createEdgeExplorer();
         // create map of old node ids pointing to new ids
         for (int removeNode = removedNodes.next(0);
              removeNode >= 0;
@@ -699,9 +709,9 @@ void inPlaceNodeRemove(int removeNodeCount) {
         // we do not remove the invalid edges => edgeCount stays the same!
         nodeCount -= removeNodeCount;
 
-        EdgeExplorer explorer = createEdgeExplorer();
         // health check
         if (isTestingEnabled()) {
+            EdgeExplorer explorer = createEdgeExplorer();
             iter = getAllEdges();
             while (iter.next()) {
                 int base = iter.getBaseNode();
diff --git a/core/src/main/java/com/graphhopper/storage/DataAccess.java b/core/src/main/java/com/graphhopper/storage/DataAccess.java
index 1acc1b978e..db7d3f7623 100644
--- a/core/src/main/java/com/graphhopper/storage/DataAccess.java
+++ b/core/src/main/java/com/graphhopper/storage/DataAccess.java
@@ -18,7 +18,7 @@
 package com.graphhopper.storage;
 
 /**
- * Abstraction of the underlying datastructure with a unique id and location. To ensure that the id
+ * Abstraction of the underlying data structure with a unique id and location. To ensure that the id
  * is unique use a Directory.attach or findAttach, if you don't need uniqueness call
  * Directory.create. Current implementations are RAM and memory mapped access.
  * <p>
diff --git a/core/src/main/java/com/graphhopper/storage/Lock.java b/core/src/main/java/com/graphhopper/storage/GHLock.java
similarity index 92%
rename from core/src/main/java/com/graphhopper/storage/Lock.java
rename to core/src/main/java/com/graphhopper/storage/GHLock.java
index 85bfab65fc..ecb04d7572 100644
--- a/core/src/main/java/com/graphhopper/storage/Lock.java
+++ b/core/src/main/java/com/graphhopper/storage/GHLock.java
@@ -18,12 +18,12 @@
 package com.graphhopper.storage;
 
 /**
- * A write lock. Influenced by Lucene code
+ * A write lock interface. Influenced by Lucene code
  * <p>
  *
  * @author Peter Karich
  */
-public interface Lock {
+public interface GHLock {
     String getName();
 
     boolean tryLock();
diff --git a/core/src/main/java/com/graphhopper/storage/GraphEdgeIdFinder.java b/core/src/main/java/com/graphhopper/storage/GraphEdgeIdFinder.java
new file mode 100644
index 0000000000..61fcdb49a4
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/storage/GraphEdgeIdFinder.java
@@ -0,0 +1,185 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for
+ *  additional information regarding copyright ownership.
+ *
+ *  GraphHopper GmbH licenses this file to you under the Apache License,
+ *  Version 2.0 (the "License"); you may not use this file except in
+ *  compliance with the License. You may obtain a copy of the License at
+ *
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.storage;
+
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.json.geo.Geometry;
+import com.graphhopper.routing.util.EdgeFilter;
+import com.graphhopper.routing.util.HintsMap;
+import com.graphhopper.storage.index.LocationIndex;
+import com.graphhopper.storage.index.QueryResult;
+import com.graphhopper.util.BreadthFirstSearch;
+import com.graphhopper.util.ConfigMap;
+import com.graphhopper.util.EdgeIteratorState;
+
+import static com.graphhopper.util.Parameters.Routing.*;
+
+import com.graphhopper.util.PointList;
+import com.graphhopper.util.shapes.BBox;
+import com.graphhopper.util.shapes.Circle;
+import com.graphhopper.util.shapes.GHPoint;
+import com.graphhopper.util.shapes.Shape;
+
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * This class allows to find edges (or construct shapes) from shape filter.
+ *
+ * @author Robin Boldt
+ */
+public class GraphEdgeIdFinder {
+
+    // internal properties
+    public static final String BLOCKED_EDGES = "graph_finder.blocked_edges";
+    public static final String BLOCKED_SHAPES = "graph_finder.blocked_shapes";
+    private final Graph graph;
+    private final LocationIndex locationIndex;
+
+    public GraphEdgeIdFinder(Graph graph, LocationIndex locationIndex) {
+        this.graph = graph;
+        this.locationIndex = locationIndex;
+    }
+
+    /**
+     * This method fills the edgeIds hash with edgeIds found close (exact match) to the specified point
+     */
+    public void findClosestEdgeToPoint(GHIntHashSet edgeIds, GHPoint point, EdgeFilter filter) {
+        findClosestEdge(edgeIds, point.getLat(), point.getLon(), filter);
+    }
+
+    /**
+     * This method fills the edgeIds hash with edgeIds found close (exact match) to the specified lat,lon
+     */
+    public void findClosestEdge(GHIntHashSet edgeIds, double lat, double lon, EdgeFilter filter) {
+        QueryResult qr = locationIndex.findClosest(lat, lon, filter);
+        if (qr.isValid())
+            edgeIds.add(qr.getClosestEdge().getEdge());
+    }
+
+    /**
+     * This method fills the edgeIds hash with edgeIds found inside the specified shape
+     */
+    public void findEdgesInShape(final GHIntHashSet edgeIds, final Shape shape, EdgeFilter filter) {
+        GHPoint center = shape.getCenter();
+        QueryResult qr = locationIndex.findClosest(center.getLat(), center.getLon(), filter);
+        // TODO: if there is no street close to the center it'll fail although there are roads covered. Maybe we should check edge points or some random points in the Shape instead?
+        if (!qr.isValid())
+            throw new IllegalArgumentException("Shape " + shape + " does not cover graph");
+
+        if (shape.contains(qr.getSnappedPoint().lat, qr.getSnappedPoint().lon))
+            edgeIds.add(qr.getClosestEdge().getEdge());
+
+        BreadthFirstSearch bfs = new BreadthFirstSearch() {
+            final NodeAccess na = graph.getNodeAccess();
+            final Shape localShape = shape;
+
+            @Override
+            protected boolean goFurther(int nodeId) {
+                return localShape.contains(na.getLatitude(nodeId), na.getLongitude(nodeId));
+            }
+
+            @Override
+            protected boolean checkAdjacent(EdgeIteratorState edge) {
+                if (localShape.contains(na.getLatitude(edge.getAdjNode()), na.getLongitude(edge.getAdjNode()))) {
+                    edgeIds.add(edge.getEdge());
+                    return true;
+                }
+                return false;
+            }
+        };
+        bfs.start(graph.createEdgeExplorer(filter), qr.getClosestNode());
+    }
+
+    /**
+     * This method fills the edgeIds hash with edgeIds found inside the specified geometry
+     */
+    public void fillEdgeIDs(GHIntHashSet edgeIds, Geometry geometry, EdgeFilter filter) {
+        if (geometry.isPoint()) {
+            GHPoint point = geometry.asPoint();
+            findClosestEdgeToPoint(edgeIds, point, filter);
+        } else if (geometry.isPointList()) {
+            PointList pl = geometry.asPointList();
+            if (geometry.getType().equals("LineString")) {
+                // TODO do map matching or routing
+                int lastIdx = pl.size() - 1;
+                if (pl.size() >= 2) {
+                    double meanLat = (pl.getLatitude(0) + pl.getLatitude(lastIdx)) / 2;
+                    double meanLon = (pl.getLongitude(0) + pl.getLongitude(lastIdx)) / 2;
+                    findClosestEdge(edgeIds, meanLat, meanLon, filter);
+                }
+            } else {
+                for (int i = 0; i < pl.size(); i++) {
+                    findClosestEdge(edgeIds, pl.getLatitude(i), pl.getLongitude(i), filter);
+                }
+            }
+        }
+    }
+
+    /**
+     * This method reads string values from the hints about blocked areas and fills the configMap with either the
+     * created shapes or the found edges if area is small enough.
+     */
+    public ConfigMap parseStringHints(ConfigMap configMap, HintsMap hints, EdgeFilter filter) {
+        final String objectSeparator = ";";
+        final String innerObjSep = ",";
+        // use shapes if bigger than 1km^2
+        final double shapeArea = 1000 * 1000;
+
+        final GHIntHashSet blockedEdges = new GHIntHashSet();
+        final List<Shape> blockedShapes = new ArrayList<>();
+
+        // Add blocked circular areas or points
+        String blockedCircularAreasStr = hints.get(BLOCK_AREA, "");
+        if (!blockedCircularAreasStr.isEmpty()) {
+            String[] blockedCircularAreasArr = blockedCircularAreasStr.split(objectSeparator);
+            for (int i = 0; i < blockedCircularAreasArr.length; i++) {
+                String objectAsString = blockedCircularAreasArr[i];
+                String[] splittedObject = objectAsString.split(innerObjSep);
+                if (splittedObject.length == 4) {
+                    final BBox bbox = BBox.parseTwoPoints(objectAsString);
+                    if (bbox.calculateArea() > shapeArea)
+                        blockedShapes.add(bbox);
+                    else
+                        findEdgesInShape(blockedEdges, bbox, filter);
+                } else if (splittedObject.length == 3) {
+                    double lat = Double.parseDouble(splittedObject[0]);
+                    double lon = Double.parseDouble(splittedObject[1]);
+                    int radius = Integer.parseInt(splittedObject[2]);
+                    Circle circle = new Circle(lat, lon, radius);
+                    if (circle.calculateArea() > shapeArea) {
+                        blockedShapes.add(circle);
+                    } else {
+                        findEdgesInShape(blockedEdges, circle, filter);
+                    }
+                } else if (splittedObject.length == 2) {
+                    double lat = Double.parseDouble(splittedObject[0]);
+                    double lon = Double.parseDouble(splittedObject[1]);
+                    findClosestEdge(blockedEdges, lat, lon, filter);
+                } else {
+                    throw new IllegalArgumentException(objectAsString + " at index " + i + " need to be defined as lat,lon "
+                            + "or as a circle lat,lon,radius or rectangular lat1,lon1,lat2,lon2");
+                }
+            }
+        }
+
+        configMap.put(BLOCKED_EDGES, blockedEdges);
+        configMap.put(BLOCKED_SHAPES, blockedShapes);
+        return configMap;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/storage/LockFactory.java b/core/src/main/java/com/graphhopper/storage/LockFactory.java
index b3fbe856f5..25b3aa90ad 100644
--- a/core/src/main/java/com/graphhopper/storage/LockFactory.java
+++ b/core/src/main/java/com/graphhopper/storage/LockFactory.java
@@ -30,7 +30,7 @@
      * Important note: even for read locks we need write access to the underlying filesystem in
      * order to avoid writes from other processes.
      */
-    Lock create(String fileName, boolean writeAccess);
+    GHLock create(String fileName, boolean writeAccess);
 
     /**
      * Removes the specified lock. Note: on windows we cannot forcefully remove an unreleased native
diff --git a/core/src/main/java/com/graphhopper/storage/MMapDataAccess.java b/core/src/main/java/com/graphhopper/storage/MMapDataAccess.java
index 93f368bbb8..b4fb668aa9 100644
--- a/core/src/main/java/com/graphhopper/storage/MMapDataAccess.java
+++ b/core/src/main/java/com/graphhopper/storage/MMapDataAccess.java
@@ -169,6 +169,7 @@ private ByteBuffer newByteBuffer(long offset, long byteCount) throws IOException
                     // mini sleep to let JVM do unmapping
                     Thread.sleep(5);
                 } catch (InterruptedException iex) {
+                    throw new IOException(iex);
                 }
             }
         }
diff --git a/core/src/main/java/com/graphhopper/storage/NativeFSLockFactory.java b/core/src/main/java/com/graphhopper/storage/NativeFSLockFactory.java
index 5e7cc8ddd7..325634f16b 100644
--- a/core/src/main/java/com/graphhopper/storage/NativeFSLockFactory.java
+++ b/core/src/main/java/com/graphhopper/storage/NativeFSLockFactory.java
@@ -64,7 +64,7 @@ public void setLockDir(File lockDir) {
     }
 
     @Override
-    public synchronized Lock create(String fileName, boolean writeAccess) {
+    public synchronized GHLock create(String fileName, boolean writeAccess) {
         if (lockDir == null)
             throw new RuntimeException("Set lockDir before creating " + (writeAccess ? "write" : "read") + " locks");
 
@@ -81,7 +81,7 @@ public synchronized void forceRemove(String fileName, boolean writeAccess) {
         }
     }
 
-    static class NativeLock implements Lock {
+    static class NativeLock implements GHLock {
         private final String name;
         private final File lockDir;
         private final File lockFile;
diff --git a/core/src/main/java/com/graphhopper/storage/SimpleFSLockFactory.java b/core/src/main/java/com/graphhopper/storage/SimpleFSLockFactory.java
index 82f1491f29..49ca8eed70 100644
--- a/core/src/main/java/com/graphhopper/storage/SimpleFSLockFactory.java
+++ b/core/src/main/java/com/graphhopper/storage/SimpleFSLockFactory.java
@@ -42,7 +42,7 @@ public void setLockDir(File lockDir) {
     }
 
     @Override
-    public synchronized Lock create(String fileName, boolean writeAccess) {
+    public synchronized GHLock create(String fileName, boolean writeAccess) {
         // TODO no read access-only support
         if (lockDir == null)
             throw new RuntimeException("Set lockDir before creating locks");
@@ -59,7 +59,7 @@ public synchronized void forceRemove(String fileName, boolean writeAccess) {
         }
     }
 
-    static class SimpleLock implements Lock {
+    static class SimpleLock implements GHLock {
         private final File lockDir;
         private final File lockFile;
         private final String name;
diff --git a/core/src/main/java/com/graphhopper/storage/TurnCostExtension.java b/core/src/main/java/com/graphhopper/storage/TurnCostExtension.java
index 6d66721be1..0bde455b9a 100644
--- a/core/src/main/java/com/graphhopper/storage/TurnCostExtension.java
+++ b/core/src/main/java/com/graphhopper/storage/TurnCostExtension.java
@@ -75,7 +75,7 @@ public void setSegmentSize(int bytes) {
 
     @Override
     public TurnCostExtension create(long initBytes) {
-        turnCosts.create((long) initBytes * turnCostsEntryBytes);
+        turnCosts.create(initBytes);
         return this;
     }
 
diff --git a/core/src/main/java/com/graphhopper/storage/VLongStorage.java b/core/src/main/java/com/graphhopper/storage/VLongStorage.java
index bdf7402efd..8ccf3755da 100644
--- a/core/src/main/java/com/graphhopper/storage/VLongStorage.java
+++ b/core/src/main/java/com/graphhopper/storage/VLongStorage.java
@@ -16,7 +16,7 @@
 import java.util.Arrays;
 
 /**
- * Taken from lucene DataOutput. VLong's are longs which have variable length depending on the size.
+ * Taken from Lucene DataOutput. VLong's are longs which have variable length depending on the size.
  * When used together with 'delta compression' it is likely that you'll use only 1 byte per value.
  */
 public class VLongStorage {
diff --git a/core/src/main/java/com/graphhopper/storage/change/ChangeGraphHelper.java b/core/src/main/java/com/graphhopper/storage/change/ChangeGraphHelper.java
new file mode 100644
index 0000000000..a8656a4b90
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/storage/change/ChangeGraphHelper.java
@@ -0,0 +1,123 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.storage.change;
+
+import com.carrotsearch.hppc.cursors.IntCursor;
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.json.geo.JsonFeature;
+import com.graphhopper.routing.util.DefaultEdgeFilter;
+import com.graphhopper.routing.util.EdgeFilter;
+import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.storage.Graph;
+import com.graphhopper.storage.GraphEdgeIdFinder;
+import com.graphhopper.storage.index.LocationIndex;
+import com.graphhopper.util.EdgeIteratorState;
+import java.util.Collection;
+import java.util.Iterator;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+import java.util.List;
+import java.util.Map;
+
+/**
+ * This graph applies permanent changes passed as JsonFeature to the specified graph.
+ *
+ * This class is not thread-safe. It is currently only safe to use it via GraphHopper.changeGraph
+ *
+ * @author Peter Karich
+ */
+public class ChangeGraphHelper {
+    private final Logger logger = LoggerFactory.getLogger(getClass());
+    private final Graph graph;
+    private final GraphEdgeIdFinder graphBrowser;
+    private boolean enableLogging = false;
+
+    public ChangeGraphHelper(Graph graph, LocationIndex locationIndex) {
+        this.graph = graph;
+        this.graphBrowser = new GraphEdgeIdFinder(graph, locationIndex);
+    }
+
+    public void setLogging(boolean log) {
+        enableLogging = log;
+    }
+
+    /**
+     * This method applies changes to the graph, specified by the json features.
+     *
+     * @return number of successfully applied edge changes
+     */
+    public long applyChanges(EncodingManager em, Collection<JsonFeature> features) {
+        long updates = 0;
+        for (JsonFeature jsonFeature : features) {
+            if (!jsonFeature.hasProperties())
+                throw new IllegalArgumentException("One feature has no properties, please specify properties e.g. speed or access");
+
+            List<String> encodersAsStr = (List) jsonFeature.getProperty("vehicles");
+            if (encodersAsStr == null) {
+                for (FlagEncoder encoder : em.fetchEdgeEncoders()) {
+                    updates += applyChange(jsonFeature, encoder);
+                }
+            } else {
+                for (String encoderStr : encodersAsStr) {
+                    updates += applyChange(jsonFeature, em.getEncoder(encoderStr));
+                }
+            }
+        }
+
+        return updates;
+    }
+
+    private long applyChange(JsonFeature jsonFeature, FlagEncoder encoder) {
+        long updates = 0;
+        EdgeFilter filter = new DefaultEdgeFilter(encoder);
+        GHIntHashSet edges = new GHIntHashSet();
+        if (jsonFeature.hasGeometry()) {
+            graphBrowser.fillEdgeIDs(edges, jsonFeature.getGeometry(), filter);
+        } else if (jsonFeature.getBBox() != null) {
+            graphBrowser.findEdgesInShape(edges, jsonFeature.getBBox(), filter);
+        } else
+            throw new IllegalArgumentException("Feature " + jsonFeature.getId() + " has no geometry and no bbox");
+
+        Iterator<IntCursor> iter = edges.iterator();
+        Map<String, Object> props = jsonFeature.getProperties();
+        while (iter.hasNext()) {
+            int edgeId = iter.next().value;
+            EdgeIteratorState edge = graph.getEdgeIteratorState(edgeId, Integer.MIN_VALUE);
+            if (props.containsKey("access")) {
+                boolean value = (boolean) props.get("access");
+                updates++;
+                if (enableLogging)
+                    logger.info(encoder.toString() + " - access change via feature " + jsonFeature.getId());
+                edge.setFlags(encoder.setAccess(edge.getFlags(), value, value));
+
+            } else if (props.containsKey("speed")) {
+                // TODO use different speed for the different directions (see e.g. Bike2WeightFlagEncoder)
+                double value = ((Number) props.get("speed")).doubleValue();
+                double oldSpeed = encoder.getSpeed(edge.getFlags());
+                if (oldSpeed != value) {
+                    updates++;
+                    if (enableLogging)
+                        logger.info(encoder.toString() + " - speed change via feature " + jsonFeature.getId() + ". Old: " + oldSpeed + ", new:" + value);
+                    edge.setFlags(encoder.setSpeed(edge.getFlags(), value));
+                }
+            }
+        }
+        return updates;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/storage/change/ChangeGraphResponse.java b/core/src/main/java/com/graphhopper/storage/change/ChangeGraphResponse.java
new file mode 100644
index 0000000000..bab332a492
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/storage/change/ChangeGraphResponse.java
@@ -0,0 +1,35 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.storage.change;
+
+/**
+ * This class describes the changes that were applied to the graph, currently only used in GraphHopper.changeGraph
+ *
+ * @author Peter Karich
+ */
+public class ChangeGraphResponse {
+    private final long updateCount;
+
+    public ChangeGraphResponse(long updateCount) {
+        this.updateCount = updateCount;
+    }
+
+    public long getUpdateCount() {
+        return updateCount;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/storage/index/Location2IDQuadtree.java b/core/src/main/java/com/graphhopper/storage/index/Location2IDQuadtree.java
index 61573c55f3..942b812df4 100644
--- a/core/src/main/java/com/graphhopper/storage/index/Location2IDQuadtree.java
+++ b/core/src/main/java/com/graphhopper/storage/index/Location2IDQuadtree.java
@@ -118,7 +118,7 @@ public LocationIndex setResolution(int resolution) {
 
     /**
      * Fill quadtree which will span a raster over the entire specified graph g. But do this in a
-     * pre-defined resolution which is controlled via capacity. This datastructure then uses approx.
+     * pre-defined resolution which is controlled via capacity. This data structure then uses approx.
      * capacity * 4 bytes. So maximum capacity is 2^30 where the quadtree would cover the world
      * boundaries every 1.3km - IMO enough for EU or US networks.
      */
diff --git a/core/src/main/java/com/graphhopper/storage/index/LocationIndexTree.java b/core/src/main/java/com/graphhopper/storage/index/LocationIndexTree.java
index 9ac7f5e6fd..d6f90c77f6 100644
--- a/core/src/main/java/com/graphhopper/storage/index/LocationIndexTree.java
+++ b/core/src/main/java/com/graphhopper/storage/index/LocationIndexTree.java
@@ -17,7 +17,11 @@
  */
 package com.graphhopper.storage.index;
 
+import com.carrotsearch.hppc.IntArrayList;
+import com.carrotsearch.hppc.cursors.IntCursor;
+import com.carrotsearch.hppc.predicates.IntPredicate;
 import com.graphhopper.coll.GHBitSet;
+import com.graphhopper.coll.GHIntHashSet;
 import com.graphhopper.coll.GHTBitSet;
 import com.graphhopper.geohash.SpatialKeyAlgo;
 import com.graphhopper.routing.util.EdgeFilter;
@@ -25,22 +29,19 @@
 import com.graphhopper.util.*;
 import com.graphhopper.util.shapes.BBox;
 import com.graphhopper.util.shapes.GHPoint;
-import gnu.trove.iterator.TIntIterator;
-import gnu.trove.list.array.TIntArrayList;
-import gnu.trove.procedure.TIntProcedure;
-import gnu.trove.set.hash.TIntHashSet;
+import java.util.ArrayList;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collection;
+import java.util.Iterator;
 import java.util.List;
 
 /**
  * This implementation implements an n-tree to get the closest node or edge from GPS coordinates.
  * <p>
- * All leafs are at the same depth, otherwise it is quite complicated to calculate the bresenham
+ * All leafs are at the same depth, otherwise it is quite complicated to calculate the Bresenham
  * line for different resolutions, especially if a leaf node could be split into a tree-node and
  * resolution changes.
  * <p>
@@ -137,7 +138,7 @@ void prepareAlgo() {
                 (bounds.maxLon - bounds.minLon) / 360 * preciseDistCalc.calcCircumference(lat));
         double tmp = maxDistInMeter / minResolutionInMeter;
         tmp = tmp * tmp;
-        TIntArrayList tmpEntries = new TIntArrayList();
+        IntArrayList tmpEntries = new IntArrayList();
         // the last one is always 4 to reduce costs if only a single entry
         tmp /= 4;
         while (tmp > 1) {
@@ -336,12 +337,13 @@ public void setSegmentSize(int bytes) {
         dataAccess.setSegmentSize(bytes);
     }
 
-    TIntArrayList getEntries() {
-        return new TIntArrayList(entries);
+    // just for test
+    IntArrayList getEntries() {
+        return IntArrayList.from(entries);
     }
 
     // fillIDs according to how they are stored
-    final void fillIDs(long keyPart, int intIndex, TIntHashSet set, int depth) {
+    final void fillIDs(long keyPart, int intIndex, GHIntHashSet set, int depth) {
         long pointer = (long) intIndex << 2;
         if (depth == entries.length) {
             int value = dataAccess.getInt(pointer);
@@ -426,11 +428,11 @@ final double calculateRMin(double lat, double lon, int paddingTiles) {
     /**
      * Provide info about tilesize for testing / visualization
      */
-    double getDeltaLat() {
+    public double getDeltaLat() {
         return deltaLat;
     }
 
-    double getDeltaLon() {
+    public double getDeltaLon() {
         return deltaLon;
     }
 
@@ -452,7 +454,7 @@ GHPoint getCenter(double lat, double lon) {
      * iteration is necessary and no early finish possible.
      */
     public final boolean findNetworkEntries(double queryLat, double queryLon,
-                                            TIntHashSet foundEntries, int iteration) {
+                                            GHIntHashSet foundEntries, int iteration) {
         // find entries in border of searchbox
         for (int yreg = -iteration; yreg <= iteration; yreg++) {
             double subqueryLat = queryLat + yreg * deltaLat;
@@ -492,11 +494,11 @@ public final boolean findNetworkEntries(double queryLat, double queryLon,
         return false;
     }
 
-    final double calcMinDistance(double queryLat, double queryLon, TIntHashSet pointset) {
+    final double calcMinDistance(double queryLat, double queryLon, GHIntHashSet pointset) {
         double min = Double.MAX_VALUE;
-        TIntIterator itr = pointset.iterator();
+        Iterator<IntCursor> itr = pointset.iterator();
         while (itr.hasNext()) {
-            int node = itr.next();
+            int node = itr.next().value;
             double lat = nodeAccess.getLat(node);
             double lon = nodeAccess.getLon(node);
             double dist = distCalc.calcDist(queryLat, queryLon, lat, lon);
@@ -507,7 +509,7 @@ final double calcMinDistance(double queryLat, double queryLon, TIntHashSet point
         return min;
     }
 
-    final void findNetworkEntriesSingleRegion(TIntHashSet storedNetworkEntryIds, double queryLat, double queryLon) {
+    public final void findNetworkEntriesSingleRegion(GHIntHashSet storedNetworkEntryIds, double queryLat, double queryLon) {
         long keyPart = createReverseKey(queryLat, queryLon);
         fillIDs(keyPart, START_POINTER, storedNetworkEntryIds, 0);
     }
@@ -517,21 +519,21 @@ public QueryResult findClosest(final double queryLat, final double queryLon, fin
         if (isClosed())
             throw new IllegalStateException("You need to create a new LocationIndex instance as it is already closed");
 
-        TIntHashSet allCollectedEntryIds = new TIntHashSet();
+        GHIntHashSet allCollectedEntryIds = new GHIntHashSet();
         final QueryResult closestMatch = new QueryResult(queryLat, queryLon);
         for (int iteration = 0; iteration < maxRegionSearch; iteration++) {
-            TIntHashSet storedNetworkEntryIds = new TIntHashSet();
+            GHIntHashSet storedNetworkEntryIds = new GHIntHashSet();
             boolean earlyFinish = findNetworkEntries(queryLat, queryLon, storedNetworkEntryIds, iteration);
             storedNetworkEntryIds.removeAll(allCollectedEntryIds);
             allCollectedEntryIds.addAll(storedNetworkEntryIds);
 
             // clone storedIds to avoid interference with forEach
-            final GHBitSet checkBitset = new GHTBitSet(new TIntHashSet(storedNetworkEntryIds));
+            final GHBitSet checkBitset = new GHTBitSet(new GHIntHashSet(storedNetworkEntryIds));
             // find nodes from the network entries which are close to 'point'
             final EdgeExplorer explorer = graph.createEdgeExplorer();
-            storedNetworkEntryIds.forEach(new TIntProcedure() {
+            storedNetworkEntryIds.forEach(new IntPredicate() {
                 @Override
-                public boolean execute(int networkEntryNodeId) {
+                public boolean apply(int networkEntryNodeId) {
                     new XFirstSearchCheck(queryLat, queryLon, checkBitset, edgeFilter) {
                         @Override
                         protected double getQueryDistance() {
@@ -596,13 +598,13 @@ public String toString() {
             return "LEAF " + /*key +*/ " " + super.toString();
         }
 
-        TIntArrayList getResults() {
+        IntArrayList getResults() {
             return this;
         }
     }
 
     // Space efficient sorted integer set. Suited for only a few entries.
-    static class SortedIntSet extends TIntArrayList {
+    static class SortedIntSet extends IntArrayList {
         public SortedIntSet() {
         }
 
@@ -614,7 +616,7 @@ public SortedIntSet(int capacity) {
          * Allow adding a value only once
          */
         public boolean addOnce(int value) {
-            int foundIndex = binarySearch(value);
+            int foundIndex = Arrays.binarySearch(buffer, 0, size(), value);
             if (foundIndex >= 0) {
                 return false;
             }
@@ -769,7 +771,7 @@ void print(InMemEntry e, StringBuilder sb, long key, int depth) {
                 int bits = keyAlgo.getBits();
                 // print reverse keys
                 sb.append(BitUtil.BIG.toBitString(BitUtil.BIG.reverse(key, bits), bits)).append("  ");
-                TIntArrayList entries = leaf.getResults();
+                IntArrayList entries = leaf.getResults();
                 for (int i = 0; i < entries.size(); i++) {
                     sb.append(leaf.get(i)).append(',');
                 }
@@ -791,7 +793,7 @@ int store(InMemEntry entry, int intIndex) {
             long refPointer = (long) intIndex * 4;
             if (entry.isLeaf()) {
                 InMemLeafEntry leaf = ((InMemLeafEntry) entry);
-                TIntArrayList entries = leaf.getResults();
+                IntArrayList entries = leaf.getResults();
                 int len = entries.size();
                 if (len == 0) {
                     return intIndex;
diff --git a/core/src/main/java/com/graphhopper/storage/index/QueryResult.java b/core/src/main/java/com/graphhopper/storage/index/QueryResult.java
index 7c1c90bfc4..278b3822a7 100644
--- a/core/src/main/java/com/graphhopper/storage/index/QueryResult.java
+++ b/core/src/main/java/com/graphhopper/storage/index/QueryResult.java
@@ -23,6 +23,8 @@
 import com.graphhopper.util.shapes.GHPoint;
 import com.graphhopper.util.shapes.GHPoint3D;
 
+import java.util.List;
+
 /**
  * Result of LocationIndex lookup.
  * <pre> X=query coordinates S=snapped coordinates: "snapping" real coords to road N=tower or pillar
@@ -49,8 +51,10 @@ public QueryResult(double queryLat, double queryLon) {
     }
 
     /**
-     * @return the closest matching node. -1 if nothing found, this should be avoided via a call of
-     * 'isValid'
+     * Returns the closest matching node. This is either a tower node of the base graph
+     * or a virtual node (see also {@link com.graphhopper.routing.QueryGraph#lookup(List)}).
+     *
+     * @return -1 if nothing found, this should be avoided via a call of 'isValid'
      */
     public int getClosestNode() {
         return closestNode;
@@ -165,6 +169,9 @@ public String toString() {
     }
 
     /**
+     * Whether the query point is projected onto a tower node, pillar node or somewhere within
+     * the closest edge.
+     *
      * Due to precision differences it is hard to define when something is exactly 90° or "on-node"
      * like TOWER or PILLAR or if it is more "on-edge" (EDGE). The default mechanism is to prefer
      * "on-edge" even if it could be 90°. To prefer "on-node" you could use e.g. GHPoint.equals with
diff --git a/core/src/main/java/com/graphhopper/util/AngleCalc.java b/core/src/main/java/com/graphhopper/util/AngleCalc.java
index 7fa179882b..211a4f671e 100644
--- a/core/src/main/java/com/graphhopper/util/AngleCalc.java
+++ b/core/src/main/java/com/graphhopper/util/AngleCalc.java
@@ -60,7 +60,7 @@ static final double atan2(double y, double x) {
      */
     public double calcOrientation(double lat1, double lon1, double lat2, double lon2) {
         double shrinkFactor = cos(toRadians((lat1 + lat2) / 2));
-        return Math.atan2((lat2 - lat1), shrinkFactor * (lon2 - lon1));
+        return Math.atan2(lat2 - lat1, shrinkFactor * (lon2 - lon1));
     }
 
     /**
@@ -80,7 +80,7 @@ public double convertAzimuth2xaxisAngle(double azimuth) {
 
     /**
      * Change the representation of an orientation, so the difference to the given baseOrientation
-     * will be smaller or equal to PI (180 degree). This is achieved by adding or substracting a
+     * will be smaller or equal to PI (180 degree). This is achieved by adding or subtracting a
      * 2*PI, so the direction of the orientation will not be changed
      */
     public double alignOrientation(double baseOrientation, double orientation) {
@@ -102,13 +102,12 @@ public double alignOrientation(double baseOrientation, double orientation) {
      * Calculate the azimuth in degree for a line given by two coordinates. Direction in 'degree'
      * where 0 is north, 90 is east, 180 is south and 270 is west.
      */
-    double calcAzimuth(double lat1, double lon1, double lat2, double lon2) {
-        double orientation = -calcOrientation(lat1, lon1, lat2, lon2);
-        orientation = Helper.round4(orientation + Math.PI / 2);
+    public double calcAzimuth(double lat1, double lon1, double lat2, double lon2) {
+        double orientation = Math.PI / 2 - calcOrientation(lat1, lon1, lat2, lon2);
         if (orientation < 0)
             orientation += 2 * Math.PI;
 
-        return Math.toDegrees(orientation);
+        return Math.toDegrees(Helper.round4(orientation));
     }
 
     String azimuth2compassPoint(double azimuth) {
diff --git a/core/src/main/java/com/graphhopper/util/BitUtil.java b/core/src/main/java/com/graphhopper/util/BitUtil.java
index 75265c42a3..e7b540c2d5 100644
--- a/core/src/main/java/com/graphhopper/util/BitUtil.java
+++ b/core/src/main/java/com/graphhopper/util/BitUtil.java
@@ -20,12 +20,12 @@
 import java.nio.ByteOrder;
 
 /**
- * Examples for BIG endianess (default for Java and computer network).
+ * Examples for BIG endianness (default for Java and computer network).
  * <pre>
  * 0=&gt;0100 0001
  * 1=&gt;1110 1011
  * 2=&gt;...
- * </pre> LITTLE endianess is default for GraphHopper and most microprocessors.
+ * </pre> LITTLE endianness is default for GraphHopper and most microprocessors.
  *
  *
  * @author Peter Karich
@@ -36,7 +36,7 @@
      */
     public static final BitUtil LITTLE = new BitUtilLittle();
     /**
-     * BIG endianess. Little is the default for GraphHopper.
+     * BIG endianness. Little is the default for GraphHopper.
      */
     public static final BitUtil BIG = new BitUtilBig();
 
@@ -149,7 +149,7 @@ public final void fromLong(byte[] bytes, long value) {
 
     /**
      * The only purpose of this method is to test 'reverse'. toBitString is the reverse and both are
-     * indepentent of the endianness.
+     * independent of the endianness.
      */
     public final long fromBitString2Long(String str) {
         if (str.length() > 64)
diff --git a/core/src/main/java/com/graphhopper/util/BitUtilBig.java b/core/src/main/java/com/graphhopper/util/BitUtilBig.java
index 1c263c1407..7d77f3b74c 100644
--- a/core/src/main/java/com/graphhopper/util/BitUtilBig.java
+++ b/core/src/main/java/com/graphhopper/util/BitUtilBig.java
@@ -18,7 +18,7 @@
 package com.graphhopper.util;
 
 /**
- * Conversion between "the memory" (integer/long/float/double/string) to bytes via BIG endianess.
+ * Conversion between "the memory" (integer/long/float/double/string) to bytes via BIG endianness.
  * <p>
  *
  * @author Peter Karich
diff --git a/core/src/main/java/com/graphhopper/util/BitUtilLittle.java b/core/src/main/java/com/graphhopper/util/BitUtilLittle.java
index 5b4715551f..5454972792 100644
--- a/core/src/main/java/com/graphhopper/util/BitUtilLittle.java
+++ b/core/src/main/java/com/graphhopper/util/BitUtilLittle.java
@@ -18,7 +18,7 @@
 package com.graphhopper.util;
 
 /**
- * Conversion between "the memory" (integer/long/float/double/string) to bytes via little endianess.
+ * Conversion between "the memory" (integer/long/float/double/string) to bytes via little endianness.
  * <p>
  *
  * @author Peter Karich
diff --git a/core/src/main/java/com/graphhopper/util/BreadthFirstSearch.java b/core/src/main/java/com/graphhopper/util/BreadthFirstSearch.java
index be5009a74b..6b32b96d8e 100644
--- a/core/src/main/java/com/graphhopper/util/BreadthFirstSearch.java
+++ b/core/src/main/java/com/graphhopper/util/BreadthFirstSearch.java
@@ -20,7 +20,7 @@
 import com.graphhopper.coll.GHBitSet;
 
 /**
- * Implementattion of breadth first search (BFS)
+ * Implementation of breadth first search (BFS)
  * <p>
  *
  * @author Peter Karich
diff --git a/core/src/main/java/com/graphhopper/util/Constants.java b/core/src/main/java/com/graphhopper/util/Constants.java
index 4b4aab0ec6..57ca5e6c90 100644
--- a/core/src/main/java/com/graphhopper/util/Constants.java
+++ b/core/src/main/java/com/graphhopper/util/Constants.java
@@ -40,6 +40,10 @@
      * True iff running on Linux.
      */
     public static final boolean LINUX = OS_NAME.startsWith("Linux");
+    /**
+     * True iff running on Android.
+     */
+    public static final boolean ANDROID = System.getProperty("java.vendor").contains("Android");
     /**
      * True iff running on Windows.
      */
diff --git a/core/src/main/java/com/graphhopper/util/DepthFirstSearch.java b/core/src/main/java/com/graphhopper/util/DepthFirstSearch.java
index e89f09678b..9bdc61e569 100644
--- a/core/src/main/java/com/graphhopper/util/DepthFirstSearch.java
+++ b/core/src/main/java/com/graphhopper/util/DepthFirstSearch.java
@@ -17,8 +17,8 @@
  */
 package com.graphhopper.util;
 
+import com.carrotsearch.hppc.IntArrayDeque;
 import com.graphhopper.coll.GHBitSet;
-import gnu.trove.stack.array.TIntArrayStack;
 
 /**
  * Implementation of depth first search (DFS) by LIFO queue
@@ -34,19 +34,19 @@
      */
     @Override
     public void start(EdgeExplorer explorer, int startNode) {
-        TIntArrayStack stack = new TIntArrayStack();
+        IntArrayDeque stack = new IntArrayDeque();
 
         GHBitSet explored = createBitSet();
-        stack.push(startNode);
+        stack.addLast(startNode);
         int current;
         while (stack.size() > 0) {
-            current = stack.pop();
+            current = stack.removeLast();
             if (!explored.contains(current) && goFurther(current)) {
                 EdgeIterator iter = explorer.setBaseNode(current);
                 while (iter.next()) {
                     int connectedId = iter.getAdjNode();
                     if (checkAdjacent(iter)) {
-                        stack.push(connectedId);
+                        stack.addLast(connectedId);
                     }
                 }
                 explored.add(current);
diff --git a/core/src/main/java/com/graphhopper/util/DistanceCalc.java b/core/src/main/java/com/graphhopper/util/DistanceCalc.java
index b36bb97d90..9422aee268 100644
--- a/core/src/main/java/com/graphhopper/util/DistanceCalc.java
+++ b/core/src/main/java/com/graphhopper/util/DistanceCalc.java
@@ -93,11 +93,11 @@ GHPoint calcCrossingPointToEdge(double r_lat_deg, double r_lon_deg,
                                     double b_lat_deg, double b_lon_deg);
 
     /**
-     * This methods projects a point given in lat and long (in degrees) into a direction, given as
-     * heading, measured clockwise from north in degrees. The distance is passed in km.
+     * This methods creates a point (lat, lon in degrees) in a certain distance and direction from the specified
+     * point (lat, lon in degrees). The heading is measured clockwise from north in degrees. The distance is passed in meter.
      */
-    public GHPoint projectCoordinate(double lat_deg, double lon_deg,
-                                     double distanceInMeter, double headingClockwiseFromNorth);
+    GHPoint projectCoordinate(double lat, double lon,
+                              double distanceInMeter, double headingClockwiseFromNorth);
 
     /*
      * Simple heuristic to detect if the specified two points are crossing the boundary +-180°. See
diff --git a/core/src/main/java/com/graphhopper/util/DistancePlaneProjection.java b/core/src/main/java/com/graphhopper/util/DistancePlaneProjection.java
index e5b749a32e..6d1d02b74e 100644
--- a/core/src/main/java/com/graphhopper/util/DistancePlaneProjection.java
+++ b/core/src/main/java/com/graphhopper/util/DistancePlaneProjection.java
@@ -20,7 +20,7 @@
 import static java.lang.Math.*;
 
 /**
- * Calculates the approximative distance of two points on earth. Very good results if delat_lon is
+ * Calculates the approximate distance of two points on earth. Very good results if delat_lon is
  * not too big (see DistanceCalcTest), e.g. the distance is small.
  * <p>
  * http://en.wikipedia.org/wiki/Geographical_distance#Spherical_Earth_projected_to_a_plane
diff --git a/core/src/main/java/com/graphhopper/util/DouglasPeucker.java b/core/src/main/java/com/graphhopper/util/DouglasPeucker.java
index 2a8040d822..5a9d06aa2a 100644
--- a/core/src/main/java/com/graphhopper/util/DouglasPeucker.java
+++ b/core/src/main/java/com/graphhopper/util/DouglasPeucker.java
@@ -18,7 +18,7 @@
 package com.graphhopper.util;
 
 /**
- * Simplyfies a list of 2D points which are not too far away.
+ * Simplifies a list of 2D points which are not too far away.
  * http://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm
  * <p>
  * Calling simplify is thread safe.
diff --git a/core/src/main/java/com/graphhopper/util/EdgeIteratorState.java b/core/src/main/java/com/graphhopper/util/EdgeIteratorState.java
index 3137e55f3a..e6aad36139 100644
--- a/core/src/main/java/com/graphhopper/util/EdgeIteratorState.java
+++ b/core/src/main/java/com/graphhopper/util/EdgeIteratorState.java
@@ -32,7 +32,7 @@
 
     /**
      * @return the edge id of the current edge. Do not make any assumptions about the concrete
-     * values, except that for an implemention it is recommended that they'll be contiguous.
+     * values, except that for an implementation it is recommended that they'll be contiguous.
      */
     int getEdge();
 
diff --git a/core/src/main/java/com/graphhopper/util/FinishInstruction.java b/core/src/main/java/com/graphhopper/util/FinishInstruction.java
index 3861b3a80e..5f1f3777f2 100644
--- a/core/src/main/java/com/graphhopper/util/FinishInstruction.java
+++ b/core/src/main/java/com/graphhopper/util/FinishInstruction.java
@@ -22,7 +22,7 @@
  */
 public class FinishInstruction extends Instruction {
     public FinishInstruction(String name, final double lat, final double lon, final double ele) {
-        super(FINISH, name, InstructionAnnotation.EMPTY, new PointList(2, true) {
+        super(FINISH, name, InstructionAnnotation.EMPTY, new PointList(2, !Double.isNaN(ele)) {
             {
                 add(lat, lon, ele);
             }
@@ -30,7 +30,7 @@ public FinishInstruction(String name, final double lat, final double lon, final
     }
 
     public FinishInstruction(final double lat, final double lon, final double ele) {
-        super(FINISH, "", InstructionAnnotation.EMPTY, new PointList(2, true) {
+        super(FINISH, "", InstructionAnnotation.EMPTY, new PointList(2, !Double.isNaN(ele)) {
             {
                 add(lat, lon, ele);
             }
@@ -39,12 +39,12 @@ public FinishInstruction(final double lat, final double lon, final double ele) {
 
     public FinishInstruction(String name, PointAccess pointAccess, int node) {
         this(name, pointAccess.getLatitude(node), pointAccess.getLongitude(node),
-                pointAccess.is3D() ? pointAccess.getElevation(node) : 0);
+                pointAccess.is3D() ? pointAccess.getElevation(node) : Double.NaN);
     }
 
     public FinishInstruction(PointAccess pointAccess, int node) {
         this(pointAccess.getLatitude(node), pointAccess.getLongitude(node),
-                pointAccess.is3D() ? pointAccess.getElevation(node) : 0);
+                pointAccess.is3D() ? pointAccess.getElevation(node) : Double.NaN);
     }
 
     @Override
diff --git a/core/src/main/java/com/graphhopper/util/GHUtility.java b/core/src/main/java/com/graphhopper/util/GHUtility.java
index 743757d752..deff1c19ec 100644
--- a/core/src/main/java/com/graphhopper/util/GHUtility.java
+++ b/core/src/main/java/com/graphhopper/util/GHUtility.java
@@ -17,15 +17,17 @@
  */
 package com.graphhopper.util;
 
+import com.carrotsearch.hppc.IntIndexedContainer;
+import com.carrotsearch.hppc.LongArrayList;
+import com.carrotsearch.hppc.LongIndexedContainer;
 import com.graphhopper.coll.GHBitSet;
 import com.graphhopper.coll.GHBitSetImpl;
+import com.graphhopper.coll.GHIntArrayList;
 import com.graphhopper.routing.util.AllCHEdgesIterator;
 import com.graphhopper.routing.util.AllEdgesIterator;
 import com.graphhopper.routing.util.EdgeFilter;
 import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.storage.*;
-import gnu.trove.list.TIntList;
-import gnu.trove.list.array.TIntArrayList;
 
 import java.util.*;
 import java.util.concurrent.atomic.AtomicInteger;
@@ -168,10 +170,10 @@ public static String getNodeInfo(Graph g, int nodeId, EdgeFilter filter) {
     }
 
     public static Graph shuffle(Graph g, Graph sortedGraph) {
-        int len = g.getNodes();
-        TIntList list = new TIntArrayList(len, -1);
-        list.fill(0, len, -1);
-        for (int i = 0; i < len; i++) {
+        int nodes = g.getNodes();
+        GHIntArrayList list = new GHIntArrayList(nodes);
+        list.fill(nodes, -1);
+        for (int i = 0; i < nodes; i++) {
             list.set(i, i);
         }
         list.shuffle(new Random());
@@ -183,9 +185,9 @@ public static Graph shuffle(Graph g, Graph sortedGraph) {
      * significant difference (bfs) for querying or are worse (z-curve).
      */
     public static Graph sortDFS(Graph g, Graph sortedGraph) {
-        final TIntList list = new TIntArrayList(g.getNodes(), -1);
         int nodes = g.getNodes();
-        list.fill(0, nodes, -1);
+        final GHIntArrayList list = new GHIntArrayList(nodes);
+        list.fill(nodes, -1);
         final GHBitSetImpl bitset = new GHBitSetImpl(nodes);
         final AtomicInteger ref = new AtomicInteger(-1);
         EdgeExplorer explorer = g.createEdgeExplorer();
@@ -207,7 +209,7 @@ protected boolean goFurther(int nodeId) {
         return createSortedGraph(g, sortedGraph, list);
     }
 
-    static Graph createSortedGraph(Graph fromGraph, Graph toSortedGraph, final TIntList oldToNewNodeList) {
+    static Graph createSortedGraph(Graph fromGraph, Graph toSortedGraph, final IntIndexedContainer oldToNewNodeList) {
         AllEdgesIterator eIter = fromGraph.getAllEdges();
         while (eIter.next()) {
             int base = eIter.getBaseNode();
@@ -357,7 +359,7 @@ public static int reverseEdgeKey(int edgeKey) {
     public static int getEdgeFromEdgeKey(int edgeKey) {
         return edgeKey / 2;
     }
-
+    
     /**
      * This edge iterator can be used in tests to mock specific iterator behaviour via overloading
      * certain methods.
diff --git a/core/src/main/java/com/graphhopper/util/Helper.java b/core/src/main/java/com/graphhopper/util/Helper.java
index 5587a0f2ca..b6c3178c5c 100644
--- a/core/src/main/java/com/graphhopper/util/Helper.java
+++ b/core/src/main/java/com/graphhopper/util/Helper.java
@@ -17,13 +17,17 @@
  */
 package com.graphhopper.util;
 
+import com.carrotsearch.hppc.IntArrayList;
+import com.carrotsearch.hppc.IntIndexedContainer;
 import com.graphhopper.util.shapes.BBox;
-import gnu.trove.list.TIntList;
-import gnu.trove.list.array.TIntArrayList;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import java.io.*;
+import java.lang.invoke.MethodHandle;
+import java.lang.invoke.MethodHandles;
+import java.lang.invoke.MethodType;
+import java.lang.reflect.Field;
 import java.lang.reflect.Method;
 import java.nio.ByteBuffer;
 import java.nio.MappedByteBuffer;
@@ -61,7 +65,7 @@
     private Helper() {
     }
 
-    public static ArrayList<Integer> tIntListToArrayList(TIntList from) {
+    public static ArrayList<Integer> intListToArrayList(IntIndexedContainer from) {
         int len = from.size();
         ArrayList<Integer> list = new ArrayList<Integer>(len);
         for (int i = 0; i < len; i++) {
@@ -88,11 +92,15 @@ static String packageToPath(Package pkg) {
     }
 
     public static int countBitValue(int maxTurnCosts) {
-        double val = Math.log(maxTurnCosts) / Math.log(2);
-        int intVal = (int) val;
-        if (val == intVal)
-            return intVal;
-        return intVal + 1;
+        if (maxTurnCosts < 0)
+            throw new IllegalArgumentException("maxTurnCosts cannot be negative " + maxTurnCosts);
+
+        int counter = 0;
+        while (maxTurnCosts > 0) {
+            maxTurnCosts >>= 1;
+            counter++;
+        }
+        return counter++;
     }
 
     public static void loadProperties(Map<String, String> map, Reader tmpReader) throws IOException {
@@ -279,12 +287,8 @@ public static String pruneFileEnd(String file) {
         return list;
     }
 
-    public static TIntList createTList(int... list) {
-        TIntList res = new TIntArrayList(list.length);
-        for (int val : list) {
-            res.add(val);
-        }
-        return res;
+    public static IntArrayList createTList(int... list) {
+        return IntArrayList.from(list);
     }
 
     public static PointList createPointList(double... list) {
@@ -314,7 +318,7 @@ public static PointList createPointList3D(double... list) {
     /**
      * Converts into an integer to be compatible with the still limited DataAccess class (accepts
      * only integer values). But this conversion also reduces memory consumption where the precision
-     * loss is accceptable. As +- 180° and +-90° are assumed as maximum values.
+     * loss is acceptable. As +- 180° and +-90° are assumed as maximum values.
      * <p>
      *
      * @return the integer of the specified degree
@@ -361,24 +365,65 @@ public static final double intToEle(int integEle) {
     }
 
     public static void cleanMappedByteBuffer(final ByteBuffer buffer) {
+        // TODO avoid reflection on every call
         try {
             AccessController.doPrivileged(new PrivilegedExceptionAction<Object>() {
                 @Override
                 public Object run() throws Exception {
+                    if (Constants.JAVA_VERSION.equals("9-ea")) {
+                        // >=JDK9 class sun.misc.Unsafe { void invokeCleaner(ByteBuffer buf) }
+                        final Class<?> unsafeClass = Class.forName("sun.misc.Unsafe");
+                        // we do not need to check for a specific class, we can call the Unsafe method with any buffer class
+                        MethodHandle unmapper = MethodHandles.lookup().findVirtual(unsafeClass, "invokeCleaner",
+                                MethodType.methodType(void.class, ByteBuffer.class));
+                        // fetch the unsafe instance and bind it to the virtual MethodHandle
+                        final Field f = unsafeClass.getDeclaredField("theUnsafe");
+                        f.setAccessible(true);
+                        final Object theUnsafe = f.get(null);
+                        try {
+                            unmapper.bindTo(theUnsafe).invokeExact(buffer);
+                            return null;
+                        } catch (Throwable t) {
+                            throw new RuntimeException(t);
+                        }
+                    }
+
+                    // <=JDK8 class DirectByteBuffer { sun.misc.Cleaner cleaner(Buffer buf) }
+                    //        then call sun.misc.Cleaner.clean
                     try {
-                        final Method getCleanerMethod = buffer.getClass().getMethod("cleaner");
-                        getCleanerMethod.setAccessible(true);
-                        final Object cleaner = getCleanerMethod.invoke(buffer);
-                        if (cleaner != null)
-                            cleaner.getClass().getMethod("clean").invoke(cleaner);
-                    } catch (NoSuchMethodException ex) {
-                        // ignore if method cleaner or clean is not available, like on Android
+                        if (buffer.getClass().getSimpleName().equals("MappedByteBufferAdapter")) {
+                            if (!Constants.ANDROID)
+                                throw new RuntimeException("MappedByteBufferAdapter only supported for Android at the moment");
+
+                            // Regarding MappedByteBufferAdapter on Android 4.1, see #914
+                            final Class<?> directByteBufferClass = Class.forName("java.nio.MappedByteBufferAdapter");
+                            final Method dbbFreeMethod = directByteBufferClass.getMethod("free");
+                            dbbFreeMethod.setAccessible(true);
+                            // call: ((MappedByteBufferAdapter)buffer).free()
+                            dbbFreeMethod.invoke(buffer);
+                        } else {
+                            final Class<?> directByteBufferClass = Class.forName("java.nio.DirectByteBuffer");
+                            final Method dbbCleanerMethod = directByteBufferClass.getMethod("cleaner");
+                            dbbCleanerMethod.setAccessible(true);
+                            // call: cleaner = ((DirectByteBuffer)buffer).cleaner()
+                            final Object cleaner = dbbCleanerMethod.invoke(buffer);
+                            if (cleaner != null) {
+                                final Class<?> cleanerMethodReturnType = dbbCleanerMethod.getReturnType();
+                                final Method cleanMethod = cleanerMethodReturnType.getDeclaredMethod("clean");
+                                cleanMethod.setAccessible(true);
+                                // call: ((sun.misc.Cleaner)cleaner).clean()
+                                cleanMethod.invoke(cleaner);
+                            }
+                        }
+                    } catch (NoSuchMethodException ex2) {
+                        // ignore if method cleaner or clean is not available
+                        LOGGER.warn("NoSuchMethodException | " + Constants.JAVA_VERSION, ex2);
                     }
                     return null;
                 }
             });
         } catch (PrivilegedActionException e) {
-            throw new RuntimeException("unable to unmap the mapped buffer", e);
+            throw new RuntimeException("Unable to unmap the mapped buffer", e);
         }
     }
 
@@ -392,7 +437,7 @@ public static void cleanHack() {
 
     public static String nf(long no) {
         // I like french localization the most: 123654 will be 123 654 instead
-        // of comma vs. point confusion for english/german guys.
+        // of comma vs. point confusion for English/German people.
         // NumberFormat is not thread safe => but getInstance looks like it's cached
         return NumberFormat.getInstance(Locale.FRANCE).format(no);
     }
diff --git a/core/src/main/java/com/graphhopper/util/InstructionList.java b/core/src/main/java/com/graphhopper/util/InstructionList.java
index 8b244c8947..a5823b3a5f 100644
--- a/core/src/main/java/com/graphhopper/util/InstructionList.java
+++ b/core/src/main/java/com/graphhopper/util/InstructionList.java
@@ -76,15 +76,16 @@ public int size() {
             instrList.add(instrJson);
 
             InstructionAnnotation ia = instruction.getAnnotation();
-            String str = instruction.getTurnDescription(tr);
-            if (Helper.isEmpty(str))
-                str = ia.getMessage();
-            instrJson.put("text", Helper.firstBig(str));
+            String text = instruction.getTurnDescription(tr);
+            if (Helper.isEmpty(text))
+                text = ia.getMessage();
+            instrJson.put("text", Helper.firstBig(text));
             if (!ia.isEmpty()) {
                 instrJson.put("annotation_text", ia.getMessage());
                 instrJson.put("annotation_importance", ia.getImportance());
             }
 
+            instrJson.put("street_name", instruction.getName());
             instrJson.put("time", instruction.getTime());
             instrJson.put("distance", Helper.round(instruction.getDistance(), 3));
             instrJson.put("sign", instruction.getSign());
diff --git a/core/src/main/java/com/graphhopper/util/PMap.java b/core/src/main/java/com/graphhopper/util/PMap.java
index e6edcbc0a1..a49e14df9d 100644
--- a/core/src/main/java/com/graphhopper/util/PMap.java
+++ b/core/src/main/java/com/graphhopper/util/PMap.java
@@ -146,10 +146,10 @@ String get(String key) {
     }
 
     /**
-     * This method copies the underlying structur into a new Map object
+     * This method copies the underlying structure into a new Map object
      */
     public Map<String, String> toMap() {
-        return new HashMap<String, String>(map);
+        return new HashMap<>(map);
     }
 
     private Map<String, String> getMap() {
@@ -170,6 +170,10 @@ PMap merge(Map<String, String> map) {
         return this;
     }
 
+    public boolean isEmpty() {
+        return map.isEmpty();
+    }
+
     @Override
     public String toString() {
         return getMap().toString();
diff --git a/core/src/main/java/com/graphhopper/util/Parameters.java b/core/src/main/java/com/graphhopper/util/Parameters.java
index 09c47efc37..1535fab8ba 100644
--- a/core/src/main/java/com/graphhopper/util/Parameters.java
+++ b/core/src/main/java/com/graphhopper/util/Parameters.java
@@ -94,8 +94,11 @@
         public static final String EDGE_BASED = "edge_based";
         public static final String MAX_VISITED_NODES = "max_visited_nodes";
         public static final String INIT_MAX_VISITED_NODES = ROUTING_INIT_PREFIX + "max_visited_nodes";
+        /** if true the response will contain turn instructions */
         public static final String INSTRUCTIONS = "instructions";
+        /** if true the response will contain a point list */
         public static final String CALC_POINTS = "calc_points";
+        /** configure simplification of returned point list */
         public static final String WAY_POINT_MAX_DISTANCE = "way_point_max_distance";
         public static final String INIT_WAY_POINT_MAX_DISTANCE = ROUTING_INIT_PREFIX + "way_point_max_distance";
         /**
@@ -104,11 +107,17 @@
          * https://github.com/graphhopper/graphhopper/blob/master/docs/core/routing.md#heading
          */
         public static final String PASS_THROUGH = "pass_through";
+        public static final String POINT_HINT = "point_hint";
         /**
          * default heading penalty in seconds
          */
         public static final double DEFAULT_HEADING_PENALTY = 300;
         public static final String HEADING_PENALTY = "heading_penalty";
+        /**
+         * block road access via a point lat,lon or an area defined from a circle lat,lon,radius or
+         * a rectangular lat1,lon1,lat2,lon2
+         */
+        public static final String BLOCK_AREA = "block_area";
     }
 
     /**
@@ -129,4 +138,18 @@
          */
         public static final String FORCE_HEADING = "ch.force_heading";
     }
+
+    /**
+     * Properties for NON CH routing
+     */
+    public static final class NON_CH {
+
+        private static final String NON_CH_PREFIX = "non_ch.";
+
+        /**
+         * Describes the max allowed distance between two consecutive waypoints of a non ch request. Distance is in Meter
+         */
+        public static final String MAX_NON_CH_POINT_DISTANCE = ROUTING_INIT_PREFIX + NON_CH_PREFIX + "max_waypoint_distance";
+
+    }
 }
diff --git a/core/src/main/java/com/graphhopper/util/PathMerger.java b/core/src/main/java/com/graphhopper/util/PathMerger.java
index 7f0da2a686..70a06cb2f0 100644
--- a/core/src/main/java/com/graphhopper/util/PathMerger.java
+++ b/core/src/main/java/com/graphhopper/util/PathMerger.java
@@ -19,8 +19,10 @@
 
 import com.graphhopper.PathWrapper;
 import com.graphhopper.routing.Path;
+import com.graphhopper.util.exceptions.ConnectionNotFoundException;
 
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.List;
 
 /**
@@ -126,7 +128,7 @@ public void doWork(PathWrapper altRsp, List<Path> paths, Translation tr) {
             altRsp.setInstructions(fullInstructions);
 
         if (!allFound)
-            altRsp.addError(new RuntimeException("Connection between locations not found"));
+            altRsp.addError(new ConnectionNotFoundException("Connection between locations not found", Collections.<String, Object>emptyMap()));
 
         altRsp.setDescription(description).
                 setPoints(fullPoints).
diff --git a/core/src/main/java/com/graphhopper/util/RoundaboutInstruction.java b/core/src/main/java/com/graphhopper/util/RoundaboutInstruction.java
index 9daf81b583..f989ee21bf 100644
--- a/core/src/main/java/com/graphhopper/util/RoundaboutInstruction.java
+++ b/core/src/main/java/com/graphhopper/util/RoundaboutInstruction.java
@@ -97,8 +97,9 @@ public RoundaboutInstruction setRadian(double radian) {
 
     @Override
     public Map<String, Object> getExtraInfoJSON() {
-        Map<String, Object> tmpMap = new HashMap<String, Object>(2);
+        Map<String, Object> tmpMap = new HashMap<String, Object>(3);
         tmpMap.put("exit_number", getExitNumber());
+        tmpMap.put("exited", this.exited);
         double tmpAngle = getTurnAngle();
         if (!Double.isNaN(tmpAngle))
             tmpMap.put("turn_angle", Helper.round(tmpAngle, 2));
diff --git a/core/src/main/java/com/graphhopper/util/TranslationMap.java b/core/src/main/java/com/graphhopper/util/TranslationMap.java
index 5d6360c942..10e9d64d02 100644
--- a/core/src/main/java/com/graphhopper/util/TranslationMap.java
+++ b/core/src/main/java/com/graphhopper/util/TranslationMap.java
@@ -94,7 +94,7 @@ public void add(Translation tr) {
     }
 
     /**
-     * Returns the Translation object for the specified locale and falls back to english if the
+     * Returns the Translation object for the specified locale and falls back to English if the
      * locale was not found.
      */
     public Translation getWithFallBack(Locale locale) {
diff --git a/core/src/main/java/com/graphhopper/coll/IntDoubleBinHeap.java b/core/src/main/java/com/graphhopper/util/exceptions/ConnectionNotFoundException.java
similarity index 69%
rename from core/src/main/java/com/graphhopper/coll/IntDoubleBinHeap.java
rename to core/src/main/java/com/graphhopper/util/exceptions/ConnectionNotFoundException.java
index d2f06e6990..a512cb6db6 100644
--- a/core/src/main/java/com/graphhopper/coll/IntDoubleBinHeap.java
+++ b/core/src/main/java/com/graphhopper/util/exceptions/ConnectionNotFoundException.java
@@ -1,30 +1,31 @@
 /*
  *  Licensed to GraphHopper GmbH under one or more contributor
- *  license agreements. See the NOTICE file distributed with this work for 
+ *  license agreements. See the NOTICE file distributed with this work for
  *  additional information regarding copyright ownership.
- * 
- *  GraphHopper GmbH licenses this file to you under the Apache License, 
- *  Version 2.0 (the "License"); you may not use this file except in 
+ *
+ *  GraphHopper GmbH licenses this file to you under the Apache License,
+ *  Version 2.0 (the "License"); you may not use this file except in
  *  compliance with the License. You may obtain a copy of the License at
- * 
+ *
  *       http://www.apache.org/licenses/LICENSE-2.0
- * 
+ *
  *  Unless required by applicable law or agreed to in writing, software
  *  distributed under the License is distributed on an "AS IS" BASIS,
  *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  *  See the License for the specific language governing permissions and
  *  limitations under the License.
  */
-package com.graphhopper.coll;
+package com.graphhopper.util.exceptions;
+
+import java.util.Map;
 
 /**
+ * If a route cannot be found due to disconnected graphs.
+ *
  * @author Peter Karich
  */
-public class IntDoubleBinHeap extends OTPIntDoubleBinHeap implements BinHeapWrapper<Number, Integer> {
-    public IntDoubleBinHeap() {
-    }
-
-    public IntDoubleBinHeap(int capacity) {
-        super(capacity);
+public class ConnectionNotFoundException extends DetailedIllegalArgumentException {
+    public ConnectionNotFoundException(String var1, Map<String, Object> details) {
+        super(var1, details);
     }
 }
diff --git a/core/src/main/java/com/graphhopper/util/exceptions/DetailedIllegalArgumentException.java b/core/src/main/java/com/graphhopper/util/exceptions/DetailedIllegalArgumentException.java
new file mode 100644
index 0000000000..5e01d77e27
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/util/exceptions/DetailedIllegalArgumentException.java
@@ -0,0 +1,36 @@
+/*
+ * Copyright 2016 peterk.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package com.graphhopper.util.exceptions;
+
+import java.util.Map;
+
+/**
+ * @author Peter Karich
+ */
+public class DetailedIllegalArgumentException extends IllegalArgumentException implements GHException {
+
+    private final Map<String, Object> details;
+
+    public DetailedIllegalArgumentException(String var1, Map<String, Object> details) {
+        super(var1);
+        this.details = details;
+    }
+
+    @Override
+    public Map<String, Object> getDetails() {
+        return details;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/util/exceptions/DetailedRuntimeException.java b/core/src/main/java/com/graphhopper/util/exceptions/DetailedRuntimeException.java
new file mode 100644
index 0000000000..5d133b5c3a
--- /dev/null
+++ b/core/src/main/java/com/graphhopper/util/exceptions/DetailedRuntimeException.java
@@ -0,0 +1,36 @@
+/*
+ * Copyright 2016 peterk.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package com.graphhopper.util.exceptions;
+
+import java.util.Map;
+
+/**
+ * @author Peter Karich
+ */
+public class DetailedRuntimeException extends RuntimeException implements GHException {
+
+    private final Map<String, Object> details;
+
+    public DetailedRuntimeException(String var1, Map<String, Object> details) {
+        super(var1);
+        this.details = details;
+    }
+
+    @Override
+    public Map<String, Object> getDetails() {
+        return details;
+    }
+}
diff --git a/core/src/main/java/com/graphhopper/util/exceptions/GHException.java b/core/src/main/java/com/graphhopper/util/exceptions/GHException.java
index b510c8fd2b..e8e1f2bbbc 100644
--- a/core/src/main/java/com/graphhopper/util/exceptions/GHException.java
+++ b/core/src/main/java/com/graphhopper/util/exceptions/GHException.java
@@ -25,5 +25,5 @@
  * @author Robin Boldt
  */
 public interface GHException {
-    public abstract Map<String, String> getDetails();
+    public abstract Map<String, Object> getDetails();
 }
diff --git a/core/src/test/java/com/graphhopper/coll/IntDoubleBinHeapTest.java b/core/src/main/java/com/graphhopper/util/exceptions/PointDistanceExceededException.java
similarity index 69%
rename from core/src/test/java/com/graphhopper/coll/IntDoubleBinHeapTest.java
rename to core/src/main/java/com/graphhopper/util/exceptions/PointDistanceExceededException.java
index 2c17655895..21ecff8d9c 100644
--- a/core/src/test/java/com/graphhopper/coll/IntDoubleBinHeapTest.java
+++ b/core/src/main/java/com/graphhopper/util/exceptions/PointDistanceExceededException.java
@@ -1,28 +1,31 @@
 /*
  *  Licensed to GraphHopper GmbH under one or more contributor
- *  license agreements. See the NOTICE file distributed with this work for 
+ *  license agreements. See the NOTICE file distributed with this work for
  *  additional information regarding copyright ownership.
- * 
- *  GraphHopper GmbH licenses this file to you under the Apache License, 
- *  Version 2.0 (the "License"); you may not use this file except in 
+ *
+ *  GraphHopper GmbH licenses this file to you under the Apache License,
+ *  Version 2.0 (the "License"); you may not use this file except in
  *  compliance with the License. You may obtain a copy of the License at
- * 
+ *
  *       http://www.apache.org/licenses/LICENSE-2.0
- * 
+ *
  *  Unless required by applicable law or agreed to in writing, software
  *  distributed under the License is distributed on an "AS IS" BASIS,
  *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  *  See the License for the specific language governing permissions and
  *  limitations under the License.
  */
-package com.graphhopper.coll;
+package com.graphhopper.util.exceptions;
+
+import java.util.Map;
 
 /**
+ * If a route cannot be found due to disconnected graphs.
+ *
  * @author Peter Karich
  */
-public class IntDoubleBinHeapTest extends AbstractBinHeapTest {
-    @Override
-    public BinHeapWrapper<Number, Integer> createHeap(int capacity) {
-        return new IntDoubleBinHeap(capacity);
+public class PointDistanceExceededException extends DetailedIllegalArgumentException {
+    public PointDistanceExceededException(String var1, Map<String, Object> details) {
+        super(var1, details);
     }
 }
diff --git a/core/src/main/java/com/graphhopper/util/exceptions/CannotFindPointException.java b/core/src/main/java/com/graphhopper/util/exceptions/PointNotFoundException.java
similarity index 81%
rename from core/src/main/java/com/graphhopper/util/exceptions/CannotFindPointException.java
rename to core/src/main/java/com/graphhopper/util/exceptions/PointNotFoundException.java
index 96307ed8e4..d5abfcb557 100644
--- a/core/src/main/java/com/graphhopper/util/exceptions/CannotFindPointException.java
+++ b/core/src/main/java/com/graphhopper/util/exceptions/PointNotFoundException.java
@@ -26,11 +26,11 @@
  *
  * @author Robin Boldt
  */
-public class CannotFindPointException extends IllegalArgumentException implements GHException {
+public class PointNotFoundException extends IllegalArgumentException implements GHException {
 
     protected final int pointIndex;
 
-    public CannotFindPointException(String var1, int pointIndex) {
+    public PointNotFoundException(String var1, int pointIndex) {
         super(var1);
         this.pointIndex = pointIndex;
     }
@@ -40,7 +40,7 @@ public int getPointIndex() {
     }
 
     @Override
-    public Map<String, String> getDetails() {
-        return Collections.singletonMap("point_index", String.valueOf(pointIndex));
+    public Map<String, Object> getDetails() {
+        return Collections.<String, Object>singletonMap("point_index", pointIndex);
     }
 }
diff --git a/core/src/main/java/com/graphhopper/util/exceptions/PointOutOfBoundsException.java b/core/src/main/java/com/graphhopper/util/exceptions/PointOutOfBoundsException.java
index c7f1b37bae..774ebfeb33 100644
--- a/core/src/main/java/com/graphhopper/util/exceptions/PointOutOfBoundsException.java
+++ b/core/src/main/java/com/graphhopper/util/exceptions/PointOutOfBoundsException.java
@@ -5,7 +5,7 @@
  *
  * @author Robin Boldt
  */
-public class PointOutOfBoundsException extends CannotFindPointException {
+public class PointOutOfBoundsException extends PointNotFoundException {
     public PointOutOfBoundsException(String var1, int pointIndex) {
         super(var1, pointIndex);
     }
diff --git a/core/src/main/java/com/graphhopper/util/shapes/BBox.java b/core/src/main/java/com/graphhopper/util/shapes/BBox.java
index 977c0162bb..afe1940a87 100644
--- a/core/src/main/java/com/graphhopper/util/shapes/BBox.java
+++ b/core/src/main/java/com/graphhopper/util/shapes/BBox.java
@@ -180,6 +180,11 @@ public BBox getBounds() {
         return this;
     }
 
+    @Override
+    public GHPoint getCenter() {
+        return new GHPoint((maxLat + minLat) / 2, (maxLon + minLon) / 2);
+    }
+
     @Override
     public boolean equals(Object obj) {
         if (obj == null)
@@ -245,4 +250,45 @@ public boolean isValid() {
 
         return list;
     }
+
+    /**
+     * @return an estimated area in m^2 using the mean value of latitudes for longitude distance
+     */
+    @Override
+    public double calculateArea() {
+        double meanLat = (maxLat + minLat) / 2;
+        return Helper.DIST_PLANE.calcDist(meanLat, minLon, meanLat, maxLon)
+                // left side should be equal to right side no mean value necessary
+                * Helper.DIST_PLANE.calcDist(minLat, minLon, maxLat, minLon);
+    }
+
+    /**
+     * This method creates a BBox out of a string in format lat1,lon1,lat2,lon2
+     */
+    public static BBox parseTwoPoints(String objectAsString) {
+        String[] splittedObject = objectAsString.split(",");
+
+        if (splittedObject.length != 4)
+            throw new IllegalArgumentException("BBox should have 4 parts but was " + objectAsString);
+
+        double minLat = Double.parseDouble(splittedObject[0]);
+        double minLon = Double.parseDouble(splittedObject[1]);
+
+        double maxLat = Double.parseDouble(splittedObject[2]);
+        double maxLon = Double.parseDouble(splittedObject[3]);
+
+        if (minLat > maxLat) {
+            double tmp = minLat;
+            minLat = maxLat;
+            maxLat = tmp;
+        }
+
+        if (minLon > maxLon) {
+            double tmp = minLon;
+            minLon = maxLon;
+            maxLon = tmp;
+        }
+
+        return new BBox(minLon, maxLon, minLat, maxLat);
+    }
 }
diff --git a/core/src/main/java/com/graphhopper/util/shapes/Circle.java b/core/src/main/java/com/graphhopper/util/shapes/Circle.java
index f538b3fae6..82549b7b68 100644
--- a/core/src/main/java/com/graphhopper/util/shapes/Circle.java
+++ b/core/src/main/java/com/graphhopper/util/shapes/Circle.java
@@ -19,12 +19,13 @@
 
 import com.graphhopper.util.DistanceCalc;
 import com.graphhopper.util.Helper;
+import com.graphhopper.util.NumHelper;
 
 /**
  * @author Peter Karich
  */
 public class Circle implements Shape {
-    private final double radiusInKm;
+    private final double radiusInMeter;
     private final double lat;
     private final double lon;
     private final double normedDist;
@@ -39,7 +40,7 @@ public Circle(double lat, double lon, double radiusInMeter, DistanceCalc calc) {
         this.calc = calc;
         this.lat = lat;
         this.lon = lon;
-        this.radiusInKm = radiusInMeter;
+        this.radiusInMeter = radiusInMeter;
         this.normedDist = calc.calcNormalizedDist(radiusInMeter);
         bbox = calc.createBBox(lat, lon, radiusInMeter);
     }
@@ -62,6 +63,11 @@ public BBox getBounds() {
         return bbox;
     }
 
+    @Override
+    public GHPoint getCenter() {
+        return new GHPoint(lat, lon);
+    }
+
     private double normDist(double lat1, double lon1) {
         return calc.calcNormalizedDist(lat, lon, lat1, lon1);
     }
@@ -127,7 +133,7 @@ public boolean intersect(Circle c) {
             return false;
         }
 
-        return normDist(c.lat, c.lon) <= calc.calcNormalizedDist(radiusInKm + c.radiusInKm);
+        return normDist(c.lat, c.lon) <= calc.calcNormalizedDist(radiusInMeter + c.radiusInMeter);
     }
 
     public boolean contains(BBox b) {
@@ -140,7 +146,7 @@ public boolean contains(BBox b) {
     }
 
     public boolean contains(Circle c) {
-        double res = radiusInKm - c.radiusInKm;
+        double res = radiusInMeter - c.radiusInMeter;
         if (res < 0) {
             return false;
         }
@@ -148,8 +154,32 @@ public boolean contains(Circle c) {
         return calc.calcDist(lat, lon, c.lat, c.lon) <= res;
     }
 
+    @Override
+    public double calculateArea() {
+        return Math.PI * radiusInMeter * radiusInMeter;
+    }
+
+    @Override
+    public boolean equals(Object obj) {
+        if (obj == null)
+            return false;
+
+        Circle b = (Circle) obj;
+        // equals within a very small range
+        return NumHelper.equalsEps(lat, b.lat) && NumHelper.equalsEps(lon, b.lon) && NumHelper.equalsEps(radiusInMeter, b.radiusInMeter);
+    }
+
+    @Override
+    public int hashCode() {
+        int hash = 3;
+        hash = 17 * hash + (int) (Double.doubleToLongBits(this.lat) ^ (Double.doubleToLongBits(this.lat) >>> 32));
+        hash = 17 * hash + (int) (Double.doubleToLongBits(this.lon) ^ (Double.doubleToLongBits(this.lon) >>> 32));
+        hash = 17 * hash + (int) (Double.doubleToLongBits(this.radiusInMeter) ^ (Double.doubleToLongBits(this.radiusInMeter) >>> 32));
+        return hash;
+    }
+
     @Override
     public String toString() {
-        return lat + "," + lon + ", radius:" + radiusInKm;
+        return lat + "," + lon + ", radius:" + radiusInMeter;
     }
 }
diff --git a/core/src/main/java/com/graphhopper/util/shapes/Shape.java b/core/src/main/java/com/graphhopper/util/shapes/Shape.java
index 1dace9efd8..924712dd09 100644
--- a/core/src/main/java/com/graphhopper/util/shapes/Shape.java
+++ b/core/src/main/java/com/graphhopper/util/shapes/Shape.java
@@ -44,4 +44,14 @@
      * @return the minimal rectangular bounding box of this shape
      */
     BBox getBounds();
+
+    /**
+     * @return The center of the shape, if applicable
+     */
+    GHPoint getCenter();
+
+    /**
+     * @return an estimated area in m^2
+     */
+    double calculateArea();
 }
diff --git a/core/src/main/resources/com/graphhopper/util/ar.txt b/core/src/main/resources/com/graphhopper/util/ar.txt
index 7083f551de..249f183415 100644
--- a/core/src/main/resources/com/graphhopper/util/ar.txt
+++ b/core/src/main/resources/com/graphhopper/util/ar.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/ast.txt b/core/src/main/resources/com/graphhopper/util/ast.txt
index f5a38a5eea..644cb329c1 100644
--- a/core/src/main/resources/com/graphhopper/util/ast.txt
+++ b/core/src/main/resources/com/graphhopper/util/ast.txt
@@ -66,3 +66,4 @@ web.refresh_button=Refrescar la páxina
 web.server_status=Estáu
 web.zoom_in=Averar
 web.zoom_out=Alloñar
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/bg.txt b/core/src/main/resources/com/graphhopper/util/bg.txt
index bc9aebee04..9a419d78d7 100644
--- a/core/src/main/resources/com/graphhopper/util/bg.txt
+++ b/core/src/main/resources/com/graphhopper/util/bg.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/ca.txt b/core/src/main/resources/com/graphhopper/util/ca.txt
index 2734907054..9438eabf82 100644
--- a/core/src/main/resources/com/graphhopper/util/ca.txt
+++ b/core/src/main/resources/com/graphhopper/util/ca.txt
@@ -66,3 +66,4 @@ web.refresh_button=Refrescar la plana
 web.server_status=Estat
 web.zoom_in=Apropar
 web.zoom_out=Allunyar
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/cs_CZ.txt b/core/src/main/resources/com/graphhopper/util/cs_CZ.txt
index f5bf05a023..944b008168 100644
--- a/core/src/main/resources/com/graphhopper/util/cs_CZ.txt
+++ b/core/src/main/resources/com/graphhopper/util/cs_CZ.txt
@@ -66,3 +66,4 @@ web.refresh_button=Obnovit stránku
 web.server_status=Stav
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/da_DK.txt b/core/src/main/resources/com/graphhopper/util/da_DK.txt
index 65341ee73e..60293ba81b 100644
--- a/core/src/main/resources/com/graphhopper/util/da_DK.txt
+++ b/core/src/main/resources/com/graphhopper/util/da_DK.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/de_DE.txt b/core/src/main/resources/com/graphhopper/util/de_DE.txt
index a9d403329d..1b35c214a3 100644
--- a/core/src/main/resources/com/graphhopper/util/de_DE.txt
+++ b/core/src/main/resources/com/graphhopper/util/de_DE.txt
@@ -66,3 +66,4 @@ web.refresh_button=Lade Seite neu
 web.server_status=Status
 web.zoom_in=Vergrössern
 web.zoom_out=Verkleinern
+web.drag_to_reorder=Zum Ändern der Reihenfolge ziehen
diff --git a/core/src/main/resources/com/graphhopper/util/el.txt b/core/src/main/resources/com/graphhopper/util/el.txt
index c232898655..429a2e426c 100644
--- a/core/src/main/resources/com/graphhopper/util/el.txt
+++ b/core/src/main/resources/com/graphhopper/util/el.txt
@@ -66,3 +66,4 @@ web.refresh_button=Ανανέωση σελίδας
 web.server_status=Κατάσταση
 web.zoom_in=Μεγέθυνση
 web.zoom_out=Σμίκρυνση
+web.drag_to_reorder=Σύρετε για αναδιάταξη
diff --git a/core/src/main/resources/com/graphhopper/util/en_US.txt b/core/src/main/resources/com/graphhopper/util/en_US.txt
index 88e354ef6f..8532012f6a 100644
--- a/core/src/main/resources/com/graphhopper/util/en_US.txt
+++ b/core/src/main/resources/com/graphhopper/util/en_US.txt
@@ -66,3 +66,4 @@ web.refresh_button=Refresh page
 web.server_status=Status
 web.zoom_in=Zoom in
 web.zoom_out=Zoom out
+web.drag_to_reorder=Drag to reorder
diff --git a/core/src/main/resources/com/graphhopper/util/es.txt b/core/src/main/resources/com/graphhopper/util/es.txt
index 4bc75658bd..5a149d4104 100644
--- a/core/src/main/resources/com/graphhopper/util/es.txt
+++ b/core/src/main/resources/com/graphhopper/util/es.txt
@@ -66,3 +66,4 @@ web.refresh_button=Actualizar página
 web.server_status=Estado
 web.zoom_in=Acercar
 web.zoom_out=Alejar
+web.drag_to_reorder=Arrastra para cambiar el orden
diff --git a/core/src/main/resources/com/graphhopper/util/fa.txt b/core/src/main/resources/com/graphhopper/util/fa.txt
index e4d479f785..539ea0a66f 100644
--- a/core/src/main/resources/com/graphhopper/util/fa.txt
+++ b/core/src/main/resources/com/graphhopper/util/fa.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/fi.txt b/core/src/main/resources/com/graphhopper/util/fi.txt
index cb3882310c..17f101a936 100644
--- a/core/src/main/resources/com/graphhopper/util/fi.txt
+++ b/core/src/main/resources/com/graphhopper/util/fi.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/fil.txt b/core/src/main/resources/com/graphhopper/util/fil.txt
index ba7430f6a9..113b43b956 100644
--- a/core/src/main/resources/com/graphhopper/util/fil.txt
+++ b/core/src/main/resources/com/graphhopper/util/fil.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/fr_CH.txt b/core/src/main/resources/com/graphhopper/util/fr_CH.txt
index 6bf22c5780..d214de42df 100644
--- a/core/src/main/resources/com/graphhopper/util/fr_CH.txt
+++ b/core/src/main/resources/com/graphhopper/util/fr_CH.txt
@@ -66,3 +66,4 @@ web.refresh_button=Rafraîchir
 web.server_status=Statut
 web.zoom_in=Zoom avant
 web.zoom_out=Zoom arrière
+web.drag_to_reorder=Faire glisser pour réorganiser
diff --git a/core/src/main/resources/com/graphhopper/util/fr_FR.txt b/core/src/main/resources/com/graphhopper/util/fr_FR.txt
index 6ecaf0ed96..4387cb8ba4 100644
--- a/core/src/main/resources/com/graphhopper/util/fr_FR.txt
+++ b/core/src/main/resources/com/graphhopper/util/fr_FR.txt
@@ -66,3 +66,4 @@ web.refresh_button=Rafraîchir
 web.server_status=Statut
 web.zoom_in=Zoom avant
 web.zoom_out=Zoom arrière
+web.drag_to_reorder=Faire glisser pour réorganiser
diff --git a/core/src/main/resources/com/graphhopper/util/gl.txt b/core/src/main/resources/com/graphhopper/util/gl.txt
index e7e312abfe..571542efc8 100644
--- a/core/src/main/resources/com/graphhopper/util/gl.txt
+++ b/core/src/main/resources/com/graphhopper/util/gl.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/he.txt b/core/src/main/resources/com/graphhopper/util/he.txt
index 351866aca3..22741dda49 100644
--- a/core/src/main/resources/com/graphhopper/util/he.txt
+++ b/core/src/main/resources/com/graphhopper/util/he.txt
@@ -66,3 +66,4 @@ web.refresh_button=רענון הדף
 web.server_status=מצב
 web.zoom_in=התקרבות
 web.zoom_out=התרחקות
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/hr_HR.txt b/core/src/main/resources/com/graphhopper/util/hr_HR.txt
index 762ce636f4..acef1b8ee4 100644
--- a/core/src/main/resources/com/graphhopper/util/hr_HR.txt
+++ b/core/src/main/resources/com/graphhopper/util/hr_HR.txt
@@ -66,3 +66,4 @@ web.refresh_button=Osvježi stranicu
 web.server_status=Status
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/hsb.txt b/core/src/main/resources/com/graphhopper/util/hsb.txt
index 48852e3606..478391c687 100644
--- a/core/src/main/resources/com/graphhopper/util/hsb.txt
+++ b/core/src/main/resources/com/graphhopper/util/hsb.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/hu_HU.txt b/core/src/main/resources/com/graphhopper/util/hu_HU.txt
index b54d76694d..f0d9f80b21 100644
--- a/core/src/main/resources/com/graphhopper/util/hu_HU.txt
+++ b/core/src/main/resources/com/graphhopper/util/hu_HU.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/it.txt b/core/src/main/resources/com/graphhopper/util/it.txt
index 54e1192a60..1d56fe1fe1 100644
--- a/core/src/main/resources/com/graphhopper/util/it.txt
+++ b/core/src/main/resources/com/graphhopper/util/it.txt
@@ -66,3 +66,4 @@ web.refresh_button=Ricarica pagina
 web.server_status=Stato
 web.zoom_in=Zoom avanti
 web.zoom_out=Zoom indietro
+web.drag_to_reorder=Trascina per riordinare
diff --git a/core/src/main/resources/com/graphhopper/util/ja.txt b/core/src/main/resources/com/graphhopper/util/ja.txt
index 93b9567f33..c2d5239ddd 100644
--- a/core/src/main/resources/com/graphhopper/util/ja.txt
+++ b/core/src/main/resources/com/graphhopper/util/ja.txt
@@ -66,3 +66,4 @@ web.refresh_button=更新
 web.server_status=ステータス
 web.zoom_in=拡大
 web.zoom_out=縮小
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/ko.txt b/core/src/main/resources/com/graphhopper/util/ko.txt
index e74311dcf5..f2ffb0c84d 100644
--- a/core/src/main/resources/com/graphhopper/util/ko.txt
+++ b/core/src/main/resources/com/graphhopper/util/ko.txt
@@ -66,3 +66,4 @@ web.refresh_button=새로고침
 web.server_status=상태
 web.zoom_in=확대
 web.zoom_out=축소
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/lt_LT.txt b/core/src/main/resources/com/graphhopper/util/lt_LT.txt
index 07bf234bb9..dd542bb151 100644
--- a/core/src/main/resources/com/graphhopper/util/lt_LT.txt
+++ b/core/src/main/resources/com/graphhopper/util/lt_LT.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/ne.txt b/core/src/main/resources/com/graphhopper/util/ne.txt
index 542fa61cd4..3f0ff0555c 100644
--- a/core/src/main/resources/com/graphhopper/util/ne.txt
+++ b/core/src/main/resources/com/graphhopper/util/ne.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/nl.txt b/core/src/main/resources/com/graphhopper/util/nl.txt
index 2585230268..e28c765284 100644
--- a/core/src/main/resources/com/graphhopper/util/nl.txt
+++ b/core/src/main/resources/com/graphhopper/util/nl.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/pl_PL.txt b/core/src/main/resources/com/graphhopper/util/pl_PL.txt
index 1d675a23b4..6707732bce 100644
--- a/core/src/main/resources/com/graphhopper/util/pl_PL.txt
+++ b/core/src/main/resources/com/graphhopper/util/pl_PL.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/pt_BR.txt b/core/src/main/resources/com/graphhopper/util/pt_BR.txt
index b30057734c..c296440709 100644
--- a/core/src/main/resources/com/graphhopper/util/pt_BR.txt
+++ b/core/src/main/resources/com/graphhopper/util/pt_BR.txt
@@ -66,3 +66,4 @@ web.refresh_button=Recarregar página
 web.server_status=Status
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/pt_PT.txt b/core/src/main/resources/com/graphhopper/util/pt_PT.txt
index dc4db61515..a1510cf6d2 100644
--- a/core/src/main/resources/com/graphhopper/util/pt_PT.txt
+++ b/core/src/main/resources/com/graphhopper/util/pt_PT.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/ro.txt b/core/src/main/resources/com/graphhopper/util/ro.txt
index 92edbade92..f5793e5d41 100644
--- a/core/src/main/resources/com/graphhopper/util/ro.txt
+++ b/core/src/main/resources/com/graphhopper/util/ro.txt
@@ -66,3 +66,4 @@ web.refresh_button=Reîmprospătează pagina
 web.server_status=Disponibilitate
 web.zoom_in=Mărește
 web.zoom_out=Micșorează
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/ru.txt b/core/src/main/resources/com/graphhopper/util/ru.txt
index f9777233a0..85119e60d0 100644
--- a/core/src/main/resources/com/graphhopper/util/ru.txt
+++ b/core/src/main/resources/com/graphhopper/util/ru.txt
@@ -66,3 +66,4 @@ web.refresh_button=Обновить страницу
 web.server_status=Статус сервера
 web.zoom_in=Приблизить 
 web.zoom_out=Отдалить
+web.drag_to_reorder=Перетащите путевую точку
diff --git a/core/src/main/resources/com/graphhopper/util/si.txt b/core/src/main/resources/com/graphhopper/util/si.txt
index bfe61eec5d..2a540d6dbf 100644
--- a/core/src/main/resources/com/graphhopper/util/si.txt
+++ b/core/src/main/resources/com/graphhopper/util/si.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/sk.txt b/core/src/main/resources/com/graphhopper/util/sk.txt
index 6c38567d61..034ccb97ae 100644
--- a/core/src/main/resources/com/graphhopper/util/sk.txt
+++ b/core/src/main/resources/com/graphhopper/util/sk.txt
@@ -66,3 +66,4 @@ web.refresh_button=Obnoviť stránku
 web.server_status=Stav
 web.zoom_in=Priblížiť
 web.zoom_out=Oddialiť
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/sv_SE.txt b/core/src/main/resources/com/graphhopper/util/sv_SE.txt
index cf25d2176c..6927d6ac89 100644
--- a/core/src/main/resources/com/graphhopper/util/sv_SE.txt
+++ b/core/src/main/resources/com/graphhopper/util/sv_SE.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/tr.txt b/core/src/main/resources/com/graphhopper/util/tr.txt
index e776b7fc6f..8991b1ba97 100644
--- a/core/src/main/resources/com/graphhopper/util/tr.txt
+++ b/core/src/main/resources/com/graphhopper/util/tr.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/uk.txt b/core/src/main/resources/com/graphhopper/util/uk.txt
index cdbdd131bd..957a3ee904 100644
--- a/core/src/main/resources/com/graphhopper/util/uk.txt
+++ b/core/src/main/resources/com/graphhopper/util/uk.txt
@@ -66,3 +66,4 @@ web.refresh_button=Оновити сторінку
 web.server_status=Стан
 web.zoom_in=Наблизити
 web.zoom_out=Віддалити
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/vi_VI.txt b/core/src/main/resources/com/graphhopper/util/vi_VI.txt
index d49a3cd377..8eec781c10 100644
--- a/core/src/main/resources/com/graphhopper/util/vi_VI.txt
+++ b/core/src/main/resources/com/graphhopper/util/vi_VI.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=
diff --git a/core/src/main/resources/com/graphhopper/util/zh_CN.txt b/core/src/main/resources/com/graphhopper/util/zh_CN.txt
index 41269295bf..6703e1418b 100644
--- a/core/src/main/resources/com/graphhopper/util/zh_CN.txt
+++ b/core/src/main/resources/com/graphhopper/util/zh_CN.txt
@@ -66,3 +66,4 @@ web.refresh_button=
 web.server_status=
 web.zoom_in=
 web.zoom_out=
+web.drag_to_reorder=拖动可重新排序
diff --git a/core/src/main/resources/com/graphhopper/util/zh_HK.txt b/core/src/main/resources/com/graphhopper/util/zh_HK.txt
index a566cf44e8..38d6139808 100644
--- a/core/src/main/resources/com/graphhopper/util/zh_HK.txt
+++ b/core/src/main/resources/com/graphhopper/util/zh_HK.txt
@@ -66,3 +66,4 @@ web.refresh_button=刷新網頁
 web.server_status=狀況
 web.zoom_in=放大
 web.zoom_out=縮小
+web.drag_to_reorder=
diff --git a/reader-osm/src/test/java/com/graphhopper/GraphHopperAPITest.java b/core/src/test/java/com/graphhopper/GraphHopperAPITest.java
similarity index 54%
rename from reader-osm/src/test/java/com/graphhopper/GraphHopperAPITest.java
rename to core/src/test/java/com/graphhopper/GraphHopperAPITest.java
index 6ae541b494..8d4ab3e519 100644
--- a/reader-osm/src/test/java/com/graphhopper/GraphHopperAPITest.java
+++ b/core/src/test/java/com/graphhopper/GraphHopperAPITest.java
@@ -17,14 +17,25 @@
  */
 package com.graphhopper;
 
-import com.graphhopper.reader.osm.GraphHopperOSM;
+import com.graphhopper.json.geo.JsonFeature;
 import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.GraphBuilder;
 import com.graphhopper.storage.GraphHopperStorage;
 import com.graphhopper.storage.NodeAccess;
+import com.graphhopper.storage.change.ChangeGraphHelper;
+import com.graphhopper.storage.index.LocationIndex;
 import com.graphhopper.util.PointList;
+import com.graphhopper.util.shapes.BBox;
 import org.junit.Test;
 
+import java.util.*;
+import java.util.concurrent.CountDownLatch;
+import java.util.concurrent.ExecutorService;
+import java.util.concurrent.Executors;
+import java.util.concurrent.TimeUnit;
+import java.util.concurrent.atomic.AtomicInteger;
+
 import static org.junit.Assert.*;
 
 /**
@@ -33,23 +44,30 @@
 public class GraphHopperAPITest {
     final EncodingManager encodingManager = new EncodingManager("car");
 
-    @Test
-    public void testLoad() {
-        GraphHopperStorage graph = new GraphBuilder(encodingManager).create();
+    void initGraph(GraphHopperStorage graph) {
         NodeAccess na = graph.getNodeAccess();
         na.setNode(0, 42, 10);
         na.setNode(1, 42.1, 10.1);
         na.setNode(2, 42.1, 10.2);
         na.setNode(3, 42, 10.4);
-        na.setNode(4, 41.9, 10.2);
 
         graph.edge(0, 1, 10, true);
-        graph.edge(1, 2, 10, false);
         graph.edge(2, 3, 10, true);
+    }
+
+    @Test
+    public void testLoad() {
+        GraphHopperStorage graph = new GraphBuilder(encodingManager).create();
+        initGraph(graph);
+        // do further changes:
+        NodeAccess na = graph.getNodeAccess();
+        na.setNode(4, 41.9, 10.2);
+
+        graph.edge(1, 2, 10, false);
         graph.edge(0, 4, 40, true);
         graph.edge(4, 3, 40, true);
 
-        GraphHopper instance = new GraphHopperOSM().
+        GraphHopper instance = new GraphHopper().
                 setStoreOnFlush(false).
                 setEncodingManager(encodingManager).setCHEnabled(false).
                 loadGraph(graph);
@@ -70,14 +88,7 @@ public void testLoad() {
     @Test
     public void testDisconnected179() {
         GraphHopperStorage graph = new GraphBuilder(encodingManager).create();
-        NodeAccess na = graph.getNodeAccess();
-        na.setNode(0, 42, 10);
-        na.setNode(1, 42.1, 10.1);
-        na.setNode(2, 42.1, 10.2);
-        na.setNode(3, 42, 10.4);
-
-        graph.edge(0, 1, 10, true);
-        graph.edge(2, 3, 10, true);
+        initGraph(graph);
 
         GraphHopper instance = new GraphHopper().
                 setStoreOnFlush(false).
@@ -115,4 +126,66 @@ public void testNoLoad() {
             assertTrue(ex.getMessage(), ex.getMessage().startsWith("Do a successful call to load or importOrLoad before routing"));
         }
     }
+
+    @Test
+    public void testConcurrentGraphChange() throws InterruptedException {
+        final GraphHopperStorage graph = new GraphBuilder(encodingManager).create();
+        initGraph(graph);
+        graph.edge(1, 2, 10, true);
+
+        final CountDownLatch latch = new CountDownLatch(1);
+        final AtomicInteger checkPointCounter = new AtomicInteger(0);
+        final GraphHopper graphHopper = new GraphHopper() {
+            @Override
+            protected ChangeGraphHelper createChangeGraphHelper(Graph graph, LocationIndex locationIndex) {
+                return new ChangeGraphHelper(graph, locationIndex) {
+                    @Override
+                    public long applyChanges(EncodingManager em, Collection<JsonFeature> features) {
+                        // force sleep inside the lock and let the main thread run until the lock barrier
+                        latch.countDown();
+                        try {
+                            Thread.sleep(400);
+                        } catch (InterruptedException e) {
+                            throw new RuntimeException(e);
+                        }
+                        checkPointCounter.incrementAndGet();
+                        return super.applyChanges(em, features);
+                    }
+                };
+            }
+        }.setStoreOnFlush(false).setEncodingManager(encodingManager).setCHEnabled(false).
+                loadGraph(graph);
+
+        GHResponse rsp = graphHopper.route(new GHRequest(42, 10.4, 42, 10));
+        assertFalse(rsp.toString(), rsp.hasErrors());
+        assertEquals(1800, rsp.getBest().getTime());
+
+        final List<JsonFeature> list = new ArrayList<>();
+        Map<String, Object> properties = new HashMap<>();
+        properties.put("speed", 5);
+
+        list.add(new JsonFeature("1", "bbox",
+                new BBox(10.399, 10.4, 42.0, 42.001),
+                null, properties));
+
+        ExecutorService executorService = Executors.newFixedThreadPool(1);
+        executorService.submit(new Runnable() {
+            @Override
+            public void run() {
+                graphHopper.changeGraph(list);
+                checkPointCounter.incrementAndGet();
+            }
+        });
+
+        latch.await();
+        assertEquals(0, checkPointCounter.get());
+        rsp = graphHopper.route(new GHRequest(42, 10.4, 42, 10));
+        assertFalse(rsp.toString(), rsp.hasErrors());
+        assertEquals(8400, rsp.getBest().getTime());
+
+        executorService.shutdown();
+        executorService.awaitTermination(3, TimeUnit.SECONDS);
+
+        assertEquals(2, checkPointCounter.get());
+    }
 }
diff --git a/core/src/test/java/com/graphhopper/apache/commons/collections/IntDoubleBinaryHeapTest.java b/core/src/test/java/com/graphhopper/apache/commons/collections/IntDoubleBinaryHeapTest.java
new file mode 100644
index 0000000000..7d90995c9b
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/apache/commons/collections/IntDoubleBinaryHeapTest.java
@@ -0,0 +1,15 @@
+package com.graphhopper.apache.commons.collections;
+
+import com.graphhopper.coll.AbstractBinHeapTest;
+import com.graphhopper.coll.BinHeapWrapper;
+
+/**
+ *
+ * @author Peter Karich
+ */
+public class IntDoubleBinaryHeapTest extends AbstractBinHeapTest {
+    @Override
+    public BinHeapWrapper<Number, Integer> createHeap(int capacity) {
+        return new IntDoubleBinaryHeap(capacity);
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/apache/commons/lang3/StringUtilsTest.java b/core/src/test/java/com/graphhopper/apache/commons/lang3/StringUtilsTest.java
new file mode 100644
index 0000000000..b39af6310b
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/apache/commons/lang3/StringUtilsTest.java
@@ -0,0 +1,59 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package com.graphhopper.apache.commons.lang3;
+
+import com.graphhopper.apache.commons.lang3.StringUtils;
+import org.junit.Test;
+
+import static org.junit.Assert.assertEquals;
+
+/**
+ * This class is a partial Copy of the org.apache.commons.lang3.StringUtils
+ * that can be found here: https://github.com/apache/commons-lang/blob/master/src/test/java/org/apache/commons/lang3/StringUtilsTest.java
+ *
+ * The library can be found here: https://commons.apache.org/proper/commons-lang/
+ *
+ * @author Robin Boldt
+ */
+public class StringUtilsTest{
+
+    @Test
+    public void testGetLevenshteinDistance_StringString() {
+        assertEquals(0, StringUtils.getLevenshteinDistance("", ""));
+        assertEquals(1, StringUtils.getLevenshteinDistance("", "a"));
+        assertEquals(7, StringUtils.getLevenshteinDistance("aaapppp", ""));
+        assertEquals(1, StringUtils.getLevenshteinDistance("frog", "fog"));
+        assertEquals(3, StringUtils.getLevenshteinDistance("fly", "ant"));
+        assertEquals(7, StringUtils.getLevenshteinDistance("elephant", "hippo"));
+        assertEquals(7, StringUtils.getLevenshteinDistance("hippo", "elephant"));
+        assertEquals(8, StringUtils.getLevenshteinDistance("hippo", "zzzzzzzz"));
+        assertEquals(8, StringUtils.getLevenshteinDistance("zzzzzzzz", "hippo"));
+        assertEquals(1, StringUtils.getLevenshteinDistance("hello", "hallo"));
+    }
+
+    @Test(expected = IllegalArgumentException.class)
+    public void testGetLevenshteinDistance_NullString() throws Exception {
+        StringUtils.getLevenshteinDistance("a", null);
+    }
+
+    @Test(expected = IllegalArgumentException.class)
+    public void testGetLevenshteinDistance_StringNull() throws Exception {
+        StringUtils.getLevenshteinDistance(null, "a");
+    }
+
+
+}
diff --git a/core/src/test/java/com/graphhopper/coll/AbstractBinHeapTest.java b/core/src/test/java/com/graphhopper/coll/AbstractBinHeapTest.java
index 8e66d12f93..2fc1a01dd5 100644
--- a/core/src/test/java/com/graphhopper/coll/AbstractBinHeapTest.java
+++ b/core/src/test/java/com/graphhopper/coll/AbstractBinHeapTest.java
@@ -51,8 +51,10 @@ public void testBasic() {
         binHeap.insert(123, 2);
         binHeap.insert(120, 3);
         binHeap.insert(130, 4);
+        binHeap.insert(80, 5);
 
         assertEquals(1, (int) binHeap.pollElement());
+        assertEquals(5, (int) binHeap.pollElement());
         assertEquals(3, (int) binHeap.pollElement());
         assertEquals(2, (int) binHeap.pollElement());
         assertEquals(1, (int) binHeap.getSize());
diff --git a/core/src/test/java/com/graphhopper/coll/GHIntArrayListTest.java b/core/src/test/java/com/graphhopper/coll/GHIntArrayListTest.java
new file mode 100644
index 0000000000..6dce1e1107
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/coll/GHIntArrayListTest.java
@@ -0,0 +1,45 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.coll;
+
+import java.util.Random;
+import org.junit.Test;
+import static org.junit.Assert.*;
+
+/**
+ * @author Peter Karich
+ */
+public class GHIntArrayListTest {
+
+    @Test
+    public void testReverse() {
+        assertEquals(GHIntArrayList.from(4, 3, 2, 1), GHIntArrayList.from(1, 2, 3, 4).reverse());
+        assertEquals(GHIntArrayList.from(5, 4, 3, 2, 1), GHIntArrayList.from(1, 2, 3, 4, 5).reverse());
+    }
+
+    @Test
+    public void testShuffle() {
+        assertEquals(GHIntArrayList.from(4, 1, 3, 2), GHIntArrayList.from(1, 2, 3, 4).shuffle(new Random(0)));
+        assertEquals(GHIntArrayList.from(4, 3, 2, 1, 5), GHIntArrayList.from(1, 2, 3, 4, 5).shuffle(new Random(1)));
+    }
+
+    @Test
+    public void testFill() {
+        assertEquals(GHIntArrayList.from(-1, -1, -1, -1), new GHIntArrayList(4).fill(4, -1));
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/coll/GHSortedCollectionTest.java b/core/src/test/java/com/graphhopper/coll/GHSortedCollectionTest.java
index 1d046db5e1..ee6dadd311 100644
--- a/core/src/test/java/com/graphhopper/coll/GHSortedCollectionTest.java
+++ b/core/src/test/java/com/graphhopper/coll/GHSortedCollectionTest.java
@@ -26,6 +26,7 @@
  * @author Peter Karich
  */
 public class GHSortedCollectionTest {
+    
     @Test
     public void testPoll() {
         GHSortedCollection instance = new GHSortedCollection();
diff --git a/core/src/test/java/com/graphhopper/coll/GHTBitSetTest.java b/core/src/test/java/com/graphhopper/coll/GHTBitSetTest.java
index d88bbbc2c8..3a9ac87492 100644
--- a/core/src/test/java/com/graphhopper/coll/GHTBitSetTest.java
+++ b/core/src/test/java/com/graphhopper/coll/GHTBitSetTest.java
@@ -39,6 +39,6 @@ public void testToString() {
         GHBitSet bs = createBitSet(100);
         bs.add(12);
         bs.add(1);
-        assertEquals("{12,1}", bs.toString());
+        assertEquals("[1, 12]", bs.toString());
     }
 }
diff --git a/core/src/test/java/com/graphhopper/reader/dem/AbstractEdgeElevationInterpolatorTest.java b/core/src/test/java/com/graphhopper/reader/dem/AbstractEdgeElevationInterpolatorTest.java
new file mode 100644
index 0000000000..c16d22bab6
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/reader/dem/AbstractEdgeElevationInterpolatorTest.java
@@ -0,0 +1,83 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import java.util.Arrays;
+
+import org.junit.After;
+import org.junit.Before;
+
+import com.graphhopper.coll.GHBitSetImpl;
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.routing.util.DataFlagEncoder;
+import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.routing.util.FootFlagEncoder;
+import com.graphhopper.storage.GraphExtension;
+import com.graphhopper.storage.GraphHopperStorage;
+import com.graphhopper.storage.RAMDirectory;
+import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.util.Helper;
+
+/**
+ * @author Alexey Valikov
+ */
+public abstract class AbstractEdgeElevationInterpolatorTest {
+
+    protected static final double PRECISION = ElevationInterpolator.EPSILON2;
+    protected ReaderWay interpolatableWay;
+    protected ReaderWay normalWay;
+
+    protected GraphHopperStorage graph;
+    protected DataFlagEncoder dataFlagEncoder;
+    protected AbstractEdgeElevationInterpolator edgeElevationInterpolator;
+
+    @SuppressWarnings("resource")
+    @Before
+    public void setUp() {
+        dataFlagEncoder = new DataFlagEncoder();
+        graph = new GraphHopperStorage(new RAMDirectory(),
+                new EncodingManager(Arrays.asList(dataFlagEncoder, new FootFlagEncoder()),
+                        8),
+                true, new GraphExtension.NoOpExtension()).create(100);
+
+        edgeElevationInterpolator = createEdgeElevationInterpolator();
+
+        interpolatableWay = createInterpolatableWay();
+        normalWay = new ReaderWay(0);
+        normalWay.setTag("highway", "primary");
+    }
+
+    @After
+    public void tearDown() {
+        Helper.close(graph);
+    }
+
+    protected abstract ReaderWay createInterpolatableWay();
+
+    protected AbstractEdgeElevationInterpolator createEdgeElevationInterpolator() {
+        return new BridgeElevationInterpolator(graph, dataFlagEncoder);
+    }
+
+    protected void gatherOuterAndInnerNodeIdsOfStructure(EdgeIteratorState edge,
+                                                         final GHIntHashSet outerNodeIds, final GHIntHashSet innerNodeIds) {
+        edgeElevationInterpolator.gatherOuterAndInnerNodeIds(
+                edgeElevationInterpolator.getStorage().createEdgeExplorer(), edge,
+                new GHBitSetImpl(), outerNodeIds, innerNodeIds);
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/reader/dem/BridgeElevationInterpolatorTest.java b/core/src/test/java/com/graphhopper/reader/dem/BridgeElevationInterpolatorTest.java
new file mode 100644
index 0000000000..fa8cd87579
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/reader/dem/BridgeElevationInterpolatorTest.java
@@ -0,0 +1,132 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import com.graphhopper.coll.GHIntHashSet;
+import static org.junit.Assert.assertEquals;
+
+import org.junit.Test;
+
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.storage.NodeAccess;
+import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.util.Helper;
+import com.graphhopper.util.PointList;
+
+/**
+ * @author Alexey Valikov
+ */
+public class BridgeElevationInterpolatorTest extends AbstractEdgeElevationInterpolatorTest {
+
+    @Override
+    protected ReaderWay createInterpolatableWay() {
+        ReaderWay bridgeWay = new ReaderWay(0);
+        bridgeWay.setTag("highway", "primary");
+        bridgeWay.setTag("bridge", "yes");
+        return bridgeWay;
+    }
+
+    @Override
+    protected AbstractEdgeElevationInterpolator createEdgeElevationInterpolator() {
+        return new BridgeElevationInterpolator(graph, dataFlagEncoder);
+    }
+
+    @Test
+    public void interpolatesElevationOfPillarNodes() {
+
+        // @formatter:off
+        /*
+		 * Graph structure:
+		 * 0-----1-----2-----3-----4
+		 *        \    |    /
+		 *         \   |   /
+		 *          T  T  T
+		 *           \ | /
+		 *            \|/
+		 * 5-----6--T--7--T--8-----9
+         */
+        // @formatter:on
+        NodeAccess na = graph.getNodeAccess();
+        na.setNode(0, 0, 0, 0);
+        na.setNode(1, 10, 0, 10);
+        na.setNode(2, 20, 0, 20);
+        na.setNode(3, 30, 0, 30);
+        na.setNode(4, 40, 0, 40);
+        na.setNode(5, 0, 10, 40);
+        na.setNode(6, 10, 10, 30);
+        na.setNode(7, 20, 10, 1000);
+        na.setNode(8, 30, 10, 10);
+        na.setNode(9, 40, 10, 0);
+
+        EdgeIteratorState edge01 = graph.edge(0, 1, 10, true);
+        EdgeIteratorState edge12 = graph.edge(1, 2, 10, true);
+        EdgeIteratorState edge23 = graph.edge(2, 3, 10, true);
+        EdgeIteratorState edge34 = graph.edge(3, 4, 10, true);
+        EdgeIteratorState edge56 = graph.edge(5, 6, 10, true);
+        EdgeIteratorState edge67 = graph.edge(6, 7, 10, true);
+        EdgeIteratorState edge78 = graph.edge(7, 8, 10, true);
+        EdgeIteratorState edge89 = graph.edge(8, 9, 10, true);
+        EdgeIteratorState edge17 = graph.edge(1, 7, 10, true);
+        EdgeIteratorState edge27 = graph.edge(2, 7, 10, true);
+        EdgeIteratorState edge37 = graph.edge(3, 7, 10, true);
+        edge17.setWayGeometry(
+                Helper.createPointList3D(12, 2, 200, 14, 4, 400, 16, 6, 600, 18, 8, 800));
+
+        edge01.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge12.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge23.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge34.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+
+        edge56.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge67.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge78.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge89.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+
+        edge17.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge27.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge37.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+
+        final GHIntHashSet outerNodeIds = new GHIntHashSet();
+        final GHIntHashSet innerNodeIds = new GHIntHashSet();
+        gatherOuterAndInnerNodeIdsOfStructure(edge27, outerNodeIds, innerNodeIds);
+
+        assertEquals(GHIntHashSet.from(1, 2, 3, 6, 8), outerNodeIds);
+        assertEquals(GHIntHashSet.from(7), innerNodeIds);
+
+        edgeElevationInterpolator.execute();
+        assertEquals(0, na.getElevation(0), PRECISION);
+        assertEquals(10, na.getElevation(1), PRECISION);
+        assertEquals(20, na.getElevation(2), PRECISION);
+        assertEquals(30, na.getElevation(3), PRECISION);
+        assertEquals(40, na.getElevation(4), PRECISION);
+        assertEquals(40, na.getElevation(5), PRECISION);
+        assertEquals(30, na.getElevation(6), PRECISION);
+        assertEquals(20, na.getElevation(7), PRECISION);
+        assertEquals(10, na.getElevation(8), PRECISION);
+        assertEquals(0, na.getElevation(9), PRECISION);
+
+        final PointList edge17PointList = edge17.fetchWayGeometry(3);
+        assertEquals(6, edge17PointList.size());
+        assertEquals(10, edge17PointList.getEle(0), PRECISION);
+        assertEquals(12, edge17PointList.getEle(1), PRECISION);
+        assertEquals(14, edge17PointList.getEle(2), PRECISION);
+        assertEquals(16, edge17PointList.getEle(3), PRECISION);
+        assertEquals(18, edge17PointList.getEle(4), PRECISION);
+        assertEquals(20, edge17PointList.getEle(5), PRECISION);
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/reader/dem/ElevationInterpolatorTest.java b/core/src/test/java/com/graphhopper/reader/dem/ElevationInterpolatorTest.java
new file mode 100644
index 0000000000..99a1d8f92c
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/reader/dem/ElevationInterpolatorTest.java
@@ -0,0 +1,91 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import static org.junit.Assert.assertEquals;
+
+import org.junit.Test;
+
+import com.graphhopper.util.Helper;
+
+/**
+ * @author Alexey Valikov
+ */
+public class ElevationInterpolatorTest {
+
+    private static final double PRECISION = ElevationInterpolator.EPSILON2;
+
+    private ElevationInterpolator elevationInterpolator = new ElevationInterpolator();
+    
+    @Test
+    public void calculatesElevationOnTwoPoints() {
+        assertEquals(15, elevationInterpolator.calculateElevationBasedOnTwoPoints(0, 0, -10, -10,
+                        10, 10, 10, 20), PRECISION);
+        assertEquals(15, elevationInterpolator.calculateElevationBasedOnTwoPoints(-10, 10, -10, -10,
+                        10, 10, 10, 20), PRECISION);
+        assertEquals(15, elevationInterpolator.calculateElevationBasedOnTwoPoints(-5, 5, -10, -10,
+                        10, 10, 10, 20), PRECISION);
+        assertEquals(19, elevationInterpolator.calculateElevationBasedOnTwoPoints(8, 8, -10, -10,
+                        10, 10, 10, 20), PRECISION);
+        assertEquals(10, elevationInterpolator.calculateElevationBasedOnTwoPoints(0, 0,
+                        -ElevationInterpolator.EPSILON / 3, 0, 10,
+                        ElevationInterpolator.EPSILON / 2, 0, 20), PRECISION);
+        assertEquals(20, elevationInterpolator.calculateElevationBasedOnTwoPoints(0, 0,
+                        -ElevationInterpolator.EPSILON / 2, 0, 10,
+                        ElevationInterpolator.EPSILON / 3, 0, 20), PRECISION);
+        assertEquals(10, elevationInterpolator.calculateElevationBasedOnTwoPoints(0, 0, 0, 0, 10, 0,
+                        0, 20), PRECISION);
+    }
+
+    @Test
+    public void calculatesElevationOnThreePoints() {
+        assertEquals(-0.88, elevationInterpolator.calculateElevationBasedOnThreePoints(0, 0, 1,
+                        2, 3, 4, 6, 9, 12, 11, 9), PRECISION);
+        assertEquals(15, elevationInterpolator.calculateElevationBasedOnThreePoints(10, 0, 0, 0, 0,
+                        10, 10, 10, 10, -10, 20), PRECISION);
+        assertEquals(5, elevationInterpolator.calculateElevationBasedOnThreePoints(5, 5, 0, 0, 0,
+                        10, 10, 10, 20, 20, 20), PRECISION);
+    }
+
+    @Test
+    public void calculatesElevationOnNPoints() {
+        assertEquals(0, elevationInterpolator.calculateElevationBasedOnPointList(5, 5,
+                        Helper.createPointList3D(0, 0, 0, 10, 0, 0, 10, 10, 0, 0, 10, 0)),
+                        PRECISION);
+        assertEquals(10, elevationInterpolator.calculateElevationBasedOnPointList(5, 5,
+                        Helper.createPointList3D(0, 0, 0, 10, 0, 10, 10, 10, 20, 0, 10, 10)),
+                        PRECISION);
+        assertEquals(5, elevationInterpolator.calculateElevationBasedOnPointList(5, 5,
+                        Helper.createPointList3D(0, 0, 0, 10, 0, 10, 10, 10, 0, 0, 10, 10)),
+                        PRECISION);
+        assertEquals(2.65, elevationInterpolator.calculateElevationBasedOnPointList(2.5,
+                        2.5, Helper.createPointList3D(0, 0, 0, 10, 0, 10, 10, 10, 0, 0, 10, 10)),
+                        PRECISION);
+        assertEquals(0, elevationInterpolator.calculateElevationBasedOnPointList(0.1,
+                        0.1, Helper.createPointList3D(0, 0, 0, 10, 0, 10, 10, 10, 0, 0, 10, 10)),
+                        PRECISION);
+        assertEquals(0, elevationInterpolator.calculateElevationBasedOnPointList(
+                        ElevationInterpolator.EPSILON / 2, ElevationInterpolator.EPSILON / 2,
+                        Helper.createPointList3D(0, 0, 0, 10, 0, 10, 10, 10, 0, 0, 10, 10)),
+                        PRECISION);
+        assertEquals(0, elevationInterpolator.calculateElevationBasedOnPointList(5, 0,
+                        Helper.createPointList3D(0, 0, 0, 10, 1, 10, 10, -1, -10, 20, 0, 0)),
+                        PRECISION);
+    }
+
+}
diff --git a/core/src/test/java/com/graphhopper/reader/dem/SRTMProviderTest.java b/core/src/test/java/com/graphhopper/reader/dem/SRTMProviderTest.java
index 9d277b0a4d..83fd21588d 100644
--- a/core/src/test/java/com/graphhopper/reader/dem/SRTMProviderTest.java
+++ b/core/src/test/java/com/graphhopper/reader/dem/SRTMProviderTest.java
@@ -18,6 +18,7 @@
 package com.graphhopper.reader.dem;
 
 import com.graphhopper.storage.DAType;
+import com.graphhopper.util.Constants;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
@@ -96,7 +97,6 @@ public void testGetHeight_issue545() throws IOException {
     @Test
     public void testGetHeightMMap() throws IOException {
         instance.setCacheDir(new File("./files/"));
-        instance.setDAType(DAType.MMAP);
         assertEquals(161, instance.getEle(55.8943144, -3), 1e-1);
     }
 }
diff --git a/core/src/test/java/com/graphhopper/reader/dem/TunnelElevationInterpolatorTest.java b/core/src/test/java/com/graphhopper/reader/dem/TunnelElevationInterpolatorTest.java
new file mode 100644
index 0000000000..4e629ce02b
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/reader/dem/TunnelElevationInterpolatorTest.java
@@ -0,0 +1,296 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.dem;
+
+import com.graphhopper.coll.GHIntHashSet;
+import static org.junit.Assert.assertEquals;
+
+import org.junit.Test;
+
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.storage.NodeAccess;
+import com.graphhopper.util.EdgeIteratorState;
+
+/**
+ * @author Alexey Valikov
+ */
+public class TunnelElevationInterpolatorTest extends AbstractEdgeElevationInterpolatorTest {
+
+    @Override
+    protected ReaderWay createInterpolatableWay() {
+        ReaderWay tunnelWay = new ReaderWay(0);
+        tunnelWay.setTag("highway", "primary");
+        tunnelWay.setTag("tunnel", "yes");
+        return tunnelWay;
+    }
+
+    @Override
+    protected AbstractEdgeElevationInterpolator createEdgeElevationInterpolator() {
+        return new TunnelElevationInterpolator(graph, dataFlagEncoder);
+    }
+
+    @Test
+    public void doesNotInterpolateElevationOfTunnelWithZeroOuterNodes() {
+
+        // @formatter:off
+        /*
+		 * Graph structure:
+		 * 0--T--1--T--2     3--T--4
+		 * Tunnel 0-1-2 has a single outer node 2.
+         */
+        // @formatter:on
+        NodeAccess na = graph.getNodeAccess();
+        na.setNode(0, 0, 0, 0);
+        na.setNode(1, 10, 0, 0);
+        na.setNode(2, 20, 0, 10);
+        na.setNode(3, 30, 0, 20);
+        na.setNode(4, 40, 0, 0);
+
+        EdgeIteratorState edge01 = graph.edge(0, 1, 10, true);
+        EdgeIteratorState edge12 = graph.edge(1, 2, 10, true);
+        EdgeIteratorState edge34 = graph.edge(3, 4, 10, true);
+
+        edge01.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge12.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge34.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+
+        final GHIntHashSet outerNodeIds = new GHIntHashSet();
+        final GHIntHashSet innerNodeIds = new GHIntHashSet();
+        gatherOuterAndInnerNodeIdsOfStructure(edge01, outerNodeIds, innerNodeIds);
+
+        assertEquals(GHIntHashSet.from(), outerNodeIds);
+        assertEquals(GHIntHashSet.from(0, 1, 2), innerNodeIds);
+
+        edgeElevationInterpolator.execute();
+        assertEquals(0, na.getElevation(0), PRECISION);
+        assertEquals(0, na.getElevation(1), PRECISION);
+        assertEquals(10, na.getElevation(2), PRECISION);
+        assertEquals(20, na.getElevation(3), PRECISION);
+        assertEquals(0, na.getElevation(4), PRECISION);
+    }
+
+    @Test
+    public void interpolatesElevationOfTunnelWithSingleOuterNode() {
+
+        // @formatter:off
+        /*
+		 * Graph structure:
+		 * 0--T--1--T--2-----3--T--4
+         */
+        // @formatter:on
+        NodeAccess na = graph.getNodeAccess();
+        na.setNode(0, 0, 0, 0);
+        na.setNode(1, 10, 0, 00);
+        na.setNode(2, 20, 0, 10);
+        na.setNode(3, 30, 0, 20);
+        na.setNode(4, 40, 0, 00);
+
+        EdgeIteratorState edge01 = graph.edge(0, 1, 10, true);
+        EdgeIteratorState edge12 = graph.edge(1, 2, 10, true);
+        EdgeIteratorState edge23 = graph.edge(2, 3, 10, true);
+        EdgeIteratorState edge34 = graph.edge(3, 4, 10, true);
+
+        edge01.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge12.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge23.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge34.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+
+        final GHIntHashSet outerNodeIds = new GHIntHashSet();
+        final GHIntHashSet innerNodeIds = new GHIntHashSet();
+        gatherOuterAndInnerNodeIdsOfStructure(edge01, outerNodeIds, innerNodeIds);
+
+        assertEquals(GHIntHashSet.from(2), outerNodeIds);
+        assertEquals(GHIntHashSet.from(0, 1), innerNodeIds);
+
+        edgeElevationInterpolator.execute();
+        assertEquals(10, na.getElevation(0), PRECISION);
+        assertEquals(10, na.getElevation(1), PRECISION);
+        assertEquals(10, na.getElevation(2), PRECISION);
+        assertEquals(20, na.getElevation(3), PRECISION);
+        assertEquals(20, na.getElevation(4), PRECISION);
+    }
+
+    @Test
+    public void interpolatesElevationOfTunnelWithTwoOuterNodes() {
+
+        // @formatter:off
+        /*
+		 * Graph structure:
+		 * 0-----1--T--2--T--3-----4
+         */
+        // @formatter:on
+        NodeAccess na = graph.getNodeAccess();
+        na.setNode(0, 0, 0, 0);
+        na.setNode(1, 10, 0, 10);
+        na.setNode(2, 20, 0, 1000);
+        na.setNode(3, 30, 0, 30);
+        na.setNode(4, 40, 0, 40);
+
+        EdgeIteratorState edge01 = graph.edge(0, 1, 10, true);
+        EdgeIteratorState edge12 = graph.edge(1, 2, 10, true);
+        EdgeIteratorState edge23 = graph.edge(2, 3, 10, true);
+        EdgeIteratorState edge34 = graph.edge(3, 4, 10, true);
+
+        edge01.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge12.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge23.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge34.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+
+        final GHIntHashSet outerNodeIds = new GHIntHashSet();
+        final GHIntHashSet innerNodeIds = new GHIntHashSet();
+        gatherOuterAndInnerNodeIdsOfStructure(edge12, outerNodeIds, innerNodeIds);
+
+        assertEquals(GHIntHashSet.from(1, 3), outerNodeIds);
+        assertEquals(GHIntHashSet.from(2), innerNodeIds);
+
+        edgeElevationInterpolator.execute();
+        assertEquals(0, na.getElevation(0), PRECISION);
+        assertEquals(10, na.getElevation(1), PRECISION);
+        assertEquals(20, na.getElevation(2), PRECISION);
+        assertEquals(30, na.getElevation(3), PRECISION);
+        assertEquals(40, na.getElevation(4), PRECISION);
+    }
+
+    @Test
+    public void interpolatesElevationOfTunnelWithThreeOuterNodes() {
+
+        // @formatter:off
+        /*
+		 * Graph structure:
+		 * 0-----1--T--2--T--3-----4
+		 *             |
+		 *             |
+		 *             T
+		 *             |
+		 *             |
+		 *             5--T--6-----7
+         */
+        // @formatter:on
+        NodeAccess na = graph.getNodeAccess();
+        na.setNode(0, 0, 0, 0);
+        na.setNode(1, 10, 0, 10);
+        na.setNode(2, 20, 0, 1000);
+        na.setNode(3, 30, 0, 30);
+        na.setNode(4, 40, 0, 40);
+        na.setNode(5, 20, 10, 1000);
+        na.setNode(6, 30, 10, 30);
+        na.setNode(7, 40, 10, 40);
+
+        EdgeIteratorState edge01 = graph.edge(0, 1, 10, true);
+        EdgeIteratorState edge12 = graph.edge(1, 2, 10, true);
+        EdgeIteratorState edge23 = graph.edge(2, 3, 10, true);
+        EdgeIteratorState edge34 = graph.edge(3, 4, 10, true);
+        EdgeIteratorState edge25 = graph.edge(2, 5, 10, true);
+        EdgeIteratorState edge56 = graph.edge(5, 6, 10, true);
+        EdgeIteratorState edge67 = graph.edge(6, 7, 10, true);
+
+        edge01.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge12.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge23.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge34.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge25.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge56.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge67.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+
+        final GHIntHashSet outerNodeIds = new GHIntHashSet();
+        final GHIntHashSet innerNodeIds = new GHIntHashSet();
+        gatherOuterAndInnerNodeIdsOfStructure(edge12, outerNodeIds, innerNodeIds);
+
+        assertEquals(GHIntHashSet.from(1, 3, 6), outerNodeIds);
+        assertEquals(GHIntHashSet.from(2, 5), innerNodeIds);
+
+        edgeElevationInterpolator.execute();
+        assertEquals(0, na.getElevation(0), PRECISION);
+        assertEquals(10, na.getElevation(1), PRECISION);
+        assertEquals(20, na.getElevation(2), PRECISION);
+        assertEquals(30, na.getElevation(3), PRECISION);
+        assertEquals(40, na.getElevation(4), PRECISION);
+        assertEquals(20, na.getElevation(5), PRECISION);
+        assertEquals(30, na.getElevation(6), PRECISION);
+        assertEquals(40, na.getElevation(7), PRECISION);
+    }
+
+    @Test
+    public void interpolatesElevationOfTunnelWithFourOuterNodes() {
+
+        // @formatter:off
+        /*
+            * Graph structure:
+            * 0-----1--T--2--T--3-----4
+            *             |
+            *             |
+            *             T
+            *             |
+            *             |
+            * 5-----6--T--7--T--8-----9
+         */
+        // @formatter:on
+        NodeAccess na = graph.getNodeAccess();
+        na.setNode(0, 0, 0, 0);
+        na.setNode(1, 10, 0, 10);
+        na.setNode(2, 20, 0, 1000);
+        na.setNode(3, 30, 0, 30);
+        na.setNode(4, 40, 0, 40);
+        na.setNode(5, 0, 10, 40);
+        na.setNode(6, 10, 10, 30);
+        na.setNode(7, 20, 10, 1000);
+        na.setNode(8, 30, 10, 10);
+        na.setNode(9, 40, 10, 0);
+
+        EdgeIteratorState edge01 = graph.edge(0, 1, 10, true);
+        EdgeIteratorState edge12 = graph.edge(1, 2, 10, true);
+        EdgeIteratorState edge23 = graph.edge(2, 3, 10, true);
+        EdgeIteratorState edge34 = graph.edge(3, 4, 10, true);
+        EdgeIteratorState edge56 = graph.edge(5, 6, 10, true);
+        EdgeIteratorState edge67 = graph.edge(6, 7, 10, true);
+        EdgeIteratorState edge78 = graph.edge(7, 8, 10, true);
+        EdgeIteratorState edge89 = graph.edge(8, 9, 10, true);
+        EdgeIteratorState edge27 = graph.edge(2, 7, 10, true);
+
+        edge01.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge12.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge23.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge34.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+
+        edge56.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+        edge67.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge78.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+        edge89.setFlags(dataFlagEncoder.handleWayTags(normalWay, 1, 0));
+
+        edge27.setFlags(dataFlagEncoder.handleWayTags(interpolatableWay, 1, 0));
+
+        final GHIntHashSet outerNodeIds = new GHIntHashSet();
+        final GHIntHashSet innerNodeIds = new GHIntHashSet();
+        gatherOuterAndInnerNodeIdsOfStructure(edge12, outerNodeIds, innerNodeIds);
+
+        assertEquals(GHIntHashSet.from(1, 3, 6, 8), outerNodeIds);
+        assertEquals(GHIntHashSet.from(2, 7), innerNodeIds);
+
+        edgeElevationInterpolator.execute();
+        assertEquals(0, na.getElevation(0), PRECISION);
+        assertEquals(10, na.getElevation(1), PRECISION);
+        assertEquals(20, na.getElevation(2), PRECISION);
+        assertEquals(30, na.getElevation(3), PRECISION);
+        assertEquals(40, na.getElevation(4), PRECISION);
+        assertEquals(40, na.getElevation(5), PRECISION);
+        assertEquals(30, na.getElevation(6), PRECISION);
+        assertEquals(20, na.getElevation(7), PRECISION);
+        assertEquals(10, na.getElevation(8), PRECISION);
+        assertEquals(0, na.getElevation(9), PRECISION);
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/reader/osm/conditional/ConditionalParserTest.java b/core/src/test/java/com/graphhopper/reader/osm/conditional/ConditionalParserTest.java
index d78a2380ab..811913688c 100644
--- a/core/src/test/java/com/graphhopper/reader/osm/conditional/ConditionalParserTest.java
+++ b/core/src/test/java/com/graphhopper/reader/osm/conditional/ConditionalParserTest.java
@@ -31,11 +31,10 @@
  * @author Robin Boldt
  */
 public class ConditionalParserTest extends CalendarBasedTest {
-    ConditionalParser parser;
 
-    @Before
-    public void setup() {
-        HashSet<String> restrictedValues = new HashSet<String>();
+    private final HashSet<String> restrictedValues = new HashSet<String>();
+
+    public ConditionalParserTest() {
         restrictedValues.add("private");
         restrictedValues.add("agricultural");
         restrictedValues.add("forestry");
@@ -44,86 +43,94 @@ public void setup() {
         restrictedValues.add("delivery");
         restrictedValues.add("military");
         restrictedValues.add("emergency");
+    }
 
-        parser = new ConditionalParser(restrictedValues);
+    ConditionalParser createParser(Calendar date) {
+        return new ConditionalParser(restrictedValues).addConditionalValueParser(new DateRangeParser(date));
     }
 
     @Test
     public void testParseConditional() throws ParseException {
-        ValueRange dateRange = parser.getRange("no @ (2015 Sep 1-2015 Sep 30)");
-        assertFalse(dateRange.isInRange(getCalendar(2015, Calendar.AUGUST, 31)));
-        assertTrue(dateRange.isInRange(getCalendar(2015, Calendar.SEPTEMBER, 30)));
+        String str = "no @ (2015 Sep 1-2015 Sep 30)";
+        assertFalse(createParser(getCalendar(2015, Calendar.AUGUST, 31)).checkCondition(str));
+        assertTrue(createParser(getCalendar(2015, Calendar.SEPTEMBER, 30)).checkCondition(str));
     }
 
     @Test
     public void testParseAllowingCondition() throws ParseException {
-        ValueRange dateRange = parser.getRange("yes @ (2015 Sep 1-2015 Sep 30)");
-        assertNull(dateRange);
+        assertFalse(createParser(getCalendar(2015, Calendar.JANUARY, 12)).
+                checkCondition("yes @ (2015 Sep 1-2015 Sep 30)"));
     }
 
     @Test
     public void testParsingOfLeading0() throws ParseException {
-        ValueRange dateRange = parser.getRange("no @ (01.11. - 31.03.)");
-        assertTrue(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 2)));
+        assertTrue(createParser(getCalendar(2015, Calendar.DECEMBER, 2)).
+                checkCondition("no @ (01.11. - 31.03.)"));
 
-        dateRange = parser.getRange("no @ (01.11 - 31.03)");
-        assertTrue(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 2)));
+        assertTrue(createParser(getCalendar(2015, Calendar.DECEMBER, 2)).
+                checkCondition("no @ (01.11 - 31.03)"));
     }
 
     @Test
     public void testGetRange() throws Exception {
+        assertTrue(ConditionalParser.createNumberParser("weight", 11).checkCondition("weight > 10").isCheckPassed());
+        assertFalse(ConditionalParser.createNumberParser("weight", 10).checkCondition("weight > 10").isCheckPassed());
+        assertFalse(ConditionalParser.createNumberParser("weight", 9).checkCondition("weight > 10").isCheckPassed());
+        assertFalse(ConditionalParser.createNumberParser("xy", 9).checkCondition("weight > 10").isValid());
+
         Set<String> set = new HashSet<>();
         set.add("no");
-        ConditionalParser instance = new ConditionalParser(set);
-
-        ValueRange result = instance.getRange("no @ weight > 10");
-        assertEquals("weight", result.getKey());
-        assertTrue(result.isInRange(11));
-        assertFalse(result.isInRange(10));
-        assertFalse(result.isInRange(9));
-
-        result = instance.getRange("no @weight>10");
-        assertTrue(result.isInRange(11));
-        assertFalse(result.isInRange(10));
-        assertFalse(result.isInRange(9));
-
-        result = instance.getRange("no @ weight < 10");
-        assertFalse(result.isInRange(11));
-        assertFalse(result.isInRange(10));
-        assertTrue(result.isInRange(9));
+        ConditionalParser instance = new ConditionalParser(set).
+                setConditionalValueParser(ConditionalParser.createNumberParser("weight", 11));
+        assertTrue(instance.checkCondition("no @weight>10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 10));
+        assertFalse(instance.checkCondition("no @weight>10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 9));
+        assertFalse(instance.checkCondition("no @weight>10"));
+
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 11));
+        assertFalse(instance.checkCondition("no @ weight < 10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 10));
+        assertFalse(instance.checkCondition("no @ weight < 10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 9));
+        assertTrue(instance.checkCondition("no @ weight < 10"));
 
         // equals is ignored for now (not that bad for weight)
-        result = instance.getRange("no @ weight <= 10");
-        assertFalse(result.isInRange(11));
-        assertFalse(result.isInRange(10));
-        assertTrue(result.isInRange(9));
-
-        result = instance.getRange("no @ weight<=10");
-        assertFalse(result.isInRange(11));
-        assertFalse(result.isInRange(10));
-        assertTrue(result.isInRange(9));
-
-        result = instance.getRange("no @ height > 2");
-        assertEquals("height", result.getKey());
-        assertFalse(result.isInRange(1));
-        assertFalse(result.isInRange(2));
-        assertTrue(result.isInRange(3));
-
-        // unit is allowed according to wiki :/
-        result = instance.getRange("no @ height > 2t");
-        assertEquals("height", result.getKey());
-        assertFalse(result.isInRange(1));
-        assertFalse(result.isInRange(2));
-        assertTrue(result.isInRange(3));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 11));
+        assertFalse(instance.checkCondition("no @ weight <= 10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 10));
+        assertFalse(instance.checkCondition("no @ weight <= 10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 9));
+        assertTrue(instance.checkCondition("no @ weight <= 10"));
+
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 11));
+        assertFalse(instance.checkCondition("no @ weight<=10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 10));
+        assertFalse(instance.checkCondition("no @ weight<=10"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("weight", 9));
+        assertTrue(instance.checkCondition("no @ weight<=10"));
+
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("height", 1));
+        assertFalse(instance.checkCondition("no @ height > 2"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("height", 2));
+        assertFalse(instance.checkCondition("no @ height > 2"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("height", 3));
+        assertTrue(instance.checkCondition("no @ height > 2"));
+
+        // unit is allowed according to wiki
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("height", 1));
+        assertFalse(instance.checkCondition("no @ height > 2t"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("height", 2));
+        assertFalse(instance.checkCondition("no @ height > 2t"));
+        instance.setConditionalValueParser(ConditionalParser.createNumberParser("height", 3));
+        assertTrue(instance.checkCondition("no @ height > 2t"));
     }
 
     @Test
     public void parseNumber() {
-        // TODO currently no unit conversation is done which can be required if a different one is passed in isInRange        
-        Set<String> set = new HashSet<>();
-        ConditionalParser p = new ConditionalParser(set);
-        assertEquals(3, p.parseNumber("3t"), .1);
-        assertEquals(3.1, p.parseNumber("3.1 t"), .1);
-        assertEquals(3, p.parseNumber("3 meters"), .1);
+        // TODO currently no unit conversation is done which can be required if a different one is passed in checkCondition
+        assertEquals(3, ConditionalParser.parseNumber("3t"), .1);
+        assertEquals(3.1, ConditionalParser.parseNumber("3.1 t"), .1);
+        assertEquals(3, ConditionalParser.parseNumber("3 meters"), .1);
     }
 }
diff --git a/core/src/test/java/com/graphhopper/reader/osm/conditional/DateRangeParserTest.java b/core/src/test/java/com/graphhopper/reader/osm/conditional/DateRangeParserTest.java
index 92c5284fe7..eeaa8f6ef8 100644
--- a/core/src/test/java/com/graphhopper/reader/osm/conditional/DateRangeParserTest.java
+++ b/core/src/test/java/com/graphhopper/reader/osm/conditional/DateRangeParserTest.java
@@ -28,6 +28,8 @@
  * @author Robin Boldt
  */
 public class DateRangeParserTest extends CalendarBasedTest {
+    final DateRangeParser dateRangeParser = new DateRangeParser();
+
     @Test
     public void testParseConditional() throws ParseException {
         assertSameDate(2014, Calendar.DECEMBER, 15, "2014 Dec 15");
@@ -39,13 +41,13 @@ public void testParseConditional() throws ParseException {
 
     @Test
     public void testToString() throws ParseException {
-        DateRange instance = DateRangeParser.parseDateRange("Mar-Oct");
+        DateRange instance = dateRangeParser.getRange("Mar-Oct");
         assertEquals("yearless:true, dayOnly:false, reverse:false, from:1970-03-01T00:00:00Z, to:1970-10-31T23:59:59Z", instance.toString());
     }
 
     @Test
     public void testParseSimpleDateRange() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("2014 Aug 10-2014 Aug 14");
+        DateRange dateRange = dateRangeParser.getRange("2014 Aug 10-2014 Aug 14");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 9)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 10)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 12)));
@@ -55,7 +57,7 @@ public void testParseSimpleDateRange() throws ParseException {
 
     @Test
     public void testParseSimpleDateRangeWithoutYear() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Aug 10-Aug 14");
+        DateRange dateRange = dateRangeParser.getRange("Aug 10-Aug 14");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 9)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 10)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 12)));
@@ -65,7 +67,7 @@ public void testParseSimpleDateRangeWithoutYear() throws ParseException {
 
     @Test
     public void testParseSimpleDateRangeWithoutYearAndDay() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Jul-Aug");
+        DateRange dateRange = dateRangeParser.getRange("Jul-Aug");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.JUNE, 9)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.JULY, 10)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 12)));
@@ -74,7 +76,7 @@ public void testParseSimpleDateRangeWithoutYearAndDay() throws ParseException {
 
     @Test
     public void testParseSimpleDateRangeWithoutYearAndDay2() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Mar-Sep");
+        DateRange dateRange = dateRangeParser.getRange("Mar-Sep");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.FEBRUARY, 25)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.MARCH, 1)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 30)));
@@ -83,7 +85,7 @@ public void testParseSimpleDateRangeWithoutYearAndDay2() throws ParseException {
 
     @Test
     public void testParseReverseDateRange() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("2014 Aug 14-2015 Mar 10");
+        DateRange dateRange = dateRangeParser.getRange("2014 Aug 14-2015 Mar 10");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 13)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 14)));
         assertTrue(dateRange.isInRange(getCalendar(2015, Calendar.MARCH, 10)));
@@ -92,7 +94,7 @@ public void testParseReverseDateRange() throws ParseException {
 
     @Test
     public void testParseReverseDateRangeWithoutYear() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Aug 14-Aug 10");
+        DateRange dateRange = dateRangeParser.getRange("Aug 14-Aug 10");
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.JANUARY, 9)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 9)));
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 10)));
@@ -104,7 +106,7 @@ public void testParseReverseDateRangeWithoutYear() throws ParseException {
 
     @Test
     public void testParseReverseDateRangeWithoutYearAndDay() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Sep-Mar");
+        DateRange dateRange = dateRangeParser.getRange("Sep-Mar");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 31)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 1)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.DECEMBER, 24)));
@@ -115,7 +117,7 @@ public void testParseReverseDateRangeWithoutYearAndDay() throws ParseException {
 
     @Test
     public void testParseReverseDateRangeWithoutYearAndDay_645() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Aug 10-Jan");
+        DateRange dateRange = dateRangeParser.getRange("Aug 10-Jan");
         assertFalse(dateRange.isInRange(getCalendar(2016, Calendar.AUGUST, 9)));
         assertTrue(dateRange.isInRange(getCalendar(2016, Calendar.AUGUST, 10)));
         assertTrue(dateRange.isInRange(getCalendar(2016, Calendar.JANUARY, 1)));
@@ -126,7 +128,7 @@ public void testParseReverseDateRangeWithoutYearAndDay_645() throws ParseExcepti
 
     @Test
     public void testParseSingleDateRange() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("2014 Sep 1");
+        DateRange dateRange = dateRangeParser.getRange("2014 Sep 1");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 31)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 1)));
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 30)));
@@ -136,7 +138,7 @@ public void testParseSingleDateRange() throws ParseException {
 
     @Test
     public void testParseSingleDateRangeWithoutDay() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("2014 Sep");
+        DateRange dateRange = dateRangeParser.getRange("2014 Sep");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 31)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 1)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 30)));
@@ -146,7 +148,7 @@ public void testParseSingleDateRangeWithoutDay() throws ParseException {
 
     @Test
     public void testParseSingleDateRangeWithoutYearAndDay() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Sep");
+        DateRange dateRange = dateRangeParser.getRange("Sep");
         assertFalse(dateRange.isInRange(getCalendar(2014, Calendar.AUGUST, 31)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 1)));
         assertTrue(dateRange.isInRange(getCalendar(2014, Calendar.SEPTEMBER, 30)));
@@ -155,7 +157,7 @@ public void testParseSingleDateRangeWithoutYearAndDay() throws ParseException {
 
     @Test
     public void testParseSingleDateRangeOneDayOnly() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Sa");
+        DateRange dateRange = dateRangeParser.getRange("Sa");
         assertFalse(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 25)));
         assertTrue(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 26)));
         assertFalse(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 27)));
@@ -163,7 +165,7 @@ public void testParseSingleDateRangeOneDayOnly() throws ParseException {
 
     @Test
     public void testParseSingleDateRangeOneDayOnlyIncludingPh() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Su, PH");
+        DateRange dateRange = dateRangeParser.getRange("Su, PH");
         assertFalse(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 26)));
         assertTrue(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 27)));
         assertFalse(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 28)));
@@ -171,7 +173,7 @@ public void testParseSingleDateRangeOneDayOnlyIncludingPh() throws ParseExceptio
 
     @Test
     public void testParseSingleDateRangeDayOnly() throws ParseException {
-        DateRange dateRange = DateRangeParser.parseDateRange("Mo-Fr");
+        DateRange dateRange = dateRangeParser.getRange("Mo-Fr");
         assertTrue(dateRange.dayOnly);
         assertFalse(dateRange.reverse);
         assertFalse(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 20)));
@@ -186,7 +188,7 @@ public void testParseReverseDateRangeDayOnly() throws ParseException {
         // This is reverse since Su=7 and Mo=1 
         // Note: If we use Locale.Germany or Locale.UK for calendar creation 
         // then cal.set(DAY_OF_WEEK, 7) results in a "time in millis" after Saturday leading to reverse=false
-        DateRange dateRange = DateRangeParser.parseDateRange("Sa-Su");
+        DateRange dateRange = dateRangeParser.getRange("Sa-Su");
         assertTrue(dateRange.dayOnly);
         assertTrue(dateRange.reverse);
         assertFalse(dateRange.isInRange(getCalendar(2015, Calendar.DECEMBER, 25)));
@@ -197,7 +199,7 @@ public void testParseReverseDateRangeDayOnly() throws ParseException {
 
     @Test(expected = ParseException.class)
     public void testParseUnparsableDate() throws ParseException {
-        DateRangeParser.parseDateRange("Sat");
+        dateRangeParser.getRange("Sat");
         fail();
     }
 
diff --git a/core/src/test/java/com/graphhopper/routing/AStarBidirectionTest.java b/core/src/test/java/com/graphhopper/routing/AStarBidirectionTest.java
index 95b4ee9cd2..4b94f5e5e2 100644
--- a/core/src/test/java/com/graphhopper/routing/AStarBidirectionTest.java
+++ b/core/src/test/java/com/graphhopper/routing/AStarBidirectionTest.java
@@ -61,7 +61,7 @@ public RoutingAlgorithmFactory createFactory(GraphHopperStorage prepareGraph, Al
         return new RoutingAlgorithmFactory() {
             @Override
             public RoutingAlgorithm createAlgo(Graph g, AlgorithmOptions opts) {
-                return new AStarBidirection(g, opts.getFlagEncoder(), opts.getWeighting(), traversalMode);
+                return new AStarBidirection(g, opts.getWeighting(), traversalMode);
             }
         };
     }
@@ -75,7 +75,7 @@ public void testInitFromAndTo() {
 
         final AtomicReference<AStar.AStarEntry> fromRef = new AtomicReference<AStar.AStarEntry>();
         final AtomicReference<AStar.AStarEntry> toRef = new AtomicReference<AStar.AStarEntry>();
-        AStarBidirection astar = new AStarBidirection(g, carEncoder, new ShortestWeighting(carEncoder), traversalMode) {
+        AStarBidirection astar = new AStarBidirection(g, new ShortestWeighting(carEncoder), traversalMode) {
             @Override
             public void initFrom(int from, double weight) {
                 super.initFrom(from, weight);
diff --git a/core/src/test/java/com/graphhopper/routing/AStarTest.java b/core/src/test/java/com/graphhopper/routing/AStarTest.java
index f720a9078d..8cd206fcea 100644
--- a/core/src/test/java/com/graphhopper/routing/AStarTest.java
+++ b/core/src/test/java/com/graphhopper/routing/AStarTest.java
@@ -56,7 +56,7 @@ public RoutingAlgorithmFactory createFactory(GraphHopperStorage prepareGraph, Al
         return new RoutingAlgorithmFactory() {
             @Override
             public RoutingAlgorithm createAlgo(Graph g, AlgorithmOptions opts) {
-                return new AStar(g, opts.getFlagEncoder(), opts.getWeighting(), traversalMode);
+                return new AStar(g, opts.getWeighting(), traversalMode);
             }
         };
     }
diff --git a/core/src/test/java/com/graphhopper/routing/AbstractRoutingAlgorithmTester.java b/core/src/test/java/com/graphhopper/routing/AbstractRoutingAlgorithmTester.java
index ac69380098..de7382ba94 100644
--- a/core/src/test/java/com/graphhopper/routing/AbstractRoutingAlgorithmTester.java
+++ b/core/src/test/java/com/graphhopper/routing/AbstractRoutingAlgorithmTester.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.routing;
 
+import com.carrotsearch.hppc.IntIndexedContainer;
 import com.graphhopper.routing.util.*;
 import com.graphhopper.routing.weighting.FastestWeighting;
 import com.graphhopper.routing.weighting.ShortestWeighting;
@@ -26,7 +27,6 @@
 import com.graphhopper.storage.index.LocationIndexTree;
 import com.graphhopper.storage.index.QueryResult;
 import com.graphhopper.util.*;
-import gnu.trove.list.TIntList;
 import org.junit.Before;
 import org.junit.Test;
 
@@ -147,7 +147,7 @@ protected static GraphHopperStorage createMatrixAlikeGraph(GraphHopperStorage tm
     public void setUp() {
         carEncoder = (CarFlagEncoder) encodingManager.getEncoder("car");
         footEncoder = (FootFlagEncoder) encodingManager.getEncoder("foot");
-        defaultOpts = AlgorithmOptions.start().flagEncoder(carEncoder).
+        defaultOpts = AlgorithmOptions.start().
                 weighting(new ShortestWeighting(carEncoder)).build();
     }
 
@@ -193,7 +193,7 @@ public void testCalcFastestPath() {
         assertEquals(p1.toString(), 402.3, p1.getDistance(), .1);
         assertEquals(p1.toString(), 144823, p1.getTime());
 
-        AlgorithmOptions opts = AlgorithmOptions.start().flagEncoder(carEncoder).
+        AlgorithmOptions opts = AlgorithmOptions.start().
                 weighting(new FastestWeighting(carEncoder)).build();
         GraphHopperStorage graphFastest = createGHStorage(encodingManager, Arrays.asList(opts.getWeighting()), false);
         initDirectedAndDiffSpeed(graphFastest, carEncoder);
@@ -246,7 +246,7 @@ protected void initDirectedAndDiffSpeed(Graph graph, FlagEncoder enc) {
 
     @Test
     public void testCalcFootPath() {
-        AlgorithmOptions opts = AlgorithmOptions.start().flagEncoder(footEncoder).
+        AlgorithmOptions opts = AlgorithmOptions.start().
                 weighting(new ShortestWeighting(footEncoder)).build();
         GraphHopperStorage ghStorage = createGHStorage(encodingManager, Arrays.asList(opts.getWeighting()), false);
         initFootVsCar(ghStorage);
@@ -440,7 +440,7 @@ public void testRekeyBugOfIntBinHeap() {
         Path p = createAlgo(matrixGraph).calcPath(36, 91);
         assertEquals(12, p.calcNodes().size());
 
-        TIntList list = p.calcNodes();
+        IntIndexedContainer list = p.calcNodes();
         if (!Helper.createTList(36, 46, 56, 66, 76, 86, 85, 84, 94, 93, 92, 91).equals(list)
                 && !Helper.createTList(36, 46, 56, 66, 76, 86, 85, 84, 83, 82, 92, 91).equals(list)) {
             assertTrue("wrong locations: " + list.toString(), false);
@@ -529,7 +529,7 @@ public void testWithCoordinates() {
         updateDistancesFor(graph, 3, 0, 1);
         updateDistancesFor(graph, 4, 0, 2);
 
-        AlgorithmOptions opts = new AlgorithmOptions(DIJKSTRA_BI, carEncoder, weighting);
+        AlgorithmOptions opts = new AlgorithmOptions(DIJKSTRA_BI, weighting);
         RoutingAlgorithmFactory prepare = createFactory(graph, opts);
         Path p = prepare.createAlgo(getGraph(graph, opts.getWeighting()), opts).calcPath(4, 0);
         assertEquals(Helper.createTList(4, 1, 0), p.calcNodes());
@@ -592,7 +592,7 @@ public void testViaEdges_BiGraph() {
     public void testViaEdges_WithCoordinates() {
         GraphHopperStorage ghStorage = createTestStorage();
         Path p = calcPath(ghStorage, 0, 1, 2, 3);
-        assertEquals(Helper.createTList(9, 1, 2, 8), p.calcNodes());
+        assertEquals(Helper.createTList(8, 1, 2, 9), p.calcNodes());
         assertEquals(p.toString(), 56.7, p.getDistance(), .1);
     }
 
@@ -616,7 +616,7 @@ public void testViaEdges_SpecialCases() {
 
         // 0-1 to 3-4
         Path p = calcPathViaQuery(graph, 0.00010, 0.00001, 0, 0.00009);
-        assertEquals(Helper.createTList(6, 1, 2, 3, 5), p.calcNodes());
+        assertEquals(Helper.createTList(5, 1, 2, 3, 6), p.calcNodes());
         assertEquals(p.toString(), 26.81, p.getDistance(), .1);
 
         // overlapping edges: 2-3 and 3-2
@@ -636,7 +636,7 @@ public void testQueryGraphAndFastest() {
         GraphHopperStorage graph = createGHStorage(encodingManager, Arrays.asList(weighting), false);
         initDirectedAndDiffSpeed(graph, carEncoder);
         Path p = calcPathViaQuery(weighting, graph, 0.002, 0.0005, 0.0017, 0.0031);
-        assertEquals(Helper.createTList(9, 1, 5, 3, 8), p.calcNodes());
+        assertEquals(Helper.createTList(8, 1, 5, 3, 9), p.calcNodes());
         assertEquals(602.98, p.getDistance(), 1e-1);
     }
 
@@ -651,7 +651,7 @@ Path calcPathViaQuery(Weighting weighting, GraphHopperStorage ghStorage, double
         QueryResult to = index.findClosest(toLat, toLon, EdgeFilter.ALL_EDGES);
 
         // correct order for CH: in factory do prepare and afterwards wrap in query graph
-        AlgorithmOptions opts = AlgorithmOptions.start().flagEncoder(carEncoder).weighting(weighting).build();
+        AlgorithmOptions opts = AlgorithmOptions.start().weighting(weighting).build();
         RoutingAlgorithmFactory factory = createFactory(ghStorage, opts);
         QueryGraph qGraph = new QueryGraph(getGraph(ghStorage, weighting)).lookup(from, to);
         return factory.createAlgo(qGraph, opts).
@@ -695,8 +695,7 @@ QueryResult newQR(Graph graph, int node1, int node2) {
     public void testTwoWeightsPerEdge() {
         FlagEncoder encoder = new Bike2WeightFlagEncoder();
         EncodingManager em = new EncodingManager(encoder);
-        AlgorithmOptions opts = AlgorithmOptions.start().
-                flagEncoder(encoder).
+        AlgorithmOptions opts = AlgorithmOptions.start().                
                 weighting(new FastestWeighting(encoder)).build();
         GraphHopperStorage graph = createGHStorage(em, Arrays.asList(opts.getWeighting()), true);
         initEleGraph(graph);
@@ -764,6 +763,13 @@ else if (adj == 4)
                 return edgeState.getDistance() * 0.8;
             }
 
+            private final Weighting tmpW = new FastestWeighting(carEncoder);
+
+            @Override
+            public long calcMillis(EdgeIteratorState edgeState, boolean reverse, int prevOrNextEdgeId) {
+                return tmpW.calcMillis(edgeState, reverse, prevOrNextEdgeId);
+            }
+
             @Override
             public boolean matches(HintsMap map) {
                 throw new UnsupportedOperationException("Not supported");
@@ -775,14 +781,14 @@ public String getName() {
             }
         };
 
-        AlgorithmOptions opts = AlgorithmOptions.start().flagEncoder(carEncoder).weighting(defaultOpts.getWeighting()).build();
+        AlgorithmOptions opts = AlgorithmOptions.start().weighting(defaultOpts.getWeighting()).build();
         GraphHopperStorage graph = createGHStorage(encodingManager, Arrays.asList(opts.getWeighting()), true);
         initEleGraph(graph);
         Path p = createAlgo(graph, opts).calcPath(0, 10);
         // GHUtility.printEdgeInfo(graph, carEncoder);
         assertEquals(Helper.createTList(0, 4, 6, 10), p.calcNodes());
 
-        AlgorithmOptions fakeOpts = AlgorithmOptions.start().flagEncoder(carEncoder).weighting(fakeWeighting).build();
+        AlgorithmOptions fakeOpts = AlgorithmOptions.start().weighting(fakeWeighting).build();
         graph = createGHStorage(encodingManager, Arrays.asList(fakeOpts.getWeighting()), true);
         initEleGraph(graph);
         QueryResult from = newQR(graph, 3, 0);
@@ -791,7 +797,7 @@ public String getName() {
         RoutingAlgorithmFactory factory = createFactory(graph, fakeOpts);
         QueryGraph qGraph = new QueryGraph(getGraph(graph, fakeWeighting)).lookup(from, to);
         p = factory.createAlgo(qGraph, fakeOpts).calcPath(from.getClosestNode(), to.getClosestNode());
-        assertEquals(Helper.createTList(13, 0, 1, 2, 11, 7, 10, 12), p.calcNodes());
+        assertEquals(Helper.createTList(12, 0, 1, 2, 11, 7, 10, 13), p.calcNodes());
         assertEquals(37009621, p.getTime());
         assertEquals(616827, p.getDistance(), 1);
         assertEquals(493462, p.getWeight(), 1);
@@ -800,11 +806,11 @@ public String getName() {
     @Test
     public void testMultipleVehicles_issue548() {
         FastestWeighting footWeighting = new FastestWeighting(footEncoder);
-        AlgorithmOptions footOptions = AlgorithmOptions.start().flagEncoder(footEncoder).
+        AlgorithmOptions footOptions = AlgorithmOptions.start().
                 weighting(footWeighting).build();
 
         FastestWeighting carWeighting = new FastestWeighting(carEncoder);
-        AlgorithmOptions carOptions = AlgorithmOptions.start().flagEncoder(carEncoder).
+        AlgorithmOptions carOptions = AlgorithmOptions.start().
                 weighting(carWeighting).build();
 
         GraphHopperStorage ghStorage = createGHStorage(encodingManager,
diff --git a/core/src/test/java/com/graphhopper/routing/AlternativeRouteTest.java b/core/src/test/java/com/graphhopper/routing/AlternativeRouteTest.java
index 7dbac45f9c..93e69af915 100644
--- a/core/src/test/java/com/graphhopper/routing/AlternativeRouteTest.java
+++ b/core/src/test/java/com/graphhopper/routing/AlternativeRouteTest.java
@@ -107,14 +107,14 @@ public GraphHopperStorage createTestGraph(boolean fullGraph, EncodingManager tmp
     public void testCalcAlternatives() throws Exception {
         Weighting weighting = new FastestWeighting(carFE);
         GraphHopperStorage g = createTestGraph(true, em);
-        AlternativeRoute altDijkstra = new AlternativeRoute(g, carFE, weighting, traversalMode);
+        AlternativeRoute altDijkstra = new AlternativeRoute(g, weighting, traversalMode);
         altDijkstra.setMaxShareFactor(0.5);
         altDijkstra.setMaxWeightFactor(2);
         List<AlternativeRoute.AlternativeInfo> pathInfos = altDijkstra.calcAlternatives(5, 4);
         checkAlternatives(pathInfos);
         assertEquals(2, pathInfos.size());
 
-        DijkstraBidirectionRef dijkstra = new DijkstraBidirectionRef(g, carFE, weighting, traversalMode);
+        DijkstraBidirectionRef dijkstra = new DijkstraBidirectionRef(g, weighting, traversalMode);
         Path bestPath = dijkstra.calcPath(5, 4);
 
         Path bestAlt = pathInfos.get(0).getPath();
@@ -136,7 +136,7 @@ public void testCalcAlternatives() throws Exception {
     public void testCalcAlternatives2() throws Exception {
         Weighting weighting = new FastestWeighting(carFE);
         Graph g = createTestGraph(true, em);
-        AlternativeRoute altDijkstra = new AlternativeRoute(g, carFE, weighting, traversalMode);
+        AlternativeRoute altDijkstra = new AlternativeRoute(g, weighting, traversalMode);
         altDijkstra.setMaxPaths(3);
         altDijkstra.setMaxShareFactor(0.7);
         altDijkstra.setMinPlateauFactor(0.15);
@@ -177,7 +177,7 @@ public void testDisconnectedAreas() {
         updateDistancesFor(g, 20, 0.00, -0.01);
 
         Weighting weighting = new FastestWeighting(carFE);
-        AlternativeBidirSearch altDijkstra = new AlternativeBidirSearch(g, carFE, weighting, traversalMode, 1);
+        AlternativeBidirSearch altDijkstra = new AlternativeBidirSearch(g, weighting, traversalMode, 1);
         Path path = altDijkstra.calcPath(1, 20);
         assertFalse(path.isFound());
 
diff --git a/core/src/test/java/com/graphhopper/routing/DijkstraBidirectionRefTest.java b/core/src/test/java/com/graphhopper/routing/DijkstraBidirectionRefTest.java
index fdc8dc61cf..34ff8c1bdb 100644
--- a/core/src/test/java/com/graphhopper/routing/DijkstraBidirectionRefTest.java
+++ b/core/src/test/java/com/graphhopper/routing/DijkstraBidirectionRefTest.java
@@ -56,7 +56,7 @@ public RoutingAlgorithmFactory createFactory(GraphHopperStorage prepareGraph, Al
         return new RoutingAlgorithmFactory() {
             @Override
             public RoutingAlgorithm createAlgo(Graph g, AlgorithmOptions opts) {
-                return new DijkstraBidirectionRef(g, opts.getFlagEncoder(), opts.getWeighting(), traversalMode);
+                return new DijkstraBidirectionRef(g, opts.getWeighting(), traversalMode);
             }
         };
     }
diff --git a/core/src/test/java/com/graphhopper/routing/DijkstraOneToManyTest.java b/core/src/test/java/com/graphhopper/routing/DijkstraOneToManyTest.java
index 4e76b03e5a..be52e4a04a 100644
--- a/core/src/test/java/com/graphhopper/routing/DijkstraOneToManyTest.java
+++ b/core/src/test/java/com/graphhopper/routing/DijkstraOneToManyTest.java
@@ -89,7 +89,7 @@ public RoutingAlgorithmFactory createFactory(GraphHopperStorage prepareGraph, Al
         return new RoutingAlgorithmFactory() {
             @Override
             public RoutingAlgorithm createAlgo(Graph g, AlgorithmOptions opts) {
-                return new DijkstraOneToMany(g, opts.getFlagEncoder(), opts.getWeighting(), traversalMode);
+                return new DijkstraOneToMany(g, opts.getWeighting(), traversalMode);
             }
         };
     }
diff --git a/core/src/test/java/com/graphhopper/routing/DijkstraTest.java b/core/src/test/java/com/graphhopper/routing/DijkstraTest.java
index 1f3de7e22e..40f1b03e45 100644
--- a/core/src/test/java/com/graphhopper/routing/DijkstraTest.java
+++ b/core/src/test/java/com/graphhopper/routing/DijkstraTest.java
@@ -56,7 +56,7 @@ public RoutingAlgorithmFactory createFactory(GraphHopperStorage prepareGraph, Al
         return new RoutingAlgorithmFactory() {
             @Override
             public RoutingAlgorithm createAlgo(Graph g, AlgorithmOptions opts) {
-                return new Dijkstra(g, opts.getFlagEncoder(), opts.getWeighting(), traversalMode);
+                return new Dijkstra(g, opts.getWeighting(), traversalMode);
             }
         };
     }
diff --git a/core/src/test/java/com/graphhopper/routing/EdgeBasedRoutingAlgorithmTest.java b/core/src/test/java/com/graphhopper/routing/EdgeBasedRoutingAlgorithmTest.java
index fc9c19c70a..68f5ea6c46 100644
--- a/core/src/test/java/com/graphhopper/routing/EdgeBasedRoutingAlgorithmTest.java
+++ b/core/src/test/java/com/graphhopper/routing/EdgeBasedRoutingAlgorithmTest.java
@@ -126,7 +126,7 @@ private void initTurnRestrictions(Graph g, TurnCostExtension tcs, TurnCostEncode
     }
 
     Weighting createWeighting(FlagEncoder encoder, TurnCostExtension tcs, double turnCosts) {
-        return new TurnWeighting(new FastestWeighting(encoder), encoder, tcs).setDefaultUTurnCost(turnCosts);
+        return new TurnWeighting(new FastestWeighting(encoder), tcs).setDefaultUTurnCost(turnCosts);
     }
 
     @Test
@@ -136,7 +136,6 @@ public void testBasicTurnRestriction() {
         TurnCostExtension tcs = (TurnCostExtension) g.getExtension();
         initTurnRestrictions(g, tcs, carEncoder);
         Path p = createAlgo(g, AlgorithmOptions.start().
-                flagEncoder(carEncoder).
                 weighting(createWeighting(carEncoder, tcs, 40)).
                 traversalMode(TraversalMode.EDGE_BASED_2DIR).build()).
                 calcPath(5, 1);
@@ -144,14 +143,12 @@ public void testBasicTurnRestriction() {
 
         // test 7-6-5 and reverse
         p = createAlgo(g, AlgorithmOptions.start().
-                flagEncoder(carEncoder).
                 weighting(createWeighting(carEncoder, tcs, 40)).
                 traversalMode(TraversalMode.EDGE_BASED_1DIR).build()).
                 calcPath(5, 7);
         assertEquals(Helper.createTList(5, 6, 7), p.calcNodes());
 
         p = createAlgo(g, AlgorithmOptions.start().
-                flagEncoder(carEncoder).
                 weighting(createWeighting(carEncoder, tcs, 40)).
                 traversalMode(TraversalMode.EDGE_BASED_1DIR).build()).
                 calcPath(7, 5);
@@ -175,7 +172,6 @@ public void testUTurns() {
         tcs.addTurnInfo(getEdge(g, 7, 6).getEdge(), 6, getEdge(g, 6, 5).getEdge(), tflags);
         tcs.addTurnInfo(getEdge(g, 4, 3).getEdge(), 3, e3_6.getEdge(), tflags);
         AlgorithmOptions opts = AlgorithmOptions.start().
-                flagEncoder(carEncoder).
                 weighting(createWeighting(carEncoder, tcs, 50)).
                 traversalMode(TraversalMode.EDGE_BASED_2DIR_UTURN).build();
         Path p = createAlgo(g, opts).calcPath(7, 5);
@@ -184,7 +180,6 @@ public void testUTurns() {
 
         // no u-turn for 6-3
         opts = AlgorithmOptions.start().
-                flagEncoder(carEncoder).
                 weighting(createWeighting(carEncoder, tcs, 100)).
                 traversalMode(TraversalMode.EDGE_BASED_2DIR_UTURN).build();
         tcs.addTurnInfo(getEdge(g, 6, 3).getEdge(), 3, getEdge(g, 3, 6).getEdge(), tflags);
@@ -199,7 +194,6 @@ public void testBasicTurnCosts() {
         initGraph(g);
         TurnCostExtension tcs = (TurnCostExtension) g.getExtension();
         Path p = createAlgo(g, AlgorithmOptions.start().
-                flagEncoder(carEncoder).
                 weighting(createWeighting(carEncoder, tcs, 40)).
                 traversalMode(TraversalMode.EDGE_BASED_1DIR).build()).
                 calcPath(5, 1);
@@ -214,7 +208,6 @@ public void testBasicTurnCosts() {
         tcs.addTurnInfo(getEdge(g, 5, 2).getEdge(), 2, getEdge(g, 2, 3).getEdge(), tflags);
 
         p = createAlgo(g, AlgorithmOptions.start().
-                flagEncoder(carEncoder).
                 weighting(createWeighting(carEncoder, tcs, 40)).
                 traversalMode(TraversalMode.EDGE_BASED_1DIR).build()).
                 calcPath(5, 1);
diff --git a/core/src/test/java/com/graphhopper/routing/PathBidirRefTest.java b/core/src/test/java/com/graphhopper/routing/PathBidirRefTest.java
index 45209e8113..d465ac43e9 100644
--- a/core/src/test/java/com/graphhopper/routing/PathBidirRefTest.java
+++ b/core/src/test/java/com/graphhopper/routing/PathBidirRefTest.java
@@ -21,6 +21,7 @@
 import com.graphhopper.routing.util.EdgeFilter;
 import com.graphhopper.routing.util.EncodingManager;
 import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.weighting.FastestWeighting;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.GraphBuilder;
 import com.graphhopper.storage.SPTEntry;
@@ -47,7 +48,7 @@ Graph createGraph() {
     public void testExtract() {
         Graph g = createGraph();
         g.edge(1, 2, 10, true);
-        PathBidirRef pw = new PathBidirRef(g, carEncoder);
+        PathBidirRef pw = new PathBidirRef(g, new FastestWeighting(carEncoder));
         EdgeExplorer explorer = g.createEdgeExplorer(carOutEdges);
         EdgeIterator iter = explorer.setBaseNode(1);
         iter.next();
@@ -67,7 +68,7 @@ public void testExtract2() {
         EdgeExplorer explorer = g.createEdgeExplorer(carOutEdges);
         EdgeIterator iter = explorer.setBaseNode(1);
         iter.next();
-        PathBidirRef pw = new PathBidirRef(g, carEncoder);
+        PathBidirRef pw = new PathBidirRef(g, new FastestWeighting(carEncoder));
         pw.sptEntry = new SPTEntry(iter.getEdge(), 2, 10);
         pw.sptEntry.parent = new SPTEntry(EdgeIterator.NO_EDGE, 1, 0);
 
diff --git a/core/src/test/java/com/graphhopper/routing/PathTest.java b/core/src/test/java/com/graphhopper/routing/PathTest.java
index 85b7c07c65..867ff9b720 100644
--- a/core/src/test/java/com/graphhopper/routing/PathTest.java
+++ b/core/src/test/java/com/graphhopper/routing/PathTest.java
@@ -18,6 +18,7 @@
 package com.graphhopper.routing;
 
 import com.graphhopper.routing.util.*;
+import com.graphhopper.routing.weighting.FastestWeighting;
 import com.graphhopper.routing.weighting.ShortestWeighting;
 import com.graphhopper.storage.*;
 import com.graphhopper.util.*;
@@ -42,7 +43,7 @@
     @Test
     public void testFound() {
         GraphHopperStorage g = new GraphBuilder(carManager).create();
-        Path p = new Path(g, encoder);
+        Path p = new Path(g, new FastestWeighting(encoder));
         assertFalse(p.isFound());
         assertEquals(0, p.getDistance(), 1e-7);
         assertEquals(0, p.calcNodes().size());
@@ -53,10 +54,12 @@ public void testFound() {
     public void testTime() {
         FlagEncoder tmpEnc = new Bike2WeightFlagEncoder();
         GraphHopperStorage g = new GraphBuilder(new EncodingManager(tmpEnc)).create();
-        Path p = new Path(g, tmpEnc);
+        Path p = new Path(g, new FastestWeighting(tmpEnc));
         long flags = tmpEnc.setSpeed(tmpEnc.setReverseSpeed(tmpEnc.setAccess(0, true, true), 10), 15);
-        assertEquals(375 * 60 * 1000, p.calcMillis(100000, flags, false));
-        assertEquals(600 * 60 * 1000, p.calcMillis(100000, flags, true));
+        EdgeIteratorState edge = GHUtility.createMockedEdgeIteratorState(100000, flags);
+                
+        assertEquals(375 * 60 * 1000, p.calcMillis(edge, false));
+        assertEquals(600 * 60 * 1000, p.calcMillis(edge, true));
 
         g.close();
     }
@@ -74,7 +77,7 @@ public void testWayList() {
         EdgeIteratorState edge2 = g.edge(2, 1).setDistance(2000).setFlags(encoder.setProperties(50, true, true));
         edge2.setWayGeometry(Helper.createPointList(11, 1, 10, 1));
 
-        Path path = new Path(g, encoder);
+        Path path = new Path(g, new FastestWeighting(encoder));
         SPTEntry e1 = new SPTEntry(edge2.getEdge(), 2, 1);
         e1.parent = new SPTEntry(edge1.getEdge(), 1, 1);
         e1.parent.parent = new SPTEntry(-1, 0, 1);
@@ -100,7 +103,7 @@ public void testWayList() {
 
         // force minor change for instructions
         edge2.setName("2");
-        path = new Path(g, encoder);
+        path = new Path(g, new FastestWeighting(encoder));
         e1 = new SPTEntry(edge2.getEdge(), 2, 1);
         e1.parent = new SPTEntry(edge1.getEdge(), 1, 1);
         e1.parent.parent = new SPTEntry(-1, 0, 1);
@@ -124,7 +127,7 @@ public void testWayList() {
         assertEquals(path.calcPoints().size() - 1, lastIndex);
 
         // now reverse order
-        path = new Path(g, encoder);
+        path = new Path(g, new FastestWeighting(encoder));
         e1 = new SPTEntry(edge1.getEdge(), 0, 1);
         e1.parent = new SPTEntry(edge2.getEdge(), 1, 1);
         e1.parent.parent = new SPTEntry(-1, 2, 1);
@@ -173,7 +176,7 @@ public void testFindInstruction() {
         edge4.setWayGeometry(Helper.createPointList());
         edge4.setName("Street 4");
 
-        Path path = new Path(g, encoder);
+        Path path = new Path(g, new FastestWeighting(encoder));
         SPTEntry e1 = new SPTEntry(edge4.getEdge(), 4, 1);
         e1.parent = new SPTEntry(edge3.getEdge(), 3, 1);
         e1.parent.parent = new SPTEntry(edge2.getEdge(), 2, 1);
@@ -209,7 +212,7 @@ public void testFindInstruction() {
     @Test
     public void testCalcInstructionsRoundabout() {
         for (FlagEncoder encoder : mixedEncoders.fetchEdgeEncoders()) {
-            Path p = new Dijkstra(roundaboutGraph.g, encoder, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
+            Path p = new Dijkstra(roundaboutGraph.g, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
                     .calcPath(1, 8);
             assertTrue(p.isFound());
             InstructionList wayList = p.calcInstructions(tr);
@@ -225,7 +228,7 @@ public void testCalcInstructionsRoundabout() {
             assertEquals(delta, instr.getTurnAngle(), 0.01);
 
             // case of continuing a street through a roundabout
-            p = new Dijkstra(roundaboutGraph.g, encoder, new ShortestWeighting(encoder), TraversalMode.NODE_BASED).
+            p = new Dijkstra(roundaboutGraph.g, new ShortestWeighting(encoder), TraversalMode.NODE_BASED).
                     calcPath(1, 7);
             wayList = p.calcInstructions(tr);
             tmpList = pick("text", wayList.createJson());
@@ -245,7 +248,7 @@ public void testCalcInstructionsRoundabout() {
      */
     @Test
     public void testCalcInstructionsRoundaboutBegin() {
-        Path p = new Dijkstra(roundaboutGraph.g, encoder, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
+        Path p = new Dijkstra(roundaboutGraph.g, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
                 .calcPath(2, 8);
         assertTrue(p.isFound());
         InstructionList wayList = p.calcInstructions(tr);
@@ -261,7 +264,7 @@ public void testCalcInstructionsRoundaboutBegin() {
     @Test
     public void testCalcInstructionsRoundaboutDirectExit() {
         roundaboutGraph.inverse3to9();
-        Path p = new Dijkstra(roundaboutGraph.g, encoder, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
+        Path p = new Dijkstra(roundaboutGraph.g, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
                 .calcPath(6, 8);
         assertTrue(p.isFound());
         InstructionList wayList = p.calcInstructions(tr);
@@ -279,7 +282,7 @@ public void testCalcInstructionsRoundaboutDirectExit() {
     @Test
     public void testCalcInstructionsRoundabout2() {
         roundaboutGraph.inverse3to6();
-        Path p = new Dijkstra(roundaboutGraph.g, encoder, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
+        Path p = new Dijkstra(roundaboutGraph.g, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
                 .calcPath(1, 8);
         assertTrue(p.isFound());
         InstructionList wayList = p.calcInstructions(tr);
@@ -349,7 +352,7 @@ public void testCalcInstructionsRoundaboutIssue353() {
         g.edge(5, 8, 5, true).setName("5-8");
         g.edge(3, 6, 5, true).setName("3-6");
 
-        Path p = new Dijkstra(g, encoder, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
+        Path p = new Dijkstra(g, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
                 .calcPath(6, 11);
         assertTrue(p.isFound());
         InstructionList wayList = p.calcInstructions(tr);
@@ -365,7 +368,7 @@ public void testCalcInstructionsRoundaboutIssue353() {
     @Test
     public void testCalcInstructionsRoundaboutClockwise() {
         roundaboutGraph.setRoundabout(true);
-        Path p = new Dijkstra(roundaboutGraph.g, encoder, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
+        Path p = new Dijkstra(roundaboutGraph.g, new ShortestWeighting(encoder), TraversalMode.NODE_BASED)
                 .calcPath(1, 8);
         assertTrue(p.isFound());
         InstructionList wayList = p.calcInstructions(tr);
diff --git a/core/src/test/java/com/graphhopper/routing/QueryGraphTest.java b/core/src/test/java/com/graphhopper/routing/QueryGraphTest.java
index 193d21686d..4e6164fdf7 100644
--- a/core/src/test/java/com/graphhopper/routing/QueryGraphTest.java
+++ b/core/src/test/java/com/graphhopper/routing/QueryGraphTest.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.routing;
 
+import com.carrotsearch.hppc.IntObjectMap;
 import com.graphhopper.routing.util.*;
 import com.graphhopper.routing.weighting.FastestWeighting;
 import com.graphhopper.routing.weighting.TurnWeighting;
@@ -24,12 +25,13 @@
 import com.graphhopper.storage.index.QueryResult;
 import com.graphhopper.util.*;
 import com.graphhopper.util.shapes.GHPoint;
-import gnu.trove.map.TIntObjectMap;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 
 import java.util.Arrays;
+import java.util.HashSet;
+import java.util.LinkedHashSet;
 
 import static com.graphhopper.storage.index.QueryResult.Position.*;
 import static org.junit.Assert.*;
@@ -152,7 +154,7 @@ public void testFillVirtualEdges() {
         QueryGraph queryGraph = new QueryGraph(g) {
 
             @Override
-            void fillVirtualEdges(TIntObjectMap<VirtualEdgeIterator> node2Edge, int towerNode, EdgeExplorer mainExpl) {
+            void fillVirtualEdges(IntObjectMap<VirtualEdgeIterator> node2Edge, int towerNode, EdgeExplorer mainExpl) {
                 super.fillVirtualEdges(node2Edge, towerNode, mainExpl);
                 // ignore nodes should include baseNode == 1
                 if (towerNode == 3)
@@ -502,7 +504,7 @@ public void testTurnCostsProperlyPropagated_Issue282() {
 
         QueryGraph qGraph = new QueryGraph(graphWithTurnCosts);
         FastestWeighting weighting = new FastestWeighting(encoder);
-        TurnWeighting turnWeighting = new TurnWeighting(weighting, encoder, (TurnCostExtension) qGraph.getExtension());
+        TurnWeighting turnWeighting = new TurnWeighting(weighting, (TurnCostExtension) qGraph.getExtension());
 
         assertEquals(0, turnWeighting.calcTurnWeight(edge0.getEdge(), 1, edge1.getEdge()), .1);
 
@@ -602,7 +604,7 @@ public void testEnforceHeading() {
     }
 
     @Test
-    public void testEnforceHeadingByEdgeId() {
+    public void testunfavorVirtualEdgePair() {
 
         initHorseshoeGraph(g);
         EdgeIteratorState edge = GHUtility.getEdge(g, 0, 1);
@@ -613,22 +615,21 @@ public void testEnforceHeadingByEdgeId() {
         queryGraph.lookup(Arrays.asList(qr));
 
         // enforce coming in north
-        queryGraph.enforceHeadingByEdgeId(2, 1, false);
+        queryGraph.unfavorVirtualEdgePair(2, 1);
         // test penalized south
-        boolean expect = true;
         VirtualEdgeIteratorState incomingEdge = (VirtualEdgeIteratorState) queryGraph.getEdgeIteratorState(1, 2);
-
         VirtualEdgeIteratorState incomingEdgeReverse = (VirtualEdgeIteratorState) queryGraph.getEdgeIteratorState(1, incomingEdge.getBaseNode());
-        // expect incoming edge in reverse direction to be avoided
+        boolean expect = true;  // expect incoming and reverse incoming edge to be avoided
         assertEquals(expect, incomingEdge.getBool(EdgeIteratorState.K_UNFAVORED_EDGE, !expect));
-        // expect reverse incoming edge to be avoided
         assertEquals(expect, incomingEdgeReverse.getBool(EdgeIteratorState.K_UNFAVORED_EDGE, !expect));
+        assertEquals(new LinkedHashSet<>(Arrays.asList(incomingEdge, incomingEdgeReverse)),
+                queryGraph.getUnfavoredVirtualEdges());
 
         queryGraph.clearUnfavoredStatus();
-        expect = false;
+        expect = false; // expect incoming and reverse incoming edge not to be avoided
         assertEquals(expect, incomingEdge.getBool(EdgeIteratorState.K_UNFAVORED_EDGE, !expect));
-        // expect reverse incoming edge to be unfavored
         assertEquals(expect, incomingEdgeReverse.getBool(EdgeIteratorState.K_UNFAVORED_EDGE, !expect));
+        assertEquals(new LinkedHashSet<>(), queryGraph.getUnfavoredVirtualEdges());
     }
 
     @Test
diff --git a/core/src/test/java/com/graphhopper/routing/RoutingAlgorithmIT.java b/core/src/test/java/com/graphhopper/routing/RoutingAlgorithmIT.java
index 9bd37f8109..5d9733de34 100644
--- a/core/src/test/java/com/graphhopper/routing/RoutingAlgorithmIT.java
+++ b/core/src/test/java/com/graphhopper/routing/RoutingAlgorithmIT.java
@@ -17,17 +17,21 @@
  */
 package com.graphhopper.routing;
 
+import com.graphhopper.GraphHopper;
 import com.graphhopper.reader.PrinctonReader;
-import com.graphhopper.routing.ch.PrepareContractionHierarchies;
 import com.graphhopper.routing.util.EncodingManager;
 import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.util.HintsMap;
 import com.graphhopper.routing.util.TestAlgoCollector.AlgoHelperEntry;
 import com.graphhopper.routing.util.TraversalMode;
-import com.graphhopper.routing.weighting.ShortestWeighting;
 import com.graphhopper.routing.weighting.Weighting;
-import com.graphhopper.storage.*;
+import com.graphhopper.storage.CHGraph;
+import com.graphhopper.storage.Directory;
+import com.graphhopper.storage.GraphBuilder;
+import com.graphhopper.storage.GraphHopperStorage;
 import com.graphhopper.storage.index.LocationIndex;
 import com.graphhopper.storage.index.LocationIndexTree;
+import com.graphhopper.util.Parameters;
 import com.graphhopper.util.StopWatch;
 import org.junit.Test;
 
@@ -43,51 +47,67 @@
 
 /**
  * Try algorithms, indices and graph storages with real data
- * <p>
  *
  * @author Peter Karich
  */
 public class RoutingAlgorithmIT {
-    public static List<AlgoHelperEntry> createAlgos(GraphHopperStorage ghStorage,
-                                                    LocationIndex idx, final FlagEncoder encoder, boolean withCh,
-                                                    final TraversalMode tMode, final Weighting weighting,
-                                                    final EncodingManager manager) {
-        List<AlgoHelperEntry> prepare = new ArrayList<AlgoHelperEntry>();
-        prepare.add(new AlgoHelperEntry(ghStorage, ghStorage, new AlgorithmOptions(ASTAR, encoder, weighting, tMode), idx));
+    public static List<AlgoHelperEntry> createAlgos(final GraphHopper hopper, final HintsMap hints, TraversalMode tMode) {
+        GraphHopperStorage ghStorage = hopper.getGraphHopperStorage();
+        LocationIndex idx = hopper.getLocationIndex();
+
+        String addStr = "";
+        if (tMode.isEdgeBased())
+            addStr = "turn|";
+
+        FlagEncoder encoder = hopper.getEncodingManager().getEncoder(hints.getVehicle());
+        Weighting weighting = hopper.createWeighting(hints, encoder, hopper.getGraphHopperStorage());
+
+        HintsMap defaultHints = new HintsMap().put(Parameters.CH.DISABLE, true)
+                .setVehicle(hints.getVehicle()).setWeighting(hints.getWeighting());
+
+        AlgorithmOptions defaultOpts = AlgorithmOptions.start(new AlgorithmOptions("", weighting, tMode)).hints(defaultHints).build();
+
+        List<AlgoHelperEntry> prepare = new ArrayList<>();
+        prepare.add(new AlgoHelperEntry(ghStorage, AlgorithmOptions.start(defaultOpts).algorithm(ASTAR).build(), idx, "astar|beeline|" + addStr + weighting));
         // later: include dijkstraOneToMany
-        prepare.add(new AlgoHelperEntry(ghStorage, ghStorage, new AlgorithmOptions(DIJKSTRA, encoder, weighting, tMode), idx));
+        prepare.add(new AlgoHelperEntry(ghStorage, AlgorithmOptions.start(defaultOpts).algorithm(DIJKSTRA).build(), idx, "dijkstra|" + addStr + weighting));
 
-        final AlgorithmOptions astarbiOpts = new AlgorithmOptions(ASTAR_BI, encoder, weighting, tMode);
+        AlgorithmOptions astarbiOpts = AlgorithmOptions.start(defaultOpts).algorithm(ASTAR_BI).build();
         astarbiOpts.getHints().put(ASTAR_BI + ".approximation", "BeelineSimplification");
-        final AlgorithmOptions dijkstrabiOpts = new AlgorithmOptions(DIJKSTRA_BI, encoder, weighting, tMode);
-        prepare.add(new AlgoHelperEntry(ghStorage, ghStorage, astarbiOpts, idx));
-        prepare.add(new AlgoHelperEntry(ghStorage, ghStorage, dijkstrabiOpts, idx));
-
-        if (withCh) {
-            GraphHopperStorage storageCopy = new GraphBuilder(manager).
-                    set3D(ghStorage.getNodeAccess().is3D()).setCHGraph(weighting).
-                    create();
-            ghStorage.copyTo(storageCopy);
-            storageCopy.freeze();
-            final CHGraph graphCH = storageCopy.getGraph(CHGraph.class, weighting);
-            final PrepareContractionHierarchies prepareCH = new PrepareContractionHierarchies(
-                    new GHDirectory("", DAType.RAM_INT), storageCopy, graphCH, encoder, weighting, tMode);
-            prepareCH.doWork();
-            LocationIndex idxCH = new LocationIndexTree(storageCopy, new RAMDirectory()).prepareIndex();
-            prepare.add(new AlgoHelperEntry(graphCH, storageCopy, dijkstrabiOpts, idxCH) {
+        AlgorithmOptions dijkstrabiOpts = AlgorithmOptions.start(defaultOpts).algorithm(DIJKSTRA_BI).build();
+        prepare.add(new AlgoHelperEntry(ghStorage, astarbiOpts, idx, "astarbi|beeline|" + addStr + weighting));
+        prepare.add(new AlgoHelperEntry(ghStorage, dijkstrabiOpts, idx, "dijkstrabi|" + addStr + weighting));
+
+        // add additional preparations if CH preparation are enabled
+        if (hopper.getCHFactoryDecorator().isEnabled()) {
+            final HintsMap chHints = new HintsMap(defaultHints).put(Parameters.CH.DISABLE, false);
+            Weighting pickedWeighting = null;
+            for (Weighting tmpWeighting : hopper.getCHFactoryDecorator().getWeightings()) {
+                if (tmpWeighting.equals(weighting)) {
+                    pickedWeighting = tmpWeighting;
+                    break;
+                }
+            }
+            if (pickedWeighting == null)
+                throw new IllegalStateException("Didn't find weighting " + hints.getWeighting() + " in " + hopper.getCHFactoryDecorator().getWeightings());
+
+            prepare.add(new AlgoHelperEntry(ghStorage.getGraph(CHGraph.class, pickedWeighting),
+                    AlgorithmOptions.start(dijkstrabiOpts).hints(chHints).build(), idx, "dijkstrabi|ch|prepare|" + hints.getWeighting()) {
                 @Override
-                public RoutingAlgorithm createAlgo(Graph qGraph) {
-                    return prepareCH.createAlgo(qGraph, dijkstrabiOpts);
+                public RoutingAlgorithmFactory createRoutingFactory() {
+                    return hopper.getAlgorithmFactory(chHints);
                 }
             });
 
-            prepare.add(new AlgoHelperEntry(graphCH, storageCopy, astarbiOpts, idxCH) {
+            prepare.add(new AlgoHelperEntry(ghStorage.getGraph(CHGraph.class, pickedWeighting),
+                    AlgorithmOptions.start(astarbiOpts).hints(chHints).build(), idx, "astarbi|ch|prepare|" + hints.getWeighting()) {
                 @Override
-                public RoutingAlgorithm createAlgo(Graph qGraph) {
-                    return prepareCH.createAlgo(qGraph, astarbiOpts);
+                public RoutingAlgorithmFactory createRoutingFactory() {
+                    return hopper.getAlgorithmFactory(chHints);
                 }
             });
         }
+
         return prepare;
     }
 
@@ -97,20 +117,32 @@ public void testPerformance() throws IOException {
         int noJvmWarming = N / 4;
 
         Random rand = new Random(0);
-        EncodingManager eManager = new EncodingManager("car");
-        FlagEncoder encoder = eManager.getEncoder("car");
-        GraphHopperStorage graph = new GraphBuilder(eManager).create();
+        final EncodingManager eManager = new EncodingManager("car");
+        final GraphHopperStorage graph = new GraphBuilder(eManager).create();
 
         String bigFile = "10000EWD.txt.gz";
         new PrinctonReader(graph).setStream(new GZIPInputStream(PrinctonReader.class.getResourceAsStream(bigFile))).read();
-        Collection<AlgoHelperEntry> prepares = createAlgos(graph, null, encoder, false, TraversalMode.NODE_BASED,
-                new ShortestWeighting(encoder), eManager);
+        GraphHopper hopper = new GraphHopper() {
+            {
+                setCHEnabled(false);
+                setEncodingManager(eManager);
+                loadGraph(graph);
+            }
+
+            @Override
+            protected LocationIndex createLocationIndex(Directory dir) {
+                return new LocationIndexTree(graph, dir);
+            }
+        };
+
+        Collection<AlgoHelperEntry> prepares = createAlgos(hopper, new HintsMap().setWeighting("shortest").setVehicle("car"), TraversalMode.NODE_BASED);
+
         for (AlgoHelperEntry entry : prepares) {
             StopWatch sw = new StopWatch();
             for (int i = 0; i < N; i++) {
                 int node1 = Math.abs(rand.nextInt(graph.getNodes()));
                 int node2 = Math.abs(rand.nextInt(graph.getNodes()));
-                RoutingAlgorithm d = entry.createAlgo(graph);
+                RoutingAlgorithm d = entry.createRoutingFactory().createAlgo(graph, entry.getAlgorithmOptions());
                 if (i >= noJvmWarming)
                     sw.start();
 
diff --git a/core/src/test/java/com/graphhopper/routing/ch/DijkstraBidirectionCHTest.java b/core/src/test/java/com/graphhopper/routing/ch/DijkstraBidirectionCHTest.java
index eee4e46e22..f50a5b37fa 100644
--- a/core/src/test/java/com/graphhopper/routing/ch/DijkstraBidirectionCHTest.java
+++ b/core/src/test/java/com/graphhopper/routing/ch/DijkstraBidirectionCHTest.java
@@ -59,7 +59,7 @@ protected GraphHopperStorage createGHStorage(EncodingManager em,
     public RoutingAlgorithmFactory createFactory(GraphHopperStorage ghStorage, AlgorithmOptions opts) {
         PrepareContractionHierarchies ch = new PrepareContractionHierarchies(new GHDirectory("", DAType.RAM_INT),
                 ghStorage, getGraph(ghStorage, opts.getWeighting()),
-                opts.getFlagEncoder(), opts.getWeighting(), TraversalMode.NODE_BASED);
+                opts.getWeighting(), TraversalMode.NODE_BASED);
         ch.doWork();
         return ch;
     }
@@ -104,9 +104,9 @@ public void testPathRecursiveUnpacking() {
         g2.setLevel(7, 6);
         g2.setLevel(0, 7);
 
-        AlgorithmOptions opts = new AlgorithmOptions(Parameters.Algorithms.DIJKSTRA_BI, encoder, weighting);
+        AlgorithmOptions opts = new AlgorithmOptions(Parameters.Algorithms.DIJKSTRA_BI, weighting);
         Path p = new PrepareContractionHierarchies(new GHDirectory("", DAType.RAM_INT),
-                ghStorage, g2, encoder, weighting, TraversalMode.NODE_BASED).
+                ghStorage, g2, weighting, TraversalMode.NODE_BASED).
                 createAlgo(g2, opts).calcPath(0, 7);
 
         assertEquals(Helper.createTList(0, 2, 5, 7), p.calcNodes());
@@ -118,7 +118,7 @@ public void testPathRecursiveUnpacking() {
     public void testBaseGraph() {
         CarFlagEncoder carFE = new CarFlagEncoder();
         EncodingManager em = new EncodingManager(carFE);
-        AlgorithmOptions opts = AlgorithmOptions.start().flagEncoder(carFE).
+        AlgorithmOptions opts = AlgorithmOptions.start().
                 weighting(new ShortestWeighting(carFE)).build();
         GraphHopperStorage ghStorage = createGHStorage(em,
                 Arrays.asList(opts.getWeighting()), false);
@@ -137,9 +137,9 @@ public void testBaseGraph() {
 
     @Test
     public void testBaseGraphMultipleVehicles() {
-        AlgorithmOptions footOptions = AlgorithmOptions.start().flagEncoder(footEncoder).
+        AlgorithmOptions footOptions = AlgorithmOptions.start().
                 weighting(new FastestWeighting(footEncoder)).build();
-        AlgorithmOptions carOptions = AlgorithmOptions.start().flagEncoder(carEncoder).
+        AlgorithmOptions carOptions = AlgorithmOptions.start().
                 weighting(new FastestWeighting(carEncoder)).build();
 
         GraphHopperStorage g = createGHStorage(encodingManager,
diff --git a/core/src/test/java/com/graphhopper/routing/ch/PrepareContractionHierarchiesTest.java b/core/src/test/java/com/graphhopper/routing/ch/PrepareContractionHierarchiesTest.java
index 1fe97d2992..52e9ac26ab 100644
--- a/core/src/test/java/com/graphhopper/routing/ch/PrepareContractionHierarchiesTest.java
+++ b/core/src/test/java/com/graphhopper/routing/ch/PrepareContractionHierarchiesTest.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.routing.ch;
 
+import com.carrotsearch.hppc.IntIndexedContainer;
 import com.graphhopper.routing.*;
 import com.graphhopper.routing.ch.PrepareContractionHierarchies.Shortcut;
 import com.graphhopper.routing.util.BikeFlagEncoder;
@@ -28,7 +29,6 @@
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.*;
 import com.graphhopper.util.*;
-import gnu.trove.list.TIntList;
 import org.junit.Before;
 import org.junit.Test;
 
@@ -155,11 +155,11 @@ public void setUp() {
     @Test
     public void testShortestPathSkipNode() {
         GraphHopperStorage g = createExampleGraph();
-        double normalDist = new Dijkstra(g, carEncoder, weighting, tMode).calcPath(4, 2).getDistance();
-        DijkstraOneToMany algo = new DijkstraOneToMany(g, carEncoder, weighting, tMode);
+        double normalDist = new Dijkstra(g, weighting, tMode).calcPath(4, 2).getDistance();
+        DijkstraOneToMany algo = new DijkstraOneToMany(g, weighting, tMode);
         CHGraph lg = g.getGraph(CHGraph.class);
         PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg,
-                carEncoder, weighting, tMode);
+                weighting, tMode);
         prepare.initFromGraph().prepareNodes();
         algo.setEdgeFilter(new PrepareContractionHierarchies.IgnoreNodeFilter(lg, g.getNodes() + 1).setAvoidNode(3));
         algo.setWeightLimit(100);
@@ -176,10 +176,10 @@ public void testShortestPathSkipNode() {
     public void testShortestPathSkipNode2() {
         GraphHopperStorage g = createExampleGraph();
         CHGraph lg = g.getGraph(CHGraph.class);
-        double normalDist = new Dijkstra(g, carEncoder, weighting, tMode).calcPath(4, 2).getDistance();
+        double normalDist = new Dijkstra(g, weighting, tMode).calcPath(4, 2).getDistance();
         assertEquals(3, normalDist, 1e-5);
-        DijkstraOneToMany algo = new DijkstraOneToMany(g, carEncoder, weighting, tMode);
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        DijkstraOneToMany algo = new DijkstraOneToMany(g, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.initFromGraph().prepareNodes();
         algo.setEdgeFilter(new PrepareContractionHierarchies.IgnoreNodeFilter(lg, g.getNodes() + 1).setAvoidNode(3));
         algo.setWeightLimit(10);
@@ -195,8 +195,8 @@ public void testShortestPathLimit() {
         GraphHopperStorage g = createExampleGraph();
         CHGraph lg = g.getGraph(CHGraph.class);
 
-        DijkstraOneToMany algo = new DijkstraOneToMany(g, carEncoder, weighting, tMode);
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        DijkstraOneToMany algo = new DijkstraOneToMany(g, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.initFromGraph().prepareNodes();
         algo.setEdgeFilter(new PrepareContractionHierarchies.IgnoreNodeFilter(lg, g.getNodes() + 1).setAvoidNode(0));
         algo.setWeightLimit(2);
@@ -210,7 +210,7 @@ public void testAddShortcuts() {
         GraphHopperStorage g = createExampleGraph();
         CHGraph lg = g.getGraph(CHGraph.class);
         int old = lg.getAllEdges().getMaxId();
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.doWork();
         assertEquals(old + 1, lg.getAllEdges().getMaxId());
     }
@@ -221,7 +221,7 @@ public void testMoreComplexGraph() {
         CHGraph lg = g.getGraph(CHGraph.class);
         initShortcutsGraph(lg);
         int oldCount = g.getAllEdges().getMaxId();
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.doWork();
         assertEquals(oldCount, g.getAllEdges().getMaxId());
         assertEquals(oldCount + 7, lg.getAllEdges().getMaxId());
@@ -240,11 +240,11 @@ public void testDirectedGraph() {
         g.freeze();
         int oldCount = GHUtility.count(lg.getAllEdges());
         assertEquals(6, oldCount);
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.doWork();
         assertEquals(2, prepare.getShortcuts());
         assertEquals(oldCount + 2, GHUtility.count(lg.getAllEdges()));
-        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, carEncoder, weighting, tMode));
+        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, weighting, tMode));
         Path p = algo.calcPath(4, 2);
         assertEquals(3, p.getDistance(), 1e-6);
         assertEquals(Helper.createTList(4, 3, 5, 2), p.calcNodes());
@@ -257,7 +257,7 @@ public void testDirectedGraph2() {
         initDirected2(g);
         int oldCount = GHUtility.count(g.getAllEdges());
         assertEquals(19, oldCount);
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.doWork();
         // PrepareTowerNodesShortcutsTest.printEdges(g);
         assertEquals(oldCount, g.getAllEdges().getMaxId());
@@ -266,7 +266,7 @@ public void testDirectedGraph2() {
         assertEquals(9, prepare.getShortcuts());
         assertEquals(oldCount + 9, lg.getAllEdges().getMaxId());
         assertEquals(oldCount + 9, GHUtility.count(lg.getAllEdges()));
-        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, carEncoder, weighting, tMode));
+        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, weighting, tMode));
         Path p = algo.calcPath(0, 10);
         assertEquals(10, p.getDistance(), 1e-6);
         assertEquals(Helper.createTList(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10), p.calcNodes());
@@ -295,7 +295,7 @@ public void testDirectedGraph3() {
         g.edge(3, 6, 2, true);
         g.edge(3, 7, 2, true);
 
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.initFromGraph();
         prepare.prepareNodes();
 
@@ -380,11 +380,11 @@ public void testRoundaboutUnpacking() {
         CHGraph lg = g.getGraph(CHGraph.class);
         initRoundaboutGraph(g);
         int oldCount = g.getAllEdges().getMaxId();
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.doWork();
         assertEquals(oldCount, g.getAllEdges().getMaxId());
         assertEquals(oldCount + 23, lg.getAllEdges().getMaxId());
-        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, carEncoder, weighting, tMode));
+        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, weighting, tMode));
         Path p = algo.calcPath(4, 7);
         assertEquals(Helper.createTList(4, 5, 6, 7), p.calcNodes());
     }
@@ -403,7 +403,7 @@ public void testFindShortcuts_Roundabout() {
         ghStorage.freeze();
 
         PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, ghStorage, lg,
-                carEncoder, weighting, tMode);
+                weighting, tMode);
         CHEdgeIteratorState tmp = lg.shortcut(1, 4);
         tmp.setFlags(PrepareEncoder.getScDirMask());
         tmp.setWeight(2);
@@ -491,8 +491,8 @@ public void testUnpackingOrder() {
         GraphHopperStorage ghStorage = createGHStorage();
         CHGraph lg = ghStorage.getGraph(CHGraph.class);
         initUnpackingGraph(ghStorage, lg, weighting);
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, ghStorage, lg, carEncoder, weighting, tMode);
-        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, carEncoder, weighting, tMode));
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, ghStorage, lg, weighting, tMode);
+        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, weighting, tMode));
         Path p = algo.calcPath(10, 6);
         assertEquals(7, p.getDistance(), 1e-5);
         assertEquals(Helper.createTList(10, 0, 1, 2, 3, 4, 5, 6), p.calcNodes());
@@ -505,8 +505,8 @@ public void testUnpackingOrder_Fastest() {
         Weighting w = new FastestWeighting(carEncoder);
         initUnpackingGraph(ghStorage, lg, w);
 
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, ghStorage, lg, carEncoder, weighting, tMode);
-        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, carEncoder, weighting, tMode));
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, ghStorage, lg, weighting, tMode);
+        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, weighting, tMode));
         Path p = algo.calcPath(10, 6);
         assertEquals(7, p.getDistance(), 1e-1);
         assertEquals(Helper.createTList(10, 0, 1, 2, 3, 4, 5, 6), p.calcNodes());
@@ -523,7 +523,7 @@ public void testCircleBug() {
         g.edge(0, 1, 4, true);
         g.edge(0, 2, 10, true);
         g.edge(0, 3, 10, true);
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.doWork();
         assertEquals(0, prepare.getShortcuts());
     }
@@ -547,7 +547,7 @@ public void testBug178() {
         g.edge(3, 4, 1, true);
         g.edge(6, 3, 1, true);
 
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, carEncoder, weighting, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, g, lg, weighting, tMode);
         prepare.doWork();
         assertEquals(2, prepare.getShortcuts());
     }
@@ -635,12 +635,12 @@ public void testMultiplePreparationsDifferentView() {
         checkPath(ghStorage, bikeWeighting, 9, 5, Helper.createTList(3, 10, 14, 16, 13, 12));
     }
 
-    void checkPath(GraphHopperStorage ghStorage, Weighting w, int expShortcuts, double expDistance, TIntList expNodes) {
+    void checkPath(GraphHopperStorage ghStorage, Weighting w, int expShortcuts, double expDistance, IntIndexedContainer expNodes) {
         CHGraph lg = ghStorage.getGraph(CHGraph.class, w);
-        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, ghStorage, lg, w.getFlagEncoder(), w, tMode);
+        PrepareContractionHierarchies prepare = new PrepareContractionHierarchies(dir, ghStorage, lg, w, tMode);
         prepare.doWork();
         assertEquals(w.toString(), expShortcuts, prepare.getShortcuts());
-        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, w.getFlagEncoder(), w, tMode));
+        RoutingAlgorithm algo = prepare.createAlgo(lg, new AlgorithmOptions(DIJKSTRA_BI, w, tMode));
         Path p = algo.calcPath(3, 12);
         assertEquals(w.toString(), expDistance, p.getDistance(), 1e-5);
         assertEquals(w.toString(), expNodes, p.calcNodes());
diff --git a/core/src/test/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworksTest.java b/core/src/test/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworksTest.java
index e4cf85c8bb..291af33595 100644
--- a/core/src/test/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworksTest.java
+++ b/core/src/test/java/com/graphhopper/routing/subnetwork/PrepareRoutingSubnetworksTest.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.routing.subnetwork;
 
+import com.carrotsearch.hppc.IntArrayList;
 import com.graphhopper.coll.GHBitSetImpl;
 import com.graphhopper.routing.subnetwork.PrepareRoutingSubnetworks.PrepEdgeFilter;
 import com.graphhopper.routing.util.*;
@@ -26,7 +27,6 @@
 import com.graphhopper.util.EdgeIteratorState;
 import com.graphhopper.util.GHUtility;
 import com.graphhopper.util.Helper;
-import gnu.trove.list.array.TIntArrayList;
 import org.junit.Test;
 
 import java.util.Arrays;
@@ -98,7 +98,7 @@ public void testFindSubnetworks() {
         GraphHopperStorage g = createSubnetworkTestStorage();
         PrepEdgeFilter filter = new PrepEdgeFilter(carFlagEncoder);
         PrepareRoutingSubnetworks instance = new PrepareRoutingSubnetworks(g, Collections.singletonList(carFlagEncoder));
-        List<TIntArrayList> components = instance.findSubnetworks(filter);
+        List<IntArrayList> components = instance.findSubnetworks(filter);
 
         assertEquals(3, components.size());
 
@@ -114,7 +114,7 @@ public void testKeepLargestNetworks() {
         GraphHopperStorage g = createSubnetworkTestStorage();
         PrepEdgeFilter filter = new PrepEdgeFilter(carFlagEncoder);
         PrepareRoutingSubnetworks instance = new PrepareRoutingSubnetworks(g, Collections.singletonList(carFlagEncoder));
-        List<TIntArrayList> components = instance.findSubnetworks(filter);
+        List<IntArrayList> components = instance.findSubnetworks(filter);
         assertEquals(3, components.size());
         int removedEdges = instance.keepLargeNetworks(filter, components);
         assertEquals(8, removedEdges);
@@ -180,7 +180,8 @@ public void testRemoveSubnetworkWhenMultipleVehicles() {
         BikeFlagEncoder bikeEncoder = new BikeFlagEncoder();
         EncodingManager em2 = new EncodingManager(carEncoder, bikeEncoder);
         GraphHopperStorage g = createSubnetworkTestStorage2(em2);
-        GHUtility.getEdge(g, 3, 4).setFlags(carEncoder.setProperties(10, false, false) | bikeEncoder.setProperties(5, true, true));
+        GHUtility.getEdge(g, 3, 4).setFlags(carEncoder.setProperties(10, false, false)
+                | bikeEncoder.setProperties(5, true, true));
         PrepareRoutingSubnetworks instance = new PrepareRoutingSubnetworks(g, em2.fetchEdgeEncoders());
         instance.setMinNetworkSize(5);
         instance.doWork();
@@ -267,13 +268,13 @@ public void testTarjan() {
         TarjansSCCAlgorithm tarjan
                 = new TarjansSCCAlgorithm(g, new GHBitSetImpl(), filter);
 
-        List<TIntArrayList> components = tarjan.findComponents();
+        List<IntArrayList> components = tarjan.findComponents();
 
         assertEquals(4, components.size());
-        assertEquals(new TIntArrayList(new int[]{13, 5, 3, 7, 0}), components.get(0));
-        assertEquals(new TIntArrayList(new int[]{2, 4, 12, 11, 8, 1}), components.get(1));
-        assertEquals(new TIntArrayList(new int[]{10, 14, 6}), components.get(2));
-        assertEquals(new TIntArrayList(new int[]{15, 9}), components.get(3));
+        assertEquals(IntArrayList.from(13, 5, 3, 7, 0), components.get(0));
+        assertEquals(IntArrayList.from(2, 4, 12, 11, 8, 1), components.get(1));
+        assertEquals(IntArrayList.from(10, 14, 6), components.get(2));
+        assertEquals(IntArrayList.from(15, 9), components.get(3));
     }
 
     // Previous two-pass implementation failed on 1 -> 2 -> 0
@@ -313,7 +314,7 @@ public void test481() {
         instance.doWork();
 
         // only one remaining network
-        List<TIntArrayList> components = instance.findSubnetworks(new PrepEdgeFilter(carFlagEncoder));
+        List<IntArrayList> components = instance.findSubnetworks(new PrepEdgeFilter(carFlagEncoder));
         assertEquals(1, components.size());
     }
 }
diff --git a/core/src/test/java/com/graphhopper/routing/template/RoundTripRoutingTemplateTest.java b/core/src/test/java/com/graphhopper/routing/template/RoundTripRoutingTemplateTest.java
index e4d6f9271b..602d6374fb 100644
--- a/core/src/test/java/com/graphhopper/routing/template/RoundTripRoutingTemplateTest.java
+++ b/core/src/test/java/com/graphhopper/routing/template/RoundTripRoutingTemplateTest.java
@@ -64,7 +64,7 @@ public void testCalcRoundTrip() throws Exception {
         QueryGraph qGraph = new QueryGraph(g);
         qGraph.lookup(qr4, qr5);
         rTripRouting.setQueryResults(Arrays.asList(qr5, qr4, qr5));
-        List<Path> paths = rTripRouting.calcPaths(qGraph, new RoutingAlgorithmFactorySimple(), new AlgorithmOptions(DIJKSTRA_BI, carFE, weighting, tMode));
+        List<Path> paths = rTripRouting.calcPaths(qGraph, new RoutingAlgorithmFactorySimple(), new AlgorithmOptions(DIJKSTRA_BI, weighting, tMode));
         assertEquals(2, paths.size());
         assertEquals(Helper.createTList(5, 6, 3, 4), paths.get(0).calcNodes());
         assertEquals(Helper.createTList(4, 8, 7, 6, 5), paths.get(1).calcNodes());
@@ -72,7 +72,7 @@ public void testCalcRoundTrip() throws Exception {
         qGraph = new QueryGraph(g);
         qGraph.lookup(qr4, qr6);
         rTripRouting.setQueryResults(Arrays.asList(qr6, qr4, qr6));
-        paths = rTripRouting.calcPaths(qGraph, new RoutingAlgorithmFactorySimple(), new AlgorithmOptions(DIJKSTRA_BI, carFE, weighting, tMode));
+        paths = rTripRouting.calcPaths(qGraph, new RoutingAlgorithmFactorySimple(), new AlgorithmOptions(DIJKSTRA_BI, weighting, tMode));
         assertEquals(2, paths.size());
         assertEquals(Helper.createTList(6, 3, 4), paths.get(0).calcNodes());
         assertEquals(Helper.createTList(4, 8, 7, 6), paths.get(1).calcNodes());
diff --git a/core/src/test/java/com/graphhopper/routing/util/BikeFlagEncoderTest.java b/core/src/test/java/com/graphhopper/routing/util/BikeFlagEncoderTest.java
index 09a644128d..95a99e3cb1 100644
--- a/core/src/test/java/com/graphhopper/routing/util/BikeFlagEncoderTest.java
+++ b/core/src/test/java/com/graphhopper/routing/util/BikeFlagEncoderTest.java
@@ -70,33 +70,68 @@ public void testGetSpeed() {
         way.clearTags();
         way.setTag("highway", "footway");
         way.setTag("bicycle", "yes");
+        assertEquals(PUSHING_SECTION_SPEED, encoder.getSpeed(way));
+        assertPriority(PREFER.getValue(), way);
+        way.setTag("segregated", "no");
+        assertEquals(PUSHING_SECTION_SPEED, encoder.getSpeed(way));
+        assertPriority(PREFER.getValue(), way);
+        way.setTag("segregated", "yes");
         assertEquals(PUSHING_SECTION_SPEED * 2, encoder.getSpeed(way));
-        assertPriority(UNCHANGED.getValue(), way);
+        assertPriority(PREFER.getValue(), way);
 
         way.clearTags();
         way.setTag("highway", "footway");
         way.setTag("surface", "paved");
         way.setTag("bicycle", "yes");
-
+        assertEquals(PUSHING_SECTION_SPEED, encoder.getSpeed(way));
+        assertPriority(PREFER.getValue(), way);
+        way.setTag("segregated", "yes");
         assertEquals(PUSHING_SECTION_SPEED * 2, encoder.getSpeed(way));
-        assertPriority(UNCHANGED.getValue(), way);
+        assertPriority(PREFER.getValue(), way);
 
         way.clearTags();
         way.setTag("highway", "cycleway");
         assertEquals(18, encoder.getSpeed(way));
         assertPriority(VERY_NICE.getValue(), way);
         int cyclewaySpeed = encoder.getSpeed(way);
+        way.setTag("foot", "yes");
+        way.setTag("segregated", "yes");
+        assertPriority(VERY_NICE.getValue(), way);
+        assertEquals(cyclewaySpeed, encoder.getSpeed(way));
+        way.setTag("segregated", "no");
+        assertPriority(PREFER.getValue(), way);
+        assertEquals(cyclewaySpeed, encoder.getSpeed(way));
 
-        // Make sure that highway=cycleway" and highway=path with bicycle = designated give same result
+        // Make sure that "highway=cycleway" and "highway=path" with "bicycle=designated" give the same result
         way.clearTags();
         way.setTag("highway", "path");
         way.setTag("bicycle", "designated");
         assertEquals(cyclewaySpeed, encoder.getSpeed(way));
+        // Assume foot=no for designated in absence of a foot tag
+        assertPriority(VERY_NICE.getValue(), way);
+        way.setTag("foot", "yes");
+        assertEquals(cyclewaySpeed, encoder.getSpeed(way));
+        assertPriority(PREFER.getValue(), way);
+
+        way.setTag("foot", "no");
+        assertEquals(cyclewaySpeed, encoder.getSpeed(way));
+        assertPriority(VERY_NICE.getValue(), way);
+
+        way.setTag("segregated", "yes");
+        assertEquals(cyclewaySpeed, encoder.getSpeed(way));
+        assertPriority(VERY_NICE.getValue(), way);
+
+        way.setTag("segregated", "no");
+        assertEquals(cyclewaySpeed, encoder.getSpeed(way));
         assertPriority(VERY_NICE.getValue(), way);
 
         way.setTag("bicycle", "yes");
+        assertEquals(PUSHING_SECTION_SPEED, encoder.getSpeed(way));
+        assertPriority(PREFER.getValue(), way);
+
+        way.setTag("segregated", "yes");
         assertEquals(PUSHING_SECTION_SPEED * 2, encoder.getSpeed(way));
-        assertPriority(UNCHANGED.getValue(), way);
+        assertPriority(PREFER.getValue(), way);
 
         way.setTag("surface", "unpaved");
         assertEquals(PUSHING_SECTION_SPEED * 2, encoder.getSpeed(way));
@@ -127,7 +162,7 @@ public void testGetSpeed() {
         way.setTag("surface", "paved");
         way.setTag("bicycle", "designated");
         assertEquals(cyclewaySpeed, encoder.getSpeed(way));
-        assertPriority(PREFER.getValue(), way);
+        assertPriority(VERY_NICE.getValue(), way);
 
         way.clearTags();
         way.setTag("highway", "track");
@@ -167,6 +202,12 @@ public void testGetSpeed() {
         way.setTag("surface", "paved");
         assertEquals(18, encoder.getSpeed(way));
 
+        way.clearTags();
+        way.setTag("highway", "path");
+        way.setTag("surface", "ground");
+        assertEquals(4, encoder.getSpeed(way));
+        assertPriority(AVOID_IF_POSSIBLE.getValue(), way);
+
         way.clearTags();
         way.setTag("highway", "track");
         way.setTag("bicycle", "yes");
@@ -181,6 +222,13 @@ public void testGetSpeed() {
         way.setTag("surface", "fine_gravel");
         assertEquals(18, encoder.getSpeed(way));
 
+        way.clearTags();
+        way.setTag("highway", "track");
+        way.setTag("surface", "gravel");
+        way.setTag("tracktype", "grade2");
+        assertEquals(12, encoder.getSpeed(way));
+        assertPriority(UNCHANGED.getValue(), way);
+
         way.clearTags();
         way.setTag("highway", "primary");
         way.setTag("surface", "paved");
@@ -245,6 +293,33 @@ public void testHandleWayTags() {
         assertTrue(encoder.isBool(flags, FlagEncoder.K_ROUNDABOUT));
     }
 
+    @Test
+    public void testWayAcceptance() {
+        ReaderWay way = new ReaderWay(1);
+        way.setTag("highway", "cycleway");
+        way.setTag("vehicle", "no");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        // Sensless tagging: JOSM does create a warning here. We follow the highway tag:
+        way.setTag("bicycle", "no");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        way.setTag("bicycle", "designated");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "motorway");
+        assertFalse(encoder.acceptWay(way) > 0);
+        way.setTag("bicycle", "yes");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "residential");
+        way.setTag("bicycle", "yes");
+        way.setTag("access", "no");
+        assertTrue(encoder.acceptWay(way) > 0);
+    }
+
     @Test
     public void testOneway() {
         ReaderWay way = new ReaderWay(1);
@@ -319,6 +394,14 @@ public void testOneway() {
         flags = encoder.handleWayTags(way, encoder.acceptWay(way), 0);
         assertTrue(encoder.isForward(flags));
         assertTrue(encoder.isBackward(flags));
+
+        way.clearTags();
+        way.setTag("highway", "residential");
+        way.setTag("oneway", "yes");
+        way.setTag("cycleway:left", "opposite_lane");
+        flags = encoder.handleWayTags(way, encoder.acceptWay(way), 0);
+        assertTrue(encoder.isForward(flags));
+        assertTrue(encoder.isBackward(flags));
     }
 
     @Test
@@ -336,6 +419,10 @@ public void testHandleWayTagsInfluencedByRelation() {
 
         // relation code is PREFER
         osmRel.setTag("route", "bicycle");
+        relFlags = encoder.handleRelationTags(osmRel, 0);
+        flags = encoder.handleWayTags(osmWay, allowed, relFlags);
+        assertEquals(12, encoder.getSpeed(flags), 1e-1);
+        assertPriority(PREFER.getValue(), osmWay, relFlags);
         osmRel.setTag("network", "lcn");
         relFlags = encoder.handleRelationTags(osmRel, 0);
         flags = encoder.handleWayTags(osmWay, allowed, relFlags);
@@ -419,7 +506,7 @@ public void testSacScale() {
 
         way.setTag("highway", "cycleway");
         way.setTag("sac_scale", "mountain_hiking");
-        // disallow
+        // disallow questionable combination as too dangerous
         assertEquals(0, encoder.acceptWay(way));
     }
 
diff --git a/core/src/test/java/com/graphhopper/routing/util/Car4WDFlagEncoderTest.java b/core/src/test/java/com/graphhopper/routing/util/Car4WDFlagEncoderTest.java
new file mode 100644
index 0000000000..2f75746e9e
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/routing/util/Car4WDFlagEncoderTest.java
@@ -0,0 +1,129 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.routing.util;
+
+import com.graphhopper.reader.ReaderNode;
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.util.Helper;
+import org.junit.Test;
+
+import java.text.DateFormat;
+import java.util.Date;
+
+import static org.junit.Assert.*;
+
+/**
+ * @author Peter Karich
+ * @author zstadler
+ */
+public class Car4WDFlagEncoderTest extends CarFlagEncoderTest {
+    private final EncodingManager em = new EncodingManager("car4wd,bike,foot");
+    private final Car4WDFlagEncoder encoder = (Car4WDFlagEncoder) em.getEncoder("car4wd");
+
+    @Override
+    @Test
+    public void testAccess() {
+        ReaderWay way = new ReaderWay(1);
+        assertFalse(encoder.acceptWay(way) > 0);
+        way.setTag("highway", "service");
+        assertTrue(encoder.acceptWay(way) > 0);
+        way.setTag("access", "no");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "track");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        way.setTag("motorcar", "no");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        // for now allow grade1+2+3 for every country, see #253
+        way.clearTags();
+        way.setTag("highway", "track");
+        way.setTag("tracktype", "grade2");
+        assertTrue(encoder.acceptWay(way) > 0);
+	// This is the only difference from a "car"
+        way.setTag("tracktype", "grade4");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "service");
+        way.setTag("access", "delivery");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "unclassified");
+        way.setTag("ford", "yes");
+        assertFalse(encoder.acceptWay(way) > 0);
+        way.setTag("motorcar", "yes");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("route", "ferry");
+        assertTrue(encoder.acceptWay(way) > 0);
+        assertTrue(encoder.isFerry(encoder.acceptWay(way)));
+        way.setTag("motorcar", "no");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("route", "ferry");
+        way.setTag("foot", "yes");
+        assertFalse(encoder.acceptWay(way) > 0);
+        assertFalse(encoder.isFerry(encoder.acceptWay(way)));
+
+        way.clearTags();
+        way.setTag("access", "yes");
+        way.setTag("motor_vehicle", "no");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "service");
+        way.setTag("access", "yes");
+        way.setTag("motor_vehicle", "no");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "service");
+        way.setTag("access", "no");
+        way.setTag("motorcar", "yes");
+        assertTrue(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "service");
+        way.setTag("access", "emergency");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "service");
+        way.setTag("motor_vehicle", "emergency");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        DateFormat simpleDateFormat = Helper.createFormatter("yyyy MMM dd");
+
+        way.clearTags();
+        way.setTag("highway", "road");
+        way.setTag("access:conditional", "no @ (" + simpleDateFormat.format(new Date().getTime()) + ")");
+        assertFalse(encoder.acceptWay(way) > 0);
+
+        way.clearTags();
+        way.setTag("highway", "road");
+        way.setTag("access", "no");
+        way.setTag("access:conditional", "yes @ (" + simpleDateFormat.format(new Date().getTime()) + ")");
+        assertTrue(encoder.acceptWay(way) > 0);
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/routing/util/CarFlagEncoderTest.java b/core/src/test/java/com/graphhopper/routing/util/CarFlagEncoderTest.java
index d3c7f81711..fe78285677 100644
--- a/core/src/test/java/com/graphhopper/routing/util/CarFlagEncoderTest.java
+++ b/core/src/test/java/com/graphhopper/routing/util/CarFlagEncoderTest.java
@@ -190,6 +190,18 @@ public void testOneway() {
         way.clearTags();
     }
 
+
+    @Test
+    public void testDestinationTag() {
+        ReaderWay way = new ReaderWay(1);
+        way.setTag("highway", "secondary");
+        assertEquals(60, encoder.getSpeed(way), 1e-1);
+
+        way.setTag("vehicle", "destination");
+        long flags = encoder.handleWayTags(way, encoder.acceptWay(way),0);
+        assertEquals(5, encoder.getSpeed(flags), 1e-1);
+    }
+
     @Test
     public void testSetAccess() {
         assertTrue(encoder.isForward(encoder.setProperties(0, true, true)));
@@ -278,6 +290,34 @@ public void testSpeed() {
         encoded = encoder.handleWayTags(way, allowed, 0);
         assertEquals(20, encoder.getSpeed(encoded), 1e-1);
 
+        way.clearTags();
+        way.setTag("highway", "secondary");
+        way.setTag("surface", "compacted");
+        allowed = encoder.acceptWay(way);
+        encoded = encoder.handleWayTags(way, allowed, 0);
+        assertEquals(30, encoder.getSpeed(encoded), 1e-1);
+
+        way.clearTags();
+        way.setTag("highway", "secondary");
+        way.setTag("motorroad", "yes");
+        allowed = encoder.acceptWay(way);
+        encoded = encoder.handleWayTags(way, allowed, 0);
+        assertEquals(90, encoder.getSpeed(encoded), 1e-1);
+
+        way.clearTags();
+        way.setTag("highway", "motorway");
+        way.setTag("motorroad", "yes"); // this tag should be ignored
+        allowed = encoder.acceptWay(way);
+        encoded = encoder.handleWayTags(way, allowed, 0);
+        assertEquals(100, encoder.getSpeed(encoded), 1e-1);
+
+        way.clearTags();
+        way.setTag("highway", "motorway_link");
+        way.setTag("motorroad", "yes"); // this tag should be ignored
+        allowed = encoder.acceptWay(way);
+        encoded = encoder.handleWayTags(way, allowed, 0);
+        assertEquals(70, encoder.getSpeed(encoded), 1e-1);
+
         try {
             encoder.setSpeed(0, -1);
             assertTrue(false);
@@ -555,4 +595,12 @@ public void testCombination() {
         assertTrue(em.getEncoder("bike").isBackward(edgeFlags));
         assertTrue(em.getEncoder("bike").isForward(edgeFlags));
     }
+    @Test
+    public void testApplyBadSurfaceSpeed() {
+        ReaderWay way = new ReaderWay(1);
+        way.setTag("highway", "secondary");
+        way.setTag("surface", "unpaved");
+        assertEquals(30, encoder.applyBadSurfaceSpeed(way, 90), 1e-1);
+
+    }
 }
diff --git a/core/src/test/java/com/graphhopper/routing/util/DataFlagEncoderTest.java b/core/src/test/java/com/graphhopper/routing/util/DataFlagEncoderTest.java
index a80b25a471..5539822243 100644
--- a/core/src/test/java/com/graphhopper/routing/util/DataFlagEncoderTest.java
+++ b/core/src/test/java/com/graphhopper/routing/util/DataFlagEncoderTest.java
@@ -1,15 +1,19 @@
 package com.graphhopper.routing.util;
 
+import java.util.Arrays;
+import java.util.LinkedHashMap;
+import java.util.Map;
+
+import com.graphhopper.util.PMap;
+import org.junit.Ignore;
+import org.junit.Test;
+
 import com.graphhopper.reader.ReaderWay;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.GraphBuilder;
 import com.graphhopper.util.EdgeIteratorState;
 import com.graphhopper.util.GHUtility;
 import com.graphhopper.util.Helper;
-import org.junit.Test;
-
-import java.util.HashMap;
-import java.util.Map;
 
 import static org.junit.Assert.*;
 
@@ -17,17 +21,40 @@
  * @author Peter Karich
  */
 public class DataFlagEncoderTest {
+    private final PMap properties;
     private final DataFlagEncoder encoder;
     private final EncodingManager encodingManager;
     private final int motorVehicleInt;
 
+    private final double DELTA = 0.1;
+
     public DataFlagEncoderTest() {
-        encoder = new DataFlagEncoder();
-        encodingManager = new EncodingManager(encoder);
+        properties = new PMap();
+        properties.put("store_height", true);
+        properties.put("store_weight", true);
+        properties.put("store_width", true);
+        encoder = new DataFlagEncoder(properties);
+        encodingManager = new EncodingManager(Arrays.asList(encoder), 8);
 
         motorVehicleInt = encoder.getAccessType("motor_vehicle");
     }
 
+    @Test(expected = IllegalArgumentException.class)
+    public void testInsufficientEncoderBitLength() {
+        EncodingManager em = new EncodingManager(Arrays.asList(new DataFlagEncoder(properties)));
+    }
+
+    @Test
+    public void testSufficientEncoderBitLength() {
+        try {
+            EncodingManager em = new EncodingManager(Arrays.asList(new DataFlagEncoder(properties)), 8);
+            EncodingManager em1 = new EncodingManager(Arrays.asList(new DataFlagEncoder()));
+        }
+        catch (Throwable t) {
+            fail();
+        }
+    }
+
     @Test
     public void testHighway() {
         ReaderWay osmWay = new ReaderWay(0);
@@ -56,7 +83,7 @@ public void testHighway() {
         edge = GHUtility.createMockedEdgeIteratorState(0, flags);
         assertEquals("_default", encoder.getHighwayAsString(edge));
     }
-    
+
     @Test
     public void testTunnel() {
         ReaderWay osmWay = new ReaderWay(0);
@@ -79,7 +106,7 @@ public void testTunnel() {
         assertFalse(encoder.isTransportModeTunnel(edge));
         assertTrue(encoder.isTransportModeBridge(edge));
     }
-    
+
     @Test
     public void testBridge() {
         ReaderWay osmWay = new ReaderWay(0);
@@ -101,18 +128,32 @@ public void testBridge() {
         assertEquals("bridge", encoder.getTransportModeAsString(edge));
         assertFalse(encoder.isTransportModeTunnel(edge));
         assertTrue(encoder.isTransportModeBridge(edge));
-    }    
+    }
 
     @Test
     public void testHighwaySpeed() {
-        Map<String, Double> map = new HashMap<>();
+        Map<String, Double> map = new LinkedHashMap<>();
         map.put("motorway", 100d);
         map.put("motorway_link", 100d);
+        map.put("motorroad", 90d);
         map.put("trunk", 90d);
         map.put("trunk_link", 90d);
 
         double[] arr = encoder.getHighwaySpeedMap(map);
-        assertEquals("[0.0, 100.0, 100.0, 90.0, 90.0, 0.0]", Helper.createDoubleList(arr).subList(0, 6).toString());
+        assertEquals("[0.0, 100.0, 100.0, 90.0, 90.0, 90.0]", Helper.createDoubleList(arr).subList(0, 6).toString());
+    }
+
+    @Test
+    public void testDestinationTag() {
+        ReaderWay way = new ReaderWay(1);
+        way.setTag("highway", "secondary");
+        assertEquals(DataFlagEncoder.AccessValue.ACCESSIBLE, encoder.getEdgeAccessValue(encoder.handleWayTags(way, encoder.acceptWay(way), 0)));
+
+        way.setTag("vehicle", "destination");
+        assertEquals(DataFlagEncoder.AccessValue.EVENTUALLY_ACCESSIBLE, encoder.getEdgeAccessValue(encoder.handleWayTags(way, encoder.acceptWay(way), 0)));
+
+        way.setTag("vehicle", "no");
+        assertEquals(DataFlagEncoder.AccessValue.NOT_ACCESSIBLE, encoder.getEdgeAccessValue(encoder.handleWayTags(way, encoder.acceptWay(way), 0)));
     }
 
     @Test
@@ -134,6 +175,25 @@ public void testMaxspeed() {
         assertEquals(-1, encoder.getMaxspeed(edge, motorVehicleInt, true), .1);
     }
 
+    @Test
+    public void testLargeMaxspeed() {
+        ReaderWay osmWay = new ReaderWay(0);
+        osmWay.setTag("highway", "primary");
+        osmWay.setTag("maxspeed", "145");
+        long flags = encoder.handleWayTags(osmWay, 1, 0);
+        EdgeIteratorState edge = GHUtility.createMockedEdgeIteratorState(0, flags);
+        assertEquals(140, encoder.getMaxspeed(edge, motorVehicleInt, false), .1);
+        assertEquals(140, encoder.getMaxspeed(edge, motorVehicleInt, true), .1);
+
+        osmWay = new ReaderWay(0);
+        osmWay.setTag("highway", "primary");
+        osmWay.setTag("maxspeed", "1000");
+        flags = encoder.handleWayTags(osmWay, 1, 0);
+        edge = GHUtility.createMockedEdgeIteratorState(0, flags);
+        assertEquals(140, encoder.getMaxspeed(edge, motorVehicleInt, false), .1);
+        assertEquals(140, encoder.getMaxspeed(edge, motorVehicleInt, true), .1);
+    }
+
     @Test
     public void reverseEdge() {
         Graph graph = new GraphBuilder(encodingManager).create();
@@ -151,4 +211,93 @@ public void reverseEdge() {
         assertEquals(-1, encoder.getMaxspeed(edge, motorVehicleInt, false), .1);
         assertEquals(10, encoder.getMaxspeed(edge, motorVehicleInt, true), .1);
     }
+
+    @Test
+    public void setAccess() {
+        Graph graph = new GraphBuilder(encodingManager).create();
+        EdgeIteratorState edge = graph.edge(0, 1);
+
+        edge.setFlags(encoder.setAccess(edge.getFlags(), true, true));
+        assertTrue(encoder.isForward(edge, motorVehicleInt));
+        assertTrue(encoder.isBackward(edge, motorVehicleInt));
+
+        edge.setFlags(encoder.setAccess(edge.getFlags(), true, false));
+        assertTrue(encoder.isForward(edge, motorVehicleInt));
+        assertFalse(encoder.isBackward(edge, motorVehicleInt));
+
+        edge = edge.detach(true);
+        assertFalse(encoder.isForward(edge, motorVehicleInt));
+        assertTrue(encoder.isBackward(edge, motorVehicleInt));
+        edge = edge.detach(true);
+        assertTrue(encoder.isForward(edge, motorVehicleInt));
+        assertFalse(encoder.isBackward(edge, motorVehicleInt));
+
+        edge.setFlags(encoder.setAccess(edge.getFlags(), false, false));
+        assertFalse(encoder.isForward(edge, motorVehicleInt));
+        assertFalse(encoder.isBackward(edge, motorVehicleInt));
+    }
+
+    @Test
+    public void acceptWay() {
+        ReaderWay osmWay = new ReaderWay(0);
+        osmWay.setTag("highway", "primary");
+        assertTrue(encoder.acceptWay(osmWay) != 0);
+
+        // important to filter out illegal highways to reduce the number of edges before adding them to the graph
+        osmWay.setTag("highway", "building");
+        assertTrue(encoder.acceptWay(osmWay) == 0);
+    }
+
+    @Test
+    public void stringToMeter() {
+        assertEquals(1.5, DataFlagEncoder.stringToMeter("1.5"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToMeter("1.5m"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToMeter("1.5 m"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToMeter("1.5   m"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToMeter("1.5 meter"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToMeter("4 ft 11 in"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToMeter("4'11''"), DELTA);
+
+
+        assertEquals(3, DataFlagEncoder.stringToMeter("3 m."), DELTA);
+        assertEquals(3, DataFlagEncoder.stringToMeter("3meters"), DELTA);
+        assertEquals(0.8 * 3, DataFlagEncoder.stringToMeter("~3"), DELTA);
+        assertEquals(3 * 0.8, DataFlagEncoder.stringToMeter("3 m approx"), DELTA);
+
+        // 2.743 + 0.178
+        assertEquals(2.921, DataFlagEncoder.stringToMeter("9 ft 7in"), DELTA);
+        assertEquals(2.921, DataFlagEncoder.stringToMeter("9'7\""), DELTA);
+        assertEquals(2.921, DataFlagEncoder.stringToMeter("9'7''"), DELTA);
+        assertEquals(2.921, DataFlagEncoder.stringToMeter("9' 7\""), DELTA);
+
+        assertEquals(2.743, DataFlagEncoder.stringToMeter("9'"), DELTA);
+        assertEquals(2.743, DataFlagEncoder.stringToMeter("9 feet"), DELTA);
+    }
+
+    @Test(expected = NumberFormatException.class)
+    public void stringToMeterException() {
+        // Unexpected values
+        DataFlagEncoder.stringToMeter("height limit 1.5m");
+    }
+
+    @Test
+    public void stringToTons() {
+        assertEquals(1.5, DataFlagEncoder.stringToTons("1.5"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToTons("1.5 t"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToTons("1.5   t"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToTons("1.5 tons"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToTons("1.5 ton"), DELTA);
+        assertEquals(1.5, DataFlagEncoder.stringToTons("3306.9 lbs"), DELTA);
+        assertEquals(3, DataFlagEncoder.stringToTons("3 T"), DELTA);
+        assertEquals(3, DataFlagEncoder.stringToTons("3ton"), DELTA);
+
+        // maximum gross weight
+        assertEquals(6, DataFlagEncoder.stringToTons("6t mgw"), DELTA);
+    }
+
+    @Test(expected = NumberFormatException.class)
+    public void stringToTonsException() {
+        // Unexpected values
+        DataFlagEncoder.stringToTons("weight limit 1.5t");
+    }
 }
diff --git a/core/src/test/java/com/graphhopper/routing/util/EncodingManagerTest.java b/core/src/test/java/com/graphhopper/routing/util/EncodingManagerTest.java
index 69a5f691ba..842bc303d9 100644
--- a/core/src/test/java/com/graphhopper/routing/util/EncodingManagerTest.java
+++ b/core/src/test/java/com/graphhopper/routing/util/EncodingManagerTest.java
@@ -89,7 +89,7 @@ public void testWrongEncoders() {
             new EncodingManager(new FootFlagEncoder(), new CarFlagEncoder(), new BikeFlagEncoder(), new MountainBikeFlagEncoder(), new RacingBikeFlagEncoder());
             assertTrue(false);
         } catch (Exception ex) {
-            assertTrue(ex.getMessage(), ex.getMessage().startsWith("Encoders are requesting more than 32 bits of way flags. Decrease the"));
+            assertTrue(ex.getMessage(), ex.getMessage().startsWith("Encoders are requesting 44 bits, more than 32 bits of way flags. Decrease the"));
         }
     }
 
diff --git a/core/src/test/java/com/graphhopper/routing/util/NameSimilarityEdgeFilterTest.java b/core/src/test/java/com/graphhopper/routing/util/NameSimilarityEdgeFilterTest.java
new file mode 100644
index 0000000000..77e3b0a6e9
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/routing/util/NameSimilarityEdgeFilterTest.java
@@ -0,0 +1,254 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.routing.util;
+
+import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.util.GHUtility;
+import org.junit.Ignore;
+import org.junit.Test;
+
+import static junit.framework.TestCase.assertFalse;
+import static org.junit.Assert.assertTrue;
+
+/**
+ * @author Robin Boldt
+ */
+public class NameSimilarityEdgeFilterTest {
+
+    @Test
+    public void testAccept() {
+        EdgeFilter edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Laufamholzstraße 154 Nürnberg");
+        EdgeIteratorState edge = createTestEdgeIterator("Laufamholzstraße, ST1333");
+        assertTrue(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Hauptstraße");
+        assertFalse(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Lorem Ipsum");
+        assertFalse(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("");
+        assertFalse(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator(null);
+        assertFalse(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), null);
+        edge = createTestEdgeIterator("Laufamholzstraße, ST1333");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "");
+        edge = createTestEdgeIterator("Laufamholzstraße, ST1333");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Johannesstraße, 99636, Rastenberg, Deutschland");
+        edge = createTestEdgeIterator("Laufamholzstraße, ST1333");
+        assertFalse(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Johannesstraße");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Hauptstraße, 39025, Naturns, Italien");
+        edge = createTestEdgeIterator("Teststraße");
+        assertFalse(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Hauptstraße");
+        assertTrue(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Hauptstrasse");
+        assertTrue(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Hauptstr.");
+        assertTrue(edgeFilter.accept(edge));
+
+    }
+
+    /**
+     * With Nominatim you should not use the "placename" for best results, otherwise the length difference becomes too big
+     */
+    @Test
+    public void testAcceptFromNominatim() {
+        EdgeFilter edgeFilter;
+        EdgeIteratorState edge;
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Wentworth Street, Caringbah South");
+        edge = createTestEdgeIterator("Wentworth Street");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Zum Toffental, Altdorf bei Nürnnberg");
+        edge = createTestEdgeIterator("Zum Toffental");
+        assertTrue(edgeFilter.accept(edge));
+    }
+
+    @Test
+    public void testAcceptFromGoogleMapsGeocoding() {
+        EdgeFilter edgeFilter;
+        EdgeIteratorState edge;
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Rue Notre-Dame O Montréal");
+        edge = createTestEdgeIterator("Rue Dupré");
+        assertFalse(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Rue Notre-Dame Ouest");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "227 Rue Saint-Antoine O, Montréal");
+        edge = createTestEdgeIterator("Rue Saint-Antoine O");
+        assertTrue(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Rue Saint-Jacques");
+        assertFalse(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "1025 Rue de Bleury, Montréal, QC H2Z 1M7");
+        edge = createTestEdgeIterator("Rue de Bleury");
+        assertTrue(edgeFilter.accept(edge));
+
+        edge = createTestEdgeIterator("Rue Balmoral");
+        assertFalse(edgeFilter.accept(edge));
+
+        // Modified Test from Below
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "257 Main Road, Claremont, Cape Town, 7708, Afrique du Sud");
+        edge = createTestEdgeIterator("Main Road");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Cape Point Rd, Cape Peninsula, Cape Town, 8001, Afrique du Sud");
+        edge = createTestEdgeIterator("Cape Point / Cape of Good Hope");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Viale Puglie, 26, 20137 Milano, Italy");
+        edge = createTestEdgeIterator("Viale Puglie");
+        assertTrue(edgeFilter.accept(edge));
+    }
+
+    @Test
+    public void testAcceptMashup() {
+        EdgeFilter edgeFilter;
+        EdgeIteratorState edge;
+
+        edge = createTestEdgeIterator("Augustine Street");
+
+        // Google Maps
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Augustine St, Hunters Hill NSW 2110, Australia");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Opencagedata
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Augustine Street, Sydney Neusüdwales 2110, Australien");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Nominatim
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Augustine Street, Sydney, Municipality of Hunters Hill, Neusüdwales, 2111, Australien");
+        assertTrue(edgeFilter.accept(edge));
+
+    }
+
+    @Ignore
+    public void testThatShouldSucceed(){
+        EdgeFilter edgeFilter;
+        EdgeIteratorState edge;
+
+        // The Problem is that Rd vs Road is abreviated, if we have Road, it works
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "257 Main Rd, Claremont, Cape Town, 7708, Afrique du Sud");
+        edge = createTestEdgeIterator("Main Road");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Just too much difference Between Google Maps and OSM @ 32.121435,-110.857969
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "7202 S Wilmot Rd, Tucson, AZ 85701");
+        edge = createTestEdgeIterator("South Wilmot Road");
+        assertTrue(edgeFilter.accept(edge));
+
+        // @ 37.307774,13.581259
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Via Manzoni, 50/52, 92100 Agrigento AG, Italy");
+        edge = createTestEdgeIterator("Via Alessandro Manzoni");
+        assertTrue(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Av. Juan Ramón Ramírez, 12, 02630 La Roda, Albacete, Spain");
+        edge = createTestEdgeIterator("Avenida Juan Ramón Ramírez");
+        assertTrue(edgeFilter.accept(edge));
+
+
+    }
+
+
+    /**
+     * We ignore Typos for now, most GeoCoders return pretty good results, we might allow some typos
+     */
+    @Ignore
+    public void testAcceptWithTypos() {
+        EdgeFilter edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Laufamholzstraße 154 Nürnberg");
+        EdgeIteratorState edge = createTestEdgeIterator("Laufamholzstraße, ST1333");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Single Typo
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Kaufamholzstraße 154 Nürnberg");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Two Typos
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Kaufamholystraße 154 Nürnberg");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Three Typos
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Kaufmholystraße 154 Nürnberg");
+        assertFalse(edgeFilter.accept(edge));
+
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Hauptstraße");
+        edge = createTestEdgeIterator("Hauptstraße");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Single Typo
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Hauptstrase");
+        assertTrue(edgeFilter.accept(edge));
+
+        // Two Typos
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "Lauptstrase");
+        assertTrue(edgeFilter.accept(edge));
+
+        // We ignore too short Strings for now
+        /*
+        // Distance - PerfectDistance = 1
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "z");
+        assertFalse(edgeFilter.accept(edge));
+        // Distance - PerfectDistance = 1
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "az");
+        assertFalse(edgeFilter.accept(edge));
+
+        // Distance - PerfectDistance = 2
+        edgeFilter = new NameSimilarityEdgeFilter(new DefaultEdgeFilter(new CarFlagEncoder()), "xy");
+        assertFalse(edgeFilter.accept(edge));
+        */
+    }
+
+    private EdgeIteratorState createTestEdgeIterator(final String name) {
+        return new GHUtility.DisabledEdgeIterator() {
+
+            @Override
+            public String getName() {
+                return name;
+            }
+
+            @Override
+            public boolean isForward(FlagEncoder encoder) {
+                return true;
+            }
+
+            @Override
+            public boolean isBackward(FlagEncoder encoder) {
+                return true;
+            }
+        };
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/routing/weighting/FastestWeightingTest.java b/core/src/test/java/com/graphhopper/routing/weighting/FastestWeightingTest.java
index 8d8836275c..d66bbb1f3f 100644
--- a/core/src/test/java/com/graphhopper/routing/weighting/FastestWeightingTest.java
+++ b/core/src/test/java/com/graphhopper/routing/weighting/FastestWeightingTest.java
@@ -18,9 +18,14 @@
 package com.graphhopper.routing.weighting;
 
 import com.graphhopper.routing.VirtualEdgeIteratorState;
+import com.graphhopper.routing.util.Bike2WeightFlagEncoder;
 import com.graphhopper.routing.util.EncodingManager;
 import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.storage.GraphBuilder;
+import com.graphhopper.storage.GraphHopperStorage;
 import com.graphhopper.util.EdgeIterator;
+import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.util.GHUtility;
 import com.graphhopper.util.Helper;
 import com.graphhopper.util.PMap;
 import com.graphhopper.util.Parameters;
@@ -45,7 +50,8 @@ public void testMinWeightHasSameUnitAs_getWeight() {
 
     @Test
     public void testWeightWrongHeading() {
-        Weighting instance = new FastestWeighting(encoder, new PMap().put(Parameters.Routing.HEADING_PENALTY, "100"));
+        Weighting instance = new FastestWeighting(encoder, new PMap().
+                put(Parameters.Routing.HEADING_PENALTY, "100"));
         VirtualEdgeIteratorState virtEdge = new VirtualEdgeIteratorState(0, 1, 1, 2, 10,
                 encoder.setProperties(10, true, true), "test", Helper.createPointList(51, 0, 51, 1));
         double time = instance.calcWeight(virtEdge, false, 0);
@@ -75,4 +81,19 @@ public void testSpeed0() {
         // 0 / 0 returns NaN but calcWeight should not return NaN!
         assertEquals(1.0 / 0, instance.calcWeight(createMockedEdgeIteratorState(0, encoder.setProperties(0, true, true)), false, EdgeIterator.NO_EDGE), 1e-8);
     }
+
+    @Test
+    public void testTime() {
+        FlagEncoder tmpEnc = new Bike2WeightFlagEncoder();
+        GraphHopperStorage g = new GraphBuilder(new EncodingManager(tmpEnc)).create();
+        Weighting w = new FastestWeighting(tmpEnc);
+
+        long flags = tmpEnc.setSpeed(tmpEnc.setReverseSpeed(tmpEnc.setAccess(0, true, true), 10), 15);
+        EdgeIteratorState edge = GHUtility.createMockedEdgeIteratorState(100000, flags);
+
+        assertEquals(375 * 60 * 1000, w.calcMillis(edge, false, EdgeIterator.NO_EDGE));
+        assertEquals(600 * 60 * 1000, w.calcMillis(edge, true, EdgeIterator.NO_EDGE));
+
+        g.close();
+    }
 }
diff --git a/core/src/test/java/com/graphhopper/routing/weighting/GenericWeightingTest.java b/core/src/test/java/com/graphhopper/routing/weighting/GenericWeightingTest.java
new file mode 100644
index 0000000000..d94f7da4b5
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/routing/weighting/GenericWeightingTest.java
@@ -0,0 +1,166 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.routing.weighting;
+
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.routing.AbstractRoutingAlgorithmTester;
+import com.graphhopper.routing.util.*;
+import com.graphhopper.storage.*;
+
+import static com.graphhopper.storage.GraphEdgeIdFinder.BLOCKED_EDGES;
+import static com.graphhopper.storage.GraphEdgeIdFinder.BLOCKED_SHAPES;
+
+import com.graphhopper.util.*;
+import com.graphhopper.util.shapes.Circle;
+import com.graphhopper.util.shapes.Shape;
+import org.junit.Before;
+import org.junit.Test;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.List;
+
+import static org.junit.Assert.assertEquals;
+
+/**
+ * @author Peter Karich
+ */
+public class GenericWeightingTest {
+    private final PMap properties;
+    private final DataFlagEncoder encoder;
+    private final EncodingManager em;
+    private Graph graph;
+
+    private final double edgeWeight = 566111;
+
+    public GenericWeightingTest() {
+        properties = new PMap();
+        properties.put("store_height", true);
+        properties.put("store_weight", true);
+        properties.put("store_width", true);
+        encoder = new DataFlagEncoder(properties);
+        em = new EncodingManager(Arrays.asList(encoder), 8);
+    }
+
+    @Before
+    public void setUp() {
+        ReaderWay way = new ReaderWay(27l);
+        way.setTag("highway", "primary");
+        way.setTag("maxspeed", "10");
+        way.setTag("maxheight", "4.4");
+
+        graph = new GraphBuilder(em).create();
+        // 0-1
+        graph.edge(0, 1, 1, true);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 0, 0.00, 0.00);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 1, 0.01, 0.01);
+        graph.getEdgeIteratorState(0, 1).setFlags(encoder.handleWayTags(way, 1, 0));
+
+    }
+
+    @Test
+    public void testBlockedById() {
+        EdgeIteratorState edge = graph.getEdgeIteratorState(0, 1);
+        ConfigMap cMap = encoder.readStringMap(new PMap());
+        Weighting instance = new GenericWeighting(encoder, cMap);
+        assertEquals(edgeWeight, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+
+        GHIntHashSet blockedEdges = new GHIntHashSet(1);
+        cMap.put(BLOCKED_EDGES, blockedEdges);
+        blockedEdges.add(0);
+        instance = new GenericWeighting(encoder, cMap);
+        assertEquals(Double.POSITIVE_INFINITY, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+    }
+
+    @Test
+    public void testBlockedByShape() {
+        EdgeIteratorState edge = graph.getEdgeIteratorState(0, 1);
+        ConfigMap cMap = encoder.readStringMap(new PMap());
+        GenericWeighting instance = new GenericWeighting(encoder, cMap);
+        assertEquals(edgeWeight, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+
+        List<Shape> shapes = new ArrayList<>(1);
+        shapes.add(new Circle(0.01, 0.01, 100));
+        cMap.put(BLOCKED_SHAPES, shapes);
+        instance = new GenericWeighting(encoder, cMap);
+        instance.setGraph(graph);
+        assertEquals(Double.POSITIVE_INFINITY, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+
+        shapes.clear();
+        // Do not match 1,1 of edge
+        shapes.add(new Circle(0.1, 0.1, 100));
+        cMap.put(BLOCKED_SHAPES, shapes);
+        instance = new GenericWeighting(encoder, cMap);
+        instance.setGraph(graph);
+        assertEquals(edgeWeight, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+    }
+
+    @Test
+    public void testCalcTime() {
+        ConfigMap cMap = encoder.readStringMap(new PMap());
+        GenericWeighting weighting = new GenericWeighting(encoder, cMap);
+        EdgeIteratorState edge = graph.getEdgeIteratorState(0, 1);
+        assertEquals(edgeWeight, weighting.calcMillis(edge, false, EdgeIterator.NO_EDGE), .1);
+    }
+
+    @Test
+    public void testNullGraph() {
+        ConfigMap cMap = encoder.readStringMap(new PMap());
+        GenericWeighting weighting = new GenericWeighting(encoder, cMap);
+        weighting.setGraph(null);
+    }
+
+    @Test
+    public void testRoadAttributeRestriction() {
+        EdgeIteratorState edge = graph.getEdgeIteratorState(0, 1);
+        ConfigMap cMap = encoder.readStringMap(new PMap());
+        cMap.put(GenericWeighting.HEIGHT_LIMIT, 4.0);
+        Weighting instance = new GenericWeighting(encoder, cMap);
+        assertEquals(edgeWeight, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+
+        cMap.put(GenericWeighting.HEIGHT_LIMIT, 5.0);
+        instance = new GenericWeighting(encoder, cMap);
+        assertEquals(Double.POSITIVE_INFINITY, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+    }
+
+    @Test
+    public void testDisabledRoadAttributes() {
+        DataFlagEncoder simpleEncoder = new DataFlagEncoder();
+        EncodingManager simpleEncodingManager = new EncodingManager(simpleEncoder);
+        Graph simpleGraph = new GraphBuilder(simpleEncodingManager).create();
+
+        ReaderWay way = new ReaderWay(27l);
+        way.setTag("highway", "primary");
+        way.setTag("maxspeed", "10");
+        way.setTag("maxheight", "4.4");
+
+        // 0-1
+        simpleGraph.edge(0, 1, 1, true);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(simpleGraph, 0, 0.00, 0.00);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(simpleGraph, 1, 0.01, 0.01);
+        simpleGraph.getEdgeIteratorState(0, 1).setFlags(simpleEncoder.handleWayTags(way, 1, 0));
+
+        EdgeIteratorState edge = simpleGraph.getEdgeIteratorState(0, 1);
+        ConfigMap cMap = simpleEncoder.readStringMap(new PMap());
+        cMap.put(GenericWeighting.HEIGHT_LIMIT, 5.0);
+        Weighting instance = new GenericWeighting(simpleEncoder, cMap);
+
+        assertEquals(edgeWeight, instance.calcWeight(edge, false, EdgeIterator.NO_EDGE), 1e-8);
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/storage/AbstractLockFactoryTester.java b/core/src/test/java/com/graphhopper/storage/AbstractLockFactoryTester.java
index b8816282d3..fbb7037415 100644
--- a/core/src/test/java/com/graphhopper/storage/AbstractLockFactoryTester.java
+++ b/core/src/test/java/com/graphhopper/storage/AbstractLockFactoryTester.java
@@ -50,13 +50,13 @@ public void tearDown() {
     public void testObtain() {
         LockFactory instance = createLockFactory();
         instance.setLockDir(lockDir);
-        Lock lock = instance.create("test", true);
+        GHLock lock = instance.create("test", true);
         assertTrue(lock.tryLock());
         assertTrue(lock.isLocked());
         assertFalse(lock.tryLock());
         assertTrue(lock.isLocked());
 
-        Lock lock2 = instance.create("test", true);
+        GHLock lock2 = instance.create("test", true);
         assertFalse(lock2.tryLock());
         assertTrue(lock2.isLocked());
 
@@ -72,7 +72,7 @@ public void testObtain() {
     public void testForceDelete() {
         LockFactory instance = createLockFactory();
         instance.setLockDir(lockDir);
-        Lock lock = instance.create("testlock", true);
+        GHLock lock = instance.create("testlock", true);
         assertTrue(lock.tryLock());
         assertTrue(lock.isLocked());
 
diff --git a/core/src/test/java/com/graphhopper/storage/GraphEdgeIdFinderTest.java b/core/src/test/java/com/graphhopper/storage/GraphEdgeIdFinderTest.java
new file mode 100644
index 0000000000..0994930bed
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/storage/GraphEdgeIdFinderTest.java
@@ -0,0 +1,88 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for
+ *  additional information regarding copyright ownership.
+ *
+ *  GraphHopper GmbH licenses this file to you under the Apache License,
+ *  Version 2.0 (the "License"); you may not use this file except in
+ *  compliance with the License. You may obtain a copy of the License at
+ *
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.storage;
+
+import com.graphhopper.coll.GHIntHashSet;
+import com.graphhopper.routing.AbstractRoutingAlgorithmTester;
+import com.graphhopper.routing.util.CarFlagEncoder;
+import com.graphhopper.routing.util.DefaultEdgeFilter;
+import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.routing.util.HintsMap;
+import static com.graphhopper.storage.GraphEdgeIdFinder.BLOCKED_EDGES;
+import static com.graphhopper.storage.GraphEdgeIdFinder.BLOCKED_SHAPES;
+import com.graphhopper.storage.index.LocationIndex;
+import com.graphhopper.storage.index.LocationIndexTree;
+import com.graphhopper.util.ConfigMap;
+import com.graphhopper.util.Parameters;
+import com.graphhopper.util.shapes.Circle;
+import com.graphhopper.util.shapes.Shape;
+import java.util.ArrayList;
+import java.util.List;
+import org.junit.Test;
+import static org.junit.Assert.*;
+
+/**
+ * @author Peter Karich
+ */
+public class GraphEdgeIdFinderTest {
+
+    @Test
+    public void testParseStringHints() {
+        FlagEncoder encoder = new CarFlagEncoder();
+        EncodingManager em = new EncodingManager(encoder);
+        GraphHopperStorage graph = new GraphBuilder(em).create();
+        // 0-1-2
+        // | |
+        // 3-4
+        graph.edge(0, 1, 1, true);
+        graph.edge(1, 2, 1, true);
+        graph.edge(3, 4, 1, true);
+        graph.edge(0, 3, 1, true);
+        graph.edge(1, 4, 1, true);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 0, 0.01, 0.00);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 1, 0.01, 0.01);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 2, 0.01, 0.02);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 3, 0.00, 0.00);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 4, 0.00, 0.01);
+
+        LocationIndex locationIndex = new LocationIndexTree(graph, new RAMDirectory())
+                .prepareIndex();
+
+        HintsMap hints = new HintsMap();
+        hints.put(Parameters.Routing.BLOCK_AREA, "0.01,0.005,1");
+
+        ConfigMap cMap = new ConfigMap();
+        GraphEdgeIdFinder graphFinder = new GraphEdgeIdFinder(graph, locationIndex);
+        ConfigMap result = graphFinder.parseStringHints(cMap, hints, new DefaultEdgeFilter(encoder));
+
+        GHIntHashSet blockedEdges = new GHIntHashSet();
+        blockedEdges.add(0);
+        assertEquals(blockedEdges, result.get(BLOCKED_EDGES, new GHIntHashSet()));
+        List<Shape> blockedShapes = new ArrayList<>();
+        assertEquals(blockedShapes, result.get(BLOCKED_SHAPES, new ArrayList<>()));
+
+        // big area converts into shapes
+        hints.put(Parameters.Routing.BLOCK_AREA, "0,0,1000");
+        result = graphFinder.parseStringHints(cMap, hints, new DefaultEdgeFilter(encoder));
+        blockedEdges.clear();
+        assertEquals(blockedEdges, result.get(BLOCKED_EDGES, new GHIntHashSet()));
+        blockedShapes.add(new Circle(0, 0, 1000));
+        assertEquals(blockedShapes, result.get(BLOCKED_SHAPES, new ArrayList<>()));
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/storage/GraphHopperStorageForDataFlagEncoderTest.java b/core/src/test/java/com/graphhopper/storage/GraphHopperStorageForDataFlagEncoderTest.java
new file mode 100644
index 0000000000..82c849d83d
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/storage/GraphHopperStorageForDataFlagEncoderTest.java
@@ -0,0 +1,102 @@
+package com.graphhopper.storage;
+
+import com.graphhopper.GraphHopper;
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.routing.AbstractRoutingAlgorithmTester;
+import com.graphhopper.routing.util.DataFlagEncoder;
+import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.routing.util.FlagEncoder;
+import com.graphhopper.util.Helper;
+import com.graphhopper.util.PMap;
+import org.junit.After;
+import org.junit.Before;
+import org.junit.Test;
+
+import java.io.Closeable;
+import java.io.File;
+import java.util.Arrays;
+
+import static org.junit.Assert.*;
+
+/**
+ * Created by tuan on 20/01/17.
+ */
+public class GraphHopperStorageForDataFlagEncoderTest {
+    private final String locationParent = "./target/graphstorage";
+    private int defaultSize = 100;
+    private String defaultGraphLoc = "./target/graphstorage/default";
+    private GraphHopperStorage graph;
+
+    private final PMap properties;
+    private final DataFlagEncoder encoder;
+    private final EncodingManager encodingManager;
+
+    public GraphHopperStorageForDataFlagEncoderTest() {
+        properties = new PMap();
+        properties.put("store_height", true);
+        properties.put("store_weight", true);
+        properties.put("store_width", false);
+        encoder = new DataFlagEncoder(properties);
+        encodingManager = new EncodingManager(Arrays.asList(encoder), 8);
+    }
+
+    @Before
+    public void setUp() {
+        Helper.removeDir(new File(locationParent));
+    }
+
+    @After
+    public void tearDown() {
+        Helper.close((Closeable) graph);
+        Helper.removeDir(new File(locationParent));
+    }
+
+
+    @Test
+    public void testStorageProperties() {
+        graph = new GraphBuilder(encodingManager).setStore(true).setLocation(defaultGraphLoc).create();
+
+        // 0-1
+        ReaderWay way_0_1 = new ReaderWay(27l);
+        way_0_1.setTag("highway", "primary");
+        way_0_1.setTag("maxheight", "4.4");
+
+        graph.edge(0, 1, 1, true);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 0, 0.00, 0.00);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 1, 0.01, 0.01);
+        graph.getEdgeIteratorState(0, 1).setFlags(encoder.handleWayTags(way_0_1, 1, 0));
+
+        // 1-2
+        ReaderWay way_1_2 = new ReaderWay(28l);
+        way_1_2.setTag("highway", "primary");
+        way_1_2.setTag("maxweight", "45");
+
+        graph.edge(1, 2, 1, true);
+        AbstractRoutingAlgorithmTester.updateDistancesFor(graph, 2, 0.02, 0.02);
+        graph.getEdgeIteratorState(1, 2).setFlags(encoder.handleWayTags(way_1_2, 1, 0));
+
+        // 2-0
+        ReaderWay way_2_0 = new ReaderWay(29l);
+        way_2_0.setTag("highway", "primary");
+        way_2_0.setTag("maxwidth", "5");
+
+        graph.edge(2, 0, 1, true);
+        graph.getEdgeIteratorState(2, 0).setFlags(encoder.handleWayTags(way_2_0, 1, 0));
+
+        graph.flush();
+        graph.close();
+
+        GraphHopper hopper = new GraphHopper().setGraphHopperLocation(defaultGraphLoc).setCHEnabled(false).importOrLoad();
+        EncodingManager em = hopper.getEncodingManager();
+        assertNotNull(em);
+        assertEquals(1, em.fetchEdgeEncoders().size());
+
+        FlagEncoder flagEncoder = em.fetchEdgeEncoders().get(0);
+        assertTrue(flagEncoder instanceof DataFlagEncoder);
+
+        DataFlagEncoder dataFlagEncoder = (DataFlagEncoder)flagEncoder;
+        assertTrue(dataFlagEncoder.isStoreHeight());
+        assertTrue(dataFlagEncoder.isStoreWeight());
+        assertFalse(dataFlagEncoder.isStoreWidth());
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/storage/GraphHopperStorageTest.java b/core/src/test/java/com/graphhopper/storage/GraphHopperStorageTest.java
index ea33fd0d76..a16c992503 100644
--- a/core/src/test/java/com/graphhopper/storage/GraphHopperStorageTest.java
+++ b/core/src/test/java/com/graphhopper/storage/GraphHopperStorageTest.java
@@ -180,7 +180,9 @@ public void internalDisconnect() {
     public void testEnsureSize() {
         Directory dir = new RAMDirectory();
         graph = newGHStorage(dir, false).create(defaultSize);
-        int testIndex = dir.find("edges").getSegmentSize() * 3;
+        int roughEdgeRowLength = 4 * 8;
+        int testIndex = dir.find("edges").getSegmentSize() * 3 / roughEdgeRowLength;
+        // we need a big node index to trigger multiple segments, but low enough to avoid OOM
         graph.edge(0, testIndex, 10, true);
 
         // test if optimize works without error
diff --git a/core/src/test/java/com/graphhopper/storage/GraphHopperStorageWithTurnCostsTest.java b/core/src/test/java/com/graphhopper/storage/GraphHopperStorageWithTurnCostsTest.java
index 2ab54ed023..76998138a8 100644
--- a/core/src/test/java/com/graphhopper/storage/GraphHopperStorageWithTurnCostsTest.java
+++ b/core/src/test/java/com/graphhopper/storage/GraphHopperStorageWithTurnCostsTest.java
@@ -93,7 +93,7 @@ public void testEnsureCapacity() throws IOException {
         graph.create(100); // 100 is the minimum size
 
         // assert that turnCostStorage can hold 104 turn cost entries at the beginning
-        assertEquals(104, turnCostStorage.getCapacity() / 16);
+        assertEquals(128, turnCostStorage.getCapacity());
 
         Random r = new Random();
 
diff --git a/core/src/test/java/com/graphhopper/storage/NativeFSLockFactoryTest.java b/core/src/test/java/com/graphhopper/storage/NativeFSLockFactoryTest.java
index 9e608b2409..86ab0813ea 100644
--- a/core/src/test/java/com/graphhopper/storage/NativeFSLockFactoryTest.java
+++ b/core/src/test/java/com/graphhopper/storage/NativeFSLockFactoryTest.java
@@ -36,11 +36,11 @@ protected LockFactory createLockFactory() {
     public void testMultiReadObtain() {
         LockFactory instance = createLockFactory();
         instance.setLockDir(lockDir);
-        Lock writeLock1 = instance.create("test", true);
+        GHLock writeLock1 = instance.create("test", true);
         assertTrue(writeLock1.tryLock());
 
         // BUT disallow more than one write lock!
-        Lock lock2 = instance.create("test", false);
+        GHLock lock2 = instance.create("test", false);
         assertFalse(lock2.tryLock());
 
         writeLock1.release();
@@ -56,7 +56,7 @@ public void testMultiReadObtain() {
         assertTrue(lock2.isLocked());
 
         // disallow write lock if currently reading
-        Lock writeLock4 = instance.create("test", true);
+        GHLock writeLock4 = instance.create("test", true);
         assertFalse(writeLock4.tryLock());
         assertEquals(OverlappingFileLockException.class, writeLock4.getObtainFailedReason().getClass());
         writeLock4.release();
diff --git a/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeCHTest.java b/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeCHTest.java
index 9e55a15717..2bc42553fd 100644
--- a/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeCHTest.java
+++ b/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeCHTest.java
@@ -17,22 +17,20 @@
  */
 package com.graphhopper.storage.index;
 
+import com.carrotsearch.hppc.IntSet;
+import com.graphhopper.coll.GHIntHashSet;
 import com.graphhopper.routing.util.EncodingManager;
 import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.weighting.FastestWeighting;
 import com.graphhopper.storage.*;
 import com.graphhopper.util.CHEdgeIteratorState;
 import com.graphhopper.util.EdgeIteratorState;
-import com.graphhopper.util.Helper;
-import gnu.trove.list.TIntList;
-import gnu.trove.set.TIntSet;
-import gnu.trove.set.hash.TIntHashSet;
 import org.junit.Test;
 
-import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
 import java.util.Comparator;
+import java.util.List;
 
 import static org.junit.Assert.assertEquals;
 
@@ -108,19 +106,16 @@ public void testSortHighLevelFirst() {
         lg.setLevel(1, 10);
         lg.setLevel(2, 30);
         lg.setLevel(3, 20);
-        TIntList tlist = Helper.createTList(1, 2, 3);
 
         // nodes with high level should come first to be covered by lower level nodes
-        ArrayList<Integer> list = Helper.tIntListToArrayList(tlist);
+        List<Integer> list = Arrays.asList(1, 2, 3);
         Collections.sort(list, new Comparator<Integer>() {
             @Override
             public int compare(Integer o1, Integer o2) {
                 return lg.getLevel(o2) - lg.getLevel(o1);
             }
         });
-        tlist.clear();
-        tlist.addAll(list);
-        assertEquals(Helper.createTList(2, 3, 1), tlist);
+        assertEquals("[2, 3, 1]", list.toString());
     }
 
     @Test
@@ -155,10 +150,10 @@ public void testCHGraphBug() {
         LocationIndexTree index = createIndex(g, 100000);
 
         // very close to 2, but should match the edge 0--1
-        TIntHashSet set = new TIntHashSet();
+        GHIntHashSet set = new GHIntHashSet();
         index.findNetworkEntries(0.51, 0.2, set, 0);
         index.findNetworkEntries(0.51, 0.2, set, 1);
-        TIntSet expectedSet = new TIntHashSet();
+        IntSet expectedSet = new GHIntHashSet();
         expectedSet.add(0);
         expectedSet.add(2);
         assertEquals(expectedSet, set);
diff --git a/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeTest.java b/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeTest.java
index 9f2b7440c7..fd9c148f7a 100644
--- a/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeTest.java
+++ b/core/src/test/java/com/graphhopper/storage/index/LocationIndexTreeTest.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.storage.index;
 
+import com.graphhopper.coll.GHIntHashSet;
 import com.graphhopper.routing.util.*;
 import com.graphhopper.storage.Directory;
 import com.graphhopper.storage.Graph;
@@ -24,7 +25,6 @@
 import com.graphhopper.storage.RAMDirectory;
 import com.graphhopper.util.*;
 import com.graphhopper.util.shapes.GHPoint;
-import gnu.trove.set.hash.TIntHashSet;
 import org.junit.Test;
 
 import java.util.Arrays;
@@ -118,10 +118,10 @@ public void testInMemIndex() {
         // [LEAF 0 {2} {},    LEAF 2 {1} {},    LEAF 1 {2} {}, LEAF 3 {1} {}, LEAF 8 {0} {}, LEAF 10 {0} {}, LEAF 9 {0} {}, LEAF 4 {2} {}, LEAF 6 {0, 3} {},       LEAF 5 {0, 2, 3} {}, LEAF 7 {1, 2, 3} {}, LEAF 13 {1} {}]
         // System.out.println(inMemIndex.getLayer(2));
 
-        TIntHashSet set = new TIntHashSet();
+        GHIntHashSet set = new GHIntHashSet();
         set.add(0);
 
-        TIntHashSet foundIds = new TIntHashSet();
+        GHIntHashSet foundIds = new GHIntHashSet();
         index.findNetworkEntries(0.5, -0.5, foundIds, 0);
         assertEquals(set, foundIds);
 
@@ -178,10 +178,10 @@ public void testInMemIndex2() {
         // get only 0 or any node in the lefter greater subgraph.
         // The other subnetwork is already perfect {26}.
         // For compaction see: https://github.com/graphhopper/graphhopper/blob/5594f7f9d98d932f365557dc37b4b2d3b7abf698/core/src/main/java/com/graphhopper/storage/index/Location2NodesNtree.java#L277
-        TIntHashSet set = new TIntHashSet();
-        set.addAll(Arrays.asList(28, 27, 26, 24, 23, 21, 19, 18, 16, 14, 6, 5, 4, 3, 2, 1, 0));
+        GHIntHashSet set = new GHIntHashSet();
+        set.addAll(28, 27, 26, 24, 23, 21, 19, 18, 16, 14, 6, 5, 4, 3, 2, 1, 0);
 
-        TIntHashSet foundIds = new TIntHashSet();
+        GHIntHashSet foundIds = new GHIntHashSet();
         index.findNetworkEntries(49.950, 11.5732, foundIds, 0);
         assertEquals(set, foundIds);
     }
@@ -412,7 +412,7 @@ public void testRMin() {
 
         assertTrue((rmin2 - check2) < 0.0001);
 
-        TIntHashSet points = new TIntHashSet();
+        GHIntHashSet points = new GHIntHashSet();
         assertEquals(Double.MAX_VALUE, index.calcMinDistance(0.05, -0.3, points), 1e-1);
 
         points.add(0);
diff --git a/core/src/test/java/com/graphhopper/util/BreadthFirstSearchTest.java b/core/src/test/java/com/graphhopper/util/BreadthFirstSearchTest.java
index ab77565e81..359956d33d 100644
--- a/core/src/test/java/com/graphhopper/util/BreadthFirstSearchTest.java
+++ b/core/src/test/java/com/graphhopper/util/BreadthFirstSearchTest.java
@@ -17,12 +17,11 @@
  */
 package com.graphhopper.util;
 
+import com.carrotsearch.hppc.IntArrayList;
+import com.graphhopper.coll.GHIntHashSet;
 import com.graphhopper.routing.util.EncodingManager;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.GraphBuilder;
-import gnu.trove.list.TIntList;
-import gnu.trove.list.array.TIntArrayList;
-import gnu.trove.set.hash.TIntHashSet;
 import org.junit.Before;
 import org.junit.Test;
 
@@ -34,8 +33,8 @@
  */
 public class BreadthFirstSearchTest {
     int counter;
-    TIntHashSet set = new TIntHashSet();
-    TIntList list = new TIntArrayList();
+    GHIntHashSet set = new GHIntHashSet();
+    IntArrayList list = new IntArrayList();
 
     @Before
     public void setup() {
@@ -73,7 +72,7 @@ public boolean goFurther(int v) {
 
         assertTrue(counter > 0);
         assertEquals(g.getNodes(), counter);
-        assertEquals("{0, 5, 3, 2, 1, 10, 8, 7, 6, 9, 4}", list.toString());
+        assertEquals("[0, 5, 3, 2, 1, 10, 8, 7, 6, 9, 4]", list.toString());
     }
 
     @Test
@@ -100,7 +99,7 @@ public boolean goFurther(int v) {
         bfs.start(g.createEdgeExplorer(), 1);
 
         assertTrue(counter > 0);
-        assertEquals("{1, 5, 2, 6, 3, 4}", list.toString());
+        assertEquals("[1, 5, 2, 6, 3, 4]", list.toString());
     }
 
 }
diff --git a/core/src/test/java/com/graphhopper/util/DepthFirstSearchTest.java b/core/src/test/java/com/graphhopper/util/DepthFirstSearchTest.java
index 645b38411b..d93b8cb5f7 100644
--- a/core/src/test/java/com/graphhopper/util/DepthFirstSearchTest.java
+++ b/core/src/test/java/com/graphhopper/util/DepthFirstSearchTest.java
@@ -17,14 +17,13 @@
  */
 package com.graphhopper.util;
 
+import com.carrotsearch.hppc.IntArrayList;
+import com.graphhopper.coll.GHIntHashSet;
 import com.graphhopper.routing.util.DefaultEdgeFilter;
 import com.graphhopper.routing.util.EncodingManager;
 import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.storage.Graph;
 import com.graphhopper.storage.GraphBuilder;
-import gnu.trove.list.TIntList;
-import gnu.trove.list.array.TIntArrayList;
-import gnu.trove.set.hash.TIntHashSet;
 import org.junit.Before;
 import org.junit.Test;
 
@@ -37,8 +36,8 @@
 public class DepthFirstSearchTest {
 
     int counter;
-    TIntHashSet set = new TIntHashSet();
-    TIntList list = new TIntArrayList();
+    GHIntHashSet set = new GHIntHashSet();
+    IntArrayList list = new IntArrayList();
 
     @Before
     public void setup() {
@@ -72,7 +71,7 @@ public boolean goFurther(int v) {
         dfs.start(g.createEdgeExplorer(new DefaultEdgeFilter(fe, false, true)), 1);
 
         assertTrue(counter > 0);
-        assertEquals("{1, 2, 3, 4, 5, 6}", list.toString());
+        assertEquals("[1, 2, 3, 4, 5, 6]", list.toString());
     }
 
     @Test
@@ -100,7 +99,7 @@ public boolean goFurther(int v) {
         dfs.start(g.createEdgeExplorer(new DefaultEdgeFilter(fe, false, true)), 1);
 
         assertTrue(counter > 0);
-        assertEquals("{1, 2, 3, 4}", list.toString());
+        assertEquals("[1, 2, 3, 4]", list.toString());
     }
 
 }
diff --git a/core/src/test/java/com/graphhopper/util/FinishInstructionTest.java b/core/src/test/java/com/graphhopper/util/FinishInstructionTest.java
new file mode 100644
index 0000000000..115365766b
--- /dev/null
+++ b/core/src/test/java/com/graphhopper/util/FinishInstructionTest.java
@@ -0,0 +1,41 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.util;
+
+import org.junit.Test;
+import static org.junit.Assert.*;
+
+/**
+ * @author Peter Karich
+ */
+public class FinishInstructionTest {
+
+    @Test
+    public void testCtor() {
+        assertTrue(new FinishInstruction("test", 123, 321, 2).getPoints().is3D());
+        assertFalse(new FinishInstruction("test", 123, 321, Double.NaN).getPoints().is3D());
+
+        PointList pointAccess = new PointList(2, true);
+        pointAccess.add(1, 2, 3);
+        assertTrue(new FinishInstruction("test", pointAccess, 0).getPoints().is3D());
+
+        pointAccess = new PointList(2, false);
+        pointAccess.add(1, 2);
+        assertFalse(new FinishInstruction("test", pointAccess, 0).getPoints().is3D());
+    }
+}
diff --git a/core/src/test/java/com/graphhopper/util/GHUtilityTest.java b/core/src/test/java/com/graphhopper/util/GHUtilityTest.java
index cf431375e0..16e7753d27 100644
--- a/core/src/test/java/com/graphhopper/util/GHUtilityTest.java
+++ b/core/src/test/java/com/graphhopper/util/GHUtilityTest.java
@@ -17,6 +17,8 @@
  */
 package com.graphhopper.util;
 
+import com.carrotsearch.hppc.LongArrayList;
+import com.graphhopper.coll.GHIntLongHashMap;
 import com.graphhopper.routing.util.CarFlagEncoder;
 import com.graphhopper.routing.util.EncodingManager;
 import com.graphhopper.routing.util.FlagEncoder;
@@ -106,7 +108,7 @@ public void testSortDirected() {
     @Test
     public void testCopyWithSelfRef() {
         Graph g = initUnsorted(createGraph());
-        EdgeIteratorState eb = g.edge(0, 0, 11, true);
+        g.edge(0, 0, 11, true);
 
         CHGraph lg = new GraphBuilder(encodingManager).chGraphCreate(new FastestWeighting(carEncoder));
         GHUtility.copyTo(g, lg);
@@ -171,4 +173,36 @@ public void testEdgeStuff() {
         assertTrue(GHUtility.isSameEdgeKeys(GHUtility.createEdgeKey(2, 1, 4, false), GHUtility.createEdgeKey(1, 2, 4, false)));
         assertFalse(GHUtility.isSameEdgeKeys(GHUtility.createEdgeKey(1, 2, 4, false), GHUtility.createEdgeKey(1, 2, 5, false)));
     }
+
+    @Test
+    public void testZeroValue() {
+        GHIntLongHashMap map1 = new GHIntLongHashMap();
+        assertFalse(map1.containsKey(0));
+        // assertFalse(map1.containsValue(0));
+        map1.put(0, 3);
+        map1.put(1, 0);
+        map1.put(2, 1);
+
+        // assertTrue(map1.containsValue(0));
+        assertEquals(3, map1.get(0));
+        assertEquals(0, map1.get(1));
+        assertEquals(1, map1.get(2));
+
+        // instead of assertEquals(-1, map1.get(3)); with hppc we have to check before:
+        assertTrue(map1.containsKey(0));
+
+        // trove4j behaviour was to return -1 if non existing:
+//        TIntLongHashMap map2 = new TIntLongHashMap(100, 0.7f, -1, -1);
+//        assertFalse(map2.containsKey(0));
+//        assertFalse(map2.containsValue(0));
+//        map2.put(0, 3);
+//        map2.put(1, 0);
+//        map2.put(2, 1);
+//        assertTrue(map2.containsKey(0));
+//        assertTrue(map2.containsValue(0));
+//        assertEquals(3, map2.get(0));
+//        assertEquals(0, map2.get(1));
+//        assertEquals(1, map2.get(2));
+//        assertEquals(-1, map2.get(3));
+    }
 }
diff --git a/core/src/test/java/com/graphhopper/util/HelperTest.java b/core/src/test/java/com/graphhopper/util/HelperTest.java
index c3768c5ced..76b740af76 100644
--- a/core/src/test/java/com/graphhopper/util/HelperTest.java
+++ b/core/src/test/java/com/graphhopper/util/HelperTest.java
@@ -47,7 +47,12 @@ public void tearDown() {
 
     @Test
     public void testCountBitValue() throws Exception {
-        assertEquals(2, Helper.countBitValue(4));
+        assertEquals(1, Helper.countBitValue(1));
+        assertEquals(2, Helper.countBitValue(2));
+        assertEquals(2, Helper.countBitValue(3));
+        assertEquals(3, Helper.countBitValue(4));
+        assertEquals(3, Helper.countBitValue(7));
+        assertEquals(4, Helper.countBitValue(8));
         assertEquals(5, Helper.countBitValue(20));
     }
 
diff --git a/core/src/test/java/com/graphhopper/util/InstructionListTest.java b/core/src/test/java/com/graphhopper/util/InstructionListTest.java
index 282cd39f0a..31fa5a97d0 100644
--- a/core/src/test/java/com/graphhopper/util/InstructionListTest.java
+++ b/core/src/test/java/com/graphhopper/util/InstructionListTest.java
@@ -108,7 +108,7 @@ public void testWayList() {
         iter2.setName("8-9");
         iter2.setWayGeometry(list);
 
-        Path p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(0, 10);
+        Path p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(0, 10);
         InstructionList wayList = p.calcInstructions(usTR);
         List<String> tmpList = pick("text", wayList.createJson());
         assertEquals(Arrays.asList("Continue onto 0-1", "Turn right onto 1-4", "Continue onto 4-7",
@@ -138,7 +138,7 @@ public void testWayList() {
                 asL(1.0, 1.2), asL(1.1, 1.3), asL(1.1, 1.4)),
                 wayList.createStartPoints());
 
-        p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(6, 2);
+        p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(6, 2);
         assertEquals(42000, p.getDistance(), 1e-2);
         assertEquals(Helper.createTList(6, 7, 8, 5, 2), p.calcNodes());
 
@@ -151,7 +151,7 @@ public void testWayList() {
                 wayList.createStartPoints());
 
         // special case of identical start and end
-        p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(0, 0);
+        p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(0, 0);
         wayList = p.calcInstructions(usTR);
         assertEquals(1, wayList.size());
         assertEquals("Finish!", wayList.get(0).getTurnDescription(usTR));
@@ -222,14 +222,14 @@ public void testWayList2() {
         list.add(10.20, 10.05);
         iter.setWayGeometry(list);
 
-        Path p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(2, 3);
+        Path p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(2, 3);
 
         InstructionList wayList = p.calcInstructions(usTR);
         List<String> tmpList = pick("text", wayList.createJson());
         assertEquals(Arrays.asList("Continue onto 2-4", "Turn slight right onto 3-4", "Finish!"),
                 tmpList);
 
-        p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(3, 5);
+        p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(3, 5);
         wayList = p.calcInstructions(usTR);
         tmpList = pick("text", wayList.createJson());
         assertEquals(Arrays.asList("Continue onto 3-4", "Continue onto 4-5", "Finish!"),
@@ -260,7 +260,7 @@ public void testNoInstructionIfSameStreet() {
         list.add(10.20, 10.05);
         iter.setWayGeometry(list);
 
-        Path p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(2, 3);
+        Path p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(2, 3);
         InstructionList wayList = p.calcInstructions(usTR);
         List<String> tmpList = pick("text", wayList.createJson());
         assertEquals(Arrays.asList("Continue onto street", "Finish!"), tmpList);
@@ -286,7 +286,7 @@ public void testInstructionsWithTimeAndPlace() {
         g.edge(3, 4, 9000, true).setName("3-4").setFlags(flagsForSpeed(carManager, 90));
         g.edge(4, 5, 10000, true).setName("4-5").setFlags(flagsForSpeed(carManager, 100));
 
-        Path p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(1, 5);
+        Path p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(1, 5);
         InstructionList wayList = p.calcInstructions(usTR);
         assertEquals(5, wayList.size());
 
@@ -442,7 +442,7 @@ private long flagsForSpeed(EncodingManager encodingManager, int speedKmPerHour)
     @Test
     public void testEmptyList() {
         Graph g = new GraphBuilder(carManager).create();
-        Path p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(0, 1);
+        Path p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(0, 1);
         InstructionList il = p.calcInstructions(usTR);
         assertEquals(0, il.size());
         assertEquals(0, il.createStartPoints().size());
@@ -489,7 +489,7 @@ public void testFind() {
         g.edge(3, 4, 10000, true).setName("3-4").setWayGeometry(waypoint);
         g.edge(4, 5, 10000, true).setName("4-5");
 
-        Path p = new Dijkstra(g, carEncoder, new ShortestWeighting(carEncoder), tMode).calcPath(1, 5);
+        Path p = new Dijkstra(g, new ShortestWeighting(carEncoder), tMode).calcPath(1, 5);
         InstructionList wayList = p.calcInstructions(usTR);
 
         // query on first edge, get instruction for second edge
diff --git a/core/src/test/java/com/graphhopper/util/shapes/BBoxTest.java b/core/src/test/java/com/graphhopper/util/shapes/BBoxTest.java
index 81dbd4f8c9..6b217d0ca9 100644
--- a/core/src/test/java/com/graphhopper/util/shapes/BBoxTest.java
+++ b/core/src/test/java/com/graphhopper/util/shapes/BBoxTest.java
@@ -56,6 +56,14 @@ public void testContains() {
         assertFalse(new BBox(8.9, 11.09, 8.9, 11.2).contains(c));
     }
 
+    @Test
+    public void testGetCenter() {
+        BBox bBox = new BBox(0, 2, 0, 2);
+        GHPoint center = bBox.getCenter();
+        assertEquals(1, center.getLat(), .00001);
+        assertEquals(1, center.getLon(), .00001);
+    }
+
     @Test
     public void testIntersect() {
         //    ---
@@ -121,4 +129,11 @@ public boolean intersect(BBox b) {
             }
         });
     }
+
+    @Test
+    public void testParseTwoPoints() {
+        assertEquals(new BBox(2, 4, 1, 3), BBox.parseTwoPoints("1,2,3,4"));
+        // stable parsing, i.e. if first point is in north or south it does not matter:
+        assertEquals(new BBox(2, 4, 1, 3), BBox.parseTwoPoints("3,2,1,4"));
+    }
 }
diff --git a/core/src/test/java/com/graphhopper/util/shapes/CircleTest.java b/core/src/test/java/com/graphhopper/util/shapes/CircleTest.java
index ed63c1708d..57cee5b29d 100644
--- a/core/src/test/java/com/graphhopper/util/shapes/CircleTest.java
+++ b/core/src/test/java/com/graphhopper/util/shapes/CircleTest.java
@@ -19,6 +19,7 @@
 
 import org.junit.Test;
 
+import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertTrue;
 
@@ -49,6 +50,14 @@ public void testContains() {
         assertFalse(c.contains(new BBox(9, 12, 10, 10.1)));
     }
 
+    @Test
+    public void testGetCenter() {
+        Circle c = new Circle(10, 10, 10);
+        GHPoint center = c.getCenter();
+        assertEquals(10, center.getLat(), .00001);
+        assertEquals(10, center.getLon(), .00001);
+    }
+
     @Test
     public void testContainsCircle() {
         Circle c = new Circle(10, 10, 120000);
diff --git a/docs/android/android-studio-setup.md b/docs/android/android-studio-setup.md
index 913bee91b9..9ba53c6fe8 100644
--- a/docs/android/android-studio-setup.md
+++ b/docs/android/android-studio-setup.md
@@ -5,7 +5,6 @@ Get the [GraphHopper sources and demo](./index.md) before you proceed.
 ## Setup
 
 [Download](http://developer.android.com/sdk/index.html) and start android studio. 
-Now you need to import the code formatting settings (File|Import Settings). Load them from core/files/intellij-settings.jar
 
 Open existing Android studio project and then open 'graphhopper/android' not the parent 'graphhopper'
 
diff --git a/docs/android/index.md b/docs/android/index.md
index 883563ad9c..5d299f7644 100644
--- a/docs/android/index.md
+++ b/docs/android/index.md
@@ -1,11 +1,13 @@
 # Get Demo
 
-[Download GraphHopper Demo APK](http://graphhopper.com/#download)
+[Download GraphHopper Demo APK](http://graphhopper.com/#community)
+
+![simple routing](https://graphhopper.com/blog/wp-content/uploads/2016/10/android-demo-screenshot-2.png)
 
 # Set-up Development
 
 As starting point you can use [the demo project](https://github.com/graphhopper/graphhopper/tree/master/android) 
-which can be used from Android Studio, NetBeans, gradle or maven.
+which can be used directly from Android Studio and NetBeans via gradle or maven.
 
 Before the installation fetch the source, the OpenStreetMap data and the dependencies:
 
@@ -38,9 +40,9 @@ $ gradle installDebug
 
 ## Maps
 
-Now that you have a running android app you need to copy somehow the routing and maps data. 
+Now that you have a running Android app you need to copy the routing and maps data to the device. 
 
- 1. [Download the raw openstreetmap file](http://download.geofabrik.de/openstreetmap/) - you'll need that only for the next step to create the routing data
+ 1. [Download the raw openstreetmap file](http://download.geofabrik.de/openstreetmap/) - you'll need that for the next step to create the routing data
  2. Execute `./graphhopper.sh import <your-osm-file>`. This creates the routing data
  3. [Download a map](http://download.mapsforge.org/maps/) e.g. berlin.map
  4. Copy berlin.map into the created berlin-gh folder
@@ -80,27 +82,28 @@ The [GraphHopper Directions API Java client](https://github.com/graphhopper/dire
 ## Problems
 
 If you encounter problems like 'trouble writing output: Too many methods: 72332; max is 65536.' or you 
-want to reduce the size of the jar/apk size you can try to apply autojar on trove4j:
+want to reduce the size of the jar/apk size you can try to apply autojar on hppc:
 
 ```bash
-java -jar autojar-2.1/autojar.jar -o trove4j-stripped.jar -c $TROVE_SRC/target/classes @trove-class.list
+java -jar autojar-2.1/autojar.jar -o trove4j-stripped.jar -c $TROVE_SRC/target/classes @class.list
 ```
 
-where trove-class.list is a file with the required classes for GraphHopper as content:
+where class.list is a file with the required classes for GraphHopper as content:
 
 ```text
-gnu.trove.list.TDoubleList.class
-gnu.trove.list.TIntList.class
-gnu.trove.list.array.TDoubleArrayList.class
-gnu.trove.list.array.TIntArrayList.class
-gnu.trove.map.TIntObjectMap.class
-gnu.trove.map.hash.TIntObjectHashMap.class
-gnu.trove.map.hash.TIntIntHashMap.class
-gnu.trove.set.hash.TIntHashSet.class
-gnu.trove.iterator.TIntIterator.class
-gnu.trove.procedure.TIntProcedure.class
-gnu.trove.procedure.TObjectProcedure.class
-gnu.trove.stack.array.TIntArrayStack.class
+com.carrotsearch.hppc.IntArrayList
+com.carrotsearch.hppc.IntObjectHashMap.class
+com.carrotsearch.hppc.IntHashSet
+com.carrotsearch.hppc.IntLongHashMap
+com.carrotsearch.hppc.IntContainer
+com.carrotsearch.hppc.LongHashSet
+com.carrotsearch.hppc.LongObjectHashMap
+com.carrotsearch.hppc.ObjectIntAssociativeContainer
+com.carrotsearch.hppc.ObjectIntHashMap
+com.carrotsearch.hppc.HashOrderMixing
+com.carrotsearch.hppc.HashOrderMixingStrategy
+com.carrotsearch.hppc.cursors.IntCursor
+...
 ```
 
 
diff --git a/docs/core/ch.md b/docs/core/ch.md
index f1e3ef6e8c..c8c1540921 100644
--- a/docs/core/ch.md
+++ b/docs/core/ch.md
@@ -8,4 +8,4 @@ which allows to store shortcuts too.
 
 A prepared graph can also be used for normal graph traversal IF you use chGraph.getBaseGraph().
 
-If CH is enabled multiple vehicles will work but only one works in speed-up mode and is faster, see issue #111.
+If CH is enabled multiple vehicles will work.
diff --git a/docs/core/deploy.md b/docs/core/deploy.md
index a61280c750..09e34c0d5f 100644
--- a/docs/core/deploy.md
+++ b/docs/core/deploy.md
@@ -19,35 +19,33 @@ export JAVA=java-home/bin/java
 export JAVA_OPTIONS="-server -Xconcurrentio -Xmx17000m -Xms17000m"
 ```
 
-Important notes:
+Notes:
 
  * jsonp support needs to be enabled in the config.properties
- * none-hierarchical graphs should be limited to a certain distance otherwise you'll require lots of RAM per request! See [#104](https://github.com/graphhopper/graphhopper/issues/104)
- * if you have strange speed problems which could be related to low memory you can try to [entire disable swap](http://askubuntu.com/questions/103915/how-do-i-configure-swappiness). Or just try it out via `sudo swapoff -a`. Swapping out is very harmful to Java programs especially when the GC kicks in.
+ * none-hierarchical graphs should be limited to a certain distance otherwise you'll require lots of RAM per request! See [#104](https://github.com/graphhopper/graphhopper/issues/734)
 
 ### API Tokens
 
-By default, GraphHopper uses [Omniscale](http://omniscale.com/) as layer service. 
-Either you get a plan there or you have to remove Omniscale from the [JavaScript file](https://github.com/graphhopper/graphhopper/blob/master/web/src/main/webapp/js/main.js). 
+By default, GraphHopper uses [Omniscale](http://omniscale.com/) and/or [Thunderforest](http://thunderforest.com/) as layer service. 
+Either you get a plan there, then set the API key in the options.js file or you 
+have to remove Omniscale from the [JavaScript file](https://github.com/graphhopper/graphhopper/blob/master/web/src/main/webapp/js/main.js). 
  
 GraphHopper uses the [GraphHopper Directions API](https://graphhopper.com/api/1/docs/) for geocoding. To be able to use the autocomplete feature of the point inputs you have to:
 
- * Get your API Token at: https://graphhopper.com/
- * Uncomment this [line](https://github.com/graphhopper/graphhopper/blob/master/web/src/main/webapp/js/main-template.js#L37) and insert your API Token as second parameter.
-   * Don't forget the Attribution
+ * Get your API Token at: https://graphhopper.com/ and set this in the options.js
+ * Don't forget the Attribution
  
 ## World Wide 
 
-GraphHopper is able to handle coverage for the whole [Openstreetmap road network](http://planet.osm.org/). 
+GraphHopper is able to handle coverage for the whole [OpenStreetMap road network](http://planet.osm.org/). 
 It needs approximately 22GB RAM for the import (CAR only) and ~1 hour (plus ~5h for contraction). 
 If you can accept slower import times this can be reduced to 14GB RAM - you'll need to set datareader.dataaccess=MMAP
 
-Then, to run the web service with this world wide graph 'only' 15GB are necessary. Without contraction hierarchy 
-this would be about 9GB.
+Then 'only' 15GB are necessary. Without contraction hierarchy this would be about 9GB.
 
 With CH the service is able to handle about 180 queries per second (from localhost to localhost this was 300qps). 
 Measured for CAR routing, real world requests, at least 100km long, on a linux machine with 8 cores and 32GB, 
-java 1.7.0_25, jetty 8.1.10 via custom QueryTorture class (10 worker threads).
+java 1.7.0_25, jetty 8.1.10 via the QueryTorture class (10 worker threads).
 
 ### System and JVM tuning
 
@@ -66,8 +64,3 @@ If you want to use elevation data you need to increase the allowed number of ope
  * add: `fs.file-max = 90000`
  * reboot now (or sudo sysctl -p; and re-login)
  * afterwards `ulimit -Hn` and `ulimit -Sn` should give you 100000
-
-
-### TODOs
-
- * Try out to disable NUMA -> http://engineering.linkedin.com/performance/optimizing-linux-memory-management-low-latency-high-throughput-databases
diff --git a/docs/core/location-index.md b/docs/core/location-index.md
index 69a18b839a..160d8bff78 100644
--- a/docs/core/location-index.md
+++ b/docs/core/location-index.md
@@ -1,3 +1,5 @@
+# Location Index
+
 You get the location index from the GraphHopper instance, after you imported or loaded the data:
 
 ```java
diff --git a/docs/core/low-level-api.md b/docs/core/low-level-api.md
index de8cf7fe1a..73c5b09624 100644
--- a/docs/core/low-level-api.md
+++ b/docs/core/low-level-api.md
@@ -21,9 +21,12 @@ edges the same applies for edge IDs too.
 
 ### What are virtual edges and nodes?
 
-For a route you do not only need *junction-precision*, i.e. from tower node to tower node, but we want *GPS-precise* routes, otherwise [you'll get lots of trouble](https://github.com/graphhopper/graphhopper/issues/27) for oneways and similar.
+For a route you do not only need *junction-precision*, i.e. from tower node to tower node, but we want 
+*GPS-precise* routes, otherwise [you'll get lots of trouble](https://github.com/graphhopper/graphhopper/issues/27) 
+for oneways and similar.
 
-To make GPS precise routes possible, although we route from tower node to tower node, we introduce one new virtual node x and virtual edges A-x, x-B for every query point located on an edge A-B:
+To make GPS precise routes possible, although we route from tower node to tower node, we introduce one new 
+virtual node x and virtual edges A-x, x-B for every query point located on an edge A-B:
 
 ```bash
 \                /
@@ -31,11 +34,13 @@ To make GPS precise routes possible, although we route from tower node to tower
 /                \
 ```
 
-But we need to decouple requests from each other and therefor we create a very lightweight graph called `QueryGraph` for every request which handles also stuff like two query points on the same edge.
+But we need to decouple requests from each other and therefor we create a very lightweight graph called 
+`QueryGraph` for every request which handles also stuff like two query points on the same edge.
 
 The virtual nodes and edges have a higher `int` ID than `graph.getNodes()` or `allEdges.getMaxId()`
 
-A call `queryGraph.lookup(allQRs)` will determine the correct node for all `QueryResult`s: and either create new virtual nodes or if close enough use the existing junction node.
+A call `queryGraph.lookup(allQRs)` will determine the correct node for all `QueryResult`s: and either 
+create new virtual nodes or if close enough use the existing junction node.
 
 ### Create and save the graph
 
@@ -48,7 +53,7 @@ GraphStorage graph = gb.create();
 EdgeIteratorState edge = graph.edge(fromId, toId);
 edge.setDistance(distance);
 edge.setFlags(encoder.setProperties(speed, true, true));
-// Store to disc
+// Flush to disc
 graph.flush();
 ```
 
@@ -117,7 +122,7 @@ queryGraph.lookup(fromQR, toQR);
 
 // create the algorithm using the PrepareContractionHierarchies object
 AlgorithmOptions algoOpts = AlgorithmOptions.start().
-   algorithm(Parameters.Algorithms.DIJKSTRA_BI).traversalMode(tMode).flagEncoder(encoder).weighting(weighting).
+   algorithm(Parameters.Algorithms.DIJKSTRA_BI).traversalMode(tMode).weighting(weighting).
    build();
 RoutingAlgorithm algorithm = pch.createAlgo(queryGraph, algoOpts);
 Path path = algorithm.calcPath(fromQR.getClosestNode(), toQR.getClosestNode());
diff --git a/docs/core/quickstart-from-source.md b/docs/core/quickstart-from-source.md
index f6ccb51590..8eb2df1e5a 100644
--- a/docs/core/quickstart-from-source.md
+++ b/docs/core/quickstart-from-source.md
@@ -1,11 +1,13 @@
 # GraphHopper - Quick Start Guide for Developers
 
+[Watch this video](https://www.youtube.com/watch?v=HBVe_E5j0TM) for a simple introduction.
+
 ## Try out
 
 For a start which requires only the JRE have a look [here](../web/quickstart.md). 
 Windows user can find a quick guide [here](./windows-setup.md). 
 
-Now, before you proceed install git and jdk7 or 8, then do:
+Now, before you proceed install git and jdk8, then do:
 
 ```bash
 $ git clone git://github.com/graphhopper/graphhopper.git
@@ -29,22 +31,12 @@ $ ./graphhopper.sh web north-america_us_new-york.pbf
 
 ## Start Development
 
-Open the project with NetBeans, IntelliJ or enable Maven in your IDE. 
-[Maven](http://maven.apache.org/download.cgi) is downloaded to ```graphhopper/maven``` if not 
-installed when executing graphhopper.sh.
-
-### NetBeans, IntelliJ, Eclipse
-
- * For IntelliJ you need to import the code formatting settings (File|Import Settings). Load them from `core/files/intellij-settings.jar`. See the [special setup](../android/android-studio-setup.md) for Android if using Android studio.
-   * For IntelliJ15 there is also a formatting description, that should be imported using (Preferences|Editor|Code Style|Java|Manage|Import) from `core/files/IntelliJ15GraphHopperFormatting.xml`. 
- * For Eclipse please refer to [this separate setup documentation](./eclipse-setup.md).
- * Nothing special needs to be done for NetBeans.
+Open the project in your IDE, first class IDEs are NetBeans and IntelliJ where no further setup is required.
 
 ### Java, Embedded Usage
 
-Have a look into the [Java API documentation](./) for further details e.g. how [GraphHopper can
-be embedded](./routing.md) into your application and like a [custom weighting](./weighting.md) 
-can be implemented.
+Have a look into the [Java API documentation](../index.md#developer) for further details e.g. how [GraphHopper can
+be embedded](./routing.md) into your application and how you create a [custom weighting](./weighting.md).
 
 Look [here](http://graphhopper.com/#community) for the maven snippet to use GraphHopper in your
 application. To use an unreleased snapshot version of GraphHopper you need the following snippet in your pom.xml
@@ -65,33 +57,10 @@ as those versions are not in maven central:
     </repositories>
 ```
 
-### Java, Routing Server Usage
-
-The Web API documentation is [here](../web). 
-We provide Java client code [here](https://github.com/graphhopper/graphhopper/blob/d70b63660ac5200b03c38ba3406b8f93976628a6/web/src/main/java/com/graphhopper/http/GraphHopperWeb.java#L43)
-to query the routing server.
-
-The routing API (json,jsonp,gpx) is optimized regarding several aspects:
- * It tries to return a smallish data set (encoded polyline, gzip filter)
- * It enables cross-site scripting on the server- and client-site
- * The JavaScript client utilizes the jquery Deferred object to chain ajax requests and avoids browser UI blocking when resolving locations in parallel.
-
-#### Routing Service Deployment
+### JavaScript
 
-If you want to setup graphhopper on your own server, we have a separate information page [Deploy](./deploy.md).
-
-### JavaScript Usage
-
-For an example of how to use graphhopper in a web application see the 
-[web subfolder](https://github.com/graphhopper/graphhopper/tree/master/web)
-
-The routing server can be queried from [JavaScript](https://github.com/graphhopper/graphhopper/blob/d70b63660ac5200b03c38ba3406b8f93976628a6/web/src/main/webapp/js/ghrequest.js)
-as well. You can see this in action at [GraphHopper Maps](https://graphhopper.com/maps/).
-
-If you need **offline** routing in the browser like for smaller areas or hybrid routing solution
-then there is a highly experimental version of GraphHopper using TeaVM. 
-Have a look into this [blog post](http://karussell.wordpress.com/2014/05/04/graphhopper-in-the-browser-teavm-makes-offline-routing-via-openstreetmap-possible-in-javascript/) 
-for a demo and more information.
+When you started GraphHopper via `./graphhopper.sh web <your_osm.pbf>` a web server is already
+started and waiting for your commands. You can see this for the whole world at [GraphHopper Maps](https://graphhopper.com/maps/).
 
 If you want to change the JavaScript you have to setup the JavaScript environment - 
 i.e. install the node package manager (npm):
@@ -106,18 +75,18 @@ nvm use 4.2.2
 
 For windows download either [nvm](https://github.com/coreybutler/nvm-windows) or [node](https://nodejs.org/en/download/) directly.
 
-Then create the main.js
+Then generate the main.js
 ```bash
 # git clone https://github.com/graphhopper/graphhopper.git
 cd graphhopper/web
 # download required packages:
 npm install
 npm test
-# create main.js
+# overwrites main.js
 npm run bundle
 ```
 
-Finally start GraphHopper e.g. via `graphhopper.sh` script and with the browser open `localhost:8989`.
+Finally start GraphHopper e.g. via the `./graphhopper.sh` script and open the browser at `localhost:8989`.
 
 There are more npm commands e.g. to change the main.js on the fly or create an uglified main.js for production:
 ```bash
@@ -139,31 +108,27 @@ npm run lint
 # see the package.json where more scripts are defined
 ```
 
+### Experimental
+
+If you need **offline** routing in the browser like for smaller areas or hybrid routing solution
+then there is a highly experimental version of GraphHopper using TeaVM. 
+Have a look into this [blog post](http://karussell.wordpress.com/2014/05/04/graphhopper-in-the-browser-teavm-makes-offline-routing-via-openstreetmap-possible-in-javascript/) 
+for a demo and more information.
+
 ### Android Usage
  
-For details on Android-usage have a look into this [Android site](../android/index.md) or at the
-[Android example](https://github.com/graphhopper/graphhopper/tree/master/android)
+For details on Android-usage have a look into this [Android site](../android/index.md)
 
 ### Swing and Desktop Usage
 
-You can use graphhopper on the Desktop with the help of the latest mapsforge swing library too. No example code
-yet but with the Android example combined with the Desktop example of the mapsforge project it should not be
-that hard.
+You can use Graphhopper on the Desktop with the help of mapsforge too. No example code is given yet 
+but with the Android example combined with the Desktop example of the mapsforge project it should not be hard.
 
 For smallish graph (e.g. size of Berlin) use a RAMDataAccess driven GraphStorage (loads all into memory).
-For larger ones use the ContractionHierarchies preparation class and MMapDataAccess to avoid OutOfMemoryErrors. 
+For larger ones use the ContractionHierarchies preparation class and MMapDataAccess to avoid OutOfMemoryErrors if you have only few RAM. 
 
 Raspberry Pi usage is also possible. Have a look into this [blog post](https://karussell.wordpress.com/2014/01/09/road-routing-on-raspberry-pi-with-graphhopper/).
 
 ## Contribute
 
 See this [contributing guide](https://github.com/graphhopper/graphhopper/blob/master/.github/CONTRIBUTING.md) on how to contribute.
-
-## Technical Details
-
-Have a look in the more [technical documentation](./technical.md) or the [low level API](./low-level-api.md).
-
-Further Links
----------------
- * [Spatial Key](http://karussell.wordpress.com/2012/05/23/spatial-keys-memory-efficient-geohashes/)
- * [Author@Twitter](https://twitter.com/timetabling)
diff --git a/docs/core/routing.md b/docs/core/routing.md
index 1e0ba552c9..bcde1d8d80 100644
--- a/docs/core/routing.md
+++ b/docs/core/routing.md
@@ -5,7 +5,7 @@ To do routing in your Java code you'll need just a few lines of code:
 ```java
 // create one GraphHopper instance
 GraphHopper hopper = new GraphHopperOSM().forServer();
-hopper.setOSMFile(osmFile);
+hopper.setDataReaderFile(osmFile);
 // where to store graphhopper files?
 hopper.setGraphHopperLocation(graphFolder);
 hopper.setEncodingManager(new EncodingManager("car"));
@@ -54,9 +54,10 @@ List<GPXEntry> list = il.createGPXList();
 
 The default is to use the speed-up mode. If you need multiple profiles you specify a list of profiles (e.g. car,bike). 
 
-You can also completely disable the speed-up mode to make all vehicles using the flexibility mode via setting `prepare.chWeighting=no` also see issue #631 for a "per request" configuration.
+You can also completely disable the speed-up mode before import (see config.properties `prepare.ch.weightings=no`)
+or for a per request setting (`ch.disable=true`). 
 
-Then pick one vehicle and optionally the algorithm like 'bidirectional astar' as algorithm:
+Then pick one vehicle and optionally an algorithm like 'bidirectional astar':
 
 ```java
 GraphHopper hopper = new GraphHopperOSM().forServer();
diff --git a/docs/core/technical.md b/docs/core/technical.md
index 84e3b4f14d..3e168b6a37 100644
--- a/docs/core/technical.md
+++ b/docs/core/technical.md
@@ -9,17 +9,18 @@ There are mainly three parts:
 ### 1. Data Import
 
 The default import is done via OSMReader which imports OpenStreetMap data. You can configure it via API 
-or use the graphhopper.sh script which utilizes the config.properties where you can specify if it should 
-read CAR, FOOT etc or all at once. You'll have to make sure that you allocate enough memory for your 
-specific graph (E.g. ~1GB for Germany) e.g. `export JAVA_OPTS="-Xmx1g"`. The import process is fast e.g. 
-complete germany takes about 10 minutes on my oldish laptop. Additionally it will take time if you choose 
-prepare.chWeighting=fastest in the config.properties which will dramatically improve query time
+or use the `graphhopper.sh` script which utilizes the config.properties where you can specify if it should 
+read `car`, `foot` or all vehicles at once. You'll have to make sure that you allocate enough memory for your 
+specific graph (E.g. ~2GB for Germany) e.g. `export JAVA_OPTS="-Xmx2g"`. The import process is fast e.g. 
+complete Germany takes roughly 10 minutes. Additionally it will take time if you choose 
+`prepare.ch.weightings=fastest` in the config.properties which will dramatically improve query time
 but requires more RAM on import.
 
 ### 2. The Graph
 
 To process algorithms you need a _Graph_. At the moment there is one main implementation GraphHopperStorage 
-which can be used: 
+which can be used:
+
   * in-memory with a safe/flush option (RAMDataAccess) and 
   * a memory mapped (MMapDataAccess).
 
@@ -37,22 +38,24 @@ Some explanations:
  * One 'edge row' consists of two edgeIDs: nextA and nextB, then two nodeIDs nodeA and nodeB, and finally some properties like the distance and the flags.
  * One node has several edges which is implemented as a linked list. E.g. node 3 points to its first edge in the edge area at position 0 to edge 0-3 (nodeA-nodeB where nodeA is always smaller than nodeB). To get the next edge of node 3 you need nextB and this goes to edge 1-3, again node 3 is nodeB, but for the next edge 3-5 node 3 is nodeA ... and so on.
  * For you custom data import keep in mind that although the nodes 4 and 6 have no edges they still 'exist' and consume space in the current implementations of DataAccess. For OSMReader this cannot be the case as separate networks with only a small number of nodes are removed (very likely OSM bugs).
+ * If CH is enabled the storage adds information for shortcuts, see [this issue](https://github.com/graphhopper/graphhopper/pull/447) for more details.
 
 For some algorithms there are special implementations of the Graph (CHGraph). You enable this in GraphHopperStorage
 to store shortcut edges and a level for every node. This special storage is necessary for _Contraction Hierarchies_. 
 For this the graph needs also some preprocessing (which can take several minutes for bigger areas) 
-which is done in the OSMReader when configured (prepare.chWeighting=fastest) or via API in PrepareContractionHierarchies. 
+which is done in the OSMReader when configured or via API in PrepareContractionHierarchies. 
 In order to use the shortcuts and get the benefits of the optimized graph you must use the algorithm returned from 
 createAlgo() in the preparation class.
 
-Also there is a file version which is changed if the data structure of GraphHopper gets incompatible to the previous versions.
+Also there is a version in every vehicle and every data structure which is changed if the 
+data structure of GraphHopper gets incompatible to the previous versions.
 
 ### 3. The Algorithms
 
 In the routing package you'll find some shortest path algorithms like Dijkstra or A* etc. For those 
 algorithms you need a _Graph_.
 
-An algorithm needs a kind of path extraction: from the shortest-path-tree one needs to determine the route 
+An algorithm needs the path extraction: from the shortest-path-tree one needs to determine the route 
 (list of edges) including the distance and time. Afterwards from this list the exact point (latitude,longitude) 
 can be determined. For bidirectional algorithms this is a bit more complicated and done in PathBidirRef. 
 For [_Contraction Hierarchies_](http://ad-wiki.informatik.uni-freiburg.de/teaching/EfficientRoutePlanningSS2012)
@@ -72,8 +75,7 @@ or similar. See issue #116 for more information.
 ## 4.1 LocationIndex
 
 In real world we have addresses and/or coordinates for the start and end point. 
-To get the coordinate from an address you will need a geocoding solution not part of GraphHopper,
-e.g. have a look into our [Routing Web API](http://graphhopper.com/#enterprise) for more information about this topic.
+To get the coordinate from an address you will need a geocoding solution not part of GraphHopper.
 
 To get the closest node or edge id from a coordinate we provide you with an efficient lookup concept:
 the LocationIndex. There are multiple implementations
@@ -83,6 +85,8 @@ See [here](./location-index.md) for more information. See #17 and #221.
 
 ## 4.2 QueryGraph
 
-In order to route not only from junctions (which are nodes) we introduced the _QueryGraph_ in issue #27,
+In order to route not only from junctions (which are nodes) we introduced with the _QueryGraph_ in issue #27,
 which creates virtual nodes and edges at the query coordinates. It provides a lightweight wrapper around
 the _Graph_ and is created per query so that queries do not influence each other.
+
+It can be also introduced for all kinds of dynamically changed nodes and is tested for a few thousand locations.
diff --git a/docs/core/weighting.md b/docs/core/weighting.md
index adf01c47dd..e82c171e67 100644
--- a/docs/core/weighting.md
+++ b/docs/core/weighting.md
@@ -34,7 +34,7 @@ class MyGraphHopper extends GraphHopper {
 }
 ```
 
-For forbiddenEdges you need to determine the edges from some GPS coordinates. 
+For `forbiddenEdges` you need to determine the edges from some GPS coordinates. 
 Have a look into the [location index docs](./location-index.md). 
 
 If your blocking edges change per-request you need to disable the speed mode e.g. via `prepare.ch.weightings=no`
diff --git a/docs/index.md b/docs/index.md
index 7767dc50e3..3a5aab308e 100644
--- a/docs/index.md
+++ b/docs/index.md
@@ -1,42 +1,79 @@
 # GraphHopper Documentation
 
-## Users
+## Getting Started
+
+Try out our live demo called [GraphHopper Maps](https://graphhopper.com/maps)
+
+ [![GraphHopper Maps](https://karussell.files.wordpress.com/2014/12/graphhopper-maps-0-4-preview.png)](https://graphhopper.com/maps)
+
+[The Readme](../README.md#features) lists all features or [this list of slides](https://graphhopper.com/public/slides/).
+
+See [more users of GraphHopper](https://graphhopper.com/#usecases) or [Android apps](./android/index.md#apps) and let us know your application!
+
+## Contact
+
+For all questions regarding the GraphHopper routing engine please use [our forum](https://discuss.graphhopper.com). 
+
+For bugs see our contribute section below.
+
+## User
+
+[The user guide](./web/quickstart.md) is the HowTo for users. Other links:
 
- * [Quickstart](./web/quickstart.md): HowTo for users.
- * [Read Overview](https://graphhopper.com/#overview): Summary of the product GraphHopper. 
  * [Add GraphHopper Maps to your Browser](./web/open-search.md): Instructions how to setup GraphHopper as the standard search enginge in your browser.
  * [Embed GraphHopper on your website](https://github.com/karussell/graphhopper-embed-form): A small code snippet on how to integrate GraphHopper Maps in your web site like a contact form
 
-## Translators
+## Web
 
-* [Translations](./core/translations.md): Tutorial how to help with the GraphHopper translations or how to setup a new language.
+The web module provides a web API for other programming languages as well as starts a simple user interface called GraphHopper Maps
 
+ * [Routing API](./web/api-doc.md): Documentation of the Web API to communicate with any GraphHopper server via http.
+ * [Deployment Guide](./core/deploy.md): Details about deploying GraphHopper
+ * [Postgis query script](../core/files/postgis)
+ * There are official API clients in [Java](https://github.com/graphhopper/directions-api-java-client/) and [JavaScript](https://github.com/graphhopper/directions-api-js-client).
 
-## Developers
+### Configuration
 
- * [Quickstart](./core/quickstart-from-source.md): Introduction for developers. Explains git checkout, IDE setup and commands for setting up a GraphHopper server.
- * [Android](./android/index.md): Instructions how to setup the demo project for GraphHopper on Android as base for further development (i.e. with Android Studio).
- * [Windows](./core/windows-setup.md): Documentation about how to get an GraphHopper instance running on windows (cygwin).
- * [Set up and run GraphHopper in Eclipse](./core/eclipse-setup.md): Detailed instructions how to setup GraphHopper in eclipse with maven.
- * [iOS](https://github.com/graphhopper/graphhopper-ios/): Link to the GraphHopper-iOS github repository.
+You can configure several aspects either programmatically or just via the [config.properties](../config-example.properties).
 
-### Core
+The elevation configuration is separately documented [here](./core/elevation.md).
 
- * [Simple routing](./core/routing.md): Tutorial how to integrate GraphHopper in your Java application (or pick any JVM language)
- * [Create custom weighting](./core/weighting.md): Documentation about how to create a custom weighting class to influence the track calculation.
- * [Elevation](./core/elevation.md): Documentation how to enable the usage of elevation for the output of the track.
- * [Slides](https://graphhopper.com/public/slides/): Small presentations about how GraphHopper is working.
+## Developer
 
-### Web
+[The quickstart](./core/quickstart-from-source.md) is an introduction for developers. Explains git checkout, IDE setup and commands for setting up a GraphHopper server.
 
- * [Routing API](./web/api-doc.md): Documentation of the Web API to communicate with any GraphHopper server via http.
- * [Deployment Guide](./core/deploy.md): Details about deploying GraphHopper.
+Find all changes in previous and current versions in the [changelogs](../core/files/changelogs.txt).
+
+### Contribute
+
+Read [here](../.github/CONTRIBUTING.md) on how to contribute as a developer and translator.
 
-### Advanced Topics
+### Technical
+
+Various topics are explained in more detail separately:
 
  * [Technical overview](./core/technical.md): Technical details about how GraphHopper its calculations are working.
- * [Contraction Hierarchies](./core/ch.md): Details about speeding up the track calculations by [Contraction Hierarchies](http://en.wikipedia.org/wiki/Contraction_hierarchies).
+ * [Simple routing](./core/routing.md): Tutorial how to integrate GraphHopper in your Java application (or pick any JVM language)
+ * [Create custom weighting](./core/weighting.md): Documentation about how to create a custom weighting class to influence the track calculation.
+ * [LocationIndex](./core/location-index.md): Documentation about how to get the location index for getting i.e. the nearest edge. 
  * [Low level API](./core/low-level-api.md): Instructions how to use GraphHopper as a Java library.
+ * [Contraction Hierarchies](./core/ch.md): Details about speeding up the track calculations by [Contraction Hierarchies](http://en.wikipedia.org/wiki/Contraction_hierarchies).
  * [Create new FlagEncoder](./core/create-new-flagencoder.md): Documentation to create new routing profiles to influence which ways to favor and how the track-time is calculated.
- * [LocationIndex](./core/location-index.md): Documentation about how to get the location index for getting i.e. the nearest edge. 
- * [Changelog](https://github.com/graphhopper/graphhopper/blob/master/core/files/changelog.txt): Latest changes.
+
+### Android
+
+ * [Android](./android/index.md): Instructions how to setup the demo project for GraphHopper on Android
+ * [Android Studio Setup](./android/android-studio-setup.md)
+
+### iOS
+
+Instructions on how to setup the GraphHopper-iOS clone for iOS development are [here](https://github.com/graphhopper/graphhopper-ios/)
+including a sample application.
+
+### Windows
+
+Documentation about how to get an GraphHopper instance running on windows via cygwin is available [here](./core/windows-setup.md).
+
+### Eclipse
+
+[Set up GraphHopper in Eclipse](./core/eclipse-setup.md) with maven and [tomcat](./core/eclipse-tomcat-setup.md).
diff --git a/docs/web/api-doc.md b/docs/web/api-doc.md
index efd88c3a15..5eec1d6abf 100644
--- a/docs/web/api-doc.md
+++ b/docs/web/api-doc.md
@@ -21,10 +21,11 @@ locale      | en      | The locale of the resulting turn instructions. E.g. `pt_
 instructions| true    | If instruction should be calculated and returned
 vehicle     | car     | The vehicle for which the route should be calculated. Other vehicles are foot, bike, motorcycle, hike, ...
 elevation   | false   | If `true` a third dimension - the elevation - is included in the polyline or in the GeoJson. IMPORTANT: If enabled you have to use a modified version of the decoding method or set points_encoded to `false`. See the points_encoded attribute for more details. Additionally a request can fail if the vehicle does not support elevation. See the features object for every vehicle.
-points_encoded     | true    | If `false` the coordinates in `point` and `snapped_waypoints` are returned as array using the order [lon,lat,elevation] for every point. If `true` the coordinates will be encoded as string leading to less bandwith usage. You'll need a special handling for the decoding of this string on the client-side. We provide open source code in [Java](https://github.com/graphhopper/graphhopper/blob/d70b63660ac5200b03c38ba3406b8f93976628a6/web/src/main/java/com/graphhopper/http/WebHelper.java#L43) and [JavaScript](https://github.com/graphhopper/graphhopper/blob/d70b63660ac5200b03c38ba3406b8f93976628a6/web/src/main/webapp/js/ghrequest.js#L139). It is especially important to use no 3rd party client if you set `elevation=true`!
-debug              | false   | If true, the output will be formated.
-calc_points        | true    | If the points for the route should be calculated at all printing out only distance and time.
-type               | json    | Specifies the resulting format of the route, for `json` the content type will be application/json. Other possible format options: <br> `jsonp` you'll need to provide the callback function via the callback parameter. The content type will be application/javascript<br> `gpx`, the content type will be application/gpx+xml, see below for more parameters.
+points_encoded   | true    | If `false` the coordinates in `point` and `snapped_waypoints` are returned as array using the order [lon,lat,elevation] for every point. If `true` the coordinates will be encoded as string leading to less bandwith usage. You'll need a special handling for the decoding of this string on the client-side. We provide open source code in [Java](https://github.com/graphhopper/graphhopper/blob/d70b63660ac5200b03c38ba3406b8f93976628a6/web/src/main/java/com/graphhopper/http/WebHelper.java#L43) and [JavaScript](https://github.com/graphhopper/graphhopper/blob/d70b63660ac5200b03c38ba3406b8f93976628a6/web/src/main/webapp/js/ghrequest.js#L139). It is especially important to use no 3rd party client if you set `elevation=true`!
+debug            | false   | If true, the output will be formated.
+calc_points      | true    | If the points for the route should be calculated at all printing out only distance and time.
+type             | json    | Specifies the resulting format of the route, for `json` the content type will be application/json. Other possible format options: <br> `jsonp` you'll need to provide the callback function via the callback parameter. The content type will be application/javascript<br> `gpx`, the content type will be application/gpx+xml, see below for more parameters.
+point_hint       | -       | Optional parameter. Specifies a hint for each `point` parameter to prefer a certain street for the closest location lookup. E.g. if there is an address or house with two or more neighboring streets you can control for which street the closest location is looked up.
 
 ### GPX
 
@@ -80,6 +81,7 @@ paths[0].instructions[0].sign                 | A number which specifies the sig
 paths[0].instructions[0].annotation_text      | [optional] A text describing the instruction in more detail, e.g. like surface of the way, warnings or involved costs
 paths[0].instructions[0].annotation_importance| [optional] 0 stands for INFO, 1 for warning, 2 for costs, 3 for costs and warning
 paths[0].instructions[0].exit_number          | [optional] Only available for USE_ROUNDABOUT instructions. The count of exits at which the route leaves the roundabout.
+paths[0].instructions[0].exited               | [optional] Only available for USE_ROUNDABOUT instructions. True if the roundabout should be exited. False if a via point or end is placed in the roundabout, thus, the roundabout should not be exited due to this instruction.
 paths[0].instructions[0].turn_angle           | [optional] Only available for USE_ROUNDABOUT instructions. The radian of the route within the roundabout: 0<r<2*PI for clockwise and -2PI<r<0 for counterclockwise transit. Null if the direction of rotation is undefined.
 
 ```json
diff --git a/docs/web/quickstart.md b/docs/web/quickstart.md
index 411afaa57b..cc855af3e0 100644
--- a/docs/web/quickstart.md
+++ b/docs/web/quickstart.md
@@ -3,12 +3,12 @@
 If you want to build GraphHopper from source look at the [Developers page](../core/quickstart-from-source.md). 
 The following steps are simpler and only need the JRE, a jar file and an OSM file.
 
- 1. Install the latest JRE and get GraphHopper Server as [zip](https://oss.sonatype.org/content/groups/public/com/graphhopper/graphhopper-web/0.8-SNAPSHOT/) (~9MB)
+ 1. Install the latest JRE and get GraphHopper Server as [zip](https://oss.sonatype.org/content/groups/public/com/graphhopper/graphhopper-web/0.9-SNAPSHOT/) (~9MB)
  2. Unzip it and copy an OSM file into the created directory. For example [berlin-latest.osm.pbf](http://download.geofabrik.de/europe/germany/berlin.html)
  3. Start GraphHopper Maps via: `java -jar *.jar jetty.resourcebase=webapp config=config-example.properties datareader.file=berlin-latest.osm.pbf`
  4. After you see 'Started server at HTTP 8989' go to [http://localhost:8989/](http://localhost:8989/) and you should see a map of Berlin. You should be able to click on the map and a route appears.
 
-To see how GraphHopper is configured for production usage, see the separate site [Deploy](./../core/deploy.md).
+To see how GraphHopper is configured for production usage, see the [deployment guide](./../core/deploy.md).
 
 ## Troubleshooting
 
@@ -16,4 +16,4 @@ To see how GraphHopper is configured for production usage, see the separate site
  * Regarding step 2:
     * The folder where you execute the java command should contain the following files: berlin-latest.osm.pbf, config-example.properties and `graphhopper-web-[version].jar`
     * The first time you execute this it'll take ~30 seconds (for Berlin), further starts will only load the graph and should be nearly instantaneous. You should see log statements but no exceptions and the last entry should be something like: Started server at HTTP 8989
- * Join the [mailing list](http://graphhopper.com/#developers) and do not hesitate to ask questions!
+ * Or [contact us](../index.md#contact)
diff --git a/graphhopper.sh b/graphhopper.sh
index ef756718e8..c75b3ba9e0 100755
--- a/graphhopper.sh
+++ b/graphhopper.sh
@@ -1,4 +1,6 @@
 #!/bin/bash
+(set -o igncr) 2>/dev/null && set -o igncr; # this comment is required for handling Windows cr/lf 
+# See StackOverflow answer http://stackoverflow.com/a/14607651
 
 GH_CLASS=com.graphhopper.tools.Import
 GH_HOME=$(dirname "$0")
@@ -24,18 +26,20 @@ FILE=$2
 
 function printUsage {
  echo
- echo "./graphhopper.sh import|web <your-osm-file>"
- echo "./graphhopper.sh clean|build|help"
+ echo "./graphhopper.sh import|web <some-map-file>"
+ echo "./graphhopper.sh clean|build|buildweb|help"
  echo
  echo "  help        this message"
  echo "  import      creates the graphhopper files used for later (faster) starts"
  echo "  web         starts a local server for user access at localhost:8989 and API access at localhost:8989/route"
  echo "  build       creates the graphhopper JAR (without the web module)"
+ echo "  buildweb    creates the graphhopper JAR (with the web module)"
  echo "  clean       removes all JARs, necessary if you need to use the latest source (e.g. after switching the branch etc)"
- echo "  measurement does performance analysis of the current source version via artificial, random routes (Measurement class)"
- echo "  torture     can be used to test real world routes via feeding graphhopper logs into a graphhopper system (Torture class)"
+ echo "  measurement does performance analysis of the current source version via random routes (Measurement class)"
+ echo "  torture     can be used to test real world routes via feeding graphhopper logs into a GraphHopper system (Torture class)"
  echo "  miniui      is a simple Java/Swing visualization application used for debugging purposes (MiniGraphUI class)"
- echo "  extract     calls the overpass API to easily grab any area as .osm file"
+ echo "  extract     calls the overpass API to grab any area as .osm file"
+ echo "  android     builds, deploys and starts the Android demo for your connected device"
 }
 
 if [ "$ACTION" = "" ]; then
@@ -43,7 +47,7 @@ if [ "$ACTION" = "" ]; then
  printUsage
 fi
 
-function ensureOsmXml { 
+function ensureOsm { 
   if [ "$OSM_FILE" = "" ]; then
     # skip
     return
@@ -97,7 +101,6 @@ function ensureMaven {
 }
 
 function execMvn {
-  # echo "exec maven with $@"
   "$MAVEN_HOME/bin/mvn" "$@" > /tmp/graphhopper-compile.log
   returncode=$?
   if [[ $returncode != 0 ]] ; then
@@ -114,7 +117,7 @@ function packageCoreJar {
   fi
   
   if [ ! -f "$JAR" ]; then
-    echo "## now building graphhopper jar: $JAR"
+    echo "## building graphhopper jar: $JAR"
     echo "## using maven at $MAVEN_HOME"
     
     execMvn --projects tools -am -DskipTests=true install
@@ -124,12 +127,7 @@ function packageCoreJar {
   fi
 }
 
-function prepareEclipse {
- ensureMaven   
- packageCoreJar
- # cp core/target/graphhopper-*-android.jar android/libs/   
-}
-
+ensureMaven
 
 ## now handle actions which do not take an OSM file
 if [ "$ACTION" = "clean" ]; then
@@ -139,13 +137,19 @@ if [ "$ACTION" = "clean" ]; then
  exit
 
 elif [ "$ACTION" = "eclipse" ]; then
- prepareEclipse
+ packageCoreJar
  exit
 
 elif [ "$ACTION" = "build" ]; then
- prepareEclipse
+ packageCoreJar
  exit  
  
+elif [ "$ACTION" = "buildweb" ]; then
+ packageCoreJar
+ execMvn --projects web -am -DskipTests=true install
+ execMvn --projects web -DskipTests=true install assembly:single
+ exit
+
 elif [ "$ACTION" = "extract" ]; then
  echo use "./graphhopper.sh extract \"left,bottom,right,top\""
  URL="http://overpass-api.de/api/map?bbox=$2"
@@ -154,8 +158,8 @@ elif [ "$ACTION" = "extract" ]; then
  exit
  
 elif [ "$ACTION" = "android" ]; then
- prepareEclipse
- "$MAVEN_HOME/bin/mvn" -P include-android --projects android/app install android:deploy android:run
+ packageCoreJar
+ execMvn -P include-android --projects android/app install android:deploy android:run
  exit
 fi
 
@@ -170,9 +174,7 @@ NAME="${FILE%.*}"
 
 if [ "$FILE" == "-" ]; then
    OSM_FILE=
-elif [ ${FILE: -4} == ".osm" ]; then
-   OSM_FILE="$FILE"
-elif [ ${FILE: -4} == ".pbf" ]; then
+elif [ ${FILE: -4} == ".osm" ] || [ ${FILE: -4} == ".xml" ] || [ ${FILE: -4} == ".pbf" ]; then
    OSM_FILE="$FILE"
 elif [ ${FILE: -7} == ".osm.gz" ]; then
    OSM_FILE="$FILE"
@@ -211,9 +213,7 @@ if [ "$JAVA_OPTS" = "" ]; then
   JAVA_OPTS="-Xmx1000m -Xms1000m -server"
 fi
 
-
-ensureOsmXml
-ensureMaven
+ensureOsm
 packageCoreJar
 
 echo "## now $ACTION. JAVA_OPTS=$JAVA_OPTS"
@@ -224,7 +224,7 @@ if [ "$ACTION" = "ui" ] || [ "$ACTION" = "web" ]; then
     JETTY_PORT=8989
   fi
   WEB_JAR="$GH_HOME/web/target/graphhopper-web-$VERSION-with-dep.jar"
-  if [ ! -s "$WEB_JAR" ]; then         
+  if [ ! -s "$WEB_JAR" ]; then
     execMvn --projects web -DskipTests=true install assembly:single
   fi
 
@@ -255,7 +255,7 @@ elif [ "$ACTION" = "torture" ]; then
 
 
 elif [ "$ACTION" = "miniui" ]; then
- "$MAVEN_HOME/bin/mvn" --projects tools -DskipTests clean install assembly:single
+ execMvn --projects tools -DskipTests clean install assembly:single
  JAR=tools/target/graphhopper-tools-$VERSION-jar-with-dependencies.jar   
  "$JAVA" $JAVA_OPTS -cp "$JAR" com.graphhopper.ui.MiniGraphUI datareader.file="$OSM_FILE" config=$CONFIG \
               graph.location="$GRAPH"
@@ -271,6 +271,8 @@ elif [ "$ACTION" = "measurement" ]; then
  # IMPORT_TIME=$(($END - $START))
 
  function startMeasurement {
+    execMvn --projects core -DskipTests clean install
+    execMvn --projects tools -DskipTests install assembly:single
     COUNT=5000
     commit_info=$(git log -n 1 --pretty=oneline)
     echo -e "\nperform measurement via jar=> $JAR and ARGS=> $ARGS"
@@ -283,8 +285,6 @@ elif [ "$ACTION" = "measurement" ]; then
  last_commits=$3
   
  if [ "$last_commits" = "" ]; then
-   # use current version
-   "$MAVEN_HOME/bin/mvn" --projects tools -DskipTests clean install assembly:single
    startMeasurement
    exit
  fi
@@ -297,7 +297,6 @@ elif [ "$ACTION" = "measurement" ]; then
    M_FILE_NAME="measurement$M_FILE_NAME.properties"
    echo -e "\nusing commit $commit and $M_FILE_NAME"
    
-   "$MAVEN_HOME/bin/mvn" --projects tools -DskipTests clean install assembly:single
    startMeasurement
    echo -e "\nmeasurement.commit=$commit\n" >> "$M_FILE_NAME"
  done
diff --git a/pom.xml b/pom.xml
index 825d553466..816ba26863 100644
--- a/pom.xml
+++ b/pom.xml
@@ -6,9 +6,9 @@
     <groupId>com.graphhopper</groupId>
     <artifactId>graphhopper-parent</artifactId>
     <name>GraphHopper Parent Project</name>
-    <version>0.8-SNAPSHOT</version>
-    <packaging>pom</packaging> 
-    <url>https://graphhopper.com</url> 
+    <version>0.9-SNAPSHOT</version>
+    <packaging>pom</packaging>
+    <url>https://graphhopper.com</url>
     <inceptionYear>2012</inceptionYear>
     <description>Super pom of GraphHopper, the fast and flexible routing engine</description>
 
@@ -17,7 +17,8 @@
         <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
         <slf4j.version>1.7.21</slf4j.version>
         <log4j.version>1.2.17</log4j.version>
-        <json.org.version>20160212</json.org.version>                
+        <json.org.version>20160810</json.org.version>
+        <commons-compress.version>1.12</commons-compress.version>
 
         <org-netbeans-modules-editor-indent.CodeStyle.project.indent-shift-width>4</org-netbeans-modules-editor-indent.CodeStyle.project.indent-shift-width>
         <org-netbeans-modules-editor-indent.CodeStyle.project.spaces-per-tab>4</org-netbeans-modules-editor-indent.CodeStyle.project.spaces-per-tab>
@@ -35,20 +36,20 @@
         <org-netbeans-modules-editor-indent.text.x-java.CodeStyle.project.alignMultilineFor>true</org-netbeans-modules-editor-indent.text.x-java.CodeStyle.project.alignMultilineFor>
         <org-netbeans-modules-editor-indent.text.x-java.CodeStyle.project.alignMultilineTryResources>true</org-netbeans-modules-editor-indent.text.x-java.CodeStyle.project.alignMultilineTryResources>
     </properties>
-    
+
     <scm>
         <connection>scm:git:git@github.com:graphhopper/graphhopper.git</connection>
         <developerConnection>scm:git:git@github.com:graphhopper/graphhopper.git</developerConnection>
         <url>git@github.com:graphhopper/graphhopper.git</url>
     </scm>
-    
+
     <licenses>
         <license>
             <name>Apache License, Version 2.0</name>
             <url>http://www.apache.org/licenses/LICENSE-2.0</url>
         </license>
     </licenses>
-    
+
     <developers>
         <developer>
             <id>karussell</id>
@@ -56,7 +57,7 @@
             <email>my.name@graphhopper.com</email>
         </developer>
     </developers>
-    
+
     <mailingLists>
         <mailingList>
             <name>GraphHopper</name>
@@ -68,39 +69,39 @@
         <system>GitHub</system>
         <url>https://github.com/graphhopper/graphhopper/issues</url>
     </issueManagement>
+
+    <prerequisites>
+        <maven>3.2</maven>
+    </prerequisites>
     <modules>
-        <module>tools-lgpl</module>
         <module>core</module>
         <module>reader-osm</module>
-        <module>reader-overlay-data</module>
+        <module>reader-json</module>
         <module>tools</module>
         <module>web</module>
     </modules>
-        
-    <build>        
+    <build>
         <plugins>
-        
-            <!-- to avoid problems with jvm 1.5 and @Override -->
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-compiler-plugin</artifactId>
                 <version>3.5.1</version>
                 <configuration>
                     <!--
-                    <compilerArgument>-Xlint:unchecked</compilerArgument>                    
+                    <compilerArgument>-Xlint:unchecked</compilerArgument>
                     <compilerArgument>-Xlint:deprecation</compilerArgument>
                     -->
-                    
-                    <!-- suppress warning about Unsafe functionality -->
+
+                    <!-- suppress warning about Unsafe functionality -->                    
                     <compilerArgument>-XDignore.symbol.file</compilerArgument>
                     <fork>true</fork>
                     <source>1.7</source>
                     <target>1.7</target>
                 </configuration>
             </plugin>
-            
+
             <!-- to run single tests -->
-            <plugin>                
+            <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-surefire-plugin</artifactId>
                 <version>2.19.1</version>
@@ -108,11 +109,11 @@
                     <argLine>-Xmx100m -Xms100m</argLine>
                 </configuration>
             </plugin>
-                        
+
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-failsafe-plugin</artifactId>
-                <version>2.19</version>
+                <version>2.19.1</version>
                 <executions>
                     <execution>
                         <goals>
@@ -122,21 +123,21 @@
                     </execution>
                 </executions>
             </plugin>
-                        
+
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-assembly-plugin</artifactId>
-                <version>2.6</version>                    
+                <version>3.0.0</version>
             </plugin>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-jar-plugin</artifactId>
-                <version>2.6</version>
+                <version>3.0.2</version>
             </plugin>
             <plugin>
                 <artifactId>maven-war-plugin</artifactId>
-                <version>2.6</version>                
-            </plugin>            
+                <version>3.0.0</version>
+            </plugin>
             <!-- example https://github.com/tananaev/traccar/blob/master/checkstyle.xml
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
@@ -147,31 +148,16 @@
                 </configuration>
             </plugin>
             -->
-            
-            <!-- create html output for findbugs -->
-            <plugin>
-                <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-site-plugin</artifactId>
-                <version>3.5</version>
-                <configuration>
-                    <reportPlugins>
-                        <plugin>
-                            <groupId>org.codehaus.mojo</groupId>
-                            <artifactId>findbugs-maven-plugin</artifactId>                            
-                        </plugin>
-                    </reportPlugins>
-                </configuration>
-            </plugin>
-            
+
             <plugin>
                 <groupId>org.codehaus.mojo</groupId>
                 <artifactId>findbugs-maven-plugin</artifactId>
-                <version>3.0.3</version>                
+                <version>3.0.4</version>
             </plugin>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-pmd-plugin</artifactId>
-                <version>3.6</version>
+                <version>3.7</version>
                 <!-- e.g. under core/target/site/pmd.html
                 <configuration>
                     <format>html</format>
@@ -179,24 +165,24 @@
                 -->
             </plugin>
         </plugins>
-    </build>    
-    
+    </build>
+
     <dependencies>
         <dependency>
             <groupId>junit</groupId>
             <artifactId>junit</artifactId>
             <version>4.12</version>
             <scope>test</scope>
-        </dependency>        
+        </dependency>
     </dependencies>
-    
+
     <distributionManagement>
         <snapshotRepository>
             <id>ossrh</id>
             <url>https://oss.sonatype.org/content/repositories/snapshots</url>
         </snapshotRepository>
-    </distributionManagement> 
-    
+    </distributionManagement>
+
     <!-- mvn clean deploy -P release -->
     <profiles>
         <profile>
@@ -204,6 +190,12 @@
             <activation>
                 <activeByDefault>false</activeByDefault>
             </activation>
+            <!-- this exception is valid for jdk8 profile below too -->
+            <modules>                
+                <!-- See https://github.com/graphhopper/graphhopper/pull/874#issuecomment-261231518
+                Currently works for jdk8 only -->
+                <module>reader-shp</module>
+            </modules>
             <build>
                 <plugins>
                     <plugin>
@@ -231,11 +223,11 @@
                             <autoReleaseAfterClose>true</autoReleaseAfterClose>
                         </configuration>
                     </plugin>
-            
+
                     <plugin>
                         <groupId>org.apache.maven.plugins</groupId>
                         <artifactId>maven-javadoc-plugin</artifactId>
-                        <version>2.10.3</version>
+                        <version>2.10.4</version>
                         <executions>
                             <execution>
                                 <id>attach-javadocs</id>
@@ -248,7 +240,7 @@
                     <plugin>
                         <groupId>org.apache.maven.plugins</groupId>
                         <artifactId>maven-source-plugin</artifactId>
-                        <version>3.0.0</version>
+                        <version>3.0.1</version>
                         <executions>
                             <execution>
                                 <id>attach-sources</id>
@@ -261,7 +253,7 @@
                 </plugins>
             </build>
         </profile>
-        
+
         <profile>
             <id>include-android</id>
             <activation>
@@ -271,6 +263,59 @@
                 <module>android/app</module>
             </modules>
         </profile>
+        
+        <profile>
+            <id>jdk8</id>
+            <activation>
+                <activeByDefault>true</activeByDefault>
+            </activation>
+            <properties />
+            <modules>                
+                <!-- See https://github.com/graphhopper/graphhopper/pull/874#issuecomment-261231518
+                Currently works for jdk8 only -->
+                <module>reader-shp</module>
+            </modules>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-failsafe-plugin</artifactId>
+                    </plugin>
+                    <plugin>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+        
+        <profile>
+            <id>jdk9</id>
+            <activation>
+                <activeByDefault>false</activeByDefault>                                
+                <jdk>9-ea</jdk>
+            </activation>
+            <properties />           
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-failsafe-plugin</artifactId>
+                        <configuration>
+                            <systemPropertyVariables />
+                            <argLine>--add-opens java.base/java.lang=ALL-UNNAMED</argLine>
+                        </configuration>
+                    </plugin>
+                    <plugin>
+                        <groupId>org.apache.maven.plugins</groupId>
+                        <artifactId>maven-surefire-plugin</artifactId>
+                        <version>2.19.1</version>
+                        <configuration>
+                            <!-- See #852 and #701 for the add exports or add opens option
+                            -->                            
+                            <argLine>-Xmx100m -Xms100m --add-opens java.base/java.lang=ALL-UNNAMED</argLine>
+                        </configuration>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
     </profiles>
-    
+
 </project>
diff --git a/reader-overlay-data/pom.xml b/reader-json/pom.xml
similarity index 77%
rename from reader-overlay-data/pom.xml
rename to reader-json/pom.xml
index 0de799d981..ded5652871 100644
--- a/reader-overlay-data/pom.xml
+++ b/reader-json/pom.xml
@@ -4,15 +4,15 @@
     <modelVersion>4.0.0</modelVersion>
 
     <groupId>com.graphhopper</groupId>
-    <artifactId>graphhopper-reader-overlay-data</artifactId>
-    <version>0.8-SNAPSHOT</version>
+    <artifactId>graphhopper-reader-json</artifactId>
+    <version>0.9-SNAPSHOT</version>
     <packaging>jar</packaging>
-    <name>GraphHopper Reader for Overlay Data</name>
+    <name>GraphHopper Reader JSON</name>
 
     <parent>
         <groupId>com.graphhopper</groupId>
         <artifactId>graphhopper-parent</artifactId>    	
-        <version>0.8-SNAPSHOT</version>
+        <version>0.9-SNAPSHOT</version>
     </parent>
 
     <dependencies>
@@ -24,28 +24,25 @@
         <dependency>
             <groupId>com.google.code.gson</groupId>
             <artifactId>gson</artifactId>
-            <version>2.6.2</version>
+            <version>2.8.0</version>
             <!-- in the future make implementation optional
                  <scope>provided</scope>
             -->
         </dependency> 
-        <dependency>
-            <groupId>org.slf4j</groupId>
-            <artifactId>slf4j-api</artifactId>
-            <version>${slf4j.version}</version>
-        </dependency>   
+        
         <dependency>
             <groupId>org.slf4j</groupId>
             <artifactId>slf4j-log4j12</artifactId>
             <version>${slf4j.version}</version>
-            <scope>runtime</scope>
+            <scope>test</scope>
         </dependency>
         <dependency>
             <groupId>log4j</groupId>
             <artifactId>log4j</artifactId>
             <version>${log4j.version}</version>
-            <scope>runtime</scope>
+            <scope>test</scope>
         </dependency>
+        
         <dependency>
             <groupId>com.graphhopper</groupId>
             <artifactId>graphhopper-core</artifactId>
@@ -53,6 +50,7 @@
             <type>test-jar</type>
             <scope>test</scope>
         </dependency>   
+
     </dependencies>
     
 </project>
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/FeatureJsonDeserializer.java b/reader-json/src/main/java/com/graphhopper/json/FeatureJsonDeserializer.java
similarity index 75%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/geo/FeatureJsonDeserializer.java
rename to reader-json/src/main/java/com/graphhopper/json/FeatureJsonDeserializer.java
index f30e7f52b5..2a8bb071aa 100644
--- a/reader-overlay-data/src/main/java/com/graphhopper/json/geo/FeatureJsonDeserializer.java
+++ b/reader-json/src/main/java/com/graphhopper/json/FeatureJsonDeserializer.java
@@ -15,8 +15,12 @@
  *  See the License for the specific language governing permissions and
  *  limitations under the License.
  */
-package com.graphhopper.json.geo;
+package com.graphhopper.json;
 
+import com.graphhopper.json.geo.JsonFeature;
+import com.graphhopper.json.geo.Geometry;
+import com.graphhopper.json.geo.Point;
+import com.graphhopper.json.geo.LineString;
 import com.google.gson.*;
 import com.graphhopper.util.shapes.BBox;
 
@@ -25,7 +29,7 @@
 import java.util.UUID;
 
 /**
- * Instructions how to read the different geometry types.
+ * This class makes reading the different geometry types possible for Gson.
  *
  * @author Peter Karich
  */
@@ -33,46 +37,47 @@
     @Override
     public JsonFeature deserialize(JsonElement json, Type type, JsonDeserializationContext context) throws JsonParseException {
         try {
-            JsonFeature feature = new JsonFeature();
             JsonObject obj = json.getAsJsonObject();
-
+            String id, strType = null;
+            Map<String,Object> properties = null;
+            BBox bbox = null;
+            Geometry geometry = null;
+            
             // TODO ensure uniqueness
             if (obj.has("id"))
-                feature.id = obj.get("id").getAsString();
+                id = obj.get("id").getAsString();
             else
-                feature.id = UUID.randomUUID().toString();
+                id = UUID.randomUUID().toString();
 
             if (obj.has("properties")) {
-                Map<String, Object> map = context.deserialize(obj.get("properties"), Map.class);
-                feature.properties = map;
+               properties= context.deserialize(obj.get("properties"), Map.class);
             }
 
             if (obj.has("bbox"))
-                feature.bbox = parseBBox(obj.get("bbox").getAsJsonArray());
+                bbox = parseBBox(obj.get("bbox").getAsJsonArray());
 
             if (obj.has("geometry")) {
-                JsonObject geometry = obj.get("geometry").getAsJsonObject();
+                JsonObject geometryJson = obj.get("geometry").getAsJsonObject();
 
-                if (geometry.has("coordinates")) {
-                    if (!geometry.has("type"))
+                if (geometryJson.has("coordinates")) {
+                    if (!geometryJson.has("type"))
                         throw new IllegalArgumentException("No type for non-empty coordinates specified");
 
-                    String strType = context.deserialize(geometry.get("type"), String.class);
-                    feature.type = strType;
+                     strType = context.deserialize(geometryJson.get("type"), String.class);
                     if ("Point".equals(strType)) {
-                        JsonArray arr = geometry.get("coordinates").getAsJsonArray();
+                        JsonArray arr = geometryJson.get("coordinates").getAsJsonArray();
                         double lon = arr.get(0).getAsDouble();
                         double lat = arr.get(1).getAsDouble();
                         if (arr.size() == 3)
-                            feature.geometry = new Point(lat, lon, arr.get(2).getAsDouble());
+                            geometry = new Point(lat, lon, arr.get(2).getAsDouble());
                         else
-                            feature.geometry = new Point(lat, lon);
+                            geometry = new Point(lat, lon);
 
                     } else if ("MultiPoint".equals(strType)) {
-                        feature.geometry = parseLineString(geometry);
+                        geometry = parseLineString(geometryJson);
 
                     } else if ("LineString".equals(strType)) {
-                        feature.geometry = parseLineString(geometry);
+                        geometry = parseLineString(geometryJson);
 
                     } else {
                         throw new IllegalArgumentException("Coordinates type " + strType + " not yet supported");
@@ -80,7 +85,7 @@ public JsonFeature deserialize(JsonElement json, Type type, JsonDeserializationC
                 }
             }
 
-            return feature;
+            return new JsonFeature(id, strType, bbox, geometry, properties);
 
         } catch (Exception ex) {
             throw new JsonParseException("Problem parsing JSON feature " + json);
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/GHsonBuilder.java b/reader-json/src/main/java/com/graphhopper/json/GHJsonBuilder.java
similarity index 89%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/GHsonBuilder.java
rename to reader-json/src/main/java/com/graphhopper/json/GHJsonBuilder.java
index 1a1d1862f5..dcd28becda 100644
--- a/reader-overlay-data/src/main/java/com/graphhopper/json/GHsonBuilder.java
+++ b/reader-json/src/main/java/com/graphhopper/json/GHJsonBuilder.java
@@ -17,16 +17,17 @@
  */
 package com.graphhopper.json;
 
+import com.graphhopper.json.geo.JsonFeature;
 import com.google.gson.Gson;
 import com.google.gson.GsonBuilder;
-import com.graphhopper.json.geo.FeatureJsonDeserializer;
-import com.graphhopper.json.geo.JsonFeature;
 
 /**
+ * This class wraps the creation of the specific GHJson implementation.
+ *
  * @author Peter Karich
  */
-public class GHsonBuilder {
-    public GHson create() {
+public class GHJsonBuilder {
+    public GHJson create() {
         // for now always return Gson implementation        
         Gson gson = new GsonBuilder()
                 .disableHtmlEscaping()
@@ -35,6 +36,6 @@ public GHson create() {
         // for geojson we could rely on external libs instead of inventing our own:
         // https://github.com/filosganga/geogson or https://github.com/3sidedcube/Android-GeoGson
 
-        return new GHsonGson(gson);
+        return new GHJsonGson(gson);
     }
 }
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/json/GHsonGson.java b/reader-json/src/main/java/com/graphhopper/json/GHJsonGson.java
similarity index 93%
rename from reader-overlay-data/src/main/java/com/graphhopper/json/GHsonGson.java
rename to reader-json/src/main/java/com/graphhopper/json/GHJsonGson.java
index 27fe0fc7cd..3714e3341a 100644
--- a/reader-overlay-data/src/main/java/com/graphhopper/json/GHsonGson.java
+++ b/reader-json/src/main/java/com/graphhopper/json/GHJsonGson.java
@@ -24,10 +24,10 @@
 /**
  * @author Peter Karich
  */
-public class GHsonGson implements GHson {
+public class GHJsonGson implements GHJson {
     private final Gson gson;
 
-    public GHsonGson(Gson gson) {
+    public GHJsonGson(Gson gson) {
         this.gson = gson;
     }
 
diff --git a/reader-json/src/main/java/com/graphhopper/json/JsonFeatureConverter.java b/reader-json/src/main/java/com/graphhopper/json/JsonFeatureConverter.java
new file mode 100644
index 0000000000..004ee0af4a
--- /dev/null
+++ b/reader-json/src/main/java/com/graphhopper/json/JsonFeatureConverter.java
@@ -0,0 +1,84 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.json;
+
+import com.graphhopper.json.geo.JsonFeatureCollection;
+import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.storage.change.ChangeGraphHelper;
+
+import java.io.File;
+import java.io.FileNotFoundException;
+import java.io.FileReader;
+import java.io.FilenameFilter;
+import java.io.Reader;
+
+/**
+ * Creates JsonFeature out of files and applies them to the graph.
+ * Currently not used in GraphHopper itself.
+ *
+ * @author Peter Karich
+ */
+public class JsonFeatureConverter {
+    private final ChangeGraphHelper changeGraphHelper;
+    private final GHJson ghson;
+    private final EncodingManager encodingManager;
+
+    public JsonFeatureConverter(GHJson ghson, ChangeGraphHelper changeGraphHelper, EncodingManager encodingManager) {
+        this.ghson = ghson;
+        this.changeGraphHelper = changeGraphHelper;
+        this.encodingManager = encodingManager;
+    }
+
+    /**
+     * Easily read GeoJSON files from disc and apply the specified changes to the graph.
+     */
+    public long applyChanges(String fileOrFolderStr) {
+        File fileOrFolder = new File(fileOrFolderStr);
+        try {
+            if (fileOrFolder.isFile()) {
+                return applyChanges(new FileReader(fileOrFolder));
+            }
+
+            long sum = 0;
+            File[] fList = new File(fileOrFolderStr).listFiles(new FilenameFilter() {
+                @Override
+                public boolean accept(File dir, String name) {
+                    return name.endsWith(".json");
+                }
+            });
+            for (File f : fList) {
+                sum += applyChanges(new FileReader(f));
+            }
+            return sum;
+
+        } catch (FileNotFoundException ex) {
+            throw new RuntimeException(ex);
+        }
+    }
+
+    /**
+     * This method applies changes to the graph, specified by the reader.
+     *
+     * @return number of successfully applied edge changes
+     */
+    public long applyChanges(Reader reader) {
+        // read full file, later support one json feature or collection per line to avoid high mem consumption
+        JsonFeatureCollection data = ghson.fromJson(reader, JsonFeatureCollection.class);
+        return changeGraphHelper.applyChanges(encodingManager, data.getFeatures());
+    }
+}
diff --git a/reader-overlay-data/src/test/java/com/graphhopper/json/geo/JsonFeatureCollectionTest.java b/reader-json/src/test/java/com/graphhopper/json/geo/JsonFeatureCollectionTest.java
similarity index 94%
rename from reader-overlay-data/src/test/java/com/graphhopper/json/geo/JsonFeatureCollectionTest.java
rename to reader-json/src/test/java/com/graphhopper/json/geo/JsonFeatureCollectionTest.java
index 691fe96d27..76e9610970 100644
--- a/reader-overlay-data/src/test/java/com/graphhopper/json/geo/JsonFeatureCollectionTest.java
+++ b/reader-json/src/test/java/com/graphhopper/json/geo/JsonFeatureCollectionTest.java
@@ -17,8 +17,8 @@
  */
 package com.graphhopper.json.geo;
 
-import com.graphhopper.json.GHson;
-import com.graphhopper.json.GHsonBuilder;
+import com.graphhopper.json.GHJson;
+import com.graphhopper.json.GHJsonBuilder;
 import com.graphhopper.util.Helper;
 import org.junit.Test;
 
@@ -32,7 +32,7 @@
  * @author Peter Karich
  */
 public class JsonFeatureCollectionTest {
-    private final GHson ghson = new GHsonBuilder().create();
+    private final GHJson ghson = new GHJsonBuilder().create();
 
     @Test
     public void testDeserialization() {
@@ -63,5 +63,4 @@ JsonFeatureCollection getJson(String name) {
         Reader reader = new InputStreamReader(getClass().getResourceAsStream(name), Helper.UTF_CS);
         return ghson.fromJson(reader, JsonFeatureCollection.class);
     }
-
 }
diff --git a/reader-overlay-data/src/test/java/com/graphhopper/reader/overlaydata/FeedOverlayDataTest.java b/reader-json/src/test/java/com/graphhopper/storage/change/ChangeGraphHelperTest.java
similarity index 83%
rename from reader-overlay-data/src/test/java/com/graphhopper/reader/overlaydata/FeedOverlayDataTest.java
rename to reader-json/src/test/java/com/graphhopper/storage/change/ChangeGraphHelperTest.java
index c1eb195cf8..5e786563e4 100644
--- a/reader-overlay-data/src/test/java/com/graphhopper/reader/overlaydata/FeedOverlayDataTest.java
+++ b/reader-json/src/test/java/com/graphhopper/storage/change/ChangeGraphHelperTest.java
@@ -1,7 +1,8 @@
-package com.graphhopper.reader.overlaydata;
+package com.graphhopper.storage.change;
 
-import com.graphhopper.json.GHson;
-import com.graphhopper.json.GHsonBuilder;
+import com.graphhopper.json.GHJson;
+import com.graphhopper.json.GHJsonBuilder;
+import com.graphhopper.json.JsonFeatureConverter;
 import com.graphhopper.routing.AbstractRoutingAlgorithmTester;
 import com.graphhopper.routing.util.AllEdgesIterator;
 import com.graphhopper.routing.util.EncodingManager;
@@ -24,16 +25,16 @@
 /**
  * @author Peter Karich
  */
-public class FeedOverlayDataTest {
+public class ChangeGraphHelperTest {
     private EncodingManager encodingManager;
     private GraphHopperStorage graph;
-    private GHson ghson;
+    private GHJson ghson;
 
     @Before
     public void setUp() {
         encodingManager = new EncodingManager("car");
         graph = new GraphBuilder(encodingManager).create();
-        ghson = new GHsonBuilder().create();
+        ghson = new GHJsonBuilder().create();
     }
 
     @Test
@@ -62,9 +63,10 @@ public void testApplyChanges() {
             assertTrue(encoder.isForward(flags));
         }
 
-        FeedOverlayData instance = new FeedOverlayData(graph, encodingManager, locationIndex, ghson);
         Reader reader = new InputStreamReader(getClass().getResourceAsStream("overlaydata1.json"), Helper.UTF_CS);
-        long updates = instance.applyChanges(reader);
+        ChangeGraphHelper instance = new ChangeGraphHelper(graph, locationIndex);
+        JsonFeatureConverter converter = new JsonFeatureConverter(ghson, instance, encodingManager);
+        long updates = converter.applyChanges(reader);
         assertEquals(2, updates);
 
         // assert changed speed and access
diff --git a/reader-overlay-data/src/test/resources/com/graphhopper/json/geo/geojson1.json b/reader-json/src/test/resources/com/graphhopper/json/geo/geojson1.json
similarity index 100%
rename from reader-overlay-data/src/test/resources/com/graphhopper/json/geo/geojson1.json
rename to reader-json/src/test/resources/com/graphhopper/json/geo/geojson1.json
diff --git a/reader-overlay-data/src/test/resources/com/graphhopper/reader/overlaydata/overlaydata1.json b/reader-json/src/test/resources/com/graphhopper/storage/change/overlaydata1.json
similarity index 100%
rename from reader-overlay-data/src/test/resources/com/graphhopper/reader/overlaydata/overlaydata1.json
rename to reader-json/src/test/resources/com/graphhopper/storage/change/overlaydata1.json
diff --git a/reader-osm/pom.xml b/reader-osm/pom.xml
index 6700e6cfc5..25073fff86 100644
--- a/reader-osm/pom.xml
+++ b/reader-osm/pom.xml
@@ -5,14 +5,14 @@
 
     <groupId>com.graphhopper</groupId>
     <artifactId>graphhopper-reader-osm</artifactId>
-    <version>0.8-SNAPSHOT</version>
+    <version>0.9-SNAPSHOT</version>
     <packaging>jar</packaging>
     <name>GraphHopper Reader for OpenStreetMap Data</name>
 
     <parent>
         <groupId>com.graphhopper</groupId>
         <artifactId>graphhopper-parent</artifactId>    	
-        <version>0.8-SNAPSHOT</version>
+        <version>0.9-SNAPSHOT</version>
     </parent>
 
     <dependencies>
@@ -21,18 +21,19 @@
             <artifactId>graphhopper-core</artifactId>
             <version>${project.parent.version}</version>
         </dependency>
-        
-        <dependency>
-            <groupId>com.google.protobuf</groupId>
-            <artifactId>protobuf-java</artifactId>
-            <version>2.6.1</version>
-        </dependency>        
+              
         <dependency>
             <groupId>org.openstreetmap.osmosis</groupId>
             <artifactId>osmosis-osm-binary</artifactId>
-            <version>0.44.1</version>
+            <version>0.45</version>
         </dependency>
-        
+        <!-- 
+        <dependency>
+            <groupId>org.apache.commons</groupId>
+            <artifactId>commons-compress</artifactId>
+            <version>${commons-compress.version}</version>
+        </dependency>
+        -->
         <dependency>
             <groupId>org.slf4j</groupId>
             <artifactId>slf4j-api</artifactId>
@@ -50,11 +51,6 @@
             <version>${log4j.version}</version>
             <scope>runtime</scope>
         </dependency>
-        <dependency>
-            <groupId>org.apache.commons</groupId>
-            <artifactId>commons-compress</artifactId>
-            <version>1.10</version>
-        </dependency>
         
         <dependency>
             <groupId>com.graphhopper</groupId>
diff --git a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMInputFile.java b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMInputFile.java
index b62830f9c4..60bdb560fd 100644
--- a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMInputFile.java
+++ b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMInputFile.java
@@ -54,7 +54,7 @@
 
     public OSMInputFile(File file) throws IOException {
         bis = decode(file);
-        itemQueue = new LinkedBlockingQueue<ReaderElement>(50000);
+        itemQueue = new LinkedBlockingQueue<>(50_000);
     }
 
     public OSMInputFile open() throws XMLStreamException {
@@ -236,7 +236,7 @@ public void close() throws IOException {
     private void openPBFReader(InputStream stream) {
         hasIncomingData = true;
         if (workerThreads <= 0)
-            workerThreads = 2;
+            workerThreads = 1;
 
         PbfReader reader = new PbfReader(stream, this, workerThreads);
         pbfReaderThread = new Thread(reader, "PBF Reader");
@@ -251,9 +251,10 @@ public void process(ReaderElement item) {
         } catch (InterruptedException ex) {
             throw new RuntimeException(ex);
         }
+    }
 
-        // throw exception if full
-        // itemQueue.add(item);
+    public int getUnprocessedElements() {
+        return itemQueue.size();
     }
 
     @Override
diff --git a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMReader.java b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMReader.java
index 5b1027461f..61d39ba9d5 100644
--- a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMReader.java
+++ b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMReader.java
@@ -17,7 +17,15 @@
  */
 package com.graphhopper.reader.osm;
 
+import com.carrotsearch.hppc.IntLongMap;
+import com.carrotsearch.hppc.LongArrayList;
+import com.carrotsearch.hppc.LongIndexedContainer;
+import com.carrotsearch.hppc.LongLongMap;
+import com.carrotsearch.hppc.LongSet;
+import com.graphhopper.coll.GHIntLongHashMap;
+import com.graphhopper.coll.GHLongHashSet;
 import com.graphhopper.coll.GHLongIntBTree;
+import com.graphhopper.coll.GHLongLongHashMap;
 import com.graphhopper.coll.LongIntMap;
 import com.graphhopper.reader.*;
 import com.graphhopper.reader.dem.ElevationProvider;
@@ -29,16 +37,6 @@
 import com.graphhopper.storage.*;
 import com.graphhopper.util.*;
 import com.graphhopper.util.shapes.GHPoint;
-import gnu.trove.list.TLongList;
-import gnu.trove.list.array.TLongArrayList;
-import gnu.trove.map.TIntLongMap;
-import gnu.trove.map.TLongLongMap;
-import gnu.trove.map.TLongObjectMap;
-import gnu.trove.map.hash.TIntLongHashMap;
-import gnu.trove.map.hash.TLongLongHashMap;
-import gnu.trove.map.hash.TLongObjectHashMap;
-import gnu.trove.set.TLongSet;
-import gnu.trove.set.hash.TLongHashSet;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -62,19 +60,19 @@
  * of the relation.
  * <p>
  * 2.a) Reads nodes from OSM file and stores lat+lon information either into the intermediate
- * datastructure for the pillar nodes (pillarLats/pillarLons) or, if a tower node, directly into the
+ * data structure for the pillar nodes (pillarLats/pillarLons) or, if a tower node, directly into the
  * graphStorage via setLatitude/setLongitude. It can also happen that a pillar node needs to be
  * transformed into a tower node e.g. via barriers or different speed values for one way.
  * <p>
  * 2.b) Reads ways OSM file and creates edges while calculating the speed etc from the OSM tags.
- * When creating an edge the pillar node information from the intermediate datastructure will be
+ * When creating an edge the pillar node information from the intermediate data structure will be
  * stored in the way geometry of that edge.
  * <p>
  *
  * @author Peter Karich
  */
 public class OSMReader implements DataReader {
-    protected static final int EMPTY = -1;
+    protected static final int EMPTY_NODE = -1;
     // pillar node is >= 3
     protected static final int PILLAR_NODE = 1;
     // tower node is <= -3
@@ -83,7 +81,7 @@
     private final GraphStorage ghStorage;
     private final Graph graph;
     private final NodeAccess nodeAccess;
-    private final TLongList barrierNodeIds = new TLongArrayList();
+    private final LongIndexedContainer barrierNodeIds = new LongArrayList();
     private final DistanceCalc distCalc = Helper.DIST_EARTH;
     private final DistanceCalc3D distCalc3D = Helper.DIST_3D;
     private final DouglasPeucker simplifyAlgo = new DouglasPeucker();
@@ -95,7 +93,7 @@
     private long locations;
     private long skippedLocations;
     private EncodingManager encodingManager = null;
-    private int workerThreads = -1;
+    private int workerThreads = 2;
     // Using the correct Map<Long, Integer> is hard. We need a memory efficient and fast solution for big data sets!
     //
     // very slow: new SparseLongLongArray
@@ -106,11 +104,11 @@
     // smaller memory overhead for bigger data sets because of avoiding a "rehash"
     // remember how many times a node was used to identify tower nodes
     private LongIntMap osmNodeIdToInternalNodeMap;
-    private TLongLongHashMap osmNodeIdToNodeFlagsMap;
-    private TLongLongHashMap osmWayIdToRouteWeightMap;
+    private GHLongLongHashMap osmNodeIdToNodeFlagsMap;
+    private GHLongLongHashMap osmWayIdToRouteWeightMap;
     // stores osm way ids used by relations to identify which edge ids needs to be mapped later
-    private TLongHashSet osmWayIdSet = new TLongHashSet();
-    private TIntLongMap edgeIdToOsmWayIdMap;
+    private GHLongHashSet osmWayIdSet = new GHLongHashSet();
+    private IntLongMap edgeIdToOsmWayIdMap;
     private boolean doSimplify = true;
     private int nextTowerId = 0;
     private int nextPillarId = 0;
@@ -126,8 +124,8 @@ public OSMReader(GraphHopperStorage ghStorage) {
         this.nodeAccess = graph.getNodeAccess();
 
         osmNodeIdToInternalNodeMap = new GHLongIntBTree(200);
-        osmNodeIdToNodeFlagsMap = new TLongLongHashMap(200, .5f, 0, 0);
-        osmWayIdToRouteWeightMap = new TLongLongHashMap(200, .5f, 0, 0);
+        osmNodeIdToNodeFlagsMap = new GHLongLongHashMap(200, .5f);
+        osmWayIdToRouteWeightMap = new GHLongLongHashMap(200, .5f);
         pillarInfo = new PillarInfo(nodeAccess.is3D(), ghStorage.getDirectory());
     }
 
@@ -150,8 +148,9 @@ public void readGraph() throws IOException {
         writeOsm2Graph(osmFile);
         sw2.stop();
 
-        LOGGER.info("time(pass1): " + (int) sw1.getSeconds() + " pass2: " + (int) sw2.getSeconds() + " total:"
-                + ((int) (sw1.getSeconds() + sw2.getSeconds())));
+        LOGGER.info("time pass1:" + (int) sw1.getSeconds() + "s, "
+                + "pass2:" + (int) sw2.getSeconds() + "s, "
+                + "total:" + (int) (sw1.getSeconds() + sw2.getSeconds()) + "s");
     }
 
     /**
@@ -171,13 +170,13 @@ void preProcess(File osmFile) {
                     final ReaderWay way = (ReaderWay) item;
                     boolean valid = filterWay(way);
                     if (valid) {
-                        TLongList wayNodes = way.getNodes();
+                        LongIndexedContainer wayNodes = way.getNodes();
                         int s = wayNodes.size();
                         for (int index = 0; index < s; index++) {
                             prepareHighwayNode(wayNodes.get(index));
                         }
 
-                        if (++tmpWayCounter % 5000000 == 0) {
+                        if (++tmpWayCounter % 10_000_000 == 0) {
                             LOGGER.info(nf(tmpWayCounter) + " (preprocess), osmIdMap:" + nf(getNodeMap().getSize()) + " ("
                                     + getNodeMap().getMemoryUsage() + "MB) " + Helper.getMemInfo());
                         }
@@ -190,7 +189,7 @@ void preProcess(File osmFile) {
                     if (relation.hasTag("type", "restriction"))
                         prepareRestrictionRelation(relation);
 
-                    if (++tmpRelationCounter % 50000 == 0) {
+                    if (++tmpRelationCounter % 100_000 == 0) {
                         LOGGER.info(nf(tmpRelationCounter) + " (preprocess), osmWayMap:" + nf(getRelFlagsMap().size())
                                 + " " + Helper.getMemInfo());
                     }
@@ -218,13 +217,13 @@ private void prepareRestrictionRelation(ReaderRelation relation) {
     /**
      * @return all required osmWayIds to process e.g. relations.
      */
-    private TLongSet getOsmWayIdSet() {
+    private LongSet getOsmWayIdSet() {
         return osmWayIdSet;
     }
 
-    private TIntLongMap getEdgeIdToOsmWayIdMap() {
+    private IntLongMap getEdgeIdToOsmWayIdMap() {
         if (edgeIdToOsmWayIdMap == null)
-            edgeIdToOsmWayIdMap = new TIntLongHashMap(getOsmWayIdSet().size(), 0.5f, -1, -1);
+            edgeIdToOsmWayIdMap = new GHIntLongHashMap(getOsmWayIdSet().size(), 0.5f);
 
         return edgeIdToOsmWayIdMap;
     }
@@ -249,7 +248,7 @@ boolean filterWay(ReaderWay item) {
     }
 
     /**
-     * Creates the edges and nodes files from the specified osm file.
+     * Creates the graph with edges and nodes from the specified osm file.
      */
     private void writeOsm2Graph(File osmFile) {
         int tmp = (int) Math.max(getNodeMap().getSize() / 50, 100);
@@ -291,11 +290,14 @@ private void writeOsm2Graph(File osmFile) {
                     default:
                         throw new IllegalStateException("Unknown type " + item.getType());
                 }
-                if (++counter % 100000000 == 0) {
+                if (++counter % 200_000_000 == 0) {
                     LOGGER.info(nf(counter) + ", locs:" + nf(locations) + " (" + skippedLocations + ") " + Helper.getMemInfo());
                 }
             }
 
+            if (in.getUnprocessedElements() > 0)
+                throw new IllegalStateException("Still unprocessed elements in reader queue " + in.getUnprocessedElements());
+
             // logger.info("storage nodes:" + storage.nodes() + " vs. graph nodes:" + storage.getGraph().nodes());
         } catch (Exception ex) {
             throw new RuntimeException("Couldn't process file " + osmFile + ", error: " + ex.getMessage(), ex);
@@ -305,7 +307,7 @@ private void writeOsm2Graph(File osmFile) {
 
         finishedReading();
         if (graph.getNodes() == 0)
-            throw new IllegalStateException("osm must not be empty. read " + counter + " lines and " + locations + " locations");
+            throw new RuntimeException("Graph after reading OSM must not be empty. Read " + counter + " items and " + locations + " locations");
     }
 
     /**
@@ -328,7 +330,7 @@ void processWay(ReaderWay way) {
         long relationFlags = getRelFlagsMap().get(way.getId());
 
         // TODO move this after we have created the edge and know the coordinates => encodingManager.applyWayTags
-        TLongList osmNodeIds = way.getNodes();
+        LongArrayList osmNodeIds = way.getNodes();
         // Estimate length of ways containing a route tag e.g. for ferry speed calculation
         if (osmNodeIds.size() > 1) {
             int first = getNodeMap().get(osmNodeIds.get(0));
@@ -377,11 +379,12 @@ void processWay(ReaderWay way) {
                         if (lastBarrier < 0)
                             lastBarrier = 0;
 
-                        // add way up to barrier shadow node
-                        long transfer[] = osmNodeIds.toArray(lastBarrier, i - lastBarrier + 1);
-                        transfer[transfer.length - 1] = newNodeId;
-                        TLongList partIds = new TLongArrayList(transfer);
-                        createdEdges.addAll(addOSMWay(partIds, wayFlags, wayOsmId));
+                        // add way up to barrier shadow node                        
+                        int length = i - lastBarrier + 1;
+                        LongArrayList partNodeIds = new LongArrayList();
+                        partNodeIds.add(osmNodeIds.buffer, lastBarrier, length);
+                        partNodeIds.set(length - 1, newNodeId);
+                        createdEdges.addAll(addOSMWay(partNodeIds, wayFlags, wayOsmId));
 
                         // create zero length edge for barrier
                         createdEdges.addAll(addBarrierEdge(newNodeId, nodeId, wayFlags, nodeFlags, wayOsmId));
@@ -401,8 +404,8 @@ void processWay(ReaderWay way) {
         // just add remainder of way to graph if barrier was not the last node
         if (lastBarrier >= 0) {
             if (lastBarrier < size - 1) {
-                long transfer[] = osmNodeIds.toArray(lastBarrier, size - lastBarrier);
-                TLongList partNodeIds = new TLongArrayList(transfer);
+                LongArrayList partNodeIds = new LongArrayList();
+                partNodeIds.add(osmNodeIds.buffer, lastBarrier, size - lastBarrier);
                 createdEdges.addAll(addOSMWay(partNodeIds, wayFlags, wayOsmId));
             }
         } else {
@@ -432,7 +435,7 @@ public void processRelation(ReaderRelation relation) throws XMLStreamException {
     }
 
     public Collection<TurnCostTableEntry> analyzeTurnRelation(OSMTurnRelation turnRelation) {
-        TLongObjectMap<TurnCostTableEntry> entries = new TLongObjectHashMap<OSMTurnRelation.TurnCostTableEntry>();
+        Map<Long, TurnCostTableEntry> entries = new LinkedHashMap<Long, OSMTurnRelation.TurnCostTableEntry>();
 
         for (FlagEncoder encoder : encodingManager.fetchEdgeEncoders()) {
             for (TurnCostTableEntry entry : analyzeTurnRelation(encoder, turnRelation)) {
@@ -446,7 +449,7 @@ public void processRelation(ReaderRelation relation) throws XMLStreamException {
             }
         }
 
-        return entries.valueCollection();
+        return entries.values();
     }
 
     public Collection<TurnCostTableEntry> analyzeTurnRelation(FlagEncoder encoder, OSMTurnRelation turnRelation) {
@@ -479,12 +482,12 @@ public int getInternalNodeIdOfOsmNode(long nodeOsmId) {
         if (id < TOWER_NODE)
             return -id - 3;
 
-        return EMPTY;
+        return EMPTY_NODE;
     }
 
     // TODO remove this ugly stuff via better preparsing phase! E.g. putting every tags etc into a helper file!
     double getTmpLatitude(int id) {
-        if (id == EMPTY)
+        if (id == EMPTY_NODE)
             return Double.NaN;
         if (id < TOWER_NODE) {
             // tower node
@@ -500,7 +503,7 @@ public int getInternalNodeIdOfOsmNode(long nodeOsmId) {
     }
 
     double getTmpLongitude(int id) {
-        if (id == EMPTY)
+        if (id == EMPTY_NODE)
             return Double.NaN;
         if (id < TOWER_NODE) {
             // tower node
@@ -534,7 +537,7 @@ private void processNode(ReaderNode node) {
 
     boolean addNode(ReaderNode node) {
         int nodeType = getNodeMap().get(node.getId());
-        if (nodeType == EMPTY)
+        if (nodeType == EMPTY_NODE)
             return false;
 
         double lat = node.getLat();
@@ -559,9 +562,7 @@ void prepareWaysWithRelationInfo(ReaderRelation osmRelation) {
         if (encodingManager.handleRelationTags(osmRelation, 0) == 0)
             return;
 
-        int size = osmRelation.getMembers().size();
-        for (int index = 0; index < size; index++) {
-            ReaderRelation.Member member = osmRelation.getMembers().get(index);
+        for (ReaderRelation.Member member : osmRelation.getMembers()) {
             if (member.getType() != ReaderRelation.Member.WAY)
                 continue;
 
@@ -576,11 +577,11 @@ void prepareWaysWithRelationInfo(ReaderRelation osmRelation) {
     }
 
     void prepareHighwayNode(long osmId) {
-        int tmpIndex = getNodeMap().get(osmId);
-        if (tmpIndex == EMPTY) {
+        int tmpGHNodeId = getNodeMap().get(osmId);
+        if (tmpGHNodeId == EMPTY_NODE) {
             // osmId is used exactly once
             getNodeMap().put(osmId, PILLAR_NODE);
-        } else if (tmpIndex > EMPTY) {
+        } else if (tmpGHNodeId > EMPTY_NODE) {
             // mark node as tower node as it occured at least twice times
             getNodeMap().put(osmId, TOWER_NODE);
         } else {
@@ -603,7 +604,7 @@ int addTowerNode(long osmId, double lat, double lon, double ele) {
     /**
      * This method creates from an OSM way (via the osm ids) one or more edges in the graph.
      */
-    Collection<EdgeIteratorState> addOSMWay(final TLongList osmNodeIds, final long flags, final long wayOsmId) {
+    Collection<EdgeIteratorState> addOSMWay(final LongIndexedContainer osmNodeIds, final long flags, final long wayOsmId) {
         PointList pointList = new PointList(osmNodeIds.size(), nodeAccess.is3D());
         List<EdgeIteratorState> newEdges = new ArrayList<EdgeIteratorState>(5);
         int firstNode = -1;
@@ -613,7 +614,7 @@ int addTowerNode(long osmId, double lat, double lon, double ele) {
             for (int i = 0; i < osmNodeIds.size(); i++) {
                 long osmId = osmNodeIds.get(i);
                 int tmpNode = getNodeMap().get(osmId);
-                if (tmpNode == EMPTY)
+                if (tmpNode == EMPTY_NODE)
                     continue;
 
                 // skip osmIds with no associated pillar or tower id (e.g. !OSMReader.isBounds)
@@ -867,11 +868,11 @@ protected LongIntMap getNodeMap() {
         return osmNodeIdToInternalNodeMap;
     }
 
-    protected TLongLongMap getNodeFlagsMap() {
+    protected LongLongMap getNodeFlagsMap() {
         return osmNodeIdToNodeFlagsMap;
     }
 
-    TLongLongHashMap getRelFlagsMap() {
+    GHLongLongHashMap getRelFlagsMap() {
         return osmWayIdToRouteWeightMap;
     }
 
diff --git a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMTurnRelation.java b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMTurnRelation.java
index 62a1994886..8570c67826 100644
--- a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMTurnRelation.java
+++ b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMTurnRelation.java
@@ -64,7 +64,7 @@ long getOsmIdTo() {
 
         try {
             // street with restriction was not included (access or tag limits etc)
-            if (nodeVia == OSMReader.EMPTY)
+            if (nodeVia == OSMReader.EMPTY_NODE)
                 return Collections.emptyList();
 
             int edgeIdFrom = EdgeIterator.NO_EDGE;
diff --git a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMXMLHelper.java b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMXMLHelper.java
index 9c859537d4..3af9ee6cb4 100644
--- a/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMXMLHelper.java
+++ b/reader-osm/src/main/java/com/graphhopper/reader/osm/OSMXMLHelper.java
@@ -85,17 +85,17 @@ public static ReaderRelation createRelation(long id, XMLStreamReader parser) thr
         ReaderRelation rel = new ReaderRelation(id);
 
         parser.nextTag();
-        readMembers(rel.getMembers(), parser);
+        readMembers(rel, parser);
         readTags(rel, parser);
         return rel;
     }
 
-    private static void readMembers(List<Member> members, XMLStreamReader parser) throws XMLStreamException {
+    private static void readMembers(ReaderRelation rel, XMLStreamReader parser) throws XMLStreamException {
         int event = parser.getEventType();
         while (event != XMLStreamConstants.END_DOCUMENT && parser.getLocalName().equalsIgnoreCase("member")) {
             if (event == XMLStreamConstants.START_ELEMENT) {
                 // read member
-                members.add(createMember(parser));
+                rel.add(createMember(parser));
             }
 
             event = parser.nextTag();
diff --git a/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfBlobDecoder.java b/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfBlobDecoder.java
index 9f289ca2d5..655cb29d61 100644
--- a/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfBlobDecoder.java
+++ b/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfBlobDecoder.java
@@ -1,6 +1,7 @@
 // This software is released into the Public Domain.  See copying.txt for details.
 package com.graphhopper.reader.osm.pbf;
 
+import com.carrotsearch.hppc.LongIndexedContainer;
 import com.google.protobuf.InvalidProtocolBufferException;
 import com.graphhopper.reader.ReaderElement;
 import com.graphhopper.reader.ReaderNode;
@@ -8,7 +9,6 @@
 import com.graphhopper.reader.ReaderWay;
 import com.graphhopper.reader.osm.OSMFileHeader;
 import com.graphhopper.util.Helper;
-import gnu.trove.list.TLongList;
 import org.openstreetmap.osmosis.osmbinary.Fileformat;
 import org.openstreetmap.osmosis.osmbinary.Osmformat;
 import org.slf4j.Logger;
@@ -229,7 +229,8 @@ private void processNodes(Osmformat.DenseNodes nodes, PbfFieldDecoder fieldDecod
                 int valueIndex = keysValuesIterator.next();
 
                 if (tags == null) {
-                    tags = new HashMap<String, String>();
+                    // devide by 2 as key&value, multiple by 2 because of the better approximation
+                    tags = new HashMap<String, String>(Math.max(3, 2 * (nodes.getKeysValsList().size() / 2) / idList.size()));
                 }
 
                 tags.put(fieldDecoder.decodeString(keyIndex), fieldDecoder.decodeString(valueIndex));
@@ -253,7 +254,7 @@ private void processWays(List<Osmformat.Way> ways, PbfFieldDecoder fieldDecoder)
             // delta encoded meaning that each id is stored as a delta against
             // the previous one.
             long nodeId = 0;
-            TLongList wayNodes = osmWay.getNodes();
+            LongIndexedContainer wayNodes = osmWay.getNodes();
             for (long nodeIdOffset : way.getRefsList()) {
                 nodeId += nodeIdOffset;
                 wayNodes.add(nodeId);
@@ -267,8 +268,6 @@ private void buildRelationMembers(ReaderRelation relation,
                                       List<Long> memberIds, List<Integer> memberRoles, List<Osmformat.Relation.MemberType> memberTypes,
                                       PbfFieldDecoder fieldDecoder) {
 
-        List<ReaderRelation.Member> members = relation.getMembers();
-
         // Ensure parallel lists are of equal size.
         if (checkData) {
             if ((memberIds.size() != memberRoles.size()) || (memberIds.size() != memberTypes.size())) {
@@ -302,8 +301,7 @@ private void buildRelationMembers(ReaderRelation relation,
             }
 
             ReaderRelation.Member member = new ReaderRelation.Member(entityType, refId, fieldDecoder.decodeString(memberRoleIterator.next()));
-
-            members.add(member);
+            relation.add(member);
         }
     }
 
@@ -327,7 +325,6 @@ private void processOsmPrimitives(byte[] data) throws InvalidProtocolBufferExcep
         PbfFieldDecoder fieldDecoder = new PbfFieldDecoder(block);
 
         for (Osmformat.PrimitiveGroup primitiveGroup : block.getPrimitivegroupList()) {
-            log.debug("Processing OSM primitive group.");
             processNodes(primitiveGroup.getDense(), fieldDecoder);
             processNodes(primitiveGroup.getNodesList(), fieldDecoder);
             processWays(primitiveGroup.getWaysList(), fieldDecoder);
diff --git a/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfDecoder.java b/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfDecoder.java
index fc2e7f6aeb..429f732e4d 100644
--- a/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfDecoder.java
+++ b/reader-osm/src/main/java/com/graphhopper/reader/osm/pbf/PbfDecoder.java
@@ -3,9 +3,11 @@
 
 import com.graphhopper.reader.ReaderElement;
 
+import java.util.ArrayList;
 import java.util.LinkedList;
 import java.util.List;
 import java.util.Queue;
+import java.util.concurrent.ArrayBlockingQueue;
 import java.util.concurrent.ExecutorService;
 import java.util.concurrent.locks.Condition;
 import java.util.concurrent.locks.Lock;
@@ -48,7 +50,7 @@ public PbfDecoder(PbfStreamSplitter streamSplitter, ExecutorService executorServ
         dataWaitCondition = lock.newCondition();
 
         // Create the queue of blobs being decoded.
-        blobResults = new LinkedList<PbfBlobResult>();
+        blobResults = new LinkedList<>();
     }
 
     /**
@@ -58,7 +60,6 @@ public PbfDecoder(PbfStreamSplitter streamSplitter, ExecutorService executorServ
     private void waitForUpdate() {
         try {
             dataWaitCondition.await();
-
         } catch (InterruptedException e) {
             throw new RuntimeException("Thread was interrupted.", e);
         }
diff --git a/reader-osm/src/test/java/com/graphhopper/GraphHopperIT.java b/reader-osm/src/test/java/com/graphhopper/GraphHopperIT.java
index acd5b4690c..768d943caf 100644
--- a/reader-osm/src/test/java/com/graphhopper/GraphHopperIT.java
+++ b/reader-osm/src/test/java/com/graphhopper/GraphHopperIT.java
@@ -23,10 +23,12 @@
 import com.graphhopper.util.*;
 import com.graphhopper.util.Parameters.CH;
 import com.graphhopper.util.Parameters.Routing;
+import com.graphhopper.util.exceptions.PointDistanceExceededException;
 import com.graphhopper.util.shapes.GHPoint;
 import org.junit.*;
 
 import java.io.File;
+import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.List;
 import java.util.Map;
@@ -38,10 +40,12 @@
  * @author Peter Karich
  */
 public class GraphHopperIT {
+
     public static final String DIR = "../core/files";
     private static final String graphFileFoot = "target/graphhopperIT-foot";
     private static final String osmFile = DIR + "/monaco.osm.gz";
     private static final String importVehicles = "foot";
+    private static final String genericImportVehicles = "generic,foot";
     private static final String vehicle = "foot";
     private static final String weightCalcStr = "shortest";
     private static GraphHopper hopper;
@@ -184,6 +188,120 @@ public void testAlternativeRoutesBikeAndCar() {
         assertEquals(958, rsp.getAll().get(2).getTime() / 1000);
     }
 
+    @Test
+    public void testPointHint() {
+        GraphHopper tmpHopper = new GraphHopperOSM().
+                setOSMFile(DIR + "/Laufamholzstrasse.osm.xml").
+                setCHEnabled(false).
+                setGraphHopperLocation(tmpGraphFile).
+                setEncodingManager(new EncodingManager("car"));
+        tmpHopper.importOrLoad();
+
+        GHRequest req = new GHRequest(49.46553, 11.154669, 49.465244, 11.152577).
+                setVehicle("car").setWeighting("fastest");
+
+        req.setPointHints(new ArrayList<>(Arrays.asList("Laufamholzstraße, 90482, Nürnberg, Deutschland", "")));
+        GHResponse rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        GHPoint snappedPoint = rsp.getBest().getWaypoints().toGHPoint(0);
+        assertEquals(49.465686, snappedPoint.getLat(), .000001);
+        assertEquals(11.154605, snappedPoint.getLon(), .000001);
+
+        req.setPointHints(new ArrayList<>(Arrays.asList("", "")));
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        snappedPoint = rsp.getBest().getWaypoints().toGHPoint(0);
+        assertEquals(49.465502, snappedPoint.getLat(), .000001);
+        assertEquals(11.154498, snappedPoint.getLon(), .000001);
+
+        // Match to closest edge, since hint was not found
+        req.setPointHints(new ArrayList<>(Arrays.asList("xy", "")));
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        snappedPoint = rsp.getBest().getWaypoints().toGHPoint(0);
+        assertEquals(49.465502, snappedPoint.getLat(), .000001);
+        assertEquals(11.154498, snappedPoint.getLon(), .000001);
+    }
+
+    @Test
+    public void testNorthBayreuthDestination() {
+        GraphHopper tmpHopper = new GraphHopperOSM().
+                setOSMFile(DIR + "/north-bayreuth.osm.gz").
+                setCHEnabled(false).
+                setGraphHopperLocation(tmpGraphFile).
+                setEncodingManager(new EncodingManager("car,generic", 8));
+        tmpHopper.importOrLoad();
+
+        GHRequest req = new GHRequest(49.985307, 11.50628, 49.985731, 11.507465).
+                setVehicle("car").setWeighting("fastest");
+
+        GHResponse rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(550, rsp.getBest().getDistance(), 1);
+
+        req = new GHRequest(49.985307, 11.50628, 49.985731, 11.507465).
+                setVehicle("generic").setWeighting("generic");
+
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(550, rsp.getBest().getDistance(), 1);
+    }
+
+    @Test
+    public void testNorthBayreuthBlockeEdges() {
+        GraphHopper tmpHopper = new GraphHopperOSM().
+                setOSMFile(DIR + "/north-bayreuth.osm.gz").
+                setCHEnabled(false).
+                setGraphHopperLocation(tmpGraphFile).
+                setEncodingManager(new EncodingManager("generic", 8));
+        tmpHopper.importOrLoad();
+
+        GHRequest req = new GHRequest(49.985272, 11.506151, 49.986107, 11.507202).
+                setVehicle("generic").setWeighting("generic");
+
+        GHResponse rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(122, rsp.getBest().getDistance(), 1);
+
+        // block point 49.985759,11.50687
+        req.getHints().put(Routing.BLOCK_AREA, "49.985759,11.50687");
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(365, rsp.getBest().getDistance(), 1);
+
+        req = new GHRequest(49.975845, 11.522598, 50.026821, 11.497364).
+                setVehicle("generic").setWeighting("generic");
+
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(6684, rsp.getBest().getDistance(), 1);
+
+        // block by area
+        String someArea = "49.97986,11.472902,50.003946,11.534357";
+        req.getHints().put(Routing.BLOCK_AREA, someArea);
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(12173, rsp.getBest().getDistance(), 1);
+
+        // Add blocked point to above area, to increase detour        
+        req.getHints().put(Routing.BLOCK_AREA, "50.017578,11.547527;" + someArea);
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(16674, rsp.getBest().getDistance(), 1);
+
+        // block by edge IDs -> i.e. use small circular area
+        req.getHints().put(Routing.BLOCK_AREA, "49.981599,11.517448,100");
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(6879, rsp.getBest().getDistance(), 1);
+
+        // block by edge IDs -> i.e. use small rectangular area
+        req.getHints().put(Routing.BLOCK_AREA, "49.981875,11.515818,49.981088,11.519423");
+        rsp = tmpHopper.route(req);
+        assertFalse(rsp.getErrors().toString(), rsp.hasErrors());
+        assertEquals(6879, rsp.getBest().getDistance(), 1);
+    }
+
     @Test
     public void testMonacoVia() {
         GHResponse rsp = hopper.route(new GHRequest().
@@ -193,7 +311,7 @@ public void testMonacoVia() {
                 setAlgorithm(ASTAR).setVehicle(vehicle).setWeighting(weightCalcStr));
 
         PathWrapper arsp = rsp.getBest();
-        assertEquals(6875.1, arsp.getDistance(), .1);
+        assertEquals(6875.2, arsp.getDistance(), .1);
         assertEquals(179, arsp.getPoints().getSize());
 
         InstructionList il = arsp.getInstructions();
@@ -293,6 +411,56 @@ public void testMonacoMaxVisitedNodes() {
         assertFalse(rsp.hasErrors());
     }
 
+    @Test
+    public void testMonacoNonChMaxWaypointDistance() {
+        GHPoint from = new GHPoint(43.741069, 7.426854);
+        GHPoint to = new GHPoint(43.727697, 7.419199);
+
+        GHRequest req = new GHRequest().
+                addPoint(from).
+                addPoint(to).
+                setVehicle(vehicle).setWeighting("fastest");
+
+        // Fail since points are too far
+        hopper.setNonChMaxWaypointDistance(1000);
+        GHResponse rsp = hopper.route(req);
+
+        assertTrue(rsp.hasErrors());
+
+        // Suceed since points are not far anymore
+        hopper.setNonChMaxWaypointDistance(Integer.MAX_VALUE);
+        rsp = hopper.route(req);
+
+        assertFalse(rsp.hasErrors());
+    }
+
+    @Test
+    public void testMonacoNonChMaxWaypointDistanceMultiplePoints() {
+        GHPoint from = new GHPoint(43.741069, 7.426854);
+        GHPoint via = new GHPoint(43.744445, 7.429483);
+        GHPoint to = new GHPoint(43.727697, 7.419199);
+
+        GHRequest req = new GHRequest().
+                addPoint(from).
+                addPoint(via).
+                addPoint(to).
+                setVehicle(vehicle).setWeighting("fastest");
+
+        // Fail since points are too far
+        hopper.setNonChMaxWaypointDistance(1000);
+        GHResponse rsp = hopper.route(req);
+
+        assertTrue(rsp.hasErrors());
+        PointDistanceExceededException exception = (PointDistanceExceededException) rsp.getErrors().get(0);
+        assertEquals(2, exception.getDetails().get("to"));
+
+        // Suceed since points are not far anymore
+        hopper.setNonChMaxWaypointDistance(Integer.MAX_VALUE);
+        rsp = hopper.route(req);
+
+        assertFalse(rsp.hasErrors());
+    }
+
     @Test
     public void testMonacoStraightVia() {
         GHRequest rq = new GHRequest().
@@ -372,6 +540,59 @@ public void testSRTMWithInstructions() throws Exception {
         assertEquals(52, il.createGPXList().get(10).getElevation(), 1e-2);
     }
 
+    @Test
+    public void testSRTMWithoutTunnelInterpolation() throws Exception {
+        GraphHopper tmpHopper = new GraphHopperOSM().setOSMFile(osmFile).setStoreOnFlush(true)
+                .setCHEnabled(false).setGraphHopperLocation(tmpGraphFile)
+                .setEncodingManager(new EncodingManager(importVehicles, 8));
+
+        tmpHopper.setElevationProvider(new SRTMProvider().setCacheDir(new File(DIR)));
+        tmpHopper.importOrLoad();
+
+        GHResponse rsp = tmpHopper.route(new GHRequest(43.74056471749763, 7.4299266210693755,
+                43.73790260334179, 7.427984089259056).setAlgorithm(ASTAR)
+                .setVehicle(vehicle).setWeighting(weightCalcStr));
+        PathWrapper arsp = rsp.getBest();
+        assertEquals(356.5, arsp.getDistance(), .1);
+        PointList pointList = arsp.getPoints();
+        assertEquals(6, pointList.getSize());
+        assertTrue(pointList.is3D());
+
+        assertEquals(20.0, pointList.getEle(0), .1);
+        assertEquals(23.0, pointList.getEle(1), .1);
+        assertEquals(23.0, pointList.getEle(2), .1);
+        assertEquals(41.0, pointList.getEle(3), .1);
+        assertEquals(19.0, pointList.getEle(4), .1);
+        assertEquals(26.5, pointList.getEle(5), .1);
+    }
+
+    @Test
+    public void testSRTMWithTunnelInterpolation() throws Exception {
+        GraphHopper tmpHopper = new GraphHopperOSM().setOSMFile(osmFile).setStoreOnFlush(true)
+                .setCHEnabled(false).setGraphHopperLocation(tmpGraphFile)
+                .setEncodingManager(new EncodingManager(genericImportVehicles, 8));
+
+        tmpHopper.setElevationProvider(new SRTMProvider().setCacheDir(new File(DIR)));
+        tmpHopper.importOrLoad();
+
+        GHResponse rsp = tmpHopper.route(new GHRequest(43.74056471749763, 7.4299266210693755,
+                43.73790260334179, 7.427984089259056).setAlgorithm(ASTAR)
+                .setVehicle(vehicle).setWeighting(weightCalcStr));
+        PathWrapper arsp = rsp.getBest();
+        // Without interpolation: 356.5
+        assertEquals(351.4, arsp.getDistance(), .1);
+        PointList pointList = arsp.getPoints();
+        assertEquals(6, pointList.getSize());
+        assertTrue(pointList.is3D());
+
+        assertEquals(17, pointList.getEle(0), .1);
+        assertEquals(19.04, pointList.getEle(1), .1);
+        assertEquals(21.67, pointList.getEle(2), .1);
+        assertEquals(25.03, pointList.getEle(3), .1);
+        assertEquals(28.65, pointList.getEle(4), .1);
+        assertEquals(31.32, pointList.getEle(5), .1);
+    }
+
     @Test
     public void testKremsCyclewayInstructionsWithWayTypeInfo() {
         String tmpOsmFile = DIR + "/krems.osm.gz";
@@ -391,7 +612,7 @@ public void testKremsCyclewayInstructionsWithWayTypeInfo() {
                 setAlgorithm(ASTAR).setVehicle(tmpVehicle).setWeighting(tmpWeightCalcStr));
 
         PathWrapper arsp = rsp.getBest();
-        assertEquals(6932.24, arsp.getDistance(), .1);
+        assertEquals(6932.2, arsp.getDistance(), .1);
         assertEquals(110, arsp.getPoints().getSize());
 
         InstructionList il = arsp.getInstructions();
@@ -562,7 +783,7 @@ public void testRoundTour() {
 
         assertEquals(1, rsp.getAll().size());
         PathWrapper pw = rsp.getBest();
-        assertEquals(1.5, rsp.getBest().getDistance() / 1000f, 0.1);
+        assertEquals(1.45, rsp.getBest().getDistance() / 1000f, .01);
         assertEquals(17, rsp.getBest().getTime() / 1000f / 60, 1);
         assertEquals(65, pw.getPoints().size());
     }
diff --git a/reader-osm/src/test/java/com/graphhopper/reader/osm/GraphHopperOSMTest.java b/reader-osm/src/test/java/com/graphhopper/reader/osm/GraphHopperOSMTest.java
index 217d5823b6..909f236aa8 100644
--- a/reader-osm/src/test/java/com/graphhopper/reader/osm/GraphHopperOSMTest.java
+++ b/reader-osm/src/test/java/com/graphhopper/reader/osm/GraphHopperOSMTest.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.reader.osm;
 
+import com.carrotsearch.hppc.IntArrayList;
 import com.graphhopper.GHRequest;
 import com.graphhopper.GHResponse;
 import com.graphhopper.GraphHopper;
@@ -225,6 +226,7 @@ protected DataReader importData() throws IOException {
                     latch2.countDown();
                     latch1.await(3, TimeUnit.SECONDS);
                 } catch (InterruptedException ex) {
+                    throw new RuntimeException(ex);
                 }
                 return super.importData();
             }
@@ -615,7 +617,7 @@ public void testGetPathsDirectionEnforcement3() {
         GHResponse response = new GHResponse();
         List<Path> paths = instance.calcPaths(req, response);
         assertFalse(response.hasErrors());
-        assertArrayEquals(new int[]{10, 5, 6, 7, 11}, paths.get(0).calcNodes().toArray());
+        assertEquals(IntArrayList.from(9, 5, 6, 7, 11), paths.get(0).calcNodes());
     }
 
     @Test
@@ -635,8 +637,8 @@ public void testGetPathsDirectionEnforcement4() {
         List<Path> paths = instance.calcPaths(req, response);
         assertFalse(response.hasErrors());
         assertEquals(1, response.getAll().size());
-        assertArrayEquals(new int[]{10, 4, 3, 11}, paths.get(0).calcNodes().toArray());
-        assertArrayEquals(new int[]{11, 8, 1, 2, 9}, paths.get(1).calcNodes().toArray());
+        assertEquals(IntArrayList.from(9, 4, 3, 10), paths.get(0).calcNodes());
+        assertEquals(IntArrayList.from(10, 8, 1, 2, 11), paths.get(1).calcNodes());
     }
 
     @Test
@@ -655,8 +657,8 @@ public void testGetPathsDirectionEnforcement5() {
         GHResponse response = new GHResponse();
         List<Path> paths = instance.calcPaths(req, response);
         assertFalse(response.hasErrors());
-        assertArrayEquals(new int[]{10, 4, 3, 8, 7, 9}, paths.get(0).calcNodes().toArray());
-        assertArrayEquals(new int[]{9, 6, 5, 10, 4, 3, 11}, paths.get(1).calcNodes().toArray());
+        assertEquals(IntArrayList.from(9, 4, 3, 8, 7, 11), paths.get(0).calcNodes());
+        assertEquals(IntArrayList.from(11, 6, 5, 9, 4, 3, 10), paths.get(1).calcNodes());
     }
 
     @Test
@@ -825,14 +827,14 @@ public void testGetWeightingForCH() {
         // use simple truck first
         EncodingManager em = new EncodingManager(simpleTruck, truck);
         CHAlgoFactoryDecorator decorator = new CHAlgoFactoryDecorator();
-        Weighting fwSimpleT = new FastestWeighting(simpleTruck);
-        Weighting fwT = new FastestWeighting(truck);
+        Weighting fwSimpleTruck = new FastestWeighting(simpleTruck);
+        Weighting fwTruck = new FastestWeighting(truck);
         RAMDirectory ramDir = new RAMDirectory();
-        GraphHopperStorage storage = new GraphHopperStorage(Arrays.asList(fwSimpleT, fwT), ramDir, em, false, new GraphExtension.NoOpExtension());
-        decorator.addWeighting(fwSimpleT);
-        decorator.addWeighting(fwT);
-        decorator.addPreparation(new PrepareContractionHierarchies(ramDir, storage, storage.getGraph(CHGraph.class, fwSimpleT), simpleTruck, fwSimpleT, TraversalMode.NODE_BASED));
-        decorator.addPreparation(new PrepareContractionHierarchies(ramDir, storage, storage.getGraph(CHGraph.class, fwT), truck, fwT, TraversalMode.NODE_BASED));
+        GraphHopperStorage storage = new GraphHopperStorage(Arrays.asList(fwSimpleTruck, fwTruck), ramDir, em, false, new GraphExtension.NoOpExtension());
+        decorator.addWeighting(fwSimpleTruck);
+        decorator.addWeighting(fwTruck);
+        decorator.addPreparation(new PrepareContractionHierarchies(ramDir, storage, storage.getGraph(CHGraph.class, fwSimpleTruck), fwSimpleTruck, TraversalMode.NODE_BASED));
+        decorator.addPreparation(new PrepareContractionHierarchies(ramDir, storage, storage.getGraph(CHGraph.class, fwTruck), fwTruck, TraversalMode.NODE_BASED));
 
         HintsMap wMap = new HintsMap("fastest");
         wMap.put("vehicle", "truck");
@@ -841,10 +843,10 @@ public void testGetWeightingForCH() {
         assertEquals("fastest|simple_truck", ((PrepareContractionHierarchies) decorator.getDecoratedAlgorithmFactory(null, wMap)).getWeighting().toString());
 
         // make sure weighting cannot be mixed
-        decorator.addWeighting(fwT);
-        decorator.addWeighting(fwSimpleT);
+        decorator.addWeighting(fwTruck);
+        decorator.addWeighting(fwSimpleTruck);
         try {
-            decorator.addPreparation(new PrepareContractionHierarchies(ramDir, storage, storage.getGraph(CHGraph.class, fwSimpleT), simpleTruck, fwSimpleT, TraversalMode.NODE_BASED));
+            decorator.addPreparation(new PrepareContractionHierarchies(ramDir, storage, storage.getGraph(CHGraph.class, fwSimpleTruck), fwSimpleTruck, TraversalMode.NODE_BASED));
             assertTrue(false);
         } catch (Exception ex) {
         }
diff --git a/reader-osm/src/test/java/com/graphhopper/reader/osm/OSMReaderTest.java b/reader-osm/src/test/java/com/graphhopper/reader/osm/OSMReaderTest.java
index 1d4b42585a..92f7c323c5 100644
--- a/reader-osm/src/test/java/com/graphhopper/reader/osm/OSMReaderTest.java
+++ b/reader-osm/src/test/java/com/graphhopper/reader/osm/OSMReaderTest.java
@@ -17,6 +17,7 @@
  */
 package com.graphhopper.reader.osm;
 
+import com.carrotsearch.hppc.LongIndexedContainer;
 import com.graphhopper.GHRequest;
 import com.graphhopper.GHResponse;
 import com.graphhopper.GraphHopper;
@@ -33,7 +34,6 @@
 import com.graphhopper.storage.index.QueryResult;
 import com.graphhopper.util.*;
 import com.graphhopper.util.shapes.GHPoint;
-import gnu.trove.list.TLongList;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
@@ -64,6 +64,7 @@
     private final String fileNegIds = "test-osm-negative-ids.xml";
     private final String fileBarriers = "test-barriers.xml";
     private final String fileTurnRestrictions = "test-restrictions.xml";
+    private final String fileRoadAttributes = "test-road-attributes.xml";
     private final String dir = "./target/tmp/test-db";
     private CarFlagEncoder carEncoder;
     private BikeFlagEncoder bikeEncoder;
@@ -92,7 +93,7 @@ InputStream getResource(String file) {
 
     @Test
     public void testMain() {
-        GraphHopper hopper = new GraphHopperTest(file1).importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade(file1).importOrLoad();
         GraphHopperStorage graph = hopper.getGraphHopperStorage();
 
         assertNotNull(graph.getProperties().get("datareader.import.date"));
@@ -153,7 +154,7 @@ protected int findID(LocationIndex index, double lat, double lon) {
 
     @Test
     public void testSort() {
-        GraphHopper hopper = new GraphHopperTest(file1).setSortGraph(true).importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade(file1).setSortGraph(true).importOrLoad();
         NodeAccess na = hopper.getGraphHopperStorage().getNodeAccess();
         assertEquals(10, na.getLongitude(findID(hopper.getLocationIndex(), 49, 10)), 1e-3);
         assertEquals(51.249, na.getLatitude(findID(hopper.getLocationIndex(), 51.2492152, 9.4317166)), 1e-3);
@@ -161,7 +162,7 @@ public void testSort() {
 
     @Test
     public void testWithBounds() {
-        GraphHopper hopper = new GraphHopperTest(file1) {
+        GraphHopper hopper = new GraphHopperFacade(file1) {
             @Override
             protected DataReader createReader(GraphHopperStorage tmpGraph) {
                 return new OSMReader(tmpGraph) {
@@ -208,7 +209,7 @@ public boolean isInBounds(ReaderNode node) {
 
     @Test
     public void testOneWay() {
-        GraphHopper hopper = new GraphHopperTest(file2).importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade(file2).importOrLoad();
         GraphHopperStorage graph = hopper.getGraphHopperStorage();
 
         assertEquals("2014-01-02T01:10:14Z", graph.getProperties().get("datareader.data.date"));
@@ -257,7 +258,7 @@ public void testOneWay() {
 
     @Test
     public void testFerry() {
-        GraphHopper hopper = new GraphHopperTest(file2) {
+        GraphHopper hopper = new GraphHopperFacade(file2) {
             @Override
             public void cleanUp() {
             }
@@ -283,7 +284,7 @@ public void cleanUp() {
 
     @Test
     public void testMaxSpeed() {
-        GraphHopper hopper = new GraphHopperTest(file2) {
+        GraphHopper hopper = new GraphHopperFacade(file2) {
             @Override
             public void cleanUp() {
             }
@@ -298,7 +299,7 @@ public void cleanUp() {
 
     @Test
     public void testWayReferencesNotExistingAdjNode() {
-        GraphHopper hopper = new GraphHopperTest(file4).importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade(file4).importOrLoad();
         Graph graph = hopper.getGraphHopperStorage();
 
         assertEquals(2, graph.getNodes());
@@ -310,7 +311,7 @@ public void testWayReferencesNotExistingAdjNode() {
 
     @Test
     public void testFoot() {
-        GraphHopper hopper = new GraphHopperTest(file3).importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade(file3).importOrLoad();
         Graph graph = hopper.getGraphHopperStorage();
 
         int n10 = AbstractGraphStorageTester.getIdOf(graph, 11.1);
@@ -332,7 +333,7 @@ public void testFoot() {
 
     @Test
     public void testNegativeIds() {
-        GraphHopper hopper = new GraphHopperTest(fileNegIds).importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade(fileNegIds).importOrLoad();
         Graph graph = hopper.getGraphHopperStorage();
         assertEquals(4, graph.getNodes());
         int n20 = AbstractGraphStorageTester.getIdOf(graph, 52);
@@ -356,7 +357,7 @@ public void testNegativeIds() {
 
     @Test
     public void testBarriers() {
-        GraphHopper hopper = new GraphHopperTest(fileBarriers).
+        GraphHopper hopper = new GraphHopperFacade(fileBarriers).
                 setMinNetworkSize(0, 0).
                 importOrLoad();
 
@@ -393,7 +394,7 @@ public void testBarriers() {
 
     @Test
     public void testBarriersOnTowerNodes() {
-        GraphHopper hopper = new GraphHopperTest(fileBarriers).
+        GraphHopper hopper = new GraphHopperFacade(fileBarriers).
                 setMinNetworkSize(0, 0).
                 importOrLoad();
         Graph graph = hopper.getGraphHopperStorage();
@@ -421,8 +422,8 @@ public void testRelation() {
         OSMReader reader = new OSMReader(ghStorage).
                 setEncodingManager(manager);
         ReaderRelation osmRel = new ReaderRelation(1);
-        osmRel.getMembers().add(new ReaderRelation.Member(ReaderRelation.WAY, 1, ""));
-        osmRel.getMembers().add(new ReaderRelation.Member(ReaderRelation.WAY, 2, ""));
+        osmRel.add(new ReaderRelation.Member(ReaderRelation.WAY, 1, ""));
+        osmRel.add(new ReaderRelation.Member(ReaderRelation.WAY, 2, ""));
 
         osmRel.setTag("route", "bicycle");
         osmRel.setTag("network", "lcn");
@@ -446,7 +447,7 @@ public void testRelation() {
 
     @Test
     public void testTurnRestrictions() {
-        GraphHopper hopper = new GraphHopperTest(fileTurnRestrictions, true).
+        GraphHopper hopper = new GraphHopperFacade(fileTurnRestrictions, true).
                 importOrLoad();
 
         Graph graph = hopper.getGraphHopperStorage();
@@ -511,6 +512,49 @@ public void testTurnRestrictions() {
         assertTrue(bikeEncoder.isTurnRestricted(costsFlags));
     }
 
+    @Test
+    public void testRoadAttributes() {
+        GraphHopper hopper = new GraphHopperFacade(fileRoadAttributes);
+        DataFlagEncoder dataFlagEncoder = (new DataFlagEncoder()).setStoreHeight(true).setStoreWeight(true).setStoreWidth(true);
+        hopper.setEncodingManager(new EncodingManager(Arrays.asList(dataFlagEncoder), 8));
+        hopper.importOrLoad();
+
+        Graph graph = hopper.getGraphHopperStorage();
+        DataFlagEncoder encoder = (DataFlagEncoder) hopper.getEncodingManager().getEncoder("generic");
+        assertEquals(5, graph.getNodes());
+
+        int na = AbstractGraphStorageTester.getIdOf(graph, 11.1, 50);
+        int nb = AbstractGraphStorageTester.getIdOf(graph, 12, 51);
+        int nc = AbstractGraphStorageTester.getIdOf(graph, 11.2, 52);
+        int nd = AbstractGraphStorageTester.getIdOf(graph, 11.3, 51);
+        int ne = AbstractGraphStorageTester.getIdOf( graph, 10, 51 );
+
+        EdgeIteratorState edge_ab = GHUtility.getEdge(graph, na, nb);
+        EdgeIteratorState edge_ad = GHUtility.getEdge(graph, na, nd);
+        EdgeIteratorState edge_ae = GHUtility.getEdge(graph, na, ne);
+        EdgeIteratorState edge_bc = GHUtility.getEdge(graph, nb, nc);
+        EdgeIteratorState edge_bd = GHUtility.getEdge(graph, nb, nd);
+        EdgeIteratorState edge_cd = GHUtility.getEdge(graph, nc, nd);
+        EdgeIteratorState edge_ce = GHUtility.getEdge(graph, nc, ne);
+        EdgeIteratorState edge_de = GHUtility.getEdge(graph, nd, ne);
+
+        assertEquals(4.0, encoder.getHeight(edge_ab), 1e-5);
+        assertEquals(2.5, encoder.getWidth(edge_ab), 1e-5);
+        assertEquals(4.4, encoder.getWeight(edge_ab), 1e-5);
+
+        assertEquals(4.0, encoder.getHeight(edge_bc), 1e-5);
+        assertEquals(2.5, encoder.getWidth(edge_bc), 1e-5);
+        assertEquals(4.4, encoder.getWeight(edge_bc), 1e-5);
+
+        assertEquals(4.4, encoder.getHeight(edge_ad), 1e-5);
+        assertEquals(3.5, encoder.getWidth(edge_ad), 1e-5);
+        assertEquals(17.5, encoder.getWeight(edge_ad), 1e-5);
+
+        assertEquals(4.4, encoder.getHeight(edge_cd), 1e-5);
+        assertEquals(3.5, encoder.getWidth(edge_cd), 1e-5);
+        assertEquals(17.5, encoder.getWeight(edge_cd), 1e-5);
+    }
+
     @Test
     public void testEstimatedCenter() {
         final CarFlagEncoder encoder = new CarFlagEncoder() {
@@ -553,7 +597,7 @@ public long handleNodeTags(ReaderNode node) {
             }
 
             @Override
-            Collection<EdgeIteratorState> addOSMWay(TLongList osmNodeIds, long wayFlags, long osmId) {
+            Collection<EdgeIteratorState> addOSMWay(LongIndexedContainer osmNodeIds, long wayFlags, long osmId) {
                 return Collections.emptyList();
             }
         };
@@ -580,7 +624,7 @@ public long handleNodeTags(ReaderNode node) {
 
     @Test
     public void testReadEleFromCustomOSM() {
-        GraphHopper hopper = new GraphHopperTest("custom-osm-ele.xml") {
+        GraphHopper hopper = new GraphHopperFacade("custom-osm-ele.xml") {
             @Override
             protected DataReader createReader(GraphHopperStorage tmpGraph) {
                 return initDataReader(new OSMReader(tmpGraph) {
@@ -602,7 +646,7 @@ protected double getElevation(ReaderNode node) {
 
     @Test
     public void testReadEleFromDataProvider() {
-        GraphHopper hopper = new GraphHopperTest("test-osm5.xml");
+        GraphHopper hopper = new GraphHopperFacade("test-osm5.xml");
         // get N10E046.hgt.zip
         ElevationProvider provider = new SRTMProvider();
         provider.setCacheDir(new File(GraphHopperIT.DIR));
@@ -705,14 +749,14 @@ public void testTurnFlagCombination() {
 
     @Test
     public void testPreferredLanguage() {
-        GraphHopper hopper = new GraphHopperTest(file1).setPreferredLanguage("de").importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade(file1).setPreferredLanguage("de").importOrLoad();
         GraphHopperStorage graph = hopper.getGraphHopperStorage();
         int n20 = AbstractGraphStorageTester.getIdOf(graph, 52);
         EdgeIterator iter = carOutExplorer.setBaseNode(n20);
         assertTrue(iter.next());
         assertEquals("straße 123, B 122", iter.getName());
 
-        hopper = new GraphHopperTest(file1).setPreferredLanguage("el").importOrLoad();
+        hopper = new GraphHopperFacade(file1).setPreferredLanguage("el").importOrLoad();
         graph = hopper.getGraphHopperStorage();
         n20 = AbstractGraphStorageTester.getIdOf(graph, 52);
         iter = carOutExplorer.setBaseNode(n20);
@@ -723,7 +767,7 @@ public void testPreferredLanguage() {
 
     @Test
     public void testDataDateWithinPBF() {
-        GraphHopper hopper = new GraphHopperTest(file6).importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade("test-osm6.pbf").importOrLoad();
         GraphHopperStorage graph = hopper.getGraphHopperStorage();
 
         assertEquals("2014-01-02T00:10:14Z", graph.getProperties().get("datareader.data.date"));
@@ -731,7 +775,7 @@ public void testDataDateWithinPBF() {
 
     @Test
     public void testCrossBoundary_issue667() {
-        GraphHopper hopper = new GraphHopperTest("test-osm-waterway.xml").importOrLoad();
+        GraphHopper hopper = new GraphHopperFacade("test-osm-waterway.xml").importOrLoad();
         QueryResult qr = hopper.getLocationIndex().findClosest(0.1, 179.5, EdgeFilter.ALL_EDGES);
         assertTrue(qr.isValid());
         assertEquals(0.1, qr.getSnappedPoint().lat, 0.1);
@@ -745,14 +789,15 @@ public void testCrossBoundary_issue667() {
         assertEquals(56, qr.getClosestEdge().getDistance() / 1000, 1);
     }
 
+    @Test
     public void testRoutingRequestFails_issue665() {
         GraphHopper hopper = new GraphHopperOSM()
-                .setDataReaderFile("src/test/resources/com/graphhopper/reader/" + file7)
+                .setDataReaderFile(getClass().getResource(file7).getFile())
                 .setEncodingManager(new EncodingManager("car,motorcycle"))
                 .setGraphHopperLocation(dir);
         hopper.getCHFactoryDecorator().setEnabled(false);
         hopper.importOrLoad();
-        GHRequest req = new GHRequest(48.97725592769741, 8.256896138191223, 48.978875552977684, 8.25486302375793).
+        GHRequest req = new GHRequest(48.977277, 8.256896, 48.978876, 8.254884).
                 setWeighting("curvature").
                 setVehicle("motorcycle");
 
@@ -760,12 +805,12 @@ public void testRoutingRequestFails_issue665() {
         assertFalse(ghRsp.getErrors().toString(), ghRsp.hasErrors());
     }
 
-    class GraphHopperTest extends GraphHopperOSM {
-        public GraphHopperTest(String osmFile) {
+    class GraphHopperFacade extends GraphHopperOSM {
+        public GraphHopperFacade(String osmFile) {
             this(osmFile, false);
         }
 
-        public GraphHopperTest(String osmFile, boolean turnCosts) {
+        public GraphHopperFacade(String osmFile, boolean turnCosts) {
             setStoreOnFlush(false);
             setOSMFile(osmFile);
             setGraphHopperLocation(dir);
diff --git a/reader-osm/src/test/java/com/graphhopper/routing/RoutingAlgorithmWithOSMIT.java b/reader-osm/src/test/java/com/graphhopper/routing/RoutingAlgorithmWithOSMIT.java
index 9f2720fcd6..acc7f9ae2b 100644
--- a/reader-osm/src/test/java/com/graphhopper/routing/RoutingAlgorithmWithOSMIT.java
+++ b/reader-osm/src/test/java/com/graphhopper/routing/RoutingAlgorithmWithOSMIT.java
@@ -46,6 +46,8 @@
 import static com.graphhopper.util.Parameters.Algorithms.DIJKSTRA_BI;
 import static org.junit.Assert.assertEquals;
 
+import org.junit.Ignore;
+
 /**
  * Try algorithms, indices and graph storages with real data
  * <p>
@@ -137,52 +139,6 @@ public void testBike2_issue432() {
         assertEquals(testCollector.toString(), 0, testCollector.errors.size());
     }
 
-    @Test
-    public void testMonacoAllAlgorithmsWithBaseGraph() {
-        String vehicle = "car";
-        String graphFile = "target/monaco-gh";
-        String osmFile = DIR + "/monaco.osm.gz";
-        String importVehicles = vehicle;
-
-        Helper.removeDir(new File(graphFile));
-        GraphHopper hopper = new GraphHopperOSM().
-                // avoid that path.getDistance is too different to path.getPoint.calcDistance
-                setWayPointMaxDistance(0).
-                setDataReaderFile(osmFile).
-                setCHEnabled(false).
-                setGraphHopperLocation(graphFile).
-                setEncodingManager(new EncodingManager(importVehicles));
-
-        hopper.importOrLoad();
-
-        FlagEncoder encoder = hopper.getEncodingManager().getEncoder(vehicle);
-        Weighting weighting = hopper.createWeighting(new HintsMap("shortest"), encoder);
-
-        List<AlgoHelperEntry> prepares = RoutingAlgorithmIT.createAlgos(hopper.getGraphHopperStorage(), hopper.getLocationIndex(),
-                encoder, true, TraversalMode.NODE_BASED, weighting, hopper.getEncodingManager());
-        AlgoHelperEntry chPrepare = prepares.get(prepares.size() - 1);
-        if (!(chPrepare.getQueryGraph() instanceof CHGraph))
-            throw new IllegalStateException("Last prepared QueryGraph has to be a CHGraph");
-
-        // set all normal algorithms to baseGraph of already prepared to see if all algorithms still work
-        Graph baseGraphOfCHPrepared = chPrepare.getBaseGraph();
-        for (AlgoHelperEntry ahe : prepares) {
-            if (!(ahe.getQueryGraph() instanceof CHGraph)) {
-                ahe.setQueryGraph(baseGraphOfCHPrepared);
-            }
-        }
-
-        List<OneRun> forEveryAlgo = createMonacoCar();
-        EdgeFilter edgeFilter = new DefaultEdgeFilter(encoder);
-        for (AlgoHelperEntry entry : prepares) {
-            LocationIndex idx = entry.getIdx();
-            for (OneRun oneRun : forEveryAlgo) {
-                List<QueryResult> list = oneRun.getList(idx, edgeFilter);
-                testCollector.assertDistance(entry, list, oneRun);
-            }
-        }
-    }
-
     @Test
     public void testOneWayCircleBug() {
         // export from http://www.openstreetmap.org/export#map=19/51.37605/-0.53155
@@ -366,7 +322,7 @@ public void testMonacoBike() {
     public void testMonacoMountainBike() {
         List<OneRun> list = new ArrayList<OneRun>();
         list.add(new OneRun(43.730864, 7.420771, 43.727687, 7.418737, 2322, 110));
-        list.add(new OneRun(43.727687, 7.418737, 43.74958, 7.436566, 3613, 178));
+        list.add(new OneRun(43.727687, 7.418737, 43.74958, 7.436566, 3655, 176));
         list.add(new OneRun(43.728677, 7.41016, 43.739213, 7.427806, 2331, 121));
         // hard to select between secondary and primary (both are AVOID for mtb)
         list.add(new OneRun(43.733802, 7.413433, 43.739662, 7.424355, 1459, 88));
@@ -400,7 +356,7 @@ public void testKremsBikeRelation() {
         List<OneRun> list = new ArrayList<OneRun>();
         list.add(new OneRun(48.409523, 15.602394, 48.375466, 15.72916, 12491, 159));
         // 3109m is better as cyclepath is used
-        list.add(new OneRun(48.410061, 15.63951, 48.411386, 15.604899, 3077, 79));
+        list.add(new OneRun(48.410061, 15.63951, 48.411386, 15.604899, 3112, 87));
         list.add(new OneRun(48.412294, 15.62007, 48.398306, 15.609667, 3965, 94));
 
         runAlgo(testCollector, DIR + "/krems.osm.gz", "target/krems-gh",
@@ -495,8 +451,11 @@ public void testMonacoVia() {
     @Test
     public void testHarsdorf() {
         List<OneRun> list = new ArrayList<OneRun>();
+        // TODO somehow the bigger road is take even if we make it less preferred (e.g. introduce AVOID AT ALL costs for lanes=2&&maxspeed>50)
+        list.add(new OneRun(50.004333, 11.600254, 50.044449, 11.543434, 6952, 190));
+
         // choose Unterloher Weg and the following residential + cycleway
-        list.add(new OneRun(50.004333, 11.600254, 50.044449, 11.543434, 6931, 184));
+        // list.add(new OneRun(50.004333, 11.600254, 50.044449, 11.543434, 6931, 184));
         runAlgo(testCollector, DIR + "/north-bayreuth.osm.gz", "target/north-bayreuth-gh",
                 list, "bike", true, "bike", "fastest", false);
         assertEquals(testCollector.toString(), 0, testCollector.errors.size());
@@ -517,36 +476,48 @@ public void testNeudrossenfeld() {
     }
 
     /**
-     * @param testAlsoCH if true also the CH algorithms will be tested which needs preparation and
-     *                   takes a bit longer
+     * @param withPreparedAlgos if true also the CH and LM algorithms will be tested which need
+     *                          preparation and takes a bit longer
      */
     Graph runAlgo(TestAlgoCollector testCollector, String osmFile,
                   String graphFile, List<OneRun> forEveryAlgo, String importVehicles,
-                  boolean testAlsoCH, String vehicle, String weightStr, boolean is3D) {
+                  boolean withPreparedAlgos, String vehicle, String weightStr, boolean is3D) {
+
+        // for different weightings we need a different storage, otherwise we would need to remove the graph folder
+        // everytime we come with a different weighting
+        // graphFile += weightStr;
+
         AlgoHelperEntry algoEntry = null;
         OneRun tmpOneRun = null;
         try {
             Helper.removeDir(new File(graphFile));
             GraphHopper hopper = new GraphHopperOSM().
                     setStoreOnFlush(true).
-                    // avoid that path.getDistance is too different to path.getPoint.calcDistance
-                    setWayPointMaxDistance(0).
-                    setDataReaderFile(osmFile).
                     setCHEnabled(false).
+                    setDataReaderFile(osmFile).
                     setGraphHopperLocation(graphFile).
                     setEncodingManager(new EncodingManager(importVehicles));
+
+            // avoid that path.getDistance is too different to path.getPoint.calcDistance
+            hopper.setWayPointMaxDistance(0);
+
+            if (withPreparedAlgos) {
+                hopper.getCHFactoryDecorator().setEnabled(true);
+                hopper.getCHFactoryDecorator().addWeighting(weightStr);
+            }
+
             if (is3D)
                 hopper.setElevationProvider(new SRTMProvider().setCacheDir(new File(DIR)));
 
             hopper.importOrLoad();
 
             TraversalMode tMode = importVehicles.contains("turn_costs=true")
-                    ? TraversalMode.EDGE_BASED_1DIR : TraversalMode.NODE_BASED;
+                    ? TraversalMode.EDGE_BASED_2DIR : TraversalMode.NODE_BASED;
             FlagEncoder encoder = hopper.getEncodingManager().getEncoder(vehicle);
-            Weighting weighting = hopper.createWeighting(new HintsMap(weightStr), encoder);
+            HintsMap hints = new HintsMap().setWeighting(weightStr).setVehicle(vehicle);
+
+            Collection<AlgoHelperEntry> prepares = RoutingAlgorithmIT.createAlgos(hopper, hints, tMode);
 
-            Collection<AlgoHelperEntry> prepares = RoutingAlgorithmIT.createAlgos(hopper.getGraphHopperStorage(),
-                    hopper.getLocationIndex(), encoder, testAlsoCH, tMode, weighting, hopper.getEncodingManager());
             EdgeFilter edgeFilter = new DefaultEdgeFilter(encoder);
             for (AlgoHelperEntry entry : prepares) {
                 algoEntry = entry;
@@ -576,7 +547,7 @@ public void testMonacoParallel() throws IOException {
         String graphFile = "target/monaco-gh";
         Helper.removeDir(new File(graphFile));
         final EncodingManager encodingManager = new EncodingManager("car");
-        GraphHopper hopper = new GraphHopperOSM().
+        final GraphHopper hopper = new GraphHopperOSM().
                 setStoreOnFlush(true).
                 setEncodingManager(encodingManager).setCHEnabled(false).
                 setWayPointMaxDistance(0).
@@ -596,10 +567,11 @@ public void testMonacoParallel() throws IOException {
         int algosLength = 2;
         final Weighting weighting = new ShortestWeighting(encodingManager.getEncoder("car"));
         final EdgeFilter filter = new DefaultEdgeFilter(carEncoder);
+        final HintsMap hints = new HintsMap().setWeighting("shortest").setVehicle("car");
         for (int no = 0; no < MAX; no++) {
             for (int instanceNo = 0; instanceNo < instances.size(); instanceNo++) {
                 String[] algos = new String[]{
-                    ASTAR, DIJKSTRA_BI
+                        ASTAR, DIJKSTRA_BI
                 };
                 for (final String algoStr : algos) {
                     // an algorithm is not thread safe! reuse via clear() is ONLY appropriated if used from same thread!
@@ -608,8 +580,8 @@ public void testMonacoParallel() throws IOException {
                         @Override
                         public void run() {
                             OneRun oneRun = instances.get(instanceIndex);
-                            AlgorithmOptions opts = AlgorithmOptions.start().flagEncoder(carEncoder).weighting(weighting).algorithm(algoStr).build();
-                            testCollector.assertDistance(new AlgoHelperEntry(g, g, opts, idx),
+                            AlgorithmOptions opts = AlgorithmOptions.start().weighting(weighting).algorithm(algoStr).build();
+                            testCollector.assertDistance(new AlgoHelperEntry(g, opts, idx, algoStr + "|" + weighting),
                                     oneRun.getList(idx, filter), oneRun);
                             integ.addAndGet(1);
                         }
diff --git a/reader-osm/src/test/resources/com/graphhopper/reader/osm/test-road-attributes.xml b/reader-osm/src/test/resources/com/graphhopper/reader/osm/test-road-attributes.xml
new file mode 100644
index 0000000000..8f919672c2
--- /dev/null
+++ b/reader-osm/src/test/resources/com/graphhopper/reader/osm/test-road-attributes.xml
@@ -0,0 +1,67 @@
+<?xml version='1.0' encoding='UTF-8'?>
+<osm version="0.6" generator="pbf2osm">
+
+    <!--  __B__
+         /  |  \
+        A___D__C
+         \  |  /
+          \_E_/
+    -->
+
+    <node id="10" lat="11.1" lon="50" uid="24853">
+        <tag k="name" v="A" />
+    </node>
+    <node id="20" lat="12" lon="51" uid="24854">
+        <tag k="name" v="B" />
+    </node>
+    <node id="30" lat="11.2" lon="52" uid="24855">
+        <tag k="name" v="C" />
+    </node>
+    <node id="40" lat="11.3" lon="51" uid="24854">
+        <tag k="name" v="D" />
+    </node>
+    <node id="50" lat="10" lon="51">
+        <tag k="name" v="E" />
+    </node>
+
+    <way id="10" uid="85761">
+        <nd ref="10"/>
+        <nd ref="20"/>
+        <nd ref="30"/>
+        <tag k="name" v="A B C" />
+        <tag k="maxheight" v="4" />
+        <tag k="maxwidth" v="2.5" />
+        <tag k="maxweight" v="4.4" />
+        <tag k="highway" v="secondary" />
+    </way>
+
+    <way id="12" uid="85762">
+        <nd ref="10"/>
+        <nd ref="40"/>
+        <nd ref="30"/>
+        <tag k="name" v="A D C" />
+        <tag k="maxheight:physical" v="4.4" />
+        <tag k="maxwidth:physical" v="3.5" />
+        <tag k="maxgcweight" v="17.5" />
+        <tag k="highway" v="secondary" />
+    </way>
+
+    <way id="11" uid="85761">
+        <nd ref="10"/>
+        <nd ref="50"/>
+        <nd ref="30"/>
+        <tag k="name" v="A E C" />
+        <tag k="highway" v="secondary" />
+    </way>
+
+    <way id="13">
+        <nd ref="20"/>
+        <nd ref="40"/>
+        <nd ref="50"/>
+        <tag k="name" v="B D E" />
+        <tag k="highway" v="secondary" />
+        <tag k="maxspeed" v="40" />
+    </way>
+
+    <!-- TODO relations -->
+</osm>
\ No newline at end of file
diff --git a/reader-overlay-data/src/main/java/com/graphhopper/reader/overlaydata/FeedOverlayData.java b/reader-overlay-data/src/main/java/com/graphhopper/reader/overlaydata/FeedOverlayData.java
deleted file mode 100644
index 3ea9cf8933..0000000000
--- a/reader-overlay-data/src/main/java/com/graphhopper/reader/overlaydata/FeedOverlayData.java
+++ /dev/null
@@ -1,213 +0,0 @@
-/*
- *  Licensed to GraphHopper GmbH under one or more contributor
- *  license agreements. See the NOTICE file distributed with this work for 
- *  additional information regarding copyright ownership.
- * 
- *  GraphHopper GmbH licenses this file to you under the Apache License, 
- *  Version 2.0 (the "License"); you may not use this file except in 
- *  compliance with the License. You may obtain a copy of the License at
- * 
- *       http://www.apache.org/licenses/LICENSE-2.0
- * 
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package com.graphhopper.reader.overlaydata;
-
-import com.graphhopper.json.GHson;
-import com.graphhopper.json.geo.Geometry;
-import com.graphhopper.json.geo.JsonFeature;
-import com.graphhopper.json.geo.JsonFeatureCollection;
-import com.graphhopper.routing.util.DefaultEdgeFilter;
-import com.graphhopper.routing.util.EdgeFilter;
-import com.graphhopper.routing.util.EncodingManager;
-import com.graphhopper.routing.util.FlagEncoder;
-import com.graphhopper.storage.Graph;
-import com.graphhopper.storage.NodeAccess;
-import com.graphhopper.storage.index.LocationIndex;
-import com.graphhopper.storage.index.QueryResult;
-import com.graphhopper.util.BreadthFirstSearch;
-import com.graphhopper.util.EdgeIteratorState;
-import com.graphhopper.util.PointList;
-import com.graphhopper.util.shapes.BBox;
-import com.graphhopper.util.shapes.GHPoint;
-import gnu.trove.iterator.TIntIterator;
-import gnu.trove.set.TIntSet;
-import gnu.trove.set.hash.TIntHashSet;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import java.io.*;
-import java.util.List;
-import java.util.Map;
-
-/**
- * @author Peter Karich
- */
-public class FeedOverlayData {
-    private final Logger logger = LoggerFactory.getLogger(getClass());
-    private final Graph graph;
-    private final LocationIndex locationIndex;
-    private final GHson ghson;
-    private final EncodingManager em;
-    private boolean enableLogging = false;
-
-    public FeedOverlayData(Graph graph, EncodingManager em, LocationIndex locationIndex, GHson ghson) {
-        this.ghson = ghson;
-        this.graph = graph;
-        this.em = em;
-        this.locationIndex = locationIndex;
-    }
-
-    public void setLogging(boolean log) {
-        enableLogging = log;
-    }
-
-    public long applyChanges(String fileOrFolderStr) {
-        File fileOrFolder = new File(fileOrFolderStr);
-        try {
-            if (fileOrFolder.isFile()) {
-                return applyChanges(new FileReader(fileOrFolder));
-            }
-
-            long sum = 0;
-            File[] fList = new File(fileOrFolderStr).listFiles(new FilenameFilter() {
-                @Override
-                public boolean accept(File dir, String name) {
-                    return name.endsWith(".json");
-                }
-            });
-            for (File f : fList) {
-                sum += applyChanges(new FileReader(f));
-            }
-            return sum;
-
-        } catch (FileNotFoundException ex) {
-            throw new RuntimeException(ex);
-        }
-    }
-
-    /**
-     * This method applies changes to the graph, specified by the reader.
-     *
-     * @return number of successfully applied edge changes
-     */
-    public long applyChanges(Reader reader) {
-        // read full file, later support one json feature or collection per line to avoid high mem consumption
-        JsonFeatureCollection data = ghson.fromJson(reader, JsonFeatureCollection.class);
-        long updates = 0;
-        for (JsonFeature jsonFeature : data.getFeatures()) {
-            if (!jsonFeature.hasProperties())
-                throw new IllegalArgumentException("One feature has no properties, please specify properties e.g. speed or access");
-
-            List<String> encodersAsStr = (List) jsonFeature.getProperty("vehicles");
-            if (encodersAsStr == null) {
-                for (FlagEncoder encoder : em.fetchEdgeEncoders()) {
-                    updates += applyChange(jsonFeature, encoder);
-                }
-            } else {
-                for (String encoderStr : encodersAsStr) {
-                    updates += applyChange(jsonFeature, em.getEncoder(encoderStr));
-                }
-            }
-        }
-
-        return updates;
-    }
-
-    private long applyChange(JsonFeature jsonFeature, FlagEncoder encoder) {
-        long updates = 0;
-        EdgeFilter filter = new DefaultEdgeFilter(encoder);
-        TIntSet edges = new TIntHashSet();
-        if (jsonFeature.hasGeometry()) {
-            fillEdgeIDs(edges, jsonFeature.getGeometry(), filter);
-        } else if (jsonFeature.getBBox() != null) {
-            fillEdgeIDs(edges, jsonFeature.getBBox(), filter);
-        } else
-            throw new IllegalArgumentException("Feature " + jsonFeature.getId() + " has no geometry and no bbox");
-
-        TIntIterator iter = edges.iterator();
-        Map<String, Object> props = jsonFeature.getProperties();
-        while (iter.hasNext()) {
-            int edgeId = iter.next();
-            EdgeIteratorState edge = graph.getEdgeIteratorState(edgeId, Integer.MIN_VALUE);
-
-            if (props.containsKey("access")) {
-                boolean value = (boolean) props.get("access");
-                updates++;
-                if (enableLogging)
-                    logger.info(encoder.toString() + " - access change via feature " + jsonFeature.getId());
-                edge.setFlags(encoder.setAccess(edge.getFlags(), value, value));
-
-            } else if (props.containsKey("speed")) {
-                // TODO use different speed for the different directions (see e.g. Bike2WeightFlagEncoder)
-                double value = ((Number) props.get("speed")).doubleValue();
-                double oldSpeed = encoder.getSpeed(edge.getFlags());
-                if (oldSpeed != value) {
-                    updates++;
-                    if (enableLogging)
-                        logger.info(encoder.toString() + " - speed change via feature " + jsonFeature.getId() + ". Old: " + oldSpeed + ", new:" + value);
-                    edge.setFlags(encoder.setSpeed(edge.getFlags(), value));
-                }
-            }
-        }
-        return updates;
-    }
-
-    public void fillEdgeIDs(TIntSet edgeIds, Geometry geometry, EdgeFilter filter) {
-        if (geometry.isPoint()) {
-            GHPoint point = geometry.asPoint();
-            QueryResult qr = locationIndex.findClosest(point.lat, point.lon, filter);
-            if (qr.isValid())
-                edgeIds.add(qr.getClosestEdge().getEdge());
-        } else if (geometry.isPointList()) {
-            PointList pl = geometry.asPointList();
-            if (geometry.getType().equals("LineString")) {
-                // TODO do map matching or routing
-                int lastIdx = pl.size() - 1;
-                if (pl.size() >= 2) {
-                    double meanLat = (pl.getLatitude(0) + pl.getLatitude(lastIdx)) / 2;
-                    double meanLon = (pl.getLongitude(0) + pl.getLongitude(lastIdx)) / 2;
-                    QueryResult qr = locationIndex.findClosest(meanLat, meanLon, filter);
-                    if (qr.isValid())
-                        edgeIds.add(qr.getClosestEdge().getEdge());
-                }
-            } else {
-                for (int i = 0; i < pl.size(); i++) {
-                    QueryResult qr = locationIndex.findClosest(pl.getLatitude(i), pl.getLongitude(i), filter);
-                    if (qr.isValid())
-                        edgeIds.add(qr.getClosestEdge().getEdge());
-                }
-            }
-        }
-    }
-
-    public void fillEdgeIDs(final TIntSet edgeIds, final BBox bbox, EdgeFilter filter) {
-        QueryResult qr = locationIndex.findClosest((bbox.maxLat + bbox.minLat) / 2, (bbox.maxLon + bbox.minLon) / 2, filter);
-        if (!qr.isValid())
-            return;
-
-        BreadthFirstSearch bfs = new BreadthFirstSearch() {
-            final NodeAccess na = graph.getNodeAccess();
-            final BBox localBBox = bbox;
-
-            @Override
-            protected boolean goFurther(int nodeId) {
-                return localBBox.contains(na.getLatitude(nodeId), na.getLongitude(nodeId));
-            }
-
-            @Override
-            protected boolean checkAdjacent(EdgeIteratorState edge) {
-                if (localBBox.contains(na.getLatitude(edge.getAdjNode()), na.getLongitude(edge.getAdjNode()))) {
-                    edgeIds.add(edge.getEdge());
-                    return true;
-                }
-                return false;
-            }
-        };
-        bfs.start(graph.createEdgeExplorer(filter), qr.getClosestNode());
-    }
-}
diff --git a/reader-shp/pom.xml b/reader-shp/pom.xml
new file mode 100644
index 0000000000..988cc164b2
--- /dev/null
+++ b/reader-shp/pom.xml
@@ -0,0 +1,82 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
+    <modelVersion>4.0.0</modelVersion>
+
+    <groupId>com.graphhopper</groupId>
+    <artifactId>graphhopper-reader-shp</artifactId>
+    <version>0.9-SNAPSHOT</version>
+    <packaging>jar</packaging>
+    <name>GraphHopper Reader for Shapefile Data</name>
+	
+    <properties>      
+        <geotools.version>15.2</geotools.version>
+    </properties>
+    	
+    <parent>
+        <groupId>com.graphhopper</groupId>
+        <artifactId>graphhopper-parent</artifactId>    	
+        <version>0.9-SNAPSHOT</version>
+    </parent>
+
+    <dependencies>
+        <dependency>
+            <groupId>com.graphhopper</groupId>
+            <artifactId>graphhopper-core</artifactId>
+            <version>${project.parent.version}</version>
+        </dependency>
+        
+        <dependency>
+            <groupId>org.geotools</groupId>
+            <artifactId>gt-shapefile</artifactId>
+            <version>${geotools.version}</version>
+        </dependency>
+		
+        <dependency>
+            <groupId>org.slf4j</groupId>
+            <artifactId>slf4j-api</artifactId>
+            <version>${slf4j.version}</version>
+        </dependency>   
+        <dependency>
+            <groupId>org.slf4j</groupId>
+            <artifactId>slf4j-log4j12</artifactId>
+            <version>${slf4j.version}</version>
+            <scope>runtime</scope>
+        </dependency>
+        <dependency>
+            <groupId>log4j</groupId>
+            <artifactId>log4j</artifactId>
+            <version>${log4j.version}</version>
+            <scope>runtime</scope>
+        </dependency>
+        
+        <dependency>
+            <!--  Include the pbf reader for test purposes -->
+            <groupId>com.graphhopper</groupId>
+            <artifactId>graphhopper-reader-osm</artifactId>
+            <version>${project.parent.version}</version>
+            <scope>test</scope>
+        </dependency>        
+    </dependencies>
+    <build>
+        <plugins>
+            <plugin>
+                <groupId>org.apache.maven.plugins</groupId>
+                <artifactId>maven-compiler-plugin</artifactId>
+                <version>3.5.1</version>
+                <configuration>
+                    <source>1.8</source>
+                    <target>1.8</target>
+                </configuration>
+            </plugin>
+        </plugins>
+    </build>
+    <repositories>
+        <repository>
+            <id>osgeo</id>
+            <name>Open Source Geospatial Foundation Repository</name>
+            <url>http://download.osgeo.org/webdav/geotools/</url>
+        </repository>
+    </repositories>
+	
+</project>
diff --git a/reader-shp/src/main/java/com/graphhopper/reader/shp/GraphhopperSHP.java b/reader-shp/src/main/java/com/graphhopper/reader/shp/GraphhopperSHP.java
new file mode 100644
index 0000000000..9b00098075
--- /dev/null
+++ b/reader-shp/src/main/java/com/graphhopper/reader/shp/GraphhopperSHP.java
@@ -0,0 +1,48 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.shp;
+
+import java.util.HashSet;
+
+import com.graphhopper.GraphHopper;
+import com.graphhopper.reader.DataReader;
+import com.graphhopper.reader.shp.OSMShapeFileReader.EdgeAddedListener;
+import com.graphhopper.storage.GraphHopperStorage;
+
+/**
+ *
+ * @author Phil
+ *
+ */
+public class GraphhopperSHP extends GraphHopper {
+    private final HashSet<EdgeAddedListener> edgeAddedListeners = new HashSet<>();
+
+    @Override
+    protected DataReader createReader(GraphHopperStorage ghStorage) {
+        OSMShapeFileReader reader = new OSMShapeFileReader(ghStorage);
+        for (EdgeAddedListener l : edgeAddedListeners) {
+            reader.addListener(l);
+        }
+        return initDataReader(reader);
+    }
+
+    public void addListener(EdgeAddedListener l) {
+        edgeAddedListeners.add(l);
+    }
+
+}
diff --git a/reader-shp/src/main/java/com/graphhopper/reader/shp/OSMShapeFileReader.java b/reader-shp/src/main/java/com/graphhopper/reader/shp/OSMShapeFileReader.java
new file mode 100644
index 0000000000..0571f263ae
--- /dev/null
+++ b/reader-shp/src/main/java/com/graphhopper/reader/shp/OSMShapeFileReader.java
@@ -0,0 +1,355 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.shp;
+
+import com.graphhopper.coll.GHObjectIntHashMap;
+import com.graphhopper.reader.DataReader;
+import com.graphhopper.reader.ReaderWay;
+import com.graphhopper.reader.dem.ElevationProvider;
+import com.graphhopper.storage.GraphHopperStorage;
+import com.graphhopper.util.DistanceCalc;
+import com.graphhopper.util.EdgeIteratorState;
+import com.graphhopper.util.Helper;
+import com.graphhopper.util.PointList;
+import com.graphhopper.util.shapes.GHPoint;
+import com.vividsolutions.jts.geom.Coordinate;
+import com.vividsolutions.jts.geom.LineString;
+import com.vividsolutions.jts.geom.MultiLineString;
+import org.geotools.data.DataStore;
+import org.geotools.feature.FeatureIterator;
+import org.opengis.feature.simple.SimpleFeature;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import java.io.File;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.HashSet;
+import java.util.List;
+
+/**
+ * OSMShapeFileReader for files present at : http://download.geofabrik.de/ It
+ * extracts the data as per the structure of shape files
+ *
+ * @author Vikas Veshishth
+ * @author Philip Welch
+ */
+public class OSMShapeFileReader extends ShapeFileReader {
+    private static final int COORD_STATE_UNKNOWN = 0;
+    private static final int COORD_STATE_PILLAR = -2;
+    private static final int FIRST_NODE_ID = 1;
+    private static final String[] DIRECT_COPY_TAGS = new String[]{"name"};
+    private File roadsFile;
+    private final GHObjectIntHashMap<Coordinate> coordState = new GHObjectIntHashMap<>(1000, 0.7f);
+    private final DistanceCalc distCalc = Helper.DIST_EARTH;
+    private static final Logger LOGGER = LoggerFactory.getLogger(OSMShapeFileReader.class);
+    private final HashSet<EdgeAddedListener> edgeAddedListeners = new HashSet<>();
+    private int nextNodeId = FIRST_NODE_ID;
+
+    public OSMShapeFileReader(GraphHopperStorage ghStorage) {
+        super(ghStorage);
+    }
+
+    private List<Coordinate[]> getCoords(Object o) {
+        ArrayList<Coordinate[]> ret = new ArrayList<>();
+        if (o == null) {
+            return ret;
+        }
+
+        if (o instanceof LineString) {
+            ret.add(((LineString) o).getCoordinates());
+        } else if (o instanceof MultiLineString) {
+            MultiLineString mls = (MultiLineString) o;
+            int n = mls.getNumGeometries();
+            for (int i = 0; i < n; i++) {
+                ret.add(mls.getGeometryN(i).getCoordinates());
+            }
+        }
+
+        return ret;
+    }
+
+    @Override
+    void processJunctions() {
+        DataStore dataStore = null;
+        FeatureIterator<SimpleFeature> roads = null;
+
+        try {
+            dataStore = openShapefileDataStore(roadsFile);
+            roads = getFeatureIterator(dataStore);
+
+            HashSet<Coordinate> tmpSet = new HashSet<>();
+            while (roads.hasNext()) {
+                SimpleFeature road = roads.next();
+
+                for (Coordinate[] points : getCoords(road.getDefaultGeometry())) {
+                    tmpSet.clear();
+                    for (int i = 0; i < points.length; i++) {
+                        Coordinate c = points[i];
+
+                        // don't add the same coord twice for the same edge
+                        // - happens with bad geometry, i.e.
+                        // duplicate coords or a road which forms a circle
+                        // (e.g. roundabout)
+                        if (tmpSet.contains(c)) {
+                            continue;
+                        }
+                        tmpSet.add(c);
+
+                        // skip if its already a node
+                        int state = coordState.get(c);
+                        if (state >= FIRST_NODE_ID) {
+                            continue;
+                        }
+
+                        if (i == 0 || i == points.length - 1 || state == COORD_STATE_PILLAR) {
+                            // turn into a node if its the first or last
+                            // point, or already appeared in another edge
+                            int nodeId = nextNodeId++;
+                            coordState.put(c, nodeId);
+                            saveTowerPosition(nodeId, c);
+                        } else if (state == COORD_STATE_UNKNOWN) {
+                            // mark it as a pillar (which may get upgraded
+                            // to an edge later)
+                            coordState.put(c, COORD_STATE_PILLAR);
+                        }
+                    }
+                }
+
+            }
+        } finally {
+            if (roads != null) {
+                roads.close();
+            }
+            if (dataStore != null) {
+                dataStore.dispose();
+            }
+        }
+
+        if (nextNodeId == FIRST_NODE_ID)
+            throw new IllegalArgumentException("No data found for roads file " + roadsFile);
+
+        LOGGER.info("Number of junction points : " + (nextNodeId - FIRST_NODE_ID));
+    }
+
+    @Override
+    void processRoads() {
+
+        DataStore dataStore = null;
+        FeatureIterator<SimpleFeature> roads = null;
+
+        try {
+            dataStore = openShapefileDataStore(roadsFile);
+            roads = getFeatureIterator(dataStore);
+
+            while (roads.hasNext()) {
+                SimpleFeature road = roads.next();
+
+                for (Coordinate[] points : getCoords(road.getDefaultGeometry())) {
+
+                    // Parse all points in the geometry, splitting into
+                    // individual graphhopper edges
+                    // whenever we find a node in the list of points
+                    Coordinate startTowerPnt = null;
+                    List<Coordinate> pillars = new ArrayList<Coordinate>();
+                    for (Coordinate point : points) {
+                        if (startTowerPnt == null) {
+                            startTowerPnt = point;
+                        } else {
+                            int state = coordState.get(point);
+                            if (state >= FIRST_NODE_ID) {
+                                int fromTowerNodeId = coordState.get(startTowerPnt);
+                                int toTowerNodeId = state;
+
+                                // get distance and estimated centres
+                                double distance = getWayLength(startTowerPnt, pillars, point);
+                                GHPoint estmCentre = new GHPoint(
+                                        0.5 * (lat(startTowerPnt) + lat(point)),
+                                        0.5 * (lng(startTowerPnt) + lng(point)));
+                                PointList pillarNodes = new PointList(pillars.size(), false);
+
+                                for (Coordinate pillar : pillars) {
+                                    pillarNodes.add(lat(pillar), lng(pillar));
+                                }
+
+                                addEdge(fromTowerNodeId, toTowerNodeId, road, distance, estmCentre,
+                                        pillarNodes);
+                                startTowerPnt = point;
+                                pillars.clear();
+                            } else {
+                                pillars.add(point);
+                            }
+                        }
+                    }
+                }
+
+            }
+        } finally {
+            if (roads != null) {
+                roads.close();
+            }
+
+            if (dataStore != null) {
+                dataStore.dispose();
+            }
+        }
+    }
+
+    private double getWayLength(Coordinate start, List<Coordinate> pillars, Coordinate end) {
+        double distance = 0;
+
+        Coordinate previous = start;
+        for (Coordinate point : pillars) {
+            distance += distCalc.calcDist(lat(previous), lng(previous), lat(point), lng(point));
+            previous = point;
+        }
+        distance += distCalc.calcDist(lat(previous), lng(previous), lat(end), lng(end));
+
+        return distance;
+    }
+
+    @Override
+    public DataReader setFile(File file) {
+        this.roadsFile = file;
+        return this;
+    }
+
+    @Override
+    public DataReader setElevationProvider(ElevationProvider ep) {
+        // Elevation not supported
+        return this;
+    }
+
+    @Override
+    public DataReader setWorkerThreads(int workerThreads) {
+        // Its only single-threaded
+        return this;
+    }
+
+    @Override
+    public DataReader setWayPointMaxDistance(double wayPointMaxDistance) {
+        // TODO Auto-generated method stub
+        return this;
+    }
+
+    @Override
+    public Date getDataDate() {
+        return null;
+    }
+
+    public static interface EdgeAddedListener {
+        void edgeAdded(ReaderWay way, EdgeIteratorState edge);
+    }
+
+    private void addEdge(int fromTower, int toTower, SimpleFeature road, double distance,
+                         GHPoint estmCentre, PointList pillarNodes) {
+        EdgeIteratorState edge = graph.edge(fromTower, toTower);
+
+        // read the OSM id, should never be null
+        long id = getOSMId(road);
+
+        // Make a temporary ReaderWay object with the properties we need so we
+        // can use the enocding manager
+        // We (hopefully don't need the node structure on here as we're only
+        // calling the flag
+        // encoders, which don't use this...
+        ReaderWay way = new ReaderWay(id);
+
+        way.setTag("estimated_distance", distance);
+        way.setTag("estimated_center", estmCentre);
+
+        // read the highway type
+        Object type = road.getAttribute("fclass");
+        if (type != null) {
+            way.setTag("highway", type.toString());
+        }
+
+        // read maxspeed filtering for 0 which for Geofabrik shapefiles appears
+        // to correspond to no tag
+        Object maxSpeed = road.getAttribute("maxspeed");
+        if (maxSpeed != null && !maxSpeed.toString().trim().equals("0")) {
+            way.setTag("maxspeed", maxSpeed.toString());
+        }
+
+        for (String tag : DIRECT_COPY_TAGS) {
+            Object val = road.getAttribute(tag);
+            if (val != null) {
+                way.setTag(tag, val.toString());
+            }
+        }
+
+        // read oneway
+        Object oneway = road.getAttribute("oneway");
+        if (oneway != null) {
+            // Geofabrik is using an odd convention for oneway field in
+            // shapefile.
+            // We map back to the standard convention so that tag can be dealt
+            // with correctly by the flag encoder.
+            String val = oneway.toString().trim().toLowerCase();
+            if (val.equals("b")) {
+                // both ways
+                val = "no";
+            } else if (val.equals("t")) {
+                // one way against the direction of digitisation
+                val = "-1";
+            } else if (val.equals("f")) {
+                // one way Forward in the direction of digitisation
+                val = "yes";
+            } else {
+                throw new RuntimeException("Unrecognised value of oneway field \"" + val
+                        + "\" found in road with OSM id " + id);
+            }
+
+            way.setTag("oneway", val);
+        }
+
+        // Process the flags using the encoders
+        long includeWay = encodingManager.acceptWay(way);
+        if (includeWay == 0) {
+            return;
+        }
+
+        // TODO we're not using the relation flags
+        long relationFlags = 0;
+
+        long wayFlags = encodingManager.handleWayTags(way, includeWay, relationFlags);
+        if (wayFlags == 0)
+            return;
+
+        edge.setDistance(distance);
+        edge.setFlags(wayFlags);
+        edge.setWayGeometry(pillarNodes);
+
+        if (edgeAddedListeners.size() > 0) {
+            // check size first so we only allocate the iterator if we have
+            // listeners
+            for (EdgeAddedListener l : edgeAddedListeners) {
+                l.edgeAdded(way, edge);
+            }
+        }
+    }
+
+    private long getOSMId(SimpleFeature road) {
+        long id = Long.parseLong(road.getAttribute("osm_id").toString());
+        return id;
+    }
+
+    public void addListener(EdgeAddedListener l) {
+        edgeAddedListeners.add(l);
+    }
+}
diff --git a/reader-shp/src/main/java/com/graphhopper/reader/shp/ShapeFileReader.java b/reader-shp/src/main/java/com/graphhopper/reader/shp/ShapeFileReader.java
new file mode 100644
index 0000000000..c4c92d9dde
--- /dev/null
+++ b/reader-shp/src/main/java/com/graphhopper/reader/shp/ShapeFileReader.java
@@ -0,0 +1,126 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.shp;
+
+import java.io.File;
+import java.util.HashMap;
+import java.util.Map;
+
+import org.geotools.data.DataStore;
+import org.geotools.data.DataStoreFinder;
+import org.geotools.data.FeatureSource;
+import org.geotools.feature.FeatureCollection;
+import org.geotools.feature.FeatureIterator;
+import org.opengis.feature.simple.SimpleFeature;
+import org.opengis.feature.simple.SimpleFeatureType;
+import org.opengis.filter.Filter;
+
+import com.graphhopper.reader.DataReader;
+import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.storage.Graph;
+import com.graphhopper.storage.GraphHopperStorage;
+import com.graphhopper.storage.GraphStorage;
+import com.graphhopper.storage.NodeAccess;
+import com.vividsolutions.jts.geom.Coordinate;
+
+/**
+ * ShapeFileReader takes care of reading a shape file and writing it to a road network graph
+ *
+ * @author Vikas Veshishth
+ * @author Philip Welch
+ */
+public abstract class ShapeFileReader implements DataReader {
+
+    private final GraphStorage graphStorage;
+    private final NodeAccess nodeAccess;
+    protected final Graph graph;
+    protected EncodingManager encodingManager;
+
+    public ShapeFileReader(GraphHopperStorage ghStorage) {
+        this.graphStorage = ghStorage;
+        this.graph = ghStorage;
+        this.nodeAccess = graph.getNodeAccess();
+    }
+
+    @Override
+    public void readGraph() {
+        graphStorage.create(1000);
+        processJunctions();
+        processRoads();
+    }
+
+    abstract void processJunctions();
+
+    abstract void processRoads();
+
+    protected FeatureIterator<SimpleFeature> getFeatureIterator(DataStore dataStore) {
+        if (dataStore == null)
+            throw new IllegalArgumentException("DataStore cannot be null for getFeatureIterator");
+
+        try {
+            String typeName = dataStore.getTypeNames()[0];
+            FeatureSource<SimpleFeatureType, SimpleFeature> source = dataStore.getFeatureSource(typeName);
+            Filter filter = Filter.INCLUDE;
+            FeatureCollection<SimpleFeatureType, SimpleFeature> collection = source.getFeatures(filter);
+
+            FeatureIterator<SimpleFeature> features = collection.features();
+            return features;
+
+        } catch (Exception e) {
+            throw Utils.asUnchecked(e);
+        }
+    }
+
+    protected DataStore openShapefileDataStore(File file) {
+        try {
+            Map<String, Object> map = new HashMap<String, Object>();
+            map.put("url", file.toURI().toURL());
+            DataStore ds = DataStoreFinder.getDataStore(map);
+            if (ds == null)
+                throw new IllegalArgumentException("Cannot find DataStore at " + file);
+            return ds;
+
+        } catch (Exception e) {
+            throw Utils.asUnchecked(e);
+        }
+    }
+
+    /*
+	 * Get longitude using the current long-lat order convention
+     */
+    protected double lng(Coordinate coordinate) {
+        return coordinate.getOrdinate(0);
+    }
+
+    /*
+	 * Get latitude using the current long-lat order convention
+     */
+    protected double lat(Coordinate coordinate) {
+        return coordinate.getOrdinate(1);
+    }
+
+    protected void saveTowerPosition(int nodeId, Coordinate point) {
+        nodeAccess.setNode(nodeId, lat(point), lng(point));
+    }
+
+    @Override
+    public ShapeFileReader setEncodingManager(EncodingManager encodingManager) {
+        this.encodingManager = encodingManager;
+        return this;
+    }
+}
diff --git a/reader-shp/src/main/java/com/graphhopper/reader/shp/Utils.java b/reader-shp/src/main/java/com/graphhopper/reader/shp/Utils.java
new file mode 100644
index 0000000000..e6dd9aa7f0
--- /dev/null
+++ b/reader-shp/src/main/java/com/graphhopper/reader/shp/Utils.java
@@ -0,0 +1,47 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.shp;
+
+import com.graphhopper.util.PointList;
+import com.vividsolutions.jts.geom.Coordinate;
+import com.vividsolutions.jts.geom.GeometryFactory;
+
+/**
+ *
+ * @author Phil
+ *
+ */
+public class Utils {
+    public static String toWKT(PointList list) {
+        int n = list.size();
+        GeometryFactory factory = new GeometryFactory();
+        Coordinate[] coords = new Coordinate[n];
+        for (int i = 0; i < coords.length; i++) {
+            coords[i] = new Coordinate(list.getLon(i), list.getLat(i));
+        }
+        return factory.createLineString(coords).toText();
+    }
+
+    public static RuntimeException asUnchecked(Throwable e) {
+        if (RuntimeException.class.isInstance(e)) {
+            return (RuntimeException) e;
+        }
+        return new RuntimeException(e);
+    }
+
+}
diff --git a/reader-shp/src/test/java/com/graphhopper/reader/shp/ShapeFileReaderTest.java b/reader-shp/src/test/java/com/graphhopper/reader/shp/ShapeFileReaderTest.java
new file mode 100644
index 0000000000..7452a37dd4
--- /dev/null
+++ b/reader-shp/src/test/java/com/graphhopper/reader/shp/ShapeFileReaderTest.java
@@ -0,0 +1,313 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.reader.shp;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+
+import java.io.File;
+import java.net.URISyntaxException;
+import java.net.URL;
+import java.util.DoubleSummaryStatistics;
+import java.util.Random;
+
+import org.junit.AfterClass;
+import org.junit.Before;
+import org.junit.BeforeClass;
+import org.junit.Test;
+
+import com.graphhopper.GHRequest;
+import com.graphhopper.GHResponse;
+import com.graphhopper.GraphHopper;
+import com.graphhopper.PathWrapper;
+import com.graphhopper.reader.osm.GraphHopperOSM;
+import com.graphhopper.routing.util.CarFlagEncoder;
+import com.graphhopper.routing.util.EncodingManager;
+import com.graphhopper.util.DistanceCalc;
+import com.graphhopper.util.Helper;
+import com.graphhopper.util.PointList;
+import com.graphhopper.util.shapes.GHPoint;
+
+/**
+ *
+ * @author Vikas Veshishth
+ * @author Philip Welch
+ */
+public class ShapeFileReaderTest {
+
+    private static final String shapefile = "/data/gis.osm_roads_free_1.shp";
+    private static final String pbf = "/data/malta-latest.osm.pbf";
+    private static final String tempOutputDirFromShp = "target/test-db-shp";
+    private static final String tempOutputDirFromPbf = "target/test-db-pbf";
+    private static GraphHopper hopperShp;
+    private static GraphHopper hopperPbf;
+    private final DistanceCalc distCalc = Helper.DIST_EARTH;
+    private static Exception BEFORE_CLASS_EXCEPTION = null;
+
+    private static class FromToPair {
+        final GHPoint from;
+        final GHPoint to;
+
+        FromToPair(double fromLat, double fromLng, double toLat, double toLng) {
+            this(new GHPoint(fromLat, fromLng), new GHPoint(toLat, toLng));
+        }
+
+        FromToPair(GHPoint from, GHPoint to) {
+            this.from = from;
+            this.to = to;
+        }
+
+        PathWrapper getPath(GraphHopper hopper, boolean assertNoErrors) {
+            GHRequest request = new GHRequest(from, to).setVehicle("car");
+            GHResponse response = hopper.route(request);
+
+            if (assertNoErrors) {
+                assertFalse(response.hasErrors());
+            }
+
+            if (!response.hasErrors()) {
+                return response.getBest();
+            }
+            return null;
+        }
+
+    }
+
+    private static class ExpectedDuration extends FromToPair {
+        final double minSecs;
+        final double maxSecs;
+
+        private ExpectedDuration(double fromLat, double fromLng, double toLat, double toLng,
+                                 double minSecs, double maxSecs) {
+            super(fromLat, fromLng, toLat, toLng);
+            this.minSecs = minSecs;
+            this.maxSecs = maxSecs;
+        }
+    }
+
+    private static GraphHopper initHopper(GraphHopper gh, String inputFile, String outDir) {
+        URL resourceURL = ShapeFileReaderTest.class.getResource(inputFile);
+        try {
+            inputFile = new File(resourceURL.toURI()).getAbsolutePath();
+        } catch (Exception e) {
+            throw new RuntimeException(e);
+        }
+
+        // turn off geometry simplification so geometry should be the same
+        // between pbf and shapefile readers
+        gh.setWayPointMaxDistance(0);
+        return gh.setStoreOnFlush(false).setDataReaderFile(inputFile)
+                .setGraphHopperLocation(new File(outDir).getAbsolutePath())
+                .setEncodingManager(new EncodingManager(new CarFlagEncoder()))
+                .setCHEnabled(false).importOrLoad();
+
+    }
+
+    /**
+     * Build the graphs once only for the various tests
+     */
+    @BeforeClass
+    public static void setupBeforeClass() {
+        try {
+            new File(tempOutputDirFromShp).mkdirs();
+            new File(tempOutputDirFromPbf).mkdirs();
+
+            hopperShp = initHopper(new GraphhopperSHP(), shapefile, tempOutputDirFromShp);
+
+            hopperPbf = initHopper(new GraphHopperOSM(), pbf, tempOutputDirFromPbf);
+
+        } catch (Exception e) {
+            // Junit silently fails if we get an exception in the setup before
+            // class,
+            // so we record it here and explicitly rethrow it
+            BEFORE_CLASS_EXCEPTION = e;
+        }
+
+    }
+
+    @AfterClass
+    public static void teardownAfterClass() {
+        try {
+            hopperShp.close();
+            hopperShp.clean();
+        } catch (Exception e) {
+        }
+
+        try {
+            hopperPbf.close();
+            hopperPbf.clean();
+        } catch (Exception e) {
+        }
+
+    }
+
+    @Before
+    public void beforeTest() throws Exception {
+        // Rethrow the exception from @BeforeClass here so it doesn't silently
+        // fail.
+        // (Junit silently fails on exceptions thrown in @BeforeClass but not
+        // for
+        // exceptions thrown in @Before)
+        if (BEFORE_CLASS_EXCEPTION != null) {
+            throw BEFORE_CLASS_EXCEPTION;
+        }
+    }
+
+    @Test
+    public void testOneWay() {
+        // We setup 2 points very close together on a one-way street.
+        // As its a one way street, the ordering of the start and end requires
+        // going around the block to serve them.
+        // As the scenario is simple, we should get the same results from both
+        // shapefile and pbf.
+        // We should also get route distance to be many times physical distance
+        FromToPair pair = new FromToPair(35.898324, 14.510729, 35.898328, 14.510681);
+        PathWrapper shp = pair.getPath(hopperShp, true);
+        PathWrapper pbf = pair.getPath(hopperPbf, true);
+        double metresShp = shp.getDistance();
+        double metresPbf = pbf.getDistance();
+
+        // should be many times the physical separation between the points (as
+        // we had to go round the block)
+        double straightLineDistMetres = distCalc.calcDist(pair.from.lat, pair.from.lon, pair.to.lat,
+                pair.to.lon);
+        assertTrue(metresShp > straightLineDistMetres * 25);
+
+        // should be the same to within 1 cm
+        assertEquals(metresShp, metresPbf, 0.01);
+
+    }
+
+    @Test
+    public void testGeometrySingleEdgePath() {
+        // We choose a path along a single edge with a couple of minor bends,
+        // which we expect to give identical results...
+        FromToPair pair = new FromToPair(35.911694, 14.492303, 35.911494, 14.490489);
+        PointList shp = pair.getPath(hopperShp, true).getPoints();
+        PointList pbf = pair.getPath(hopperPbf, true).getPoints();
+
+        assertTrue("The chosen edge had a couple of bends!", shp.getSize() >= 2);
+        assertSameGeometry(shp, pbf);
+    }
+
+    private void assertSameGeometry(PointList shp, PointList pbf) {
+        assertEquals(shp.getSize(), pbf.getSize());
+
+        for (int i = 0; i < shp.getSize(); i++) {
+            assertEquals(shp.getLat(i), pbf.getLat(i), 0.0000001);
+            assertEquals(shp.getLon(i), pbf.getLon(i), 0.0000001);
+        }
+    }
+
+    @Test
+    public void testTravelTimesBetweenRandomLocations() {
+        int nTests = 200;
+        final Random random = new Random(123);
+        final GHPoint min = new GHPoint(35.882931, 14.403076);
+        final GHPoint max = new GHPoint(35.913523, 14.448566);
+
+        class RandPointGenerator {
+            double rand(double min, double max) {
+                return min + random.nextDouble() * (max - min);
+            }
+
+            GHPoint randPoint() {
+                return new GHPoint(rand(min.lat, max.lat), rand(min.lon, max.lon));
+            }
+
+        }
+        RandPointGenerator pointGenerator = new RandPointGenerator();
+
+        int nbFails = 0;
+        DoubleSummaryStatistics stats = new DoubleSummaryStatistics();
+        for (int i = 0; i < nTests; i++) {
+            FromToPair pair = new FromToPair(pointGenerator.randPoint(),
+                    pointGenerator.randPoint());
+
+            // paths from random points can fail to don't assert on failure
+            PathWrapper shpPath = pair.getPath(hopperShp, false);
+            PathWrapper pbfPath = pair.getPath(hopperPbf, false);
+
+            // paths between random points can fail to find a route (i.e. be off
+            // the road network)
+            if (shpPath == null || pbfPath == null) {
+                nbFails++;
+                continue;
+            }
+            double shpSecs = getSecondsTravel(shpPath);
+            double pbfSecs = getSecondsTravel(pbfPath);
+
+            double frac = shpSecs / pbfSecs;
+            double percentageDeviation = Math.abs(1.0 - frac) * 100;
+            stats.accept(percentageDeviation);
+        }
+
+        assertTrue("Number of fails should be small for the chosen box", nbFails < nTests / 3);
+
+        // Test mean fraction. There will be some deviation as not all tags are
+        // considered etc,
+        // but we expect it to be small for a large number of tests
+        double mean = stats.getAverage();
+        assertTrue("Should have a mean deviation in travel times of less than 1%", mean < 1.0);
+    }
+
+    @Test
+    public void testTravelTimesBetweenPredefinedLocations() throws URISyntaxException {
+
+        // try a couple of test points, with an expected time range that will
+        // only fail if something is really bad...
+        ExpectedDuration[] expected = new ExpectedDuration[]{
+            new ExpectedDuration(35.899167, 14.515171, 35.894126, 14.502983, 60,
+            60 * 6),
+            new ExpectedDuration(35.899167, 14.515171, 35.877645, 14.398956, 8 * 60,
+            25 * 60),
+            new ExpectedDuration(35.85817, 14.561348, 35.877645, 14.398956, 10 * 60,
+            30 * 60),
+            new ExpectedDuration(35.812802, 14.528732, 35.979673, 14.335785, 20 * 60,
+            50 * 60),};
+
+        // The chosen locations should have small deviations in travel times
+        double tolDiffFromPbf = 0.01;
+
+        for (ExpectedDuration ed : expected) {
+            double secsShp = getSecondsTravel(ed.getPath(hopperShp, true));
+            double secsPbf = getSecondsTravel(ed.getPath(hopperPbf, true));
+            double frac = secsShp / secsPbf;
+
+            String message = "From (" + ed.from + ") to (" + ed.to + ") expected " + ed.minSecs
+                    + " <= travelsecs <= " + ed.maxSecs + ", found " + secsShp
+                    + " secs, pbf was " + secsPbf + " secs, frac diff=" + frac;
+            assertTrue(message, secsShp >= ed.minSecs);
+            assertTrue(message, secsShp <= ed.maxSecs);
+
+            // we also use a tolerance difference with the pbf
+            assertTrue(frac > 1 - tolDiffFromPbf);
+            assertTrue(frac < 1 + tolDiffFromPbf);
+
+        }
+
+    }
+
+    private static double getSecondsTravel(PathWrapper pw) {
+        long millis = pw.getTime();
+        double secs = 0.001 * millis;
+        return secs;
+    }
+
+}
diff --git a/reader-shp/src/test/resources/data/gis.osm_roads_free_1.cpg b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.cpg
new file mode 100644
index 0000000000..7edc66b06a
--- /dev/null
+++ b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.cpg
@@ -0,0 +1 @@
+UTF-8
diff --git a/reader-shp/src/test/resources/data/gis.osm_roads_free_1.dbf b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.dbf
new file mode 100644
index 0000000000..116ff9c648
Binary files /dev/null and b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.dbf differ
diff --git a/reader-shp/src/test/resources/data/gis.osm_roads_free_1.prj b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.prj
new file mode 100644
index 0000000000..8f73f480ff
--- /dev/null
+++ b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.prj
@@ -0,0 +1 @@
+GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]
diff --git a/reader-shp/src/test/resources/data/gis.osm_roads_free_1.shp b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.shp
new file mode 100644
index 0000000000..491be81e73
Binary files /dev/null and b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.shp differ
diff --git a/reader-shp/src/test/resources/data/gis.osm_roads_free_1.shx b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.shx
new file mode 100644
index 0000000000..25718abea1
Binary files /dev/null and b/reader-shp/src/test/resources/data/gis.osm_roads_free_1.shx differ
diff --git a/reader-shp/src/test/resources/data/malta-latest.osm.pbf b/reader-shp/src/test/resources/data/malta-latest.osm.pbf
new file mode 100644
index 0000000000..6b84456772
Binary files /dev/null and b/reader-shp/src/test/resources/data/malta-latest.osm.pbf differ
diff --git a/reader-shp/src/test/resources/log4j.xml b/reader-shp/src/test/resources/log4j.xml
new file mode 100644
index 0000000000..a9bb71c09f
--- /dev/null
+++ b/reader-shp/src/test/resources/log4j.xml
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">
+<log4j:configuration>
+    <appender name="stdout" class="org.apache.log4j.ConsoleAppender">
+        <layout class="org.apache.log4j.PatternLayout">
+            <param name="ConversionPattern" value="%d [%t] %-5p %c - %m%n"/>
+        </layout>
+    </appender>
+    <appender name="ASYNC" class="org.apache.log4j.AsyncAppender">
+        <param name="BufferSize" value="500"/>
+        <appender-ref ref="stdout"/>
+    </appender>    
+    <logger name="com.graphhopper" additivity="false">
+        <level value="warn" />
+        <appender-ref ref="ASYNC" />
+    </logger>
+    <root>
+        <priority value="warn"></priority>
+        <appender-ref ref="ASYNC"/>
+    </root>
+</log4j:configuration>
\ No newline at end of file
diff --git a/tools-lgpl/pom.xml b/tools-lgpl/pom.xml
deleted file mode 100644
index dbe21ddcc3..0000000000
--- a/tools-lgpl/pom.xml
+++ /dev/null
@@ -1,21 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
-    <modelVersion>4.0.0</modelVersion>
-
-    <groupId>com.graphhopper</groupId>
-    <artifactId>graphhopper-tools-lgpl</artifactId>
-    <version>0.8-SNAPSHOT</version>
-    <packaging>jar</packaging>
-    <name>GraphHopper Tools LGPL licensed</name>
-
-    <parent>
-        <groupId>com.graphhopper</groupId>
-        <artifactId>graphhopper-parent</artifactId>    	
-        <version>0.8-SNAPSHOT</version>
-    </parent>
-
-    <dependencies>
-        
-    </dependencies>
-</project>
diff --git a/tools-lgpl/src/main/java/com/graphhopper/coll/OTPIntDoubleBinHeap.java b/tools-lgpl/src/main/java/com/graphhopper/coll/OTPIntDoubleBinHeap.java
deleted file mode 100644
index d977f7dd8b..0000000000
--- a/tools-lgpl/src/main/java/com/graphhopper/coll/OTPIntDoubleBinHeap.java
+++ /dev/null
@@ -1,245 +0,0 @@
-/* This program is free software: you can redistribute it and/or
- modify it under the terms of the GNU Lesser General Public License
- as published by the Free Software Foundation, either version 3 of
- the License, or (at your option) any later version.
-
- This program is distributed in the hope that it will be useful,
- but WITHOUT ANY WARRANTY; without even the implied warranty of
- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- GNU General Public License for more details.
-
- You should have received a copy of the GNU General Public License
- along with this program.  If not, see <http://www.gnu.org/licenses/>. */
-package com.graphhopper.coll;
-
-import java.util.Arrays;
-
-/**
- * Taken from opentripplanner.
- */
-public class OTPIntDoubleBinHeap {
-    private static final double GROW_FACTOR = 2.0;
-    private float[] keys;
-    private int[] elem;
-    private int size;
-    private int capacity;
-
-    public OTPIntDoubleBinHeap() {
-        this(1000);
-    }
-
-    public OTPIntDoubleBinHeap(int capacity) {
-        if (capacity < 10) {
-            capacity = 10;
-        }
-        this.capacity = capacity;
-        size = 0;
-        elem = new int[capacity + 1];
-        // 1-based indexing
-        keys = new float[capacity + 1];
-        // set sentinel
-        keys[0] = Float.NEGATIVE_INFINITY;
-    }
-
-    public int getSize() {
-        return size;
-    }
-
-    public int size() {
-        return size;
-    }
-
-    public boolean isEmpty() {
-        return size == 0;
-    }
-
-    public Double peekKey() {
-        return peek_key();
-    }
-
-    public double peek_key() {
-        if (size > 0) {
-            return keys[1];
-        } else {
-            throw new IllegalStateException("An empty queue does not have a minimum key.");
-        }
-    }
-
-    public Integer peekElement() {
-        return peek_element();
-    }
-
-    public int peek_element() {
-        if (size > 0) {
-            return elem[1];
-        } else {
-            throw new IllegalStateException("An empty queue does not have a minimum value.");
-        }
-    }
-
-    public Integer pollElement() {
-        return poll_element();
-    }
-
-    public int poll_element() {
-        int i, child;
-        int minElem = elem[1];
-        int lastElem = elem[size];
-        double lastPrio = keys[size];
-        if (size <= 0) {
-            throw new IllegalStateException("An empty queue does not have a minimum value.");
-        }
-        size -= 1;
-        for (i = 1; i * 2 <= size; i = child) {
-            child = i * 2;
-            if (child != size && keys[child + 1] < keys[child]) {
-                child++;
-            }
-            if (lastPrio > keys[child]) {
-                elem[i] = elem[child];
-                keys[i] = keys[child];
-            } else {
-                break;
-            }
-        }
-        elem[i] = lastElem;
-        keys[i] = (float) lastPrio;
-        return minElem;
-    }
-
-    public void update(Number key, Integer element) {
-        update_(key.doubleValue(), element);
-    }
-
-    public boolean update_(double key, int element) {
-        // Perform "inefficient" but straightforward linear search 
-        // for an element then change its key by sifting up or down
-        int i;
-        for (i = 1; i <= size; i++) {
-            if (elem[i] == element) {
-                break;
-            }
-        }
-        if (i > size) {
-            return false;
-        }
-
-        if (key > keys[i]) {
-            // sift up (as in extract)
-            while (i * 2 <= size) {
-                int child = i * 2;
-                if (child != size && keys[child + 1] < keys[child]) {
-                    child++;
-                }
-                if (key > keys[child]) {
-                    elem[i] = elem[child];
-                    keys[i] = keys[child];
-                    i = child;
-                } else {
-                    break;
-                }
-            }
-            elem[i] = element;
-            keys[i] = (float) key;
-        } else {
-            // sift down (as in insert_)
-            while (keys[i / 2] > key) {
-                elem[i] = elem[i / 2];
-                keys[i] = keys[i / 2];
-                i /= 2;
-            }
-            elem[i] = element;
-            keys[i] = (float) key;
-        }
-        return true;
-    }
-
-    public void insert(Number key, Integer element) {
-        insert_(key.doubleValue(), element);
-    }
-
-    public void insert_(double key, int element) {
-        int i;
-        size += 1;
-        if (size > capacity) {
-            ensureCapacity((int) (capacity * GROW_FACTOR));
-        }
-        for (i = size; keys[i / 2] > key; i /= 2) {
-            elem[i] = elem[i / 2];
-            keys[i] = keys[i / 2];
-        }
-        elem[i] = element;
-        keys[i] = (float) key;
-    }
-
-    public void ensureCapacity(int capacity) {
-        // System.out.println("Growing queue to " + capacity);
-        if (capacity < size) {
-            throw new IllegalStateException("BinHeap contains too many elements to fit in new capacity.");
-        }
-        this.capacity = capacity;
-        keys = Arrays.copyOf(keys, capacity + 1);
-        elem = Arrays.copyOf(elem, capacity + 1);
-    }
-
-    public int getCapacity() {
-        return capacity;
-    }
-
-    float getKey(int index) {
-        return keys[index];
-    }
-
-    int getElement(int index) {
-        return elem[index];
-    }
-
-    void set(int index, float key, int element) {
-        keys[index] = key;
-        elem[index] = element;
-    }
-
-    void trimTo(int toSize) {
-        this.size = toSize;
-        toSize++;
-        // necessary as we currently do not init arrays when inserting
-        Arrays.fill(keys, toSize, size + 1, 0f);
-        Arrays.fill(elem, toSize, size + 1, 0);
-    }
-
-    public void clear() {
-        trimTo(0);
-    }
-
-    @Override
-    public String toString() {
-        StringBuilder sb = new StringBuilder();
-        for (int i = 1; i <= size; i++) {
-            if (i > 1) {
-                sb.append(", ");
-            }
-            sb.append(keys[i]).append(":").append(elem[i]);
-        }
-        return sb.toString();
-    }
-
-    public String toKeyString() {
-        StringBuilder sb = new StringBuilder();
-        for (int i = 1; i <= size; i++) {
-            if (i > 1) {
-                sb.append(", ");
-            }
-            sb.append(keys[i]);
-        }
-        return sb.toString();
-    }
-
-    public int indexOfValue(int value) {
-        for (int i = 0; i <= size; i++) {
-            if (elem[i] == value) {
-                return i;
-            }
-        }
-        return -1;
-    }
-}
diff --git a/tools/pom.xml b/tools/pom.xml
index e035f529b2..a67272987b 100644
--- a/tools/pom.xml
+++ b/tools/pom.xml
@@ -5,14 +5,14 @@
 
     <groupId>com.graphhopper</groupId>
     <artifactId>graphhopper-tools</artifactId>
-    <version>0.8-SNAPSHOT</version>
+    <version>0.9-SNAPSHOT</version>
     <packaging>jar</packaging>
     <name>GraphHopper Tools</name>
 
     <parent>
         <groupId>com.graphhopper</groupId>
         <artifactId>graphhopper-parent</artifactId>    	
-        <version>0.8-SNAPSHOT</version>
+        <version>0.9-SNAPSHOT</version>
     </parent>
 
     <dependencies>
@@ -21,6 +21,12 @@
             <artifactId>graphhopper-reader-osm</artifactId>
             <version>${project.parent.version}</version>
         </dependency>
+        <dependency>
+            <groupId>org.apache.commons</groupId>
+            <artifactId>commons-compress</artifactId>
+            <version>${commons-compress.version}</version>
+        </dependency>
+        
         <dependency>
             <groupId>org.slf4j</groupId>
             <artifactId>slf4j-api</artifactId>
@@ -38,11 +44,6 @@
             <version>${log4j.version}</version>
             <scope>runtime</scope>
         </dependency>
-        <dependency>
-            <groupId>org.apache.commons</groupId>
-            <artifactId>commons-compress</artifactId>
-            <version>1.10</version>
-        </dependency>
     </dependencies>
     <build>
         <plugins>
diff --git a/tools/src/main/java/com/graphhopper/tools/Measurement.java b/tools/src/main/java/com/graphhopper/tools/Measurement.java
index 9e1b52773f..a800493f9c 100644
--- a/tools/src/main/java/com/graphhopper/tools/Measurement.java
+++ b/tools/src/main/java/com/graphhopper/tools/Measurement.java
@@ -102,9 +102,7 @@ protected DataReader importData() throws IOException {
         hopper.importOrLoad();
 
         GraphHopperStorage g = hopper.getGraphHopperStorage();
-//        if ("true".equals(g.getProperties().get("prepare.done")))
-//            throw new IllegalStateException("Graph has to be unprepared but wasn't!");
-
+        
         String vehicleStr = args.get("graph.flag_encoders", "car");
         FlagEncoder encoder = hopper.getEncodingManager().getEncoder(vehicleStr);
         Weighting weighting = hopper.getCHFactoryDecorator().getWeightings().get(0);
diff --git a/tools/src/main/java/com/graphhopper/tools/QueryTorture.java b/tools/src/main/java/com/graphhopper/tools/QueryTorture.java
index 61facd840f..343a18c813 100644
--- a/tools/src/main/java/com/graphhopper/tools/QueryTorture.java
+++ b/tools/src/main/java/com/graphhopper/tools/QueryTorture.java
@@ -48,11 +48,12 @@
     private AtomicInteger routingErrorCounter;
     private CountDownLatch workerStartedBarrier;
     private CountDownLatch logfileEOFBarrier;
-    private int skippedTooShort;
-    private int readQueries;
-    private int maxQueries;
+    private long skippedTooShort;
+    private long readQueries;
+    private long maxQueries;
     private int timeout;
-    private int statusUpdateCnt;
+    private long statusUpdateCnt;
+    private double tooShortDistance;
     private boolean logRequest = false;
 
     public QueryTorture() {
@@ -66,7 +67,8 @@ public void start(CmdArgs cmdArgs) {
         String logfile = cmdArgs.get("logfile", "");
         int workers = cmdArgs.getInt("workers", 1);
         baseUrl = cmdArgs.get("baseurl", "");
-        maxQueries = cmdArgs.getInt("maxqueries", 1000);
+        tooShortDistance = cmdArgs.getDouble("too_short_distance", 50d);
+        maxQueries = cmdArgs.getLong("maxqueries", 1000L);
         timeout = cmdArgs.getInt("timeout", 3000);
         logRequest = cmdArgs.getBool("log_request", false);
         statusUpdateCnt = maxQueries / 10;
@@ -143,7 +145,7 @@ public Object call() throws Exception {
                 try {
                     logger.info(getName() + " started with " + workers + " workers");
                     service.invokeAll(workerCollection);
-                    logger.info(getName() + " FINISHED");
+                    logger.info(getName() + " FINISHED. Queue: " + queryQueue.size() + ", successfullQueries:" + successfullQueries.get());
                 } catch (RejectedExecutionException ex) {
                     logger.info(getName() + " cannot create threads", ex);
                 } catch (InterruptedException ex) {
@@ -167,8 +169,8 @@ void execute(int workerNo) throws InterruptedException {
             else
                 successfullQueries.incrementAndGet();
 
-            if (successfullQueries.get() % statusUpdateCnt == 0) {
-                logger.info("progress: " + (int) (successfullQueries.get() * 100 / maxQueries) + "%");
+            if (query.realCount % statusUpdateCnt == 0) {
+                logger.info("progress: " + (int) (query.realCount * 100 / maxQueries) + "%");
             }
         } catch (MalformedURLException ex) {
             logger.error("Error while querying", ex);
@@ -200,11 +202,12 @@ public void run() {
                                 continue;
 
                             double dist = distCalc.calcDist(q.start.lat, q.start.lon, q.end.lat, q.end.lon);
-                            if (dist < 100) {
+                            if (dist < tooShortDistance) {
                                 skippedTooShort++;
                                 continue;
                             }
                             readQueries++;
+                            q.realCount = readQueries;
                             if (noDuplicate.size() >= maxQueries)
                                 break;
                             if (noDuplicate.add(q))
@@ -235,6 +238,7 @@ public void run() {
     static class Query {
         GHPoint start;
         GHPoint end;
+        long realCount;
         List<String> points = new ArrayList<String>();
         Map<String, String> params = new HashMap<String, String>();
 
diff --git a/tools/src/main/java/com/graphhopper/ui/DebugAStar.java b/tools/src/main/java/com/graphhopper/ui/DebugAStar.java
index 7f0c86ff8f..367a82b5ce 100644
--- a/tools/src/main/java/com/graphhopper/ui/DebugAStar.java
+++ b/tools/src/main/java/com/graphhopper/ui/DebugAStar.java
@@ -18,7 +18,6 @@
 package com.graphhopper.ui;
 
 import com.graphhopper.routing.AStar;
-import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
@@ -31,11 +30,11 @@
  * @author Peter Karich
  */
 public class DebugAStar extends AStar implements DebugAlgo {
-    private GraphicsWrapper mg;
+    private final GraphicsWrapper mg;
     private Graphics2D g2;
 
-    public DebugAStar(Graph graph, FlagEncoder encoder, Weighting type, TraversalMode tMode, GraphicsWrapper mg) {
-        super(graph, encoder, type, tMode);
+    public DebugAStar(Graph graph, Weighting type, TraversalMode tMode, GraphicsWrapper mg) {
+        super(graph, type, tMode);
         this.mg = mg;
     }
 
diff --git a/tools/src/main/java/com/graphhopper/ui/DebugAStarBi.java b/tools/src/main/java/com/graphhopper/ui/DebugAStarBi.java
index e18a73e704..c273f83fdf 100644
--- a/tools/src/main/java/com/graphhopper/ui/DebugAStarBi.java
+++ b/tools/src/main/java/com/graphhopper/ui/DebugAStarBi.java
@@ -18,7 +18,6 @@
 package com.graphhopper.ui;
 
 import com.graphhopper.routing.AStarBidirection;
-import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
@@ -31,11 +30,11 @@
  * @author Peter Karich
  */
 public class DebugAStarBi extends AStarBidirection implements DebugAlgo {
-    private GraphicsWrapper mg;
+    private final GraphicsWrapper mg;
     private Graphics2D g2;
 
-    public DebugAStarBi(Graph graph, FlagEncoder encoder, Weighting type, TraversalMode tMode, GraphicsWrapper mg) {
-        super(graph, encoder, type, tMode);
+    public DebugAStarBi(Graph graph, Weighting type, TraversalMode tMode, GraphicsWrapper mg) {
+        super(graph, type, tMode);
         this.mg = mg;
     }
 
diff --git a/tools/src/main/java/com/graphhopper/ui/DebugDijkstraBidirection.java b/tools/src/main/java/com/graphhopper/ui/DebugDijkstraBidirection.java
index 7b2310503f..57399b1105 100644
--- a/tools/src/main/java/com/graphhopper/ui/DebugDijkstraBidirection.java
+++ b/tools/src/main/java/com/graphhopper/ui/DebugDijkstraBidirection.java
@@ -18,7 +18,6 @@
 package com.graphhopper.ui;
 
 import com.graphhopper.routing.DijkstraBidirectionRef;
-import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
@@ -31,11 +30,11 @@
  * @author Peter Karich
  */
 public class DebugDijkstraBidirection extends DijkstraBidirectionRef implements DebugAlgo {
-    private GraphicsWrapper mg;
+    private final GraphicsWrapper mg;
     private Graphics2D g2;
 
-    public DebugDijkstraBidirection(Graph graph, FlagEncoder encoder, Weighting type, TraversalMode tMode, GraphicsWrapper mg) {
-        super(graph, encoder, type, tMode);
+    public DebugDijkstraBidirection(Graph graph, Weighting type, TraversalMode tMode, GraphicsWrapper mg) {
+        super(graph, type, tMode);
         this.mg = mg;
     }
 
diff --git a/tools/src/main/java/com/graphhopper/ui/DebugDijkstraSimple.java b/tools/src/main/java/com/graphhopper/ui/DebugDijkstraSimple.java
index d9f4f8c8b9..5159811a16 100644
--- a/tools/src/main/java/com/graphhopper/ui/DebugDijkstraSimple.java
+++ b/tools/src/main/java/com/graphhopper/ui/DebugDijkstraSimple.java
@@ -18,7 +18,6 @@
 package com.graphhopper.ui;
 
 import com.graphhopper.routing.Dijkstra;
-import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.TraversalMode;
 import com.graphhopper.routing.weighting.Weighting;
 import com.graphhopper.storage.Graph;
@@ -31,11 +30,11 @@
  * @author Peter Karich
  */
 public class DebugDijkstraSimple extends Dijkstra implements DebugAlgo {
-    private GraphicsWrapper mg;
+    private final GraphicsWrapper mg;
     private Graphics2D g2;
 
-    public DebugDijkstraSimple(Graph graph, FlagEncoder encoder, Weighting weighting, TraversalMode tMode, GraphicsWrapper mg) {
-        super(graph, encoder, weighting, tMode);
+    public DebugDijkstraSimple(Graph graph, Weighting weighting, TraversalMode tMode, GraphicsWrapper mg) {
+        super(graph, weighting, tMode);
         this.mg = mg;
     }
 
diff --git a/tools/src/main/java/com/graphhopper/ui/GraphicsWrapper.java b/tools/src/main/java/com/graphhopper/ui/GraphicsWrapper.java
index ad2a1b7f45..cc7815bb71 100644
--- a/tools/src/main/java/com/graphhopper/ui/GraphicsWrapper.java
+++ b/tools/src/main/java/com/graphhopper/ui/GraphicsWrapper.java
@@ -24,6 +24,8 @@
 import org.slf4j.LoggerFactory;
 
 import java.awt.*;
+import java.awt.geom.AffineTransform;
+import java.awt.geom.Path2D;
 
 /**
  * @author Peter Karich
@@ -65,6 +67,33 @@ public void plotText(Graphics2D g2, double lat, double lon, String text) {
         g2.drawString(text, (int) getX(lon) + 5, (int) getY(lat) + 5);
     }
 
+    public void plotDirectedEdge(Graphics2D g2, double lat, double lon, double lat2, double lon2, float width) {
+
+        g2.setStroke(new BasicStroke(width));
+        int startLon = (int) getX(lon);
+        int startLat = (int) getY(lat);
+        int destLon = (int) getX(lon2);
+        int destLat = (int) getY(lat2);
+
+        g2.drawLine(startLon, startLat, destLon, destLat);
+
+        // only for deep zoom show direction
+        if (scaleX < 0.0001) {
+            g2.setStroke(new BasicStroke(3));
+            Path2D.Float path = new Path2D.Float();
+            path.moveTo(destLon, destLat);
+            path.lineTo(destLon + 6, destLat - 2);
+            path.lineTo(destLon + 6, destLat + 2);
+            path.lineTo(destLon, destLat);
+
+            AffineTransform at = new AffineTransform();
+            double angle = Math.atan2(lat2 - lat, lon2 - lon);
+            at.rotate(-angle + Math.PI, destLon, destLat);
+            path.transform(at);
+            g2.draw(path);
+        }
+    }
+
     public void plotEdge(Graphics2D g2, double lat, double lon, double lat2, double lon2, float width) {
         g2.setStroke(new BasicStroke(width));
         g2.drawLine((int) getX(lon), (int) getY(lat), (int) getX(lon2), (int) getY(lat2));
diff --git a/tools/src/main/java/com/graphhopper/ui/MiniGraphUI.java b/tools/src/main/java/com/graphhopper/ui/MiniGraphUI.java
index 187d92f3c4..c486015229 100644
--- a/tools/src/main/java/com/graphhopper/ui/MiniGraphUI.java
+++ b/tools/src/main/java/com/graphhopper/ui/MiniGraphUI.java
@@ -17,10 +17,13 @@
  */
 package com.graphhopper.ui;
 
+import com.carrotsearch.hppc.IntIndexedContainer;
 import com.graphhopper.GraphHopper;
 import com.graphhopper.coll.GHBitSet;
 import com.graphhopper.coll.GHTBitSet;
+import com.graphhopper.reader.osm.GraphHopperOSM;
 import com.graphhopper.routing.*;
+import com.graphhopper.routing.util.AllEdgesIterator;
 import com.graphhopper.routing.util.EdgeFilter;
 import com.graphhopper.routing.util.FlagEncoder;
 import com.graphhopper.routing.util.HintsMap;
@@ -29,10 +32,12 @@
 import com.graphhopper.storage.NodeAccess;
 import com.graphhopper.storage.index.LocationIndexTree;
 import com.graphhopper.storage.index.QueryResult;
-import com.graphhopper.util.*;
+import com.graphhopper.util.CmdArgs;
+import com.graphhopper.util.Parameters;
 import com.graphhopper.util.Parameters.Algorithms;
+import com.graphhopper.util.PointList;
+import com.graphhopper.util.StopWatch;
 import com.graphhopper.util.shapes.BBox;
-import gnu.trove.list.TIntList;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -46,7 +51,7 @@
 
 /**
  * A rough graphical user interface for visualizing the OSM graph. Mainly for debugging algorithms
- * and spatial datastructures. See e.g. this blog post:
+ * and spatial data structures. See e.g. this blog post:
  * https://graphhopper.com/blog/2016/01/19/alternative-roads-to-rome/
  * <p>
  * Use the web module for a better/faster/userfriendly/... alternative!
@@ -82,9 +87,15 @@ public MiniGraphUI(GraphHopper hopper, boolean debug) {
         this.na = graph.getNodeAccess();
         encoder = hopper.getEncodingManager().getEncoder("car");
         HintsMap map = new HintsMap("fastest");
-        weighting = hopper.createWeighting(map, encoder);
+        map.put(Parameters.CH.DISABLE, true);
+        // for CH we need:
+        // map.setVehicle("car");
+        // weighting = hopper.getCHFactoryDecorator().getWeightings().get(0);
+        // routingGraph = hopper.getGraphHopperStorage().getGraph(CHGraph.class, weighting);
+
+        weighting = hopper.createWeighting(map, encoder, this.graph);
         algoFactory = hopper.getAlgorithmFactory(map);
-        algoOpts = new AlgorithmOptions(Algorithms.DIJKSTRA_BI, encoder, weighting);
+        algoOpts = new AlgorithmOptions(Algorithms.DIJKSTRA_BI, weighting);
 
         logger.info("locations:" + graph.getNodes() + ", debug:" + debug + ", algoOpts:" + algoOpts);
         mg = new GraphicsWrapper(graph);
@@ -146,57 +157,62 @@ public void paintComponent(Graphics2D g2) {
 //                plotPath(path, g2, 1);
                 g2.setColor(Color.black);
 
-                EdgeExplorer explorer = graph.createEdgeExplorer(EdgeFilter.ALL_EDGES);
                 Color[] speedColors = generateColors(15);
-
-                for (int nodeIndex = 0; nodeIndex < locs; nodeIndex++) {
+                AllEdgesIterator edge = graph.getAllEdges();
+                while (edge.next()) {
                     if (fastPaint && rand.nextInt(30) > 1)
                         continue;
+
+                    int nodeIndex = edge.getBaseNode();
                     double lat = na.getLatitude(nodeIndex);
                     double lon = na.getLongitude(nodeIndex);
+                    int nodeId = edge.getAdjNode();
+                    double lat2 = na.getLatitude(nodeId);
+                    double lon2 = na.getLongitude(nodeId);
 
                     // mg.plotText(g2, lat, lon, "" + nodeIndex);
-                    if (lat < b.minLat || lat > b.maxLat || lon < b.minLon || lon > b.maxLon)
+                    if (!b.contains(lat, lon) && !b.contains(lat2, lon2))
                         continue;
 
-                    EdgeIterator edge = explorer.setBaseNode(nodeIndex);
-                    while (edge.next()) {
-                        int nodeId = edge.getAdjNode();
-                        int sum = nodeIndex + nodeId;
-                        if (fastPaint) {
-                            if (bitset.contains(sum))
-                                continue;
+                    int sum = nodeIndex + nodeId;
+                    if (fastPaint) {
+                        if (bitset.contains(sum))
+                            continue;
 
-                            bitset.add(sum);
-                        }
-                        double lat2 = na.getLatitude(nodeId);
-                        double lon2 = na.getLongitude(nodeId);
-
-                        // mg.plotText(g2, lat * 0.9 + lat2 * 0.1, lon * 0.9 + lon2 * 0.1, iter.getName());
-                        //mg.plotText(g2, lat * 0.9 + lat2 * 0.1, lon * 0.9 + lon2 * 0.1, "s:" + (int) encoder.getSpeed(iter.getFlags()));
-                        double speed = encoder.getSpeed(edge.getFlags());
-                        Color color;
-                        if (speed >= 120) {
-                            // red
-                            color = speedColors[12];
-                        } else if (speed >= 100) {
-                            color = speedColors[10];
-                        } else if (speed >= 80) {
-                            color = speedColors[8];
-                        } else if (speed >= 60) {
-                            color = speedColors[6];
-                        } else if (speed >= 50) {
-                            color = speedColors[5];
-                        } else if (speed >= 40) {
-                            color = speedColors[4];
-                        } else if (speed >= 30) {
-                            color = Color.GRAY;
-                        } else {
-                            color = Color.LIGHT_GRAY;
-                        }
+                        bitset.add(sum);
+                    }
+
+                    // mg.plotText(g2, lat * 0.9 + lat2 * 0.1, lon * 0.9 + lon2 * 0.1, iter.getName());
+                    //mg.plotText(g2, lat * 0.9 + lat2 * 0.1, lon * 0.9 + lon2 * 0.1, "s:" + (int) encoder.getSpeed(iter.getFlags()));
+                    double speed = encoder.getSpeed(edge.getFlags());
+                    Color color;
+                    if (speed >= 120) {
+                        // red
+                        color = speedColors[12];
+                    } else if (speed >= 100) {
+                        color = speedColors[10];
+                    } else if (speed >= 80) {
+                        color = speedColors[8];
+                    } else if (speed >= 60) {
+                        color = speedColors[6];
+                    } else if (speed >= 50) {
+                        color = speedColors[5];
+                    } else if (speed >= 40) {
+                        color = speedColors[4];
+                    } else if (speed >= 30) {
+                        color = Color.GRAY;
+                    } else {
+                        color = Color.LIGHT_GRAY;
+                    }
 
-                        g2.setColor(color);
-                        mg.plotEdge(g2, lat, lon, lat2, lon2, 1.2f);
+                    g2.setColor(color);
+                    boolean fwd = encoder.isForward(edge.getFlags());
+                    boolean bwd = encoder.isBackward(edge.getFlags());
+                    float width = 1.2f;
+                    if (fwd && !bwd) {
+                        mg.plotDirectedEdge(g2, lat, lon, lat2, lon2, width);
+                    } else {
+                        mg.plotEdge(g2, lat, lon, lat2, lon2, width);
                     }
                 }
 
@@ -213,7 +229,7 @@ public void paintComponent(Graphics2D g2) {
 
         mainPanel.addLayer(pathLayer = new DefaultMapLayer() {
             @Override
-            public void paintComponent(Graphics2D g2) {
+            public void paintComponent(final Graphics2D g2) {
                 if (fromRes == null || toRes == null)
                     return;
 
@@ -251,7 +267,7 @@ public void paintComponent(Graphics2D g2) {
                 }
 
                 logger.info("found path in " + sw.getSeconds() + "s with nodes:"
-                        + path.calcNodes().size() + ", millis: " + path.getTime() + ", " + path);
+                        + path.calcNodes().size() + ", millis: " + path.getTime());// + ", " + path);
                 g2.setColor(Color.BLUE.brighter().brighter());
                 plotPath(path, g2, 1);
             }
@@ -267,7 +283,7 @@ public void paintComponent(Graphics2D g2) {
 
     public static void main(String[] strs) throws Exception {
         CmdArgs args = CmdArgs.read(strs);
-        GraphHopper hopper = new GraphHopper().init(args).importOrLoad();
+        GraphHopper hopper = new GraphHopperOSM().init(args).importOrLoad();
         boolean debug = args.getBool("minigraphui.debug", false);
         new MiniGraphUI(hopper, debug).visualize();
     }
@@ -308,7 +324,7 @@ private Path plotPath(Path tmpPath, Graphics2D g2, int w) {
         double prevLat = Double.NaN;
         double prevLon = Double.NaN;
         boolean plotNodes = false;
-        TIntList nodes = tmpPath.calcNodes();
+        IntIndexedContainer nodes = tmpPath.calcNodes();
         if (plotNodes) {
             for (int i = 0; i < nodes.size(); i++) {
                 plotNodeName(g2, nodes.get(i));
diff --git a/web/package.json b/web/package.json
index e9447c3d22..bcb1faf34b 100644
--- a/web/package.json
+++ b/web/package.json
@@ -22,17 +22,18 @@
     }
   },
   "dependencies": {
-    "browserify": "13.1.0",
+    "browserify": "14.0.0",
     "browserify-swap": "0.2.2",
     "d3": "3.5.17",
-    "jquery": "3.1.0",
-    "leaflet": "0.7.7",
-    "leaflet-loading": "0.1.22",
-    "uglifyify": "3.0.2"
+    "jquery": "3.1.1",
+    "leaflet": "1.0.3",
+    "leaflet-contextmenu": "1.2.1",
+    "leaflet-loading": "0.1.24",
+    "uglifyify": "3.0.4"
   },
   "devDependencies": {
-    "jasmine": "2.4.1",
-    "jshint": "2.9.2",
-    "watchify": "3.7.0"
+    "jasmine": "2.5.3",
+    "jshint": "2.9.4",
+    "watchify": "3.9.0"
   }
 }
diff --git a/web/pom.xml b/web/pom.xml
index fea85a31a0..5ca45fbe63 100644
--- a/web/pom.xml
+++ b/web/pom.xml
@@ -6,38 +6,43 @@
     <groupId>com.graphhopper</groupId>
     <artifactId>graphhopper-web</artifactId>
     <packaging>jar</packaging>
-    <version>0.8-SNAPSHOT</version>
+    <version>0.9-SNAPSHOT</version>
     <name>GraphHopper Web</name>
     <description>Example on how to use GraphHopper in a web-based application</description>
-        
+
     <parent>
         <groupId>com.graphhopper</groupId>
-        <artifactId>graphhopper-parent</artifactId>    	
-        <version>0.8-SNAPSHOT</version>
+        <artifactId>graphhopper-parent</artifactId>
+        <version>0.9-SNAPSHOT</version>
     </parent>
     <properties>
         <jetty.version>9.3.8.v20160314</jetty.version>
     </properties>
-    
+
     <dependencies>
         <dependency>
             <groupId>com.graphhopper</groupId>
             <artifactId>graphhopper-reader-osm</artifactId>
-            <version>${project.parent.version}</version>            
+            <version>${project.parent.version}</version>
+        </dependency>
+        <dependency>
+            <groupId>com.graphhopper</groupId>
+            <artifactId>graphhopper-reader-json</artifactId>
+            <version>${project.parent.version}</version>
         </dependency>
         
         <dependency>
             <groupId>org.json</groupId>
-            <artifactId>json</artifactId>            
+            <artifactId>json</artifactId>
             <version>${json.org.version}</version>
-        </dependency>    
-        
+        </dependency>
+
         <dependency>
             <groupId>com.google.inject</groupId>
             <artifactId>guice</artifactId>
             <version>4.0</version>
         </dependency>
-        
+
         <!-- necessary to use guice ('@Inject') in servlets -->
         <dependency>
             <groupId>com.google.inject.extensions</groupId>
@@ -56,7 +61,7 @@
             <version>${slf4j.version}</version>
             <scope>runtime</scope>
         </dependency>
-        
+
         <dependency>
             <groupId>log4j</groupId>
             <artifactId>log4j</artifactId>
@@ -69,7 +74,7 @@
             <artifactId>jetty-servlets</artifactId>
             <version>${jetty.version}</version>
         </dependency>
-        
+
         <dependency>
             <groupId>org.eclipse.jetty</groupId>
             <artifactId>jetty-server</artifactId>
@@ -80,7 +85,7 @@
             <artifactId>jetty-servlet</artifactId>
             <version>${jetty.version}</version>
         </dependency>
-        
+
         <!-- for integration tests of service -->
         <dependency>
             <groupId>org.eclipse.jetty</groupId>
@@ -88,14 +93,22 @@
             <version>${jetty.version}</version>
             <scope>test</scope>
         </dependency>
-      
+        <!-- for integration tests of service --> 
+        <dependency>
+            <groupId>com.squareup.okhttp3</groupId>
+            <artifactId>okhttp</artifactId>
+            <version>3.4.2</version>
+            <scope>test</scope>
+        </dependency>
+        
     </dependencies>
 
     <build>
         <plugins>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-compiler-plugin</artifactId>                
+                <artifactId>maven-compiler-plugin</artifactId>
+                <version>3.5.1</version>
                 <configuration>
                     <source>1.8</source>
                     <target>1.8</target>
@@ -104,14 +117,25 @@
             <!-- create a jar file too, so others can use it more easily -->
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
-                <artifactId>maven-war-plugin</artifactId>                
+                <artifactId>maven-war-plugin</artifactId>
+                <version>3.0.0</version>
                 <configuration>
                     <attachClasses>true</attachClasses>
                 </configuration>
-            </plugin>            
+            </plugin>
             <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-assembly-plugin</artifactId>
+                <!-- this is an old version but 2.6 fails with java 9
+                see: https://stackoverflow.com/questions/36583118/is-maven-ready-for-jdk9-->
+                <version>2.4.1</version>
+                <dependencies>
+                    <dependency>
+                        <groupId>org.codehaus.plexus</groupId>
+                        <artifactId>plexus-archiver</artifactId>
+                        <version>2.4.4</version>
+                    </dependency>
+                </dependencies>
                 <configuration>
                     <archive>
                         <manifest>
@@ -128,14 +152,14 @@
                     <execution>
                         <id>make-assembly</id>
                         <!-- bind to verify and not package to pass integration tests before creating assemblies -->
-                        <phase>integration-test</phase> 
+                        <phase>integration-test</phase>
                         <goals>
                             <goal>single</goal>
                         </goals>
                     </execution>
                 </executions>
             </plugin>
- 
+
         </plugins>
     </build>
 
diff --git a/web/src/main/java/com/graphhopper/http/ChangeGraphServlet.java b/web/src/main/java/com/graphhopper/http/ChangeGraphServlet.java
new file mode 100644
index 0000000000..7b87b4fe7c
--- /dev/null
+++ b/web/src/main/java/com/graphhopper/http/ChangeGraphServlet.java
@@ -0,0 +1,80 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.http;
+
+import com.graphhopper.GraphHopper;
+import com.graphhopper.json.geo.JsonFeatureCollection;
+import com.graphhopper.storage.change.ChangeGraphResponse;
+import com.graphhopper.util.Helper;
+import com.graphhopper.util.StopWatch;
+import java.io.IOException;
+import java.io.InputStreamReader;
+import javax.inject.Inject;
+import javax.servlet.ServletException;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+import org.json.JSONObject;
+import com.graphhopper.json.GHJson;
+
+/**
+ * This class defines a new endpoint to submit access and speed changes to the graph.
+ *
+ * @author Peter Karich
+ */
+public class ChangeGraphServlet extends GHBaseServlet {
+
+    @Inject
+    private GraphHopper hopper;
+    @Inject
+    private GHJson gson;
+
+    @Override
+    protected void doPost(HttpServletRequest httpReq, HttpServletResponse httpRes) throws ServletException, IOException {
+        String infoStr = httpReq.getRemoteAddr() + " " + httpReq.getPathInfo() + " " + httpReq.getQueryString();
+        float took = -1;
+        StopWatch sw = new StopWatch().start();
+        try {
+            JsonFeatureCollection collection = gson.fromJson(new InputStreamReader(httpReq.getInputStream(), Helper.UTF_CS), JsonFeatureCollection.class);
+            // TODO make asynchronous!
+            ChangeGraphResponse rsp = hopper.changeGraph(collection.getFeatures());
+            JSONObject resObject = new JSONObject();
+            resObject.put("updates", rsp.getUpdateCount());
+            // prepare the consumer to get some changes not immediately when returning after POST
+            resObject.put("scheduled_updates", 0);
+
+            httpRes.setHeader("X-GH-Took", "" + Math.round(took * 1000));
+            writeJson(httpReq, httpRes, resObject);
+
+            took = sw.stop().getSeconds();
+            logger.info(infoStr + " " + took);
+        } catch (IllegalArgumentException ex) {
+            took = sw.stop().getSeconds();
+            logger.warn(infoStr + " " + took + ", " + ex.getMessage());
+            writeError(httpRes, 400, "Wrong arguments for endpoint /change, " + infoStr);
+        } catch (Exception ex) {
+            took = sw.stop().getSeconds();
+            logger.error(infoStr + " " + took, ex);
+            writeError(httpRes, 500, "Error at endpoint /change, " + infoStr);
+        }
+    }
+
+    @Override
+    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
+        throw new IllegalArgumentException("GET not allowed");
+    }
+}
diff --git a/web/src/main/java/com/graphhopper/http/DefaultModule.java b/web/src/main/java/com/graphhopper/http/DefaultModule.java
index 6d901eed9b..7b91b291ed 100644
--- a/web/src/main/java/com/graphhopper/http/DefaultModule.java
+++ b/web/src/main/java/com/graphhopper/http/DefaultModule.java
@@ -20,11 +20,13 @@
 import com.google.inject.AbstractModule;
 import com.google.inject.name.Names;
 import com.graphhopper.GraphHopper;
+import com.graphhopper.json.GHJsonBuilder;
 import com.graphhopper.reader.osm.GraphHopperOSM;
 import com.graphhopper.util.CmdArgs;
 import com.graphhopper.util.TranslationMap;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
+import com.graphhopper.json.GHJson;
 
 /**
  * @author Peter Karich
@@ -68,12 +70,13 @@ protected void configure() {
             long timeout = args.getLong("web.timeout", 3000);
             bind(Long.class).annotatedWith(Names.named("timeout")).toInstance(timeout);
             boolean jsonpAllowed = args.getBool("web.jsonp_allowed", false);
-            if (!jsonpAllowed)
-                logger.info("jsonp disabled");
 
             bind(Boolean.class).annotatedWith(Names.named("jsonp_allowed")).toInstance(jsonpAllowed);
 
             bind(RouteSerializer.class).toInstance(new SimpleRouteSerializer(graphHopper.getGraphHopperStorage().getBounds()));
+
+            // should be thread safe
+            bind(GHJson.class).toInstance(new GHJsonBuilder().create());
         } catch (Exception ex) {
             throw new IllegalStateException("Couldn't load graph", ex);
         }
diff --git a/web/src/main/java/com/graphhopper/http/GHBaseServlet.java b/web/src/main/java/com/graphhopper/http/GHBaseServlet.java
index 53b4fce9e7..314ebb032b 100644
--- a/web/src/main/java/com/graphhopper/http/GHBaseServlet.java
+++ b/web/src/main/java/com/graphhopper/http/GHBaseServlet.java
@@ -17,6 +17,8 @@
  */
 package com.graphhopper.http;
 
+import com.graphhopper.GHRequest;
+import com.graphhopper.routing.util.HintsMap;
 import org.json.JSONException;
 import org.json.JSONObject;
 import org.slf4j.Logger;
@@ -31,6 +33,7 @@
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.List;
+import java.util.Map;
 
 import static javax.servlet.http.HttpServletResponse.SC_BAD_REQUEST;
 import static javax.servlet.http.HttpServletResponse.SC_OK;
@@ -64,14 +67,14 @@ protected void writeJson(HttpServletRequest req, HttpServletResponse res, JSONOb
             if (debug)
                 writeResponse(res, callbackName + "(" + json.toString(2) + ")");
             else
-                writeResponse(res, callbackName + "(" + json.toString() + ")");
+                writeResponse(res, callbackName + "(" + json.toString(0) + ")");
 
         } else {
             res.setContentType("application/json");
             if (debug)
                 writeResponse(res, json.toString(2));
             else
-                writeResponse(res, json.toString());
+                writeResponse(res, json.toString(0));
         }
     }
 
@@ -90,7 +93,7 @@ protected void writeJsonError(HttpServletResponse res, int code, JSONObject json
             res.setStatus(code);
             res.getWriter().append(json.toString(2));
         } catch (IOException ex) {
-            logger.error("Cannot write error " + ex.getMessage());
+            throw new RuntimeException("Cannot write JSON Error " + code, ex);
         }
     }
 
@@ -162,4 +165,11 @@ public void writeResponse(HttpServletResponse res, String str) {
             logger.error("Cannot write message:" + str, ex);
         }
     }
+
+    protected void initHints(HintsMap m, Map<String, String[]> parameterMap) {
+        for (Map.Entry<String, String[]> e : parameterMap.entrySet()) {
+            if (e.getValue().length == 1)
+                m.put(e.getKey(), e.getValue()[0]);
+        }
+    }
 }
diff --git a/web/src/main/java/com/graphhopper/http/GHErrorHandler.java b/web/src/main/java/com/graphhopper/http/GHErrorHandler.java
index 2b812eaa41..742923b5fc 100644
--- a/web/src/main/java/com/graphhopper/http/GHErrorHandler.java
+++ b/web/src/main/java/com/graphhopper/http/GHErrorHandler.java
@@ -26,8 +26,6 @@
 import javax.servlet.http.HttpServletResponse;
 import java.io.IOException;
 
-import static javax.servlet.http.HttpServletResponse.SC_INTERNAL_SERVER_ERROR;
-
 /**
  * @author Peter Karich
  */
@@ -38,19 +36,25 @@
     @Override
     public void handle(String str, Request req, HttpServletRequest httpReq, HttpServletResponse httpRes) throws IOException {
         Throwable throwable = (Throwable) httpReq.getAttribute("javax.servlet.error.exception");
+        String url = httpReq.getRequestURI();
+        if (httpReq.getQueryString() != null)
+            url += "?" + httpReq.getQueryString();
+
         if (throwable != null) {
             String message = throwable.getMessage();
-            logger.error(message + ", via:" + httpReq.getRequestURL(), throwable);
+            logger.error(message + "! Via:" + url, throwable);
         } else {
             String message = (String) httpReq.getAttribute("javax.servlet.error.message");
-            if (message != null) {
-                logger.error("Internal error " + message + "! Via:" + httpReq.getRequestURL());
+            if (httpRes.getStatus() / 100 == 4) {
+                logger.warn(message + ", via:" + url);
+            } else if (message != null) {
+                logger.error("Internal error " + message + "! Via:" + url);
             } else {
-                logger.error("Internal error " + str + ", throwable not known! Via:" + httpReq.getRequestURL());
+                logger.error("Internal error " + str + ", throwable unknown! Via:" + url);
             }
         }
 
         // you can't call sendError( 500, "Server Error" ) without triggering Jetty's DefaultErrorHandler
-        httpRes.setStatus(SC_INTERNAL_SERVER_ERROR);
+        httpRes.setStatus(httpRes.getStatus());
     }
 }
diff --git a/web/src/main/java/com/graphhopper/http/GHServer.java b/web/src/main/java/com/graphhopper/http/GHServer.java
index f8f526e225..f5e552f77a 100644
--- a/web/src/main/java/com/graphhopper/http/GHServer.java
+++ b/web/src/main/java/com/graphhopper/http/GHServer.java
@@ -66,7 +66,7 @@ public void start(Injector injector) throws Exception {
         resHandler.setWelcomeFiles(new String[]{
             "index.html"
         });
-        resHandler.setResourceBase(args.get("jetty.resourcebase", "./src/main/webapp"));
+        resHandler.setResourceBase(args.get("jetty.resourcebase", "./web/src/main/webapp"));
 
         server = new Server();
         // getSessionHandler and getSecurityHandler should always return null
diff --git a/web/src/main/java/com/graphhopper/http/GHServletModule.java b/web/src/main/java/com/graphhopper/http/GHServletModule.java
index 947d3a2115..bf71bd9e83 100644
--- a/web/src/main/java/com/graphhopper/http/GHServletModule.java
+++ b/web/src/main/java/com/graphhopper/http/GHServletModule.java
@@ -47,6 +47,9 @@ public GHServletModule(CmdArgs args) {
 
     @Override
     protected void configureServlets() {
+        filter("*").through(HeadFilter.class);
+        bind(HeadFilter.class).in(Singleton.class);
+
         filter("*").through(CORSFilter.class, params);
         bind(CORSFilter.class).in(Singleton.class);
 
@@ -64,5 +67,8 @@ protected void configureServlets() {
 
         serve("/nearest*").with(NearestServlet.class);
         bind(NearestServlet.class).in(Singleton.class);
+
+        serve("/change*").with(ChangeGraphServlet.class);
+        bind(ChangeGraphServlet.class).in(Singleton.class);
     }
 }
diff --git a/web/src/main/java/com/graphhopper/http/GraphHopperServlet.java b/web/src/main/java/com/graphhopper/http/GraphHopperServlet.java
index 75f3518e9e..ff4bb991d2 100644
--- a/web/src/main/java/com/graphhopper/http/GraphHopperServlet.java
+++ b/web/src/main/java/com/graphhopper/http/GraphHopperServlet.java
@@ -22,7 +22,6 @@
 import com.graphhopper.GraphHopper;
 import com.graphhopper.PathWrapper;
 import com.graphhopper.routing.util.FlagEncoder;
-import com.graphhopper.routing.util.HintsMap;
 import com.graphhopper.util.StopWatch;
 import com.graphhopper.util.shapes.GHPoint;
 import org.json.JSONObject;
@@ -42,8 +41,8 @@
 import java.io.IOException;
 import java.io.StringWriter;
 import java.util.*;
-import java.util.Map.Entry;
 
+import static com.graphhopper.util.Parameters.Routing.*;
 import static javax.servlet.http.HttpServletResponse.SC_BAD_REQUEST;
 
 /**
@@ -65,11 +64,10 @@ public void doGet(HttpServletRequest httpReq, HttpServletResponse httpRes) throw
         List<GHPoint> requestPoints = getPoints(httpReq, "point");
         GHResponse ghRsp = new GHResponse();
 
-        // we can reduce the path length based on the maximum differences to the original coordinates
-        double minPathPrecision = getDoubleParam(httpReq, "way_point_max_distance", 1d);
+        double minPathPrecision = getDoubleParam(httpReq, WAY_POINT_MAX_DISTANCE, 1d);
         boolean writeGPX = "gpx".equalsIgnoreCase(getParam(httpReq, "type", "json"));
-        boolean enableInstructions = writeGPX || getBooleanParam(httpReq, "instructions", true);
-        boolean calcPoints = getBooleanParam(httpReq, "calc_points", true);
+        boolean enableInstructions = writeGPX || getBooleanParam(httpReq, INSTRUCTIONS, true);
+        boolean calcPoints = getBooleanParam(httpReq, CALC_POINTS, true);
         boolean enableElevation = getBooleanParam(httpReq, "elevation", false);
         boolean pointsEncoded = getBooleanParam(httpReq, "points_encoded", true);
 
@@ -87,7 +85,7 @@ public void doGet(HttpServletRequest httpReq, HttpServletResponse httpRes) throw
                     favoredHeadings = getDoubleParamList(httpReq, "heading");
 
                 } catch (NumberFormatException e) {
-                    throw new IllegalArgumentException("heading list in from format: " + e.getMessage());
+                    throw new IllegalArgumentException("heading list in wrong format: " + e.getMessage());
                 }
 
                 if (!hopper.getEncodingManager().supports(vehicleStr)) {
@@ -99,6 +97,11 @@ public void doGet(HttpServletRequest httpReq, HttpServletResponse httpRes) throw
                             + "or equal to the number of points (" + requestPoints.size() + ")");
                 }
 
+                List<String> pointHints = new ArrayList<String>(Arrays.asList(getParams(httpReq, POINT_HINT)));
+                if (pointHints.size() > 0 && pointHints.size() != requestPoints.size()) {
+                    throw new IllegalArgumentException("If you pass " + POINT_HINT + ", you need to pass a hint for every point, empty hints will be ignored");
+                }
+
                 FlagEncoder algoVehicle = hopper.getEncodingManager().getEncoder(vehicleStr);
                 GHRequest request;
                 if (favoredHeadings.size() > 0) {
@@ -115,15 +118,16 @@ public void doGet(HttpServletRequest httpReq, HttpServletResponse httpRes) throw
                     request = new GHRequest(requestPoints);
                 }
 
-                initHints(request, httpReq.getParameterMap());
+                initHints(request.getHints(), httpReq.getParameterMap());
                 request.setVehicle(algoVehicle.toString()).
                         setWeighting(weighting).
                         setAlgorithm(algoStr).
                         setLocale(localeStr).
+                        setPointHints(pointHints).
                         getHints().
-                        put("calcPoints", calcPoints).
-                        put("instructions", enableInstructions).
-                        put("wayPointMaxDistance", minPathPrecision);
+                        put(CALC_POINTS, calcPoints).
+                        put(INSTRUCTIONS, enableInstructions).
+                        put(WAY_POINT_MAX_DISTANCE, minPathPrecision);
 
                 ghRsp = hopper.route(request);
             } catch (IllegalArgumentException ex) {
@@ -171,8 +175,9 @@ public void doGet(HttpServletRequest httpReq, HttpServletResponse httpRes) throw
 
             if (ghRsp.hasErrors())
                 writeJsonError(httpRes, SC_BAD_REQUEST, new JSONObject(map));
-            else
+            else {
                 writeJson(httpReq, httpRes, new JSONObject(map));
+            }
         }
     }
 
@@ -250,12 +255,4 @@ protected String errorsToXML(Collection<Throwable> list) {
 
         return infoPoints;
     }
-
-    protected void initHints(GHRequest request, Map<String, String[]> parameterMap) {
-        HintsMap m = request.getHints();
-        for (Entry<String, String[]> e : parameterMap.entrySet()) {
-            if (e.getValue().length == 1)
-                m.put(e.getKey(), e.getValue()[0]);
-        }
-    }
 }
diff --git a/web/src/main/java/com/graphhopper/http/GraphHopperWeb.java b/web/src/main/java/com/graphhopper/http/GraphHopperWeb.java
index 9ee781cbe4..2ba8d7dfed 100644
--- a/web/src/main/java/com/graphhopper/http/GraphHopperWeb.java
+++ b/web/src/main/java/com/graphhopper/http/GraphHopperWeb.java
@@ -22,17 +22,23 @@
 import com.graphhopper.GraphHopperAPI;
 import com.graphhopper.PathWrapper;
 import com.graphhopper.util.*;
-import com.graphhopper.util.exceptions.CannotFindPointException;
+import com.graphhopper.util.exceptions.ConnectionNotFoundException;
+import com.graphhopper.util.exceptions.DetailedIllegalArgumentException;
+import com.graphhopper.util.exceptions.DetailedRuntimeException;
+import com.graphhopper.util.exceptions.PointNotFoundException;
 import com.graphhopper.util.exceptions.PointOutOfBoundsException;
 import com.graphhopper.util.shapes.GHPoint;
 import org.json.JSONArray;
 import org.json.JSONObject;
 
 import java.util.ArrayList;
+import java.util.HashMap;
 import java.util.HashSet;
 import java.util.List;
+import java.util.Map;
 import java.util.Map.Entry;
 import java.util.Set;
+import org.json.JSONException;
 
 /**
  * Main wrapper of the GraphHopper Directions API for a simple and efficient usage.
@@ -47,6 +53,7 @@
     private String key = "";
     private boolean instructions = true;
     private boolean calcPoints = true;
+    private boolean turnDescription = true;
     private boolean elevation = false;
 
     public GraphHopperWeb() {
@@ -71,7 +78,8 @@ public GraphHopperWeb() {
     }
 
     public static PathWrapper createPathWrapper(JSONObject path,
-                                                boolean tmpCalcPoints, boolean tmpInstructions, boolean tmpElevation) {
+                                                boolean tmpCalcPoints, boolean tmpInstructions,
+                                                boolean tmpElevation, boolean turnDescription) {
         PathWrapper pathWrapper = new PathWrapper();
         pathWrapper.addErrors(readErrors(path));
         if (pathWrapper.hasErrors())
@@ -96,7 +104,7 @@ public static PathWrapper createPathWrapper(JSONObject path,
                 for (int instrIndex = 0; instrIndex < instrArr.length(); instrIndex++) {
                     JSONObject jsonObj = instrArr.getJSONObject(instrIndex);
                     double instDist = jsonObj.getDouble("distance");
-                    String text = jsonObj.getString("text");
+                    String text = turnDescription ? jsonObj.getString("text") : jsonObj.getString("street_name");
                     long instTime = jsonObj.getLong("time");
                     int sign = jsonObj.getInt("sign");
                     JSONArray iv = jsonObj.getJSONArray("interval");
@@ -120,6 +128,11 @@ public static PathWrapper createPathWrapper(JSONObject path,
                             ri.setExitNumber(jsonObj.getInt("exit_number"));
                         }
 
+                        if (jsonObj.has("exited")) {
+                            if (jsonObj.getBoolean("exited"))
+                                ri.setExited();
+                        }
+
                         if (jsonObj.has("turn_angle")) {
                             // TODO provide setTurnAngle setter
                             double angle = jsonObj.getDouble("turn_angle");
@@ -139,9 +152,12 @@ public static PathWrapper createPathWrapper(JSONObject path,
                         instr = new Instruction(sign, text, ia, instPL);
                     }
 
-                    // The translation is done from the routing service so just use the provided string
-                    // instead of creating a combination with sign and name etc
-                    instr.setUseRawName();
+                    // Usually, the translation is done from the routing service so just use the provided string
+                    // instead of creating a combination with sign and name etc.
+                    // This is called the turn description.
+                    // This can be changed by passing <code>turn_description=false</code>.
+                    if(turnDescription)
+                        instr.setUseRawName();
 
                     instr.setDistance(instDist).setTime(instTime);
                     il.add(instr);
@@ -156,8 +172,36 @@ public static PathWrapper createPathWrapper(JSONObject path,
         return pathWrapper;
     }
 
+    // Credits to: http://stackoverflow.com/a/24012023/194609
+    private static Map<String, Object> toMap(JSONObject object) throws JSONException {
+        Map<String, Object> map = new HashMap<>(object.keySet().size());
+        for (String key : object.keySet()) {
+            Object value = object.get(key);
+            if (value instanceof JSONArray) {
+                value = toList((JSONArray) value);
+            } else if (value instanceof JSONObject) {
+                value = toMap((JSONObject) value);
+            }
+            map.put(key, value);
+        }
+        return map;
+    }
+
+    private static List<Object> toList(JSONArray array) throws JSONException {
+        List<Object> list = new ArrayList<>();
+        for (Object value : array) {
+            if (value instanceof JSONArray) {
+                value = toList((JSONArray) value);
+            } else if (value instanceof JSONObject) {
+                value = toMap((JSONObject) value);
+            }
+            list.add(value);
+        }
+        return list;
+    }
+
     public static List<Throwable> readErrors(JSONObject json) {
-        List<Throwable> errors = new ArrayList<Throwable>();
+        List<Throwable> errors = new ArrayList<>();
         JSONArray errorJson;
 
         if (json.has("message")) {
@@ -184,19 +228,21 @@ public static PathWrapper createPathWrapper(JSONObject path,
             else if (exClass.equals(IllegalStateException.class.getName()))
                 errors.add(new IllegalStateException(exMessage));
             else if (exClass.equals(RuntimeException.class.getName()))
-                errors.add(new RuntimeException(exMessage));
+                errors.add(new DetailedRuntimeException(exMessage, toMap(error)));
             else if (exClass.equals(IllegalArgumentException.class.getName()))
-                errors.add(new IllegalArgumentException(exMessage));
-            else if (exClass.equals(CannotFindPointException.class.getName())) {
+                errors.add(new DetailedIllegalArgumentException(exMessage, toMap(error)));
+            else if (exClass.equals(ConnectionNotFoundException.class.getName())) {
+                errors.add(new ConnectionNotFoundException(exMessage, toMap(error)));
+            } else if (exClass.equals(PointNotFoundException.class.getName())) {
                 int pointIndex = error.getInt("point_index");
-                errors.add(new CannotFindPointException(exMessage, pointIndex));
+                errors.add(new PointNotFoundException(exMessage, pointIndex));
             } else if (exClass.equals(PointOutOfBoundsException.class.getName())) {
                 int pointIndex = error.getInt("point_index");
                 errors.add(new PointOutOfBoundsException(exMessage, pointIndex));
             } else if (exClass.isEmpty())
-                errors.add(new RuntimeException(exMessage));
+                errors.add(new DetailedRuntimeException(exMessage, toMap(error)));
             else
-                errors.add(new RuntimeException(exClass + " " + exMessage));
+                errors.add(new DetailedRuntimeException(exClass + " " + exMessage, toMap(error)));
         }
 
         if (json.has("message") && errors.isEmpty())
@@ -249,6 +295,7 @@ public GHResponse route(GHRequest request) {
 
             boolean tmpInstructions = request.getHints().getBool("instructions", instructions);
             boolean tmpCalcPoints = request.getHints().getBool("calc_points", calcPoints);
+            boolean tmpTurnDescription = request.getHints().getBool("turn_description", turnDescription);
 
             if (tmpInstructions && !tmpCalcPoints)
                 throw new IllegalStateException("Cannot calculate instructions without points (only points without instructions). "
@@ -296,7 +343,7 @@ public GHResponse route(GHRequest request) {
             JSONArray paths = json.getJSONArray("paths");
             for (int index = 0; index < paths.length(); index++) {
                 JSONObject path = paths.getJSONObject(index);
-                PathWrapper altRsp = createPathWrapper(path, tmpCalcPoints, tmpInstructions, tmpElevation);
+                PathWrapper altRsp = createPathWrapper(path, tmpCalcPoints, tmpInstructions, tmpElevation, tmpTurnDescription);
                 res.add(altRsp);
             }
 
diff --git a/web/src/main/java/com/graphhopper/http/HeadFilter.java b/web/src/main/java/com/graphhopper/http/HeadFilter.java
new file mode 100644
index 0000000000..0f24963501
--- /dev/null
+++ b/web/src/main/java/com/graphhopper/http/HeadFilter.java
@@ -0,0 +1,47 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.http;
+
+import javax.servlet.*;
+import java.io.IOException;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+/**
+ * Throw proper error for HEAD requests
+ *
+ * @author Peter Karich
+ */
+public class HeadFilter implements Filter {
+    @Override
+    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
+        String method = ((HttpServletRequest) request).getMethod();
+        if ("HEAD".equals(method))
+            ((HttpServletResponse) response).sendError(HttpServletResponse.SC_BAD_REQUEST);
+        else
+            chain.doFilter(request, response);
+    }
+
+    @Override
+    public void init(FilterConfig filterConfig) throws ServletException {
+    }
+
+    @Override
+    public void destroy() {
+    }
+}
diff --git a/web/src/main/java/com/graphhopper/http/RouteSerializer.java b/web/src/main/java/com/graphhopper/http/RouteSerializer.java
index 8ef600dccb..c968bbb74d 100644
--- a/web/src/main/java/com/graphhopper/http/RouteSerializer.java
+++ b/web/src/main/java/com/graphhopper/http/RouteSerializer.java
@@ -23,7 +23,7 @@
 import java.util.Map;
 
 /**
- * This interface speficies how the route should be transformed into JSON.
+ * This interface specifies how the route should be transformed into JSON.
  * <p>
  *
  * @author Peter Karich
diff --git a/web/src/main/java/com/graphhopper/http/SimpleRouteSerializer.java b/web/src/main/java/com/graphhopper/http/SimpleRouteSerializer.java
index 37dd5b1e87..f91a115110 100644
--- a/web/src/main/java/com/graphhopper/http/SimpleRouteSerializer.java
+++ b/web/src/main/java/com/graphhopper/http/SimpleRouteSerializer.java
@@ -52,9 +52,9 @@ private String getMessage(Throwable t) {
 
         if (rsp.hasErrors()) {
             json.put("message", getMessage(rsp.getErrors().get(0)));
-            List<Map<String, String>> errorHintList = new ArrayList<Map<String, String>>();
+            List<Map<String, Object>> errorHintList = new ArrayList<>();
             for (Throwable t : rsp.getErrors()) {
-                Map<String, String> map = new HashMap<String, String>();
+                Map<String, Object> map = new HashMap<>();
                 map.put("message", getMessage(t));
                 map.put("details", t.getClass().getName());
                 if (t instanceof GHException) {
diff --git a/web/src/main/webapp/css/images/layers-2x.png b/web/src/main/webapp/css/images/layers-2x.png
index a2cf7f9efe..200c333dca 100644
Binary files a/web/src/main/webapp/css/images/layers-2x.png and b/web/src/main/webapp/css/images/layers-2x.png differ
diff --git a/web/src/main/webapp/css/images/layers.png b/web/src/main/webapp/css/images/layers.png
index bca0a0e429..1a72e5784b 100644
Binary files a/web/src/main/webapp/css/images/layers.png and b/web/src/main/webapp/css/images/layers.png differ
diff --git a/web/src/main/webapp/css/images/loading.gif b/web/src/main/webapp/css/images/loading.gif
deleted file mode 100644
index ed65b705af..0000000000
Binary files a/web/src/main/webapp/css/images/loading.gif and /dev/null differ
diff --git a/web/src/main/webapp/css/images/marker-icon-2x.png b/web/src/main/webapp/css/images/marker-icon-2x.png
index 0015b6495f..e4abba3b51 100644
Binary files a/web/src/main/webapp/css/images/marker-icon-2x.png and b/web/src/main/webapp/css/images/marker-icon-2x.png differ
diff --git a/web/src/main/webapp/css/images/marker-icon.png b/web/src/main/webapp/css/images/marker-icon.png
index e2e9f757f5..950edf2467 100644
Binary files a/web/src/main/webapp/css/images/marker-icon.png and b/web/src/main/webapp/css/images/marker-icon.png differ
diff --git a/web/src/main/webapp/css/images/marker-shadow.png b/web/src/main/webapp/css/images/marker-shadow.png
index d1e773c715..9fd2979532 100644
Binary files a/web/src/main/webapp/css/images/marker-shadow.png and b/web/src/main/webapp/css/images/marker-shadow.png differ
diff --git a/web/src/main/webapp/css/leaflet.contextmenu.css b/web/src/main/webapp/css/leaflet.contextmenu.css
index cd83d4b2ab..0b5e2defca 100644
--- a/web/src/main/webapp/css/leaflet.contextmenu.css
+++ b/web/src/main/webapp/css/leaflet.contextmenu.css
@@ -28,10 +28,6 @@
     opacity: 0.5;
 }
 
-.leaflet-contextmenu a.leaflet-contextmenu-item-hidden {
-    display: none;
-}
-
 .leaflet-contextmenu a.leaflet-contextmenu-item.over {
     background-color: #f4f4f4;
     border-top: 1px solid #f0f0f0;
@@ -56,7 +52,3 @@
     border-bottom: 1px solid #ccc;
     margin: 5px 0;
 }
-
-.leaflet-contextmenu-separator-hidden {
-    display: none;
-}
\ No newline at end of file
diff --git a/web/src/main/webapp/css/leaflet.css b/web/src/main/webapp/css/leaflet.css
index 1232550253..72998d0054 100644
--- a/web/src/main/webapp/css/leaflet.css
+++ b/web/src/main/webapp/css/leaflet.css
@@ -1,16 +1,12 @@
 /* required styles */
 
-.leaflet-map-pane,
+.leaflet-pane,
 .leaflet-tile,
 .leaflet-marker-icon,
 .leaflet-marker-shadow,
-.leaflet-tile-pane,
 .leaflet-tile-container,
-.leaflet-overlay-pane,
-.leaflet-shadow-pane,
-.leaflet-marker-pane,
-.leaflet-popup-pane,
-.leaflet-overlay-pane svg,
+.leaflet-pane > svg,
+.leaflet-pane > canvas,
 .leaflet-zoom-box,
 .leaflet-image-layer,
 .leaflet-layer {
@@ -20,7 +16,6 @@
 	}
 .leaflet-container {
 	overflow: hidden;
-	-ms-touch-action: none;
 	}
 .leaflet-tile,
 .leaflet-marker-icon,
@@ -28,20 +23,43 @@
 	-webkit-user-select: none;
 	   -moz-user-select: none;
 	        user-select: none;
-	-webkit-user-drag: none;
+	  -webkit-user-drag: none;
+	}
+/* Safari renders non-retina tile on retina better with this, but Chrome is worse */
+.leaflet-safari .leaflet-tile {
+	image-rendering: -webkit-optimize-contrast;
+	}
+/* hack that prevents hw layers "stretching" when loading new tiles */
+.leaflet-safari .leaflet-tile-container {
+	width: 1600px;
+	height: 1600px;
+	-webkit-transform-origin: 0 0;
 	}
 .leaflet-marker-icon,
 .leaflet-marker-shadow {
 	display: block;
 	}
-/* map is broken in FF if you have max-width: 100% on tiles */
-.leaflet-container img {
+/* .leaflet-container svg: reset svg max-width decleration shipped in Joomla! (joomla.org) 3.x */
+/* .leaflet-container img: map is broken in FF if you have max-width: 100% on tiles */
+.leaflet-container .leaflet-overlay-pane svg,
+.leaflet-container .leaflet-marker-pane img,
+.leaflet-container .leaflet-shadow-pane img,
+.leaflet-container .leaflet-tile-pane img,
+.leaflet-container img.leaflet-image-layer {
 	max-width: none !important;
 	}
-/* stupid Android 2 doesn't understand "max-width: none" properly */
-.leaflet-container img.leaflet-image-layer {
-	max-width: 15000px !important;
+
+.leaflet-container.leaflet-touch-zoom {
+	-ms-touch-action: pan-x pan-y;
+	touch-action: pan-x pan-y;
+	}
+.leaflet-container.leaflet-touch-drag {
+	-ms-touch-action: pinch-zoom;
 	}
+.leaflet-container.leaflet-touch-drag.leaflet-touch-zoom {
+	-ms-touch-action: none;
+	touch-action: none;
+}
 .leaflet-tile {
 	filter: inherit;
 	visibility: hidden;
@@ -52,18 +70,26 @@
 .leaflet-zoom-box {
 	width: 0;
 	height: 0;
+	-moz-box-sizing: border-box;
+	     box-sizing: border-box;
+	z-index: 800;
 	}
 /* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */
 .leaflet-overlay-pane svg {
 	-moz-user-select: none;
 	}
 
-.leaflet-tile-pane    { z-index: 2; }
-.leaflet-objects-pane { z-index: 3; }
-.leaflet-overlay-pane { z-index: 4; }
-.leaflet-shadow-pane  { z-index: 5; }
-.leaflet-marker-pane  { z-index: 6; }
-.leaflet-popup-pane   { z-index: 7; }
+.leaflet-pane         { z-index: 400; }
+
+.leaflet-tile-pane    { z-index: 200; }
+.leaflet-overlay-pane { z-index: 400; }
+.leaflet-shadow-pane  { z-index: 500; }
+.leaflet-marker-pane  { z-index: 600; }
+.leaflet-tooltip-pane   { z-index: 650; }
+.leaflet-popup-pane   { z-index: 700; }
+
+.leaflet-map-pane canvas { z-index: 100; }
+.leaflet-map-pane svg    { z-index: 200; }
 
 .leaflet-vml-shape {
 	width: 1px;
@@ -80,7 +106,8 @@
 
 .leaflet-control {
 	position: relative;
-	z-index: 7;
+	z-index: 800;
+	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
 	pointer-events: auto;
 	}
 .leaflet-top,
@@ -124,7 +151,9 @@
 
 /* zoom and fade animations */
 
-.leaflet-fade-anim .leaflet-tile,
+.leaflet-fade-anim .leaflet-tile {
+	will-change: opacity;
+	}
 .leaflet-fade-anim .leaflet-popup {
 	opacity: 0;
 	-webkit-transition: opacity 0.2s linear;
@@ -132,11 +161,17 @@
 	     -o-transition: opacity 0.2s linear;
 	        transition: opacity 0.2s linear;
 	}
-.leaflet-fade-anim .leaflet-tile-loaded,
 .leaflet-fade-anim .leaflet-map-pane .leaflet-popup {
 	opacity: 1;
 	}
-
+.leaflet-zoom-animated {
+	-webkit-transform-origin: 0 0;
+	    -ms-transform-origin: 0 0;
+	        transform-origin: 0 0;
+	}
+.leaflet-zoom-anim .leaflet-zoom-animated {
+	will-change: transform;
+	}
 .leaflet-zoom-anim .leaflet-zoom-animated {
 	-webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);
 	   -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);
@@ -144,8 +179,7 @@
 	        transition:         transform 0.25s cubic-bezier(0,0,0.25,1);
 	}
 .leaflet-zoom-anim .leaflet-tile,
-.leaflet-pan-anim .leaflet-tile,
-.leaflet-touching .leaflet-zoom-animated {
+.leaflet-pan-anim .leaflet-tile {
 	-webkit-transition: none;
 	   -moz-transition: none;
 	     -o-transition: none;
@@ -159,24 +193,44 @@
 
 /* cursors */
 
-.leaflet-clickable {
+.leaflet-interactive {
 	cursor: pointer;
 	}
-.leaflet-container {
+.leaflet-grab {
 	cursor: -webkit-grab;
 	cursor:    -moz-grab;
 	}
+.leaflet-crosshair,
+.leaflet-crosshair .leaflet-interactive {
+	cursor: crosshair;
+	}
 .leaflet-popup-pane,
 .leaflet-control {
 	cursor: auto;
 	}
-.leaflet-dragging .leaflet-container,
-.leaflet-dragging .leaflet-clickable {
+.leaflet-dragging .leaflet-grab,
+.leaflet-dragging .leaflet-grab .leaflet-interactive,
+.leaflet-dragging .leaflet-marker-draggable {
 	cursor: move;
 	cursor: -webkit-grabbing;
 	cursor:    -moz-grabbing;
 	}
 
+/* marker & overlays interactivity */
+.leaflet-marker-icon,
+.leaflet-marker-shadow,
+.leaflet-image-layer,
+.leaflet-pane > svg path,
+.leaflet-tile-container {
+	pointer-events: none;
+	}
+
+.leaflet-marker-icon.leaflet-interactive,
+.leaflet-image-layer.leaflet-interactive,
+.leaflet-pane > svg path.leaflet-interactive {
+	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
+	pointer-events: auto;
+	}
 
 /* visual tweaks */
 
@@ -303,6 +357,10 @@
 	color: #333;
 	background: #fff;
 	}
+.leaflet-control-layers-scrollbar {
+	overflow-y: scroll;
+	padding-right: 5px;
+	}
 .leaflet-control-layers-selector {
 	margin-top: 2px;
 	position: relative;
@@ -317,6 +375,11 @@
 	margin: 5px -10px 5px -6px;
 	}
 
+/* Default icon URLs */
+.leaflet-default-icon-path {
+	background-image: url(images/marker-icon.png);
+	}
+
 
 /* attribution and scale controls */
 
@@ -354,8 +417,8 @@
 	font-size: 11px;
 	white-space: nowrap;
 	overflow: hidden;
-	-moz-box-sizing: content-box;
-	     box-sizing: content-box;
+	-moz-box-sizing: border-box;
+	     box-sizing: border-box;
 
 	background: #fff;
 	background: rgba(255, 255, 255, 0.5);
@@ -386,6 +449,7 @@
 .leaflet-popup {
 	position: absolute;
 	text-align: center;
+	margin-bottom: 20px;
 	}
 .leaflet-popup-content-wrapper {
 	padding: 1px;
@@ -400,11 +464,13 @@
 	margin: 18px 0;
 	}
 .leaflet-popup-tip-container {
-	margin: 0 auto;
 	width: 40px;
 	height: 20px;
-	position: relative;
+	position: absolute;
+	left: 50%;
+	margin-left: -20px;
 	overflow: hidden;
+	pointer-events: none;
 	}
 .leaflet-popup-tip {
 	width: 17px;
@@ -422,7 +488,7 @@
 .leaflet-popup-content-wrapper,
 .leaflet-popup-tip {
 	background: white;
-
+	color: #333;
 	box-shadow: 0 3px 14px rgba(0,0,0,0.4);
 	}
 .leaflet-container a.leaflet-popup-close-button {
@@ -430,6 +496,7 @@
 	top: 0;
 	right: 0;
 	padding: 4px 4px 0 0;
+	border: none;
 	text-align: center;
 	width: 18px;
 	height: 14px;
@@ -476,3 +543,82 @@
 	background: #fff;
 	border: 1px solid #666;
 	}
+
+
+/* Tooltip */
+/* Base styles for the element that has a tooltip */
+.leaflet-tooltip {
+	position: absolute;
+	padding: 6px;
+	background-color: #fff;
+	border: 1px solid #fff;
+	border-radius: 3px;
+	color: #222;
+	white-space: nowrap;
+	-webkit-user-select: none;
+	-moz-user-select: none;
+	-ms-user-select: none;
+	user-select: none;
+	pointer-events: none;
+	box-shadow: 0 1px 3px rgba(0,0,0,0.4);
+	}
+.leaflet-tooltip.leaflet-clickable {
+	cursor: pointer;
+	pointer-events: auto;
+	}
+.leaflet-tooltip-top:before,
+.leaflet-tooltip-bottom:before,
+.leaflet-tooltip-left:before,
+.leaflet-tooltip-right:before {
+	position: absolute;
+	pointer-events: none;
+	border: 6px solid transparent;
+	background: transparent;
+	content: "";
+	}
+
+/* Directions */
+
+.leaflet-tooltip-bottom {
+	margin-top: 6px;
+}
+.leaflet-tooltip-top {
+	margin-top: -6px;
+}
+.leaflet-tooltip-bottom:before,
+.leaflet-tooltip-top:before {
+	left: 50%;
+	margin-left: -6px;
+	}
+.leaflet-tooltip-top:before {
+	bottom: 0;
+	margin-bottom: -12px;
+	border-top-color: #fff;
+	}
+.leaflet-tooltip-bottom:before {
+	top: 0;
+	margin-top: -12px;
+	margin-left: -6px;
+	border-bottom-color: #fff;
+	}
+.leaflet-tooltip-left {
+	margin-left: -6px;
+}
+.leaflet-tooltip-right {
+	margin-left: 6px;
+}
+.leaflet-tooltip-left:before,
+.leaflet-tooltip-right:before {
+	top: 50%;
+	margin-top: -6px;
+	}
+.leaflet-tooltip-left:before {
+	right: 0;
+	margin-right: -12px;
+	border-left-color: #fff;
+	}
+.leaflet-tooltip-right:before {
+	left: 0;
+	margin-left: -12px;
+	border-right-color: #fff;
+	}
diff --git a/web/src/main/webapp/css/leaflet.loading.css b/web/src/main/webapp/css/leaflet.loading.css
index 79657a4741..f4157bc6f3 100644
--- a/web/src/main/webapp/css/leaflet.loading.css
+++ b/web/src/main/webapp/css/leaflet.loading.css
@@ -1,16 +1,20 @@
-.leaflet-control-loading {
-    background: url(images/loading.gif);
+.leaflet-control-loading:empty {
+    /* Spinner via ajaxload.info, base64-encoded */
+    background-image: url(data:image/gif;base64,R0lGODlhEAAQAPQAAP///wAAAPDw8IqKiuDg4EZGRnp6egAAAFhYWCQkJKysrL6+vhQUFJycnAQEBDY2NmhoaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAAKAAEALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQACgACACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQACgADACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkEAAoABAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkEAAoABQAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkEAAoABgAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAAKAAcALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkEAAoACAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAAKAAkALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQACgAKACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQACgALACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==);
+    background-repeat: no-repeat;
 }
 
 .leaflet-control-loading,
-.leaflet-control-zoom a.leaflet-control-loading ,
-.leaflet-control-zoomslider a.leaflet-control-loading {
+.leaflet-control-zoom a.leaflet-control-loading,
+.leaflet-control-zoomslider a.leaflet-control-loading,
+.leaflet-control-layer-container {
     display: none;
 }
 
 .leaflet-control-loading.is-loading,
 .leaflet-control-zoom a.leaflet-control-loading.is-loading,
-.leaflet-control-zoomslider a.leaflet-control-loading.is-loading  {
+.leaflet-control-zoomslider a.leaflet-control-loading.is-loading,
+.leaflet-control-layer-container.is-loading {
     display: block;
 }
 
diff --git a/web/src/main/webapp/css/style.css b/web/src/main/webapp/css/style.css
index cdfd5e9f54..0803581863 100644
--- a/web/src/main/webapp/css/style.css
+++ b/web/src/main/webapp/css/style.css
@@ -1,8 +1,7 @@
 body {
-    color: #000;
     font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
     line-height: 1.4;
-    color: #111111;
+    color: #111;
     background-color: white;
     margin: 0;
     min-width: 700px;
@@ -18,7 +17,7 @@ body {
     /*padding-right: 15px; */
 }
 
-#info {    
+#info {
     margin-top: 10px;
     display: none;
     padding: 5px;
@@ -28,7 +27,7 @@ body {
     padding-right: 5px;
 }
 
-.route_results {    
+.route_results {
     max-height: 40%;
 }
 
@@ -39,6 +38,7 @@ body {
 
 .instructions_info {
     overflow: auto;
+    width: 100%;
 }
 
 .route_description {
@@ -186,7 +186,7 @@ body {
 }
 #hosting {
     display: none;
-    /*    float: left;*/
+    /* float: left;*/
     padding-top: 4px;
     padding-bottom: 10px;
     /* color: #666666; */
@@ -221,7 +221,7 @@ tr.instruction {
     border-bottom: #dadada dashed thin;
 }
 
-.instructions {    
+.instructions {
     table-layout:fixed;
     border-collapse: collapse;
     padding-top: 10px;
@@ -302,7 +302,7 @@ td img.pic {
 .wikilink { float: right; }
 .wikilink img { max-width: 16px; }
 
-.nameseg { /*border-top: #dadada dashed thin;*/ }
+/* .nameseg { border-top: #dadada dashed thin; } */
 .cityseg { float: left; font-size: 10px; }
 .moreseg { float: right; font-size: 9px; }
 
@@ -310,7 +310,7 @@ td img.pic {
     width: 16px;
     height: 16px;
 }
-.pointFlag:hover { cursor: n-resize; }
+.pointFlag:hover { cursor: ns-resize; }
 .pointAdd {
     padding-left: 3px;
 }
@@ -321,7 +321,7 @@ td img.pic {
 .pointDelete:hover, .pointAdd:hover { cursor: pointer; }
 .pointDelete:disabled {
     background: red;
-} 
+}
 
 .expandDetails {
     color: gray;
@@ -331,21 +331,26 @@ td img.pic {
     width: 20px;
     height: 20px;
     height: 20px;
-    margin: 0px 10px;
-    padding: 0px;
+    margin: 0 10px;
+    padding: 0;
     background-image: linear-gradient(to bottom, white, #e7e7e7);
 }
 #moreButton {
     background-image: linear-gradient(to bottom, white, #e7e7e7);
 }
 
-.ui-dialog > .ui-widget-header{
-    padding:1em;    
+.ui-dialog {
+  /* Must be > 700, the z-index of .leaflet-popup-pane */
+  z-index: 1000;
+}
+
+.ui-dialog > .ui-widget-header {
+    padding: 1em;
     border: 1px solid black;
 }
 
 .ui-dialog .ui-dialog-content {
-    padding:1em
+    padding: 1em;
 }
 
 .ui-dialog .ui-widget-content {
@@ -367,8 +372,8 @@ td img.pic {
 }
 
 #route_result_tabs {
-    list-style: none; 
-    padding: 0; 
+    list-style: none;
+    padding: 0;
     margin: 0;
 }
 
@@ -392,7 +397,7 @@ td img.pic {
 }
 
 .route_result_tab.current {
-    display: block;    
+    display: block;
 }
 
 #donate_form {
@@ -402,7 +407,7 @@ td img.pic {
 #donate_form_button {
     background: none;
     border: none;
-    padding-left: 0px;
+    padding-left: 0;
     margin-top: 5px;
     cursor: pointer;
     float: left;
@@ -414,7 +419,7 @@ td img.pic {
 
 .plain_text_button {
     font-size: small;
-    padding: 0px;
+    padding: 0;
     border: none;
     background: none;
     cursor: pointer;
diff --git a/web/src/main/webapp/img/indicator.gif b/web/src/main/webapp/img/indicator.gif
index 7dfc4bf477..e192ca895c 100644
Binary files a/web/src/main/webapp/img/indicator.gif and b/web/src/main/webapp/img/indicator.gif differ
diff --git a/web/src/main/webapp/index.html b/web/src/main/webapp/index.html
index 3407a84aa6..e45343fdbb 100644
--- a/web/src/main/webapp/index.html
+++ b/web/src/main/webapp/index.html
@@ -8,13 +8,13 @@
         <link rel="search" type="application/opensearchdescription+xml" title="GraphHopper Maps" href="opensearch.xml"/>
         <title>Driving Directions - GraphHopper Maps</title>
         <meta name="description" content="A fast route planner for biking, hiking and more! Based on OpenStreetMap including elevation data. Try out for free!"/>
-        <link rel="stylesheet" href="css/leaflet.css?v=0.7.3" />
+        <link rel="stylesheet" href="css/leaflet.css?v=1.0.3" />
         <link rel="stylesheet" href="css/leaflet.elevation-0.0.4.css" />
         <link rel="stylesheet" href="css/leaflet_numbered_markers.css" />
         <link rel="stylesheet" href="css/leaflet.contextmenu.css" />
-        <link rel="stylesheet" href="css/leaflet.loading.css" />
+        <link rel="stylesheet" href="css/leaflet.loading.css?v=0.1.24" />
         <link rel="stylesheet" href="css/ui-lightness/jquery-ui.min.css" />
-        <script type="text/javascript" src="js/main.js?v=0.7.0"></script>
+        <script type="text/javascript" src="js/main.js?v=0.9.1"></script>
         <link rel="stylesheet" type="text/css" href="css/style.css" />
     </head>
     <body>
diff --git a/web/src/main/webapp/js/graphhopper/GHRequest.js b/web/src/main/webapp/js/graphhopper/GHRequest.js
index da385da5da..f7d62d6a9f 100644
--- a/web/src/main/webapp/js/graphhopper/GHRequest.js
+++ b/web/src/main/webapp/js/graphhopper/GHRequest.js
@@ -30,7 +30,6 @@ if (!Function.prototype.bind) {
 
 var GHRequest = function (host, api_key) {
     this.host = host;
-    this.key = api_key;
     this.route = new GHRoute(new GHInput(), new GHInput());
     this.from = this.route.first();
     this.to = this.route.last();
@@ -41,7 +40,7 @@ var GHRequest = function (host, api_key) {
     this.useMiles = false;
     // use jsonp here if host allows CORS
     this.dataType = "json";
-    this.api_params = {"locale": "en", "vehicle": "car", "weighting": "fastest", "elevation": false};
+    this.api_params = {"locale": "en", "vehicle": "car", "weighting": "fastest", "elevation": false, "key": api_key};
 
     // register events
     this.route.addListener('route.add', function (evt) {
@@ -144,7 +143,7 @@ GHRequest.prototype.createGeocodeURL = function (host, prevIndex) {
     if (host)
         tmpHost = host;
 
-    var path = this.createPath(tmpHost + "/geocode?limit=6&type=" + this.dataType + "&key=" + this.key);
+    var path = this.createPath(tmpHost + "/geocode?limit=6&type=" + this.dataType);
     if (prevIndex >= 0 && prevIndex < this.route.size()) {
         var point = this.route.getIndex(prevIndex);
         if (point.isResolved()) {
@@ -155,15 +154,16 @@ GHRequest.prototype.createGeocodeURL = function (host, prevIndex) {
 };
 
 GHRequest.prototype.createURL = function () {
-    return this.createPath(this.host + "/route?" + this.createPointParams(false) + "&type=" + this.dataType + "&key=" + this.key);
+    return this.createPath(this.host + "/route?" + this.createPointParams(false) + "&type=" + this.dataType);
 };
 
 GHRequest.prototype.createGPXURL = function (withRoute, withTrack, withWayPoints) {
-    return this.createPath(this.host + "/route?" + this.createPointParams(false) + "&type=gpx&key=" + this.key + "&gpx.route=" + withRoute + "&gpx.track=" + withTrack + "&gpx.waypoints=" + withWayPoints);
+    return this.createPath(this.host + "/route?" + this.createPointParams(false) + "&type=gpx&gpx.route=" + withRoute + "&gpx.track=" + withTrack + "&gpx.waypoints=" + withWayPoints);
 };
 
 GHRequest.prototype.createHistoryURL = function () {
-    return this.createPath("?" + this.createPointParams(true)) + "&use_miles=" + !!this.useMiles;
+    var skip = {"key": true};
+    return this.createPath("?" + this.createPointParams(true), skip) + "&use_miles=" + !!this.useMiles;
 };
 
 GHRequest.prototype.createPointParams = function (useRawInput) {
@@ -181,9 +181,12 @@ GHRequest.prototype.createPointParams = function (useRawInput) {
     return (str);
 };
 
-GHRequest.prototype.createPath = function (url) {
+GHRequest.prototype.createPath = function (url, skipParameters) {
     for (var key in this.api_params) {
         var val = this.api_params[key];
+        if(skipParameters && skipParameters[key])
+            continue;
+
         if (GHRoute.isArray(val)) {
             for (var keyIndex in val) {
                 url += "&" + encodeURIComponent(key) + "=" + encodeURIComponent(val[keyIndex]);
@@ -249,7 +252,7 @@ GHRequest.prototype.doRequest = function (url, callback) {
 };
 
 GHRequest.prototype.getInfo = function () {
-    var url = this.host + "/info?type=" + this.dataType + "&key=" + this.key;
+    var url = this.host + "/info?type=" + this.dataType + "&key=" + this.getKey();
     // console.log(url);
     return $.ajax({
         url: url,
@@ -265,11 +268,15 @@ GHRequest.prototype.setLocale = function (locale) {
         this.api_params.locale = locale;
 };
 
+GHRequest.prototype.getKey = function() {
+    return this.api_params.key;
+};
+
 GHRequest.prototype.fetchTranslationMap = function (urlLocaleParam) {
     if (!urlLocaleParam)
         // let servlet figure out the locale from the Accept-Language header
         urlLocaleParam = "";
-    var url = this.host + "/i18n/" + urlLocaleParam + "?type=" + this.dataType + "&key=" + this.key;
+    var url = this.host + "/i18n/" + urlLocaleParam + "?type=" + this.dataType + "&key=" + this.getKey();
     // console.log(url);
     return $.ajax({
         url: url,
diff --git a/web/src/main/webapp/js/instructions.js b/web/src/main/webapp/js/instructions.js
index f64f3310b8..66a01fa599 100644
--- a/web/src/main/webapp/js/instructions.js
+++ b/web/src/main/webapp/js/instructions.js
@@ -101,7 +101,7 @@ module.exports.create = function (mapLayer, path, urlForHistory, request) {
     hiddenDiv.append(osmRouteLink);
 
     var osrmLink = $("<a>OSRM</a>");
-    osrmLink.attr("href", "http://map.project-osrm.org/?loc=" + request.from + "&loc=" + request.to);
+    osrmLink.attr("href", "http://map.project-osrm.org/?z=13&loc=" + request.from + "&loc=" + request.to);
     hiddenDiv.append("<br/><span>Compare with: </span>");
     hiddenDiv.append(osrmLink);
     var googleLink = $("<a>Google</a> ");
diff --git a/web/src/main/webapp/js/lib/leaflet.contextmenu.js b/web/src/main/webapp/js/lib/leaflet.contextmenu.js
deleted file mode 100644
index 4cae713af9..0000000000
--- a/web/src/main/webapp/js/lib/leaflet.contextmenu.js
+++ /dev/null
@@ -1,618 +0,0 @@
-/*
-Leaflet.contextmenu, a context menu for Leaflet.
-(c) 2014, Adam Ratcliffe, GeoSmart Maps Limited
-contribute 2014, Roland Braband, NRC
- */
-L.Map.mergeOptions({
-    contextmenuItems : []
-});
-
-L.Map.ContextMenu = L.Handler.extend({
-
-        statics : {
-            BASE_CLS : 'leaflet-contextmenu'
-        },
-
-        initialize : function (map) {
-            L.Handler.prototype.initialize.call(this, map);
-
-            this._items = [];
-            this._sets = [];
-            this._state = 0;
-            this._defaultState = map.options.contextmenuDefaultState || 1;
-            this._activeState = map.options.contextmenuAtiveState || 1;
-            this._visible = false;
-
-            var container = this._container = L.DomUtil.create('div', L.Map.ContextMenu.BASE_CLS, map._container);
-            container.style.zIndex = 1e4;
-            container.style.position = 'absolute';
-
-            if (map.options.contextmenuWidth) {
-                container.style.width = map.options.contextmenuWidth + 'px';
-            }
-            if (map.options.contextmenuSets === undefined || map.options.contextmenuSets.length === 0) {
-                map.options.contextmenuSets = [{
-                        name : 'set_default',
-                        state : this._defaultState
-                    }
-                ];
-            }
-
-            this._createItems();
-            this._createSets();
-            this._changeState();
-            L.DomEvent
-            .on(container, 'click', L.DomEvent.stop)
-            .on(container, 'mousedown', L.DomEvent.stop)
-            .on(container, 'dblclick', L.DomEvent.stop)
-            .on(container, 'contextmenu', L.DomEvent.stop);
-        },
-
-        addHooks : function () {
-            L.DomEvent
-            .on(document, ((L.Browser.touch) ? 'touchstart' : 'mousedown'), this._onMouseDown, this)
-            .on(document, 'keydown', this._onKeyDown, this);
-
-            this._map.on({
-                contextmenu : this._show,
-                mouseout : this._hide,
-                mousedown : this._hide,
-                movestart : this._hide,
-                zoomstart : this._hide
-            }, this);
-        },
-
-        removeHooks : function () {
-            L.DomEvent.off(document, 'keydown', this._onKeyDown, this);
-
-            this._map.off({
-                contextmenu : this._show,
-                mouseout : this._hide,
-                mousedown : this._hide,
-                movestart : this._hide,
-                zoomstart : this._hide
-            }, this);
-
-        },
-
-        showAt : function (point, data, state) {
-            if (point instanceof L.LatLng) {
-                point = this._map.latLngToContainerPoint(point);
-            }
-            this._showAtPoint(point, data, state);
-        },
-
-        hide : function () {
-            this._hide();
-        },
-
-        setState : function (state) {
-            return this._changeState(state);
-        },
-
-        setActiveState : function (state) {
-            var set,
-            state = (state !== undefined) ? state : this._activeState,
-            el,
-            i,
-            l;
-
-            for (i = 0, l = this._sets.length; i < l; i++) {
-                set = this._sets[i];
-                if (set.state === state) {
-                    this._activeState = state;
-                    break;
-                }
-            }
-            return set;
-        },
-
-        getState : function () {
-            return this._state;
-        },
-
-        addSet : function (options) {
-            return this.insertSet(options);
-        },
-
-        insertSet : function (options, id) {
-            var id = (id !== undefined) ? id : this._sets.length,
-            set = this._createSet(options, id);
-
-            this._sets.push(set);
-            return set;
-        },
-
-        addItem : function (options) {
-            return this.insertItem(options);
-        },
-
-        insertItem : function (options, index) {
-            var index = (index !== undefined) ? index : this._items.length,
-            item = this._createItem(this._container, options, index);
-
-            this._items.push(item);
-            this._sizeChanged = true;
-            this._map.fire('contextmenu.additem', {
-                contextmenu : this,
-                el : item.el,
-                index : index
-            });
-
-            return item.el;
-        },
-
-        removeItem : function (item) {
-            var container = this._container;
-
-            if (!isNaN(item)) {
-                item = container.children[item];
-            }
-
-            if (item !== undefined) {
-                this._removeItem(L.Util.stamp(item));
-
-                this._sizeChanged = true;
-
-                this._map.fire('contextmenu.removeitem', {
-                    contextmenu : this,
-                    el : item
-                });
-
-            }
-        },
-
-        removeAllItems : function () {
-            var item;
-            
-            while (this._container.children.length) {
-                item = this._container.children[0];
-                this._removeItem(L.Util.stamp(item));
-            }
-        },
-
-        setDisabled : function (item, disabled) {
-            var container = this._container,
-            itemCls = L.Map.ContextMenu.BASE_CLS + '-item';
-
-            if (!isNaN(item)) {
-                item = container.children[item];
-            }
-
-            if (item !== undefined && L.DomUtil.hasClass(item, itemCls)) {
-                if (disabled) {
-                    L.DomUtil.addClass(item, itemCls + '-disabled');
-                    this._map.fire('contextmenu.disableitem', {
-                        contextmenu : this,
-                        el : item
-                    });
-                } else {
-                    L.DomUtil.removeClass(item, itemCls + '-disabled');
-                    this._map.fire('contextmenu.enableitem', {
-                        contextmenu : this,
-                        el : item
-                    });
-                }
-            }
-        },
-
-        setHidden : function (item, hidden) {
-            var container = this._container,
-            itemCls = L.Map.ContextMenu.BASE_CLS + '-item',
-            separatorCls = L.Map.ContextMenu.BASE_CLS + '-separator';
-
-            if (!isNaN(item)) {
-                item = container.children[item];
-            }
-            if (item !== undefined && L.DomUtil.hasClass(item, itemCls)) {
-                if (hidden) {
-                    L.DomUtil.addClass(item, itemCls + '-hidden');
-                    this._map.fire('contextmenu.hideitem', {
-                        contextmenu : this,
-                        el : item
-                    });
-
-                } else {
-                    L.DomUtil.removeClass(item, itemCls + '-hidden');
-                    this._map.fire('contextmenu.showitem', {
-                        contextmenu : this,
-                        el : item
-                    });
-                }
-            } else if (item !== undefined && L.DomUtil.hasClass(item, separatorCls)) {
-                if (hidden) {
-                    L.DomUtil.addClass(item, separatorCls + '-hidden');
-                } else {
-                    L.DomUtil.removeClass(item, separatorCls + '-hidden');
-                }
-            }
-        },
-
-        isVisible : function () {
-            return this._visible;
-        },
-
-        // private methods
-        _changeState : function (state) {
-            var set,
-            state = (state !== undefined) ? state : this._defaultState,
-            item,
-            el,
-            i,
-            l;
-            
-            if (state !== this._state) {
-                for (i = 0, l = this._sets.length; i < l; i++) {
-                    set = this._sets[i];
-                    if (set.state === state || (set.name === state && set.state !== this._state)) {
-                        this._map.fire('contextmenu.changestate', {
-                            contextmenu : this,
-                            set : set,
-                            state : state
-                        });
-                        for (i = 0, l = this._items.length; i < l; i++) {
-                            item = this._items[i];
-                            this.setHidden(this._items[i].el, (item.state.indexOf(set.state) === -1 && item.state.indexOf(set.name) === -1));
-                        }
-                        this._sizeChanged = true;
-                        this._state = state;
-                        break;
-                    }
-                }
-            }
-            return set;
-        },
-
-        _createSets : function () {
-            var setOptions = this._map.options.contextmenuSets,
-            set,
-            i,
-            l;
-
-            for (i = 0, l = setOptions.length; i < l; i++) {
-                this._sets.push(this._createSet(setOptions[i], this._sets.length));
-            }
-        },
-
-        _createSet : function (options, id) {
-            var name = (options.name !== undefined) ? options.name : 'set_' + id;
-            return {
-                id : id,
-                name : options.name,
-                state : options.state
-            };
-        },
-
-        _createItems : function () {
-            var itemOptions = this._map.options.contextmenuItems,
-            item,
-            i,
-            l;
-
-            for (i = 0, l = itemOptions.length; i < l; i++) {
-                this._items.push(this._createItem(this._container, itemOptions[i]));
-            }
-        },
-
-        _createItem : function (container, options, index) {
-            if (options.separator || options === '-') {
-                return this._createSeparator(container, index, options.state);
-            }
-
-            var itemCls = L.Map.ContextMenu.BASE_CLS + '-item',
-            state = (options.state !== undefined) ? ((Array.isArray(options.state)) ? options.state : [options.state]) : [this._defaultState],
-            cls = (options.disabled) ? (itemCls + ' ' + itemCls + '-disabled') : ((options.hidden) ? (itemCls + ' ' + itemCls + '-hidden') : itemCls),
-            el = this._insertElementAt('a', cls, container, index),
-            callback = this._createEventHandler(el, options.callback, options.context, options.hideOnSelect),
-            html = '';
-
-            if (options.icon) {
-                html = '<img class="' + L.Map.ContextMenu.BASE_CLS + '-icon" src="' + options.icon + '"/>';
-            } else if (options.iconCls) {
-                html = '<span class="' + L.Map.ContextMenu.BASE_CLS + '- icon ' + options.iconCls + '"></span>';
-            }
-
-            el.innerHTML = html + options.text;
-            el.href = '#';
-            L.DomEvent
-            .on(el, 'mouseover', this._onItemMouseOver, this)
-            .on(el, 'mouseout', this._onItemMouseOut, this)
-            .on(el, 'mousedown', L.DomEvent.stopPropagation)
-            .on(el, 'click', callback);
-
-            return {
-                id : L.Util.stamp(el),
-                el : el,
-                callback : callback,
-                state : state
-            };
-        },
-
-        _removeItem : function (id) {
-            var item,
-            callback,
-            el,
-            i,
-            l;
-
-            for (i = 0, l = this._items.length; i < l; i++) {
-                item = this._items[i];
-
-                if (item.id === id) {
-                    el = item.el;
-                    callback = item.callback;
-
-                    if (callback) {
-                        L.DomEvent
-                        .off(el, 'mouseover', this._onItemMouseOver, this)
-                        .off(el, 'mouseover', this._onItemMouseOut, this)
-                        .off(el, 'mousedown', L.DomEvent.stopPropagation)
-                        .off(el, 'click', item.callback);
-
-                    }
-
-                    this._container.removeChild(el);
-                    this._items.splice(i, 1);
-                    return item;
-
-                }
-            }
-            return null;
-        },
-
-        _createSeparator : function (container, index, state) {
-            var el = this._insertElementAt('div', L.Map.ContextMenu.BASE_CLS + '-separator', container, index),
-            state = (state !== undefined) ? ((Array.isArray(state)) ? state : [state]) : [this._defaultState];
-
-            return {
-                id : L.Util.stamp(el),
-                el : el,
-                state : state
-            };
-        },
-
-        _createEventHandler : function (el, func, context, hideOnSelect) {
-            var me = this,
-            map = this._map,
-            disabledCls = L.Map.ContextMenu.BASE_CLS + '-item-disabled',
-            hideOnSelect = (hideOnSelect !== undefined) ? hideOnSelect : true;
-
-            return function (e) {
-                if (L.DomUtil.hasClass(el, disabledCls)) {
-                    return;
-
-                }
-
-                if (hideOnSelect) {
-                    me._hide();
-
-                }
-
-                if (func) {
-                    func.call(context || map, me._showLocation);
-                }
-
-                me._map.fire('contextmenu:select', {
-                    contextmenu : me,
-                    el : el
-                });
-            };
-        },
-
-        _insertElementAt : function (tagName, className, container, index) {
-            var refEl,
-            el = document.createElement(tagName);
-
-            el.className = className;
-
-            if (index !== undefined) {
-                refEl = container.children[index];
-            }
-
-            if (refEl) {
-                container.insertBefore(el, refEl);
-            } else {
-                container.appendChild(el);
-            }
-
-            return el;
-        },
-
-        _show : function (e) {
-            this._showAtPoint(e.containerPoint);
-        },
-
-        _showAtPoint : function (pt, data, state) {
-            if (this._items.length) {
-                var map = this._map,
-                layerPoint = map.containerPointToLayerPoint(pt),
-                latlng = map.layerPointToLatLng(layerPoint),
-                event = {
-                    contextmenu : this,
-                    state : state
-                },
-                state = (state !== undefined) ? state : this._activeState;
-
-                if (data) {
-                    event = L.extend(data, event);
-                }
-
-                this._showLocation = {
-                    state : state,
-                    target : (data) ? data.relatedTarget : null,
-                    latlng : latlng,
-                    layerPoint : layerPoint,
-                    containerPoint : pt
-                };
-
-                this._setPosition(pt);
-                this._changeState(state);
-                
-                if (!this._visible) {
-                    this._container.style.display = 'block';
-                    this._visible = true;
-                } else {
-                    this._setPosition(pt);
-                }
-                
-
-                this._map.fire('contextmenu.show', event);
-            }
-        },
-
-        _hide : function () {
-            if (this._visible) {
-                this.setState(this._defaultState);
-                this._visible = false;
-                this._container.style.display = 'none';
-                this._map.fire('contextmenu.hide', {
-                    contextmenu : this
-                });
-            }
-        },
-
-        _setPosition : function (pt) {
-            var mapSize = this._map.getSize(),
-            container = this._container,
-            containerSize = this._getElementSize(container),
-            anchor;
-
-            if (this._map.options.contextmenuAnchor) {
-                anchor = L.point(this._map.options.contextmenuAnchor);
-                pt = pt.add(anchor);
-            }
-
-            container._leaflet_pos = pt;
-
-            if (pt.x + containerSize.x > mapSize.x) {
-                container.style.left = 'auto';
-                container.style.right = Math.max(mapSize.x - pt.x, 0) + 'px';
-            } else {
-                container.style.left = Math.max(pt.x, 0) + 'px';
-                container.style.right = 'auto';
-            }
-
-            if (pt.y + containerSize.y > mapSize.y) {
-                container.style.top = 'auto';
-                container.style.bottom = Math.max(mapSize.y - pt.y, 0) + 'px';
-            } else {
-                container.style.top = Math.max(pt.y, 0) + 'px';
-                container.style.bottom = 'auto';
-            }
-        },
-
-        _getElementSize : function (el) {
-            var size = this._size,
-            initialDisplay = el.style.display;
-
-            if (!size || this._sizeChanged) {
-                size = {};
-
-                el.style.left = '-999999px';
-                el.style.right = 'auto';
-                el.style.display = 'block';
-
-                size.x = el.offsetWidth;
-                size.y = el.offsetHeight;
-
-                el.style.left = 'auto';
-                el.style.display = initialDisplay;
-
-                this._sizeChanged = false;
-            }
-
-            return size;
-        },
-
-        _onMouseDown : function (e) {
-            //console.log('_onMouseDown');
-            this._hide();
-        },
-
-        _onKeyDown : function (e) {
-            var key = e.keyCode;
-
-            // If ESC pressed and context menu is visible hide it
-            if (key === 27) {
-                this._hide();
-            }
-        },
-
-        _onItemMouseOver : function (e) {
-            L.DomUtil.addClass(e.target, 'over');
-        },
-
-        _onItemMouseOut : function (e) {
-            L.DomUtil.removeClass(e.target, 'over');
-        }
-    });
-
-L.Map.addInitHook('addHandler', 'contextmenu', L.Map.ContextMenu);
-L.Mixin.ContextMenu = {
-
-    // private methods
-    _initContextMenu : function () {
-        this._items = [];
-
-        this.on('contextmenu', this._showContextMenu, this);
-    },
-
-    _showContextMenu : function (e) {
-        var itemOptions,
-        pt,
-        i,
-        l;
-
-        if (this._map.contextmenu) {
-            pt = this._map.mouseEventToContainerPoint(e.originalEvent);
-
-            for (i = 0, l = this.options.contextmenuItems.length; i < l; i++) {
-                itemOptions = this.options.contextmenuItems[i];
-                this._items.push(this._map.contextmenu.insertItem(itemOptions, itemOptions.index));
-            }
-
-            this._map.once('contextmenu.hide', this._hideContextMenu, this);
-
-            this._map.contextmenu.showAt(pt, {
-                relatedTarget : this
-            },
-            this.options.contextmenuAtiveState);
-        }
-    },
-
-    _hideContextMenu : function () {
-        var i,
-        l;
-
-        for (i = 0, l = this._items.length; i < l; i++) {
-            this._map.contextmenu.removeItem(this._items[i]);
-        }
-        this._items.length = 0;
-    }
-};
-
-L.Marker.mergeOptions({
-    contextmenu : false,
-    contextmenuItems : []
-});
-
-L.Marker.addInitHook(function () {
-    if (this.options.contextmenu) {
-        this._initContextMenu();
-    }
-});
-
-L.Marker.include(L.Mixin.ContextMenu);
-
-L.Path.mergeOptions({
-    contextmenu : false,
-    contextmenuItems : []
-});
-
-L.Path.addInitHook(function () {
-    if (this.options.contextmenu) {
-        this._initContextMenu();
-    }
-});
-
-L.Path.include(L.Mixin.ContextMenu);
\ No newline at end of file
diff --git a/web/src/main/webapp/js/main-template.js b/web/src/main/webapp/js/main-template.js
index c6a5fddb7f..5f804e0afd 100644
--- a/web/src/main/webapp/js/main-template.js
+++ b/web/src/main/webapp/js/main-template.js
@@ -1,7 +1,7 @@
 global.d3 = require('d3');
 var L = require('leaflet');
+require('leaflet-contextmenu');
 require('leaflet-loading');
-require('./lib/leaflet.contextmenu.js');
 require('./lib/leaflet.elevation-0.0.4.min.js');
 require('./lib/leaflet_numbered_markers.js');
 
@@ -156,7 +156,7 @@ $(document).ready(function (e) {
                 }
                 metaVersionInfo = messages.extractMetaVersionInfo(json);
 
-                mapLayer.initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, urlParams.layer);
+                mapLayer.initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, urlParams.layer, urlParams.use_miles);
 
                 // execute query
                 initFromParams(urlParams, true);
@@ -173,7 +173,7 @@ $(document).ready(function (e) {
                     "maxLat": 90
                 };
                 nominatim.setBounds(bounds);
-                mapLayer.initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord);
+                mapLayer.initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, urlParams.layer, urlParams.use_miles);
             });
 
     $(window).resize(function () {
@@ -315,14 +315,14 @@ function checkInput() {
 }
 
 function setToStart(e) {
-    var latlng = e.target.getLatLng(),
+    var latlng = e.relatedTarget.getLatLng(),
             index = ghRequest.route.getIndexByCoord(latlng);
     ghRequest.route.move(index, 0);
     routeIfAllResolved();
 }
 
 function setToEnd(e) {
-    var latlng = e.target.getLatLng(),
+    var latlng = e.relatedTarget.getLatLng(),
             index = ghRequest.route.getIndexByCoord(latlng);
     ghRequest.route.move(index, -1);
     routeIfAllResolved();
@@ -351,7 +351,7 @@ function setIntermediateCoord(e) {
 }
 
 function deleteCoord(e) {
-    var latlng = e.target.getLatLng();
+    var latlng = e.relatedTarget.getLatLng();
     ghRequest.route.removeSingle(latlng);
     mapLayer.clearLayers();
     routeLatLng(ghRequest, false);
@@ -392,12 +392,12 @@ function setFlag(coord, index) {
         };
         var _tempItem = {
             text: translate.tr('set_start'),
+            icon: './img/marker-small-green.png',
             callback: setToStart,
-            index: 1,
-            state: 2
+            index: 1
         };
         if (toFrom === -1)
-            marker.options.contextmenuItems.push(_tempItem);// because the Mixin.ContextMenu isn't initialized
+            marker.options.contextmenuItems.push(_tempItem); // because the Mixin.ContextMenu isn't initialized
         marker.on('dragend', function (e) {
             mapLayer.clearLayers();
             // inconsistent leaflet API: event.target.getLatLng vs. mouseEvent.latlng?
@@ -545,6 +545,24 @@ function routeLatLng(request, doQuery) {
         var geoJsons = [];
         var firstHeader;
 
+        // Create buttons to toggle between SI and imperial units.
+        var createUnitsChooserButtonClickHandler = function (useMiles) {
+            return function () {
+                mapLayer.updateScale(useMiles);
+                ghRequest.useMiles = useMiles;
+                resolveAll();
+                routeLatLng(ghRequest);
+            };
+        };
+
+        if(json.paths.length > 0 && json.paths[0].points_order) {
+            mapLayer.clearLayers();
+            var po = json.paths[0].points_order;
+            for (var i = 0; i < po.length; i++) {
+                setFlag(ghRequest.route.getIndex(po[i]), i);
+            }
+        }
+
         for (var pathIndex = 0; pathIndex < json.paths.length; pathIndex++) {
             var tabHeader = $("<li>").append((pathIndex + 1) + "<img class='alt_route_img' src='img/alt_route.png'/>");
             if (pathIndex === 0)
@@ -579,15 +597,6 @@ function routeLatLng(request, doQuery) {
             }
             routeInfo.append(translate.tr("route_info", [tmpDist, tmpTime]));
 
-            //create buttons to toggle between si and imperial units
-            var createUnitsChooserButtonClickHandler = function (useMiles) {
-                return function () {
-                    mapLayer.updateScale(useMiles);
-                    ghRequest.useMiles = useMiles;
-                    resolveAll();
-                    routeLatLng(ghRequest);
-                };
-            };
             var kmButton = $("<button class='plain_text_button " + (request.useMiles ? "gray" : "") + "'>");
             kmButton.text(translate.tr2("km_abbr"));
             kmButton.click(createUnitsChooserButtonClickHandler(false));
diff --git a/web/src/main/webapp/js/main.js b/web/src/main/webapp/js/main.js
index 83529a79a1..1d2dcf90b9 100644
--- a/web/src/main/webapp/js/main.js
+++ b/web/src/main/webapp/js/main.js
@@ -1,61 +1,62 @@
 (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
-!function(){function n(n){return n&&(n.ownerDocument||n.document||n).documentElement}function t(n){return n&&(n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView)}function e(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function r(n){return null===n?NaN:+n}function i(n){return!isNaN(n)}function u(n){return{left:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var u=r+i>>>1;n(t[u],e)<0?r=u+1:i=u}return r},right:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var u=r+i>>>1;n(t[u],e)>0?i=u:r=u+1}return r}}}function o(n){return n.length}function a(n){for(var t=1;n*t%1;)t*=10;return t}function l(n,t){for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}function c(){this._=Object.create(null)}function f(n){return(n+="")===Mo||n[0]===xo?xo+n:n}function s(n){return(n+="")[0]===xo?n.slice(1):n}function h(n){return f(n)in this._}function p(n){return(n=f(n))in this._&&delete this._[n]}function g(){var n=[];for(var t in this._)n.push(s(t));return n}function v(){var n=0;for(var t in this._)++n;return n}function d(){for(var n in this._)return!1;return!0}function y(){this._=Object.create(null)}function m(n){return n}function M(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function x(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=bo.length;e<r;++e){var i=bo[e]+t;if(i in n)return i}}function b(){}function _(){}function w(n){function t(){for(var t,r=e,i=-1,u=r.length;++i<u;)(t=r[i].on)&&t.apply(this,arguments);return n}var e=[],r=new c;return t.on=function(t,i){var u,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,u=e.indexOf(o)).concat(e.slice(u+1)),r.remove(t)),i&&e.push(r.set(t,{on:i})),n)},t}function S(){ao.event.preventDefault()}function k(){for(var n,t=ao.event;n=t.sourceEvent;)t=n;return t}function N(n){for(var t=new _,e=0,r=arguments.length;++e<r;)t[arguments[e]]=w(t);return t.of=function(e,r){return function(i){try{var u=i.sourceEvent=ao.event;i.target=n,ao.event=i,t[i.type].apply(e,r)}finally{ao.event=u}}},t}function E(n){return wo(n,Eo),n}function A(n){return"function"==typeof n?n:function(){return So(n,this)}}function C(n){return"function"==typeof n?n:function(){return ko(n,this)}}function z(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function i(){this.setAttribute(n,t)}function u(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=ao.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?u:i}function L(n){return n.trim().replace(/\s+/g," ")}function q(n){return new RegExp("(?:^|\\s+)"+ao.requote(n)+"(?:\\s+|$)","g")}function T(n){return(n+"").trim().split(/^|\s+/)}function R(n,t){function e(){for(var e=-1;++e<i;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<i;)n[e](this,r)}n=T(n).map(D);var i=n.length;return"function"==typeof t?r:e}function D(n){var t=q(n);return function(e,r){if(i=e.classList)return r?i.add(n):i.remove(n);var i=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||e.setAttribute("class",L(i+" "+n))):e.setAttribute("class",L(i.replace(t," ")))}}function P(n,t,e){function r(){this.style.removeProperty(n)}function i(){this.style.setProperty(n,t,e)}function u(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?u:i}function U(n,t){function e(){delete this[n]}function r(){this[n]=t}function i(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?i:r}function j(n){function t(){var t=this.ownerDocument,e=this.namespaceURI;return e===Ao&&t.documentElement.namespaceURI===Ao?t.createElement(n):t.createElementNS(e,n)}function e(){return this.ownerDocument.createElementNS(n.space,n.local)}return"function"==typeof n?n:(n=ao.ns.qualify(n)).local?e:t}function F(){var n=this.parentNode;n&&n.removeChild(this)}function H(n){return{__data__:n}}function O(n){return function(){return No(this,n)}}function I(n){return arguments.length||(n=e),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function Y(n,t){for(var e=0,r=n.length;e<r;e++)for(var i,u=n[e],o=0,a=u.length;o<a;o++)(i=u[o])&&t(i,o,e);return n}function Z(n){return wo(n,zo),n}function V(n){var t,e;return function(r,i,u){var o,a=n[u].update,l=a.length;for(u!=e&&(e=u,t=0),i>=t&&(t=i+1);!(o=a[t])&&++t<l;);return o}}function X(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function i(){var i=l(t,co(arguments));r.call(this),this.addEventListener(n,this[o]=i,i.$=e),i._=t}function u(){var t,e=new RegExp("^__on([^.]+)"+ao.requote(n)+"$");for(var r in this)if(t=r.match(e)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),l=$;a>0&&(n=n.slice(0,a));var c=Lo.get(n);return c&&(n=c,l=B),a?t?i:r:t?b:u}function $(n,t){return function(e){var r=ao.event;ao.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{ao.event=r}}}function B(n,t){var e=$(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function W(e){var r=".dragsuppress-"+ ++To,i="click"+r,u=ao.select(t(e)).on("touchmove"+r,S).on("dragstart"+r,S).on("selectstart"+r,S);if(null==qo&&(qo=!("onselectstart"in e)&&x(e.style,"userSelect")),qo){var o=n(e).style,a=o[qo];o[qo]="none"}return function(n){if(u.on(r,null),qo&&(o[qo]=a),n){var t=function(){u.on(i,null)};u.on(i,function(){S(),t()},!0),setTimeout(t,0)}}}function J(n,e){e.changedTouches&&(e=e.changedTouches[0]);var r=n.ownerSVGElement||n;if(r.createSVGPoint){var i=r.createSVGPoint();if(Ro<0){var u=t(n);if(u.scrollX||u.scrollY){r=ao.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=r[0][0].getScreenCTM();Ro=!(o.f||o.e),r.remove()}}return Ro?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(n.getScreenCTM().inverse()),[i.x,i.y]}var a=n.getBoundingClientRect();return[e.clientX-a.left-n.clientLeft,e.clientY-a.top-n.clientTop]}function G(){return ao.event.changedTouches[0].identifier}function K(n){return n>0?1:n<0?-1:0}function Q(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function nn(n){return n>1?0:n<-1?Uo:Math.acos(n)}function tn(n){return n>1?Ho:n<-1?-Ho:Math.asin(n)}function en(n){return((n=Math.exp(n))-1/n)/2}function rn(n){return((n=Math.exp(n))+1/n)/2}function un(n){return((n=Math.exp(2*n))-1)/(n+1)}function on(n){return(n=Math.sin(n/2))*n}function an(){}function ln(n,t,e){return this instanceof ln?(this.h=+n,this.s=+t,void(this.l=+e)):arguments.length<2?n instanceof ln?new ln(n.h,n.s,n.l):_n(""+n,wn,ln):new ln(n,t,e)}function cn(n,t,e){function r(n){return n>360?n-=360:n<0&&(n+=360),n<60?u+(o-u)*n/60:n<180?o:n<240?u+(o-u)*(240-n)/60:u}function i(n){return Math.round(255*r(n))}var u,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:t<0?0:t>1?1:t,e=e<0?0:e>1?1:e,o=e<=.5?e*(1+t):e+t-e*t,u=2*e-o,new mn(i(n+120),i(n),i(n-120))}function fn(n,t,e){return this instanceof fn?(this.h=+n,this.c=+t,void(this.l=+e)):arguments.length<2?n instanceof fn?new fn(n.h,n.c,n.l):n instanceof hn?gn(n.l,n.a,n.b):gn((n=Sn((n=ao.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new fn(n,t,e)}function sn(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new hn(e,Math.cos(n*=Oo)*t,Math.sin(n)*t)}function hn(n,t,e){return this instanceof hn?(this.l=+n,this.a=+t,void(this.b=+e)):arguments.length<2?n instanceof hn?new hn(n.l,n.a,n.b):n instanceof fn?sn(n.h,n.c,n.l):Sn((n=mn(n)).r,n.g,n.b):new hn(n,t,e)}function pn(n,t,e){var r=(n+16)/116,i=r+t/500,u=r-e/200;return i=vn(i)*Ko,r=vn(r)*Qo,u=vn(u)*na,new mn(yn(3.2404542*i-1.5371385*r-.4985314*u),yn(-.969266*i+1.8760108*r+.041556*u),yn(.0556434*i-.2040259*r+1.0572252*u))}function gn(n,t,e){return n>0?new fn(Math.atan2(e,t)*Io,Math.sqrt(t*t+e*e),n):new fn(NaN,NaN,n)}function vn(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function dn(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function yn(n){return Math.round(255*(n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function mn(n,t,e){return this instanceof mn?(this.r=~~n,this.g=~~t,void(this.b=~~e)):arguments.length<2?n instanceof mn?new mn(n.r,n.g,n.b):_n(""+n,mn,cn):new mn(n,t,e)}function Mn(n){return new mn(n>>16,n>>8&255,255&n)}function xn(n){return Mn(n)+""}function bn(n){return n<16?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function _n(n,t,e){var r,i,u,o=0,a=0,l=0;if(r=/([a-z]+)\((.*)\)/.exec(n=n.toLowerCase()))switch(i=r[2].split(","),r[1]){case"hsl":return e(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Nn(i[0]),Nn(i[1]),Nn(i[2]))}return(u=ra.get(n))?t(u.r,u.g,u.b):(null==n||"#"!==n.charAt(0)||isNaN(u=parseInt(n.slice(1),16))||(4===n.length?(o=(3840&u)>>4,o=o>>4|o,a=240&u,a=a>>4|a,l=15&u,l=l<<4|l):7===n.length&&(o=(16711680&u)>>16,a=(65280&u)>>8,l=255&u)),t(o,a,l))}function wn(n,t,e){var r,i,u=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-u,l=(o+u)/2;return a?(i=l<.5?a/(o+u):a/(2-o-u),r=n==o?(t-e)/a+(t<e?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=NaN,i=l>0&&l<1?0:r),new ln(r,i,l)}function Sn(n,t,e){n=kn(n),t=kn(t),e=kn(e);var r=dn((.4124564*n+.3575761*t+.1804375*e)/Ko),i=dn((.2126729*n+.7151522*t+.072175*e)/Qo),u=dn((.0193339*n+.119192*t+.9503041*e)/na);return hn(116*i-16,500*(r-i),200*(i-u))}function kn(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Nn(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function En(n){return"function"==typeof n?n:function(){return n}}function An(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Cn(t,e,n,r)}}function Cn(n,t,e,r){function i(){var n,t=l.status;if(!t&&Ln(l)||t>=200&&t<300||304===t){try{n=e.call(u,l)}catch(n){return void o.error.call(u,n)}o.load.call(u,n)}else o.error.call(u,l)}var u={},o=ao.dispatch("beforesend","progress","load","error"),a={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(n)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=i:l.onreadystatechange=function(){l.readyState>3&&i()},l.onprogress=function(n){var t=ao.event;ao.event=n;try{o.progress.call(u,l)}finally{ao.event=t}},u.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",u)},u.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",u):t},u.responseType=function(n){return arguments.length?(c=n,u):c},u.response=function(n){return e=n,u},["get","post"].forEach(function(n){u[n]=function(){return u.send.apply(u,[n].concat(co(arguments)))}}),u.send=function(e,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),l.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),l.setRequestHeader)for(var f in a)l.setRequestHeader(f,a[f]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=i&&u.on("error",i).on("load",function(n){i(null,n)}),o.beforesend.call(u,l),l.send(null==r?null:r),u},u.abort=function(){return l.abort(),u},ao.rebind(u,o,"on"),null==r?u:u.get(zn(r))}function zn(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function Ln(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function qn(n,t,e){var r=arguments.length;r<2&&(t=0),r<3&&(e=Date.now());var i=e+t,u={c:n,t:i,n:null};return ua?ua.n=u:ia=u,ua=u,oa||(aa=clearTimeout(aa),oa=1,la(Tn)),u}function Tn(){var n=Rn(),t=Dn()-n;t>24?(isFinite(t)&&(clearTimeout(aa),aa=setTimeout(Tn,t)),oa=0):(oa=1,la(Tn))}function Rn(){for(var n=Date.now(),t=ia;t;)n>=t.t&&t.c(n-t.t)&&(t.c=null),t=t.n;return n}function Dn(){for(var n,t=ia,e=1/0;t;)t.c?(t.t<e&&(e=t.t),t=(n=t).n):t=n?n.n=t.n:ia=t.n;return ua=n,e}function Pn(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Un(n,t){var e=Math.pow(10,3*mo(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function jn(n){var t=n.decimal,e=n.thousands,r=n.grouping,i=n.currency,u=r&&e?function(n,t){for(var i=n.length,u=[],o=0,a=r[0],l=0;i>0&&a>0&&(l+a+1>t&&(a=Math.max(1,t-l)),u.push(n.substring(i-=a,i+a)),!((l+=a+1)>t));)a=r[o=(o+1)%r.length];return u.reverse().join(e)}:m;return function(n){var e=fa.exec(n),r=e[1]||" ",o=e[2]||">",a=e[3]||"-",l=e[4]||"",c=e[5],f=+e[6],s=e[7],h=e[8],p=e[9],g=1,v="",d="",y=!1,m=!0;switch(h&&(h=+h.substring(1)),(c||"0"===r&&"="===o)&&(c=r="0",o="="),p){case"n":s=!0,p="g";break;case"%":g=100,d="%",p="f";break;case"p":g=100,d="%",p="r";break;case"b":case"o":case"x":case"X":"#"===l&&(v="0"+p.toLowerCase());case"c":m=!1;case"d":y=!0,h=0;break;case"s":g=-1,p="r"}"$"===l&&(v=i[0],d=i[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):"e"!=p&&"f"!=p||(h=Math.max(0,Math.min(20,h)))),p=sa.get(p)||Fn;var M=c&&s;return function(n){var e=d;if(y&&n%1)return"";var i=n<0||0===n&&1/n<0?(n=-n,"-"):"-"===a?"":a;if(g<0){var l=ao.formatPrefix(n,h);n=l.scale(n),e=l.symbol+d}else n*=g;n=p(n,h);var x,b,_=n.lastIndexOf(".");if(_<0){var w=m?n.lastIndexOf("e"):-1;w<0?(x=n,b=""):(x=n.substring(0,w),b=n.substring(w))}else x=n.substring(0,_),b=t+n.substring(_+1);!c&&s&&(x=u(x,1/0));var S=v.length+x.length+b.length+(M?0:i.length),k=S<f?new Array(S=f-S+1).join(r):"";return M&&(x=u(k+x,k.length?f-b.length:1/0)),i+=v,n=x+b,("<"===o?i+n+k:">"===o?k+i+n:"^"===o?k.substring(0,S>>=1)+i+n+k.substring(S):i+(M?n:k+n))+e}}}function Fn(n){return n+""}function Hn(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function On(n,t,e){function r(t){var e=n(t),r=u(e,1);return t-e<r-t?e:r}function i(e){return t(e=n(new pa(e-1)),1),e}function u(n,e){return t(n=new pa(+n),e),n}function o(n,r,u){var o=i(n),a=[];if(u>1)for(;o<r;)e(o)%u||a.push(new Date(+o)),t(o,1);else for(;o<r;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{pa=Hn;var r=new Hn;return r._=n,o(r,t,e)}finally{pa=Date}}n.floor=n,n.round=r,n.ceil=i,n.offset=u,n.range=o;var l=n.utc=In(n);return l.floor=l,l.round=In(r),l.ceil=In(i),l.offset=In(u),l.range=a,n}function In(n){return function(t,e){try{pa=Hn;var r=new Hn;return r._=t,n(r,e)._}finally{pa=Date}}}function Yn(n){function t(n){function t(t){for(var e,i,u,o=[],a=-1,l=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.slice(l,a)),null!=(i=va[e=n.charAt(++a)])&&(e=n.charAt(++a)),(u=A[e])&&(e=u(t,null==i?"e"===e?" ":"0":i)),o.push(e),l=a+1);return o.push(n.slice(l,a)),o.join("")}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=e(r,n,t,0);if(i!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var u=null!=r.Z&&pa!==Hn,o=new(u?Hn:pa);return"j"in r?o.setFullYear(r.y,0,r.j):"W"in r||"U"in r?("w"in r||(r.w="W"in r?1:0),o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),u?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var i,u,o,a=0,l=t.length,c=e.length;a<l;){if(r>=c)return-1;if(i=t.charCodeAt(a++),37===i){if(o=t.charAt(a++),u=C[o in va?t.charAt(a++):o],!u||(r=u(n,e,r))<0)return-1}else if(i!=e.charCodeAt(r++))return-1}return r}function r(n,t,e){_.lastIndex=0;var r=_.exec(t.slice(e));return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1}function i(n,t,e){x.lastIndex=0;var r=x.exec(t.slice(e));return r?(n.w=b.get(r[0].toLowerCase()),e+r[0].length):-1}function u(n,t,e){N.lastIndex=0;var r=N.exec(t.slice(e));return r?(n.m=E.get(r[0].toLowerCase()),e+r[0].length):-1}function o(n,t,e){S.lastIndex=0;var r=S.exec(t.slice(e));return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1}function a(n,t,r){return e(n,A.c.toString(),t,r)}function l(n,t,r){return e(n,A.x.toString(),t,r)}function c(n,t,r){return e(n,A.X.toString(),t,r)}function f(n,t,e){var r=M.get(t.slice(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}var s=n.dateTime,h=n.date,p=n.time,g=n.periods,v=n.days,d=n.shortDays,y=n.months,m=n.shortMonths;t.utc=function(n){function e(n){try{pa=Hn;var t=new pa;return t._=n,r(t)}finally{pa=Date}}var r=t(n);return e.parse=function(n){try{pa=Hn;var t=r.parse(n);return t&&t._}finally{pa=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ct;var M=ao.map(),x=Vn(v),b=Xn(v),_=Vn(d),w=Xn(d),S=Vn(y),k=Xn(y),N=Vn(m),E=Xn(m);g.forEach(function(n,t){M.set(n.toLowerCase(),t)});var A={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return m[n.getMonth()]},B:function(n){return y[n.getMonth()]},c:t(s),d:function(n,t){return Zn(n.getDate(),t,2)},e:function(n,t){return Zn(n.getDate(),t,2)},H:function(n,t){return Zn(n.getHours(),t,2)},I:function(n,t){return Zn(n.getHours()%12||12,t,2)},j:function(n,t){return Zn(1+ha.dayOfYear(n),t,3)},L:function(n,t){return Zn(n.getMilliseconds(),t,3)},m:function(n,t){return Zn(n.getMonth()+1,t,2)},M:function(n,t){return Zn(n.getMinutes(),t,2)},p:function(n){return g[+(n.getHours()>=12)]},S:function(n,t){return Zn(n.getSeconds(),t,2)},U:function(n,t){return Zn(ha.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Zn(ha.mondayOfYear(n),t,2)},x:t(h),X:t(p),y:function(n,t){return Zn(n.getFullYear()%100,t,2)},Y:function(n,t){return Zn(n.getFullYear()%1e4,t,4)},Z:at,"%":function(){return"%"}},C={a:r,A:i,b:u,B:o,c:a,d:tt,e:tt,H:rt,I:rt,j:et,L:ot,m:nt,M:it,p:f,S:ut,U:Bn,w:$n,W:Wn,x:l,X:c,y:Gn,Y:Jn,Z:Kn,"%":lt};return t}function Zn(n,t,e){var r=n<0?"-":"",i=(r?-n:n)+"",u=i.length;return r+(u<e?new Array(e-u+1).join(t)+i:i)}function Vn(n){return new RegExp("^(?:"+n.map(ao.requote).join("|")+")","i")}function Xn(n){for(var t=new c,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function $n(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Bn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e));return r?(n.U=+r[0],e+r[0].length):-1}function Wn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e));return r?(n.W=+r[0],e+r[0].length):-1}function Jn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Gn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.y=Qn(+r[0]),e+r[0].length):-1}function Kn(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1}function Qn(n){return n+(n>68?1900:2e3)}function nt(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function tt(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function et(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function rt(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function it(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function ut(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ot(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function at(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=mo(t)/60|0,i=mo(t)%60;return e+Zn(r,"0",2)+Zn(i,"0",2)}function lt(n,t,e){ya.lastIndex=0;var r=ya.exec(t.slice(e,e+1));return r?e+r[0].length:-1}function ct(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ft(){}function st(n,t,e){var r=e.s=n+t,i=r-n,u=r-i;e.t=n-u+(t-i)}function ht(n,t){n&&ba.hasOwnProperty(n.type)&&ba[n.type](n,t)}function pt(n,t,e){var r,i=-1,u=n.length-e;for(t.lineStart();++i<u;)r=n[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function gt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)pt(n[e],t,1);t.polygonEnd()}function vt(){function n(n,t){n*=Oo,t=t*Oo/2+Uo/4;var e=n-r,o=e>=0?1:-1,a=o*e,l=Math.cos(t),c=Math.sin(t),f=u*c,s=i*l+f*Math.cos(a),h=f*o*Math.sin(a);wa.add(Math.atan2(h,s)),r=n,i=l,u=c}var t,e,r,i,u;Sa.point=function(o,a){Sa.point=n,r=(t=o)*Oo,i=Math.cos(a=(e=a)*Oo/2+Uo/4),u=Math.sin(a)},Sa.lineEnd=function(){n(t,e)}}function dt(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function yt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function mt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Mt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function xt(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function bt(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function _t(n){return[Math.atan2(n[1],n[0]),tn(n[2])]}function wt(n,t){return mo(n[0]-t[0])<Do&&mo(n[1]-t[1])<Do}function St(n,t){n*=Oo;var e=Math.cos(t*=Oo);kt(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function kt(n,t,e){++ka,Ea+=(n-Ea)/ka,Aa+=(t-Aa)/ka,Ca+=(e-Ca)/ka}function Nt(){function n(n,i){n*=Oo;var u=Math.cos(i*=Oo),o=u*Math.cos(n),a=u*Math.sin(n),l=Math.sin(i),c=Math.atan2(Math.sqrt((c=e*l-r*a)*c+(c=r*o-t*l)*c+(c=t*a-e*o)*c),t*o+e*a+r*l);Na+=c,za+=c*(t+(t=o)),La+=c*(e+(e=a)),qa+=c*(r+(r=l)),kt(t,e,r)}var t,e,r;Pa.point=function(i,u){i*=Oo;var o=Math.cos(u*=Oo);t=o*Math.cos(i),e=o*Math.sin(i),r=Math.sin(u),Pa.point=n,kt(t,e,r)}}function Et(){Pa.point=St}function At(){function n(n,t){n*=Oo;var e=Math.cos(t*=Oo),o=e*Math.cos(n),a=e*Math.sin(n),l=Math.sin(t),c=i*l-u*a,f=u*o-r*l,s=r*a-i*o,h=Math.sqrt(c*c+f*f+s*s),p=r*o+i*a+u*l,g=h&&-nn(p)/h,v=Math.atan2(h,p);Ta+=g*c,Ra+=g*f,Da+=g*s,Na+=v,za+=v*(r+(r=o)),La+=v*(i+(i=a)),qa+=v*(u+(u=l)),kt(r,i,u)}var t,e,r,i,u;Pa.point=function(o,a){t=o,e=a,Pa.point=n,o*=Oo;var l=Math.cos(a*=Oo);r=l*Math.cos(o),i=l*Math.sin(o),u=Math.sin(a),kt(r,i,u)},Pa.lineEnd=function(){n(t,e),Pa.lineEnd=Et,Pa.point=St}}function Ct(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function zt(){return!0}function Lt(n,t,e,r,i){var u=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(wt(e,r)){i.lineStart();for(var a=0;a<t;++a)i.point((e=n[a])[0],e[1]);return void i.lineEnd()}var l=new Tt(e,n,null,!0),c=new Tt(e,null,l,!1);l.o=c,u.push(l),o.push(c),l=new Tt(r,n,null,!1),c=new Tt(r,null,l,!0),l.o=c,u.push(l),o.push(c)}}),o.sort(t),qt(u),qt(o),u.length){for(var a=0,l=e,c=o.length;a<c;++a)o[a].e=l=!l;for(var f,s,h=u[0];;){for(var p=h,g=!0;p.v;)if((p=p.n)===h)return;f=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(g)for(var a=0,c=f.length;a<c;++a)i.point((s=f[a])[0],s[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(g){f=p.p.z;for(var a=f.length-1;a>=0;--a)i.point((s=f[a])[0],s[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,f=p.z,g=!g}while(!p.v);i.lineEnd()}}}function qt(n){if(t=n.length){for(var t,e,r=0,i=n[0];++r<t;)i.n=e=n[r],e.p=i,i=e;i.n=e=n[0],e.p=i}}function Tt(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Rt(n,t,e,r){return function(i,u){function o(t,e){var r=i(t,e);n(t=r[0],e=r[1])&&u.point(t,e)}function a(n,t){var e=i(n,t);d.point(e[0],e[1])}function l(){m.point=a,d.lineStart()}function c(){m.point=o,d.lineEnd()}function f(n,t){v.push([n,t]);var e=i(n,t);x.point(e[0],e[1])}function s(){x.lineStart(),v=[]}function h(){f(v[0][0],v[0][1]),x.lineEnd();var n,t=x.clean(),e=M.buffer(),r=e.length;if(v.pop(),g.push(v),v=null,r)if(1&t){n=e[0];var i,r=n.length-1,o=-1;if(r>0){for(b||(u.polygonStart(),b=!0),u.lineStart();++o<r;)u.point((i=n[o])[0],i[1]);u.lineEnd()}}else r>1&&2&t&&e.push(e.pop().concat(e.shift())),p.push(e.filter(Dt))}var p,g,v,d=t(u),y=i.invert(r[0],r[1]),m={point:o,lineStart:l,lineEnd:c,polygonStart:function(){m.point=f,m.lineStart=s,m.lineEnd=h,p=[],g=[]},polygonEnd:function(){m.point=o,m.lineStart=l,m.lineEnd=c,p=ao.merge(p);var n=Ot(y,g);p.length?(b||(u.polygonStart(),b=!0),Lt(p,Ut,n,e,u)):n&&(b||(u.polygonStart(),b=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),b&&(u.polygonEnd(),b=!1),p=g=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}},M=Pt(),x=t(M),b=!1;return m}}function Dt(n){return n.length>1}function Pt(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:b,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Ut(n,t){return((n=n.x)[0]<0?n[1]-Ho-Do:Ho-n[1])-((t=t.x)[0]<0?t[1]-Ho-Do:Ho-t[1])}function jt(n){var t,e=NaN,r=NaN,i=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(u,o){var a=u>0?Uo:-Uo,l=mo(u-e);mo(l-Uo)<Do?(n.point(e,r=(r+o)/2>0?Ho:-Ho),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(u,r),t=0):i!==a&&l>=Uo&&(mo(e-i)<Do&&(e-=i*Do),mo(u-a)<Do&&(u-=a*Do),r=Ft(e,r,u,o),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=u,r=o),i=a},lineEnd:function(){n.lineEnd(),e=r=NaN},clean:function(){return 2-t}}}function Ft(n,t,e,r){var i,u,o=Math.sin(n-e);return mo(o)>Do?Math.atan((Math.sin(t)*(u=Math.cos(r))*Math.sin(e)-Math.sin(r)*(i=Math.cos(t))*Math.sin(n))/(i*u*o)):(t+r)/2}function Ht(n,t,e,r){var i;if(null==n)i=e*Ho,r.point(-Uo,i),r.point(0,i),r.point(Uo,i),r.point(Uo,0),r.point(Uo,-i),r.point(0,-i),r.point(-Uo,-i),r.point(-Uo,0),r.point(-Uo,i);else if(mo(n[0]-t[0])>Do){var u=n[0]<t[0]?Uo:-Uo;i=e*u/2,r.point(-u,i),r.point(0,i),r.point(u,i)}else r.point(t[0],t[1])}function Ot(n,t){var e=n[0],r=n[1],i=[Math.sin(e),-Math.cos(e),0],u=0,o=0;wa.reset();for(var a=0,l=t.length;a<l;++a){var c=t[a],f=c.length;if(f)for(var s=c[0],h=s[0],p=s[1]/2+Uo/4,g=Math.sin(p),v=Math.cos(p),d=1;;){d===f&&(d=0),n=c[d];var y=n[0],m=n[1]/2+Uo/4,M=Math.sin(m),x=Math.cos(m),b=y-h,_=b>=0?1:-1,w=_*b,S=w>Uo,k=g*M;if(wa.add(Math.atan2(k*_*Math.sin(w),v*x+k*Math.cos(w))),u+=S?b+_*jo:b,S^h>=e^y>=e){var N=mt(dt(s),dt(n));bt(N);var E=mt(i,N);bt(E);var A=(S^b>=0?-1:1)*tn(E[2]);(r>A||r===A&&(N[0]||N[1]))&&(o+=S^b>=0?1:-1)}if(!d++)break;h=y,g=M,v=x,s=n}}return(u<-Do||u<Do&&wa<-Do)^1&o}function It(n){function t(n,t){return Math.cos(n)*Math.cos(t)>u}function e(n){var e,u,l,c,f;return{lineStart:function(){c=l=!1,f=1},point:function(s,h){var p,g=[s,h],v=t(s,h),d=o?v?0:i(s,h):v?i(s+(s<0?Uo:-Uo),h):0;if(!e&&(c=l=v)&&n.lineStart(),v!==l&&(p=r(e,g),(wt(e,p)||wt(g,p))&&(g[0]+=Do,g[1]+=Do,v=t(g[0],g[1]))),v!==l)f=0,v?(n.lineStart(),p=r(g,e),n.point(p[0],p[1])):(p=r(e,g),n.point(p[0],p[1]),n.lineEnd()),e=p;else if(a&&e&&o^v){var y;d&u||!(y=r(g,e,!0))||(f=0,o?(n.lineStart(),n.point(y[0][0],y[0][1]),n.point(y[1][0],y[1][1]),n.lineEnd()):(n.point(y[1][0],y[1][1]),n.lineEnd(),n.lineStart(),n.point(y[0][0],y[0][1])))}!v||e&&wt(e,g)||n.point(g[0],g[1]),e=g,l=v,u=d},lineEnd:function(){l&&n.lineEnd(),e=null},clean:function(){return f|(c&&l)<<1}}}function r(n,t,e){var r=dt(n),i=dt(t),o=[1,0,0],a=mt(r,i),l=yt(a,a),c=a[0],f=l-c*c;if(!f)return!e&&n;var s=u*l/f,h=-u*c/f,p=mt(o,a),g=xt(o,s),v=xt(a,h);Mt(g,v);var d=p,y=yt(g,d),m=yt(d,d),M=y*y-m*(yt(g,g)-1);if(!(M<0)){var x=Math.sqrt(M),b=xt(d,(-y-x)/m);if(Mt(b,g),b=_t(b),!e)return b;var _,w=n[0],S=t[0],k=n[1],N=t[1];S<w&&(_=w,w=S,S=_);var E=S-w,A=mo(E-Uo)<Do,C=A||E<Do;if(!A&&N<k&&(_=k,k=N,N=_),C?A?k+N>0^b[1]<(mo(b[0]-w)<Do?k:N):k<=b[1]&&b[1]<=N:E>Uo^(w<=b[0]&&b[0]<=S)){var z=xt(d,(-y+x)/m);return Mt(z,g),[b,_t(z)]}}}function i(t,e){var r=o?n:Uo-n,i=0;return t<-r?i|=1:t>r&&(i|=2),e<-r?i|=4:e>r&&(i|=8),i}var u=Math.cos(n),o=u>0,a=mo(u)>Do,l=ve(n,6*Oo);return Rt(t,e,l,o?[0,-n]:[-Uo,n-Uo])}function Yt(n,t,e,r){return function(i){var u,o=i.a,a=i.b,l=o.x,c=o.y,f=a.x,s=a.y,h=0,p=1,g=f-l,v=s-c;if(u=n-l,g||!(u>0)){if(u/=g,g<0){if(u<h)return;u<p&&(p=u)}else if(g>0){if(u>p)return;u>h&&(h=u)}if(u=e-l,g||!(u<0)){if(u/=g,g<0){if(u>p)return;u>h&&(h=u)}else if(g>0){if(u<h)return;u<p&&(p=u)}if(u=t-c,v||!(u>0)){if(u/=v,v<0){if(u<h)return;u<p&&(p=u)}else if(v>0){if(u>p)return;u>h&&(h=u)}if(u=r-c,v||!(u<0)){if(u/=v,v<0){if(u>p)return;u>h&&(h=u)}else if(v>0){if(u<h)return;u<p&&(p=u)}return h>0&&(i.a={x:l+h*g,y:c+h*v}),p<1&&(i.b={x:l+p*g,y:c+p*v}),i}}}}}}function Zt(n,t,e,r){function i(r,i){return mo(r[0]-n)<Do?i>0?0:3:mo(r[0]-e)<Do?i>0?2:1:mo(r[1]-t)<Do?i>0?1:0:i>0?3:2}function u(n,t){return o(n.x,t.x)}function o(n,t){var e=i(n,1),r=i(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function l(n){for(var t=0,e=d.length,r=n[1],i=0;i<e;++i)for(var u,o=1,a=d[i],l=a.length,c=a[0];o<l;++o)u=a[o],c[1]<=r?u[1]>r&&Q(c,u,n)>0&&++t:u[1]<=r&&Q(c,u,n)<0&&--t,c=u;return 0!==t}function c(u,a,l,c){var f=0,s=0;if(null==u||(f=i(u,l))!==(s=i(a,l))||o(u,a)<0^l>0){do c.point(0===f||3===f?n:e,f>1?r:t);while((f=(f+l+4)%4)!==s)}else c.point(a[0],a[1])}function f(i,u){return n<=i&&i<=e&&t<=u&&u<=r}function s(n,t){f(n,t)&&a.point(n,t)}function h(){C.point=g,d&&d.push(y=[]),S=!0,w=!1,b=_=NaN}function p(){v&&(g(m,M),x&&w&&E.rejoin(),v.push(E.buffer())),C.point=s,w&&a.lineEnd()}function g(n,t){n=Math.max(-ja,Math.min(ja,n)),t=Math.max(-ja,Math.min(ja,t));var e=f(n,t);if(d&&y.push([n,t]),S)m=n,M=t,x=e,S=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&w)a.point(n,t);else{var r={a:{x:b,y:_},b:{x:n,y:t}};A(r)?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1)}b=n,_=t,w=e}var v,d,y,m,M,x,b,_,w,S,k,N=a,E=Pt(),A=Yt(n,t,e,r),C={point:s,lineStart:h,lineEnd:p,polygonStart:function(){a=E,v=[],d=[],k=!0},polygonEnd:function(){a=N,v=ao.merge(v);var t=l([n,r]),e=k&&t,i=v.length;(e||i)&&(a.polygonStart(),e&&(a.lineStart(),c(null,null,1,a),a.lineEnd()),i&&Lt(v,u,t,c,a),a.polygonEnd()),v=d=y=null}};return C}}function Vt(n){var t=0,e=Uo/3,r=ae(n),i=r(t,e);return i.parallels=function(n){return arguments.length?r(t=n[0]*Uo/180,e=n[1]*Uo/180):[t/Uo*180,e/Uo*180]},i}function Xt(n,t){function e(n,t){var e=Math.sqrt(u-2*i*Math.sin(t))/i;return[e*Math.sin(n*=i),o-e*Math.cos(n)]}var r=Math.sin(n),i=(r+Math.sin(t))/2,u=1+r*(2*i-r),o=Math.sqrt(u)/i;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/i,tn((u-(n*n+e*e)*i*i)/(2*i))]},e}function $t(){function n(n,t){Ha+=i*n-r*t,r=n,i=t}var t,e,r,i;Va.point=function(u,o){Va.point=n,t=r=u,e=i=o},Va.lineEnd=function(){n(t,e)}}function Bt(n,t){n<Oa&&(Oa=n),n>Ya&&(Ya=n),t<Ia&&(Ia=t),t>Za&&(Za=t)}function Wt(){function n(n,t){o.push("M",n,",",t,u)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function i(){o.push("Z")}var u=Jt(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return u=Jt(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Jt(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Gt(n,t){Ea+=n,Aa+=t,++Ca}function Kt(){function n(n,r){var i=n-t,u=r-e,o=Math.sqrt(i*i+u*u);za+=o*(t+n)/2,La+=o*(e+r)/2,qa+=o,Gt(t=n,e=r)}var t,e;$a.point=function(r,i){$a.point=n,Gt(t=r,e=i)}}function Qt(){$a.point=Gt}function ne(){function n(n,t){var e=n-r,u=t-i,o=Math.sqrt(e*e+u*u);za+=o*(r+n)/2,La+=o*(i+t)/2,qa+=o,o=i*n-r*t,Ta+=o*(r+n),Ra+=o*(i+t),Da+=3*o,Gt(r=n,i=t)}var t,e,r,i;$a.point=function(u,o){$a.point=n,Gt(t=r=u,e=i=o)},$a.lineEnd=function(){n(t,e)}}function te(n){function t(t,e){n.moveTo(t+o,e),n.arc(t,e,o,0,jo)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function i(){a.point=t}function u(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:i,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=i,a.point=t},pointRadius:function(n){return o=n,a},result:b};return a}function ee(n){function t(n){return(a?r:e)(n)}function e(t){return ue(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){M=NaN,S.point=u,t.lineStart()}function u(e,r){var u=dt([e,r]),o=n(e,r);i(M,x,m,b,_,w,M=o[0],x=o[1],m=e,b=u[0],_=u[1],w=u[2],a,t),t.point(M,x)}function o(){S.point=e,t.lineEnd()}function l(){
+!function(){function n(n){return n&&(n.ownerDocument||n.document||n).documentElement}function t(n){return n&&(n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView)}function e(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function r(n){return null===n?NaN:+n}function i(n){return!isNaN(n)}function u(n){return{left:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var u=r+i>>>1;n(t[u],e)<0?r=u+1:i=u}return r},right:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);r<i;){var u=r+i>>>1;n(t[u],e)>0?i=u:r=u+1}return r}}}function o(n){return n.length}function a(n){for(var t=1;n*t%1;)t*=10;return t}function l(n,t){for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}function c(){this._=Object.create(null)}function f(n){return(n+="")===Mo||n[0]===xo?xo+n:n}function s(n){return(n+="")[0]===xo?n.slice(1):n}function h(n){return f(n)in this._}function p(n){return(n=f(n))in this._&&delete this._[n]}function g(){var n=[];for(var t in this._)n.push(s(t));return n}function v(){var n=0;for(var t in this._)++n;return n}function d(){for(var n in this._)return!1;return!0}function y(){this._=Object.create(null)}function m(n){return n}function M(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function x(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=bo.length;e<r;++e){var i=bo[e]+t;if(i in n)return i}}function b(){}function _(){}function w(n){function t(){for(var t,r=e,i=-1,u=r.length;++i<u;)(t=r[i].on)&&t.apply(this,arguments);return n}var e=[],r=new c;return t.on=function(t,i){var u,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,u=e.indexOf(o)).concat(e.slice(u+1)),r.remove(t)),i&&e.push(r.set(t,{on:i})),n)},t}function S(){ao.event.preventDefault()}function k(){for(var n,t=ao.event;n=t.sourceEvent;)t=n;return t}function N(n){for(var t=new _,e=0,r=arguments.length;++e<r;)t[arguments[e]]=w(t);return t.of=function(e,r){return function(i){try{var u=i.sourceEvent=ao.event;i.target=n,ao.event=i,t[i.type].apply(e,r)}finally{ao.event=u}}},t}function E(n){return wo(n,Eo),n}function A(n){return"function"==typeof n?n:function(){return So(n,this)}}function C(n){return"function"==typeof n?n:function(){return ko(n,this)}}function z(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function i(){this.setAttribute(n,t)}function u(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=ao.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?u:i}function L(n){return n.trim().replace(/\s+/g," ")}function q(n){return new RegExp("(?:^|\\s+)"+ao.requote(n)+"(?:\\s+|$)","g")}function T(n){return(n+"").trim().split(/^|\s+/)}function R(n,t){function e(){for(var e=-1;++e<i;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<i;)n[e](this,r)}n=T(n).map(D);var i=n.length;return"function"==typeof t?r:e}function D(n){var t=q(n);return function(e,r){if(i=e.classList)return r?i.add(n):i.remove(n);var i=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||e.setAttribute("class",L(i+" "+n))):e.setAttribute("class",L(i.replace(t," ")))}}function P(n,t,e){function r(){this.style.removeProperty(n)}function i(){this.style.setProperty(n,t,e)}function u(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?u:i}function U(n,t){function e(){delete this[n]}function r(){this[n]=t}function i(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?i:r}function j(n){function t(){var t=this.ownerDocument,e=this.namespaceURI;return e===Ao&&t.documentElement.namespaceURI===Ao?t.createElement(n):t.createElementNS(e,n)}function e(){return this.ownerDocument.createElementNS(n.space,n.local)}return"function"==typeof n?n:(n=ao.ns.qualify(n)).local?e:t}function F(){var n=this.parentNode;n&&n.removeChild(this)}function H(n){return{__data__:n}}function O(n){return function(){return No(this,n)}}function I(n){return arguments.length||(n=e),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function Y(n,t){for(var e=0,r=n.length;e<r;e++)for(var i,u=n[e],o=0,a=u.length;o<a;o++)(i=u[o])&&t(i,o,e);return n}function Z(n){return wo(n,zo),n}function V(n){var t,e;return function(r,i,u){var o,a=n[u].update,l=a.length;for(u!=e&&(e=u,t=0),i>=t&&(t=i+1);!(o=a[t])&&++t<l;);return o}}function X(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function i(){var i=l(t,co(arguments));r.call(this),this.addEventListener(n,this[o]=i,i.$=e),i._=t}function u(){var t,e=new RegExp("^__on([^.]+)"+ao.requote(n)+"$");for(var r in this)if(t=r.match(e)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),l=$;a>0&&(n=n.slice(0,a));var c=Lo.get(n);return c&&(n=c,l=B),a?t?i:r:t?b:u}function $(n,t){return function(e){var r=ao.event;ao.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{ao.event=r}}}function B(n,t){var e=$(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function W(e){var r=".dragsuppress-"+ ++To,i="click"+r,u=ao.select(t(e)).on("touchmove"+r,S).on("dragstart"+r,S).on("selectstart"+r,S);if(null==qo&&(qo=!("onselectstart"in e)&&x(e.style,"userSelect")),qo){var o=n(e).style,a=o[qo];o[qo]="none"}return function(n){if(u.on(r,null),qo&&(o[qo]=a),n){var t=function(){u.on(i,null)};u.on(i,function(){S(),t()},!0),setTimeout(t,0)}}}function J(n,e){e.changedTouches&&(e=e.changedTouches[0]);var r=n.ownerSVGElement||n;if(r.createSVGPoint){var i=r.createSVGPoint();if(Ro<0){var u=t(n);if(u.scrollX||u.scrollY){r=ao.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=r[0][0].getScreenCTM();Ro=!(o.f||o.e),r.remove()}}return Ro?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(n.getScreenCTM().inverse()),[i.x,i.y]}var a=n.getBoundingClientRect();return[e.clientX-a.left-n.clientLeft,e.clientY-a.top-n.clientTop]}function G(){return ao.event.changedTouches[0].identifier}function K(n){return n>0?1:n<0?-1:0}function Q(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function nn(n){return n>1?0:n<-1?Uo:Math.acos(n)}function tn(n){return n>1?Ho:n<-1?-Ho:Math.asin(n)}function en(n){return((n=Math.exp(n))-1/n)/2}function rn(n){return((n=Math.exp(n))+1/n)/2}function un(n){return((n=Math.exp(2*n))-1)/(n+1)}function on(n){return(n=Math.sin(n/2))*n}function an(){}function ln(n,t,e){return this instanceof ln?(this.h=+n,this.s=+t,void(this.l=+e)):arguments.length<2?n instanceof ln?new ln(n.h,n.s,n.l):_n(""+n,wn,ln):new ln(n,t,e)}function cn(n,t,e){function r(n){return n>360?n-=360:n<0&&(n+=360),n<60?u+(o-u)*n/60:n<180?o:n<240?u+(o-u)*(240-n)/60:u}function i(n){return Math.round(255*r(n))}var u,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:t<0?0:t>1?1:t,e=e<0?0:e>1?1:e,o=e<=.5?e*(1+t):e+t-e*t,u=2*e-o,new mn(i(n+120),i(n),i(n-120))}function fn(n,t,e){return this instanceof fn?(this.h=+n,this.c=+t,void(this.l=+e)):arguments.length<2?n instanceof fn?new fn(n.h,n.c,n.l):n instanceof hn?gn(n.l,n.a,n.b):gn((n=Sn((n=ao.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new fn(n,t,e)}function sn(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new hn(e,Math.cos(n*=Oo)*t,Math.sin(n)*t)}function hn(n,t,e){return this instanceof hn?(this.l=+n,this.a=+t,void(this.b=+e)):arguments.length<2?n instanceof hn?new hn(n.l,n.a,n.b):n instanceof fn?sn(n.h,n.c,n.l):Sn((n=mn(n)).r,n.g,n.b):new hn(n,t,e)}function pn(n,t,e){var r=(n+16)/116,i=r+t/500,u=r-e/200;return i=vn(i)*Ko,r=vn(r)*Qo,u=vn(u)*na,new mn(yn(3.2404542*i-1.5371385*r-.4985314*u),yn(-.969266*i+1.8760108*r+.041556*u),yn(.0556434*i-.2040259*r+1.0572252*u))}function gn(n,t,e){return n>0?new fn(Math.atan2(e,t)*Io,Math.sqrt(t*t+e*e),n):new fn(NaN,NaN,n)}function vn(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function dn(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function yn(n){return Math.round(255*(n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function mn(n,t,e){return this instanceof mn?(this.r=~~n,this.g=~~t,void(this.b=~~e)):arguments.length<2?n instanceof mn?new mn(n.r,n.g,n.b):_n(""+n,mn,cn):new mn(n,t,e)}function Mn(n){return new mn(n>>16,n>>8&255,255&n)}function xn(n){return Mn(n)+""}function bn(n){return n<16?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function _n(n,t,e){var r,i,u,o=0,a=0,l=0;if(r=/([a-z]+)\((.*)\)/.exec(n=n.toLowerCase()))switch(i=r[2].split(","),r[1]){case"hsl":return e(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Nn(i[0]),Nn(i[1]),Nn(i[2]))}return(u=ra.get(n))?t(u.r,u.g,u.b):(null==n||"#"!==n.charAt(0)||isNaN(u=parseInt(n.slice(1),16))||(4===n.length?(o=(3840&u)>>4,o|=o>>4,a=240&u,a|=a>>4,l=15&u,l|=l<<4):7===n.length&&(o=(16711680&u)>>16,a=(65280&u)>>8,l=255&u)),t(o,a,l))}function wn(n,t,e){var r,i,u=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-u,l=(o+u)/2;return a?(i=l<.5?a/(o+u):a/(2-o-u),r=n==o?(t-e)/a+(t<e?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=NaN,i=l>0&&l<1?0:r),new ln(r,i,l)}function Sn(n,t,e){n=kn(n),t=kn(t),e=kn(e);var r=dn((.4124564*n+.3575761*t+.1804375*e)/Ko),i=dn((.2126729*n+.7151522*t+.072175*e)/Qo),u=dn((.0193339*n+.119192*t+.9503041*e)/na);return hn(116*i-16,500*(r-i),200*(i-u))}function kn(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Nn(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function En(n){return"function"==typeof n?n:function(){return n}}function An(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Cn(t,e,n,r)}}function Cn(n,t,e,r){function i(){var n,t=l.status;if(!t&&Ln(l)||t>=200&&t<300||304===t){try{n=e.call(u,l)}catch(n){return void o.error.call(u,n)}o.load.call(u,n)}else o.error.call(u,l)}var u={},o=ao.dispatch("beforesend","progress","load","error"),a={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(n)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=i:l.onreadystatechange=function(){l.readyState>3&&i()},l.onprogress=function(n){var t=ao.event;ao.event=n;try{o.progress.call(u,l)}finally{ao.event=t}},u.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",u)},u.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",u):t},u.responseType=function(n){return arguments.length?(c=n,u):c},u.response=function(n){return e=n,u},["get","post"].forEach(function(n){u[n]=function(){return u.send.apply(u,[n].concat(co(arguments)))}}),u.send=function(e,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),l.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),l.setRequestHeader)for(var f in a)l.setRequestHeader(f,a[f]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=i&&u.on("error",i).on("load",function(n){i(null,n)}),o.beforesend.call(u,l),l.send(null==r?null:r),u},u.abort=function(){return l.abort(),u},ao.rebind(u,o,"on"),null==r?u:u.get(zn(r))}function zn(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function Ln(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function qn(n,t,e){var r=arguments.length;r<2&&(t=0),r<3&&(e=Date.now());var i=e+t,u={c:n,t:i,n:null};return ua?ua.n=u:ia=u,ua=u,oa||(aa=clearTimeout(aa),oa=1,la(Tn)),u}function Tn(){var n=Rn(),t=Dn()-n;t>24?(isFinite(t)&&(clearTimeout(aa),aa=setTimeout(Tn,t)),oa=0):(oa=1,la(Tn))}function Rn(){for(var n=Date.now(),t=ia;t;)n>=t.t&&t.c(n-t.t)&&(t.c=null),t=t.n;return n}function Dn(){for(var n,t=ia,e=1/0;t;)t.c?(t.t<e&&(e=t.t),t=(n=t).n):t=n?n.n=t.n:ia=t.n;return ua=n,e}function Pn(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Un(n,t){var e=Math.pow(10,3*mo(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function jn(n){var t=n.decimal,e=n.thousands,r=n.grouping,i=n.currency,u=r&&e?function(n,t){for(var i=n.length,u=[],o=0,a=r[0],l=0;i>0&&a>0&&(l+a+1>t&&(a=Math.max(1,t-l)),u.push(n.substring(i-=a,i+a)),!((l+=a+1)>t));)a=r[o=(o+1)%r.length];return u.reverse().join(e)}:m;return function(n){var e=fa.exec(n),r=e[1]||" ",o=e[2]||">",a=e[3]||"-",l=e[4]||"",c=e[5],f=+e[6],s=e[7],h=e[8],p=e[9],g=1,v="",d="",y=!1,m=!0;switch(h&&(h=+h.substring(1)),(c||"0"===r&&"="===o)&&(c=r="0",o="="),p){case"n":s=!0,p="g";break;case"%":g=100,d="%",p="f";break;case"p":g=100,d="%",p="r";break;case"b":case"o":case"x":case"X":"#"===l&&(v="0"+p.toLowerCase());case"c":m=!1;case"d":y=!0,h=0;break;case"s":g=-1,p="r"}"$"===l&&(v=i[0],d=i[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):"e"!=p&&"f"!=p||(h=Math.max(0,Math.min(20,h)))),p=sa.get(p)||Fn;var M=c&&s;return function(n){var e=d;if(y&&n%1)return"";var i=n<0||0===n&&1/n<0?(n=-n,"-"):"-"===a?"":a;if(g<0){var l=ao.formatPrefix(n,h);n=l.scale(n),e=l.symbol+d}else n*=g;n=p(n,h);var x,b,_=n.lastIndexOf(".");if(_<0){var w=m?n.lastIndexOf("e"):-1;w<0?(x=n,b=""):(x=n.substring(0,w),b=n.substring(w))}else x=n.substring(0,_),b=t+n.substring(_+1);!c&&s&&(x=u(x,1/0));var S=v.length+x.length+b.length+(M?0:i.length),k=S<f?new Array(S=f-S+1).join(r):"";return M&&(x=u(k+x,k.length?f-b.length:1/0)),i+=v,n=x+b,("<"===o?i+n+k:">"===o?k+i+n:"^"===o?k.substring(0,S>>=1)+i+n+k.substring(S):i+(M?n:k+n))+e}}}function Fn(n){return n+""}function Hn(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function On(n,t,e){function r(t){var e=n(t),r=u(e,1);return t-e<r-t?e:r}function i(e){return t(e=n(new pa(e-1)),1),e}function u(n,e){return t(n=new pa(+n),e),n}function o(n,r,u){var o=i(n),a=[];if(u>1)for(;o<r;)e(o)%u||a.push(new Date(+o)),t(o,1);else for(;o<r;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{pa=Hn;var r=new Hn;return r._=n,o(r,t,e)}finally{pa=Date}}n.floor=n,n.round=r,n.ceil=i,n.offset=u,n.range=o;var l=n.utc=In(n);return l.floor=l,l.round=In(r),l.ceil=In(i),l.offset=In(u),l.range=a,n}function In(n){return function(t,e){try{pa=Hn;var r=new Hn;return r._=t,n(r,e)._}finally{pa=Date}}}function Yn(n){function t(n){function t(t){for(var e,i,u,o=[],a=-1,l=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.slice(l,a)),null!=(i=va[e=n.charAt(++a)])&&(e=n.charAt(++a)),(u=A[e])&&(e=u(t,null==i?"e"===e?" ":"0":i)),o.push(e),l=a+1);return o.push(n.slice(l,a)),o.join("")}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=e(r,n,t,0);if(i!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var u=null!=r.Z&&pa!==Hn,o=new(u?Hn:pa);return"j"in r?o.setFullYear(r.y,0,r.j):"W"in r||"U"in r?("w"in r||(r.w="W"in r?1:0),o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),u?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var i,u,o,a=0,l=t.length,c=e.length;a<l;){if(r>=c)return-1;if(i=t.charCodeAt(a++),37===i){if(o=t.charAt(a++),u=C[o in va?t.charAt(a++):o],!u||(r=u(n,e,r))<0)return-1}else if(i!=e.charCodeAt(r++))return-1}return r}function r(n,t,e){_.lastIndex=0;var r=_.exec(t.slice(e));return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1}function i(n,t,e){x.lastIndex=0;var r=x.exec(t.slice(e));return r?(n.w=b.get(r[0].toLowerCase()),e+r[0].length):-1}function u(n,t,e){N.lastIndex=0;var r=N.exec(t.slice(e));return r?(n.m=E.get(r[0].toLowerCase()),e+r[0].length):-1}function o(n,t,e){S.lastIndex=0;var r=S.exec(t.slice(e));return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1}function a(n,t,r){return e(n,A.c.toString(),t,r)}function l(n,t,r){return e(n,A.x.toString(),t,r)}function c(n,t,r){return e(n,A.X.toString(),t,r)}function f(n,t,e){var r=M.get(t.slice(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}var s=n.dateTime,h=n.date,p=n.time,g=n.periods,v=n.days,d=n.shortDays,y=n.months,m=n.shortMonths;t.utc=function(n){function e(n){try{pa=Hn;var t=new pa;return t._=n,r(t)}finally{pa=Date}}var r=t(n);return e.parse=function(n){try{pa=Hn;var t=r.parse(n);return t&&t._}finally{pa=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ct;var M=ao.map(),x=Vn(v),b=Xn(v),_=Vn(d),w=Xn(d),S=Vn(y),k=Xn(y),N=Vn(m),E=Xn(m);g.forEach(function(n,t){M.set(n.toLowerCase(),t)});var A={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return m[n.getMonth()]},B:function(n){return y[n.getMonth()]},c:t(s),d:function(n,t){return Zn(n.getDate(),t,2)},e:function(n,t){return Zn(n.getDate(),t,2)},H:function(n,t){return Zn(n.getHours(),t,2)},I:function(n,t){return Zn(n.getHours()%12||12,t,2)},j:function(n,t){return Zn(1+ha.dayOfYear(n),t,3)},L:function(n,t){return Zn(n.getMilliseconds(),t,3)},m:function(n,t){return Zn(n.getMonth()+1,t,2)},M:function(n,t){return Zn(n.getMinutes(),t,2)},p:function(n){return g[+(n.getHours()>=12)]},S:function(n,t){return Zn(n.getSeconds(),t,2)},U:function(n,t){return Zn(ha.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Zn(ha.mondayOfYear(n),t,2)},x:t(h),X:t(p),y:function(n,t){return Zn(n.getFullYear()%100,t,2)},Y:function(n,t){return Zn(n.getFullYear()%1e4,t,4)},Z:at,"%":function(){return"%"}},C={a:r,A:i,b:u,B:o,c:a,d:tt,e:tt,H:rt,I:rt,j:et,L:ot,m:nt,M:it,p:f,S:ut,U:Bn,w:$n,W:Wn,x:l,X:c,y:Gn,Y:Jn,Z:Kn,"%":lt};return t}function Zn(n,t,e){var r=n<0?"-":"",i=(r?-n:n)+"",u=i.length;return r+(u<e?new Array(e-u+1).join(t)+i:i)}function Vn(n){return new RegExp("^(?:"+n.map(ao.requote).join("|")+")","i")}function Xn(n){for(var t=new c,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function $n(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Bn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e));return r?(n.U=+r[0],e+r[0].length):-1}function Wn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e));return r?(n.W=+r[0],e+r[0].length):-1}function Jn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Gn(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.y=Qn(+r[0]),e+r[0].length):-1}function Kn(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1}function Qn(n){return n+(n>68?1900:2e3)}function nt(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function tt(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function et(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function rt(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function it(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function ut(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ot(n,t,e){da.lastIndex=0;var r=da.exec(t.slice(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function at(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=mo(t)/60|0,i=mo(t)%60;return e+Zn(r,"0",2)+Zn(i,"0",2)}function lt(n,t,e){ya.lastIndex=0;var r=ya.exec(t.slice(e,e+1));return r?e+r[0].length:-1}function ct(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ft(){}function st(n,t,e){var r=e.s=n+t,i=r-n,u=r-i;e.t=n-u+(t-i)}function ht(n,t){n&&ba.hasOwnProperty(n.type)&&ba[n.type](n,t)}function pt(n,t,e){var r,i=-1,u=n.length-e;for(t.lineStart();++i<u;)r=n[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function gt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)pt(n[e],t,1);t.polygonEnd()}function vt(){function n(n,t){n*=Oo,t=t*Oo/2+Uo/4;var e=n-r,o=e>=0?1:-1,a=o*e,l=Math.cos(t),c=Math.sin(t),f=u*c,s=i*l+f*Math.cos(a),h=f*o*Math.sin(a);wa.add(Math.atan2(h,s)),r=n,i=l,u=c}var t,e,r,i,u;Sa.point=function(o,a){Sa.point=n,r=(t=o)*Oo,i=Math.cos(a=(e=a)*Oo/2+Uo/4),u=Math.sin(a)},Sa.lineEnd=function(){n(t,e)}}function dt(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function yt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function mt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Mt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function xt(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function bt(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function _t(n){return[Math.atan2(n[1],n[0]),tn(n[2])]}function wt(n,t){return mo(n[0]-t[0])<Do&&mo(n[1]-t[1])<Do}function St(n,t){n*=Oo;var e=Math.cos(t*=Oo);kt(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function kt(n,t,e){++ka,Ea+=(n-Ea)/ka,Aa+=(t-Aa)/ka,Ca+=(e-Ca)/ka}function Nt(){function n(n,i){n*=Oo;var u=Math.cos(i*=Oo),o=u*Math.cos(n),a=u*Math.sin(n),l=Math.sin(i),c=Math.atan2(Math.sqrt((c=e*l-r*a)*c+(c=r*o-t*l)*c+(c=t*a-e*o)*c),t*o+e*a+r*l);Na+=c,za+=c*(t+(t=o)),La+=c*(e+(e=a)),qa+=c*(r+(r=l)),kt(t,e,r)}var t,e,r;Pa.point=function(i,u){i*=Oo;var o=Math.cos(u*=Oo);t=o*Math.cos(i),e=o*Math.sin(i),r=Math.sin(u),Pa.point=n,kt(t,e,r)}}function Et(){Pa.point=St}function At(){function n(n,t){n*=Oo;var e=Math.cos(t*=Oo),o=e*Math.cos(n),a=e*Math.sin(n),l=Math.sin(t),c=i*l-u*a,f=u*o-r*l,s=r*a-i*o,h=Math.sqrt(c*c+f*f+s*s),p=r*o+i*a+u*l,g=h&&-nn(p)/h,v=Math.atan2(h,p);Ta+=g*c,Ra+=g*f,Da+=g*s,Na+=v,za+=v*(r+(r=o)),La+=v*(i+(i=a)),qa+=v*(u+(u=l)),kt(r,i,u)}var t,e,r,i,u;Pa.point=function(o,a){t=o,e=a,Pa.point=n,o*=Oo;var l=Math.cos(a*=Oo);r=l*Math.cos(o),i=l*Math.sin(o),u=Math.sin(a),kt(r,i,u)},Pa.lineEnd=function(){n(t,e),Pa.lineEnd=Et,Pa.point=St}}function Ct(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function zt(){return!0}function Lt(n,t,e,r,i){var u=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(wt(e,r)){i.lineStart();for(var a=0;a<t;++a)i.point((e=n[a])[0],e[1]);return void i.lineEnd()}var l=new Tt(e,n,null,!0),c=new Tt(e,null,l,!1);l.o=c,u.push(l),o.push(c),l=new Tt(r,n,null,!1),c=new Tt(r,null,l,!0),l.o=c,u.push(l),o.push(c)}}),o.sort(t),qt(u),qt(o),u.length){for(var a=0,l=e,c=o.length;a<c;++a)o[a].e=l=!l;for(var f,s,h=u[0];;){for(var p=h,g=!0;p.v;)if((p=p.n)===h)return;f=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(g)for(var a=0,c=f.length;a<c;++a)i.point((s=f[a])[0],s[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(g){f=p.p.z;for(var a=f.length-1;a>=0;--a)i.point((s=f[a])[0],s[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,f=p.z,g=!g}while(!p.v);i.lineEnd()}}}function qt(n){if(t=n.length){for(var t,e,r=0,i=n[0];++r<t;)i.n=e=n[r],e.p=i,i=e;i.n=e=n[0],e.p=i}}function Tt(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Rt(n,t,e,r){return function(i,u){function o(t,e){var r=i(t,e);n(t=r[0],e=r[1])&&u.point(t,e)}function a(n,t){var e=i(n,t);d.point(e[0],e[1])}function l(){m.point=a,d.lineStart()}function c(){m.point=o,d.lineEnd()}function f(n,t){v.push([n,t]);var e=i(n,t);x.point(e[0],e[1])}function s(){x.lineStart(),v=[]}function h(){f(v[0][0],v[0][1]),x.lineEnd();var n,t=x.clean(),e=M.buffer(),r=e.length;if(v.pop(),g.push(v),v=null,r)if(1&t){n=e[0];var i,r=n.length-1,o=-1;if(r>0){for(b||(u.polygonStart(),b=!0),u.lineStart();++o<r;)u.point((i=n[o])[0],i[1]);u.lineEnd()}}else r>1&&2&t&&e.push(e.pop().concat(e.shift())),p.push(e.filter(Dt))}var p,g,v,d=t(u),y=i.invert(r[0],r[1]),m={point:o,lineStart:l,lineEnd:c,polygonStart:function(){m.point=f,m.lineStart=s,m.lineEnd=h,p=[],g=[]},polygonEnd:function(){m.point=o,m.lineStart=l,m.lineEnd=c,p=ao.merge(p);var n=Ot(y,g);p.length?(b||(u.polygonStart(),b=!0),Lt(p,Ut,n,e,u)):n&&(b||(u.polygonStart(),b=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),b&&(u.polygonEnd(),b=!1),p=g=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}},M=Pt(),x=t(M),b=!1;return m}}function Dt(n){return n.length>1}function Pt(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:b,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Ut(n,t){return((n=n.x)[0]<0?n[1]-Ho-Do:Ho-n[1])-((t=t.x)[0]<0?t[1]-Ho-Do:Ho-t[1])}function jt(n){var t,e=NaN,r=NaN,i=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(u,o){var a=u>0?Uo:-Uo,l=mo(u-e);mo(l-Uo)<Do?(n.point(e,r=(r+o)/2>0?Ho:-Ho),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(u,r),t=0):i!==a&&l>=Uo&&(mo(e-i)<Do&&(e-=i*Do),mo(u-a)<Do&&(u-=a*Do),r=Ft(e,r,u,o),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=u,r=o),i=a},lineEnd:function(){n.lineEnd(),e=r=NaN},clean:function(){return 2-t}}}function Ft(n,t,e,r){var i,u,o=Math.sin(n-e);return mo(o)>Do?Math.atan((Math.sin(t)*(u=Math.cos(r))*Math.sin(e)-Math.sin(r)*(i=Math.cos(t))*Math.sin(n))/(i*u*o)):(t+r)/2}function Ht(n,t,e,r){var i;if(null==n)i=e*Ho,r.point(-Uo,i),r.point(0,i),r.point(Uo,i),r.point(Uo,0),r.point(Uo,-i),r.point(0,-i),r.point(-Uo,-i),r.point(-Uo,0),r.point(-Uo,i);else if(mo(n[0]-t[0])>Do){var u=n[0]<t[0]?Uo:-Uo;i=e*u/2,r.point(-u,i),r.point(0,i),r.point(u,i)}else r.point(t[0],t[1])}function Ot(n,t){var e=n[0],r=n[1],i=[Math.sin(e),-Math.cos(e),0],u=0,o=0;wa.reset();for(var a=0,l=t.length;a<l;++a){var c=t[a],f=c.length;if(f)for(var s=c[0],h=s[0],p=s[1]/2+Uo/4,g=Math.sin(p),v=Math.cos(p),d=1;;){d===f&&(d=0),n=c[d];var y=n[0],m=n[1]/2+Uo/4,M=Math.sin(m),x=Math.cos(m),b=y-h,_=b>=0?1:-1,w=_*b,S=w>Uo,k=g*M;if(wa.add(Math.atan2(k*_*Math.sin(w),v*x+k*Math.cos(w))),u+=S?b+_*jo:b,S^h>=e^y>=e){var N=mt(dt(s),dt(n));bt(N);var E=mt(i,N);bt(E);var A=(S^b>=0?-1:1)*tn(E[2]);(r>A||r===A&&(N[0]||N[1]))&&(o+=S^b>=0?1:-1)}if(!d++)break;h=y,g=M,v=x,s=n}}return(u<-Do||u<Do&&wa<-Do)^1&o}function It(n){function t(n,t){return Math.cos(n)*Math.cos(t)>u}function e(n){var e,u,l,c,f;return{lineStart:function(){c=l=!1,f=1},point:function(s,h){var p,g=[s,h],v=t(s,h),d=o?v?0:i(s,h):v?i(s+(s<0?Uo:-Uo),h):0;if(!e&&(c=l=v)&&n.lineStart(),v!==l&&(p=r(e,g),(wt(e,p)||wt(g,p))&&(g[0]+=Do,g[1]+=Do,v=t(g[0],g[1]))),v!==l)f=0,v?(n.lineStart(),p=r(g,e),n.point(p[0],p[1])):(p=r(e,g),n.point(p[0],p[1]),n.lineEnd()),e=p;else if(a&&e&&o^v){var y;d&u||!(y=r(g,e,!0))||(f=0,o?(n.lineStart(),n.point(y[0][0],y[0][1]),n.point(y[1][0],y[1][1]),n.lineEnd()):(n.point(y[1][0],y[1][1]),n.lineEnd(),n.lineStart(),n.point(y[0][0],y[0][1])))}!v||e&&wt(e,g)||n.point(g[0],g[1]),e=g,l=v,u=d},lineEnd:function(){l&&n.lineEnd(),e=null},clean:function(){return f|(c&&l)<<1}}}function r(n,t,e){var r=dt(n),i=dt(t),o=[1,0,0],a=mt(r,i),l=yt(a,a),c=a[0],f=l-c*c;if(!f)return!e&&n;var s=u*l/f,h=-u*c/f,p=mt(o,a),g=xt(o,s),v=xt(a,h);Mt(g,v);var d=p,y=yt(g,d),m=yt(d,d),M=y*y-m*(yt(g,g)-1);if(!(M<0)){var x=Math.sqrt(M),b=xt(d,(-y-x)/m);if(Mt(b,g),b=_t(b),!e)return b;var _,w=n[0],S=t[0],k=n[1],N=t[1];S<w&&(_=w,w=S,S=_);var E=S-w,A=mo(E-Uo)<Do,C=A||E<Do;if(!A&&N<k&&(_=k,k=N,N=_),C?A?k+N>0^b[1]<(mo(b[0]-w)<Do?k:N):k<=b[1]&&b[1]<=N:E>Uo^(w<=b[0]&&b[0]<=S)){var z=xt(d,(-y+x)/m);return Mt(z,g),[b,_t(z)]}}}function i(t,e){var r=o?n:Uo-n,i=0;return t<-r?i|=1:t>r&&(i|=2),e<-r?i|=4:e>r&&(i|=8),i}var u=Math.cos(n),o=u>0,a=mo(u)>Do,l=ve(n,6*Oo);return Rt(t,e,l,o?[0,-n]:[-Uo,n-Uo])}function Yt(n,t,e,r){return function(i){var u,o=i.a,a=i.b,l=o.x,c=o.y,f=a.x,s=a.y,h=0,p=1,g=f-l,v=s-c;if(u=n-l,g||!(u>0)){if(u/=g,g<0){if(u<h)return;u<p&&(p=u)}else if(g>0){if(u>p)return;u>h&&(h=u)}if(u=e-l,g||!(u<0)){if(u/=g,g<0){if(u>p)return;u>h&&(h=u)}else if(g>0){if(u<h)return;u<p&&(p=u)}if(u=t-c,v||!(u>0)){if(u/=v,v<0){if(u<h)return;u<p&&(p=u)}else if(v>0){if(u>p)return;u>h&&(h=u)}if(u=r-c,v||!(u<0)){if(u/=v,v<0){if(u>p)return;u>h&&(h=u)}else if(v>0){if(u<h)return;u<p&&(p=u)}return h>0&&(i.a={x:l+h*g,y:c+h*v}),p<1&&(i.b={x:l+p*g,y:c+p*v}),i}}}}}}function Zt(n,t,e,r){function i(r,i){return mo(r[0]-n)<Do?i>0?0:3:mo(r[0]-e)<Do?i>0?2:1:mo(r[1]-t)<Do?i>0?1:0:i>0?3:2}function u(n,t){return o(n.x,t.x)}function o(n,t){var e=i(n,1),r=i(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function l(n){for(var t=0,e=d.length,r=n[1],i=0;i<e;++i)for(var u,o=1,a=d[i],l=a.length,c=a[0];o<l;++o)u=a[o],c[1]<=r?u[1]>r&&Q(c,u,n)>0&&++t:u[1]<=r&&Q(c,u,n)<0&&--t,c=u;return 0!==t}function c(u,a,l,c){var f=0,s=0;if(null==u||(f=i(u,l))!==(s=i(a,l))||o(u,a)<0^l>0){do c.point(0===f||3===f?n:e,f>1?r:t);while((f=(f+l+4)%4)!==s)}else c.point(a[0],a[1])}function f(i,u){return n<=i&&i<=e&&t<=u&&u<=r}function s(n,t){f(n,t)&&a.point(n,t)}function h(){C.point=g,d&&d.push(y=[]),S=!0,w=!1,b=_=NaN}function p(){v&&(g(m,M),x&&w&&E.rejoin(),v.push(E.buffer())),C.point=s,w&&a.lineEnd()}function g(n,t){n=Math.max(-ja,Math.min(ja,n)),t=Math.max(-ja,Math.min(ja,t));var e=f(n,t);if(d&&y.push([n,t]),S)m=n,M=t,x=e,S=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&w)a.point(n,t);else{var r={a:{x:b,y:_},b:{x:n,y:t}};A(r)?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1)}b=n,_=t,w=e}var v,d,y,m,M,x,b,_,w,S,k,N=a,E=Pt(),A=Yt(n,t,e,r),C={point:s,lineStart:h,lineEnd:p,polygonStart:function(){a=E,v=[],d=[],k=!0},polygonEnd:function(){a=N,v=ao.merge(v);var t=l([n,r]),e=k&&t,i=v.length;(e||i)&&(a.polygonStart(),e&&(a.lineStart(),c(null,null,1,a),a.lineEnd()),i&&Lt(v,u,t,c,a),a.polygonEnd()),v=d=y=null}};return C}}function Vt(n){var t=0,e=Uo/3,r=ae(n),i=r(t,e);return i.parallels=function(n){return arguments.length?r(t=n[0]*Uo/180,e=n[1]*Uo/180):[t/Uo*180,e/Uo*180]},i}function Xt(n,t){function e(n,t){var e=Math.sqrt(u-2*i*Math.sin(t))/i;return[e*Math.sin(n*=i),o-e*Math.cos(n)]}var r=Math.sin(n),i=(r+Math.sin(t))/2,u=1+r*(2*i-r),o=Math.sqrt(u)/i;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/i,tn((u-(n*n+e*e)*i*i)/(2*i))]},e}function $t(){function n(n,t){Ha+=i*n-r*t,r=n,i=t}var t,e,r,i;Va.point=function(u,o){Va.point=n,t=r=u,e=i=o},Va.lineEnd=function(){n(t,e)}}function Bt(n,t){n<Oa&&(Oa=n),n>Ya&&(Ya=n),t<Ia&&(Ia=t),t>Za&&(Za=t)}function Wt(){function n(n,t){o.push("M",n,",",t,u)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function i(){o.push("Z")}var u=Jt(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return u=Jt(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Jt(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Gt(n,t){Ea+=n,Aa+=t,++Ca}function Kt(){function n(n,r){var i=n-t,u=r-e,o=Math.sqrt(i*i+u*u);za+=o*(t+n)/2,La+=o*(e+r)/2,qa+=o,Gt(t=n,e=r)}var t,e;$a.point=function(r,i){$a.point=n,Gt(t=r,e=i)}}function Qt(){$a.point=Gt}function ne(){function n(n,t){var e=n-r,u=t-i,o=Math.sqrt(e*e+u*u);za+=o*(r+n)/2,La+=o*(i+t)/2,qa+=o,o=i*n-r*t,Ta+=o*(r+n),Ra+=o*(i+t),Da+=3*o,Gt(r=n,i=t)}var t,e,r,i;$a.point=function(u,o){$a.point=n,Gt(t=r=u,e=i=o)},$a.lineEnd=function(){n(t,e)}}function te(n){function t(t,e){n.moveTo(t+o,e),n.arc(t,e,o,0,jo)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function i(){a.point=t}function u(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:i,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=i,a.point=t},pointRadius:function(n){return o=n,a},result:b};return a}function ee(n){function t(n){return(a?r:e)(n)}function e(t){return ue(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){M=NaN,S.point=u,t.lineStart()}function u(e,r){var u=dt([e,r]),o=n(e,r);i(M,x,m,b,_,w,M=o[0],x=o[1],m=e,b=u[0],_=u[1],w=u[2],a,t),t.point(M,x)}function o(){S.point=e,t.lineEnd()}function l(){
 r(),S.point=c,S.lineEnd=f}function c(n,t){u(s=n,h=t),p=M,g=x,v=b,d=_,y=w,S.point=u}function f(){i(M,x,m,b,_,w,p,g,s,v,d,y,a,t),S.lineEnd=o,o()}var s,h,p,g,v,d,y,m,M,x,b,_,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=l},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function i(t,e,r,a,l,c,f,s,h,p,g,v,d,y){var m=f-t,M=s-e,x=m*m+M*M;if(x>4*u&&d--){var b=a+p,_=l+g,w=c+v,S=Math.sqrt(b*b+_*_+w*w),k=Math.asin(w/=S),N=mo(mo(w)-1)<Do||mo(r-h)<Do?(r+h)/2:Math.atan2(_,b),E=n(N,k),A=E[0],C=E[1],z=A-t,L=C-e,q=M*z-m*L;(q*q/x>u||mo((m*z+M*L)/x-.5)>.3||a*p+l*g+c*v<o)&&(i(t,e,r,a,l,c,A,C,N,b/=S,_/=S,w,d,y),y.point(A,C),i(A,C,N,b,_,w,f,s,h,p,g,v,d,y))}}var u=.5,o=Math.cos(30*Oo),a=16;return t.precision=function(n){return arguments.length?(a=(u=n*n)>0&&16,t):Math.sqrt(u)},t}function re(n){var t=ee(function(t,e){return n([t*Io,e*Io])});return function(n){return le(t(n))}}function ie(n){this.stream=n}function ue(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function oe(n){return ae(function(){return n})()}function ae(n){function t(n){return n=a(n[0]*Oo,n[1]*Oo),[n[0]*h+l,c-n[1]*h]}function e(n){return n=a.invert((n[0]-l)/h,(c-n[1])/h),n&&[n[0]*Io,n[1]*Io]}function r(){a=Ct(o=se(y,M,x),u);var n=u(v,d);return l=p-n[0]*h,c=g+n[1]*h,i()}function i(){return f&&(f.valid=!1,f=null),t}var u,o,a,l,c,f,s=ee(function(n,t){return n=u(n,t),[n[0]*h+l,c-n[1]*h]}),h=150,p=480,g=250,v=0,d=0,y=0,M=0,x=0,b=Ua,_=m,w=null,S=null;return t.stream=function(n){return f&&(f.valid=!1),f=le(b(o,s(_(n)))),f.valid=!0,f},t.clipAngle=function(n){return arguments.length?(b=null==n?(w=n,Ua):It((w=+n)*Oo),i()):w},t.clipExtent=function(n){return arguments.length?(S=n,_=n?Zt(n[0][0],n[0][1],n[1][0],n[1][1]):m,i()):S},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(p=+n[0],g=+n[1],r()):[p,g]},t.center=function(n){return arguments.length?(v=n[0]%360*Oo,d=n[1]%360*Oo,r()):[v*Io,d*Io]},t.rotate=function(n){return arguments.length?(y=n[0]%360*Oo,M=n[1]%360*Oo,x=n.length>2?n[2]%360*Oo:0,r()):[y*Io,M*Io,x*Io]},ao.rebind(t,s,"precision"),function(){return u=n.apply(this,arguments),t.invert=u.invert&&e,r()}}function le(n){return ue(n,function(t,e){n.point(t*Oo,e*Oo)})}function ce(n,t){return[n,t]}function fe(n,t){return[n>Uo?n-jo:n<-Uo?n+jo:n,t]}function se(n,t,e){return n?t||e?Ct(pe(n),ge(t,e)):pe(n):t||e?ge(t,e):fe}function he(n){return function(t,e){return t+=n,[t>Uo?t-jo:t<-Uo?t+jo:t,e]}}function pe(n){var t=he(n);return t.invert=he(-n),t}function ge(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,l=Math.sin(n)*e,c=Math.sin(t),f=c*r+a*i;return[Math.atan2(l*u-f*o,a*r-c*i),tn(f*u+l*o)]}var r=Math.cos(n),i=Math.sin(n),u=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,l=Math.sin(n)*e,c=Math.sin(t),f=c*u-l*o;return[Math.atan2(l*u+c*o,a*r+f*i),tn(f*r-a*i)]},e}function ve(n,t){var e=Math.cos(n),r=Math.sin(n);return function(i,u,o,a){var l=o*t;null!=i?(i=de(e,i),u=de(e,u),(o>0?i<u:i>u)&&(i+=o*jo)):(i=n+o*jo,u=n-.5*l);for(var c,f=i;o>0?f>u:f<u;f-=l)a.point((c=_t([e,-r*Math.cos(f),-r*Math.sin(f)]))[0],c[1])}}function de(n,t){var e=dt(t);e[0]-=n,bt(e);var r=nn(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Do)%(2*Math.PI)}function ye(n,t,e){var r=ao.range(n,t-Do,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function me(n,t,e){var r=ao.range(n,t-Do,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function Me(n){return n.source}function xe(n){return n.target}function be(n,t,e,r){var i=Math.cos(t),u=Math.sin(t),o=Math.cos(r),a=Math.sin(r),l=i*Math.cos(n),c=i*Math.sin(n),f=o*Math.cos(e),s=o*Math.sin(e),h=2*Math.asin(Math.sqrt(on(r-t)+i*o*on(e-n))),p=1/Math.sin(h),g=h?function(n){var t=Math.sin(n*=h)*p,e=Math.sin(h-n)*p,r=e*l+t*f,i=e*c+t*s,o=e*u+t*a;return[Math.atan2(i,r)*Io,Math.atan2(o,Math.sqrt(r*r+i*i))*Io]}:function(){return[n*Io,t*Io]};return g.distance=h,g}function _e(){function n(n,i){var u=Math.sin(i*=Oo),o=Math.cos(i),a=mo((n*=Oo)-t),l=Math.cos(a);Ba+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*u-e*o*l)*a),e*u+r*o*l),t=n,e=u,r=o}var t,e,r;Wa.point=function(i,u){t=i*Oo,e=Math.sin(u*=Oo),r=Math.cos(u),Wa.point=n},Wa.lineEnd=function(){Wa.point=Wa.lineEnd=b}}function we(n,t){function e(t,e){var r=Math.cos(t),i=Math.cos(e),u=n(r*i);return[u*i*Math.sin(t),u*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),i=t(r),u=Math.sin(i),o=Math.cos(i);return[Math.atan2(n*u,r*o),Math.asin(r&&e*u/r)]},e}function Se(n,t){function e(n,t){o>0?t<-Ho+Do&&(t=-Ho+Do):t>Ho-Do&&(t=Ho-Do);var e=o/Math.pow(i(t),u);return[e*Math.sin(u*n),o-e*Math.cos(u*n)]}var r=Math.cos(n),i=function(n){return Math.tan(Uo/4+n/2)},u=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(i(t)/i(n)),o=r*Math.pow(i(n),u)/u;return u?(e.invert=function(n,t){var e=o-t,r=K(u)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/u,2*Math.atan(Math.pow(o/r,1/u))-Ho]},e):Ne}function ke(n,t){function e(n,t){var e=u-t;return[e*Math.sin(i*n),u-e*Math.cos(i*n)]}var r=Math.cos(n),i=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),u=r/i+n;return mo(i)<Do?ce:(e.invert=function(n,t){var e=u-t;return[Math.atan2(n,e)/i,u-K(i)*Math.sqrt(n*n+e*e)]},e)}function Ne(n,t){return[n,Math.log(Math.tan(Uo/4+t/2))]}function Ee(n){var t,e=oe(n),r=e.scale,i=e.translate,u=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=i.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=u.apply(e,arguments);if(o===e){if(t=null==n){var a=Uo*r(),l=i();u([[l[0]-a,l[1]-a],[l[0]+a,l[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function Ae(n,t){return[Math.log(Math.tan(Uo/4+t/2)),-n]}function Ce(n){return n[0]}function ze(n){return n[1]}function Le(n){for(var t=n.length,e=[0,1],r=2,i=2;i<t;i++){for(;r>1&&Q(n[e[r-2]],n[e[r-1]],n[i])<=0;)--r;e[r++]=i}return e.slice(0,r)}function qe(n,t){return n[0]-t[0]||n[1]-t[1]}function Te(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function Re(n,t,e,r){var i=n[0],u=e[0],o=t[0]-i,a=r[0]-u,l=n[1],c=e[1],f=t[1]-l,s=r[1]-c,h=(a*(l-c)-s*(i-u))/(s*o-a*f);return[i+h*o,l+h*f]}function De(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Pe(){rr(this),this.edge=this.site=this.circle=null}function Ue(n){var t=al.pop()||new Pe;return t.site=n,t}function je(n){Be(n),il.remove(n),al.push(n),rr(n)}function Fe(n){var t=n.circle,e=t.x,r=t.cy,i={x:e,y:r},u=n.P,o=n.N,a=[n];je(n);for(var l=u;l.circle&&mo(e-l.circle.x)<Do&&mo(r-l.circle.cy)<Do;)u=l.P,a.unshift(l),je(l),l=u;a.unshift(l),Be(l);for(var c=o;c.circle&&mo(e-c.circle.x)<Do&&mo(r-c.circle.cy)<Do;)o=c.N,a.push(c),je(c),c=o;a.push(c),Be(c);var f,s=a.length;for(f=1;f<s;++f)c=a[f],l=a[f-1],nr(c.edge,l.site,c.site,i);l=a[0],c=a[s-1],c.edge=Ke(l.site,c.site,null,i),$e(l),$e(c)}function He(n){for(var t,e,r,i,u=n.x,o=n.y,a=il._;a;)if(r=Oe(a,o)-u,r>Do)a=a.L;else{if(i=u-Ie(a,o),!(i>Do)){r>-Do?(t=a.P,e=a):i>-Do?(t=a,e=a.N):t=e=a;break}if(!a.R){t=a;break}a=a.R}var l=Ue(n);if(il.insert(t,l),t||e){if(t===e)return Be(t),e=Ue(t.site),il.insert(l,e),l.edge=e.edge=Ke(t.site,l.site),$e(t),void $e(e);if(!e)return void(l.edge=Ke(t.site,l.site));Be(t),Be(e);var c=t.site,f=c.x,s=c.y,h=n.x-f,p=n.y-s,g=e.site,v=g.x-f,d=g.y-s,y=2*(h*d-p*v),m=h*h+p*p,M=v*v+d*d,x={x:(d*m-p*M)/y+f,y:(h*M-v*m)/y+s};nr(e.edge,c,g,x),l.edge=Ke(c,n,null,x),e.edge=Ke(n,g,null,x),$e(t),$e(e)}}function Oe(n,t){var e=n.site,r=e.x,i=e.y,u=i-t;if(!u)return r;var o=n.P;if(!o)return-(1/0);e=o.site;var a=e.x,l=e.y,c=l-t;if(!c)return a;var f=a-r,s=1/u-1/c,h=f/c;return s?(-h+Math.sqrt(h*h-2*s*(f*f/(-2*c)-l+c/2+i-u/2)))/s+r:(r+a)/2}function Ie(n,t){var e=n.N;if(e)return Oe(e,t);var r=n.site;return r.y===t?r.x:1/0}function Ye(n){this.site=n,this.edges=[]}function Ze(n){for(var t,e,r,i,u,o,a,l,c,f,s=n[0][0],h=n[1][0],p=n[0][1],g=n[1][1],v=rl,d=v.length;d--;)if(u=v[d],u&&u.prepare())for(a=u.edges,l=a.length,o=0;o<l;)f=a[o].end(),r=f.x,i=f.y,c=a[++o%l].start(),t=c.x,e=c.y,(mo(r-t)>Do||mo(i-e)>Do)&&(a.splice(o,0,new tr(Qe(u.site,f,mo(r-s)<Do&&g-i>Do?{x:s,y:mo(t-s)<Do?e:g}:mo(i-g)<Do&&h-r>Do?{x:mo(e-g)<Do?t:h,y:g}:mo(r-h)<Do&&i-p>Do?{x:h,y:mo(t-h)<Do?e:p}:mo(i-p)<Do&&r-s>Do?{x:mo(e-p)<Do?t:s,y:p}:null),u.site,null)),++l)}function Ve(n,t){return t.angle-n.angle}function Xe(){rr(this),this.x=this.y=this.arc=this.site=this.cy=null}function $e(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,i=n.site,u=e.site;if(r!==u){var o=i.x,a=i.y,l=r.x-o,c=r.y-a,f=u.x-o,s=u.y-a,h=2*(l*s-c*f);if(!(h>=-Po)){var p=l*l+c*c,g=f*f+s*s,v=(s*p-c*g)/h,d=(l*g-f*p)/h,s=d+a,y=ll.pop()||new Xe;y.arc=n,y.site=i,y.x=v+o,y.y=s+Math.sqrt(v*v+d*d),y.cy=s,n.circle=y;for(var m=null,M=ol._;M;)if(y.y<M.y||y.y===M.y&&y.x<=M.x){if(!M.L){m=M.P;break}M=M.L}else{if(!M.R){m=M;break}M=M.R}ol.insert(m,y),m||(ul=y)}}}}function Be(n){var t=n.circle;t&&(t.P||(ul=t.N),ol.remove(t),ll.push(t),rr(t),n.circle=null)}function We(n){for(var t,e=el,r=Yt(n[0][0],n[0][1],n[1][0],n[1][1]),i=e.length;i--;)t=e[i],(!Je(t,n)||!r(t)||mo(t.a.x-t.b.x)<Do&&mo(t.a.y-t.b.y)<Do)&&(t.a=t.b=null,e.splice(i,1))}function Je(n,t){var e=n.b;if(e)return!0;var r,i,u=n.a,o=t[0][0],a=t[1][0],l=t[0][1],c=t[1][1],f=n.l,s=n.r,h=f.x,p=f.y,g=s.x,v=s.y,d=(h+g)/2,y=(p+v)/2;if(v===p){if(d<o||d>=a)return;if(h>g){if(u){if(u.y>=c)return}else u={x:d,y:l};e={x:d,y:c}}else{if(u){if(u.y<l)return}else u={x:d,y:c};e={x:d,y:l}}}else if(r=(h-g)/(v-p),i=y-r*d,r<-1||r>1)if(h>g){if(u){if(u.y>=c)return}else u={x:(l-i)/r,y:l};e={x:(c-i)/r,y:c}}else{if(u){if(u.y<l)return}else u={x:(c-i)/r,y:c};e={x:(l-i)/r,y:l}}else if(p<v){if(u){if(u.x>=a)return}else u={x:o,y:r*o+i};e={x:a,y:r*a+i}}else{if(u){if(u.x<o)return}else u={x:a,y:r*a+i};e={x:o,y:r*o+i}}return n.a=u,n.b=e,!0}function Ge(n,t){this.l=n,this.r=t,this.a=this.b=null}function Ke(n,t,e,r){var i=new Ge(n,t);return el.push(i),e&&nr(i,n,t,e),r&&nr(i,t,n,r),rl[n.i].edges.push(new tr(i,n,t)),rl[t.i].edges.push(new tr(i,t,n)),i}function Qe(n,t,e){var r=new Ge(n,null);return r.a=t,r.b=e,el.push(r),r}function nr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function tr(n,t,e){var r=n.a,i=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function er(){this._=null}function rr(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function ir(n,t){var e=t,r=t.R,i=e.U;i?i.L===e?i.L=r:i.R=r:n._=r,r.U=i,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function ur(n,t){var e=t,r=t.L,i=e.U;i?i.L===e?i.L=r:i.R=r:n._=r,r.U=i,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function or(n){for(;n.L;)n=n.L;return n}function ar(n,t){var e,r,i,u=n.sort(lr).pop();for(el=[],rl=new Array(n.length),il=new er,ol=new er;;)if(i=ul,u&&(!i||u.y<i.y||u.y===i.y&&u.x<i.x))u.x===e&&u.y===r||(rl[u.i]=new Ye(u),He(u),e=u.x,r=u.y),u=n.pop();else{if(!i)break;Fe(i.arc)}t&&(We(t),Ze(t));var o={cells:rl,edges:el};return il=ol=el=rl=null,o}function lr(n,t){return t.y-n.y||t.x-n.x}function cr(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}function fr(n){return n.x}function sr(n){return n.y}function hr(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function pr(n,t,e,r,i,u){if(!n(t,e,r,i,u)){var o=.5*(e+i),a=.5*(r+u),l=t.nodes;l[0]&&pr(n,l[0],e,r,o,a),l[1]&&pr(n,l[1],o,r,i,a),l[2]&&pr(n,l[2],e,a,o,u),l[3]&&pr(n,l[3],o,a,i,u)}}function gr(n,t,e,r,i,u,o){var a,l=1/0;return function n(c,f,s,h,p){if(!(f>u||s>o||h<r||p<i)){if(g=c.point){var g,v=t-c.x,d=e-c.y,y=v*v+d*d;if(y<l){var m=Math.sqrt(l=y);r=t-m,i=e-m,u=t+m,o=e+m,a=g}}for(var M=c.nodes,x=.5*(f+h),b=.5*(s+p),_=t>=x,w=e>=b,S=w<<1|_,k=S+4;S<k;++S)if(c=M[3&S])switch(3&S){case 0:n(c,f,s,x,b);break;case 1:n(c,x,s,h,b);break;case 2:n(c,f,b,x,p);break;case 3:n(c,x,b,h,p)}}}(n,r,i,u,o),a}function vr(n,t){n=ao.rgb(n),t=ao.rgb(t);var e=n.r,r=n.g,i=n.b,u=t.r-e,o=t.g-r,a=t.b-i;return function(n){return"#"+bn(Math.round(e+u*n))+bn(Math.round(r+o*n))+bn(Math.round(i+a*n))}}function dr(n,t){var e,r={},i={};for(e in n)e in t?r[e]=Mr(n[e],t[e]):i[e]=n[e];for(e in t)e in n||(i[e]=t[e]);return function(n){for(e in r)i[e]=r[e](n);return i}}function yr(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function mr(n,t){var e,r,i,u=fl.lastIndex=sl.lastIndex=0,o=-1,a=[],l=[];for(n+="",t+="";(e=fl.exec(n))&&(r=sl.exec(t));)(i=r.index)>u&&(i=t.slice(u,i),a[o]?a[o]+=i:a[++o]=i),(e=e[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:yr(e,r)})),u=sl.lastIndex;return u<t.length&&(i=t.slice(u),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?(t=l[0].x,function(n){return t(n)+""}):function(){return t}:(t=l.length,function(n){for(var e,r=0;r<t;++r)a[(e=l[r]).i]=e.x(n);return a.join("")})}function Mr(n,t){for(var e,r=ao.interpolators.length;--r>=0&&!(e=ao.interpolators[r](n,t)););return e}function xr(n,t){var e,r=[],i=[],u=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;e<a;++e)r.push(Mr(n[e],t[e]));for(;e<u;++e)i[e]=n[e];for(;e<o;++e)i[e]=t[e];return function(n){for(e=0;e<a;++e)i[e]=r[e](n);return i}}function br(n){return function(t){return t<=0?0:t>=1?1:n(t)}}function _r(n){return function(t){return 1-n(1-t)}}function wr(n){return function(t){return.5*(t<.5?n(2*t):2-n(2-2*t))}}function Sr(n){return n*n}function kr(n){return n*n*n}function Nr(n){if(n<=0)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(n<.5?e:3*(n-t)+e-.75)}function Er(n){return function(t){return Math.pow(t,n)}}function Ar(n){return 1-Math.cos(n*Ho)}function Cr(n){return Math.pow(2,10*(n-1))}function zr(n){return 1-Math.sqrt(1-n*n)}function Lr(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/jo*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*jo/t)}}function qr(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function Tr(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Rr(n,t){n=ao.hcl(n),t=ao.hcl(t);var e=n.h,r=n.c,i=n.l,u=t.h-e,o=t.c-r,a=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):u>180?u-=360:u<-180&&(u+=360),function(n){return sn(e+u*n,r+o*n,i+a*n)+""}}function Dr(n,t){n=ao.hsl(n),t=ao.hsl(t);var e=n.h,r=n.s,i=n.l,u=t.h-e,o=t.s-r,a=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):u>180?u-=360:u<-180&&(u+=360),function(n){return cn(e+u*n,r+o*n,i+a*n)+""}}function Pr(n,t){n=ao.lab(n),t=ao.lab(t);var e=n.l,r=n.a,i=n.b,u=t.l-e,o=t.a-r,a=t.b-i;return function(n){return pn(e+u*n,r+o*n,i+a*n)+""}}function Ur(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function jr(n){var t=[n.a,n.b],e=[n.c,n.d],r=Hr(t),i=Fr(t,e),u=Hr(Or(e,t,-i))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Io,this.translate=[n.e,n.f],this.scale=[r,u],this.skew=u?Math.atan2(i,u)*Io:0}function Fr(n,t){return n[0]*t[0]+n[1]*t[1]}function Hr(n){var t=Math.sqrt(Fr(n,n));return t&&(n[0]/=t,n[1]/=t),t}function Or(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function Ir(n){return n.length?n.pop()+",":""}function Yr(n,t,e,r){if(n[0]!==t[0]||n[1]!==t[1]){var i=e.push("translate(",null,",",null,")");r.push({i:i-4,x:yr(n[0],t[0])},{i:i-2,x:yr(n[1],t[1])})}else(t[0]||t[1])&&e.push("translate("+t+")")}function Zr(n,t,e,r){n!==t?(n-t>180?t+=360:t-n>180&&(n+=360),r.push({i:e.push(Ir(e)+"rotate(",null,")")-2,x:yr(n,t)})):t&&e.push(Ir(e)+"rotate("+t+")")}function Vr(n,t,e,r){n!==t?r.push({i:e.push(Ir(e)+"skewX(",null,")")-2,x:yr(n,t)}):t&&e.push(Ir(e)+"skewX("+t+")")}function Xr(n,t,e,r){if(n[0]!==t[0]||n[1]!==t[1]){var i=e.push(Ir(e)+"scale(",null,",",null,")");r.push({i:i-4,x:yr(n[0],t[0])},{i:i-2,x:yr(n[1],t[1])})}else 1===t[0]&&1===t[1]||e.push(Ir(e)+"scale("+t+")")}function $r(n,t){var e=[],r=[];return n=ao.transform(n),t=ao.transform(t),Yr(n.translate,t.translate,e,r),Zr(n.rotate,t.rotate,e,r),Vr(n.skew,t.skew,e,r),Xr(n.scale,t.scale,e,r),n=t=null,function(n){for(var t,i=-1,u=r.length;++i<u;)e[(t=r[i]).i]=t.x(n);return e.join("")}}function Br(n,t){return t=(t-=n=+n)||1/t,function(e){return(e-n)/t}}function Wr(n,t){return t=(t-=n=+n)||1/t,function(e){return Math.max(0,Math.min(1,(e-n)/t))}}function Jr(n){for(var t=n.source,e=n.target,r=Kr(t,e),i=[t];t!==r;)t=t.parent,i.push(t);for(var u=i.length;e!==r;)i.splice(u,0,e),e=e.parent;return i}function Gr(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Kr(n,t){if(n===t)return n;for(var e=Gr(n),r=Gr(t),i=e.pop(),u=r.pop(),o=null;i===u;)o=i,i=e.pop(),u=r.pop();return o}function Qr(n){n.fixed|=2}function ni(n){n.fixed&=-7}function ti(n){n.fixed|=4,n.px=n.x,n.py=n.y}function ei(n){n.fixed&=-5}function ri(n,t,e){var r=0,i=0;if(n.charge=0,!n.leaf)for(var u,o=n.nodes,a=o.length,l=-1;++l<a;)u=o[l],null!=u&&(ri(u,t,e),n.charge+=u.charge,r+=u.charge*u.cx,i+=u.charge*u.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var c=t*e[n.point.index];n.charge+=n.pointCharge=c,r+=c*n.point.x,i+=c*n.point.y}n.cx=r/n.charge,n.cy=i/n.charge}function ii(n,t){return ao.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=fi,n}function ui(n,t){for(var e=[n];null!=(n=e.pop());)if(t(n),(i=n.children)&&(r=i.length))for(var r,i;--r>=0;)e.push(i[r])}function oi(n,t){for(var e=[n],r=[];null!=(n=e.pop());)if(r.push(n),(u=n.children)&&(i=u.length))for(var i,u,o=-1;++o<i;)e.push(u[o]);for(;null!=(n=r.pop());)t(n)}function ai(n){return n.children}function li(n){return n.value}function ci(n,t){return t.value-n.value}function fi(n){return ao.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function si(n){return n.x}function hi(n){return n.y}function pi(n,t,e){n.y0=t,n.y=e}function gi(n){return ao.range(n.length)}function vi(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function di(n){for(var t,e=1,r=0,i=n[0][1],u=n.length;e<u;++e)(t=n[e][1])>i&&(r=e,i=t);return r}function yi(n){return n.reduce(mi,0)}function mi(n,t){return n+t[1]}function Mi(n,t){return xi(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function xi(n,t){for(var e=-1,r=+n[0],i=(n[1]-r)/t,u=[];++e<=t;)u[e]=i*e+r;return u}function bi(n){return[ao.min(n),ao.max(n)]}function _i(n,t){return n.value-t.value}function wi(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function Si(n,t){n._pack_next=t,t._pack_prev=n}function ki(n,t){var e=t.x-n.x,r=t.y-n.y,i=n.r+t.r;return.999*i*i>e*e+r*r}function Ni(n){function t(n){f=Math.min(n.x-n.r,f),s=Math.max(n.x+n.r,s),h=Math.min(n.y-n.r,h),p=Math.max(n.y+n.r,p)}if((e=n.children)&&(c=e.length)){var e,r,i,u,o,a,l,c,f=1/0,s=-(1/0),h=1/0,p=-(1/0);if(e.forEach(Ei),r=e[0],r.x=-r.r,r.y=0,t(r),c>1&&(i=e[1],i.x=i.r,i.y=0,t(i),c>2))for(u=e[2],zi(r,i,u),t(u),wi(r,u),r._pack_prev=u,wi(u,i),i=r._pack_next,o=3;o<c;o++){zi(r,i,u=e[o]);var g=0,v=1,d=1;for(a=i._pack_next;a!==i;a=a._pack_next,v++)if(ki(a,u)){g=1;break}if(1==g)for(l=r._pack_prev;l!==a._pack_prev&&!ki(l,u);l=l._pack_prev,d++);g?(v<d||v==d&&i.r<r.r?Si(r,i=a):Si(r=l,i),o--):(wi(r,u),i=u,t(u))}var y=(f+s)/2,m=(h+p)/2,M=0;for(o=0;o<c;o++)u=e[o],u.x-=y,u.y-=m,M=Math.max(M,u.r+Math.sqrt(u.x*u.x+u.y*u.y));n.r=M,e.forEach(Ai)}}function Ei(n){n._pack_next=n._pack_prev=n}function Ai(n){delete n._pack_next,delete n._pack_prev}function Ci(n,t,e,r){var i=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,i)for(var u=-1,o=i.length;++u<o;)Ci(i[u],t,e,r)}function zi(n,t,e){var r=n.r+e.r,i=t.x-n.x,u=t.y-n.y;if(r&&(i||u)){var o=t.r+e.r,a=i*i+u*u;o*=o,r*=r;var l=.5+(r-o)/(2*a),c=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+l*i+c*u,e.y=n.y+l*u-c*i}else e.x=n.x+r,e.y=n.y}function Li(n,t){return n.parent==t.parent?1:2}function qi(n){var t=n.children;return t.length?t[0]:n.t}function Ti(n){var t,e=n.children;return(t=e.length)?e[t-1]:n.t}function Ri(n,t,e){var r=e/(t.i-n.i);t.c-=r,t.s+=e,n.c+=r,t.z+=e,t.m+=e}function Di(n){for(var t,e=0,r=0,i=n.children,u=i.length;--u>=0;)t=i[u],t.z+=e,t.m+=e,e+=t.s+(r+=t.c)}function Pi(n,t,e){return n.a.parent===t.parent?n.a:e}function Ui(n){return 1+ao.max(n,function(n){return n.y})}function ji(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Fi(n){var t=n.children;return t&&t.length?Fi(t[0]):n}function Hi(n){var t,e=n.children;return e&&(t=e.length)?Hi(e[t-1]):n}function Oi(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Ii(n,t){var e=n.x+t[3],r=n.y+t[0],i=n.dx-t[1]-t[3],u=n.dy-t[0]-t[2];return i<0&&(e+=i/2,i=0),u<0&&(r+=u/2,u=0),{x:e,y:r,dx:i,dy:u}}function Yi(n){var t=n[0],e=n[n.length-1];return t<e?[t,e]:[e,t]}function Zi(n){return n.rangeExtent?n.rangeExtent():Yi(n.range())}function Vi(n,t,e,r){var i=e(n[0],n[1]),u=r(t[0],t[1]);return function(n){return u(i(n))}}function Xi(n,t){var e,r=0,i=n.length-1,u=n[r],o=n[i];return o<u&&(e=r,r=i,i=e,e=u,u=o,o=e),n[r]=t.floor(u),n[i]=t.ceil(o),n}function $i(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:_l}function Bi(n,t,e,r){var i=[],u=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)i.push(e(n[o-1],n[o])),u.push(r(t[o-1],t[o]));return function(t){var e=ao.bisect(n,t,1,a)-1;return u[e](i[e](t))}}function Wi(n,t,e,r){function i(){var i=Math.min(n.length,t.length)>2?Bi:Vi,l=r?Wr:Br;return o=i(n,t,l,e),a=i(t,n,l,Mr),u}function u(n){return o(n)}var o,a;return u.invert=function(n){return a(n)},u.domain=function(t){return arguments.length?(n=t.map(Number),i()):n},u.range=function(n){return arguments.length?(t=n,i()):t},u.rangeRound=function(n){return u.range(n).interpolate(Ur)},u.clamp=function(n){return arguments.length?(r=n,i()):r},u.interpolate=function(n){return arguments.length?(e=n,i()):e},u.ticks=function(t){return Qi(n,t)},u.tickFormat=function(t,e){return nu(n,t,e)},u.nice=function(t){return Gi(n,t),i()},u.copy=function(){return Wi(n,t,e,r)},i()}function Ji(n,t){return ao.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Gi(n,t){return Xi(n,$i(Ki(n,t)[2])),Xi(n,$i(Ki(n,t)[2])),n}function Ki(n,t){null==t&&(t=10);var e=Yi(n),r=e[1]-e[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),u=t/r*i;return u<=.15?i*=10:u<=.35?i*=5:u<=.75&&(i*=2),e[0]=Math.ceil(e[0]/i)*i,e[1]=Math.floor(e[1]/i)*i+.5*i,e[2]=i,e}function Qi(n,t){return ao.range.apply(ao,Ki(n,t))}function nu(n,t,e){var r=Ki(n,t);if(e){var i=fa.exec(e);if(i.shift(),"s"===i[8]){var u=ao.formatPrefix(Math.max(mo(r[0]),mo(r[1])));return i[7]||(i[7]="."+tu(u.scale(r[2]))),i[8]="f",e=ao.format(i.join("")),function(n){return e(u.scale(n))+u.symbol}}i[7]||(i[7]="."+eu(i[8],r)),e=i.join("")}else e=",."+tu(r[2])+"f";return ao.format(e)}function tu(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function eu(n,t){var e=tu(t[2]);return n in wl?Math.abs(e-tu(Math.max(mo(t[0]),mo(t[1]))))+ +("e"!==n):e-2*("%"===n)}function ru(n,t,e,r){function i(n){return(e?Math.log(n<0?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function u(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(i(t))}return o.invert=function(t){return u(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(i)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(i)),o):t},o.nice=function(){var t=Xi(r.map(i),e?Math:kl);return n.domain(t),r=t.map(u),o},o.ticks=function(){var n=Yi(r),o=[],a=n[0],l=n[1],c=Math.floor(i(a)),f=Math.ceil(i(l)),s=t%1?2:t;if(isFinite(f-c)){if(e){for(;c<f;c++)for(var h=1;h<s;h++)o.push(u(c)*h);o.push(u(c))}else for(o.push(u(c));c++<f;)for(var h=s-1;h>0;h--)o.push(u(c)*h);for(c=0;o[c]<a;c++);for(f=o.length;o[f-1]>l;f--);o=o.slice(c,f)}return o},o.tickFormat=function(n,e){if(!arguments.length)return Sl;arguments.length<2?e=Sl:"function"!=typeof e&&(e=ao.format(e));var r=Math.max(1,t*n/o.ticks().length);return function(n){var o=n/u(Math.round(i(n)));return o*t<t-.5&&(o*=t),o<=r?e(n):""}},o.copy=function(){return ru(n.copy(),t,e,r)},Ji(o,n)}function iu(n,t,e){function r(t){return n(i(t))}var i=uu(t),u=uu(1/t);return r.invert=function(t){return u(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(i)),r):e},r.ticks=function(n){return Qi(e,n)},r.tickFormat=function(n,t){return nu(e,n,t)},r.nice=function(n){return r.domain(Gi(e,n))},r.exponent=function(o){return arguments.length?(i=uu(t=o),u=uu(1/t),n.domain(e.map(i)),r):t},r.copy=function(){return iu(n.copy(),t,e)},Ji(r,n)}function uu(n){return function(t){return t<0?-Math.pow(-t,n):Math.pow(t,n)}}function ou(n,t){function e(e){return u[((i.get(e)||("range"===t.t?i.set(e,n.push(e)):NaN))-1)%u.length]}function r(t,e){return ao.range(n.length).map(function(n){return t+e*n})}var i,u,o;return e.domain=function(r){if(!arguments.length)return n;n=[],i=new c;for(var u,o=-1,a=r.length;++o<a;)i.has(u=r[o])||i.set(u,n.push(u));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(u=n,o=0,t={t:"range",a:arguments},e):u},e.rangePoints=function(i,a){arguments.length<2&&(a=0);var l=i[0],c=i[1],f=n.length<2?(l=(l+c)/2,0):(c-l)/(n.length-1+a);return u=r(l+f*a/2,f),o=0,t={t:"rangePoints",a:arguments},e},e.rangeRoundPoints=function(i,a){arguments.length<2&&(a=0);var l=i[0],c=i[1],f=n.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(n.length-1+a)|0;return u=r(l+Math.round(f*a/2+(c-l-(n.length-1+a)*f)/2),f),o=0,t={t:"rangeRoundPoints",a:arguments},e},e.rangeBands=function(i,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var c=i[1]<i[0],f=i[c-0],s=i[1-c],h=(s-f)/(n.length-a+2*l);return u=r(f+h*l,h),c&&u.reverse(),o=h*(1-a),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(i,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var c=i[1]<i[0],f=i[c-0],s=i[1-c],h=Math.floor((s-f)/(n.length-a+2*l));return u=r(f+Math.round((s-f-(n.length-a)*h)/2),h),c&&u.reverse(),o=Math.round(h*(1-a)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return o},e.rangeExtent=function(){return Yi(t.a[0])},e.copy=function(){return ou(n,t)},e.domain(n)}function au(n,t){function u(){var e=0,r=t.length;for(a=[];++e<r;)a[e-1]=ao.quantile(n,e/r);return o}function o(n){if(!isNaN(n=+n))return t[ao.bisect(a,n)]}var a;return o.domain=function(t){return arguments.length?(n=t.map(r).filter(i).sort(e),u()):n},o.range=function(n){return arguments.length?(t=n,u()):t},o.quantiles=function(){return a},o.invertExtent=function(e){return e=t.indexOf(e),e<0?[NaN,NaN]:[e>0?a[e-1]:n[0],e<a.length?a[e]:n[n.length-1]]},o.copy=function(){return au(n,t)},u()}function lu(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(u*(t-n))))]}function i(){return u=e.length/(t-n),o=e.length-1,r}var u,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],i()):[n,t]},r.range=function(n){return arguments.length?(e=n,i()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=t<0?NaN:t/u+n,[t,t+1/u]},r.copy=function(){return lu(n,t,e)},i()}function cu(n,t){function e(e){if(e<=e)return t[ao.bisect(n,e)]}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return cu(n,t)},e}function fu(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Qi(n,t)},t.tickFormat=function(t,e){return nu(n,t,e)},t.copy=function(){return fu(n)},t}function su(){return 0}function hu(n){return n.innerRadius}function pu(n){return n.outerRadius}function gu(n){return n.startAngle}function vu(n){return n.endAngle}function du(n){return n&&n.padAngle}function yu(n,t,e,r){return(n-e)*t-(t-r)*n>0?0:1}function mu(n,t,e,r,i){var u=n[0]-t[0],o=n[1]-t[1],a=(i?r:-r)/Math.sqrt(u*u+o*o),l=a*o,c=-a*u,f=n[0]+l,s=n[1]+c,h=t[0]+l,p=t[1]+c,g=(f+h)/2,v=(s+p)/2,d=h-f,y=p-s,m=d*d+y*y,M=e-r,x=f*p-h*s,b=(y<0?-1:1)*Math.sqrt(Math.max(0,M*M*m-x*x)),_=(x*y-d*b)/m,w=(-x*d-y*b)/m,S=(x*y+d*b)/m,k=(-x*d+y*b)/m,N=_-g,E=w-v,A=S-g,C=k-v;return N*N+E*E>A*A+C*C&&(_=S,w=k),[[_-l,w-c],[_*e/M,w*e/M]]}function Mu(n){function t(t){function o(){c.push("M",u(n(f),a))}for(var l,c=[],f=[],s=-1,h=t.length,p=En(e),g=En(r);++s<h;)i.call(this,l=t[s],s)?f.push([+p.call(this,l,s),+g.call(this,l,s)]):f.length&&(o(),f=[]);return f.length&&o(),c.length?c.join(""):null}var e=Ce,r=ze,i=zt,u=xu,o=u.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(i=n,t):i},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?u=n:(u=Ll.get(n)||xu).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function xu(n){return n.length>1?n.join("L"):n+"Z"}function bu(n){return n.join("L")+"Z"}function _u(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&i.push("H",r[0]),i.join("")}function wu(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("V",(r=n[t])[1],"H",r[0]);return i.join("")}function Su(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r=n[t])[0],"V",r[1]);return i.join("")}function ku(n,t){return n.length<4?xu(n):n[1]+Au(n.slice(1,-1),Cu(n,t))}function Nu(n,t){return n.length<3?bu(n):n[0]+Au((n.push(n[0]),n),Cu([n[n.length-2]].concat(n,[n[1]]),t))}function Eu(n,t){return n.length<3?xu(n):n[0]+Au(n,Cu(n,t))}function Au(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return xu(n);var e=n.length!=t.length,r="",i=n[0],u=n[1],o=t[0],a=o,l=1;if(e&&(r+="Q"+(u[0]-2*o[0]/3)+","+(u[1]-2*o[1]/3)+","+u[0]+","+u[1],i=n[1],l=2),t.length>1){a=t[1],u=n[l],l++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(u[0]-a[0])+","+(u[1]-a[1])+","+u[0]+","+u[1];for(var c=2;c<t.length;c++,l++)u=n[l],a=t[c],r+="S"+(u[0]-a[0])+","+(u[1]-a[1])+","+u[0]+","+u[1]}if(e){var f=n[l];r+="Q"+(u[0]+2*a[0]/3)+","+(u[1]+2*a[1]/3)+","+f[0]+","+f[1]}return r}function Cu(n,t){for(var e,r=[],i=(1-t)/2,u=n[0],o=n[1],a=1,l=n.length;++a<l;)e=u,u=o,o=n[a],r.push([i*(o[0]-e[0]),i*(o[1]-e[1])]);return r}function zu(n){if(n.length<3)return xu(n);var t=1,e=n.length,r=n[0],i=r[0],u=r[1],o=[i,i,i,(r=n[1])[0]],a=[u,u,u,r[1]],l=[i,",",u,"L",Ru(Rl,o),",",Ru(Rl,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),Du(l,o,a);return n.pop(),l.push("L",r),l.join("")}function Lu(n){if(n.length<4)return xu(n);for(var t,e=[],r=-1,i=n.length,u=[0],o=[0];++r<3;)t=n[r],u.push(t[0]),o.push(t[1]);for(e.push(Ru(Rl,u)+","+Ru(Rl,o)),--r;++r<i;)t=n[r],u.shift(),u.push(t[0]),o.shift(),o.push(t[1]),Du(e,u,o);return e.join("")}function qu(n){for(var t,e,r=-1,i=n.length,u=i+4,o=[],a=[];++r<4;)e=n[r%i],o.push(e[0]),a.push(e[1]);for(t=[Ru(Rl,o),",",Ru(Rl,a)],--r;++r<u;)e=n[r%i],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Du(t,o,a);return t.join("")}function Tu(n,t){var e=n.length-1;if(e)for(var r,i,u=n[0][0],o=n[0][1],a=n[e][0]-u,l=n[e][1]-o,c=-1;++c<=e;)r=n[c],i=c/e,r[0]=t*r[0]+(1-t)*(u+i*a),r[1]=t*r[1]+(1-t)*(o+i*l);return zu(n)}function Ru(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Du(n,t,e){n.push("C",Ru(ql,t),",",Ru(ql,e),",",Ru(Tl,t),",",Ru(Tl,e),",",Ru(Rl,t),",",Ru(Rl,e))}function Pu(n,t){return(t[1]-n[1])/(t[0]-n[0])}function Uu(n){for(var t=0,e=n.length-1,r=[],i=n[0],u=n[1],o=r[0]=Pu(i,u);++t<e;)r[t]=(o+(o=Pu(i=u,u=n[t+1])))/2;return r[t]=o,r}function ju(n){for(var t,e,r,i,u=[],o=Uu(n),a=-1,l=n.length-1;++a<l;)t=Pu(n[a],n[a+1]),mo(t)<Do?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,i=e*e+r*r,i>9&&(i=3*t/Math.sqrt(i),o[a]=i*e,o[a+1]=i*r));for(a=-1;++a<=l;)i=(n[Math.min(l,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),u.push([i||0,o[a]*i||0]);return u}function Fu(n){return n.length<3?xu(n):n[0]+Au(n,ju(n))}function Hu(n){for(var t,e,r,i=-1,u=n.length;++i<u;)t=n[i],e=t[0],r=t[1]-Ho,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function Ou(n){function t(t){function l(){v.push("M",a(n(y),s),f,c(n(d.reverse()),s),"Z")}for(var h,p,g,v=[],d=[],y=[],m=-1,M=t.length,x=En(e),b=En(i),_=e===r?function(){
 return p}:En(r),w=i===u?function(){return g}:En(u);++m<M;)o.call(this,h=t[m],m)?(d.push([p=+x.call(this,h,m),g=+b.call(this,h,m)]),y.push([+_.call(this,h,m),+w.call(this,h,m)])):d.length&&(l(),d=[],y=[]);return d.length&&l(),v.length?v.join(""):null}var e=Ce,r=Ce,i=0,u=ze,o=zt,a=xu,l=a.key,c=a,f="L",s=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(i=u=n,t):u},t.y0=function(n){return arguments.length?(i=n,t):i},t.y1=function(n){return arguments.length?(u=n,t):u},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(l="function"==typeof n?a=n:(a=Ll.get(n)||xu).key,c=a.reverse||a,f=a.closed?"M":"L",t):l},t.tension=function(n){return arguments.length?(s=n,t):s},t}function Iu(n){return n.radius}function Yu(n){return[n.x,n.y]}function Zu(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]-Ho;return[e*Math.cos(r),e*Math.sin(r)]}}function Vu(){return 64}function Xu(){return"circle"}function $u(n){var t=Math.sqrt(n/Uo);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Bu(n){return function(){var t,e,r;(t=this[n])&&(r=t[e=t.active])&&(r.timer.c=null,r.timer.t=NaN,--t.count?delete t[e]:delete this[n],t.active+=.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index))}}function Wu(n,t,e){return wo(n,Ol),n.namespace=t,n.id=e,n}function Ju(n,t,e,r){var i=n.id,u=n.namespace;return Y(n,"function"==typeof e?function(n,o,a){n[u][i].tween.set(t,r(e.call(n,n.__data__,o,a)))}:(e=r(e),function(n){n[u][i].tween.set(t,e)}))}function Gu(n){return null==n&&(n=""),function(){this.textContent=n}}function Ku(n){return null==n?"__transition__":"__transition_"+n+"__"}function Qu(n,t,e,r,i){function u(n){var t=v.delay;return f.t=t+l,t<=n?o(n-t):void(f.c=o)}function o(e){var i=g.active,u=g[i];u&&(u.timer.c=null,u.timer.t=NaN,--g.count,delete g[i],u.event&&u.event.interrupt.call(n,n.__data__,u.index));for(var o in g)if(+o<r){var c=g[o];c.timer.c=null,c.timer.t=NaN,--g.count,delete g[o]}f.c=a,qn(function(){return f.c&&a(e||1)&&(f.c=null,f.t=NaN),1},0,l),g.active=r,v.event&&v.event.start.call(n,n.__data__,t),p=[],v.tween.forEach(function(e,r){(r=r.call(n,n.__data__,t))&&p.push(r)}),h=v.ease,s=v.duration}function a(i){for(var u=i/s,o=h(u),a=p.length;a>0;)p[--a].call(n,o);if(u>=1)return v.event&&v.event.end.call(n,n.__data__,t),--g.count?delete g[r]:delete n[e],1}var l,f,s,h,p,g=n[e]||(n[e]={active:0,count:0}),v=g[r];v||(l=i.time,f=qn(u,0,l),v=g[r]={tween:new c,time:l,timer:f,delay:i.delay,duration:i.duration,ease:i.ease,index:t},i=null,++g.count)}function no(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"})}function to(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"})}function eo(n){return n.toISOString()}function ro(n,t,e){function r(t){return n(t)}function i(n,e){var r=n[1]-n[0],i=r/e,u=ao.bisect(Jl,i);return u==Jl.length?[t.year,Ki(n.map(function(n){return n/31536e6}),e)[2]]:u?t[i/Jl[u-1]<Jl[u]/i?u-1:u]:[Ql,Ki(n,e)[2]]}return r.invert=function(t){return io(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(io)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,io(+e+1),t).length}var u=r.domain(),o=Yi(u),a=null==n?i(o,10):"number"==typeof n&&i(o,n);return a&&(n=a[0],t=a[1]),r.domain(Xi(u,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=io(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=io(+t+1);return t}}:n))},r.ticks=function(n,t){var e=Yi(r.domain()),u=null==n?i(e,10):"number"==typeof n?i(e,n):!n.range&&[{range:n},t];return u&&(n=u[0],t=u[1]),n.range(e[0],io(+e[1]+1),t<1?1:t)},r.tickFormat=function(){return e},r.copy=function(){return ro(n.copy(),t,e)},Ji(r,n)}function io(n){return new Date(n)}function uo(n){return JSON.parse(n.responseText)}function oo(n){var t=fo.createRange();return t.selectNode(fo.body),t.createContextualFragment(n.responseText)}var ao={version:"3.5.17"},lo=[].slice,co=function(n){return lo.call(n)},fo=this.document;if(fo)try{co(fo.documentElement.childNodes)[0].nodeType}catch(n){co=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}if(Date.now||(Date.now=function(){return+new Date}),fo)try{fo.createElement("DIV").style.setProperty("opacity",0,"")}catch(n){var so=this.Element.prototype,ho=so.setAttribute,po=so.setAttributeNS,go=this.CSSStyleDeclaration.prototype,vo=go.setProperty;so.setAttribute=function(n,t){ho.call(this,n,t+"")},so.setAttributeNS=function(n,t,e){po.call(this,n,t,e+"")},go.setProperty=function(n,t,e){vo.call(this,n,t+"",e)}}ao.ascending=e,ao.descending=function(n,t){return t<n?-1:t>n?1:t>=n?0:NaN},ao.min=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u;)if(null!=(r=n[i])&&r>=r){e=r;break}for(;++i<u;)null!=(r=n[i])&&e>r&&(e=r)}else{for(;++i<u;)if(null!=(r=t.call(n,n[i],i))&&r>=r){e=r;break}for(;++i<u;)null!=(r=t.call(n,n[i],i))&&e>r&&(e=r)}return e},ao.max=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u;)if(null!=(r=n[i])&&r>=r){e=r;break}for(;++i<u;)null!=(r=n[i])&&r>e&&(e=r)}else{for(;++i<u;)if(null!=(r=t.call(n,n[i],i))&&r>=r){e=r;break}for(;++i<u;)null!=(r=t.call(n,n[i],i))&&r>e&&(e=r)}return e},ao.extent=function(n,t){var e,r,i,u=-1,o=n.length;if(1===arguments.length){for(;++u<o;)if(null!=(r=n[u])&&r>=r){e=i=r;break}for(;++u<o;)null!=(r=n[u])&&(e>r&&(e=r),i<r&&(i=r))}else{for(;++u<o;)if(null!=(r=t.call(n,n[u],u))&&r>=r){e=i=r;break}for(;++u<o;)null!=(r=t.call(n,n[u],u))&&(e>r&&(e=r),i<r&&(i=r))}return[e,i]},ao.sum=function(n,t){var e,r=0,u=n.length,o=-1;if(1===arguments.length)for(;++o<u;)i(e=+n[o])&&(r+=e);else for(;++o<u;)i(e=+t.call(n,n[o],o))&&(r+=e);return r},ao.mean=function(n,t){var e,u=0,o=n.length,a=-1,l=o;if(1===arguments.length)for(;++a<o;)i(e=r(n[a]))?u+=e:--l;else for(;++a<o;)i(e=r(t.call(n,n[a],a)))?u+=e:--l;if(l)return u/l},ao.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),i=+n[r-1],u=e-r;return u?i+u*(n[r]-i):i},ao.median=function(n,t){var u,o=[],a=n.length,l=-1;if(1===arguments.length)for(;++l<a;)i(u=r(n[l]))&&o.push(u);else for(;++l<a;)i(u=r(t.call(n,n[l],l)))&&o.push(u);if(o.length)return ao.quantile(o.sort(e),.5)},ao.variance=function(n,t){var e,u,o=n.length,a=0,l=0,c=-1,f=0;if(1===arguments.length)for(;++c<o;)i(e=r(n[c]))&&(u=e-a,a+=u/++f,l+=u*(e-a));else for(;++c<o;)i(e=r(t.call(n,n[c],c)))&&(u=e-a,a+=u/++f,l+=u*(e-a));if(f>1)return l/(f-1)},ao.deviation=function(){var n=ao.variance.apply(this,arguments);return n?Math.sqrt(n):n};var yo=u(e);ao.bisectLeft=yo.left,ao.bisect=ao.bisectRight=yo.right,ao.bisector=function(n){return u(1===n.length?function(t,r){return e(n(t),r)}:n)},ao.shuffle=function(n,t,e){(u=arguments.length)<3&&(e=n.length,u<2&&(t=0));for(var r,i,u=e-t;u;)i=Math.random()*u--|0,r=n[u+t],n[u+t]=n[i+t],n[i+t]=r;return n},ao.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},ao.pairs=function(n){for(var t,e=0,r=n.length-1,i=n[0],u=new Array(r<0?0:r);e<r;)u[e]=[t=i,i=n[++e]];return u},ao.transpose=function(n){if(!(i=n.length))return[];for(var t=-1,e=ao.min(n,o),r=new Array(e);++t<e;)for(var i,u=-1,a=r[t]=new Array(i);++u<i;)a[u]=n[u][t];return r},ao.zip=function(){return ao.transpose(arguments)},ao.keys=function(n){var t=[];for(var e in n)t.push(e);return t},ao.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},ao.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},ao.merge=function(n){for(var t,e,r,i=n.length,u=-1,o=0;++u<i;)o+=n[u].length;for(e=new Array(o);--i>=0;)for(r=n[i],t=r.length;--t>=0;)e[--o]=r[t];return e};var mo=Math.abs;ao.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),(t-n)/e===1/0)throw new Error("infinite range");var r,i=[],u=a(mo(e)),o=-1;if(n*=u,t*=u,e*=u,e<0)for(;(r=n+e*++o)>t;)i.push(r/u);else for(;(r=n+e*++o)<t;)i.push(r/u);return i},ao.map=function(n,t){var e=new c;if(n instanceof c)n.forEach(function(n,t){e.set(n,t)});else if(Array.isArray(n)){var r,i=-1,u=n.length;if(1===arguments.length)for(;++i<u;)e.set(i,n[i]);else for(;++i<u;)e.set(t.call(n,r=n[i],i),r)}else for(var o in n)e.set(o,n[o]);return e};var Mo="__proto__",xo="\0";l(c,{has:h,get:function(n){return this._[f(n)]},set:function(n,t){return this._[f(n)]=t},remove:p,keys:g,values:function(){var n=[];for(var t in this._)n.push(this._[t]);return n},entries:function(){var n=[];for(var t in this._)n.push({key:s(t),value:this._[t]});return n},size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,s(t),this._[t])}}),ao.nest=function(){function n(t,o,a){if(a>=u.length)return r?r.call(i,o):e?o.sort(e):o;for(var l,f,s,h,p=-1,g=o.length,v=u[a++],d=new c;++p<g;)(h=d.get(l=v(f=o[p])))?h.push(f):d.set(l,[f]);return t?(f=t(),s=function(e,r){f.set(e,n(t,r,a))}):(f={},s=function(e,r){f[e]=n(t,r,a)}),d.forEach(s),f}function t(n,e){if(e>=u.length)return n;var r=[],i=o[e++];return n.forEach(function(n,i){r.push({key:n,values:t(i,e)})}),i?r.sort(function(n,t){return i(n.key,t.key)}):r}var e,r,i={},u=[],o=[];return i.map=function(t,e){return n(e,t,0)},i.entries=function(e){return t(n(ao.map,e,0),0)},i.key=function(n){return u.push(n),i},i.sortKeys=function(n){return o[u.length-1]=n,i},i.sortValues=function(n){return e=n,i},i.rollup=function(n){return r=n,i},i},ao.set=function(n){var t=new y;if(n)for(var e=0,r=n.length;e<r;++e)t.add(n[e]);return t},l(y,{has:h,add:function(n){return this._[f(n+="")]=!0,n},remove:p,values:g,size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,s(t))}}),ao.behavior={},ao.rebind=function(n,t){for(var e,r=1,i=arguments.length;++r<i;)n[e=arguments[r]]=M(n,t,t[e]);return n};var bo=["webkit","ms","moz","Moz","o","O"];ao.dispatch=function(){for(var n=new _,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=w(n);return n},_.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.slice(e+1),n=n.slice(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},ao.event=null,ao.requote=function(n){return n.replace(_o,"\\$&")};var _o=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,wo={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},So=function(n,t){return t.querySelector(n)},ko=function(n,t){return t.querySelectorAll(n)},No=function(n,t){var e=n.matches||n[x(n,"matchesSelector")];return(No=function(n,t){return e.call(n,t)})(n,t)};"function"==typeof Sizzle&&(So=function(n,t){return Sizzle(n,t)[0]||null},ko=Sizzle,No=Sizzle.matchesSelector),ao.selection=function(){return ao.select(fo.documentElement)};var Eo=ao.selection.prototype=[];Eo.select=function(n){var t,e,r,i,u=[];n=A(n);for(var o=-1,a=this.length;++o<a;){u.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var l=-1,c=r.length;++l<c;)(i=r[l])?(t.push(e=n.call(i,i.__data__,l,o)),e&&"__data__"in i&&(e.__data__=i.__data__)):t.push(null)}return E(u)},Eo.selectAll=function(n){var t,e,r=[];n=C(n);for(var i=-1,u=this.length;++i<u;)for(var o=this[i],a=-1,l=o.length;++a<l;)(e=o[a])&&(r.push(t=co(n.call(e,e.__data__,a,i))),t.parentNode=e);return E(r)};var Ao="http://www.w3.org/1999/xhtml",Co={svg:"http://www.w3.org/2000/svg",xhtml:Ao,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ao.ns={prefix:Co,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&"xmlns"!==(e=n.slice(0,t))&&(n=n.slice(t+1)),Co.hasOwnProperty(e)?{space:Co[e],local:n}:n}},Eo.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=ao.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(z(t,n[t]));return this}return this.each(z(n,t))},Eo.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=T(n)).length,i=-1;if(t=e.classList){for(;++i<r;)if(!t.contains(n[i]))return!1}else for(t=e.getAttribute("class");++i<r;)if(!q(n[i]).test(t))return!1;return!0}for(t in n)this.each(R(t,n[t]));return this}return this.each(R(n,t))},Eo.style=function(n,e,r){var i=arguments.length;if(i<3){if("string"!=typeof n){i<2&&(e="");for(r in n)this.each(P(r,n[r],e));return this}if(i<2){var u=this.node();return t(u).getComputedStyle(u,null).getPropertyValue(n)}r=""}return this.each(P(n,e,r))},Eo.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(U(t,n[t]));return this}return this.each(U(n,t))},Eo.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},Eo.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},Eo.append=function(n){return n=j(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},Eo.insert=function(n,t){return n=j(n),t=A(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},Eo.remove=function(){return this.each(F)},Eo.data=function(n,t){function e(n,e){var r,i,u,o=n.length,s=e.length,h=Math.min(o,s),p=new Array(s),g=new Array(s),v=new Array(o);if(t){var d,y=new c,m=new Array(o);for(r=-1;++r<o;)(i=n[r])&&(y.has(d=t.call(i,i.__data__,r))?v[r]=i:y.set(d,i),m[r]=d);for(r=-1;++r<s;)(i=y.get(d=t.call(e,u=e[r],r)))?i!==!0&&(p[r]=i,i.__data__=u):g[r]=H(u),y.set(d,!0);for(r=-1;++r<o;)r in m&&y.get(m[r])!==!0&&(v[r]=n[r])}else{for(r=-1;++r<h;)i=n[r],u=e[r],i?(i.__data__=u,p[r]=i):g[r]=H(u);for(;r<s;++r)g[r]=H(e[r]);for(;r<o;++r)v[r]=n[r]}g.update=p,g.parentNode=p.parentNode=v.parentNode=n.parentNode,a.push(g),l.push(p),f.push(v)}var r,i,u=-1,o=this.length;if(!arguments.length){for(n=new Array(o=(r=this[0]).length);++u<o;)(i=r[u])&&(n[u]=i.__data__);return n}var a=Z([]),l=E([]),f=E([]);if("function"==typeof n)for(;++u<o;)e(r=this[u],n.call(r,r.parentNode.__data__,u));else for(;++u<o;)e(r=this[u],n);return l.enter=function(){return a},l.exit=function(){return f},l},Eo.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},Eo.filter=function(n){var t,e,r,i=[];"function"!=typeof n&&(n=O(n));for(var u=0,o=this.length;u<o;u++){i.push(t=[]),t.parentNode=(e=this[u]).parentNode;for(var a=0,l=e.length;a<l;a++)(r=e[a])&&n.call(r,r.__data__,a,u)&&t.push(r)}return E(i)},Eo.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],i=r.length-1,u=r[i];--i>=0;)(e=r[i])&&(u&&u!==e.nextSibling&&u.parentNode.insertBefore(e,u),u=e);return this},Eo.sort=function(n){n=I.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},Eo.each=function(n){return Y(this,function(t,e,r){n.call(t,t.__data__,e,r)})},Eo.call=function(n){var t=co(arguments);return n.apply(t[0]=this,t),this},Eo.empty=function(){return!this.node()},Eo.node=function(){for(var n=0,t=this.length;n<t;n++)for(var e=this[n],r=0,i=e.length;r<i;r++){var u=e[r];if(u)return u}return null},Eo.size=function(){var n=0;return Y(this,function(){++n}),n};var zo=[];ao.selection.enter=Z,ao.selection.enter.prototype=zo,zo.append=Eo.append,zo.empty=Eo.empty,zo.node=Eo.node,zo.call=Eo.call,zo.size=Eo.size,zo.select=function(n){for(var t,e,r,i,u,o=[],a=-1,l=this.length;++a<l;){r=(i=this[a]).update,o.push(t=[]),t.parentNode=i.parentNode;for(var c=-1,f=i.length;++c<f;)(u=i[c])?(t.push(r[c]=e=n.call(i.parentNode,u.__data__,c,a)),e.__data__=u.__data__):t.push(null)}return E(o)},zo.insert=function(n,t){return arguments.length<2&&(t=V(this)),Eo.insert.call(this,n,t)},ao.select=function(t){var e;return"string"==typeof t?(e=[So(t,fo)],e.parentNode=fo.documentElement):(e=[t],e.parentNode=n(t)),E([e])},ao.selectAll=function(n){var t;return"string"==typeof n?(t=co(ko(n,fo)),t.parentNode=fo.documentElement):(t=co(n),t.parentNode=null),E([t])},Eo.on=function(n,t,e){var r=arguments.length;if(r<3){if("string"!=typeof n){r<2&&(t=!1);for(e in n)this.each(X(e,n[e],t));return this}if(r<2)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(X(n,t,e))};var Lo=ao.map({mouseenter:"mouseover",mouseleave:"mouseout"});fo&&Lo.forEach(function(n){"on"+n in fo&&Lo.remove(n)});var qo,To=0;ao.mouse=function(n){return J(n,k())};var Ro=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ao.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=k().changedTouches),t)for(var r,i=0,u=t.length;i<u;++i)if((r=t[i]).identifier===e)return J(n,r)},ao.behavior.drag=function(){function n(){this.on("mousedown.drag",u).on("touchstart.drag",o)}function e(n,t,e,u,o){return function(){function a(){var n,e,r=t(h,v);r&&(n=r[0]-M[0],e=r[1]-M[1],g|=n|e,M=r,p({type:"drag",x:r[0]+c[0],y:r[1]+c[1],dx:n,dy:e}))}function l(){t(h,v)&&(y.on(u+d,null).on(o+d,null),m(g),p({type:"dragend"}))}var c,f=this,s=ao.event.target.correspondingElement||ao.event.target,h=f.parentNode,p=r.of(f,arguments),g=0,v=n(),d=".drag"+(null==v?"":"-"+v),y=ao.select(e(s)).on(u+d,a).on(o+d,l),m=W(s),M=t(h,v);i?(c=i.apply(f,arguments),c=[c.x-M[0],c.y-M[1]]):c=[0,0],p({type:"dragstart"})}}var r=N(n,"drag","dragstart","dragend"),i=null,u=e(b,ao.mouse,t,"mousemove","mouseup"),o=e(G,ao.touch,m,"touchmove","touchend");return n.origin=function(t){return arguments.length?(i=t,n):i},ao.rebind(n,r,"on")},ao.touches=function(n,t){return arguments.length<2&&(t=k().touches),t?co(t).map(function(t){var e=J(n,t);return e.identifier=t.identifier,e}):[]};var Do=1e-6,Po=Do*Do,Uo=Math.PI,jo=2*Uo,Fo=jo-Do,Ho=Uo/2,Oo=Uo/180,Io=180/Uo,Yo=Math.SQRT2,Zo=2,Vo=4;ao.interpolateZoom=function(n,t){var e,r,i=n[0],u=n[1],o=n[2],a=t[0],l=t[1],c=t[2],f=a-i,s=l-u,h=f*f+s*s;if(h<Po)r=Math.log(c/o)/Yo,e=function(n){return[i+n*f,u+n*s,o*Math.exp(Yo*n*r)]};else{var p=Math.sqrt(h),g=(c*c-o*o+Vo*h)/(2*o*Zo*p),v=(c*c-o*o-Vo*h)/(2*c*Zo*p),d=Math.log(Math.sqrt(g*g+1)-g),y=Math.log(Math.sqrt(v*v+1)-v);r=(y-d)/Yo,e=function(n){var t=n*r,e=rn(d),a=o/(Zo*p)*(e*un(Yo*t+d)-en(d));return[i+a*f,u+a*s,o*e/rn(Yo*t+d)]}}return e.duration=1e3*r,e},ao.behavior.zoom=function(){function n(n){n.on(L,s).on($o+".zoom",p).on("dblclick.zoom",g).on(R,h)}function e(n){return[(n[0]-k.x)/k.k,(n[1]-k.y)/k.k]}function r(n){return[n[0]*k.k+k.x,n[1]*k.k+k.y]}function i(n){k.k=Math.max(A[0],Math.min(A[1],n))}function u(n,t){t=r(t),k.x+=n[0]-t[0],k.y+=n[1]-t[1]}function o(t,e,r,o){t.__chart__={x:k.x,y:k.y,k:k.k},i(Math.pow(2,o)),u(d=e,r),t=ao.select(t),C>0&&(t=t.transition().duration(C)),t.call(n.event)}function a(){b&&b.domain(x.range().map(function(n){return(n-k.x)/k.k}).map(x.invert)),w&&w.domain(_.range().map(function(n){return(n-k.y)/k.k}).map(_.invert))}function l(n){z++||n({type:"zoomstart"})}function c(n){a(),n({type:"zoom",scale:k.k,translate:[k.x,k.y]})}function f(n){--z||(n({type:"zoomend"}),d=null)}function s(){function n(){a=1,u(ao.mouse(i),h),c(o)}function r(){s.on(q,null).on(T,null),p(a),f(o)}var i=this,o=D.of(i,arguments),a=0,s=ao.select(t(i)).on(q,n).on(T,r),h=e(ao.mouse(i)),p=W(i);Hl.call(i),l(o)}function h(){function n(){var n=ao.touches(g);return p=k.k,n.forEach(function(n){n.identifier in d&&(d[n.identifier]=e(n))}),n}function t(){var t=ao.event.target;ao.select(t).on(x,r).on(b,a),_.push(t);for(var e=ao.event.changedTouches,i=0,u=e.length;i<u;++i)d[e[i].identifier]=null;var l=n(),c=Date.now();if(1===l.length){if(c-M<500){var f=l[0];o(g,f,d[f.identifier],Math.floor(Math.log(k.k)/Math.LN2)+1),S()}M=c}else if(l.length>1){var f=l[0],s=l[1],h=f[0]-s[0],p=f[1]-s[1];y=h*h+p*p}}function r(){var n,t,e,r,o=ao.touches(g);Hl.call(g);for(var a=0,l=o.length;a<l;++a,r=null)if(e=o[a],r=d[e.identifier]){if(t)break;n=e,t=r}if(r){var f=(f=e[0]-n[0])*f+(f=e[1]-n[1])*f,s=y&&Math.sqrt(f/y);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+r[0])/2,(t[1]+r[1])/2],i(s*p)}M=null,u(n,t),c(v)}function a(){if(ao.event.touches.length){for(var t=ao.event.changedTouches,e=0,r=t.length;e<r;++e)delete d[t[e].identifier];for(var i in d)return void n()}ao.selectAll(_).on(m,null),w.on(L,s).on(R,h),N(),f(v)}var p,g=this,v=D.of(g,arguments),d={},y=0,m=".zoom-"+ao.event.changedTouches[0].identifier,x="touchmove"+m,b="touchend"+m,_=[],w=ao.select(g),N=W(g);t(),l(v),w.on(L,null).on(R,t)}function p(){var n=D.of(this,arguments);m?clearTimeout(m):(Hl.call(this),v=e(d=y||ao.mouse(this)),l(n)),m=setTimeout(function(){m=null,f(n)},50),S(),i(Math.pow(2,.002*Xo())*k.k),u(d,v),c(n)}function g(){var n=ao.mouse(this),t=Math.log(k.k)/Math.LN2;o(this,n,e(n),ao.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1)}var v,d,y,m,M,x,b,_,w,k={x:0,y:0,k:1},E=[960,500],A=Bo,C=250,z=0,L="mousedown.zoom",q="mousemove.zoom",T="mouseup.zoom",R="touchstart.zoom",D=N(n,"zoomstart","zoom","zoomend");return $o||($o="onwheel"in fo?(Xo=function(){return-ao.event.deltaY*(ao.event.deltaMode?120:1)},"wheel"):"onmousewheel"in fo?(Xo=function(){return ao.event.wheelDelta},"mousewheel"):(Xo=function(){return-ao.event.detail},"MozMousePixelScroll")),n.event=function(n){n.each(function(){var n=D.of(this,arguments),t=k;jl?ao.select(this).transition().each("start.zoom",function(){k=this.__chart__||{x:0,y:0,k:1},l(n)}).tween("zoom:zoom",function(){var e=E[0],r=E[1],i=d?d[0]:e/2,u=d?d[1]:r/2,o=ao.interpolateZoom([(i-k.x)/k.k,(u-k.y)/k.k,e/k.k],[(i-t.x)/t.k,(u-t.y)/t.k,e/t.k]);return function(t){var r=o(t),a=e/r[2];this.__chart__=k={x:i-r[0]*a,y:u-r[1]*a,k:a},c(n)}}).each("interrupt.zoom",function(){f(n)}).each("end.zoom",function(){f(n)}):(this.__chart__=k,l(n),c(n),f(n))})},n.translate=function(t){return arguments.length?(k={x:+t[0],y:+t[1],k:k.k},a(),n):[k.x,k.y]},n.scale=function(t){return arguments.length?(k={x:k.x,y:k.y,k:null},i(+t),a(),n):k.k},n.scaleExtent=function(t){return arguments.length?(A=null==t?Bo:[+t[0],+t[1]],n):A},n.center=function(t){return arguments.length?(y=t&&[+t[0],+t[1]],n):y},n.size=function(t){return arguments.length?(E=t&&[+t[0],+t[1]],n):E},n.duration=function(t){return arguments.length?(C=+t,n):C},n.x=function(t){return arguments.length?(b=t,x=t.copy(),k={x:0,y:0,k:1},n):b},n.y=function(t){return arguments.length?(w=t,_=t.copy(),k={x:0,y:0,k:1},n):w},ao.rebind(n,D,"on")};var Xo,$o,Bo=[0,1/0];ao.color=an,an.prototype.toString=function(){return this.rgb()+""},ao.hsl=ln;var Wo=ln.prototype=new an;Wo.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),new ln(this.h,this.s,this.l/n)},Wo.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new ln(this.h,this.s,n*this.l)},Wo.rgb=function(){return cn(this.h,this.s,this.l)},ao.hcl=fn;var Jo=fn.prototype=new an;Jo.brighter=function(n){return new fn(this.h,this.c,Math.min(100,this.l+Go*(arguments.length?n:1)))},Jo.darker=function(n){return new fn(this.h,this.c,Math.max(0,this.l-Go*(arguments.length?n:1)))},Jo.rgb=function(){return sn(this.h,this.c,this.l).rgb()},ao.lab=hn;var Go=18,Ko=.95047,Qo=1,na=1.08883,ta=hn.prototype=new an;ta.brighter=function(n){return new hn(Math.min(100,this.l+Go*(arguments.length?n:1)),this.a,this.b)},ta.darker=function(n){return new hn(Math.max(0,this.l-Go*(arguments.length?n:1)),this.a,this.b)},ta.rgb=function(){return pn(this.l,this.a,this.b)},ao.rgb=mn;var ea=mn.prototype=new an;ea.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,i=30;return t||e||r?(t&&t<i&&(t=i),e&&e<i&&(e=i),r&&r<i&&(r=i),new mn(Math.min(255,t/n),Math.min(255,e/n),Math.min(255,r/n))):new mn(i,i,i)},ea.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new mn(n*this.r,n*this.g,n*this.b)},ea.hsl=function(){return wn(this.r,this.g,this.b)},ea.toString=function(){return"#"+bn(this.r)+bn(this.g)+bn(this.b)};var ra=ao.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});ra.forEach(function(n,t){ra.set(n,Mn(t))}),ao.functor=En,ao.xhr=An(m),ao.dsv=function(n,t){function e(n,e,u){arguments.length<3&&(u=e,e=null);var o=Cn(n,t,null==e?r:i(e),u);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:i(n)):e},o}function r(n){return e.parse(n.responseText)}function i(n){return function(t){return e.parse(t.responseText,n)}}function u(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),l=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var i=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(i(n),e)}:i})},e.parseRows=function(n,t){function e(){if(f>=c)return o;if(i)return i=!1,u;var t=f;if(34===n.charCodeAt(t)){for(var e=t;e++<c;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}f=e+2;var r=n.charCodeAt(e+1);return 13===r?(i=!0,10===n.charCodeAt(e+2)&&++f):10===r&&(i=!0),n.slice(t+1,e).replace(/""/g,'"')}for(;f<c;){var r=n.charCodeAt(f++),a=1;if(10===r)i=!0;else if(13===r)i=!0,10===n.charCodeAt(f)&&(++f,++a);else if(r!==l)continue;return n.slice(t,f-a)}return n.slice(t)}for(var r,i,u={},o={},a=[],c=n.length,f=0,s=0;(r=e())!==o;){for(var h=[];r!==u&&r!==o;)h.push(r),r=e();t&&null==(h=t(h,s++))||a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new y,i=[];return t.forEach(function(n){for(var t in n)r.has(t)||i.push(r.add(t))}),[i.map(o).join(n)].concat(t.map(function(t){return i.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(u).join("\n")},e},ao.csv=ao.dsv(",","text/csv"),ao.tsv=ao.dsv("\t","text/tab-separated-values");var ia,ua,oa,aa,la=this[x(this,"requestAnimationFrame")]||function(n){setTimeout(n,17)};ao.timer=function(){qn.apply(this,arguments)},ao.timer.flush=function(){Rn(),Dn()},ao.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var ca=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Un);ao.formatPrefix=function(n,t){var e=0;return(n=+n)&&(n<0&&(n*=-1),t&&(n=ao.round(n,Pn(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),ca[8+e/3]};var fa=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,sa=ao.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=ao.round(n,Pn(n,t))).toFixed(Math.max(0,Math.min(20,Pn(n*(1+1e-15),t))))}}),ha=ao.time={},pa=Date;Hn.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ga.setUTCDate.apply(this._,arguments)},setDay:function(){ga.setUTCDay.apply(this._,arguments)},setFullYear:function(){ga.setUTCFullYear.apply(this._,arguments)},setHours:function(){ga.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ga.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ga.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ga.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ga.setUTCSeconds.apply(this._,arguments)},setTime:function(){ga.setTime.apply(this._,arguments)}};var ga=Date.prototype;ha.year=On(function(n){return n=ha.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),ha.years=ha.year.range,ha.years.utc=ha.year.utc.range,ha.day=On(function(n){var t=new pa(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),ha.days=ha.day.range,ha.days.utc=ha.day.utc.range,ha.dayOfYear=function(n){var t=ha.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var e=ha[n]=On(function(n){return(n=ha.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=ha.year(n).getDay();return Math.floor((ha.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});ha[n+"s"]=e.range,ha[n+"s"].utc=e.utc.range,ha[n+"OfYear"]=function(n){var e=ha.year(n).getDay();return Math.floor((ha.dayOfYear(n)+(e+t)%7)/7)}}),ha.week=ha.sunday,ha.weeks=ha.sunday.range,ha.weeks.utc=ha.sunday.utc.range,ha.weekOfYear=ha.sundayOfYear;var va={"-":"",_:" ",0:"0"},da=/^\s*\d+/,ya=/^%/;ao.locale=function(n){return{numberFormat:jn(n),timeFormat:Yn(n)}};var ma=ao.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],
 shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ao.format=ma.numberFormat,ao.geo={},ft.prototype={s:0,t:0,add:function(n){st(n,this.t,Ma),st(Ma.s,this.s,this),this.s?this.t+=Ma.t:this.s=Ma.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var Ma=new ft;ao.geo.stream=function(n,t){n&&xa.hasOwnProperty(n.type)?xa[n.type](n,t):ht(n,t)};var xa={Feature:function(n,t){ht(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,i=e.length;++r<i;)ht(e[r].geometry,t)}},ba={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){pt(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)pt(e[r],t,0)},Polygon:function(n,t){gt(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)gt(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,i=e.length;++r<i;)ht(e[r],t)}};ao.geo.area=function(n){return _a=0,ao.geo.stream(n,Sa),_a};var _a,wa=new ft,Sa={sphere:function(){_a+=4*Uo},point:b,lineStart:b,lineEnd:b,polygonStart:function(){wa.reset(),Sa.lineStart=vt},polygonEnd:function(){var n=2*wa;_a+=n<0?4*Uo+n:n,Sa.lineStart=Sa.lineEnd=Sa.point=b}};ao.geo.bounds=function(){function n(n,t){M.push(x=[f=n,h=n]),t<s&&(s=t),t>p&&(p=t)}function t(t,e){var r=dt([t*Oo,e*Oo]);if(y){var i=mt(y,r),u=[i[1],-i[0],0],o=mt(u,i);bt(o),o=_t(o);var l=t-g,c=l>0?1:-1,v=o[0]*Io*c,d=mo(l)>180;if(d^(c*g<v&&v<c*t)){var m=o[1]*Io;m>p&&(p=m)}else if(v=(v+360)%360-180,d^(c*g<v&&v<c*t)){var m=-o[1]*Io;m<s&&(s=m)}else e<s&&(s=e),e>p&&(p=e);d?t<g?a(f,t)>a(f,h)&&(h=t):a(t,h)>a(f,h)&&(f=t):h>=f?(t<f&&(f=t),t>h&&(h=t)):t>g?a(f,t)>a(f,h)&&(h=t):a(t,h)>a(f,h)&&(f=t)}else n(t,e);y=r,g=t}function e(){b.point=t}function r(){x[0]=f,x[1]=h,b.point=n,y=null}function i(n,e){if(y){var r=n-g;m+=mo(r)>180?r+(r>0?360:-360):r}else v=n,d=e;Sa.point(n,e),t(n,e)}function u(){Sa.lineStart()}function o(){i(v,d),Sa.lineEnd(),mo(m)>Do&&(f=-(h=180)),x[0]=f,x[1]=h,y=null}function a(n,t){return(t-=n)<0?t+360:t}function l(n,t){return n[0]-t[0]}function c(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var f,s,h,p,g,v,d,y,m,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=i,b.lineStart=u,b.lineEnd=o,m=0,Sa.polygonStart()},polygonEnd:function(){Sa.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,wa<0?(f=-(h=180),s=-(p=90)):m>Do?p=90:m<-Do&&(s=-90),x[0]=f,x[1]=h}};return function(n){p=h=-(f=s=1/0),M=[],ao.geo.stream(n,b);var t=M.length;if(t){M.sort(l);for(var e,r=1,i=M[0],u=[i];r<t;++r)e=M[r],c(e[0],i)||c(e[1],i)?(a(i[0],e[1])>a(i[0],i[1])&&(i[1]=e[1]),a(e[0],i[1])>a(i[0],i[1])&&(i[0]=e[0])):u.push(i=e);for(var o,e,g=-(1/0),t=u.length-1,r=0,i=u[t];r<=t;i=e,++r)e=u[r],(o=a(i[1],e[0]))>g&&(g=o,f=e[0],h=i[1])}return M=x=null,f===1/0||s===1/0?[[NaN,NaN],[NaN,NaN]]:[[f,s],[h,p]]}}(),ao.geo.centroid=function(n){ka=Na=Ea=Aa=Ca=za=La=qa=Ta=Ra=Da=0,ao.geo.stream(n,Pa);var t=Ta,e=Ra,r=Da,i=t*t+e*e+r*r;return i<Po&&(t=za,e=La,r=qa,Na<Do&&(t=Ea,e=Aa,r=Ca),i=t*t+e*e+r*r,i<Po)?[NaN,NaN]:[Math.atan2(e,t)*Io,tn(r/Math.sqrt(i))*Io]};var ka,Na,Ea,Aa,Ca,za,La,qa,Ta,Ra,Da,Pa={sphere:b,point:St,lineStart:Nt,lineEnd:Et,polygonStart:function(){Pa.lineStart=At},polygonEnd:function(){Pa.lineStart=Nt}},Ua=Rt(zt,jt,Ht,[-Uo,-Uo/2]),ja=1e9;ao.geo.clipExtent=function(){var n,t,e,r,i,u,o={stream:function(n){return i&&(i.valid=!1),i=u(n),i.valid=!0,i},extent:function(a){return arguments.length?(u=Zt(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),i&&(i.valid=!1,i=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(ao.geo.conicEqualArea=function(){return Vt(Xt)}).raw=Xt,ao.geo.albers=function(){return ao.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ao.geo.albersUsa=function(){function n(n){var u=n[0],o=n[1];return t=null,e(u,o),t||(r(u,o),t)||i(u,o),t}var t,e,r,i,u=ao.geo.albers(),o=ao.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=ao.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=u.scale(),e=u.translate(),r=(n[0]-e[0])/t,i=(n[1]-e[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?o:i>=.166&&i<.234&&r>=-.214&&r<-.115?a:u).invert(n)},n.stream=function(n){var t=u.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,i){t.point(n,i),e.point(n,i),r.point(n,i)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(u.precision(t),o.precision(t),a.precision(t),n):u.precision()},n.scale=function(t){return arguments.length?(u.scale(t),o.scale(.35*t),a.scale(t),n.translate(u.translate())):u.scale()},n.translate=function(t){if(!arguments.length)return u.translate();var c=u.scale(),f=+t[0],s=+t[1];return e=u.translate(t).clipExtent([[f-.455*c,s-.238*c],[f+.455*c,s+.238*c]]).stream(l).point,r=o.translate([f-.307*c,s+.201*c]).clipExtent([[f-.425*c+Do,s+.12*c+Do],[f-.214*c-Do,s+.234*c-Do]]).stream(l).point,i=a.translate([f-.205*c,s+.212*c]).clipExtent([[f-.214*c+Do,s+.166*c+Do],[f-.115*c-Do,s+.234*c-Do]]).stream(l).point,n},n.scale(1070)};var Fa,Ha,Oa,Ia,Ya,Za,Va={point:b,lineStart:b,lineEnd:b,polygonStart:function(){Ha=0,Va.lineStart=$t},polygonEnd:function(){Va.lineStart=Va.lineEnd=Va.point=b,Fa+=mo(Ha/2)}},Xa={point:Bt,lineStart:b,lineEnd:b,polygonStart:b,polygonEnd:b},$a={point:Gt,lineStart:Kt,lineEnd:Qt,polygonStart:function(){$a.lineStart=ne},polygonEnd:function(){$a.point=Gt,$a.lineStart=Kt,$a.lineEnd=Qt}};ao.geo.path=function(){function n(n){return n&&("function"==typeof a&&u.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=i(u)),ao.geo.stream(n,o)),u.result()}function t(){return o=null,n}var e,r,i,u,o,a=4.5;return n.area=function(n){return Fa=0,ao.geo.stream(n,i(Va)),Fa},n.centroid=function(n){return Ea=Aa=Ca=za=La=qa=Ta=Ra=Da=0,ao.geo.stream(n,i($a)),Da?[Ta/Da,Ra/Da]:qa?[za/qa,La/qa]:Ca?[Ea/Ca,Aa/Ca]:[NaN,NaN]},n.bounds=function(n){return Ya=Za=-(Oa=Ia=1/0),ao.geo.stream(n,i(Xa)),[[Oa,Ia],[Ya,Za]]},n.projection=function(n){return arguments.length?(i=(e=n)?n.stream||re(n):m,t()):e},n.context=function(n){return arguments.length?(u=null==(r=n)?new Wt:new te(n),"function"!=typeof a&&u.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(u.pointRadius(+t),+t),n):a},n.projection(ao.geo.albersUsa()).context(null)},ao.geo.transform=function(n){return{stream:function(t){var e=new ie(t);for(var r in n)e[r]=n[r];return e}}},ie.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ao.geo.projection=oe,ao.geo.projectionMutator=ae,(ao.geo.equirectangular=function(){return oe(ce)}).raw=ce.invert=ce,ao.geo.rotation=function(n){function t(t){return t=n(t[0]*Oo,t[1]*Oo),t[0]*=Io,t[1]*=Io,t}return n=se(n[0]%360*Oo,n[1]*Oo,n.length>2?n[2]*Oo:0),t.invert=function(t){return t=n.invert(t[0]*Oo,t[1]*Oo),t[0]*=Io,t[1]*=Io,t},t},fe.invert=ce,ao.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=se(-n[0]*Oo,-n[1]*Oo,0).invert,i=[];return e(null,null,1,{point:function(n,e){i.push(n=t(n,e)),n[0]*=Io,n[1]*=Io}}),{type:"Polygon",coordinates:[i]}}var t,e,r=[0,0],i=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=ve((t=+r)*Oo,i*Oo),n):t},n.precision=function(r){return arguments.length?(e=ve(t*Oo,(i=+r)*Oo),n):i},n.angle(90)},ao.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Oo,i=n[1]*Oo,u=t[1]*Oo,o=Math.sin(r),a=Math.cos(r),l=Math.sin(i),c=Math.cos(i),f=Math.sin(u),s=Math.cos(u);return Math.atan2(Math.sqrt((e=s*o)*e+(e=c*f-l*s*a)*e),l*f+c*s*a)},ao.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return ao.range(Math.ceil(u/d)*d,i,d).map(h).concat(ao.range(Math.ceil(c/y)*y,l,y).map(p)).concat(ao.range(Math.ceil(r/g)*g,e,g).filter(function(n){return mo(n%d)>Do}).map(f)).concat(ao.range(Math.ceil(a/v)*v,o,v).filter(function(n){return mo(n%y)>Do}).map(s))}var e,r,i,u,o,a,l,c,f,s,h,p,g=10,v=g,d=90,y=360,m=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(u).concat(p(l).slice(1),h(i).reverse().slice(1),p(c).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(u=+t[0][0],i=+t[1][0],c=+t[0][1],l=+t[1][1],u>i&&(t=u,u=i,i=t),c>l&&(t=c,c=l,l=t),n.precision(m)):[[u,c],[i,l]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(m)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],y=+t[1],n):[d,y]},n.minorStep=function(t){return arguments.length?(g=+t[0],v=+t[1],n):[g,v]},n.precision=function(t){return arguments.length?(m=+t,f=ye(a,o,90),s=me(r,e,m),h=ye(c,l,90),p=me(u,i,m),n):m},n.majorExtent([[-180,-90+Do],[180,90-Do]]).minorExtent([[-180,-80-Do],[180,80+Do]])},ao.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||i.apply(this,arguments)]}}var t,e,r=Me,i=xe;return n.distance=function(){return ao.geo.distance(t||r.apply(this,arguments),e||i.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(i=t,e="function"==typeof t?null:t,n):i},n.precision=function(){return arguments.length?n:0},n},ao.geo.interpolate=function(n,t){return be(n[0]*Oo,n[1]*Oo,t[0]*Oo,t[1]*Oo)},ao.geo.length=function(n){return Ba=0,ao.geo.stream(n,Wa),Ba};var Ba,Wa={sphere:b,point:b,lineStart:_e,lineEnd:b,polygonStart:b,polygonEnd:b},Ja=we(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(ao.geo.azimuthalEqualArea=function(){return oe(Ja)}).raw=Ja;var Ga=we(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},m);(ao.geo.azimuthalEquidistant=function(){return oe(Ga)}).raw=Ga,(ao.geo.conicConformal=function(){return Vt(Se)}).raw=Se,(ao.geo.conicEquidistant=function(){return Vt(ke)}).raw=ke;var Ka=we(function(n){return 1/n},Math.atan);(ao.geo.gnomonic=function(){return oe(Ka)}).raw=Ka,Ne.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Ho]},(ao.geo.mercator=function(){return Ee(Ne)}).raw=Ne;var Qa=we(function(){return 1},Math.asin);(ao.geo.orthographic=function(){return oe(Qa)}).raw=Qa;var nl=we(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(ao.geo.stereographic=function(){return oe(nl)}).raw=nl,Ae.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-Ho]},(ao.geo.transverseMercator=function(){var n=Ee(Ae),t=n.center,e=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},n.rotate=function(n){return n?e([n[0],n[1],n.length>2?n[2]+90:90]):(n=e(),[n[0],n[1],n[2]-90])},e([0,0,90])}).raw=Ae,ao.geom={},ao.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,i=En(e),u=En(r),o=n.length,a=[],l=[];for(t=0;t<o;t++)a.push([+i.call(this,n[t],t),+u.call(this,n[t],t),t]);for(a.sort(qe),t=0;t<o;t++)l.push([a[t][0],-a[t][1]]);var c=Le(a),f=Le(l),s=f[0]===c[0],h=f[f.length-1]===c[c.length-1],p=[];for(t=c.length-1;t>=0;--t)p.push(n[a[c[t]][2]]);for(t=+s;t<f.length-h;++t)p.push(n[a[f[t]][2]]);return p}var e=Ce,r=ze;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},ao.geom.polygon=function(n){return wo(n,tl),n};var tl=ao.geom.polygon.prototype=[];tl.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],i=0;++t<e;)n=r,r=this[t],i+=n[1]*r[0]-n[0]*r[1];return.5*i},tl.centroid=function(n){var t,e,r=-1,i=this.length,u=0,o=0,a=this[i-1];for(arguments.length||(n=-1/(6*this.area()));++r<i;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],u+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[u*n,o*n]},tl.clip=function(n){for(var t,e,r,i,u,o,a=De(n),l=-1,c=this.length-De(this),f=this[c-1];++l<c;){for(t=n.slice(),n.length=0,i=this[l],u=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],Te(o,f,i)?(Te(u,f,i)||n.push(Re(u,o,f,i)),n.push(o)):Te(u,f,i)&&n.push(Re(u,o,f,i)),u=o;a&&n.push(n[0]),f=i}return n};var el,rl,il,ul,ol,al=[],ll=[];Ye.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)n=t[e].edge,n.b&&n.a||t.splice(e,1);return t.sort(Ve),t.length},tr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},er.prototype={insert:function(n,t){var e,r,i;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else this._?(n=or(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)r=e.U,e===r.L?(i=r.R,i&&i.C?(e.C=i.C=!1,r.C=!0,n=r):(n===e.R&&(ir(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ur(this,r))):(i=r.L,i&&i.C?(e.C=i.C=!1,r.C=!0,n=r):(n===e.L&&(ur(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ir(this,r))),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,i=n.U,u=n.L,o=n.R;if(e=u?o?or(o):u:o,i?i.L===n?i.L=e:i.R=e:this._=e,u&&o?(r=e.C,e.C=n.C,e.L=u,u.U=e,e!==o?(i=e.U,e.U=n.U,n=e.R,i.L=n,e.R=o,o.U=e):(e.U=i,i=e,n=e.R)):(r=n.C,n=e),n&&(n.U=i),!r){if(n&&n.C)return void(n.C=!1);do{if(n===this._)break;if(n===i.L){if(t=i.R,t.C&&(t.C=!1,i.C=!0,ir(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ur(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,ir(this,i),n=this._;break}}else if(t=i.L,t.C&&(t.C=!1,i.C=!0,ur(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ir(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,ur(this,i),n=this._;break}t.C=!0,n=i,i=i.U}while(!n.C);n&&(n.C=!1)}}},ao.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],i=a[0][1],u=a[1][0],o=a[1][1];return ar(e(n),a).cells.forEach(function(e,a){var l=e.edges,c=e.site,f=t[a]=l.length?l.map(function(n){var t=n.start();return[t.x,t.y]}):c.x>=r&&c.x<=u&&c.y>=i&&c.y<=o?[[r,o],[u,o],[u,i],[r,i]]:[];f.point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(u(n,t)/Do)*Do,y:Math.round(o(n,t)/Do)*Do,i:t}})}var r=Ce,i=ze,u=r,o=i,a=cl;return n?t(n):(t.links=function(n){return ar(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return ar(e(n)).cells.forEach(function(e,r){for(var i,u,o=e.site,a=e.edges.sort(Ve),l=-1,c=a.length,f=a[c-1].edge,s=f.l===o?f.r:f.l;++l<c;)i=f,u=s,f=a[l].edge,s=f.l===o?f.r:f.l,r<u.i&&r<s.i&&cr(o,u,s)<0&&t.push([n[r],n[u.i],n[s.i]])}),t},t.x=function(n){return arguments.length?(u=En(r=n),t):r},t.y=function(n){return arguments.length?(o=En(i=n),t):i},t.clipExtent=function(n){return arguments.length?(a=null==n?cl:n,t):a===cl?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===cl?null:a&&a[1]},t)};var cl=[[-1e6,-1e6],[1e6,1e6]];ao.geom.delaunay=function(n){return ao.geom.voronoi().triangles(n)},ao.geom.quadtree=function(n,t,e,r,i){function u(n){function u(n,t,e,r,i,u,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var l=n.x,f=n.y;if(null!=l)if(mo(l-e)+mo(f-r)<.01)c(n,t,e,r,i,u,o,a);else{var s=n.point;n.x=n.y=n.point=null,c(n,s,l,f,i,u,o,a),c(n,t,e,r,i,u,o,a)}else n.x=e,n.y=r,n.point=t}else c(n,t,e,r,i,u,o,a)}function c(n,t,e,r,i,o,a,l){var c=.5*(i+a),f=.5*(o+l),s=e>=c,h=r>=f,p=h<<1|s;n.leaf=!1,n=n.nodes[p]||(n.nodes[p]=hr()),s?i=c:a=c,h?o=f:l=f,u(n,t,e,r,i,o,a,l)}var f,s,h,p,g,v,d,y,m,M=En(a),x=En(l);if(null!=t)v=t,d=e,y=r,m=i;else if(y=m=-(v=d=1/0),s=[],h=[],g=n.length,o)for(p=0;p<g;++p)f=n[p],f.x<v&&(v=f.x),f.y<d&&(d=f.y),f.x>y&&(y=f.x),f.y>m&&(m=f.y),s.push(f.x),h.push(f.y);else for(p=0;p<g;++p){var b=+M(f=n[p],p),_=+x(f,p);b<v&&(v=b),_<d&&(d=_),b>y&&(y=b),_>m&&(m=_),s.push(b),h.push(_)}var w=y-v,S=m-d;w>S?m=d+w:y=v+S;var k=hr();if(k.add=function(n){u(k,n,+M(n,++p),+x(n,p),v,d,y,m)},k.visit=function(n){pr(n,k,v,d,y,m)},k.find=function(n){return gr(k,n[0],n[1],v,d,y,m)},p=-1,null==t){for(;++p<g;)u(k,n[p],s[p],h[p],v,d,y,m);--p}else n.forEach(k.add);return s=h=n=f=null,k}var o,a=Ce,l=ze;return(o=arguments.length)?(a=fr,l=sr,3===o&&(i=e,r=t,e=t=0),u(n)):(u.x=function(n){return arguments.length?(a=n,u):a},u.y=function(n){return arguments.length?(l=n,u):l},u.extent=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],i=+n[1][1]),u):null==t?null:[[t,e],[r,i]]},u.size=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=e=0,r=+n[0],i=+n[1]),u):null==t?null:[r-t,i-e]},u)},ao.interpolateRgb=vr,ao.interpolateObject=dr,ao.interpolateNumber=yr,ao.interpolateString=mr;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,sl=new RegExp(fl.source,"g");ao.interpolate=Mr,ao.interpolators=[function(n,t){var e=typeof t;return("string"===e?ra.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?vr:mr:t instanceof an?vr:Array.isArray(t)?xr:"object"===e&&isNaN(t)?dr:yr)(n,t)}],ao.interpolateArray=xr;var hl=function(){return m},pl=ao.map({linear:hl,poly:Er,quad:function(){return Sr},cubic:function(){return kr},sin:function(){return Ar},exp:function(){return Cr},circle:function(){return zr},elastic:Lr,back:qr,bounce:function(){return Tr}}),gl=ao.map({in:m,out:_r,"in-out":wr,"out-in":function(n){return wr(_r(n))}});ao.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.slice(0,t):n,r=t>=0?n.slice(t+1):"in";return e=pl.get(e)||hl,r=gl.get(r)||m,br(r(e.apply(null,lo.call(arguments,1))))},ao.interpolateHcl=Rr,ao.interpolateHsl=Dr,ao.interpolateLab=Pr,ao.interpolateRound=Ur,ao.transform=function(n){var t=fo.createElementNS(ao.ns.prefix.svg,"g");return(ao.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new jr(e?e.matrix:vl)})(n)},jr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var vl={a:1,b:0,c:0,d:1,e:0,f:0};ao.interpolateTransform=$r,ao.layout={},ao.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Jr(n[e]));return t}},ao.layout.chord=function(){function n(){var n,c,s,h,p,g={},v=[],d=ao.range(u),y=[];for(e=[],r=[],n=0,h=-1;++h<u;){for(c=0,p=-1;++p<u;)c+=i[h][p];v.push(c),y.push(ao.range(u)),n+=c}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&y.forEach(function(n,t){n.sort(function(n,e){return a(i[t][n],i[t][e])})}),n=(jo-f*u)/n,c=0,h=-1;++h<u;){for(s=c,p=-1;++p<u;){var m=d[h],M=y[m][p],x=i[m][M],b=c,_=c+=x*n;g[m+"-"+M]={index:m,subindex:M,startAngle:b,endAngle:_,value:x}}r[m]={index:m,startAngle:s,endAngle:c,value:v[m]},c+=f}for(h=-1;++h<u;)for(p=h-1;++p<u;){var w=g[h+"-"+p],S=g[p+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}l&&t()}function t(){e.sort(function(n,t){return l((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,i,u,o,a,l,c={},f=0;return c.matrix=function(n){return arguments.length?(u=(i=n)&&i.length,e=r=null,c):i},c.padding=function(n){return arguments.length?(f=n,e=r=null,c):f},c.sortGroups=function(n){return arguments.length?(o=n,e=r=null,c):o},c.sortSubgroups=function(n){return arguments.length?(a=n,e=null,c):a},c.sortChords=function(n){return arguments.length?(l=n,e&&t(),c):l},c.chords=function(){return e||n(),e},c.groups=function(){return r||n(),r},c},ao.layout.force=function(){function n(n){return function(t,e,r,i){if(t.point!==n){var u=t.cx-n.x,o=t.cy-n.y,a=i-e,l=u*u+o*o;if(a*a/y<l){if(l<v){var c=t.charge/l;n.px-=u*c,n.py-=o*c}return!0}if(t.point&&l&&l<v){var c=t.pointCharge/l;n.px-=u*c,n.py-=o*c}}return!t.charge}}function t(n){n.px=ao.event.x,n.py=ao.event.y,l.resume()}var e,r,i,u,o,a,l={},c=ao.dispatch("start","tick","end"),f=[1,1],s=.9,h=dl,p=yl,g=-30,v=ml,d=.1,y=.64,M=[],x=[];return l.tick=function(){if((i*=.99)<.005)return e=null,c.end({type:"end",alpha:i=0}),!0;var t,r,l,h,p,v,y,m,b,_=M.length,w=x.length;for(r=0;r<w;++r)l=x[r],h=l.source,p=l.target,m=p.x-h.x,b=p.y-h.y,(v=m*m+b*b)&&(v=i*o[r]*((v=Math.sqrt(v))-u[r])/v,m*=v,b*=v,p.x-=m*(y=h.weight+p.weight?h.weight/(h.weight+p.weight):.5),p.y-=b*y,h.x+=m*(y=1-y),h.y+=b*y);if((y=i*d)&&(m=f[0]/2,b=f[1]/2,r=-1,y))for(;++r<_;)l=M[r],l.x+=(m-l.x)*y,l.y+=(b-l.y)*y;if(g)for(ri(t=ao.geom.quadtree(M),i,a),r=-1;++r<_;)(l=M[r]).fixed||t.visit(n(l));for(r=-1;++r<_;)l=M[r],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*s,l.y-=(l.py-(l.py=l.y))*s);c.tick({type:"tick",alpha:i})},l.nodes=function(n){return arguments.length?(M=n,l):M},l.links=function(n){return arguments.length?(x=n,l):x},l.size=function(n){return arguments.length?(f=n,l):f},l.linkDistance=function(n){return arguments.length?(h="function"==typeof n?n:+n,l):h},l.distance=l.linkDistance,l.linkStrength=function(n){return arguments.length?(p="function"==typeof n?n:+n,l):p},l.friction=function(n){return arguments.length?(s=+n,l):s},l.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,l):g},l.chargeDistance=function(n){return arguments.length?(v=n*n,l):Math.sqrt(v)},l.gravity=function(n){return arguments.length?(d=+n,l):d},l.theta=function(n){return arguments.length?(y=n*n,l):Math.sqrt(y)},l.alpha=function(n){return arguments.length?(n=+n,i?n>0?i=n:(e.c=null,e.t=NaN,e=null,c.end({type:"end",alpha:i=0})):n>0&&(c.start({type:"start",alpha:i=n}),e=qn(l.tick)),l):i},l.start=function(){function n(n,r){if(!e){for(e=new Array(i),l=0;l<i;++l)e[l]=[];for(l=0;l<c;++l){var u=x[l];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var o,a=e[t],l=-1,f=a.length;++l<f;)if(!isNaN(o=a[l][n]))return o;return Math.random()*r}var t,e,r,i=M.length,c=x.length,s=f[0],v=f[1];for(t=0;t<i;++t)(r=M[t]).index=t,r.weight=0;for(t=0;t<c;++t)r=x[t],"number"==typeof r.source&&(r.source=M[r.source]),"number"==typeof r.target&&(r.target=M[r.target]),++r.source.weight,++r.target.weight;for(t=0;t<i;++t)r=M[t],isNaN(r.x)&&(r.x=n("x",s)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof h)for(t=0;t<c;++t)u[t]=+h.call(this,x[t],t);else for(t=0;t<c;++t)u[t]=h;if(o=[],"function"==typeof p)for(t=0;t<c;++t)o[t]=+p.call(this,x[t],t);else for(t=0;t<c;++t)o[t]=p;if(a=[],"function"==typeof g)for(t=0;t<i;++t)a[t]=+g.call(this,M[t],t);else for(t=0;t<i;++t)a[t]=g;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){return r||(r=ao.behavior.drag().origin(m).on("dragstart.force",Qr).on("drag.force",t).on("dragend.force",ni)),arguments.length?void this.on("mouseover.force",ti).on("mouseout.force",ei).call(r):r},ao.rebind(l,c,"on")};var dl=20,yl=1,ml=1/0;ao.layout.hierarchy=function(){function n(i){var u,o=[i],a=[];for(i.depth=0;null!=(u=o.pop());)if(a.push(u),(c=e.call(n,u,u.depth))&&(l=c.length)){for(var l,c,f;--l>=0;)o.push(f=c[l]),f.parent=u,f.depth=u.depth+1;r&&(u.value=0),u.children=c}else r&&(u.value=+r.call(n,u,u.depth)||0),delete u.children;return oi(i,function(n){var e,i;t&&(e=n.children)&&e.sort(t),r&&(i=n.parent)&&(i.value+=n.value)}),a}var t=ci,e=ai,r=li;return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(r=t,n):r},n.revalue=function(t){return r&&(ui(t,function(n){n.children&&(n.value=0)}),oi(t,function(t){var e;t.children||(t.value=+r.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},n},ao.layout.partition=function(){function n(t,e,r,i){var u=t.children;if(t.x=e,t.y=t.depth*i,t.dx=r,t.dy=i,u&&(o=u.length)){var o,a,l,c=-1;for(r=t.value?r/t.value:0;++c<o;)n(a=u[c],e,l=a.value*r,i),e+=l}}function t(n){var e=n.children,r=0;if(e&&(i=e.length))for(var i,u=-1;++u<i;)r=Math.max(r,t(e[u]));return 1+r}function e(e,u){var o=r.call(this,e,u);return n(o[0],0,i[0],i[1]/t(o[0])),o}var r=ao.layout.hierarchy(),i=[1,1];return e.size=function(n){return arguments.length?(i=n,e):i},ii(e,r)},ao.layout.pie=function(){function n(o){var a,l=o.length,c=o.map(function(e,r){return+t.call(n,e,r)}),f=+("function"==typeof r?r.apply(this,arguments):r),s=("function"==typeof i?i.apply(this,arguments):i)-f,h=Math.min(Math.abs(s)/l,+("function"==typeof u?u.apply(this,arguments):u)),p=h*(s<0?-1:1),g=ao.sum(c),v=g?(s-l*p)/g:0,d=ao.range(l),y=[];return null!=e&&d.sort(e===Ml?function(n,t){return c[t]-c[n]}:function(n,t){return e(o[n],o[t])}),d.forEach(function(n){y[n]={data:o[n],value:a=c[n],startAngle:f,endAngle:f+=a*v+p,padAngle:h}}),y}var t=Number,e=Ml,r=0,i=jo,u=0;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(i=t,n):i},n.padAngle=function(t){return arguments.length?(u=t,n):u},n};var Ml={};ao.layout.stack=function(){function n(a,l){if(!(h=a.length))return a;var c=a.map(function(e,r){return t.call(n,e,r)}),f=c.map(function(t){return t.map(function(t,e){return[u.call(n,t,e),o.call(n,t,e)]})}),s=e.call(n,f,l);c=ao.permute(c,s),f=ao.permute(f,s);var h,p,g,v,d=r.call(n,f,l),y=c[0].length;for(g=0;g<y;++g)for(i.call(n,c[0][g],v=d[g],f[0][g][1]),p=1;p<h;++p)i.call(n,c[p][g],v+=f[p-1][g][1],f[p][g][1]);return a}var t=m,e=gi,r=vi,i=pi,u=si,o=hi;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:xl.get(t)||gi,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:bl.get(t)||vi,n):r},n.x=function(t){return arguments.length?(u=t,n):u},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(i=t,n):i},n};var xl=ao.map({"inside-out":function(n){var t,e,r=n.length,i=n.map(di),u=n.map(yi),o=ao.range(r).sort(function(n,t){return i[n]-i[t]}),a=0,l=0,c=[],f=[];for(t=0;t<r;++t)e=o[t],a<l?(a+=u[e],c.push(e)):(l+=u[e],f.push(e));return f.reverse().concat(c)},reverse:function(n){return ao.range(n.length).reverse()},default:gi}),bl=ao.map({silhouette:function(n){var t,e,r,i=n.length,u=n[0].length,o=[],a=0,l=[];for(e=0;e<u;++e){for(t=0,r=0;t<i;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;e<u;++e)l[e]=(a-o[e])/2;return l},wiggle:function(n){var t,e,r,i,u,o,a,l,c,f=n.length,s=n[0],h=s.length,p=[];for(p[0]=l=c=0,e=1;e<h;++e){for(t=0,i=0;t<f;++t)i+=n[t][e][1];for(t=0,u=0,a=s[e][0]-s[e-1][0];t<f;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);r<t;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;u+=o*n[t][e][1]}p[e]=l-=i?u/i*a:0,l<c&&(c=l)}for(e=0;e<h;++e)p[e]-=c;return p},expand:function(n){var t,e,r,i=n.length,u=n[0].length,o=1/i,a=[];for(e=0;e<u;++e){for(t=0,r=0;t<i;t++)r+=n[t][e][1];if(r)for(t=0;t<i;t++)n[t][e][1]/=r;else for(t=0;t<i;t++)n[t][e][1]=o}for(e=0;e<u;++e)a[e]=0;return a},zero:vi});ao.layout.histogram=function(){function n(n,u){for(var o,a,l=[],c=n.map(e,this),f=r.call(this,c,u),s=i.call(this,f,c,u),u=-1,h=c.length,p=s.length-1,g=t?1:1/h;++u<p;)o=l[u]=[],o.dx=s[u+1]-(o.x=s[u]),o.y=0;if(p>0)for(u=-1;++u<h;)a=c[u],a>=f[0]&&a<=f[1]&&(o=l[ao.bisect(s,a,1,p)-1],o.y+=g,o.push(n[u]));return l}var t=!0,e=Number,r=bi,i=Mi;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=En(t),n):r},n.bins=function(t){return arguments.length?(i="number"==typeof t?function(n){return xi(n,t)}:En(t),n):i},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},ao.layout.pack=function(){function n(n,u){var o=e.call(this,n,u),a=o[0],l=i[0],c=i[1],f=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,oi(a,function(n){n.r=+f(n.value)}),oi(a,Ni),r){var s=r*(t?1:Math.max(2*a.r/l,2*a.r/c))/2;oi(a,function(n){n.r+=s}),oi(a,Ni),oi(a,function(n){n.r-=s})}return Ci(a,l/2,c/2,t?1:1/Math.max(2*a.r/l,2*a.r/c)),o}var t,e=ao.layout.hierarchy().sort(_i),r=0,i=[1,1];return n.size=function(t){return arguments.length?(i=t,n):i},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},ii(n,e)},ao.layout.tree=function(){function n(n,i){var f=o.call(this,n,i),s=f[0],h=t(s);if(oi(h,e),h.parent.m=-h.z,ui(h,r),c)ui(s,u);else{var p=s,g=s,v=s;ui(s,function(n){n.x<p.x&&(p=n),n.x>g.x&&(g=n),n.depth>v.depth&&(v=n)});var d=a(p,g)/2-p.x,y=l[0]/(g.x+a(g,p)/2+d),m=l[1]/(v.depth||1);ui(s,function(n){n.x=(n.x+d)*y,n.y=n.depth*m})}return f}function t(n){for(var t,e={A:null,children:[n]},r=[e];null!=(t=r.pop());)for(var i,u=t.children,o=0,a=u.length;o<a;++o)r.push((u[o]=i={_:u[o],parent:t,children:(i=u[o].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=i);return e.children[0]}function e(n){var t=n.children,e=n.parent.children,r=n.i?e[n.i-1]:null;if(t.length){Di(n);var u=(t[0].z+t[t.length-1].z)/2;r?(n.z=r.z+a(n._,r._),n.m=n.z-u):n.z=u}else r&&(n.z=r.z+a(n._,r._));n.parent.A=i(n,r,n.parent.A||e[0])}function r(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function i(n,t,e){if(t){for(var r,i=n,u=n,o=t,l=i.parent.children[0],c=i.m,f=u.m,s=o.m,h=l.m;o=Ti(o),i=qi(i),o&&i;)l=qi(l),u=Ti(u),u.a=n,r=o.z+s-i.z-c+a(o._,i._),r>0&&(Ri(Pi(o,n,e),n,r),c+=r,f+=r),s+=o.m,c+=i.m,h+=l.m,f+=u.m;o&&!Ti(u)&&(u.t=o,u.m+=s-f),i&&!qi(l)&&(l.t=i,l.m+=c-h,e=n)}return e}function u(n){n.x*=l[0],n.y=n.depth*l[1]}var o=ao.layout.hierarchy().sort(null).value(null),a=Li,l=[1,1],c=null;return n.separation=function(t){return arguments.length?(a=t,n):a},n.size=function(t){return arguments.length?(c=null==(l=t)?u:null,n):c?null:l},n.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:u,n):c?l:null},ii(n,o)},ao.layout.cluster=function(){function n(n,u){var o,a=t.call(this,n,u),l=a[0],c=0;oi(l,function(n){var t=n.children;t&&t.length?(n.x=ji(t),n.y=Ui(t)):(n.x=o?c+=e(n,o):0,n.y=0,o=n)});var f=Fi(l),s=Hi(l),h=f.x-e(f,s)/2,p=s.x+e(s,f)/2;return oi(l,i?function(n){n.x=(n.x-l.x)*r[0],n.y=(l.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(p-h)*r[0],n.y=(1-(l.y?n.y/l.y:1))*r[1]}),a}var t=ao.layout.hierarchy().sort(null).value(null),e=Li,r=[1,1],i=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(i=null==(r=t),n):i?null:r},n.nodeSize=function(t){return arguments.length?(i=null!=(r=t),n):i?r:null},ii(n,t)},ao.layout.treemap=function(){function n(n,t){for(var e,r,i=-1,u=n.length;++i<u;)r=(e=n[i]).value*(t<0?0:t),e.area=isNaN(r)||r<=0?0:r}function t(e){var u=e.children;if(u&&u.length){var o,a,l,c=s(e),f=[],h=u.slice(),g=1/0,v="slice"===p?c.dx:"dice"===p?c.dy:"slice-dice"===p?1&e.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(n(h,c.dx*c.dy/e.value),f.area=0;(l=h.length)>0;)f.push(o=h[l-1]),f.area+=o.area,"squarify"!==p||(a=r(f,v))<=g?(h.pop(),g=a):(f.area-=f.pop().area,i(f,v,c,!1),v=Math.min(c.dx,c.dy),f.length=f.area=0,g=1/0);f.length&&(i(f,v,c,!0),f.length=f.area=0),u.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var u,o=s(t),a=r.slice(),l=[];for(n(a,o.dx*o.dy/t.value),l.area=0;u=a.pop();)l.push(u),l.area+=u.area,null!=u.z&&(i(l,u.z?o.dx:o.dy,o,!a.length),l.length=l.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,i=0,u=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(e<u&&(u=e),e>i&&(i=e));return r*=r,t*=t,r?Math.max(t*i*g/r,r/(t*u*g)):1/0}function i(n,t,e,r){var i,u=-1,o=n.length,a=e.x,c=e.y,f=t?l(n.area/t):0;
 if(t==e.dx){for((r||f>e.dy)&&(f=e.dy);++u<o;)i=n[u],i.x=a,i.y=c,i.dy=f,a+=i.dx=Math.min(e.x+e.dx-a,f?l(i.area/f):0);i.z=!0,i.dx+=e.x+e.dx-a,e.y+=f,e.dy-=f}else{for((r||f>e.dx)&&(f=e.dx);++u<o;)i=n[u],i.x=a,i.y=c,i.dx=f,c+=i.dy=Math.min(e.y+e.dy-c,f?l(i.area/f):0);i.z=!1,i.dy+=e.y+e.dy-c,e.x+=f,e.dx-=f}}function u(r){var i=o||a(r),u=i[0];return u.x=u.y=0,u.value?(u.dx=c[0],u.dy=c[1]):u.dx=u.dy=0,o&&a.revalue(u),n([u],u.dx*u.dy/u.value),(o?e:t)(u),h&&(o=i),i}var o,a=ao.layout.hierarchy(),l=Math.round,c=[1,1],f=null,s=Oi,h=!1,p="squarify",g=.5*(1+Math.sqrt(5));return u.size=function(n){return arguments.length?(c=n,u):c},u.padding=function(n){function t(t){var e=n.call(u,t,t.depth);return null==e?Oi(t):Ii(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Ii(t,n)}if(!arguments.length)return f;var r;return s=null==(f=n)?Oi:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,u},u.round=function(n){return arguments.length?(l=n?Math.round:Number,u):l!=Number},u.sticky=function(n){return arguments.length?(h=n,o=null,u):h},u.ratio=function(n){return arguments.length?(g=n,u):g},u.mode=function(n){return arguments.length?(p=n+"",u):p},ii(u,a)},ao.random={normal:function(n,t){var e=arguments.length;return e<2&&(t=1),e<1&&(n=0),function(){var e,r,i;do e=2*Math.random()-1,r=2*Math.random()-1,i=e*e+r*r;while(!i||i>1);return n+t*e*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var n=ao.random.normal.apply(ao,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=ao.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,e=0;e<n;e++)t+=Math.random();return t}}},ao.scale={};var _l={floor:m,ceil:m};ao.scale.linear=function(){return Wi([0,1],[0,1],Mr,!1)};var wl={s:1,g:1,p:1,r:1,e:1};ao.scale.log=function(){return ru(ao.scale.linear().domain([0,1]),10,!0,[1,10])};var Sl=ao.format(".0e"),kl={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};ao.scale.pow=function(){return iu(ao.scale.linear(),1,[0,1])},ao.scale.sqrt=function(){return ao.scale.pow().exponent(.5)},ao.scale.ordinal=function(){return ou([],{t:"range",a:[[]]})},ao.scale.category10=function(){return ao.scale.ordinal().range(Nl)},ao.scale.category20=function(){return ao.scale.ordinal().range(El)},ao.scale.category20b=function(){return ao.scale.ordinal().range(Al)},ao.scale.category20c=function(){return ao.scale.ordinal().range(Cl)};var Nl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(xn),El=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(xn),Al=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(xn),Cl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(xn);ao.scale.quantile=function(){return au([],[])},ao.scale.quantize=function(){return lu(0,1,[0,1])},ao.scale.threshold=function(){return cu([.5],[0,1])},ao.scale.identity=function(){return fu([0,1])},ao.svg={},ao.svg.arc=function(){function n(){var n=Math.max(0,+e.apply(this,arguments)),c=Math.max(0,+r.apply(this,arguments)),f=o.apply(this,arguments)-Ho,s=a.apply(this,arguments)-Ho,h=Math.abs(s-f),p=f>s?0:1;if(c<n&&(g=c,c=n,n=g),h>=Fo)return t(c,p)+(n?t(n,1-p):"")+"Z";var g,v,d,y,m,M,x,b,_,w,S,k,N=0,E=0,A=[];if((y=(+l.apply(this,arguments)||0)/2)&&(d=u===zl?Math.sqrt(n*n+c*c):+u.apply(this,arguments),p||(E*=-1),c&&(E=tn(d/c*Math.sin(y))),n&&(N=tn(d/n*Math.sin(y)))),c){m=c*Math.cos(f+E),M=c*Math.sin(f+E),x=c*Math.cos(s-E),b=c*Math.sin(s-E);var C=Math.abs(s-f-2*E)<=Uo?0:1;if(E&&yu(m,M,x,b)===p^C){var z=(f+s)/2;m=c*Math.cos(z),M=c*Math.sin(z),x=b=null}}else m=M=0;if(n){_=n*Math.cos(s-N),w=n*Math.sin(s-N),S=n*Math.cos(f+N),k=n*Math.sin(f+N);var L=Math.abs(f-s+2*N)<=Uo?0:1;if(N&&yu(_,w,S,k)===1-p^L){var q=(f+s)/2;_=n*Math.cos(q),w=n*Math.sin(q),S=k=null}}else _=w=0;if(h>Do&&(g=Math.min(Math.abs(c-n)/2,+i.apply(this,arguments)))>.001){v=n<c^p?0:1;var T=g,R=g;if(h<Uo){var D=null==S?[_,w]:null==x?[m,M]:Re([m,M],[S,k],[x,b],[_,w]),P=m-D[0],U=M-D[1],j=x-D[0],F=b-D[1],H=1/Math.sin(Math.acos((P*j+U*F)/(Math.sqrt(P*P+U*U)*Math.sqrt(j*j+F*F)))/2),O=Math.sqrt(D[0]*D[0]+D[1]*D[1]);R=Math.min(g,(n-O)/(H-1)),T=Math.min(g,(c-O)/(H+1))}if(null!=x){var I=mu(null==S?[_,w]:[S,k],[m,M],c,T,p),Y=mu([x,b],[_,w],c,T,p);g===T?A.push("M",I[0],"A",T,",",T," 0 0,",v," ",I[1],"A",c,",",c," 0 ",1-p^yu(I[1][0],I[1][1],Y[1][0],Y[1][1]),",",p," ",Y[1],"A",T,",",T," 0 0,",v," ",Y[0]):A.push("M",I[0],"A",T,",",T," 0 1,",v," ",Y[0])}else A.push("M",m,",",M);if(null!=S){var Z=mu([m,M],[S,k],n,-R,p),V=mu([_,w],null==x?[m,M]:[x,b],n,-R,p);g===R?A.push("L",V[0],"A",R,",",R," 0 0,",v," ",V[1],"A",n,",",n," 0 ",p^yu(V[1][0],V[1][1],Z[1][0],Z[1][1]),",",1-p," ",Z[1],"A",R,",",R," 0 0,",v," ",Z[0]):A.push("L",V[0],"A",R,",",R," 0 0,",v," ",Z[0])}else A.push("L",_,",",w)}else A.push("M",m,",",M),null!=x&&A.push("A",c,",",c," 0 ",C,",",p," ",x,",",b),A.push("L",_,",",w),null!=S&&A.push("A",n,",",n," 0 ",L,",",1-p," ",S,",",k);return A.push("Z"),A.join("")}function t(n,t){return"M0,"+n+"A"+n+","+n+" 0 1,"+t+" 0,"+-n+"A"+n+","+n+" 0 1,"+t+" 0,"+n}var e=hu,r=pu,i=su,u=zl,o=gu,a=vu,l=du;return n.innerRadius=function(t){return arguments.length?(e=En(t),n):e},n.outerRadius=function(t){return arguments.length?(r=En(t),n):r},n.cornerRadius=function(t){return arguments.length?(i=En(t),n):i},n.padRadius=function(t){return arguments.length?(u=t==zl?zl:En(t),n):u},n.startAngle=function(t){return arguments.length?(o=En(t),n):o},n.endAngle=function(t){return arguments.length?(a=En(t),n):a},n.padAngle=function(t){return arguments.length?(l=En(t),n):l},n.centroid=function(){var n=(+e.apply(this,arguments)+ +r.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Ho;return[Math.cos(t)*n,Math.sin(t)*n]},n};var zl="auto";ao.svg.line=function(){return Mu(m)};var Ll=ao.map({linear:xu,"linear-closed":bu,step:_u,"step-before":wu,"step-after":Su,basis:zu,"basis-open":Lu,"basis-closed":qu,bundle:Tu,cardinal:Eu,"cardinal-open":ku,"cardinal-closed":Nu,monotone:Fu});Ll.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var ql=[0,2/3,1/3,0],Tl=[0,1/3,2/3,0],Rl=[0,1/6,2/3,1/6];ao.svg.line.radial=function(){var n=Mu(Hu);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},wu.reverse=Su,Su.reverse=wu,ao.svg.area=function(){return Ou(m)},ao.svg.area.radial=function(){var n=Ou(Hu);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},ao.svg.chord=function(){function n(n,a){var l=t(this,u,n,a),c=t(this,o,n,a);return"M"+l.p0+r(l.r,l.p1,l.a1-l.a0)+(e(l,c)?i(l.r,l.p1,l.r,l.p0):i(l.r,l.p1,c.r,c.p0)+r(c.r,c.p1,c.a1-c.a0)+i(c.r,c.p1,l.r,l.p0))+"Z"}function t(n,t,e,r){var i=t.call(n,e,r),u=a.call(n,i,r),o=l.call(n,i,r)-Ho,f=c.call(n,i,r)-Ho;return{r:u,a0:o,a1:f,p0:[u*Math.cos(o),u*Math.sin(o)],p1:[u*Math.cos(f),u*Math.sin(f)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>Uo)+",1 "+t}function i(n,t,e,r){return"Q 0,0 "+r}var u=Me,o=xe,a=Iu,l=gu,c=vu;return n.radius=function(t){return arguments.length?(a=En(t),n):a},n.source=function(t){return arguments.length?(u=En(t),n):u},n.target=function(t){return arguments.length?(o=En(t),n):o},n.startAngle=function(t){return arguments.length?(l=En(t),n):l},n.endAngle=function(t){return arguments.length?(c=En(t),n):c},n},ao.svg.diagonal=function(){function n(n,i){var u=t.call(this,n,i),o=e.call(this,n,i),a=(u.y+o.y)/2,l=[u,{x:u.x,y:a},{x:o.x,y:a},o];return l=l.map(r),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=Me,e=xe,r=Yu;return n.source=function(e){return arguments.length?(t=En(e),n):t},n.target=function(t){return arguments.length?(e=En(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},ao.svg.diagonal.radial=function(){var n=ao.svg.diagonal(),t=Yu,e=n.projection;return n.projection=function(n){return arguments.length?e(Zu(t=n)):t},n},ao.svg.symbol=function(){function n(n,r){return(Dl.get(t.call(this,n,r))||$u)(e.call(this,n,r))}var t=Xu,e=Vu;return n.type=function(e){return arguments.length?(t=En(e),n):t},n.size=function(t){return arguments.length?(e=En(t),n):e},n};var Dl=ao.map({circle:$u,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*Ul)),e=t*Ul;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/Pl),e=t*Pl/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/Pl),e=t*Pl/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});ao.svg.symbolTypes=Dl.keys();var Pl=Math.sqrt(3),Ul=Math.tan(30*Oo);Eo.transition=function(n){for(var t,e,r=jl||++Il,i=Ku(n),u=[],o=Fl||{time:Date.now(),ease:Nr,delay:0,duration:250},a=-1,l=this.length;++a<l;){u.push(t=[]);for(var c=this[a],f=-1,s=c.length;++f<s;)(e=c[f])&&Qu(e,f,i,r,o),t.push(e)}return Wu(u,i,r)},Eo.interrupt=function(n){return this.each(null==n?Hl:Bu(Ku(n)))};var jl,Fl,Hl=Bu(Ku()),Ol=[],Il=0;Ol.call=Eo.call,Ol.empty=Eo.empty,Ol.node=Eo.node,Ol.size=Eo.size,ao.transition=function(n,t){return n&&n.transition?jl?n.transition(t):n:ao.selection().transition(n)},ao.transition.prototype=Ol,Ol.select=function(n){var t,e,r,i=this.id,u=this.namespace,o=[];n=A(n);for(var a=-1,l=this.length;++a<l;){o.push(t=[]);for(var c=this[a],f=-1,s=c.length;++f<s;)(r=c[f])&&(e=n.call(r,r.__data__,f,a))?("__data__"in r&&(e.__data__=r.__data__),Qu(e,f,u,i,r[u][i]),t.push(e)):t.push(null)}return Wu(o,u,i)},Ol.selectAll=function(n){var t,e,r,i,u,o=this.id,a=this.namespace,l=[];n=C(n);for(var c=-1,f=this.length;++c<f;)for(var s=this[c],h=-1,p=s.length;++h<p;)if(r=s[h]){u=r[a][o],e=n.call(r,r.__data__,h,c),l.push(t=[]);for(var g=-1,v=e.length;++g<v;)(i=e[g])&&Qu(i,g,a,o,u),t.push(i)}return Wu(l,a,o)},Ol.filter=function(n){var t,e,r,i=[];"function"!=typeof n&&(n=O(n));for(var u=0,o=this.length;u<o;u++){i.push(t=[]);for(var e=this[u],a=0,l=e.length;a<l;a++)(r=e[a])&&n.call(r,r.__data__,a,u)&&t.push(r)}return Wu(i,this.namespace,this.id)},Ol.tween=function(n,t){var e=this.id,r=this.namespace;return arguments.length<2?this.node()[r][e].tween.get(n):Y(this,null==t?function(t){t[r][e].tween.remove(n)}:function(i){i[r][e].tween.set(n,t)})},Ol.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}function i(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})}function u(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?$r:Mr,a=ao.ns.qualify(n);return Ju(this,"attr."+n,t,a.local?u:i)},Ol.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(i));return r&&function(n){this.setAttribute(i,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(i.space,i.local));return r&&function(n){this.setAttributeNS(i.space,i.local,r(n))}}var i=ao.ns.qualify(n);return this.tween("attr."+n,i.local?r:e)},Ol.style=function(n,e,r){function i(){this.style.removeProperty(n)}function u(e){return null==e?i:(e+="",function(){var i,u=t(this).getComputedStyle(this,null).getPropertyValue(n);return u!==e&&(i=Mr(u,e),function(t){this.style.setProperty(n,i(t),r)})})}var o=arguments.length;if(o<3){if("string"!=typeof n){o<2&&(e="");for(r in n)this.style(r,n[r],e);return this}r=""}return Ju(this,"style."+n,e,u)},Ol.styleTween=function(n,e,r){function i(i,u){var o=e.call(this,i,u,t(this).getComputedStyle(this,null).getPropertyValue(n));return o&&function(t){this.style.setProperty(n,o(t),r)}}return arguments.length<3&&(r=""),this.tween("style."+n,i)},Ol.text=function(n){return Ju(this,"text",n,Gu)},Ol.remove=function(){var n=this.namespace;return this.each("end.transition",function(){var t;this[n].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Ol.ease=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].ease:("function"!=typeof n&&(n=ao.ease.apply(ao,arguments)),Y(this,function(r){r[e][t].ease=n}))},Ol.delay=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].delay:Y(this,"function"==typeof n?function(r,i,u){r[e][t].delay=+n.call(r,r.__data__,i,u)}:(n=+n,function(r){r[e][t].delay=n}))},Ol.duration=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].duration:Y(this,"function"==typeof n?function(r,i,u){r[e][t].duration=Math.max(1,n.call(r,r.__data__,i,u))}:(n=Math.max(1,n),function(r){r[e][t].duration=n}))},Ol.each=function(n,t){var e=this.id,r=this.namespace;if(arguments.length<2){var i=Fl,u=jl;try{jl=e,Y(this,function(t,i,u){Fl=t[r][e],n.call(t,t.__data__,i,u)})}finally{Fl=i,jl=u}}else Y(this,function(i){var u=i[r][e];(u.event||(u.event=ao.dispatch("start","end","interrupt"))).on(n,t)});return this},Ol.transition=function(){for(var n,t,e,r,i=this.id,u=++Il,o=this.namespace,a=[],l=0,c=this.length;l<c;l++){a.push(n=[]);for(var t=this[l],f=0,s=t.length;f<s;f++)(e=t[f])&&(r=e[o][i],Qu(e,f,o,u,{time:r.time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration})),n.push(e)}return Wu(a,o,u)},ao.svg.axis=function(){function n(n){n.each(function(){var n,c=ao.select(this),f=this.__chart__||e,s=this.__chart__=e.copy(),h=null==l?s.ticks?s.ticks.apply(s,a):s.domain():l,p=null==t?s.tickFormat?s.tickFormat.apply(s,a):m:t,g=c.selectAll(".tick").data(h,s),v=g.enter().insert("g",".domain").attr("class","tick").style("opacity",Do),d=ao.transition(g.exit()).style("opacity",Do).remove(),y=ao.transition(g.order()).style("opacity",1),M=Math.max(i,0)+o,x=Zi(s),b=c.selectAll(".domain").data([0]),_=(b.enter().append("path").attr("class","domain"),ao.transition(b));v.append("line"),v.append("text");var w,S,k,N,E=v.select("line"),A=y.select("line"),C=g.select("text").text(p),z=v.select("text"),L=y.select("text"),q="top"===r||"left"===r?-1:1;if("bottom"===r||"top"===r?(n=no,w="x",k="y",S="x2",N="y2",C.attr("dy",q<0?"0em":".71em").style("text-anchor","middle"),_.attr("d","M"+x[0]+","+q*u+"V0H"+x[1]+"V"+q*u)):(n=to,w="y",k="x",S="y2",N="x2",C.attr("dy",".32em").style("text-anchor",q<0?"end":"start"),_.attr("d","M"+q*u+","+x[0]+"H0V"+x[1]+"H"+q*u)),E.attr(N,q*i),z.attr(k,q*M),A.attr(S,0).attr(N,q*i),L.attr(w,0).attr(k,q*M),s.rangeBand){var T=s,R=T.rangeBand()/2;f=s=function(n){return T(n)+R}}else f.rangeBand?f=s:d.call(n,s,f);v.call(n,f,s),y.call(n,s,s)})}var t,e=ao.scale.linear(),r=Yl,i=6,u=6,o=3,a=[10],l=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Zl?t+"":Yl,n):r},n.ticks=function(){return arguments.length?(a=co(arguments),n):a},n.tickValues=function(t){return arguments.length?(l=t,n):l},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(i=+t,u=+arguments[e-1],n):i},n.innerTickSize=function(t){return arguments.length?(i=+t,n):i},n.outerTickSize=function(t){return arguments.length?(u=+t,n):u},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var Yl="bottom",Zl={top:1,right:1,bottom:1,left:1};ao.svg.brush=function(){function n(t){t.each(function(){var t=ao.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),o=t.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=t.selectAll(".resize").data(v,m);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return Vl[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var l,s=ao.transition(t),h=ao.transition(o);c&&(l=Zi(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),r(s)),f&&(l=Zi(f),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(s)),e(s)})}function e(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+s[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")"})}function r(n){n.select(".extent").attr("x",s[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",s[1]-s[0])}function i(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function u(){function u(){32==ao.event.keyCode&&(C||(M=null,L[0]-=s[1],L[1]-=h[1],C=2),S())}function v(){32==ao.event.keyCode&&2==C&&(L[0]+=s[1],L[1]+=h[1],C=0,S())}function d(){var n=ao.mouse(b),t=!1;x&&(n[0]+=x[0],n[1]+=x[1]),C||(ao.event.altKey?(M||(M=[(s[0]+s[1])/2,(h[0]+h[1])/2]),L[0]=s[+(n[0]<M[0])],L[1]=h[+(n[1]<M[1])]):M=null),E&&y(n,c,0)&&(r(k),t=!0),A&&y(n,f,1)&&(i(k),t=!0),t&&(e(k),w({type:"brush",mode:C?"move":"resize"}))}function y(n,t,e){var r,i,u=Zi(t),l=u[0],c=u[1],f=L[e],v=e?h:s,d=v[1]-v[0];if(C&&(l-=f,c-=d+f),r=(e?g:p)?Math.max(l,Math.min(c,n[e])):n[e],C?i=(r+=f)+d:(M&&(f=Math.max(l,Math.min(c,2*M[e]-r))),f<r?(i=r,r=f):i=f),v[0]!=r||v[1]!=i)return e?a=null:o=null,v[0]=r,v[1]=i,!0}function m(){d(),k.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),ao.select("body").style("cursor",null),q.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),z(),w({type:"brushend"})}var M,x,b=this,_=ao.select(ao.event.target),w=l.of(b,arguments),k=ao.select(b),N=_.datum(),E=!/^(n|s)$/.test(N)&&c,A=!/^(e|w)$/.test(N)&&f,C=_.classed("extent"),z=W(b),L=ao.mouse(b),q=ao.select(t(b)).on("keydown.brush",u).on("keyup.brush",v);if(ao.event.changedTouches?q.on("touchmove.brush",d).on("touchend.brush",m):q.on("mousemove.brush",d).on("mouseup.brush",m),k.interrupt().selectAll("*").interrupt(),C)L[0]=s[0]-L[0],L[1]=h[0]-L[1];else if(N){var T=+/w$/.test(N),R=+/^n/.test(N);x=[s[1-T]-L[0],h[1-R]-L[1]],L[0]=s[T],L[1]=h[R]}else ao.event.altKey&&(M=L.slice());k.style("pointer-events","none").selectAll(".resize").style("display",null),ao.select("body").style("cursor",_.style("cursor")),w({type:"brushstart"}),d()}var o,a,l=N(n,"brushstart","brush","brushend"),c=null,f=null,s=[0,0],h=[0,0],p=!0,g=!0,v=Xl[0];return n.event=function(n){n.each(function(){var n=l.of(this,arguments),t={x:s,y:h,i:o,j:a},e=this.__chart__||t;this.__chart__=t,jl?ao.select(this).transition().each("start.brush",function(){o=e.i,a=e.j,s=e.x,h=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=xr(s,t.x),r=xr(h,t.y);return o=a=null,function(i){s=t.x=e(i),h=t.y=r(i),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=t.i,a=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(c=t,v=Xl[!c<<1|!f],n):c},n.y=function(t){return arguments.length?(f=t,v=Xl[!c<<1|!f],n):f},n.clamp=function(t){return arguments.length?(c&&f?(p=!!t[0],g=!!t[1]):c?p=!!t:f&&(g=!!t),n):c&&f?[p,g]:c?p:f?g:null},n.extent=function(t){var e,r,i,u,l;return arguments.length?(c&&(e=t[0],r=t[1],f&&(e=e[0],r=r[0]),o=[e,r],c.invert&&(e=c(e),r=c(r)),r<e&&(l=e,e=r,r=l),e==s[0]&&r==s[1]||(s=[e,r])),f&&(i=t[0],u=t[1],c&&(i=i[1],u=u[1]),a=[i,u],f.invert&&(i=f(i),u=f(u)),u<i&&(l=i,i=u,u=l),i==h[0]&&u==h[1]||(h=[i,u])),n):(c&&(o?(e=o[0],r=o[1]):(e=s[0],r=s[1],c.invert&&(e=c.invert(e),r=c.invert(r)),r<e&&(l=e,e=r,r=l))),f&&(a?(i=a[0],u=a[1]):(i=h[0],u=h[1],f.invert&&(i=f.invert(i),u=f.invert(u)),u<i&&(l=i,i=u,u=l))),c&&f?[[e,i],[r,u]]:c?[e,r]:f&&[i,u])},n.clear=function(){return n.empty()||(s=[0,0],h=[0,0],o=a=null),n},n.empty=function(){return!!c&&s[0]==s[1]||!!f&&h[0]==h[1]},ao.rebind(n,l,"on")};var Vl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Xl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],$l=ha.format=ma.timeFormat,Bl=$l.utc,Wl=Bl("%Y-%m-%dT%H:%M:%S.%LZ");$l.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?eo:Wl,eo.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},eo.toString=Wl.toString,ha.second=On(function(n){return new pa(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),ha.seconds=ha.second.range,ha.seconds.utc=ha.second.utc.range,ha.minute=On(function(n){return new pa(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),ha.minutes=ha.minute.range,ha.minutes.utc=ha.minute.utc.range,ha.hour=On(function(n){var t=n.getTimezoneOffset()/60;return new pa(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),ha.hours=ha.hour.range,ha.hours.utc=ha.hour.utc.range,ha.month=On(function(n){return n=ha.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),ha.months=ha.month.range,ha.months.utc=ha.month.utc.range;var Jl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Gl=[[ha.second,1],[ha.second,5],[ha.second,15],[ha.second,30],[ha.minute,1],[ha.minute,5],[ha.minute,15],[ha.minute,30],[ha.hour,1],[ha.hour,3],[ha.hour,6],[ha.hour,12],[ha.day,1],[ha.day,2],[ha.week,1],[ha.month,1],[ha.month,3],[ha.year,1]],Kl=$l.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",zt]]),Ql={range:function(n,t,e){return ao.range(Math.ceil(n/e)*e,+t,e).map(io)},floor:m,ceil:m};Gl.year=ha.year,ha.scale=function(){return ro(ao.scale.linear(),Gl,Kl)};var nc=Gl.map(function(n){return[n[0].utc,n[1]]}),tc=Bl.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",zt]]);nc.year=ha.year.utc,ha.scale.utc=function(){return ro(ao.scale.linear(),nc,tc)},ao.text=An(function(n){return n.responseText}),ao.json=function(n,t){return Cn(n,"application/json",uo,t)},ao.html=function(n,t){return Cn(n,"text/html",oo,t)},ao.xml=An(function(n){return n.responseXML}),"function"==typeof define&&define.amd?(this.d3=ao,define(ao)):"object"==typeof module&&module.exports?module.exports=ao:this.d3=ao}();
 },{}],2:[function(require,module,exports){
-!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function n(e,t){t=t||Z;var n=t.createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)}function r(e){var t=!!e&&"length"in e&&e.length,n=pe.type(e);return"function"!==n&&!pe.isWindow(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function i(e,t,n){if(pe.isFunction(t))return pe.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return pe.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(Te.test(t))return pe.filter(t,e,n);t=pe.filter(t,e)}return pe.grep(e,function(e){return ie.call(t,e)>-1!==n&&1===e.nodeType})}function o(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function a(e){var t={};return pe.each(e.match(De)||[],function(e,n){t[n]=!0}),t}function s(e){return e}function u(e){throw e}function l(e,t,n){var r;try{e&&pe.isFunction(r=e.promise)?r.call(e).done(t).fail(n):e&&pe.isFunction(r=e.then)?r.call(e,t,n):t.call(void 0,e)}catch(e){n.call(void 0,e)}}function c(){Z.removeEventListener("DOMContentLoaded",c),e.removeEventListener("load",c),pe.ready()}function f(){this.expando=pe.expando+f.uid++}function p(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Pe,"-$&").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:Oe.test(n)?JSON.parse(n):n)}catch(e){}Fe.set(e,t,n)}else n=void 0;return n}function d(e,t,n,r){var i,o=1,a=20,s=r?function(){return r.cur()}:function(){return pe.css(e,t,"")},u=s(),l=n&&n[3]||(pe.cssNumber[t]?"":"px"),c=(pe.cssNumber[t]||"px"!==l&&+u)&&Me.exec(pe.css(e,t));if(c&&c[3]!==l){l=l||c[3],n=n||[],c=+u||1;do o=o||".5",c/=o,pe.style(e,t,c+l);while(o!==(o=s()/u)&&1!==o&&--a)}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}function h(e){var t,n=e.ownerDocument,r=e.nodeName,i=Be[r];return i?i:(t=n.body.appendChild(n.createElement(r)),i=pe.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),Be[r]=i,i)}function g(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)r=e[o],r.style&&(n=r.style.display,t?("none"===n&&(i[o]=He.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&We(r)&&(i[o]=h(r))):"none"!==n&&(i[o]="none",He.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}function m(e,t){var n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&pe.nodeName(e,t)?pe.merge([e],n):n}function v(e,t){for(var n=0,r=e.length;n<r;n++)He.set(e[n],"globalEval",!t||He.get(t[n],"globalEval"))}function y(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if(o=e[d],o||0===o)if("object"===pe.type(o))pe.merge(p,o.nodeType?[o]:o);else if(Ve.test(o)){for(a=a||f.appendChild(t.createElement("div")),s=(ze.exec(o)||["",""])[1].toLowerCase(),u=Ue[s]||Ue._default,a.innerHTML=u[1]+pe.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;pe.merge(p,a.childNodes),a=f.firstChild,a.textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&pe.inArray(o,r)>-1)i&&i.push(o);else if(l=pe.contains(o.ownerDocument,o),a=m(f.appendChild(o),"script"),l&&v(a),n)for(c=0;o=a[c++];)Xe.test(o.type||"")&&n.push(o);return f}function x(){return!0}function b(){return!1}function w(){try{return Z.activeElement}catch(e){}}function T(e,t,n,r,i,o){var a,s;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(s in t)T(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),i===!1)i=b;else if(!i)return e;return 1===o&&(a=i,i=function(e){return pe().off(e),a.apply(this,arguments)},i.guid=a.guid||(a.guid=pe.guid++)),e.each(function(){pe.event.add(this,t,i,r,n)})}function C(e,t){return pe.nodeName(e,"table")&&pe.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e:e}function k(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function E(e){var t=tt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function S(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(He.hasData(e)&&(o=He.access(e),a=He.set(t,o),l=o.events)){delete a.handle,a.events={};for(i in l)for(n=0,r=l[i].length;n<r;n++)pe.event.add(t,i,l[i][n])}Fe.hasData(e)&&(s=Fe.access(e),u=pe.extend({},s),Fe.set(t,u))}}function N(e,t){var n=t.nodeName.toLowerCase();"input"===n&&_e.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function D(e,t,r,i){t=ne.apply([],t);var o,a,s,u,l,c,f=0,p=e.length,d=p-1,h=t[0],g=pe.isFunction(h);if(g||p>1&&"string"==typeof h&&!ce.checkClone&&et.test(h))return e.each(function(n){var o=e.eq(n);g&&(t[0]=h.call(this,n,o.html())),D(o,t,r,i)});if(p&&(o=y(t,e[0].ownerDocument,!1,e,i),a=o.firstChild,1===o.childNodes.length&&(o=a),a||i)){for(s=pe.map(m(o,"script"),k),u=s.length;f<p;f++)l=o,f!==d&&(l=pe.clone(l,!0,!0),u&&pe.merge(s,m(l,"script"))),r.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,pe.map(s,E),f=0;f<u;f++)l=s[f],Xe.test(l.type||"")&&!He.access(l,"globalEval")&&pe.contains(c,l)&&(l.src?pe._evalUrl&&pe._evalUrl(l.src):n(l.textContent.replace(nt,""),c))}return e}function j(e,t,n){for(var r,i=t?pe.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||pe.cleanData(m(r)),r.parentNode&&(n&&pe.contains(r.ownerDocument,r)&&v(m(r,"script")),r.parentNode.removeChild(r));return e}function A(e,t,n){var r,i,o,a,s=e.style;return n=n||ot(e),n&&(a=n.getPropertyValue(t)||n[t],""!==a||pe.contains(e.ownerDocument,e)||(a=pe.style(e,t)),!ce.pixelMarginRight()&&it.test(a)&&rt.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function q(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function L(e){if(e in ct)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=lt.length;n--;)if(e=lt[n]+t,e in ct)return e}function H(e,t,n){var r=Me.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function F(e,t,n,r,i){for(var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;o<4;o+=2)"margin"===n&&(a+=pe.css(e,n+Ie[o],!0,i)),r?("content"===n&&(a-=pe.css(e,"padding"+Ie[o],!0,i)),"margin"!==n&&(a-=pe.css(e,"border"+Ie[o]+"Width",!0,i))):(a+=pe.css(e,"padding"+Ie[o],!0,i),"padding"!==n&&(a+=pe.css(e,"border"+Ie[o]+"Width",!0,i)));return a}function O(e,t,n){var r,i=!0,o=ot(e),a="border-box"===pe.css(e,"boxSizing",!1,o);if(e.getClientRects().length&&(r=e.getBoundingClientRect()[t]),r<=0||null==r){if(r=A(e,t,o),(r<0||null==r)&&(r=e.style[t]),it.test(r))return r;i=a&&(ce.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+F(e,t,n||(a?"border":"content"),i,o)+"px"}function P(e,t,n,r,i){return new P.prototype.init(e,t,n,r,i)}function R(){pt&&(e.requestAnimationFrame(R),pe.fx.tick())}function M(){return e.setTimeout(function(){ft=void 0}),ft=pe.now()}function I(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)n=Ie[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function W(e,t,n){for(var r,i=(_.tweeners[t]||[]).concat(_.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function $(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,m=e.nodeType&&We(e),v=He.get(e,"fxshow");n.queue||(a=pe._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,pe.queue(e,"fx").length||a.empty.fire()})}));for(r in t)if(i=t[r],dt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;m=!0}d[r]=v&&v[r]||pe.style(e,r)}if(u=!pe.isEmptyObject(t),u||!pe.isEmptyObject(d)){f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],l=v&&v.display,null==l&&(l=He.get(e,"display")),c=pe.css(e,"display"),"none"===c&&(l?c=l:(g([e],!0),l=e.style.display||l,c=pe.css(e,"display"),g([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===pe.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1;for(r in d)u||(v?"hidden"in v&&(m=v.hidden):v=He.access(e,"fxshow",{display:l}),o&&(v.hidden=!m),m&&g([e],!0),p.done(function(){m||g([e]),He.remove(e,"fxshow");for(r in d)pe.style(e,r,d[r])})),u=W(m?v[r]:0,r,p),r in v||(v[r]=u.start,m&&(u.end=u.start,u.start=0))}}function B(e,t){var n,r,i,o,a;for(n in e)if(r=pe.camelCase(n),i=t[r],o=e[n],pe.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),a=pe.cssHooks[r],a&&"expand"in a){o=a.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function _(e,t,n){var r,i,o=0,a=_.prefilters.length,s=pe.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=ft||M(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;a<u;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),o<1&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:pe.extend({},t),opts:pe.extend(!0,{specialEasing:{},easing:pe.easing._default},n),originalProperties:t,originalOptions:n,startTime:ft||M(),duration:n.duration,tweens:[],createTween:function(t,n){var r=pe.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(B(c,l.opts.specialEasing);o<a;o++)if(r=_.prefilters[o].call(l,e,c,l.opts))return pe.isFunction(r.stop)&&(pe._queueHooks(l.elem,l.opts.queue).stop=pe.proxy(r.stop,r)),r;return pe.map(c,W,l),pe.isFunction(l.opts.start)&&l.opts.start.call(e,l),pe.fx.timer(pe.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function z(e){return e.getAttribute&&e.getAttribute("class")||""}function X(e,t,n,r){var i;if(pe.isArray(t))pe.each(t,function(t,i){n||St.test(e)?r(e,i):X(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==pe.type(t))r(e,t);else for(i in t)X(e+"["+i+"]",t[i],n,r)}function U(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(De)||[];if(pe.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function V(e,t,n,r){function i(s){var u;return o[s]=!0,pe.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||a||o[l]?a?!(u=l):void 0:(t.dataTypes.unshift(l),i(l),!1)}),u}var o={},a=e===Mt;return i(t.dataTypes[0])||!o["*"]&&i("*")}function G(e,t){var n,r,i=pe.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&pe.extend(!0,e,r),e}function Y(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}function Q(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(a=l[u+" "+o]||l["* "+o],!a)for(i in l)if(s=i.split(" "),s[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){a===!0?a=l[i]:l[i]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}function J(e){return pe.isWindow(e)?e:9===e.nodeType&&e.defaultView}var K=[],Z=e.document,ee=Object.getPrototypeOf,te=K.slice,ne=K.concat,re=K.push,ie=K.indexOf,oe={},ae=oe.toString,se=oe.hasOwnProperty,ue=se.toString,le=ue.call(Object),ce={},fe="3.1.0",pe=function(e,t){return new pe.fn.init(e,t)},de=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,he=/^-ms-/,ge=/-([a-z])/g,me=function(e,t){return t.toUpperCase()};pe.fn=pe.prototype={jquery:fe,constructor:pe,length:0,toArray:function(){return te.call(this)},get:function(e){return null!=e?e<0?this[e+this.length]:this[e]:te.call(this)},pushStack:function(e){var t=pe.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return pe.each(this,e)},map:function(e){return this.pushStack(pe.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(te.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:re,sort:K.sort,splice:K.splice},pe.extend=pe.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||pe.isFunction(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],r=e[t],a!==r&&(l&&r&&(pe.isPlainObject(r)||(i=pe.isArray(r)))?(i?(i=!1,o=n&&pe.isArray(n)?n:[]):o=n&&pe.isPlainObject(n)?n:{},a[t]=pe.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},pe.extend({expando:"jQuery"+(fe+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===pe.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=pe.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==ae.call(e))&&(!(t=ee(e))||(n=se.call(t,"constructor")&&t.constructor,"function"==typeof n&&ue.call(n)===le))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?oe[ae.call(e)]||"object":typeof e},globalEval:function(e){n(e)},camelCase:function(e){return e.replace(he,"ms-").replace(ge,me)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var n,i=0;if(r(e))for(n=e.length;i<n&&t.call(e[i],i,e[i])!==!1;i++);else for(i in e)if(t.call(e[i],i,e[i])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(de,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(r(Object(e))?pe.merge(n,"string"==typeof e?[e]:e):re.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:ie.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,a=e.length,s=!n;o<a;o++)r=!t(e[o],o),r!==s&&i.push(e[o]);return i},map:function(e,t,n){var i,o,a=0,s=[];if(r(e))for(i=e.length;a<i;a++)o=t(e[a],a,n),null!=o&&s.push(o);else for(a in e)o=t(e[a],a,n),null!=o&&s.push(o);return ne.apply([],s)},guid:1,proxy:function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),pe.isFunction(e))return r=te.call(arguments,2),i=function(){return e.apply(t||this,r.concat(te.call(arguments)))},i.guid=e.guid=e.guid||pe.guid++,i},now:Date.now,support:ce}),"function"==typeof Symbol&&(pe.fn[Symbol.iterator]=K[Symbol.iterator]),pe.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){oe["[object "+t+"]"]=t.toLowerCase()});var ve=function(e){function t(e,t,n,r){var i,o,a,s,u,l,c,p=t&&t.ownerDocument,h=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==h&&9!==h&&11!==h)return n;if(!r&&((t?t.ownerDocument||t:$)!==H&&L(t),t=t||H,O)){if(11!==h&&(u=ve.exec(e)))if(i=u[1]){if(9===h){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(p&&(a=p.getElementById(i))&&I(t,a)&&a.id===i)return n.push(a),n}else{if(u[2])return K.apply(n,t.getElementsByTagName(e)),n;if((i=u[3])&&T.getElementsByClassName&&t.getElementsByClassName)return K.apply(n,t.getElementsByClassName(i)),n}if(T.qsa&&!U[e+" "]&&(!P||!P.test(e))){if(1!==h)p=t,c=e;else if("object"!==t.nodeName.toLowerCase()){for((s=t.getAttribute("id"))?s=s.replace(we,Te):t.setAttribute("id",s=W),l=S(e),o=l.length;o--;)l[o]="#"+s+" "+d(l[o]);c=l.join(","),p=ye.test(e)&&f(t.parentNode)||t}if(c)try{return K.apply(n,p.querySelectorAll(c)),n}catch(e){}finally{s===W&&t.removeAttribute("id")}}}return D(e.replace(se,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>C.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[W]=!0,e}function i(e){var t=H.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var n=e.split("|"),r=n.length;r--;)C.attrHandle[n[r]]=t}function a(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function s(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function u(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function l(e){return function(t){return"label"in t&&t.disabled===e||"form"in t&&t.disabled===e||"form"in t&&t.disabled===!1&&(t.isDisabled===e||t.isDisabled!==!e&&("label"in t||!ke(t))!==e)}}function c(e){return r(function(t){return t=+t,r(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function f(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function p(){}function d(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function h(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=_++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||a)return e(t,n,i)}:function(t,n,u){var l,c,f,p=[B,s];if(u){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(f=t[W]||(t[W]={}),c=f[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===B&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}}}function g(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function m(e,n,r){for(var i=0,o=n.length;i<o;i++)t(e,n[i],r);return r}function v(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function y(e,t,n,i,o,a){return i&&!i[W]&&(i=y(i)),o&&!o[W]&&(o=y(o,a)),r(function(r,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=r||m(t||"*",s.nodeType?[s]:s,[]),y=!e||!r&&t?g:v(g,p,e,s,u),x=n?o||(r?e:h||i)?[]:a:y;if(n&&n(y,x,s,u),i)for(l=v(x,d),i(l,[],s,u),c=l.length;c--;)(f=l[c])&&(x[d[c]]=!(y[d[c]]=f));if(r){if(o||e){if(o){for(l=[],c=x.length;c--;)(f=x[c])&&l.push(y[c]=f);o(null,x=[],l,u)}for(c=x.length;c--;)(f=x[c])&&(l=o?ee(r,f):p[c])>-1&&(r[l]=!(a[l]=f))}}else x=v(x===a?x.splice(h,x.length):x),o?o(null,a,x,u):K.apply(a,x)})}function x(e){for(var t,n,r,i=e.length,o=C.relative[e[0].type],a=o||C.relative[" "],s=o?1:0,u=h(function(e){return e===t},a,!0),l=h(function(e){return ee(t,e)>-1},a,!0),c=[function(e,n,r){var i=!o&&(r||n!==j)||((t=n).nodeType?u(e,n,r):l(e,n,r));return t=null,i}];s<i;s++)if(n=C.relative[e[s].type])c=[h(g(c),n)];else{if(n=C.filter[e[s].type].apply(null,e[s].matches),n[W]){for(r=++s;r<i&&!C.relative[e[r].type];r++);return y(s>1&&g(c),s>1&&d(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(se,"$1"),n,s<r&&x(e.slice(s,r)),r<i&&x(e=e.slice(r)),r<i&&d(e))}c.push(n)}return g(c)}function b(e,n){var i=n.length>0,o=e.length>0,a=function(r,a,s,u,l){var c,f,p,d=0,h="0",g=r&&[],m=[],y=j,x=r||o&&C.find.TAG("*",l),b=B+=null==y?1:Math.random()||.1,w=x.length;for(l&&(j=a===H||a||l);h!==w&&null!=(c=x[h]);h++){if(o&&c){for(f=0,a||c.ownerDocument===H||(L(c),s=!O);p=e[f++];)if(p(c,a||H,s)){u.push(c);break}l&&(B=b)}i&&((c=!p&&c)&&d--,r&&g.push(c))}if(d+=h,i&&h!==d){for(f=0;p=n[f++];)p(g,m,a,s);if(r){if(d>0)for(;h--;)g[h]||m[h]||(m[h]=Q.call(u));m=v(m)}K.apply(u,m),l&&!r&&m.length>0&&d+n.length>1&&t.uniqueSort(u)}return l&&(B=b,j=y),g};return i?r(a):a}var w,T,C,k,E,S,N,D,j,A,q,L,H,F,O,P,R,M,I,W="sizzle"+1*new Date,$=e.document,B=0,_=0,z=n(),X=n(),U=n(),V=function(e,t){return e===t&&(q=!0),0},G={}.hasOwnProperty,Y=[],Q=Y.pop,J=Y.push,K=Y.push,Z=Y.slice,ee=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",ie="\\["+ne+"*("+re+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ne+"*\\]",oe=":("+re+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ie+")*)|.*)\\)|)",ae=new RegExp(ne+"+","g"),se=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),ue=new RegExp("^"+ne+"*,"+ne+"*"),le=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),ce=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),fe=new RegExp(oe),pe=new RegExp("^"+re+"$"),de={ID:new RegExp("^#("+re+")"),CLASS:new RegExp("^\\.("+re+")"),TAG:new RegExp("^("+re+"|[*])"),ATTR:new RegExp("^"+ie),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},he=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,me=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,xe=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),be=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},we=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,Te=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},Ce=function(){L()},ke=h(function(e){return e.disabled===!0},{dir:"parentNode",next:"legend"});try{K.apply(Y=Z.call($.childNodes),$.childNodes),Y[$.childNodes.length].nodeType}catch(e){K={apply:Y.length?function(e,t){J.apply(e,Z.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}T=t.support={},E=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},L=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:$;return r!==H&&9===r.nodeType&&r.documentElement?(H=r,F=H.documentElement,O=!E(H),$!==H&&(n=H.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",Ce,!1):n.attachEvent&&n.attachEvent("onunload",Ce)),T.attributes=i(function(e){return e.className="i",!e.getAttribute("className")}),T.getElementsByTagName=i(function(e){return e.appendChild(H.createComment("")),!e.getElementsByTagName("*").length}),T.getElementsByClassName=me.test(H.getElementsByClassName),T.getById=i(function(e){return F.appendChild(e).id=W,!H.getElementsByName||!H.getElementsByName(W).length}),T.getById?(C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&O){var n=t.getElementById(e);return n?[n]:[]}},C.filter.ID=function(e){var t=e.replace(xe,be);return function(e){return e.getAttribute("id")===t}}):(delete C.find.ID,C.filter.ID=function(e){var t=e.replace(xe,be);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),C.find.TAG=T.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):T.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},C.find.CLASS=T.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&O)return t.getElementsByClassName(e)},R=[],P=[],(T.qsa=me.test(H.querySelectorAll))&&(i(function(e){F.appendChild(e).innerHTML="<a id='"+W+"'></a><select id='"+W+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&P.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||P.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+W+"-]").length||P.push("~="),e.querySelectorAll(":checked").length||P.push(":checked"),e.querySelectorAll("a#"+W+"+*").length||P.push(".#.+[+~]")}),i(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=H.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&P.push("name"+ne+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&P.push(":enabled",":disabled"),F.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&P.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),P.push(",.*:")})),(T.matchesSelector=me.test(M=F.matches||F.webkitMatchesSelector||F.mozMatchesSelector||F.oMatchesSelector||F.msMatchesSelector))&&i(function(e){T.disconnectedMatch=M.call(e,"*"),M.call(e,"[s!='']:x"),R.push("!=",oe)}),P=P.length&&new RegExp(P.join("|")),R=R.length&&new RegExp(R.join("|")),t=me.test(F.compareDocumentPosition),I=t||me.test(F.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},V=t?function(e,t){if(e===t)return q=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!T.sortDetached&&t.compareDocumentPosition(e)===n?e===H||e.ownerDocument===$&&I($,e)?-1:t===H||t.ownerDocument===$&&I($,t)?1:A?ee(A,e)-ee(A,t):0:4&n?-1:1)}:function(e,t){if(e===t)return q=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,s=[e],u=[t];if(!i||!o)return e===H?-1:t===H?1:i?-1:o?1:A?ee(A,e)-ee(A,t):0;if(i===o)return a(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;s[r]===u[r];)r++;return r?a(s[r],u[r]):s[r]===$?-1:u[r]===$?1:0},H):H},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==H&&L(e),n=n.replace(ce,"='$1']"),T.matchesSelector&&O&&!U[n+" "]&&(!R||!R.test(n))&&(!P||!P.test(n)))try{var r=M.call(e,n);if(r||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return t(n,H,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==H&&L(e),I(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==H&&L(e);var n=C.attrHandle[t.toLowerCase()],r=n&&G.call(C.attrHandle,t.toLowerCase())?n(e,t,!O):void 0;return void 0!==r?r:T.attributes||!O?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.escape=function(e){return(e+"").replace(we,Te)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,i=0;if(q=!T.detectDuplicates,A=!T.sortStable&&e.slice(0),e.sort(V),q){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return A=null,e},k=t.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=k(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=k(t);return n},C=t.selectors={cacheLength:50,createPseudo:r,match:de,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(xe,be),e[3]=(e[3]||e[4]||e[5]||"").replace(xe,be),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return de.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&fe.test(n)&&(t=S(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(xe,be).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=z[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&z(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(i){var o=t.attr(i,e);return null==o?"!="===n:!n||(o+="","="===n?o===r:"!="===n?o!==r:"^="===n?r&&0===o.indexOf(r):"*="===n?r&&o.indexOf(r)>-1:"$="===n?r&&o.slice(-r.length)===r:"~="===n?(" "+o.replace(ae," ")+" ").indexOf(r)>-1:"|="===n&&(o===r||o.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!u&&!s,x=!1;if(m){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&y){for(p=m,f=p[W]||(p[W]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),l=c[e]||[],d=l[0]===B&&l[1],x=d&&l[2],p=d&&m.childNodes[d];p=++d&&p&&p[g]||(x=d=0)||h.pop();)if(1===p.nodeType&&++x&&p===t){c[e]=[B,d,x];break}}else if(y&&(p=t,f=p[W]||(p[W]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),l=c[e]||[],d=l[0]===B&&l[1],x=d),x===!1)for(;(p=++d&&p&&p[g]||(x=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==v:1!==p.nodeType)||!++x||(y&&(f=p[W]||(p[W]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),c[e]=[B,x]),p!==t)););return x-=i,x===r||x%r===0&&x/r>=0}}},PSEUDO:function(e,n){var i,o=C.pseudos[e]||C.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[W]?o(n):o.length>1?(i=[e,e,"",n],C.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,i=o(e,n),a=i.length;a--;)r=ee(e,i[a]),e[r]=!(t[r]=i[a])}):function(e){return o(e,0,i)}):o}},pseudos:{not:r(function(e){var t=[],n=[],i=N(e.replace(se,"$1"));return i[W]?r(function(e,t,n,r){for(var o,a=i(e,null,r,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,r,o){return t[0]=e,i(t,null,o,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(xe,be),function(t){return(t.textContent||t.innerText||k(t)).indexOf(e)>-1}}),lang:r(function(e){return pe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(xe,be).toLowerCase(),function(t){var n;do if(n=O?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===F},focus:function(e){return e===H.activeElement&&(!H.hasFocus||H.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:l(!1),disabled:l(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;
-return!0},parent:function(e){return!C.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return he.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[n<0?n+t:n]}),even:c(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:c(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},C.pseudos.nth=C.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[w]=s(w);for(w in{submit:!0,reset:!0})C.pseudos[w]=u(w);return p.prototype=C.filters=C.pseudos,C.setFilters=new p,S=t.tokenize=function(e,n){var r,i,o,a,s,u,l,c=X[e+" "];if(c)return n?0:c.slice(0);for(s=e,u=[],l=C.preFilter;s;){r&&!(i=ue.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),r=!1,(i=le.exec(s))&&(r=i.shift(),o.push({value:r,type:i[0].replace(se," ")}),s=s.slice(r.length));for(a in C.filter)!(i=de[a].exec(s))||l[a]&&!(i=l[a](i))||(r=i.shift(),o.push({value:r,type:a,matches:i}),s=s.slice(r.length));if(!r)break}return n?s.length:s?t.error(e):X(e,u).slice(0)},N=t.compile=function(e,t){var n,r=[],i=[],o=U[e+" "];if(!o){for(t||(t=S(e)),n=t.length;n--;)o=x(t[n]),o[W]?r.push(o):i.push(o);o=U(e,b(i,r)),o.selector=e}return o},D=t.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&S(e=l.selector||e);if(n=n||[],1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&T.getById&&9===t.nodeType&&O&&C.relative[o[1].type]){if(t=(C.find.ID(a.matches[0].replace(xe,be),t)||[])[0],!t)return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=de.needsContext.test(e)?0:o.length;i--&&(a=o[i],!C.relative[s=a.type]);)if((u=C.find[s])&&(r=u(a.matches[0].replace(xe,be),ye.test(o[0].type)&&f(t.parentNode)||t))){if(o.splice(i,1),e=r.length&&d(o),!e)return K.apply(n,r),n;break}}return(l||N(e,c))(r,t,!O,n,!t||ye.test(e)&&f(t.parentNode)||t),n},T.sortStable=W.split("").sort(V).join("")===W,T.detectDuplicates=!!q,L(),T.sortDetached=i(function(e){return 1&e.compareDocumentPosition(H.createElement("fieldset"))}),i(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),T.attributes&&i(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),i(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,n){var r;if(!n)return e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e);pe.find=ve,pe.expr=ve.selectors,pe.expr[":"]=pe.expr.pseudos,pe.uniqueSort=pe.unique=ve.uniqueSort,pe.text=ve.getText,pe.isXMLDoc=ve.isXML,pe.contains=ve.contains,pe.escapeSelector=ve.escape;var ye=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&pe(e).is(n))break;r.push(e)}return r},xe=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},be=pe.expr.match.needsContext,we=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,Te=/^.[^:#\[\.,]*$/;pe.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?pe.find.matchesSelector(r,e)?[r]:[]:pe.find.matches(e,pe.grep(t,function(e){return 1===e.nodeType}))},pe.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(pe(e).filter(function(){for(t=0;t<r;t++)if(pe.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)pe.find(e,i[t],n);return r>1?pe.uniqueSort(n):n},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&be.test(e)?pe(e):e||[],!1).length}});var Ce,ke=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ee=pe.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||Ce,"string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ke.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof pe?t[0]:t,pe.merge(this,pe.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:Z,!0)),we.test(r[1])&&pe.isPlainObject(t))for(r in t)pe.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=Z.getElementById(r[2]),i&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):pe.isFunction(e)?void 0!==n.ready?n.ready(e):e(pe):pe.makeArray(e,this)};Ee.prototype=pe.fn,Ce=pe(Z);var Se=/^(?:parents|prev(?:Until|All))/,Ne={children:!0,contents:!0,next:!0,prev:!0};pe.fn.extend({has:function(e){var t=pe(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(pe.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&pe(e);if(!be.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&pe.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?pe.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?ie.call(pe(e),this[0]):ie.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(pe.uniqueSort(pe.merge(this.get(),pe(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),pe.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ye(e,"parentNode")},parentsUntil:function(e,t,n){return ye(e,"parentNode",n)},next:function(e){return o(e,"nextSibling")},prev:function(e){return o(e,"previousSibling")},nextAll:function(e){return ye(e,"nextSibling")},prevAll:function(e){return ye(e,"previousSibling")},nextUntil:function(e,t,n){return ye(e,"nextSibling",n)},prevUntil:function(e,t,n){return ye(e,"previousSibling",n)},siblings:function(e){return xe((e.parentNode||{}).firstChild,e)},children:function(e){return xe(e.firstChild)},contents:function(e){return e.contentDocument||pe.merge([],e.childNodes)}},function(e,t){pe.fn[e]=function(n,r){var i=pe.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=pe.filter(r,i)),this.length>1&&(Ne[e]||pe.uniqueSort(i),Se.test(e)&&i.reverse()),this.pushStack(i)}});var De=/\S+/g;pe.Callbacks=function(e){e="string"==typeof e?a(e):pe.extend({},e);var t,n,r,i,o=[],s=[],u=-1,l=function(){for(i=e.once,r=t=!0;s.length;u=-1)for(n=s.shift();++u<o.length;)o[u].apply(n[0],n[1])===!1&&e.stopOnFalse&&(u=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},c={add:function(){return o&&(n&&!t&&(u=o.length-1,s.push(n)),function t(n){pe.each(n,function(n,r){pe.isFunction(r)?e.unique&&c.has(r)||o.push(r):r&&r.length&&"string"!==pe.type(r)&&t(r)})}(arguments),n&&!t&&l()),this},remove:function(){return pe.each(arguments,function(e,t){for(var n;(n=pe.inArray(t,o,n))>-1;)o.splice(n,1),n<=u&&u--}),this},has:function(e){return e?pe.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=s=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=s=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=n||[],n=[e,n.slice?n.slice():n],s.push(n),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},pe.extend({Deferred:function(t){var n=[["notify","progress",pe.Callbacks("memory"),pe.Callbacks("memory"),2],["resolve","done",pe.Callbacks("once memory"),pe.Callbacks("once memory"),0,"resolved"],["reject","fail",pe.Callbacks("once memory"),pe.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return pe.Deferred(function(t){pe.each(n,function(n,r){var i=pe.isFunction(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&pe.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){function o(t,n,r,i){return function(){var l=this,c=arguments,f=function(){var e,f;if(!(t<a)){if(e=r.apply(l,c),e===n.promise())throw new TypeError("Thenable self-resolution");f=e&&("object"==typeof e||"function"==typeof e)&&e.then,pe.isFunction(f)?i?f.call(e,o(a,n,s,i),o(a,n,u,i)):(a++,f.call(e,o(a,n,s,i),o(a,n,u,i),o(a,n,s,n.notifyWith))):(r!==s&&(l=void 0,c=[e]),(i||n.resolveWith)(l,c))}},p=i?f:function(){try{f()}catch(e){pe.Deferred.exceptionHook&&pe.Deferred.exceptionHook(e,p.stackTrace),t+1>=a&&(r!==u&&(l=void 0,c=[e]),n.rejectWith(l,c))}};t?p():(pe.Deferred.getStackHook&&(p.stackTrace=pe.Deferred.getStackHook()),e.setTimeout(p))}}var a=0;return pe.Deferred(function(e){n[0][3].add(o(0,e,pe.isFunction(i)?i:s,e.notifyWith)),n[1][3].add(o(0,e,pe.isFunction(t)?t:s)),n[2][3].add(o(0,e,pe.isFunction(r)?r:u))}).promise()},promise:function(e){return null!=e?pe.extend(e,i):i}},o={};return pe.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[0][2].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=te.call(arguments),o=pe.Deferred(),a=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?te.call(arguments):n,--t||o.resolveWith(r,i)}};if(t<=1&&(l(e,o.done(a(n)).resolve,o.reject),"pending"===o.state()||pe.isFunction(i[n]&&i[n].then)))return o.then();for(;n--;)l(i[n],a(n),o.reject);return o.promise()}});var je=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;pe.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&je.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},pe.readyException=function(t){e.setTimeout(function(){throw t})};var Ae=pe.Deferred();pe.fn.ready=function(e){return Ae.then(e).catch(function(e){pe.readyException(e)}),this},pe.extend({isReady:!1,readyWait:1,holdReady:function(e){e?pe.readyWait++:pe.ready(!0)},ready:function(e){(e===!0?--pe.readyWait:pe.isReady)||(pe.isReady=!0,e!==!0&&--pe.readyWait>0||Ae.resolveWith(Z,[pe]))}}),pe.ready.then=Ae.then,"complete"===Z.readyState||"loading"!==Z.readyState&&!Z.documentElement.doScroll?e.setTimeout(pe.ready):(Z.addEventListener("DOMContentLoaded",c),e.addEventListener("load",c));var qe=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===pe.type(n)){i=!0;for(s in n)qe(e,t,s,n[s],!0,o,a)}else if(void 0!==r&&(i=!0,pe.isFunction(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(pe(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},Le=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};f.uid=1,f.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Le(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[pe.camelCase(t)]=n;else for(r in t)i[pe.camelCase(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][pe.camelCase(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){pe.isArray(t)?t=t.map(pe.camelCase):(t=pe.camelCase(t),t=t in r?[t]:t.match(De)||[]),n=t.length;for(;n--;)delete r[t[n]]}(void 0===t||pe.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!pe.isEmptyObject(t)}};var He=new f,Fe=new f,Oe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Pe=/[A-Z]/g;pe.extend({hasData:function(e){return Fe.hasData(e)||He.hasData(e)},data:function(e,t,n){return Fe.access(e,t,n)},removeData:function(e,t){Fe.remove(e,t)},_data:function(e,t,n){return He.access(e,t,n)},_removeData:function(e,t){He.remove(e,t)}}),pe.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=Fe.get(o),1===o.nodeType&&!He.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&(r=a[n].name,0===r.indexOf("data-")&&(r=pe.camelCase(r.slice(5)),p(o,r,i[r])));He.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){Fe.set(this,e)}):qe(this,function(t){var n;if(o&&void 0===t){if(n=Fe.get(o,e),void 0!==n)return n;if(n=p(o,e),void 0!==n)return n}else this.each(function(){Fe.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Fe.remove(this,e)})}}),pe.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=He.get(e,t),n&&(!r||pe.isArray(n)?r=He.access(e,t,pe.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=pe.queue(e,t),r=n.length,i=n.shift(),o=pe._queueHooks(e,t),a=function(){pe.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return He.get(e,n)||He.access(e,n,{empty:pe.Callbacks("once memory").add(function(){He.remove(e,[t+"queue",n])})})}}),pe.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?pe.queue(this[0],e):void 0===t?this:this.each(function(){var n=pe.queue(this,e,t);pe._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&pe.dequeue(this,e)})},dequeue:function(e){return this.each(function(){pe.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=pe.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)n=He.get(o[a],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var Re=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Me=new RegExp("^(?:([+-])=|)("+Re+")([a-z%]*)$","i"),Ie=["Top","Right","Bottom","Left"],We=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&pe.contains(e.ownerDocument,e)&&"none"===pe.css(e,"display")},$e=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i},Be={};pe.fn.extend({show:function(){return g(this,!0)},hide:function(){return g(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){We(this)?pe(this).show():pe(this).hide()})}});var _e=/^(?:checkbox|radio)$/i,ze=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Xe=/^$|\/(?:java|ecma)script/i,Ue={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ue.optgroup=Ue.option,Ue.tbody=Ue.tfoot=Ue.colgroup=Ue.caption=Ue.thead,Ue.th=Ue.td;var Ve=/<|&#?\w+;/;!function(){var e=Z.createDocumentFragment(),t=e.appendChild(Z.createElement("div")),n=Z.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),ce.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",ce.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ge=Z.documentElement,Ye=/^key/,Qe=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Je=/^([^.]*)(?:\.(.+)|)/;pe.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,m=He.get(e);if(m)for(n.handler&&(o=n,n=o.handler,i=o.selector),i&&pe.find.matchesSelector(Ge,i),n.guid||(n.guid=pe.guid++),(u=m.events)||(u=m.events={}),(a=m.handle)||(a=m.handle=function(t){return"undefined"!=typeof pe&&pe.event.triggered!==t.type?pe.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(De)||[""],l=t.length;l--;)s=Je.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d&&(f=pe.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=pe.event.special[d]||{},c=pe.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&pe.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||(p=u[d]=[],p.delegateCount=0,f.setup&&f.setup.call(e,r,h,a)!==!1||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),pe.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,m=He.hasData(e)&&He.get(e);if(m&&(u=m.events)){for(t=(t||"").match(De)||[""],l=t.length;l--;)if(s=Je.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){for(f=pe.event.special[d]||{},d=(r?f.delegateType:f.bindType)||d,p=u[d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&f.teardown.call(e,h,m.handle)!==!1||pe.removeEvent(e,d,m.handle),delete u[d])}else for(d in u)pe.event.remove(e,d+t[l],n,r,!0);pe.isEmptyObject(u)&&He.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=pe.event.fix(e),u=new Array(arguments.length),l=(He.get(this,"events")||{})[s.type]||[],c=pe.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,s)!==!1){for(a=pe.event.handlers.call(this,s,l),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,r=((pe.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u),void 0!==r&&(s.result=r)===!1&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a=[],s=t.delegateCount,u=e.target;if(s&&u.nodeType&&("click"!==e.type||isNaN(e.button)||e.button<1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(r=[],n=0;n<s;n++)o=t[n],i=o.selector+" ",void 0===r[i]&&(r[i]=o.needsContext?pe(i,this).index(u)>-1:pe.find(i,this,null,[u]).length),r[i]&&r.push(o);r.length&&a.push({elem:u,handlers:r})}return s<t.length&&a.push({elem:this,handlers:t.slice(s)}),a},addProp:function(e,t){Object.defineProperty(pe.Event.prototype,e,{enumerable:!0,configurable:!0,get:pe.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[pe.expando]?e:new pe.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==w()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===w()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&pe.nodeName(this,"input"))return this.click(),!1},_default:function(e){return pe.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},pe.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},pe.Event=function(e,t){return this instanceof pe.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?x:b,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&pe.extend(this,t),this.timeStamp=e&&e.timeStamp||pe.now(),void(this[pe.expando]=!0)):new pe.Event(e,t)},pe.Event.prototype={constructor:pe.Event,isDefaultPrevented:b,isPropagationStopped:b,isImmediatePropagationStopped:b,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=x,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=x,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=x,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},pe.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Ye.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Qe.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},pe.event.addProp),pe.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){pe.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||pe.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),pe.fn.extend({on:function(e,t,n,r){return T(this,e,t,n,r)},one:function(e,t,n,r){return T(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,pe(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return t!==!1&&"function"!=typeof t||(n=t,t=void 0),n===!1&&(n=b),this.each(function(){pe.event.remove(this,e,n,t)})}});var Ke=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ze=/<script|<style|<link/i,et=/checked\s*(?:[^=]|=\s*.checked.)/i,tt=/^true\/(.*)/,nt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;pe.extend({htmlPrefilter:function(e){return e.replace(Ke,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s=e.cloneNode(!0),u=pe.contains(e.ownerDocument,e);if(!(ce.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||pe.isXMLDoc(e)))for(a=m(s),o=m(e),r=0,i=o.length;r<i;r++)N(o[r],a[r]);if(t)if(n)for(o=o||m(e),a=a||m(s),r=0,i=o.length;r<i;r++)S(o[r],a[r]);else S(e,s);return a=m(s,"script"),a.length>0&&v(a,!u&&m(e,"script")),s},cleanData:function(e){for(var t,n,r,i=pe.event.special,o=0;void 0!==(n=e[o]);o++)if(Le(n)){if(t=n[He.expando]){if(t.events)for(r in t.events)i[r]?pe.event.remove(n,r):pe.removeEvent(n,r,t.handle);n[He.expando]=void 0}n[Fe.expando]&&(n[Fe.expando]=void 0)}}}),pe.fn.extend({detach:function(e){return j(this,e,!0)},remove:function(e){return j(this,e)},text:function(e){return qe(this,function(e){return void 0===e?pe.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return D(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=C(this,e);t.appendChild(e)}})},prepend:function(){return D(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=C(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return D(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return D(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(pe.cleanData(m(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return pe.clone(this,e,t)})},html:function(e){return qe(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ze.test(e)&&!Ue[(ze.exec(e)||["",""])[1].toLowerCase()]){e=pe.htmlPrefilter(e);try{for(;n<r;n++)t=this[n]||{},1===t.nodeType&&(pe.cleanData(m(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return D(this,arguments,function(t){var n=this.parentNode;pe.inArray(this,e)<0&&(pe.cleanData(m(this)),n&&n.replaceChild(t,this))},e)}}),pe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){pe.fn[e]=function(e){for(var n,r=[],i=pe(e),o=i.length-1,a=0;a<=o;a++)n=a===o?this:this.clone(!0),pe(i[a])[t](n),re.apply(r,n.get());return this.pushStack(r)}});var rt=/^margin/,it=new RegExp("^("+Re+")(?!px)[a-z%]+$","i"),ot=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)};!function(){function t(){if(s){s.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",s.innerHTML="",Ge.appendChild(a);var t=e.getComputedStyle(s);n="1%"!==t.top,o="2px"===t.marginLeft,r="4px"===t.width,s.style.marginRight="50%",i="4px"===t.marginRight,Ge.removeChild(a),s=null}}var n,r,i,o,a=Z.createElement("div"),s=Z.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",ce.clearCloneStyle="content-box"===s.style.backgroundClip,a.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",a.appendChild(s),pe.extend(ce,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return t(),r},pixelMarginRight:function(){return t(),i},reliableMarginLeft:function(){return t(),o}}))}();var at=/^(none|table(?!-c[ea]).+)/,st={position:"absolute",visibility:"hidden",display:"block"},ut={letterSpacing:"0",fontWeight:"400"},lt=["Webkit","Moz","ms"],ct=Z.createElement("div").style;pe.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=A(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=pe.camelCase(t),u=e.style;return t=pe.cssProps[s]||(pe.cssProps[s]=L(s)||s),a=pe.cssHooks[t]||pe.cssHooks[s],void 0===n?a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:u[t]:(o=typeof n,"string"===o&&(i=Me.exec(n))&&i[1]&&(n=d(e,t,i),o="number"),null!=n&&n===n&&("number"===o&&(n+=i&&i[3]||(pe.cssNumber[s]?"":"px")),ce.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u[t]=n)),void 0)}},css:function(e,t,n,r){var i,o,a,s=pe.camelCase(t);return t=pe.cssProps[s]||(pe.cssProps[s]=L(s)||s),a=pe.cssHooks[t]||pe.cssHooks[s],a&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=A(e,t,r)),"normal"===i&&t in ut&&(i=ut[t]),""===n||n?(o=parseFloat(i),n===!0||isFinite(o)?o||0:i):i}}),pe.each(["height","width"],function(e,t){pe.cssHooks[t]={get:function(e,n,r){if(n)return!at.test(pe.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?O(e,t,r):$e(e,st,function(){return O(e,t,r)})},set:function(e,n,r){var i,o=r&&ot(e),a=r&&F(e,t,r,"border-box"===pe.css(e,"boxSizing",!1,o),o);return a&&(i=Me.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=pe.css(e,t)),H(e,n,a)}}}),pe.cssHooks.marginLeft=q(ce.reliableMarginLeft,function(e,t){if(t)return(parseFloat(A(e,"marginLeft"))||e.getBoundingClientRect().left-$e(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),pe.each({margin:"",padding:"",border:"Width"},function(e,t){pe.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+Ie[r]+t]=o[r]||o[r-2]||o[0];return i}},rt.test(e)||(pe.cssHooks[e+t].set=H)}),pe.fn.extend({css:function(e,t){return qe(this,function(e,t,n){var r,i,o={},a=0;if(pe.isArray(t)){for(r=ot(e),i=t.length;a<i;a++)o[t[a]]=pe.css(e,t[a],!1,r);return o}return void 0!==n?pe.style(e,t,n):pe.css(e,t)},e,t,arguments.length>1)}}),pe.Tween=P,P.prototype={constructor:P,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||pe.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(pe.cssNumber[n]?"":"px")},cur:function(){var e=P.propHooks[this.prop];return e&&e.get?e.get(this):P.propHooks._default.get(this)},run:function(e){var t,n=P.propHooks[this.prop];return this.options.duration?this.pos=t=pe.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):P.propHooks._default.set(this),this}},P.prototype.init.prototype=P.prototype,P.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=pe.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){pe.fx.step[e.prop]?pe.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[pe.cssProps[e.prop]]&&!pe.cssHooks[e.prop]?e.elem[e.prop]=e.now:pe.style(e.elem,e.prop,e.now+e.unit)}}},P.propHooks.scrollTop=P.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},pe.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},pe.fx=P.prototype.init,pe.fx.step={};var ft,pt,dt=/^(?:toggle|show|hide)$/,ht=/queueHooks$/;pe.Animation=pe.extend(_,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return d(n.elem,e,Me.exec(t),n),n}]},tweener:function(e,t){pe.isFunction(e)?(t=e,e=["*"]):e=e.match(De);for(var n,r=0,i=e.length;r<i;r++)n=e[r],_.tweeners[n]=_.tweeners[n]||[],_.tweeners[n].unshift(t)},prefilters:[$],prefilter:function(e,t){t?_.prefilters.unshift(e):_.prefilters.push(e)}}),pe.speed=function(e,t,n){var r=e&&"object"==typeof e?pe.extend({},e):{complete:n||!n&&t||pe.isFunction(e)&&e,duration:e,easing:n&&t||t&&!pe.isFunction(t)&&t};return pe.fx.off||Z.hidden?r.duration=0:r.duration="number"==typeof r.duration?r.duration:r.duration in pe.fx.speeds?pe.fx.speeds[r.duration]:pe.fx.speeds._default,null!=r.queue&&r.queue!==!0||(r.queue="fx"),r.old=r.complete,r.complete=function(){pe.isFunction(r.old)&&r.old.call(this),r.queue&&pe.dequeue(this,r.queue)},r},pe.fn.extend({fadeTo:function(e,t,n,r){return this.filter(We).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=pe.isEmptyObject(e),o=pe.speed(t,n,r),a=function(){var t=_(this,pe.extend({},e),o);(i||He.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=pe.timers,a=He.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&ht.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||pe.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=He.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=pe.timers,a=r?r.length:0;for(n.finish=!0,pe.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);
-delete n.finish})}}),pe.each(["toggle","show","hide"],function(e,t){var n=pe.fn[t];pe.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(I(t,!0),e,r,i)}}),pe.each({slideDown:I("show"),slideUp:I("hide"),slideToggle:I("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){pe.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),pe.timers=[],pe.fx.tick=function(){var e,t=0,n=pe.timers;for(ft=pe.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||pe.fx.stop(),ft=void 0},pe.fx.timer=function(e){pe.timers.push(e),e()?pe.fx.start():pe.timers.pop()},pe.fx.interval=13,pe.fx.start=function(){pt||(pt=e.requestAnimationFrame?e.requestAnimationFrame(R):e.setInterval(pe.fx.tick,pe.fx.interval))},pe.fx.stop=function(){e.cancelAnimationFrame?e.cancelAnimationFrame(pt):e.clearInterval(pt),pt=null},pe.fx.speeds={slow:600,fast:200,_default:400},pe.fn.delay=function(t,n){return t=pe.fx?pe.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=Z.createElement("input"),t=Z.createElement("select"),n=t.appendChild(Z.createElement("option"));e.type="checkbox",ce.checkOn=""!==e.value,ce.optSelected=n.selected,e=Z.createElement("input"),e.value="t",e.type="radio",ce.radioValue="t"===e.value}();var gt,mt=pe.expr.attrHandle;pe.fn.extend({attr:function(e,t){return qe(this,pe.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){pe.removeAttr(this,e)})}}),pe.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?pe.prop(e,t,n):(1===o&&pe.isXMLDoc(e)||(i=pe.attrHooks[t.toLowerCase()]||(pe.expr.match.bool.test(t)?gt:void 0)),void 0!==n?null===n?void pe.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:(r=pe.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set:function(e,t){if(!ce.radioValue&&"radio"===t&&pe.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(De);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),gt={set:function(e,t,n){return t===!1?pe.removeAttr(e,n):e.setAttribute(n,n),n}},pe.each(pe.expr.match.bool.source.match(/\w+/g),function(e,t){var n=mt[t]||pe.find.attr;mt[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=mt[a],mt[a]=i,i=null!=n(e,t,r)?a:null,mt[a]=o),i}});var vt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;pe.fn.extend({prop:function(e,t){return qe(this,pe.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[pe.propFix[e]||e]})}}),pe.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&pe.isXMLDoc(e)||(t=pe.propFix[t]||t,i=pe.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=pe.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ce.optSelected||(pe.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),pe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){pe.propFix[this.toLowerCase()]=this});var xt=/[\t\r\n\f]/g;pe.fn.extend({addClass:function(e){var t,n,r,i,o,a,s,u=0;if(pe.isFunction(e))return this.each(function(t){pe(this).addClass(e.call(this,t,z(this)))});if("string"==typeof e&&e)for(t=e.match(De)||[];n=this[u++];)if(i=z(n),r=1===n.nodeType&&(" "+i+" ").replace(xt," ")){for(a=0;o=t[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");s=pe.trim(r),i!==s&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,o,a,s,u=0;if(pe.isFunction(e))return this.each(function(t){pe(this).removeClass(e.call(this,t,z(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(De)||[];n=this[u++];)if(i=z(n),r=1===n.nodeType&&(" "+i+" ").replace(xt," ")){for(a=0;o=t[a++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");s=pe.trim(r),i!==s&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):pe.isFunction(e)?this.each(function(n){pe(this).toggleClass(e.call(this,n,z(this),t),t)}):this.each(function(){var t,r,i,o;if("string"===n)for(r=0,i=pe(this),o=e.match(De)||[];t=o[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==e&&"boolean"!==n||(t=z(this),t&&He.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":He.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+z(n)+" ").replace(xt," ").indexOf(t)>-1)return!0;return!1}});var bt=/\r/g,wt=/[\x20\t\r\n\f]+/g;pe.fn.extend({val:function(e){var t,n,r,i=this[0];{if(arguments.length)return r=pe.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,pe(this).val()):e,null==i?i="":"number"==typeof i?i+="":pe.isArray(i)&&(i=pe.map(i,function(e){return null==e?"":e+""})),t=pe.valHooks[this.type]||pe.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return t=pe.valHooks[i.type]||pe.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(bt,""):null==n?"":n)}}}),pe.extend({valHooks:{option:{get:function(e){var t=pe.find.attr(e,"value");return null!=t?t:pe.trim(pe.text(e)).replace(wt," ")}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type,a=o?null:[],s=o?i+1:r.length,u=i<0?s:o?i:0;u<s;u++)if(n=r[u],(n.selected||u===i)&&!n.disabled&&(!n.parentNode.disabled||!pe.nodeName(n.parentNode,"optgroup"))){if(t=pe(n).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var n,r,i=e.options,o=pe.makeArray(t),a=i.length;a--;)r=i[a],(r.selected=pe.inArray(pe.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),pe.each(["radio","checkbox"],function(){pe.valHooks[this]={set:function(e,t){if(pe.isArray(t))return e.checked=pe.inArray(pe(e).val(),t)>-1}},ce.checkOn||(pe.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Tt=/^(?:focusinfocus|focusoutblur)$/;pe.extend(pe.event,{trigger:function(t,n,r,i){var o,a,s,u,l,c,f,p=[r||Z],d=se.call(t,"type")?t.type:t,h=se.call(t,"namespace")?t.namespace.split("."):[];if(a=s=r=r||Z,3!==r.nodeType&&8!==r.nodeType&&!Tt.test(d+pe.event.triggered)&&(d.indexOf(".")>-1&&(h=d.split("."),d=h.shift(),h.sort()),l=d.indexOf(":")<0&&"on"+d,t=t[pe.expando]?t:new pe.Event(d,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=h.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:pe.makeArray(n,[t]),f=pe.event.special[d]||{},i||!f.trigger||f.trigger.apply(r,n)!==!1)){if(!i&&!f.noBubble&&!pe.isWindow(r)){for(u=f.delegateType||d,Tt.test(u+d)||(a=a.parentNode);a;a=a.parentNode)p.push(a),s=a;s===(r.ownerDocument||Z)&&p.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=p[o++])&&!t.isPropagationStopped();)t.type=o>1?u:f.bindType||d,c=(He.get(a,"events")||{})[t.type]&&He.get(a,"handle"),c&&c.apply(a,n),c=l&&a[l],c&&c.apply&&Le(a)&&(t.result=c.apply(a,n),t.result===!1&&t.preventDefault());return t.type=d,i||t.isDefaultPrevented()||f._default&&f._default.apply(p.pop(),n)!==!1||!Le(r)||l&&pe.isFunction(r[d])&&!pe.isWindow(r)&&(s=r[l],s&&(r[l]=null),pe.event.triggered=d,r[d](),pe.event.triggered=void 0,s&&(r[l]=s)),t.result}},simulate:function(e,t,n){var r=pe.extend(new pe.Event,n,{type:e,isSimulated:!0});pe.event.trigger(r,null,t)}}),pe.fn.extend({trigger:function(e,t){return this.each(function(){pe.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return pe.event.trigger(e,t,n,!0)}}),pe.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){pe.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),pe.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ce.focusin="onfocusin"in e,ce.focusin||pe.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){pe.event.simulate(t,e.target,pe.event.fix(e))};pe.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=He.access(r,t);i||r.addEventListener(e,n,!0),He.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=He.access(r,t)-1;i?He.access(r,t,i):(r.removeEventListener(e,n,!0),He.remove(r,t))}}});var Ct=e.location,kt=pe.now(),Et=/\?/;pe.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||pe.error("Invalid XML: "+t),n};var St=/\[\]$/,Nt=/\r?\n/g,Dt=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;pe.param=function(e,t){var n,r=[],i=function(e,t){var n=pe.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(pe.isArray(e)||e.jquery&&!pe.isPlainObject(e))pe.each(e,function(){i(this.name,this.value)});else for(n in e)X(n,e[n],t,i);return r.join("&")},pe.fn.extend({serialize:function(){return pe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=pe.prop(this,"elements");return e?pe.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!pe(this).is(":disabled")&&jt.test(this.nodeName)&&!Dt.test(e)&&(this.checked||!_e.test(e))}).map(function(e,t){var n=pe(this).val();return null==n?null:pe.isArray(n)?pe.map(n,function(e){return{name:t.name,value:e.replace(Nt,"\r\n")}}):{name:t.name,value:n.replace(Nt,"\r\n")}}).get()}});var At=/%20/g,qt=/#.*$/,Lt=/([?&])_=[^&]*/,Ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ot=/^(?:GET|HEAD)$/,Pt=/^\/\//,Rt={},Mt={},It="*/".concat("*"),Wt=Z.createElement("a");Wt.href=Ct.href,pe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:Ft.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":It,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":pe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?G(G(e,pe.ajaxSettings),t):G(pe.ajaxSettings,e)},ajaxPrefilter:U(Rt),ajaxTransport:U(Mt),ajax:function(t,n){function r(t,n,r,s){var l,p,d,b,w,T=n;c||(c=!0,u&&e.clearTimeout(u),i=void 0,a=s||"",C.readyState=t>0?4:0,l=t>=200&&t<300||304===t,r&&(b=Y(h,C,r)),b=Q(h,b,C,l),l?(h.ifModified&&(w=C.getResponseHeader("Last-Modified"),w&&(pe.lastModified[o]=w),w=C.getResponseHeader("etag"),w&&(pe.etag[o]=w)),204===t||"HEAD"===h.type?T="nocontent":304===t?T="notmodified":(T=b.state,p=b.data,d=b.error,l=!d)):(d=T,!t&&T||(T="error",t<0&&(t=0))),C.status=t,C.statusText=(n||T)+"",l?v.resolveWith(g,[p,T,C]):v.rejectWith(g,[C,T,d]),C.statusCode(x),x=void 0,f&&m.trigger(l?"ajaxSuccess":"ajaxError",[C,h,l?p:d]),y.fireWith(g,[C,T]),f&&(m.trigger("ajaxComplete",[C,h]),--pe.active||pe.event.trigger("ajaxStop")))}"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,o,a,s,u,l,c,f,p,d,h=pe.ajaxSetup({},n),g=h.context||h,m=h.context&&(g.nodeType||g.jquery)?pe(g):pe.event,v=pe.Deferred(),y=pe.Callbacks("once memory"),x=h.statusCode||{},b={},w={},T="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s)for(s={};t=Ht.exec(a);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(e,t){return null==c&&(e=w[e.toLowerCase()]=w[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)C.always(e[C.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||T;return i&&i.abort(t),r(0,t),this}};if(v.promise(C),h.url=((t||h.url||Ct.href)+"").replace(Pt,Ct.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(De)||[""],null==h.crossDomain){l=Z.createElement("a");try{l.href=h.url,l.href=l.href,h.crossDomain=Wt.protocol+"//"+Wt.host!=l.protocol+"//"+l.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=pe.param(h.data,h.traditional)),V(Rt,h,n,C),c)return C;f=pe.event&&h.global,f&&0===pe.active++&&pe.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Ot.test(h.type),o=h.url.replace(qt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(At,"+")):(d=h.url.slice(o.length),h.data&&(o+=(Et.test(o)?"&":"?")+h.data,delete h.data),h.cache===!1&&(o=o.replace(Lt,""),d=(Et.test(o)?"&":"?")+"_="+kt++ +d),h.url=o+d),h.ifModified&&(pe.lastModified[o]&&C.setRequestHeader("If-Modified-Since",pe.lastModified[o]),pe.etag[o]&&C.setRequestHeader("If-None-Match",pe.etag[o])),(h.data&&h.hasContent&&h.contentType!==!1||n.contentType)&&C.setRequestHeader("Content-Type",h.contentType),C.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+It+"; q=0.01":""):h.accepts["*"]);for(p in h.headers)C.setRequestHeader(p,h.headers[p]);if(h.beforeSend&&(h.beforeSend.call(g,C,h)===!1||c))return C.abort();if(T="abort",y.add(h.complete),C.done(h.success),C.fail(h.error),i=V(Mt,h,n,C)){if(C.readyState=1,f&&m.trigger("ajaxSend",[C,h]),c)return C;h.async&&h.timeout>0&&(u=e.setTimeout(function(){C.abort("timeout")},h.timeout));try{c=!1,i.send(b,r)}catch(e){if(c)throw e;r(-1,e)}}else r(-1,"No Transport");return C},getJSON:function(e,t,n){return pe.get(e,t,n,"json")},getScript:function(e,t){return pe.get(e,void 0,t,"script")}}),pe.each(["get","post"],function(e,t){pe[t]=function(e,n,r,i){return pe.isFunction(n)&&(i=i||r,r=n,n=void 0),pe.ajax(pe.extend({url:e,type:t,dataType:i,data:n,success:r},pe.isPlainObject(e)&&e))}}),pe._evalUrl=function(e){return pe.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},pe.fn.extend({wrapAll:function(e){var t;return this[0]&&(pe.isFunction(e)&&(e=e.call(this[0])),t=pe(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return pe.isFunction(e)?this.each(function(t){pe(this).wrapInner(e.call(this,t))}):this.each(function(){var t=pe(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=pe.isFunction(e);return this.each(function(n){pe(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){pe(this).replaceWith(this.childNodes)}),this}}),pe.expr.pseudos.hidden=function(e){return!pe.expr.pseudos.visible(e)},pe.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},pe.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var $t={0:200,1223:204},Bt=pe.ajaxSettings.xhr();ce.cors=!!Bt&&"withCredentials"in Bt,ce.ajax=Bt=!!Bt,pe.ajaxTransport(function(t){var n,r;if(ce.cors||Bt&&!t.crossDomain)return{send:function(i,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(a in i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o($t[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),pe.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),pe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return pe.globalEval(e),e}}}),pe.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),pe.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=pe("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),Z.head.appendChild(t[0])},abort:function(){n&&n()}}}});var _t=[],zt=/(=)\?(?=&|$)|\?\?/;pe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=_t.pop()||pe.expando+"_"+kt++;return this[e]=!0,e}}),pe.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,a,s=t.jsonp!==!1&&(zt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&zt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=pe.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(zt,"$1"+i):t.jsonp!==!1&&(t.url+=(Et.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||pe.error(i+" was not called"),a[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===o?pe(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,_t.push(i)),a&&pe.isFunction(o)&&o(a[0]),a=o=void 0}),"script"}),ce.createHTMLDocument=function(){var e=Z.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),pe.parseHTML=function(e,t,n){if("string"!=typeof e)return[];"boolean"==typeof t&&(n=t,t=!1);var r,i,o;return t||(ce.createHTMLDocument?(t=Z.implementation.createHTMLDocument(""),r=t.createElement("base"),r.href=Z.location.href,t.head.appendChild(r)):t=Z),i=we.exec(e),o=!n&&[],i?[t.createElement(i[1])]:(i=y([e],t,o),o&&o.length&&pe(o).remove(),pe.merge([],i.childNodes))},pe.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=pe.trim(e.slice(s)),e=e.slice(0,s)),pe.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&pe.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?pe("<div>").append(pe.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},pe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){pe.fn[t]=function(e){return this.on(t,e)}}),pe.expr.pseudos.animated=function(e){return pe.grep(pe.timers,function(t){return e===t.elem}).length},pe.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l,c=pe.css(e,"position"),f=pe(e),p={};"static"===c&&(e.style.position="relative"),s=f.offset(),o=pe.css(e,"top"),u=pe.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1,l?(r=f.position(),a=r.top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),pe.isFunction(t)&&(t=t.call(e,n,pe.extend({},s))),null!=t.top&&(p.top=t.top-s.top+a),null!=t.left&&(p.left=t.left-s.left+i),"using"in t?t.using.call(e,p):f.css(p)}},pe.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){pe.offset.setOffset(this,e,t)});var t,n,r,i,o=this[0];if(o)return o.getClientRects().length?(r=o.getBoundingClientRect(),r.width||r.height?(i=o.ownerDocument,n=J(i),t=i.documentElement,{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}):r):{top:0,left:0}},position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===pe.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),pe.nodeName(e[0],"html")||(r=e.offset()),r={top:r.top+pe.css(e[0],"borderTopWidth",!0),left:r.left+pe.css(e[0],"borderLeftWidth",!0)}),{top:t.top-r.top-pe.css(n,"marginTop",!0),left:t.left-r.left-pe.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===pe.css(e,"position");)e=e.offsetParent;return e||Ge})}}),pe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;pe.fn[e]=function(r){return qe(this,function(e,r,i){var o=J(e);return void 0===i?o?o[t]:e[r]:void(o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i)},e,r,arguments.length)}}),pe.each(["top","left"],function(e,t){pe.cssHooks[t]=q(ce.pixelPosition,function(e,n){if(n)return n=A(e,t),it.test(n)?pe(e).position()[t]+"px":n})}),pe.each({Height:"height",Width:"width"},function(e,t){pe.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){pe.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(i===!0||o===!0?"margin":"border");return qe(this,function(t,n,i){var o;return pe.isWindow(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?pe.css(t,n,s):pe.style(t,n,i,s)},t,a?i:void 0,a)}})}),pe.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),pe.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return pe});var Xt=e.jQuery,Ut=e.$;return pe.noConflict=function(t){return e.$===pe&&(e.$=Ut),t&&e.jQuery===pe&&(e.jQuery=Xt),pe},t||(e.jQuery=e.$=pe),pe});
+!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function n(e,t){t=t||te;var n=t.createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)}function r(e){var t=!!e&&"length"in e&&e.length,n=he.type(e);return"function"!==n&&!he.isWindow(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function i(e,t,n){return he.isFunction(t)?he.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?he.grep(e,function(e){return e===t!==n}):"string"!=typeof t?he.grep(e,function(e){return ae.call(t,e)>-1!==n}):Ee.test(t)?he.filter(t,e,n):(t=he.filter(t,e),he.grep(e,function(e){return ae.call(t,e)>-1!==n&&1===e.nodeType}))}function o(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function a(e){var t={};return he.each(e.match(Ae)||[],function(e,n){t[n]=!0}),t}function s(e){return e}function u(e){throw e}function l(e,t,n){var r;try{e&&he.isFunction(r=e.promise)?r.call(e).done(t).fail(n):e&&he.isFunction(r=e.then)?r.call(e,t,n):t.call(void 0,e)}catch(e){n.call(void 0,e)}}function c(){te.removeEventListener("DOMContentLoaded",c),e.removeEventListener("load",c),he.ready()}function f(){this.expando=he.expando+f.uid++}function p(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Re.test(e)?JSON.parse(e):e)}function d(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Me,"-$&").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n=p(n)}catch(e){}Pe.set(e,t,n)}else n=void 0;return n}function h(e,t,n,r){var i,o=1,a=20,s=r?function(){return r.cur()}:function(){return he.css(e,t,"")},u=s(),l=n&&n[3]||(he.cssNumber[t]?"":"px"),c=(he.cssNumber[t]||"px"!==l&&+u)&&We.exec(he.css(e,t));if(c&&c[3]!==l){l=l||c[3],n=n||[],c=+u||1;do o=o||".5",c/=o,he.style(e,t,c+l);while(o!==(o=s()/u)&&1!==o&&--a)}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}function g(e){var t,n=e.ownerDocument,r=e.nodeName,i=ze[r];return i?i:(t=n.body.appendChild(n.createElement(r)),i=he.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),ze[r]=i,i)}function m(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)r=e[o],r.style&&(n=r.style.display,t?("none"===n&&(i[o]=Oe.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&Be(r)&&(i[o]=g(r))):"none"!==n&&(i[o]="none",Oe.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}function v(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&he.nodeName(e,t)?he.merge([e],n):n}function y(e,t){for(var n=0,r=e.length;n<r;n++)Oe.set(e[n],"globalEval",!t||Oe.get(t[n],"globalEval"))}function x(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if(o=e[d],o||0===o)if("object"===he.type(o))he.merge(p,o.nodeType?[o]:o);else if(Ye.test(o)){for(a=a||f.appendChild(t.createElement("div")),s=(Ue.exec(o)||["",""])[1].toLowerCase(),u=Ge[s]||Ge._default,a.innerHTML=u[1]+he.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;he.merge(p,a.childNodes),a=f.firstChild,a.textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&he.inArray(o,r)>-1)i&&i.push(o);else if(l=he.contains(o.ownerDocument,o),a=v(f.appendChild(o),"script"),l&&y(a),n)for(c=0;o=a[c++];)Ve.test(o.type||"")&&n.push(o);return f}function b(){return!0}function w(){return!1}function T(){try{return te.activeElement}catch(e){}}function C(e,t,n,r,i,o){var a,s;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(s in t)C(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),i===!1)i=w;else if(!i)return e;return 1===o&&(a=i,i=function(e){return he().off(e),a.apply(this,arguments)},i.guid=a.guid||(a.guid=he.guid++)),e.each(function(){he.event.add(this,t,i,r,n)})}function E(e,t){return he.nodeName(e,"table")&&he.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e:e}function k(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function N(e){var t=rt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function S(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(Oe.hasData(e)&&(o=Oe.access(e),a=Oe.set(t,o),l=o.events)){delete a.handle,a.events={};for(i in l)for(n=0,r=l[i].length;n<r;n++)he.event.add(t,i,l[i][n])}Pe.hasData(e)&&(s=Pe.access(e),u=he.extend({},s),Pe.set(t,u))}}function D(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Xe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function j(e,t,r,i){t=ie.apply([],t);var o,a,s,u,l,c,f=0,p=e.length,d=p-1,h=t[0],g=he.isFunction(h);if(g||p>1&&"string"==typeof h&&!pe.checkClone&&nt.test(h))return e.each(function(n){var o=e.eq(n);g&&(t[0]=h.call(this,n,o.html())),j(o,t,r,i)});if(p&&(o=x(t,e[0].ownerDocument,!1,e,i),a=o.firstChild,1===o.childNodes.length&&(o=a),a||i)){for(s=he.map(v(o,"script"),k),u=s.length;f<p;f++)l=o,f!==d&&(l=he.clone(l,!0,!0),u&&he.merge(s,v(l,"script"))),r.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,he.map(s,N),f=0;f<u;f++)l=s[f],Ve.test(l.type||"")&&!Oe.access(l,"globalEval")&&he.contains(c,l)&&(l.src?he._evalUrl&&he._evalUrl(l.src):n(l.textContent.replace(it,""),c))}return e}function A(e,t,n){for(var r,i=t?he.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||he.cleanData(v(r)),r.parentNode&&(n&&he.contains(r.ownerDocument,r)&&y(v(r,"script")),r.parentNode.removeChild(r));return e}function q(e,t,n){var r,i,o,a,s=e.style;return n=n||st(e),n&&(a=n.getPropertyValue(t)||n[t],""!==a||he.contains(e.ownerDocument,e)||(a=he.style(e,t)),!pe.pixelMarginRight()&&at.test(a)&&ot.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function L(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function H(e){if(e in pt)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=ft.length;n--;)if(e=ft[n]+t,e in pt)return e}function F(e,t,n){var r=We.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function O(e,t,n,r,i){var o,a=0;for(o=n===(r?"border":"content")?4:"width"===t?1:0;o<4;o+=2)"margin"===n&&(a+=he.css(e,n+$e[o],!0,i)),r?("content"===n&&(a-=he.css(e,"padding"+$e[o],!0,i)),"margin"!==n&&(a-=he.css(e,"border"+$e[o]+"Width",!0,i))):(a+=he.css(e,"padding"+$e[o],!0,i),"padding"!==n&&(a+=he.css(e,"border"+$e[o]+"Width",!0,i)));return a}function P(e,t,n){var r,i=!0,o=st(e),a="border-box"===he.css(e,"boxSizing",!1,o);if(e.getClientRects().length&&(r=e.getBoundingClientRect()[t]),r<=0||null==r){if(r=q(e,t,o),(r<0||null==r)&&(r=e.style[t]),at.test(r))return r;i=a&&(pe.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+O(e,t,n||(a?"border":"content"),i,o)+"px"}function R(e,t,n,r,i){return new R.prototype.init(e,t,n,r,i)}function M(){ht&&(e.requestAnimationFrame(M),he.fx.tick())}function I(){return e.setTimeout(function(){dt=void 0}),dt=he.now()}function W(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)n=$e[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function $(e,t,n){for(var r,i=(z.tweeners[t]||[]).concat(z.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function B(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&Be(e),v=Oe.get(e,"fxshow");n.queue||(a=he._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,he.queue(e,"fx").length||a.empty.fire()})}));for(r in t)if(i=t[r],gt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||he.style(e,r)}if(u=!he.isEmptyObject(t),u||!he.isEmptyObject(d)){f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],l=v&&v.display,null==l&&(l=Oe.get(e,"display")),c=he.css(e,"display"),"none"===c&&(l?c=l:(m([e],!0),l=e.style.display||l,c=he.css(e,"display"),m([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===he.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1;for(r in d)u||(v?"hidden"in v&&(g=v.hidden):v=Oe.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&m([e],!0),p.done(function(){g||m([e]),Oe.remove(e,"fxshow");for(r in d)he.style(e,r,d[r])})),u=$(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}}function _(e,t){var n,r,i,o,a;for(n in e)if(r=he.camelCase(n),i=t[r],o=e[n],he.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),a=he.cssHooks[r],a&&"expand"in a){o=a.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function z(e,t,n){var r,i,o=0,a=z.prefilters.length,s=he.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=dt||I(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;a<u;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),o<1&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:he.extend({},t),opts:he.extend(!0,{specialEasing:{},easing:he.easing._default},n),originalProperties:t,originalOptions:n,startTime:dt||I(),duration:n.duration,tweens:[],createTween:function(t,n){var r=he.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(_(c,l.opts.specialEasing);o<a;o++)if(r=z.prefilters[o].call(l,e,c,l.opts))return he.isFunction(r.stop)&&(he._queueHooks(l.elem,l.opts.queue).stop=he.proxy(r.stop,r)),r;return he.map(c,$,l),he.isFunction(l.opts.start)&&l.opts.start.call(e,l),he.fx.timer(he.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function X(e){var t=e.match(Ae)||[];return t.join(" ")}function U(e){return e.getAttribute&&e.getAttribute("class")||""}function V(e,t,n,r){var i;if(he.isArray(t))he.each(t,function(t,i){n||Nt.test(e)?r(e,i):V(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==he.type(t))r(e,t);else for(i in t)V(e+"["+i+"]",t[i],n,r)}function G(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(Ae)||[];if(he.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Y(e,t,n,r){function i(s){var u;return o[s]=!0,he.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||a||o[l]?a?!(u=l):void 0:(t.dataTypes.unshift(l),i(l),!1)}),u}var o={},a=e===Mt;return i(t.dataTypes[0])||!o["*"]&&i("*")}function Q(e,t){var n,r,i=he.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&he.extend(!0,e,r),e}function J(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}function K(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(a=l[u+" "+o]||l["* "+o],!a)for(i in l)if(s=i.split(" "),s[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){a===!0?a=l[i]:l[i]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}function Z(e){return he.isWindow(e)?e:9===e.nodeType&&e.defaultView}var ee=[],te=e.document,ne=Object.getPrototypeOf,re=ee.slice,ie=ee.concat,oe=ee.push,ae=ee.indexOf,se={},ue=se.toString,le=se.hasOwnProperty,ce=le.toString,fe=ce.call(Object),pe={},de="3.1.1",he=function(e,t){return new he.fn.init(e,t)},ge=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,me=/^-ms-/,ve=/-([a-z])/g,ye=function(e,t){return t.toUpperCase()};he.fn=he.prototype={jquery:de,constructor:he,length:0,toArray:function(){return re.call(this)},get:function(e){return null==e?re.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=he.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return he.each(this,e)},map:function(e){return this.pushStack(he.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(re.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:oe,sort:ee.sort,splice:ee.splice},he.extend=he.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||he.isFunction(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],r=e[t],a!==r&&(l&&r&&(he.isPlainObject(r)||(i=he.isArray(r)))?(i?(i=!1,o=n&&he.isArray(n)?n:[]):o=n&&he.isPlainObject(n)?n:{},a[t]=he.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},he.extend({expando:"jQuery"+(de+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===he.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=he.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==ue.call(e))&&(!(t=ne(e))||(n=le.call(t,"constructor")&&t.constructor,"function"==typeof n&&ce.call(n)===fe))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?se[ue.call(e)]||"object":typeof e},globalEval:function(e){n(e)},camelCase:function(e){return e.replace(me,"ms-").replace(ve,ye)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var n,i=0;if(r(e))for(n=e.length;i<n&&t.call(e[i],i,e[i])!==!1;i++);else for(i in e)if(t.call(e[i],i,e[i])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ge,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(r(Object(e))?he.merge(n,"string"==typeof e?[e]:e):oe.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:ae.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,a=e.length,s=!n;o<a;o++)r=!t(e[o],o),r!==s&&i.push(e[o]);return i},map:function(e,t,n){var i,o,a=0,s=[];if(r(e))for(i=e.length;a<i;a++)o=t(e[a],a,n),null!=o&&s.push(o);else for(a in e)o=t(e[a],a,n),null!=o&&s.push(o);return ie.apply([],s)},guid:1,proxy:function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),he.isFunction(e))return r=re.call(arguments,2),i=function(){return e.apply(t||this,r.concat(re.call(arguments)))},i.guid=e.guid=e.guid||he.guid++,i},now:Date.now,support:pe}),"function"==typeof Symbol&&(he.fn[Symbol.iterator]=ee[Symbol.iterator]),he.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){se["[object "+t+"]"]=t.toLowerCase()});var xe=function(e){function t(e,t,n,r){var i,o,a,s,u,l,c,p=t&&t.ownerDocument,h=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==h&&9!==h&&11!==h)return n;if(!r&&((t?t.ownerDocument||t:$)!==H&&L(t),t=t||H,O)){if(11!==h&&(u=ve.exec(e)))if(i=u[1]){if(9===h){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(p&&(a=p.getElementById(i))&&I(t,a)&&a.id===i)return n.push(a),n}else{if(u[2])return K.apply(n,t.getElementsByTagName(e)),n;if((i=u[3])&&T.getElementsByClassName&&t.getElementsByClassName)return K.apply(n,t.getElementsByClassName(i)),n}if(T.qsa&&!U[e+" "]&&(!P||!P.test(e))){if(1!==h)p=t,c=e;else if("object"!==t.nodeName.toLowerCase()){for((s=t.getAttribute("id"))?s=s.replace(we,Te):t.setAttribute("id",s=W),l=N(e),o=l.length;o--;)l[o]="#"+s+" "+d(l[o]);c=l.join(","),p=ye.test(e)&&f(t.parentNode)||t}if(c)try{return K.apply(n,p.querySelectorAll(c)),n}catch(e){}finally{s===W&&t.removeAttribute("id")}}}return D(e.replace(se,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>C.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[W]=!0,e}function i(e){var t=H.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var n=e.split("|"),r=n.length;r--;)C.attrHandle[n[r]]=t}function a(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function s(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function u(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function l(e){return function(t){return"form"in t?t.parentNode&&t.disabled===!1?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Ee(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function c(e){return r(function(t){return t=+t,r(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function f(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function p(){}function d(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function h(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=_++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||a)return e(t,n,i);return!1}:function(t,n,u){var l,c,f,p=[B,s];if(u){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(f=t[W]||(t[W]={}),c=f[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===B&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}return!1}}function g(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function m(e,n,r){for(var i=0,o=n.length;i<o;i++)t(e,n[i],r);return r}function v(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function y(e,t,n,i,o,a){return i&&!i[W]&&(i=y(i)),o&&!o[W]&&(o=y(o,a)),r(function(r,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=r||m(t||"*",s.nodeType?[s]:s,[]),y=!e||!r&&t?g:v(g,p,e,s,u),x=n?o||(r?e:h||i)?[]:a:y;if(n&&n(y,x,s,u),i)for(l=v(x,d),i(l,[],s,u),c=l.length;c--;)(f=l[c])&&(x[d[c]]=!(y[d[c]]=f));if(r){if(o||e){if(o){for(l=[],c=x.length;c--;)(f=x[c])&&l.push(y[c]=f);o(null,x=[],l,u)}for(c=x.length;c--;)(f=x[c])&&(l=o?ee(r,f):p[c])>-1&&(r[l]=!(a[l]=f))}}else x=v(x===a?x.splice(h,x.length):x),o?o(null,a,x,u):K.apply(a,x)})}function x(e){for(var t,n,r,i=e.length,o=C.relative[e[0].type],a=o||C.relative[" "],s=o?1:0,u=h(function(e){return e===t},a,!0),l=h(function(e){return ee(t,e)>-1},a,!0),c=[function(e,n,r){var i=!o&&(r||n!==j)||((t=n).nodeType?u(e,n,r):l(e,n,r));return t=null,i}];s<i;s++)if(n=C.relative[e[s].type])c=[h(g(c),n)];else{if(n=C.filter[e[s].type].apply(null,e[s].matches),n[W]){for(r=++s;r<i&&!C.relative[e[r].type];r++);return y(s>1&&g(c),s>1&&d(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(se,"$1"),n,s<r&&x(e.slice(s,r)),r<i&&x(e=e.slice(r)),r<i&&d(e))}c.push(n)}return g(c)}function b(e,n){var i=n.length>0,o=e.length>0,a=function(r,a,s,u,l){var c,f,p,d=0,h="0",g=r&&[],m=[],y=j,x=r||o&&C.find.TAG("*",l),b=B+=null==y?1:Math.random()||.1,w=x.length;for(l&&(j=a===H||a||l);h!==w&&null!=(c=x[h]);h++){if(o&&c){for(f=0,a||c.ownerDocument===H||(L(c),s=!O);p=e[f++];)if(p(c,a||H,s)){u.push(c);break}l&&(B=b)}i&&((c=!p&&c)&&d--,r&&g.push(c))}if(d+=h,i&&h!==d){for(f=0;p=n[f++];)p(g,m,a,s);if(r){if(d>0)for(;h--;)g[h]||m[h]||(m[h]=Q.call(u));m=v(m)}K.apply(u,m),l&&!r&&m.length>0&&d+n.length>1&&t.uniqueSort(u)}return l&&(B=b,j=y),g};return i?r(a):a}var w,T,C,E,k,N,S,D,j,A,q,L,H,F,O,P,R,M,I,W="sizzle"+1*new Date,$=e.document,B=0,_=0,z=n(),X=n(),U=n(),V=function(e,t){return e===t&&(q=!0),0},G={}.hasOwnProperty,Y=[],Q=Y.pop,J=Y.push,K=Y.push,Z=Y.slice,ee=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",ie="\\["+ne+"*("+re+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ne+"*\\]",oe=":("+re+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ie+")*)|.*)\\)|)",ae=new RegExp(ne+"+","g"),se=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),ue=new RegExp("^"+ne+"*,"+ne+"*"),le=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),ce=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),fe=new RegExp(oe),pe=new RegExp("^"+re+"$"),de={ID:new RegExp("^#("+re+")"),CLASS:new RegExp("^\\.("+re+")"),TAG:new RegExp("^("+re+"|[*])"),ATTR:new RegExp("^"+ie),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},he=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,me=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,xe=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),be=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},we=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,Te=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},Ce=function(){L()},Ee=h(function(e){return e.disabled===!0&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{K.apply(Y=Z.call($.childNodes),$.childNodes),Y[$.childNodes.length].nodeType}catch(e){K={apply:Y.length?function(e,t){J.apply(e,Z.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}T=t.support={},k=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},L=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:$;return r!==H&&9===r.nodeType&&r.documentElement?(H=r,F=H.documentElement,O=!k(H),$!==H&&(n=H.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",Ce,!1):n.attachEvent&&n.attachEvent("onunload",Ce)),T.attributes=i(function(e){return e.className="i",!e.getAttribute("className")}),T.getElementsByTagName=i(function(e){return e.appendChild(H.createComment("")),!e.getElementsByTagName("*").length}),T.getElementsByClassName=me.test(H.getElementsByClassName),T.getById=i(function(e){return F.appendChild(e).id=W,!H.getElementsByName||!H.getElementsByName(W).length}),T.getById?(C.filter.ID=function(e){var t=e.replace(xe,be);return function(e){return e.getAttribute("id")===t}},C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&O){var n=t.getElementById(e);return n?[n]:[]}}):(C.filter.ID=function(e){var t=e.replace(xe,be);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&O){var n,r,i,o=t.getElementById(e);if(o){if(n=o.getAttributeNode("id"),n&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if(n=o.getAttributeNode("id"),n&&n.value===e)return[o]}return[]}}),C.find.TAG=T.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):T.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},C.find.CLASS=T.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&O)return t.getElementsByClassName(e)},R=[],P=[],(T.qsa=me.test(H.querySelectorAll))&&(i(function(e){F.appendChild(e).innerHTML="<a id='"+W+"'></a><select id='"+W+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&P.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||P.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+W+"-]").length||P.push("~="),e.querySelectorAll(":checked").length||P.push(":checked"),e.querySelectorAll("a#"+W+"+*").length||P.push(".#.+[+~]")}),i(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=H.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&P.push("name"+ne+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&P.push(":enabled",":disabled"),F.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&P.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),P.push(",.*:")})),(T.matchesSelector=me.test(M=F.matches||F.webkitMatchesSelector||F.mozMatchesSelector||F.oMatchesSelector||F.msMatchesSelector))&&i(function(e){T.disconnectedMatch=M.call(e,"*"),M.call(e,"[s!='']:x"),R.push("!=",oe)}),P=P.length&&new RegExp(P.join("|")),R=R.length&&new RegExp(R.join("|")),t=me.test(F.compareDocumentPosition),I=t||me.test(F.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},V=t?function(e,t){if(e===t)return q=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!T.sortDetached&&t.compareDocumentPosition(e)===n?e===H||e.ownerDocument===$&&I($,e)?-1:t===H||t.ownerDocument===$&&I($,t)?1:A?ee(A,e)-ee(A,t):0:4&n?-1:1)}:function(e,t){if(e===t)return q=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,s=[e],u=[t];if(!i||!o)return e===H?-1:t===H?1:i?-1:o?1:A?ee(A,e)-ee(A,t):0;if(i===o)return a(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;s[r]===u[r];)r++;return r?a(s[r],u[r]):s[r]===$?-1:u[r]===$?1:0},H):H},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==H&&L(e),n=n.replace(ce,"='$1']"),T.matchesSelector&&O&&!U[n+" "]&&(!R||!R.test(n))&&(!P||!P.test(n)))try{var r=M.call(e,n);if(r||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return t(n,H,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==H&&L(e),I(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==H&&L(e);var n=C.attrHandle[t.toLowerCase()],r=n&&G.call(C.attrHandle,t.toLowerCase())?n(e,t,!O):void 0;return void 0!==r?r:T.attributes||!O?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.escape=function(e){return(e+"").replace(we,Te)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,i=0;if(q=!T.detectDuplicates,A=!T.sortStable&&e.slice(0),e.sort(V),q){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return A=null,e},E=t.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=E(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=E(t);return n},C=t.selectors={cacheLength:50,createPseudo:r,match:de,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(xe,be),e[3]=(e[3]||e[4]||e[5]||"").replace(xe,be),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return de.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&fe.test(n)&&(t=N(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(xe,be).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=z[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&z(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(i){var o=t.attr(i,e);return null==o?"!="===n:!n||(o+="","="===n?o===r:"!="===n?o!==r:"^="===n?r&&0===o.indexOf(r):"*="===n?r&&o.indexOf(r)>-1:"$="===n?r&&o.slice(-r.length)===r:"~="===n?(" "+o.replace(ae," ")+" ").indexOf(r)>-1:"|="===n&&(o===r||o.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!u&&!s,x=!1;if(m){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&y){for(p=m,f=p[W]||(p[W]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),l=c[e]||[],d=l[0]===B&&l[1],x=d&&l[2],p=d&&m.childNodes[d];p=++d&&p&&p[g]||(x=d=0)||h.pop();)if(1===p.nodeType&&++x&&p===t){c[e]=[B,d,x];break}}else if(y&&(p=t,f=p[W]||(p[W]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),l=c[e]||[],d=l[0]===B&&l[1],x=d),x===!1)for(;(p=++d&&p&&p[g]||(x=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==v:1!==p.nodeType)||!++x||(y&&(f=p[W]||(p[W]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),c[e]=[B,x]),p!==t)););return x-=i,x===r||x%r===0&&x/r>=0}}},PSEUDO:function(e,n){var i,o=C.pseudos[e]||C.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[W]?o(n):o.length>1?(i=[e,e,"",n],C.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,i=o(e,n),a=i.length;a--;)r=ee(e,i[a]),e[r]=!(t[r]=i[a])}):function(e){return o(e,0,i)}):o}},pseudos:{not:r(function(e){var t=[],n=[],i=S(e.replace(se,"$1"));return i[W]?r(function(e,t,n,r){for(var o,a=i(e,null,r,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,r,o){return t[0]=e,i(t,null,o,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(xe,be),function(t){return(t.textContent||t.innerText||E(t)).indexOf(e)>-1}}),lang:r(function(e){return pe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(xe,be).toLowerCase(),function(t){var n;do if(n=O?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1;
+}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===F},focus:function(e){return e===H.activeElement&&(!H.hasFocus||H.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:l(!1),disabled:l(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!C.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return he.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[n<0?n+t:n]}),even:c(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:c(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},C.pseudos.nth=C.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[w]=s(w);for(w in{submit:!0,reset:!0})C.pseudos[w]=u(w);return p.prototype=C.filters=C.pseudos,C.setFilters=new p,N=t.tokenize=function(e,n){var r,i,o,a,s,u,l,c=X[e+" "];if(c)return n?0:c.slice(0);for(s=e,u=[],l=C.preFilter;s;){r&&!(i=ue.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),r=!1,(i=le.exec(s))&&(r=i.shift(),o.push({value:r,type:i[0].replace(se," ")}),s=s.slice(r.length));for(a in C.filter)!(i=de[a].exec(s))||l[a]&&!(i=l[a](i))||(r=i.shift(),o.push({value:r,type:a,matches:i}),s=s.slice(r.length));if(!r)break}return n?s.length:s?t.error(e):X(e,u).slice(0)},S=t.compile=function(e,t){var n,r=[],i=[],o=U[e+" "];if(!o){for(t||(t=N(e)),n=t.length;n--;)o=x(t[n]),o[W]?r.push(o):i.push(o);o=U(e,b(i,r)),o.selector=e}return o},D=t.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&N(e=l.selector||e);if(n=n||[],1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&9===t.nodeType&&O&&C.relative[o[1].type]){if(t=(C.find.ID(a.matches[0].replace(xe,be),t)||[])[0],!t)return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=de.needsContext.test(e)?0:o.length;i--&&(a=o[i],!C.relative[s=a.type]);)if((u=C.find[s])&&(r=u(a.matches[0].replace(xe,be),ye.test(o[0].type)&&f(t.parentNode)||t))){if(o.splice(i,1),e=r.length&&d(o),!e)return K.apply(n,r),n;break}}return(l||S(e,c))(r,t,!O,n,!t||ye.test(e)&&f(t.parentNode)||t),n},T.sortStable=W.split("").sort(V).join("")===W,T.detectDuplicates=!!q,L(),T.sortDetached=i(function(e){return 1&e.compareDocumentPosition(H.createElement("fieldset"))}),i(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),T.attributes&&i(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),i(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,n){var r;if(!n)return e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e);he.find=xe,he.expr=xe.selectors,he.expr[":"]=he.expr.pseudos,he.uniqueSort=he.unique=xe.uniqueSort,he.text=xe.getText,he.isXMLDoc=xe.isXML,he.contains=xe.contains,he.escapeSelector=xe.escape;var be=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&he(e).is(n))break;r.push(e)}return r},we=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},Te=he.expr.match.needsContext,Ce=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,Ee=/^.[^:#\[\.,]*$/;he.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?he.find.matchesSelector(r,e)?[r]:[]:he.find.matches(e,he.grep(t,function(e){return 1===e.nodeType}))},he.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(he(e).filter(function(){for(t=0;t<r;t++)if(he.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)he.find(e,i[t],n);return r>1?he.uniqueSort(n):n},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&Te.test(e)?he(e):e||[],!1).length}});var ke,Ne=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Se=he.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||ke,"string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:Ne.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof he?t[0]:t,he.merge(this,he.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:te,!0)),Ce.test(r[1])&&he.isPlainObject(t))for(r in t)he.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=te.getElementById(r[2]),i&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):he.isFunction(e)?void 0!==n.ready?n.ready(e):e(he):he.makeArray(e,this)};Se.prototype=he.fn,ke=he(te);var De=/^(?:parents|prev(?:Until|All))/,je={children:!0,contents:!0,next:!0,prev:!0};he.fn.extend({has:function(e){var t=he(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(he.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&he(e);if(!Te.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&he.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?he.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?ae.call(he(e),this[0]):ae.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(he.uniqueSort(he.merge(this.get(),he(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),he.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return be(e,"parentNode")},parentsUntil:function(e,t,n){return be(e,"parentNode",n)},next:function(e){return o(e,"nextSibling")},prev:function(e){return o(e,"previousSibling")},nextAll:function(e){return be(e,"nextSibling")},prevAll:function(e){return be(e,"previousSibling")},nextUntil:function(e,t,n){return be(e,"nextSibling",n)},prevUntil:function(e,t,n){return be(e,"previousSibling",n)},siblings:function(e){return we((e.parentNode||{}).firstChild,e)},children:function(e){return we(e.firstChild)},contents:function(e){return e.contentDocument||he.merge([],e.childNodes)}},function(e,t){he.fn[e]=function(n,r){var i=he.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=he.filter(r,i)),this.length>1&&(je[e]||he.uniqueSort(i),De.test(e)&&i.reverse()),this.pushStack(i)}});var Ae=/[^\x20\t\r\n\f]+/g;he.Callbacks=function(e){e="string"==typeof e?a(e):he.extend({},e);var t,n,r,i,o=[],s=[],u=-1,l=function(){for(i=e.once,r=t=!0;s.length;u=-1)for(n=s.shift();++u<o.length;)o[u].apply(n[0],n[1])===!1&&e.stopOnFalse&&(u=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},c={add:function(){return o&&(n&&!t&&(u=o.length-1,s.push(n)),function t(n){he.each(n,function(n,r){he.isFunction(r)?e.unique&&c.has(r)||o.push(r):r&&r.length&&"string"!==he.type(r)&&t(r)})}(arguments),n&&!t&&l()),this},remove:function(){return he.each(arguments,function(e,t){for(var n;(n=he.inArray(t,o,n))>-1;)o.splice(n,1),n<=u&&u--}),this},has:function(e){return e?he.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=s=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=s=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=n||[],n=[e,n.slice?n.slice():n],s.push(n),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},he.extend({Deferred:function(t){var n=[["notify","progress",he.Callbacks("memory"),he.Callbacks("memory"),2],["resolve","done",he.Callbacks("once memory"),he.Callbacks("once memory"),0,"resolved"],["reject","fail",he.Callbacks("once memory"),he.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return he.Deferred(function(t){he.each(n,function(n,r){var i=he.isFunction(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&he.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){function o(t,n,r,i){return function(){var l=this,c=arguments,f=function(){var e,f;if(!(t<a)){if(e=r.apply(l,c),e===n.promise())throw new TypeError("Thenable self-resolution");f=e&&("object"==typeof e||"function"==typeof e)&&e.then,he.isFunction(f)?i?f.call(e,o(a,n,s,i),o(a,n,u,i)):(a++,f.call(e,o(a,n,s,i),o(a,n,u,i),o(a,n,s,n.notifyWith))):(r!==s&&(l=void 0,c=[e]),(i||n.resolveWith)(l,c))}},p=i?f:function(){try{f()}catch(e){he.Deferred.exceptionHook&&he.Deferred.exceptionHook(e,p.stackTrace),t+1>=a&&(r!==u&&(l=void 0,c=[e]),n.rejectWith(l,c))}};t?p():(he.Deferred.getStackHook&&(p.stackTrace=he.Deferred.getStackHook()),e.setTimeout(p))}}var a=0;return he.Deferred(function(e){n[0][3].add(o(0,e,he.isFunction(i)?i:s,e.notifyWith)),n[1][3].add(o(0,e,he.isFunction(t)?t:s)),n[2][3].add(o(0,e,he.isFunction(r)?r:u))}).promise()},promise:function(e){return null!=e?he.extend(e,i):i}},o={};return he.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[0][2].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=re.call(arguments),o=he.Deferred(),a=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?re.call(arguments):n,--t||o.resolveWith(r,i)}};if(t<=1&&(l(e,o.done(a(n)).resolve,o.reject),"pending"===o.state()||he.isFunction(i[n]&&i[n].then)))return o.then();for(;n--;)l(i[n],a(n),o.reject);return o.promise()}});var qe=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;he.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&qe.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},he.readyException=function(t){e.setTimeout(function(){throw t})};var Le=he.Deferred();he.fn.ready=function(e){return Le.then(e).catch(function(e){he.readyException(e)}),this},he.extend({isReady:!1,readyWait:1,holdReady:function(e){e?he.readyWait++:he.ready(!0)},ready:function(e){(e===!0?--he.readyWait:he.isReady)||(he.isReady=!0,e!==!0&&--he.readyWait>0||Le.resolveWith(te,[he]))}}),he.ready.then=Le.then,"complete"===te.readyState||"loading"!==te.readyState&&!te.documentElement.doScroll?e.setTimeout(he.ready):(te.addEventListener("DOMContentLoaded",c),e.addEventListener("load",c));var He=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===he.type(n)){i=!0;for(s in n)He(e,t,s,n[s],!0,o,a)}else if(void 0!==r&&(i=!0,he.isFunction(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(he(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},Fe=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};f.uid=1,f.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Fe(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[he.camelCase(t)]=n;else for(r in t)i[he.camelCase(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][he.camelCase(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){he.isArray(t)?t=t.map(he.camelCase):(t=he.camelCase(t),t=t in r?[t]:t.match(Ae)||[]),n=t.length;for(;n--;)delete r[t[n]]}(void 0===t||he.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!he.isEmptyObject(t)}};var Oe=new f,Pe=new f,Re=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Me=/[A-Z]/g;he.extend({hasData:function(e){return Pe.hasData(e)||Oe.hasData(e)},data:function(e,t,n){return Pe.access(e,t,n)},removeData:function(e,t){Pe.remove(e,t)},_data:function(e,t,n){return Oe.access(e,t,n)},_removeData:function(e,t){Oe.remove(e,t)}}),he.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=Pe.get(o),1===o.nodeType&&!Oe.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&(r=a[n].name,0===r.indexOf("data-")&&(r=he.camelCase(r.slice(5)),d(o,r,i[r])));Oe.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){Pe.set(this,e)}):He(this,function(t){var n;if(o&&void 0===t){if(n=Pe.get(o,e),void 0!==n)return n;if(n=d(o,e),void 0!==n)return n}else this.each(function(){Pe.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Pe.remove(this,e)})}}),he.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Oe.get(e,t),n&&(!r||he.isArray(n)?r=Oe.access(e,t,he.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=he.queue(e,t),r=n.length,i=n.shift(),o=he._queueHooks(e,t),a=function(){he.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Oe.get(e,n)||Oe.access(e,n,{empty:he.Callbacks("once memory").add(function(){Oe.remove(e,[t+"queue",n])})})}}),he.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?he.queue(this[0],e):void 0===t?this:this.each(function(){var n=he.queue(this,e,t);he._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&he.dequeue(this,e)})},dequeue:function(e){return this.each(function(){he.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=he.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)n=Oe.get(o[a],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var Ie=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,We=new RegExp("^(?:([+-])=|)("+Ie+")([a-z%]*)$","i"),$e=["Top","Right","Bottom","Left"],Be=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&he.contains(e.ownerDocument,e)&&"none"===he.css(e,"display")},_e=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i},ze={};he.fn.extend({show:function(){return m(this,!0)},hide:function(){return m(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Be(this)?he(this).show():he(this).hide()})}});var Xe=/^(?:checkbox|radio)$/i,Ue=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Ve=/^$|\/(?:java|ecma)script/i,Ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ge.optgroup=Ge.option,Ge.tbody=Ge.tfoot=Ge.colgroup=Ge.caption=Ge.thead,Ge.th=Ge.td;var Ye=/<|&#?\w+;/;!function(){var e=te.createDocumentFragment(),t=e.appendChild(te.createElement("div")),n=te.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),pe.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",pe.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Qe=te.documentElement,Je=/^key/,Ke=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ze=/^([^.]*)(?:\.(.+)|)/;he.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,m=Oe.get(e);if(m)for(n.handler&&(o=n,n=o.handler,i=o.selector),i&&he.find.matchesSelector(Qe,i),n.guid||(n.guid=he.guid++),(u=m.events)||(u=m.events={}),(a=m.handle)||(a=m.handle=function(t){return"undefined"!=typeof he&&he.event.triggered!==t.type?he.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(Ae)||[""],l=t.length;l--;)s=Ze.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d&&(f=he.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=he.event.special[d]||{},c=he.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&he.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||(p=u[d]=[],p.delegateCount=0,f.setup&&f.setup.call(e,r,h,a)!==!1||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),he.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,m=Oe.hasData(e)&&Oe.get(e);if(m&&(u=m.events)){for(t=(t||"").match(Ae)||[""],l=t.length;l--;)if(s=Ze.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){for(f=he.event.special[d]||{},d=(r?f.delegateType:f.bindType)||d,p=u[d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&f.teardown.call(e,h,m.handle)!==!1||he.removeEvent(e,d,m.handle),delete u[d])}else for(d in u)he.event.remove(e,d+t[l],n,r,!0);he.isEmptyObject(u)&&Oe.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=he.event.fix(e),u=new Array(arguments.length),l=(Oe.get(this,"events")||{})[s.type]||[],c=he.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,s)!==!1){for(a=he.event.handlers.call(this,s,l),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,r=((he.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u),void 0!==r&&(s.result=r)===!1&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||l.disabled!==!0)){for(o=[],a={},n=0;n<u;n++)r=t[n],i=r.selector+" ",void 0===a[i]&&(a[i]=r.needsContext?he(i,this).index(l)>-1:he.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(he.Event.prototype,e,{enumerable:!0,configurable:!0,get:he.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[he.expando]?e:new he.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==T()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===T()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&he.nodeName(this,"input"))return this.click(),!1},_default:function(e){return he.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},he.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},he.Event=function(e,t){return this instanceof he.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?b:w,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&he.extend(this,t),this.timeStamp=e&&e.timeStamp||he.now(),void(this[he.expando]=!0)):new he.Event(e,t)},he.Event.prototype={constructor:he.Event,isDefaultPrevented:w,isPropagationStopped:w,isImmediatePropagationStopped:w,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=b,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=b,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=b,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},he.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Je.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ke.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},he.event.addProp),he.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){he.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||he.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),he.fn.extend({on:function(e,t,n,r){return C(this,e,t,n,r)},one:function(e,t,n,r){return C(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,he(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return t!==!1&&"function"!=typeof t||(n=t,t=void 0),n===!1&&(n=w),this.each(function(){he.event.remove(this,e,n,t)})}});var et=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,tt=/<script|<style|<link/i,nt=/checked\s*(?:[^=]|=\s*.checked.)/i,rt=/^true\/(.*)/,it=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;he.extend({htmlPrefilter:function(e){return e.replace(et,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s=e.cloneNode(!0),u=he.contains(e.ownerDocument,e);if(!(pe.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||he.isXMLDoc(e)))for(a=v(s),o=v(e),r=0,i=o.length;r<i;r++)D(o[r],a[r]);if(t)if(n)for(o=o||v(e),a=a||v(s),r=0,i=o.length;r<i;r++)S(o[r],a[r]);else S(e,s);return a=v(s,"script"),a.length>0&&y(a,!u&&v(e,"script")),s},cleanData:function(e){for(var t,n,r,i=he.event.special,o=0;void 0!==(n=e[o]);o++)if(Fe(n)){if(t=n[Oe.expando]){if(t.events)for(r in t.events)i[r]?he.event.remove(n,r):he.removeEvent(n,r,t.handle);n[Oe.expando]=void 0}n[Pe.expando]&&(n[Pe.expando]=void 0)}}}),he.fn.extend({detach:function(e){return A(this,e,!0)},remove:function(e){return A(this,e)},text:function(e){return He(this,function(e){return void 0===e?he.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return j(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=E(this,e);t.appendChild(e)}})},prepend:function(){return j(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=E(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return j(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return j(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(he.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return he.clone(this,e,t)})},html:function(e){return He(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!tt.test(e)&&!Ge[(Ue.exec(e)||["",""])[1].toLowerCase()]){e=he.htmlPrefilter(e);try{for(;n<r;n++)t=this[n]||{},1===t.nodeType&&(he.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return j(this,arguments,function(t){var n=this.parentNode;he.inArray(this,e)<0&&(he.cleanData(v(this)),n&&n.replaceChild(t,this))},e)}}),he.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){he.fn[e]=function(e){for(var n,r=[],i=he(e),o=i.length-1,a=0;a<=o;a++)n=a===o?this:this.clone(!0),he(i[a])[t](n),oe.apply(r,n.get());return this.pushStack(r)}});var ot=/^margin/,at=new RegExp("^("+Ie+")(?!px)[a-z%]+$","i"),st=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)};!function(){function t(){if(s){s.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",s.innerHTML="",Qe.appendChild(a);var t=e.getComputedStyle(s);n="1%"!==t.top,o="2px"===t.marginLeft,r="4px"===t.width,s.style.marginRight="50%",i="4px"===t.marginRight,Qe.removeChild(a),s=null}}var n,r,i,o,a=te.createElement("div"),s=te.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",pe.clearCloneStyle="content-box"===s.style.backgroundClip,a.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",a.appendChild(s),he.extend(pe,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return t(),r},pixelMarginRight:function(){return t(),i},reliableMarginLeft:function(){return t(),o}}))}();var ut=/^(none|table(?!-c[ea]).+)/,lt={position:"absolute",visibility:"hidden",display:"block"},ct={letterSpacing:"0",fontWeight:"400"},ft=["Webkit","Moz","ms"],pt=te.createElement("div").style;he.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=q(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=he.camelCase(t),u=e.style;return t=he.cssProps[s]||(he.cssProps[s]=H(s)||s),a=he.cssHooks[t]||he.cssHooks[s],void 0===n?a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:u[t]:(o=typeof n,"string"===o&&(i=We.exec(n))&&i[1]&&(n=h(e,t,i),o="number"),null!=n&&n===n&&("number"===o&&(n+=i&&i[3]||(he.cssNumber[s]?"":"px")),pe.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u[t]=n)),void 0)}},css:function(e,t,n,r){var i,o,a,s=he.camelCase(t);return t=he.cssProps[s]||(he.cssProps[s]=H(s)||s),a=he.cssHooks[t]||he.cssHooks[s],a&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=q(e,t,r)),"normal"===i&&t in ct&&(i=ct[t]),""===n||n?(o=parseFloat(i),n===!0||isFinite(o)?o||0:i):i}}),he.each(["height","width"],function(e,t){he.cssHooks[t]={get:function(e,n,r){if(n)return!ut.test(he.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?P(e,t,r):_e(e,lt,function(){return P(e,t,r)})},set:function(e,n,r){var i,o=r&&st(e),a=r&&O(e,t,r,"border-box"===he.css(e,"boxSizing",!1,o),o);return a&&(i=We.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=he.css(e,t)),F(e,n,a)}}}),he.cssHooks.marginLeft=L(pe.reliableMarginLeft,function(e,t){if(t)return(parseFloat(q(e,"marginLeft"))||e.getBoundingClientRect().left-_e(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),he.each({margin:"",padding:"",border:"Width"},function(e,t){he.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+$e[r]+t]=o[r]||o[r-2]||o[0];return i}},ot.test(e)||(he.cssHooks[e+t].set=F)}),he.fn.extend({css:function(e,t){return He(this,function(e,t,n){var r,i,o={},a=0;if(he.isArray(t)){for(r=st(e),i=t.length;a<i;a++)o[t[a]]=he.css(e,t[a],!1,r);return o}return void 0!==n?he.style(e,t,n):he.css(e,t)},e,t,arguments.length>1)}}),he.Tween=R,R.prototype={constructor:R,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||he.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(he.cssNumber[n]?"":"px")},cur:function(){var e=R.propHooks[this.prop];return e&&e.get?e.get(this):R.propHooks._default.get(this)},run:function(e){var t,n=R.propHooks[this.prop];return this.options.duration?this.pos=t=he.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):R.propHooks._default.set(this),this}},R.prototype.init.prototype=R.prototype,R.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=he.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){he.fx.step[e.prop]?he.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[he.cssProps[e.prop]]&&!he.cssHooks[e.prop]?e.elem[e.prop]=e.now:he.style(e.elem,e.prop,e.now+e.unit)}}},R.propHooks.scrollTop=R.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},he.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},he.fx=R.prototype.init,he.fx.step={};var dt,ht,gt=/^(?:toggle|show|hide)$/,mt=/queueHooks$/;he.Animation=he.extend(z,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return h(n.elem,e,We.exec(t),n),n}]},tweener:function(e,t){he.isFunction(e)?(t=e,e=["*"]):e=e.match(Ae);for(var n,r=0,i=e.length;r<i;r++)n=e[r],z.tweeners[n]=z.tweeners[n]||[],z.tweeners[n].unshift(t)},prefilters:[B],prefilter:function(e,t){t?z.prefilters.unshift(e):z.prefilters.push(e)}}),he.speed=function(e,t,n){var r=e&&"object"==typeof e?he.extend({},e):{complete:n||!n&&t||he.isFunction(e)&&e,duration:e,easing:n&&t||t&&!he.isFunction(t)&&t};return he.fx.off||te.hidden?r.duration=0:"number"!=typeof r.duration&&(r.duration in he.fx.speeds?r.duration=he.fx.speeds[r.duration]:r.duration=he.fx.speeds._default),null!=r.queue&&r.queue!==!0||(r.queue="fx"),r.old=r.complete,r.complete=function(){he.isFunction(r.old)&&r.old.call(this),r.queue&&he.dequeue(this,r.queue)},r},he.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Be).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=he.isEmptyObject(e),o=he.speed(t,n,r),a=function(){var t=z(this,he.extend({},e),o);(i||Oe.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=he.timers,a=Oe.get(this);
+if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&mt.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||he.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=Oe.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=he.timers,a=r?r.length:0;for(n.finish=!0,he.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),he.each(["toggle","show","hide"],function(e,t){var n=he.fn[t];he.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(W(t,!0),e,r,i)}}),he.each({slideDown:W("show"),slideUp:W("hide"),slideToggle:W("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){he.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),he.timers=[],he.fx.tick=function(){var e,t=0,n=he.timers;for(dt=he.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||he.fx.stop(),dt=void 0},he.fx.timer=function(e){he.timers.push(e),e()?he.fx.start():he.timers.pop()},he.fx.interval=13,he.fx.start=function(){ht||(ht=e.requestAnimationFrame?e.requestAnimationFrame(M):e.setInterval(he.fx.tick,he.fx.interval))},he.fx.stop=function(){e.cancelAnimationFrame?e.cancelAnimationFrame(ht):e.clearInterval(ht),ht=null},he.fx.speeds={slow:600,fast:200,_default:400},he.fn.delay=function(t,n){return t=he.fx?he.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=te.createElement("input"),t=te.createElement("select"),n=t.appendChild(te.createElement("option"));e.type="checkbox",pe.checkOn=""!==e.value,pe.optSelected=n.selected,e=te.createElement("input"),e.value="t",e.type="radio",pe.radioValue="t"===e.value}();var vt,yt=he.expr.attrHandle;he.fn.extend({attr:function(e,t){return He(this,he.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){he.removeAttr(this,e)})}}),he.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?he.prop(e,t,n):(1===o&&he.isXMLDoc(e)||(i=he.attrHooks[t.toLowerCase()]||(he.expr.match.bool.test(t)?vt:void 0)),void 0!==n?null===n?void he.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:(r=he.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set:function(e,t){if(!pe.radioValue&&"radio"===t&&he.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(Ae);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),vt={set:function(e,t,n){return t===!1?he.removeAttr(e,n):e.setAttribute(n,n),n}},he.each(he.expr.match.bool.source.match(/\w+/g),function(e,t){var n=yt[t]||he.find.attr;yt[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=yt[a],yt[a]=i,i=null!=n(e,t,r)?a:null,yt[a]=o),i}});var xt=/^(?:input|select|textarea|button)$/i,bt=/^(?:a|area)$/i;he.fn.extend({prop:function(e,t){return He(this,he.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[he.propFix[e]||e]})}}),he.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&he.isXMLDoc(e)||(t=he.propFix[t]||t,i=he.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=he.find.attr(e,"tabindex");return t?parseInt(t,10):xt.test(e.nodeName)||bt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),pe.optSelected||(he.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),he.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){he.propFix[this.toLowerCase()]=this}),he.fn.extend({addClass:function(e){var t,n,r,i,o,a,s,u=0;if(he.isFunction(e))return this.each(function(t){he(this).addClass(e.call(this,t,U(this)))});if("string"==typeof e&&e)for(t=e.match(Ae)||[];n=this[u++];)if(i=U(n),r=1===n.nodeType&&" "+X(i)+" "){for(a=0;o=t[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");s=X(r),i!==s&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,o,a,s,u=0;if(he.isFunction(e))return this.each(function(t){he(this).removeClass(e.call(this,t,U(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Ae)||[];n=this[u++];)if(i=U(n),r=1===n.nodeType&&" "+X(i)+" "){for(a=0;o=t[a++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");s=X(r),i!==s&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):he.isFunction(e)?this.each(function(n){he(this).toggleClass(e.call(this,n,U(this),t),t)}):this.each(function(){var t,r,i,o;if("string"===n)for(r=0,i=he(this),o=e.match(Ae)||[];t=o[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==e&&"boolean"!==n||(t=U(this),t&&Oe.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":Oe.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+X(U(n))+" ").indexOf(t)>-1)return!0;return!1}});var wt=/\r/g;he.fn.extend({val:function(e){var t,n,r,i=this[0];{if(arguments.length)return r=he.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,he(this).val()):e,null==i?i="":"number"==typeof i?i+="":he.isArray(i)&&(i=he.map(i,function(e){return null==e?"":e+""})),t=he.valHooks[this.type]||he.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return t=he.valHooks[i.type]||he.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(wt,""):null==n?"":n)}}}),he.extend({valHooks:{option:{get:function(e){var t=he.find.attr(e,"value");return null!=t?t:X(he.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(n=i[r],(n.selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!he.nodeName(n.parentNode,"optgroup"))){if(t=he(n).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=he.makeArray(t),a=i.length;a--;)r=i[a],(r.selected=he.inArray(he.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),he.each(["radio","checkbox"],function(){he.valHooks[this]={set:function(e,t){if(he.isArray(t))return e.checked=he.inArray(he(e).val(),t)>-1}},pe.checkOn||(he.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Tt=/^(?:focusinfocus|focusoutblur)$/;he.extend(he.event,{trigger:function(t,n,r,i){var o,a,s,u,l,c,f,p=[r||te],d=le.call(t,"type")?t.type:t,h=le.call(t,"namespace")?t.namespace.split("."):[];if(a=s=r=r||te,3!==r.nodeType&&8!==r.nodeType&&!Tt.test(d+he.event.triggered)&&(d.indexOf(".")>-1&&(h=d.split("."),d=h.shift(),h.sort()),l=d.indexOf(":")<0&&"on"+d,t=t[he.expando]?t:new he.Event(d,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=h.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:he.makeArray(n,[t]),f=he.event.special[d]||{},i||!f.trigger||f.trigger.apply(r,n)!==!1)){if(!i&&!f.noBubble&&!he.isWindow(r)){for(u=f.delegateType||d,Tt.test(u+d)||(a=a.parentNode);a;a=a.parentNode)p.push(a),s=a;s===(r.ownerDocument||te)&&p.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=p[o++])&&!t.isPropagationStopped();)t.type=o>1?u:f.bindType||d,c=(Oe.get(a,"events")||{})[t.type]&&Oe.get(a,"handle"),c&&c.apply(a,n),c=l&&a[l],c&&c.apply&&Fe(a)&&(t.result=c.apply(a,n),t.result===!1&&t.preventDefault());return t.type=d,i||t.isDefaultPrevented()||f._default&&f._default.apply(p.pop(),n)!==!1||!Fe(r)||l&&he.isFunction(r[d])&&!he.isWindow(r)&&(s=r[l],s&&(r[l]=null),he.event.triggered=d,r[d](),he.event.triggered=void 0,s&&(r[l]=s)),t.result}},simulate:function(e,t,n){var r=he.extend(new he.Event,n,{type:e,isSimulated:!0});he.event.trigger(r,null,t)}}),he.fn.extend({trigger:function(e,t){return this.each(function(){he.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return he.event.trigger(e,t,n,!0)}}),he.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){he.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),he.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),pe.focusin="onfocusin"in e,pe.focusin||he.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){he.event.simulate(t,e.target,he.event.fix(e))};he.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=Oe.access(r,t);i||r.addEventListener(e,n,!0),Oe.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=Oe.access(r,t)-1;i?Oe.access(r,t,i):(r.removeEventListener(e,n,!0),Oe.remove(r,t))}}});var Ct=e.location,Et=he.now(),kt=/\?/;he.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||he.error("Invalid XML: "+t),n};var Nt=/\[\]$/,St=/\r?\n/g,Dt=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;he.param=function(e,t){var n,r=[],i=function(e,t){var n=he.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(he.isArray(e)||e.jquery&&!he.isPlainObject(e))he.each(e,function(){i(this.name,this.value)});else for(n in e)V(n,e[n],t,i);return r.join("&")},he.fn.extend({serialize:function(){return he.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=he.prop(this,"elements");return e?he.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!he(this).is(":disabled")&&jt.test(this.nodeName)&&!Dt.test(e)&&(this.checked||!Xe.test(e))}).map(function(e,t){var n=he(this).val();return null==n?null:he.isArray(n)?he.map(n,function(e){return{name:t.name,value:e.replace(St,"\r\n")}}):{name:t.name,value:n.replace(St,"\r\n")}}).get()}});var At=/%20/g,qt=/#.*$/,Lt=/([?&])_=[^&]*/,Ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ot=/^(?:GET|HEAD)$/,Pt=/^\/\//,Rt={},Mt={},It="*/".concat("*"),Wt=te.createElement("a");Wt.href=Ct.href,he.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:Ft.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":It,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":he.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Q(Q(e,he.ajaxSettings),t):Q(he.ajaxSettings,e)},ajaxPrefilter:G(Rt),ajaxTransport:G(Mt),ajax:function(t,n){function r(t,n,r,s){var l,p,d,b,w,T=n;c||(c=!0,u&&e.clearTimeout(u),i=void 0,a=s||"",C.readyState=t>0?4:0,l=t>=200&&t<300||304===t,r&&(b=J(h,C,r)),b=K(h,b,C,l),l?(h.ifModified&&(w=C.getResponseHeader("Last-Modified"),w&&(he.lastModified[o]=w),w=C.getResponseHeader("etag"),w&&(he.etag[o]=w)),204===t||"HEAD"===h.type?T="nocontent":304===t?T="notmodified":(T=b.state,p=b.data,d=b.error,l=!d)):(d=T,!t&&T||(T="error",t<0&&(t=0))),C.status=t,C.statusText=(n||T)+"",l?v.resolveWith(g,[p,T,C]):v.rejectWith(g,[C,T,d]),C.statusCode(x),x=void 0,f&&m.trigger(l?"ajaxSuccess":"ajaxError",[C,h,l?p:d]),y.fireWith(g,[C,T]),f&&(m.trigger("ajaxComplete",[C,h]),--he.active||he.event.trigger("ajaxStop")))}"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,o,a,s,u,l,c,f,p,d,h=he.ajaxSetup({},n),g=h.context||h,m=h.context&&(g.nodeType||g.jquery)?he(g):he.event,v=he.Deferred(),y=he.Callbacks("once memory"),x=h.statusCode||{},b={},w={},T="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s)for(s={};t=Ht.exec(a);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(e,t){return null==c&&(e=w[e.toLowerCase()]=w[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)C.always(e[C.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||T;return i&&i.abort(t),r(0,t),this}};if(v.promise(C),h.url=((t||h.url||Ct.href)+"").replace(Pt,Ct.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(Ae)||[""],null==h.crossDomain){l=te.createElement("a");try{l.href=h.url,l.href=l.href,h.crossDomain=Wt.protocol+"//"+Wt.host!=l.protocol+"//"+l.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=he.param(h.data,h.traditional)),Y(Rt,h,n,C),c)return C;f=he.event&&h.global,f&&0===he.active++&&he.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Ot.test(h.type),o=h.url.replace(qt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(At,"+")):(d=h.url.slice(o.length),h.data&&(o+=(kt.test(o)?"&":"?")+h.data,delete h.data),h.cache===!1&&(o=o.replace(Lt,"$1"),d=(kt.test(o)?"&":"?")+"_="+Et++ +d),h.url=o+d),h.ifModified&&(he.lastModified[o]&&C.setRequestHeader("If-Modified-Since",he.lastModified[o]),he.etag[o]&&C.setRequestHeader("If-None-Match",he.etag[o])),(h.data&&h.hasContent&&h.contentType!==!1||n.contentType)&&C.setRequestHeader("Content-Type",h.contentType),C.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+It+"; q=0.01":""):h.accepts["*"]);for(p in h.headers)C.setRequestHeader(p,h.headers[p]);if(h.beforeSend&&(h.beforeSend.call(g,C,h)===!1||c))return C.abort();if(T="abort",y.add(h.complete),C.done(h.success),C.fail(h.error),i=Y(Mt,h,n,C)){if(C.readyState=1,f&&m.trigger("ajaxSend",[C,h]),c)return C;h.async&&h.timeout>0&&(u=e.setTimeout(function(){C.abort("timeout")},h.timeout));try{c=!1,i.send(b,r)}catch(e){if(c)throw e;r(-1,e)}}else r(-1,"No Transport");return C},getJSON:function(e,t,n){return he.get(e,t,n,"json")},getScript:function(e,t){return he.get(e,void 0,t,"script")}}),he.each(["get","post"],function(e,t){he[t]=function(e,n,r,i){return he.isFunction(n)&&(i=i||r,r=n,n=void 0),he.ajax(he.extend({url:e,type:t,dataType:i,data:n,success:r},he.isPlainObject(e)&&e))}}),he._evalUrl=function(e){return he.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},he.fn.extend({wrapAll:function(e){var t;return this[0]&&(he.isFunction(e)&&(e=e.call(this[0])),t=he(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return he.isFunction(e)?this.each(function(t){he(this).wrapInner(e.call(this,t))}):this.each(function(){var t=he(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=he.isFunction(e);return this.each(function(n){he(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){he(this).replaceWith(this.childNodes)}),this}}),he.expr.pseudos.hidden=function(e){return!he.expr.pseudos.visible(e)},he.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},he.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var $t={0:200,1223:204},Bt=he.ajaxSettings.xhr();pe.cors=!!Bt&&"withCredentials"in Bt,pe.ajax=Bt=!!Bt,he.ajaxTransport(function(t){var n,r;if(pe.cors||Bt&&!t.crossDomain)return{send:function(i,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(a in i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o($t[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),he.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),he.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return he.globalEval(e),e}}}),he.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),he.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=he("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),te.head.appendChild(t[0])},abort:function(){n&&n()}}}});var _t=[],zt=/(=)\?(?=&|$)|\?\?/;he.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=_t.pop()||he.expando+"_"+Et++;return this[e]=!0,e}}),he.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,a,s=t.jsonp!==!1&&(zt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&zt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=he.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(zt,"$1"+i):t.jsonp!==!1&&(t.url+=(kt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||he.error(i+" was not called"),a[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===o?he(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,_t.push(i)),a&&he.isFunction(o)&&o(a[0]),a=o=void 0}),"script"}),pe.createHTMLDocument=function(){var e=te.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),he.parseHTML=function(e,t,n){if("string"!=typeof e)return[];"boolean"==typeof t&&(n=t,t=!1);var r,i,o;return t||(pe.createHTMLDocument?(t=te.implementation.createHTMLDocument(""),r=t.createElement("base"),r.href=te.location.href,t.head.appendChild(r)):t=te),i=Ce.exec(e),o=!n&&[],i?[t.createElement(i[1])]:(i=x([e],t,o),o&&o.length&&he(o).remove(),he.merge([],i.childNodes))},he.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=X(e.slice(s)),e=e.slice(0,s)),he.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&he.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?he("<div>").append(he.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},he.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){he.fn[t]=function(e){return this.on(t,e)}}),he.expr.pseudos.animated=function(e){return he.grep(he.timers,function(t){return e===t.elem}).length},he.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l,c=he.css(e,"position"),f=he(e),p={};"static"===c&&(e.style.position="relative"),s=f.offset(),o=he.css(e,"top"),u=he.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1,l?(r=f.position(),a=r.top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),he.isFunction(t)&&(t=t.call(e,n,he.extend({},s))),null!=t.top&&(p.top=t.top-s.top+a),null!=t.left&&(p.left=t.left-s.left+i),"using"in t?t.using.call(e,p):f.css(p)}},he.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){he.offset.setOffset(this,e,t)});var t,n,r,i,o=this[0];if(o)return o.getClientRects().length?(r=o.getBoundingClientRect(),r.width||r.height?(i=o.ownerDocument,n=Z(i),t=i.documentElement,{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}):r):{top:0,left:0}},position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===he.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),he.nodeName(e[0],"html")||(r=e.offset()),r={top:r.top+he.css(e[0],"borderTopWidth",!0),left:r.left+he.css(e[0],"borderLeftWidth",!0)}),{top:t.top-r.top-he.css(n,"marginTop",!0),left:t.left-r.left-he.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===he.css(e,"position");)e=e.offsetParent;return e||Qe})}}),he.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;he.fn[e]=function(r){return He(this,function(e,r,i){var o=Z(e);return void 0===i?o?o[t]:e[r]:void(o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i)},e,r,arguments.length)}}),he.each(["top","left"],function(e,t){he.cssHooks[t]=L(pe.pixelPosition,function(e,n){if(n)return n=q(e,t),at.test(n)?he(e).position()[t]+"px":n})}),he.each({Height:"height",Width:"width"},function(e,t){he.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){he.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(i===!0||o===!0?"margin":"border");return He(this,function(t,n,i){var o;return he.isWindow(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?he.css(t,n,s):he.style(t,n,i,s)},t,a?i:void 0,a)}})}),he.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),he.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return he});var Xt=e.jQuery,Ut=e.$;return he.noConflict=function(t){return e.$===he&&(e.$=Ut),t&&e.jQuery===he&&(e.jQuery=Xt),he},t||(e.jQuery=e.$=he),he});
 
 },{}],3:[function(require,module,exports){
-!function(){function o(o){o.Control.Loading=o.Control.extend({options:{delayIndicator:null,position:"topleft",separate:!1,zoomControl:null,spinjs:!1,spin:{lines:7,length:3,width:3,radius:5,rotate:13,top:"83%"}},initialize:function(t){o.setOptions(this,t),this._dataLoaders={},null!==this.options.zoomControl&&(this.zoomControl=this.options.zoomControl)},onAdd:function(n){if(this.options.spinjs&&"function"!=typeof Spinner)return t.error("Leaflet.loading cannot load because you didn't load spin.js (http://fgnass.github.io/spin.js/), even though you set it in options.");this._addLayerListeners(n),this._addMapListeners(n),this.options.separate||this.zoomControl||(n.zoomControl?this.zoomControl=n.zoomControl:n.zoomsliderControl&&(this.zoomControl=n.zoomsliderControl));var i,a="leaflet-control-loading";return this.zoomControl&&!this.options.separate?(i=this.zoomControl._container,a+=" leaflet-bar-part-bottom leaflet-bar-part last",o.DomUtil.addClass(this._getLastControlButton(),"leaflet-bar-part-bottom")):i=o.DomUtil.create("div","leaflet-control-zoom leaflet-bar"),this._indicator=o.DomUtil.create("a",a,i),this.options.spinjs&&(this._spinner=new Spinner(this.options.spin).spin(),this._indicator.appendChild(this._spinner.el)),i},onRemove:function(o){this._removeLayerListeners(o),this._removeMapListeners(o)},removeFrom:function(t){return this.zoomControl&&!this.options.separate?(this._container.removeChild(this._indicator),this._map=null,this.onRemove(t),this):o.Control.prototype.removeFrom.call(this,t)},addLoader:function(o){if(this._dataLoaders[o]=!0,this.options.delayIndicator&&!this.delayIndicatorTimeout){var t=this;this.delayIndicatorTimeout=setTimeout(function(){t.updateIndicator(),t.delayIndicatorTimeout=null},this.options.delayIndicator)}else this.updateIndicator()},removeLoader:function(o){delete this._dataLoaders[o],this.updateIndicator(),this.options.delayIndicator&&this.delayIndicatorTimeout&&!this.isLoading()&&(clearTimeout(this.delayIndicatorTimeout),this.delayIndicatorTimeout=null)},updateIndicator:function(){this.isLoading()?this._showIndicator():this._hideIndicator()},isLoading:function(){return this._countLoaders()>0},_countLoaders:function(){var o,t=0;for(o in this._dataLoaders)this._dataLoaders.hasOwnProperty(o)&&t++;return t},_showIndicator:function(){o.DomUtil.addClass(this._indicator,"is-loading"),this.options.separate||(this.zoomControl instanceof o.Control.Zoom?o.DomUtil.removeClass(this._getLastControlButton(),"leaflet-bar-part-bottom"):"function"==typeof o.Control.Zoomslider&&this.zoomControl instanceof o.Control.Zoomslider&&o.DomUtil.removeClass(this.zoomControl._ui.zoomOut,"leaflet-bar-part-bottom"))},_hideIndicator:function(){o.DomUtil.removeClass(this._indicator,"is-loading"),this.options.separate||(this.zoomControl instanceof o.Control.Zoom?o.DomUtil.addClass(this._getLastControlButton(),"leaflet-bar-part-bottom"):"function"==typeof o.Control.Zoomslider&&this.zoomControl instanceof o.Control.Zoomslider&&o.DomUtil.addClass(this.zoomControl._ui.zoomOut,"leaflet-bar-part-bottom"))},_getLastControlButton:function(){for(var o=this.zoomControl._container,t=o.children.length-1;t>0;){var n=o.children[t];if(this._indicator!==n&&0!==n.offsetWidth&&0!==n.offsetHeight)break;t--}return o.children[t]},_handleLoading:function(o){this.addLoader(this.getEventId(o))},_handleBaseLayerChange:function(t){var n=this;t.layer&&t.layer.eachLayer&&"function"==typeof t.layer.eachLayer?t.layer.eachLayer(function(o){n._handleBaseLayerChange({layer:o})}):o.TileLayer.Canvas&&t.layer instanceof o.TileLayer.Canvas||n._handleLoading(t)},_handleLoad:function(o){this.removeLoader(this.getEventId(o))},getEventId:function(o){return o.id?o.id:o.layer?o.layer._leaflet_id:o.target._leaflet_id},_layerAdd:function(o){if(o.layer&&o.layer.on)try{o.layer.on({loading:this._handleLoading,load:this._handleLoad},this)}catch(n){t.warn("L.Control.Loading: Tried and failed to add  event handlers to layer",o.layer),t.warn("L.Control.Loading: Full details",n)}},_layerRemove:function(o){if(o.layer&&o.layer.off)try{o.layer.off({loading:this._handleLoading,load:this._handleLoad},this)}catch(n){t.warn("L.Control.Loading: Tried and failed to remove event handlers from layer",o.layer),t.warn("L.Control.Loading: Full details",n)}},_addLayerListeners:function(o){o.eachLayer(function(o){o.on&&o.on({loading:this._handleLoading,load:this._handleLoad},this)},this),o.on("layeradd",this._layerAdd,this),o.on("layerremove",this._layerRemove,this)},_removeLayerListeners:function(o){o.eachLayer(function(o){o.off&&o.off({loading:this._handleLoading,load:this._handleLoad},this)},this),o.off("layeradd",this._layerAdd,this),o.off("layerremove",this._layerRemove,this)},_addMapListeners:function(o){o.on({baselayerchange:this._handleBaseLayerChange,dataloading:this._handleLoading,dataload:this._handleLoad,layerremove:this._handleLoad},this)},_removeMapListeners:function(o){o.off({baselayerchange:this._handleBaseLayerChange,dataloading:this._handleLoading,dataload:this._handleLoad,layerremove:this._handleLoad},this)}}),o.Map.addInitHook(function(){this.options.loadingControl&&(this.loadingControl=new o.Control.Loading,this.addControl(this.loadingControl))}),o.Control.loading=function(t){return new o.Control.Loading(t)}}var t=window.console||{error:function(){},warn:function(){}};"function"==typeof define&&define.amd?define(["leaflet"],function(t){o(t)}):o(L)}();
+!function(t){var e;if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)e=require("leaflet"),module.exports=t(e);else{if("undefined"==typeof window.L)throw new Error("Leaflet must be loaded first");t(window.L)}}(function(t){t.Map.mergeOptions({contextmenuItems:[]}),t.Map.ContextMenu=t.Handler.extend({_touchstart:t.Browser.msPointer?"MSPointerDown":t.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(e){t.Handler.prototype.initialize.call(this,e),this._items=[],this._visible=!1;var n=this._container=t.DomUtil.create("div",t.Map.ContextMenu.BASE_CLS,e._container);n.style.zIndex=1e4,n.style.position="absolute",e.options.contextmenuWidth&&(n.style.width=e.options.contextmenuWidth+"px"),this._createItems(),t.DomEvent.on(n,"click",t.DomEvent.stop).on(n,"mousedown",t.DomEvent.stop).on(n,"dblclick",t.DomEvent.stop).on(n,"contextmenu",t.DomEvent.stop)},addHooks:function(){var e=this._map.getContainer();t.DomEvent.on(e,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),t.Browser.touch&&t.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var e=this._map.getContainer();t.DomEvent.off(e,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),t.Browser.touch&&t.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},showAt:function(e,n){e instanceof t.LatLng&&(e=this._map.latLngToContainerPoint(e)),this._showAtPoint(e,n)},hide:function(){this._hide()},addItem:function(t){return this.insertItem(t)},insertItem:function(t,e){e=void 0!==e?e:this._items.length;var n=this._createItem(this._container,t,e);return this._items.push(n),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:n.el,index:e}),n.el},removeItem:function(e){var n=this._container;isNaN(e)||(e=n.children[e]),e&&(this._removeItem(t.Util.stamp(e)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:e}))},removeAllItems:function(){for(var e;this._container.children.length;)e=this._container.children[0],this._removeItem(t.Util.stamp(e))},hideAllItems:function(){var t,e,n;for(e=0,n=this._items.length;e<n;e++)t=this._items[e],t.el.style.display="none"},showAllItems:function(){var t,e,n;for(e=0,n=this._items.length;e<n;e++)t=this._items[e],t.el.style.display=""},setDisabled:function(e,n){var i=this._container,o=t.Map.ContextMenu.BASE_CLS+"-item";isNaN(e)||(e=i.children[e]),e&&t.DomUtil.hasClass(e,o)&&(n?(t.DomUtil.addClass(e,o+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:e})):(t.DomUtil.removeClass(e,o+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:e})))},isVisible:function(){return this._visible},_createItems:function(){var t,e,n=this._map.options.contextmenuItems;for(t=0,e=n.length;t<e;t++)this._items.push(this._createItem(this._container,n[t]))},_createItem:function(e,n,i){if(n.separator||"-"===n)return this._createSeparator(e,i);var o=t.Map.ContextMenu.BASE_CLS+"-item",s=n.disabled?o+" "+o+"-disabled":o,h=this._insertElementAt("a",s,e,i),a=this._createEventHandler(h,n.callback,n.context,n.hideOnSelect),m="";return n.icon?m='<img class="'+t.Map.ContextMenu.BASE_CLS+'-icon" src="'+n.icon+'"/>':n.iconCls&&(m='<span class="'+t.Map.ContextMenu.BASE_CLS+"-icon "+n.iconCls+'"></span>'),h.innerHTML=m+n.text,h.href="#",t.DomEvent.on(h,"mouseover",this._onItemMouseOver,this).on(h,"mouseout",this._onItemMouseOut,this).on(h,"mousedown",t.DomEvent.stopPropagation).on(h,"click",a),t.Browser.touch&&t.DomEvent.on(h,this._touchstart,t.DomEvent.stopPropagation),{id:t.Util.stamp(h),el:h,callback:a}},_removeItem:function(e){var n,i,o,s,h;for(o=0,s=this._items.length;o<s;o++)if(n=this._items[o],n.id===e)return i=n.el,h=n.callback,h&&(t.DomEvent.off(i,"mouseover",this._onItemMouseOver,this).off(i,"mouseover",this._onItemMouseOut,this).off(i,"mousedown",t.DomEvent.stopPropagation).off(i,"click",h),t.Browser.touch&&t.DomEvent.off(i,this._touchstart,t.DomEvent.stopPropagation)),this._container.removeChild(i),this._items.splice(o,1),n;return null},_createSeparator:function(e,n){var i=this._insertElementAt("div",t.Map.ContextMenu.BASE_CLS+"-separator",e,n);return{id:t.Util.stamp(i),el:i}},_createEventHandler:function(e,n,i,o){var s=this,h=this._map,a=t.Map.ContextMenu.BASE_CLS+"-item-disabled",o=void 0===o||o;return function(m){t.DomUtil.hasClass(e,a)||(o&&s._hide(),n&&n.call(i||h,s._showLocation),s._map.fire("contextmenu:select",{contextmenu:s,el:e}))}},_insertElementAt:function(t,e,n,i){var o,s=document.createElement(t);return s.className=e,void 0!==i&&(o=n.children[i]),o?n.insertBefore(s,o):n.appendChild(s),s},_show:function(t){this._showAtPoint(t.containerPoint,t)},_showAtPoint:function(e,n){if(this._items.length){var i=this._map,o=i.containerPointToLayerPoint(e),s=i.layerPointToLatLng(o),h=t.extend(n||{},{contextmenu:this});this._showLocation={latlng:s,layerPoint:o,containerPoint:e},n&&n.relatedTarget&&(this._showLocation.relatedTarget=n.relatedTarget),this._setPosition(e),this._visible?this._setPosition(e):(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",h)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_setPosition:function(e){var n,i=this._map.getSize(),o=this._container,s=this._getElementSize(o);this._map.options.contextmenuAnchor&&(n=t.point(this._map.options.contextmenuAnchor),e=e.add(n)),o._leaflet_pos=e,e.x+s.x>i.x?(o.style.left="auto",o.style.right=Math.max(i.x-e.x,0)+"px"):(o.style.left=Math.max(e.x,0)+"px",o.style.right="auto"),e.y+s.y>i.y?(o.style.top="auto",o.style.bottom=Math.max(i.y-e.y,0)+"px"):(o.style.top=Math.max(e.y,0)+"px",o.style.bottom="auto")},_getElementSize:function(t){var e=this._size,n=t.style.display;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display=n,this._sizeChanged=!1),e},_onKeyDown:function(t){var e=t.keyCode;27===e&&this._hide()},_onItemMouseOver:function(e){t.DomUtil.addClass(e.target||e.srcElement,"over")},_onItemMouseOut:function(e){t.DomUtil.removeClass(e.target||e.srcElement,"over")}}),t.Map.addInitHook("addHandler","contextmenu",t.Map.ContextMenu),t.Mixin.ContextMenu={bindContextMenu:function(e){return t.setOptions(this,e),this._initContextMenu(),this},unbindContextMenu:function(){return this.off("contextmenu",this._showContextMenu,this),this},addContextMenuItem:function(t){this.options.contextmenuItems.push(t)},removeContextMenuItemWithIndex:function(t){for(var e=[],n=0;n<this.options.contextmenuItems.length;n++)this.options.contextmenuItems[n].index==t&&e.push(n);for(var i=e.pop();void 0!==i;)this.options.contextmenuItems.splice(i,1),i=e.pop()},replaceConextMenuItem:function(t){this.removeContextMenuItemWithIndex(t.index),this.addContextMenuItem(t)},_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(e){var n,i,o,s,h;if(this._map.contextmenu){for(i=t.extend({relatedTarget:this},e),o=this._map.mouseEventToContainerPoint(e.originalEvent),this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems(),s=0,h=this.options.contextmenuItems.length;s<h;s++)n=this.options.contextmenuItems[s],this._items.push(this._map.contextmenu.insertItem(n,n.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(o,i)}},_hideContextMenu:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._map.contextmenu.removeItem(this._items[t]);this._items.length=0,this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var e,n,i,o=[t.Marker,t.Path],s={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0};for(n=0,i=o.length;n<i;n++)e=o[n],e.prototype.options?e.mergeOptions(s):e.prototype.options=s,e.addInitHook(function(){this.options.contextmenu&&this._initContextMenu()}),e.include(t.Mixin.ContextMenu);return t.Map.ContextMenu});
 
-},{}],4:[function(require,module,exports){
-!function(t,e,i){var n=t.L,o={};o.version="0.7.7","object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o),o.noConflict=function(){return t.L=n,this},t.L=o,o.Util={extend:function(t){var e,i,n,o,s=Array.prototype.slice.call(arguments,1);for(i=0,n=s.length;i<n;i++){o=s[i]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,o;if("object"==typeof t){o=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(o));return!0}return!1},limitExecByInterval:function(t,e,i){var n,o;return function s(){var a=arguments;return n?void(o=!0):(n=!0,setTimeout(function(){n=!1,o&&(s.apply(i,a),o=!1)},e),void t.apply(i,a))}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=o.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&e.indexOf("?")!==-1?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,o=["webkit","moz","o","ms"];for(i=0;i<o.length&&!n;i++)n=t[o[i]+e];return n}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,s=t.requestAnimationFrame||e("RequestAnimationFrame")||i,a=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,a,r){return e=o.bind(e,n),a&&s===i?void e():s.call(t,e,r)},o.Util.cancelAnimFrame=function(e){e&&a.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(e[s]=this[s]);t.statics&&(o.extend(e,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=o.extend({},n.options,t.options)),o.extend(n,t),n._initHooks=[];var a=this;return e.__super__=a.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){a.prototype.callInitHooks&&a.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;t<e;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){o.extend(this.prototype,t)},o.Class.mergeOptions=function(t){o.extend(this.prototype.options,t)},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var s="_leaflet_events";o.Mixin={},o.Mixin.Events={addEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d=this[s]=this[s]||{},p=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;n<a;n++)r={action:e,context:i||this},h=t[n],p?(l=h+"_idx",u=l+"_len",c=d[l]=d[l]||{},c[p]||(c[p]=[],d[u]=(d[u]||0)+1),c[p].push(r)):(d[h]=d[h]||[],d[h].push(r));return this},hasEventListeners:function(t){var e=this[s];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[s])return this;if(!t)return this.clearAllEventListeners();if(o.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d,p,_=this[s],m=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;n<a;n++)if(r=t[n],u=r+"_idx",c=u+"_len",d=_[u],e){if(h=m&&d?d[m]:_[r]){for(l=h.length-1;l>=0;l--)h[l].action!==e||i&&h[l].context!==i||(p=h.splice(l,1),p[0].action=o.Util.falseFn);i&&d&&0===h.length&&(delete d[m],_[c]--)}}else delete _[r],delete _[u],delete _[c];return this},clearAllEventListeners:function(){return delete this[s],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,a,r,h,l=o.Util.extend({},e,{type:t,target:this}),u=this[s];if(u[t])for(i=u[t].slice(),n=0,a=i.length;n<a;n++)i[n].action.call(i[n].context,l);r=u[t+"_idx"];for(h in r)if(i=r[h].slice())for(n=0,a=i.length;n<a;n++)i[n].action.call(i[n].context,l);return this},addOneTimeEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=o.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},o.Mixin.Events.on=o.Mixin.Events.addEventListener,o.Mixin.Events.off=o.Mixin.Events.removeEventListener,o.Mixin.Events.once=o.Mixin.Events.addOneTimeEventListener,o.Mixin.Events.fire=o.Mixin.Events.fireEvent,function(){var n="ActiveXObject"in t,s=n&&!e.addEventListener,a=navigator.userAgent.toLowerCase(),r=a.indexOf("webkit")!==-1,h=a.indexOf("chrome")!==-1,l=a.indexOf("phantom")!==-1,u=a.indexOf("android")!==-1,c=a.search("android [23]")!==-1,d=a.indexOf("gecko")!==-1,p=typeof orientation!=i+"",_=!t.PointerEvent&&t.MSPointerEvent,m=t.PointerEvent&&t.navigator.pointerEnabled||_,f="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,g=e.documentElement,v=n&&"transition"in g.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!c,P="MozPerspective"in g.style,L="OTransition"in g.style,x=!t.L_DISABLE_3D&&(v||y||P||L)&&!l,w=!t.L_NO_TOUCH&&!l&&(m||"ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch);o.Browser={ie:n,ielt9:s,webkit:r,gecko:d&&!r&&!t.opera&&!n,android:u,android23:c,chrome:h,ie3d:v,webkit3d:y,gecko3d:P,opera3d:L,any3d:x,mobile:p,mobileWebkit:p&&r,mobileWebkit3d:p&&y,mobileOpera:p&&t.opera,touch:w,msPointer:_,pointer:m,retina:f}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,a=s.x>=e.x&&n.x<=i.x,r=s.y>=e.y&&n.y<=i.y;return a&&r},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,n=0,s=0,a=t,r=e.body,h=e.documentElement;do{if(n+=a.offsetTop||0,s+=a.offsetLeft||0,n+=parseInt(o.DomUtil.getStyle(a,"borderTopWidth"),10)||0,s+=parseInt(o.DomUtil.getStyle(a,"borderLeftWidth"),10)||0,i=o.DomUtil.getStyle(a,"position"),a.offsetParent===r&&"absolute"===i)break;if("fixed"===i){n+=r.scrollTop||h.scrollTop||0,s+=r.scrollLeft||h.scrollLeft||0;break}if("relative"===i&&!a.offsetLeft){var l=o.DomUtil.getStyle(a,"width"),u=o.DomUtil.getStyle(a,"max-width"),c=a.getBoundingClientRect();"none"===l&&"none"===u||(s+=c.left+a.clientLeft),n+=c.top+(r.scrollTop||h.scrollTop||0);break}a=a.offsetParent}while(a);a=t;do{if(a===r)break;n-=a.scrollTop||0,s-=a.scrollLeft||0,a=a.parentNode}while(a);return new o.Point(s,n)},documentIsLtr:function(){return o.DomUtil._docIsLtrCached||(o.DomUtil._docIsLtrCached=!0,o.DomUtil._docIsLtr="ltr"===o.DomUtil.getStyle(e.body,"direction")),o.DomUtil._docIsLtr},create:function(t,i,n){var o=e.createElement(t);return o.className=i,n&&n.appendChild(o),o},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),s=0,a=n.length;s<a;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,e)){var r=o.DomUtil._getClass(t);o.DomUtil._setClass(t,(r?r+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil._setClass(t,o.Util.trim((" "+o.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=o.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=o.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&o.Browser.any3d?t.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),o.DomUtil.TRANSITION_END="webkitTransition"===o.DomUtil.TRANSITION||"OTransition"===o.DomUtil.TRANSITION?o.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in e)o.extend(o.DomUtil,{disableTextSelection:function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},enableTextSelection:function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)}});else{var i=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.extend(o.DomUtil,{disableTextSelection:function(){if(i){var t=e.documentElement.style;this._userSelect=t[i],t[i]="none"}},enableTextSelection:function(){i&&(e.documentElement.style[i]=this._userSelect,delete this._userSelect)}})}o.extend(o.DomUtil,{disableImageDrag:function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},enableImageDrag:function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)}})}(),o.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==i&&(this.alt=parseFloat(n))},o.extend(o.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),o.LatLng.prototype={equals:function(t){if(!t)return!1;t=o.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=o.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=o.latLng(t);var e=6378137,i=o.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,s=(t.lng-this.lng)*i,a=this.lat*i,r=t.lat*i,h=Math.sin(n/2),l=Math.sin(s/2),u=h*h+l*l*Math.cos(a)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(i<t||i===e?e:t),new o.LatLng(this.lat,i)}},o.latLng=function(t,e){return t instanceof o.LatLng?t:o.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new o.LatLng(t[0],t[1],t[2]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===i?null:new o.LatLng(t,e)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=o.latLng(t);return t=null!==e?e:o.latLngBounds(t),t instanceof o.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new o.LatLng(t.lat,t.lng),this._northEast=new o.LatLng(t.lat,t.lng)):t instanceof o.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-s),new o.LatLng(i.lat+n,i.lng+s))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=s.lat&&e.lng>=n.lng&&i.lng<=s.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),a=s.lat>=e.lat&&n.lat<=i.lat,r=s.lng>=e.lng&&n.lng<=i.lng;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return!!t&&(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return!t||t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=t.lng*e,a=n*e;return a=Math.log(Math.tan(Math.PI/4+a/2)),new o.Point(s,a)},unproject:function(t){var e=o.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new o.LatLng(n,i)}},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)}},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return o.point(e,e)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),o.CRS.EPSG3857=o.extend({},o.CRS,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:new o.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/360,.5,-1/360,.5)}),o.Map=o.Class.extend({includes:o.Mixin.Events,options:{crs:o.CRS.EPSG3857,fadeAnimation:o.DomUtil.TRANSITION&&!o.Browser.android23,trackResize:!0,markerZoomAnimation:o.DomUtil.TRANSITION&&o.Browser.any3d},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(o.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),a=t instanceof o.Point?t:this.latLngToContainerPoint(t),r=a.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(r));return this.setView(h,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n));s=e.maxZoom?Math.min(e.maxZoom,s):s;var a=n.subtract(i).divideBy(2),r=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),l=this.unproject(r.add(h).divideBy(2).add(a),s);return this.setView(l,s,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(o.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=o.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var i=this.getCenter(),n=this._limitCenter(i,this._zoom,t);return i.equals(n)?this:this.panTo(n,e)},addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return!!t&&o.stamp(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),a=n.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=i}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom===i?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t);var n,s=this.getMinZoom()-(e?1:0),a=this.getMaxZoom(),r=this.getSize(),h=t.getNorthWest(),l=t.getSouthEast(),u=!0;i=o.point(i||[0,0]);do s++,n=this.project(l,s).subtract(this.project(h,s)).add(i),u=e?n.x<r.x||n.y<r.y:r.contains(n);while(u&&s<=a);return u&&e?null:e?s:s-1},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new o.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new o.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,e),o.DomUtil.addClass(t.shadowPane,e),o.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return o.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;e<i;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var s=this._zoom!==e;n||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!i}),a&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(s||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-(1/0),o=this._getZoomSpan();for(t in this._zoomBoundLayers){var s=this._zoomBoundLayers[t];isNaN(s.options.minZoom)||(e=Math.min(e,s.options.minZoom)),isNaN(s.options.maxZoom)||(n=Math.max(n,s.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),o!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){e=e||"on",o.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,s=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=s.length;i<n;i++)o.DomEvent[e](this._container,s[i],this._fireMouseEvent,this);this.options.trackResize&&o.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||o.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!o.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&o.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),s=this.layerPointToLatLng(n);this.fire(e,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),a=new o.Bounds(n.subtract(s),n.add(s)),r=this._getBoundsOffset(a,i,e);return this.unproject(n.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=this.project(e.getNorthWest(),i).subtract(t.min),s=this.project(e.getSouthEast(),i).subtract(t.max),a=this._rebound(n.x,-s.x),r=this._rebound(n.y,-s.y);return new o.Point(a,r)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),o.map=function(t,e){return new o.Map(t,e)},o.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=this.R_MAJOR,a=this.R_MINOR,r=t.lng*e*s,h=n*e,l=a/s,u=Math.sqrt(1-l*l),c=u*Math.sin(h);c=Math.pow((1-c)/(1+c),.5*u);var d=Math.tan(.5*(.5*Math.PI-h))/c;return h=-s*Math.log(d),new o.Point(r,h)},unproject:function(t){for(var e,i=o.LatLng.RAD_TO_DEG,n=this.R_MAJOR,s=this.R_MINOR,a=t.x*i/n,r=s/n,h=Math.sqrt(1-r*r),l=Math.exp(-t.y/n),u=Math.PI/2-2*Math.atan(l),c=15,d=1e-7,p=c,_=.1;Math.abs(_)>d&&--p>0;)e=h*Math.sin(u),_=Math.PI/2-2*Math.atan(l*Math.pow((1-e)/(1+e),.5*h))-u,u+=_;return new o.LatLng(u*i,a)}},o.CRS.EPSG3395=o.extend({},o.CRS,{code:"EPSG:3395",projection:o.Projection.Mercator,
-transformation:function(){var t=o.Projection.Mercator,e=t.R_MAJOR,i=.5/(Math.PI*e);return new o.Transformation(i,.5,-i,.5)}()}),o.TileLayer=o.Class.extend({includes:o.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:o.Browser.mobile,updateWhenIdle:o.Browser.mobile},initialize:function(t,e){e=o.setOptions(this,e),e.detectRetina&&o.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=o.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=o.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,o,s=t.children,a=-e(1/0,-(1/0));for(n=0,o=s.length;n<o;n++)s[n]!==this._container&&(i=parseInt(s[n].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(o.Browser.ielt9)for(t in e)o.DomUtil.setOpacity(e[t],this.options.opacity);else o.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=o.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=o.DomUtil.create("div",e,this._container),this._tileContainer=o.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,n=this.options.tileSize;return i&&e>i&&(n=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*n)),n},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),n=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var s=o.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(s),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(s)}}},_addTilesFromCenterOut:function(t){var i,n,s,a=[],r=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(n=t.min.x;n<=t.max.x;n++)s=new o.Point(n,i),this._tileShouldBeLoaded(s)&&a.push(s);var h=a.length;if(0!==h){a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)});var l=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=h,n=0;n<h;n++)this._addTile(a[n],l);this._tileContainer.appendChild(l)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var n=this._getTileSize(),o=t.multiplyBy(n),s=o.add([n,n]),a=this._map.unproject(o),r=this._map.unproject(s);if(e.continuousWorld||e.noWrap||(a=a.wrap(),r=r.wrap()),!e.bounds.intersects([a,r]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,o;for(o in this._tiles)e=o.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(i<t.min.x||i>t.max.x||n<t.min.y||n>t.max.y)&&this._removeTile(o)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(o.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),o.Browser.android||(e.onload=null,e.src=o.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();o.DomUtil.setPosition(n,i,o.Browser.chrome),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return o.Util.template(this._url,o.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=o.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity!==i&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&o.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(o.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==o.Util.emptyImageUrl&&(o.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;e.detectRetina&&o.Browser.retina?i.width=i.height=2*n:i.width=i.height=n;for(var s in e)this.options.hasOwnProperty(s)||"crs"===s||(i[s]=e[s]);this.wmsParams=i,o.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=this.options.tileSize,n=t.multiplyBy(i),s=n.add([i,i]),a=this._crs.project(e.unproject(n,t.z)),r=this._crs.project(e.unproject(s,t.z)),h=this._wmsVersion>=1.3&&this._crs===o.CRS.EPSG4326?[r.y,a.x,a.y,r.x].join(","):[a.x,r.y,r.x,a.y].join(","),l=o.Util.template(this._url,{s:this._getSubdomain(t)});return l+o.Util.getParamString(this.wmsParams,l,!0)+"&BBOX="+h},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.TileLayer.Canvas=o.TileLayer.extend({options:{async:!1},initialize:function(t){o.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=o.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=o.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),o.tileLayer.canvas=function(t){return new o.TileLayer.Canvas(t)},o.ImageOverlay=o.Class.extend({includes:o.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&o.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=o.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&o.Browser.any3d?o.DomUtil.addClass(this._image,"leaflet-zoom-animated"):o.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),o.extend(this._image,{galleryimg:"no",onselectstart:o.Util.falseFn,onmousemove:o.Util.falseFn,onload:o.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),s=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),r=e._latLngToNewLayerPoint(s,t.zoom,t.center),h=e._latLngToNewLayerPoint(a,t.zoom,t.center)._subtract(r),l=r._add(h._multiplyBy(.5*(1-1/n)));i.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(l)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);o.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({options:{className:""},initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,s=o.point(n[e+"Size"]);i="shadow"===e?o.point(n.shadowAnchor||n.iconAnchor):o.point(n.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];o.Browser.retina&&"icon"===t&&(t+="-2x");var i=o.Icon.Default.imagePath;if(!i)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),o.Icon.Default.imagePath=function(){var t,i,n,o,s,a=e.getElementsByTagName("script"),r=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=a.length;t<i;t++)if(n=a[t].src,o=n.match(r))return s=n.split(r)[0],(s?s+"/":"")+"images"}(),o.Marker=o.Class.extend({includes:o.Mixin.Events,options:{icon:new o.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){return this._icon&&this._setPos(this._map.latLngToLayerPoint(this._latlng).round()),this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",s=t.icon.createIcon(this._icon),a=!1;s!==this._icon&&(this._icon&&this._removeIcon(),a=!0,t.title&&(s.title=t.title),t.alt&&(s.alt=t.alt)),o.DomUtil.addClass(s,n),t.keyboard&&(s.tabIndex="0"),this._icon=s,this._initInteraction(),t.riseOnHover&&o.DomEvent.on(s,"mouseover",this._bringToFront,this).on(s,"mouseout",this._resetZIndex,this);var r=t.icon.createShadow(this._shadow),h=!1;r!==this._shadow&&(this._removeShadow(),h=!0),r&&o.DomUtil.addClass(r,n),this._shadow=r,t.opacity<1&&this._updateOpacity();var l=this._map._panes;a&&l.markerPane.appendChild(this._icon),r&&h&&l.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&o.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];o.DomUtil.addClass(t,"leaflet-clickable"),o.DomEvent.on(t,"click",this._onMouseClick,this),o.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)o.DomEvent.on(t,e[i],this._fireMouseEvent,this);o.Handler.MarkerDrag&&(this.dragging=new o.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&o.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&o.DomEvent.preventDefault(t),"mousedown"!==t.type?o.DomEvent.stopPropagation(t):o.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){o.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&o.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;return n.html!==!1?i.innerHTML=n.html:i.innerHTML="",n.bgPos&&(i.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Popup=o.Class.extend({includes:o.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){o.setOptions(this,t),this._source=e,this._animated=o.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&o.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&o.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),o.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&o.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=o.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=o.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",o.DomEvent.disableClickPropagation(t),o.DomEvent.on(t,"click",this._onCloseButtonClick,this));var s=this._wrapper=o.DomUtil.create("div",e+"-content-wrapper",n);o.DomEvent.disableClickPropagation(s),this._contentNode=o.DomUtil.create("div",e+"-content",s),o.DomEvent.disableScrollPropagation(this._contentNode),o.DomEvent.on(s,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",e+"-tip-container",n),this._tip=o.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,a="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",o.DomUtil.addClass(t,a)):o.DomUtil.removeClass(t,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=o.point(this.options.offset);e&&o.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);o.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new o.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(o.DomUtil.getPosition(this._container));var s=t.layerPointToContainerPoint(n),a=o.point(this.options.autoPanPadding),r=o.point(this.options.autoPanPaddingTopLeft||a),h=o.point(this.options.autoPanPaddingBottomRight||a),l=t.getSize(),u=0,c=0;s.x+i+h.x>l.x&&(u=s.x+i-l.x+h.x),s.x-u-r.x<0&&(u=s.x-r.x),s.y+e+h.y>l.y&&(c=s.y+e-l.y+h.y),s.y-c-r.y<0&&(c=s.y-r.y),(u||c)&&t.fire("autopanstart").panBy([u,c])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof o.Popup)){var n=t;t=new o.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),o.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=o.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(o.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=o.extend({offset:i},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof o.Popup?(o.setOptions(t,e),this._popup=t,t._source=this):this._popup=new o.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.LayerGroup=o.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;e<i;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({includes:o.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),"off"in t&&t.off(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof o.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=o.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Path=o.Class.extend({includes:[o.Mixin.Events],statics:{CLIP_PADDING:function(){var e=o.Browser.mobile?1280:2e3,i=(e/Math.max(t.outerWidth,t.outerHeight)-1)/2;return Math.max(0,Math.min(.5,i))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){o.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,o.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return o.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),o.Map.include({_updatePathViewport:function(){var t=o.Path.CLIP_PADDING,e=this.getSize(),i=o.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),s=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new o.Bounds(n,s)}}),o.Path.SVG_NS="http://www.w3.org/2000/svg",o.Browser.svg=!(!e.createElementNS||!e.createElementNS(o.Path.SVG_NS,"svg").createSVGRect),o.Path=o.Path.extend({statics:{SVG:o.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(o.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&o.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){!o.Browser.svg&&o.Browser.vml||o.DomUtil.addClass(this._path,"leaflet-clickable"),o.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)o.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this._map&&this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),s=e.layerPointToLatLng(n);this.fire(t.type,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&o.DomEvent.preventDefault(t),"mousemove"!==t.type&&o.DomEvent.stopPropagation(t)}}}),o.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=o.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&o.Browser.any3d?(o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),
-this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,s=i.y-e.y,a=this._pathRoot,r=this._panes.overlayPane;o.Browser.mobileWebkit&&r.removeChild(a),o.DomUtil.setPosition(a,e),a.setAttribute("width",n),a.setAttribute("height",s),a.setAttribute("viewBox",[e.x,e.y,n,s].join(" ")),o.Browser.mobileWebkit&&r.appendChild(a)}}}),o.Path.include({bindPopup:function(t,e){return t instanceof o.Popup?this._popup=t:(this._popup&&!e||(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),o.Browser.vml=!o.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(t){return!1}}(),o.Path=o.Browser.svg||!o.Browser.vml?o.Path:o.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");o.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&o.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=o.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",i.lineCap&&(t.endcap=i.lineCap.replace("butt","flat")),i.lineJoin&&(t.joinstyle=i.lineJoin)):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),o.Map.include(o.Browser.svg||!o.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.Path=o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?o.Path:o.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return o.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!o.Path._updateRequest&&(o.Path._updateRequest=o.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){o.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color),t.lineCap&&(this._ctx.lineCap=t.lineCap),t.lineJoin&&(this._ctx.lineJoin=t.lineJoin)},_drawPath:function(){var t,e,i,n,s,a;for(this._ctx.beginPath(),t=0,i=this._parts.length;t<i;t++){for(e=0,n=this._parts[t].length;e<n;e++)s=this._parts[t][e],a=(0===e?"move":"line")+"To",this._ctx[a](s.x,s.y);this instanceof o.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill(e.fillRule||"evenodd")),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click dblclick contextmenu",this._fireMouseEvent,this))},_fireMouseEvent:function(t){this._containsPoint(t.layerPoint)&&this.fire(t.type,t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),o.Map.include(o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;o.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var a,r=[];for(a=0;a<n;a++)s[a]&&r.push(t[a]);return r},_simplifyDPStep:function(t,e,i,n,o){var s,a,r,h=0;for(a=n+1;a<=o-1;a++)r=this._sqClosestPointOnSegment(t[a],t[n],t[o],!0),r>h&&(s=a,h=r);h>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;n<s;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return o<s-1&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n){var o,s,a,r=n?this._lastCode:this._getBitCode(t,i),h=this._getBitCode(e,i);for(this._lastCode=h;;){if(!(r|h))return[t,e];if(r&h)return!1;o=r||h,s=this._getEdgeIntersection(t,e,o,i),a=this._getBitCode(s,i),o===r?(t=s,r=a):(e=s,h=a)}},_getEdgeIntersection:function(t,e,i,n){var s=e.x-t.x,a=e.y-t.y,r=n.min,h=n.max;return 8&i?new o.Point(t.x+s*(h.y-t.y)/a,h.y):4&i?new o.Point(t.x+s*(r.y-t.y)/a,r.y):2&i?new o.Point(h.x,t.y+a*(h.x-t.x)/s):1&i?new o.Point(r.x,t.y+a*(r.x-t.x)/s):void 0},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var s,a=e.x,r=e.y,h=i.x-a,l=i.y-r,u=h*h+l*l;return u>0&&(s=((t.x-a)*h+(t.y-r)*l)/u,s>1?(a=i.x,r=i.y):s>0&&(a+=h*s,r+=l*s)),h=t.x-a,l=t.y-r,n?h*h+l*l:new o.Point(a,r)}},o.Polyline=o.Path.extend({initialize:function(t,e){o.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;t<e;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";t<e;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(o.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,s=this._parts,a=null,r=0,h=s.length;r<h;r++)for(var l=s[r],u=1,c=l.length;u<c;u++){e=l[u-1],i=l[u];var d=o.LineUtil._sqClosestPointOnSegment(t,e,i,!0);d<n&&(n=d,a=o.LineUtil._sqClosestPointOnSegment(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getBounds:function(){return new o.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,s=e?t:[];for(i=0,n=t.length;i<n;i++){if(o.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;s[i]=o.latLng(t[i])}return s},_initEvents:function(){o.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=o.Path.VML,n=0,s=t.length,a="";n<s;n++)e=t[n],i&&e._round(),a+=(n?"L":"M")+e.x+" "+e.y;return a},_clipPoints:function(){var t,e,i,n=this._originalPoints,s=n.length;if(this.options.noClip)return void(this._parts=[n]);this._parts=[];var a=this._parts,r=this._map._pathViewport,h=o.LineUtil;for(t=0,e=0;t<s-1;t++)i=h.clipSegment(n[t],n[t+1],r,t),i&&(a[e]=a[e]||[],a[e].push(i[0]),i[1]===n[t+1]&&t!==s-2||(a[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=o.LineUtil,i=0,n=t.length;i<n;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),o.Path.prototype._updatePath.call(this))}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e){var i,n,s,a,r,h,l,u,c,d=[1,4,2,8],p=o.LineUtil;for(n=0,l=t.length;n<l;n++)t[n]._code=p._getBitCode(t[n],e);for(a=0;a<4;a++){for(u=d[a],i=[],n=0,l=t.length,s=l-1;n<l;s=n++)r=t[n],h=t[s],r._code&u?h._code&u||(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)):(h._code&u&&(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)),i.push(r));t=i}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},initialize:function(t,e){o.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,i,n;if(t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,i=this._holes.length;e<i;e++)n=this._holes[e]=this._convertLatLngs(this._holes[e]),n[0].equals(n[n.length-1])&&n.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(o.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;t<i;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;e<n;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):o.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;i<n;i++){var s=o.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);s.length&&e.push(s)}this._parts=e}},_getPathPartStr:function(t){var e=o.Polyline.prototype._getPathPartStr.call(this,t);return e+(o.Browser.svg?"z":"x")}}),o.polygon=function(t,e){return new o.Polygon(t,e)},function(){function t(t){return o.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){i<n?t.setLatLngs(e[i++]):this.removeLayer(t)},this);i<n;)this.addLayer(new t(e[i++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}o.MultiPolyline=t(o.Polyline),o.MultiPolygon=t(o.Polygon),o.multiPolyline=function(t,e){return new o.MultiPolyline(t,e)},o.multiPolygon=function(t,e){return new o.MultiPolygon(t,e)}}(),o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.Circle=o.Path.extend({initialize:function(t,e,i){o.Path.prototype.initialize.call(this,i),this._latlng=o.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=this._mRadius/40075017*360,i=this._latlng;return new o.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":o.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(o.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.CircleMarker=o.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){o.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){o.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return o.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Polyline.include(o.Path.CANVAS?{_containsPoint:function(t,e){var i,n,s,a,r,h,l,u=this.options.weight/2;for(o.Browser.touch&&(u+=10),i=0,a=this._parts.length;i<a;i++)for(l=this._parts[i],n=0,r=l.length,s=r-1;n<r;s=n++)if((e||0!==n)&&(h=o.LineUtil.pointToSegmentDistance(t,l[s],l[n]),h<=u))return!0;return!1}}:{}),o.Polygon.include(o.Path.CANVAS?{_containsPoint:function(t){var e,i,n,s,a,r,h,l,u=!1;if(o.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(s=0,h=this._parts.length;s<h;s++)for(e=this._parts[s],a=0,l=e.length,r=l-1;a<l;r=a++)i=e[a],n=e[r],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u}}:{}),o.Circle.include(o.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),o.CircleMarker.include(o.Path.CANVAS?{_updateStyle:function(){o.Path.prototype._updateStyle.call(this)}}:{}),o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,s=o.Util.isArray(t)?t:t.features;if(s){for(e=0,i=s.length;e<i;e++)n=s[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(s[e]);return this}var a=this.options;if(!a.filter||a.filter(t)){var r=o.GeoJSON.geometryToLayer(t,a.pointToLayer,a.coordsToLatLng,a);return r.feature=o.GeoJSON.asFeature(t),r.defaultOptions=r.options,this.resetStyle(r),a.onEachFeature&&a.onEachFeature(t,r),this.addLayer(r)}},resetStyle:function(t){var e=this.options.style;e&&(o.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e,i,n){var s,a,r,h,l="Feature"===t.type?t.geometry:t,u=l.coordinates,c=[];switch(i=i||this.coordsToLatLng,l.type){case"Point":return s=i(u),e?e(t,s):new o.Marker(s);case"MultiPoint":for(r=0,h=u.length;r<h;r++)s=i(u[r]),c.push(e?e(t,s):new o.Marker(s));return new o.FeatureGroup(c);case"LineString":return a=this.coordsToLatLngs(u,0,i),new o.Polyline(a,n);case"Polygon":if(2===u.length&&!u[1].length)throw new Error("Invalid GeoJSON object.");return a=this.coordsToLatLngs(u,1,i),new o.Polygon(a,n);case"MultiLineString":return a=this.coordsToLatLngs(u,1,i),new o.MultiPolyline(a,n);case"MultiPolygon":return a=this.coordsToLatLngs(u,2,i),new o.MultiPolygon(a,n);case"GeometryCollection":for(r=0,h=l.geometries.length;r<h;r++)c.push(this.geometryToLayer({geometry:l.geometries[r],type:"Feature",properties:t.properties},e,i,n));return new o.FeatureGroup(c);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var n,o,s,a=[];for(o=0,s=t.length;o<s;o++)n=e?this.coordsToLatLngs(t[o],e-1,i):(i||this.coordsToLatLng)(t[o]),a.push(n);return a},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==i&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;i<n;i++)e.push(o.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var a={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(a),o.Circle.include(a),o.CircleMarker.include(a),o.Polyline.include({toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"LineString",coordinates:o.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),o.Polygon.include({toGeoJSON:function(){var t,e,i,n=[o.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;t<e;t++)i=o.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return o.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:t,coordinates:e})}}o.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),o.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),o.LayerGroup.include({toGeoJSON:function(){var e,i=this.feature&&this.feature.geometry,n=[];if(i&&"MultiPoint"===i.type)return t("MultiPoint").call(this);var s=i&&"GeometryCollection"===i.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),n.push(s?e.geometry:o.GeoJSON.asFeature(e)))}),s?o.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}})}(),o.geoJson=function(t,e){return new o.GeoJSON(t,e)},o.DomEvent={addListener:function(t,e,i,n){var s,a,r,h=o.stamp(i),l="_leaflet_"+e+h;return t[l]?this:(s=function(e){return i.call(n||t,e||o.DomEvent._getEvent())},o.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,s,h):(o.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,s,h),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",s,!1),t.addEventListener(e,s,!1)):"mouseenter"===e||"mouseleave"===e?(a=s,r="mouseenter"===e?"mouseover":"mouseout",s=function(e){if(o.DomEvent._checkMouse(t,e))return a(e)},t.addEventListener(r,s,!1)):"click"===e&&o.Browser.android?(a=s,s=function(t){return o.DomEvent._filterClick(t,a)},t.addEventListener(e,s,!1)):t.addEventListener(e,s,!1):"attachEvent"in t&&t.attachEvent("on"+e,s),t[l]=s,this))},removeListener:function(t,e,i){var n=o.stamp(i),s="_leaflet_"+e+n,a=t[s];return a?(o.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,n):o.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",a,!1),t.removeEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1):t.removeEventListener(e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=o.DomEvent.stopPropagation,i=o.Draggable.START.length-1;i>=0;i--)o.DomEvent.on(t,o.Draggable.START[i],e);return o.DomEvent.on(t,"click",o.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&i-o.DomEvent._lastClick;return n&&n>100&&n<500||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,e(t))}},o.DomEvent.on=o.DomEvent.addListener,o.DomEvent.off=o.DomEvent.removeListener,o.Draggable=o.Class.extend({includes:o.Mixin.Events,statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.on(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.off(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!t.shiftKey&&(1===t.which||1===t.button||t.touches)&&(o.DomEvent.stopPropagation(t),!o.Draggable._disabled&&(o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),!this._moving))){var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),this._startPos=this._newPos=o.DomUtil.getPosition(this._element),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var i=t.touches&&1===t.touches.length?t.touches[0]:t,n=new o.Point(i.clientX,i.clientY),s=n.subtract(this._startPoint);(s.x||s.y)&&(o.Browser.touch&&Math.abs(s.x)+Math.abs(s.y)<3||(o.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(s),o.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,o.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){o.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(o.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[t],this._onMove).off(e,o.Draggable.END[t],this._onUp);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:o.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,a=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,i=e.options,n=+new Date-this._lastTime,s=!i.inertia||n>i.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),s)e.fire("moveend");else{var a=this._lastPos.subtract(this._positions[0]),r=(this._lastTime+n-this._times[0])/1e3,h=i.easeLinearity,l=a.multiplyBy(h/r),u=l.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,u),d=l.multiplyBy(c/u),p=c/(i.inertiaDeceleration*h),_=d.multiplyBy(-p/2).round();_.x&&_.y?(_=e._limitOffset(_,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(_,{duration:p,easeLinearity:h,noMoveStart:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),o.DomEvent.on(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),o.DomEvent.off(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),i),o.DomEvent.preventDefault(t),o.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(i+e):t.setZoomAround(this._lastMousePos,i+e))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,i,n){function s(t){var e;if(o.Browser.pointer?(_.push(t.pointerId),e=_.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(r||i);h=t.touches?t.touches[0]:t,l=n>0&&n<=u,r=i}}function a(t){if(o.Browser.pointer){var e=_.indexOf(t.pointerId);if(e===-1)return;_.splice(e,1)}if(l){if(o.Browser.pointer){var n,s={};for(var a in h)n=h[a],"function"==typeof n?s[a]=n.bind(h):s[a]=n;h=s}h.type="dblclick",i(h),r=null}}var r,h,l=!1,u=250,c="_leaflet_",d=this._touchstart,p=this._touchend,_=[];t[c+d+n]=s,t[c+p+n]=a;var m=o.Browser.pointer?e.documentElement:t;return t.addEventListener(d,s,!1),m.addEventListener(p,a,!1),o.Browser.pointer&&m.addEventListener(o.DomEvent.POINTER_CANCEL,a,!1),this},removeDoubleTapListener:function(t,i){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+i],!1),(o.Browser.pointer?e.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+i],!1),o.Browser.pointer&&e.documentElement.removeEventListener(o.DomEvent.POINTER_CANCEL,t[n+this._touchend+i],!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,i,n){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i,n);
-case"touchend":return this.addPointerListenerEnd(t,e,i,n);case"touchmove":return this.addPointerListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,i,n,s){var a="_leaflet_",r=this._pointers,h=function(t){"mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&o.DomEvent.preventDefault(t);for(var e=!1,i=0;i<r.length;i++)if(r[i].pointerId===t.pointerId){e=!0;break}e||r.push(t),t.touches=r.slice(),t.changedTouches=[t],n(t)};if(t[a+"touchstart"+s]=h,t.addEventListener(this.POINTER_DOWN,h,!1),!this._pointerDocumentListener){var l=function(t){for(var e=0;e<r.length;e++)if(r[e].pointerId===t.pointerId){r.splice(e,1);break}};e.documentElement.addEventListener(this.POINTER_UP,l,!1),e.documentElement.addEventListener(this.POINTER_CANCEL,l,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,i,n){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],i(t)}}var s="_leaflet_",a=this._pointers;return t[s+"touchmove"+n]=o,t.addEventListener(this.POINTER_MOVE,o,!1),this},addPointerListenerEnd:function(t,e,i,n){var o="_leaflet_",s=this._pointers,a=function(t){for(var e=0;e<s.length;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}t.touches=s.slice(),t.changedTouches=[t],i(t)};return t[o+"touchend"+n]=a,t.addEventListener(this.POINTER_UP,a,!1),t.addEventListener(this.POINTER_CANCEL,a,!1),this},removePointerListener:function(t,e,i){var n="_leaflet_",o=t[n+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,o,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,o,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,o,!1),t.removeEventListener(this.POINTER_CANCEL,o,!1)}return this}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&&!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToLayerPoint(t.touches[0]),s=i.mouseEventToLayerPoint(t.touches[1]),a=i._getCenterLayerPoint();this._startCenter=n.add(s)._divideBy(2),this._startDist=n.distanceTo(s),this._moved=!1,this._zooming=!0,this._centerOffset=a.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(!e.options.bounceAtZoomLimits&&(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1)||(this._moved||(o.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),o.DomEvent.preventDefault(t)))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var t=this._map;this._zooming=!1,o.DomUtil.removeClass(t._mapPane,"leaflet-touching"),o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),n=t.layerPointToLatLng(i),s=t.getZoom(),a=t.getScaleZoom(this._scale)-s,r=a>0?Math.ceil(a):Math.floor(a),h=t._limitZoom(s+r),l=t.getZoomScale(h)/this._scale;t._animateZoom(n,h,i,l)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),o.DomEvent.on(e,"touchmove",this._onMove,this).on(e,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,"touchmove",this._onMove,this).off(e,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&&!o.Browser.pointer&&o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!(!t.shiftKey||1!==t.which&&1!==t.button)&&(o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),void o.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this))},_onMouseMove:function(t){this._moved||(this._box=o.DomUtil.create("div","leaflet-zoom-box",this._pane),o.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),s=n.subtract(e),a=new o.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));o.DomUtil.setPosition(i,a),this._moved=!0,i.style.width=Math.max(0,Math.abs(s.x)-4)+"px",i.style.height=Math.max(0,Math.abs(s.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new o.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;t.tabIndex===-1&&(t.tabIndex="0"),o.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;o.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,s=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;e<i;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;e<i;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;e<i;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;e<i;e++)n[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;e<i;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;e<i;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}o.DomEvent.stop(t)}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),o.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=o.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&o.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),i.indexOf("bottom")!==-1?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,s){var a=i+t+" "+i+s;e[t+s]=o.DomUtil.create("div",a,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",i,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,s,a){var r=o.DomUtil.create("a",i,n);r.innerHTML=t,r.href="#",r.title=e;var h=o.DomEvent.stopPropagation;return o.DomEvent.on(r,"click",h).on(r,"mousedown",h).on(r,"dblclick",h).on(r,"click",o.DomEvent.preventDefault).on(r,"click",s,a).on(r,"click",this._refocusOnMap,a),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&o.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){if(t)return this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this},removeAttribution:function(t){if(t)return this._attributions[t]&&(this._attributions[t]--,this._update()),this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new o.Control.Attribution).addTo(this))}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=o.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=o.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),s=this.options,a=0;o.x>0&&(a=n*(s.maxWidth/o.x)),this._updateScales(s,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=e<1e3?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,o=3.2808399*t,s=this._iScale;o>5280?(e=o/5280,i=this._getRoundNum(e),s.style.width=this._getScaleWidth(i/e)+"px",s.innerHTML=i+" mi"):(n=this._getRoundNum(o),s.style.width=this._getScaleWidth(n/o)+"px",s.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){o.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=o.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),o.Browser.touch?o.DomEvent.on(e,"click",o.DomEvent.stopPropagation):o.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var i=this._form=o.DomUtil.create("form",t+"-list");if(this.options.collapsed){o.Browser.android||o.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",o.Browser.touch?o.DomEvent.on(n,"click",o.DomEvent.stop).on(n,"click",this._expand,this):o.DomEvent.on(n,"focus",this._expand,this),o.DomEvent.on(i,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=o.DomUtil.create("div",t+"-base",i),this._separator=o.DomUtil.create("div",t+"-separator",i),this._overlaysList=o.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=o.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[o.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var a=e.createElement("span");a.innerHTML=" "+t.name,n.appendChild(i),n.appendChild(a);var r=t.overlay?this._overlaysList:this._baseLayersList;return r.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=n.length;for(this._handlingClick=!0,t=0;t<o;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)},o.PosAnimation=o.Class.extend({includes:o.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[o.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",o.DomEvent.on(t,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),o.DomUtil.setPosition(t,e),o.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(o.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(o.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),o.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,s=this._el,a=t.getComputedStyle(s);if(o.Browser.any3d){if(n=a[o.DomUtil.TRANSFORM].match(this._transformRe),!n)return;e=parseFloat(n[1]),i=parseFloat(n[2])}else e=parseFloat(a.left),i=parseFloat(a.top);return new o.Point(e,i,!0)},_onTransitionEnd:function(){o.DomEvent.off(this._el,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[o.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),o.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return!((e&&e.animate)!==!0&&!this.getSize().contains(i))&&(this.panBy(i,e),!0)}}),o.PosAnimation=o.DomUtil.TRANSITION?o.PosAnimation:o.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;t<e?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));o.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),o.DomUtil.TRANSITION&&o.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.android23&&!o.Browser.mobileOpera,this._zoomAnimated&&o.DomEvent.on(this._mapPane,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),o.Map.include(o.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/n),s=this._getCenterLayerPoint()._add(o);return!(i.animate!==!0&&!this.getSize().contains(o))&&(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,s,n,null,!0),!0)},_animateZoom:function(t,e,i,n,s,a,r){r||(this._animatingZoom=!0),o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,o.Draggable&&(o.Draggable._disabled=!0),o.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:s,backwards:a}),setTimeout(o.bind(this._onZoomTransitionEnd,this),250)},this)},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._animatingZoom=!1,o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),o.Util.requestAnimFrame(function(){this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),o.Draggable&&(o.Draggable._disabled=!1)},this))}}:{}),o.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=o.DomUtil.TRANSFORM,n=t.delta?o.DomUtil.getTranslateString(t.delta):e.style[i],s=o.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?s+" "+n:n+" "+s},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),o.Util.falseFn(e.offsetWidth);var i=this._map.getZoom();(i>this.options.maxZoom||i<this.options.minZoom)&&this._clearBgBuffer(),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[o.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),n=this._getLoadedTilesPercentage(t);return e&&i>.5&&n<.5?(t.style.visibility="hidden",void this._stopLoadingImages(t)):(e.style.visibility="hidden",e.style[o.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),o=0;for(e=0,i=n.length;e<i;e++)n[e].complete&&o++;return o/i},_stopLoadingImages:function(t){var e,i,n,s=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=s.length;e<i;e++)n=s[e],n.complete||(n.onload=o.Util.falseFn,n.onerror=o.Util.falseFn,n.src=o.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),o.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=o.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),s=180*t.coords.accuracy/40075017,a=s/Math.cos(o.LatLng.DEG_TO_RAD*e),r=o.latLngBounds([e-s,i-a],[e+s,i+a]),h=this._locateOptions;if(h.setView){var l=Math.min(this.getBoundsZoom(r),h.maxZoom);this.setView(n,l)}var u={latlng:n,bounds:r,timestamp:t.timestamp};for(var c in t.coords)"number"==typeof t.coords[c]&&(u[c]=t.coords[c]);this.fire("locationfound",u)}})}(window,document);
+},{"leaflet":5}],4:[function(require,module,exports){
+!function(){function o(o){o.Control.Loading=o.Control.extend({options:{delayIndicator:null,position:"topleft",separate:!1,zoomControl:null,spinjs:!1,spin:{lines:7,length:3,width:3,radius:5,rotate:13,top:"83%"}},initialize:function(t){o.setOptions(this,t),this._dataLoaders={},null!==this.options.zoomControl&&(this.zoomControl=this.options.zoomControl)},onAdd:function(n){if(this.options.spinjs&&"function"!=typeof Spinner)return t.error("Leaflet.loading cannot load because you didn't load spin.js (http://fgnass.github.io/spin.js/), even though you set it in options.");this._addLayerListeners(n),this._addMapListeners(n),this.options.separate||this.zoomControl||(n.zoomControl?this.zoomControl=n.zoomControl:n.zoomsliderControl&&(this.zoomControl=n.zoomsliderControl));var i,a="leaflet-control-loading";return this.zoomControl&&!this.options.separate?(i=this.zoomControl._container,a+=" leaflet-bar-part-bottom leaflet-bar-part last",o.DomUtil.addClass(this._getLastControlButton(),"leaflet-bar-part-bottom")):i=o.DomUtil.create("div","leaflet-control-zoom leaflet-bar"),this._indicator=o.DomUtil.create("a",a,i),this.options.spinjs&&(this._spinner=new Spinner(this.options.spin).spin(),this._indicator.appendChild(this._spinner.el)),i},onRemove:function(o){this._removeLayerListeners(o),this._removeMapListeners(o)},removeFrom:function(t){return this.zoomControl&&!this.options.separate?(this._container.removeChild(this._indicator),this._map=null,this.onRemove(t),this):o.Control.prototype.removeFrom.call(this,t)},addLoader:function(o){if(this._dataLoaders[o]=!0,this.options.delayIndicator&&!this.delayIndicatorTimeout){var t=this;this.delayIndicatorTimeout=setTimeout(function(){t.updateIndicator(),t.delayIndicatorTimeout=null},this.options.delayIndicator)}else this.updateIndicator()},removeLoader:function(o){delete this._dataLoaders[o],this.updateIndicator(),this.options.delayIndicator&&this.delayIndicatorTimeout&&!this.isLoading()&&(clearTimeout(this.delayIndicatorTimeout),this.delayIndicatorTimeout=null)},updateIndicator:function(){this.isLoading()?this._showIndicator():this._hideIndicator()},isLoading:function(){return this._countLoaders()>0},_countLoaders:function(){var o,t=0;for(o in this._dataLoaders)this._dataLoaders.hasOwnProperty(o)&&t++;return t},_showIndicator:function(){o.DomUtil.addClass(this._indicator,"is-loading"),this.options.separate||(this.zoomControl instanceof o.Control.Zoom?o.DomUtil.removeClass(this._getLastControlButton(),"leaflet-bar-part-bottom"):"function"==typeof o.Control.Zoomslider&&this.zoomControl instanceof o.Control.Zoomslider&&o.DomUtil.removeClass(this.zoomControl._ui.zoomOut,"leaflet-bar-part-bottom"))},_hideIndicator:function(){o.DomUtil.removeClass(this._indicator,"is-loading"),this.options.separate||(this.zoomControl instanceof o.Control.Zoom?o.DomUtil.addClass(this._getLastControlButton(),"leaflet-bar-part-bottom"):"function"==typeof o.Control.Zoomslider&&this.zoomControl instanceof o.Control.Zoomslider&&o.DomUtil.addClass(this.zoomControl._ui.zoomOut,"leaflet-bar-part-bottom"))},_getLastControlButton:function(){for(var o=this.zoomControl._container,t=o.children.length-1;t>0;){var n=o.children[t];if(this._indicator!==n&&0!==n.offsetWidth&&0!==n.offsetHeight)break;t--}return o.children[t]},_handleLoading:function(o){this.addLoader(this.getEventId(o))},_handleBaseLayerChange:function(t){var n=this;t.layer&&t.layer.eachLayer&&"function"==typeof t.layer.eachLayer?t.layer.eachLayer(function(o){n._handleBaseLayerChange({layer:o})}):o.TileLayer.Canvas&&t.layer instanceof o.TileLayer.Canvas||n._handleLoading(t)},_handleLoad:function(o){this.removeLoader(this.getEventId(o))},getEventId:function(o){return o.id?o.id:o.layer?o.layer._leaflet_id:o.target._leaflet_id},_layerAdd:function(o){if(o.layer&&o.layer.on)try{o.layer.on({loading:this._handleLoading,load:this._handleLoad},this)}catch(n){t.warn("L.Control.Loading: Tried and failed to add  event handlers to layer",o.layer),t.warn("L.Control.Loading: Full details",n)}},_layerRemove:function(o){if(o.layer&&o.layer.off)try{o.layer.off({loading:this._handleLoading,load:this._handleLoad},this)}catch(n){t.warn("L.Control.Loading: Tried and failed to remove event handlers from layer",o.layer),t.warn("L.Control.Loading: Full details",n)}},_addLayerListeners:function(o){o.eachLayer(function(o){o.on&&o.on({loading:this._handleLoading,load:this._handleLoad},this)},this),o.on("layeradd",this._layerAdd,this),o.on("layerremove",this._layerRemove,this)},_removeLayerListeners:function(o){o.eachLayer(function(o){o.off&&o.off({loading:this._handleLoading,load:this._handleLoad},this)},this),o.off("layeradd",this._layerAdd,this),o.off("layerremove",this._layerRemove,this)},_addMapListeners:function(o){o.on({baselayerchange:this._handleBaseLayerChange,dataloading:this._handleLoading,dataload:this._handleLoad,layerremove:this._handleLoad},this)},_removeMapListeners:function(o){o.off({baselayerchange:this._handleBaseLayerChange,dataloading:this._handleLoading,dataload:this._handleLoad,layerremove:this._handleLoad},this)}}),o.Map.addInitHook(function(){this.options.loadingControl&&(this.loadingControl=new o.Control.Loading,this.addControl(this.loadingControl))}),o.Control.loading=function(t){return new o.Control.Loading(t)}}var t=window.console||{error:function(){},warn:function(){}};"function"==typeof define&&define.amd?define(["leaflet"],function(t){o(t)}):o(L)}();
 
 },{}],5:[function(require,module,exports){
+!function(t,e,i){function n(){var e=t.L;o.noConflict=function(){return t.L=e,this},t.L=o}var o={version:"1.0.1"};"object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o),"undefined"!=typeof t&&n(),o.Util={extend:function(t){var e,i,n,o;for(i=1,n=arguments.length;i<n;i++){o=arguments[i];for(e in o)t[e]=o[e]}return t},create:Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}(),bind:function(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}},stamp:function(t){return t._leaflet_id=t._leaflet_id||++o.Util.lastId,t._leaflet_id},lastId:0,throttle:function(t,e,i){var n,o,s,r;return r=function(){n=!1,o&&(s.apply(i,o),o=!1)},s=function(){n?o=arguments:(t.apply(i,arguments),setTimeout(r,e),n=!0)}},wrapNum:function(t,e,i){var n=e[1],o=e[0],s=n-o;return t===n&&i?t:((t-o)%s+s)%s+o},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){t.hasOwnProperty("options")||(t.options=t.options?o.Util.create(t.options):{});for(var i in e)t.options[i]=e[i];return t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&e.indexOf("?")!==-1?"&":"?")+n.join("&")},template:function(t,e){return t.replace(o.Util.templateRe,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},indexOf:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){return t["webkit"+e]||t["moz"+e]||t["ms"+e]}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,s=t.requestAnimationFrame||e("RequestAnimationFrame")||i,r=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,r){return r&&s===i?void e.call(n):s.call(t,o.bind(e,n))},o.Util.cancelAnimFrame=function(e){e&&r.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,n=o.Util.create(i);n.constructor=e,e.prototype=n;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(e[s]=this[s]);return t.statics&&(o.extend(e,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),n.options&&(t.options=o.Util.extend(o.Util.create(n.options),t.options)),o.extend(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;t<e;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){return o.extend(this.prototype,t),this},o.Class.mergeOptions=function(t){return o.extend(this.prototype.options,t),this},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this},o.Evented=o.Class.extend({on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;s<r;s++)this._on(t[s],e,i)}return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;s<r;s++)this._off(t[s],e,i)}else delete this._events;return this},_on:function(t,e,n){this._events=this._events||{};var o=this._events[t];o||(o=[],this._events[t]=o),n===this&&(n=i);for(var s={fn:e,ctx:n},r=o,a=0,h=r.length;a<h;a++)if(r[a].fn===e&&r[a].ctx===n)return;r.push(s),o.count++},_off:function(t,e,n){var s,r,a;if(this._events&&(s=this._events[t])){if(!e){for(r=0,a=s.length;r<a;r++)s[r].fn=o.Util.falseFn;return void delete this._events[t]}if(n===this&&(n=i),s)for(r=0,a=s.length;r<a;r++){var h=s[r];if(h.ctx===n&&h.fn===e)return h.fn=o.Util.falseFn,this._firingCount&&(this._events[t]=s=s.slice()),void s.splice(r,1)}}},fire:function(t,e,i){if(!this.listens(t,i))return this;var n=o.Util.extend({},e,{type:t,target:this});if(this._events){var s=this._events[t];if(s){this._firingCount=this._firingCount+1||1;for(var r=0,a=s.length;r<a;r++){var h=s[r];h.fn.call(h.ctx||this,n)}this._firingCount--}}return i&&this._propagateEvent(n),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var n in t)this.once(n,t[n],e);return this}var s=o.bind(function(){this.off(t,e,i).off(t,s,i)},this);return this.on(t,e,i).on(t,s,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[o.stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[o.stamp(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,o.extend({layer:t.target},t),!0)}});var s=o.Evented.prototype;s.addEventListener=s.on,s.removeEventListener=s.clearAllEventListeners=s.off,s.addOneTimeEventListener=s.once,s.fireEvent=s.fire,s.hasEventListeners=s.listens,o.Mixin={Events:s},function(){var i=navigator.userAgent.toLowerCase(),n=e.documentElement,s="ActiveXObject"in t,r=i.indexOf("webkit")!==-1,a=i.indexOf("phantom")!==-1,h=i.search("android [23]")!==-1,l=i.indexOf("chrome")!==-1,u=i.indexOf("gecko")!==-1&&!r&&!t.opera&&!s,c=0===navigator.platform.indexOf("Win"),d="undefined"!=typeof orientation||i.indexOf("mobile")!==-1,_=!t.PointerEvent&&t.MSPointerEvent,m=t.PointerEvent||_,p=s&&"transition"in n.style,f="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!h,g="MozPerspective"in n.style,v="OTransition"in n.style,y=!t.L_NO_TOUCH&&(m||"ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch);o.Browser={ie:s,ielt9:s&&!e.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in e),webkit:r,gecko:u,android:i.indexOf("android")!==-1,android23:h,chrome:l,safari:!l&&i.indexOf("safari")!==-1,win:c,ie3d:p,webkit3d:f,gecko3d:g,opera12:v,any3d:!t.L_DISABLE_3D&&(p||f||g)&&!v&&!a,mobile:d,mobileWebkit:d&&r,mobileWebkit3d:d&&f,mobileOpera:d&&t.opera,mobileGecko:d&&u,touch:!!y,msPointer:!!_,pointer:!!m,retina:(t.devicePixelRatio||t.screen.deviceXDPI/t.screen.logicalXDPI)>1}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new o.Point(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new o.Point(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new o.Point(t.x,t.y):new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x>=e.x&&n.x<=i.x,a=s.y>=e.y&&n.y<=i.y;return r&&a},overlaps:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x>e.x&&n.x<i.x,a=s.y>e.y&&n.y<i.y;return r&&a},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i]||t.currentStyle&&t.currentStyle[i];if((!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},create:function(t,i,n){var o=e.createElement(t);return o.className=i||"",n&&n.appendChild(o),o},remove:function(t){var e=t.parentNode;e&&e.removeChild(t)},empty:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},toFront:function(t){t.parentNode.appendChild(t)},toBack:function(t){var e=t.parentNode;e.insertBefore(t,e.firstChild)},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil.getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),s=0,r=n.length;s<r;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,e)){var a=o.DomUtil.getClass(t);o.DomUtil.setClass(t,(a?a+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil.setClass(t,o.Util.trim((" "+o.DomUtil.getClass(t)+" ").replace(" "+e+" "," ")))},setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&o.DomUtil._setOpacityIE(t,e)},_setOpacityIE:function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},setTransform:function(t,e,i){var n=e||new o.Point(0,0);t.style[o.DomUtil.TRANSFORM]=(o.Browser.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")},setPosition:function(t,e){t._leaflet_pos=e,o.Browser.any3d?o.DomUtil.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos||new o.Point(0,0)}},function(){o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var i=o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(o.DomUtil.TRANSITION_END="webkitTransition"===i||"OTransition"===i?i+"End":"transitionend","onselectstart"in e)o.DomUtil.disableTextSelection=function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},o.DomUtil.enableTextSelection=function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)};else{var n=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.DomUtil.disableTextSelection=function(){if(n){var t=e.documentElement.style;this._userSelect=t[n],t[n]="none"}},o.DomUtil.enableTextSelection=function(){n&&(e.documentElement.style[n]=this._userSelect,delete this._userSelect)}}o.DomUtil.disableImageDrag=function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},o.DomUtil.enableImageDrag=function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)},o.DomUtil.preventOutline=function(e){for(;e.tabIndex===-1;)e=e.parentNode;e&&e.style&&(o.DomUtil.restoreOutline(),this._outlineElement=e,this._outlineStyle=e.style.outline,e.style.outline="none",o.DomEvent.on(t,"keydown",o.DomUtil.restoreOutline,this))},o.DomUtil.restoreOutline=function(){this._outlineElement&&(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,o.DomEvent.off(t,"keydown",o.DomUtil.restoreOutline,this))}}(),o.LatLng=function(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,n!==i&&(this.alt=+n)},o.LatLng.prototype={equals:function(t,e){if(!t)return!1;t=o.latLng(t);var n=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return n<=(e===i?1e-9:e)},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){return o.CRS.Earth.distance(this,o.latLng(t))},wrap:function(){return o.CRS.Earth.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return o.latLngBounds([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new o.LatLng(this.lat,this.lng,this.alt)}},o.latLng=function(t,e,n){return t instanceof o.LatLng?t:o.Util.isArray(t)&&"object"!=typeof t[0]?3===t.length?new o.LatLng(t[0],t[1],t[2]):2===t.length?new o.LatLng(t[0],t[1]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===i?null:new o.LatLng(t,e,n)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){var e,i,n=this._southWest,s=this._northEast;if(t instanceof o.LatLng)e=t,i=t;else{if(!(t instanceof o.LatLngBounds))return t?this.extend(o.latLng(t)||o.latLngBounds(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||s?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),s.lat=Math.max(i.lat,s.lat),s.lng=Math.max(i.lng,s.lng)):(this._southWest=new o.LatLng(e.lat,e.lng),this._northEast=new o.LatLng(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-s),new o.LatLng(i.lat+n,i.lng+s))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=s.lat&&e.lng>=n.lng&&i.lng<=s.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>=e.lat&&n.lat<=i.lat,a=s.lng>=e.lng&&n.lng<=i.lng;return r&&a},overlaps:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>e.lat&&n.lat<i.lat,a=s.lng>e.lng&&n.lng<i.lng;return r&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return!!t&&(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)},bounds:o.bounds([-180,-90],[180,90])},o.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=Math.sin(n*e);return new o.Point(this.R*t.lng*e,this.R*Math.log((1+s)/(1-s))/2)},unproject:function(t){var e=180/Math.PI;return new o.LatLng((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return o.bounds([-t,-t],[t,t])}()},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),n=this.transformation.transform(e.min,i),s=this.transformation.transform(e.max,i);return o.bounds(n,s)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?o.Util.wrapNum(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?o.Util.wrapNum(t.lat,this.wrapLat,!0):t.lat,n=t.alt;return o.latLng(i,e,n)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0}),o.CRS.Earth=o.extend({},o.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,o=e.lat*i,s=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((e.lng-t.lng)*i);return this.R*Math.acos(Math.min(s,1))}}),o.CRS.EPSG3857=o.extend({},o.CRS.Earth,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:function(){var t=.5/(Math.PI*o.Projection.SphericalMercator.R);return new o.Transformation(t,.5,-t,.5)}()}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS.Earth,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/180,1,-1/180,.5)}),o.Map=o.Evented.extend({options:{crs:o.CRS.EPSG3857,center:i,zoom:i,minZoom:i,maxZoom:i,layers:[],maxBounds:i,renderer:i,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==i&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==i&&this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._addLayers(this.options.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(o.latLng(t),e),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(o.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(o.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),r=t instanceof o.Point?t:this.latLngToContainerPoint(t),a=r.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(a));return this.setView(h,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n));s="number"==typeof e.maxZoom?Math.min(e.maxZoom,s):s;var r=n.subtract(i).divideBy(2),a=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),l=this.unproject(a.add(h).divideBy(2).add(r),s);return{center:l,zoom:s}},fitBounds:function(t,e){if(t=o.latLngBounds(t),!t.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(o.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=o.latLngBounds(t),t.isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){return this.options.minZoom=t,this._loaded&&this.getZoom()<this.options.minZoom?this.setZoom(t):this},setMaxZoom:function(t){return this.options.maxZoom=t,this._loaded&&this.getZoom()>this.options.maxZoom?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,o.latLngBounds(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),r=n.subtract(s);return r.x||r.y?(t.animate&&t.pan?this.panBy(r):(t.pan&&this._rawPanBy(r),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=i,this._containerId=i}o.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload");for(var t in this._layers)this._layers[t].remove();return this},createPane:function(t,e){var i="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),n=o.DomUtil.create("div",i,e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t),i=o.point(i||[0,0]);var n=this.getZoom()||0,s=this.getMinZoom(),r=this.getMaxZoom(),a=t.getNorthWest(),h=t.getSouthEast(),l=this.getSize().subtract(i),u=this.project(h,n).subtract(this.project(a,n)),c=o.Browser.any3d?this.options.zoomSnap:1,d=Math.min(l.x/u.x,l.y/u.y);return n=this.getScaleZoom(d,n),c&&(n=Math.round(n/(c/100))*(c/100),n=e?Math.ceil(n/c)*c:Math.floor(n/c)*c),Math.max(s,Math.min(r,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new o.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new o.Bounds(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===i?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=e===i?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=e===i?this._zoom:e;var o=n.zoom(t*n.scale(e));return isNaN(o)?1/0:o},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(o.latLng(t))},distance:function(t,e){return this.options.crs.distance(o.latLng(t),o.latLng(e))},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");o.DomEvent.addListener(e,"scroll",this._onScroll,this),this._containerId=o.Util.stamp(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&o.Browser.any3d,o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(o.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,"leaflet-zoom-hide"),o.DomUtil.addClass(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){o.DomUtil.setPosition(this._mapPane,new o.Point(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t){return t&&this.fire("zoomstart"),this.fire("movestart")},_move:function(t,e,n){e===i&&(e=this._zoom);var o=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(o||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return o.Util.cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){this._targets={},this._targets[o.stamp(this._container)]=this;var i=e?"off":"on";o.DomEvent[i](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&o.DomEvent[i](t,"resize",this._onResize,this),o.Browser.any3d&&this.options.transform3DLimit&&this[i]("moveend",this._onMoveEnd)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],s="mouseout"===e||"mouseover"===e,r=t.target||t.srcElement,a=!1;r;){if(i=this._targets[o.stamp(r)],i&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(s&&!o.DomEvent._isExternalTarget(r,t))break;if(n.push(i),s)break}if(r===this._container)break;r=r.parentNode}return n.length||a||s||!o.DomEvent._isExternalTarget(r,t)||(n=[this]),n},_handleDOMEvent:function(t){if(this._loaded&&!o.DomEvent._skipped(t)){var e="keypress"===t.type&&13===t.keyCode?"click":t.type;"mousedown"===e&&o.DomUtil.preventOutline(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_fireDOMEvent:function(t,e,i){if("click"===t.type){var n=o.Util.extend({},t);n.type="preclick",this._fireDOMEvent(n,n.type,i)}if(!t._stopped&&(i=(i||[]).concat(this._findEventTargets(t,e)),i.length)){var s=i[0];"contextmenu"===e&&s.listens(e,!0)&&o.DomEvent.preventDefault(t);var r={originalEvent:t};if("keypress"!==t.type){var a=s instanceof o.Marker;r.containerPoint=a?this.latLngToContainerPoint(s.getLatLng()):this.mouseEventToContainerPoint(t),r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlng=a?s.getLatLng():this.layerPointToLatLng(r.layerPoint);
+}for(var h=0;h<i.length;h++)if(i[h].fire(e,r,!0),r.originalEvent._stopped||i[h].options.nonBubblingEvents&&o.Util.indexOf(i[h].options.nonBubblingEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)||new o.Point(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var n=t&&e!==i?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return n.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),r=new o.Bounds(n.subtract(s),n.add(s)),a=this._getBoundsOffset(r,i,e);return a.round().equals([0,0])?t:this.unproject(n.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=o.bounds(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),s=n.min.subtract(t.min),r=n.max.subtract(t.max),a=this._rebound(s.x,-r.x),h=this._rebound(s.y,-r.y);return new o.Point(a,h)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=o.Browser.any3d?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))}}),o.map=function(t,e){return new o.Map(t,e)},o.Layer=o.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[]},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[o.stamp(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[o.stamp(t)],this},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}}),o.Map.include({addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&o.stamp(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[o.stamp(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=o.stamp(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-(1/0),n=this._getZoomSpan();for(var o in this._zoomBoundLayers){var s=this._zoomBoundLayers[o].options;t=s.minZoom===i?t:Math.min(t,s.minZoom),e=s.maxZoom===i?e:Math.max(e,s.maxZoom)}this._layersMaxZoom=e===-(1/0)?i:e,this._layersMinZoom=t===1/0?i:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange")}}),o.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:o.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,s=this.R_MINOR/i,r=Math.sqrt(1-s*s),a=r*Math.sin(n),h=Math.tan(Math.PI/4-n/2)/Math.pow((1-a)/(1+a),r/2);return n=-i*Math.log(Math.max(h,1e-10)),new o.Point(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,s=this.R_MINOR/n,r=Math.sqrt(1-s*s),a=Math.exp(-t.y/n),h=Math.PI/2-2*Math.atan(a),l=0,u=.1;l<15&&Math.abs(u)>1e-7;l++)e=r*Math.sin(h),e=Math.pow((1-e)/(1+e),r/2),u=Math.PI/2-2*Math.atan(a*e)-h,h+=u;return new o.LatLng(h*i,t.x*i/n)}},o.CRS.EPSG3395=o.extend({},o.CRS.Earth,{code:"EPSG:3395",projection:o.Projection.Mercator,transformation:function(){var t=.5/(Math.PI*o.Projection.Mercator.R);return new o.Transformation(t,.5,-t,.5)}()}),o.GridLayer=o.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:o.Browser.mobile,updateWhenZooming:!0,updateInterval:200,attribution:null,zIndex:1,bounds:null,minZoom:0,maxZoom:i,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){o.setOptions(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),o.DomUtil.remove(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=null},bringToFront:function(){return this._map&&(o.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(o.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=o.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return e.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof o.Point?t:new o.Point(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-(1/0),1/0),o=0,s=i.length;o<s;o++)e=i[o].style.zIndex,i[o]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!o.Browser.ielt9){o.DomUtil.setOpacity(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var s=this._tiles[n];if(s.current&&s.loaded){var r=Math.min(1,(t-s.loaded)/200);o.DomUtil.setOpacity(s.el,r),r<1?e=!0:(s.active&&(i=!0),s.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(o.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=o.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=o.DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t===i)return i;for(var n in this._levels)this._levels[n].el.children.length||n===t?this._levels[n].el.style.zIndex=e-Math.abs(t-n):(o.DomUtil.remove(this._levels[n].el),this._removeTilesAtZoom(n),delete this._levels[n]);var s=this._levels[t],r=this._map;return s||(s=this._levels[t]={},s.el=o.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),s.el.style.zIndex=e,s.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),s.zoom=t,this._setZoomTransform(s,r.getCenter(),r.getZoom()),o.Util.falseFn(s.el.offsetWidth)),this._level=s,s},_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)return void this._removeAllTiles();for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)o.DomUtil.remove(this._levels[t].el),delete this._levels[t];this._removeAllTiles(),this._tileZoom=null},_retainParent:function(t,e,i,n){var s=Math.floor(t/2),r=Math.floor(e/2),a=i-1,h=new o.Point(+s,+r);h.z=+a;var l=this._tileCoordsToKey(h),u=this._tiles[l];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),a>n&&this._retainParent(s,r,a,n))},_retainChildren:function(t,e,i,n){for(var s=2*t;s<2*t+2;s++)for(var r=2*e;r<2*e+2;r++){var a=new o.Point(s,r);a.z=i+1;var h=this._tileCoordsToKey(a),l=this._tiles[h];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<n&&this._retainChildren(s,r,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_setView:function(t,e,n,o){var s=Math.round(e);(this.options.maxZoom!==i&&s>this.options.maxZoom||this.options.minZoom!==i&&s<this.options.minZoom)&&(s=i);var r=this.options.updateWhenZooming&&s!==this._tileZoom;o&&!r||(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),s!==i&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),s=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();o.Browser.any3d?o.DomUtil.setTransform(t.el,s,n):o.DomUtil.setPosition(t.el,s)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&&(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),s=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*n);return new o.Bounds(s.subtract(r),s.add(r))},_update:function(t){var n=this._map;if(n){var s=n.getZoom();if(t===i&&(t=n.getCenter()),this._tileZoom!==i){var r=this._getTiledPixelBounds(t),a=this._pxBoundsToTileRange(r),h=a.getCenter(),l=[],u=this.options.keepBuffer,c=new o.Bounds(a.getBottomLeft().subtract([u,-u]),a.getTopRight().add([u,-u]));for(var d in this._tiles){var _=this._tiles[d].coords;_.z===this._tileZoom&&c.contains(o.point(_.x,_.y))||(this._tiles[d].current=!1)}if(Math.abs(s-this._tileZoom)>1)return void this._setView(t,s);for(var m=a.min.y;m<=a.max.y;m++)for(var p=a.min.x;p<=a.max.x;p++){var f=new o.Point(p,m);if(f.z=this._tileZoom,this._isValidTile(f)){var g=this._tiles[this._tileCoordsToKey(f)];g?g.current=!0:l.push(f)}}if(l.sort(function(t,e){return t.distanceTo(h)-e.distanceTo(h)}),0!==l.length){this._loading||(this._loading=!0,this.fire("loading"));var v=e.createDocumentFragment();for(p=0;p<l.length;p++)this._addTile(l[p],v);this._level.el.appendChild(v)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return o.latLngBounds(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToBounds:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),s=n.add(i),r=e.unproject(n,t.z),a=e.unproject(s,t.z);return this.options.noWrap||(r=e.wrapLatLng(r),a=e.wrapLatLng(a)),new o.LatLngBounds(r,a)},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new o.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(o.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){o.DomUtil.addClass(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity<1&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.android&&!o.Browser.android23&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),o.bind(this._tileReady,this,t));this._initTile(s),this.createTile.length<2&&o.Util.requestAnimFrame(o.bind(this._tileReady,this,t,null,s)),o.DomUtil.setPosition(s,i),this._tiles[n]={el:s,coords:t,current:!0},e.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,e,i){if(this._map){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);i=this._tiles[n],i&&(i.loaded=+new Date,this._map._fadeAnimated?(o.DomUtil.setOpacity(i.el,0),o.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=o.Util.requestAnimFrame(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(o.DomUtil.addClass(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),o.Browser.ielt9||!this._map._fadeAnimated?o.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(o.bind(this._pruneTiles,this),250)))}},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new o.Point(this._wrapX?o.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?o.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new o.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),o.gridLayer=function(t){return new o.GridLayer(t)},o.TileLayer=o.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,e=o.setOptions(this,e),e.detectRetina&&o.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),o.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},createTile:function(t,i){var n=e.createElement("img");return o.DomEvent.on(n,"load",o.bind(this._tileOnLoad,this,i,n)),o.DomEvent.on(n,"error",o.bind(this._tileOnError,this,i,n)),this.options.crossOrigin&&(n.crossOrigin=""),n.alt="",n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:o.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}return o.Util.template(this._url,o.extend(e,this.options))},_tileOnLoad:function(t,e){o.Browser.ielt9?setTimeout(o.bind(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&(e.src=n),t(i,e)},getTileSize:function(){var t=this._map,e=o.GridLayer.prototype.getTileSize.call(this),i=this._tileZoom+this.options.zoomOffset,n=this.options.maxNativeZoom;return null!==n&&i>n?e.divideBy(t.getZoomScale(n,i)).round():e},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this.options,e=this._tileZoom;return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,null!==t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=o.Util.falseFn,e.onerror=o.Util.falseFn,e.complete||(e.src=o.Util.emptyImageUrl,o.DomUtil.remove(e)))}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams);for(var n in e)n in this.options||(i[n]=e[n]);e=o.setOptions(this,e),i.width=i.height=e.tileSize*(e.detectRetina&&o.Browser.retina?2:1),this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToBounds(t),i=this._crs.project(e.getNorthWest()),n=this._crs.project(e.getSouthEast()),s=(this._wmsVersion>=1.3&&this._crs===o.CRS.EPSG4326?[n.y,i.x,i.y,n.x]:[i.x,n.y,n.x,i.y]).join(","),r=o.TileLayer.prototype.getTileUrl.call(this,t);return r+o.Util.getParamString(this.wmsParams,r,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.ImageOverlay=o.Layer.extend({options:{opacity:1,alt:"",interactive:!1,attribution:null,crossOrigin:!1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(o.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){o.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&o.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&o.DomUtil.toBack(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=t,this._map&&this._reset(),this},getAttribution:function(){return this.options.attribution},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._image=o.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,t.onload=o.bind(this.fire,this,"load"),this.options.crossOrigin&&(t.crossOrigin=""),t.src=this._url,t.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngToNewLayerPoint(this._bounds.getNorthWest(),t.zoom,t.center);o.DomUtil.setTransform(this._image,i,e)},_reset:function(){var t=this._image,e=new o.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();o.DomUtil.setPosition(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&&(n=[n,n]);var s=o.point(n),r=o.point("shadow"===e&&i.shadowAnchor||i.iconAnchor||s&&s.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return o.Icon.Default.imagePath||(o.Icon.Default.imagePath=this._detectIconPath()),(this.options.imagePath||o.Icon.Default.imagePath)+o.Icon.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=o.DomUtil.create("div","leaflet-default-icon-path",e.body),i=o.DomUtil.getStyle(t,"background-image")||o.DomUtil.getStyle(t,"backgroundImage");return e.body.removeChild(t),0===i.indexOf("url")?i.replace(/^url\([\"\']?/,"").replace(/marker-icon\.png[\"\']?\)$/,""):""}}),o.Marker=o.Layer.extend({options:{icon:new o.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=o.latLng(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),t.alt&&(i.alt=t.alt)),o.DomUtil.addClass(i,e),t.keyboard&&(i.tabIndex="0"),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var s=t.icon.createShadow(this._shadow),r=!1;s!==this._shadow&&(this._removeShadow(),r=!0),s&&o.DomUtil.addClass(s,e),this._shadow=s,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),s&&r&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),o.DomUtil.remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&o.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(o.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),o.Handler.MarkerDrag)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new o.Handler.MarkerDrag(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;o.DomUtil.setOpacity(this._icon,t),this._shadow&&o.DomUtil.setOpacity(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;if(i.innerHTML=n.html!==!1?n.html:"",n.bgPos){var s=o.point(n.bgPos);i.style.backgroundPosition=-s.x+"px "+-s.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.DivOverlay=o.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){o.setOptions(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&o.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&o.DomUtil.setOpacity(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(o.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(o.bind(o.DomUtil.remove,o.DomUtil,this._container),200)):o.DomUtil.remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&o.DomUtil.toFront(this._container),this},bringToBack:function(){return this._map&&o.DomUtil.toBack(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=o.point(this.options.offset),i=this._getAnchor();this._zoomAnimated?o.DomUtil.setPosition(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=s+"px"}},_getAnchor:function(){return[0,0]}}),o.Popup=o.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){o.DivOverlay.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof o.Path||this._source.on("preclick",o.DomEvent.stopPropagation))},onRemove:function(t){o.DivOverlay.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof o.Path||this._source.off("preclick",o.DomEvent.stopPropagation))},getEvents:function(){var t=o.DivOverlay.prototype.getEvents.call(this);return("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=o.DomUtil.create("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var i=this._closeButton=o.DomUtil.create("a",t+"-close-button",e);i.href="#close",i.innerHTML="&#215;",o.DomEvent.on(i,"click",this._onCloseButtonClick,this)}var n=this._wrapper=o.DomUtil.create("div",t+"-content-wrapper",e);this._contentNode=o.DomUtil.create("div",t+"-content",n),o.DomEvent.disableClickPropagation(n).disableScrollPropagation(this._contentNode).on(n,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",t+"-tip-container",e),this._tip=o.DomUtil.create("div",t+"-tip",this._tipContainer)},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,r="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",o.DomUtil.addClass(t,r)):o.DomUtil.removeClass(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();o.DomUtil.setPosition(this._container,e.add(i))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var t=this._map,e=parseInt(o.DomUtil.getStyle(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,s=new o.Point(this._containerLeft,-i-this._containerBottom);s._add(o.DomUtil.getPosition(this._container));var r=t.layerPointToContainerPoint(s),a=o.point(this.options.autoPanPadding),h=o.point(this.options.autoPanPaddingTopLeft||a),l=o.point(this.options.autoPanPaddingBottomRight||a),u=t.getSize(),c=0,d=0;
+r.x+n+l.x>u.x&&(c=r.x+n-u.x+l.x),r.x-c-h.x<0&&(c=r.x-h.x),r.y+i+l.y>u.y&&(d=r.y+i-u.y+l.y),r.y-d-h.y<0&&(d=r.y-h.y),(c||d)&&t.fire("autopanstart").panBy([c,d])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)},_getAnchor:function(){return o.point(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Map.include({openPopup:function(t,e,i){return t instanceof o.Popup||(t=new o.Popup(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),o.Layer.include({bindPopup:function(t,e){return t instanceof o.Popup?(o.setOptions(t,e),this._popup=t,t._source=this):(this._popup&&!e||(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof o.Layer||(e=t,t=this),t instanceof o.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;if(this._popup&&this._map)return o.DomEvent.stop(t),e instanceof o.Path?void this.openPopup(t.layer||t.target,t.latlng):void(this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.Marker.include({_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]}}),o.Tooltip=o.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){o.DivOverlay.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){o.DivOverlay.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=o.DivOverlay.prototype.getEvents.call(this);return o.Browser.touch&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=o.DomUtil.create("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),s=e.layerPointToContainerPoint(t),r=this.options.direction,a=i.offsetWidth,h=i.offsetHeight,l=o.point(this.options.offset),u=this._getAnchor();"top"===r?t=t.add(o.point(-a/2+l.x,-h+l.y+u.y)):"bottom"===r?t=t.subtract(o.point(a/2-l.x,-l.y)):"center"===r?t=t.subtract(o.point(a/2+l.x,h/2-u.y+l.y)):"right"===r||"auto"===r&&s.x<n.x?(r="right",t=t.add([l.x+u.x,u.y-h/2+l.y])):(r="left",t=t.subtract(o.point(a+u.x-l.x,h/2-u.y-l.y))),o.DomUtil.removeClass(i,"leaflet-tooltip-right"),o.DomUtil.removeClass(i,"leaflet-tooltip-left"),o.DomUtil.removeClass(i,"leaflet-tooltip-top"),o.DomUtil.removeClass(i,"leaflet-tooltip-bottom"),o.DomUtil.addClass(i,"leaflet-tooltip-"+r),o.DomUtil.setPosition(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&o.DomUtil.setOpacity(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return o.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),o.tooltip=function(t,e){return new o.Tooltip(t,e)},o.Map.include({openTooltip:function(t,e,i){return t instanceof o.Tooltip||(t=new o.Tooltip(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),o.Layer.include({bindTooltip:function(t,e){return t instanceof o.Tooltip?(o.setOptions(t,e),this._tooltip=t,t._source=this):(this._tooltip&&!e||(this._tooltip=o.tooltip(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),o.Browser.touch&&(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){if(t instanceof o.Layer||(e=t,t=this),t instanceof o.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(o.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(o.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:i)},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}}),o.Marker.include({_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}}),o.LayerGroup=o.Layer.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;e<i;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){for(var e in this._layers)t.addLayer(this._layers[e])},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e])},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),o.LayerGroup.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),o.LayerGroup.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Renderer=o.Layer.extend({options:{padding:.1},initialize:function(t){o.setOptions(this,t),o.stamp(this)},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&o.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update()},onRemove:function(){o.DomUtil.remove(this._container)},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=o.DomUtil.getPosition(this._container),s=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),a=this._map.project(t,e),h=a.subtract(r),l=s.multiplyBy(-i).add(n).add(s).subtract(h);o.Browser.any3d?o.DomUtil.setTransform(this._container,l,i):o.DomUtil.setPosition(this._container,l)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom)},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new o.Bounds(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),o.Map.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this.options.preferCanvas&&o.canvas()||o.svg()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||t===i)return!1;var e=this._paneRenderers[t];return e===i&&(e=o.SVG&&o.svg({pane:t})||o.Canvas&&o.canvas({pane:t}),this._paneRenderers[t]=e),e}}),o.Path=o.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this),this._renderer.on("update",this._update,this)},onRemove:function(){this._renderer._removePath(this),this._renderer.off("update",this._update,this)},getEvents:function(){return{zoomend:this._project,viewreset:this._reset}},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return o.setOptions(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(o.Browser.touch?10:0)}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var r,a=[];for(r=0;r<n;r++)s[r]&&a.push(t[r]);return a},_simplifyDPStep:function(t,e,i,n,o){var s,r,a,h=0;for(r=n+1;r<=o-1;r++)a=this._sqClosestPointOnSegment(t[r],t[n],t[o],!0),a>h&&(s=r,h=a);h>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;n<s;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return o<s-1&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n,o){var s,r,a,h=n?this._lastCode:this._getBitCode(t,i),l=this._getBitCode(e,i);for(this._lastCode=l;;){if(!(h|l))return[t,e];if(h&l)return!1;s=h||l,r=this._getEdgeIntersection(t,e,s,i,o),a=this._getBitCode(r,i),s===h?(t=r,h=a):(e=r,l=a)}},_getEdgeIntersection:function(t,e,i,n,s){var r,a,h=e.x-t.x,l=e.y-t.y,u=n.min,c=n.max;return 8&i?(r=t.x+h*(c.y-t.y)/l,a=c.y):4&i?(r=t.x+h*(u.y-t.y)/l,a=u.y):2&i?(r=c.x,a=t.y+l*(c.x-t.x)/h):1&i&&(r=u.x,a=t.y+l*(u.x-t.x)/h),new o.Point(r,a,s)},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var s,r=e.x,a=e.y,h=i.x-r,l=i.y-a,u=h*h+l*l;return u>0&&(s=((t.x-r)*h+(t.y-a)*l)/u,s>1?(r=i.x,a=i.y):s>0&&(r+=h*s,a+=l*s)),h=t.x-r,l=t.y-a,n?h*h+l*l:new o.Point(r,a)}},o.Polyline=o.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){o.setOptions(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,s=null,r=o.LineUtil._sqClosestPointOnSegment,a=0,h=this._parts.length;a<h;a++)for(var l=this._parts[a],u=1,c=l.length;u<c;u++){e=l[u-1],i=l[u];var d=r(t,e,i,!0);d<n&&(n=d,s=r(t,e,i))}return s&&(s.distance=Math.sqrt(n)),s},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,r,a=this._rings[0],h=a.length;if(!h)return null;for(t=0,e=0;t<h-1;t++)e+=a[t].distanceTo(a[t+1])/2;if(0===e)return this._map.layerPointToLatLng(a[0]);for(t=0,n=0;t<h-1;t++)if(o=a[t],s=a[t+1],i=o.distanceTo(s),n+=i,n>e)return r=(n-e)/i,this._map.layerPointToLatLng([s.x-r*(s.x-o.x),s.y-r*(s.y-o.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=o.latLng(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new o.LatLngBounds,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return o.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=o.Polyline._flat(t),n=0,s=t.length;n<s;n++)i?(e[n]=o.latLng(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new o.Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),i=new o.Point(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(i),t.max._add(i),this._pxBounds=t)},_projectLatlngs:function(t,e,i){var n,s,r=t[0]instanceof o.LatLng,a=t.length;if(r){for(s=[],n=0;n<a;n++)s[n]=this._map.latLngToLayerPoint(t[n]),i.extend(s[n]);e.push(s)}else for(n=0;n<a;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,i,n,s,r,a,h,l=this._parts;for(e=0,n=0,s=this._rings.length;e<s;e++)for(h=this._rings[e],i=0,r=h.length;i<r-1;i++)a=o.LineUtil.clipSegment(h[i],h[i+1],t,i,!0),a&&(l[n]=l[n]||[],l[n].push(a[0]),a[1]===h[i+1]&&i!==r-2||(l[n].push(a[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=o.LineUtil.simplify(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.Polyline._flat=function(t){return!o.Util.isArray(t[0])||"object"!=typeof t[0][0]&&"undefined"!=typeof t[0][0]},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e,i){var n,s,r,a,h,l,u,c,d,_=[1,4,2,8],m=o.LineUtil;for(s=0,u=t.length;s<u;s++)t[s]._code=m._getBitCode(t[s],e);for(a=0;a<4;a++){for(c=_[a],n=[],s=0,u=t.length,r=u-1;s<u;r=s++)h=t[s],l=t[r],h._code&c?l._code&c||(d=m._getEdgeIntersection(l,h,c,e,i),d._code=m._getBitCode(d,e),n.push(d)):(l._code&c&&(d=m._getEdgeIntersection(l,h,c,e,i),d._code=m._getBitCode(d,e),n.push(d)),n.push(h));t=n}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,r,a,h,l=this._rings[0],u=l.length;if(!u)return null;for(s=r=a=0,t=0,e=u-1;t<u;e=t++)i=l[t],n=l[e],o=i.y*n.x-n.y*i.x,r+=(i.x+n.x)*o,a+=(i.y+n.y)*o,s+=3*o;return h=0===s?l[0]:[r/s,a/s],this._map.layerPointToLatLng(h)},_convertLatLngs:function(t){var e=o.Polyline.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof o.LatLng&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){o.Polyline.prototype._setLatLngs.call(this,t),o.Polyline._flat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return o.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new o.Point(e,e);if(t=new o.Bounds(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);for(var n,s=0,r=this._rings.length;s<r;s++)n=o.PolyUtil.clipPolygon(this._rings[s],t,!0),n.length&&this._parts.push(n)}},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),o.polygon=function(t,e){return new o.Polygon(t,e)},o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.CircleMarker=o.Path.extend({options:{fill:!0,radius:10},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return o.Path.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new o.Bounds(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Circle=o.CircleMarker.extend({initialize:function(t,e,i){if("number"==typeof e&&(e=o.extend({},i,{radius:e})),o.setOptions(this,e),this._latlng=o.latLng(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new o.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:o.Path.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===o.CRS.Earth.distance){var s=Math.PI/180,r=this._mRadius/o.CRS.Earth.R/s,a=i.project([e+r,t]),h=i.project([e-r,t]),l=a.add(h).divideBy(2),u=i.unproject(l).lat,c=Math.acos((Math.cos(r*s)-Math.sin(e*s)*Math.sin(u*s))/(Math.cos(e*s)*Math.cos(u*s)))/s;(isNaN(c)||0===c)&&(c=r/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(c)?0:Math.max(Math.round(l.x-i.project([u,t-c]).x),1),this._radiusY=Math.max(Math.round(l.y-a.y),1)}else{var d=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(d).x}this._updateBounds()}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.SVG=o.Renderer.extend({getEvents:function(){var t=o.Renderer.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=o.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=o.SVG.create("g"),this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){o.Renderer.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),o.DomUtil.setPosition(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=o.SVG.create("path");t.options.className&&o.DomUtil.addClass(e,t.options.className),t.options.interactive&&o.DomUtil.addClass(e,"leaflet-interactive"),this._updateStyle(t)},_addPath:function(t){this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){o.DomUtil.remove(t._path),t.removeInteractiveTarget(t._path)},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,o.SVG.pointsToPath(t._parts,e))},_updateCircle:function(t){var e=t._point,i=t._radius,n=t._radiusY||i,o="a"+i+","+n+" 0 1,0 ",s=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+o+2*i+",0 "+o+2*-i+",0 ";this._setPath(t,s)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){o.DomUtil.toFront(t._path)},_bringToBack:function(t){o.DomUtil.toBack(t._path)}}),o.extend(o.SVG,{create:function(t){return e.createElementNS("http://www.w3.org/2000/svg",t)},pointsToPath:function(t,e){var i,n,s,r,a,h,l="";for(i=0,s=t.length;i<s;i++){for(a=t[i],n=0,r=a.length;n<r;n++)h=a[n],l+=(n?"L":"M")+h.x+" "+h.y;l+=e?o.Browser.svg?"z":"x":""}return l||"M0 0"}}),o.Browser.svg=!(!e.createElementNS||!o.SVG.create("svg").createSVGRect),o.svg=function(t){return o.Browser.svg||o.Browser.vml?new o.SVG(t):null},o.Browser.vml=!o.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(t){return!1}}(),o.SVG.include(o.Browser.vml?{_initContainer:function(){this._container=o.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(o.Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=o.SVG.create("shape");o.DomUtil.addClass(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=o.SVG.create("path"),e.appendChild(t._path),this._updateStyle(t)},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;o.DomUtil.remove(e),t.removeInteractiveTarget(e)},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,s=t._container;s.stroked=!!n.stroke,s.filled=!!n.fill,n.stroke?(e||(e=t._stroke=o.SVG.create("stroke")),s.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=o.Util.isArray(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(s.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=o.SVG.create("fill")),s.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(s.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){o.DomUtil.toFront(t._container)},_bringToBack:function(t){o.DomUtil.toBack(t._container)}}:{}),o.Browser.vml&&(o.SVG.create=function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),o.Canvas=o.Renderer.extend({onAdd:function(){o.Renderer.prototype.onAdd.call(this),this._layers=this._layers||{},this._draw()},_initContainer:function(){var t=this._container=e.createElement("canvas");o.DomEvent.on(t,"mousemove",o.Util.throttle(this._onMouseMove,32,this),this).on(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},o.Renderer.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=o.Browser.retina?2:1;o.DomUtil.setPosition(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",o.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_initPath:function(t){this._updateDashArray(t),this._layers[o.stamp(t)]=t},_addPath:o.Util.falseFn,_removePath:function(t){t._removed=!0,this._requestRedraw(t)},_updatePath:function(t){this._redrawBounds=t._pxBounds,this._draw(!0),t._project(),t._update(),this._draw(),this._redrawBounds=null},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(t.options.dashArray){var e,i=t.options.dashArray.split(","),n=[];for(e=0;e<i.length;e++)n.push(Number(i[e]));t.options._dashArray=n}},_requestRedraw:function(t){if(this._map){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new o.Bounds,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e])),this._redrawRequest=this._redrawRequest||o.Util.requestAnimFrame(this._redraw,this)}},_redraw:function(){this._redrawRequest=null,this._draw(!0),this._draw(),this._redrawBounds=null},_draw:function(t){this._clear=t;var e,i=this._redrawBounds;this._ctx.save(),i&&(this._ctx.beginPath(),this._ctx.rect(i.min.x,i.min.y,i.max.x-i.min.x,i.max.y-i.min.y),this._ctx.clip());for(var n in this._layers)e=this._layers[n],(!i||e._pxBounds&&e._pxBounds.intersects(i))&&e._updatePath(),t&&e._removed&&(delete e._removed,delete this._layers[n]);this._ctx.restore()},_updatePoly:function(t,e){var i,n,o,s,r=t._parts,a=r.length,h=this._ctx;if(a){for(this._drawnLayers[t._leaflet_id]=t,h.beginPath(),h.setLineDash&&h.setLineDash(t.options&&t.options._dashArray||[]),i=0;i<a;i++){for(n=0,o=r[i].length;n<o;n++)s=r[i][n],h[n?"lineTo":"moveTo"](s.x,s.y);e&&h.closePath()}this._fillStroke(h,t)}},_updateCircle:function(t){if(!t._empty()){var e=t._point,i=this._ctx,n=t._radius,o=(t._radiusY||n)/n;this._drawnLayers[t._leaflet_id]=t,1!==o&&(i.save(),i.scale(1,o)),i.beginPath(),i.arc(e.x,e.y/o,n,0,2*Math.PI,!1),1!==o&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=this._clear,n=e.options;t.globalCompositeOperation=i?"destination-out":"source-over",n.fill&&(t.globalAlpha=i?1:n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.globalAlpha=i?1:n.opacity,e._prevWeight=t.lineWidth=i?e._prevWeight+1:n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){var e,i=this._map.mouseEventToLayerPoint(t),n=[];for(var s in this._layers)e=this._layers[s],e.options.interactive&&e._containsPoint(i)&&!this._map._draggableMoved(e)&&(o.DomEvent._fakeStop(t),n.push(e));n.length&&this._fireEvent(n,t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseOut(t,e),this._handleMouseHover(t,e)}},_handleMouseOut:function(t,e){var i=this._hoveredLayer;!i||"mouseout"!==t.type&&i._containsPoint(e)||(o.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([i],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){var i,n;for(i in this._drawnLayers)n=this._drawnLayers[i],n.options.interactive&&n._containsPoint(e)&&(o.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n);this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:o.Util.falseFn,_bringToBack:o.Util.falseFn}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.canvas=function(t){return o.Browser.canvas?new o.Canvas(t):null},o.Polyline.prototype._containsPoint=function(t,e){var i,n,s,r,a,h,l=this._clickTolerance();if(!this._pxBounds.contains(t))return!1;for(i=0,r=this._parts.length;i<r;i++)for(h=this._parts[i],n=0,a=h.length,s=a-1;n<a;s=n++)if((e||0!==n)&&o.LineUtil.pointToSegmentDistance(t,h[s],h[n])<=l)return!0;return!1},o.Polygon.prototype._containsPoint=function(t){var e,i,n,s,r,a,h,l,u=!1;if(!this._pxBounds.contains(t))return!1;for(s=0,h=this._parts.length;s<h;s++)for(e=this._parts[s],r=0,l=e.length,a=l-1;r<l;a=r++)i=e[r],n=e[a],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u||o.Polyline.prototype._containsPoint.call(this,t,!0)},o.CircleMarker.prototype._containsPoint=function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()},o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,s=o.Util.isArray(t)?t:t.features;if(s){for(e=0,i=s.length;e<i;e++)n=s[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this;
+}var r=this.options;if(r.filter&&!r.filter(t))return this;var a=o.GeoJSON.geometryToLayer(t,r);return a?(a.feature=o.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),r.onEachFeature&&r.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return t.options=o.Util.extend({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e){var i,n,s,r,a="Feature"===t.type?t.geometry:t,h=a?a.coordinates:null,l=[],u=e&&e.pointToLayer,c=e&&e.coordsToLatLng||this.coordsToLatLng;if(!h&&!a)return null;switch(a.type){case"Point":return i=c(h),u?u(t,i):new o.Marker(i);case"MultiPoint":for(s=0,r=h.length;s<r;s++)i=c(h[s]),l.push(u?u(t,i):new o.Marker(i));return new o.FeatureGroup(l);case"LineString":case"MultiLineString":return n=this.coordsToLatLngs(h,"LineString"===a.type?0:1,c),new o.Polyline(n,e);case"Polygon":case"MultiPolygon":return n=this.coordsToLatLngs(h,"Polygon"===a.type?1:2,c),new o.Polygon(n,e);case"GeometryCollection":for(s=0,r=a.geometries.length;s<r;s++){var d=this.geometryToLayer({geometry:a.geometries[s],type:"Feature",properties:t.properties},e);d&&l.push(d)}return new o.FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){for(var n,o=[],s=0,r=t.length;s<r;s++)n=e?this.coordsToLatLngs(t[s],e-1,i):(i||this.coordsToLatLng)(t[s]),o.push(n);return o},latLngToCoords:function(t){return t.alt!==i?[t.lng,t.lat,t.alt]:[t.lng,t.lat]},latLngsToCoords:function(t,e,i){for(var n=[],s=0,r=t.length;s<r;s++)n.push(e?o.GeoJSON.latLngsToCoords(t[s],e-1,i):o.GeoJSON.latLngToCoords(t[s]));return!e&&i&&n.push(n[0]),n},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var r={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(r),o.Circle.include(r),o.CircleMarker.include(r),o.Polyline.prototype.toGeoJSON=function(){var t=!o.Polyline._flat(this._latlngs),e=o.GeoJSON.latLngsToCoords(this._latlngs,t?1:0);return o.GeoJSON.getFeature(this,{type:(t?"Multi":"")+"LineString",coordinates:e})},o.Polygon.prototype.toGeoJSON=function(){var t=!o.Polyline._flat(this._latlngs),e=t&&!o.Polyline._flat(this._latlngs[0]),i=o.GeoJSON.latLngsToCoords(this._latlngs,e?2:t?1:0,!0);return t||(i=[i]),o.GeoJSON.getFeature(this,{type:(e?"Multi":"")+"Polygon",coordinates:i})},o.LayerGroup.include({toMultiPoint:function(){var t=[];return this.eachLayer(function(e){t.push(e.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint();var e="GeometryCollection"===t,i=[];return this.eachLayer(function(t){if(t.toGeoJSON){var n=t.toGeoJSON();i.push(e?n.geometry:o.GeoJSON.asFeature(n))}}),e?o.GeoJSON.getFeature(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}}),o.geoJSON=function(t,e){return new o.GeoJSON(t,e)},o.geoJson=o.geoJSON;var a="_leaflet_events";o.DomEvent={on:function(t,e,i,n){if("object"==typeof e)for(var s in e)this._on(t,s,e[s],i);else{e=o.Util.splitWords(e);for(var r=0,a=e.length;r<a;r++)this._on(t,e[r],i,n)}return this},off:function(t,e,i,n){if("object"==typeof e)for(var s in e)this._off(t,s,e[s],i);else{e=o.Util.splitWords(e);for(var r=0,a=e.length;r<a;r++)this._off(t,e[r],i,n)}return this},_on:function(e,i,n,s){var r=i+o.stamp(n)+(s?"_"+o.stamp(s):"");if(e[a]&&e[a][r])return this;var h=function(i){return n.call(s||e,i||t.event)},l=h;return o.Browser.pointer&&0===i.indexOf("touch")?this.addPointerListener(e,i,h,r):o.Browser.touch&&"dblclick"===i&&this.addDoubleTapListener?this.addDoubleTapListener(e,h,r):"addEventListener"in e?"mousewheel"===i?e.addEventListener("onwheel"in e?"wheel":"mousewheel",h,!1):"mouseenter"===i||"mouseleave"===i?(h=function(i){i=i||t.event,o.DomEvent._isExternalTarget(e,i)&&l(i)},e.addEventListener("mouseenter"===i?"mouseover":"mouseout",h,!1)):("click"===i&&o.Browser.android&&(h=function(t){return o.DomEvent._filterClick(t,l)}),e.addEventListener(i,h,!1)):"attachEvent"in e&&e.attachEvent("on"+i,h),e[a]=e[a]||{},e[a][r]=h,this},_off:function(t,e,i,n){var s=e+o.stamp(i)+(n?"_"+o.stamp(n):""),r=t[a]&&t[a][s];return r?(o.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,s):o.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,s):"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",r,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,r,!1):"detachEvent"in t&&t.detachEvent("on"+e,r),t[a][s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){return o.DomEvent.on(t,"mousewheel",o.DomEvent.stopPropagation)},disableClickPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,o.Draggable.START.join(" "),e),o.DomEvent.on(t,{click:o.DomEvent._fakeStop,dblclick:e})},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},_wheelPxFactor:o.Browser.win&&o.Browser.chrome?2:o.Browser.gecko?t.devicePixelRatio:1,getWheelDelta:function(t){return o.Browser.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/o.DomEvent._wheelPxFactor:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_isExternalTarget:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&i-o.DomEvent._lastClick;return n&&n>100&&n<500||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,void e(t))}},o.DomEvent.addListener=o.DomEvent.on,o.DomEvent.removeListener=o.DomEvent.off,o.Draggable=o.Evented.extend({options:{clickTolerance:3},statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e,i){this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(o.DomEvent.on(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(o.DomEvent.off(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!o.DomUtil.hasClass(this._element,"leaflet-zoom-anim")&&!(o.Draggable._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches)&&this._enabled&&(o.Draggable._dragging=!0,this._preventOutline&&o.DomUtil.preventOutline(this._element),o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),!this._moving))){this.fire("down");var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(i){if(!i._simulated&&this._enabled){if(i.touches&&i.touches.length>1)return void(this._moved=!0);var n=i.touches&&1===i.touches.length?i.touches[0]:i,s=new o.Point(n.clientX,n.clientY),r=s.subtract(this._startPoint);(r.x||r.y)&&(Math.abs(r.x)+Math.abs(r.y)<this.options.clickTolerance||(o.DomEvent.preventDefault(i),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(r),o.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=i.target||i.srcElement,t.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),o.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(r),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._lastEvent=i,this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){if(!t._simulated&&this._enabled){o.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(o.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var i in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[i],this._onMove,this).off(e,o.Draggable.END[i],this._onUp,this);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,o.Draggable._dragging=!1}}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}o.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){o.DomUtil.removeClass(this._map._container,"leaflet-grab"),o.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var t=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=o.latLngBounds(this._map.options.maxBounds);this._offsetLimit=o.bounds(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),e-this._times[0]>50&&(this._positions.shift(),this._times.shift())}this._map.fire("move",t).fire("drag",t)},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,r=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,a=i.easeLinearity,h=s.multiplyBy(a/r),l=h.distanceTo([0,0]),u=Math.min(i.inertiaMaxSpeed,l),c=h.multiplyBy(u/l),d=u/(i.inertiaDeceleration*a),_=c.multiplyBy(-d/2).round();_.x||_.y?(_=e._limitOffset(_,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(_,{duration:d,easeLinearity:a,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,o=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(o):e.setZoomAround(t.containerPoint,o)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),n),o.DomEvent.stop(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),o=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,s=i?Math.ceil(o/i)*i:o,r=t._limitZoom(e+(this._delta>0?s:-s))-e;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,e,i){function n(t){var e;if(e=o.Browser.pointer?o.DomEvent._pointersCount:t.touches.length,!(e>1)){var i=Date.now(),n=i-(r||i);a=t.touches?t.touches[0]:t,h=n>0&&n<=l,r=i}}function s(){if(h&&!a.cancelBubble){if(o.Browser.pointer){var t,i,n={};for(i in a)t=a[i],n[i]=t&&t.bind?t.bind(a):t;a=n}a.type="dblclick",e(a),r=null}}var r,a,h=!1,l=250,u="_leaflet_",c=this._touchstart,d=this._touchend;return t[u+c+i]=n,t[u+d+i]=s,t[u+"dblclick"+i]=e,t.addEventListener(c,n,!1),t.addEventListener(d,s,!1),o.Browser.edge||t.addEventListener("dblclick",e,!1),this},removeDoubleTapListener:function(t,e){var i="_leaflet_",n=t[i+this._touchstart+e],s=t[i+this._touchend+e],r=t[i+"dblclick"+e];return t.removeEventListener(this._touchstart,n,!1),t.removeEventListener(this._touchend,s,!1),o.Browser.edge||t.removeEventListener("dblclick",r,!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(t,e,i,n){return"touchstart"===e?this._addPointerStart(t,i,n):"touchmove"===e?this._addPointerMove(t,i,n):"touchend"===e&&this._addPointerEnd(t,i,n),this},removePointerListener:function(t,e,i){var n=t["_leaflet_"+e+i];return"touchstart"===e?t.removeEventListener(this.POINTER_DOWN,n,!1):"touchmove"===e?t.removeEventListener(this.POINTER_MOVE,n,!1):"touchend"===e&&(t.removeEventListener(this.POINTER_UP,n,!1),t.removeEventListener(this.POINTER_CANCEL,n,!1)),this},_addPointerStart:function(t,i,n){var s=o.bind(function(t){if("mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(this.TAG_WHITE_LIST.indexOf(t.target.tagName)<0))return;o.DomEvent.preventDefault(t)}this._handlePointer(t,i)},this);if(t["_leaflet_touchstart"+n]=s,t.addEventListener(this.POINTER_DOWN,s,!1),!this._pointerDocListener){var r=o.bind(this._globalPointerUp,this);e.documentElement.addEventListener(this.POINTER_DOWN,o.bind(this._globalPointerDown,this),!0),e.documentElement.addEventListener(this.POINTER_MOVE,o.bind(this._globalPointerMove,this),!0),e.documentElement.addEventListener(this.POINTER_UP,r,!0),e.documentElement.addEventListener(this.POINTER_CANCEL,r,!0),this._pointerDocListener=!0}},_globalPointerDown:function(t){this._pointers[t.pointerId]=t,this._pointersCount++},_globalPointerMove:function(t){this._pointers[t.pointerId]&&(this._pointers[t.pointerId]=t)},_globalPointerUp:function(t){delete this._pointers[t.pointerId],this._pointersCount--},_handlePointer:function(t,e){t.touches=[];for(var i in this._pointers)t.touches.push(this._pointers[i]);t.changedTouches=[t],e(t)},_addPointerMove:function(t,e,i){var n=o.bind(function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&this._handlePointer(t,e)},this);t["_leaflet_touchmove"+i]=n,t.addEventListener(this.POINTER_MOVE,n,!1)},_addPointerEnd:function(t,e,i){var n=o.bind(function(t){this._handlePointer(t,e)},this);t["_leaflet_touchend"+i]=n,t.addEventListener(this.POINTER_UP,n,!1),t.addEventListener(this.POINTER_CANCEL,n,!1)}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&&!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomUtil.addClass(this._map._container,"leaflet-touch-zoom"),o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom"),o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToContainerPoint(t.touches[0]),s=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),"center"!==i.options.touchZoom&&(this._pinchStartLatLng=i.containerPointToLatLng(n.add(s)._divideBy(2))),this._startDist=n.distanceTo(s),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),s=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(s,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&s<1||this._zoom>e.getMaxZoom()&&s>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===s)return}else{var r=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===s&&0===r.x&&0===r.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(r),this._zoom)}this._moved||(e._moveStart(!0),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest);var a=o.bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=o.Util.requestAnimFrame(a,this,!0),o.DomEvent.preventDefault(t)}},_onTouchEnd:function(){return this._moved&&this._zooming?(this._zooming=!1,o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd),void(this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom)))):void(this._zooming=!1)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),this._simulateEvent("mousedown",i),o.DomEvent.on(e,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.removeClass(n,"leaflet-active"),this._simulateEvent("mouseup",i),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&&!o.Browser.pointer&&o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(t){return!(!t.shiftKey||1!==t.which&&1!==t.button)&&(this._resetState(),o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),void o.DomEvent.on(e,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=o.DomUtil.create("div","leaflet-zoom-box",this._container),o.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new o.Bounds(this._point,this._startPoint),i=e.getSize();o.DomUtil.setPosition(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(o.DomUtil.remove(this._box),o.DomUtil.removeClass(this._container,"leaflet-crosshair")),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){setTimeout(o.bind(this._resetState,this),0);var e=new o.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),o.DomEvent.on(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),o.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,s=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;e<i;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;e<i;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;e<i;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;e<i;e++)n[o.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;e<i;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;e<i;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys){if(n._panAnim&&n._panAnim._inProgress)return;e=this._panKeys[i],t.shiftKey&&(e=o.point(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds)}else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i)return;n.closePopup()}o.DomEvent.stop(t)}}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),o.DomUtil.addClass(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(t){var e=this._marker,i=e._shadow,n=o.DomUtil.getPosition(e._icon),s=e._map.layerPointToLatLng(n);i&&o.DomUtil.setPosition(i,n),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),i.indexOf("bottom")!==-1?n.insertBefore(e,n.firstChild):n.appendChild(e),this},remove:function(){return this._map?(o.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,s){var r=i+t+" "+i+s;e[t+s]=o.DomUtil.create("div",r,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){o.DomUtil.remove(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,s){var r=o.DomUtil.create("a",i,n);return r.innerHTML=t,r.href="#",r.title=e,o.DomEvent.on(r,"mousedown dblclick",o.DomEvent.stopPropagation).on(r,"click",o.DomEvent.stop).on(r,"click",s,this).on(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&o.DomUtil.addClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent&&o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());
+return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&&(new o.Control.Attribution).addTo(this)}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=o.DomUtil.create("div",e,i)),t.imperial&&(this._iScale=o.DomUtil.create("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,o=3.2808399*t;o>5280?(e=o/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(o),this._updateScale(this._iScale,n+" ft",n/o))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1},initialize:function(t,e,i){o.setOptions(this,i),this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(o.stamp(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(o.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=t+"px"):o.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return o.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),o.DomEvent.disableClickPropagation(e),o.Browser.touch||o.DomEvent.disableScrollPropagation(e);var i=this._form=o.DomUtil.create("form",t+"-list");if(this.options.collapsed){o.Browser.android||o.DomEvent.on(e,{mouseenter:this.expand,mouseleave:this.collapse},this);var n=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",o.Browser.touch?o.DomEvent.on(n,"click",o.DomEvent.stop).on(n,"click",this.expand,this):o.DomEvent.on(n,"focus",this.expand,this),o.DomEvent.on(i,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),this._map.on("click",this.collapse,this)}else this.expand();this._baseLayersList=o.DomUtil.create("div",t+"-base",i),this._separator=o.DomUtil.create("div",t+"-separator",i),this._overlaysList=o.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&o.stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;o.DomUtil.empty(this._baseLayersList),o.DomUtil.empty(this._overlaysList);var t,e,i,n,s=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,s+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&s>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(o.stamp(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/>",o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var r=e.createElement("span");r.innerHTML=" "+t.name;var a=e.createElement("div");n.appendChild(a),a.appendChild(i),a.appendChild(r);var h=t.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=[],s=[];this._handlingClick=!0;for(var r=n.length-1;r>=0;r--)t=n[r],e=this._getLayer(t.layerId).layer,i=this._map.hasLayer(e),t.checked&&!i?o.push(e):!t.checked&&i&&s.push(e);for(r=0;r<s.length;r++)this._map.removeLayer(s[r]);for(r=0;r<o.length;r++)this._map.addLayer(o[r]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,n=this._form.getElementsByTagName("input"),o=this._map.getZoom(),s=n.length-1;s>=0;s--)t=n[s],e=this._getLayer(t.layerId).layer,t.disabled=e.options.minZoom!==i&&o<e.options.minZoom||e.options.maxZoom!==i&&o>e.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)},o.PosAnimation=o.Evented.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),o.DomUtil.setPosition(this._el,i),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate,duration:n.duration},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return!((e&&e.animate)!==!0&&!this.getSize().contains(i))&&(this.panBy(i,e),!0)}}),o.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4});var h=o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.mobileOpera;h&&o.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),o.DomEvent.on(this._proxy,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this))}),o.Map.include(h?{_createAnimProxy:function(){var t=this._proxy=o.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var i=o.DomUtil.TRANSFORM,n=t.style[i];o.DomUtil.setTransform(t,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===t.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var e=this.getCenter(),i=this.getZoom();o.DomUtil.setTransform(t,this.project(e,i),this.getZoomScale(i,1))},this)},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/n);return!(i.animate!==!0&&!this.getSize().contains(s))&&(o.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,i,n){i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),setTimeout(o.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&&(o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),o.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}:{}),o.Map.include({flyTo:function(t,e,n){function s(t){var e=t?-1:1,i=t?v:g,n=v*v-g*g+e*L*L*y*y,o=2*i*L*y,s=n/o,r=Math.sqrt(s*s+1)-s,a=r<1e-9?-18:Math.log(r);return a}function r(t){return(Math.exp(t)-Math.exp(-t))/2}function a(t){return(Math.exp(t)+Math.exp(-t))/2}function h(t){return r(t)/a(t)}function l(t){return g*(a(x)/a(x+P*t))}function u(t){return g*(a(x)*h(x+P*t)-r(x))/L}function c(t){return 1-Math.pow(1-t,1.5)}function d(){var i=(Date.now()-b)/T,n=c(i)*w;i<=1?(this._flyToFrame=o.Util.requestAnimFrame(d,this),this._move(this.unproject(_.add(m.subtract(_).multiplyBy(u(n)/y)),f),this.getScaleZoom(g/l(n),f),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}if(n=n||{},n.animate===!1||!o.Browser.any3d)return this.setView(t,e,n);this._stop();var _=this.project(this.getCenter()),m=this.project(t),p=this.getSize(),f=this._zoom;t=o.latLng(t),e=e===i?f:e;var g=Math.max(p.x,p.y),v=g*this.getZoomScale(f,e),y=m.distanceTo(_)||1,P=1.42,L=P*P,x=s(0),b=Date.now(),w=(s(1)-x)/P,T=n.duration?1e3*n.duration:1e3*w*.8;return this._moveStart(!0),d.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)}}),o.Map.include({_defaultLocateOptions:{timeout:1e4,watch:!1},locate:function(t){if(t=this._locateOptions=o.extend({},this._defaultLocateOptions,t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),s=n.toBounds(t.coords.accuracy),r=this._locateOptions;if(r.setView){var a=this.getBoundsZoom(s);this.setView(n,r.maxZoom?Math.min(a,r.maxZoom):a)}var h={latlng:n,bounds:s,timestamp:t.timestamp};for(var l in t.coords)"number"==typeof t.coords[l]&&(h[l]=t.coords[l]);this.fire("locationfound",h)}})}(window,document);
+
+},{}],6:[function(require,module,exports){
 var formatTools=require("./tools/format.js"),GHInput=require("./graphhopper/GHInput.js"),GHRoute=require("./graphhopper/GHRoute.js"),mapLayer=require("./map.js"),dataToHtml=function(e,t){var o="";if(e.name)o+="<div class='nameseg'>"+formatTools.formatValue(e.name,t)+"</div>";else if(e.street){var a=e.street;e.housenumber&&(a=formatTools.insComma(a,e.housenumber)),o+="<div class='nameseg'>"+formatTools.formatValue(a,t)+"</div>"}var n="";return e.postcode&&(n=e.postcode),e.city&&(n=formatTools.insComma(n,e.city)),e.country&&(n=formatTools.insComma(n,e.country)),n&&(o+="<div class='cityseg'>"+formatTools.formatValue(n,t)+"</div>"),"highway"===e.osm_key,o+="place"===e.osm_key?"<span class='moreseg'>"+e.osm_value+"</span>":"<span class='moreseg'>"+e.osm_key+"</span>"},dataToText=function(e){var t="";return e.name?t=e.name:e.street&&(t=e.street,e.housenumber&&(t=formatTools.insComma(t,e.housenumber))),e.postcode&&(t=formatTools.insComma(t,e.postcode)),e.city&&t.indexOf(e.city)<0&&(t=formatTools.insComma(t,e.city)),e.country&&t.indexOf(e.country)<0&&(t=formatTools.insComma(t,e.country)),t},AutoComplete=function(e,t){this.host=e,this.key=t,this.dataType="json",this.api_params={locale:"en"}};AutoComplete.prototype.createPath=function(e){for(var t in this.api_params){var o=this.api_params[t];if(GHRoute.isArray(o))for(var a in o)e+="&"+encodeURIComponent(t)+"="+encodeURIComponent(o[a]);else e+="&"+encodeURIComponent(t)+"="+encodeURIComponent(o)}return e},AutoComplete.prototype.createGeocodeURL=function(e,t){var o=this.createPath(this.host+"/geocode?limit=6&type="+this.dataType+"&key="+this.key);if(t>=0&&t<e.route.size()){var a=e.route.getIndex(t);a.isResolved()&&(o+="&point="+a.lat+","+a.lng)}return o},AutoComplete.prototype.getAutoCompleteDiv=function(e){return $("#locationpoints > div.pointDiv").eq(e).find(".pointInput")},AutoComplete.prototype.hide=function(){$(':input[id$="_Input"]').autocomplete().hide()},AutoComplete.prototype.showListForIndex=function(e,t,o){var a=this.getAutoCompleteDiv(o),n=this.createGeocodeURL(e,o-1),r={containerClass:"autocomplete",timeout:1e3,deferRequestBy:5,minChars:2,maxHeight:510,noCache:!0,triggerSelectOnValidInput:!1,autoSelectFirst:!1,paramName:"q",dataType:e.dataType,onSearchStart:function(e){var t=new GHInput(e.q).lat;return void 0===t},serviceUrl:function(){return n},transformResult:function(e,t){if(e.suggestions=[],e.hits)for(var o=0;o<e.hits.length;o++){var a=e.hits[o];e.suggestions.push({value:dataToText(a),data:a})}return e},onSearchError:function(e,t,o,a,n){},formatResult:function(e,t){return dataToHtml(e.data,t)},onSelect:function(e){r.onPreSelect(e)},onPreSelect:function(n){var r=e.route.getIndex(o);a.autocomplete().disable();var s=n.data.point;r.setCoord(s.lat,s.lng),r.input=n.value,t(!0)||mapLayer.focus(r,15,o),a.autocomplete().enable()}};a.autocomplete(r)},AutoComplete.prototype.createStub=function(){return complete=new AutoComplete,complete.showListForIndex=function(){},complete.hide=function(){},complete},AutoComplete.prototype.setLocale=function(e){e&&(this.api_params.locale=e)},module.exports=AutoComplete;
 
-},{"./graphhopper/GHInput.js":9,"./graphhopper/GHRoute.js":11,"./map.js":21,"./tools/format.js":25}],6:[function(require,module,exports){
+},{"./graphhopper/GHInput.js":10,"./graphhopper/GHRoute.js":12,"./map.js":21,"./tools/format.js":25}],7:[function(require,module,exports){
 exports.options={environment:"development",routing:{host:"",api_key:""},geocoding:{host:"",api_key:""},thunderforest:{api_key:""}};
 
-},{}],7:[function(require,module,exports){
+},{}],8:[function(require,module,exports){
 var ghenv=require("./options.js").options,tfAddition="";ghenv.thunderforest.api_key&&(tfAddition="?apikey="+ghenv.thunderforest.api_key);var osmAttr='&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors',retinaTiles=L.Browser.retina,lyrk=L.tileLayer("https://tiles.lyrk.org/"+(retinaTiles?"lr":"ls")+"/{z}/{x}/{y}?apikey=6e8cfef737a140e2a58c8122aaa26077",{attribution:osmAttr+', <a href="https://geodienste.lyrk.de/">Lyrk</a>'}),omniscale=L.tileLayer.wms("https://maps.omniscale.net/v1/mapsgraph-bf48cc0b/tile",{layers:"osm",attribution:osmAttr+', &copy; <a href="http://maps.omniscale.com/">Omniscale</a>'}),openMapSurfer=L.tileLayer("http://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}",{attribution:osmAttr+', <a href="http://korona.geog.uni-heidelberg.de/contact.html">GIScience Heidelberg</a>'}),sorbianLang=L.tileLayer("http://map.dgpsonline.eu/osmsb/{z}/{x}/{y}.png",{attribution:osmAttr+', <a href="http://www.alberding.eu/">&copy; Alberding GmbH, CC-BY-SA</a>'}),thunderTransport=L.tileLayer("https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png"+tfAddition,{attribution:osmAttr+', <a href="http://www.thunderforest.com/transport/" target="_blank">Thunderforest Transport</a>'}),thunderCycle=L.tileLayer("https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png"+tfAddition,{attribution:osmAttr+', <a href="http://www.thunderforest.com/opencyclemap/" target="_blank">Thunderforest Cycle</a>'}),thunderOutdoors=L.tileLayer("https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png"+tfAddition,{attribution:osmAttr+', <a href="http://www.thunderforest.com/outdoors/" target="_blank">Thunderforest Outdoors</a>'}),wrk=L.tileLayer("http://{s}.wanderreitkarte.de/topo/{z}/{x}/{y}.png",{attribution:osmAttr+', <a href="http://wanderreitkarte.de" target="_blank">WanderReitKarte</a>',subdomains:["topo4","topo","topo2","topo3"]}),osm=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:osmAttr}),osmde=L.tileLayer("http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",{attribution:osmAttr}),mapLink='<a href="http://www.esri.com/">Esri</a>',wholink="i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",esriAerial=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"&copy; "+mapLink+", "+wholink,maxZoom:18}),availableTileLayers={Omniscale:omniscale,OpenStreetMap:osm,"Esri Aerial":esriAerial,"TF Transport":thunderTransport,"TF Cycle":thunderCycle,"TF Outdoors":thunderOutdoors,Lyrk:lyrk,WanderReitKarte:wrk,OpenMapSurfer:openMapSurfer,"Sorbian Language":sorbianLang,"OpenStreetMap.de":osmde};module.exports.activeLayerName="Omniscale",module.exports.defaultLayer=omniscale,module.exports.getAvailableTileLayers=function(){return availableTileLayers},module.exports.selectLayer=function(e){var t=availableTileLayers[e];return t||(t=module.exports.defaultLayer),t};
 
-},{"./options.js":6}],8:[function(require,module,exports){
+},{"./options.js":7}],9:[function(require,module,exports){
 var ensureOneCheckboxSelected=function(){$("#gpx_route").change(function(){$(this).is(":checked")?($("#gpx_track").prop("disabled",!1),$("#gpx_waypoints").prop("disabled",!1)):$("#gpx_track").is(":checked")?$("#gpx_waypoints").is(":checked")||$("#gpx_track").prop("disabled",!0):$("#gpx_waypoints").prop("disabled",!0)}),$("#gpx_track").change(function(){$(this).is(":checked")?($("#gpx_route").prop("disabled",!1),$("#gpx_waypoints").prop("disabled",!1)):$("#gpx_route").is(":checked")?$("#gpx_waypoints").is(":checked")||$("#gpx_route").prop("disabled",!0):$("#gpx_waypoints").prop("disabled",!0)}),$("#gpx_waypoints").change(function(){$(this).is(":checked")?($("#gpx_route").prop("disabled",!1),$("#gpx_track").prop("disabled",!1)):$("#gpx_route").is(":checked")?$("#gpx_track").is(":checked")||$("#gpx_route").prop("disabled",!0):$("#gpx_track").prop("disabled",!0)})};module.exports.addGpxExport=function(e){function p(p,o,i){return e.route.isResolved()&&window.open(e.createGPXURL(p,o,i)),!1}function o(){return p($("#gpx_route").is(":checked"),$("#gpx_track").is(":checked"),$("#gpx_waypoints").is(":checked")),i.dialog("close"),!1}var i;$(function(){i=$("#gpx_dialog").dialog({width:420,height:260,autoOpen:!1,resizable:!1,draggable:!1,buttons:{"Export GPX":o,Cancel:function(){$(this).dialog("close")}}}),ensureOneCheckboxSelected()}),$("#gpxExportButton a").click(function(e){e.preventDefault(),$("#gpx_dialog").dialog("open")})};
 
-},{}],9:[function(require,module,exports){
+},{}],10:[function(require,module,exports){
 function round(t,n){return void 0===n&&(n=1e6),Math.round(t*n)/n}var GHInput=function(t){this.set(t)};GHInput.isObject=function(t){var n=Object.prototype.toString.call(t);return"[object object]"===n.toLowerCase()},GHInput.isString=function(t){var n=Object.prototype.toString.call(t);return"[object string]"===n.toLowerCase()},GHInput.prototype.isResolved=function(){return!isNaN(this.lat)&&!isNaN(this.lng)},GHInput.prototype.setCoord=function(t,n){this.lat=round(t),this.lng=round(n),this.input=this.toString()},GHInput.prototype.setUnresolved=function(){this.lat=void 0,this.lng=void 0},GHInput.prototype.set=function(t){if(this.input=t,GHInput.isObject(t))this.setCoord(t.lat,t.lng);else if(GHInput.isString(t)){var n=t.indexOf(",");n>=0?(this.lat=round(parseFloat(t.substr(0,n))),this.lng=round(parseFloat(t.substr(n+1))),this.isResolved()?this.input=this.toString():this.setUnresolved()):this.setUnresolved()}},GHInput.prototype.toString=function(){if(void 0!==this.lat&&void 0!==this.lng)return this.lat+","+this.lng},module.exports=GHInput;
 
-},{}],10:[function(require,module,exports){
-var GHRoute=require("./GHRoute.js"),GHInput=require("./GHInput.js"),graphhopperTools=require("./tools.js");Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,o=function(){},s=function(){return i.apply(this instanceof o&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,s.prototype=new o,s});var GHRequest=function(t,e){this.host=t,this.key=e,this.route=new GHRoute(new GHInput,new GHInput),this.from=this.route.first(),this.to=this.route.last(),this.features={},this.do_zoom=!0,this.useMiles=!1,this.dataType="json",this.api_params={locale:"en",vehicle:"car",weighting:"fastest",elevation:!1},this.route.addListener("route.add",function(t){this.to=this.route.last()}.bind(this)),this.route.addListener("route.remove",function(t){this.from=this.route.first(),this.to=this.route.last()}.bind(this)),this.route.addListener("route.move",function(t){this.from=this.route.first(),this.to=this.route.last()}.bind(this)),this.route.addListener("route.reverse",function(t){this.from=this.route.first(),this.to=this.route.last()}.bind(this))};GHRequest.prototype.init=function(t){for(var e in t){var i=t[e];"false"===i?i=!1:"true"===i&&(i=!0),"point"!==e&&"mathRandom"!==e&&"do_zoom"!==e&&"layer"!==e&&"use_miles"!==e&&(this.api_params[e]=i)}"do_zoom"in t&&(this.do_zoom=t.do_zoom),"use_miles"in t&&(this.useMiles=t.use_miles),this.api_params.elevation=!1;var o=this.features[this.api_params.vehicle];if(o&&o.elevation&&("elevation"in t?this.api_params.elevation=t.elevation:this.api_params.elevation=!0),t.q){var s=t.q;t.point||(t.point=[]);var r=s.indexOf("from:"),a=s.indexOf("to:");if(r>=0&&a>=0)r<a?(t.point.push(s.substring(r+5,a).trim()),t.point.push(s.substring(a+3).trim())):(t.point.push(s.substring(a+3,r).trim()),t.point.push(s.substring(r+5).trim()));else for(var n=s.split("p:"),p=0;p<n.length;p++){var h=n[p].trim();0!==h.length&&t.point.push(h)}}},GHRequest.prototype.initVehicle=function(t){this.api_params.vehicle=t;var e=this.features[t];e&&e.elevation?this.api_params.elevation=!0:this.api_params.elevation=!1},GHRequest.prototype.hasElevation=function(){return this.api_params.elevation},GHRequest.prototype.getVehicle=function(){return this.api_params.vehicle},GHRequest.prototype.createGeocodeURL=function(t,e){var i=this.host;t&&(i=t);var o=this.createPath(i+"/geocode?limit=6&type="+this.dataType+"&key="+this.key);if(e>=0&&e<this.route.size()){var s=this.route.getIndex(e);s.isResolved()&&(o+="&point="+s.lat+","+s.lng)}return o},GHRequest.prototype.createURL=function(){return this.createPath(this.host+"/route?"+this.createPointParams(!1)+"&type="+this.dataType+"&key="+this.key)},GHRequest.prototype.createGPXURL=function(t,e,i){return this.createPath(this.host+"/route?"+this.createPointParams(!1)+"&type=gpx&key="+this.key+"&gpx.route="+t+"&gpx.track="+e+"&gpx.waypoints="+i)},GHRequest.prototype.createHistoryURL=function(){return this.createPath("?"+this.createPointParams(!0))+"&use_miles="+!!this.useMiles},GHRequest.prototype.createPointParams=function(t){var e,i,o,s="";for(i=0,o=this.route.size();i<o;i++)e=this.route.getIndex(i),i>0&&(s+="&"),s+=t?"point="+encodeURIComponent(e.input):"point="+encodeURIComponent(e.toString());return s},GHRequest.prototype.createPath=function(t){for(var e in this.api_params){var i=this.api_params[e];if(GHRoute.isArray(i))for(var o in i)t+="&"+encodeURIComponent(e)+"="+encodeURIComponent(i[o]);else t+="&"+encodeURIComponent(e)+"="+encodeURIComponent(i)}return t},GHRequest.prototype.doRequest=function(t,e){var i=this;$.ajax({timeout:3e4,url:t,success:function(t){if(t.paths)for(var o=0;o<t.paths.length;o++){var s=t.paths[o];if(s.points_encoded){var r=graphhopperTools.decodePath(s.points,i.hasElevation());s.points={type:"LineString",coordinates:r};var a=graphhopperTools.decodePath(s.snapped_waypoints,i.hasElevation());s.snapped_waypoints={type:"MultiPoint",coordinates:a}}}e(t)},error:function(i){var o,s="API did not respond! ";if(i&&i.responseText&&i.responseText.indexOf("{")>=0)o=JSON.parse(i.responseText);else if(i&&i.statusText&&"OK"!==i.statusText){s+=i.statusText;var r="Error for "+t;o={message:s,hints:[{message:s,details:r}]}}console.log(s+" "+JSON.stringify(i)),e(o)},type:"GET",dataType:this.dataType,crossDomain:!0})},GHRequest.prototype.getInfo=function(){var t=this.host+"/info?type="+this.dataType+"&key="+this.key;return $.ajax({url:t,timeout:3e3,type:"GET",dataType:this.dataType,crossDomain:!0})},GHRequest.prototype.setLocale=function(t){t&&(this.api_params.locale=t)},GHRequest.prototype.fetchTranslationMap=function(t){t||(t="");var e=this.host+"/i18n/"+t+"?type="+this.dataType+"&key="+this.key;return $.ajax({url:e,timeout:3e3,type:"GET",dataType:this.dataType,crossDomain:!0})},module.exports=GHRequest;
+},{}],11:[function(require,module,exports){
+var GHRoute=require("./GHRoute.js"),GHInput=require("./GHInput.js"),graphhopperTools=require("./tools.js");Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,o=function(){},s=function(){return i.apply(this instanceof o&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,s.prototype=new o,s});var GHRequest=function(t,e){this.host=t,this.route=new GHRoute(new GHInput,new GHInput),this.from=this.route.first(),this.to=this.route.last(),this.features={},this.do_zoom=!0,this.useMiles=!1,this.dataType="json",this.api_params={locale:"en",vehicle:"car",weighting:"fastest",elevation:!1,key:e},this.route.addListener("route.add",function(t){this.to=this.route.last()}.bind(this)),this.route.addListener("route.remove",function(t){this.from=this.route.first(),this.to=this.route.last()}.bind(this)),this.route.addListener("route.move",function(t){this.from=this.route.first(),this.to=this.route.last()}.bind(this)),this.route.addListener("route.reverse",function(t){this.from=this.route.first(),this.to=this.route.last()}.bind(this))};GHRequest.prototype.init=function(t){for(var e in t){var i=t[e];"false"===i?i=!1:"true"===i&&(i=!0),"point"!==e&&"mathRandom"!==e&&"do_zoom"!==e&&"layer"!==e&&"use_miles"!==e&&(this.api_params[e]=i)}"do_zoom"in t&&(this.do_zoom=t.do_zoom),"use_miles"in t&&(this.useMiles=t.use_miles),this.api_params.elevation=!1;var o=this.features[this.api_params.vehicle];if(o&&o.elevation&&("elevation"in t?this.api_params.elevation=t.elevation:this.api_params.elevation=!0),t.q){var s=t.q;t.point||(t.point=[]);var r=s.indexOf("from:"),a=s.indexOf("to:");if(r>=0&&a>=0)r<a?(t.point.push(s.substring(r+5,a).trim()),t.point.push(s.substring(a+3).trim())):(t.point.push(s.substring(a+3,r).trim()),t.point.push(s.substring(r+5).trim()));else for(var n=s.split("p:"),p=0;p<n.length;p++){var u=n[p].trim();0!==u.length&&t.point.push(u)}}},GHRequest.prototype.initVehicle=function(t){this.api_params.vehicle=t;var e=this.features[t];e&&e.elevation?this.api_params.elevation=!0:this.api_params.elevation=!1},GHRequest.prototype.hasElevation=function(){return this.api_params.elevation},GHRequest.prototype.getVehicle=function(){return this.api_params.vehicle},GHRequest.prototype.createGeocodeURL=function(t,e){var i=this.host;t&&(i=t);var o=this.createPath(i+"/geocode?limit=6&type="+this.dataType);if(e>=0&&e<this.route.size()){var s=this.route.getIndex(e);s.isResolved()&&(o+="&point="+s.lat+","+s.lng)}return o},GHRequest.prototype.createURL=function(){return this.createPath(this.host+"/route?"+this.createPointParams(!1)+"&type="+this.dataType)},GHRequest.prototype.createGPXURL=function(t,e,i){return this.createPath(this.host+"/route?"+this.createPointParams(!1)+"&type=gpx&gpx.route="+t+"&gpx.track="+e+"&gpx.waypoints="+i)},GHRequest.prototype.createHistoryURL=function(){var t={key:!0};return this.createPath("?"+this.createPointParams(!0),t)+"&use_miles="+!!this.useMiles},GHRequest.prototype.createPointParams=function(t){var e,i,o,s="";for(i=0,o=this.route.size();i<o;i++)e=this.route.getIndex(i),i>0&&(s+="&"),s+=t?"point="+encodeURIComponent(e.input):"point="+encodeURIComponent(e.toString());return s},GHRequest.prototype.createPath=function(t,e){for(var i in this.api_params){var o=this.api_params[i];if(!e||!e[i])if(GHRoute.isArray(o))for(var s in o)t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(o[s]);else t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(o)}return t},GHRequest.prototype.doRequest=function(t,e){var i=this;$.ajax({timeout:3e4,url:t,success:function(t){if(t.paths)for(var o=0;o<t.paths.length;o++){var s=t.paths[o];if(s.points_encoded){var r=graphhopperTools.decodePath(s.points,i.hasElevation());s.points={type:"LineString",coordinates:r};var a=graphhopperTools.decodePath(s.snapped_waypoints,i.hasElevation());s.snapped_waypoints={type:"MultiPoint",coordinates:a}}}e(t)},error:function(i){var o,s="API did not respond! ";if(i&&i.responseText&&i.responseText.indexOf("{")>=0)o=JSON.parse(i.responseText);else if(i&&i.statusText&&"OK"!==i.statusText){s+=i.statusText;var r="Error for "+t;o={message:s,hints:[{message:s,details:r}]}}console.log(s+" "+JSON.stringify(i)),e(o)},type:"GET",dataType:this.dataType,crossDomain:!0})},GHRequest.prototype.getInfo=function(){var t=this.host+"/info?type="+this.dataType+"&key="+this.getKey();return $.ajax({url:t,timeout:3e3,type:"GET",dataType:this.dataType,crossDomain:!0})},GHRequest.prototype.setLocale=function(t){t&&(this.api_params.locale=t)},GHRequest.prototype.getKey=function(){return this.api_params.key},GHRequest.prototype.fetchTranslationMap=function(t){t||(t="");var e=this.host+"/i18n/"+t+"?type="+this.dataType+"&key="+this.getKey();return $.ajax({url:e,timeout:3e3,type:"GET",dataType:this.dataType,crossDomain:!0})},module.exports=GHRequest;
 
-},{"./GHInput.js":9,"./GHRoute.js":11,"./tools.js":12}],11:[function(require,module,exports){
+},{"./GHInput.js":10,"./GHRoute.js":12,"./tools.js":13}],12:[function(require,module,exports){
 var GHInput=require("./GHInput.js"),GHroute=function(){var t=Object.create(Array.prototype);return t=Array.apply(t,arguments)||t,GHroute.injectClassMethods(t),t._listeners={},t};GHroute.injectClassMethods=function(t){for(var e in GHroute.prototype)GHroute.prototype.hasOwnProperty(e)&&(t[e]=GHroute.prototype[e]);return t},GHroute.fromArray=function(t){var e=GHroute.apply(null,t);return e},GHroute.isArray=function(t){var e=Object.prototype.toString.call(t);return"[object array]"===e.toLowerCase()},GHroute.prototype={first:function(){return this.getIndex(0)},last:function(){return this.getIndex(this.length-1)},getIndex:function(t){return t=isNaN(t)?0:t,this[t]instanceof GHInput&&this[t]},getIndexByCoord:function(t){var e,r,i,n=!1,o=new GHInput(t);for(r=0,i=this.length;r<i;r++)if(e=this[r],e.toString()===o.toString()){n=r;break}return n},getIndexFromCoord:function(t){return this.getIndex(this.getIndexByCoord(t))},size:function(){return this.length},add:function(t,e){if(GHroute.isArray(t)){for(var r=0;r<t.length;r++)Array.prototype.push.call(this,t[r]instanceof GHInput?t[r]:new GHInput(t[r])),void 0!==e?(this.move(-1,e,!0),e++):e=this.lenght-1,this.fire("route.add",{point:this[e],to:e});return this}return Array.prototype.push.call(this,t instanceof GHInput?t:new GHInput(t)),void 0!==e?this.move(-1,e,!0):e=this.lenght-1,this.fire("route.add",{point:this[e],to:e}),this[e]},removeSingle:function(t){var e=!1;return isNaN(t)||t>=this.length||void 0===this[t]?(t instanceof GHInput&&(t=t.toString()),e=this.getIndexByCoord(t)):e=t,e!==!1&&this.remove(e),this},remove:function(t,e){var r=e||1;return Array.prototype.splice.call(this,t,r),1===this.length&&Array.prototype.push.call(this,new GHInput),this.fire("route.remove",{from:t,to:r}),this},addAll:function(){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this},set:function(t,e,r){if(t instanceof GHInput)this[e]=t;else{if(!(this[e]instanceof GHInput))return!!r&&this.add(t,e);this[e].set(t)}return this.fire("route.set",{point:this[e],to:e}),this[e]},move:function(t,e,r){for(;t<0;)t+=this.length;for(;e<0;)e+=this.length;if(e>=this.length)for(var i=e-this.length;i--+1;)Array.prototype.push.call(this,void 0);return Array.prototype.splice.call(this,e,0,Array.prototype.splice.call(this,t,1)[0]),r||this.fire("route.move",{old_index:t,new_index:e}),this},reverse:function(){return Array.prototype.reverse.call(this),this.fire("route.reverse",{}),this},isResolved:function(){for(var t=0,e=this.length;t<e;t++){var r=this[t];if(!r.isResolved())return!1}return!0},addListener:function(t,e){return"undefined"==typeof this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e),this},fire:function(t,e){if("string"==typeof t&&(t={type:t}),"object"==typeof e)for(var r in e)t[r]=e[r];if(t.route||(t.route=this),!t.type)throw new Error("Event object missing 'type' property.");if(this._listeners[t.type]instanceof Array)for(var i=this._listeners[t.type],n=0,o=i.length;n<o;n++)i[n].call(this,t)},removeListener:function(t,e){if(this._listeners[t]instanceof Array)for(var r=this._listeners[t],i=0,n=r.length;i<n;i++)if(r[i]===e){r.splice(i,1);break}}},module.exports=GHroute;
-},{"./GHInput.js":9}],12:[function(require,module,exports){
+},{"./GHInput.js":10}],13:[function(require,module,exports){
 var decodePath=function(e,d){for(var o=e.length,r=0,a=[],h=0,t=0,c=0;r<o;){var l,v=0,i=0;do l=e.charCodeAt(r++)-63,i|=(31&l)<<v,v+=5;while(l>=32);var u=1&i?~(i>>1):i>>1;h+=u,v=0,i=0;do l=e.charCodeAt(r++)-63,i|=(31&l)<<v,v+=5;while(l>=32);var n=1&i?~(i>>1):i>>1;if(t+=n,d){v=0,i=0;do l=e.charCodeAt(r++)-63,i|=(31&l)<<v,v+=5;while(l>=32);var s=1&i?~(i>>1):i>>1;c+=s,a.push([1e-5*t,1e-5*h,c/100])}else a.push([1e-5*t,1e-5*h])}return a};module.exports.decodePath=decodePath;
-},{}],13:[function(require,module,exports){
-function addInstruction(t,e,n,a,r,o){var s=n.sign;s=0===a?"marker-icon-green":messages.getSignName(s);var i=n.text;n.annotation_text&&(i=i?i+", "+n.annotation_text:n.annotation_text);var p=window.location.pathname,c=p.substring(0,p.lastIndexOf("/")),d=$("<tr class='instruction'/>");if("continue"!==s){var l="<img class='pic' style='vertical-align: middle' src='"+c+"/img/"+s+".png'/>";d.append("<td class='instr_pic'>"+l+"</td>")}else d.append("<td class='instr_pic'/>");var g=$("<td class='instr_title'>");g.text(i),d.append(g);var u=n.distance;u>0&&d.append("<td class='instr_distance'><span>"+translate.createDistanceString(u,o)+"<br/>"+translate.createTimeString(n.time)+"</span></td>"),r&&d.click(function(){routeSegmentPopup&&t.removeLayerFromMap(routeSegmentPopup),routeSegmentPopup=L.popup().setLatLng([r[1],r[0]]).setContent(i).openOn(t.getMap())}),e.append(d)}var translate=require("./translate.js"),messages=require("./messages.js"),routeSegmentPopup=null;module.exports.create=function(t,e,n,a){for(var r=$("<table class='instructions'>"),o=e.instructions.length>100,s=Math.min(e.instructions.length,100),i=0;i<s;i++){var p=e.instructions[i],c=e.points.coordinates[p.interval[0]];addInstruction(t,r,p,i,c,a.useMiles)}var d=$("<div class='instructions_info'>");if(d.append(r),o){var l=$("<button id='moreButton'>"+translate.tr("more_button")+"…</button>");l.click(function(){l.remove();for(var n=s;n<e.instructions.length;n++){var o=e.instructions[n],i=e.points.coordinates[o.interval[0]];addInstruction(t,r,o,n,i,a.useMiles)}}),r.append(l)}var g=$("<div id='routeDetails'/>");g.hide();var u=$("<button class='expandDetails'>+</button>");u.click(function(){g.toggle()}),d.append(u);var m="points: "+e.points.coordinates.length;g.append("<span>"+m+"</span>");var v=$("#export-link a");v.attr("href",n);var f=$("<br/><a>view on OSM</a>"),h="bicycle";"FOOT"===a.getVehicle().toUpperCase()&&(h="foot"),f.attr("href","http://www.openstreetmap.org/directions?engine=graphhopper_"+h+"&route="+encodeURIComponent(a.from.lat+","+a.from.lng+";"+a.to.lat+","+a.to.lng)),g.append(f);var b=$("<a>OSRM</a>");b.attr("href","http://map.project-osrm.org/?loc="+a.from+"&loc="+a.to),g.append("<br/><span>Compare with: </span>"),g.append(b);var w=$("<a>Google</a> "),x="",_="";"FOOT"===a.getVehicle().toUpperCase()?(x="&dirflg=w",_="&mode=W"):(a.getVehicle().toUpperCase().indexOf("BIKE")>=0||"MTB"===a.getVehicle().toUpperCase())&&(x="&dirflg=b"),w.attr("href","https://maps.google.com/?saddr="+a.from+"&daddr="+a.to+x),g.append(w);var O=$("<a>Bing</a> ");return O.attr("href","https://www.bing.com/maps/default.aspx?rtp=adr."+a.from+"~adr."+a.to+_),g.append(O),metaVersionInfo&&g.append(metaVersionInfo),d.append(g),d};
-},{"./messages.js":22,"./translate.js":29}],14:[function(require,module,exports){
+},{}],14:[function(require,module,exports){
+function addInstruction(t,e,n,a,r,o){var s=n.sign;s=0===a?"marker-icon-green":messages.getSignName(s);var i=n.text;n.annotation_text&&(i=i?i+", "+n.annotation_text:n.annotation_text);var p=window.location.pathname,c=p.substring(0,p.lastIndexOf("/")),d=$("<tr class='instruction'/>");if("continue"!==s){var l="<img class='pic' style='vertical-align: middle' src='"+c+"/img/"+s+".png'/>";d.append("<td class='instr_pic'>"+l+"</td>")}else d.append("<td class='instr_pic'/>");var g=$("<td class='instr_title'>");g.text(i),d.append(g);var u=n.distance;u>0&&d.append("<td class='instr_distance'><span>"+translate.createDistanceString(u,o)+"<br/>"+translate.createTimeString(n.time)+"</span></td>"),r&&d.click(function(){routeSegmentPopup&&t.removeLayerFromMap(routeSegmentPopup),routeSegmentPopup=L.popup().setLatLng([r[1],r[0]]).setContent(i).openOn(t.getMap())}),e.append(d)}var translate=require("./translate.js"),messages=require("./messages.js"),routeSegmentPopup=null;module.exports.create=function(t,e,n,a){for(var r=$("<table class='instructions'>"),o=e.instructions.length>100,s=Math.min(e.instructions.length,100),i=0;i<s;i++){var p=e.instructions[i],c=e.points.coordinates[p.interval[0]];addInstruction(t,r,p,i,c,a.useMiles)}var d=$("<div class='instructions_info'>");if(d.append(r),o){var l=$("<button id='moreButton'>"+translate.tr("more_button")+"…</button>");l.click(function(){l.remove();for(var n=s;n<e.instructions.length;n++){var o=e.instructions[n],i=e.points.coordinates[o.interval[0]];addInstruction(t,r,o,n,i,a.useMiles)}}),r.append(l)}var g=$("<div id='routeDetails'/>");g.hide();var u=$("<button class='expandDetails'>+</button>");u.click(function(){g.toggle()}),d.append(u);var m="points: "+e.points.coordinates.length;g.append("<span>"+m+"</span>");var v=$("#export-link a");v.attr("href",n);var f=$("<br/><a>view on OSM</a>"),h="bicycle";"FOOT"===a.getVehicle().toUpperCase()&&(h="foot"),f.attr("href","http://www.openstreetmap.org/directions?engine=graphhopper_"+h+"&route="+encodeURIComponent(a.from.lat+","+a.from.lng+";"+a.to.lat+","+a.to.lng)),g.append(f);var b=$("<a>OSRM</a>");b.attr("href","http://map.project-osrm.org/?z=13&loc="+a.from+"&loc="+a.to),g.append("<br/><span>Compare with: </span>"),g.append(b);var w=$("<a>Google</a> "),x="",_="";"FOOT"===a.getVehicle().toUpperCase()?(x="&dirflg=w",_="&mode=W"):(a.getVehicle().toUpperCase().indexOf("BIKE")>=0||"MTB"===a.getVehicle().toUpperCase())&&(x="&dirflg=b"),w.attr("href","https://maps.google.com/?saddr="+a.from+"&daddr="+a.to+x),g.append(w);var O=$("<a>Bing</a> ");return O.attr("href","https://www.bing.com/maps/default.aspx?rtp=adr."+a.from+"~adr."+a.to+_),g.append(O),metaVersionInfo&&g.append(metaVersionInfo),d.append(g),d};
+},{"./messages.js":22,"./translate.js":29}],15:[function(require,module,exports){
 !function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}t.ui=t.ui||{},t.ui.version="1.12.0";var i=0,s=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,o,n;for(n=0;null!=(o=i[n]);n++)try{s=t._data(o,"events"),s&&s.remove&&t(o).triggerHandler("remove")}catch(t){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var o,n,r,h={},a=e.split(".")[0];e=e.split(".")[1];var l=a+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[a]=t[a]||{},o=t[a][e],n=t[a][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new n(t,e)},t.extend(n,o,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),r=new i,r.options=t.widget.extend({},r.options),t.each(s,function(e,s){return t.isFunction(s)?void(h[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function o(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,n=this._superApply;return this._super=t,this._superApply=o,e=s.apply(this,arguments),this._super=i,this._superApply=n,e}}()):void(h[e]=s)}),n.prototype=t.widget.extend(r,{widgetEventPrefix:o?r.widgetEventPrefix||e:e},h,{constructor:n,namespace:a,widgetName:e,widgetFullName:l}),o?(t.each(o._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,n,i._proto)}),delete o._childConstructors):i._childConstructors.push(n),t.widget.bridge(e,n),n},t.widget.extend=function(e){for(var i,o,n=s.call(arguments,1),r=0,h=n.length;h>r;r++)for(i in n[r])o=n[r][i],n[r].hasOwnProperty(i)&&void 0!==o&&(e[i]=t.isPlainObject(o)?t.isPlainObject(e[i])?t.widget.extend({},e[i],o):t.widget.extend({},o):o);return e},t.widget.bridge=function(e,i){var o=i.prototype.widgetFullName||e;t.fn[e]=function(n){var r="string"==typeof n,h=s.call(arguments,1),a=this;return r?this.each(function(){var i,s=t.data(this,o);return"instance"===n?(a=s,!1):s?t.isFunction(s[n])&&"_"!==n.charAt(0)?(i=s[n].apply(s,h),i!==s&&void 0!==i?(a=i&&i.jquery?a.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):(h.length&&(n=t.widget.extend.apply(null,[n].concat(h))),this.each(function(){var e=t.data(this,o);e?(e.option(n||{}),e._init&&e._init()):t.data(this,o,new i(n,this))})),a}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,o,n,r=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(r={},s=e.split("."),e=s.shift(),s.length){for(o=r[e]=t.widget.extend({},this.options[e]),n=0;s.length-1>n;n++)o[s[n]]=o[s[n]]||{},o=o[s[n]];if(e=s.pop(),1===arguments.length)return void 0===o[e]?null:o[e];o[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];r[e]=i}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,o;for(i in e)o=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&o&&o.length&&(s=t(o.get()),this._removeClass(o,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,n){var r,h;for(h=0;i.length>h;h++)r=o.classesElementLookup[i[h]]||t(),r=t(e.add?t.unique(r.get().concat(e.element.get())):r.not(e.element).get()),o.classesElementLookup[i[h]]=r,s.push(i[h]),n&&e.classes[i[h]]&&s.push(e.classes[i[h]])}var s=[],o=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var o="string"==typeof t||null===t,n={extra:o?e:i,keys:o?t:e,element:o?this.element:t,add:s};return n.element.toggleClass(this._classes(n),s),this},_on:function(e,i,s){var o,n=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=o=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,o=this.widget()),t.each(s,function(s,r){function h(){return e||n.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?n[r]:r).apply(n,arguments):void 0}"string"!=typeof r&&(h.guid=r.guid=r.guid||h.guid||t.guid++);var a=s.match(/^([\w:-]*)\s*(.*)$/),l=a[1]+n.eventNamespace,c=a[2];c?o.on(l,c,h):i.on(l,h)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var o,n,r=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(o in n)o in i||(i[o]=n[o]);return this.element.trigger(i,s),!(t.isFunction(r)&&r.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,o,n){"string"==typeof o&&(o={effect:o});var r,h=o?o===!0||"number"==typeof o?i:o.effect||i:e;o=o||{},"number"==typeof o&&(o={duration:o}),r=!t.isEmptyObject(o),o.complete=n,o.delay&&s.delay(o.delay),r&&t.effects&&t.effects.effect[h]?s[e](o):h!==e&&s[h]?s[h](o.duration,o.easing,n):s.queue(function(i){t(this)[e](),n&&n.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(d.test(t[0])?e/100:1),parseFloat(t[1])*(d.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var o,n,r=Math.max,h=Math.abs,a=Math.round,l=/left|center|right/,c=/top|center|bottom/,p=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,d=/%$/,f=t.fn.position;n=function(){var e=t("<div>").css("position","absolute").appendTo("body").offset({top:1.5,left:1.5}),i=1.5===e.offset().top;return e.remove(),n=function(){return i},i},t.position={scrollbarWidth:function(){if(void 0!==o)return o;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=s.children()[0];return t("body").append(s),e=n.offsetWidth,s.css("overflow","scroll"),i=n.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),o=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),o="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,n="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:n?t.position.scrollbarWidth():0,height:o?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),o=!!i[0]&&9===i[0].nodeType,n=!s&&!o;return{element:i,isWindow:s,isDocument:o,offset:n?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(o){if(!o||!o.of)return f.apply(this,arguments);o=t.extend({},o);var d,g,m,_,v,b,w=t(o.of),y=t.position.getWithinInfo(o.within),P=t.position.getScrollInfo(y),x=(o.collision||"flip").split(" "),z={};return b=s(w),w[0].preventDefault&&(o.at="left top"),g=b.width,m=b.height,_=b.offset,v=t.extend({},_),t.each(["my","at"],function(){var t,e,i=(o[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):c.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=c.test(i[1])?i[1]:"center",t=p.exec(i[0]),e=p.exec(i[1]),z[this]=[t?t[0]:0,e?e[0]:0],o[this]=[u.exec(i[0])[0],u.exec(i[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===o.at[0]?v.left+=g:"center"===o.at[0]&&(v.left+=g/2),"bottom"===o.at[1]?v.top+=m:"center"===o.at[1]&&(v.top+=m/2),d=e(z.at,g,m),v.left+=d[0],v.top+=d[1],this.each(function(){var s,l,c=t(this),p=c.outerWidth(),u=c.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),C=p+f+i(this,"marginRight")+P.width,H=u+b+i(this,"marginBottom")+P.height,T=t.extend({},v),k=e(z.my,c.outerWidth(),c.outerHeight());"right"===o.my[0]?T.left-=p:"center"===o.my[0]&&(T.left-=p/2),"bottom"===o.my[1]?T.top-=u:"center"===o.my[1]&&(T.top-=u/2),T.left+=k[0],T.top+=k[1],n()||(T.left=a(T.left),T.top=a(T.top)),s={marginLeft:f,marginTop:b},t.each(["left","top"],function(e,i){t.ui.position[x[e]]&&t.ui.position[x[e]][i](T,{targetWidth:g,targetHeight:m,elemWidth:p,elemHeight:u,collisionPosition:s,collisionWidth:C,collisionHeight:H,offset:[d[0]+k[0],d[1]+k[1]],my:o.my,at:o.at,within:y,elem:c})}),o.using&&(l=function(t){var e=_.left-T.left,i=e+g-p,s=_.top-T.top,n=s+m-u,a={target:{element:w,left:_.left,top:_.top,width:g,height:m},element:{element:c,left:T.left,top:T.top,width:p,height:u},horizontal:0>i?"left":e>0?"right":"center",vertical:0>n?"top":s>0?"bottom":"middle"};p>g&&g>h(e+i)&&(a.horizontal="center"),u>m&&m>h(s+n)&&(a.vertical="middle"),a.important=r(h(e),h(i))>r(h(s),h(n))?"horizontal":"vertical",o.using.call(this,t,a)}),c.offset(t.extend(T,{using:l}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,o=s.isWindow?s.scrollLeft:s.offset.left,n=s.width,h=t.left-e.collisionPosition.marginLeft,a=o-h,l=h+e.collisionWidth-n-o;e.collisionWidth>n?a>0&&0>=l?(i=t.left+a+e.collisionWidth-n-o,t.left+=a-i):t.left=l>0&&0>=a?o:a>l?o+n-e.collisionWidth:o:a>0?t.left+=a:l>0?t.left-=l:t.left=r(t.left-h,t.left)},top:function(t,e){var i,s=e.within,o=s.isWindow?s.scrollTop:s.offset.top,n=e.within.height,h=t.top-e.collisionPosition.marginTop,a=o-h,l=h+e.collisionHeight-n-o;e.collisionHeight>n?a>0&&0>=l?(i=t.top+a+e.collisionHeight-n-o,t.top+=a-i):t.top=l>0&&0>=a?o:a>l?o+n-e.collisionHeight:o:a>0?t.top+=a:l>0?t.top-=l:t.top=r(t.top-h,t.top)}},flip:{left:function(t,e){var i,s,o=e.within,n=o.offset.left+o.scrollLeft,r=o.width,a=o.isWindow?o.scrollLeft:o.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-a,p=l+e.collisionWidth-r-a,u="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,d="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+u+d+f+e.collisionWidth-r-n,(0>i||h(c)>i)&&(t.left+=u+d+f)):p>0&&(s=t.left-e.collisionPosition.marginLeft+u+d+f-a,(s>0||p>h(s))&&(t.left+=u+d+f))},top:function(t,e){var i,s,o=e.within,n=o.offset.top+o.scrollTop,r=o.height,a=o.isWindow?o.scrollTop:o.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-a,p=l+e.collisionHeight-r-a,u="top"===e.my[1],d=u?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+d+f+g+e.collisionHeight-r-n,(0>s||h(c)>s)&&(t.top+=d+f+g)):p>0&&(i=t.top-e.collisionPosition.marginTop+d+f+g-a,(i>0||p>h(i))&&(t.top+=d+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}}),t.ui.focusable=function(i,s){var o,n,r,h,a,l=i.nodeName.toLowerCase();return"area"===l?(o=i.parentNode,n=o.name,!(!i.href||!n||"map"!==o.nodeName.toLowerCase())&&(r=t("img[usemap='#"+n+"']"),r.length>0&&r.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(l)?(h=!i.disabled,h&&(a=t(i).closest("fieldset")[0],a&&(h=!a.disabled))):h="a"===l?i.href||s:s,h&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,n){return t.each(o,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),n&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var o="Width"===i?["Left","Right"]:["Top","Bottom"],n=i.toLowerCase(),r={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?r["inner"+i].call(this):this.each(function(){t(this).css(n,s(this,e)+"px")})},t.fn["outer"+i]=function(e,o){return"number"!=typeof e?r["outer"+i].call(this,e):this.each(function(){t(this).css(n,s(this,e,!0,o)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,o,n;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(o=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),n=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",o=o.add(n.find(i).addBack(i))),this.pushStack(o))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,o=e?/(auto|scroll|hidden)/:/(auto|scroll)/,n=this.parents().filter(function(){var e=t(this);return(!s||"static"!==e.css("position"))&&o.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&n.length?n:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var o=!1;t(document).on("mouseup",function(){o=!1}),t.widget("ui.mouse",{version:"1.12.0",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!o){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(s&&!n&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),o=!0,!0))}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,o=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var o,n=t.ui[e].prototype;for(o in s)n.plugins[o]=n.plugins[o]||[],n.plugins[o].push([i,s[o]])},call:function(t,e,i,s){var o,n=t.plugins[e];if(n&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(o=0;n.length>o;o++)t.options[n[o][0]]&&n[o][1].apply(t.element,i)}},t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.0",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.options;return this._blurActiveElement(e),!(this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(e),!!this.handle&&(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);this._getHandle(e)&&s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),o=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return o.parents("body").length||o.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&o[0]===this.element[0]&&this._setPositionRelative(),o[0]===this.element[0]||/(fixed|absolute)/.test(o.css("position"))||o.css("position","absolute"),o},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,o=this.options,n=this.document[0];return this.relativeContainer=null,o.containment?"window"===o.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===o.containment?void(this.containment=[0,0,t(n).width()-this.helperProportions.width-this.margins.left,(t(n).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):o.containment.constructor===Array?void(this.containment=o.containment):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),i=t(o.containment),s=i[0],void(s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,o,n,r=this.options,h=this._isRootNode(this.scrollParent[0]),a=t.pageX,l=t.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(a=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(a=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),r.grid&&(o=r.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,l=i?o-this.offset.click.top>=i[1]||o-this.offset.click.top>i[3]?o:o-this.offset.click.top>=i[1]?o-r.grid[1]:o+r.grid[1]:o,n=r.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,a=i?n-this.offset.click.left>=i[0]||n-this.offset.click.left>i[2]?n:n-this.offset.click.left>=i[0]?n-r.grid[0]:n+r.grid[0]:n),"y"===r.axis&&(a=this.originalPageX),"x"===r.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:h?0:this.offset.scroll.left)
 }},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var o=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,o))})},stop:function(e,i,s){var o=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,o))})},drag:function(e,i,s){t.each(s.sortables,function(){var o=!1,n=this;n.positionAbs=s.positionAbs,n.helperProportions=s.helperProportions,n.offset.click=s.offset.click,n._intersectsWith(n.containerCache)&&(o=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==n&&this._intersectsWith(this.containerCache)&&t.contains(n.element[0],this.element[0])&&(o=!1),o})),o?(n.isOver||(n.isOver=1,s._parent=i.helper.parent(),n.currentItem=i.helper.appendTo(n.element).data("ui-sortable-item",!0),n.options._helper=n.options.helper,n.options.helper=function(){return i.helper[0]},e.target=n.currentItem[0],n._mouseCapture(e,!0),n._mouseStart(e,!0,!0),n.offset.click.top=s.offset.click.top,n.offset.click.left=s.offset.click.left,n.offset.parent.left-=s.offset.parent.left-n.offset.parent.left,n.offset.parent.top-=s.offset.parent.top-n.offset.parent.top,s._trigger("toSortable",e),s.dropped=n.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,n.fromOutside=s),n.currentItem&&(n._mouseDrag(e),i.position=n.position)):n.isOver&&(n.isOver=0,n.cancelHelperRemoval=!0,n.options._revert=n.options.revert,n.options.revert=!1,n._trigger("out",e,n._uiHash(n)),n._mouseStop(e,!0),n.options.revert=n.options._revert,n.options.helper=n.options._helper,n.placeholder&&n.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var o=t("body"),n=s.options;o.css("cursor")&&(n._cursor=o.css("cursor")),o.css("cursor",n.cursor)},stop:function(e,i,s){var o=s.options;o._cursor&&t("body").css("cursor",o._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var o=t(i.helper),n=s.options;o.css("opacity")&&(n._opacity=o.css("opacity")),o.css("opacity",n.opacity)},stop:function(e,i,s){var o=s.options;o._opacity&&t(i.helper).css("opacity",o._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var o=s.options,n=!1,r=s.scrollParentNotHidden[0],h=s.document[0];r!==h&&"HTML"!==r.tagName?(o.axis&&"x"===o.axis||(s.overflowOffset.top+r.offsetHeight-e.pageY<o.scrollSensitivity?r.scrollTop=n=r.scrollTop+o.scrollSpeed:e.pageY-s.overflowOffset.top<o.scrollSensitivity&&(r.scrollTop=n=r.scrollTop-o.scrollSpeed)),o.axis&&"y"===o.axis||(s.overflowOffset.left+r.offsetWidth-e.pageX<o.scrollSensitivity?r.scrollLeft=n=r.scrollLeft+o.scrollSpeed:e.pageX-s.overflowOffset.left<o.scrollSensitivity&&(r.scrollLeft=n=r.scrollLeft-o.scrollSpeed))):(o.axis&&"x"===o.axis||(e.pageY-t(h).scrollTop()<o.scrollSensitivity?n=t(h).scrollTop(t(h).scrollTop()-o.scrollSpeed):t(window).height()-(e.pageY-t(h).scrollTop())<o.scrollSensitivity&&(n=t(h).scrollTop(t(h).scrollTop()+o.scrollSpeed))),o.axis&&"y"===o.axis||(e.pageX-t(h).scrollLeft()<o.scrollSensitivity?n=t(h).scrollLeft(t(h).scrollLeft()-o.scrollSpeed):t(window).width()-(e.pageX-t(h).scrollLeft())<o.scrollSensitivity&&(n=t(h).scrollLeft(t(h).scrollLeft()+o.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var o=s.options;s.snapElements=[],t(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var o,n,r,h,a,l,c,p,u,d,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(u=s.snapElements.length-1;u>=0;u--)a=s.snapElements[u].left-s.margins.left,l=a+s.snapElements[u].width,c=s.snapElements[u].top-s.margins.top,p=c+s.snapElements[u].height,a-g>_||m>l+g||c-g>b||v>p+g||!t.contains(s.snapElements[u].item.ownerDocument,s.snapElements[u].item)?(s.snapElements[u].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=!1):("inner"!==f.snapMode&&(o=g>=Math.abs(c-b),n=g>=Math.abs(p-v),r=g>=Math.abs(a-_),h=g>=Math.abs(l-m),o&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),n&&(i.position.top=s._convertPositionTo("relative",{top:p,left:0}).top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:a-s.helperProportions.width}).left),h&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),d=o||n||r||h,"outer"!==f.snapMode&&(o=g>=Math.abs(c-v),n=g>=Math.abs(p-b),r=g>=Math.abs(a-m),h=g>=Math.abs(l-_),o&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),n&&(i.position.top=s._convertPositionTo("relative",{top:p-s.helperProportions.height,left:0}).top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:a}).left),h&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[u].snapping&&(o||n||r||h||d)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=o||n||r||h||d)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var o,n=s.options,r=t.makeArray(t(n.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});r.length&&(o=parseInt(t(r[0]).css("zIndex"),10)||0,t(r).each(function(e){t(this).css("zIndex",o+e)}),this.css("zIndex",o+r.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var o=t(i.helper),n=s.options;o.css("zIndex")&&(n._zIndex=o.css("zIndex")),o.css("zIndex",n.zIndex)},stop:function(e,i,s){var o=s.options;o._zIndex&&t(i.helper).css("zIndex",o._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.0",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",o=!1;return e[s]>0||(e[s]=1,o=e[s]>0,e[s]=0,o)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var e,i,s,o,n,r=this.options,h=this;if(this.handles=r.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),o="ui-resizable-"+e,n=t("<div>"),this._addClass(n,"ui-resizable-handle "+o),n.css({zIndex:r.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(n);this._renderAxis=function(e){var i,s,o,n;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:h._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),n=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),o=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(o,n),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){h.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),h.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,o=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(o=!0);return!this.options.disabled&&o},_mouseStart:function(e){var i,s,o,n=this.options,r=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),n.containment&&(i+=t(n.containment).scrollLeft()||0,s+=t(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===o?this.axis+"-resize":o),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,o=this.originalMousePosition,n=this.axis,r=e.pageX-o.left||0,h=e.pageY-o.top||0,a=this._change[n];return this._updatePrevProperties(),!!a&&(i=a.apply(this,[e,r,h]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var i,s,o,n,r,h,a,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,n=s?0:c.sizeDiff.width,r={width:c.helper.width()-n,height:c.helper.height()-o},h=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,a=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(r,{top:a,left:h})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,o,n,r=this.options;n={minWidth:this._isNumber(r.minWidth)?r.minWidth:0,maxWidth:this._isNumber(r.maxWidth)?r.maxWidth:1/0,minHeight:this._isNumber(r.minHeight)?r.minHeight:0,maxHeight:this._isNumber(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||t)&&(e=n.minHeight*this.aspectRatio,s=n.minWidth/this.aspectRatio,i=n.maxHeight*this.aspectRatio,o=n.maxWidth/this.aspectRatio,e>n.minWidth&&(n.minWidth=e),s>n.minHeight&&(n.minHeight=s),n.maxWidth>i&&(n.maxWidth=i),n.maxHeight>o&&(n.maxHeight=o)),this._vBoundaries=n},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,o=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,n=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,r=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,h=this.originalPosition.left+this.originalSize.width,a=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return n&&(t.width=e.minWidth),r&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),o&&(t.height=e.maxHeight),n&&l&&(t.left=h-e.minWidth),s&&l&&(t.left=h-e.maxWidth),r&&c&&(t.top=a-e.minHeight),o&&c&&(t.top=a-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],o=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(o[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,o=this.originalPosition;return{top:o.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,o=i._proportionallyResizeElements,n=o.length&&/textarea/i.test(o[0].nodeName),r=n&&i._hasScroll(o[0],"left")?0:i.sizeDiff.height,h=n?0:i.sizeDiff.width,a={width:i.size.width-h,height:i.size.height-r},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(a,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};o&&o.length&&t(o[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,o,n,r,h,a=t(this).resizable("instance"),l=a.options,c=a.element,p=l.containment,u=p instanceof t?p.get(0):/parent/.test(p)?c.parent().get(0):p;u&&(a.containerElement=t(u),/document/.test(p)||p===document?(a.containerOffset={left:0,top:0},a.containerPosition={left:0,top:0},a.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(u),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=a._num(e.css("padding"+s))}),a.containerOffset=e.offset(),a.containerPosition=e.position(),a.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=a.containerOffset,o=a.containerSize.height,n=a.containerSize.width,r=a._hasScroll(u,"left")?u.scrollWidth:n,h=a._hasScroll(u)?u.scrollHeight:o,a.parentData={element:u,left:s.left,top:s.top,width:r,height:h}))},resize:function(e){var i,s,o,n,r=t(this).resizable("instance"),h=r.options,a=r.containerOffset,l=r.position,c=r._aspectRatio||e.shiftKey,p={top:0,left:0},u=r.containerElement,d=!0;u[0]!==document&&/static/.test(u.css("position"))&&(p=a),l.left<(r._helper?a.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-a.left:r.position.left-p.left),c&&(r.size.height=r.size.width/r.aspectRatio,d=!1),r.position.left=h.helper?a.left:0),l.top<(r._helper?a.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-a.top:r.position.top),c&&(r.size.width=r.size.height*r.aspectRatio,d=!1),r.position.top=r._helper?a.top:0),o=r.containerElement.get(0)===r.element.parent().get(0),n=/relative|absolute/.test(r.containerElement.css("position")),o&&n?(r.offset.left=r.parentData.left+r.position.left,r.offset.top=r.parentData.top+r.position.top):(r.offset.left=r.element.offset().left,r.offset.top=r.element.offset().top),i=Math.abs(r.sizeDiff.width+(r._helper?r.offset.left-p.left:r.offset.left-a.left)),s=Math.abs(r.sizeDiff.height+(r._helper?r.offset.top-p.top:r.offset.top-a.top)),i+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-i,c&&(r.size.height=r.size.width/r.aspectRatio,d=!1)),s+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-s,c&&(r.size.width=r.size.height*r.aspectRatio,d=!1)),d||(r.position.left=r.prevPosition.left,r.position.top=r.prevPosition.top,r.size.width=r.prevSize.width,r.size.height=r.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,o=e.containerPosition,n=e.containerElement,r=t(e.helper),h=r.offset(),a=r.outerWidth()-e.sizeDiff.width,l=r.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(n.css("position"))&&t(this).css({left:h.left-o.left-s.left,width:a,height:l}),e._helper&&!i.animate&&/static/.test(n.css("position"))&&t(this).css({left:h.left-o.left-s.left,width:a,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),o=s.options,n=s.originalSize,r=s.originalPosition,h={height:s.size.height-n.height||0,width:s.size.width-n.width||0,top:s.position.top-r.top||0,left:s.position.left-r.left||0};t(o.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),o={},n=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(n,function(t,e){var i=(s[e]||0)+(h[e]||0);i&&i>=0&&(o[e]=i||null)}),e.css(o)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,o=i.size,n=i.originalSize,r=i.originalPosition,h=i.axis,a="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=a[0]||1,c=a[1]||1,p=Math.round((o.width-n.width)/l)*l,u=Math.round((o.height-n.height)/c)*c,d=n.width+p,f=n.height+u,g=s.maxWidth&&d>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>d,v=s.minHeight&&s.minHeight>f;s.grid=a,_&&(d+=l),v&&(f+=c),g&&(d-=l),m&&(f-=c),/^(se|s|e)$/.test(h)?(i.size.width=d,i.size.height=f):/^(ne)$/.test(h)?(i.size.width=d,i.size.height=f,i.position.top=r.top-u):/^(sw)$/.test(h)?(i.size.width=d,i.size.height=f,i.position.left=r.left-p):((0>=f-c||0>=d-l)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=r.top-u):(f=c-e.height,i.size.height=f,i.position.top=r.top+n.height-f),d-l>0?(i.size.width=d,i.position.left=r.left-p):(d=l-e.width,i.size.width=d,i.position.left=r.left+n.width-d))}}),t.ui.resizable,t.widget("ui.sortable",t.ui.mouse,{version:"1.12.0",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,o=!1,n=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,n.widgetName+"-item")===n?(s=t(this),!1):void 0}),t.data(e.target,n.widgetName+"-item")===n&&(s=t(e.target)),!!s&&(!(this.options.handle&&!i&&(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(o=!0)}),!o))&&(this.currentItem=s,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,s){var o,n,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",r.cursor),this.storedStylesheet=t("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(n)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,o,n,r=this.options,h=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+r.scrollSpeed:e.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+r.scrollSpeed:e.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(e.pageY-this.document.scrollTop()<r.scrollSensitivity?h=this.document.scrollTop(this.document.scrollTop()-r.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<r.scrollSensitivity&&(h=this.document.scrollTop(this.document.scrollTop()+r.scrollSpeed)),e.pageX-this.document.scrollLeft()<r.scrollSensitivity?h=this.document.scrollLeft(this.document.scrollLeft()-r.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<r.scrollSensitivity&&(h=this.document.scrollLeft(this.document.scrollLeft()+r.scrollSpeed))),h!==!1&&t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],o=s.item[0],n=this._intersectsWithPointer(s),n&&s.instance===this.currentContainer&&o!==this.currentItem[0]&&this.placeholder[1===n?"next":"prev"]()[0]!==o&&!t.contains(this.placeholder[0],o)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],o))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),
 this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,o=this.placeholder.offset(),n=this.options.axis,r={};n&&"x"!==n||(r.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(r.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(r,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,o=s+this.helperProportions.height,n=t.left,r=n+t.width,h=t.top,a=h+t.height,l=this.offset.click.top,c=this.offset.click.left,p="x"===this.options.axis||s+l>h&&a>s+l,u="y"===this.options.axis||e+c>n&&r>e+c,d=p&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?d:e+this.helperProportions.width/2>n&&r>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>h&&a>o-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),o="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=s&&o;return!!n&&(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&i||"left"===o&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){h.push(this)}var s,o,n,r,h=[],a=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(n=t(l[s],this.document[0]),o=n.length-1;o>=0;o--)r=t.data(n[o],this.widgetFullName),r&&r!==this&&!r.options.disabled&&a.push([t.isFunction(r.options.items)?r.options.items.call(r.element):t(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r]);for(a.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=a.length-1;s>=0;s--)a[s][0].each(i);return t(h)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,o,n,r,h,a,l,c=this.items,p=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(o=t(u[i],this.document[0]),s=o.length-1;s>=0;s--)n=t.data(o[s],this.widgetFullName),n&&n!==this&&!n.options.disabled&&(p.push([t.isFunction(n.options.items)?n.options.items.call(n.element[0],e,{item:this.currentItem}):t(n.options.items,n.element),n]),this.containers.push(n));for(i=p.length-1;i>=0;i--)for(r=p[i][1],h=p[i][0],s=0,l=h.length;l>s;s++)a=t(h[s]),a.data(this.widgetName+"-item",r),c.push({item:a,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,o,n;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(o=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=o.outerWidth(),s.height=o.outerHeight()),n=o.offset(),s.left=n.left,s.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)n=this.containers[i].element.offset(),this.containers[i].containerCache.left=n.left,this.containers[i].containerCache.top=n.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),o=t("<"+s+">",e.document[0]);return e._addClass(o,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(o,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(o)):"tr"===s?e._createTrPlaceholder(e.currentItem,o):"img"===s&&o.attr("src",e.currentItem.attr("src")),i||o.css("visibility","hidden"),o},update:function(t,o){(!i||s.forcePlaceholderSize)&&(o.height()||o.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,o,n,r,h,a,l,c,p,u=null,d=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&t.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],d=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[d].containerCache.over||(this.containers[d]._trigger("over",e,this._uiHash(this)),this.containers[d].containerCache.over=1);else{for(o=1e4,n=null,c=u.floating||this._isFloating(this.currentItem),r=c?"left":"top",h=c?"width":"height",p=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[d].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(a=this.items[s].item.offset()[r],l=!1,e[p]-a>this.items[s][h]/2&&(l=!0),o>Math.abs(e[p]-a)&&(o=Math.abs(e[p]-a),n=this.items[s],this.direction=l?"up":"down"));if(!n&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[d])return void(this.currentContainer.containerCache.over||(this.containers[d]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));n?this._rearrange(e,n,null,!0):this._rearrange(e,null,this.containers[d].element,!0),this._trigger("change",e,this._uiHash()),this.containers[d]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[d],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",e,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),("document"===o.containment||"window"===o.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===o.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===o.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(e=t(o.containment)[0],i=t(o.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(o[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:o.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:o.scrollLeft())*s}},_generatePosition:function(e){var i,s,o=this.options,n=e.pageX,r=e.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),o.grid&&(i=this.originalPageY+Math.round((r-this.originalPageY)/o.grid[1])*o.grid[1],r=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-o.grid[1]:i+o.grid[1]:i,s=this.originalPageX+Math.round((n-this.originalPageX)/o.grid[0])*o.grid[0],n=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:h.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:h.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&o.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||o.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(o.push(function(t){this._trigger("remove",t,this._uiHash())}),o.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||o.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(o.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;o.length>s;s++)o[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}});var n=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.0",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,o){var n,r={};return o?"controlgroupLabel"===s?(n=e.element.find(o),n.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(n,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(n.get()))):void(t.fn[s]&&(e["_"+s+"Options"]&&(r=e["_"+s+"Options"]("middle")),e.element.find(o).each(function(){var o=t(this),n=o[s]("instance"),h=t.widget.extend({},r);if("button"!==s||!o.parent(".ui-spinner").length){n||(n=o[s]()[s]("instance")),n&&(h.classes=e._resolveClassesValues(h.classes,n)),o[s](h);var a=o[s]("widget");t.data(a[0],"ui-controlgroup-data",n?n:o[s]("instance")),i.push(a[0])}}))):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:!!e&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(t){var o=i.options.classes[t]||"";o=o.replace(n,"").trim(),s[t]=(o+" "+e[t]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?void this._callChildMethod(e?"disable":"enable"):void this.refresh()},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var o=e[s]().data("ui-controlgroup-data");if(o&&i["_"+o.widgetName+"Options"]){var n=i["_"+o.widgetName+"Options"](1===e.length?"only":s);n.classes=i._resolveClassesValues(n.classes,o),o.element[o.widgetName](n)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.0",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,o=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(o.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(o.disabled=e),o},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e)):void this.refresh()):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){this.label.contents().not(this.element.add(this.icon).add(this.iconSpace)).remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.0",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,o=s?this.options.iconPosition:i,n="top"===o||"bottom"===o;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(o),n?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(o))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?void this._super("showLabel",e):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.widget("ui.dialog",{version:"1.12.0",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",
 at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,o=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),n=Math.max.apply(null,o);return n>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",n+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),o=i.filter(":last");e.target!==o[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){o.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(t.each(i,function(i,s){var o,n;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),o=s.click,n={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,t("<button></button>",s).button(n).appendTo(e.uiButtonSet).on("click",function(){o.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,o){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(o))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(o,n){var r=n.offset.left-i.document.scrollLeft(),h=n.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" top"+(h>=0?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",o,e(n))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,o=s.resizable,n=this.uiDialog.css("position"),r="string"==typeof o?o:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:r,start:function(s,o){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(o))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(o,n){var r=i.uiDialog.offset(),h=r.left-i.document.scrollLeft(),a=r.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(h>=0?"+":"")+h+" top"+(a>=0?"+":"")+a,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",o,e(n))}}).css("position",n)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,o={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(o[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",o)},_setOption:function(e,i){var s,o,n=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(s=n.is(":data(ui-draggable)"),s&&!i&&n.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(o=n.is(":data(ui-resizable)"),o&&!i&&n.resizable("destroy"),o&&"string"==typeof i&&n.resizable("option","handles",i),o||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog});
 
-},{}],15:[function(require,module,exports){
-!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";function t(n,s){var i=function(){},o=this,l={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:t.formatResult,onPreSelect:i,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:i,onSearchComplete:i,onSearchError:i,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,lookupFilter:function(e,t,n){return e.value.toLowerCase().indexOf(n)!==-1},paramName:"query",transformResult:function(t){return"string"==typeof t?e.parseJSON(t):t}};o.element=n,o.el=e(n),o.suggestions=[],o.badQueries=[],o.selectedIndex=-1,o.currentValue=o.element.value,o.intervalId=0,o.cachedResponse={},o.onChangeInterval=null,o.onChange=null,o.isLocal=!1,o.suggestionsContainer=null,o.options=e.extend({},l,s),o.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},o.hint=null,o.hintValue="",o.selection=null,o.initialize(),o.setOptions(s)}var n=function(){return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t.style.cursor="pointer",t}}}(),s={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};t.utils=n,e.Autocomplete=t,t.formatResult=function(e,t){var s="("+n.escapeRegExChars(t)+")";return e.value.replace(new RegExp(s,"gi"),"<strong>$1</strong>")},t.prototype={killerFn:null,initialize:function(){var n,s=this,i="."+s.classes.suggestion,o=(s.classes.selected,s.options);s.element.setAttribute("autocomplete","off"),s.killerFn=function(t){0===e(t.target).closest("."+s.options.containerClass).length&&(s.killSuggestions(),s.disableKillerFn())},s.suggestionsContainer=t.utils.createNode(o.containerClass),n=e(s.suggestionsContainer),n.appendTo(o.appendTo),"auto"!==o.width&&n.width(o.width),n.on("click.autocomplete",i,function(){s.select(e(this).data("index"))}),s.fixPosition(),s.fixPositionCapture=function(){s.visible&&s.fixPosition()},e(window).on("resize.autocomplete",s.fixPositionCapture),s.el.on("keydown.autocomplete",function(e){s.onKeyPress(e)}),s.el.on("keyup.autocomplete",function(e){s.onKeyUp(e)}),s.el.on("blur.autocomplete",function(){s.onBlur()}),s.el.on("focus.autocomplete",function(){s.onFocus()}),s.el.on("change.autocomplete",function(e){s.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition(),e.options.minChars<=e.el.val().length},onBlur:function(){this.enableKillerFn()},setOptions:function(t){var n=this,s=n.options;e.extend(s,t),n.isLocal=e.isArray(s.lookup),n.isLocal&&(s.lookup=n.verifySuggestionsFormat(s.lookup)),e(n.suggestionsContainer).css({"max-height":s.maxHeight+"px",width:s.width+"px","z-index":s.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,e.currentRequest&&e.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var t,n,s=this;"body"===s.options.appendTo&&(t=s.el.offset(),n={top:t.top+s.el.outerHeight()+"px",left:t.left+"px"},"auto"===s.options.width&&(n.width=s.el.outerWidth()-2+"px"),e(s.suggestionsContainer).css(n))},enableKillerFn:function(){var t=this;e(document).on("click.autocomplete",t.killerFn)},disableKillerFn:function(){var t=this;e(document).off("click.autocomplete",t.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e,t=this,n=t.el.val().length,s=t.element.selectionStart;return"number"==typeof s?s===n:!document.selection||(e=document.selection.createRange(),e.moveStart("character",-n),n===e.text.length)},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.which===s.DOWN&&t.currentValue)return void t.suggest();if(!t.disabled&&t.visible){switch(e.which){case s.ESC:t.el.val(t.currentValue),t.hide();break;case s.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case s.TAB:if(t.hint&&t.options.onHint)return void t.selectHint();case s.RETURN:if(t.selectedIndex===-1)return void t.hide();if(t.select(t.selectedIndex),e.which===s.TAB&&t.options.tabDisabled===!1)return;break;case s.UP:t.moveUp();break;case s.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case s.UP:case s.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var t,n=this,s=n.options,i=n.el.val(),o=n.getQuery(i);return n.selection&&(n.selection=null,(s.onInvalidateSelection||e.noop).call(n.element)),clearInterval(n.onChangeInterval),n.currentValue=i,n.selectedIndex=-1,s.triggerSelectOnValidInput&&(t=n.findSuggestionIndex(o),t!==-1)?void n.select(t):void(o.length<s.minChars?n.hide():n.getSuggestions(o))},findSuggestionIndex:function(t){var n=this,s=-1,i=t.toLowerCase();return e.each(n.suggestions,function(e,t){if(t.value.toLowerCase()===i)return s=e,!1}),s},getQuery:function(t){var n,s=this.options.delimiter;return s?(n=t.split(s),e.trim(n[n.length-1])):t},getSuggestionsLocal:function(t){var n,s=this,i=s.options,o=t.toLowerCase(),l=i.lookupFilter,a=parseInt(i.lookupLimit,10);return n={suggestions:e.grep(i.lookup,function(e){return l(e,t,o)})},a&&n.suggestions.length>a&&(n.suggestions=n.suggestions.slice(0,a)),n},getSuggestions:function(t){var n,s,i,o=this,l=o.options,a=l.serviceUrl;if(l.params[l.paramName]=t,s=l.ignoreParams?null:l.params,o.isLocal?n=o.getSuggestionsLocal(t):(e.isFunction(a)&&(a=a.call(o.element,t)),i=a+"?"+e.param(s||{}),n=o.cachedResponse[i]),n&&e.isArray(n.suggestions))o.suggestions=n.suggestions,o.suggest();else if(!o.isBadQuery(t)){if(l.onSearchStart.call(o.element,l.params)===!1)return;o.currentRequest&&o.currentRequest.abort(),o.currentRequest=e.ajax({url:a,data:s,type:l.type,dataType:l.dataType}).done(function(e){o.currentRequest=null,o.processResponse(e,t,i),l.onSearchComplete.call(o.element,t)}).fail(function(e,n,s){l.onSearchError.call(o.element,t,e,n,s)})}},isBadQuery:function(e){for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var t=this;t.visible=!1,t.selectedIndex=-1,e(t.suggestionsContainer).hide(),t.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var t,n,s=this,i=s.options,o=i.formatResult,l=s.getQuery(s.currentValue),a=s.classes.suggestion,r=s.classes.selected,u=e(s.suggestionsContainer),c=i.beforeRender,g="";return i.triggerSelectOnValidInput&&(t=s.findSuggestionIndex(l),t!==-1)?void s.select(t):(e.each(s.suggestions,function(e,t){g+='<div class="'+a+'" data-index="'+e+'">'+o(t,l)+"</div>"}),"auto"===i.width&&(n=s.el.outerWidth()-2,u.width(n>0?n:300)),u.html(g),i.autoSelectFirst&&(s.selectedIndex=0,u.children().first().addClass(r)),e.isFunction(c)&&c.call(s.element,u),u.show(),s.visible=!0,void s.findBestHint())},findBestHint:function(){var t=this,n=t.el.val().toLowerCase(),s=null;n&&(e.each(t.suggestions,function(e,t){var i=0===t.value.toLowerCase().indexOf(n);return i&&(s=t),!i}),t.signalHint(s))},signalHint:function(t){var n="",s=this;t&&(n=s.currentValue+t.value.substr(s.currentValue.length)),s.hintValue!==n&&(s.hintValue=n,s.hint=t,(this.options.onHint||e.noop)(n))},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,function(e){return{value:e,data:null}}):t},processResponse:function(e,t,n){var s=this,i=s.options,o=i.transformResult(e,t);o.suggestions=s.verifySuggestionsFormat(o.suggestions),i.noCache||(s.cachedResponse[n]=o,0===o.suggestions.length&&s.badQueries.push(n)),t===s.getQuery(s.currentValue)&&(s.suggestions=o.suggestions,s.suggest())},activate:function(t){var n,s=this,i=s.classes.selected,o=e(s.suggestionsContainer),l=o.children();return s.selectedIndex===t?null:(o.children("."+i).removeClass(i),s.selectedIndex=t,s.selectedIndex!==-1&&l.length>s.selectedIndex?(n=l.get(s.selectedIndex),e(n).addClass(i),s.options.onPreSelect(s.suggestions[t],n),n):null)},selectHint:function(){var t=this,n=e.inArray(t.hint,t.suggestions);t.select(n)},select:function(e){var t=this;t.hide(),t.onSelect(e)},moveUp:function(){var t=this;if(t.selectedIndex!==-1)return 0===t.selectedIndex?(e(t.suggestionsContainer).children().first().removeClass(t.classes.selected),t.selectedIndex=-1,t.el.val(t.currentValue),void t.findBestHint()):void t.adjustScroll(t.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n,s,i,o=this,l=o.activate(t),a=25;l&&(n=l.offsetTop,s=e(o.suggestionsContainer).scrollTop(),i=s+o.options.maxHeight-a,n<s?e(o.suggestionsContainer).scrollTop(n):n>i&&e(o.suggestionsContainer).scrollTop(n-o.options.maxHeight+a),o.el.val(o.getValue(o.suggestions[t].value)),o.signalHint(null))},onSelect:function(t){var n=this,s=n.options.onSelect,i=n.suggestions[t];n.currentValue=n.getValue(i.value),n.el.val(n.currentValue),n.signalHint(null),n.suggestions=[],n.selection=i,e.isFunction(s)&&s.call(n.element,i)},getValue:function(e){var t,n,s=this,i=s.options.delimiter;return i?(t=s.currentValue,n=t.split(i),1===n.length?e:t.substr(0,t.length-n[n.length-1].length)+e):e},dispose:function(){var t=this;t.el.off(".autocomplete").removeData("autocomplete"),t.disableKillerFn(),e(window).off("resize.autocomplete",t.fixPositionCapture),e(t.suggestionsContainer).remove()}},e.fn.autocomplete=function(n,s){var i="autocomplete";return 0===arguments.length?this.first().data(i):this.each(function(){var o=e(this),l=o.data(i);"string"==typeof n?l&&"function"==typeof l[n]&&l[n](s):(l&&l.dispose&&l.dispose(),l=new t(this,n),o.data(i,l))})}});
-
 },{}],16:[function(require,module,exports){
-!function(e,t){"use strict";var r=e.History=e.History||{},a=e.jQuery;if("undefined"!=typeof r.Adapter)throw new Error("History.js Adapter has already been loaded...");r.Adapter={bind:function(e,t,r){a(e).bind(t,r)},trigger:function(e,t,r){a(e).trigger(t,r)},extractEventData:function(e,r,a){var n=r&&r.originalEvent&&r.originalEvent[e]||a&&a[e]||t;return n},onDomLoad:function(e){a(e)}},"undefined"!=typeof r.init&&r.init()}(window),function(e,t){"use strict";var r=e.console||t,a=e.document,n=e.navigator,o=e.sessionStorage||!1,i=e.setTimeout,s=e.clearTimeout,u=e.setInterval,l=e.clearInterval,d=e.JSON,c=e.alert,p=e.History=e.History||{},f=e.history;try{o.setItem("TEST","1"),o.removeItem("TEST")}catch(e){o=!1}if(d.stringify=d.stringify||d.encode,d.parse=d.parse||d.decode,"undefined"!=typeof p.init)throw new Error("History.js Core has already been loaded...");p.init=function(e){return"undefined"!=typeof p.Adapter&&("undefined"!=typeof p.initCore&&p.initCore(),"undefined"!=typeof p.initHtml4&&p.initHtml4(),!0)},p.initCore=function(g){if("undefined"!=typeof p.initCore.initialized)return!1;if(p.initCore.initialized=!0,p.options=p.options||{},p.options.hashChangeInterval=p.options.hashChangeInterval||100,p.options.safariPollInterval=p.options.safariPollInterval||500,p.options.doubleCheckInterval=p.options.doubleCheckInterval||500,p.options.disableSuid=p.options.disableSuid||!1,p.options.storeInterval=p.options.storeInterval||1e3,p.options.busyDelay=p.options.busyDelay||250,p.options.debug=p.options.debug||!1,p.options.initialTitle=p.options.initialTitle||a.title,p.options.html4Mode=p.options.html4Mode||!1,p.options.delayInit=p.options.delayInit||!1,p.intervalList=[],p.clearAllIntervals=function(){var e,t=p.intervalList;if("undefined"!=typeof t&&null!==t){for(e=0;e<t.length;e++)l(t[e]);p.intervalList=null}},p.debug=function(){(p.options.debug||!1)&&p.log.apply(p,arguments)},p.log=function(){var e,t,n,o,i,s="undefined"!=typeof r&&"undefined"!=typeof r.log&&"undefined"!=typeof r.log.apply,u=a.getElementById("log");for(s?(o=Array.prototype.slice.call(arguments),e=o.shift(),"undefined"!=typeof r.debug?r.debug.apply(r,[e,o]):r.log.apply(r,[e,o])):e="\n"+arguments[0]+"\n",t=1,n=arguments.length;t<n;++t){if(i=arguments[t],"object"==typeof i&&"undefined"!=typeof d)try{i=d.stringify(i)}catch(e){}e+="\n"+i+"\n"}return u?(u.value+=e+"\n-----\n",u.scrollTop=u.scrollHeight-u.clientHeight):s||c(e),!0},p.getInternetExplorerMajorVersion=function(){var e=p.getInternetExplorerMajorVersion.cached="undefined"!=typeof p.getInternetExplorerMajorVersion.cached?p.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=a.createElement("div"),r=t.getElementsByTagName("i");(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&r[0];);return e>4&&e}();return e},p.isInternetExplorer=function(){var e=p.isInternetExplorer.cached="undefined"!=typeof p.isInternetExplorer.cached?p.isInternetExplorer.cached:Boolean(p.getInternetExplorerMajorVersion());return e},p.options.html4Mode?p.emulated={pushState:!0,hashChange:!0}:p.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(n.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(n.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in a)||p.isInternetExplorer()&&p.getInternetExplorerMajorVersion()<8)},p.enabled=!p.emulated.pushState,p.bugs={setHash:Boolean(!p.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),safariPoll:Boolean(!p.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),ieDoubleCheck:Boolean(p.isInternetExplorer()&&p.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(p.isInternetExplorer()&&p.getInternetExplorerMajorVersion()<7)},p.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},p.cloneObject=function(e){var t,r;return e?(t=d.stringify(e),r=d.parse(t)):r={},r},p.getRootUrl=function(){var e=a.location.protocol+"//"+(a.location.hostname||a.location.host);return a.location.port&&(e+=":"+a.location.port),e+="/"},p.getBaseHref=function(){var e=a.getElementsByTagName("base"),t=null,r="";return 1===e.length&&(t=e[0],r=t.href.replace(/[^\/]+$/,"")),r=r.replace(/\/+$/,""),r&&(r+="/"),r},p.getBaseUrl=function(){var e=p.getBaseHref()||p.getBasePageUrl()||p.getRootUrl();return e},p.getPageUrl=function(){var e,t=p.getState(!1,!1),r=(t||{}).url||p.getLocationHref();return e=r.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,r){return/\./.test(e)?e:e+"/"})},p.getBasePageUrl=function(){var e=p.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,r){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},p.getFullUrl=function(e,t){var r=e,a=e.substring(0,1);return t="undefined"==typeof t||t,/[a-z]+\:\/\//.test(e)||(r="/"===a?p.getRootUrl()+e.replace(/^\/+/,""):"#"===a?p.getPageUrl().replace(/#.*/,"")+e:"?"===a?p.getPageUrl().replace(/[\?#].*/,"")+e:t?p.getBaseUrl()+e.replace(/^(\.\/)+/,""):p.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),r.replace(/\#$/,"")},p.getShortUrl=function(e){var t=e,r=p.getBaseUrl(),a=p.getRootUrl();return p.emulated.pushState&&(t=t.replace(r,"")),t=t.replace(a,"/"),p.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},p.getLocationHref=function(e){return e=e||a,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:e.URL.indexOf("#")==-1&&e.location.href.indexOf("#")!=-1?e.location.href:e.URL||e.location.href},p.store={},p.idToState=p.idToState||{},p.stateToId=p.stateToId||{},p.urlToId=p.urlToId||{},p.storedStates=p.storedStates||[],p.savedStates=p.savedStates||[],p.normalizeStore=function(){p.store.idToState=p.store.idToState||{},p.store.urlToId=p.store.urlToId||{},p.store.stateToId=p.store.stateToId||{}},p.getState=function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!0);var r=p.getLastSavedState();return!r&&t&&(r=p.createStateObject()),e&&(r=p.cloneObject(r),r.url=r.cleanUrl||r.url),r},p.getIdByState=function(e){var t,r=p.extractId(e.url);if(!r)if(t=p.getStateString(e),"undefined"!=typeof p.stateToId[t])r=p.stateToId[t];else if("undefined"!=typeof p.store.stateToId[t])r=p.store.stateToId[t];else{for(;r=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"!=typeof p.idToState[r]||"undefined"!=typeof p.store.idToState[r];);p.stateToId[t]=r,p.idToState[r]=e}return r},p.normalizeState=function(e){var t,r;return e&&"object"==typeof e||(e={}),"undefined"!=typeof e.normalized?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=p.getFullUrl(e.url?e.url:p.getLocationHref()),t.hash=p.getShortUrl(t.url),t.data=p.cloneObject(e.data),t.id=p.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,r=!p.isEmptyObject(t.data),(t.title||r)&&p.options.disableSuid!==!0&&(t.hash=p.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=p.getFullUrl(t.hash),(p.emulated.pushState||p.bugs.safariPoll)&&p.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)},p.createStateObject=function(e,t,r){var a={data:e,title:t,url:r};return a=p.normalizeState(a)},p.getStateById=function(e){e=String(e);var r=p.idToState[e]||p.store.idToState[e]||t;return r},p.getStateString=function(e){var t,r,a;return t=p.normalizeState(e),r={data:t.data,title:e.title,url:e.url},a=d.stringify(r)},p.getStateId=function(e){var t,r;return t=p.normalizeState(e),r=t.id},p.getHashByState=function(e){var t,r;return t=p.normalizeState(e),r=t.hash},p.extractId=function(e){var t,r,a,n;return n=e.indexOf("#")!=-1?e.split("#")[0]:e,r=/(.*)\&_suid=([0-9]+)$/.exec(n),a=r?r[1]||e:e,t=r?String(r[2]||""):"",t||!1},p.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},p.extractState=function(e,t){var r,a,n=null;return t=t||!1,r=p.extractId(e),r&&(n=p.getStateById(r)),n||(a=p.getFullUrl(e),r=p.getIdByUrl(a)||!1,r&&(n=p.getStateById(r)),!n&&t&&!p.isTraditionalAnchor(e)&&(n=p.createStateObject(null,null,a))),n},p.getIdByUrl=function(e){var r=p.urlToId[e]||p.store.urlToId[e]||t;return r},p.getLastSavedState=function(){return p.savedStates[p.savedStates.length-1]||t},p.getLastStoredState=function(){return p.storedStates[p.storedStates.length-1]||t},p.hasUrlDuplicate=function(e){var t,r=!1;return t=p.extractState(e.url),r=t&&t.id!==e.id},p.storeState=function(e){return p.urlToId[e.url]=e.id,p.storedStates.push(p.cloneObject(e)),e},p.isLastSavedState=function(e){var t,r,a,n=!1;return p.savedStates.length&&(t=e.id,r=p.getLastSavedState(),a=r.id,n=t===a),n},p.saveState=function(e){return!p.isLastSavedState(e)&&(p.savedStates.push(p.cloneObject(e)),!0)},p.getStateByIndex=function(e){var t=null;return t="undefined"==typeof e?p.savedStates[p.savedStates.length-1]:e<0?p.savedStates[p.savedStates.length+e]:p.savedStates[e]},p.getCurrentIndex=function(){var e=null;return e=p.savedStates.length<1?0:p.savedStates.length-1},p.getHash=function(e){var t,r=p.getLocationHref(e);return t=p.getHashByUrl(r)},p.unescapeHash=function(e){var t=p.normalizeHash(e);return t=decodeURIComponent(t)},p.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},p.setHash=function(e,t){var r,n;return t!==!1&&p.busy()?(p.pushQueue({scope:p,callback:p.setHash,args:arguments,queue:t}),!1):(p.busy(!0),r=p.extractState(e,!0),r&&!p.emulated.pushState?p.pushState(r.data,r.title,r.url,!1):p.getHash()!==e&&(p.bugs.setHash?(n=p.getPageUrl(),p.pushState(null,null,n+"#"+e,!1)):a.location.hash=e),p)},p.escapeHash=function(t){var r=p.normalizeHash(t);return r=e.encodeURIComponent(r),p.bugs.hashEscape||(r=r.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),r},p.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=p.unescapeHash(t)},p.setTitle=function(e){var t,r=e.title;r||(t=p.getStateByIndex(0),t&&t.url===e.url&&(r=t.title||p.options.initialTitle));try{a.getElementsByTagName("title")[0].innerHTML=r.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(e){}return a.title=r,p},p.queues=[],p.busy=function(e){if("undefined"!=typeof e?p.busy.flag=e:"undefined"==typeof p.busy.flag&&(p.busy.flag=!1),!p.busy.flag){s(p.busy.timeout);var t=function(){var e,r,a;if(!p.busy.flag)for(e=p.queues.length-1;e>=0;--e)r=p.queues[e],0!==r.length&&(a=r.shift(),p.fireQueueItem(a),p.busy.timeout=i(t,p.options.busyDelay))};p.busy.timeout=i(t,p.options.busyDelay)}return p.busy.flag},p.busy.flag=!1,p.fireQueueItem=function(e){return e.callback.apply(e.scope||p,e.args||[])},p.pushQueue=function(e){return p.queues[e.queue||0]=p.queues[e.queue||0]||[],p.queues[e.queue||0].push(e),p},p.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),"undefined"!=typeof t&&(e.queue=t),p.busy()?p.pushQueue(e):p.fireQueueItem(e),p},p.clearQueue=function(){return p.busy.flag=!1,p.queues=[],p},p.stateChanged=!1,p.doubleChecker=!1,p.doubleCheckComplete=function(){return p.stateChanged=!0,p.doubleCheckClear(),p},p.doubleCheckClear=function(){return p.doubleChecker&&(s(p.doubleChecker),p.doubleChecker=!1),p},p.doubleCheck=function(e){return p.stateChanged=!1,p.doubleCheckClear(),p.bugs.ieDoubleCheck&&(p.doubleChecker=i(function(){return p.doubleCheckClear(),p.stateChanged||e(),!0},p.options.doubleCheckInterval)),p},p.safariStatePoll=function(){var t,r=p.extractState(p.getLocationHref());if(!p.isLastSavedState(r))return t=r,t||(t=p.createStateObject()),p.Adapter.trigger(e,"popstate"),p},p.back=function(e){return e!==!1&&p.busy()?(p.pushQueue({scope:p,callback:p.back,args:arguments,queue:e}),!1):(p.busy(!0),p.doubleCheck(function(){p.back(!1)}),f.go(-1),!0)},p.forward=function(e){return e!==!1&&p.busy()?(p.pushQueue({scope:p,callback:p.forward,args:arguments,queue:e}),!1):(p.busy(!0),p.doubleCheck(function(){p.forward(!1)}),f.go(1),!0)},p.go=function(e,t){var r;if(e>0)for(r=1;r<=e;++r)p.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(r=-1;r>=e;--r)p.back(t)}return p},p.emulated.pushState){var h=function(){};p.pushState=p.pushState||h,p.replaceState=p.replaceState||h}else p.onPopState=function(t,r){var a,n,o=!1,i=!1;return p.doubleCheckComplete(),a=p.getHash(),a?(n=p.extractState(a||p.getLocationHref(),!0),n?p.replaceState(n.data,n.title,n.url,!1):(p.Adapter.trigger(e,"anchorchange"),p.busy(!1)),p.expectedStateId=!1,!1):(o=p.Adapter.extractEventData("state",t,r)||!1,i=o?p.getStateById(o):p.expectedStateId?p.getStateById(p.expectedStateId):p.extractState(p.getLocationHref()),i||(i=p.createStateObject(null,null,p.getLocationHref())),p.expectedStateId=!1,p.isLastSavedState(i)?(p.busy(!1),!1):(p.storeState(i),p.saveState(i),p.setTitle(i),p.Adapter.trigger(e,"statechange"),p.busy(!1),!0))},p.Adapter.bind(e,"popstate",p.onPopState),p.pushState=function(t,r,a,n){if(p.getHashByUrl(a)&&p.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&p.busy())return p.pushQueue({scope:p,callback:p.pushState,args:arguments,queue:n}),!1;p.busy(!0);var o=p.createStateObject(t,r,a);return p.isLastSavedState(o)?p.busy(!1):(p.storeState(o),p.expectedStateId=o.id,f.pushState(o.id,o.title,o.url),p.Adapter.trigger(e,"popstate")),!0},p.replaceState=function(t,r,a,n){if(p.getHashByUrl(a)&&p.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&p.busy())return p.pushQueue({scope:p,callback:p.replaceState,args:arguments,queue:n}),!1;p.busy(!0);var o=p.createStateObject(t,r,a);return p.isLastSavedState(o)?p.busy(!1):(p.storeState(o),p.expectedStateId=o.id,f.replaceState(o.id,o.title,o.url),p.Adapter.trigger(e,"popstate")),!0};if(o){try{p.store=d.parse(o.getItem("History.store"))||{}}catch(e){p.store={}}p.normalizeStore()}else p.store={},p.normalizeStore();p.Adapter.bind(e,"unload",p.clearAllIntervals),p.saveState(p.storeState(p.extractState(p.getLocationHref(),!0))),o&&(p.onUnload=function(){var e,t,r;try{e=d.parse(o.getItem("History.store"))||{}}catch(t){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in p.idToState)p.idToState.hasOwnProperty(t)&&(e.idToState[t]=p.idToState[t]);for(t in p.urlToId)p.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=p.urlToId[t]);for(t in p.stateToId)p.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=p.stateToId[t]);p.store=e,p.normalizeStore(),r=d.stringify(e);try{o.setItem("History.store",r)}catch(e){if(e.code!==DOMException.QUOTA_EXCEEDED_ERR)throw e;o.length&&(o.removeItem("History.store"),o.setItem("History.store",r))}},p.intervalList.push(u(p.onUnload,p.options.storeInterval)),p.Adapter.bind(e,"beforeunload",p.onUnload),p.Adapter.bind(e,"unload",p.onUnload)),p.emulated.pushState||(p.bugs.safariPoll&&p.intervalList.push(u(p.safariStatePoll,p.options.safariPollInterval)),"Apple Computer, Inc."!==n.vendor&&"Mozilla"!==(n.appCodeName||"")||(p.Adapter.bind(e,"hashchange",function(){p.Adapter.trigger(e,"popstate")}),p.getHash()&&p.Adapter.onDomLoad(function(){p.Adapter.trigger(e,"hashchange")})))},(!p.options||!p.options.delayInit)&&p.init()}(window);
+!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";function t(n,s){var i=function(){},o=this,l={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:t.formatResult,onPreSelect:i,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:i,onSearchComplete:i,onSearchError:i,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,lookupFilter:function(e,t,n){return e.value.toLowerCase().indexOf(n)!==-1},paramName:"query",transformResult:function(t){return"string"==typeof t?e.parseJSON(t):t}};o.element=n,o.el=e(n),o.suggestions=[],o.badQueries=[],o.selectedIndex=-1,o.currentValue=o.element.value,o.intervalId=0,o.cachedResponse={},o.onChangeInterval=null,o.onChange=null,o.isLocal=!1,o.suggestionsContainer=null,o.options=e.extend({},l,s),o.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},o.hint=null,o.hintValue="",o.selection=null,o.initialize(),o.setOptions(s)}var n=function(){return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t.style.cursor="pointer",t}}}(),s={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};t.utils=n,e.Autocomplete=t,t.formatResult=function(e,t){var s="("+n.escapeRegExChars(t)+")";return e.value.replace(new RegExp(s,"gi"),"<strong>$1</strong>")},t.prototype={killerFn:null,initialize:function(){var n,s=this,i="."+s.classes.suggestion,o=(s.classes.selected,s.options);s.element.setAttribute("autocomplete","off"),s.killerFn=function(t){0===e(t.target).closest("."+s.options.containerClass).length&&(s.killSuggestions(),s.disableKillerFn())},s.suggestionsContainer=t.utils.createNode(o.containerClass),n=e(s.suggestionsContainer),n.appendTo(o.appendTo),"auto"!==o.width&&n.width(o.width),n.on("click.autocomplete",i,function(){s.select(e(this).data("index"))}),s.fixPosition(),s.fixPositionCapture=function(){s.visible&&s.fixPosition()},e(window).on("resize.autocomplete",s.fixPositionCapture),s.el.on("keydown.autocomplete",function(e){s.onKeyPress(e)}),s.el.on("keyup.autocomplete",function(e){s.onKeyUp(e)}),s.el.on("blur.autocomplete",function(){s.onBlur()}),s.el.on("focus.autocomplete",function(){s.onFocus()}),s.el.on("change.autocomplete",function(e){s.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition(),e.options.minChars<=e.el.val().length},onBlur:function(){this.enableKillerFn()},setOptions:function(t){var n=this,s=n.options;e.extend(s,t),n.isLocal=e.isArray(s.lookup),n.isLocal&&(s.lookup=n.verifySuggestionsFormat(s.lookup)),e(n.suggestionsContainer).css({"max-height":s.maxHeight+"px",width:s.width+"px","z-index":s.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,e.currentRequest&&e.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var t,n,s=this;"body"===s.options.appendTo&&(t=s.el.offset(),n={top:t.top+s.el.outerHeight()+"px",left:t.left+"px"},"auto"===s.options.width&&(n.width=s.el.outerWidth()-2+"px"),e(s.suggestionsContainer).css(n))},enableKillerFn:function(){var t=this;e(document).on("click.autocomplete",t.killerFn)},disableKillerFn:function(){var t=this;e(document).off("click.autocomplete",t.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e,t=this,n=t.el.val().length,s=t.element.selectionStart;return"number"==typeof s?s===n:!document.selection||(e=document.selection.createRange(),e.moveStart("character",-n),n===e.text.length)},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.which===s.DOWN&&t.currentValue)return void t.suggest();if(!t.disabled&&t.visible){switch(e.which){case s.ESC:t.el.val(t.currentValue),t.hide();break;case s.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case s.TAB:if(t.hint&&t.options.onHint)return void t.selectHint();case s.RETURN:if(t.selectedIndex===-1)return void t.hide();if(t.select(t.selectedIndex),e.which===s.TAB&&t.options.tabDisabled===!1)return;break;case s.UP:t.moveUp();break;case s.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case s.UP:case s.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var t,n=this,s=n.options,i=n.el.val(),o=n.getQuery(i);return n.selection&&(n.selection=null,(s.onInvalidateSelection||e.noop).call(n.element)),clearInterval(n.onChangeInterval),n.currentValue=i,n.selectedIndex=-1,s.triggerSelectOnValidInput&&(t=n.findSuggestionIndex(o),t!==-1)?void n.select(t):void(o.length<s.minChars?n.hide():n.getSuggestions(o))},findSuggestionIndex:function(t){var n=this,s=-1,i=t.toLowerCase();return e.each(n.suggestions,function(e,t){if(t.value.toLowerCase()===i)return s=e,!1}),s},getQuery:function(t){var n,s=this.options.delimiter;return s?(n=t.split(s),e.trim(n[n.length-1])):t},getSuggestionsLocal:function(t){var n,s=this,i=s.options,o=t.toLowerCase(),l=i.lookupFilter,a=parseInt(i.lookupLimit,10);return n={suggestions:e.grep(i.lookup,function(e){return l(e,t,o)})},a&&n.suggestions.length>a&&(n.suggestions=n.suggestions.slice(0,a)),n},getSuggestions:function(t){var n,s,i,o=this,l=o.options,a=l.serviceUrl;if(l.params[l.paramName]=t,s=l.ignoreParams?null:l.params,o.isLocal?n=o.getSuggestionsLocal(t):(e.isFunction(a)&&(a=a.call(o.element,t)),i=a+"?"+e.param(s||{}),n=o.cachedResponse[i]),n&&e.isArray(n.suggestions))o.suggestions=n.suggestions,o.suggest();else if(!o.isBadQuery(t)){if(l.onSearchStart.call(o.element,l.params)===!1)return;o.currentRequest&&o.currentRequest.abort(),o.currentRequest=e.ajax({url:a,data:s,type:l.type,dataType:l.dataType}).done(function(e){o.currentRequest=null,o.processResponse(e,t,i),l.onSearchComplete.call(o.element,t)}).fail(function(e,n,s){l.onSearchError.call(o.element,t,e,n,s)})}},isBadQuery:function(e){for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var t=this;t.visible=!1,t.selectedIndex=-1,e(t.suggestionsContainer).hide(),t.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var t,n,s=this,i=s.options,o=i.formatResult,l=s.getQuery(s.currentValue),a=s.classes.suggestion,r=s.classes.selected,u=e(s.suggestionsContainer),c=i.beforeRender,g="";return i.triggerSelectOnValidInput&&(t=s.findSuggestionIndex(l),t!==-1)?void s.select(t):(e.each(s.suggestions,function(e,t){g+='<div class="'+a+'" data-index="'+e+'">'+o(t,l)+"</div>"}),"auto"===i.width&&(n=s.el.outerWidth()-2,u.width(n>0?n:300)),u.html(g),i.autoSelectFirst&&(s.selectedIndex=0,u.children().first().addClass(r)),e.isFunction(c)&&c.call(s.element,u),u.show(),s.visible=!0,void s.findBestHint())},findBestHint:function(){var t=this,n=t.el.val().toLowerCase(),s=null;n&&(e.each(t.suggestions,function(e,t){var i=0===t.value.toLowerCase().indexOf(n);return i&&(s=t),!i}),t.signalHint(s))},signalHint:function(t){var n="",s=this;t&&(n=s.currentValue+t.value.substr(s.currentValue.length)),s.hintValue!==n&&(s.hintValue=n,s.hint=t,(this.options.onHint||e.noop)(n))},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,function(e){return{value:e,data:null}}):t},processResponse:function(e,t,n){var s=this,i=s.options,o=i.transformResult(e,t);o.suggestions=s.verifySuggestionsFormat(o.suggestions),i.noCache||(s.cachedResponse[n]=o,0===o.suggestions.length&&s.badQueries.push(n)),t===s.getQuery(s.currentValue)&&(s.suggestions=o.suggestions,s.suggest())},activate:function(t){var n,s=this,i=s.classes.selected,o=e(s.suggestionsContainer),l=o.children();return s.selectedIndex===t?null:(o.children("."+i).removeClass(i),s.selectedIndex=t,s.selectedIndex!==-1&&l.length>s.selectedIndex?(n=l.get(s.selectedIndex),e(n).addClass(i),s.options.onPreSelect(s.suggestions[t],n),n):null)},selectHint:function(){var t=this,n=e.inArray(t.hint,t.suggestions);t.select(n)},select:function(e){var t=this;t.hide(),t.onSelect(e)},moveUp:function(){var t=this;if(t.selectedIndex!==-1)return 0===t.selectedIndex?(e(t.suggestionsContainer).children().first().removeClass(t.classes.selected),t.selectedIndex=-1,t.el.val(t.currentValue),void t.findBestHint()):void t.adjustScroll(t.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n,s,i,o=this,l=o.activate(t),a=25;l&&(n=l.offsetTop,s=e(o.suggestionsContainer).scrollTop(),i=s+o.options.maxHeight-a,n<s?e(o.suggestionsContainer).scrollTop(n):n>i&&e(o.suggestionsContainer).scrollTop(n-o.options.maxHeight+a),o.el.val(o.getValue(o.suggestions[t].value)),o.signalHint(null))},onSelect:function(t){var n=this,s=n.options.onSelect,i=n.suggestions[t];n.currentValue=n.getValue(i.value),n.el.val(n.currentValue),n.signalHint(null),n.suggestions=[],n.selection=i,e.isFunction(s)&&s.call(n.element,i)},getValue:function(e){var t,n,s=this,i=s.options.delimiter;return i?(t=s.currentValue,n=t.split(i),1===n.length?e:t.substr(0,t.length-n[n.length-1].length)+e):e},dispose:function(){var t=this;t.el.off(".autocomplete").removeData("autocomplete"),t.disableKillerFn(),e(window).off("resize.autocomplete",t.fixPositionCapture),e(t.suggestionsContainer).remove()}},e.fn.autocomplete=function(n,s){var i="autocomplete";return 0===arguments.length?this.first().data(i):this.each(function(){var o=e(this),l=o.data(i);"string"==typeof n?l&&"function"==typeof l[n]&&l[n](s):(l&&l.dispose&&l.dispose(),l=new t(this,n),o.data(i,l))})}});
 
 },{}],17:[function(require,module,exports){
-L.Map.mergeOptions({contextmenuItems:[]}),L.Map.ContextMenu=L.Handler.extend({statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(t){L.Handler.prototype.initialize.call(this,t),this._items=[],this._sets=[],this._state=0,this._defaultState=t.options.contextmenuDefaultState||1,this._activeState=t.options.contextmenuAtiveState||1,this._visible=!1;var e=this._container=L.DomUtil.create("div",L.Map.ContextMenu.BASE_CLS,t._container);e.style.zIndex=1e4,e.style.position="absolute",t.options.contextmenuWidth&&(e.style.width=t.options.contextmenuWidth+"px"),void 0!==t.options.contextmenuSets&&0!==t.options.contextmenuSets.length||(t.options.contextmenuSets=[{name:"set_default",state:this._defaultState}]),this._createItems(),this._createSets(),this._changeState(),L.DomEvent.on(e,"click",L.DomEvent.stop).on(e,"mousedown",L.DomEvent.stop).on(e,"dblclick",L.DomEvent.stop).on(e,"contextmenu",L.DomEvent.stop)},addHooks:function(){L.DomEvent.on(document,L.Browser.touch?"touchstart":"mousedown",this._onMouseDown,this).on(document,"keydown",this._onKeyDown,this),this._map.on({contextmenu:this._show,mouseout:this._hide,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},removeHooks:function(){L.DomEvent.off(document,"keydown",this._onKeyDown,this),this._map.off({contextmenu:this._show,mouseout:this._hide,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},showAt:function(t,e,i){t instanceof L.LatLng&&(t=this._map.latLngToContainerPoint(t)),this._showAtPoint(t,e,i)},hide:function(){this._hide()},setState:function(t){return this._changeState(t)},setActiveState:function(t){var e,i,n,t=void 0!==t?t:this._activeState;for(i=0,n=this._sets.length;i<n;i++)if(e=this._sets[i],e.state===t){this._activeState=t;break}return e},getState:function(){return this._state},addSet:function(t){return this.insertSet(t)},insertSet:function(t,e){var e=void 0!==e?e:this._sets.length,i=this._createSet(t,e);return this._sets.push(i),i},addItem:function(t){return this.insertItem(t)},insertItem:function(t,e){var e=void 0!==e?e:this._items.length,i=this._createItem(this._container,t,e);return this._items.push(i),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:i.el,index:e}),i.el},removeItem:function(t){var e=this._container;isNaN(t)||(t=e.children[t]),void 0!==t&&(this._removeItem(L.Util.stamp(t)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:t}))},removeAllItems:function(){for(var t;this._container.children.length;)t=this._container.children[0],this._removeItem(L.Util.stamp(t))},setDisabled:function(t,e){var i=this._container,n=L.Map.ContextMenu.BASE_CLS+"-item";isNaN(t)||(t=i.children[t]),void 0!==t&&L.DomUtil.hasClass(t,n)&&(e?(L.DomUtil.addClass(t,n+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:t})):(L.DomUtil.removeClass(t,n+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:t})))},setHidden:function(t,e){var i=this._container,n=L.Map.ContextMenu.BASE_CLS+"-item",s=L.Map.ContextMenu.BASE_CLS+"-separator";isNaN(t)||(t=i.children[t]),void 0!==t&&L.DomUtil.hasClass(t,n)?e?(L.DomUtil.addClass(t,n+"-hidden"),this._map.fire("contextmenu.hideitem",{contextmenu:this,el:t})):(L.DomUtil.removeClass(t,n+"-hidden"),this._map.fire("contextmenu.showitem",{contextmenu:this,el:t})):void 0!==t&&L.DomUtil.hasClass(t,s)&&(e?L.DomUtil.addClass(t,s+"-hidden"):L.DomUtil.removeClass(t,s+"-hidden"))},isVisible:function(){return this._visible},_changeState:function(t){var e,i,n,s,t=void 0!==t?t:this._defaultState;if(t!==this._state)for(n=0,s=this._sets.length;n<s;n++)if(e=this._sets[n],e.state===t||e.name===t&&e.state!==this._state){for(this._map.fire("contextmenu.changestate",{contextmenu:this,set:e,state:t}),n=0,s=this._items.length;n<s;n++)i=this._items[n],this.setHidden(this._items[n].el,i.state.indexOf(e.state)===-1&&i.state.indexOf(e.name)===-1);this._sizeChanged=!0,this._state=t;break}return e},_createSets:function(){var t,e,i=this._map.options.contextmenuSets;for(t=0,e=i.length;t<e;t++)this._sets.push(this._createSet(i[t],this._sets.length))},_createSet:function(t,e){void 0!==t.name?t.name:"set_"+e;return{id:e,name:t.name,state:t.state}},_createItems:function(){var t,e,i=this._map.options.contextmenuItems;for(t=0,e=i.length;t<e;t++)this._items.push(this._createItem(this._container,i[t]))},_createItem:function(t,e,i){if(e.separator||"-"===e)return this._createSeparator(t,i,e.state);var n=L.Map.ContextMenu.BASE_CLS+"-item",s=void 0!==e.state?Array.isArray(e.state)?e.state:[e.state]:[this._defaultState],o=e.disabled?n+" "+n+"-disabled":e.hidden?n+" "+n+"-hidden":n,a=this._insertElementAt("a",o,t,i),h=this._createEventHandler(a,e.callback,e.context,e.hideOnSelect),m="";return e.icon?m='<img class="'+L.Map.ContextMenu.BASE_CLS+'-icon" src="'+e.icon+'"/>':e.iconCls&&(m='<span class="'+L.Map.ContextMenu.BASE_CLS+"- icon "+e.iconCls+'"></span>'),a.innerHTML=m+e.text,a.href="#",L.DomEvent.on(a,"mouseover",this._onItemMouseOver,this).on(a,"mouseout",this._onItemMouseOut,this).on(a,"mousedown",L.DomEvent.stopPropagation).on(a,"click",h),{id:L.Util.stamp(a),el:a,callback:h,state:s}},_removeItem:function(t){var e,i,n,s,o;for(s=0,o=this._items.length;s<o;s++)if(e=this._items[s],e.id===t)return n=e.el,i=e.callback,i&&L.DomEvent.off(n,"mouseover",this._onItemMouseOver,this).off(n,"mouseover",this._onItemMouseOut,this).off(n,"mousedown",L.DomEvent.stopPropagation).off(n,"click",e.callback),this._container.removeChild(n),this._items.splice(s,1),e;return null},_createSeparator:function(t,e,i){var n=this._insertElementAt("div",L.Map.ContextMenu.BASE_CLS+"-separator",t,e),i=void 0!==i?Array.isArray(i)?i:[i]:[this._defaultState];return{id:L.Util.stamp(n),el:n,state:i}},_createEventHandler:function(t,e,i,n){var s=this,o=this._map,a=L.Map.ContextMenu.BASE_CLS+"-item-disabled",n=void 0===n||n;return function(h){L.DomUtil.hasClass(t,a)||(n&&s._hide(),e&&e.call(i||o,s._showLocation),s._map.fire("contextmenu:select",{contextmenu:s,el:t}))}},_insertElementAt:function(t,e,i,n){var s,o=document.createElement(t);return o.className=e,void 0!==n&&(s=i.children[n]),s?i.insertBefore(o,s):i.appendChild(o),o},_show:function(t){this._showAtPoint(t.containerPoint)},_showAtPoint:function(t,e,i){if(this._items.length){var n=this._map,s=n.containerPointToLayerPoint(t),o=n.layerPointToLatLng(s),a={contextmenu:this,state:i},i=void 0!==i?i:this._activeState;e&&(a=L.extend(e,a)),this._showLocation={state:i,target:e?e.relatedTarget:null,latlng:o,layerPoint:s,containerPoint:t},this._setPosition(t),this._changeState(i),this._visible?this._setPosition(t):(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",a)}},_hide:function(){this._visible&&(this.setState(this._defaultState),this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_setPosition:function(t){var e,i=this._map.getSize(),n=this._container,s=this._getElementSize(n);this._map.options.contextmenuAnchor&&(e=L.point(this._map.options.contextmenuAnchor),t=t.add(e)),n._leaflet_pos=t,t.x+s.x>i.x?(n.style.left="auto",n.style.right=Math.max(i.x-t.x,0)+"px"):(n.style.left=Math.max(t.x,0)+"px",n.style.right="auto"),t.y+s.y>i.y?(n.style.top="auto",n.style.bottom=Math.max(i.y-t.y,0)+"px"):(n.style.top=Math.max(t.y,0)+"px",n.style.bottom="auto")},_getElementSize:function(t){var e=this._size,i=t.style.display;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display=i,this._sizeChanged=!1),e},_onMouseDown:function(t){this._hide()},_onKeyDown:function(t){var e=t.keyCode;27===e&&this._hide()},_onItemMouseOver:function(t){L.DomUtil.addClass(t.target,"over")},_onItemMouseOut:function(t){L.DomUtil.removeClass(t.target,"over")}}),L.Map.addInitHook("addHandler","contextmenu",L.Map.ContextMenu),L.Mixin.ContextMenu={_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(t){var e,i,n,s;if(this._map.contextmenu){for(i=this._map.mouseEventToContainerPoint(t.originalEvent),n=0,s=this.options.contextmenuItems.length;n<s;n++)e=this.options.contextmenuItems[n],this._items.push(this._map.contextmenu.insertItem(e,e.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(i,{relatedTarget:this},this.options.contextmenuAtiveState)}},_hideContextMenu:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._map.contextmenu.removeItem(this._items[t]);this._items.length=0}},L.Marker.mergeOptions({contextmenu:!1,contextmenuItems:[]}),L.Marker.addInitHook(function(){this.options.contextmenu&&this._initContextMenu()}),L.Marker.include(L.Mixin.ContextMenu),L.Path.mergeOptions({contextmenu:!1,contextmenuItems:[]}),L.Path.addInitHook(function(){this.options.contextmenu&&this._initContextMenu()}),L.Path.include(L.Mixin.ContextMenu);
+!function(e,t){"use strict";var r=e.History=e.History||{},a=e.jQuery;if("undefined"!=typeof r.Adapter)throw new Error("History.js Adapter has already been loaded...");r.Adapter={bind:function(e,t,r){a(e).bind(t,r)},trigger:function(e,t,r){a(e).trigger(t,r)},extractEventData:function(e,r,a){var n=r&&r.originalEvent&&r.originalEvent[e]||a&&a[e]||t;return n},onDomLoad:function(e){a(e)}},"undefined"!=typeof r.init&&r.init()}(window),function(e,t){"use strict";var r=e.console||t,a=e.document,n=e.navigator,o=e.sessionStorage||!1,i=e.setTimeout,s=e.clearTimeout,u=e.setInterval,l=e.clearInterval,d=e.JSON,c=e.alert,p=e.History=e.History||{},f=e.history;try{o.setItem("TEST","1"),o.removeItem("TEST")}catch(e){o=!1}if(d.stringify=d.stringify||d.encode,d.parse=d.parse||d.decode,"undefined"!=typeof p.init)throw new Error("History.js Core has already been loaded...");p.init=function(e){return"undefined"!=typeof p.Adapter&&("undefined"!=typeof p.initCore&&p.initCore(),"undefined"!=typeof p.initHtml4&&p.initHtml4(),!0)},p.initCore=function(g){if("undefined"!=typeof p.initCore.initialized)return!1;if(p.initCore.initialized=!0,p.options=p.options||{},p.options.hashChangeInterval=p.options.hashChangeInterval||100,p.options.safariPollInterval=p.options.safariPollInterval||500,p.options.doubleCheckInterval=p.options.doubleCheckInterval||500,p.options.disableSuid=p.options.disableSuid||!1,p.options.storeInterval=p.options.storeInterval||1e3,p.options.busyDelay=p.options.busyDelay||250,p.options.debug=p.options.debug||!1,p.options.initialTitle=p.options.initialTitle||a.title,p.options.html4Mode=p.options.html4Mode||!1,p.options.delayInit=p.options.delayInit||!1,p.intervalList=[],p.clearAllIntervals=function(){var e,t=p.intervalList;if("undefined"!=typeof t&&null!==t){for(e=0;e<t.length;e++)l(t[e]);p.intervalList=null}},p.debug=function(){(p.options.debug||!1)&&p.log.apply(p,arguments)},p.log=function(){var e,t,n,o,i,s="undefined"!=typeof r&&"undefined"!=typeof r.log&&"undefined"!=typeof r.log.apply,u=a.getElementById("log");for(s?(o=Array.prototype.slice.call(arguments),e=o.shift(),"undefined"!=typeof r.debug?r.debug.apply(r,[e,o]):r.log.apply(r,[e,o])):e="\n"+arguments[0]+"\n",t=1,n=arguments.length;t<n;++t){if(i=arguments[t],"object"==typeof i&&"undefined"!=typeof d)try{i=d.stringify(i)}catch(e){}e+="\n"+i+"\n"}return u?(u.value+=e+"\n-----\n",u.scrollTop=u.scrollHeight-u.clientHeight):s||c(e),!0},p.getInternetExplorerMajorVersion=function(){var e=p.getInternetExplorerMajorVersion.cached="undefined"!=typeof p.getInternetExplorerMajorVersion.cached?p.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=a.createElement("div"),r=t.getElementsByTagName("i");(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&r[0];);return e>4&&e}();return e},p.isInternetExplorer=function(){var e=p.isInternetExplorer.cached="undefined"!=typeof p.isInternetExplorer.cached?p.isInternetExplorer.cached:Boolean(p.getInternetExplorerMajorVersion());return e},p.options.html4Mode?p.emulated={pushState:!0,hashChange:!0}:p.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(n.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(n.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in a)||p.isInternetExplorer()&&p.getInternetExplorerMajorVersion()<8)},p.enabled=!p.emulated.pushState,p.bugs={setHash:Boolean(!p.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),safariPoll:Boolean(!p.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),ieDoubleCheck:Boolean(p.isInternetExplorer()&&p.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(p.isInternetExplorer()&&p.getInternetExplorerMajorVersion()<7)},p.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},p.cloneObject=function(e){var t,r;return e?(t=d.stringify(e),r=d.parse(t)):r={},r},p.getRootUrl=function(){var e=a.location.protocol+"//"+(a.location.hostname||a.location.host);return a.location.port&&(e+=":"+a.location.port),e+="/"},p.getBaseHref=function(){var e=a.getElementsByTagName("base"),t=null,r="";return 1===e.length&&(t=e[0],r=t.href.replace(/[^\/]+$/,"")),r=r.replace(/\/+$/,""),r&&(r+="/"),r},p.getBaseUrl=function(){var e=p.getBaseHref()||p.getBasePageUrl()||p.getRootUrl();return e},p.getPageUrl=function(){var e,t=p.getState(!1,!1),r=(t||{}).url||p.getLocationHref();return e=r.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,r){return/\./.test(e)?e:e+"/"})},p.getBasePageUrl=function(){var e=p.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,r){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},p.getFullUrl=function(e,t){var r=e,a=e.substring(0,1);return t="undefined"==typeof t||t,/[a-z]+\:\/\//.test(e)||(r="/"===a?p.getRootUrl()+e.replace(/^\/+/,""):"#"===a?p.getPageUrl().replace(/#.*/,"")+e:"?"===a?p.getPageUrl().replace(/[\?#].*/,"")+e:t?p.getBaseUrl()+e.replace(/^(\.\/)+/,""):p.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),r.replace(/\#$/,"")},p.getShortUrl=function(e){var t=e,r=p.getBaseUrl(),a=p.getRootUrl();return p.emulated.pushState&&(t=t.replace(r,"")),t=t.replace(a,"/"),p.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},p.getLocationHref=function(e){return e=e||a,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:e.URL.indexOf("#")==-1&&e.location.href.indexOf("#")!=-1?e.location.href:e.URL||e.location.href},p.store={},p.idToState=p.idToState||{},p.stateToId=p.stateToId||{},p.urlToId=p.urlToId||{},p.storedStates=p.storedStates||[],p.savedStates=p.savedStates||[],p.normalizeStore=function(){p.store.idToState=p.store.idToState||{},p.store.urlToId=p.store.urlToId||{},p.store.stateToId=p.store.stateToId||{}},p.getState=function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!0);var r=p.getLastSavedState();return!r&&t&&(r=p.createStateObject()),e&&(r=p.cloneObject(r),r.url=r.cleanUrl||r.url),r},p.getIdByState=function(e){var t,r=p.extractId(e.url);if(!r)if(t=p.getStateString(e),"undefined"!=typeof p.stateToId[t])r=p.stateToId[t];else if("undefined"!=typeof p.store.stateToId[t])r=p.store.stateToId[t];else{for(;r=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"!=typeof p.idToState[r]||"undefined"!=typeof p.store.idToState[r];);p.stateToId[t]=r,p.idToState[r]=e}return r},p.normalizeState=function(e){var t,r;return e&&"object"==typeof e||(e={}),"undefined"!=typeof e.normalized?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=p.getFullUrl(e.url?e.url:p.getLocationHref()),t.hash=p.getShortUrl(t.url),t.data=p.cloneObject(e.data),t.id=p.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,r=!p.isEmptyObject(t.data),(t.title||r)&&p.options.disableSuid!==!0&&(t.hash=p.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=p.getFullUrl(t.hash),(p.emulated.pushState||p.bugs.safariPoll)&&p.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)},p.createStateObject=function(e,t,r){var a={data:e,title:t,url:r};return a=p.normalizeState(a)},p.getStateById=function(e){e=String(e);var r=p.idToState[e]||p.store.idToState[e]||t;return r},p.getStateString=function(e){var t,r,a;return t=p.normalizeState(e),r={data:t.data,title:e.title,url:e.url},a=d.stringify(r)},p.getStateId=function(e){var t,r;return t=p.normalizeState(e),r=t.id},p.getHashByState=function(e){var t,r;return t=p.normalizeState(e),r=t.hash},p.extractId=function(e){var t,r,a,n;return n=e.indexOf("#")!=-1?e.split("#")[0]:e,r=/(.*)\&_suid=([0-9]+)$/.exec(n),a=r?r[1]||e:e,t=r?String(r[2]||""):"",t||!1},p.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},p.extractState=function(e,t){var r,a,n=null;return t=t||!1,r=p.extractId(e),r&&(n=p.getStateById(r)),n||(a=p.getFullUrl(e),r=p.getIdByUrl(a)||!1,r&&(n=p.getStateById(r)),!n&&t&&!p.isTraditionalAnchor(e)&&(n=p.createStateObject(null,null,a))),n},p.getIdByUrl=function(e){var r=p.urlToId[e]||p.store.urlToId[e]||t;return r},p.getLastSavedState=function(){return p.savedStates[p.savedStates.length-1]||t},p.getLastStoredState=function(){return p.storedStates[p.storedStates.length-1]||t},p.hasUrlDuplicate=function(e){var t,r=!1;return t=p.extractState(e.url),r=t&&t.id!==e.id},p.storeState=function(e){return p.urlToId[e.url]=e.id,p.storedStates.push(p.cloneObject(e)),e},p.isLastSavedState=function(e){var t,r,a,n=!1;return p.savedStates.length&&(t=e.id,r=p.getLastSavedState(),a=r.id,n=t===a),n},p.saveState=function(e){return!p.isLastSavedState(e)&&(p.savedStates.push(p.cloneObject(e)),!0)},p.getStateByIndex=function(e){var t=null;return t="undefined"==typeof e?p.savedStates[p.savedStates.length-1]:e<0?p.savedStates[p.savedStates.length+e]:p.savedStates[e]},p.getCurrentIndex=function(){var e=null;return e=p.savedStates.length<1?0:p.savedStates.length-1},p.getHash=function(e){var t,r=p.getLocationHref(e);return t=p.getHashByUrl(r)},p.unescapeHash=function(e){var t=p.normalizeHash(e);return t=decodeURIComponent(t)},p.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},p.setHash=function(e,t){var r,n;return t!==!1&&p.busy()?(p.pushQueue({scope:p,callback:p.setHash,args:arguments,queue:t}),!1):(p.busy(!0),r=p.extractState(e,!0),r&&!p.emulated.pushState?p.pushState(r.data,r.title,r.url,!1):p.getHash()!==e&&(p.bugs.setHash?(n=p.getPageUrl(),p.pushState(null,null,n+"#"+e,!1)):a.location.hash=e),p)},p.escapeHash=function(t){var r=p.normalizeHash(t);return r=e.encodeURIComponent(r),p.bugs.hashEscape||(r=r.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),r},p.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=p.unescapeHash(t)},p.setTitle=function(e){var t,r=e.title;r||(t=p.getStateByIndex(0),t&&t.url===e.url&&(r=t.title||p.options.initialTitle));try{a.getElementsByTagName("title")[0].innerHTML=r.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(e){}return a.title=r,p},p.queues=[],p.busy=function(e){if("undefined"!=typeof e?p.busy.flag=e:"undefined"==typeof p.busy.flag&&(p.busy.flag=!1),!p.busy.flag){s(p.busy.timeout);var t=function(){var e,r,a;if(!p.busy.flag)for(e=p.queues.length-1;e>=0;--e)r=p.queues[e],0!==r.length&&(a=r.shift(),p.fireQueueItem(a),p.busy.timeout=i(t,p.options.busyDelay))};p.busy.timeout=i(t,p.options.busyDelay)}return p.busy.flag},p.busy.flag=!1,p.fireQueueItem=function(e){return e.callback.apply(e.scope||p,e.args||[])},p.pushQueue=function(e){return p.queues[e.queue||0]=p.queues[e.queue||0]||[],p.queues[e.queue||0].push(e),p},p.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),"undefined"!=typeof t&&(e.queue=t),p.busy()?p.pushQueue(e):p.fireQueueItem(e),p},p.clearQueue=function(){return p.busy.flag=!1,p.queues=[],p},p.stateChanged=!1,p.doubleChecker=!1,p.doubleCheckComplete=function(){return p.stateChanged=!0,p.doubleCheckClear(),p},p.doubleCheckClear=function(){return p.doubleChecker&&(s(p.doubleChecker),p.doubleChecker=!1),p},p.doubleCheck=function(e){return p.stateChanged=!1,p.doubleCheckClear(),p.bugs.ieDoubleCheck&&(p.doubleChecker=i(function(){return p.doubleCheckClear(),p.stateChanged||e(),!0},p.options.doubleCheckInterval)),p},p.safariStatePoll=function(){var t,r=p.extractState(p.getLocationHref());if(!p.isLastSavedState(r))return t=r,t||(t=p.createStateObject()),p.Adapter.trigger(e,"popstate"),p},p.back=function(e){return e!==!1&&p.busy()?(p.pushQueue({scope:p,callback:p.back,args:arguments,queue:e}),!1):(p.busy(!0),p.doubleCheck(function(){p.back(!1)}),f.go(-1),!0)},p.forward=function(e){return e!==!1&&p.busy()?(p.pushQueue({scope:p,callback:p.forward,args:arguments,queue:e}),!1):(p.busy(!0),p.doubleCheck(function(){p.forward(!1)}),f.go(1),!0)},p.go=function(e,t){var r;if(e>0)for(r=1;r<=e;++r)p.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(r=-1;r>=e;--r)p.back(t)}return p},p.emulated.pushState){var h=function(){};p.pushState=p.pushState||h,p.replaceState=p.replaceState||h}else p.onPopState=function(t,r){var a,n,o=!1,i=!1;return p.doubleCheckComplete(),a=p.getHash(),a?(n=p.extractState(a||p.getLocationHref(),!0),n?p.replaceState(n.data,n.title,n.url,!1):(p.Adapter.trigger(e,"anchorchange"),p.busy(!1)),p.expectedStateId=!1,!1):(o=p.Adapter.extractEventData("state",t,r)||!1,i=o?p.getStateById(o):p.expectedStateId?p.getStateById(p.expectedStateId):p.extractState(p.getLocationHref()),i||(i=p.createStateObject(null,null,p.getLocationHref())),p.expectedStateId=!1,p.isLastSavedState(i)?(p.busy(!1),!1):(p.storeState(i),p.saveState(i),p.setTitle(i),p.Adapter.trigger(e,"statechange"),p.busy(!1),!0))},p.Adapter.bind(e,"popstate",p.onPopState),p.pushState=function(t,r,a,n){if(p.getHashByUrl(a)&&p.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&p.busy())return p.pushQueue({scope:p,callback:p.pushState,args:arguments,queue:n}),!1;p.busy(!0);var o=p.createStateObject(t,r,a);return p.isLastSavedState(o)?p.busy(!1):(p.storeState(o),p.expectedStateId=o.id,f.pushState(o.id,o.title,o.url),p.Adapter.trigger(e,"popstate")),!0},p.replaceState=function(t,r,a,n){if(p.getHashByUrl(a)&&p.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&p.busy())return p.pushQueue({scope:p,callback:p.replaceState,args:arguments,queue:n}),!1;p.busy(!0);var o=p.createStateObject(t,r,a);return p.isLastSavedState(o)?p.busy(!1):(p.storeState(o),p.expectedStateId=o.id,f.replaceState(o.id,o.title,o.url),p.Adapter.trigger(e,"popstate")),!0};if(o){try{p.store=d.parse(o.getItem("History.store"))||{}}catch(e){p.store={}}p.normalizeStore()}else p.store={},p.normalizeStore();p.Adapter.bind(e,"unload",p.clearAllIntervals),p.saveState(p.storeState(p.extractState(p.getLocationHref(),!0))),o&&(p.onUnload=function(){var e,t,r;try{e=d.parse(o.getItem("History.store"))||{}}catch(t){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in p.idToState)p.idToState.hasOwnProperty(t)&&(e.idToState[t]=p.idToState[t]);for(t in p.urlToId)p.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=p.urlToId[t]);for(t in p.stateToId)p.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=p.stateToId[t]);p.store=e,p.normalizeStore(),r=d.stringify(e);try{o.setItem("History.store",r)}catch(e){if(e.code!==DOMException.QUOTA_EXCEEDED_ERR)throw e;o.length&&(o.removeItem("History.store"),o.setItem("History.store",r))}},p.intervalList.push(u(p.onUnload,p.options.storeInterval)),p.Adapter.bind(e,"beforeunload",p.onUnload),p.Adapter.bind(e,"unload",p.onUnload)),p.emulated.pushState||(p.bugs.safariPoll&&p.intervalList.push(u(p.safariStatePoll,p.options.safariPollInterval)),"Apple Computer, Inc."!==n.vendor&&"Mozilla"!==(n.appCodeName||"")||(p.Adapter.bind(e,"hashchange",function(){p.Adapter.trigger(e,"popstate")}),p.getHash()&&p.Adapter.onDomLoad(function(){p.Adapter.trigger(e,"hashchange")})))},(!p.options||!p.options.delayInit)&&p.init()}(window);
 
 },{}],18:[function(require,module,exports){
 L.Control.Elevation=L.Control.extend({options:{position:"topright",theme:"lime-theme",width:600,height:175,margins:{top:10,right:20,bottom:30,left:60},useHeightIndicator:!0,interpolation:"linear",hoverNumber:{decimalsX:3,decimalsY:0,formatter:void 0},xTicks:void 0,yTicks:void 0,collapsed:!1,yAxisMin:void 0,yAxisMax:void 0,forceAxisBounds:!1,controlButton:{iconCssClass:"elevation-toggle-icon",title:"Elevation"},imperial:!1},__mileFactor:.621371,__footFactor:3.28084,onRemove:function(t){this._container=null},onAdd:function(t){this._map=t;var i=this.options,e=i.margins;i.xTicks=i.xTicks||Math.round(this._width()/75),i.yTicks=i.yTicks||Math.round(this._height()/30),i.hoverNumber.formatter=i.hoverNumber.formatter||this._formatter;var a=this._x=d3.scale.linear().range([0,this._width()]),s=this._y=d3.scale.linear().range([this._height(),0]),o=(this._area=d3.svg.area().interpolate(i.interpolation).x(function(t){var i=a(t.dist);return t.xDiagCoord=i,i}).y0(this._height()).y1(function(t){return s(t.altitude)}),this._container=L.DomUtil.create("div","elevation"));L.DomUtil.addClass(o,i.theme),this._initToggle();var r=d3.select(o);r.attr("width",i.width);var n=r.append("svg");n.attr("width",i.width).attr("class","background").attr("height",i.height).append("g").attr("transform","translate("+e.left+","+e.top+")");var h=d3.svg.line();h=h.x(function(t){return d3.mouse(n.select("g"))[0]}).y(function(t){return this._height()});var l=d3.select(this._container).select("svg").select("g");this._areapath=l.append("path").attr("class","area");var d=this._background=l.append("rect").attr("width",this._width()).attr("height",this._height()).style("fill","none").style("stroke","none").style("pointer-events","all");L.Browser.touch?(d.on("touchmove.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focus",this._mousemoveHandler.bind(this)),L.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)):(d.on("mousemove.focus",this._mousemoveHandler.bind(this)).on("mouseout.focus",this._mouseoutHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mousemove.drag",this._dragHandler.bind(this)),L.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this)),this._xaxisgraphicnode=l.append("g"),this._yaxisgraphicnode=l.append("g"),this._appendXaxis(this._xaxisgraphicnode),this._appendYaxis(this._yaxisgraphicnode);var c=this._focusG=l.append("g");return this._mousefocus=c.append("svg:line").attr("class","mouse-focus-line").attr("x2","0").attr("y2","0").attr("x1","0").attr("y1","0"),this._focuslabelX=c.append("svg:text").style("pointer-events","none").attr("class","mouse-focus-label-x"),this._focuslabelY=c.append("svg:text").style("pointer-events","none").attr("class","mouse-focus-label-y"),this._data&&this._applyData(),o},_dragHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_drawDragRectangle:function(){if(this._dragStartCoords){var t=this._dragCurrentCoords=d3.mouse(this._background.node()),i=Math.min(this._dragStartCoords[0],t[0]),e=Math.max(this._dragStartCoords[0],t[0]);if(this._dragRectangle||this._dragRectangleG)this._dragRectangle.attr("width",e-i).attr("x",i);else{var a=d3.select(this._container).select("svg").select("g");this._dragRectangleG=a.append("g"),this._dragRectangle=this._dragRectangleG.append("rect").attr("width",e-i).attr("height",this._height()).attr("x",i).attr("class","mouse-drag").style("pointer-events","none")}}},_resetDrag:function(){this._dragRectangleG&&(this._dragRectangleG.remove(),this._dragRectangleG=null,this._dragRectangle=null,this._hidePositionMarker(),this._map.fitBounds(this._fullExtent))},_dragEndHandler:function(){if(!this._dragStartCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void this._resetDrag();this._hidePositionMarker();var t=this._findItemForX(this._dragStartCoords[0]),i=this._findItemForX(this._dragCurrentCoords[0]);this._fitSection(t,i),this._dragStartCoords=null,this._gotDragged=!1},_dragStartHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=d3.mouse(this._background.node())},_findItemForX:function(t){var i=d3.bisector(function(t){return t.dist}).left,e=this._x.invert(t);return i(this._data,e)},_findItemForLatLng:function(t){var i=null,e=1/0;return this._data.forEach(function(a){var s=t.distanceTo(a.latlng);e>s&&(e=s,i=a)}),i},_fitSection:function(t,i){var e=Math.min(t,i),a=Math.max(t,i),s=this._calculateFullExtent(this._data.slice(e,a));this._map.fitBounds(s)},_initToggle:function(){var t=this._container;if(t.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(t,"click",L.DomEvent.stopPropagation):L.DomEvent.disableClickPropagation(t),this.options.collapsed){this._collapse(),L.Browser.android||L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this);var i=this._button=L.DomUtil.create("a","elevation-toggle "+this.options.controlButton.iconCssClass,t);i.href="#",i.title=this.options.controlButton.title,L.Browser.touch?L.DomEvent.on(i,"click",L.DomEvent.stop).on(i,"click",this._expand,this):L.DomEvent.on(i,"focus",this._expand,this),this._map.on("click",this._collapse,this)}},_expand:function(){this._container.className=this._container.className.replace(" elevation-collapsed","")},_collapse:function(){L.DomUtil.addClass(this._container,"elevation-collapsed")},_width:function(){var t=this.options;return t.width-t.margins.left-t.margins.right},_height:function(){var t=this.options;return t.height-t.margins.top-t.margins.bottom},_formatter:function(t,i,e){var a;a=0===i?Math.round(t)+"":L.Util.formatNum(t,i)+"";var s=a.split(".");if(s[1]){for(var o=i-s[1].length;o>0;o--)s[1]+="0";a=s.join(e||".")}return a},_appendYaxis:function(t){var i=this.options;i.imperial?t.attr("class","y axis").call(d3.svg.axis().scale(this._y).ticks(this.options.yTicks).orient("left")).append("text").attr("x",-37).attr("y",3).style("text-anchor","end").text("ft"):t.attr("class","y axis").call(d3.svg.axis().scale(this._y).ticks(this.options.yTicks).orient("left")).append("text").attr("x",-45).attr("y",3).style("text-anchor","end").text("m")},_appendXaxis:function(t){var i=this.options;i.imperial?t.attr("class","x axis").attr("transform","translate(0,"+this._height()+")").call(d3.svg.axis().scale(this._x).ticks(this.options.xTicks).orient("bottom")).append("text").attr("x",this._width()+10).attr("y",15).style("text-anchor","end").text("mi"):t.attr("class","x axis").attr("transform","translate(0,"+this._height()+")").call(d3.svg.axis().scale(this._x).ticks(this.options.xTicks).orient("bottom")).append("text").attr("x",this._width()+20).attr("y",15).style("text-anchor","end").text("km")},_updateAxis:function(){this._xaxisgraphicnode.selectAll("g").remove(),this._xaxisgraphicnode.selectAll("path").remove(),this._xaxisgraphicnode.selectAll("text").remove(),this._yaxisgraphicnode.selectAll("g").remove(),this._yaxisgraphicnode.selectAll("path").remove(),this._yaxisgraphicnode.selectAll("text").remove(),this._appendXaxis(this._xaxisgraphicnode),this._appendYaxis(this._yaxisgraphicnode)},_mouseoutHandler:function(){this._hidePositionMarker()},_hidePositionMarker:function(){this._marker&&(this._map.removeLayer(this._marker),this._marker=null),this._mouseHeightFocus&&(this._mouseHeightFocus.style("visibility","hidden"),this._mouseHeightFocusLabel.style("visibility","hidden")),this._pointG&&this._pointG.style("visibility","hidden"),this._focusG.style("visibility","hidden")},_mousemoveHandler:function(t,i,e){if(this._data&&0!==this._data.length){var a=d3.mouse(this._background.node()),s=this.options,o=this._data[this._findItemForX(a[0])],r=o.altitude,n=o.dist,h=o.latlng,l=s.hoverNumber.formatter(r,s.hoverNumber.decimalsY);s.hoverNumber.formatter(n,s.hoverNumber.decimalsX),this._showDiagramIndicator(o,a[0]);var d=this._map.latLngToLayerPoint(h);if(s.useHeightIndicator){if(!this._mouseHeightFocus){var c=d3.select(".leaflet-overlay-pane svg").append("g");this._mouseHeightFocus=c.append("svg:line").attr("class",s.theme+" height-focus line").attr("x2",0).attr("y2",0).attr("x1",0).attr("y1",0);var _=this._pointG=c.append("g");_.append("svg:circle").attr("r",6).attr("cx",0).attr("cy",0).attr("class",s.theme+" height-focus circle-lower"),this._mouseHeightFocusLabel=c.append("svg:text").attr("class",s.theme+" height-focus-label").style("pointer-events","none")}var u=this._height()/this._maxElevation*r,g=d.y-u;this._mouseHeightFocus.attr("x1",d.x).attr("x2",d.x).attr("y1",d.y).attr("y2",g).style("visibility","visible"),this._pointG.attr("transform","translate("+d.x+","+d.y+")").style("visibility","visible"),s.imperial?this._mouseHeightFocusLabel.attr("x",d.x).attr("y",g).text(l+" ft").style("visibility","visible"):this._mouseHeightFocusLabel.attr("x",d.x).attr("y",g).text(l+" m").style("visibility","visible")}else this._marker?this._marker.setLatLng(h):this._marker=new L.Marker(h).addTo(this._map)}},_addGeoJSONData:function(t){var i=this.options;if(t){for(var e=this._data||[],a=this._dist||0,s=this._maxElevation||0,o=0;o<t.length;o++){var r=new L.LatLng(t[o][1],t[o][0]),n=new L.LatLng(t[o?o-1:0][1],t[o?o-1:0][0]),h=i.imperial?r.distanceTo(n)*this.__mileFactor:r.distanceTo(n);a+=Math.round(h/1e3*1e5)/1e5,s=s<t[o][2]?t[o][2]:s,e.push({dist:a,altitude:i.imperial?t[o][2]*this.__footFactor:t[o][2],x:t[o][0],y:t[o][1],latlng:r})}this._dist=a,this._data=e,s=i.imperial?s*this.__footFactor:s,this._maxElevation=s}},_addGPXdata:function(t){var i=this.options;if(t){for(var e=this._data||[],a=this._dist||0,s=this._maxElevation||0,o=0;o<t.length;o++){var r=t[o],n=t[o?o-1:0],h=i.imperial?r.distanceTo(n)*this.__mileFactor:r.distanceTo(n);a+=Math.round(h/1e3*1e5)/1e5,s=s<r.meta.ele?r.meta.ele:s,e.push({dist:a,altitude:i.imperial?r.meta.ele*this.__footFactor:r.meta.ele,x:r.lng,y:r.lat,latlng:r})}this._dist=a,this._data=e,s=i.imperial?s*this.__footFactor:s,this._maxElevation=s}},_addData:function(t){var i,e=t&&t.geometry&&t.geometry;if(e)switch(e.type){case"LineString":this._addGeoJSONData(e.coordinates);break;case"MultiLineString":for(i=0;i<e.coordinates.length;i++)this._addGeoJSONData(e.coordinates[i]);break;default:throw new Error("Invalid GeoJSON object.")}var a=t&&"FeatureCollection"===t.type;if(a)for(i=0;i<t.features.length;i++)this._addData(t.features[i]);t&&t._latlngs&&this._addGPXdata(t._latlngs)},_calculateFullExtent:function(t){if(!t||t.length<1)throw new Error("no data in parameters");var i=new L.latLngBounds(t[0].latlng,t[0].latlng);return t.forEach(function(t){i.extend(t.latlng)}),i},addData:function(t,i){this._addData(t),this._container&&this._applyData(),null===i&&t.on&&(i=t),i&&i.on("mousemove",this._handleLayerMouseOver.bind(this))},_handleLayerMouseOver:function(t){if(this._data&&0!==this._data.length){var i=t.latlng,e=this._findItemForLatLng(i);if(e){var a=e.xDiagCoord;this._showDiagramIndicator(e,a)}}},_showDiagramIndicator:function(t,i){var e=this.options;this._focusG.style("visibility","visible"),this._mousefocus.attr("x1",i).attr("y1",0).attr("x2",i).attr("y2",this._height()).classed("hidden",!1);var a=t.altitude,s=t.dist,o=(t.latlng,e.hoverNumber.formatter(a,e.hoverNumber.decimalsY)),r=e.hoverNumber.formatter(s,e.hoverNumber.decimalsX);e.imperial?(this._focuslabelX.attr("x",i).text(o+" ft"),this._focuslabelY.attr("y",this._height()-5).attr("x",i).text(r+" mi")):(this._focuslabelX.attr("x",i).text(o+" m"),this._focuslabelY.attr("y",this._height()-5).attr("x",i).text(r+" km"))},_applyData:function(){var t=d3.extent(this._data,function(t){return t.dist}),i=d3.extent(this._data,function(t){return t.altitude}),e=this.options;void 0!==e.yAxisMin&&(e.yAxisMin<i[0]||e.forceAxisBounds)&&(i[0]=e.yAxisMin),void 0!==e.yAxisMax&&(e.yAxisMax>i[1]||e.forceAxisBounds)&&(i[1]=e.yAxisMax),this._x.domain(t),this._y.domain(i),this._areapath.datum(this._data).attr("d",this._area),this._updateAxis(),this._fullExtent=this._calculateFullExtent(this._data)},_clearData:function(){this._data=null,this._dist=null,this._maxElevation=null},clear:function(){this._clearData(),this._areapath&&(this._areapath.attr("d","M0 0"),this._x.domain([0,1]),this._y.domain([0,1]),this._updateAxis())},hide:function(){this._container.style.display="none"},show:function(){this._container.style.display="block"}}),L.control.elevation=function(t){return new L.Control.Elevation(t)};
@@ -65,12 +66,12 @@ L.NumberedDivIcon=L.Icon.extend({options:{iconUrl:"./img/marker_hole.png",number
 
 },{}],20:[function(require,module,exports){
 (function (global){
-function initFromParams(e,t){ghRequest.init(e);var o,r=0;if(e.point)for(var a=0;a<e.point.length;a++)""!==e.point[a]&&(r++,o=a);var n=e.point&&r>=2;n?resolveCoords(e.point,t):e.point&&1===r&&(ghRequest.route.set(e.point[o],o,!0),resolveIndex(o).done(function(){mapLayer.focus(ghRequest.route.getIndex(o),15,o)}))}function resolveCoords(e,t){for(var o=0,r=e.length;o<r;o++){var a=e[o],n=ghRequest.route.getIndex(o);n&&a===n.input&&n.isResolved()||ghRequest.route.set(a,o,!0)}checkInput(),ghRequest.route.isResolved()?(resolveAll(),routeLatLng(ghRequest,t)):$.when.apply($,resolveAll()).done(function(){routeLatLng(ghRequest,t)})}function getToFrom(e){return 0===e?FROM:e===ghRequest.route.size()-1?TO:-1}function checkInput(){var e=$("#pointTemplate").html(),t=ghRequest.route.size();$("#locationpoints > div.pointDiv").length>t&&$("#locationpoints > div.pointDiv:gt("+(t-1)+")").remove(),$("#locationpoints .pointDelete").off();for(var o=function(){var e=$(this).parent().data("index");ghRequest.route.removeSingle(e),mapLayer.clearLayers(),routeLatLng(ghRequest,!1)},r=0;r<t;r++){var a=$("#locationpoints > div.pointDiv").eq(r);0===a.length&&($("#locationpoints > div.pointAdd").before(translate.nanoTemplate(e,{id:r})),a=$("#locationpoints > div.pointDiv").eq(r));var n=getToFrom(r);if(a.data("index",r),a.find(".pointFlag").attr("src",n===FROM?"img/marker-small-green.png":n===TO?"img/marker-small-red.png":"img/marker-small-blue.png"),t>2?a.find(".pointDelete").click(o).prop("disabled",!1).removeClass("ui-state-disabled"):a.find(".pointDelete").prop("disabled",!0).addClass("ui-state-disabled"),autocomplete.showListForIndex(ghRequest,routeIfAllResolved,r),translate.isI18nIsInitialized()){var s=a.find(".pointInput");0===r?$(s).attr("placeholder",translate.tr("from_hint")):r===t-1?$(s).attr("placeholder",translate.tr("to_hint")):$(s).attr("placeholder",translate.tr("via_hint"))}}}function setToStart(e){var t=e.target.getLatLng(),o=ghRequest.route.getIndexByCoord(t);ghRequest.route.move(o,0),routeIfAllResolved()}function setToEnd(e){var t=e.target.getLatLng(),o=ghRequest.route.getIndexByCoord(t);ghRequest.route.move(o,-1),routeIfAllResolved()}function setStartCoord(e){ghRequest.route.set(e.latlng.wrap(),0),resolveFrom(),routeIfAllResolved()}function setIntermediateCoord(e){var t=mapLayer.getSubLayers("route"),o=t.map(function(e){return{coordinates:e.getLatLngs(),wayPoints:e.feature.properties.snapped_waypoints.coordinates.map(function(e){return L.latLng(e[1],e[0])})}}),r=routeManipulation.getIntermediatePointIndex(o,e.latlng);ghRequest.route.add(e.latlng.wrap(),r),resolveIndex(r),routeIfAllResolved()}function deleteCoord(e){var t=e.target.getLatLng();ghRequest.route.removeSingle(t),mapLayer.clearLayers(),routeLatLng(ghRequest,!1)}function setEndCoord(e){var t=ghRequest.route.size()-1;ghRequest.route.set(e.latlng.wrap(),t),resolveTo(),routeIfAllResolved()}function routeIfAllResolved(e){return!!ghRequest.route.isResolved()&&(routeLatLng(ghRequest,e),!0)}function setFlag(e,t){if(e.lat){var o=getToFrom(t),r=mapLayer.createMarker(t,e,setToEnd,setToStart,deleteCoord,ghRequest);r._openPopup=r.openPopup,r.openPopup=function(){var e,t=this.getLatLng(),o=ghRequest.route.getIndexFromCoord(t);if(o.resolvedList&&o.resolvedList[0]&&o.resolvedList[0].locationDetails){var r=o.resolvedList[0].locationDetails;e=format.formatAddress(r),this._popup.setContent(e).update()}this._openPopup()};var a={text:translate.tr("set_start"),callback:setToStart,index:1,state:2};o===-1&&r.options.contextmenuItems.push(a),r.on("dragend",function(e){mapLayer.clearLayers();var o=e.target.getLatLng();autocomplete.hide(),ghRequest.route.getIndex(t).setCoord(o.lat,o.lng),resolveIndex(t),ghRequest.do_zoom=!1,routeLatLng(ghRequest,!1)})}}function resolveFrom(){return resolveIndex(0)}function resolveTo(){return resolveIndex(ghRequest.route.size()-1)}function resolveIndex(e){return setFlag(ghRequest.route.getIndex(e),e),0===e?ghRequest.to.isResolved()?mapLayer.setDisabledForMapsContextMenu("start",!1):mapLayer.setDisabledForMapsContextMenu("start",!0):e===ghRequest.route.size()-1&&(ghRequest.from.isResolved()?mapLayer.setDisabledForMapsContextMenu("end",!1):mapLayer.setDisabledForMapsContextMenu("end",!0)),nominatim.resolve(e,ghRequest.route.getIndex(e))}function resolveAll(){for(var e=[],t=0,o=ghRequest.route.size();t<o;t++)e[t]=resolveIndex(t);return e}function flagAll(){for(var e=0,t=ghRequest.route.size();e<t;e++)setFlag(ghRequest.route.getIndex(e),e)}function routeLatLng(e,t){var o=e.do_zoom;e.do_zoom=!0;var r=e.createHistoryURL()+"&layer="+tileLayers.activeLayerName;if(!t&&History.enabled){var a=urlTools.parseUrl(r);return console.log(a),a.do_zoom=o,a.mathRandom=Math.random(),void History.pushState(a,messages.browserTitle,r)}var n=$("#info");n.empty(),n.show();var s=$("<div class='route_results'/>");n.append(s),mapLayer.clearElevation(),mapLayer.clearLayers(),flagAll(),mapLayer.setDisabledForMapsContextMenu("intermediate",!1),$("#vehicles button").removeClass("selectvehicle"),$("button#"+e.getVehicle().toLowerCase()).addClass("selectvehicle");var i=e.createURL();s.html('<img src="img/indicator.gif"/> Search Route ...'),e.doRequest(i,function(t){function a(e,t,o,r,a,n){return function(){var i=e[t];mapLayer.eachLayer(function(e){if(e.setStyle){var t=e.feature===i;e.setStyle(t?d:c),t&&(L.Browser.ie||L.Browser.opera||e.bringToFront())}}),a&&(mapLayer.clearElevation(),mapLayer.addElevation(i,n)),l.find("li").removeClass("current"),s.find("div").removeClass("current"),o.addClass("current"),r.addClass("current")}}if(s.html(""),t.message){var n=t.message;if(console.log(n),t.hints)for(var i=0;i<t.hints.length;i++)s.append("<div class='error'>"+t.hints[i].message+"</div>");else s.append("<div class='error'>"+n+"</div>")}else{var l=$("<ul id='route_result_tabs'/>");t.paths.length>1&&(s.append(l),s.append("<div class='clear'/>"));for(var u,p={color:"#00cc33",weight:5,opacity:.6},d={color:"#00cc33",weight:6,opacity:.8},c={color:"darkgray",weight:6,opacity:.8},g=[],h=0;h<t.paths.length;h++){var v=$("<li>").append(h+1+"<img class='alt_route_img' src='img/alt_route.png'/>");0===h&&(u=v),l.append(v);var m=t.paths[h],f=0===h?p:c,q={type:"Feature",geometry:m.points,properties:{style:f,name:"route",snapped_waypoints:m.snapped_waypoints}};g.push(q),mapLayer.addDataToRoutingLayer(q);var y=$("<div class='route_result_tab'>");s.append(y),v.click(a(g,h,v,y,e.hasElevation(),e.useMiles));var b=translate.createTimeString(m.time),R=translate.createDistanceString(m.distance,e.useMiles),x=$("<div class='route_description'>");m.description&&m.description.length>0&&(x.text(m.description),x.append("<br/>")),x.append(translate.tr("route_info",[R,b]));var I=function(e){return function(){mapLayer.updateScale(e),ghRequest.useMiles=e,resolveAll(),routeLatLng(ghRequest)}},_=$("<button class='plain_text_button "+(e.useMiles?"gray":"")+"'>");_.text(translate.tr2("km_abbr")),_.click(I(!1));var w=$("<button class='plain_text_button "+(e.useMiles?"":"gray")+"'>");w.text(translate.tr2("mi_abbr")),w.click(I(!0));var C=$("<span style='float: right;'>");if(C.append(_),C.append("|"),C.append(w),x.append(C),e.hasElevation()&&x.append(translate.createEleInfoString(m.ascend,m.descend,e.useMiles)),y.append(x),m.instructions){var M=require("./instructions.js");y.append(M.create(mapLayer,m,r,e))}}u.click(),mapLayer.adjustMapSize();var j=t.paths[0];if(j.bbox&&o){var F=j.bbox[0],k=j.bbox[1],S=j.bbox[2],T=j.bbox[3],A=new L.LatLngBounds(new L.LatLng(k,F),new L.LatLng(T,S));mapLayer.fitMapToBounds(A)}$(".defaulting").each(function(e,t){$(t).css("color","black")})}})}function mySubmit(){var e,t,o,r=[],a=!0,n=$("#locationpoints > div.pointDiv > input.pointInput"),s=n.size;if($.each(n,function(n){0===n?(e=$(this).val(),e!==translate.tr("from_hint")&&""!==e?r.push(e):a=!1):n===s-1?(t=$(this).val(),t!==translate.tr("to_hint")&&""!==t?r.push(t):a=!1):(o=$(this).val(),o!==translate.tr("via_hint")&&""!==o?r.push(o):a=!1)}),a&&e!==translate.tr("from_hint"))return t===translate.tr("to_hint")?(ghRequest.from.setStr(e),void $.when(resolveFrom()).done(function(){mapLayer.focus(ghRequest.from,null,0)})):void(a&&resolveCoords(r))}function isProduction(){return host.indexOf("graphhopper.com")>0}global.d3=require("d3");var L=require("leaflet");require("leaflet-loading"),require("./lib/leaflet.contextmenu.js"),require("./lib/leaflet.elevation-0.0.4.min.js"),require("./lib/leaflet_numbered_markers.js"),global.jQuery=require("jquery"),global.$=global.jQuery,require("./lib/jquery-ui-custom-1.12.0.min.js"),require("./lib/jquery.history.js"),require("./lib/jquery.autocomplete.js");var ghenv=require("./config/options.js").options;console.log(ghenv.environment);var GHInput=require("./graphhopper/GHInput.js"),GHRequest=require("./graphhopper/GHRequest.js"),host=ghenv.routing.host;host||(host=""===location.port?location.protocol+"//"+location.hostname:location.protocol+"//"+location.hostname+":"+location.port);var AutoComplete=require("./autocomplete.js");if("development"===ghenv.environment)var autocomplete=AutoComplete.prototype.createStub();else var autocomplete=new AutoComplete(ghenv.geocoding.host,ghenv.geocoding.api_key);var mapLayer=require("./map.js"),nominatim=require("./nominatim.js"),routeManipulation=require("./routeManipulation.js"),gpxExport=require("./gpxexport.js"),messages=require("./messages.js"),translate=require("./translate.js"),format=require("./tools/format.js"),urlTools=require("./tools/url.js"),vehicle=require("./tools/vehicle.js"),tileLayers=require("./config/tileLayers.js"),debug=!1,ghRequest=new GHRequest(host,ghenv.routing.api_key),bounds={},metaVersionInfo;global.window&&(window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&debug&&console.log(Array.prototype.slice.call(arguments))}),$(document).ready(function(e){jQuery.support.cors=!0,gpxExport.addGpxExport(ghRequest),isProduction()&&$("#hosting").show();var t=window.History;t.enabled&&t.Adapter.bind(window,"statechange",function(){var e=t.getState();console.log(e),initFromParams(e.data,!0)}),$("#locationform").submit(function(e){e.preventDefault(),mySubmit()});var o=urlTools.parseUrlWithHisto();$.when(ghRequest.fetchTranslationMap(o.locale),ghRequest.getInfo()).then(function(e,t){function r(e,t){var o=$("<button class='vehicle-btn' title='"+translate.tr(e)+"'/>");return t&&o.hide(),o.attr("id",e),o.html("<img src='img/"+e+".png' alt='"+translate.tr(e)+"'></img>"),o.click(function(){ghRequest.initVehicle(e),resolveAll(),routeLatLng(ghRequest)}),o}var a=e[0];autocomplete.setLocale(a.locale),ghRequest.setLocale(a.locale),translate.init(a);var n=t[0],s=n.bbox;bounds.initialized=!0,bounds.minLon=s[0],bounds.minLat=s[1],bounds.maxLon=s[2],bounds.maxLat=s[3],nominatim.setBounds(bounds);var i=$("#vehicles");if(n.features){ghRequest.features=n.features;var l={car:1,foot:2,bike:3,motorcycle:1e4},u=o.vehicle&&(!l[o.vehicle]||l[o.vehicle]>3),p=vehicle.getSortedVehicleKeys(n.features,l);p.length>0&&ghRequest.initVehicle(p[0]);var d=[];for(var c in p){var g=r(p[c].toLowerCase(),!u&&c>2);i.append(g),c>2&&d.push(g)}if(!u&&p.length>3){var h=$("<a id='more-vehicle-btn'> ...</a>").click(function(){h.hide();for(var e in d)d[e].show()});i.append($("<a class='vehicle-info-link' href='https://graphhopper.com/api/1/docs/supported-vehicle-profiles/'>?</a>")),i.append(h)}}metaVersionInfo=messages.extractMetaVersionInfo(n),mapLayer.initMap(bounds,setStartCoord,setIntermediateCoord,setEndCoord,o.layer),initFromParams(o,!0),checkInput()},function(e){console.log(e),$("#error").html('GraphHopper API offline? <a href="http://graphhopper.com/maps">Refresh</a><br/>Status: '+e.statusText+"<br/>"+host),bounds={minLon:-180,minLat:-90,maxLon:180,maxLat:90},nominatim.setBounds(bounds),mapLayer.initMap(bounds,setStartCoord,setIntermediateCoord,setEndCoord)}),$(window).resize(function(){mapLayer.adjustMapSize()}),$("#locationpoints").sortable({items:".pointDiv",cursor:"n-resize",containment:"parent",handle:".pointFlag",update:function(e,t){var o=$(t.item[0]).data("index");sortable_items=$("#locationpoints > div.pointDiv"),$(sortable_items).each(function(e){var t=$(this).data("index");if(o===t)return ghRequest.route.move(t,e),routeIfAllResolved()||checkInput(),!1})}}),$("#locationpoints > div.pointAdd").click(function(){ghRequest.route.add(new GHInput),checkInput()}),checkInput()});var FROM="from",TO="to";module.exports.setFlag=setFlag;
+function initFromParams(e,t){ghRequest.init(e);var o,r=0;if(e.point)for(var a=0;a<e.point.length;a++)""!==e.point[a]&&(r++,o=a);var n=e.point&&r>=2;n?resolveCoords(e.point,t):e.point&&1===r&&(ghRequest.route.set(e.point[o],o,!0),resolveIndex(o).done(function(){mapLayer.focus(ghRequest.route.getIndex(o),15,o)}))}function resolveCoords(e,t){for(var o=0,r=e.length;o<r;o++){var a=e[o],n=ghRequest.route.getIndex(o);n&&a===n.input&&n.isResolved()||ghRequest.route.set(a,o,!0)}checkInput(),ghRequest.route.isResolved()?(resolveAll(),routeLatLng(ghRequest,t)):$.when.apply($,resolveAll()).done(function(){routeLatLng(ghRequest,t)})}function getToFrom(e){return 0===e?FROM:e===ghRequest.route.size()-1?TO:-1}function checkInput(){var e=$("#pointTemplate").html(),t=ghRequest.route.size();$("#locationpoints > div.pointDiv").length>t&&$("#locationpoints > div.pointDiv:gt("+(t-1)+")").remove(),$("#locationpoints .pointDelete").off();for(var o=function(){var e=$(this).parent().data("index");ghRequest.route.removeSingle(e),mapLayer.clearLayers(),routeLatLng(ghRequest,!1)},r=0;r<t;r++){var a=$("#locationpoints > div.pointDiv").eq(r);0===a.length&&($("#locationpoints > div.pointAdd").before(translate.nanoTemplate(e,{id:r})),a=$("#locationpoints > div.pointDiv").eq(r));var n=getToFrom(r);if(a.data("index",r),a.find(".pointFlag").attr("src",n===FROM?"img/marker-small-green.png":n===TO?"img/marker-small-red.png":"img/marker-small-blue.png"),t>2?a.find(".pointDelete").click(o).prop("disabled",!1).removeClass("ui-state-disabled"):a.find(".pointDelete").prop("disabled",!0).addClass("ui-state-disabled"),autocomplete.showListForIndex(ghRequest,routeIfAllResolved,r),translate.isI18nIsInitialized()){var s=a.find(".pointInput");0===r?$(s).attr("placeholder",translate.tr("from_hint")):r===t-1?$(s).attr("placeholder",translate.tr("to_hint")):$(s).attr("placeholder",translate.tr("via_hint"))}}}function setToStart(e){var t=e.relatedTarget.getLatLng(),o=ghRequest.route.getIndexByCoord(t);ghRequest.route.move(o,0),routeIfAllResolved()}function setToEnd(e){var t=e.relatedTarget.getLatLng(),o=ghRequest.route.getIndexByCoord(t);ghRequest.route.move(o,-1),routeIfAllResolved()}function setStartCoord(e){ghRequest.route.set(e.latlng.wrap(),0),resolveFrom(),routeIfAllResolved()}function setIntermediateCoord(e){var t=mapLayer.getSubLayers("route"),o=t.map(function(e){return{coordinates:e.getLatLngs(),wayPoints:e.feature.properties.snapped_waypoints.coordinates.map(function(e){return L.latLng(e[1],e[0])})}}),r=routeManipulation.getIntermediatePointIndex(o,e.latlng);ghRequest.route.add(e.latlng.wrap(),r),resolveIndex(r),routeIfAllResolved()}function deleteCoord(e){var t=e.relatedTarget.getLatLng();ghRequest.route.removeSingle(t),mapLayer.clearLayers(),routeLatLng(ghRequest,!1)}function setEndCoord(e){var t=ghRequest.route.size()-1;ghRequest.route.set(e.latlng.wrap(),t),resolveTo(),routeIfAllResolved()}function routeIfAllResolved(e){return!!ghRequest.route.isResolved()&&(routeLatLng(ghRequest,e),!0)}function setFlag(e,t){if(e.lat){var o=getToFrom(t),r=mapLayer.createMarker(t,e,setToEnd,setToStart,deleteCoord,ghRequest);r._openPopup=r.openPopup,r.openPopup=function(){var e,t=this.getLatLng(),o=ghRequest.route.getIndexFromCoord(t);if(o.resolvedList&&o.resolvedList[0]&&o.resolvedList[0].locationDetails){var r=o.resolvedList[0].locationDetails;e=format.formatAddress(r),this._popup.setContent(e).update()}this._openPopup()};var a={text:translate.tr("set_start"),icon:"./img/marker-small-green.png",callback:setToStart,index:1};o===-1&&r.options.contextmenuItems.push(a),r.on("dragend",function(e){mapLayer.clearLayers();var o=e.target.getLatLng();autocomplete.hide(),ghRequest.route.getIndex(t).setCoord(o.lat,o.lng),resolveIndex(t),ghRequest.do_zoom=!1,routeLatLng(ghRequest,!1)})}}function resolveFrom(){return resolveIndex(0)}function resolveTo(){return resolveIndex(ghRequest.route.size()-1)}function resolveIndex(e){return setFlag(ghRequest.route.getIndex(e),e),0===e?ghRequest.to.isResolved()?mapLayer.setDisabledForMapsContextMenu("start",!1):mapLayer.setDisabledForMapsContextMenu("start",!0):e===ghRequest.route.size()-1&&(ghRequest.from.isResolved()?mapLayer.setDisabledForMapsContextMenu("end",!1):mapLayer.setDisabledForMapsContextMenu("end",!0)),nominatim.resolve(e,ghRequest.route.getIndex(e))}function resolveAll(){for(var e=[],t=0,o=ghRequest.route.size();t<o;t++)e[t]=resolveIndex(t);return e}function flagAll(){for(var e=0,t=ghRequest.route.size();e<t;e++)setFlag(ghRequest.route.getIndex(e),e)}function routeLatLng(e,t){var o=e.do_zoom;e.do_zoom=!0;var r=e.createHistoryURL()+"&layer="+tileLayers.activeLayerName;if(!t&&History.enabled){var a=urlTools.parseUrl(r);return console.log(a),a.do_zoom=o,a.mathRandom=Math.random(),void History.pushState(a,messages.browserTitle,r)}var n=$("#info");n.empty(),n.show();var s=$("<div class='route_results'/>");n.append(s),mapLayer.clearElevation(),mapLayer.clearLayers(),flagAll(),mapLayer.setDisabledForMapsContextMenu("intermediate",!1),$("#vehicles button").removeClass("selectvehicle"),$("button#"+e.getVehicle().toLowerCase()).addClass("selectvehicle");var i=e.createURL();s.html('<img src="img/indicator.gif"/> Search Route ...'),e.doRequest(i,function(t){function a(e,t,o,r,a,n){return function(){var i=e[t];mapLayer.eachLayer(function(e){if(e.setStyle){var t=e.feature===i;e.setStyle(t?d:c),t&&(L.Browser.ie||L.Browser.opera||e.bringToFront())}}),a&&(mapLayer.clearElevation(),mapLayer.addElevation(i,n)),l.find("li").removeClass("current"),s.find("div").removeClass("current"),o.addClass("current"),r.addClass("current")}}if(s.html(""),t.message){var n=t.message;if(console.log(n),t.hints)for(var i=0;i<t.hints.length;i++)s.append("<div class='error'>"+t.hints[i].message+"</div>");else s.append("<div class='error'>"+n+"</div>")}else{var l=$("<ul id='route_result_tabs'/>");t.paths.length>1&&(s.append(l),s.append("<div class='clear'/>"));var u,p={color:"#00cc33",weight:5,opacity:.6},d={color:"#00cc33",weight:6,opacity:.8},c={color:"darkgray",weight:6,opacity:.8},g=[],h=function(e){return function(){mapLayer.updateScale(e),ghRequest.useMiles=e,resolveAll(),routeLatLng(ghRequest)}};if(t.paths.length>0&&t.paths[0].points_order){mapLayer.clearLayers();for(var v=t.paths[0].points_order,m=0;m<v.length;m++)setFlag(ghRequest.route.getIndex(v[m]),m)}for(var f=0;f<t.paths.length;f++){var q=$("<li>").append(f+1+"<img class='alt_route_img' src='img/alt_route.png'/>");0===f&&(u=q),l.append(q);var y=t.paths[f],b=0===f?p:c,R={type:"Feature",geometry:y.points,properties:{style:b,name:"route",snapped_waypoints:y.snapped_waypoints}};g.push(R),mapLayer.addDataToRoutingLayer(R);var x=$("<div class='route_result_tab'>");s.append(x),q.click(a(g,f,q,x,e.hasElevation(),e.useMiles));var I=translate.createTimeString(y.time),_=translate.createDistanceString(y.distance,e.useMiles),w=$("<div class='route_description'>");y.description&&y.description.length>0&&(w.text(y.description),w.append("<br/>")),w.append(translate.tr("route_info",[_,I]));var C=$("<button class='plain_text_button "+(e.useMiles?"gray":"")+"'>");C.text(translate.tr2("km_abbr")),C.click(h(!1));var M=$("<button class='plain_text_button "+(e.useMiles?"":"gray")+"'>");M.text(translate.tr2("mi_abbr")),M.click(h(!0));var j=$("<span style='float: right;'>");if(j.append(C),j.append("|"),j.append(M),w.append(j),e.hasElevation()&&w.append(translate.createEleInfoString(y.ascend,y.descend,e.useMiles)),x.append(w),y.instructions){var F=require("./instructions.js");x.append(F.create(mapLayer,y,r,e))}}u.click(),mapLayer.adjustMapSize();var k=t.paths[0];if(k.bbox&&o){var T=k.bbox[0],S=k.bbox[1],A=k.bbox[2],D=k.bbox[3],z=new L.LatLngBounds(new L.LatLng(S,T),new L.LatLng(D,A));mapLayer.fitMapToBounds(z)}$(".defaulting").each(function(e,t){$(t).css("color","black")})}})}function mySubmit(){var e,t,o,r=[],a=!0,n=$("#locationpoints > div.pointDiv > input.pointInput"),s=n.size;if($.each(n,function(n){0===n?(e=$(this).val(),e!==translate.tr("from_hint")&&""!==e?r.push(e):a=!1):n===s-1?(t=$(this).val(),t!==translate.tr("to_hint")&&""!==t?r.push(t):a=!1):(o=$(this).val(),o!==translate.tr("via_hint")&&""!==o?r.push(o):a=!1)}),a&&e!==translate.tr("from_hint"))return t===translate.tr("to_hint")?(ghRequest.from.setStr(e),void $.when(resolveFrom()).done(function(){mapLayer.focus(ghRequest.from,null,0)})):void(a&&resolveCoords(r))}function isProduction(){return host.indexOf("graphhopper.com")>0}global.d3=require("d3");var L=require("leaflet");require("leaflet-contextmenu"),require("leaflet-loading"),require("./lib/leaflet.elevation-0.0.4.min.js"),require("./lib/leaflet_numbered_markers.js"),global.jQuery=require("jquery"),global.$=global.jQuery,require("./lib/jquery-ui-custom-1.12.0.min.js"),require("./lib/jquery.history.js"),require("./lib/jquery.autocomplete.js");var ghenv=require("./config/options.js").options;console.log(ghenv.environment);var GHInput=require("./graphhopper/GHInput.js"),GHRequest=require("./graphhopper/GHRequest.js"),host=ghenv.routing.host;host||(host=""===location.port?location.protocol+"//"+location.hostname:location.protocol+"//"+location.hostname+":"+location.port);var AutoComplete=require("./autocomplete.js");if("development"===ghenv.environment)var autocomplete=AutoComplete.prototype.createStub();else var autocomplete=new AutoComplete(ghenv.geocoding.host,ghenv.geocoding.api_key);var mapLayer=require("./map.js"),nominatim=require("./nominatim.js"),routeManipulation=require("./routeManipulation.js"),gpxExport=require("./gpxexport.js"),messages=require("./messages.js"),translate=require("./translate.js"),format=require("./tools/format.js"),urlTools=require("./tools/url.js"),vehicle=require("./tools/vehicle.js"),tileLayers=require("./config/tileLayers.js"),debug=!1,ghRequest=new GHRequest(host,ghenv.routing.api_key),bounds={},metaVersionInfo;global.window&&(window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&debug&&console.log(Array.prototype.slice.call(arguments))}),$(document).ready(function(e){jQuery.support.cors=!0,gpxExport.addGpxExport(ghRequest),isProduction()&&$("#hosting").show();var t=window.History;t.enabled&&t.Adapter.bind(window,"statechange",function(){var e=t.getState();console.log(e),initFromParams(e.data,!0)}),$("#locationform").submit(function(e){e.preventDefault(),mySubmit()});var o=urlTools.parseUrlWithHisto();$.when(ghRequest.fetchTranslationMap(o.locale),ghRequest.getInfo()).then(function(e,t){function r(e,t){var o=$("<button class='vehicle-btn' title='"+translate.tr(e)+"'/>");return t&&o.hide(),o.attr("id",e),o.html("<img src='img/"+e+".png' alt='"+translate.tr(e)+"'></img>"),o.click(function(){ghRequest.initVehicle(e),resolveAll(),routeLatLng(ghRequest)}),o}var a=e[0];autocomplete.setLocale(a.locale),ghRequest.setLocale(a.locale),translate.init(a);var n=t[0],s=n.bbox;bounds.initialized=!0,bounds.minLon=s[0],bounds.minLat=s[1],bounds.maxLon=s[2],bounds.maxLat=s[3],nominatim.setBounds(bounds);var i=$("#vehicles");if(n.features){ghRequest.features=n.features;var l={car:1,foot:2,bike:3,motorcycle:1e4},u=o.vehicle&&(!l[o.vehicle]||l[o.vehicle]>3),p=vehicle.getSortedVehicleKeys(n.features,l);p.length>0&&ghRequest.initVehicle(p[0]);var d=[];for(var c in p){var g=r(p[c].toLowerCase(),!u&&c>2);i.append(g),c>2&&d.push(g)}if(!u&&p.length>3){var h=$("<a id='more-vehicle-btn'> ...</a>").click(function(){h.hide();for(var e in d)d[e].show()});i.append($("<a class='vehicle-info-link' href='https://graphhopper.com/api/1/docs/supported-vehicle-profiles/'>?</a>")),i.append(h)}}metaVersionInfo=messages.extractMetaVersionInfo(n),mapLayer.initMap(bounds,setStartCoord,setIntermediateCoord,setEndCoord,o.layer,o.use_miles),initFromParams(o,!0),checkInput()},function(e){console.log(e),$("#error").html('GraphHopper API offline? <a href="http://graphhopper.com/maps">Refresh</a><br/>Status: '+e.statusText+"<br/>"+host),bounds={minLon:-180,minLat:-90,maxLon:180,maxLat:90},nominatim.setBounds(bounds),mapLayer.initMap(bounds,setStartCoord,setIntermediateCoord,setEndCoord,o.layer,o.use_miles)}),$(window).resize(function(){mapLayer.adjustMapSize()}),$("#locationpoints").sortable({items:".pointDiv",cursor:"n-resize",containment:"parent",handle:".pointFlag",update:function(e,t){var o=$(t.item[0]).data("index");sortable_items=$("#locationpoints > div.pointDiv"),$(sortable_items).each(function(e){var t=$(this).data("index");if(o===t)return ghRequest.route.move(t,e),routeIfAllResolved()||checkInput(),!1})}}),$("#locationpoints > div.pointAdd").click(function(){ghRequest.route.add(new GHInput),checkInput()}),checkInput()});var FROM="from",TO="to";module.exports.setFlag=setFlag;
 }).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
-},{"./autocomplete.js":5,"./config/options.js":6,"./config/tileLayers.js":7,"./gpxexport.js":8,"./graphhopper/GHInput.js":9,"./graphhopper/GHRequest.js":10,"./instructions.js":13,"./lib/jquery-ui-custom-1.12.0.min.js":14,"./lib/jquery.autocomplete.js":15,"./lib/jquery.history.js":16,"./lib/leaflet.contextmenu.js":17,"./lib/leaflet.elevation-0.0.4.min.js":18,"./lib/leaflet_numbered_markers.js":19,"./map.js":21,"./messages.js":22,"./nominatim.js":23,"./routeManipulation.js":24,"./tools/format.js":25,"./tools/url.js":27,"./tools/vehicle.js":28,"./translate.js":29,"d3":1,"jquery":2,"leaflet":4,"leaflet-loading":3}],21:[function(require,module,exports){
-function adjustMapSize(){var e=$("#map"),t=$(window).width()-280;t<400?(t=400,e.attr("style","position: relative; float: right;")):e.attr("style","position: absolute; right: 0;");var a=$(window).height();a<500&&(a=500),e.width(t).height(a),$("#input").height(a);var n=a-60-$("#input_header").height()-$("#footer").height()-$(".route_description").height(),o=$("#route_result_tabs li").height();isNaN(o)||(n-=o),$(".instructions_info").css("max-height",n)}function initMap(e,t,a,n,o){adjustMapSize();var r=tileLayers.selectLayer(o);map=L.map("map",{layers:[r],minZoom:2,contextmenu:!0,contextmenuWidth:150,contextmenuItems:[{separator:!0,index:3,state:["set_default"]},{text:translate.tr("show_coords"),callback:function(e){alert(e.latlng.lat+","+e.latlng.lng)},index:4,state:[1,2,3]},{text:translate.tr("center_map"),callback:function(e){map.panTo(e.latlng)},index:5,state:[1,2,3]}],zoomControl:!1,loadingControl:!1});var i={text:translate.tr("set_start"),callback:t,disabled:!1,index:0},l={text:translate.tr("set_intermediate"),callback:a,disabled:!0,index:1},s={text:translate.tr("set_end"),callback:n,disabled:!1,index:2};menuStart=map.contextmenu.insertItem(i,i.index),menuIntermediate=map.contextmenu.insertItem(l,l.index),menuEnd=map.contextmenu.insertItem(s,s.index);var m=new L.Control.Zoom({position:"topleft",zoomInTitle:translate.tr("zoom_in"),zoomOutTitle:translate.tr("zoom_out")}).addTo(map);new L.Control.loading({zoomControl:m}).addTo(map),map.contextmenu.addSet({name:"markers",state:2}),map.contextmenu.addSet({name:"path",state:3}),L.control.layers(tileLayers.getAvailableTileLayers()).addTo(map),map.on("baselayerchange",function(e){e.name&&(tileLayers.activeLayerName=e.name,$("#export-link a").attr("href",function(e,t){return t.replace(/(layer=)([\w\s]+)/,"$1"+tileLayers.activeLayerName)}))}),scaleControl=L.control.scale({imperial:!1}).addTo(map),map.fitBounds(new L.LatLngBounds(new L.LatLng(e.minLat,e.minLon),new L.LatLng(e.maxLat,e.maxLon))),map.attributionControl.setPrefix("");var d={color:"black",weight:2,opacity:.3},u={type:"Feature",geometry:{type:"LineString",coordinates:[[e.minLon,e.minLat],[e.maxLon,e.minLat],[e.maxLon,e.maxLat],[e.minLon,e.maxLat],[e.minLon,e.minLat]]}};e.initialized&&L.geoJson(u,{style:d}).addTo(map),routingLayer=L.geoJson().addTo(map),routingLayer.options={style:function(e){return e.properties&&e.properties.style},contextmenu:!0,contextmenuItems:[{text:translate.tr("route")+" ",disabled:!0,index:0,state:3},{text:translate.tr("set_intermediate"),callback:a,index:1,state:3},{separator:!0,index:2,state:3}],contextmenuAtiveState:3}}function focus(e,t,a){e.lat&&e.lng&&(t||(t=11),routingLayer.clearLayers(),map.setView(new L.LatLng(e.lat,e.lng),t),mainTemplate.setFlag(e,a))}function getToFrom(e,t){return 0===e?FROM:e===t.route.size()-1?TO:-1}var mainTemplate=require("./main-template.js"),tileLayers=require("./config/tileLayers.js"),translate=require("./translate.js"),routingLayer,map,menuStart,menuIntermediate,menuEnd,elevationControl=null;module.exports.clearLayers=function(){routingLayer.clearLayers()},module.exports.getRoutingLayer=function(){return routingLayer},module.exports.getSubLayers=function(e){var t=routingLayer.getLayers();return t.filter(function(t){return t.feature&&t.feature.properties&&t.feature.properties.name===e})},module.exports.addDataToRoutingLayer=function(e){routingLayer.addData(e)},module.exports.eachLayer=function(e){routingLayer.eachLayer(e)},module.exports.setDisabledForMapsContextMenu=function(e,t){"start"===e&&map.contextmenu.setDisabled(menuStart,t),"end"===e&&map.contextmenu.setDisabled(menuEnd,t),"intermediate"===e&&map.contextmenu.setDisabled(menuIntermediate,t)},module.exports.fitMapToBounds=function(e){map.fitBounds(e)},module.exports.removeLayerFromMap=function(e){map.removeLayer(e)},module.exports.focus=focus,module.exports.initMap=initMap,module.exports.adjustMapSize=adjustMapSize,module.exports.addElevation=function(e,t){null===elevationControl&&(elevationControl=L.control.elevation({position:"bottomright",theme:"white-theme",width:450,height:125,margins:{top:10,right:20,bottom:30,left:60},useHeightIndicator:!0,interpolation:"linear",hoverNumber:{decimalsX:2,decimalsY:0,formatter:void 0},xTicks:void 0,yTicks:void 0,collapsed:!1}),elevationControl.addTo(map)),elevationControl.options.imperial=t,elevationControl.addData(e)},module.exports.clearElevation=function(){elevationControl&&elevationControl.clear()},module.exports.getMap=function(){return map},module.exports.updateScale=function(e){if(null!==scaleControl){scaleControl.removeFrom(map);var t=e?{metric:!1}:{imperial:!1};scaleControl=L.control.scale(t).addTo(map)}};var FROM="from",TO="to",iconFrom=L.icon({iconUrl:"./img/marker-icon-green.png",shadowSize:[50,64],shadowAnchor:[4,62],iconAnchor:[12,40]}),iconTo=L.icon({iconUrl:"./img/marker-icon-red.png",shadowSize:[50,64],shadowAnchor:[4,62],iconAnchor:[12,40]});module.exports.createMarker=function(e,t,a,n,o,r){var i=getToFrom(e,r);return L.marker([t.lat,t.lng],{icon:i===FROM?iconFrom:i===TO?iconTo:new L.NumberedDivIcon({number:e}),draggable:!0,contextmenu:!0,contextmenuItems:[{text:translate.tr("marker")+" "+(i===FROM?translate.tr("start_label"):i===TO?translate.tr("end_label"):translate.tr("intermediate_label")+" "+e),disabled:!0,index:0,state:2},{text:translate.tr(i!==TO?"set_end":"set_start"),callback:i!==TO?a:n,index:2,state:2},{text:translate.tr("delete_from_route"),callback:o,index:3,state:2,disabled:i!==-1&&2===r.route.size()},{separator:!0,index:4,state:2}],contextmenuAtiveState:2}).addTo(routingLayer).bindPopup(i===FROM?translate.tr("start_label"):i===TO?translate.tr("end_label"):translate.tr("intermediate_label")+" "+e)};
+},{"./autocomplete.js":6,"./config/options.js":7,"./config/tileLayers.js":8,"./gpxexport.js":9,"./graphhopper/GHInput.js":10,"./graphhopper/GHRequest.js":11,"./instructions.js":14,"./lib/jquery-ui-custom-1.12.0.min.js":15,"./lib/jquery.autocomplete.js":16,"./lib/jquery.history.js":17,"./lib/leaflet.elevation-0.0.4.min.js":18,"./lib/leaflet_numbered_markers.js":19,"./map.js":21,"./messages.js":22,"./nominatim.js":23,"./routeManipulation.js":24,"./tools/format.js":25,"./tools/url.js":27,"./tools/vehicle.js":28,"./translate.js":29,"d3":1,"jquery":2,"leaflet":5,"leaflet-contextmenu":3,"leaflet-loading":4}],21:[function(require,module,exports){
+function adjustMapSize(){var e=$("#map"),t=$(window).width()-280;t<400?(t=400,e.attr("style","position: relative; float: right;")):e.attr("style","position: absolute; right: 0;");var a=$(window).height();a<500&&(a=500),e.width(t).height(a),$("#input").height(a);var n=a-60-$("#input_header").height()-$("#footer").height()-$(".route_description").height(),o=$("#route_result_tabs li").height();isNaN(o)||(n-=o),$(".instructions_info").css("max-height",n)}function initMap(e,t,a,n,o,r){adjustMapSize();var i=tileLayers.selectLayer(o);defaultContextmenuItems=[{separator:!0,index:10},{text:translate.tr("show_coords"),callback:function(e){alert(e.latlng.lat+","+e.latlng.lng)},index:11},{text:translate.tr("center_map"),callback:function(e){map.panTo(e.latlng)},index:12}],map=L.map("map",{layers:[i],minZoom:2,contextmenu:!0,contextmenuItems:defaultContextmenuItems,zoomControl:!1,loadingControl:!1});var l={text:translate.tr("set_start"),icon:"./img/marker-small-green.png",callback:t,index:0},m={text:translate.tr("set_intermediate"),icon:"./img/marker-small-blue.png",callback:a,disabled:!0,index:1},s={text:translate.tr("set_end"),icon:"./img/marker-small-red.png",callback:n,index:2};menuStart=map.contextmenu.insertItem(l,l.index),menuIntermediate=map.contextmenu.insertItem(m,m.index),menuEnd=map.contextmenu.insertItem(s,s.index);var u=new L.Control.Zoom({position:"topleft",zoomInTitle:translate.tr("zoom_in"),zoomOutTitle:translate.tr("zoom_out")}).addTo(map);new L.Control.loading({zoomControl:u}).addTo(map),L.control.layers(tileLayers.getAvailableTileLayers()).addTo(map),map.on("baselayerchange",function(e){e.name&&(tileLayers.activeLayerName=e.name,$("#export-link a").attr("href",function(e,t){return t.replace(/(layer=)([\w\s]+)/,"$1"+tileLayers.activeLayerName)}))}),scaleControl=L.control.scale(r?{metric:!1}:{imperial:!1}).addTo(map),map.fitBounds(new L.LatLngBounds(new L.LatLng(e.minLat,e.minLon),new L.LatLng(e.maxLat,e.maxLon))),map.attributionControl.setPrefix(!1);var d={color:"black",weight:2,opacity:.3},c={type:"Feature",geometry:{type:"LineString",coordinates:[[e.minLon,e.minLat],[e.maxLon,e.minLat],[e.maxLon,e.maxLat],[e.minLon,e.maxLat],[e.minLon,e.minLat]]}};e.initialized&&L.geoJson(c,{style:d}).addTo(map),routingLayer=L.geoJson().addTo(map),routingLayer.options={style:function(e){return e.properties&&e.properties.style},contextmenu:!0,contextmenuItems:defaultContextmenuItems.concat([{text:translate.tr("route"),disabled:!0,index:0},{text:translate.tr("set_intermediate"),icon:"./img/marker-small-blue.png",callback:a,index:1}]),contextmenuInheritItems:!1}}function focus(e,t,a){e.lat&&e.lng&&(t||(t=11),routingLayer.clearLayers(),map.setView(new L.LatLng(e.lat,e.lng),t),mainTemplate.setFlag(e,a))}function getToFrom(e,t){return 0===e?FROM:e===t.route.size()-1?TO:-1}var mainTemplate=require("./main-template.js"),tileLayers=require("./config/tileLayers.js"),translate=require("./translate.js"),routingLayer,map,menuStart,menuIntermediate,menuEnd,elevationControl=null,defaultContextmenuItems;module.exports.clearLayers=function(){routingLayer.clearLayers()},module.exports.getRoutingLayer=function(){return routingLayer},module.exports.getSubLayers=function(e){var t=routingLayer.getLayers();return t.filter(function(t){return t.feature&&t.feature.properties&&t.feature.properties.name===e})},module.exports.addDataToRoutingLayer=function(e){routingLayer.addData(e)},module.exports.eachLayer=function(e){routingLayer.eachLayer(e)},module.exports.setDisabledForMapsContextMenu=function(e,t){"start"===e&&map.contextmenu.setDisabled(menuStart,t),"end"===e&&map.contextmenu.setDisabled(menuEnd,t),"intermediate"===e&&map.contextmenu.setDisabled(menuIntermediate,t)},module.exports.fitMapToBounds=function(e){map.fitBounds(e,{padding:[42,42]})},module.exports.removeLayerFromMap=function(e){map.removeLayer(e)},module.exports.focus=focus,module.exports.initMap=initMap,module.exports.adjustMapSize=adjustMapSize,module.exports.addElevation=function(e,t){null===elevationControl&&(elevationControl=L.control.elevation({position:"bottomright",theme:"white-theme",width:450,height:125,margins:{top:10,right:20,bottom:30,left:60},useHeightIndicator:!0,interpolation:"linear",hoverNumber:{decimalsX:2,decimalsY:0,formatter:void 0},xTicks:void 0,yTicks:void 0,collapsed:!1}),elevationControl.addTo(map)),elevationControl.options.imperial=t,elevationControl.addData(e)},module.exports.clearElevation=function(){elevationControl&&elevationControl.clear()},module.exports.getMap=function(){return map},module.exports.updateScale=function(e){if(null!==scaleControl){scaleControl.remove();var t=e?{metric:!1}:{imperial:!1};scaleControl=L.control.scale(t).addTo(map)}};var FROM="from",TO="to",iconFrom=L.icon({iconUrl:"./img/marker-icon-green.png",shadowSize:[50,64],shadowAnchor:[4,62],iconAnchor:[12,40]}),iconTo=L.icon({iconUrl:"./img/marker-icon-red.png",shadowSize:[50,64],shadowAnchor:[4,62],iconAnchor:[12,40]});module.exports.createMarker=function(e,t,a,n,o,r){var i=getToFrom(e,r);return L.marker([t.lat,t.lng],{icon:i===FROM?iconFrom:i===TO?iconTo:new L.NumberedDivIcon({number:e}),draggable:!0,contextmenu:!0,contextmenuItems:defaultContextmenuItems.concat([{text:translate.tr("marker")+" "+(i===FROM?translate.tr("start_label"):i===TO?translate.tr("end_label"):translate.tr("intermediate_label")+" "+e),disabled:!0,index:0},{text:translate.tr(i!==TO?"set_end":"set_start"),icon:i!==TO?"./img/marker-small-red.png":"./img/marker-small-green.png",callback:i!==TO?a:n,index:2},{text:translate.tr("delete_from_route"),callback:o,disabled:i!==-1&&2===r.route.size(),index:3}]),contextmenuInheritItems:!1}).addTo(routingLayer).bindPopup(i===FROM?translate.tr("start_label"):i===TO?translate.tr("end_label"):translate.tr("intermediate_label")+" "+e)};
 
-},{"./config/tileLayers.js":7,"./main-template.js":20,"./translate.js":29}],22:[function(require,module,exports){
+},{"./config/tileLayers.js":8,"./main-template.js":20,"./translate.js":29}],22:[function(require,module,exports){
 module.exports.extractMetaVersionInfo=function(r){return metaVersionInfo="",r.data_date&&(metaVersionInfo+="<br/>Data date: "+r.data_date),r.import_date&&(metaVersionInfo+="<br/>Import date: "+r.import_date),r.prepare_date&&(metaVersionInfo+="<br/>Prepare date: "+r.prepare_date),r.version&&(metaVersionInfo+="<br/>GH version: "+r.version),r.build_date&&(metaVersionInfo+="<br/>Jar date: "+r.build_date),metaVersionInfo},module.exports.getSignName=function(r){if(r===-3)return"sharp_left";if(r===-2)return"left";if(r===-1)return"slight_left";if(0===r)return"continue";if(1===r)return"slight_right";if(2===r)return"right";if(3===r)return"sharp_right";if(4===r)return"marker-icon-red";if(5===r)return"marker-icon-blue";if(6===r)return"roundabout";throw"did not find sign "+r},module.exports.browserTitle="GraphHopper Maps - Driving Directions";
 
 },{}],23:[function(require,module,exports){
@@ -79,7 +80,7 @@ function createAmbiguityList(o){o.error="",o.resolvedList=[];var n=3e3;if(o.isRe
 },{"./tools/format.js":25,"./tools/math.js":26}],24:[function(require,module,exports){
 var L=require("leaflet");module.exports.getIntermediatePointIndex=function(e,n){for(var t=0,r=e[0].wayPoints,a=[],i=0;i<e.length;++i)for(var o=e[i].coordinates,d=0;d<o.length;++d)o[d].equals(r[t],1e-5)&&t++,a.push({distance:o[d].distanceTo(n),nextWayPointIndex:t===r.length?t-1:t});var s=a.reduce(function(e,n){return n.distance-e.distance<1e-6?n:e}).nextWayPointIndex;return s=s>0&&s<r.length?s:1};
 
-},{"leaflet":4}],25:[function(require,module,exports){
+},{"leaflet":5}],25:[function(require,module,exports){
 function insComma(o,t){return o.length>0?o+", "+t:t}function formatLocationEntry(o){var t={},n="";return o?(o.road&&(n=o.road,o.house_number&&(n.length>0&&(n+=" "),n+=o.house_number),t.road=n),o.postcode&&(t.postcode=o.postcode),t.country=o.country,(o.city||o.suburb||o.town||o.village||o.hamlet||o.locality)&&(n="",o.locality&&(n=insComma(n,o.locality)),o.hamlet&&(n=insComma(n,o.hamlet)),o.village&&(n=insComma(n,o.village)),o.suburb&&(n=insComma(n,o.suburb)),o.city&&(n=insComma(n,o.city)),o.town&&(n=insComma(n,o.town)),t.city=n),n="",o.state&&(n+=o.state),o.continent&&(n=insComma(n,o.continent)),t.more=n,t):t}module.exports.formatLocationEntry=formatLocationEntry,module.exports.formatAddress=function(o){return(o.road?o.road+", ":"")+(o.postcode?o.postcode+", ":"")+(o.city?o.city+", ":"")+(o.country?o.country:"")},module.exports.insComma=insComma,module.exports.formatValue=function(o,t){var n="("+$.Autocomplete.utils.escapeRegExChars(t)+")";return o.replace(/[<>]/g,"_").replace(new RegExp(n,"gi"),"<strong>$1</strong>")};
 
 },{}],26:[function(require,module,exports){
@@ -93,7 +94,7 @@ module.exports.getSortedVehicleKeys=function(e,r){var t=Object.keys(e);return t.
 
 },{}],29:[function(require,module,exports){
 (function (global){
-function tr2(t,r){if(null===t)return console.log("ERROR: key was null?"),"";if(null===defaultTranslationMap)return console.log("ERROR: defaultTranslationMap was not initialized?"),t;t=t.toLowerCase();var o=defaultTranslationMap[t];return!o&&enTranslationMap&&(o=enTranslationMap[t]),o?stringFormat(o,r):t}function tr(t,r){return t!==t.toLowerCase()&&console.log("key "+t+" has to be lower case"),tr2("web."+t,r)}function stringFormat(t,r){if("string"==typeof r&&(r=[r]),t.indexOf("%1$s")>=0)return t.replace(/\%(\d+)\$s/g,function(t,o){return o--,"undefined"!=typeof r[o]?r[o]:t});var o=0;return t.replace(/\%s/g,function(t){var n="undefined"!=typeof r[o]?r[o]:t;return o++,n})}function initI18N(){if(global.$){$("#searchButton").attr("value",tr("search_button"));var t=$("#locationpoints > div.pointDiv > input.pointInput"),r=t.size;$(t).each(function(t){0===t?$(this).attr("placeholder",tr("from_hint")):t===r-1?$(this).attr("placeholder",tr("to_hint")):$(this).attr("placeholder",tr("via_hint"))}),$(".pointDelete").each(function(){$(this).attr("title",tr("delete_from_route"))}),$("#export-link").attr("title",tr("staticlink")),$("#gpxExportButton").attr("title",tr("gpx_export_button"))}}function mToKm(t){return t/1e3}function mToFt(t){return t/.3048}function mToMi(t){return t/1609.344}var defaultTranslationMap=null,enTranslationMap=null,i18nIsInitialized,mathTools=require("./tools/math.js");module.exports.createDistanceString=function(t,r){return r?t<152?mathTools.round(mToFt(t),1)+tr2("ft_abbr"):(t=mathTools.round(mToMi(t),100),t>100&&(t=mathTools.round(t,1)),t+tr2("mi_abbr")):t<900?mathTools.round(t,1)+tr2("m_abbr"):(t=mathTools.round(mToKm(t),100),t>100&&(t=mathTools.round(t,1)),t+tr2("km_abbr"))},module.exports.createEleInfoString=function(t,r,o){var n="";return(t>0||r>0)&&(n="<br/> ",t>0&&(n+=o?"&#8599;"+mathTools.round(mToFt(t),1)+tr2("ft_abbr"):"&#8599;"+mathTools.round(t,1)+tr2("m_abbr")),r>0&&(n+=o?" &#8600;"+mathTools.round(mToFt(r),1)+tr2("ft_abbr"):" &#8600;"+mathTools.round(r,1)+tr2("m_abbr"))),n},module.exports.createTimeString=function(t){var r,o=mathTools.round(t/60/1e3,1e3);return o>60?o/60>24?(r=mathTools.floor(o/60/24,1)+tr2("day_abbr"),o=mathTools.floor(o/60%24,1),o>0&&(r+=" "+o+tr2("hour_abbr"))):(r=mathTools.floor(o/60,1)+tr2("hour_abbr"),o=mathTools.floor(o%60,1),o>0&&(r+=" "+o+tr2("min_abbr"))):r=mathTools.round(o%60,1)+tr2("min_abbr"),r},module.exports.tr=tr,module.exports.tr2=tr2,module.exports.nanoTemplate=function(t,r){return t.replace(/\{([\w\.]*)\}/g,function(t,o){var n=o.split("."),a=r[n.shift()];for(i=0,l=n.length;i<l;_i++)a=a[this];return"undefined"!=typeof a&&null!==a?a:""})},module.exports.init=function(t){defaultTranslationMap=t.default,enTranslationMap=t.en,defaultTranslationMap||(defaultTranslationMap=enTranslationMap),i18nIsInitialized=!0,initI18N()},module.exports.isI18nIsInitialized=function(){return i18nIsInitialized};
+function tr2(t,r){if(null===t)return console.log("ERROR: key was null?"),"";if(null===defaultTranslationMap)return console.log("ERROR: defaultTranslationMap was not initialized?"),t;t=t.toLowerCase();var o=defaultTranslationMap[t];return!o&&enTranslationMap&&(o=enTranslationMap[t]),o?stringFormat(o,r):t}function tr(t,r){return t!==t.toLowerCase()&&console.log("key "+t+" has to be lower case"),tr2("web."+t,r)}function stringFormat(t,r){if("string"==typeof r&&(r=[r]),t.indexOf("%1$s")>=0)return t.replace(/\%(\d+)\$s/g,function(t,o){return o--,"undefined"!=typeof r[o]?r[o]:t});var o=0;return t.replace(/\%s/g,function(t){var n="undefined"!=typeof r[o]?r[o]:t;return o++,n})}function initI18N(){if(global.$){$("#searchButton").attr("value",tr("search_button"));var t=$("#locationpoints > div.pointDiv > input.pointInput"),r=t.size;$(t).each(function(t){0===t?$(this).attr("placeholder",tr("from_hint")):t===r-1?$(this).attr("placeholder",tr("to_hint")):$(this).attr("placeholder",tr("via_hint"))}),$(".pointFlag").each(function(){$(this).attr("title",tr("drag_to_reorder"))}),$(".pointDelete").each(function(){$(this).attr("title",tr("delete_from_route"))}),$("#export-link").attr("title",tr("staticlink")),$("#gpxExportButton").attr("title",tr("gpx_export_button"))}}function mToKm(t){return t/1e3}function mToFt(t){return t/.3048}function mToMi(t){return t/1609.344}var defaultTranslationMap=null,enTranslationMap=null,i18nIsInitialized,mathTools=require("./tools/math.js");module.exports.createDistanceString=function(t,r){return r?t<152?mathTools.round(mToFt(t),1)+tr2("ft_abbr"):(t=mathTools.round(mToMi(t),100),t>100&&(t=mathTools.round(t,1)),t+tr2("mi_abbr")):t<900?mathTools.round(t,1)+tr2("m_abbr"):(t=mathTools.round(mToKm(t),100),t>100&&(t=mathTools.round(t,1)),t+tr2("km_abbr"))},module.exports.createEleInfoString=function(t,r,o){var n="";return(t>0||r>0)&&(n="<br/> ",t>0&&(n+=o?"&#8599;"+mathTools.round(mToFt(t),1)+tr2("ft_abbr"):"&#8599;"+mathTools.round(t,1)+tr2("m_abbr")),r>0&&(n+=o?" &#8600;"+mathTools.round(mToFt(r),1)+tr2("ft_abbr"):" &#8600;"+mathTools.round(r,1)+tr2("m_abbr"))),n},module.exports.createTimeString=function(t){var r,o=mathTools.round(t/60/1e3,1e3);return o>60?o/60>24?(r=mathTools.floor(o/60/24,1)+tr2("day_abbr"),o=mathTools.floor(o/60%24,1),o>0&&(r+=" "+o+tr2("hour_abbr"))):(r=mathTools.floor(o/60,1)+tr2("hour_abbr"),o=mathTools.floor(o%60,1),o>0&&(r+=" "+o+tr2("min_abbr"))):r=mathTools.round(o%60,1)+tr2("min_abbr"),r},module.exports.tr=tr,module.exports.tr2=tr2,module.exports.nanoTemplate=function(t,r){return t.replace(/\{([\w\.]*)\}/g,function(t,o){var n=o.split("."),a=r[n.shift()];for(i=0,l=n.length;i<l;_i++)a=a[this];return"undefined"!=typeof a&&null!==a?a:""})},module.exports.init=function(t){defaultTranslationMap=t.default,enTranslationMap=t.en,defaultTranslationMap||(defaultTranslationMap=enTranslationMap),i18nIsInitialized=!0,initI18N()},module.exports.isI18nIsInitialized=function(){return i18nIsInitialized};
 
 }).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
 },{"./tools/math.js":26}]},{},[20]);
diff --git a/web/src/main/webapp/js/map.js b/web/src/main/webapp/js/map.js
index 0e514a971c..cc3ad125b3 100644
--- a/web/src/main/webapp/js/map.js
+++ b/web/src/main/webapp/js/map.js
@@ -9,6 +9,9 @@ var menuIntermediate;
 var menuEnd;
 var elevationControl = null;
 
+// Items added in every contextmenu.
+var defaultContextmenuItems;
+
 // called if window changes or before map is created
 function adjustMapSize() {
     var mapDiv = $("#map");
@@ -29,9 +32,9 @@ function adjustMapSize() {
     // console.log("adjustMapSize " + height + "x" + width);
 
     // reduce info size depending on how heigh the input_header is and reserve space for footer
-    var instructionInfoMaxHeight = height - 60
-            - $("#input_header").height() - $("#footer").height() - $(".route_description").height();
-    var tabHeight = $("#route_result_tabs li").height()
+    var instructionInfoMaxHeight = height - 60 -
+            $("#input_header").height() - $("#footer").height() - $(".route_description").height();
+    var tabHeight = $("#route_result_tabs li").height();
     if (!isNaN(tabHeight))
         instructionInfoMaxHeight -= tabHeight;
     $(".instructions_info").css("max-height", instructionInfoMaxHeight);
@@ -40,58 +43,57 @@ function adjustMapSize() {
     // $("#info").css("height", height - $("#input_header").height() - 100);
 }
 
-function initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, selectLayer) {
+function initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, selectLayer, useMiles) {
     adjustMapSize();
     // console.log("init map at " + JSON.stringify(bounds));
 
     var defaultLayer = tileLayers.selectLayer(selectLayer);
 
+    defaultContextmenuItems = [{
+        separator: true,
+        index: 10
+    }, {
+        text: translate.tr('show_coords'),
+        callback: function (e) {
+            alert(e.latlng.lat + "," + e.latlng.lng);
+        },
+        index: 11
+    }, {
+        text: translate.tr('center_map'),
+        callback: function (e) {
+            map.panTo(e.latlng);
+        },
+        index: 12
+    }];
+
     // default
     map = L.map('map', {
         layers: [defaultLayer],
         minZoom: 2,
+        // zoomSnap: 0,  // allow fractional zoom levels
         contextmenu: true,
-        contextmenuWidth: 150,
-        contextmenuItems: [{
-                separator: true,
-                index: 3,
-                state: ['set_default']
-            }, {
-                text: translate.tr('show_coords'),
-                callback: function (e) {
-                    alert(e.latlng.lat + "," + e.latlng.lng);
-                },
-                index: 4,
-                state: [1, 2, 3]
-            }, {
-                text: translate.tr('center_map'),
-                callback: function (e) {
-                    map.panTo(e.latlng);
-                },
-                index: 5,
-                state: [1, 2, 3]
-            }],
+        contextmenuItems: defaultContextmenuItems,
         zoomControl: false,
         loadingControl: false
     });
 
-
     var _startItem = {
         text: translate.tr('set_start'),
+        icon: './img/marker-small-green.png',
         callback: setStartCoord,
-        disabled: false,
         index: 0
     };
     var _intItem = {
         text: translate.tr('set_intermediate'),
+        icon: './img/marker-small-blue.png',
         callback: setIntermediateCoord,
         disabled: true,
         index: 1
     };
     var _endItem = {
         text: translate.tr('set_end'),
+        icon: './img/marker-small-red.png',
         callback: setEndCoord,
-        disabled: false,
         index: 2
     };
     menuStart = map.contextmenu.insertItem(_startItem, _startItem.index);
@@ -108,16 +110,6 @@ function initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, selec
         zoomControl: zoomControl
     }).addTo(map);
 
-    map.contextmenu.addSet({
-        name: 'markers',
-        state: 2
-    });
-
-    map.contextmenu.addSet({
-        name: 'path',
-        state: 3
-    });
-
     L.control.layers(tileLayers.getAvailableTileLayers()/*, overlays*/).addTo(map);
 
     map.on('baselayerchange', function (a) {
@@ -129,7 +121,9 @@ function initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, selec
         }
     });
 
-    scaleControl = L.control.scale({
+    scaleControl = L.control.scale(useMiles ? {
+        metric: false
+    } : {
         imperial: false
     }).addTo(map);
 
@@ -139,29 +133,30 @@ function initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, selec
     //if (isProduction())
     //    map.setView(new L.LatLng(0, 0), 2);
 
-    map.attributionControl.setPrefix('');
+    map.attributionControl.setPrefix(false);
 
     var myStyle = {
-        "color": 'black',
-        "weight": 2,
-        "opacity": 0.3
+        color: 'black',
+        weight: 2,
+        opacity: 0.3
     };
     var geoJson = {
-        "type": "Feature",
-        "geometry": {
-            "type": "LineString",
-            "coordinates": [
+        type: "Feature",
+        geometry: {
+            type: "LineString",
+            coordinates: [
                 [bounds.minLon, bounds.minLat],
                 [bounds.maxLon, bounds.minLat],
                 [bounds.maxLon, bounds.maxLat],
                 [bounds.minLon, bounds.maxLat],
-                [bounds.minLon, bounds.minLat]]
+                [bounds.minLon, bounds.minLat]
+            ]
         }
     };
 
     if (bounds.initialized)
         L.geoJson(geoJson, {
-            "style": myStyle
+            style: myStyle
         }).addTo(map);
 
     routingLayer = L.geoJson().addTo(map);
@@ -172,22 +167,17 @@ function initMap(bounds, setStartCoord, setIntermediateCoord, setEndCoord, selec
             return feature.properties && feature.properties.style;
         },
         contextmenu: true,
-        contextmenuItems: [{
-                text: translate.tr('route') + ' ',
+        contextmenuItems: defaultContextmenuItems.concat([{
+                text: translate.tr('route'),
                 disabled: true,
-                index: 0,
-                state: 3
+                index: 0
             }, {
                 text: translate.tr('set_intermediate'),
+                icon: './img/marker-small-blue.png',
                 callback: setIntermediateCoord,
-                index: 1,
-                state: 3
-            }, {
-                separator: true,
-                index: 2,
-                state: 3
-            }],
-        contextmenuAtiveState: 3
+                index: 1
+            }]),
+        contextmenuInheritItems: false
     };
 }
 
@@ -234,7 +224,9 @@ module.exports.setDisabledForMapsContextMenu = function (entry, value) {
 };
 
 module.exports.fitMapToBounds = function (bounds) {
-    map.fitBounds(bounds);
+    map.fitBounds(bounds, {
+        padding: [42, 42]
+    });
 };
 
 module.exports.removeLayerFromMap = function (layer) {
@@ -288,7 +280,7 @@ module.exports.updateScale = function (useMiles) {
     if (scaleControl === null) {
         return;
     }
-    scaleControl.removeFrom(map);
+    scaleControl.remove();
     var options = useMiles ? {metric: false} : {imperial: false};
     scaleControl = L.control.scale(options).addTo(map);
 };
@@ -322,30 +314,24 @@ module.exports.createMarker = function (index, coord, setToEnd, setToStart, dele
         icon: ((toFrom === FROM) ? iconFrom : ((toFrom === TO) ? iconTo : new L.NumberedDivIcon({number: index}))),
         draggable: true,
         contextmenu: true,
-        contextmenuItems: [{
+        contextmenuItems: defaultContextmenuItems.concat([{
                 text: translate.tr("marker") + ' ' + ((toFrom === FROM) ?
                         translate.tr("start_label") : ((toFrom === TO) ?
                         translate.tr("end_label") : translate.tr("intermediate_label") + ' ' + index)),
                 disabled: true,
-                index: 0,
-                state: 2
+                index: 0
             }, {
                 text: translate.tr((toFrom !== TO) ? "set_end" : "set_start"),
+                icon: (toFrom !== TO) ? './img/marker-small-red.png' : './img/marker-small-green.png',
                 callback: (toFrom !== TO) ? setToEnd : setToStart,
-                index: 2,
-                state: 2
+                index: 2
             }, {
                 text: translate.tr("delete_from_route"),
                 callback: deleteCoord,
-                index: 3,
-                state: 2,
-                disabled: (toFrom !== -1 && ghRequest.route.size() === 2) ? true : false // prevent to and from
-            }, {
-                separator: true,
-                index: 4,
-                state: 2
-            }],
-        contextmenuAtiveState: 2
+                disabled: (toFrom !== -1 && ghRequest.route.size() === 2) ? true : false, // prevent to and from
+                index: 3
+            }]),
+        contextmenuInheritItems: false
     }).addTo(routingLayer).bindPopup(((toFrom === FROM) ?
             translate.tr("start_label") : ((toFrom === TO) ?
             translate.tr("end_label") : translate.tr("intermediate_label") + ' ' + index)));
diff --git a/web/src/main/webapp/js/translate.js b/web/src/main/webapp/js/translate.js
index 84760838a9..1d382cbe5e 100644
--- a/web/src/main/webapp/js/translate.js
+++ b/web/src/main/webapp/js/translate.js
@@ -64,6 +64,9 @@ function initI18N() {
             else
                 $(this).attr("placeholder", tr("via_hint"));
         });
+        $('.pointFlag').each(function () {
+            $(this).attr('title', tr('drag_to_reorder'));
+        });
         $('.pointDelete').each(function () {
             $(this).attr("title", tr("delete_from_route"));
         });
diff --git a/web/src/test/java/com/graphhopper/http/BaseServletTester.java b/web/src/test/java/com/graphhopper/http/BaseServletTester.java
index 38fd117865..6804be6597 100644
--- a/web/src/test/java/com/graphhopper/http/BaseServletTester.java
+++ b/web/src/test/java/com/graphhopper/http/BaseServletTester.java
@@ -23,19 +23,29 @@
 import com.graphhopper.util.CmdArgs;
 import com.graphhopper.util.Downloader;
 import com.graphhopper.util.Helper;
+import java.io.IOException;
 import org.json.JSONObject;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import java.net.HttpURLConnection;
-
+import java.util.concurrent.TimeUnit;
+import okhttp3.MediaType;
+import okhttp3.OkHttpClient;
+import okhttp3.Request;
+import okhttp3.RequestBody;
+import okhttp3.Response;
+import org.eclipse.jetty.http.HttpStatus;
 import static org.junit.Assert.assertEquals;
 
 /**
  * @author Peter Karich
  */
 public class BaseServletTester {
-    protected static final Logger logger = LoggerFactory.getLogger(BaseServletTester.class);
+    private static final MediaType MT_JSON = MediaType.parse("application/json; charset=utf-8");
+    private static final MediaType MT_XML = MediaType.parse("application/gpx+xml; charset=utf-8");
+    protected static final Logger LOGGER = LoggerFactory.getLogger(BaseServletTester.class);
+    private final OkHttpClient client = new OkHttpClient.Builder().connectTimeout(1020, TimeUnit.SECONDS).build();
     protected static int port;
     private static GHServer server;
     protected Injector injector;
@@ -46,7 +56,7 @@ public static void shutdownJetty(boolean force) {
             try {
                 server.stop();
             } catch (Exception ex) {
-                logger.error("Cannot stop jetty", ex);
+                LOGGER.error("Cannot stop jetty", ex);
             }
 
         server = null;
@@ -79,25 +89,28 @@ private void bootJetty(CmdArgs args, int retryCount) {
             port = 18080 + i;
             args.put("jetty.port", "" + port);
             try {
-                logger.info("Trying to start jetty at port " + port);
+                LOGGER.info("Trying to start jetty at port " + port);
                 server.start(injector);
 //                server.join();
                 break;
             } catch (Exception ex) {
                 server = null;
-                logger.error("Cannot start jetty at port " + port + " " + ex.getMessage());
+                LOGGER.error("Cannot start jetty at port " + port + " " + ex.getMessage());
             }
         }
     }
 
     protected String getTestRouteAPIUrl() {
-        String host = "localhost";
-        return "http://" + host + ":" + port + "/route";
+        return getTestAPIUrl("/route");
     }
 
     protected String getTestNearestAPIUrl() {
+        return getTestAPIUrl("/nearest");
+    }
+
+    protected String getTestAPIUrl(String path) {
         String host = "localhost";
-        return "http://" + host + ":" + port + "/nearest";
+        return "http://" + host + ":" + port + path;
     }
 
     protected String queryString(String query, int code) throws Exception {
@@ -138,4 +151,20 @@ protected JSONObject nearestQuery(String query) throws Exception {
         Downloader downloader = new Downloader("web integration tester");
         return new JSONObject(downloader.downloadAsString(url, true));
     }
+
+    protected String post(String path, int expectedStatusCode, String xmlOrJson) throws IOException {
+        String url = getTestAPIUrl(path);
+        MediaType type;
+        if (xmlOrJson.startsWith("<")) {
+            type = MT_XML;
+        } else {
+            type = MT_JSON;
+        }
+
+        Response rsp = client.newCall(new Request.Builder().url(url).
+                post(RequestBody.create(type, xmlOrJson)).build()).execute();
+        assertEquals(url + ", http status was:" + rsp.code(),
+                HttpStatus.getMessage(expectedStatusCode), HttpStatus.getMessage(rsp.code()));
+        return rsp.body().string();
+    }
 }
diff --git a/web/src/test/java/com/graphhopper/http/ChangeGraphServletIT.java b/web/src/test/java/com/graphhopper/http/ChangeGraphServletIT.java
new file mode 100644
index 0000000000..c98f6ac03f
--- /dev/null
+++ b/web/src/test/java/com/graphhopper/http/ChangeGraphServletIT.java
@@ -0,0 +1,93 @@
+/*
+ *  Licensed to GraphHopper GmbH under one or more contributor
+ *  license agreements. See the NOTICE file distributed with this work for 
+ *  additional information regarding copyright ownership.
+ * 
+ *  GraphHopper GmbH licenses this file to you under the Apache License, 
+ *  Version 2.0 (the "License"); you may not use this file except in 
+ *  compliance with the License. You may obtain a copy of the License at
+ * 
+ *       http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package com.graphhopper.http;
+
+import com.graphhopper.util.CmdArgs;
+import com.graphhopper.util.Helper;
+import org.json.JSONObject;
+import org.junit.AfterClass;
+import org.junit.Before;
+import org.junit.Test;
+
+import java.io.File;
+
+import static org.junit.Assert.*;
+
+/**
+ * @author Peter Karich
+ */
+public class ChangeGraphServletIT extends BaseServletTester {
+    private static final String DIR = "./target/andorra-gh/";
+
+    @AfterClass
+    public static void cleanUp() {
+        Helper.removeDir(new File(DIR));
+        shutdownJetty(true);
+    }
+
+    @Before
+    public void setUp() {
+        CmdArgs args = new CmdArgs().
+                put("prepare.ch.weightings", "no").
+                put("graph.flag_encoders", "car").
+                put("graph.location", DIR).
+                put("datareader.file", "../core/files/andorra.osm.pbf");
+        setUpJetty(args);
+    }
+
+    @Test
+    public void testBlockAccessViaPoint() throws Exception {
+        JSONObject json = query("point=42.531453,1.518946&point=42.511178,1.54006", 200);
+        JSONObject infoJson = json.getJSONObject("info");
+        assertFalse(infoJson.has("errors"));
+        JSONObject path = json.getJSONArray("paths").getJSONObject(0);
+        // System.out.println("\n\n1\n" + path);
+        double distance = path.getDouble("distance");
+        assertTrue("distance wasn't correct:" + distance, distance > 3000);
+        assertTrue("distance wasn't correct:" + distance, distance < 3500);
+
+        // block road
+        String geoJson = "{"
+                + "'type': 'FeatureCollection',"
+                + "'features': [{"
+                + "  'type': 'Feature',"
+                + "  'geometry': {"
+                + "    'type': 'Point',"
+                + "    'coordinates': [1.521692, 42.522969]"
+                + "  },"
+                + "  'properties': {"
+                + "    'vehicles': ['car'],"
+                + "    'access': false"
+                + "  }}]}".replaceAll("'", "\"");
+        String res = post("/change", 200, geoJson);
+        JSONObject jsonObj = new JSONObject(res);
+        assertEquals(1, jsonObj.getInt("updates"));
+
+        // route around blocked road => longer
+        json = query("point=42.531453,1.518946&point=42.511178,1.54006", 200);
+        infoJson = json.getJSONObject("info");
+        assertFalse(infoJson.has("errors"));
+        path = json.getJSONArray("paths").getJSONObject(0);
+
+        // System.out.println("\n\n2\n" + path);
+
+        distance = path.getDouble("distance");
+        assertTrue("distance wasn't correct:" + distance, distance > 5300);
+        assertTrue("distance wasn't correct:" + distance, distance < 5800);
+    }
+}
diff --git a/web/src/test/java/com/graphhopper/http/GraphHopperServletIT.java b/web/src/test/java/com/graphhopper/http/GraphHopperServletIT.java
index 5516358324..20011b3657 100644
--- a/web/src/test/java/com/graphhopper/http/GraphHopperServletIT.java
+++ b/web/src/test/java/com/graphhopper/http/GraphHopperServletIT.java
@@ -23,6 +23,7 @@
 import com.graphhopper.PathWrapper;
 import com.graphhopper.util.CmdArgs;
 import com.graphhopper.util.Helper;
+import com.graphhopper.util.TranslationMap;
 import com.graphhopper.util.exceptions.PointOutOfBoundsException;
 import com.graphhopper.util.shapes.GHPoint;
 import org.json.JSONObject;
@@ -32,6 +33,7 @@
 
 import java.io.File;
 import java.util.List;
+import java.util.Locale;
 import java.util.Map;
 
 import static org.junit.Assert.*;
@@ -133,6 +135,21 @@ public void testGraphHopperWeb() throws Exception {
         assertEquals(23, instructions.size());
         assertEquals("Continue onto la Callisa", instructions.get(0).get("text"));
         assertEquals("At roundabout, take exit 2", instructions.get(3).get("text"));
+        assertEquals(true, instructions.get(3).get("exited"));
+        assertEquals(false, instructions.get(21).get("exited"));
+    }
+
+    @Test
+    public void testInitInstructionsWithTurnDescription() {
+        GraphHopperAPI hopper = new GraphHopperWeb();
+        assertTrue(hopper.load(getTestRouteAPIUrl()));
+        GHRequest request = new GHRequest(42.554851, 1.536198, 42.510071, 1.548128);
+        GHResponse rsp = hopper.route(request);
+        assertEquals("Continue onto Carrer Antoni Fiter i Rossell", rsp.getBest().getInstructions().get(2).getName());
+
+        request.getHints().put("turn_description", false);
+        rsp = hopper.route(request);
+        assertEquals("Carrer Antoni Fiter i Rossell", rsp.getBest().getInstructions().get(2).getName());
     }
 
     @Test
diff --git a/web/src/test/java/com/graphhopper/http/GraphHopperWebTest.java b/web/src/test/java/com/graphhopper/http/GraphHopperWebTest.java
index 0b54f07b14..e163bf8931 100644
--- a/web/src/test/java/com/graphhopper/http/GraphHopperWebTest.java
+++ b/web/src/test/java/com/graphhopper/http/GraphHopperWebTest.java
@@ -27,6 +27,7 @@
 import java.io.IOException;
 import java.io.InputStream;
 import java.net.HttpURLConnection;
+import java.util.Arrays;
 
 import static org.junit.Assert.*;
 
@@ -83,4 +84,10 @@ public String downloadAsString(String url, boolean readErrorStreamNoException) t
         req.getHints().put("alternative_route.max_paths", "4");
         instance.route(req);
     }
+
+    @Test
+    public void testSimpleToStringStream() {
+        assertEquals("12;2", Arrays.asList("12", "2").stream().reduce("", (s1, s2) -> s1.isEmpty() ? s2 : s1 + ";" + s2));
+        assertEquals("2", Arrays.asList("2").stream().reduce("", (s1, s2) -> s1.isEmpty() ? s2 : s1 + ";" + s2));
+    }
 }
diff --git a/web/src/test/webapp/spec/routeManipulationSpec.js b/web/src/test/webapp/spec/routeManipulationSpec.js
index 3d83b7f4ef..b089f54dc3 100644
--- a/web/src/test/webapp/spec/routeManipulationSpec.js
+++ b/web/src/test/webapp/spec/routeManipulationSpec.js
@@ -1,5 +1,8 @@
-// because leaflet-src.js requires window, document etc. we need to provide these variables...
-global.window = {};
+// Because leaflet-src.js requires window, document, and navigator we need to
+// provide these variables.
+global.window = {
+    screen: {}
+};
 global.document = {
     documentElement: {
         style: {}
@@ -8,6 +11,7 @@ global.document = {
     createElement: function() { return {}; }
 };
 global.navigator = {
+    platform: 'nodejs',
     userAgent: 'nodejs'
 };
 
@@ -46,7 +50,7 @@ describe('getIntermediatePointIndex', function () {
             coordinates: [a, x1, x2, x3, b, x4, x5, c, x6, x7, d],
             wayPoints: [a, b, c, d]
         }];
-        
+
         for(var i=0; i < clickLocations.length; ++i) {
             expect(routeManipulation.getIntermediatePointIndex(routeSegments, clickLocations[i].latlng))
                     .toEqual(clickLocations[i].expectedIndex);
@@ -97,7 +101,7 @@ describe('getIntermediatePointIndex', function () {
             coordinates: [c, x6, x7, d],
             wayPoints: wayPoints
         }];
-    
+
         for(var i=0; i < clickLocations.length; ++i) {
             expect(routeManipulation.getIntermediatePointIndex(routeSegments, clickLocations[i].latlng))
                     .toEqual(clickLocations[i].expectedIndex);
