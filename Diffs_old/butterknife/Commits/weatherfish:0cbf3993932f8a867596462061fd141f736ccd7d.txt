diff --git a/build.gradle b/build.gradle
index 5bfb85a5..a14015d6 100644
--- a/build.gradle
+++ b/build.gradle
@@ -3,7 +3,9 @@ subprojects { project ->
   version = VERSION_NAME
 
   repositories {
-    mavenCentral()
+    maven {
+      url "https://plugins.gradle.org/m2/"
+    }
   }
 
   if (!project.name.equals('butterknife-gradle-plugin')) {
@@ -28,14 +30,12 @@ subprojects { project ->
 
   buildscript {
     repositories {
-      mavenCentral()
       maven {
         url "https://plugins.gradle.org/m2/"
       }
     }
     dependencies {
-      classpath 'com.android.tools.build:gradle:2.1.3'
-      classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8'
+      classpath 'com.android.tools.build:gradle:2.2.0'
       classpath 'gradle.plugin.com.kageiit:lintrules:1.1.2'
     }
   }
@@ -60,7 +60,7 @@ ext.deps = [
     supportCompat: "com.android.support:support-compat:$supportLibraryVersion",
     supportAnnotations: "com.android.support:support-annotations:$supportLibraryVersion",
     supportTestRunner: 'com.android.support.test:runner:0.5',
-    androidGradle: 'com.android.tools.build:gradle:2.1.3',
+    androidGradle: 'com.android.tools.build:gradle:2.2.0',
     lint: "com.android.tools.lint:lint:$androidToolsVersion",
     lintApi: "com.android.tools.lint:lint-api:$androidToolsVersion",
     lintChecks: "com.android.tools.lint:lint-checks:$androidToolsVersion",
@@ -81,7 +81,6 @@ ext.deps = [
     autoservice: 'com.google.auto.service:auto-service:1.0-rc2',
     autocommon: 'com.google.auto:auto-common:0.6',
 
-
     butterknife: "com.jakewharton:butterknife:$butterknifeLatestReleaseVersion",
     butterknifeCompiler: "com.jakewharton:butterknife-compiler:$butterknifeLatestReleaseVersion"
 ]
diff --git a/butterknife-integration-test/build.gradle b/butterknife-integration-test/build.gradle
index 047eaacf..79584af3 100644
--- a/butterknife-integration-test/build.gradle
+++ b/butterknife-integration-test/build.gradle
@@ -1,5 +1,4 @@
 apply plugin: 'com.android.application'
-apply plugin: 'com.neenbedankt.android-apt'
 
 android {
   compileSdkVersion rootProject.ext.compileSdkVersion
@@ -37,7 +36,7 @@ android {
 
 dependencies {
   compile project(':butterknife')
-  apt project(':butterknife-compiler')
+  annotationProcessor project(':butterknife-compiler')
 
   testCompile deps.junit
   testCompile deps.truth
diff --git a/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleActivityTest.java b/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleActivityTest.java
index c5be63ce..ccda50b4 100644
--- a/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleActivityTest.java
+++ b/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleActivityTest.java
@@ -6,11 +6,11 @@
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.robolectric.Robolectric;
-import org.robolectric.RobolectricGradleTestRunner;
+import org.robolectric.RobolectricTestRunner;
 
 import static com.google.common.truth.Truth.assertThat;
 
-@RunWith(RobolectricGradleTestRunner.class)
+@RunWith(RobolectricTestRunner.class)
 public class SimpleActivityTest {
   @Test public void verifyContentViewBinding() {
     SimpleActivity activity = Robolectric.buildActivity(SimpleActivity.class).create().get();
diff --git a/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleAdapterTest.java b/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleAdapterTest.java
index 59dad6ce..cd625c3e 100644
--- a/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleAdapterTest.java
+++ b/butterknife-integration-test/src/test/java/com/example/butterknife/library/SimpleAdapterTest.java
@@ -1,23 +1,22 @@
 package com.example.butterknife.library;
 
 import android.content.Context;
-import android.view.LayoutInflater;
 import android.view.View;
 import com.example.butterknife.R;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.robolectric.RobolectricGradleTestRunner;
+import org.robolectric.RobolectricTestRunner;
 import org.robolectric.RuntimeEnvironment;
 
 import static com.example.butterknife.library.SimpleAdapter.ViewHolder;
 import static com.google.common.truth.Truth.assertThat;
 
-@RunWith(RobolectricGradleTestRunner.class)
+@RunWith(RobolectricTestRunner.class)
 public class SimpleAdapterTest {
   @Test public void verifyViewHolderViews() {
     Context context = RuntimeEnvironment.application;
 
-    View root = LayoutInflater.from(context).inflate(R.layout.simple_list_item, null);
+    View root = View.inflate(context, R.layout.simple_list_item, null);
     ViewHolder holder = new ViewHolder(root);
 
     assertThat(holder.word.getId()).isEqualTo(R.id.word);
diff --git a/butterknife-integration-test/src/test/java/com/example/butterknife/unbinder/UnbinderTest.java b/butterknife-integration-test/src/test/java/com/example/butterknife/unbinder/UnbinderTest.java
index 9cc6536c..55754140 100644
--- a/butterknife-integration-test/src/test/java/com/example/butterknife/unbinder/UnbinderTest.java
+++ b/butterknife-integration-test/src/test/java/com/example/butterknife/unbinder/UnbinderTest.java
@@ -7,12 +7,12 @@
 import butterknife.Unbinder;
 import org.junit.Test;
 import org.junit.runner.RunWith;
-import org.robolectric.RobolectricGradleTestRunner;
+import org.robolectric.RobolectricTestRunner;
 import org.robolectric.RuntimeEnvironment;
 
 import static com.google.common.truth.Truth.assertThat;
 
-@RunWith(RobolectricGradleTestRunner.class)
+@RunWith(RobolectricTestRunner.class)
 public final class UnbinderTest {
 
   @Test
diff --git a/butterknife/build.gradle b/butterknife/build.gradle
index 6f2bb055..06fc3869 100644
--- a/butterknife/build.gradle
+++ b/butterknife/build.gradle
@@ -33,9 +33,23 @@ dependencies {
   testCompile deps.junit
   testCompile deps.truth
   testCompile deps.compiletesting
-  testCompile files(org.gradle.internal.jvm.Jvm.current().getRuntimeJar())
+  testCompile files(getRuntimeJar())
   testCompile files(org.gradle.internal.jvm.Jvm.current().getToolsJar())
   testCompile project(':butterknife-compiler')
 }
 
+def getRuntimeJar() {
+  try {
+    final File javaBase = new File(System.getProperty("java.home")).getCanonicalFile();
+    File runtimeJar = new File(javaBase, "lib/rt.jar");
+    if (runtimeJar.exists()) {
+      return runtimeJar;
+    }
+    runtimeJar = new File(javaBase, "jre/lib/rt.jar");
+    return runtimeJar.exists() ? runtimeJar : null;
+  } catch (IOException e) {
+    throw new RuntimeException(e);
+  }
+}
+
 apply from: rootProject.file('gradle/gradle-mvn-push.gradle')
diff --git a/checkstyle.xml b/checkstyle.xml
index 67d211ce..a91a2812 100644
--- a/checkstyle.xml
+++ b/checkstyle.xml
@@ -16,7 +16,7 @@
 
   <!-- Space after 'for' and 'if' -->
   <module name="RegexpSingleline">
-    <property name="format" value="^\s*(for|if)[^ ]"/>
+    <property name="format" value="^\s*(for|if)\b[^ ]"/>
     <property name="message" value="Space needed before opening parenthesis."/>
   </module>
 
diff --git a/gradle/wrapper/gradle-wrapper.jar b/gradle/wrapper/gradle-wrapper.jar
index 3baa851b..6ffa2378 100644
Binary files a/gradle/wrapper/gradle-wrapper.jar and b/gradle/wrapper/gradle-wrapper.jar differ
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index f3fdc34d..a65e9c08 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,6 +1,6 @@
-#Fri Sep 02 22:21:42 PDT 2016
+#Mon Sep 19 21:26:00 PDT 2016
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-3.1-all.zip
diff --git a/gradlew b/gradlew
index 27309d92..9aa616c2 100755
--- a/gradlew
+++ b/gradlew
@@ -161,4 +161,9 @@ function splitJvmOpts() {
 eval splitJvmOpts $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS
 JVM_OPTS[${#JVM_OPTS[*]}]="-Dorg.gradle.appname=$APP_BASE_NAME"
 
+# by default we should be in the correct project dir, but when run from Finder on Mac, the cwd is wrong
+if [[ "$(uname)" == "Darwin" ]] && [[ "$HOME" == "$PWD" ]]; then
+  cd "$(dirname "$0")"
+fi
+
 exec "$JAVACMD" "${JVM_OPTS[@]}" -classpath "$CLASSPATH" org.gradle.wrapper.GradleWrapperMain "$@"
diff --git a/gradlew.bat b/gradlew.bat
index f6d5974e..e95643d6 100644
--- a/gradlew.bat
+++ b/gradlew.bat
@@ -49,7 +49,6 @@ goto fail
 @rem Get command-line arguments, handling Windows variants
 
 if not "%OS%" == "Windows_NT" goto win9xME_args
-if "%@eval[2+2]" == "4" goto 4NT_args
 
 :win9xME_args
 @rem Slurp the command line arguments.
@@ -60,11 +59,6 @@ set _SKIP=2
 if "x%~1" == "x" goto execute
 
 set CMD_LINE_ARGS=%*
-goto execute
-
-:4NT_args
-@rem Get arguments from the 4NT Shell from JP Software
-set CMD_LINE_ARGS=%$
 
 :execute
 @rem Setup the command line
diff --git a/sample/app/build.gradle b/sample/app/build.gradle
index 40ccd2d6..41fa2f5f 100644
--- a/sample/app/build.gradle
+++ b/sample/app/build.gradle
@@ -1,5 +1,4 @@
 apply plugin: 'com.android.application'
-apply plugin: 'com.neenbedankt.android-apt'
 
 android {
   compileSdkVersion rootProject.ext.compileSdkVersion
@@ -32,13 +31,12 @@ android {
 
 dependencies {
   compile deps.butterknife
-  apt deps.butterknifeCompiler
+  annotationProcessor deps.butterknifeCompiler
 
   compile project(':sample:library')
 
   testCompile deps.junit
   testCompile deps.truth
-  testCompile deps.robolectric
 }
 
 afterEvaluate {
diff --git a/sample/library/build.gradle b/sample/library/build.gradle
index df52a0e3..826c25aa 100644
--- a/sample/library/build.gradle
+++ b/sample/library/build.gradle
@@ -1,11 +1,10 @@
 buildscript {
   dependencies {
-    classpath 'com.jakewharton:butterknife-gradle-plugin:8.2.0'
+    classpath 'com.jakewharton:butterknife-gradle-plugin:8.4.0'
   }
 }
 
 apply plugin: 'com.android.library'
-apply plugin: 'com.neenbedankt.android-apt'
 apply plugin: 'com.jakewharton.butterknife'
 
 android {
@@ -19,9 +18,8 @@ android {
 
 dependencies {
   compile deps.butterknife
-  apt deps.butterknifeCompiler
+  annotationProcessor deps.butterknifeCompiler
 
   testCompile deps.junit
   testCompile deps.truth
-  testCompile deps.robolectric
 }
