diff --git a/build.gradle b/build.gradle
index 4d95a3b5..cf3d11f2 100644
--- a/build.gradle
+++ b/build.gradle
@@ -6,10 +6,10 @@ buildscript {
       'compileSdk': 26,
       'buildTools': '26.0.1',
 
-      'supportLibrary': '26.0.1',
-      'androidPlugin': '3.0.0-beta2',
-      'androidTools': '26.0.0-beta2',
-      'kotlin': '1.1.3-2',
+      'supportLibrary': '26.0.2',
+      'androidPlugin': '3.0.0-beta5',
+      'androidTools': '26.0.0-beta5',
+      'kotlin': '1.1.4-3',
 
       'release': '8.8.1',
   ]
@@ -23,7 +23,7 @@ buildscript {
           'compat': "com.android.support:support-compat:${versions.supportLibrary}",
           'annotations': "com.android.support:support-annotations:${versions.supportLibrary}",
           'test': [
-              'runner': 'com.android.support.test:runner:1.0.0',
+              'runner': 'com.android.support.test:runner:1.0.1',
           ],
       ],
       'lint': [
@@ -33,11 +33,11 @@ buildscript {
           'tests': "com.android.tools.lint:lint-tests:${versions.androidTools}",
       ],
       javapoet: 'com.squareup:javapoet:1.9.0',
-      javaparser: 'com.github.javaparser:javaparser-core:3.3.0',
+      javaparser: 'com.github.javaparser:javaparser-core:3.3.5',
       junit: 'junit:junit:4.12',
-      truth: 'com.google.truth:truth:0.34',
+      truth: 'com.google.truth:truth:0.35',
       robolectric: 'org.robolectric:robolectric:3.4.2',
-      compiletesting: 'com.google.testing.compile:compile-testing:0.11',
+      compiletesting: 'com.google.testing.compile:compile-testing:0.12',
       'auto': [
           'service': 'com.google.auto.service:auto-service:1.0-rc3',
           'common': 'com.google.auto:auto-common:0.8',
diff --git a/butterknife-compiler/src/main/java/butterknife/compiler/ButterKnifeProcessor.java b/butterknife-compiler/src/main/java/butterknife/compiler/ButterKnifeProcessor.java
index e67a6847..8faac8b1 100644
--- a/butterknife-compiler/src/main/java/butterknife/compiler/ButterKnifeProcessor.java
+++ b/butterknife-compiler/src/main/java/butterknife/compiler/ButterKnifeProcessor.java
@@ -67,6 +67,7 @@
 import javax.lang.model.element.ExecutableElement;
 import javax.lang.model.element.Modifier;
 import javax.lang.model.element.Name;
+import javax.lang.model.element.PackageElement;
 import javax.lang.model.element.TypeElement;
 import javax.lang.model.element.VariableElement;
 import javax.lang.model.type.ArrayType;
@@ -499,7 +500,7 @@ private void parseBindView(Element element, Map<TypeElement, BindingSet.Builder>
   }
 
   private QualifiedId elementToQualifiedId(Element element, int id) {
-    return new QualifiedId(elementUtils.getPackageOf(element).getQualifiedName().toString(), id);
+    return new QualifiedId(elementUtils.getPackageOf(element), id);
   }
 
   private void parseBindViews(Element element, Map<TypeElement, BindingSet.Builder> builderMap,
@@ -1354,58 +1355,67 @@ private void scanForRClasses(RoundEnvironment env) {
       for (Element element : env.getElementsAnnotatedWith(annotation)) {
         JCTree tree = (JCTree) trees.getTree(element, getMirror(element, annotation));
         if (tree != null) { // tree can be null if the references are compiled types and not source
-          String respectivePackageName =
-              elementUtils.getPackageOf(element).getQualifiedName().toString();
-          scanner.setCurrentPackageName(respectivePackageName);
+          scanner.setCurrentPackage(elementUtils.getPackageOf(element));
           tree.accept(scanner);
         }
       }
     }
 
-    for (Map.Entry<String, Set<String>> packageNameToRClassSet : scanner.getRClasses().entrySet()) {
-      String respectivePackageName = packageNameToRClassSet.getKey();
-      for (String rClass : packageNameToRClassSet.getValue()) {
-        parseRClass(respectivePackageName, rClass);
+    for (Map.Entry<PackageElement, Set<Symbol.ClassSymbol>> packageNameToRClassSet
+          : scanner.getRClasses().entrySet()) {
+      PackageElement respectivePackageName = packageNameToRClassSet.getKey();
+      for (Symbol.ClassSymbol rClass : packageNameToRClassSet.getValue()) {
+        parseRClass(respectivePackageName, rClass, scanner.getReferenced());
       }
     }
   }
 
-  private void parseRClass(String respectivePackageName, String rClass) {
-    Element element;
+  private void parseRClass(PackageElement respectivePackageName, Symbol.ClassSymbol rClass,
+      Set<String> referenced) {
+    TypeElement element;
 
     try {
-      element = elementUtils.getTypeElement(rClass);
+      element = rClass;
     } catch (MirroredTypeException mte) {
-      element = typeUtils.asElement(mte.getTypeMirror());
+      element = (TypeElement) typeUtils.asElement(mte.getTypeMirror());
     }
 
     JCTree tree = (JCTree) trees.getTree(element);
     if (tree != null) { // tree can be null if the references are compiled types and not source
-      IdScanner idScanner = new IdScanner(symbols, elementUtils.getPackageOf(element)
-          .getQualifiedName().toString(), respectivePackageName);
+      IdScanner idScanner =
+          new IdScanner(symbols, elementUtils.getPackageOf(element), respectivePackageName,
+              referenced);
       tree.accept(idScanner);
     } else {
-      parseCompiledR(respectivePackageName, (TypeElement) element);
+      parseCompiledR(respectivePackageName, element, referenced);
     }
   }
 
-  private void parseCompiledR(String respectivePackageName, TypeElement rClass) {
+  private void parseCompiledR(PackageElement respectivePackageName, TypeElement rClass,
+      Set<String> referenced) {
     for (Element element : rClass.getEnclosedElements()) {
       String innerClassName = element.getSimpleName().toString();
       if (SUPPORTED_TYPES.contains(innerClassName)) {
         for (Element enclosedElement : element.getEnclosedElements()) {
           if (enclosedElement instanceof VariableElement) {
-            VariableElement variableElement = (VariableElement) enclosedElement;
-            Object value = variableElement.getConstantValue();
-
-            if (value instanceof Integer) {
-              int id = (Integer) value;
-              ClassName rClassName =
-                  ClassName.get(elementUtils.getPackageOf(variableElement).toString(), "R",
-                      innerClassName);
-              String resourceName = variableElement.getSimpleName().toString();
-              QualifiedId qualifiedId = new QualifiedId(respectivePackageName, id);
-              symbols.put(qualifiedId, new Id(id, rClassName, resourceName));
+            String fqName = elementUtils.getPackageOf(enclosedElement).getQualifiedName().toString()
+                + ".R."
+                + innerClassName
+                + "."
+                + enclosedElement.toString();
+            if (referenced.contains(fqName)) {
+              VariableElement variableElement = (VariableElement) enclosedElement;
+              Object value = variableElement.getConstantValue();
+
+              if (value instanceof Integer) {
+                int id = (Integer) value;
+                ClassName rClassName =
+                    ClassName.get(elementUtils.getPackageOf(variableElement).toString(), "R",
+                        innerClassName);
+                String resourceName = variableElement.getSimpleName().toString();
+                QualifiedId qualifiedId = new QualifiedId(respectivePackageName, id);
+                symbols.put(qualifiedId, new Id(id, rClassName, resourceName));
+              }
             }
           }
         }
@@ -1414,9 +1424,10 @@ private void parseCompiledR(String respectivePackageName, TypeElement rClass) {
   }
 
   private static class RClassScanner extends TreeScanner {
-    // Maps the currently evaulated rPackageName to R Classes
-    private final Map<String, Set<String>> rClasses = new LinkedHashMap<>();
-    private String currentPackageName;
+    // Maps the currently evaluated rPackageName to R Classes
+    private final Map<PackageElement, Set<Symbol.ClassSymbol>> rClasses = new LinkedHashMap<>();
+    private PackageElement currentPackage;
+    private Set<String> referenced = new HashSet<>();
 
     @Override public void visitSelect(JCTree.JCFieldAccess jcFieldAccess) {
       Symbol symbol = jcFieldAccess.sym;
@@ -1424,33 +1435,41 @@ private void parseCompiledR(String respectivePackageName, TypeElement rClass) {
           && symbol.getEnclosingElement() != null
           && symbol.getEnclosingElement().getEnclosingElement() != null
           && symbol.getEnclosingElement().getEnclosingElement().enclClass() != null) {
-        Set<String> rClassSet = rClasses.get(currentPackageName);
+        Set<Symbol.ClassSymbol> rClassSet = rClasses.get(currentPackage);
         if (rClassSet == null) {
           rClassSet = new HashSet<>();
-          rClasses.put(currentPackageName, rClassSet);
+          rClasses.put(currentPackage, rClassSet);
         }
-        rClassSet.add(symbol.getEnclosingElement().getEnclosingElement().enclClass().className());
+        referenced.add(getFqName(symbol));
+        rClassSet.add(symbol.getEnclosingElement().getEnclosingElement().enclClass());
       }
     }
 
-    Map<String, Set<String>> getRClasses() {
+    Map<PackageElement, Set<Symbol.ClassSymbol>> getRClasses() {
       return rClasses;
     }
 
-    void setCurrentPackageName(String respectivePackageName) {
-      this.currentPackageName = respectivePackageName;
+    Set<String> getReferenced() {
+      return referenced;
+    }
+
+    void setCurrentPackage(PackageElement packageElement) {
+      this.currentPackage = packageElement;
     }
   }
 
   private static class IdScanner extends TreeScanner {
     private final Map<QualifiedId, Id> ids;
-    private final String rPackageName;
-    private final String respectivePackageName;
+    private final PackageElement rPackageName;
+    private final PackageElement respectivePackageName;
+    private final Set<String> referenced;
 
-    IdScanner(Map<QualifiedId, Id> ids, String rPackageName, String respectivePackageName) {
+    IdScanner(Map<QualifiedId, Id> ids, PackageElement rPackageName,
+        PackageElement respectivePackageName, Set<String> referenced) {
       this.ids = ids;
       this.rPackageName = rPackageName;
       this.respectivePackageName = respectivePackageName;
+      this.referenced = referenced;
     }
 
     @Override public void visitClassDef(JCTree.JCClassDecl jcClassDecl) {
@@ -1459,8 +1478,9 @@ void setCurrentPackageName(String respectivePackageName) {
           ClassTree classTree = (ClassTree) tree;
           String className = classTree.getSimpleName().toString();
           if (SUPPORTED_TYPES.contains(className)) {
-            ClassName rClassName = ClassName.get(rPackageName, "R", className);
-            VarScanner scanner = new VarScanner(ids, rClassName, respectivePackageName);
+            ClassName rClassName = ClassName.get(rPackageName.getQualifiedName().toString(), "R",
+                    className);
+            VarScanner scanner = new VarScanner(ids, rClassName, respectivePackageName, referenced);
             ((JCTree) classTree).accept(scanner);
           }
         }
@@ -1471,22 +1491,34 @@ void setCurrentPackageName(String respectivePackageName) {
   private static class VarScanner extends TreeScanner {
     private final Map<QualifiedId, Id> ids;
     private final ClassName className;
-    private final String respectivePackageName;
+    private final PackageElement respectivePackageName;
+    private final Set<String> referenced;
 
     private VarScanner(Map<QualifiedId, Id> ids, ClassName className,
-        String respectivePackageName) {
+        PackageElement respectivePackageName, Set<String> referenced) {
       this.ids = ids;
       this.className = className;
       this.respectivePackageName = respectivePackageName;
+      this.referenced = referenced;
     }
 
     @Override public void visitVarDef(JCTree.JCVariableDecl jcVariableDecl) {
       if ("int".equals(jcVariableDecl.getType().toString())) {
-        int id = Integer.valueOf(jcVariableDecl.getInitializer().toString());
         String resourceName = jcVariableDecl.getName().toString();
-        QualifiedId qualifiedId = new QualifiedId(respectivePackageName, id);
-        ids.put(qualifiedId, new Id(id, className, resourceName));
+        if (referenced.contains(getFqName(jcVariableDecl.sym))) {
+          int id = Integer.valueOf(jcVariableDecl.getInitializer().toString());
+          QualifiedId qualifiedId = new QualifiedId(respectivePackageName, id);
+          ids.put(qualifiedId, new Id(id, className, resourceName));
+        }
       }
     }
   }
+
+  private static String getFqName(Symbol rSymbol) {
+    return rSymbol.packge().getQualifiedName().toString()
+        + ".R."
+        + rSymbol.enclClass().name.toString()
+        + "."
+        + rSymbol.name.toString();
+  }
 }
diff --git a/butterknife-compiler/src/main/java/butterknife/compiler/QualifiedId.java b/butterknife-compiler/src/main/java/butterknife/compiler/QualifiedId.java
index 76600c89..1d8683e4 100644
--- a/butterknife-compiler/src/main/java/butterknife/compiler/QualifiedId.java
+++ b/butterknife-compiler/src/main/java/butterknife/compiler/QualifiedId.java
@@ -1,10 +1,12 @@
 package butterknife.compiler;
 
+import javax.lang.model.element.PackageElement;
+
 final class QualifiedId {
-  final String packageName;
+  final PackageElement packageName;
   final int id;
 
-  QualifiedId(String packageName, int id) {
+  QualifiedId(PackageElement packageName, int id) {
     this.packageName = packageName;
     this.id = id;
   }
