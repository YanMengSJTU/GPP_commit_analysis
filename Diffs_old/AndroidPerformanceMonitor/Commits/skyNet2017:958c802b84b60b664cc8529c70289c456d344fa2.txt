diff --git a/blockcanary-analyzer/build.gradle b/blockcanary-analyzer/build.gradle
index 83af379..d97bf98 100644
--- a/blockcanary-analyzer/build.gradle
+++ b/blockcanary-analyzer/build.gradle
@@ -3,7 +3,7 @@ apply from: 'gradle-mvn-push.gradle'
 
 android {
     compileSdkVersion LIBRARY_COMPILE_SDK_VERSION
-    buildToolsVersion LIBRARY_BUILD_TOOLS_VERSION
+    buildToolsVersion '28.0.2'
 
     defaultConfig {
         minSdkVersion LIBRARY_MIN_SDK_VERSION
diff --git a/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/BlockCanaryInternals.java b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/BlockCanaryInternals.java
index 895d0d6..29dc5df 100644
--- a/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/BlockCanaryInternals.java
+++ b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/BlockCanaryInternals.java
@@ -59,6 +59,7 @@ public void onBlockEvent(long realTimeStart, long realTimeEnd,
                             .setCpuBusyFlag(cpuSampler.isCpuBusy(realTimeStart, realTimeEnd))
                             .setRecentCpuRate(cpuSampler.getCpuRateInfo())
                             .setThreadStackEntries(threadStackEntries)
+                            .setStackTraceElements(stackSampler.getTraceElements())
                             .flushString();
                     LogWriter.save(blockInfo.toString());
 
diff --git a/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/StackSampler.java b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/StackSampler.java
index 2d65e4a..b6c6653 100644
--- a/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/StackSampler.java
+++ b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/StackSampler.java
@@ -31,6 +31,14 @@
     private int mMaxEntryCount = DEFAULT_MAX_ENTRY_COUNT;
     private Thread mCurrentThread;
 
+    public  StackTraceElement[] getTraceElements() {
+        synchronized (sStackMap) {
+            return traceElements;
+        }
+    }
+
+    private static  StackTraceElement[] traceElements;
+
     public StackSampler(Thread thread, long sampleIntervalMillis) {
         this(thread, DEFAULT_MAX_ENTRY_COUNT, sampleIntervalMillis);
     }
@@ -59,8 +67,8 @@ public StackSampler(Thread thread, int maxEntryCount, long sampleIntervalMillis)
     @Override
     protected void doSample() {
         StringBuilder stringBuilder = new StringBuilder();
-
-        for (StackTraceElement stackTraceElement : mCurrentThread.getStackTrace()) {
+        traceElements = mCurrentThread.getStackTrace();
+        for (StackTraceElement stackTraceElement : traceElements) {
             stringBuilder
                     .append(stackTraceElement.toString())
                     .append(BlockInfo.SEPARATOR);
diff --git a/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java
index 1b07edd..d15fce1 100644
--- a/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java
+++ b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java
@@ -94,6 +94,7 @@
     public boolean cpuBusy;
     public String cpuRateInfo;
     public ArrayList<String> threadStackEntries = new ArrayList<>();
+    public StackTraceElement[] stackTraceElements ;
 
     private StringBuilder basicSb = new StringBuilder();
     private StringBuilder cpuSb = new StringBuilder();
@@ -163,6 +164,11 @@ public BlockInfo setThreadStackEntries(ArrayList<String> threadStackEntries) {
         return this;
     }
 
+    public BlockInfo setStackTraceElements(StackTraceElement[] stackTraceElements) {
+        this.stackTraceElements = stackTraceElements;
+        return this;
+    }
+
     public BlockInfo setMainThreadTimeCost(long realTimeStart, long realTimeEnd, long threadTimeStart, long threadTimeEnd) {
         timeCost = realTimeEnd - realTimeStart;
         threadTimeCost = threadTimeEnd - threadTimeStart;
@@ -220,4 +226,22 @@ public String getTimeString() {
     public String toString() {
         return String.valueOf(basicSb) + timeSb + cpuSb + stackSb;
     }
+
+    public Exception buildException(){
+        StringBuilder sb = new StringBuilder("threadTimeCost time cost:")
+                .append(threadTimeCost)
+                .append("ms,real time cost:")
+                .append(timeCost)
+                .append("ms");
+        if(timeCost - threadTimeCost > 300){
+            sb.append(",thread waiting a long time!!!");
+        }
+        if(cpuBusy){
+            sb.append(",cpu is busy !!!");
+        }
+        Exception exception = new BlockcanaryException(sb.toString());
+        exception.setStackTrace(stackTraceElements);
+        return exception;
+
+    }
 }
diff --git a/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/internal/BlockcanaryException.java b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/internal/BlockcanaryException.java
new file mode 100644
index 0000000..a348a39
--- /dev/null
+++ b/blockcanary-analyzer/src/main/java/com/github/moduth/blockcanary/internal/BlockcanaryException.java
@@ -0,0 +1,24 @@
+package com.github.moduth.blockcanary.internal;
+
+/**
+ * time:2019/6/8
+ * author:hss
+ * desription:
+ */
+public class BlockcanaryException extends Exception{
+
+    public BlockcanaryException() {
+    }
+
+    public BlockcanaryException(String detailMessage) {
+        super(detailMessage);
+    }
+
+    public BlockcanaryException(String detailMessage, Throwable throwable) {
+        super(detailMessage, throwable);
+    }
+
+    public BlockcanaryException(Throwable throwable) {
+        super(throwable);
+    }
+}
diff --git a/blockcanary-android-no-op/build.gradle b/blockcanary-android-no-op/build.gradle
index 83af379..d97bf98 100644
--- a/blockcanary-android-no-op/build.gradle
+++ b/blockcanary-android-no-op/build.gradle
@@ -3,7 +3,7 @@ apply from: 'gradle-mvn-push.gradle'
 
 android {
     compileSdkVersion LIBRARY_COMPILE_SDK_VERSION
-    buildToolsVersion LIBRARY_BUILD_TOOLS_VERSION
+    buildToolsVersion '28.0.2'
 
     defaultConfig {
         minSdkVersion LIBRARY_MIN_SDK_VERSION
diff --git a/blockcanary-android-no-op/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java b/blockcanary-android-no-op/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java
index 278a8c7..0dbd64f 100644
--- a/blockcanary-android-no-op/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java
+++ b/blockcanary-android-no-op/src/main/java/com/github/moduth/blockcanary/internal/BlockInfo.java
@@ -1,4 +1,23 @@
 package com.github.moduth.blockcanary.internal;
 
 public class BlockInfo {
+    public Exception buildException(){
+        return null;
+    }
+
+    public String getBasicString() {
+        return "";
+    }
+
+    public String getCpuString() {
+        return "";
+    }
+
+    public String getTimeString() {
+        return "";
+    }
+
+    public String toString() {
+        return "";
+    }
 }
diff --git a/blockcanary-android/build.gradle b/blockcanary-android/build.gradle
index ebe613e..d32fee1 100644
--- a/blockcanary-android/build.gradle
+++ b/blockcanary-android/build.gradle
@@ -3,7 +3,7 @@ apply from: 'gradle-mvn-push.gradle'
 
 android {
     compileSdkVersion LIBRARY_COMPILE_SDK_VERSION
-    buildToolsVersion LIBRARY_BUILD_TOOLS_VERSION
+    buildToolsVersion '28.0.2'
 
     defaultConfig {
         minSdkVersion LIBRARY_MIN_SDK_VERSION
@@ -21,6 +21,6 @@ android {
 
 dependencies {
     compile fileTree(include: ['*.jar'], dir: 'libs')
-//    compile project(':blockcanary-analyzer')
-    compile 'com.github.markzhai:blockcanary-analyzer:1.5.0'
+    compile project(':blockcanary-analyzer')
+ //   compile 'com.github.markzhai:blockcanary-analyzer:1.5.0'
 }
diff --git a/blockcanary-sample/build.gradle b/blockcanary-sample/build.gradle
index 32d69b8..def04dc 100644
--- a/blockcanary-sample/build.gradle
+++ b/blockcanary-sample/build.gradle
@@ -2,7 +2,7 @@ apply plugin: 'com.android.application'
 
 android {
     compileSdkVersion LIBRARY_COMPILE_SDK_VERSION
-    buildToolsVersion LIBRARY_BUILD_TOOLS_VERSION
+    buildToolsVersion '28.0.2'
 
     defaultConfig {
         applicationId "com.example.blockcanary"
diff --git a/blockcanary-sample/src/main/java/com/example/blockcanary/AppContext.java b/blockcanary-sample/src/main/java/com/example/blockcanary/AppContext.java
index 612df72..e0d9f23 100644
--- a/blockcanary-sample/src/main/java/com/example/blockcanary/AppContext.java
+++ b/blockcanary-sample/src/main/java/com/example/blockcanary/AppContext.java
@@ -15,11 +15,13 @@
  */
 package com.example.blockcanary;
 
+import android.content.Context;
 import android.content.pm.PackageInfo;
 import android.content.pm.PackageManager;
 import android.util.Log;
 
 import com.github.moduth.blockcanary.BlockCanaryContext;
+import com.github.moduth.blockcanary.internal.BlockInfo;
 
 import java.util.List;
 
@@ -82,4 +84,14 @@ public boolean displayNotification() {
     public boolean stopWhenDebugging() {
         return true;
     }
+
+    @Override
+    public void onBlock(Context context, BlockInfo blockInfo) {
+        super.onBlock(context, blockInfo);
+        Exception e = blockInfo.buildException();
+        if(e != null){
+            e.printStackTrace();
+        }
+        Log.e("block",blockInfo.toString());
+    }
 }
\ No newline at end of file
diff --git a/build.gradle b/build.gradle
index 2e498be..5f83be9 100644
--- a/build.gradle
+++ b/build.gradle
@@ -4,9 +4,10 @@ buildscript {
     repositories {
         mavenCentral()
         jcenter()
+        google()
     }
     dependencies {
-        classpath 'com.android.tools.build:gradle:2.2.2'
+        classpath 'com.android.tools.build:gradle:3.2.0'
     }
 }
 
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index 586936a..71fd68f 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,6 +1,6 @@
-#Wed Apr 13 16:42:11 CST 2016
+#Sat Jun 08 14:14:09 CST 2019
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip
+distributionUrl=https\://services.gradle.org/distributions/gradle-4.6-all.zip
