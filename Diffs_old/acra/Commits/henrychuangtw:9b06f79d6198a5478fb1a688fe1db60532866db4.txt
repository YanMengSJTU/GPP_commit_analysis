diff --git a/.gitignore b/.gitignore
index 04a2dd73..1b0642ed 100644
--- a/.gitignore
+++ b/.gitignore
@@ -6,3 +6,4 @@ pom.xml.releaseBackup
 release.properties
 *.iml
 *.idea/*
+build/
\ No newline at end of file
diff --git a/NOTICE b/NOTICE
index 97bd4cb3..dd203f43 100644
--- a/NOTICE
+++ b/NOTICE
@@ -3,5 +3,3 @@ Copyright (c) 2013 Kevin Gaudin
 http://acra.ch
 
 This product is licensed under the terms of the Apache Software License 2.0. See the LICENSE file for the full license text.
-
-This product includes software (package org.acra.jraf.android.util.activitylifecyclecallbackscompat) developed at JRAF, Copyright (C) 2013 Benoit 'BoD' Lubek (BoD@JRAF.org), ASL 2.0.
diff --git a/README.md b/README.md
index 9f53fd81..b0907bae 100644
--- a/README.md
+++ b/README.md
@@ -1,156 +1,45 @@
 [![Click here to lend your support to: ACRA - Application Crash Reports for Android and make a donation at www.pledgie.com !](https://pledgie.com/campaigns/18789.png?skin_name=chrome)](http://www.pledgie.com/campaigns/18789) [![Flattr this project](http://api.flattr.com/button/flattr-badge-large.png)](https://flattr.com/submit/auto?user_id=kevingaudin&url=http://acra.ch&title=ACRA%20-%20Application%20Crash%20Reports%20for%20Android&language=&tags=opensource%2Candroid&category=software&description=ACRA%20%28Application%20Crash%20Reports%20for%20Android%29%20is%20an%20open%20source%20android%20library%20for%20developers%2C%20enabling%20their%20apps%20to%20send%20detailed%20reports%20when%20they%20crash.)
 
-<a href="https://plus.google.com/118444843928759726538" rel="publisher">Follow ACRA on Google+ for latest news and tips.</a>
-
-[![](https://ssl.gstatic.com/images/icons/gplus-32.png)](https://plus.google.com/118444843928759726538)
-
 What is ACRA ?
 ==============
 
-ACRA is a library enabling Android Application to automatically post their crash reports to a GoogleDoc form. It is targetted to android applications developers to help them get data from their applications when they crash or behave erroneously.
+ACRA is a library enabling Android Application to automatically post their crash reports to a GoogleDoc form. It is targeted to android applications developers to help them get data from their applications when they crash or behave erroneously.
 
-ACRA is used in 2.76% ([See AppBrain/stats](http://www.appbrain.com/stats/libraries/details/acra/acra)) of all apps on Google Play as of Jan 2015. That's over 40M **apps** using ACRA. And since the average US user has 41 apps installed on their phone that means there is a 70% chance that ACRA is running on any phone. That means ACRA is running on over a **billion devices**.
+ACRA is used in 2.68% ([See AppBrain/stats](http://www.appbrain.com/stats/libraries/details/acra/acra)) of all apps on Google Play as of Feb 2016. That's over 53K **apps** using ACRA. And since the average US user has 41 apps installed on their phone that means there is a 70% chance that ACRA is running on any phone. That means ACRA is running on over a **billion devices**.
 
 See [BasicSetup](http://github.com/ACRA/acra/wiki/BasicSetup) for a step-by-step installation and usage guide.
 
 A crash reporting feature for android apps is native since Android 2.2 (FroYo) but only available through the official Android Market (and with limited data). ACRA is a great help for Android developers :
 
   * [developer configurable user interaction](http://github.com/ACRA/acra/wiki/AdvancedUsage#wiki-User_Interaction): silent reports, Toast notification, status bar notification + dialog or direct dialog
-  * usable with ALL versions of android (compiled with 1.5, not tested on 1.0/1.1 but might work... but who does really care ?) and capable of retrieving data from latest versions through reflection.
+  * usable with ALL versions of Android from 2.2 onwards.
   * more [detailed crash reports](http://github.com/ACRA/acra/wiki/ReportContent) about the device running the app than what is displayed in the Android Market developer console error reports
   * you can [add your own variables content or debug traces](http://github.com/ACRA/acra/wiki/AdvancedUsage#wiki-Adding_your_own_variables_content_or_traces_in_crash_reports) to the reports
   * you can send [error reports even if the application doesn't crash](http://github.com/ACRA/acra/wiki/AdvancedUsage#wiki-Sending_reports_for_caught_exceptions)
-  * works for any application even if not delivered through Google's Android Market => great for devices/regions where the Android Market is not available, beta releases or for enterprise private apps
+  * works for any application even if not delivered through Google PLay => great for devices/regions where the Google Play is not available, beta releases or for enterprise private apps
   * if there is no network coverage, reports are kept and sent on a later application restart
   * can be used with [your own self-hosted report receiver script](http://github.com/ACRA/acra/wiki/AdvancedUsage#wiki-Reports_destination)
   * google doc reports can be shared with a whole development team. Other benefits from the Google Docs platform are still to be investigated (stats, macros...)
 
 ACRA's notification systems are clean. If a crash occurs, your application does not add user notifications over existing system's crash notifications or reporting features. If you use the Toast, Status bar notification or direct dialog modes, the "force close" dialog is not displayed anymore and devices where the system native reporting feature is enabled do not offer the user to send an additional report.
 
-The user is notified of an error only once, and you might enhance the percieved quality of your application by defining your own texts in the notifications/dialogs.
+The user is notified of an error only once, and you might enhance the perceived quality of your application by defining your own texts in the notifications/dialogs.
 
 Please do not hesitate to open defects/enhancements requests in [the issue tracker](http://github.com/ACRA/acra/issues).
 
-Change Log
-==========
+Latest version ACRA v4.9.0 - 4-JUN-2016
+===========================================
 
 For a complete changelog, please see the [ChangeLog page](http://github.com/ACRA/acra/wiki/ChangeLog) in the Wiki.
 
-ACRA v4.7
-===============================
-- Support for Android M (6.0)
-  - Using HtttpUrlConnection instead of Apache Http
-  - Using com.android.support:support-v4 to provide support fro removed Notification methods.
-- Minimum Android version is Froyo (2.2). ACRA will disable itself for anything prior to that.  
-- Packaging as an AAR.
-  In order to use com.android.support:support-v4 ACRA now needs to be packaged as an AAR instead of a JAR.
-- Removal of maxNumberOfRequestRetries config as HttpUrlConnection does not natively support retries on Socket timeout.
-- Removal of httpsSocketFactoryFactoryClass config and TlsSniSocketFactory as it was not natively supported with HttpUrlConnection and it is questionable as to whether it is still required.
-  HttpUrlConnection decides upon the Socket to use based upon protocol.
-- Removal of disableSSLCertValidation (this hasn't been used since the introduction of the keystore parameter).  
-- Increase of default connection timeout to 5000ms
-- Increase of default socket timeout to 8000ms
-
-
-ACRA v4.6
-===============================
-
-The summarized changelog is here: https://github.com/ACRA/acra/wiki/ChangeLog
-
-Included in this release (summarized summary):
-- CustomReportDialog using @ReportCrashes#reportDialogClass (NB must extend from BaseCrashReportDialog).
-- many bugfixes
-
-ACRA v4.5 - enabling the future
-===============================
-
-**ACRA 4.5.0 is now the official stable version.**
-
-https://oss.sonatype.org/content/groups/public/ch/acra/acra/4.5.0/acra-4.5.0.zip
-(also available in Maven Central repository)
-
-The summarized changelog is here: https://github.com/ACRA/acra/wiki/ChangeLog
-
-Included in this release (summarized summary):
-- many bugfixes
-- no more exception thrown in ACRA.init() if called twice (widget developers will enjoy it)
-- HttpPostSender is renamed HttpSender and can send PUT and POST requests with data encoded as FORM (same as before) and JSON. The JSON mode enables a fully structured JSON tree to be sent to your backend.
-- Display configuration details can benefit of the newly introduced DisplayManager from Android 4.2
-- CrashReportDialog is now using AlertDialog.Builder to ensure that dialogs are created using the UX guidelines enforced by the android version. (you should remove its theme attribute in your manifest to benefit from the default theme of the device)
-- Ability to set Http Headers with `ACRAConfig.setHttpHeaders()`
-
-The most important part of this release is to enable the usage of Acralyzer (http://github.com/ACRA/acralyzer) which will be the default backend in future release.
-
-Next release will be 5.0 with important changes in mind:
-- no more default support of old Google Forms
-- use JSON as the default report storage and management mode (current implementation transforms flat data into JSON just before sending it)
-
-New ideas about the project are always welcome, you can open feature requests in the Github issue tracker.
-
-
-ACRA v4.4 - enforcing security
-==============================
-
-ACRA has been named in [this report](http://www.cs.utexas.edu/~shmat/shmat_ccs12.pdf) as a potential cause of SSL vulnerability for all android apps using it.
-
-The truth is that, in order to let devs use alternative backends over an SSL connection with self-signed certificates, I chose to disable certificate validation in earlier versions of the lib. But this was done only on the scope of ACRA reports senders. Using ACRA did not imply that your app became unsafe for all its SSL communications.
-
-Prior to ACRA v4.4.0, reports content were indeed vulnerable to a man in the middle attack. There "can" be some private data in there, but there are really few by default.
-
-ACRA v4.4.0 has been modified to use SSL certificate validation by default. If you send your reports to your own server via SSL with a self-signed certificate, you have to set the option `disableSSLCertValidation` to `true` (annotation or dynamic config).
-
-ACRA v4.3 is now STABLE
-=======================
-
-After 15 months of great service and more than 11700 downloads, it's time for v4.2.3 to bow out and live a new life among the deprecated releases.
-
-Here's what's new in ACRA 4.3.0:
-
-* cleaned, more stable code base, reducing reports duplicates (thanks to William Ferguson)
-* new experimental and long awaited **direct dialog** interaction mode, _without notifications_ (thanks to Julia Segal)
-* full **runtime configuration API**, required for projects using Android Library Projects since ADT14, and very handy for developers in need of dynamic ACRA configuration.
-* addition of a collector for a custom log file
-* addition of a collector for the details of the broken thread (id, name, groupname)
-* addition of a collector for the new MediaCodecList provided in the Jelly Bean API
-
-A more detailed description of the changes has been introduced in [this Google+ post](https://plus.google.com/b/118444843928759726538/118444843928759726538/posts/cnABXX7bbxV), based on the [ChangeLog](acra/wiki/ChangeLog).
-
-If you upgrade from 4.2.3, be aware that the default list of ReportFields has changed. You would better create a new spreadsheet & form with the help of the doc/CrashReports-Template.csv or use `@ReportsCrashes(customReportContent={...})` to redefine your own list of fields.
-
-Thanks a lot to everyone for testing during these 3 weeks of Beta (with special thanks to Nikolay Elenkov for his feedback on the dynamic configuration API), the 3 successive beta releases have reached 397 downloads on googlecode, not including Maven downloads. There has been very few reports during the Beta, a proof that you can rely on this new version even more than you could rely on the previous.
-
-About Maven. ACRA is now available on Maven Central, with 4.2.3 and 4.3.0 stable releases available on the central repository. Just note these IDs: groupId `ch.acra` artifactId `acra`.
-
-If you think there are missing parts in the documentation, please open an issue. 
-
-_Kevin_
-
-----
-
-ACRA v4.X main new features
-===========================
-
-You can read in the [ChangeLog](http://code.google.com/p/acra/acra/wiki/ChangeLog) that many things have been added since ACRA 3.1. Here is a summary:
-
-  * In addition to standard logcat data, reports can contain eventslog and radioevents data
-  * Reports will contain the result of the "`adb shell dumpsys meminfo <pid>`" command which gives details about your application memory usage right after the crash.
-  * Introduction of an abstraction layer for report senders. This allows to:
-    * use the `formUri` parameter to send reports to your custom server script with POST parameters names not related to Google Forms naming. POST parameters will have easy to understand names.
-    * introduce a new report sending mode: email (see below)
-    * create your own custom report senders. There is now a simple public interface allowing you to code your own class in charge of handling report data. Your sender(s) can be added to default senders or replace them.
-  * Reports can now be sent via email (through an `ACTION_SEND` intent so the user has to choose the email client he wants to use and then send the email containing report fields in the body). The list of report fields included is configurable. This allows to get rid of the `INTERNET` permission in apps where it does not make any sense.
-  * Custom report receiver server scripts can be secured with basic http authentication (login/password can be configured in ACRA)
-  * If the `READ_PHONE_STATE` permission is granted, reports include the Unique Device Identifier (IMEI). This can be really useful for enterprise applications deployment.
-
------
 
 And after that?
 ===============
 
 Now that ACRA is stabilized on the device side (there shouldn't be much more data required...), the effort should be placed on crash data analysis and reports management tools for developers.
 
-You can look at [some contributions](http://github.com/ACRA/acra/wiki/Contribs) that have already been published. Most of them are work in progress, so if you feel like joining the effort, please do!
+You can look at [some contributions](https://github.com/ACRA/acra/wiki/Backends) that have already been published.
 
-[Acralyzer](http://github.com/ACRA/acralyzer) will soon be the official backend for reports storage and analysis. It is a free and open source modern web app, based on a full open stack and using advanced
+[Acralyzer](http://github.com/ACRA/acralyzer) is the official backend for reports storage and analysis. It is a free and open source modern web app, based on a full open stack and using advanced
 technology like CouchDB (JSON document storage with a RESTful API and Map/Reduce querying), AngularJS (one of the most advanced client-side JS frameworks), D3JS (for data visualisation)... If you are interested
 in webapps development, this project can become your playground too ;-)
diff --git a/build.gradle b/build.gradle
index 8802e4f2..c1997d58 100644
--- a/build.gradle
+++ b/build.gradle
@@ -1,29 +1,36 @@
 apply plugin: 'com.android.library'
 
+ext {
+    final def pom = new XmlSlurper().parse(new File(projectDir, "pom.xml"))
+    acraVersion = pom.version.toString()
+    supportVersion = pom.depthFirst().find { it.name() == 'support.version' }.toString()
+    androidVersion = pom.depthFirst().find { it.name() == 'android.version' }.toInteger()
+    proguardFile = pom.depthFirst().find { it.name() == 'consumerProguardFile' }.toString()
+    println("building ACRA $acraVersion for android $androidVersion with support version $supportVersion")
+}
+
 android {
-    compileSdkVersion 23
-    buildToolsVersion "23.0.1"
+    compileSdkVersion androidVersion
+    buildToolsVersion "23.0.3"
 
     lintOptions {
         abortOnError false
     }
 
     defaultConfig {
-        minSdkVersion 4
-        targetSdkVersion 23
-        versionCode 1
-        versionName "1.0"
+        minSdkVersion 8
+        targetSdkVersion androidVersion
+        versionName acraVersion
+        consumerProguardFile proguardFile
     }
-    
-    buildTypes {
-        release {
-            minifyEnabled false
-            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
-        }
+
+    compileOptions {
+        sourceCompatibility JavaVersion.VERSION_1_6
+        targetCompatibility JavaVersion.VERSION_1_6
     }
 }
 
 dependencies {
-    compile fileTree(dir: 'libs', include: ['*.jar'])
-    compile 'com.android.support:support-v4:23.1.0'
+    compile "com.android.support:support-v4:$supportVersion"
+    compile "com.android.support:support-annotations:$supportVersion"
 }
diff --git a/pom.xml b/pom.xml
index 2d872013..ea7bfcde 100644
--- a/pom.xml
+++ b/pom.xml
@@ -8,7 +8,7 @@
 	<groupId>ch.acra</groupId>
 	<artifactId>acra</artifactId>
 	<packaging>aar</packaging>
-	<version>4.7.1-SNAPSHOT</version>
+	<version>4.9.1-SNAPSHOT</version>
 
 	<name>Application Crash Report for Android</name>
 
@@ -49,11 +49,13 @@
 		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
 
 		<!--
-			NB ACRA supports back to API3.
+			NB ACRA supports back to API 8.
+
 			But in order to compile classes and method that will NOT be used except when the target platform is of sufficient version
-			we need to compile against version 23.
+			we need to compile against version 23. All such classes are in the org.acra.jraf package.
 		-->
         <android.version>23</android.version>
+		<support.version>23.3.0</support.version>
 	</properties>
 
 	<dependencies>
@@ -76,9 +78,17 @@
 		<dependency>
 			<groupId>com.android.support</groupId>
 			<artifactId>support-v4</artifactId>
-			<version>23.0.1</version>
+			<version>${support.version}</version>
 			<type>aar</type>
 		</dependency>
+
+		<dependency>
+			<groupId>com.android.support</groupId>
+			<artifactId>support-annotations</artifactId>
+			<version>${support.version}</version>
+			<type>jar</type>
+		</dependency>
+
 		<dependency>
 			<groupId>junit</groupId>
 			<artifactId>junit</artifactId>
@@ -86,13 +96,6 @@
 			<type>jar</type>
 			<scope>test</scope>
 		</dependency>
-
-        <dependency>
-            <groupId>org.json</groupId>
-            <artifactId>json</artifactId>
-            <version>20080701</version>
-            <scope>provided</scope>
-        </dependency>
     </dependencies>
 
 	<build>
@@ -112,7 +115,7 @@
 				</plugin>
 				<plugin>
 					<artifactId>maven-javadoc-plugin</artifactId>
-					<version>2.7</version>
+					<version>2.10.3</version>
 				</plugin>
 				<plugin>
 					<artifactId>maven-source-plugin</artifactId>
@@ -125,8 +128,22 @@
 			<plugin>
 				<groupId>com.simpligility.maven.plugins</groupId>
 				<artifactId>android-maven-plugin</artifactId>
-				<version>4.3.0</version>
+				<version>4.4.2</version>
 				<extensions>true</extensions>
+				<configuration>
+					<consumerProguardFiles>
+						<consumerProguardFile>src/main/proguard/proguard.cfg</consumerProguardFile>
+					</consumerProguardFiles>
+
+					<buildConfigConstants>
+						<buildConfigConstant>
+							<name>VERSION_NAME</name>
+							<type>String</type>
+							<value>${project.version}</value>
+						</buildConfigConstant>
+					</buildConfigConstants>
+
+				</configuration>
 			</plugin>
 
 			<plugin>
@@ -151,7 +168,7 @@
 					</execution>
 				</executions>
                 <configuration>
-					<bootclasspath>${env.ANDROID_HOME}/platforms/android-${android.version}/android.jar</bootclasspath>
+					<bootclasspath>${env.JAVA_HOME}/jre/lib/rt.jar;${env.ANDROID_HOME}/platforms/android-${android.version}/android.jar</bootclasspath>
                     <excludePackageNames>org.acra.log,org.acra.util</excludePackageNames>
                 </configuration>
 			</plugin>
diff --git a/proguard-rules.pro b/proguard-rules.pro
deleted file mode 100644
index fe3e5e46..00000000
--- a/proguard-rules.pro
+++ /dev/null
@@ -1,17 +0,0 @@
-# Add project specific ProGuard rules here.
-# By default, the flags in this file are appended to flags specified
-# in C:\Android\android-sdk-windows/tools/proguard/proguard-android.txt
-# You can edit the include path and order by changing the proguardFiles
-# directive in build.gradle.
-#
-# For more details, see
-#   http://developer.android.com/guide/developing/tools/proguard.html
-
-# Add any project specific keep options here:
-
-# If your project uses WebView with JS, uncomment the following
-# and specify the fully qualified class name to the JavaScript interface
-# class:
-#-keepclassmembers class fqcn.of.javascript.interface.for.webview {
-#   public *;
-#}
diff --git a/src/main/AndroidManifest.xml b/src/main/AndroidManifest.xml
index c0895c62..c5d4a733 100644
--- a/src/main/AndroidManifest.xml
+++ b/src/main/AndroidManifest.xml
@@ -9,8 +9,6 @@
   ~ Contact support@xandar.com.au for copyright requests.
   -->
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
-          android:versionCode="0"
-          android:versionName="UPDATED-BY-BUILD"
           package="ch.acra.acra">
     
     <!--
@@ -38,5 +36,20 @@
         1.1     2
         1.0     1
     -->
-    <uses-sdk android:minSdkVersion="8" android:targetSdkVersion="23"/>
+    <uses-sdk android:minSdkVersion="8"/>
+
+    <application>
+        <activity
+            android:name="org.acra.dialog.CrashReportDialog"
+            android:theme="@android:style/Theme.Dialog"
+            android:launchMode="singleInstance"
+            android:excludeFromRecents="true"
+            android:finishOnTaskLaunch="true"
+            android:process=":acra"/>
+
+        <service
+            android:name="org.acra.sender.SenderService"
+            android:exported="false"
+            android:process=":acra" />
+    </application>
 </manifest>
\ No newline at end of file
diff --git a/src/main/java/org/acra/ACRA.java b/src/main/java/org/acra/ACRA.java
index 773f3190..33bbc425 100644
--- a/src/main/java/org/acra/ACRA.java
+++ b/src/main/java/org/acra/ACRA.java
@@ -15,18 +15,28 @@
  */
 package org.acra;
 
+import android.app.Application;
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.content.SharedPreferences.OnSharedPreferenceChangeListener;
 import android.os.Build;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
 import org.acra.annotation.ReportsCrashes;
+import org.acra.config.ACRAConfiguration;
+import org.acra.config.ACRAConfigurationException;
+import org.acra.config.ConfigurationBuilder;
+import org.acra.legacy.ReportMigrator;
 import org.acra.log.ACRALog;
 import org.acra.log.AndroidLogDelegate;
+import org.acra.prefs.PrefUtils;
+import org.acra.prefs.SharedPreferencesFactory;
+import org.acra.util.ApplicationStartupProcessor;
+import org.acra.util.IOUtils;
 
-import android.app.Application;
-import android.content.SharedPreferences;
-import android.content.SharedPreferences.OnSharedPreferenceChangeListener;
-import android.content.pm.ApplicationInfo;
-import android.content.pm.PackageManager;
-import android.content.pm.PackageManager.NameNotFoundException;
-import android.preference.PreferenceManager;
+import java.io.FileInputStream;
+import java.io.IOException;
 
 /**
  * Use this class to initialize the crash reporting feature using
@@ -34,18 +44,23 @@
  * subclass {@link Application#onCreate()} method. Configuration items must have
  * been set by using {@link ReportsCrashes} above the declaration of your
  * {@link Application} subclass.
- * 
+ *
  * @author Kevin Gaudin
- * 
+ *
  */
-public class ACRA {
+@SuppressWarnings({"WeakerAccess","unused"})
+public final class ACRA {
+    private ACRA(){}
+
+    public static /*non-final*/ boolean DEV_LOGGING = false; // Should be false for release.
 
-    public static final boolean DEV_LOGGING = false; // Should be false for
-                                                     // release.
     public static final String LOG_TAG = ACRA.class.getSimpleName();
-    
+
+    @NonNull
     public static ACRALog log = new AndroidLogDelegate();
 
+    private static final String ACRA_PRIVATE_PROCESS_NAME= ":acra";
+
     /**
      * The key of the application default SharedPreference where you can put a
      * 'true' Boolean value to disable ACRA.
@@ -92,70 +107,121 @@
      */
     public static final String PREF_LAST_VERSION_NR = "acra.lastVersionNr";
 
+    private static final String PREF__LEGACY_ALREADY_CONVERTED_TO_4_8_0 = "acra.legacyAlreadyConvertedTo4.8.0";
+
     private static Application mApplication;
+    @Nullable
+    private static ACRAConfiguration configProxy;
 
     // Accessible via ACRA#getErrorReporter().
+    @Nullable
     private static ErrorReporter errorReporterSingleton;
 
     // NB don't convert to a local field because then it could be garbage
     // collected and then we would have no PreferenceListener.
-    private static OnSharedPreferenceChangeListener mPrefListener;
+    private static OnSharedPreferenceChangeListener mPrefListener; // TODO consider moving to ErrorReport so it doesn't need to be a static field.
 
     /**
      * <p>
-     * Initialize ACRA for a given Application. The call to this method should
-     * be placed as soon as possible in the {@link Application#onCreate()}
-     * method.
+     * Initialize ACRA for a given Application.
+     *
+     * The call to this method should be placed as soon as possible in the {@link Application#attachBaseContext(Context)} method.
+     *
+     * Uses the configuration as configured with the @ReportCrashes annotation.
+     * Sends any unsent reports.
      * </p>
-     * 
+     *
      * @param app   Your Application class.
      * @throws IllegalStateException if it is called more than once.
      */
-    public static void init(Application app) {
+    public static void init(@NonNull Application app) {
         final ReportsCrashes reportsCrashes = app.getClass().getAnnotation(ReportsCrashes.class);
         if (reportsCrashes == null) {
-            log.e(LOG_TAG,
-                    "ACRA#init called but no ReportsCrashes annotation on Application " + app.getPackageName());
+            log.e(LOG_TAG, "ACRA#init(Application) called but no ReportsCrashes annotation on Application " + app.getPackageName());
             return;
         }
-        init(app, new ACRAConfiguration(reportsCrashes));
+        try {
+            init(app, new ConfigurationBuilder(app).build());
+        } catch (ACRAConfigurationException e) {
+            log.w(LOG_TAG, "Configuration Error - ACRA not started : " + e.getMessage());
+        }
     }
 
     /**
      * <p>
-     * Initialize ACRA for a given Application. The call to this method should
-     * be placed as soon as possible in the {@link Application#onCreate()}
-     * method.
+     * Initialize ACRA for a given Application.
+     *
+     * The call to this method should be placed as soon as possible in the {@link Application#attachBaseContext(Context)} method.
+     *
+     * Uses the configuration as configured with the @ReportCrashes annotation.
+     * Sends any unsent reports.
+     * </p>
+     *
+     * @param app     Your Application class.
+     * @param builder ConfigurationBuilder to manually set up ACRA configuration.
+     */
+    public static void init(@NonNull Application app, @NonNull ConfigurationBuilder builder) {
+        init(app, builder, true);
+    }
+
+    /**
+     * <p>
+     * Initialize ACRA for a given Application.
+     *
+     * The call to this method should be placed as soon as possible in the {@link Application#attachBaseContext(Context)}  method.
+     * </p>
+     *
+     * @param app                            Your Application class.
+     * @param builder                        ConfigurationBuilder to manually set up ACRA configuration.
+     * @param checkReportsOnApplicationStart Whether to invoke ErrorReporter.checkReportsOnApplicationStart().
+     */
+    public static void init(@NonNull Application app, @NonNull ConfigurationBuilder builder, boolean checkReportsOnApplicationStart) {
+        try {
+            init(app, builder.build(), checkReportsOnApplicationStart);
+        } catch (ACRAConfigurationException e) {
+            log.w(LOG_TAG, "Configuration Error - ACRA not started : " + e.getMessage());
+        }
+    }
+
+    /**
+     * <p>
+     * Initialize ACRA for a given Application.
+     *
+     * The call to this method should be placed as soon as possible in the {@link Application#attachBaseContext(Context)} method.
+     *
+     * Sends any unsent reports.
      * </p>
      *
      * @param app       Your Application class.
      * @param config    ACRAConfiguration to manually set up ACRA configuration.
      * @throws IllegalStateException if it is called more than once.
      */
-    public static void init(Application app, ACRAConfiguration config) {
+    public static void init(@NonNull Application app, @NonNull ACRAConfiguration config) {
         init(app, config, true);
     }
 
     /**
      * <p>
      * Initialize ACRA for a given Application. The call to this method should
-     * be placed as soon as possible in the {@link Application#onCreate()}
+     * be placed as soon as possible in the {@link Application#attachBaseContext(Context)}
      * method.
      * </p>
      *
      * @param app       Your Application class.
      * @param config    ACRAConfiguration to manually set up ACRA configuration.
-     * @param checkReportsOnApplicationStart    Whether to invoke
-     *     ErrorReporter.checkReportsOnApplicationStart(). Apps which adjust the
-     *     ReportSenders should set this to false and call
-     *     checkReportsOnApplicationStart() themselves to prevent a potential
-     *     race with the SendWorker and list of ReportSenders.
+     * @param checkReportsOnApplicationStart    Whether to invoke ErrorReporter.checkReportsOnApplicationStart().
      * @throws IllegalStateException if it is called more than once.
      */
-    public static void init(Application app, ACRAConfiguration config, boolean checkReportsOnApplicationStart){
+    public static void init(@NonNull Application app, @NonNull ACRAConfiguration config, boolean checkReportsOnApplicationStart){
+
+        final boolean senderServiceProcess = isACRASenderServiceProcess();
+        if (senderServiceProcess) {
+            if (ACRA.DEV_LOGGING) log.d(LOG_TAG, "Not initialising ACRA to listen for uncaught Exceptions as this is the SendWorker process and we only send reports, we don't capture them to avoid infinite loops");
+        }
 
-        boolean supportedAndroidVersion = (Build.VERSION.SDK_INT >= Build.VERSION_CODES.FROYO);
+        final boolean supportedAndroidVersion = Build.VERSION.SDK_INT >= Build.VERSION_CODES.FROYO;
         if (!supportedAndroidVersion){
+            // NB We keep initialising so that everything is configured. But ACRA is never enabled below.
             log.w(LOG_TAG, "ACRA 4.7.0+ requires Froyo or greater. ACRA is disabled and will NOT catch crashes or send messages.");
         }
 
@@ -164,35 +230,47 @@ public static void init(Application app, ACRAConfiguration config, boolean check
             return;
         }
         mApplication = app;
-        
+
+        //noinspection ConstantConditions
         if (config == null) {
             log.e(LOG_TAG, "ACRA#init called but no ACRAConfiguration provided");
             return;
         }
         configProxy = config;
 
-        final SharedPreferences prefs = getACRASharedPreferences();
+        final SharedPreferences prefs = new SharedPreferencesFactory(mApplication, configProxy).create();
 
-        try {
-            checkCrashResources(config);
+        // Check prefs to see if we have converted from legacy (pre 4.8.0) ACRA
+        if (!prefs.getBoolean(PREF__LEGACY_ALREADY_CONVERTED_TO_4_8_0, false)) {
+            // If not then move reports to approved/unapproved folders and mark as converted.
+            new ReportMigrator(app).migrate();
 
-            // Initialize ErrorReporter with all required data
-            final boolean enableAcra = supportedAndroidVersion && !shouldDisableACRA(prefs);
-            log.d(LOG_TAG, "ACRA is " + (enableAcra ? "enabled" : "disabled") + " for " + mApplication.getPackageName() + ", initializing...");
-            final ErrorReporter errorReporter = new ErrorReporter(mApplication, prefs, enableAcra, supportedAndroidVersion);
-
-            // Append ReportSenders.
-            errorReporter.setDefaultReportSenders();
-
-            errorReporterSingleton = errorReporter;
+            // Mark as converted.
+            final SharedPreferences.Editor editor = prefs.edit().putBoolean(PREF__LEGACY_ALREADY_CONVERTED_TO_4_8_0, true);
+            PrefUtils.save(editor);
+        }
 
-            // Check for pending reports
-            if (checkReportsOnApplicationStart) {
-                errorReporter.checkReportsOnApplicationStart();
+        // Initialize ErrorReporter with all required data
+        final boolean enableAcra = supportedAndroidVersion && !shouldDisableACRA(prefs);
+        if (!senderServiceProcess) {
+            // Indicate that ACRA is or is not listening for crashes.
+            log.i(LOG_TAG, "ACRA is " + (enableAcra ? "enabled" : "disabled") + " for " + mApplication.getPackageName() + ", initializing...");
+        }
+        errorReporterSingleton = new ErrorReporter(mApplication, configProxy, prefs, enableAcra, supportedAndroidVersion, !senderServiceProcess);
+
+        // Check for approved reports and send them (if enabled).
+        // NB don't check if senderServiceProcess as it will gather these reports itself.
+        if (checkReportsOnApplicationStart && !senderServiceProcess) {
+            final ApplicationStartupProcessor startupProcessor = new ApplicationStartupProcessor(mApplication,  config);
+            if (config.deleteOldUnsentReportsOnApplicationStart()) {
+                startupProcessor.deleteUnsentReportsFromOldAppVersion();
+            }
+            if (config.deleteUnapprovedReportsOnApplicationStart()) {
+                startupProcessor.deleteAllUnapprovedReportsBarOne();
+            }
+            if (enableAcra) {
+                startupProcessor.sendApprovedReports();
             }
-
-        } catch (ACRAConfigurationException e) {
-            log.w(LOG_TAG, "Error : ", e);
         }
 
         // We HAVE to keep a reference otherwise the listener could be garbage
@@ -201,7 +279,7 @@ public static void init(Application app, ACRAConfiguration config, boolean check
         mPrefListener = new OnSharedPreferenceChangeListener() {
 
             @Override
-            public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {
+            public void onSharedPreferenceChanged(@NonNull SharedPreferences sharedPreferences, String key) {
                 if (PREF_DISABLE_ACRA.equals(key) || PREF_ENABLE_ACRA.equals(key)) {
                     final boolean enableAcra = !shouldDisableACRA(sharedPreferences);
                     getErrorReporter().setEnabled(enableAcra);
@@ -215,12 +293,39 @@ public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, Strin
         prefs.registerOnSharedPreferenceChangeListener(mPrefListener);
     }
 
+    /**
+     * @return true is ACRA has been initialised.
+     */
+    @SuppressWarnings("unused")
+    public static boolean isInitialised() {
+        return configProxy != null;
+    }
+
+    /**
+     * @return true if the current process is the process running the SenderService.
+     *          NB this assumes that your SenderService is configured to used the default ':acra' process.
+     */
+    public static boolean isACRASenderServiceProcess() {
+        final String processName = getCurrentProcessName();
+        if (ACRA.DEV_LOGGING) log.d(LOG_TAG, "ACRA processName='" + processName + '\'');
+        //processName sometimes (or always?) starts with the package name, so we use endsWith instead of equals
+        return processName != null && processName.endsWith(ACRA_PRIVATE_PROCESS_NAME);
+    }
+
+    @Nullable
+    private static String getCurrentProcessName() {
+        try {
+            return IOUtils.streamToString(new FileInputStream("/proc/self/cmdline")).trim();
+        } catch (IOException e) {
+            return null;
+        }
+    }
+
     /**
      * @return the current instance of ErrorReporter.
-     * @throws IllegalStateException
-     *             if {@link ACRA#init(android.app.Application)} has not yet
-     *             been called.
+     * @throws IllegalStateException if {@link ACRA#init(android.app.Application)} has not yet been called.
      */
+    @NonNull
     public static ErrorReporter getErrorReporter() {
         if (errorReporterSingleton == null) {
             throw new IllegalStateException("Cannot access ErrorReporter before ACRA#init");
@@ -228,19 +333,19 @@ public static ErrorReporter getErrorReporter() {
         return errorReporterSingleton;
     }
 
-    
+
 
     /**
      * Check if the application default shared preferences contains true for the
      * key "acra.disable", do not activate ACRA. Also checks the alternative
      * opposite setting "acra.enable" if "acra.disable" is not found.
-     * 
+     *
      * @param prefs
      *            SharedPreferences to check to see whether ACRA should be
      *            disabled.
      * @return true if prefs indicate that ACRA should be disabled.
      */
-    private static boolean shouldDisableACRA(SharedPreferences prefs) {
+    private static boolean shouldDisableACRA(@NonNull SharedPreferences prefs) {
         boolean disableAcra = false;
         try {
             final boolean enableAcra = prefs.getBoolean(PREF_ENABLE_ACRA, true);
@@ -252,108 +357,34 @@ private static boolean shouldDisableACRA(SharedPreferences prefs) {
     }
 
     /**
-     * Checks that mandatory configuration items have been provided.
-     * 
-     * @throws ACRAConfigurationException
-     *             if required values are missing.
-     */
-    static void checkCrashResources(ReportsCrashes conf) throws ACRAConfigurationException {
-        switch (conf.mode()) {
-        case TOAST:
-            if (conf.resToastText() == 0) {
-                throw new ACRAConfigurationException(
-                        "TOAST mode: you have to define the resToastText parameter in your application @ReportsCrashes() annotation.");
-            }
-            break;
-        case NOTIFICATION:
-            if (conf.resNotifTickerText() == 0 || conf.resNotifTitle() == 0 || conf.resNotifText() == 0) {
-                throw new ACRAConfigurationException(
-                        "NOTIFICATION mode: you have to define at least the resNotifTickerText, resNotifTitle, resNotifText parameters in your application @ReportsCrashes() annotation.");
-            }
-            if (CrashReportDialog.class.equals(conf.reportDialogClass()) && conf.resDialogText() == 0) {
-                throw new ACRAConfigurationException(
-                        "NOTIFICATION mode: using the (default) CrashReportDialog requires you have to define the resDialogText parameter in your application @ReportsCrashes() annotation.");
-            }
-            break;
-        case DIALOG:
-            if (CrashReportDialog.class.equals(conf.reportDialogClass()) && conf.resDialogText() == 0) {
-                throw new ACRAConfigurationException(
-                        "DIALOG mode: using the (default) CrashReportDialog requires you to define the resDialogText parameter in your application @ReportsCrashes() annotation.");
-            }
-            break;
-		default:
-			break;
-        }
-    }
-
-    /**
-     * Retrieves the {@link SharedPreferences} instance where user adjustable
-     * settings for ACRA are stored. Default are the Application default
-     * SharedPreferences, but you can provide another SharedPreferences name
-     * with {@link ReportsCrashes#sharedPreferencesName()}.
-     * 
-     * @return The Shared Preferences where ACRA will retrieve its user
-     *         adjustable setting.
+     * @return The Shared Preferences where ACRA will retrieve its user adjustable setting.
+     * @deprecated since 4.8.0 use {@link SharedPreferencesFactory} instead.
      */
+    @SuppressWarnings( "unused" )
+    @NonNull
     public static SharedPreferences getACRASharedPreferences() {
-        ReportsCrashes conf = getConfig();
-        if (!"".equals(conf.sharedPreferencesName())) {
-            return mApplication.getSharedPreferences(conf.sharedPreferencesName(), conf.sharedPreferencesMode());
-        } else {
-            return PreferenceManager.getDefaultSharedPreferences(mApplication);
+        if (configProxy == null) {
+            throw new IllegalStateException("Cannot call ACRA.getACRASharedPreferences() before ACRA.init().");
         }
+        return new SharedPreferencesFactory(mApplication, configProxy).create();
     }
 
     /**
      * Provides the current ACRA configuration.
-     * 
+     *
      * @return Current ACRA {@link ReportsCrashes} configuration instance.
+     * @deprecated since 4.8.0 {@link ACRAConfiguration} should be passed into classes instead of retrieved statically.
      */
+    @NonNull
     public static ACRAConfiguration getConfig() {
         if (configProxy == null) {
-            if (mApplication == null) {
-                log.w(LOG_TAG,
-                        "Calling ACRA.getConfig() before ACRA.init() gives you an empty configuration instance. You might prefer calling ACRA.getNewDefaultConfig(Application) to get an instance with default values taken from a @ReportsCrashes annotation.");
-            }
-            configProxy = getNewDefaultConfig(mApplication);
+            throw new IllegalStateException("Cannot call ACRA.getConfig() before ACRA.init().");
         }
         return configProxy;
     }
 
-    /**
-     * @param app       Your Application class.
-     * @return new {@link ACRAConfiguration} instance with values initialized
-     *         from the {@link ReportsCrashes} annotation.
-     */
-    public static ACRAConfiguration getNewDefaultConfig(Application app) {
-        if(app != null) {
-            return new ACRAConfiguration(app.getClass().getAnnotation(ReportsCrashes.class));
-        } else {
-            return new ACRAConfiguration(null);
-        }
-    }
-
-    private static ACRAConfiguration configProxy;
-
-    /**
-     * Returns true if the application is debuggable.
-     * 
-     * @return true if the application is debuggable.
-     */
-    static boolean isDebuggable() {
-        PackageManager pm = mApplication.getPackageManager();
-        try {
-            return ((pm.getApplicationInfo(mApplication.getPackageName(), 0).flags & ApplicationInfo.FLAG_DEBUGGABLE) > 0);
-        } catch (NameNotFoundException e) {
-            return false;
-        }
-    }
-    
-    static Application getApplication() {
-        return mApplication;
-    }
-
-    public static void setLog(ACRALog log) {
+    public static void setLog(@NonNull ACRALog log) {
+        //noinspection ConstantConditions (do not rely on annotation alone)
         if (log == null) {
             throw new NullPointerException("ACRALog cannot be null");
         }
diff --git a/src/main/java/org/acra/ACRAConfiguration.java b/src/main/java/org/acra/ACRAConfiguration.java
deleted file mode 100644
index d29cb774..00000000
--- a/src/main/java/org/acra/ACRAConfiguration.java
+++ /dev/null
@@ -1,1251 +0,0 @@
-/*
- *  Copyright 2011 Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra;
-
-import org.acra.annotation.ReportsCrashes;
-import org.acra.sender.HttpSender;
-import org.acra.sender.HttpSender.Method;
-import org.acra.sender.HttpSender.Type;
-
-import java.lang.annotation.Annotation;
-import java.security.KeyStore;
-import java.util.Arrays;
-import java.util.List;
-import java.util.Map;
-
-import static org.acra.ACRA.LOG_TAG;
-import static org.acra.ACRAConstants.*;
-
-/**
- * This class is to be used if you need to apply dynamic settings. This is
- * needed for example when using ACRA in an Android Library Project since ADT
- * v14 where resource ids are not final anymore and can't be passed as
- * annotation parameters values.
- */
-public class ACRAConfiguration implements ReportsCrashes {
-
-    private String[] mAdditionalDropboxTags = null;
-
-    private String[] mAdditionalSharedPreferences = null;
-    private Integer mConnectionTimeout = null;
-    private ReportField[] mCustomReportContent = null;
-    private Boolean mDeleteUnapprovedReportsOnApplicationStart = null;
-    private Boolean mDeleteOldUnsentReportsOnApplicationStart = null;
-    private Integer mDropboxCollectionMinutes = null;
-    private Boolean mForceCloseDialogAfterToast = null;
-    private String mFormUri = null;
-    private String mFormUriBasicAuthLogin = null;
-    private String mFormUriBasicAuthPassword = null;
-    private Boolean mIncludeDropboxSystemTags = null;
-
-    private String[] mLogcatArguments = null;
-    private String mMailTo = null;
-    private ReportingInteractionMode mMode = null;
-    private ReportsCrashes mReportsCrashes = null;
-    private Class<? extends BaseCrashReportDialog> mReportDialogClass = null;
-
-    private Integer mResDialogPositiveButtonText = null;
-    private Integer mResDialogNegativeButtonText = null;
-    private Integer mResDialogCommentPrompt = null;
-    private Integer mResDialogEmailPrompt = null;
-    private Integer mResDialogIcon = null;
-    private Integer mResDialogOkToast = null;
-    private Integer mResDialogText = null;
-    private Integer mResDialogTitle = null;
-    private Integer mResNotifIcon = null;
-    private Integer mResNotifText = null;
-    private Integer mResNotifTickerText = null;
-    private Integer mResNotifTitle = null;
-    private Integer mResToastText = null;
-    private Integer mSharedPreferenceMode = null;
-    private String mSharedPreferenceName = null;
-    private Integer mSocketTimeout = null;
-    private Boolean mLogcatFilterByPid = null;
-    private Boolean mSendReportsInDevMode = null;
-    private Boolean mSendReportsAtShutdown = null;
-
-    private String[] mExcludeMatchingSharedPreferencesKeys = null;
-    private String[] mExcludeMatchingSettingsKeys = null;
-    private Class mBuildConfigClass;
-    private String mApplicationLogFile = null;
-    private Integer mApplicationLogFileLines = null;
-
-    private Method mHttpMethod = null;
-    private Type mReportType = null;
-    private Map<String, String> mHttpHeaders;
-    private KeyStore mKeyStore;
-
-    /**
-     * Set custom HTTP headers to be sent by the provided {@link HttpSender}.
-     * This should be used also by third party senders.
-     * 
-     * @param headers
-     *            A map associating HTTP header names to their values.
-     * @return The updated ACRA configuration
-     */
-    public ACRAConfiguration setHttpHeaders(Map<String, String> headers) {
-        this.mHttpHeaders = headers;
-        return this;
-    }
-
-    /**
-     * Retrieve HTTP headers defined by the application developer. These should
-     * be added to requests sent by any third-party sender (over HTTP of
-     * course).
-     * 
-     * @return A map associating http header names to their values.
-     */
-    public Map<String, String> getHttpHeaders() {
-        return mHttpHeaders;
-    }
-
-    /**
-     * @return List of ReportField that ACRA will provide to the server.
-     */
-    public List<ReportField> getReportFields() {
-        final ReportField[] customReportFields = customReportContent();
-
-        final ReportField[] fieldsList;
-        if (customReportFields.length != 0) {
-            ACRA.log.d(LOG_TAG, "Using custom Report Fields");
-            fieldsList = customReportFields;
-        } else if (mailTo() == null || "".equals(mailTo())) {
-            ACRA.log.d(LOG_TAG, "Using default Report Fields");
-            fieldsList = ACRAConstants.DEFAULT_REPORT_FIELDS;
-        } else {
-            ACRA.log.d(LOG_TAG, "Using default Mail Report Fields");
-            fieldsList = ACRAConstants.DEFAULT_MAIL_REPORT_FIELDS;
-        }
-        return Arrays.asList(fieldsList);
-    }
-
-    /**
-     * @param additionalDropboxTags
-     *            the additionalDropboxTags to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setAdditionalDropboxTags(String[] additionalDropboxTags) {
-        this.mAdditionalDropboxTags = additionalDropboxTags;
-        return this;
-    }
-
-    /**
-     * @param additionalSharedPreferences
-     *            the additionalSharedPreferences to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setAdditionalSharedPreferences(String[] additionalSharedPreferences) {
-        this.mAdditionalSharedPreferences = additionalSharedPreferences;
-        return this;
-    }
-
-    /**
-     * @param connectionTimeout
-     *            the connectionTimeout to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setConnectionTimeout(Integer connectionTimeout) {
-        this.mConnectionTimeout = connectionTimeout;
-        return this;
-    }
-
-    /**
-     * @param customReportContent
-     *            the customReportContent to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setCustomReportContent(ReportField[] customReportContent) {
-        this.mCustomReportContent = customReportContent;
-        return this;
-    }
-
-    /**
-     * @param deleteUnapprovedReportsOnApplicationStart
-     *            the deleteUnapprovedReportsOnApplicationStart to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setDeleteUnapprovedReportsOnApplicationStart(Boolean deleteUnapprovedReportsOnApplicationStart) {
-        this.mDeleteUnapprovedReportsOnApplicationStart = deleteUnapprovedReportsOnApplicationStart;
-        return this;
-    }
-
-    /**
-     * @param deleteOldUnsentReportsOnApplicationStart    When to delete old (unsent) reports on startup.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setDeleteOldUnsentReportsOnApplicationStart(Boolean deleteOldUnsentReportsOnApplicationStart) {
-        this.mDeleteOldUnsentReportsOnApplicationStart = deleteOldUnsentReportsOnApplicationStart;
-        return this;
-    }
-
-    /**
-     * @param dropboxCollectionMinutes
-     *            the dropboxCollectionMinutes to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setDropboxCollectionMinutes(Integer dropboxCollectionMinutes) {
-        this.mDropboxCollectionMinutes = dropboxCollectionMinutes;
-        return this;
-    }
-
-    /**
-     * @param forceCloseDialogAfterToast
-     *            the forceCloseDialogAfterToast to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setForceCloseDialogAfterToast(Boolean forceCloseDialogAfterToast) {
-        this.mForceCloseDialogAfterToast = forceCloseDialogAfterToast;
-        return this;
-    }
-
-    /**
-     * Modify the formUri of your backend server receiving reports. You need to
-     * call {@link ErrorReporter#setDefaultReportSenders()} after modifying this
-     * value if you were not using a formUri before (a mailTo or formKey
-     * instead).
-     * 
-     * @param formUri
-     *            the formUri to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setFormUri(String formUri) {
-        this.mFormUri = formUri;
-        return this;
-    }
-
-    /**
-     * @param formUriBasicAuthLogin
-     *            the formUriBasicAuthLogin to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setFormUriBasicAuthLogin(String formUriBasicAuthLogin) {
-        this.mFormUriBasicAuthLogin = formUriBasicAuthLogin;
-        return this;
-    }
-
-    /**
-     * @param formUriBasicAuthPassword
-     *            the formUriBasicAuthPassword to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setFormUriBasicAuthPassword(String formUriBasicAuthPassword) {
-        this.mFormUriBasicAuthPassword = formUriBasicAuthPassword;
-        return this;
-    }
-
-    /**
-     * @param includeDropboxSystemTags
-     *            the includeDropboxSystemTags to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setIncludeDropboxSystemTags(Boolean includeDropboxSystemTags) {
-        this.mIncludeDropboxSystemTags = includeDropboxSystemTags;
-        return this;
-    }
-
-    /**
-     * @param logcatArguments
-     *            the logcatArguments to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setLogcatArguments(String[] logcatArguments) {
-        this.mLogcatArguments = logcatArguments;
-        return this;
-    }
-
-    /**
-     * Modify the mailTo of the mail account receiving reports. You need to call
-     * {@link ErrorReporter#setDefaultReportSenders()} after modifying this
-     * value if you were not using a formKey before (a formKey or formUri
-     * instead).
-     * 
-     * @param mailTo
-     *            the mailTo to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setMailTo(String mailTo) {
-        this.mMailTo = mailTo;
-        return this;
-    }
-
-    /**
-     * Change the current {@link ReportingInteractionMode}. You must set
-     * required configuration items first.
-     * 
-     * @param mode
-     *            the new mode to set.
-     * @return The updated ACRA configuration
-     * @throws ACRAConfigurationException
-     *             if a configuration item is missing for this mode.
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setMode(ReportingInteractionMode mode) throws ACRAConfigurationException {
-        this.mMode = mode;
-        ACRA.checkCrashResources(this);
-        return this;
-    }
-
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogPositiveButtonText(int resId) {
-        mResDialogPositiveButtonText = resId;
-        return this;
-    }
-
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogNegativeButtonText(int resId) {
-        mResDialogNegativeButtonText = resId;
-        return this;
-    }
-
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setReportDialogClass(Class<? extends BaseCrashReportDialog> reportDialogClass) {
-        mReportDialogClass = reportDialogClass;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resDialogCommentPrompt()} comes from an Android
-     * Library Project.
-     * 
-     * @param resId
-     *            The resource id, see
-     *            {@link ReportsCrashes#resDialogCommentPrompt()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogCommentPrompt(int resId) {
-        mResDialogCommentPrompt = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resDialogEmailPrompt()} comes from an Android
-     * Library Project.
-     * 
-     * @param resId
-     *            The resource id, see
-     *            {@link ReportsCrashes#resDialogEmailPrompt()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogEmailPrompt(int resId) {
-        mResDialogEmailPrompt = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resDialogIcon()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resDialogIcon()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogIcon(int resId) {
-        mResDialogIcon = resId;
-        return this;
-    }
-
-    /**
-     * Use this method BEFORE if the id you wanted to give to
-     * {@link ReportsCrashes#resDialogOkToast()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resDialogOkToast()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogOkToast(int resId) {
-        mResDialogOkToast = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resDialogText()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resDialogText()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogText(int resId) {
-        mResDialogText = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resDialogTitle()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resDialogTitle()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResDialogTitle(int resId) {
-        mResDialogTitle = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resNotifIcon()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resNotifIcon()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResNotifIcon(int resId) {
-        mResNotifIcon = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resNotifText()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resNotifText()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResNotifText(int resId) {
-        mResNotifText = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resNotifTickerText()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see
-     *            {@link ReportsCrashes#resNotifTickerText()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResNotifTickerText(int resId) {
-        mResNotifTickerText = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resNotifTitle()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resNotifTitle()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResNotifTitle(int resId) {
-        mResNotifTitle = resId;
-        return this;
-    }
-
-    /**
-     * Use this method if the id you wanted to give to
-     * {@link ReportsCrashes#resToastText()} comes from an Android Library
-     * Project.
-     * 
-     * @param resId
-     *            The resource id, see {@link ReportsCrashes#resToastText()}
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setResToastText(int resId) {
-        mResToastText = resId;
-        return this;
-    }
-
-    /**
-     * @param sharedPreferenceMode
-     *            the sharedPreferenceMode to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setSharedPreferenceMode(Integer sharedPreferenceMode) {
-        this.mSharedPreferenceMode = sharedPreferenceMode;
-        return this;
-    }
-
-    /**
-     * @param sharedPreferenceName
-     *            the sharedPreferenceName to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setSharedPreferenceName(String sharedPreferenceName) {
-        this.mSharedPreferenceName = sharedPreferenceName;
-        return this;
-    }
-
-    /**
-     * @param socketTimeout
-     *            the socketTimeout to set
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setSocketTimeout(Integer socketTimeout) {
-        this.mSocketTimeout = socketTimeout;
-        return this;
-    }
-
-    /**
-     * 
-     * @param filterByPid
-     *            true if you want to collect only logcat lines related to your
-     *            application process.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setLogcatFilterByPid(Boolean filterByPid) {
-        mLogcatFilterByPid = filterByPid;
-        return this;
-    }
-
-    /**
-     * 
-     * @param sendReportsInDevMode
-     *            false if you want to disable sending reports in development
-     *            mode. Reports will be sent only on signed applications.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setSendReportsInDevMode(Boolean sendReportsInDevMode) {
-        mSendReportsInDevMode = sendReportsInDevMode;
-        return this;
-    }
-
-    /**
-     * 
-     * @param sendReportsAtShutdown
-     *            false if you want to disable sending reports at the time the
-     *            exception is caught. Reports will be sent when the application
-     *            is restarted.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setSendReportsAtShutdown(Boolean sendReportsAtShutdown) {
-        mSendReportsAtShutdown = sendReportsAtShutdown;
-        return this;
-    }
-
-    /**
-     * 
-     * @param excludeMatchingSharedPreferencesKeys
-     *            an array of Strings containing regexp defining
-     *            SharedPreferences keys that should be excluded from the data
-     *            collection.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setExcludeMatchingSharedPreferencesKeys(String[] excludeMatchingSharedPreferencesKeys) {
-        mExcludeMatchingSharedPreferencesKeys = excludeMatchingSharedPreferencesKeys;
-        return this;
-    }
-
-    /**
-     * 
-     * @param excludeMatchingSettingsKeys
-     *            an array of Strings containing regexp defining
-     *            Settings.System, Settings.Secure and Settings.Global keys that
-     *            should be excluded from the data collection.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setExcludeMatchingSettingsKeys(String[] excludeMatchingSettingsKeys) {
-        mExcludeMatchingSettingsKeys = excludeMatchingSettingsKeys;
-        return this;
-    }
-
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setBuildConfigClass(Class buildConfigClass) {
-        mBuildConfigClass = buildConfigClass;
-        return this;
-    }
-    /**
-     * 
-     * @param applicationLogFile
-     *            The path and file name of your application log file, to be
-     *            used with {@link ReportField#APPLICATION_LOG}.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setApplicationLogFile(String applicationLogFile) {
-        mApplicationLogFile = applicationLogFile;
-        return this;
-    }
-
-    /**
-     * 
-     * @param applicationLogFileLines
-     *            The number of lines of your application log to be collected,
-     *            to be used with {@link ReportField#APPLICATION_LOG} and
-     *            {@link ReportsCrashes#applicationLogFile()}.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setApplicationLogFileLines(int applicationLogFileLines) {
-        mApplicationLogFileLines = applicationLogFileLines;
-        return this;
-    }
-
-    /**
-     * 
-     * @param httpMethod
-     *            The method to be used to send data to the server.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setHttpMethod(Method httpMethod) {
-        mHttpMethod = httpMethod;
-        return this;
-    }
-
-    /**
-     * 
-     * @param type
-     *            The type of content encoding to be used to send data to the
-     *            server.
-     * @return The updated ACRA configuration
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration setReportType(Type type) {
-        mReportType = type;
-        return this;
-    }
-
-    /**
-     * 
-     * @param keyStore
-     *            Set this to the keystore that contains the trusted certificates
-     */
-    @SuppressWarnings( "unused" )
-    public void setKeyStore(KeyStore keyStore) {
-        mKeyStore = keyStore;
-    }
-
-    /**
-     * @param defaults  Defaults with which to initialise this {@link ACRAConfiguration}.
-     */
-    public ACRAConfiguration(ReportsCrashes defaults) {
-        mReportsCrashes = defaults;
-    }
-
-    /**
-     * Empty constructor which sets no defaults.
-     */
-    @SuppressWarnings( "unused" )
-    public ACRAConfiguration(){
-        this(null);
-    }
-
-    @Override
-    public String[] additionalDropBoxTags() {
-        if (mAdditionalDropboxTags != null) {
-            return mAdditionalDropboxTags;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.additionalDropBoxTags();
-        }
-
-        return new String[0];
-    }
-
-    @Override
-    public String[] additionalSharedPreferences() {
-        if (mAdditionalSharedPreferences != null) {
-            return mAdditionalSharedPreferences;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.additionalSharedPreferences();
-        }
-
-        return new String[0];
-    }
-
-    @Override
-    public Class<? extends Annotation> annotationType() {
-        return mReportsCrashes.annotationType();
-    }
-
-    @Override
-    public int connectionTimeout() {
-        if (mConnectionTimeout != null) {
-            return mConnectionTimeout;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.connectionTimeout();
-        }
-
-        return DEFAULT_CONNECTION_TIMEOUT;
-    }
-
-    @Override
-    public ReportField[] customReportContent() {
-        if (mCustomReportContent != null) {
-            return mCustomReportContent;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.customReportContent();
-        }
-
-        return new ReportField[0];
-    }
-
-    @Override
-    public boolean deleteUnapprovedReportsOnApplicationStart() {
-        if (mDeleteUnapprovedReportsOnApplicationStart != null) {
-            return mDeleteUnapprovedReportsOnApplicationStart;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.deleteUnapprovedReportsOnApplicationStart();
-        }
-
-        return DEFAULT_DELETE_UNAPPROVED_REPORTS_ON_APPLICATION_START;
-    }
-
-    @Override
-    public boolean deleteOldUnsentReportsOnApplicationStart() {
-        if (mDeleteOldUnsentReportsOnApplicationStart != null) {
-            return mDeleteOldUnsentReportsOnApplicationStart;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.deleteOldUnsentReportsOnApplicationStart();
-        }
-
-        return DEFAULT_DELETE_OLD_UNSENT_REPORTS_ON_APPLICATION_START;
-    }
-
-    @Override
-    public int dropboxCollectionMinutes() {
-        if (mDropboxCollectionMinutes != null) {
-            return mDropboxCollectionMinutes;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.dropboxCollectionMinutes();
-        }
-
-        return DEFAULT_DROPBOX_COLLECTION_MINUTES;
-    }
-
-    @Override
-    public boolean forceCloseDialogAfterToast() {
-        if (mForceCloseDialogAfterToast != null) {
-            return mForceCloseDialogAfterToast;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.forceCloseDialogAfterToast();
-        }
-
-        return DEFAULT_FORCE_CLOSE_DIALOG_AFTER_TOAST;
-    }
-
-    @Override
-    public String formUri() {
-        if (mFormUri != null) {
-            return mFormUri;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.formUri();
-        }
-
-        return DEFAULT_STRING_VALUE;
-    }
-
-    @Override
-    public String formUriBasicAuthLogin() {
-        if (mFormUriBasicAuthLogin != null) {
-            return mFormUriBasicAuthLogin;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.formUriBasicAuthLogin();
-        }
-
-        return NULL_VALUE;
-    }
-
-    @Override
-    public String formUriBasicAuthPassword() {
-        if (mFormUriBasicAuthPassword != null) {
-            return mFormUriBasicAuthPassword;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.formUriBasicAuthPassword();
-        }
-
-        return NULL_VALUE;
-    }
-
-    @Override
-    public boolean includeDropBoxSystemTags() {
-        if (mIncludeDropboxSystemTags != null) {
-            return mIncludeDropboxSystemTags;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.includeDropBoxSystemTags();
-        }
-
-        return DEFAULT_INCLUDE_DROPBOX_SYSTEM_TAGS;
-    }
-
-    @Override
-    public String[] logcatArguments() {
-        if (mLogcatArguments != null) {
-            return mLogcatArguments;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.logcatArguments();
-        }
-
-        return new String[] { "-t", Integer.toString(DEFAULT_LOGCAT_LINES), "-v", "time" };
-    }
-
-    @Override
-    public String mailTo() {
-        if (mMailTo != null) {
-            return mMailTo;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.mailTo();
-        }
-
-        return DEFAULT_STRING_VALUE;
-    }
-
-    @Override
-    public ReportingInteractionMode mode() {
-        if (mMode != null) {
-            return mMode;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.mode();
-        }
-
-        return ReportingInteractionMode.SILENT;
-    }
-
-    @Override
-    public int resDialogPositiveButtonText() {
-        if (mResDialogPositiveButtonText != null) {
-            return mResDialogPositiveButtonText;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogPositiveButtonText();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resDialogNegativeButtonText() {
-        if (mResDialogNegativeButtonText != null) {
-            return mResDialogNegativeButtonText;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogNegativeButtonText();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resDialogCommentPrompt() {
-        if (mResDialogCommentPrompt != null) {
-            return mResDialogCommentPrompt;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogCommentPrompt();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resDialogEmailPrompt() {
-        if (mResDialogEmailPrompt != null) {
-            return mResDialogEmailPrompt;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogEmailPrompt();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resDialogIcon() {
-        if (mResDialogIcon != null) {
-            return mResDialogIcon;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogIcon();
-        }
-
-        return DEFAULT_DIALOG_ICON;
-    }
-
-    @Override
-    public int resDialogOkToast() {
-        if (mResDialogOkToast != null) {
-            return mResDialogOkToast;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogOkToast();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resDialogText() {
-        if (mResDialogText != null) {
-            return mResDialogText;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogText();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resDialogTitle() {
-        if (mResDialogTitle != null) {
-            return mResDialogTitle;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resDialogTitle();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resNotifIcon() {
-        if (mResNotifIcon != null) {
-            return mResNotifIcon;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resNotifIcon();
-        }
-
-        return DEFAULT_NOTIFICATION_ICON;
-    }
-
-    @Override
-    public int resNotifText() {
-        if (mResNotifText != null) {
-            return mResNotifText;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resNotifText();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resNotifTickerText() {
-        if (mResNotifTickerText != null) {
-            return mResNotifTickerText;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resNotifTickerText();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resNotifTitle() {
-        if (mResNotifTitle != null) {
-            return mResNotifTitle;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resNotifTitle();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int resToastText() {
-        if (mResToastText != null) {
-            return mResToastText;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.resToastText();
-        }
-
-        return DEFAULT_RES_VALUE;
-    }
-
-    @Override
-    public int sharedPreferencesMode() {
-        if (mSharedPreferenceMode != null) {
-            return mSharedPreferenceMode;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.sharedPreferencesMode();
-        }
-
-        return DEFAULT_SHARED_PREFERENCES_MODE;
-    }
-
-    @Override
-    public String sharedPreferencesName() {
-        if (mSharedPreferenceName != null) {
-            return mSharedPreferenceName;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.sharedPreferencesName();
-        }
-
-        return DEFAULT_STRING_VALUE;
-    }
-
-    @Override
-    public int socketTimeout() {
-        if (mSocketTimeout != null) {
-            return mSocketTimeout;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.socketTimeout();
-        }
-
-        return DEFAULT_SOCKET_TIMEOUT;
-    }
-
-    @Override
-    public boolean logcatFilterByPid() {
-        if (mLogcatFilterByPid != null) {
-            return mLogcatFilterByPid;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.logcatFilterByPid();
-        }
-
-        return DEFAULT_LOGCAT_FILTER_BY_PID;
-    }
-
-    @Override
-    public boolean sendReportsInDevMode() {
-        if (mSendReportsInDevMode != null) {
-            return mSendReportsInDevMode;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.sendReportsInDevMode();
-        }
-
-        return DEFAULT_SEND_REPORTS_IN_DEV_MODE;
-    }
-
-    @Override
-    public boolean sendReportsAtShutdown() {
-        if (mSendReportsAtShutdown != null) {
-            return mSendReportsAtShutdown;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.sendReportsAtShutdown();
-        }
-
-        return DEFAULT_SEND_REPORTS_AT_SHUTDOWN;
-    }
-
-    @Override
-    public String[] excludeMatchingSharedPreferencesKeys() {
-        if (mExcludeMatchingSharedPreferencesKeys != null) {
-            return mExcludeMatchingSharedPreferencesKeys;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.excludeMatchingSharedPreferencesKeys();
-        }
-
-        return new String[0];
-    }
-
-    @Override
-    public String[] excludeMatchingSettingsKeys() {
-        if (mExcludeMatchingSettingsKeys != null) {
-            return mExcludeMatchingSettingsKeys;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.excludeMatchingSettingsKeys();
-        }
-
-        return new String[0];
-    }
-
-    @Override
-    /**
-     * Will return null if no value has been configured.
-     * It is up to clients to construct the recommended default value oof context.getClass().getPackage().getName() + BuildConfig.class
-     */
-    public Class buildConfigClass() {
-        if (mBuildConfigClass != null) {
-            return mBuildConfigClass;
-        }
-
-        if ((mReportsCrashes != null) && (mReportsCrashes.buildConfigClass() != null)) {
-            return mReportsCrashes.buildConfigClass();
-        }
-
-        return null;
-    }
-
-    @Override
-    public String applicationLogFile() {
-        if (mApplicationLogFile != null) {
-            return mApplicationLogFile;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.applicationLogFile();
-        }
-
-        return DEFAULT_APPLICATION_LOGFILE;
-    }
-
-    @Override
-    public int applicationLogFileLines() {
-        if (mApplicationLogFileLines != null) {
-            return mApplicationLogFileLines;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.applicationLogFileLines();
-        }
-
-        return DEFAULT_APPLICATION_LOGFILE_LINES;
-    }
-
-    @Override
-    public Class<? extends BaseCrashReportDialog> reportDialogClass() {
-        if (mReportDialogClass != null) {
-            return mReportDialogClass;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.reportDialogClass();
-        }
-
-        return CrashReportDialog.class;
-    }
-
-    @Override
-    public Method httpMethod() {
-        if (mHttpMethod != null) {
-            return mHttpMethod;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.httpMethod();
-        }
-
-        return Method.POST;
-    }
-
-    @Override
-    public Type reportType() {
-        if (mReportType != null) {
-            return mReportType;
-        }
-
-        if (mReportsCrashes != null) {
-            return mReportsCrashes.reportType();
-        }
-
-        return Type.FORM;
-    }
-
-    public KeyStore keyStore() {
-        if (mKeyStore != null) {
-            return mKeyStore;
-        }
-
-        return null;
-    }
-
-    public static boolean isNull(String aString) {
-        return aString == null || ACRAConstants.NULL_VALUE.equals(aString);
-    }
-
-}
diff --git a/src/main/java/org/acra/ACRAConstants.java b/src/main/java/org/acra/ACRAConstants.java
index a426a0fe..73bcd8cb 100644
--- a/src/main/java/org/acra/ACRAConstants.java
+++ b/src/main/java/org/acra/ACRAConstants.java
@@ -16,6 +16,10 @@
 package org.acra;
 
 import android.content.Context;
+import android.support.annotation.DrawableRes;
+import android.support.annotation.StringRes;
+
+import org.acra.dialog.CrashReportDialog;
 
 import static org.acra.ReportField.*;
 
@@ -26,6 +30,7 @@
  * @since 4.3.0
  */
 public final class ACRAConstants {
+    private ACRAConstants(){}
 
     public static final String REPORTFILE_EXTENSION = ".stacktrace";
 
@@ -33,25 +38,26 @@
      * Suffix to be added to report files when they have been approved by the
      * user in NOTIFICATION mode
      */
-    static final String APPROVED_SUFFIX = "-approved";
+    public static final String APPROVED_SUFFIX = "-approved";
     /**
      * This key is used to store the silent state of a report sent by
      * handleSilentException().
      */
-    static final String SILENT_SUFFIX = "-" + IS_SILENT;
+    public static final String SILENT_SUFFIX = "-" + IS_SILENT;
     /**
-     * This is the number of previously stored reports that we send in
-     * {@link SendWorker#checkAndSendReports(android.content.Context, boolean)}.
-     * The number of reports is limited to avoid ANR on application start.
+     * This is the maximum number of previously stored reports that we send
+     * in one batch to avoid overloading the network.
      */
-    static final int MAX_SEND_REPORTS = 5;
+    public static final int MAX_SEND_REPORTS = 5;
 
     /**
      * Used in the intent starting CrashReportDialog to provide the name of the
      * latest generated report file in order to be able to associate the user
      * comment.
      */
+    public static final String EXTRA_REPORT_FILE = "REPORT_FILE";
     public static final String EXTRA_REPORT_FILE_NAME = "REPORT_FILE_NAME";
+
     /**
      * Used in the intent starting CrashReportDialog to provide the Exception that caused the crash.
      *
@@ -60,19 +66,24 @@
     public static final String EXTRA_REPORT_EXCEPTION = "REPORT_EXCEPTION";
 
     /**
-     * Set this extra to true to force the deletion of reports by the
-     * {@link CrashReportDialog} activity.
+     * Used in the intent starting CrashReportDialog to provide the AcraConfig to use when gathering the crash info.
+     *
+     * This can be used by any BaseCrashReportDialog subclass to custom the dialog.
+     */
+    public static final String EXTRA_REPORT_CONFIG = "REPORT_CONFIG";
+
+    /**
+     * Set this extra to true to force the deletion of reports by the {@link CrashReportDialog} activity.
      */
-    protected static final String EXTRA_FORCE_CANCEL = "FORCE_CANCEL";
+    public static final String EXTRA_FORCE_CANCEL = "FORCE_CANCEL";
     /**
-     * This is the identifier (value = 666) use for the status bar notification
-     * issued when crashes occur.
+     * This is the identifier (value = 666) use for the status bar notification issued when crashes occur.
      */
-    static final int NOTIF_CRASH_ID = 666;
+    public static final int NOTIF_CRASH_ID = 666;
     /**
      * Number of milliseconds to wait after displaying a toast.
      */
-    static final int TOAST_WAIT_DURATION = 2000;
+    public static final int TOAST_WAIT_DURATION = 2000;
 
     /**
      * A special String value to allow the usage of a pseudo-null default value
@@ -80,11 +91,9 @@
      */
     public static final String NULL_VALUE = "ACRA-NULL-STRING";
 
-    public static final boolean DEFAULT_FORCE_CLOSE_DIALOG_AFTER_TOAST = false;
-
-    public static final int DEFAULT_MAX_NUMBER_OF_REQUEST_RETRIES = 3;
+    public static final boolean DEFAULT_REPORT_TO_ANDROID_FRAMEWORK = false;
 
-    public static final int DEFAULT_SOCKET_TIMEOUT = 8000;
+    public static final int DEFAULT_SOCKET_TIMEOUT = 20000;
 
     public static final int DEFAULT_CONNECTION_TIMEOUT = 5000;
 
@@ -98,12 +107,16 @@
 
     public static final int DEFAULT_SHARED_PREFERENCES_MODE = Context.MODE_PRIVATE;
 
+    @DrawableRes
     public static final int DEFAULT_NOTIFICATION_ICON = android.R.drawable.stat_notify_error;
 
+    @DrawableRes
     public static final int DEFAULT_DIALOG_ICON = android.R.drawable.ic_dialog_alert;
 
+    @StringRes
     public static final int DEFAULT_DIALOG_POSITIVE_BUTTON_TEXT = android.R.string.ok;
 
+    @StringRes
     public static final int DEFAULT_DIALOG_NEGATIVE_BUTTON_TEXT = android.R.string.cancel;
 
     public static final int DEFAULT_RES_VALUE = 0;
@@ -118,16 +131,10 @@
 
     public static final boolean DEFAULT_SEND_REPORTS_IN_DEV_MODE = true;
 
-    public static final boolean DEFAULT_SEND_REPORTS_AT_SHUTDOWN = true;
-
     public static final String DEFAULT_APPLICATION_LOGFILE = DEFAULT_STRING_VALUE;
 
     public static final int DEFAULT_APPLICATION_LOGFILE_LINES = DEFAULT_LOGCAT_LINES;
 
-    public static final boolean DEFAULT_DISABLE_SSL_CERT_VALIDATION = false;
-
-    public static final String DEFAULT_HTTP_SOCKET_FACTORY_FACTORY_CLASS = "org.acra.util.DefaultHttpsSocketFactoryFactory";
-
     /**
      * Default list of {@link ReportField}s to be sent in email reports. You can
      * set your own list with
@@ -135,7 +142,7 @@
      * 
      * @see org.acra.annotation.ReportsCrashes#mailTo()
      */
-    public final static ReportField[] DEFAULT_MAIL_REPORT_FIELDS = { USER_COMMENT, ANDROID_VERSION, APP_VERSION_NAME,
+    public static final ReportField[] DEFAULT_MAIL_REPORT_FIELDS = { USER_COMMENT, ANDROID_VERSION, APP_VERSION_NAME,
             BRAND, PHONE_MODEL, CUSTOM_DATA, STACK_TRACE };
 
     /**
@@ -150,4 +157,6 @@
             INSTALLATION_ID, DEVICE_FEATURES, ENVIRONMENT, SHARED_PREFERENCES };
 
     public static final String DATE_TIME_FORMAT_STRING = "yyyy-MM-dd'T'HH:mm:ss.SSSZZZZZ";
+
+    public static final String DEFAULT_CERTIFICATE_TYPE = "X.509";
 }
diff --git a/src/main/java/org/acra/BaseCrashReportDialog.java b/src/main/java/org/acra/BaseCrashReportDialog.java
deleted file mode 100644
index bc024dbc..00000000
--- a/src/main/java/org/acra/BaseCrashReportDialog.java
+++ /dev/null
@@ -1,90 +0,0 @@
-package org.acra;
-
-import android.app.Activity;
-import android.os.Bundle;
-import android.widget.Toast;
-import org.acra.collector.CrashReportData;
-import org.acra.util.ToastSender;
-
-import java.io.IOException;
-
-import static org.acra.ACRA.LOG_TAG;
-import static org.acra.ReportField.USER_COMMENT;
-import static org.acra.ReportField.USER_EMAIL;
-
-/**
- * Activity which implements the base functionality for a CrashReportDialog
- * Activities which extend from this class can override onCreate() to create a custom view,
- * but they must call super.onCreate() at the beginning of the method.
- *
- * The methods sendCrash(comment, usrEmail) and cancelReports() can be used to send or cancel
- * sending of reports respectively.
- *
- * This Activity will be instantiated with 2 arguments:
- * <ol>
- *     <li>{@link ACRAConstants#EXTRA_REPORT_FILE_NAME}</li>
- *     <li>{@link ACRAConstants#EXTRA_REPORT_EXCEPTION}</li>
- * </ol>
- */
-public abstract class BaseCrashReportDialog extends Activity {
-
-    private String mReportFileName;
-
-    @Override
-    protected void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-
-        ACRA.log.d(LOG_TAG, "CrashReportDialog extras=" + getIntent().getExtras());
-
-        final boolean forceCancel = getIntent().getBooleanExtra(ACRAConstants.EXTRA_FORCE_CANCEL, false);
-        if (forceCancel) {
-            ACRA.log.d(LOG_TAG, "Forced reports deletion.");
-            cancelReports();
-            finish();
-            return;
-        }
-
-        mReportFileName = getIntent().getStringExtra(ACRAConstants.EXTRA_REPORT_FILE_NAME);
-        ACRA.log.d(LOG_TAG, "Opening CrashReportDialog for " + mReportFileName);
-        if (mReportFileName == null) {
-            finish();
-        }
-    }
-
-
-    /**
-     * Cancel any pending crash reports
-     */
-    protected void cancelReports() {
-        ACRA.getErrorReporter().deletePendingNonApprovedReports(false);
-    }
-
-
-    /**
-     * Send crash report given user's comment and email address. If none should be empty strings
-     * @param comment       Comment (may be null) provided by the user.
-     * @param userEmail     Email address (may be null) provided by the client.
-     */
-    protected void sendCrash(String comment, String userEmail) {
-        final CrashReportPersister persister = new CrashReportPersister(getApplicationContext());
-        try {
-            ACRA.log.d(LOG_TAG, "Add user comment to " + mReportFileName);
-            final CrashReportData crashData = persister.load(mReportFileName);
-            crashData.put(USER_COMMENT, comment == null ? "" : comment);
-            crashData.put(USER_EMAIL, userEmail == null ? "" : userEmail);
-            persister.store(crashData, mReportFileName);
-        } catch (IOException e) {
-            ACRA.log.w(LOG_TAG, "User comment not added: ", e);
-        }
-
-        // Start the report sending task
-        ACRA.log.v(LOG_TAG, "About to start SenderWorker from CrashReportDialog");
-        ACRA.getErrorReporter().startSendingReports(false, true);
-
-        // Optional Toast to thank the user
-        final int toastId = ACRA.getConfig().resDialogOkToast();
-        if (toastId != 0) {
-            ToastSender.sendToast(getApplicationContext(), toastId, Toast.LENGTH_LONG);
-        }
-    }
-}
diff --git a/src/main/java/org/acra/CrashReportDialog.java b/src/main/java/org/acra/CrashReportDialog.java
index c55f5923..f113167f 100644
--- a/src/main/java/org/acra/CrashReportDialog.java
+++ b/src/main/java/org/acra/CrashReportDialog.java
@@ -1,169 +1,20 @@
-package org.acra;
-
-import android.app.AlertDialog;
-import android.content.DialogInterface;
-import android.content.SharedPreferences;
-import android.os.Bundle;
-import android.text.InputType;
-import android.view.View;
-import android.view.ViewGroup.LayoutParams;
-import android.widget.EditText;
-import android.widget.LinearLayout;
-import android.widget.ScrollView;
-import android.widget.TextView;
-
-
-/**
- * This is the dialog Activity used by ACRA to get authorization from the user
- * to send reports. Requires android:launchMode="singleInstance" in your
- * AndroidManifest to work properly.
- **/
-public class CrashReportDialog extends BaseCrashReportDialog implements DialogInterface.OnClickListener, DialogInterface.OnDismissListener {
-
-    private static final String STATE_EMAIL = "email";
-    private static final String STATE_COMMENT = "comment";
-    private EditText userCommentView;
-    private EditText userEmailView;
-
-    AlertDialog mDialog;
-
-    @Override
-    protected void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-
-        final AlertDialog.Builder dialogBuilder = new AlertDialog.Builder(this);
-        final int titleResourceId = ACRA.getConfig().resDialogTitle();
-        if (titleResourceId != 0) {
-            dialogBuilder.setTitle(titleResourceId);
-        }
-        final int iconResourceId = ACRA.getConfig().resDialogIcon();
-        if (iconResourceId != 0) {
-            dialogBuilder.setIcon(iconResourceId);
-        }
-        dialogBuilder.setView(buildCustomView(savedInstanceState));
-        dialogBuilder.setPositiveButton(getText(ACRA.getConfig().resDialogPositiveButtonText()), CrashReportDialog.this);
-        dialogBuilder.setNegativeButton(getText(ACRA.getConfig().resDialogNegativeButtonText()), CrashReportDialog.this);
-
-        mDialog = dialogBuilder.create();
-        mDialog.setCanceledOnTouchOutside(false);
-        mDialog.setOnDismissListener(this);
-        mDialog.show();
-    }
-
-    protected View buildCustomView(Bundle savedInstanceState) {
-        final LinearLayout root = new LinearLayout(this);
-        root.setOrientation(LinearLayout.VERTICAL);
-        root.setPadding(10, 10, 10, 10);
-        root.setLayoutParams(new LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT));
-        root.setFocusable(true);
-        root.setFocusableInTouchMode(true);
-
-        final ScrollView scroll = new ScrollView(this);
-        root.addView(scroll, new LinearLayout.LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT, 1.0f));
-        final LinearLayout scrollable = new LinearLayout(this);
-        scrollable.setOrientation(LinearLayout.VERTICAL);
-        scroll.addView(scrollable);
-
-        final TextView text = new TextView(this);
-        final int dialogTextId = ACRA.getConfig().resDialogText();
-        if (dialogTextId != 0) {
-            text.setText(getText(dialogTextId));
-        }
-        scrollable.addView(text);
-
-        // Add an optional prompt for user comments
-        final int commentPromptId = ACRA.getConfig().resDialogCommentPrompt();
-        if (commentPromptId != 0) {
-            final TextView label = new TextView(this);
-            label.setText(getText(commentPromptId));
-
-            label.setPadding(label.getPaddingLeft(), 10, label.getPaddingRight(), label.getPaddingBottom());
-            scrollable.addView(label, new LinearLayout.LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.WRAP_CONTENT));
-
-            userCommentView = new EditText(this);
-            userCommentView.setLines(2);
-            if (savedInstanceState != null) {
-                String savedValue = savedInstanceState.getString(STATE_COMMENT);
-                if (savedValue != null) {
-                    userCommentView.setText(savedValue);
-                }
-            }
-            scrollable.addView(userCommentView);
-        }
-
-        // Add an optional user email field
-        final int emailPromptId = ACRA.getConfig().resDialogEmailPrompt();
-        if (emailPromptId != 0) {
-            final TextView label = new TextView(this);
-            label.setText(getText(emailPromptId));
-
-            label.setPadding(label.getPaddingLeft(), 10, label.getPaddingRight(), label.getPaddingBottom());
-            scrollable.addView(label);
-
-            userEmailView = new EditText(this);
-            userEmailView.setSingleLine();
-            userEmailView.setInputType(InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_EMAIL_ADDRESS);
-
-            String savedValue = null;
-            if (savedInstanceState != null) {
-                savedValue = savedInstanceState.getString(STATE_EMAIL);
-            }
-            if (savedValue != null) {
-                userEmailView.setText(savedValue);
-            } else {
-                final SharedPreferences prefs = ACRA.getACRASharedPreferences();
-                userEmailView.setText(prefs.getString(ACRA.PREF_USER_EMAIL_ADDRESS, ""));
-            }
-            scrollable.addView(userEmailView);
-        }
-
-        return root;
-    }
-
-    @Override
-    public void onClick(DialogInterface dialog, int which) {
-        if (which == DialogInterface.BUTTON_POSITIVE) {
-            // Retrieve user comment
-            final String comment = userCommentView != null ? userCommentView.getText().toString() : "";
-
-            // Store the user email
-            final String userEmail;
-            final SharedPreferences prefs = ACRA.getACRASharedPreferences();
-            if (userEmailView != null) {
-                userEmail = userEmailView.getText().toString();
-                final SharedPreferences.Editor prefEditor = prefs.edit();
-                prefEditor.putString(ACRA.PREF_USER_EMAIL_ADDRESS, userEmail);
-                prefEditor.commit();
-            } else {
-                userEmail = prefs.getString(ACRA.PREF_USER_EMAIL_ADDRESS, "");
-            }
-            sendCrash(comment, userEmail);
-        } else {
-            cancelReports();
-        }
-
-        finish();
-    }
-
-
-    @Override
-    public void onDismiss(DialogInterface dialog) {
-        finish();
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see android.app.Activity#onSaveInstanceState(android.os.Bundle)
-     */
-    @Override
-    protected void onSaveInstanceState(Bundle outState) {
-        super.onSaveInstanceState(outState);
-        if (userCommentView != null && userCommentView.getText() != null) {
-            outState.putString(STATE_COMMENT, userCommentView.getText().toString());
-        }
-        if (userEmailView != null && userEmailView.getText() != null) {
-            outState.putString(STATE_EMAIL, userEmailView.getText().toString());
-        }
-    }
+package org.acra;
+
+import android.os.Bundle;
+
+import static org.acra.ACRA.LOG_TAG;
+
+
+/**
+ * Old crash report dialog.
+ *
+ * @deprecated since 4.8.0 use {@link org.acra.dialog.CrashReportDialog} instead
+ **/
+public final class CrashReportDialog extends org.acra.dialog.CrashReportDialog {
+
+    @Override
+    protected void buildAndShowDialog(Bundle savedInstanceState){
+        ACRA.log.w(LOG_TAG, "org.acra.CrashReportDialog has been deprecated. Please use org.acra.dialog.CrashReportDialog instead");
+        super.buildAndShowDialog(savedInstanceState);
+    }
 }
\ No newline at end of file
diff --git a/src/main/java/org/acra/CrashReportFinder.java b/src/main/java/org/acra/CrashReportFinder.java
deleted file mode 100644
index 118fb7e0..00000000
--- a/src/main/java/org/acra/CrashReportFinder.java
+++ /dev/null
@@ -1,67 +0,0 @@
-/*
- *  Copyright 2012 Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra;
-
-import static org.acra.ACRA.LOG_TAG;
-
-import java.io.File;
-import java.io.FilenameFilter;
-
-import android.content.Context;
-
-/**
- * Responsible for retrieving the location of Crash Report files.
- * <p/>
- * @author William Ferguson
- * @since 4.3.0
- */
-final class CrashReportFinder {
-
-    private final Context context;
-
-    public CrashReportFinder(Context context) {
-        this.context = context;
-    }
-
-    /**
-     * Returns an array containing the names of pending crash report files.
-     *
-     * @return an array containing the names of pending crash report files.
-     */
-    public String[] getCrashReportFiles() {
-        if (context == null) {
-            ACRA.log.e(LOG_TAG, "Trying to get ACRA reports but ACRA is not initialized.");
-            return new String[0];
-        }
-
-        final File dir = context.getFilesDir();
-        if (dir == null) {
-            ACRA.log.w(LOG_TAG, "Application files directory does not exist! The application may not be installed correctly. Please try reinstalling.");
-            return new String[0];
-        }
-
-        ACRA.log.d(LOG_TAG, "Looking for error files in " + dir.getAbsolutePath());
-
-        // Filter for ".stacktrace" files
-        final FilenameFilter filter = new FilenameFilter() {
-            public boolean accept(File dir, String name) {
-                return name.endsWith(ACRAConstants.REPORTFILE_EXTENSION);
-            }
-        };
-        final String[] result = dir.list(filter);
-        return (result == null) ? new String[0] : result;
-    }
-}
diff --git a/src/main/java/org/acra/CrashReportPersister.java b/src/main/java/org/acra/CrashReportPersister.java
deleted file mode 100644
index aabcd107..00000000
--- a/src/main/java/org/acra/CrashReportPersister.java
+++ /dev/null
@@ -1,352 +0,0 @@
-/*
- * java.util.Properties.java modified by Kevin Gaudin to allow usage of enums as keys.
- *
- *  Licensed to the Apache Software Foundation (ASF) under one or more
- *  contributor license agreements.  See the NOTICE file distributed with
- *  this work for additional information regarding copyright ownership.
- *  The ASF licenses this file to You under the Apache License, Version 2.0
- *  (the "License"); you may not use this file except in compliance with
- *  the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-
-package org.acra;
-
-import android.content.Context;
-
-import org.acra.collector.CollectorUtil;
-import org.acra.collector.CrashReportData;
-
-import java.io.BufferedInputStream;
-import java.io.BufferedReader;
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.io.InputStreamReader;
-import java.io.OutputStream;
-import java.io.OutputStreamWriter;
-import java.io.Reader;
-import java.util.Map;
-
-/**
- * Stores a crash reports data with {@link org.acra.ReportField} enum values as keys.
- * This is basically the source of {@link java.util.Properties} adapted to extend an
- * EnumMap instead of Hashtable and with a few tweaks to avoid losing crazy
- * amounts of android time in the generation of a date comment when storing to
- * file.
- */
-final class CrashReportPersister {
-
-    private static final int NONE = 0, SLASH = 1, UNICODE = 2, CONTINUE = 3, KEY_DONE = 4, IGNORE = 5;
-    private static final String LINE_SEPARATOR = "\n";
-
-    private final Context context;
-
-    CrashReportPersister(Context context) {
-        this.context = context;
-    }
-
-    /**
-     * Loads properties from the specified {@code InputStream}. The encoding is
-     * ISO8859-1.
-     *
-     * @param fileName  Name of the report file from which to load the CrashData.
-     * @return CrashReportData read from the supplied InputStream.
-     * @throws java.io.IOException if error occurs during reading from the {@code InputStream}.
-     */
-    public CrashReportData load(String fileName) throws IOException {
-
-        final FileInputStream in = context.openFileInput(fileName);
-        if (in == null) {
-            throw new IllegalArgumentException("Invalid crash report fileName : " + fileName);
-        }
-
-        try {
-            final BufferedInputStream bis = new BufferedInputStream(in, ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES);
-            return load(new InputStreamReader(bis, "ISO8859-1")); //$NON-NLS-1$
-        } finally {
-            in.close();
-        }
-    }
-
-    /**
-     * Stores the mappings in this Properties to the specified OutputStream,
-     * putting the specified comment at the beginning. The output from this
-     * method is suitable for being read by the load() method.
-     *
-     * @param crashData    CrashReportData to save.
-     * @param fileName      Name of the file to which to store the CrashReportData.
-     * @throws java.io.IOException if the CrashReportData could not be written to the OutputStream.
-     */
-    public void store(CrashReportData crashData, String fileName) throws IOException {
-
-        final OutputStream out = context.openFileOutput(fileName, Context.MODE_PRIVATE);
-        try {
-            final StringBuilder buffer = new StringBuilder(200);
-            final OutputStreamWriter writer = new OutputStreamWriter(out, "ISO8859_1"); //$NON-NLS-1$
-
-            for (final Map.Entry<ReportField, String> entry : crashData.entrySet()) {
-                final String key = entry.getKey().toString();
-                dumpString(buffer, key, true);
-                buffer.append('=');
-                dumpString(buffer, entry.getValue(), false);
-                buffer.append(LINE_SEPARATOR);
-                writer.write(buffer.toString());
-                buffer.setLength(0);
-            }
-            writer.flush();
-        } finally {
-            out.close();
-        }
-    }
-
-    /**
-     * Loads properties from the specified InputStream. The properties are of
-     * the form <code>key=value</code>, one property per line. It may be not
-     * encode as 'ISO-8859-1'.The {@code Properties} file is interpreted
-     * according to the following rules:
-     * <ul>
-     * <li>Empty lines are ignored.</li>
-     * <li>Lines starting with either a "#" or a "!" are comment lines and are
-     * ignored.</li>
-     * <li>A backslash at the end of the line escapes the following newline
-     * character ("\r", "\n", "\r\n"). If there's a whitespace after the
-     * backslash it will just escape that whitespace instead of concatenating
-     * the lines. This does not apply to comment lines.</li>
-     * <li>A property line consists of the key, the space between the key and
-     * the value, and the value. The key goes up to the first whitespace, "=" or
-     * ":" that is not escaped. The space between the key and the value contains
-     * either one whitespace, one "=" or one ":" and any number of additional
-     * whitespaces before and after that character. The value starts with the
-     * first character after the space between the key and the value.</li>
-     * <li>Following escape sequences are recognized: "\ ", "\\", "\r", "\n",
-     * "\!", "\#", "\t", "\b", "\f", and "&#92;uXXXX" (unicode character).</li>
-     * </ul>
-     *
-     * @param reader    Reader from which to read the properties of this CrashReportData.
-     * @return CrashReportData read from the supplied Reader.
-     * @throws java.io.IOException if the properties could not be read.
-     * @since 1.6
-     */
-    private synchronized CrashReportData load(Reader reader) throws IOException {
-        int mode = NONE, unicode = 0, count = 0;
-        char nextChar, buf[] = new char[40];
-        int offset = 0, keyLength = -1, intVal;
-        boolean firstChar = true;
-
-        final CrashReportData crashData = new CrashReportData();
-        final BufferedReader br = new BufferedReader(reader, ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES);
-
-        while (true) {
-            intVal = br.read();
-            if (intVal == -1) {
-                break;
-            }
-            nextChar = (char) intVal;
-
-            if (offset == buf.length) {
-                final char[] newBuf = new char[buf.length * 2];
-                System.arraycopy(buf, 0, newBuf, 0, offset);
-                buf = newBuf;
-            }
-            if (mode == UNICODE) {
-                final int digit = Character.digit(nextChar, 16);
-                if (digit >= 0) {
-                    unicode = (unicode << 4) + digit;
-                    if (++count < 4) {
-                        continue;
-                    }
-                } else if (count <= 4) {
-                    // luni.09=Invalid Unicode sequence: illegal character
-                    throw new IllegalArgumentException("luni.09");
-                }
-                mode = NONE;
-                buf[offset++] = (char) unicode;
-                if (nextChar != '\n' && nextChar != '\u0085') {
-                    continue;
-                }
-            }
-            if (mode == SLASH) {
-                mode = NONE;
-                switch (nextChar) {
-                case '\r':
-                    mode = CONTINUE; // Look for a following \n
-                    continue;
-                case '\u0085':
-                case '\n':
-                    mode = IGNORE; // Ignore whitespace on the next line
-                    continue;
-                case 'b':
-                    nextChar = '\b';
-                    break;
-                case 'f':
-                    nextChar = '\f';
-                    break;
-                case 'n':
-                    nextChar = '\n';
-                    break;
-                case 'r':
-                    nextChar = '\r';
-                    break;
-                case 't':
-                    nextChar = '\t';
-                    break;
-                case 'u':
-                    mode = UNICODE;
-                    unicode = count = 0;
-                    continue;
-                }
-            } else {
-                switch (nextChar) {
-                case '#':
-                case '!':
-                    if (firstChar) {
-                        while (true) {
-                            intVal = br.read();
-                            if (intVal == -1) {
-                                break;
-                            }
-                            nextChar = (char) intVal; // & 0xff
-                                                      // not
-                                                      // required
-                            if (nextChar == '\r' || nextChar == '\n' || nextChar == '\u0085') {
-                                break;
-                            }
-                        }
-                        continue;
-                    }
-                    break;
-                case '\n':
-                    if (mode == CONTINUE) { // Part of a \r\n sequence
-                        mode = IGNORE; // Ignore whitespace on the next line
-                        continue;
-                    }
-                    // fall into the next case
-                case '\u0085':
-                case '\r':
-                    mode = NONE;
-                    firstChar = true;
-                    if (offset > 0 || (offset == 0 && keyLength == 0)) {
-                        if (keyLength == -1) {
-                            keyLength = offset;
-                        }
-                        final String temp = new String(buf, 0, offset);
-                        crashData.put(Enum.valueOf(ReportField.class, temp.substring(0, keyLength)), temp.substring(keyLength));
-                    }
-                    keyLength = -1;
-                    offset = 0;
-                    continue;
-                case '\\':
-                    if (mode == KEY_DONE) {
-                        keyLength = offset;
-                    }
-                    mode = SLASH;
-                    continue;
-                case ':':
-                case '=':
-                    if (keyLength == -1) { // if parsing the key
-                        mode = NONE;
-                        keyLength = offset;
-                        continue;
-                    }
-                    break;
-                }
-                if (Character.isWhitespace(nextChar)) {
-                    if (mode == CONTINUE) {
-                        mode = IGNORE;
-                    }
-                    // if key length == 0 or value length == 0
-                    if (offset == 0 || offset == keyLength || mode == IGNORE) {
-                        continue;
-                    }
-                    if (keyLength == -1) { // if parsing the key
-                        mode = KEY_DONE;
-                        continue;
-                    }
-                }
-                if (mode == IGNORE || mode == CONTINUE) {
-                    mode = NONE;
-                }
-            }
-            firstChar = false;
-            if (mode == KEY_DONE) {
-                keyLength = offset;
-                mode = NONE;
-            }
-            buf[offset++] = nextChar;
-        }
-        if (mode == UNICODE && count <= 4) {
-            // luni.08=Invalid Unicode sequence: expected format \\uxxxx
-            throw new IllegalArgumentException("luni.08");
-        }
-        if (keyLength == -1 && offset > 0) {
-            keyLength = offset;
-        }
-        if (keyLength >= 0) {
-            final String temp = new String(buf, 0, offset);
-            final ReportField key = Enum.valueOf(ReportField.class, temp.substring(0, keyLength));
-            String value = temp.substring(keyLength);
-            if (mode == SLASH) {
-                value += "\u0000";
-            }
-            crashData.put(key, value);
-        }
-
-        CollectorUtil.safeClose(reader);
-
-        return crashData;
-    }
-
-    /**
-     * Constructs a new {@code Properties} object.
-     *
-     * @param buffer    StringBuilder to populate with the supplied property.
-     * @param string    String to append to the buffer.
-     * @param key       Whether the String is a key value or not.
-     */
-    private void dumpString(StringBuilder buffer, String string, boolean key) {
-        int i = 0;
-        if (!key && i < string.length() && string.charAt(i) == ' ') {
-            buffer.append("\\ "); //$NON-NLS-1$
-            i++;
-        }
-
-        for (; i < string.length(); i++) {
-            char ch = string.charAt(i);
-            switch (ch) {
-            case '\t':
-                buffer.append("\\t"); //$NON-NLS-1$
-                break;
-            case '\n':
-                buffer.append("\\n"); //$NON-NLS-1$
-                break;
-            case '\f':
-                buffer.append("\\f"); //$NON-NLS-1$
-                break;
-            case '\r':
-                buffer.append("\\r"); //$NON-NLS-1$
-                break;
-            default:
-                if ("\\#!=:".indexOf(ch) >= 0 || (key && ch == ' ')) {
-                    buffer.append('\\');
-                }
-                if (ch >= ' ' && ch <= '~') {
-                    buffer.append(ch);
-                } else {
-                    final String hex = Integer.toHexString(ch);
-                    buffer.append("\\u"); //$NON-NLS-1$
-                    for (int j = 0; j < 4 - hex.length(); j++) {
-                        buffer.append("0"); //$NON-NLS-1$
-                    }
-                    buffer.append(hex);
-                }
-            }
-        }
-    }
-}
diff --git a/src/main/java/org/acra/ErrorReporter.java b/src/main/java/org/acra/ErrorReporter.java
index a9e29b8a..b59e605a 100644
--- a/src/main/java/org/acra/ErrorReporter.java
+++ b/src/main/java/org/acra/ErrorReporter.java
@@ -15,46 +15,23 @@
  */
 package org.acra;
 
-import android.Manifest.permission;
-import android.app.Activity;
 import android.app.Application;
-import android.app.Notification;
-import android.app.NotificationManager;
-import android.app.PendingIntent;
-import android.content.Context;
-import android.content.Intent;
 import android.content.SharedPreferences;
-import android.content.pm.PackageInfo;
-import android.os.Bundle;
-import android.os.Looper;
-import android.support.v4.app.NotificationCompat;
-import android.widget.Toast;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
 import org.acra.annotation.ReportsCrashes;
-import org.acra.collector.Compatibility;
+import org.acra.builder.*;
 import org.acra.collector.ConfigurationCollector;
-import org.acra.collector.CrashReportData;
 import org.acra.collector.CrashReportDataFactory;
-import org.acra.jraf.android.util.activitylifecyclecallbackscompat.ActivityLifecycleCallbacksCompat;
-import org.acra.jraf.android.util.activitylifecyclecallbackscompat.ApplicationHelper;
-import org.acra.sender.EmailIntentSender;
-import org.acra.sender.HttpSender;
-import org.acra.sender.ReportSender;
-import org.acra.util.PackageManagerWrapper;
-import org.acra.util.ToastSender;
+import org.acra.util.ApplicationStartupProcessor;
+import org.acra.config.ACRAConfiguration;
 
-import java.io.File;
 import java.lang.Thread.UncaughtExceptionHandler;
-import java.lang.ref.WeakReference;
-import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.Calendar;
 import java.util.GregorianCalendar;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
 
 import static org.acra.ACRA.LOG_TAG;
-import static org.acra.ReportField.IS_SILENT;
 
 /**
  * <p>
@@ -83,164 +60,80 @@
 public class ErrorReporter implements Thread.UncaughtExceptionHandler {
 
     private final boolean supportedAndroidVersion;
-    private boolean enabled = false;
-
-    private final Application mContext;
-    private final SharedPreferences prefs;
 
-    /**
-     * Contains the active {@link ReportSender}s.
-     */
-    private final List<ReportSender> mReportSenders = new ArrayList<ReportSender>();
+    private final Application context;
+    @NonNull
+    private final ACRAConfiguration config;
 
+    @NonNull
     private final CrashReportDataFactory crashReportDataFactory;
+    @NonNull
+    private final ReportExecutor reportExecutor;
 
-    private final CrashReportFileNameParser fileNameParser = new CrashReportFileNameParser();
-
-    // A reference to the system's previous default UncaughtExceptionHandler
-    // kept in order to execute the default exception handling after sending the
-    // report.
-    private final Thread.UncaughtExceptionHandler mDfltExceptionHandler;
-
-    private WeakReference<Activity> lastActivityCreated = new WeakReference<Activity>(null);
-
-    /**
-     * This is used to wait for the crash toast to end it's display duration
-     * before killing the Application.
-     */
-    private boolean toastWaitEnded = true;
-
-    private static final ExceptionHandlerInitializer NULL_EXCEPTION_HANDLER_INITIALIZER = new ExceptionHandlerInitializer() {
+    @NonNull
+    private volatile ExceptionHandlerInitializer exceptionHandlerInitializer = new ExceptionHandlerInitializer() {
         @Override
         public void initializeExceptionHandler(ErrorReporter reporter) {
         }
     };
 
-    private volatile ExceptionHandlerInitializer exceptionHandlerInitializer = NULL_EXCEPTION_HANDLER_INITIALIZER;
-
-    /**
-     * Used to create a new (non-cached) PendingIntent each time a new crash occurs.
-     */
-    private static int mNotificationCounter = 0;
 
     /**
      * Can only be constructed from within this class.
      *
-     * @param context
-     *            Context for the application in which ACRA is running.
-     * @param prefs
-     *            SharedPreferences used by ACRA.
-     * @param enabled
-     *            Whether this ErrorReporter should capture Exceptions and
-     *            forward their reports.
+     * @param context   Context for the application in which ACRA is running.
+     * @param config    AcraConfig to use when reporting and sending errors.
+     * @param prefs     SharedPreferences used by ACRA.
+     * @param enabled   Whether this ErrorReporter should capture Exceptions and forward their reports.
+     * @param listenForUncaughtExceptions   Whether to listen for uncaught Exceptions.
      */
-    ErrorReporter(Application context, SharedPreferences prefs, boolean enabled, boolean supportedAndroidVersion) {
+    ErrorReporter(@NonNull Application context, @NonNull ACRAConfiguration config, @NonNull SharedPreferences prefs,
+                  boolean enabled, boolean supportedAndroidVersion, boolean listenForUncaughtExceptions) {
 
-        this.mContext = context;
-        this.prefs = prefs;
-        this.enabled = enabled;
+        this.context = context;
+        this.config = config;
         this.supportedAndroidVersion = supportedAndroidVersion;
 
         // Store the initial Configuration state.
         // This is expensive to gather, so only do so if we plan to report it.
         final String initialConfiguration;
-        if (ACRA.getConfig().getReportFields().contains(ReportField.INITIAL_CONFIGURATION)) {
-            initialConfiguration = ConfigurationCollector.collectConfiguration(mContext);
+        if (config.getReportFields().contains(ReportField.INITIAL_CONFIGURATION)) {
+            initialConfiguration = ConfigurationCollector.collectConfiguration(this.context);
         } else {
             initialConfiguration = null;
         }
 
         // Sets the application start date.
-        // This will be included in the reports, will be helpful compared to
-        // user_crash date.
+        // This will be included in the reports, will be helpful compared to user_crash date.
         final Calendar appStartDate = new GregorianCalendar();
 
-        if (Compatibility.getAPILevel() >= Compatibility.VERSION_CODES.ICE_CREAM_SANDWICH) { // ActivityLifecycleCallback
-            // only available for API14+
-            ApplicationHelper.registerActivityLifecycleCallbacks(context, new ActivityLifecycleCallbacksCompat() {
-                @Override
-                public void onActivityCreated(Activity activity, Bundle savedInstanceState) {
-                    if (ACRA.DEV_LOGGING)
-                        ACRA.log.d(LOG_TAG, "onActivityCreated " + activity.getClass());
-                    if (!(activity instanceof BaseCrashReportDialog)) {
-                        // Ignore CrashReportDialog because we want the last
-                        // application Activity that was started so that we can
-                        // explicitly kill it off.
-                        lastActivityCreated = new WeakReference<Activity>(activity);
-                    }
-                }
-
-                @Override
-                public void onActivityStarted(Activity activity) {
-                    if (ACRA.DEV_LOGGING)
-                        ACRA.log.d(LOG_TAG, "onActivityStarted " + activity.getClass());
-                }
-
-                @Override
-                public void onActivityResumed(Activity activity) {
-                    if (ACRA.DEV_LOGGING)
-                        ACRA.log.d(LOG_TAG, "onActivityResumed " + activity.getClass());
-                }
-
-                @Override
-                public void onActivityPaused(Activity activity) {
-                    if (ACRA.DEV_LOGGING)
-                        ACRA.log.d(LOG_TAG, "onActivityPaused " + activity.getClass());
-                }
+        crashReportDataFactory = new CrashReportDataFactory(this.context, config, prefs, appStartDate, initialConfiguration);
 
-                @Override
-                public void onActivityStopped(Activity activity) {
-                    if (ACRA.DEV_LOGGING)
-                        ACRA.log.d(LOG_TAG, "onActivityStopped " + activity.getClass());
-                }
-
-                @Override
-                public void onActivitySaveInstanceState(Activity activity, Bundle outState) {
-                    if (ACRA.DEV_LOGGING)
-                        ACRA.log.i(LOG_TAG, "onActivitySaveInstanceState " + activity.getClass());
-                }
-
-                @Override
-                public void onActivityDestroyed(Activity activity) {
-                    if (ACRA.DEV_LOGGING)
-                        ACRA.log.i(LOG_TAG, "onActivityDestroyed " + activity.getClass());
-                }
-            });
+        final Thread.UncaughtExceptionHandler defaultExceptionHandler;
+        if (listenForUncaughtExceptions) {
+            defaultExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();
+            Thread.setDefaultUncaughtExceptionHandler(this);
+        } else {
+            defaultExceptionHandler = null;
         }
 
-        crashReportDataFactory = new CrashReportDataFactory(mContext, prefs, appStartDate, initialConfiguration);
+        final LastActivityManager lastActivityManager = new LastActivityManager(this.context);
+        final ReportPrimer reportPrimer = getReportPrimer(config);
 
-        // If mDfltExceptionHandler is not null, initialization is already done.
-        // Don't do it twice to avoid losing the original handler.
-        mDfltExceptionHandler = Thread.getDefaultUncaughtExceptionHandler();
-        Thread.setDefaultUncaughtExceptionHandler(this);
-    }
-
-    /**
-     * @return the current instance of ErrorReporter.
-     * @throws IllegalStateException
-     *             if {@link ACRA#init(android.app.Application)} has not yet
-     *             been called.
-     * @deprecated since 4.3.0 Use {@link org.acra.ACRA#getErrorReporter()}
-     *             instead.
-     */
-    @Deprecated
-    public static ErrorReporter getInstance() {
-        return ACRA.getErrorReporter();
+        reportExecutor = new ReportExecutor(context, config, crashReportDataFactory, lastActivityManager, defaultExceptionHandler, reportPrimer);
+        reportExecutor.setEnabled(enabled);
     }
 
     /**
      * Deprecated. Use {@link #putCustomData(String, String)}.
      *
-     * @param key
-     *            A key for your custom data.
-     * @param value
-     *            The value associated to your key.
+     * @param key   A key for your custom data.
+     * @param value The value associated to your key.
      */
     @Deprecated
     @SuppressWarnings("unused")
-    public void addCustomData(String key, String value) {
-        crashReportDataFactory.putCustomData(key, value);
+    public void addCustomData(@NonNull String key, String value) {
+        putCustomData(key, value);
     }
 
     /**
@@ -256,16 +149,14 @@ public void addCustomData(String key, String value) {
      * "custom" column, as a text containing a 'key = value' pair on each line.
      * </p>
      *
-     * @param key
-     *            A key for your custom data.
-     * @param value
-     *            The value associated to your key.
+     * @param key   A key for your custom data.
+     * @param value The value associated to your key.
      * @return The previous value for this key if there was one, or null.
      * @see #removeCustomData(String)
      * @see #getCustomData(String)
      */
     @SuppressWarnings("unused")
-    public String putCustomData(String key, String value) {
+    public String putCustomData(@NonNull String key, String value) {
         return crashReportDataFactory.putCustomData(key, value);
     }
 
@@ -286,7 +177,7 @@ public String putCustomData(String key, String value) {
      * <p>
      * Example. Add to the {@link Application#onCreate()}:
      * </p>
-     * 
+     *
      * <pre>
      * ACRA.getErrorReporter().setExceptionHandlerInitializer(new ExceptionHandlerInitializer() {
      *     <code>@Override</code> public void initializeExceptionHandler(ErrorReporter reporter) {
@@ -294,24 +185,30 @@ public String putCustomData(String key, String value) {
      *     }
      * });
      * </pre>
-     * 
+     *
      * @param initializer   The initializer. Can be <code>null</code>.
-     */
-    public void setExceptionHandlerInitializer(ExceptionHandlerInitializer initializer) {
-        exceptionHandlerInitializer = (initializer != null) ? initializer : NULL_EXCEPTION_HANDLER_INITIALIZER;
+     * @deprecated since 4.8.0 use {@link ReportPrimer} mechanism instead.
+     */
+    public void setExceptionHandlerInitializer(@Nullable ExceptionHandlerInitializer initializer) {
+        exceptionHandlerInitializer = (initializer != null)
+                ? initializer
+                : new ExceptionHandlerInitializer() {
+                    @Override
+                    public void initializeExceptionHandler(ErrorReporter reporter) {
+                    }
+                };
     }
 
     /**
      * Removes a key/value pair from your reports custom data field.
      *
-     * @param key
-     *            The key of the data to be removed.
+     * @param key   The key of the data to be removed.
      * @return The value for this key before removal.
      * @see #putCustomData(String, String)
      * @see #getCustomData(String)
      */
     @SuppressWarnings("unused")
-    public String removeCustomData(String key) {
+    public String removeCustomData(@NonNull String key) {
         return crashReportDataFactory.removeCustomData(key);
     }
 
@@ -333,70 +230,10 @@ public void clearCustomData() {
      * @see #removeCustomData(String)
      */
     @SuppressWarnings("unused")
-    public String getCustomData(String key) {
+    public String getCustomData(@NonNull String key) {
         return crashReportDataFactory.getCustomData(key);
     }
 
-    /**
-     * Add a {@link ReportSender} to the list of active {@link ReportSender}s.
-     *
-     * @param sender
-     *            The {@link ReportSender} to be added.
-     */
-    public void addReportSender(ReportSender sender) {
-        mReportSenders.add(sender);
-    }
-
-    /**
-     * Remove a specific instance of {@link ReportSender} from the list of
-     * active {@link ReportSender}s.
-     *
-     * @param sender
-     *            The {@link ReportSender} instance to be removed.
-     */
-    @SuppressWarnings("unused")
-    public void removeReportSender(ReportSender sender) {
-        mReportSenders.remove(sender);
-    }
-
-    /**
-     * Remove all {@link ReportSender} instances from a specific class.
-     *
-     * @param senderClass
-     *            ReportSender class whose instances should be removed.
-     */
-    @SuppressWarnings("unused")
-    public void removeReportSenders(Class<?> senderClass) {
-        if (ReportSender.class.isAssignableFrom(senderClass)) {
-            for (ReportSender sender : mReportSenders) {
-                if (senderClass.isInstance(sender)) {
-                    mReportSenders.remove(sender);
-                }
-            }
-        }
-    }
-
-    /**
-     * Clears the list of active {@link ReportSender}s. You should then call
-     * {@link #addReportSender(ReportSender)} or ACRA will not send any report
-     * anymore.
-     */
-    public void removeAllReportSenders() {
-        mReportSenders.clear();
-    }
-
-    /**
-     * Removes all previously set {@link ReportSender}s and set the given one as
-     * the new {@link ReportSender}.
-     *
-     * @param sender
-     *            ReportSender to set as the sole sender for this ErrorReporter.
-     */
-    public void setReportSender(ReportSender sender) {
-        removeAllReportSenders();
-        addReportSender(sender);
-    }
-
     /*
      * (non-Javadoc)
      *
@@ -405,103 +242,47 @@ public void setReportSender(ReportSender sender) {
      * .Thread, java.lang.Throwable)
      */
     @Override
-    public void uncaughtException(Thread t, Throwable e) {
+    public void uncaughtException(@Nullable Thread t, @NonNull Throwable e) {
+
+        // If we're not enabled then just pass the Exception on to the defaultExceptionHandler.
+        if (!reportExecutor.isEnabled()) {
+            reportExecutor.handReportToDefaultExceptionHandler(t, e);
+            return;
+        }
+
         try {
-            // If we're not enabled then just pass the Exception on to any
-            // defaultExceptionHandler.
-            if (!enabled) {
-                if (mDfltExceptionHandler != null) {
-                    ACRA.log.e(LOG_TAG, "ACRA is disabled for " + mContext.getPackageName()
-                        + " - forwarding uncaught Exception on to default ExceptionHandler");
-                    mDfltExceptionHandler.uncaughtException(t, e);
-                } else {
-                    ACRA.log.e(LOG_TAG, "ACRA is disabled for " + mContext.getPackageName()
-                        + " - no default ExceptionHandler");
-                    ACRA.log.e(LOG_TAG,
-                          "ACRA caught a " + e.getClass().getSimpleName() + " for " + mContext.getPackageName(), e);
-                }
-                return;
-            }
+            ACRA.log.e(LOG_TAG, "ACRA caught a " + e.getClass().getSimpleName() + " for " + context.getPackageName(), e);
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Building report");
 
-            ACRA.log.e(LOG_TAG,
-                  "ACRA caught a " + e.getClass().getSimpleName() + " for " + mContext.getPackageName(), e);
-            ACRA.log.d(LOG_TAG, "Building report");
+            performDeprecatedReportPriming();
 
             // Generate and send crash report
-            reportBuilder()
+            new ReportBuilder()
                 .uncaughtExceptionThread(t)
                 .exception(e)
-                .endsApplication()
-                .send();
-        } catch (Throwable fatality) {
-            // ACRA failed. Prevent any recursive call to
-            // ACRA.uncaughtException(), let the native reporter do its job.
-            if (mDfltExceptionHandler != null) {
-                mDfltExceptionHandler.uncaughtException(t, e);
-            }
-        }
-    }
-
-    /**
-     * End the application.
-     */
-    private void endApplication(Thread uncaughtExceptionThread, Throwable th) {
-        // TODO It would be better to create an explicit config attribute #letDefaultHandlerEndApplication
-        // as the intent is clearer and would allows you to switch it off for SILENT.
-        final boolean letDefaultHandlerEndApplication = (
-             ACRA.getConfig().mode() == ReportingInteractionMode.SILENT ||
-            (ACRA.getConfig().mode() == ReportingInteractionMode.TOAST && ACRA.getConfig().forceCloseDialogAfterToast())
-        );
-
-        final boolean handlingUncaughtException = uncaughtExceptionThread != null;
-        if (handlingUncaughtException && letDefaultHandlerEndApplication && (mDfltExceptionHandler != null)) {
-            // Let the system default handler do it's job and display the force close dialog.
-            ACRA.log.d(LOG_TAG, "Handing Exception on to default ExceptionHandler");
-            mDfltExceptionHandler.uncaughtException(uncaughtExceptionThread, th);
-        } else {
-            // If ACRA handles user notifications with a Toast or a Notification
-            // the Force Close dialog is one more notification to the user...
-            // We choose to close the process ourselves using the same actions.
-            ACRA.log.e(LOG_TAG, mContext.getPackageName() + " fatal error : " + th.getMessage(), th);
-
-            // Trying to solve
-            // https://github.com/ACRA/acra/issues/42#issuecomment-12134144
-            // Determine the current/last Activity that was started and close
-            // it. Activity#finish (and maybe it's parent too).
-            final Activity lastActivity = lastActivityCreated.get();
-            if (lastActivity != null) {
-                ACRA.log.i(LOG_TAG, "Finishing the last Activity prior to killing the Process");
-                lastActivity.finish();
-                ACRA.log.i(LOG_TAG, "Finished " + lastActivity.getClass());
-                lastActivityCreated.clear();
-            }
+                .endApplication()
+                .build(reportExecutor);
 
-            android.os.Process.killProcess(android.os.Process.myPid());
-            System.exit(10);
+        } catch (Throwable fatality) {
+            // ACRA failed. Prevent any recursive call to ACRA.uncaughtException(), let the native reporter do its job.
+            ACRA.log.e(LOG_TAG, "ACRA failed to capture the error - handing off to native error reporter" , fatality);
+            reportExecutor.handReportToDefaultExceptionHandler(t, e);
         }
     }
 
     /**
-     * Send a report for this {@link Throwable} silently (forces the use of
-     * {@link ReportingInteractionMode#SILENT} for this report, whatever is the
-     * mode set for the application. Very useful for tracking difficult defects.
+     * Mark this report as silent as send it.
      *
-     * @param e
-     *            The {@link Throwable} to be reported. If null the report will
-     *            contain a new Exception("Report requested by developer").
+     * @param e The {@link Throwable} to be reported. If null the report will
+     *          contain a new Exception("Report requested by developer").
      */
-    public void handleSilentException(Throwable e) {
-        // Mark this report as silent.
-        if (enabled) {
-            reportBuilder()
+    @SuppressWarnings("unused")
+    public void handleSilentException(@Nullable Throwable e) {
+        performDeprecatedReportPriming();
+        new ReportBuilder()
                 .exception(e)
-                .forceSilent()
-                .send();
-            ACRA.log.d(LOG_TAG, "ACRA sent Silent report.");
-            return;
-        }
-
-        ACRA.log.d(LOG_TAG, "ACRA is disabled. Silent report not sent.");
+                .sendSilently()
+                .build(reportExecutor);
     }
 
     /**
@@ -512,117 +293,33 @@ public void handleSilentException(Throwable e) {
      *            forward them as crash reports.
      */
     public void setEnabled(boolean enabled) {
-        if (!supportedAndroidVersion) {
-            ACRA.log.w(LOG_TAG, "ACRA 4.7.0+ requires Froyo or greater. ACRA is disabled and will NOT catch crashes or send messages.");
+        if (supportedAndroidVersion) {
+            ACRA.log.i(LOG_TAG, "ACRA is " + (enabled ? "enabled" : "disabled") + " for " + context.getPackageName());
+            reportExecutor.setEnabled(enabled);
         } else {
-            ACRA.log.i(LOG_TAG, "ACRA is " + (enabled ? "enabled" : "disabled") + " for " + mContext.getPackageName());
-            this.enabled = enabled;
+            ACRA.log.w(LOG_TAG, "ACRA 4.7.0+ requires Froyo or greater. ACRA is disabled and will NOT catch crashes or send messages.");
         }
     }
 
     /**
-     * Starts a Thread to start sending outstanding error reports.
+     * This method looks for pending reports and does the action required depending on the interaction mode set.
      *
-     * @param onlySendSilentReports
-     *            If true then only send silent reports.
-     * @param approveReportsFirst
-     *            If true then approve unapproved reports first.
-     * @return SendWorker that will be sending the report.s
-     */
-    SendWorker startSendingReports(boolean onlySendSilentReports, boolean approveReportsFirst) {
-        final SendWorker worker = new SendWorker(mContext, mReportSenders, onlySendSilentReports, approveReportsFirst);
-        worker.start();
-        return worker;
-    }
-
-    /**
-     * Delete all report files stored.
-     */
-    void deletePendingReports() {
-        deletePendingReports(true, true, 0);
-    }
-
-    /**
-     * This method looks for pending reports and does the action required
-     * depending on the interaction mode set.
+     * @deprecated since 4.8.0 No replacement. Whether to send report on app start is controlled by {@link ACRA#init(Application, ACRAConfiguration, boolean)}.
      */
+    @SuppressWarnings( " unused" )
     public void checkReportsOnApplicationStart() {
-
-        if (ACRA.getConfig().deleteOldUnsentReportsOnApplicationStart()) {
-            // Delete any old unsent reports if this is a newer version of the app
-            // than when we last started.
-            final long lastVersionNr = prefs.getInt(ACRA.PREF_LAST_VERSION_NR, 0);
-            final PackageManagerWrapper packageManagerWrapper = new PackageManagerWrapper(mContext);
-            final PackageInfo packageInfo = packageManagerWrapper.getPackageInfo();
-            if (packageInfo != null) {
-                final boolean newVersion = packageInfo.versionCode > lastVersionNr;
-                if (newVersion) {
-                    deletePendingReports();
-                }
-                final SharedPreferences.Editor prefsEditor = prefs.edit();
-                prefsEditor.putInt(ACRA.PREF_LAST_VERSION_NR, packageInfo.versionCode);
-                prefsEditor.commit();
-            }
+        final ApplicationStartupProcessor startupProcessor = new ApplicationStartupProcessor(context,  config);
+        if (config.deleteOldUnsentReportsOnApplicationStart()) {
+            startupProcessor.deleteUnsentReportsFromOldAppVersion();
         }
-
-        ReportingInteractionMode reportingInteractionMode = ACRA.getConfig().mode();
-
-        if ((reportingInteractionMode == ReportingInteractionMode.NOTIFICATION || reportingInteractionMode == ReportingInteractionMode.DIALOG)
-            && ACRA.getConfig().deleteUnapprovedReportsOnApplicationStart()) {
-            // NOTIFICATION or DIALOG mode, and there are unapproved reports to
-            // send (latest notification/dialog has been ignored: neither
-            // accepted
-            // nor refused). The application developer has decided that
-            // these reports should not be renotified ==> destroy them all but
-            // one.
-            deletePendingNonApprovedReports(true);
+        if (config.deleteUnapprovedReportsOnApplicationStart()) {
+            startupProcessor.deleteAllUnapprovedReportsBarOne();
         }
-
-        final CrashReportFinder reportFinder = new CrashReportFinder(mContext);
-        String[] filesList = reportFinder.getCrashReportFiles();
-
-        if (filesList != null && filesList.length > 0) {
-            // Immediately send reports for SILENT and TOAST modes.
-            // Immediately send reports in NOTIFICATION mode only if they are
-            // all silent or approved.
-            // If there is still one unapproved report in NOTIFICATION mode,
-            // notify it.
-            // If there are unapproved reports in DIALOG mode, show the dialog
-
-
-            final boolean onlySilentOrApprovedReports = containsOnlySilentOrApprovedReports(filesList);
-
-            if (reportingInteractionMode == ReportingInteractionMode.SILENT
-                || reportingInteractionMode == ReportingInteractionMode.TOAST
-                || (onlySilentOrApprovedReports && (reportingInteractionMode == ReportingInteractionMode.NOTIFICATION || reportingInteractionMode == ReportingInteractionMode.DIALOG))) {
-
-                if (reportingInteractionMode == ReportingInteractionMode.TOAST && !onlySilentOrApprovedReports) {
-                    // Display the Toast in TOAST mode only if there are
-                    // non-silent reports.
-                    ToastSender.sendToast(mContext, ACRA.getConfig().resToastText(), Toast.LENGTH_LONG);
-                }
-
-                ACRA.log.v(LOG_TAG, "About to start ReportSenderWorker from #checkReportOnApplicationStart");
-                startSendingReports(false, false);
-            }
-
+        if (reportExecutor.isEnabled()) {
+            startupProcessor.sendApprovedReports();
         }
     }
 
-    /**
-     * Delete all pending non approved reports.
-     *
-     * @param keepOne
-     *            If you need to keep the latest report, set this to true.
-     */
-    void deletePendingNonApprovedReports(boolean keepOne) {
-        // In NOTIFICATION AND DIALOG mode, we have to keep the latest report
-        // which
-        // has been written before killing the app.
-        final int nbReportsToKeep = keepOne ? 1 : 0;
-        deletePendingReports(false, true, nbReportsToKeep);
-    }
-
     /**
      * Send a report for a {@link Throwable} with the reporting interaction mode
      * configured by the developer.
@@ -635,13 +332,14 @@ void deletePendingNonApprovedReports(boolean keepOne) {
      *            sending the report.
      */
     @SuppressWarnings("unused")
-    public void handleException(Throwable e, boolean endApplication) {
-        final ReportBuilder builder = reportBuilder()
-            .exception(e);
+    public void handleException(@Nullable Throwable e, boolean endApplication) {
+        performDeprecatedReportPriming();
+        final ReportBuilder builder = new ReportBuilder();
+        builder.exception(e);
         if (endApplication) {
-            builder.endsApplication();
+            builder.endApplication();
         }
-        builder.send();
+        builder.build(reportExecutor);
     }
 
     /**
@@ -654,506 +352,32 @@ public void handleException(Throwable e, boolean endApplication) {
      *            contain a new Exception("Report requested by developer").
      */
     @SuppressWarnings("unused")
-    public void handleException(Throwable e) {
-        reportBuilder()
-            .exception(e)
-            .send();
-    }
-
-    /**
-     * Creates a new crash report builder
-     *
-     * @return the newly created {@code ReportBuilder}
-     */
-    public ReportBuilder reportBuilder() {
-        return new ReportBuilder();
-    }
-
-    /**
-     * Helps manage
-     */
-    private static class TimeHelper {
-
-        private Long initialTimeMillis;
-
-        public void setInitialTimeMillis(long initialTimeMillis) {
-            this.initialTimeMillis = initialTimeMillis;
-        }
-
-        /**
-         * @return 0 if the initial time has yet to be set otherwise returns the difference between now and the initial time.
-         */
-        public long getElapsedTime() {
-            return (initialTimeMillis == null) ? 0 : System.currentTimeMillis() - initialTimeMillis;
-        }
+    public void handleException(@Nullable Throwable e) {
+        handleException(e, false);
     }
 
     /**
-     * Try to send a report, if an error occurs stores a report file for a later
-     * attempt.
-     *
-     * @param reportBuilder The report builder used to assemble the report
+     * This method is only here to support the deprecated {@link ExceptionHandlerInitializer} mechanism
+     * for adding additional data to a crash report.
      */
-    private void report(final ReportBuilder reportBuilder) {
-
-        if (!enabled) {
-            return;
-        }
-
+    private void performDeprecatedReportPriming() {
         try {
             exceptionHandlerInitializer.initializeExceptionHandler(this);
         } catch (Exception exceptionInRunnable) {
-            ACRA.log.d(LOG_TAG, "Failed to initlize " + exceptionHandlerInitializer + " from #handleException");
-        }
-
-        boolean sendOnlySilentReports = false;
-        ReportingInteractionMode reportingInteractionMode;
-        if (!reportBuilder.mForceSilent) {
-            // No interaction mode defined in the ReportBuilder, we assume it has been set during ACRA.initACRA()
-            reportingInteractionMode = ACRA.getConfig().mode();
-        } else {
-            reportingInteractionMode = ReportingInteractionMode.SILENT;
-
-            // An interaction mode has been provided. If ACRA has been
-            // initialized with a non SILENT mode and this mode is overridden
-            // with SILENT, then we have to send only reports which have been
-            // explicitly declared as silent via handleSilentException().
-            if (ACRA.getConfig().mode() != ReportingInteractionMode.SILENT) {
-                sendOnlySilentReports = true;
-            }
-        }
-
-        final boolean shouldDisplayToast = reportingInteractionMode == ReportingInteractionMode.TOAST
-            || (ACRA.getConfig().resToastText() != 0 && (reportingInteractionMode == ReportingInteractionMode.NOTIFICATION || reportingInteractionMode == ReportingInteractionMode.DIALOG));
-
-        final TimeHelper sentToastTimeMillis = new TimeHelper();
-        if (shouldDisplayToast) {
-            new Thread() {
-
-                /*
-                 * (non-Javadoc)
-                 *
-                 * @see java.lang.Thread#run()
-                 */
-                @Override
-                public void run() {
-                    Looper.prepare();
-                    ToastSender.sendToast(mContext, ACRA.getConfig().resToastText(), Toast.LENGTH_LONG);
-                    sentToastTimeMillis.setInitialTimeMillis(System.currentTimeMillis());
-                    Looper.loop();
-                }
-
-            }.start();
-
-            // We will wait a few seconds at the end of the method to be sure
-            // that the Toast can be read by the user.
-        }
-
-        final CrashReportData crashReportData = crashReportDataFactory.createCrashData(reportBuilder.mMessage,
-                                                                                       reportBuilder.mException, reportBuilder.mCustomData,
-                                                                                       reportBuilder.mForceSilent, reportBuilder.mUncaughtExceptionThread);
-
-        // Always write the report file
-
-        final String reportFileName = getReportFileName(crashReportData);
-        saveCrashReportFile(reportFileName, crashReportData);
-
-        if (reportBuilder.mEndsApplication && !ACRA.getConfig().sendReportsAtShutdown()) {
-            endApplication(reportBuilder.mUncaughtExceptionThread, reportBuilder.mException);
-        }
-
-        SendWorker sender = null;
-
-        if (reportingInteractionMode == ReportingInteractionMode.SILENT
-            || reportingInteractionMode == ReportingInteractionMode.TOAST
-            || prefs.getBoolean(ACRA.PREF_ALWAYS_ACCEPT, false)) {
-
-            // Approve and then send reports now
-            ACRA.log.d(LOG_TAG, "About to start ReportSenderWorker from #handleException");
-            sender = startSendingReports(sendOnlySilentReports, true);
-            if ((reportingInteractionMode == ReportingInteractionMode.SILENT) && !reportBuilder.mEndsApplication) {
-                // Report is being sent silently and the application is not ending.
-                // So no need to wait around for the sender to complete.
-                return;
-            }
-
-        } else if (reportingInteractionMode == ReportingInteractionMode.NOTIFICATION) {
-            ACRA.log.d(LOG_TAG, "Creating Notification.");
-            createNotification(reportFileName, reportBuilder);
+            ACRA.log.w(LOG_TAG, "Failed to initialize " + exceptionHandlerInitializer + " from #handleException");
         }
-
-        toastWaitEnded = true;
-        if (shouldDisplayToast) {
-            // A toast is being displayed, we have to wait for its end before doing anything else.
-            // The toastWaitEnded flag will be checked before any other operation.
-            toastWaitEnded = false;
-            new Thread() {
-
-                @Override
-                public void run() {
-                    ACRA.log.d(LOG_TAG, "Waiting for " + ACRAConstants.TOAST_WAIT_DURATION
-                        + " millis from " + sentToastTimeMillis.initialTimeMillis
-                        + " currentMillis=" + System.currentTimeMillis());
-                    while (sentToastTimeMillis.getElapsedTime() < ACRAConstants.TOAST_WAIT_DURATION) {
-                        try {
-                            // Wait a bit to let the user read the toast
-                            Thread.sleep(100);
-                        } catch (InterruptedException e1) {
-                            ACRA.log.d(LOG_TAG, "Interrupted while waiting for Toast to end.", e1);
-                        }
-                    }
-                    toastWaitEnded = true;
-                }
-            }.start();
-        }
-
-        // Start an AsyncTask waiting for the end of the sender.
-        // Once sent, call endApplication() if reportBuilder.mEndApplication
-        final SendWorker worker = sender;
-        final boolean showDirectDialog = (reportingInteractionMode == ReportingInteractionMode.DIALOG)
-            && !prefs.getBoolean(ACRA.PREF_ALWAYS_ACCEPT, false);
-
-        new Thread() {
-
-            @Override
-            public void run() {
-                // We have to wait for the toast display to be completed.
-                ACRA.log.d(LOG_TAG, "Waiting for Toast");
-                while (!toastWaitEnded) {
-                    try {
-                        Thread.sleep(100);
-                    } catch (InterruptedException e1) {
-                        ACRA.log.d(LOG_TAG, "Error : ", e1);
-                    }
-                }
-                ACRA.log.d(LOG_TAG, "Finished waiting for Toast");
-
-                // We have to wait for the worker job to be completed.
-                if (worker != null) {
-                    ACRA.log.d(LOG_TAG, "Waiting for Worker");
-                    while (worker.isAlive()) {
-                        try {
-                            Thread.sleep(100);
-                        } catch (InterruptedException e1) {
-                            ACRA.log.d(LOG_TAG, "Error : ", e1);
-                        }
-                    }
-                    ACRA.log.d(LOG_TAG, "Finished waiting for Worker");
-                }
-
-                if (showDirectDialog) {
-                    // Create a new activity task with the confirmation dialog.
-                    // This new task will be persisted on application restart
-                    // right after its death.
-                    ACRA.log.d(LOG_TAG, "Creating CrashReportDialog for " + reportFileName);
-                    final Intent dialogIntent = createCrashReportDialogIntent(reportFileName, reportBuilder);
-                    dialogIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
-                    mContext.startActivity(dialogIntent);
-                }
-
-                ACRA.log.d(LOG_TAG, "Wait for Toast + worker ended. Kill Application ? " + reportBuilder.mEndsApplication);
-
-                if (reportBuilder.mEndsApplication) {
-                    endApplication(reportBuilder.mUncaughtExceptionThread, reportBuilder.mException);
-                }
-            }
-        }.start();
     }
 
-    /**
-     * Creates an Intent that can be used to create and show a CrashReportDialog.
-     *
-     * @param reportFileName    Name of the error report to display in the crash report dialog.
-     * @param reportBuilder     ReportBuilder containing the details of the crash.
-     */
-    private Intent createCrashReportDialogIntent(String reportFileName, ReportBuilder reportBuilder) {
-        ACRA.log.d(LOG_TAG, "Creating DialogIntent for " + reportFileName + " exception=" + reportBuilder.mException);
-        final Intent dialogIntent = new Intent(mContext, ACRA.getConfig().reportDialogClass());
-        dialogIntent.putExtra(ACRAConstants.EXTRA_REPORT_FILE_NAME, reportFileName);
-        dialogIntent.putExtra(ACRAConstants.EXTRA_REPORT_EXCEPTION, reportBuilder.mException);
-        return dialogIntent;
-    }
-
-
-    /**
-     * Creates a status bar notification.
-     *
-     * The action triggered when the notification is selected is to start the
-     * {@link CrashReportDialog} Activity.
-     *
-     * @param reportFileName Name of the report file to send.
-     */
-    private void createNotification(String reportFileName, ReportBuilder reportBuilder) {
-
-        final NotificationManager notificationManager = (NotificationManager) mContext.getSystemService(Context.NOTIFICATION_SERVICE);
-
-        final ReportsCrashes conf = ACRA.getConfig();
-
-        // Default notification icon is the warning symbol
-        final int icon = conf.resNotifIcon();
-
-        final CharSequence tickerText = mContext.getText(conf.resNotifTickerText());
-        final long when = System.currentTimeMillis();
-
-        ACRA.log.d(LOG_TAG, "Creating Notification for " + reportFileName);
-        final Intent crashReportDialogIntent = createCrashReportDialogIntent(reportFileName, reportBuilder);
-        final PendingIntent contentIntent = PendingIntent.getActivity(mContext, mNotificationCounter++, crashReportDialogIntent, PendingIntent.FLAG_UPDATE_CURRENT);
-
-        final CharSequence contentTitle = mContext.getText(conf.resNotifTitle());
-        final CharSequence contentText = mContext.getText(conf.resNotifText());
-
-        final NotificationCompat.Builder builder = new NotificationCompat.Builder(mContext);
-        final Notification notification = builder
-            .setSmallIcon(icon)
-            .setTicker(tickerText)
-            .setWhen(when)
-            .setAutoCancel(true)
-            .setContentTitle(contentTitle)
-            .setContentText(contentText)
-            .setContentIntent(contentIntent)
-            .build();
-
-        notification.flags = notification.flags | Notification.FLAG_AUTO_CANCEL;
-
-        // The deleteIntent is invoked when the user swipes away the Notification.
-        // In this case we invoke the CrashReportDialog with EXTRA_FORCE_CANCEL==true
-        // which will cause BaseCrashReportDialog to clear the crash report and finish itself.
-        final Intent deleteIntent = createCrashReportDialogIntent(reportFileName, reportBuilder);
-        deleteIntent.putExtra(ACRAConstants.EXTRA_FORCE_CANCEL, true);
-        notification.deleteIntent = PendingIntent.getActivity(mContext, -1, deleteIntent, 0);
-
-        // Send new notification
-        notificationManager.notify(ACRAConstants.NOTIF_CRASH_ID, notification);
-    }
-
-    private String getReportFileName(CrashReportData crashData) {
-        final Calendar now = new GregorianCalendar();
-        final long timestamp = now.getTimeInMillis();
-        final String isSilent = crashData.getProperty(IS_SILENT);
-        return "" + timestamp + (isSilent != null ? ACRAConstants.SILENT_SUFFIX : "")
-            + ACRAConstants.REPORTFILE_EXTENSION;
-    }
-
-    /**
-     * When a report can't be sent, it is saved here in a file in the root of
-     * the application private directory.
-     *
-     * @param fileName
-     *            In a few rare cases, we write the report again with additional
-     *            data (user comment for example). In such cases, you can
-     *            provide the already existing file name here to overwrite the
-     *            report file. If null, a new file report will be generated
-     * @param crashData
-     *            Can be used to save an alternative (or previously generated)
-     *            report data. Used to store again a report with the addition of
-     *            user comment. If null, the default current crash data are
-     *            used.
-     */
-    private void saveCrashReportFile(String fileName, CrashReportData crashData) {
+    @NonNull
+    private static ReportPrimer getReportPrimer(@NonNull ACRAConfiguration config) {
         try {
-            ACRA.log.d(LOG_TAG, "Writing crash report file " + fileName + ".");
-            final CrashReportPersister persister = new CrashReportPersister(mContext);
-            persister.store(crashData, fileName);
-        } catch (Exception e) {
-            ACRA.log.e(LOG_TAG, "An error occurred while writing the report file...", e);
-        }
-    }
-
-    /**
-     * Delete pending reports.
-     *
-     * @param deleteApprovedReports
-     *            Set to true to delete approved and silent reports.
-     * @param deleteNonApprovedReports
-     *            Set to true to delete non approved/silent reports.
-     * @param nbOfLatestToKeep
-     *            Number of pending reports to retain.
-     */
-    private void deletePendingReports(boolean deleteApprovedReports, boolean deleteNonApprovedReports,
-                                      int nbOfLatestToKeep) {
-        // TODO Check logic and instances where nbOfLatestToKeep = X, because
-        // that might stop us from deleting any reports.
-        final CrashReportFinder reportFinder = new CrashReportFinder(mContext);
-        final String[] filesList = reportFinder.getCrashReportFiles();
-        Arrays.sort(filesList);
-        for (int iFile = 0; iFile < filesList.length - nbOfLatestToKeep; iFile++) {
-            final String fileName = filesList[iFile];
-            final boolean isReportApproved = fileNameParser.isApproved(fileName);
-            if ((isReportApproved && deleteApprovedReports) || (!isReportApproved && deleteNonApprovedReports)) {
-                final File fileToDelete = new File(mContext.getFilesDir(), fileName);
-                ACRA.log.d(LOG_TAG, "Deleting file " + fileName);
-                if (!fileToDelete.delete()) {
-                    ACRA.log.e(LOG_TAG, "Could not delete report : " + fileToDelete);
-                }
-            }
-        }
-    }
-
-    /**
-     * Checks if an array of reports files names contains only silent or
-     * approved reports.
-     *
-     * @param reportFileNames
-     *            Array of report locations to check.
-     * @return True if there are only silent or approved reports. False if there
-     *         is at least one non-approved report.
-     */
-    private boolean containsOnlySilentOrApprovedReports(String[] reportFileNames) {
-        for (String reportFileName : reportFileNames) {
-            if (!fileNameParser.isApproved(reportFileName)) {
-                return false;
-            }
-        }
-        return true;
-    }
-
-    /**
-     * Sets relevant ReportSenders to the ErrorReporter, replacing any
-     * previously set ReportSender.
-     */
-    public void setDefaultReportSenders() {
-        ReportsCrashes conf = ACRA.getConfig();
-        Application mApplication = ACRA.getApplication();
-        removeAllReportSenders();
-
-        // Try to send by mail. If a mailTo address is provided, do not add
-        // other senders.
-        if (!"".equals(conf.mailTo())) {
-            ACRA.log.w(LOG_TAG, mApplication.getPackageName() + " reports will be sent by email (if accepted by user).");
-            setReportSender(new EmailIntentSender(mApplication));
-            return;
-        }
-
-        final PackageManagerWrapper pm = new PackageManagerWrapper(mApplication);
-        if (!pm.hasPermission(permission.INTERNET)) {
-            // NB If the PackageManager has died then this will erroneously log
-            // the error that the App doesn't have Internet (even though it
-            // does).
-            // I think that is a small price to pay to ensure that ACRA doesn't
-            // crash if the PackageManager has died.
-            ACRA.log.e(LOG_TAG,
-                  mApplication.getPackageName()
-                      + " should be granted permission "
-                      + permission.INTERNET
-                      + " if you want your crash reports to be sent. If you don't want to add this permission to your application you can also enable sending reports by email. If this is your will then provide your email address in @ReportsCrashes(mailTo=\"your.account@domain.com\"");
-            return;
+            return config.reportPrimerClass().newInstance();
+        } catch (InstantiationException e) {
+            ACRA.log.w(LOG_TAG, "Could not construct ReportPrimer from " + config.reportPrimerClass() + " - not priming", e);
+        } catch (IllegalAccessException e) {
+            ACRA.log.w(LOG_TAG, "Could not construct ReportPrimer from " + config.reportPrimerClass() + " - not priming", e);
         }
 
-        // If formUri is set, instantiate a sender for a generic HTTP POST form
-        // with default mapping.
-        if (conf.formUri() != null && !"".equals(conf.formUri())) {
-            setReportSender(new HttpSender(ACRA.getConfig().httpMethod(), ACRA.getConfig().reportType(), null));
-        }
-    }
-
-    /**
-     * Fluent API used to assemble the different options used for a crash report
-     */
-    public final class ReportBuilder {
-
-        private String mMessage;
-        private Thread mUncaughtExceptionThread;
-        private Throwable mException;
-        private Map<String, String> mCustomData;
-
-        private boolean mForceSilent = false;
-        private boolean mEndsApplication = false;
-
-        /**
-         * Set the error message to be reported.
-         *
-         * @param msg the error message
-         * @return the updated {@code ReportBuilder}
-         */
-        public ReportBuilder message(String msg) {
-            mMessage = msg;
-            return this;
-        }
-
-        /**
-         * Sets the Thread on which an uncaught Exception occurred.
-         *
-         * @param thread    Thread on which an uncaught Exception occurred.
-         * @return the updated {@code ReportBuilder}
-         */
-        private ReportBuilder uncaughtExceptionThread(Thread thread) {
-            mUncaughtExceptionThread = thread;
-            return this;
-        }
-
-        /**
-         * Set the stack trace to be reported
-         *
-         * @param e The exception that should be associated with this report
-         * @return the updated {@code ReportBuilder}
-         */
-        public ReportBuilder exception(Throwable e) {
-            mException = e;
-            return this;
-        }
-
-        private void initCustomData() {
-            if (mCustomData ==  null)
-                mCustomData = new HashMap<String, String>();
-        }
-
-        /**
-         * Sets additional values to be added to {@code CUSTOM_DATA}. Values
-         * specified here take precedence over globally specified custom data.
-         *
-         * @param customData a map of custom key-values to be attached to the report
-         * @return the updated {@code ReportBuilder}
-         */
-        @SuppressWarnings("unused")
-        public ReportBuilder customData(Map<String, String> customData) {
-            initCustomData();
-            mCustomData.putAll(customData);
-            return this;
-        }
-
-        /**
-         * Sets an additional value to be added to {@code CUSTOM_DATA}. The value
-         * specified here takes precedence over globally specified custom data.
-         *
-         * @param key the key identifying the custom data
-         * @param value the value for the custom data entry
-         * @return the updated {@code ReportBuilder}
-         */
-        @SuppressWarnings("unused")
-        public ReportBuilder customData(String key, String value) {
-            initCustomData();
-            mCustomData.put(key, value);
-            return this;
-        }
-
-        /**
-         * Forces the report to be sent silently, ignoring the default interaction mode set in the config
-         *
-         * @return the updated {@code ReportBuilder}
-         */
-        public ReportBuilder forceSilent() {
-            mForceSilent = true;
-            return this;
-        }
-
-        /**
-         * Ends the application after sending the crash report
-         *
-         * @return the updated {@code ReportBuilder}
-         */
-        public ReportBuilder endsApplication() {
-            mEndsApplication = true;
-            return this;
-        }
-
-        /**
-         * Assembles and sends the crash report
-         */
-        public void send() {
-            if (mMessage == null && mException == null) {
-                mMessage = "Report requested by developer";
-            }
-            report(this);
-        }
+        return new NoOpReportPrimer();
     }
 }
\ No newline at end of file
diff --git a/src/main/java/org/acra/ExceptionHandlerInitializer.java b/src/main/java/org/acra/ExceptionHandlerInitializer.java
index fc532bb9..4e48616c 100644
--- a/src/main/java/org/acra/ExceptionHandlerInitializer.java
+++ b/src/main/java/org/acra/ExceptionHandlerInitializer.java
@@ -7,6 +7,7 @@
  * exception is handled.
  * 
  * @see ErrorReporter#setExceptionHandlerInitializer(ExceptionHandlerInitializer)
+ * @deprecated since 4.8.0 use {@link org.acra.builder.ReportPrimer} mechanism instead.
  */
 public interface ExceptionHandlerInitializer {
     /**
diff --git a/src/main/java/org/acra/ReportField.java b/src/main/java/org/acra/ReportField.java
index 3815b11b..34bf13de 100644
--- a/src/main/java/org/acra/ReportField.java
+++ b/src/main/java/org/acra/ReportField.java
@@ -15,10 +15,10 @@
  */
 package org.acra;
 
-import org.acra.annotation.ReportsCrashes;
-
 import android.content.res.Configuration;
 
+import org.acra.annotation.ReportsCrashes;
+
 /**
  * Specifies all the different fields available in a crash report.
  * 
@@ -27,7 +27,7 @@
  */
 public enum ReportField {
     /**
-     * Report Identifier
+     * Report Identifier.
      */
     REPORT_ID,
     /**
@@ -293,7 +293,7 @@ public boolean containsKeyValuePairs() {
      * Whether this field is a collection of key/value pairs.
      * 
      * @return true if the field contains a string with a key/value pair on each
-     *         line, key and value separated by an equal sugn
+     *         line, key and value separated by an equal sign
      * 
      */
     public boolean containsKeyValuePairs() {
diff --git a/src/main/java/org/acra/SendWorker.java b/src/main/java/org/acra/SendWorker.java
deleted file mode 100644
index 1a90da9a..00000000
--- a/src/main/java/org/acra/SendWorker.java
+++ /dev/null
@@ -1,212 +0,0 @@
-/*
- *  Copyright 2012 Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra;
-
-import static org.acra.ACRA.LOG_TAG;
-
-import java.io.File;
-import java.io.IOException;
-import java.util.Arrays;
-import java.util.List;
-
-import org.acra.collector.CrashReportData;
-import org.acra.sender.ReportSender;
-import org.acra.sender.ReportSenderException;
-
-import android.content.Context;
-
-/**
- * Checks and send reports on a separate Thread.
- * 
- * @author Kevin Gaudin
- */
-final class SendWorker extends Thread {
-
-    private final Context context;
-    private final boolean sendOnlySilentReports;
-    private final boolean approvePendingReports;
-    private final CrashReportFileNameParser fileNameParser = new CrashReportFileNameParser();
-    private final List<ReportSender> reportSenders;
-
-    /**
-     * Creates a new {@link SendWorker} to try sending pending reports.
-     * 
-     * @param context
-     *            ApplicationContext in which the reports are being sent.
-     * @param reportSenders
-     *            List of ReportSender to use to send the crash reports.
-     * @param sendOnlySilentReports
-     *            If set to true, will send only reports which have been
-     *            explicitly declared as silent by the application developer.
-     * @param approvePendingReports
-     *            if this endWorker should approve pending reports before
-     *            sending any reports.
-     */
-    public SendWorker(Context context, List<ReportSender> reportSenders, boolean sendOnlySilentReports,
-            boolean approvePendingReports) {
-        this.context = context;
-        this.reportSenders = reportSenders;
-        this.sendOnlySilentReports = sendOnlySilentReports;
-        this.approvePendingReports = approvePendingReports;
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.lang.Thread#run()
-     */
-    @Override
-    public void run() {
-        if (approvePendingReports) {
-            approvePendingReports();
-        }
-        checkAndSendReports(context, sendOnlySilentReports);
-    }
-
-    /**
-     * Flag all pending reports as "approved" by the user. These reports can be
-     * sent.
-     */
-    private void approvePendingReports() {
-        ACRA.log.d(LOG_TAG, "Mark all pending reports as approved.");
-
-        final CrashReportFinder reportFinder = new CrashReportFinder(context);
-        final String[] reportFileNames = reportFinder.getCrashReportFiles();
-
-        for (String reportFileName : reportFileNames) {
-            if (!fileNameParser.isApproved(reportFileName)) {
-                final File reportFile = new File(context.getFilesDir(), reportFileName);
-
-                // TODO look into how this could cause a file to go from
-                // -approved.stacktrace to -approved-approved.stacktrace
-                final String newName = reportFileName.replace(ACRAConstants.REPORTFILE_EXTENSION,
-                        ACRAConstants.APPROVED_SUFFIX + ACRAConstants.REPORTFILE_EXTENSION);
-
-                // TODO Look into whether rename is atomic. Is there a better
-                // option?
-                final File newFile = new File(context.getFilesDir(), newName);
-                if (!reportFile.renameTo(newFile)) {
-                    ACRA.log.e(LOG_TAG, "Could not rename approved report from " + reportFile + " to " + newFile);
-                }
-            }
-        }
-    }
-
-    /**
-     * Send pending reports.
-     * 
-     * @param context
-     *            The application context.
-     * @param sendOnlySilentReports
-     *            Send only reports explicitly declared as SILENT by the
-     *            developer (sent via
-     *            {@link ErrorReporter#handleSilentException(Throwable)}.
-     */
-    private void checkAndSendReports(Context context, boolean sendOnlySilentReports) {
-        ACRA.log.d(LOG_TAG, "#checkAndSendReports - start");
-        final CrashReportFinder reportFinder = new CrashReportFinder(context);
-        final String[] reportFiles = reportFinder.getCrashReportFiles();
-        Arrays.sort(reportFiles);
-
-        int reportsSentCount = 0;
-
-        for (String curFileName : reportFiles) {
-            if (sendOnlySilentReports && !fileNameParser.isSilent(curFileName)) {
-                continue;
-            }
-
-            if (reportsSentCount >= ACRAConstants.MAX_SEND_REPORTS) {
-                break; // send only a few reports to avoid overloading the
-                       // network
-            }
-
-            ACRA.log.i(LOG_TAG, "Sending file " + curFileName);
-            try {
-                final CrashReportPersister persister = new CrashReportPersister(context);
-                final CrashReportData previousCrashReport = persister.load(curFileName);
-                sendCrashReport(previousCrashReport);
-                deleteFile(context, curFileName);
-            } catch (RuntimeException e) {
-                ACRA.log.e(LOG_TAG, "Failed to send crash reports for " + curFileName, e);
-                deleteFile(context, curFileName);
-                break; // Something really unexpected happened. Don't try to
-                       // send any more reports now.
-            } catch (IOException e) {
-                ACRA.log.e(LOG_TAG, "Failed to load crash report for " + curFileName, e);
-                deleteFile(context, curFileName);
-                break; // Something unexpected happened when reading the crash
-                       // report. Don't try to send any more reports now.
-            } catch (ReportSenderException e) {
-                ACRA.log.e(LOG_TAG, "Failed to send crash report for " + curFileName, e);
-                // An issue occurred while sending this report but we can still try to
-                // send other reports. Report sending is limited by ACRAConstants.MAX_SEND_REPORTS
-                // so there's not much to fear about overloading a failing server.
-            }
-            reportsSentCount++;
-        }
-        ACRA.log.d(LOG_TAG, "#checkAndSendReports - finish");
-    }
-
-    /**
-     * Sends the report with all configured ReportSenders. If at least one
-     * sender completed its job, the report is considered as sent and will not
-     * be sent again for failing senders.
-     * 
-     * @param errorContent
-     *            Crash data.
-     * @throws ReportSenderException
-     *             if unable to send the crash report.
-     */
-    private void sendCrashReport(CrashReportData errorContent) throws ReportSenderException {
-        if (!ACRA.isDebuggable() || ACRA.getConfig().sendReportsInDevMode()) {
-            boolean sentAtLeastOnce = false;
-            ReportSenderException sendFailure = null;
-            String failedSender = null;
-            for (ReportSender sender : reportSenders) {
-                try {
-                    ACRA.log.d(LOG_TAG, "Sending report using " + sender.getClass().getName());
-                    sender.send(context, errorContent);
-                    ACRA.log.d(LOG_TAG, "Sent report using " + sender.getClass().getName());
-
-                    // If at least one sender worked, don't re-send the report later.
-                    sentAtLeastOnce = true;
-                } catch (ReportSenderException e) {
-                    sendFailure = e;
-                    failedSender = sender.getClass().getName();
-                }
-            }
-
-            if (sendFailure != null) {
-                // We had some failure
-                if (!sentAtLeastOnce) {
-                    throw sendFailure; // Don't log here because we aren't dealing with the Exception here.
-                } else {
-                    ACRA.log.w(LOG_TAG,
-                               "ReportSender of class "
-                                   + failedSender
-                                   + " failed but other senders completed their task. ACRA will not send this report again.");
-                }
-            }
-        }
-    }
-
-    private void deleteFile(Context context, String fileName) {
-        final boolean deleted = context.deleteFile(fileName);
-        if (!deleted) {
-            ACRA.log.w(LOG_TAG, "Could not delete error report : " + fileName);
-        }
-    }
-}
diff --git a/src/main/java/org/acra/annotation/ReportsCrashes.java b/src/main/java/org/acra/annotation/ReportsCrashes.java
index 6d2e8607..8858b87a 100644
--- a/src/main/java/org/acra/annotation/ReportsCrashes.java
+++ b/src/main/java/org/acra/annotation/ReportsCrashes.java
@@ -15,25 +15,38 @@
  */
 package org.acra.annotation;
 
-import java.lang.annotation.Documented;
-import java.lang.annotation.ElementType;
-import java.lang.annotation.Inherited;
-import java.lang.annotation.Retention;
-import java.lang.annotation.RetentionPolicy;
-import java.lang.annotation.Target;
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.preference.PreferenceManager;
+import android.support.annotation.DrawableRes;
+import android.support.annotation.NonNull;
+import android.support.annotation.RawRes;
+import android.support.annotation.StringRes;
+import android.support.annotation.StyleRes;
 
 import org.acra.ACRA;
 import org.acra.ACRAConstants;
-import org.acra.BaseCrashReportDialog;
-import org.acra.CrashReportDialog;
 import org.acra.ReportField;
 import org.acra.ReportingInteractionMode;
+import org.acra.builder.NoOpReportPrimer;
+import org.acra.builder.ReportPrimer;
+import org.acra.config.DefaultRetryPolicy;
+import org.acra.config.RetryPolicy;
+import org.acra.dialog.BaseCrashReportDialog;
+import org.acra.dialog.CrashReportDialog;
+import org.acra.security.KeyStoreFactory;
+import org.acra.security.NoKeyStoreFactory;
+import org.acra.sender.DefaultReportSenderFactory;
 import org.acra.sender.HttpSender.Method;
 import org.acra.sender.HttpSender.Type;
+import org.acra.sender.ReportSenderFactory;
 
-import android.content.Context;
-import android.content.SharedPreferences;
-import android.preference.PreferenceManager;
+import java.lang.annotation.Documented;
+import java.lang.annotation.ElementType;
+import java.lang.annotation.Inherited;
+import java.lang.annotation.Retention;
+import java.lang.annotation.RetentionPolicy;
+import java.lang.annotation.Target;
 
 /**
  * Provide configuration elements to the
@@ -57,7 +70,7 @@
      * 
      * @return URI of a custom server to which to post reports.
      */
-    String formUri() default ACRAConstants.DEFAULT_STRING_VALUE;
+    @NonNull String formUri() default ACRAConstants.DEFAULT_STRING_VALUE;
 
     /**
      * <p>
@@ -84,74 +97,80 @@
      * 
      * @return the interaction mode that you want ACRA to implement.
      */
-    ReportingInteractionMode mode() default ReportingInteractionMode.SILENT;
+    @NonNull ReportingInteractionMode mode() default ReportingInteractionMode.SILENT;
 
     /**
      * @return Resource id for the label of positive button in the crash dialog.
      *         If not provided, defaults to 'OK'.
      */
-    int resDialogPositiveButtonText() default ACRAConstants.DEFAULT_DIALOG_POSITIVE_BUTTON_TEXT;
+    @StringRes int resDialogPositiveButtonText() default ACRAConstants.DEFAULT_DIALOG_POSITIVE_BUTTON_TEXT;
 
     /**
      * @return Resource id for the label of negative button in the crash dialog.
      *         If not provided, defaults to 'cancel'.
      */
-    int resDialogNegativeButtonText() default ACRAConstants.DEFAULT_DIALOG_NEGATIVE_BUTTON_TEXT;
+    @StringRes int resDialogNegativeButtonText() default ACRAConstants.DEFAULT_DIALOG_NEGATIVE_BUTTON_TEXT;
 
     /**
      * @return Resource id for the user comment input label in the crash dialog.
      *         If not provided, disables the input field.
      */
-    int resDialogCommentPrompt() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resDialogCommentPrompt() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Resource id for the user email address input label in the crash
      *         dialog. If not provided, disables the input field.
      */
-    int resDialogEmailPrompt() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resDialogEmailPrompt() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Resource id for the icon in the crash dialog. Default value is
      *         the system alert icon.
      */
-    int resDialogIcon() default ACRAConstants.DEFAULT_DIALOG_ICON;
+    @DrawableRes int resDialogIcon() default ACRAConstants.DEFAULT_DIALOG_ICON;
 
     /**
      * @return Resource id for the Toast text triggered when the user accepts to
      *         send a report in the crash dialog.
      */
-    int resDialogOkToast() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resDialogOkToast() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Resource id for the text in the crash dialog.
      */
-    int resDialogText() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resDialogText() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Resource id for the title in the crash dialog.
      */
-    int resDialogTitle() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resDialogTitle() default ACRAConstants.DEFAULT_RES_VALUE;
+
+    /**
+     *
+     * @return resource id for the crash dialog theme
+     */
+    @StyleRes int resDialogTheme() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Resource id for the icon in the status bar notification. Default
      *         is the system error notification icon.
      */
-    int resNotifIcon() default ACRAConstants.DEFAULT_NOTIFICATION_ICON;
+    @DrawableRes int resNotifIcon() default ACRAConstants.DEFAULT_NOTIFICATION_ICON;
 
     /**
      * @return Resource id for the text in the status bar notification.
      */
-    int resNotifText() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resNotifText() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Resource id for the ticker text in the status bar notification.
      */
-    int resNotifTickerText() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resNotifTickerText() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Resource id for the title in the status bar notification.
      */
-    int resNotifTitle() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resNotifTitle() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * Resource id for the Toast text triggered when the application crashes if
@@ -165,7 +184,7 @@
      * @return Resource id for the Toast text triggered when the application
      *         crashes.
      */
-    int resToastText() default ACRAConstants.DEFAULT_RES_VALUE;
+    @StringRes int resToastText() default ACRAConstants.DEFAULT_RES_VALUE;
 
     /**
      * @return Name of the SharedPreferences that will host ACRA settings you
@@ -184,7 +203,7 @@
      *         SharedPreferences, as retrieved with
      *         {@link PreferenceManager#getDefaultSharedPreferences(Context)}.
      */
-    String sharedPreferencesName() default ACRAConstants.DEFAULT_STRING_VALUE;
+    @NonNull String sharedPreferencesName() default ACRAConstants.DEFAULT_STRING_VALUE;
 
     /**
      * If using a custom {@link ReportsCrashes#sharedPreferencesName()}, pass
@@ -226,7 +245,7 @@
      * @return Array of tags that you want to be fetched when collecting DropBox
      *         entries.
      */
-    String[] additionalDropBoxTags() default {};
+    @NonNull String[] additionalDropBoxTags() default {};
 
     /**
      * @return Number of minutes to look back when collecting events from
@@ -261,7 +280,7 @@
      * @return Array of arguments to supply if retrieving the log as part of the
      *         report.
      */
-    String[] logcatArguments() default { "-t", "" + ACRAConstants.DEFAULT_LOGCAT_LINES, "-v", "time" };
+    @NonNull String[] logcatArguments() default { "-t", "" + ACRAConstants.DEFAULT_LOGCAT_LINES, "-v", "time" };
 
     /**
      * When using the {@link #formUri()} parameter to send reports to a custom
@@ -271,7 +290,7 @@
      * 
      * @return Login to use when posting reports to a custom server.
      */
-    String formUriBasicAuthLogin() default ACRAConstants.NULL_VALUE;
+    @NonNull String formUriBasicAuthLogin() default ACRAConstants.NULL_VALUE;
 
     /**
      * When using the {@link #formUri()} parameter to send reports to a custom
@@ -281,7 +300,7 @@
      * 
      * @return Password to use when posting reports to a custom server.
      */
-    String formUriBasicAuthPassword() default ACRAConstants.NULL_VALUE;
+    @NonNull String formUriBasicAuthPassword() default ACRAConstants.NULL_VALUE;
 
     /**
      * <p>
@@ -365,7 +384,7 @@
      * @return ReportField Array listing the fields to be included in the
      *         report.
      */
-    ReportField[] customReportContent() default {};
+    @NonNull ReportField[] customReportContent() default {};
 
     /**
      * <p>
@@ -393,20 +412,24 @@
      * 
      * @return email address to which to send reports.
      */
-    String mailTo() default ACRAConstants.DEFAULT_STRING_VALUE;
+    @NonNull String mailTo() default ACRAConstants.DEFAULT_STRING_VALUE;
 
     /**
-     * Controls whether unapproved reports are deleted on application start or
-     * not. Default is true. This is a change from versions of ACRA before 3.2
-     * as in {@link ReportingInteractionMode#NOTIFICATION} mode reports were
-     * previously kept until the user explicitly opens the Notification dialog
-     * AND choose to send or discard the report. Until then, on application
-     * restart, ACRA was issuing a new crash notification for previous reports
-     * pending for approval. This could be misunderstood by the user with a new
-     * crash, resulting in bad appreciation of the application.
-     * 
-     * @return true if ACRA should delete unapproved reports on application
-     *         start.
+     * Controls whether unapproved reports are deleted on application start or not.
+     * Default is true.
+     *
+     * Silent and Toast reports are automatically approved.
+     * Dialog and Notification reports required explicit approval by the user before they are sent.
+     *
+     * On application restart the user is prompted with approval for any unsent reports.
+     * So you generally don't want to accumulate unapproved reports, otherwise you will prompt them multiple times.
+     *
+     * If this is set to true then all unapproved reports bar one will be deleted on application start.
+     * The last report is always retained because that is the report that probably just happened.
+     *
+     * If set to false then on restart the user will be prompted with approval for each unapproved report.
+     *
+     * @return true if ACRA should delete unapproved reports on application start.
      */
     boolean deleteUnapprovedReportsOnApplicationStart() default ACRAConstants.DEFAULT_DELETE_UNAPPROVED_REPORTS_ON_APPLICATION_START;
 
@@ -434,12 +457,12 @@
     int socketTimeout() default ACRAConstants.DEFAULT_SOCKET_TIMEOUT;
 
     /**
-     * In {@link ReportingInteractionMode#TOAST} mode, set this to true if you
-     * prefer displaying the native Force Close dialog after the Toast.
+     * Set this to true if you prefer displaying the native force close dialog after the ACRA is done.
+     * Recommended: Keep this set to false if using {@link ReportingInteractionMode#DIALOG} for notification.
      * 
-     * @return true if the Force Close dialog has to be displayed.
+     * @return true if the native force close dialog should be displayed.
      */
-    boolean forceCloseDialogAfterToast() default ACRAConstants.DEFAULT_FORCE_CLOSE_DIALOG_AFTER_TOAST;
+    boolean alsoReportToAndroidFramework() default ACRAConstants.DEFAULT_REPORT_TO_ANDROID_FRAMEWORK;
 
     /**
      * Add here your {@link SharedPreferences} identifier Strings if you use
@@ -448,7 +471,7 @@
      * 
      * @return String Array containing the names of the additional preferences.
      */
-    String[] additionalSharedPreferences() default {};
+    @NonNull String[] additionalSharedPreferences() default {};
 
     /**
      * Set this to true if you want to include only logcat lines related to your
@@ -468,13 +491,10 @@
     boolean sendReportsInDevMode() default ACRAConstants.DEFAULT_SEND_REPORTS_IN_DEV_MODE;
 
     /**
-     * Set this to false if you want to disable sending reports at the time the
-     * exception is caught. In this case, reports will not be sent until the
-     * application is restarted.
-     *
-     * @return false if reports should not be sent.
+     * @return true.
+     * @deprecated since 4.8.3 no replacement. Now that we are using the SenderService in a separate process we always send at shutdown.
      */
-    boolean sendReportsAtShutdown() default ACRAConstants.DEFAULT_SEND_REPORTS_AT_SHUTDOWN;
+    boolean sendReportsAtShutdown() default true;
 
     /**
      * Provide here regex patterns to be evaluated on each SharedPreference key
@@ -483,7 +503,7 @@
      * 
      * @return an array of regex patterns, every matching key is not collected.
      */
-    String[] excludeMatchingSharedPreferencesKeys() default {};
+    @NonNull String[] excludeMatchingSharedPreferencesKeys() default {};
 
     /**
      * Provide here regex patterns to be evaluated on each Settings.System,
@@ -493,14 +513,24 @@
      * 
      * @return an array of regex patterns, every matching key is not collected.
      */
-    String[] excludeMatchingSettingsKeys() default {};
+    @NonNull String[] excludeMatchingSettingsKeys() default {};
 
     /**
      * The default value will be a BuildConfig class residing in the same package as the Application class.
      *
      * @return BuildConfig class from which to read any BuildConfig attributes.
      */
-    Class buildConfigClass() default Object.class;
+    @NonNull Class buildConfigClass() default Object.class;
+
+    /**
+     * The default {@link org.acra.sender.ReportSenderFactory} creates an {@link org.acra.sender.EmailIntentSender}
+     * if the 'mailTo' parameter is defined or an {@link org.acra.sender.HttpSender} if the 'formUri' parameter
+     * is defined (and internet permission has been granted.
+     *
+     * @return List of the {@link org.acra.sender.ReportSenderFactory} with which to construct the
+     *         {@link org.acra.sender.ReportSender}s that will send the crash reports.
+     */
+    @NonNull Class<? extends ReportSenderFactory>[] reportSenderFactoryClasses() default {DefaultReportSenderFactory.class};
 
     /**
      * To use in combination with {@link ReportField#APPLICATION_LOG} to set the
@@ -509,10 +539,10 @@
      * {@link Context#getFilesDir()}.
      * 
      * @return a String containing the path/name of your application log file.
-     *         If the string does not containt any path separator, the file is
+     *         If the string does not contain any path separator, the file is
      *         assumed as being in {@link Context#getFilesDir()}.
      */
-    String applicationLogFile() default ACRAConstants.DEFAULT_APPLICATION_LOGFILE;
+    @NonNull String applicationLogFile() default ACRAConstants.DEFAULT_APPLICATION_LOGFILE;
 
     /**
      * To use in combination with {@link ReportField#APPLICATION_LOG} to set the
@@ -524,10 +554,15 @@
     int applicationLogFileLines() default ACRAConstants.DEFAULT_APPLICATION_LOGFILE_LINES;
 
     /**
-     * @return Class for the CrashReportDialog used when sending intent.
-     *  If not provided, defaults to CrashReportDialog.class
+     * @return Class for the CrashReportDialog used when prompting the user for crash details.
+     *          If not provided, defaults to CrashReportDialog.class
+     */
+    @NonNull Class<? extends BaseCrashReportDialog> reportDialogClass() default CrashReportDialog.class;
+
+    /**
+     * @return Class that is ued to provide any extra details for a crash.
      */
-    Class<? extends BaseCrashReportDialog> reportDialogClass() default CrashReportDialog.class;
+    @NonNull Class<? extends ReportPrimer> reportPrimerClass() default NoOpReportPrimer.class;
 
     /**
      * <p>
@@ -536,7 +571,33 @@
      *
      * @return HTTP method used when posting reports.
      */
-    Method httpMethod() default Method.POST;
+    @NonNull Method httpMethod() default Method.POST;
+
+    @NonNull Type reportType() default Type.FORM;
+
+    /**
+     * @return Class which creates a keystore that can contain trusted certificates
+     */
+    @NonNull Class<? extends KeyStoreFactory> keyStoreFactoryClass() default NoKeyStoreFactory.class;
 
-    Type reportType() default Type.FORM;
+    /**
+     * @return path to a custom trusted certificate. Must start with "asset://" if the file is in the assets folder
+     */
+    @NonNull String certificatePath() default ACRAConstants.DEFAULT_STRING_VALUE;
+
+    /**
+     * @return resource id of a custom trusted certificate.
+     */
+    @RawRes int resCertificate() default ACRAConstants.DEFAULT_RES_VALUE;
+
+    /**
+     * @return specify the type of the certificate set in either {@link #certificatePath()} or {@link #resCertificate()}
+     */
+    @NonNull String certificateType() default ACRAConstants.DEFAULT_CERTIFICATE_TYPE;
+
+    /**
+     * @return a Class that decides if a report should be resent (usually if one or more senders failed).
+     * @since 4.9.1
+     */
+    @NonNull Class<? extends RetryPolicy> retryPolicyClass() default DefaultRetryPolicy.class;
 }
diff --git a/src/main/java/org/acra/builder/LastActivityManager.java b/src/main/java/org/acra/builder/LastActivityManager.java
new file mode 100644
index 00000000..83f1c8f9
--- /dev/null
+++ b/src/main/java/org/acra/builder/LastActivityManager.java
@@ -0,0 +1,95 @@
+package org.acra.builder;
+
+import android.app.Activity;
+import android.app.Application;
+import android.os.Build;
+import android.os.Bundle;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import org.acra.ACRA;
+import org.acra.dialog.BaseCrashReportDialog;
+
+import java.lang.ref.WeakReference;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Responsible for tracking the last Activity other than any CrashReport dialog that was created.
+ *
+ * @since 4.8.0
+ */
+public final class LastActivityManager {
+
+    @NonNull
+    private WeakReference<Activity> lastActivityCreated = new WeakReference<Activity>(null);
+
+    public LastActivityManager(@NonNull Application application) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
+
+            // ActivityLifecycleCallback only available for API14+
+            application.registerActivityLifecycleCallbacks(new Application.ActivityLifecycleCallbacks() {
+                @Override
+                public void onActivityCreated(@NonNull Activity activity, Bundle savedInstanceState) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "onActivityCreated " + activity.getClass());
+                    if (!(activity instanceof BaseCrashReportDialog)) {
+                        // Ignore CrashReportDialog because we want the last
+                        // application Activity that was started so that we can explicitly kill it off.
+                        lastActivityCreated = new WeakReference<Activity>(activity);
+                    }
+                }
+
+                @Override
+                public void onActivityStarted(@NonNull Activity activity) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "onActivityStarted " + activity.getClass());
+                }
+
+                @Override
+                public void onActivityResumed(@NonNull Activity activity) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "onActivityResumed " + activity.getClass());
+                }
+
+                @Override
+                public void onActivityPaused(@NonNull Activity activity) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "onActivityPaused " + activity.getClass());
+                }
+
+                @Override
+                public void onActivityStopped(@NonNull Activity activity) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "onActivityStopped " + activity.getClass());
+                    synchronized (this){
+                        notify();
+                    }
+                }
+
+                @Override
+                public void onActivitySaveInstanceState(@NonNull Activity activity, Bundle outState) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "onActivitySaveInstanceState " + activity.getClass());
+                }
+
+                @Override
+                public void onActivityDestroyed(@NonNull Activity activity) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "onActivityDestroyed " + activity.getClass());
+                }
+            });
+        }
+    }
+
+    @Nullable
+    public Activity getLastActivity() {
+        return lastActivityCreated.get();
+    }
+
+    public void clearLastActivity() {
+        lastActivityCreated.clear();
+    }
+
+    public void waitForActivityStop(int timeOutInMillis){
+        synchronized (this) {
+            try {
+                wait(timeOutInMillis);
+            } catch (InterruptedException ignored) {
+            }
+        }
+    }
+}
diff --git a/src/main/java/org/acra/builder/NoOpReportPrimer.java b/src/main/java/org/acra/builder/NoOpReportPrimer.java
new file mode 100644
index 00000000..586ac940
--- /dev/null
+++ b/src/main/java/org/acra/builder/NoOpReportPrimer.java
@@ -0,0 +1,16 @@
+package org.acra.builder;
+
+import android.content.Context;
+
+/**
+ * Does not perform any priming for the current report.
+ *
+ * @since 4.8.0
+ */
+public final class NoOpReportPrimer implements ReportPrimer {
+
+    @Override
+    public void primeReport(Context context, ReportBuilder builder) {
+        // Nothing to do.
+    }
+}
diff --git a/src/main/java/org/acra/builder/ReportBuilder.java b/src/main/java/org/acra/builder/ReportBuilder.java
new file mode 100644
index 00000000..fa892481
--- /dev/null
+++ b/src/main/java/org/acra/builder/ReportBuilder.java
@@ -0,0 +1,152 @@
+package org.acra.builder;
+
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import java.util.HashMap;
+import java.util.Map;
+
+/**
+ * Fluent API used to assemble the different options used for a crash report.
+ *
+ * @since 4.8.0
+ */
+public final class ReportBuilder {
+
+    private String message;
+    private Thread uncaughtExceptionThread;
+    private Throwable exception;
+    private final Map<String, String> customData = new HashMap<String, String>();
+
+    private boolean sendSilently = false;
+    private boolean endApplication = false;
+
+    /**
+     * Set the error message to be reported.
+     *
+     * @param msg the error message
+     * @return the updated {@code ReportBuilder}
+     */
+    @NonNull
+    @SuppressWarnings( "unused" )
+    public ReportBuilder message(@Nullable String msg) {
+        message = msg;
+        return this;
+    }
+
+    @Nullable
+    public String getMessage() {
+        return message;
+    }
+
+    /**
+     * Sets the Thread on which an uncaught Exception occurred.
+     *
+     * @param thread    Thread on which an uncaught Exception occurred.
+     * @return the updated {@code ReportBuilder}
+     */
+    @NonNull
+    public ReportBuilder uncaughtExceptionThread(@Nullable Thread thread) {
+        uncaughtExceptionThread = thread;
+        return this;
+    }
+
+    @Nullable
+    public Thread getUncaughtExceptionThread() {
+        return uncaughtExceptionThread;
+    }
+
+    /**
+     * Set the stack trace to be reported
+     *
+     * @param e The exception that should be associated with this report
+     * @return the updated {@code ReportBuilder}
+     */
+    @NonNull
+    public ReportBuilder exception(@Nullable Throwable e) {
+        exception = e;
+        return this;
+    }
+
+    @Nullable
+    public Throwable getException() {
+        return exception;
+    }
+
+    /**
+     * Sets additional values to be added to {@code CUSTOM_DATA}. Values
+     * specified here take precedence over globally specified custom data.
+     *
+     * @param customData a map of custom key-values to be attached to the report
+     * @return the updated {@code ReportBuilder}
+     */
+    @NonNull
+    @SuppressWarnings("unused")
+    public ReportBuilder customData(@NonNull Map<String, String> customData) {
+        this.customData.putAll(customData);
+        return this;
+    }
+
+    /**
+     * Sets an additional value to be added to {@code CUSTOM_DATA}. The value
+     * specified here takes precedence over globally specified custom data.
+     *
+     * @param key the key identifying the custom data
+     * @param value the value for the custom data entry
+     * @return the updated {@code ReportBuilder}
+     */
+    @NonNull
+    @SuppressWarnings("unused")
+    public ReportBuilder customData(@NonNull String key, String value) {
+        customData.put(key, value);
+        return this;
+    }
+
+    @NonNull
+    public Map<String, String> getCustomData() {
+        return customData;
+    }
+
+    /**
+     * Forces the report to be sent silently, ignoring the default interaction mode set in the config
+     *
+     * @return the updated {@code ReportBuilder}
+     */
+    @NonNull
+    public ReportBuilder sendSilently() {
+        sendSilently = true;
+        return this;
+    }
+
+    public boolean isSendSilently() {
+        return sendSilently;
+    }
+
+    /**
+     * Ends the application after sending the crash report
+     *
+     * @return the updated {@code ReportBuilder}
+     */
+    @NonNull
+    public ReportBuilder endApplication() {
+        endApplication = true;
+        return this;
+    }
+
+    public boolean isEndApplication() {
+        return endApplication;
+    }
+
+    /**
+     * Assembles and sends the crash report.
+     *
+     * @param reportExecutor    ReportExecutor to use to build the report.
+     */
+    public void build(@NonNull ReportExecutor reportExecutor) {
+        if (message == null && exception == null) {
+            message = "Report requested by developer";
+        }
+
+        reportExecutor.execute(this);
+    }
+}
diff --git a/src/main/java/org/acra/builder/ReportExecutor.java b/src/main/java/org/acra/builder/ReportExecutor.java
new file mode 100644
index 00000000..88f1f447
--- /dev/null
+++ b/src/main/java/org/acra/builder/ReportExecutor.java
@@ -0,0 +1,400 @@
+package org.acra.builder;
+
+import android.app.Activity;
+import android.app.Notification;
+import android.app.NotificationManager;
+import android.app.PendingIntent;
+import android.content.Context;
+import android.content.Intent;
+import android.content.SharedPreferences;
+import android.os.Looper;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.support.v4.app.NotificationCompat;
+import android.widget.Toast;
+
+import org.acra.ACRA;
+import org.acra.ACRAConstants;
+import org.acra.ReportingInteractionMode;
+import org.acra.collector.CrashReportData;
+import org.acra.collector.CrashReportDataFactory;
+import org.acra.config.ACRAConfiguration;
+import org.acra.dialog.CrashReportDialog;
+import org.acra.file.CrashReportPersister;
+import org.acra.file.ReportLocator;
+import org.acra.prefs.SharedPreferencesFactory;
+import org.acra.sender.SenderServiceStarter;
+import org.acra.util.ToastSender;
+
+import java.io.File;
+import java.util.Date;
+
+import static org.acra.ACRA.LOG_TAG;
+import static org.acra.ReportField.IS_SILENT;
+import static org.acra.ReportField.USER_CRASH_DATE;
+
+/**
+ * Collates, records and initiates the sending of a report.
+ *
+ * @since 4.8.0
+ */
+public final class ReportExecutor {
+
+    private static final int THREAD_SLEEP_INTERVAL_MILLIS = 100;
+
+    private final Context context;
+    private final ACRAConfiguration config;
+    private final CrashReportDataFactory crashReportDataFactory;
+    private final LastActivityManager lastActivityManager;
+
+    // A reference to the system's previous default UncaughtExceptionHandler
+    // kept in order to execute the default exception handling after sending the report.
+    private final Thread.UncaughtExceptionHandler defaultExceptionHandler;
+
+    private final ReportPrimer reportPrimer;
+
+    private boolean enabled = false;
+
+    /**
+     * Used to create a new (non-cached) PendingIntent each time a new crash occurs.
+     */
+    private static int mNotificationCounter = 0;
+
+    public ReportExecutor(@NonNull Context context,@NonNull ACRAConfiguration config,@NonNull CrashReportDataFactory crashReportDataFactory,
+                          @NonNull LastActivityManager lastActivityManager,@Nullable Thread.UncaughtExceptionHandler defaultExceptionHandler,@NonNull ReportPrimer reportPrimer) {
+        this.context = context;
+        this.config = config;
+        this.crashReportDataFactory = crashReportDataFactory;
+        this.lastActivityManager = lastActivityManager;
+        this.defaultExceptionHandler = defaultExceptionHandler;
+        this.reportPrimer = reportPrimer;
+    }
+
+    /**
+     * Helps manage
+     */
+    private static class TimeHelper {
+
+        private Long initialTimeMillis;
+
+        public void setInitialTimeMillis(long initialTimeMillis) {
+            this.initialTimeMillis = initialTimeMillis;
+        }
+
+        /**
+         * @return 0 if the initial time has yet to be set otherwise returns the difference between now and the initial time.
+         */
+        public long getElapsedTime() {
+            return (initialTimeMillis == null) ? 0 : System.currentTimeMillis() - initialTimeMillis;
+        }
+    }
+
+    public void handReportToDefaultExceptionHandler(@Nullable Thread t, @NonNull Throwable e) {
+        if (defaultExceptionHandler != null) {
+            ACRA.log.i(LOG_TAG, "ACRA is disabled for " + context.getPackageName()
+                    + " - forwarding uncaught Exception on to default ExceptionHandler");
+            defaultExceptionHandler.uncaughtException(t, e);
+        } else {
+            ACRA.log.e(LOG_TAG, "ACRA is disabled for " + context.getPackageName() + " - no default ExceptionHandler");
+            ACRA.log.e(LOG_TAG, "ACRA caught a " + e.getClass().getSimpleName() + " for " + context.getPackageName(), e);
+        }
+
+    }
+
+    public boolean isEnabled() {
+        return enabled;
+    }
+
+    public void setEnabled(boolean enabled) {
+        this.enabled = enabled;
+    }
+
+    /**
+     * Try to send a report, if an error occurs stores a report file for a later attempt.
+     *
+     * @param reportBuilder The report builder used to assemble the report
+     */
+    public void execute(@NonNull final ReportBuilder reportBuilder) {
+
+        if (!enabled) {
+            ACRA.log.v(LOG_TAG, "ACRA is disabled. Report not sent.");
+            return;
+        }
+
+        // Prime this crash report with any extra data.
+        reportPrimer.primeReport(context, reportBuilder);
+
+        boolean sendOnlySilentReports = false;
+        final ReportingInteractionMode reportingInteractionMode;
+        if (!reportBuilder.isSendSilently()) {
+            // No interaction mode defined in the ReportBuilder, we assume it has been set during ACRA.initACRA()
+            reportingInteractionMode = config.mode();
+        } else {
+            reportingInteractionMode = ReportingInteractionMode.SILENT;
+
+            // An interaction mode has been provided. If ACRA has been
+            // initialized with a non SILENT mode and this mode is overridden
+            // with SILENT, then we have to send only reports which have been
+            // explicitly declared as silent via handleSilentException().
+            if (config.mode() != ReportingInteractionMode.SILENT) {
+                sendOnlySilentReports = true;
+            }
+        }
+
+        final boolean shouldDisplayToast = reportingInteractionMode == ReportingInteractionMode.TOAST
+                || (config.resToastText() != 0 && (reportingInteractionMode == ReportingInteractionMode.NOTIFICATION || reportingInteractionMode == ReportingInteractionMode.DIALOG));
+
+        final TimeHelper sentToastTimeMillis = new TimeHelper();
+        if (shouldDisplayToast) {
+            new Thread() {
+
+                /*
+                 * (non-Javadoc)
+                 *
+                 * @see java.lang.Thread#run()
+                 */
+                @Override
+                public void run() {
+                    Looper.prepare();
+                    ToastSender.sendToast(context, config.resToastText(), Toast.LENGTH_LONG);
+                    sentToastTimeMillis.setInitialTimeMillis(System.currentTimeMillis());
+                    Looper.loop();
+                }
+
+            }.start();
+
+            // We will wait a few seconds at the end of the method to be sure
+            // that the Toast can be read by the user.
+        }
+
+        final CrashReportData crashReportData = crashReportDataFactory.createCrashData(reportBuilder);
+
+        // Always write the report file
+
+        final File reportFile = getReportFileName(crashReportData);
+        saveCrashReportFile(reportFile, crashReportData);
+
+        final SharedPreferences prefs = new SharedPreferencesFactory(context, config).create();
+        if (reportingInteractionMode == ReportingInteractionMode.SILENT
+                || reportingInteractionMode == ReportingInteractionMode.TOAST
+                || prefs.getBoolean(ACRA.PREF_ALWAYS_ACCEPT, false)) {
+
+            // Approve and then send reports now
+            startSendingReports(sendOnlySilentReports);
+            if ((reportingInteractionMode == ReportingInteractionMode.SILENT) && !reportBuilder.isEndApplication()) {
+                // Report is being sent silently and the application is not ending.
+                // So no need to wait around for the sender to complete.
+                return;
+            }
+
+        } else if (reportingInteractionMode == ReportingInteractionMode.NOTIFICATION) {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Creating Notification.");
+            createNotification(reportFile, reportBuilder);
+        }
+
+        final boolean showDirectDialog = (reportingInteractionMode == ReportingInteractionMode.DIALOG)
+                && !prefs.getBoolean(ACRA.PREF_ALWAYS_ACCEPT, false);
+
+        if (shouldDisplayToast) {
+            // A toast is being displayed, we have to wait for its end before doing anything else.
+            new Thread() {
+
+                @Override
+                public void run() {
+                    if (ACRA.DEV_LOGGING)
+                        ACRA.log.d(LOG_TAG, "Waiting for " + ACRAConstants.TOAST_WAIT_DURATION
+                                + " millis from " + sentToastTimeMillis.initialTimeMillis
+                                + " currentMillis=" + System.currentTimeMillis());
+                    final long sleep = ACRAConstants.TOAST_WAIT_DURATION - sentToastTimeMillis.getElapsedTime();
+                    try {
+                        // Wait a bit to let the user read the toast
+                        if (sleep > 0L) Thread.sleep(sleep);
+                    } catch (InterruptedException e1) {
+                        if (ACRA.DEV_LOGGING)
+                            ACRA.log.d(LOG_TAG, "Interrupted while waiting for Toast to end.", e1);
+                    }
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Finished waiting for Toast");
+                    dialogAndEnd(reportBuilder, reportFile, showDirectDialog);
+                }
+            }.start();
+        } else {
+            dialogAndEnd(reportBuilder, reportFile, showDirectDialog);
+        }
+    }
+
+    private void dialogAndEnd(@NonNull ReportBuilder reportBuilder, @NonNull File reportFile, boolean shouldShowDialog) {
+        if (shouldShowDialog) {
+            // Create a new activity task with the confirmation dialog.
+            // This new task will be persisted on application restart
+            // right after its death.
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Creating CrashReportDialog for " + reportFile);
+            final Intent dialogIntent = createCrashReportDialogIntent(reportFile, reportBuilder);
+            dialogIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
+            context.startActivity(dialogIntent);
+        }
+
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Wait for Toast + worker ended. Kill Application ? " + reportBuilder.isEndApplication());
+
+        if (reportBuilder.isEndApplication()) {
+            endApplication(reportBuilder.getUncaughtExceptionThread(), reportBuilder.getException());
+        }
+    }
+
+    /**
+     * End the application.
+     */
+    private void endApplication(@Nullable Thread uncaughtExceptionThread, Throwable th) {
+        final boolean letDefaultHandlerEndApplication = config.alsoReportToAndroidFramework();
+
+        final boolean handlingUncaughtException = uncaughtExceptionThread != null;
+        if (handlingUncaughtException && letDefaultHandlerEndApplication && defaultExceptionHandler != null) {
+            // Let the system default handler do it's job and display the force close dialog.
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Handing Exception on to default ExceptionHandler");
+            defaultExceptionHandler.uncaughtException(uncaughtExceptionThread, th);
+        } else {
+            // If ACRA handles user notifications with a Toast or a Notification
+            // the Force Close dialog is one more notification to the user...
+            // We choose to close the process ourselves using the same actions.
+
+            // Trying to solve https://github.com/ACRA/acra/issues/42#issuecomment-12134144
+            // Determine the current/last Activity that was started and close
+            // it. Activity#finish (and maybe it's parent too).
+            final Activity lastActivity = lastActivityManager.getLastActivity();
+            if (lastActivity != null) {
+                if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Finishing the last Activity prior to killing the Process");
+                lastActivity.runOnUiThread(new Runnable() {
+                    @Override
+                    public void run() {
+                        lastActivity.finish();
+                        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Finished " + lastActivity.getClass());
+                    }
+                });
+
+                // A crashed activity won't continue its lifecycle. So we only wait if something else crashed
+                if (uncaughtExceptionThread != lastActivity.getMainLooper().getThread()) {
+                    lastActivityManager.waitForActivityStop(100);
+                }
+                lastActivityManager.clearLastActivity();
+            }
+
+            android.os.Process.killProcess(android.os.Process.myPid());
+            System.exit(10);
+        }
+    }
+
+    /**
+     * Starts a Thread to start sending outstanding error reports.
+     *
+     * @param onlySendSilentReports If true then only send silent reports.
+     */
+    private void startSendingReports(boolean onlySendSilentReports) {
+        if (enabled) {
+            final SenderServiceStarter starter = new SenderServiceStarter(context, config);
+            starter.startService(onlySendSilentReports, true);
+        } else {
+            ACRA.log.w(LOG_TAG, "Would be sending reports, but ACRA is disabled");
+        }
+    }
+
+    /**
+     * Creates a status bar notification.
+     *
+     * The action triggered when the notification is selected is to start the
+     * {@link CrashReportDialog} Activity.
+     *
+     * @param reportFile    Report file to send.
+     */
+    private void createNotification(@NonNull File reportFile, @NonNull ReportBuilder reportBuilder) {
+
+        final NotificationManager notificationManager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);
+
+        // Default notification icon is the warning symbol
+        final int icon = config.resNotifIcon();
+
+        final CharSequence tickerText = context.getText(config.resNotifTickerText());
+        final long when = System.currentTimeMillis();
+
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Creating Notification for " + reportFile);
+        final Intent crashReportDialogIntent = createCrashReportDialogIntent(reportFile, reportBuilder);
+        final PendingIntent contentIntent = PendingIntent.getActivity(context, mNotificationCounter++, crashReportDialogIntent, PendingIntent.FLAG_UPDATE_CURRENT);
+
+        final CharSequence contentTitle = context.getText(config.resNotifTitle());
+        final CharSequence contentText = context.getText(config.resNotifText());
+
+        final NotificationCompat.Builder builder = new NotificationCompat.Builder(context);
+        final Notification notification = builder
+                .setSmallIcon(icon)
+                .setTicker(tickerText)
+                .setWhen(when)
+                .setAutoCancel(true)
+                .setContentTitle(contentTitle)
+                .setContentText(contentText)
+                .setContentIntent(contentIntent)
+                .build();
+
+        notification.flags |= Notification.FLAG_AUTO_CANCEL;
+
+        // The deleteIntent is invoked when the user swipes away the Notification.
+        // In this case we invoke the CrashReportDialog with EXTRA_FORCE_CANCEL==true
+        // which will cause BaseCrashReportDialog to clear the crash report and finish itself.
+        final Intent deleteIntent = createCrashReportDialogIntent(reportFile, reportBuilder);
+        deleteIntent.putExtra(ACRAConstants.EXTRA_FORCE_CANCEL, true);
+        notification.deleteIntent = PendingIntent.getActivity(context, -1, deleteIntent, 0);
+
+        // Send new notification
+        notificationManager.notify(ACRAConstants.NOTIF_CRASH_ID, notification);
+    }
+
+    @NonNull
+    private File getReportFileName(@NonNull CrashReportData crashData) {
+        final String timestamp = crashData.getProperty(USER_CRASH_DATE);
+        final String isSilent = crashData.getProperty(IS_SILENT);
+        final String fileName = (timestamp != null ? timestamp : new Date().getTime()) // Need to check for null because old version of ACRA did not always capture USER_CRASH_DATE
+                + (isSilent != null ? ACRAConstants.SILENT_SUFFIX : "")
+                + ACRAConstants.REPORTFILE_EXTENSION;
+        final ReportLocator reportLocator = new ReportLocator(context);
+        return new File(reportLocator.getUnapprovedFolder(), fileName);
+    }
+
+    /**
+     * When a report can't be sent, it is saved here in a file in the root of
+     * the application private directory.
+     *
+     * @param file
+     *            In a few rare cases, we write the report again with additional
+     *            data (user comment for example). In such cases, you can
+     *            provide the already existing file name here to overwrite the
+     *            report file. If null, a new file report will be generated
+     * @param crashData
+     *            Can be used to save an alternative (or previously generated)
+     *            report data. Used to store again a report with the addition of
+     *            user comment. If null, the default current crash data are
+     *            used.
+     */
+    private void saveCrashReportFile(@NonNull File file, @NonNull CrashReportData crashData) {
+        try {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Writing crash report file " + file);
+            final CrashReportPersister persister = new CrashReportPersister();
+            persister.store(crashData, file);
+        } catch (Exception e) {
+            ACRA.log.e(LOG_TAG, "An error occurred while writing the report file...", e);
+        }
+    }
+
+
+    /**
+     * Creates an Intent that can be used to create and show a CrashReportDialog.
+     *
+     * @param reportFile        Error report file to display in the crash report dialog.
+     * @param reportBuilder     ReportBuilder containing the details of the crash.
+     */
+    @NonNull
+    private Intent createCrashReportDialogIntent(@NonNull File reportFile, @NonNull ReportBuilder reportBuilder) {
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Creating DialogIntent for " + reportFile + " exception=" + reportBuilder.getException());
+        final Intent dialogIntent = new Intent(context, config.reportDialogClass());
+        dialogIntent.putExtra(ACRAConstants.EXTRA_REPORT_FILE, reportFile);
+        dialogIntent.putExtra(ACRAConstants.EXTRA_REPORT_EXCEPTION, reportBuilder.getException());
+        dialogIntent.putExtra(ACRAConstants.EXTRA_REPORT_CONFIG, config);
+        return dialogIntent;
+    }
+}
diff --git a/src/main/java/org/acra/builder/ReportPrimer.java b/src/main/java/org/acra/builder/ReportPrimer.java
new file mode 100644
index 00000000..ee03d9b5
--- /dev/null
+++ b/src/main/java/org/acra/builder/ReportPrimer.java
@@ -0,0 +1,30 @@
+package org.acra.builder;
+
+import android.content.Context;
+
+import java.util.Map;
+
+/**
+ * Primes a {@link ReportBuilder} with any extra data to record for the current crash report.
+ *
+ * ReportPrimer is configured declaratively via {@link org.acra.annotation.ReportsCrashes#reportPrimerClass()}.
+ * The ReportPrimer class MUST have a no arg constructor and is created when ACRA is initialised.
+ *
+ * Created by William on 9 Jan 2016.
+ * @since 4.8.0
+ */
+public interface ReportPrimer {
+
+    /**
+     * Update builder via {@link ReportBuilder#customData(Map)} or {@link ReportBuilder#customData(String, String)}
+     * with any extra dta application to just this crash.
+     *
+     * Builder is fully constructed when this method is called, so it can be introspected for details of the crash.
+     *
+     * Note that this method will only be called if ACRA is currently enabled.
+     *
+     * @param context   Application context from which to retrieve resources.
+     * @param builder   Full configured {@link ReportBuilder} for the current crash report.
+     */
+    void primeReport(Context context, ReportBuilder builder);
+}
diff --git a/src/main/java/org/acra/util/BoundedLinkedList.java b/src/main/java/org/acra/collections/BoundedLinkedList.java
similarity index 77%
rename from src/main/java/org/acra/util/BoundedLinkedList.java
rename to src/main/java/org/acra/collections/BoundedLinkedList.java
index fc50ec44..187ce428 100644
--- a/src/main/java/org/acra/util/BoundedLinkedList.java
+++ b/src/main/java/org/acra/collections/BoundedLinkedList.java
@@ -1,130 +1,163 @@
-/*
- *  Copyright 2010 Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra.util;
-
-import java.util.Collection;
-import java.util.LinkedList;
-
-/**
- * A {@link LinkedList} version with a maximum number of elements. When adding
- * elements to the end of the list, first elements in the list are discarded if
- * the maximum size is reached.
- * 
- * @author Kevin Gaudin
- * 
- * @param <E>
- */
-@SuppressWarnings("serial")
-public class BoundedLinkedList<E> extends LinkedList<E> {
-
-    private final int maxSize;
-
-    public BoundedLinkedList(int maxSize) {
-        this.maxSize = maxSize;
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.util.LinkedList#add(java.lang.Object)
-     */
-    @Override
-    public boolean add(E object) {
-        if (size() == maxSize) {
-            removeFirst();
-        }
-        return super.add(object);
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.util.LinkedList#add(int, java.lang.Object)
-     */
-    @Override
-    public void add(int location, E object) {
-        if (size() == maxSize) {
-            removeFirst();
-        }
-        super.add(location, object);
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.util.LinkedList#addAll(java.util.Collection)
-     */
-    @Override
-    public boolean addAll(Collection<? extends E> collection) {
-        final int totalNeededSize = size() + collection.size();
-        final int overhead = totalNeededSize - maxSize;
-        if (overhead > 0) {
-            removeRange(0, overhead);
-        }
-        return super.addAll(collection);
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.util.LinkedList#addAll(int, java.util.Collection)
-     */
-    @Override
-    public boolean addAll(int location, Collection<? extends E> collection) {
-        // int totalNeededSize = size() + collection.size();
-        // int overhead = totalNeededSize - maxSize;
-        // if(overhead > 0) {
-        // removeRange(0, overhead);
-        // }
-        // return super.addAll(location, collection);
-        throw new UnsupportedOperationException();
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.util.LinkedList#addFirst(java.lang.Object)
-     */
-    @Override
-    public void addFirst(E object) {
-        // super.addFirst(object);
-        throw new UnsupportedOperationException();
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.util.LinkedList#addLast(java.lang.Object)
-     */
-    @Override
-    public void addLast(E object) {
-        add(object);
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see java.util.AbstractCollection#toString()
-     */
-    @Override
-    public String toString() {
-        final StringBuilder result = new StringBuilder();
-        for (E object : this) {
-            result.append(object.toString());
-        }
-        return result.toString();
-    }
-}
+/*
+ *  Copyright 2010 Kevin Gaudin
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.collections;
+
+import android.support.annotation.NonNull;
+
+import java.util.Collection;
+import java.util.LinkedList;
+
+/**
+ * A {@link LinkedList} version with a maximum number of elements. When adding
+ * elements to the end of the list, first elements in the list are discarded if
+ * the maximum size is reached.
+ *
+ * @author Kevin Gaudin
+ */
+@SuppressWarnings("serial")
+public final class BoundedLinkedList<E> extends LinkedList<E> {
+
+    private final int maxSize;
+
+    public BoundedLinkedList(int maxSize) {
+        this.maxSize = maxSize;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.LinkedList#add(java.lang.Object)
+     */
+    @Override
+    public boolean add(E object) {
+        if (size() == maxSize) {
+            removeFirst();
+        }
+        return super.add(object);
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.LinkedList#add(int, java.lang.Object)
+     */
+    @Override
+    public void add(int location, E object) {
+        if (size() == maxSize) {
+            removeFirst();
+        }
+        super.add(location, object);
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.LinkedList#addAll(java.util.Collection)
+     */
+    @Override
+    public boolean addAll(@NonNull Collection<? extends E> collection) {
+        final int size = collection.size();
+        if (size > maxSize) {
+            final LinkedList<? extends E> list = new LinkedList<E>(collection);
+            for (int i = 0; i < size - maxSize; i++) {
+                list.removeFirst();
+            }
+            collection = list;
+        }
+        final int totalNeededSize = size() + collection.size();
+        final int overhead = totalNeededSize - maxSize;
+        if (overhead > 0) {
+            removeRange(0, overhead);
+        }
+        return super.addAll(collection);
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.LinkedList#addAll(int, java.util.Collection)
+     */
+    @Override
+    public boolean addAll(int location, Collection<? extends E> collection) {
+        // int totalNeededSize = size() + collection.size();
+        // int overhead = totalNeededSize - maxSize;
+        // if(overhead > 0) {
+        // removeRange(0, overhead);
+        // }
+        // return super.addAll(location, collection);
+        if(location == size()){
+            return super.addAll(location, collection);
+        }
+        throw new UnsupportedOperationException();
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.LinkedList#addFirst(java.lang.Object)
+     */
+    @Override
+    public void addFirst(E object) {
+        // super.addFirst(object);
+        throw new UnsupportedOperationException();
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.LinkedList#addLast(java.lang.Object)
+     */
+    @Override
+    public void addLast(E object) {
+        add(object);
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.AbstractCollection#toString()
+     */
+    @NonNull
+    @Override
+    public String toString() {
+        final StringBuilder result = new StringBuilder();
+        for (E object : this) {
+            result.append(object.toString());
+        }
+        return result.toString();
+    }
+
+    @Override
+    public boolean offer(E o) {
+        return add(o);
+    }
+
+    @Override
+    public boolean offerFirst(E e) {
+        addFirst(e);
+        return true;
+    }
+
+    @Override
+    public boolean offerLast(E e) {
+        return add(e);
+    }
+
+    @Override
+    public void push(E e) {
+        add(e);
+    }
+}
diff --git a/src/main/java/org/acra/collections/ImmutableList.java b/src/main/java/org/acra/collections/ImmutableList.java
new file mode 100644
index 00000000..61324f93
--- /dev/null
+++ b/src/main/java/org/acra/collections/ImmutableList.java
@@ -0,0 +1,167 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.collections;
+
+import android.support.annotation.NonNull;
+
+import java.io.Serializable;
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Collection;
+import java.util.Iterator;
+import java.util.List;
+import java.util.ListIterator;
+
+/**
+ * Naive (not optimized) implementation of an Immutable List
+ *
+ * @author F43nd1r
+ * @since 4.9.0
+ */
+public final class ImmutableList<E> implements List<E>, Serializable {
+
+    private final List<E> mList;
+
+    public ImmutableList(E... elements) {
+        this(Arrays.asList(elements));
+    }
+
+    public ImmutableList(Collection<E> collection) {
+        this.mList = new ArrayList<E>(collection);
+    }
+
+    @Override
+    public void add(int location, E object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean add(E object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean addAll(int location, @NonNull Collection<? extends E> collection) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean addAll(@NonNull Collection<? extends E> collection) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public void clear() {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean contains(Object object) {
+        return mList.contains(object);
+    }
+
+    @Override
+    public boolean containsAll(@NonNull Collection<?> collection) {
+        return mList.containsAll(collection);
+    }
+
+    @Override
+    public E get(int location) {
+        return mList.get(location);
+    }
+
+    @Override
+    public int indexOf(Object object) {
+        return mList.indexOf(object);
+    }
+
+    @Override
+    public boolean isEmpty() {
+        return mList.isEmpty();
+    }
+
+    @NonNull
+    @Override
+    public Iterator<E> iterator() {
+        return new UnmodifiableIteratorWrapper<E>(mList.iterator());
+    }
+
+    @Override
+    public int lastIndexOf(Object object) {
+        return mList.lastIndexOf(object);
+    }
+
+    @Override
+    public ListIterator<E> listIterator() {
+        return new UnmodifiableListIteratorWrapper<E>(mList.listIterator());
+    }
+
+    @NonNull
+    @Override
+    public ListIterator<E> listIterator(int location) {
+        return new UnmodifiableListIteratorWrapper<E>(mList.listIterator(location));
+    }
+
+    @Override
+    public E remove(int location) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean remove(Object object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean removeAll(@NonNull Collection<?> collection) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean retainAll(@NonNull Collection<?> collection) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public E set(int location, E object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public int size() {
+        return mList.size();
+    }
+
+    @NonNull
+    @Override
+    public List<E> subList(int start, int end) {
+        throw new UnsupportedOperationException();
+    }
+
+    @NonNull
+    @Override
+    public Object[] toArray() {
+        return mList.toArray();
+    }
+
+    @NonNull
+    @Override
+    public <T> T[] toArray(@NonNull T[] array) {
+        //noinspection SuspiciousToArrayCall
+        return mList.toArray(array);
+    }
+
+}
diff --git a/src/main/java/org/acra/collections/ImmutableMap.java b/src/main/java/org/acra/collections/ImmutableMap.java
new file mode 100644
index 00000000..dd3a2bb2
--- /dev/null
+++ b/src/main/java/org/acra/collections/ImmutableMap.java
@@ -0,0 +1,131 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.collections;
+
+import android.support.annotation.NonNull;
+
+import java.io.Serializable;
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.Map;
+import java.util.Set;
+
+/**
+ * Naive (not optimized) implementation of an Immutable Map
+ *
+ * @author F43nd1r
+ * @since 4.9.0
+ */
+public final class ImmutableMap<K, V> implements Map<K, V>, Serializable {
+
+    private final Map<K, V> mMap;
+
+    public ImmutableMap(Map<K, V> map) {
+        this.mMap = new HashMap<K, V>(map);
+    }
+
+    @Override
+    public void clear() {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean containsKey(Object key) {
+        return mMap.containsKey(key);
+    }
+
+    @Override
+    public boolean containsValue(Object value) {
+        return mMap.containsValue(value);
+    }
+
+    @NonNull
+    @Override
+    public Set<Entry<K, V>> entrySet() {
+        final Set<Entry<K, V>> original = mMap.entrySet();
+        final ImmutableSet.Builder<Entry<K, V>> builder = new ImmutableSet.Builder<Entry<K, V>>();
+        for (Entry<K, V> entry : original) {
+            builder.add(new ImmutableEntryWrapper<K, V>(entry));
+        }
+        return builder.build();
+    }
+
+    @Override
+    public V get(Object key) {
+        return mMap.get(key);
+    }
+
+    @Override
+    public boolean isEmpty() {
+        return mMap.isEmpty();
+    }
+
+    @NonNull
+    @Override
+    public Set<K> keySet() {
+        return new ImmutableSet<K>(mMap.keySet());
+    }
+
+    @Override
+    public V put(K key, V value) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public void putAll(@NonNull Map<? extends K, ? extends V> map) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public V remove(Object object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public int size() {
+        return mMap.size();
+    }
+
+    @NonNull
+    @Override
+    public Collection<V> values() {
+        return new ImmutableList<V>(mMap.values());
+    }
+
+    public static class ImmutableEntryWrapper<K, V> implements Map.Entry<K, V> {
+        private final Map.Entry<K, V> mEntry;
+
+        ImmutableEntryWrapper(Entry<K, V> mEntry) {
+            this.mEntry = mEntry;
+        }
+
+        @Override
+        public K getKey() {
+            return mEntry.getKey();
+        }
+
+        @Override
+        public V getValue() {
+            return mEntry.getValue();
+        }
+
+        @Override
+        public V setValue(Object object) {
+            throw new UnsupportedOperationException();
+        }
+    }
+
+}
diff --git a/src/main/java/org/acra/collections/ImmutableSet.java b/src/main/java/org/acra/collections/ImmutableSet.java
new file mode 100644
index 00000000..f2e9b13e
--- /dev/null
+++ b/src/main/java/org/acra/collections/ImmutableSet.java
@@ -0,0 +1,130 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.collections;
+
+import android.support.annotation.NonNull;
+
+import java.io.Serializable;
+import java.util.Arrays;
+import java.util.Collection;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.Set;
+
+/**
+ * Naive (not optimized) implementation of an Immutable Set
+ *
+ * @author F43nd1r
+ * @since 4.9.0
+ */
+public final class ImmutableSet<E> implements Set<E>, Serializable {
+
+    private final Set<E> mSet;
+
+    public ImmutableSet(E... elements) {
+        this(Arrays.asList(elements));
+    }
+
+    public ImmutableSet(Collection<E> collection) {
+        this.mSet = new HashSet<E>(collection);
+    }
+
+    @Override
+    public boolean add(E object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean addAll(@NonNull Collection<? extends E> collection) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public void clear() {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean contains(Object object) {
+        return mSet.contains(object);
+    }
+
+    @Override
+    public boolean containsAll(@NonNull Collection<?> collection) {
+        return mSet.containsAll(collection);
+    }
+
+    @Override
+    public boolean isEmpty() {
+        return mSet.isEmpty();
+    }
+
+    @NonNull
+    @Override
+    public Iterator<E> iterator() {
+        return new UnmodifiableIteratorWrapper<E>(mSet.iterator());
+    }
+
+    @Override
+    public boolean remove(Object object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean removeAll(@NonNull Collection<?> collection) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean retainAll(@NonNull Collection<?> collection) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public int size() {
+        return mSet.size();
+    }
+
+    @NonNull
+    @Override
+    public Object[] toArray() {
+        return mSet.toArray();
+    }
+
+    @NonNull
+    @Override
+    public <T> T[] toArray(@NonNull T[] array) {
+        //noinspection SuspiciousToArrayCall
+        return mSet.toArray(array);
+    }
+
+    public static final class Builder<E> {
+        private final Set<E> mSet;
+
+        public Builder() {
+            mSet = new HashSet<E>();
+        }
+
+        public void add(E element) {
+            mSet.add(element);
+        }
+
+        public ImmutableSet<E> build() {
+            return new ImmutableSet<E>(mSet);
+        }
+    }
+
+}
diff --git a/src/main/java/org/acra/collections/UnmodifiableIteratorWrapper.java b/src/main/java/org/acra/collections/UnmodifiableIteratorWrapper.java
new file mode 100644
index 00000000..c0308479
--- /dev/null
+++ b/src/main/java/org/acra/collections/UnmodifiableIteratorWrapper.java
@@ -0,0 +1,47 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.collections;
+
+import java.util.Iterator;
+
+/**
+ * Wrapper around an Iterator which prevents modifications
+ *
+ * @author F43nd1r
+ * @since 4.9.0
+ */
+class UnmodifiableIteratorWrapper<E> implements Iterator<E> {
+    private final Iterator<E> mIterator;
+
+    UnmodifiableIteratorWrapper(Iterator<E> mIterator) {
+        this.mIterator = mIterator;
+    }
+
+    @Override
+    public boolean hasNext() {
+        return mIterator.hasNext();
+    }
+
+    @Override
+    public E next() {
+        return mIterator.next();
+    }
+
+    @Override
+    public void remove() {
+        throw new UnsupportedOperationException();
+    }
+}
diff --git a/src/main/java/org/acra/collections/UnmodifiableListIteratorWrapper.java b/src/main/java/org/acra/collections/UnmodifiableListIteratorWrapper.java
new file mode 100644
index 00000000..97f0ab59
--- /dev/null
+++ b/src/main/java/org/acra/collections/UnmodifiableListIteratorWrapper.java
@@ -0,0 +1,78 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.collections;
+
+import java.util.ListIterator;
+
+/**
+ * Wrapper around a ListIterator which prevents modifications
+ *
+ * @author F43nd1r
+ * @since 4.9.0
+ */
+class UnmodifiableListIteratorWrapper<E> implements ListIterator<E> {
+    private final ListIterator<E> mIterator;
+
+    UnmodifiableListIteratorWrapper(ListIterator<E> mIterator) {
+        this.mIterator = mIterator;
+    }
+
+    @Override
+    public void add(E object) {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public boolean hasNext() {
+        return mIterator.hasNext();
+    }
+
+    @Override
+    public boolean hasPrevious() {
+        return mIterator.hasPrevious();
+    }
+
+    @Override
+    public E next() {
+        return mIterator.next();
+    }
+
+    @Override
+    public int nextIndex() {
+        return mIterator.nextIndex();
+    }
+
+    @Override
+    public E previous() {
+        return mIterator.previous();
+    }
+
+    @Override
+    public int previousIndex() {
+        return mIterator.previousIndex();
+    }
+
+    @Override
+    public void remove() {
+        throw new UnsupportedOperationException();
+    }
+
+    @Override
+    public void set(E object) {
+        throw new UnsupportedOperationException();
+    }
+}
+
diff --git a/src/main/java/org/acra/collector/CollectorUtil.java b/src/main/java/org/acra/collector/CollectorUtil.java
deleted file mode 100644
index fa0f8b5b..00000000
--- a/src/main/java/org/acra/collector/CollectorUtil.java
+++ /dev/null
@@ -1,22 +0,0 @@
-package org.acra.collector;
-
-import java.io.IOException;
-import java.io.Reader;
-
-public final class CollectorUtil {
-
-    /**
-     * Closes a Reader.
-     *
-     * @param reader    Reader to close. If reader is null then method just returns.
-     */
-    public static void safeClose(Reader reader) {
-    	if (reader == null) return;
-    	
-        try {
-            reader.close();
-        } catch (IOException e) {
-            // We made out best effort to release this resource. Nothing more we can do.
-        }
-    }
-}
diff --git a/src/main/java/org/acra/collector/Compatibility.java b/src/main/java/org/acra/collector/Compatibility.java
deleted file mode 100644
index 66d94a40..00000000
--- a/src/main/java/org/acra/collector/Compatibility.java
+++ /dev/null
@@ -1,78 +0,0 @@
-/*
- *  Copyright 2010 Emmanuel Astier & Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra.collector;
-
-import android.content.Context;
-import android.os.Build;
-
-import java.lang.reflect.Field;
-
-/**
- * Utility class containing methods enabling backward compatibility.
- * 
- * @author Normal
- * 
- */
-public final class Compatibility {
-
-    public class VERSION_CODES {
-        public final static int ECLAIR = 5;
-        public final static int FROYO = 8;
-        public final static int ICE_CREAM_SANDWICH = 14;
-        public final static int JELLY_BEAN = 16;
-        public final static int JELLY_BEAN_MR1 = 17;
-        public final static int LOLLIPOP = 21;
-    }
-
-    /**
-     * Retrieves Android SDK API level using the best possible method.
-     * 
-     * @return The Android SDK API int level.
-     */
-    public static int getAPILevel() {
-        int apiLevel;
-        try {
-            // This field has been added in Android 1.6
-            final Field SDK_INT = Build.VERSION.class.getField("SDK_INT");
-            apiLevel = SDK_INT.getInt(null);
-        } catch (SecurityException e) {
-            apiLevel = Integer.parseInt(Build.VERSION.SDK);
-        } catch (NoSuchFieldException e) {
-            apiLevel = Integer.parseInt(Build.VERSION.SDK);
-        } catch (IllegalArgumentException e) {
-            apiLevel = Integer.parseInt(Build.VERSION.SDK);
-        } catch (IllegalAccessException e) {
-            apiLevel = Integer.parseInt(Build.VERSION.SDK);
-        }
-
-        return apiLevel;
-    }
-
-    /**
-     * Retrieve the DropBoxManager service name using reflection API.
-     *
-     * @return Name of the DropBox service regardless of Android version.
-     * @throws NoSuchFieldException if the field DROPBOX_SERVICE doesn't exist.
-     * @throws IllegalAccessException if the DROPBOX_SERVICE field is inaccessible.
-     */
-    public static String getDropBoxServiceName() throws NoSuchFieldException, IllegalAccessException {
-        final Field serviceName = Context.class.getField("DROPBOX_SERVICE");
-        if (serviceName != null) {
-            return (String) serviceName.get(null);
-        }
-        return null;
-    }
-}
diff --git a/src/main/java/org/acra/collector/ConfigurationCollector.java b/src/main/java/org/acra/collector/ConfigurationCollector.java
index 07d03f65..60f73126 100644
--- a/src/main/java/org/acra/collector/ConfigurationCollector.java
+++ b/src/main/java/org/acra/collector/ConfigurationCollector.java
@@ -15,17 +15,19 @@
  */
 package org.acra.collector;
 
-import static org.acra.ACRA.LOG_TAG;
+import android.content.Context;
+import android.content.res.Configuration;
+import android.support.annotation.NonNull;
+import android.util.SparseArray;
+
+import org.acra.ACRA;
 
 import java.lang.reflect.Field;
 import java.lang.reflect.Modifier;
 import java.util.HashMap;
+import java.util.Map;
 
-import org.acra.ACRA;
-
-import android.content.Context;
-import android.content.res.Configuration;
-import android.util.SparseArray;
+import static org.acra.ACRA.LOG_TAG;
 
 /**
  * Inspects a {@link Configuration} object through reflection API in order to
@@ -55,7 +57,7 @@
     private static final String PREFIX_KEYBOARD = "KEYBOARD_";
     private static final String PREFIX_HARDKEYBOARDHIDDEN = "HARDKEYBOARDHIDDEN_";
 
-    private final HashMap<String, SparseArray<String>> mValueArrays = new HashMap<String, SparseArray<String>>();
+    private final Map<String, SparseArray<String>> mValueArrays = new HashMap<String, SparseArray<String>>();
 
     private ConfigurationCollector() {
 
@@ -92,9 +94,9 @@ private ConfigurationCollector() {
                     } else if (fieldName.startsWith(PREFIX_UI_MODE)) {
                         uiModeValues.put(f.getInt(null), fieldName);
                     }
-                } catch (IllegalArgumentException e) {
+                } catch (@NonNull IllegalArgumentException e) {
                     ACRA.log.w(LOG_TAG, "Error while inspecting device configuration: ", e);
-                } catch (IllegalAccessException e) {
+                } catch (@NonNull IllegalAccessException e) {
                     ACRA.log.w(LOG_TAG, "Error while inspecting device configuration: ", e);
                 }
             }
@@ -120,7 +122,8 @@ private ConfigurationCollector() {
      * @return A String describing all the fields of the given Configuration,
      *         with values replaced by constant names.
      */
-    private String toString(Configuration conf) {
+    @NonNull
+    private String toString(@NonNull Configuration conf) {
         final StringBuilder result = new StringBuilder();
         for (final Field f : conf.getClass().getFields()) {
             try {
@@ -134,9 +137,9 @@ private String toString(Configuration conf) {
                     }
                     result.append('\n');
                 }
-            } catch (IllegalArgumentException e) {
+            } catch (@NonNull IllegalArgumentException e) {
                 ACRA.log.e(LOG_TAG, "Error while inspecting device configuration: ", e);
-            } catch (IllegalAccessException e) {
+            } catch (@NonNull IllegalAccessException e) {
                 ACRA.log.e(LOG_TAG, "Error while inspecting device configuration: ", e);
             }
         }
@@ -158,7 +161,7 @@ private String toString(Configuration conf) {
      *         constant name.
      * @throws IllegalAccessException if the supplied field is inaccessible.
      */
-    private String getFieldValueName(Configuration conf, Field f) throws IllegalAccessException {
+    private String getFieldValueName(@NonNull Configuration conf, @NonNull Field f) throws IllegalAccessException {
         final String fieldName = f.getName();
         if (fieldName.equals(FIELD_MCC) || fieldName.equals(FIELD_MNC)) {
             return Integer.toString(f.getInt(conf));
@@ -195,7 +198,8 @@ private String getFieldValueName(Configuration conf, Field f) throws IllegalAcce
      * @return The names of the different values contained in the bitfield,
      *         separated by '+'.
      */
-    private static String activeFlags(SparseArray<String> valueNames, int bitfield) {
+    @NonNull
+    private static String activeFlags(@NonNull SparseArray<String> valueNames, int bitfield) {
         final StringBuilder result = new StringBuilder();
 
         // Look for masks, apply it an retrieve the masked value
@@ -220,7 +224,8 @@ private static String activeFlags(SparseArray<String> valueNames, int bitfield)
      * @param context   Context for the application being reported.
      * @return A String representation of the current configuration for the application.
      */
-    public static String collectConfiguration(Context context) {
+    @NonNull
+    public static String collectConfiguration(@NonNull Context context) {
         try {
             final ConfigurationCollector collector = new ConfigurationCollector();
             final Configuration crashConf = context.getResources().getConfiguration();
diff --git a/src/main/java/org/acra/collector/CrashReportData.java b/src/main/java/org/acra/collector/CrashReportData.java
index 60aae535..3564932e 100644
--- a/src/main/java/org/acra/collector/CrashReportData.java
+++ b/src/main/java/org/acra/collector/CrashReportData.java
@@ -16,20 +16,22 @@
 
 package org.acra.collector;
 
-import java.util.EnumMap;
-import java.util.Properties;
+import android.support.annotation.NonNull;
 
 import org.acra.ReportField;
 import org.acra.util.JSONReportBuilder;
 import org.acra.util.JSONReportBuilder.JSONReportException;
 import org.json.JSONObject;
 
+import java.util.EnumMap;
+import java.util.Properties;
+
 /**
  * Stores a crash reports data with {@link org.acra.ReportField} enum values as keys.
+ *
  * This is basically the source of {@link Properties} adapted to extend an
  * EnumMap instead of Hashtable and with a few tweaks to avoid losing crazy
- * amounts of android time in the generation of a date comment when storing to
- * file.
+ * amounts of android time in the generation of a date comment when storing to file.
  */
 public final class CrashReportData extends EnumMap<ReportField, String> {
 
@@ -48,10 +50,11 @@ public CrashReportData() {
      * @param key the name of the property to find.
      * @return the named property value, or {@code null} if it can't be found.
      */
-    public String getProperty(ReportField key) {
+    public String getProperty(@NonNull ReportField key) {
         return super.get(key);
     }
 
+    @NonNull
     public JSONObject toJSON() throws JSONReportException {
         return JSONReportBuilder.buildJSONReport(this);
     }
diff --git a/src/main/java/org/acra/collector/CrashReportDataFactory.java b/src/main/java/org/acra/collector/CrashReportDataFactory.java
index bc3d3c25..f52f4465 100644
--- a/src/main/java/org/acra/collector/CrashReportDataFactory.java
+++ b/src/main/java/org/acra/collector/CrashReportDataFactory.java
@@ -20,10 +20,16 @@
 import android.content.Context;
 import android.content.SharedPreferences;
 import android.content.pm.PackageInfo;
+import android.os.Build;
 import android.os.Environment;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
 import android.text.TextUtils;
+
 import org.acra.ACRA;
 import org.acra.ReportField;
+import org.acra.builder.ReportBuilder;
+import org.acra.config.ACRAConfiguration;
 import org.acra.util.Installation;
 import org.acra.util.PackageManagerWrapper;
 import org.acra.util.ReportUtils;
@@ -36,12 +42,48 @@
 import java.util.GregorianCalendar;
 import java.util.HashMap;
 import java.util.LinkedHashMap;
-import java.util.List;
 import java.util.Map;
+import java.util.Set;
 import java.util.UUID;
 
 import static org.acra.ACRA.LOG_TAG;
-import static org.acra.ReportField.*;
+import static org.acra.ReportField.ANDROID_VERSION;
+import static org.acra.ReportField.APPLICATION_LOG;
+import static org.acra.ReportField.APP_VERSION_CODE;
+import static org.acra.ReportField.APP_VERSION_NAME;
+import static org.acra.ReportField.AVAILABLE_MEM_SIZE;
+import static org.acra.ReportField.BRAND;
+import static org.acra.ReportField.BUILD;
+import static org.acra.ReportField.BUILD_CONFIG;
+import static org.acra.ReportField.CRASH_CONFIGURATION;
+import static org.acra.ReportField.CUSTOM_DATA;
+import static org.acra.ReportField.DEVICE_FEATURES;
+import static org.acra.ReportField.DEVICE_ID;
+import static org.acra.ReportField.DISPLAY;
+import static org.acra.ReportField.DROPBOX;
+import static org.acra.ReportField.DUMPSYS_MEMINFO;
+import static org.acra.ReportField.ENVIRONMENT;
+import static org.acra.ReportField.EVENTSLOG;
+import static org.acra.ReportField.FILE_PATH;
+import static org.acra.ReportField.INITIAL_CONFIGURATION;
+import static org.acra.ReportField.INSTALLATION_ID;
+import static org.acra.ReportField.IS_SILENT;
+import static org.acra.ReportField.LOGCAT;
+import static org.acra.ReportField.MEDIA_CODEC_LIST;
+import static org.acra.ReportField.PACKAGE_NAME;
+import static org.acra.ReportField.PHONE_MODEL;
+import static org.acra.ReportField.PRODUCT;
+import static org.acra.ReportField.RADIOLOG;
+import static org.acra.ReportField.SETTINGS_GLOBAL;
+import static org.acra.ReportField.SETTINGS_SECURE;
+import static org.acra.ReportField.SETTINGS_SYSTEM;
+import static org.acra.ReportField.SHARED_PREFERENCES;
+import static org.acra.ReportField.STACK_TRACE;
+import static org.acra.ReportField.STACK_TRACE_HASH;
+import static org.acra.ReportField.THREAD_DETAILS;
+import static org.acra.ReportField.TOTAL_MEM_SIZE;
+import static org.acra.ReportField.USER_EMAIL;
+import static org.acra.ReportField.USER_IP;
 
 /**
  * Responsible for creating the CrashReportData for an Exception.
@@ -55,14 +97,17 @@
 public final class CrashReportDataFactory {
 
     private final Context context;
+    private final ACRAConfiguration config;
     private final SharedPreferences prefs;
     private final Map<String, String> customParameters = new LinkedHashMap<String, String>();
     private final Calendar appStartDate;
     private final String initialConfiguration;
 
-    public CrashReportDataFactory(Context context, SharedPreferences prefs, Calendar appStartDate,
-                                  String initialConfiguration) {
+    public CrashReportDataFactory(@NonNull Context context, @NonNull ACRAConfiguration config,
+                                  @NonNull SharedPreferences prefs, @NonNull Calendar appStartDate,
+                                  @Nullable String initialConfiguration) {
         this.context = context;
+        this.config = config;
         this.prefs = prefs;
         this.appStartDate = appStartDate;
         this.initialConfiguration = initialConfiguration;
@@ -78,24 +123,21 @@ public CrashReportDataFactory(Context context, SharedPreferences prefs, Calendar
      * containing one 'key = value' pair on each line.
      * </p>
      *
-     * @param key
-     *            A key for your custom data.
-     * @param value
-     *            The value associated to your key.
+     * @param key   A key for your custom data.
+     * @param value The value associated to your key.
      * @return The previous value for this key if there was one, or null.
      */
-    public String putCustomData(String key, String value) {
+    public String putCustomData(@NonNull String key, String value) {
         return customParameters.put(key, value);
     }
 
     /**
      * Removes a key/value pair from the custom data field.
      *
-     * @param key
-     *            The key of the data to be removed.
+     * @param key The key of the data to be removed.
      * @return The value for this key before removal.
      */
-    public String removeCustomData(String key) {
+    public String removeCustomData(@NonNull String key) {
         return customParameters.remove(key);
     }
 
@@ -109,33 +151,24 @@ public void clearCustomData() {
     /**
      * Gets the current value for a key in the custom data field.
      *
-     * @param key
-     *            The key of the data to be retrieved.
+     * @param key The key of the data to be retrieved.
      * @return The value for this key.
      */
-    public String getCustomData(String key) {
+    public String getCustomData(@NonNull String key) {
         return customParameters.get(key);
     }
 
     /**
      * Collects crash data.
      *
-     * @param msg
-     *            A message to be associated with the crash report.
-     * @param th
-     *            Throwable that caused the crash.
-     * @param customData
-     *            Custom key/value pairs to be associated with the crash report.
-     * @param isSilentReport
-     *            Whether to report this report as being sent silently.
-     * @param brokenThread  Thread on which the error occurred.
-     * @return CrashReportData representing the current state of the application
-     *         at the instant of the Exception.
+     * @param builder ReportBuilder for whom to crete the crash report.
+     * @return CrashReportData identifying the current crash.
      */
-    public CrashReportData createCrashData(String msg, Throwable th, Map<String, String> customData, boolean isSilentReport, Thread brokenThread) {
+    @NonNull
+    public CrashReportData createCrashData(@NonNull ReportBuilder builder) {
         final CrashReportData crashReportData = new CrashReportData();
         try {
-            final List<ReportField> crashReportFields = ACRA.getConfig().getReportFields();
+            final Set<ReportField> crashReportFields = config.getReportFields();
 
             // Make every entry here bullet proof and move any slightly dodgy
             // ones to the end.
@@ -143,44 +176,95 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             // something crashes the collection process.
 
             try {
-                crashReportData.put(STACK_TRACE, getStackTrace(msg, th));
-            } catch (RuntimeException e){
+                crashReportData.put(STACK_TRACE, getStackTrace(builder.getMessage(), builder.getException()));
+            } catch (RuntimeException e) {
                 ACRA.log.e(LOG_TAG, "Error while retrieving STACK_TRACE data", e);
             }
 
+            // Collect DropBox and logcat. This is done first because some ROMs spam the log with every get on
+            // Settings.
+            final PackageManagerWrapper pm = new PackageManagerWrapper(context);
+
+            // Before JellyBean, this required the READ_LOGS permission
+            // Since JellyBean, READ_LOGS is not granted to third-party apps anymore for security reasons.
+            // Though, we can call logcat without any permission and still get traces related to our app.
+            final boolean hasReadLogsPermission = pm.hasPermission(Manifest.permission.READ_LOGS) || Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN;
+            if (prefs.getBoolean(ACRA.PREF_ENABLE_SYSTEM_LOGS, true) && hasReadLogsPermission) {
+                if (ACRA.DEV_LOGGING)
+                    ACRA.log.d(LOG_TAG, "READ_LOGS granted! ACRA can include LogCat and DropBox data.");
+                final LogCatCollector logCatCollector = new LogCatCollector();
+                if (crashReportFields.contains(LOGCAT)) {
+                    try {
+                        crashReportData.put(LOGCAT, logCatCollector.collectLogCat(config, null));
+                    } catch (RuntimeException e) {
+                        ACRA.log.e(LOG_TAG, "Error while retrieving LOGCAT data", e);
+                    }
+                }
+                if (crashReportFields.contains(EVENTSLOG)) {
+                    try {
+                        crashReportData.put(EVENTSLOG, logCatCollector.collectLogCat(config, "events"));
+                    } catch (RuntimeException e) {
+                        ACRA.log.e(LOG_TAG, "Error while retrieving EVENTSLOG data", e);
+                    }
+                }
+                if (crashReportFields.contains(RADIOLOG)) {
+                    try {
+                        crashReportData.put(RADIOLOG, logCatCollector.collectLogCat(config, "radio"));
+                    } catch (RuntimeException e) {
+                        ACRA.log.e(LOG_TAG, "Error while retrieving RADIOLOG data", e);
+                    }
+                }
+                if (crashReportFields.contains(DROPBOX)) {
+                    try {
+                        crashReportData.put(DROPBOX, new DropBoxCollector().read(context, config));
+                    } catch (RuntimeException e) {
+                        ACRA.log.e(LOG_TAG, "Error while retrieving DROPBOX data", e);
+                    }
+                }
+            } else {
+                if (ACRA.DEV_LOGGING)
+                    ACRA.log.d(LOG_TAG, "READ_LOGS not allowed. ACRA will not include LogCat and DropBox data.");
+            }
+
             try {
                 crashReportData.put(ReportField.USER_APP_START_DATE, ReportUtils.getTimeString(appStartDate));
-            } catch (RuntimeException e){
+            } catch (RuntimeException e) {
                 ACRA.log.e(LOG_TAG, "Error while retrieving USER_APP_START_DATE data", e);
             }
 
-            if (isSilentReport) {
+            if (builder.isSendSilently()) {
                 crashReportData.put(IS_SILENT, "true");
             }
 
+            // Always generate report uuid
+            try {
+                crashReportData.put(ReportField.REPORT_ID, UUID.randomUUID().toString());
+            } catch (RuntimeException e) {
+                ACRA.log.e(LOG_TAG, "Error while retrieving REPORT_ID data", e);
+            }
+
+            // Always generate crash time
+            try {
+                final Calendar curDate = new GregorianCalendar();
+                crashReportData.put(ReportField.USER_CRASH_DATE, ReportUtils.getTimeString(curDate));
+            } catch (RuntimeException e) {
+                ACRA.log.e(LOG_TAG, "Error while retrieving USER_CRASH_DATE data", e);
+            }
+
             // StackTrace hash
             if (crashReportFields.contains(STACK_TRACE_HASH)) {
                 try {
-                    crashReportData.put(ReportField.STACK_TRACE_HASH, getStackTraceHash(th));
-                } catch (RuntimeException e){
+                    crashReportData.put(ReportField.STACK_TRACE_HASH, getStackTraceHash(builder.getException()));
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving STACK_TRACE_HASH data", e);
                 }
             }
 
-            // Generate report uuid
-            if (crashReportFields.contains(REPORT_ID)) {
-                try {
-                    crashReportData.put(ReportField.REPORT_ID, UUID.randomUUID().toString());
-                } catch (RuntimeException e){
-                    ACRA.log.e(LOG_TAG, "Error while retrieving REPORT_ID data", e);
-                }
-            }
-
             // Installation unique ID
             if (crashReportFields.contains(INSTALLATION_ID)) {
                 try {
                     crashReportData.put(INSTALLATION_ID, Installation.id(context));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving INSTALLATION_ID data", e);
                 }
             }
@@ -189,23 +273,23 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(INITIAL_CONFIGURATION)) {
                 try {
                     crashReportData.put(INITIAL_CONFIGURATION, initialConfiguration);
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving INITIAL_CONFIGURATION data", e);
                 }
             }
             if (crashReportFields.contains(CRASH_CONFIGURATION)) {
                 try {
                     crashReportData.put(CRASH_CONFIGURATION, ConfigurationCollector.collectConfiguration(context));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving CRASH_CONFIGURATION data", e);
                 }
             }
 
             // Collect meminfo
-            if (!(th instanceof OutOfMemoryError) && crashReportFields.contains(DUMPSYS_MEMINFO)) {
+            if (!(builder.getException() instanceof OutOfMemoryError) && crashReportFields.contains(DUMPSYS_MEMINFO)) {
                 try {
                     crashReportData.put(DUMPSYS_MEMINFO, DumpSysCollector.collectMemInfo());
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving DUMPSYS_MEMINFO data", e);
                 }
             }
@@ -214,7 +298,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(PACKAGE_NAME)) {
                 try {
                     crashReportData.put(PACKAGE_NAME, context.getPackageName());
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving PACKAGE_NAME data", e);
                 }
             }
@@ -223,7 +307,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(BUILD)) {
                 try {
                     crashReportData.put(BUILD, ReflectionCollector.collectConstants(android.os.Build.class) + ReflectionCollector.collectConstants(android.os.Build.VERSION.class, "VERSION"));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving BUILD data", e);
                 }
             }
@@ -232,7 +316,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(PHONE_MODEL)) {
                 try {
                     crashReportData.put(PHONE_MODEL, android.os.Build.MODEL);
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving PHONE_MODEL data", e);
                 }
             }
@@ -240,7 +324,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(ANDROID_VERSION)) {
                 try {
                     crashReportData.put(ANDROID_VERSION, android.os.Build.VERSION.RELEASE);
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving ANDROID_VERSION data", e);
                 }
             }
@@ -249,14 +333,14 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(BRAND)) {
                 try {
                     crashReportData.put(BRAND, android.os.Build.BRAND);
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving BRAND data", e);
                 }
             }
             if (crashReportFields.contains(PRODUCT)) {
                 try {
                     crashReportData.put(PRODUCT, android.os.Build.PRODUCT);
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving PRODUCT data", e);
                 }
             }
@@ -265,14 +349,14 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(TOTAL_MEM_SIZE)) {
                 try {
                     crashReportData.put(TOTAL_MEM_SIZE, Long.toString(ReportUtils.getTotalInternalMemorySize()));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving TOTAL_MEM_SIZE data", e);
                 }
             }
             if (crashReportFields.contains(AVAILABLE_MEM_SIZE)) {
                 try {
                     crashReportData.put(AVAILABLE_MEM_SIZE, Long.toString(ReportUtils.getAvailableInternalMemorySize()));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving AVAILABLE_MEM_SIZE data", e);
                 }
             }
@@ -281,7 +365,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(FILE_PATH)) {
                 try {
                     crashReportData.put(FILE_PATH, ReportUtils.getApplicationFilePath(context));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving FILE_PATH data", e);
                 }
             }
@@ -290,26 +374,16 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(DISPLAY)) {
                 try {
                     crashReportData.put(DISPLAY, DisplayManagerCollector.collectDisplays(context));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving DISPLAY data", e);
                 }
             }
 
-            // User crash date with local timezone
-            if (crashReportFields.contains(USER_CRASH_DATE)) {
-                try {
-                    final Calendar curDate = new GregorianCalendar();
-                    crashReportData.put(USER_CRASH_DATE, ReportUtils.getTimeString(curDate));
-                } catch (RuntimeException e){
-                    ACRA.log.e(LOG_TAG, "Error while retrieving USER_CRASH_DATE data", e);
-                }
-            }
-
             // Add custom info, they are all stored in a single field
             if (crashReportFields.contains(CUSTOM_DATA)) {
                 try {
-                    crashReportData.put(CUSTOM_DATA, createCustomInfoString(customData));
-                } catch (RuntimeException e){
+                    crashReportData.put(CUSTOM_DATA, createCustomInfoString(builder.getCustomData()));
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving CUSTOM_DATA data", e);
                 }
             }
@@ -318,9 +392,9 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
                 try {
                     final Class buildConfigClass = getBuildConfigClass();
                     crashReportData.put(BUILD_CONFIG, ReflectionCollector.collectConstants(buildConfigClass));
-                } catch (ClassNotFoundException e) {
+                } catch (ClassNotFoundException ignored) {
                     // We have already logged this when we had the name of the class that wasn't found.
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving BUILD_CONFIG data", e);
                 }
             }
@@ -329,7 +403,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(USER_EMAIL)) {
                 try {
                     crashReportData.put(USER_EMAIL, prefs.getString(ACRA.PREF_USER_EMAIL_ADDRESS, "N/A"));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving USER_EMAIL data", e);
                 }
             }
@@ -338,7 +412,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(DEVICE_FEATURES)) {
                 try {
                     crashReportData.put(DEVICE_FEATURES, DeviceFeaturesCollector.getFeatures(context));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving DEVICE_FEATURES data", e);
                 }
             }
@@ -347,16 +421,17 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(ENVIRONMENT)) {
                 try {
                     crashReportData.put(ENVIRONMENT, ReflectionCollector.collectStaticGettersResults(Environment.class));
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving ENVIRONMENT data", e);
                 }
             }
 
+            final SettingsCollector settingsCollector = new SettingsCollector(context, config);
             // System settings
             if (crashReportFields.contains(SETTINGS_SYSTEM)) {
                 try {
-                    crashReportData.put(SETTINGS_SYSTEM, SettingsCollector.collectSystemSettings(context));
-                } catch (RuntimeException e){
+                    crashReportData.put(SETTINGS_SYSTEM, settingsCollector.collectSystemSettings());
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving SETTINGS_SYSTEM data", e);
                 }
             }
@@ -364,8 +439,8 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             // Secure settings
             if (crashReportFields.contains(SETTINGS_SECURE)) {
                 try {
-                    crashReportData.put(SETTINGS_SECURE, SettingsCollector.collectSecureSettings(context));
-                } catch (RuntimeException e){
+                    crashReportData.put(SETTINGS_SECURE, settingsCollector.collectSecureSettings());
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving SETTINGS_SECURE data", e);
                 }
             }
@@ -374,8 +449,8 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(SETTINGS_GLOBAL)) {
                 try {
 
-                    crashReportData.put(SETTINGS_GLOBAL, SettingsCollector.collectGlobalSettings(context));
-                } catch (RuntimeException e){
+                    crashReportData.put(SETTINGS_GLOBAL, settingsCollector.collectGlobalSettings());
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving SETTINGS_GLOBAL data", e);
                 }
             }
@@ -383,16 +458,14 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             // SharedPreferences
             if (crashReportFields.contains(SHARED_PREFERENCES)) {
                 try {
-                    crashReportData.put(SHARED_PREFERENCES, SharedPreferencesCollector.collect(context));
-                } catch (RuntimeException e){
+                    crashReportData.put(SHARED_PREFERENCES, new SharedPreferencesCollector(context, config).collect());
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving SHARED_PREFERENCES data", e);
                 }
             }
 
-            // Now get all the crash data that relies on the PackageManager
+            // Now get all the crash data that relies on the PackageManager.getPackageInfo()
             // (which may or may not be here).
-            final PackageManagerWrapper pm = new PackageManagerWrapper(context);
-
             try {
                 final PackageInfo pi = pm.getPackageInfo();
                 if (pi != null) {
@@ -407,73 +480,31 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
                     // Could not retrieve package info...
                     crashReportData.put(APP_VERSION_NAME, "Package info unavailable");
                 }
-            } catch (RuntimeException e){
+            } catch (RuntimeException e) {
                 ACRA.log.e(LOG_TAG, "Error while retrieving APP_VERSION_CODE and APP_VERSION_NAME data", e);
             }
 
             // Retrieve UDID(IMEI) if permission is available
             if (crashReportFields.contains(DEVICE_ID) && prefs.getBoolean(ACRA.PREF_ENABLE_DEVICE_ID, true)
-                && pm.hasPermission(Manifest.permission.READ_PHONE_STATE)) {
+                    && pm.hasPermission(Manifest.permission.READ_PHONE_STATE)) {
                 try {
                     final String deviceId = ReportUtils.getDeviceId(context);
                     if (deviceId != null) {
                         crashReportData.put(DEVICE_ID, deviceId);
                     }
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving DEVICE_ID data", e);
                 }
             }
 
-            // Collect DropBox and logcat
-            // Before JellyBean, this required the READ_LOGS permission
-            // Since JellyBean, READ_LOGS is not granted to third-party apps anymore for security reasons.
-            // Though, we can call logcat without any permission and still get traces related to our app.
-            final boolean hasReadLogsPermission = pm.hasPermission(Manifest.permission.READ_LOGS) || (Compatibility.getAPILevel() >= Compatibility.VERSION_CODES.JELLY_BEAN);
-            if (prefs.getBoolean(ACRA.PREF_ENABLE_SYSTEM_LOGS, true) && hasReadLogsPermission) {
-                ACRA.log.i(LOG_TAG, "READ_LOGS granted! ACRA can include LogCat and DropBox data.");
-                if (crashReportFields.contains(LOGCAT)) {
-                    try {
-                        crashReportData.put(LOGCAT, LogCatCollector.collectLogCat(null));
-                    } catch (RuntimeException e){
-                        ACRA.log.e(LOG_TAG, "Error while retrieving LOGCAT data", e);
-                    }
-                }
-                if (crashReportFields.contains(EVENTSLOG)) {
-                    try {
-                        crashReportData.put(EVENTSLOG, LogCatCollector.collectLogCat("events"));
-                    } catch (RuntimeException e){
-                        ACRA.log.e(LOG_TAG, "Error while retrieving EVENTSLOG data", e);
-                    }
-                }
-                if (crashReportFields.contains(RADIOLOG)) {
-                    try {
-                        crashReportData.put(RADIOLOG, LogCatCollector.collectLogCat("radio"));
-                    } catch (RuntimeException e){
-                        ACRA.log.e(LOG_TAG, "Error while retrieving RADIOLOG data", e);
-                    }
-                }
-                if (crashReportFields.contains(DROPBOX)) {
-                    try {
-                        crashReportData.put(DROPBOX,
-                                            DropBoxCollector.read(context, ACRA.getConfig().additionalDropBoxTags()));
-                    } catch (RuntimeException e){
-                        ACRA.log.e(LOG_TAG, "Error while retrieving DROPBOX data", e);
-                    }
-                }
-            } else {
-                ACRA.log.i(LOG_TAG, "READ_LOGS not allowed. ACRA will not include LogCat and DropBox data.");
-            }
-
             // Application specific log file
             if (crashReportFields.contains(APPLICATION_LOG)) {
                 try {
-                    final String logFile = LogFileCollector.collectLogFile(context,
-                                                                           ACRA.getConfig().applicationLogFile(),
-                                                                           ACRA.getConfig().applicationLogFileLines());
+                    final String logFile = new LogFileCollector().collectLogFile(context, config.applicationLogFile(), config.applicationLogFileLines());
                     crashReportData.put(APPLICATION_LOG, logFile);
                 } catch (IOException e) {
-                    ACRA.log.e(LOG_TAG, "Error while reading application log file " + ACRA.getConfig().applicationLogFile(), e);
-                } catch (RuntimeException e){
+                    ACRA.log.e(LOG_TAG, "Error while reading application log file " + config.applicationLogFile(), e);
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving APPLICATION_LOG data", e);
 
                 }
@@ -482,8 +513,8 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             // Media Codecs list
             if (crashReportFields.contains(MEDIA_CODEC_LIST)) {
                 try {
-                    crashReportData.put(MEDIA_CODEC_LIST, MediaCodecListCollector.collecMediaCodecList());
-                } catch (RuntimeException e){
+                    crashReportData.put(MEDIA_CODEC_LIST, MediaCodecListCollector.collectMediaCodecList());
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving MEDIA_CODEC_LIST data", e);
                 }
             }
@@ -491,8 +522,8 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             // Failing thread details
             if (crashReportFields.contains(THREAD_DETAILS)) {
                 try {
-                    crashReportData.put(THREAD_DETAILS, ThreadCollector.collect(brokenThread));
-                } catch (RuntimeException e){
+                    crashReportData.put(THREAD_DETAILS, ThreadCollector.collect(builder.getUncaughtExceptionThread()));
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving THREAD_DETAILS data", e);
                 }
             }
@@ -501,7 +532,7 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
             if (crashReportFields.contains(USER_IP)) {
                 try {
                     crashReportData.put(USER_IP, ReportUtils.getLocalIpAddress());
-                } catch (RuntimeException e){
+                } catch (RuntimeException e) {
                     ACRA.log.e(LOG_TAG, "Error while retrieving USER_IP data", e);
                 }
             }
@@ -519,7 +550,8 @@ public CrashReportData createCrashData(String msg, Throwable th, Map<String, Str
      *
      * @return A string with a 'key = value' pair on each line.
      */
-    private String createCustomInfoString(Map<String, String> reportCustomData) {
+    @NonNull
+    private String createCustomInfoString(@Nullable Map<String, String> reportCustomData) {
         Map<String, String> params = customParameters;
 
         if (reportCustomData != null) {
@@ -528,27 +560,31 @@ private String createCustomInfoString(Map<String, String> reportCustomData) {
         }
 
         final StringBuilder customInfo = new StringBuilder();
-        for (final String currentKey : params.keySet()) {
-            String currentVal = params.get(currentKey);
-            customInfo.append(currentKey);
+        for (final Map.Entry<String, String> currentEntry : params.entrySet()) {
+            customInfo.append(currentEntry.getKey());
             customInfo.append(" = ");
+
             // We need to escape new lines in values or they are transformed into new
             // custom fields. => let's replace all '\n' with "\\n"
-            if(currentVal != null) {
-                currentVal = currentVal.replaceAll("\n", "\\\\n");
+            final String currentVal = currentEntry.getValue();
+            if (currentVal != null) {
+                customInfo.append(currentVal.replaceAll("\n", "\\\\n"));
+            } else {
+                customInfo.append("null");
             }
-            customInfo.append(currentVal);
-            customInfo.append("\n");
+            customInfo.append('\n');
         }
         return customInfo.toString();
     }
 
-    private String getStackTrace(String msg, Throwable th) {
+    @NonNull
+    private String getStackTrace(@Nullable String msg, @Nullable Throwable th) {
         final Writer result = new StringWriter();
         final PrintWriter printWriter = new PrintWriter(result);
 
-        if (msg != null && !TextUtils.isEmpty(msg))
+        if (msg != null && !TextUtils.isEmpty(msg)) {
             printWriter.println(msg);
+        }
 
         // If the exception was thrown in a background thread inside
         // AsyncTask, then the actual exception can be found with getCause
@@ -563,7 +599,8 @@ private String getStackTrace(String msg, Throwable th) {
         return stacktraceAsString;
     }
 
-    private String getStackTraceHash(Throwable th) {
+    @NonNull
+    private String getStackTraceHash(@Nullable Throwable th) {
         final StringBuilder res = new StringBuilder();
         Throwable cause = th;
         while (cause != null) {
@@ -578,15 +615,16 @@ private String getStackTraceHash(Throwable th) {
         return Integer.toHexString(res.toString().hashCode());
     }
 
+    @NonNull
     private Class<?> getBuildConfigClass() throws ClassNotFoundException {
-        final Class configuredBuildConfig = ACRA.getConfig().buildConfigClass();
-        if ((configuredBuildConfig != null) && !configuredBuildConfig.equals(Object.class)) {
-            // If set via annotations or programatically then it will have a real value,
+        final Class configuredBuildConfig = config.buildConfigClass();
+        if (!configuredBuildConfig.equals(Object.class)) {
+            // If set via annotations or programmatically then it will have a real value,
             // otherwise it will be Object.class (annotation default) or null (explicit programmatic).
             return configuredBuildConfig;
         }
 
-        final String className = context.getClass().getPackage().getName() + ".BuildConfig";
+        final String className = context.getPackageName() + ".BuildConfig";
         try {
             return Class.forName(className);
         } catch (ClassNotFoundException e) {
diff --git a/src/main/java/org/acra/collector/DeviceFeaturesCollector.java b/src/main/java/org/acra/collector/DeviceFeaturesCollector.java
index f483d5ef..0eaaa72a 100644
--- a/src/main/java/org/acra/collector/DeviceFeaturesCollector.java
+++ b/src/main/java/org/acra/collector/DeviceFeaturesCollector.java
@@ -15,45 +15,38 @@
  */
 package org.acra.collector;
 
-import static org.acra.ACRA.LOG_TAG;
-
-import java.lang.reflect.Method;
-
 import android.content.Context;
+import android.content.pm.FeatureInfo;
 import android.content.pm.PackageManager;
-
+import android.support.annotation.NonNull;
 import org.acra.ACRA;
 
+import static org.acra.ACRA.LOG_TAG;
+
 /**
- * Features declared as available on the device. Available only with API level > 5.
+ * Features declared as available on the device.
  * 
  * @author Kevin Gaudin
  * 
  */
 final class DeviceFeaturesCollector {
+    private DeviceFeaturesCollector(){}
 
-    public static String getFeatures(Context ctx) {
-
-        if (Compatibility.getAPILevel() < Compatibility.VERSION_CODES.ECLAIR) {
-            return "Data available only with API Level >= 5";
-        }
+    @NonNull
+    public static String getFeatures(@NonNull Context ctx) {
 
         final StringBuilder result = new StringBuilder();
         try {
             final PackageManager pm = ctx.getPackageManager();
-            final Method getSystemAvailableFeatures = PackageManager.class.getMethod("getSystemAvailableFeatures", (Class[]) null);
-            final Object[] features = (Object[]) getSystemAvailableFeatures.invoke(pm);
-            for (final Object feature : features) {
-                final String featureName = (String) feature.getClass().getField("name").get(feature);
+            final FeatureInfo[] features = pm.getSystemAvailableFeatures();
+            for (final FeatureInfo feature : features) {
+                final String featureName = feature.name;
                 if(featureName != null) {
                     result.append(featureName);
                 } else {
-                    final Method getGlEsVersion = feature.getClass().getMethod("getGlEsVersion", (Class[]) null);
-                    final String glEsVersion = (String) getGlEsVersion.invoke(feature);
-                    result.append("glEsVersion = ");
-                    result.append(glEsVersion);
+                    result.append("glEsVersion = ").append(feature.getGlEsVersion());
                 }
-                result.append("\n");
+                result.append('\n');
             }
         } catch (Throwable e) {
             ACRA.log.w(LOG_TAG, "Couldn't retrieve DeviceFeatures for " + ctx.getPackageName(), e);
diff --git a/src/main/java/org/acra/collector/DisplayManagerCollector.java b/src/main/java/org/acra/collector/DisplayManagerCollector.java
index d9593271..9184147f 100644
--- a/src/main/java/org/acra/collector/DisplayManagerCollector.java
+++ b/src/main/java/org/acra/collector/DisplayManagerCollector.java
@@ -1,59 +1,40 @@
 package org.acra.collector;
 
-import java.lang.reflect.Field;
-import java.lang.reflect.InvocationTargetException;
-import java.lang.reflect.Method;
-
-import org.acra.ACRA;
-
 import android.content.Context;
 import android.graphics.Point;
 import android.graphics.Rect;
+import android.hardware.display.DisplayManager;
+import android.os.Build;
+import android.support.annotation.NonNull;
 import android.util.DisplayMetrics;
 import android.util.SparseArray;
 import android.view.Display;
 import android.view.Surface;
 import android.view.WindowManager;
 
-import static org.acra.ACRA.LOG_TAG;
+import java.lang.reflect.Field;
 
 final class DisplayManagerCollector {
+    private DisplayManagerCollector(){}
 
-    final static SparseArray<String> mFlagsNames = new SparseArray<String>();
-    final static SparseArray<String> mDensities = new SparseArray<String>();
+    private static final SparseArray<String> mFlagsNames = new SparseArray<String>();
 
-    public static String collectDisplays(Context ctx) {
-        Display[] displays = null;
+    @NonNull
+    public static String collectDisplays(@NonNull Context ctx) {
+        final Display[] displays;
         final StringBuilder result = new StringBuilder();
 
-        if (Compatibility.getAPILevel() < Compatibility.VERSION_CODES.JELLY_BEAN_MR1) {
+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR1) {
             // Before Android 4.2, there was a single display available from the
             // window manager
-            final WindowManager windowManager = (WindowManager) ctx
-                    .getSystemService(android.content.Context.WINDOW_SERVICE);
+            final WindowManager windowManager = (WindowManager) ctx.getSystemService(Context.WINDOW_SERVICE);
             displays = new Display[1];
             displays[0] = windowManager.getDefaultDisplay();
         } else {
             // Since Android 4.2, we can fetch multiple displays with the
             // DisplayManager.
-            try {
-                Object displayManager = ctx.getSystemService((String) (ctx.getClass().getField("DISPLAY_SERVICE")
-                        .get(null)));
-                Method getDisplays = displayManager.getClass().getMethod("getDisplays");
-                displays = (Display[]) getDisplays.invoke(displayManager);
-            } catch (IllegalArgumentException e) {
-                ACRA.log.w(LOG_TAG, "Error while collecting DisplayManager data: ", e);
-            } catch (SecurityException e) {
-                ACRA.log.w(LOG_TAG, "Error while collecting DisplayManager data: ", e);
-            } catch (IllegalAccessException e) {
-                ACRA.log.w(LOG_TAG, "Error while collecting DisplayManager data: ", e);
-            } catch (NoSuchFieldException e) {
-                ACRA.log.w(LOG_TAG, "Error while collecting DisplayManager data: ", e);
-            } catch (NoSuchMethodException e) {
-                ACRA.log.w(LOG_TAG, "Error while collecting DisplayManager data: ", e);
-            } catch (InvocationTargetException e) {
-                ACRA.log.w(LOG_TAG, "Error while collecting DisplayManager data: ", e);
-            }
+            final DisplayManager displayManager = (DisplayManager) ctx.getSystemService(Context.DISPLAY_SERVICE);
+            displays = displayManager.getDisplays();
         }
 
         for (Display display : displays) {
@@ -63,223 +44,168 @@ public static String collectDisplays(Context ctx) {
         return result.toString();
     }
 
-    private static Object collectDisplayData(Display display) {
+    @NonNull
+    private static Object collectDisplayData(@NonNull Display display) {
         final DisplayMetrics metrics = new DisplayMetrics();
         display.getMetrics(metrics);
 
-        final StringBuilder result = new StringBuilder();
-
-        result.append(collectCurrentSizeRange(display));
-        result.append(collectFlags(display));
-        result.append(display.getDisplayId()).append(".height=").append(display.getHeight()).append('\n');
-        result.append(collectMetrics(display, "getMetrics"));
-        result.append(collectName(display));
-        result.append(display.getDisplayId()).append(".orientation=").append(display.getOrientation()).append('\n');
-        result.append(display.getDisplayId()).append(".pixelFormat=").append(display.getPixelFormat()).append('\n');
-        result.append(collectMetrics(display, "getRealMetrics"));
-        result.append(collectSize(display, "getRealSize"));
-        result.append(collectRectSize(display));
-        result.append(display.getDisplayId()).append(".refreshRate=").append(display.getRefreshRate()).append('\n');
-        result.append(collectRotation(display));
-        result.append(collectSize(display, "getSize"));
-        result.append(display.getDisplayId()).append(".width=").append(display.getWidth()).append('\n');
-        result.append(collectIsValid(display));
-
-        return result.toString();
+        //noinspection deprecation
+        return collectCurrentSizeRange(display) +
+                collectFlags(display) +
+                display.getDisplayId() + ".height=" + display.getHeight() + '\n' +
+                collectMetrics(display) +
+                collectName(display) +
+                display.getDisplayId() + ".orientation=" + display.getRotation() + '\n' +
+                display.getDisplayId() + ".pixelFormat=" + display.getPixelFormat() + '\n' +
+                collectRealMetrics(display) +
+                collectRealSize(display) +
+                collectRectSize(display) +
+                display.getDisplayId() + ".refreshRate=" + display.getRefreshRate() + '\n' +
+                collectRotation(display) +
+                collectSize(display) +
+                display.getDisplayId() + ".width=" + display.getWidth() + '\n' +
+                collectIsValid(display);
     }
 
-    private static Object collectIsValid(Display display) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method isValid = display.getClass().getMethod("isValid");
-            Boolean value = (Boolean) isValid.invoke(display);
-            result.append(display.getDisplayId()).append(".isValid=").append(value).append('\n');
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
+    @NonNull
+    private static String collectIsValid(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
+            return display.getDisplayId() + ".isValid=" + display.isValid() + '\n';
         }
-        return result.toString();
+        return "";
+    }
+
+    @NonNull
+    private static String collectRotation(@NonNull Display display) {
+        return display.getDisplayId() + ".rotation=" + rotationToString(display.getRotation()) + '\n';
     }
 
-    private static Object collectRotation(Display display) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method getRotation = display.getClass().getMethod("getRotation");
-            int rotation = (Integer) getRotation.invoke(display);
-            result.append(display.getDisplayId()).append(".rotation=");
-            switch (rotation) {
+    @NonNull
+    private static String rotationToString(int rotation) {
+        switch (rotation) {
             case Surface.ROTATION_0:
-                result.append("ROTATION_0");
-                break;
+                return "ROTATION_0";
             case Surface.ROTATION_90:
-                result.append("ROTATION_90");
-                break;
+                return "ROTATION_90";
             case Surface.ROTATION_180:
-                result.append("ROTATION_180");
-                break;
+                return "ROTATION_180";
             case Surface.ROTATION_270:
-                result.append("ROTATION_270");
-                break;
+                return "ROTATION_270";
             default:
-                result.append(rotation);
-                break;
-            }
-            result.append('\n');
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
+                return String.valueOf(rotation);
         }
-        return result.toString();
     }
 
-    private static Object collectRectSize(Display display) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method getRectSize = display.getClass().getMethod("getRectSize", Rect.class);
-            Rect size = new Rect();
-            getRectSize.invoke(display, size);
-            result.append(display.getDisplayId()).append(".rectSize=[").append(size.top).append(',').append(size.left)
-                    .append(',').append(size.width()).append(',').append(size.height()).append(']').append('\n');
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
+    @NonNull
+    private static String collectRectSize(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB_MR2) {
+            final Rect size = new Rect();
+            display.getRectSize(size);
+            return display.getDisplayId() + ".rectSize=[" + size.top + ',' + size.left +
+                    ',' + size.width() + ',' + size.height() + ']' + '\n';
         }
-        return result.toString();
+        return "";
     }
 
-    private static Object collectSize(Display display, String methodName) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method getRealSize = display.getClass().getMethod(methodName, Point.class);
-            Point size = new Point();
-            getRealSize.invoke(display, size);
-            result.append(display.getDisplayId()).append('.').append(methodName).append("=[").append(size.x)
-                    .append(',').append(size.y).append(']').append('\n');
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
+    @NonNull
+    private static String collectSize(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB_MR2) {
+            final Point size = new Point();
+            display.getSize(size);
+            return display.getDisplayId() + ".size=[" + size.x
+                    + ',' + size.y + ']' + '\n';
         }
-        return result.toString();
+        return "";
     }
 
-    private static String collectCurrentSizeRange(Display display) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method getCurrentSizeRange = display.getClass().getMethod("getCurrentSizeRange", Point.class, Point.class);
-            Point smallest = new Point(), largest = new Point();
-            getCurrentSizeRange.invoke(display, smallest, largest);
-            result.append(display.getDisplayId()).append(".currentSizeRange.smallest=[").append(smallest.x).append(',')
-                    .append(smallest.y).append(']').append('\n');
-            result.append(display.getDisplayId()).append(".currentSizeRange.largest=[").append(largest.x).append(',')
-                    .append(largest.y).append(']').append('\n');
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
+    private static String collectRealSize(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
+            final Point size = new Point();
+            display.getRealSize(size);
+            return display.getDisplayId() + ".realSize=[" + size.x
+                    + ',' + size.y + ']' + '\n';
         }
-        return result.toString();
+        return "";
     }
 
-    private static String collectFlags(Display display) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method getFlags = display.getClass().getMethod("getFlags");
-            int flags = (Integer) getFlags.invoke(display);
+    @NonNull
+    private static String collectCurrentSizeRange(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {
+            final Point smallest = new Point();
+            final Point largest = new Point();
+            display.getCurrentSizeRange(smallest, largest);
+            return display.getDisplayId() + ".currentSizeRange.smallest=[" + smallest.x + ',' + smallest.y + "]\n"
+                    + display.getDisplayId() + ".currentSizeRange.largest=[" + largest.x + ',' + largest.y + "]\n";
+        }
+        return "";
+    }
 
+    @NonNull
+    private static String collectFlags(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
+            final int flags = display.getFlags();
             for (Field field : display.getClass().getFields()) {
                 if (field.getName().startsWith("FLAG_")) {
-                    mFlagsNames.put(field.getInt(null), field.getName());
+                    try {
+                        mFlagsNames.put(field.getInt(null), field.getName());
+                    } catch (IllegalAccessException ignored) {
+                    }
                 }
             }
-
-            result.append(display.getDisplayId()).append(".flags=").append(activeFlags(mFlagsNames, flags))
-                    .append('\n');
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
+            return display.getDisplayId() + ".flags=" + activeFlags(mFlagsNames, flags) + '\n';
         }
-        return result.toString();
+        return "";
     }
 
-    private static String collectName(Display display) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method getName = display.getClass().getMethod("getName");
-            String name = (String) getName.invoke(display);
-
-            result.append(display.getDisplayId()).append(".name=").append(name).append('\n');
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
+    @NonNull
+    private static String collectName(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
+            return display.getDisplayId() + ".name=" + display.getName() + '\n';
         }
-        return result.toString();
+        return "";
     }
 
-    private static Object collectMetrics(Display display, String methodName) {
-        StringBuilder result = new StringBuilder();
-        try {
-            Method getMetrics = display.getClass().getMethod(methodName);
-            DisplayMetrics metrics = (DisplayMetrics) getMetrics.invoke(display);
-
-            for (Field field : DisplayMetrics.class.getFields()) {
-                if (field.getType().equals(Integer.class) && field.getName().startsWith("DENSITY_")
-                        && !field.getName().equals("DENSITY_DEFAULT")) {
-                    mDensities.put(field.getInt(null), field.getName());
-                }
-            }
-
-            result.append(display.getDisplayId()).append('.').append(methodName).append(".density=")
-                    .append(metrics.density).append('\n');
-            result.append(display.getDisplayId()).append('.').append(methodName).append(".densityDpi=")
-                    .append(metrics.getClass().getField("densityDpi")).append('\n');
-            result.append(display.getDisplayId()).append('.').append(methodName).append("scaledDensity=x")
-                    .append(metrics.scaledDensity).append('\n');
-            result.append(display.getDisplayId()).append('.').append(methodName).append(".widthPixels=")
-                    .append(metrics.widthPixels).append('\n');
-            result.append(display.getDisplayId()).append('.').append(methodName).append(".heightPixels=")
-                    .append(metrics.heightPixels).append('\n');
-            result.append(display.getDisplayId()).append('.').append(methodName).append(".xdpi=").append(metrics.xdpi)
-                    .append('\n');
-            result.append(display.getDisplayId()).append('.').append(methodName).append(".ydpi=").append(metrics.ydpi)
-                    .append('\n');
+    @NonNull
+    private static String collectMetrics(@NonNull Display display) {
+        final DisplayMetrics metrics = new DisplayMetrics();
+        display.getMetrics(metrics);
+        return collectMetrics(display.getDisplayId() + ".metrics", metrics);
+    }
 
-        } catch (SecurityException e) {
-        } catch (NoSuchMethodException e) {
-        } catch (IllegalArgumentException e) {
-        } catch (IllegalAccessException e) {
-        } catch (InvocationTargetException e) {
-        } catch (NoSuchFieldException e) {
+    @NonNull
+    private static String collectRealMetrics(@NonNull Display display) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
+            final DisplayMetrics metrics = new DisplayMetrics();
+            display.getRealMetrics(metrics);
+            return collectMetrics(display.getDisplayId() + ".realMetrics", metrics);
         }
-        return result.toString();
+        return "";
+    }
+
+    @NonNull
+    private static String collectMetrics(@NonNull String prefix, @NonNull DisplayMetrics metrics) {
+        return prefix + ".density=" + metrics.density + '\n'
+                + prefix + ".densityDpi=" + metrics.densityDpi + '\n'
+                + prefix + ".scaledDensity=x" + metrics.scaledDensity + '\n'
+                + prefix + ".widthPixels=" + metrics.widthPixels + '\n'
+                + prefix + ".heightPixels=" + metrics.heightPixels + '\n'
+                + prefix + ".xdpi=" + metrics.xdpi + '\n'
+                + prefix + ".ydpi=" + metrics.ydpi + '\n';
     }
 
     /**
      * Some fields contain multiple value types which can be isolated by
      * applying a bitmask. That method returns the concatenation of active
      * values.
-     * 
-     * @param valueNames
-     *            The array containing the different values and names for this
-     *            field. Must contain mask values too.
-     * @param bitfield
-     *            The bitfield to inspect.
+     *
+     * @param valueNames The array containing the different values and names for this
+     *                   field. Must contain mask values too.
+     * @param bitfield   The bitfield to inspect.
      * @return The names of the different values contained in the bitfield,
-     *         separated by '+'.
+     * separated by '+'.
      */
-    private static String activeFlags(SparseArray<String> valueNames, int bitfield) {
+    @NonNull
+    private static String activeFlags(@NonNull SparseArray<String> valueNames, int bitfield) {
         final StringBuilder result = new StringBuilder();
 
         // Look for masks, apply it an retrieve the masked value
diff --git a/src/main/java/org/acra/collector/DropBoxCollector.java b/src/main/java/org/acra/collector/DropBoxCollector.java
index a2673d12..d0f7b27d 100644
--- a/src/main/java/org/acra/collector/DropBoxCollector.java
+++ b/src/main/java/org/acra/collector/DropBoxCollector.java
@@ -15,16 +15,20 @@
  */
 package org.acra.collector;
 
-import java.lang.reflect.InvocationTargetException;
-import java.lang.reflect.Method;
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.List;
+import android.content.Context;
+import android.os.DropBoxManager;
+import android.support.annotation.NonNull;
 
 import org.acra.ACRA;
+import org.acra.config.ACRAConfiguration;
 
-import android.content.Context;
-import android.text.format.Time;
+import java.text.SimpleDateFormat;
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Calendar;
+import java.util.List;
+import java.util.Locale;
+import java.util.Set;
 
 import static org.acra.ACRA.LOG_TAG;
 
@@ -34,55 +38,44 @@
  * collect data associated to these tags with hope that some of them could help
  * debugging applications. Application specific tags can be provided by the app
  * dev to track his own usage of the DropBoxManager.
- * 
+ *
  * @author Kevin Gaudin
- * 
  */
 final class DropBoxCollector {
 
-    private static final String[] SYSTEM_TAGS = { "system_app_anr", "system_app_wtf", "system_app_crash",
+    private static final String[] SYSTEM_TAGS = {"system_app_anr", "system_app_wtf", "system_app_crash",
             "system_server_anr", "system_server_wtf", "system_server_crash", "BATTERY_DISCHARGE_INFO",
             "SYSTEM_RECOVERY_LOG", "SYSTEM_BOOT", "SYSTEM_LAST_KMSG", "APANIC_CONSOLE", "APANIC_THREADS",
-            "SYSTEM_RESTART", "SYSTEM_TOMBSTONE", "data_app_strictmode" };
+            "SYSTEM_RESTART", "SYSTEM_TOMBSTONE", "data_app_strictmode"};
 
     private static final String NO_RESULT = "N/A";
+    private final SimpleDateFormat dateFormat = new SimpleDateFormat("yyyyMMdd'T'HHmmss", Locale.getDefault()); //iCal format (used to prevent logic changes). Why use this bad readable format?
 
     /**
      * Read latest messages contained in the DropBox for system related tags and
      * optional developer-set tags.
-     * 
-     * @param context
-     *            The application context.
-     * @param additionalTags
-     *            An array of tags provided by the application developer.
+     *
+     * @param context The application context.
+     * @param config  AcraConfig describe what to collect.
      * @return A readable formatted String listing messages retrieved.
      */
-    public static String read(Context context, String[] additionalTags) {
+    @NonNull
+    public String read(@NonNull Context context, @NonNull ACRAConfiguration config) {
         try {
-            // Use reflection API to allow compilation with API Level 5.
-            final String serviceName = Compatibility.getDropBoxServiceName();
-            if (serviceName == null) {
-                return NO_RESULT;
-            }
+            final DropBoxManager dropbox = (DropBoxManager) context.getSystemService(Context.DROPBOX_SERVICE);
 
-            final Object dropbox = context.getSystemService(serviceName);
-            final Method getNextEntry = dropbox.getClass().getMethod("getNextEntry", String.class, long.class);
-            if (getNextEntry == null) {
-                return "";
-            }
-
-            final Time timer = new Time();
-            timer.setToNow();
-            timer.minute -= ACRA.getConfig().dropboxCollectionMinutes();
-            timer.normalize(false);
-            final long time = timer.toMillis(false);
+            final Calendar calendar = Calendar.getInstance();
+            calendar.roll(Calendar.MINUTE, -config.dropboxCollectionMinutes());
+            final long time = calendar.getTimeInMillis();
+            dateFormat.format(calendar.getTime());
 
             final List<String> tags = new ArrayList<String>();
-            if (ACRA.getConfig().includeDropBoxSystemTags()) {
+            if (config.includeDropBoxSystemTags()) {
                 tags.addAll(Arrays.asList(SYSTEM_TAGS));
             }
-            if (additionalTags != null && additionalTags.length > 0) {
-                tags.addAll(Arrays.asList(additionalTags));
+            final Set<String> additionalTags = config.additionalDropBoxTags();
+            if (!additionalTags.isEmpty()) {
+                tags.addAll(additionalTags);
             }
 
             if (tags.isEmpty()) {
@@ -92,43 +85,29 @@ public static String read(Context context, String[] additionalTags) {
             final StringBuilder dropboxContent = new StringBuilder();
             for (String tag : tags) {
                 dropboxContent.append("Tag: ").append(tag).append('\n');
-                Object entry = getNextEntry.invoke(dropbox, tag, time);
+                DropBoxManager.Entry entry = dropbox.getNextEntry(tag, time);
                 if (entry == null) {
                     dropboxContent.append("Nothing.").append('\n');
                     continue;
                 }
-
-                final Method getText = entry.getClass().getMethod("getText", int.class);
-                final Method getTimeMillis = entry.getClass().getMethod("getTimeMillis", (Class[]) null);
-                final Method close = entry.getClass().getMethod("close", (Class[]) null);
                 while (entry != null) {
-                    final long msec = (Long) getTimeMillis.invoke(entry, (Object[]) null);
-                    timer.set(msec);
-                    dropboxContent.append("@").append(timer.format2445()).append('\n');
-                    final String text = (String) getText.invoke(entry, 500);
+                    final long msec = entry.getTimeMillis();
+                    calendar.setTimeInMillis(msec);
+                    dropboxContent.append('@').append(dateFormat.format(calendar.getTime())).append('\n');
+                    final String text = entry.getText(500);
                     if (text != null) {
                         dropboxContent.append("Text: ").append(text).append('\n');
                     } else {
                         dropboxContent.append("Not Text!").append('\n');
                     }
-                    close.invoke(entry, (Object[]) null);
-                    entry = getNextEntry.invoke(dropbox, tag, msec);
+                    entry.close();
+                    entry = dropbox.getNextEntry(tag, msec);
                 }
             }
             return dropboxContent.toString();
 
-        } catch (SecurityException e) {
-            ACRA.log.i(LOG_TAG, "DropBoxManager not available.");
-        } catch (NoSuchMethodException e) {
-            ACRA.log.i(LOG_TAG, "DropBoxManager not available.");
-        } catch (IllegalArgumentException e) {
-            ACRA.log.i(LOG_TAG, "DropBoxManager not available.");
-        } catch (IllegalAccessException e) {
-            ACRA.log.i(LOG_TAG, "DropBoxManager not available.");
-        } catch (InvocationTargetException e) {
-            ACRA.log.i(LOG_TAG, "DropBoxManager not available.");
-        } catch (NoSuchFieldException e) {
-            ACRA.log.i(LOG_TAG, "DropBoxManager not available.");
+        } catch (Exception e) {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "DropBoxManager not available.");
         }
 
         return NO_RESULT;
diff --git a/src/main/java/org/acra/collector/DumpSysCollector.java b/src/main/java/org/acra/collector/DumpSysCollector.java
index a6afd86e..d792ebca 100644
--- a/src/main/java/org/acra/collector/DumpSysCollector.java
+++ b/src/main/java/org/acra/collector/DumpSysCollector.java
@@ -15,12 +15,12 @@
  */
 package org.acra.collector;
 
+import android.support.annotation.NonNull;
+
 import org.acra.ACRA;
-import org.acra.ACRAConstants;
+import org.acra.util.IOUtils;
 
-import java.io.BufferedReader;
 import java.io.IOException;
-import java.io.InputStreamReader;
 import java.util.ArrayList;
 import java.util.List;
 
@@ -33,6 +33,7 @@
  * 
  */
 final class DumpSysCollector {
+    private DumpSysCollector(){}
 
     /**
      * Collect results of the <code>dumpsys meminfo</code> command restricted to
@@ -40,10 +41,10 @@
      * 
      * @return The execution result.
      */
+    @NonNull
     public static String collectMemInfo() {
 
         final StringBuilder meminfo = new StringBuilder();
-		BufferedReader bufferedReader = null;
         try {
             final List<String> commandLine = new ArrayList<String>();
             commandLine.add("dumpsys");
@@ -51,23 +52,12 @@ public static String collectMemInfo() {
             commandLine.add(Integer.toString(android.os.Process.myPid()));
 
             final Process process = Runtime.getRuntime().exec(commandLine.toArray(new String[commandLine.size()]));
-            bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()), ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES);
-
-            while (true) {
-                final String line = bufferedReader.readLine();
-                if (line == null) {
-                    break;
-                }
-                meminfo.append(line);
-                meminfo.append("\n");
-            }
+            meminfo.append(IOUtils.streamToString(process.getInputStream()));
 
         } catch (IOException e) {
             ACRA.log.e(LOG_TAG, "DumpSysCollector.meminfo could not retrieve data", e);
 		}
 
-        CollectorUtil.safeClose(bufferedReader);
-
         return meminfo.toString();
     }
 }
\ No newline at end of file
diff --git a/src/main/java/org/acra/collector/LogCatCollector.java b/src/main/java/org/acra/collector/LogCatCollector.java
index fd27ef26..646a9fcd 100644
--- a/src/main/java/org/acra/collector/LogCatCollector.java
+++ b/src/main/java/org/acra/collector/LogCatCollector.java
@@ -15,21 +15,24 @@
  */
 package org.acra.collector;
 
-import static org.acra.ACRA.LOG_TAG;
+import android.os.Build;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import com.android.internal.util.Predicate;
+
+import org.acra.ACRA;
+import org.acra.annotation.ReportsCrashes;
+import org.acra.config.ACRAConfiguration;
+import org.acra.collections.BoundedLinkedList;
+import org.acra.util.IOUtils;
 
-import java.io.BufferedReader;
 import java.io.IOException;
-import java.io.InputStream;
-import java.io.InputStreamReader;
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.LinkedList;
 import java.util.List;
 
-import org.acra.ACRA;
-import org.acra.ACRAConstants;
-import org.acra.annotation.ReportsCrashes;
-import org.acra.util.BoundedLinkedList;
+import static org.acra.ACRA.LOG_TAG;
 
 
 /**
@@ -48,10 +51,9 @@
     /**
      * Executes the logcat command with arguments taken from
      * {@link ReportsCrashes#logcatArguments()}
-     * 
-     * @param bufferName
-     *            The name of the buffer to be read: "main" (default), "radio"
-     *            or "events".
+     *
+     * @param config        AcraConfig to use when collecting logcat.
+     * @param bufferName    The name of the buffer to be read: "main" (default), "radio" or "events".
      * @return A {@link String} containing the latest lines of the output.
      *         Default is 100 lines, use "-t", "300" in
      *         {@link ReportsCrashes#logcatArguments()} if you want 300 lines.
@@ -59,10 +61,10 @@
      *         report generation time and a bigger footprint on the device data
      *         plan consumption.
      */
-    public static String collectLogCat(String bufferName) {
+    public String collectLogCat(@NonNull ACRAConfiguration config, @Nullable String bufferName) {
         final int myPid = android.os.Process.myPid();
         String myPidStr = null;
-        if (ACRA.getConfig().logcatFilterByPid() && myPid > 0) {
+        if (config.logcatFilterByPid() && myPid > 0) {
             myPidStr = Integer.toString(myPid) +"):";
         }
 
@@ -76,13 +78,12 @@ public static String collectLogCat(String bufferName) {
         // "-t n" argument has been introduced in FroYo (API level 8). For
         // devices with lower API level, we will have to emulate its job.
         final int tailCount;
-        final List<String> logcatArgumentsList = new ArrayList<String>(
-                Arrays.asList(ACRA.getConfig().logcatArguments()));
+        final List<String> logcatArgumentsList = config.logcatArguments();
 
         final int tailIndex = logcatArgumentsList.indexOf("-t");
         if (tailIndex > -1 && tailIndex < logcatArgumentsList.size()) {
             tailCount = Integer.parseInt(logcatArgumentsList.get(tailIndex + 1));
-            if (Compatibility.getAPILevel() < Compatibility.VERSION_CODES.FROYO) {
+            if (Build.VERSION.SDK_INT < Build.VERSION_CODES.FROYO) {
                 logcatArgumentsList.remove(tailIndex + 1);
                 logcatArgumentsList.remove(tailIndex);
                 logcatArgumentsList.add("-d");
@@ -94,42 +95,33 @@ public static String collectLogCat(String bufferName) {
         final LinkedList<String> logcatBuf = new BoundedLinkedList<String>(tailCount > 0 ? tailCount
                 : DEFAULT_TAIL_COUNT);
         commandLine.addAll(logcatArgumentsList);
-        
-        BufferedReader bufferedReader = null;
 
         try {
             final Process process = Runtime.getRuntime().exec(commandLine.toArray(new String[commandLine.size()]));
-            bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()), ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES);
 
-            ACRA.log.d(LOG_TAG, "Retrieving logcat output...");
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Retrieving logcat output...");
 
             // Dump stderr to null
             new Thread(new Runnable() {
+                @Override
                 public void run() {
                     try {
-                        InputStream stderr = process.getErrorStream();
-                        byte[] dummy = new byte[ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES];
-                        while (stderr.read(dummy) >= 0)
-                            ;
-                    } catch (IOException e) {
+                        IOUtils.streamToString(process.getErrorStream());
+                    } catch (IOException ignored) {
                     }
                 }
             }).start();
 
-            while (true) {
-                final String line = bufferedReader.readLine();
-                if (line == null) {
-                    break;
+            final String finalMyPidStr = myPidStr;
+            logcatBuf.add(IOUtils.streamToString(process.getInputStream(), new Predicate<String>() {
+                @Override
+                public boolean apply(String s) {
+                    return finalMyPidStr == null || s.contains(finalMyPidStr);
                 }
-                if (myPidStr == null || line.contains(myPidStr)) {
-                    logcatBuf.add(line + "\n");
-                }
-            }
+            }));
 
         } catch (IOException e) {
             ACRA.log.e(LOG_TAG, "LogCatCollector.collectLogCat could not retrieve data.", e);
-        } finally {
-            CollectorUtil.safeClose(bufferedReader);
         }
 
         return logcatBuf.toString();
diff --git a/src/main/java/org/acra/collector/LogFileCollector.java b/src/main/java/org/acra/collector/LogFileCollector.java
index ca9679e4..696024fb 100644
--- a/src/main/java/org/acra/collector/LogFileCollector.java
+++ b/src/main/java/org/acra/collector/LogFileCollector.java
@@ -16,18 +16,14 @@
 
 package org.acra.collector;
 
-import java.io.BufferedReader;
-import java.io.ByteArrayInputStream;
-import java.io.FileInputStream;
-import java.io.FileNotFoundException;
-import java.io.IOException;
-import java.io.InputStreamReader;
+import android.app.Application;
+import android.content.Context;
+import android.support.annotation.NonNull;
 
 import org.acra.ACRA;
-import org.acra.util.BoundedLinkedList;
+import org.acra.util.IOUtils;
 
-import android.app.Application;
-import android.content.Context;
+import java.io.*;
 
 import static org.acra.ACRA.LOG_TAG;
 
@@ -40,48 +36,41 @@
  */
 class LogFileCollector {
 
-    /**
-     * Private constructor to prevent instantiation.
-     */
-    private LogFileCollector() {
-    };
-
     /**
      * Reads the last lines of a custom log file. The file name is assumed as
      * located in the {@link Application#getFilesDir()} directory if it does not
      * contain any path separator.
      * 
-     * @param context
-     * @param fileName
-     * @param numberOfLines
-     * @return
+     * @param context       Application context.
+     * @param fileName      Log file to read. It can be an absolute path, or a relative path from the application
+     *                      files folder, or a file within the application files folder.
+     * @param numberOfLines Number of lines to retrieve.
+     * @return A single String containing all of the requested lines.
      * @throws IOException
      */
-    public static String collectLogFile(Context context, String fileName, int numberOfLines) throws IOException {
-        final BoundedLinkedList<String> resultBuffer = new BoundedLinkedList<String>(numberOfLines);
-        final BufferedReader reader = getReader(context, fileName);
-        try {
-            String line = reader.readLine();
-            while (line != null) {
-                resultBuffer.add(line + "\n");
-                line = reader.readLine();
-            }
-        } finally {
-            CollectorUtil.safeClose(reader);
-        }
-        return resultBuffer.toString();
+    @NonNull
+    public String collectLogFile(@NonNull Context context, @NonNull String fileName, int numberOfLines) throws IOException {
+        return IOUtils.streamToString(getStream(context, fileName), numberOfLines);
     }
 
-    private static BufferedReader getReader(Context context, String fileName) {
+    @NonNull
+    private static InputStream getStream(@NonNull Context context, @NonNull String fileName) {
         try {
-            if (fileName.contains("/")) {
-                return new BufferedReader(new InputStreamReader(new FileInputStream(fileName)), 1024);
+            final FileInputStream inputStream;
+            if (fileName.startsWith("/")) {
+                // Absolute path
+                inputStream = new FileInputStream(fileName);
+            } else if (fileName.contains("/")) {
+                // Relative path from the application files folder (ie a sub folder)
+                inputStream = new FileInputStream(new File(context.getFilesDir(), fileName));
             } else {
-                return new BufferedReader(new InputStreamReader(context.openFileInput(fileName)), 1024);
+                // A file directly contained within the application files folder.
+                inputStream = context.openFileInput(fileName);
             }
+            return inputStream;
         } catch (FileNotFoundException e) {
-            ACRA.log.e(LOG_TAG, "Cannot find application log file : '" + ACRA.getConfig().applicationLogFile() + "'");
-            return new BufferedReader(new InputStreamReader(new ByteArrayInputStream(new byte[0])));
+            ACRA.log.e(LOG_TAG, "Cannot find application log file : '" + fileName + '\'');
+            return new ByteArrayInputStream(new byte[0]);
         }
     }
 }
diff --git a/src/main/java/org/acra/collector/MediaCodecListCollector.java b/src/main/java/org/acra/collector/MediaCodecListCollector.java
index 23c58890..bcc878c1 100644
--- a/src/main/java/org/acra/collector/MediaCodecListCollector.java
+++ b/src/main/java/org/acra/collector/MediaCodecListCollector.java
@@ -16,22 +16,26 @@
 
 package org.acra.collector;
 
+import android.annotation.TargetApi;
+import android.media.MediaCodecInfo;
+import android.media.MediaCodecList;
+import android.os.Build;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.util.SparseArray;
+
 import java.lang.reflect.Field;
-import java.lang.reflect.InvocationTargetException;
-import java.lang.reflect.Method;
 import java.lang.reflect.Modifier;
 import java.util.Arrays;
 
-import android.util.SparseArray;
-
 /**
  * Collects data about available codecs on the device through the MediaCodecList
  * API introduced in Android 4.1 JellyBean.
- * 
+ *
  * @author Kevin Gaudin
- * 
  */
-public class MediaCodecListCollector {
+final class MediaCodecListCollector {
+    private MediaCodecListCollector(){}
     private enum CodecType {
         AVC, H263, MPEG4, AAC
 
@@ -43,41 +47,19 @@
     private static final String[] H263_TYPES = { "h263", "H263" };
     private static final String[] AAC_TYPES = { "aac", "AAC" };
 
-    private static Class<?> mediaCodecListClass = null;
-    private static Method getCodecInfoAtMethod = null;
-    private static Class<?> mediaCodecInfoClass = null;
-    private static Method getNameMethod = null;
-    private static Method isEncoderMethod = null;
-    private static Method getSupportedTypesMethod = null;
-    private static Method getCapabilitiesForTypeMethod = null;
-    private static Class<?> codecCapabilitiesClass = null;
-    private static Field colorFormatsField = null;
-    private static Field profileLevelsField = null;
-    private static Field profileField = null;
-    private static Field levelField = null;
-    private static SparseArray<String> mColorFormatValues = new SparseArray<String>();
-    private static SparseArray<String> mAVCLevelValues = new SparseArray<String>();
-    private static SparseArray<String> mAVCProfileValues = new SparseArray<String>();
-    private static SparseArray<String> mH263LevelValues = new SparseArray<String>();
-    private static SparseArray<String> mH263ProfileValues = new SparseArray<String>();
-    private static SparseArray<String> mMPEG4LevelValues = new SparseArray<String>();
-    private static SparseArray<String> mMPEG4ProfileValues = new SparseArray<String>();
-    private static SparseArray<String> mAACProfileValues = new SparseArray<String>();
+    private static final SparseArray<String> mColorFormatValues = new SparseArray<String>();
+    private static final SparseArray<String> mAVCLevelValues = new SparseArray<String>();
+    private static final SparseArray<String> mAVCProfileValues = new SparseArray<String>();
+    private static final SparseArray<String> mH263LevelValues = new SparseArray<String>();
+    private static final SparseArray<String> mH263ProfileValues = new SparseArray<String>();
+    private static final SparseArray<String> mMPEG4LevelValues = new SparseArray<String>();
+    private static final SparseArray<String> mMPEG4ProfileValues = new SparseArray<String>();
+    private static final SparseArray<String> mAACProfileValues = new SparseArray<String>();
 
     // static init where nearly all reflection inspection is done.
     static {
         try {
-            mediaCodecListClass = Class.forName("android.media.MediaCodecList");
-            // Get methods to retrieve media codec info
-            getCodecInfoAtMethod = mediaCodecListClass.getMethod("getCodecInfoAt", int.class);
-            mediaCodecInfoClass = Class.forName("android.media.MediaCodecInfo");
-            getNameMethod = mediaCodecInfoClass.getMethod("getName");
-            isEncoderMethod = mediaCodecInfoClass.getMethod("isEncoder");
-            getSupportedTypesMethod = mediaCodecInfoClass.getMethod("getSupportedTypes");
-            getCapabilitiesForTypeMethod = mediaCodecInfoClass.getMethod("getCapabilitiesForType", String.class);
-            codecCapabilitiesClass = Class.forName("android.media.MediaCodecInfo$CodecCapabilities");
-            colorFormatsField = codecCapabilitiesClass.getField("colorFormats");
-            profileLevelsField = codecCapabilitiesClass.getField("profileLevels");
+            final Class<?> codecCapabilitiesClass = Class.forName("android.media.MediaCodecInfo$CodecCapabilities");
 
             // Retrieve list of possible Color Format
             for (Field f : codecCapabilitiesClass.getFields()) {
@@ -88,7 +70,7 @@
             }
 
             // Retrieve lists of possible codecs profiles and levels
-            Class<?> codecProfileLevelClass = Class.forName("android.media.MediaCodecInfo$CodecProfileLevel");
+            final Class<?> codecProfileLevelClass = Class.forName("android.media.MediaCodecInfo$CodecProfileLevel");
             for (Field f : codecProfileLevelClass.getFields()) {
                 if (Modifier.isStatic(f.getModifiers()) && Modifier.isFinal(f.getModifiers())) {
                     if (f.getName().startsWith("AVCLevel")) {
@@ -108,21 +90,13 @@
                     }
                 }
             }
-
-            profileField = codecProfileLevelClass.getField("profile");
-            levelField = codecProfileLevelClass.getField("level");
-
-        } catch (ClassNotFoundException e) {
-            // NOOP
-        } catch (NoSuchMethodException e) {
-            // NOOP
-        } catch (IllegalArgumentException e) {
+        } catch (@NonNull ClassNotFoundException ignored) {
             // NOOP
-        } catch (IllegalAccessException e) {
+        } catch (@NonNull SecurityException ignored) {
             // NOOP
-        } catch (SecurityException e) {
+        } catch (@NonNull IllegalAccessException ignored) {
             // NOOP
-        } catch (NoSuchFieldException e) {
+        } catch (@NonNull IllegalArgumentException ignored) {
             // NOOP
         }
 
@@ -132,37 +106,41 @@
      * Builds a String describing the list of available codecs on the device
      * with their capabilities (supported Color Formats, Codec Profiles et
      * Levels).
-     * 
+     *
      * @return The media codecs information
      */
-    public static String collecMediaCodecList() {
-        StringBuilder result = new StringBuilder();
-        if (mediaCodecListClass != null && mediaCodecInfoClass != null) {
-            try {
-                // Retrieve list of available media codecs
-                int codecCount = (Integer) (mediaCodecListClass.getMethod("getCodecCount").invoke(null));
+    @NonNull
+    public static String collectMediaCodecList() {
+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN) {
+            return "";
+        }
 
-                // Go through each available media codec
-                Object codecInfo = null;
-                for (int codecIdx = 0; codecIdx < codecCount; codecIdx++) {
-                    result.append("\n");
-                    codecInfo = getCodecInfoAtMethod.invoke(null, codecIdx);
-                    result.append(codecIdx).append(": ").append(getNameMethod.invoke(codecInfo)).append("\n");
-                    result.append("isEncoder: ").append(isEncoderMethod.invoke(codecInfo)).append("\n");
-                    String[] supportedTypes = (String[]) getSupportedTypesMethod.invoke(codecInfo);
-                    result.append("Supported types: ").append(Arrays.toString(supportedTypes)).append("\n");
-                    for (String type : supportedTypes) {
-                        result.append(collectCapabilitiesForType(codecInfo, type));
-                    }
-                    result.append("\n");
-                }
-            } catch (NoSuchMethodException e) {
-                // NOOP
-            } catch (IllegalAccessException e) {
-                // NOOP
-            } catch (InvocationTargetException e) {
-                // NOOP
+        final MediaCodecInfo[] infos;
+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {
+            //noinspection deprecation
+            final int codecCount = MediaCodecList.getCodecCount();
+            infos = new MediaCodecInfo[codecCount];
+            for (int codecIdx = 0; codecIdx < codecCount; codecIdx++) {
+                //noinspection deprecation
+                infos[codecIdx] = MediaCodecList.getCodecInfoAt(codecIdx);
+            }
+        } else {
+            infos = new MediaCodecList(MediaCodecList.ALL_CODECS).getCodecInfos();
+        }
+
+        final StringBuilder result = new StringBuilder();
+        for (int i = 0; i < infos.length; i++) {
+            final MediaCodecInfo codecInfo = infos[i];
+            result.append('\n')
+                    .append(i).append(": ").append(codecInfo.getName()).append('\n')
+                    .append("isEncoder: ").append(codecInfo.isEncoder()).append('\n');
+
+            final String[] supportedTypes = codecInfo.getSupportedTypes();
+            result.append("Supported types: ").append(Arrays.toString(supportedTypes)).append('\n');
+            for (String type : supportedTypes) {
+                result.append(collectCapabilitiesForType(codecInfo, type));
             }
+            result.append('\n');
         }
         return result.toString();
     }
@@ -170,23 +148,21 @@ public static String collecMediaCodecList() {
     /**
      * Retrieve capabilities (ColorFormats and CodecProfileLevels) for a
      * specific codec type.
-     * 
-     * @param codecInfo
-     * @param type
+     *
+     * @param codecInfo //TODO describe param
+     * @param type      //TODO describe param
      * @return A string describing the color formats and codec profile levels
-     *         available for a specific codec type.
-     * @throws IllegalArgumentException
-     * @throws IllegalAccessException
-     * @throws InvocationTargetException
+     * available for a specific codec type.
      */
-    private static String collectCapabilitiesForType(final Object codecInfo, String type) throws IllegalArgumentException,
-            IllegalAccessException, InvocationTargetException {
+    @NonNull
+    @TargetApi(Build.VERSION_CODES.JELLY_BEAN)
+    private static String collectCapabilitiesForType(@NonNull final MediaCodecInfo codecInfo, @NonNull String type){
 
         final StringBuilder result = new StringBuilder();
-        final Object codecCapabilities = getCapabilitiesForTypeMethod.invoke(codecInfo, type);
+        final MediaCodecInfo.CodecCapabilities codecCapabilities = codecInfo.getCapabilitiesForType(type);
 
         // Color Formats
-        final int[] colorFormats = (int[]) colorFormatsField.get(codecCapabilities);
+        final int[] colorFormats = codecCapabilities.colorFormats;
         if (colorFormats.length > 0) {
             result.append(type).append(" color formats:");
             for (int i = 0; i < colorFormats.length; i++) {
@@ -195,19 +171,19 @@ private static String collectCapabilitiesForType(final Object codecInfo, String
                     result.append(',');
                 }
             }
-            result.append("\n");
+            result.append('\n');
         }
 
         final CodecType codecType = identifyCodecType(codecInfo);
 
         // Profile Levels
-        final Object[] codecProfileLevels = (Object[]) profileLevelsField.get(codecCapabilities);
+        final MediaCodecInfo.CodecProfileLevel[] codecProfileLevels = codecCapabilities.profileLevels;
         if (codecProfileLevels.length > 0) {
             result.append(type).append(" profile levels:");
             for (int i = 0; i < codecProfileLevels.length; i++) {
 
-                final int profileValue = profileField.getInt(codecProfileLevels[i]);
-                final int levelValue = levelField.getInt(codecProfileLevels[i]);
+                final int profileValue = codecProfileLevels[i].profile;
+                final int levelValue = codecProfileLevels[i].level;
 
                 if (codecType == null) {
                     // Unknown codec
@@ -216,23 +192,23 @@ private static String collectCapabilitiesForType(final Object codecInfo, String
                 }
 
                 switch (codecType) {
-                case AVC:
-                    result.append(profileValue).append(mAVCProfileValues.get(profileValue)).append('-')
-                            .append(mAVCLevelValues.get(levelValue));
-                    break;
-                case H263:
-                    result.append(mH263ProfileValues.get(profileValue)).append('-')
-                            .append(mH263LevelValues.get(levelValue));
-                    break;
-                case MPEG4:
-                    result.append(mMPEG4ProfileValues.get(profileValue)).append('-')
-                            .append(mMPEG4LevelValues.get(levelValue));
-                    break;
-                case AAC:
-                    result.append(mAACProfileValues.get(profileValue));
-                    break;
-                default:
-                    break;
+                    case AVC:
+                        result.append(profileValue).append(mAVCProfileValues.get(profileValue)).append('-')
+                                .append(mAVCLevelValues.get(levelValue));
+                        break;
+                    case H263:
+                        result.append(mH263ProfileValues.get(profileValue)).append('-')
+                                .append(mH263LevelValues.get(levelValue));
+                        break;
+                    case MPEG4:
+                        result.append(mMPEG4ProfileValues.get(profileValue)).append('-')
+                                .append(mMPEG4LevelValues.get(levelValue));
+                        break;
+                    case AAC:
+                        result.append(mAACProfileValues.get(profileValue));
+                        break;
+                    default:
+                        break;
                 }
 
                 if (i < codecProfileLevels.length - 1) {
@@ -240,23 +216,22 @@ private static String collectCapabilitiesForType(final Object codecInfo, String
                 }
 
             }
-            result.append("\n");
+            result.append('\n');
         }
-        return result.append("\n").toString();
+        return result.append('\n').toString();
     }
 
     /**
      * Looks for keywords in the codec name to identify its nature ({@link CodecType}).
-     * @param codecInfo
-     * @return
-     * @throws IllegalArgumentException
-     * @throws IllegalAccessException
-     * @throws InvocationTargetException
+     *
+     * @param codecInfo //TODO describe param
+     * @return //TODO describe return
      */
-    private static CodecType identifyCodecType(Object codecInfo) throws IllegalArgumentException,
-            IllegalAccessException, InvocationTargetException {
+    @Nullable
+    @TargetApi(Build.VERSION_CODES.JELLY_BEAN)
+    private static CodecType identifyCodecType(@NonNull MediaCodecInfo codecInfo)  {
 
-        String name = (String) getNameMethod.invoke(codecInfo);
+        final String name = codecInfo.getName();
         for (String token : AVC_TYPES) {
             if (name.contains(token)) {
                 return CodecType.AVC;
diff --git a/src/main/java/org/acra/collector/ReflectionCollector.java b/src/main/java/org/acra/collector/ReflectionCollector.java
index 47a2a917..27dad8be 100644
--- a/src/main/java/org/acra/collector/ReflectionCollector.java
+++ b/src/main/java/org/acra/collector/ReflectionCollector.java
@@ -16,6 +16,9 @@
 
 package org.acra.collector;
 
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
 import java.lang.reflect.Field;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
@@ -31,6 +34,7 @@
  * 
  */
 final class ReflectionCollector {
+    private ReflectionCollector(){}
 
     /**
      * Retrieves key/value pairs from static fields of a class.
@@ -39,16 +43,17 @@
      * 
      * @return A human readable string with a key=value pair on each line.
      */
-    public static String collectConstants(Class<?> someClass, String prefix) {
+    @NonNull
+    public static String collectConstants(@NonNull Class<?> someClass, @Nullable String prefix) {
 
         final StringBuilder result = new StringBuilder();
 
         final Field[] fields = someClass.getFields();
         for (final Field field : fields) {
-            if (prefix != null && prefix.length() > 0) {
+            if (prefix != null && !prefix.isEmpty()) {
                 result.append(prefix).append('.');
             }
-            result.append(field.getName()).append("=");
+            result.append(field.getName()).append('=');
             try {
                 final Object value = field.get(null);
                 if (value != null) {
@@ -58,12 +63,12 @@ public static String collectConstants(Class<?> someClass, String prefix) {
                         result.append(value.toString());
                     }
                 }
-            } catch (IllegalArgumentException e) {
+            } catch (@NonNull IllegalArgumentException e) {
                 result.append("N/A");
-            } catch (IllegalAccessException e) {
+            } catch (@NonNull IllegalAccessException e) {
                 result.append("N/A");
             }
-            result.append("\n");
+            result.append('\n');
         }
 
         return result.toString();
@@ -75,23 +80,24 @@ public static String collectConstants(Class<?> someClass, String prefix) {
      * @param someClass the class to be inspected.
      * @return A human readable string with a key=value pair on each line.
      */
-    public static String collectStaticGettersResults(Class<?> someClass) {
+    @NonNull
+    public static String collectStaticGettersResults(@NonNull Class<?> someClass) {
         final StringBuilder result = new StringBuilder();
         final Method[] methods = someClass.getMethods();
         for (final Method method : methods) {
             if (method.getParameterTypes().length == 0
                     && (method.getName().startsWith("get") || method.getName().startsWith("is"))
-                    && !method.getName().equals("getClass")) {
+                    && !"getClass".equals(method.getName())) {
                 try {
                     result.append(method.getName());
                     result.append('=');
                     result.append(method.invoke(null, (Object[]) null));
-                    result.append("\n");
-                } catch (IllegalArgumentException e) {
+                    result.append('\n');
+                } catch (@NonNull IllegalArgumentException ignored) {
                     // NOOP
-                } catch (IllegalAccessException e) {
+                } catch (@NonNull InvocationTargetException ignored) {
                     // NOOP
-                } catch (InvocationTargetException e) {
+                } catch (@NonNull IllegalAccessException ignored) {
                     // NOOP
                 }
             }
@@ -100,7 +106,8 @@ public static String collectStaticGettersResults(Class<?> someClass) {
         return result.toString();
     }
 
-    public static String collectConstants(Class<?> someClass) {
+    @NonNull
+    public static String collectConstants(@NonNull Class<?> someClass) {
         return collectConstants(someClass, "");
     }
 }
diff --git a/src/main/java/org/acra/collector/SettingsCollector.java b/src/main/java/org/acra/collector/SettingsCollector.java
index ef314f7b..2ba52fd3 100644
--- a/src/main/java/org/acra/collector/SettingsCollector.java
+++ b/src/main/java/org/acra/collector/SettingsCollector.java
@@ -16,55 +16,65 @@
 
 package org.acra.collector;
 
-import java.lang.reflect.Field;
-import java.lang.reflect.InvocationTargetException;
-import java.lang.reflect.Method;
-
-import org.acra.ACRA;
-
-import android.content.ContentResolver;
 import android.content.Context;
+import android.os.Build;
 import android.provider.Settings;
 import android.provider.Settings.Secure;
 import android.provider.Settings.System;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import org.acra.ACRA;
+import org.acra.config.ACRAConfiguration;
+
+import java.lang.reflect.Field;
 
 import static org.acra.ACRA.LOG_TAG;
 
 /**
  * Helper to collect data from {@link System} and {@link Secure} Settings
  * classes.
- * 
+ *
  * @author Kevin Gaudin
- * 
+ *
  */
 final class SettingsCollector {
 
+    private static final String ERROR = "Error: ";
+
+    private final Context context;
+    private final ACRAConfiguration config;
+
+    SettingsCollector(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        this.context = context;
+        this.config = config;
+    }
+
     /**
      * Collect data from {@link android.provider.Settings.System}. This
      * collector uses reflection to be sure to always get the most accurate data
      * whatever Android API level it runs on.
-     * 
-     * @param ctx
-     *            Application context.
+     *
      * @return A human readable String containing one key=value pair per line.
      */
-    public static String collectSystemSettings(Context ctx) {
+    @NonNull
+    public String collectSystemSettings() {
         final StringBuilder result = new StringBuilder();
         final Field[] keys = Settings.System.class.getFields();
         for (final Field key : keys) {
             // Avoid retrieving deprecated fields... it is useless, has an
-            // impact on perfs, and the system writes many warnings in the
+            // impact on prefs, and the system writes many warnings in the
             // logcat.
             if (!key.isAnnotationPresent(Deprecated.class) && key.getType() == String.class) {
                 try {
-                    final Object value = Settings.System.getString(ctx.getContentResolver(), (String) key.get(null));
+                    final Object value = Settings.System.getString(context.getContentResolver(), (String) key.get(null));
                     if (value != null) {
-                        result.append(key.getName()).append("=").append(value).append("\n");
+                        result.append(key.getName()).append('=').append(value).append('\n');
                     }
-                } catch (IllegalArgumentException e) {
-                    ACRA.log.w(LOG_TAG, "Error : ", e);
-                } catch (IllegalAccessException e) {
-                    ACRA.log.w(LOG_TAG, "Error : ", e);
+                } catch (@NonNull IllegalArgumentException e) {
+                    ACRA.log.w(LOG_TAG, ERROR, e);
+                } catch (@NonNull IllegalAccessException e) {
+                    ACRA.log.w(LOG_TAG, ERROR, e);
                 }
             }
         }
@@ -76,25 +86,24 @@ public static String collectSystemSettings(Context ctx) {
      * Collect data from {@link android.provider.Settings.Secure}. This
      * collector uses reflection to be sure to always get the most accurate data
      * whatever Android API level it runs on.
-     * 
-     * @param ctx
-     *            Application context.
+     *
      * @return A human readable String containing one key=value pair per line.
      */
-    public static String collectSecureSettings(Context ctx) {
+    @NonNull
+    public String collectSecureSettings() {
         final StringBuilder result = new StringBuilder();
         final Field[] keys = Settings.Secure.class.getFields();
         for (final Field key : keys) {
             if (!key.isAnnotationPresent(Deprecated.class) && key.getType() == String.class && isAuthorized(key)) {
                 try {
-                    final Object value = Settings.Secure.getString(ctx.getContentResolver(), (String) key.get(null));
+                    final Object value = Settings.Secure.getString(context.getContentResolver(), (String) key.get(null));
                     if (value != null) {
-                        result.append(key.getName()).append("=").append(value).append("\n");
+                        result.append(key.getName()).append('=').append(value).append('\n');
                     }
-                } catch (IllegalArgumentException e) {
-                    ACRA.log.w(LOG_TAG, "Error : ", e);
-                } catch (IllegalAccessException e) {
-                    ACRA.log.w(LOG_TAG, "Error : ", e);
+                } catch (@NonNull IllegalArgumentException e) {
+                    ACRA.log.w(LOG_TAG, ERROR, e);
+                } catch (@NonNull IllegalAccessException e) {
+                    ACRA.log.w(LOG_TAG, ERROR, e);
                 }
             }
         }
@@ -106,53 +115,43 @@ public static String collectSecureSettings(Context ctx) {
      * Collect data from {@link android.provider.Settings.Global}. This
      * collector uses reflection to be sure to always get the most accurate data
      * whatever Android API level it runs on.
-     * 
-     * @param ctx
-     *            Application context.
+     *
      * @return A human readable String containing one key=value pair per line.
      */
-    public static String collectGlobalSettings(Context ctx) {
-        if (Compatibility.getAPILevel() < Compatibility.VERSION_CODES.JELLY_BEAN_MR1) {
+    @NonNull
+    public String collectGlobalSettings() {
+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR1) {
             return "";
         }
 
         final StringBuilder result = new StringBuilder();
-        try {
-            final Class<?> globalClass = Class.forName("android.provider.Settings$Global");
-            final Field[] keys = globalClass.getFields();
-            final Method getString = globalClass.getMethod("getString", ContentResolver.class, String.class);
-            for (final Field key : keys) {
-                if (!key.isAnnotationPresent(Deprecated.class) && key.getType() == String.class && isAuthorized(key)) {
-                    final Object value = getString.invoke(null, ctx.getContentResolver(), (String) key.get(null));
+        final Field[] keys = Settings.Global.class.getFields();
+        for (final Field key : keys) {
+            if (!key.isAnnotationPresent(Deprecated.class) && key.getType() == String.class && isAuthorized(key)) {
+                try {
+                    final Object value = Settings.Global.getString(context.getContentResolver(), (String) key.get(null));
                     if (value != null) {
-                        result.append(key.getName()).append("=").append(value).append("\n");
+                        result.append(key.getName()).append('=').append(value).append('\n');
                     }
+                } catch (@NonNull IllegalArgumentException e) {
+                    ACRA.log.w(LOG_TAG, ERROR, e);
+                } catch (@NonNull SecurityException e) {
+                    ACRA.log.w(LOG_TAG, ERROR, e);
+                } catch (@NonNull IllegalAccessException e) {
+                    ACRA.log.w(LOG_TAG, ERROR, e);
                 }
             }
-        } catch (IllegalArgumentException e) {
-            ACRA.log.w(LOG_TAG, "Error : ", e);
-        } catch (IllegalAccessException e) {
-            ACRA.log.w(LOG_TAG, "Error : ", e);
-        } catch (ClassNotFoundException e) {
-            ACRA.log.w(LOG_TAG, "Error : ", e);
-        } catch (SecurityException e) {
-            ACRA.log.w(LOG_TAG, "Error : ", e);
-        } catch (NoSuchMethodException e) {
-            ACRA.log.w(LOG_TAG, "Error : ", e);
-        } catch (InvocationTargetException e) {
-            ACRA.log.w(LOG_TAG, "Error : ", e);
         }
-
         return result.toString();
     }
 
-    private static boolean isAuthorized(Field key) {
+    private boolean isAuthorized(@Nullable Field key) {
         if (key == null || key.getName().startsWith("WIFI_AP")) {
             return false;
         }
-        for (String regex : ACRA.getConfig().excludeMatchingSettingsKeys()) {
+        for (String regex : config.excludeMatchingSettingsKeys()) {
             if(key.getName().matches(regex)) {
-               return false; 
+               return false;
             }
         }
         return true;
diff --git a/src/main/java/org/acra/collector/SharedPreferencesCollector.java b/src/main/java/org/acra/collector/SharedPreferencesCollector.java
index d4ef0f7b..caf6f978 100644
--- a/src/main/java/org/acra/collector/SharedPreferencesCollector.java
+++ b/src/main/java/org/acra/collector/SharedPreferencesCollector.java
@@ -15,15 +15,17 @@
  */
 package org.acra.collector;
 
-import java.util.Map;
-import java.util.TreeMap;
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.preference.PreferenceManager;
+import android.support.annotation.NonNull;
 
 import org.acra.ACRA;
 import org.acra.annotation.ReportsCrashes;
+import org.acra.config.ACRAConfiguration;
 
-import android.content.Context;
-import android.content.SharedPreferences;
-import android.preference.PreferenceManager;
+import java.util.Map;
+import java.util.TreeMap;
 
 import static org.acra.ACRA.LOG_TAG;
 
@@ -34,20 +36,25 @@
  */
 final class SharedPreferencesCollector {
 
+    private final Context context;
+    private final ACRAConfiguration config;
+
+    SharedPreferencesCollector(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        this.context = context;
+        this.config = config;
+    }
+
     /**
      * Collects all key/value pairs in SharedPreferences and writes them in a
      * result String. The application default SharedPreferences are always
      * collected, and the developer can provide additional SharedPreferences
      * names in the {@link ReportsCrashes#additionalSharedPreferences()}
      * configuration item.
-     * 
-     * 
-     * 
-     * @param context
-     *            the application context.
+     *
      * @return A readable formatted String containing all key/value pairs.
      */
-    public static String collect(Context context) {
+    @NonNull
+    public String collect() {
         final StringBuilder result = new StringBuilder();
 
         // Include the default SharedPreferences
@@ -55,11 +62,8 @@ public static String collect(Context context) {
         sharedPrefs.put("default", PreferenceManager.getDefaultSharedPreferences(context));
 
         // Add in any additional SharedPreferences
-        final String[] sharedPrefIds = ACRA.getConfig().additionalSharedPreferences();
-        if (sharedPrefIds != null) {
-            for (final String sharedPrefId : sharedPrefIds) {
-                sharedPrefs.put(sharedPrefId, context.getSharedPreferences(sharedPrefId, Context.MODE_PRIVATE));
-            }
+        for (final String sharedPrefId : config.additionalSharedPreferences()) {
+            sharedPrefs.put(sharedPrefId, context.getSharedPreferences(sharedPrefId, Context.MODE_PRIVATE));
         }
 
         // Iterate over all included preference files and add the preferences from each.
@@ -76,14 +80,14 @@ public static String collect(Context context) {
             }
 
             // Add all non-filtered preferences from that preference file.
-            for (final String key : prefEntries.keySet()) {
-                if (filteredKey(key)) {
-                    ACRA.log.d(LOG_TAG, "Filtered out sharedPreference=" + sharedPrefId + "  key=" + key + " due to filtering rule");
+            for (final Map.Entry<String, ?> prefEntry : prefEntries.entrySet()) {
+                if (filteredKey(prefEntry.getKey())) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Filtered out sharedPreference=" + sharedPrefId + "  key=" + prefEntry.getKey() + " due to filtering rule");
                 } else {
-                    final Object prefValue = prefEntries.get(key);
-                    result.append(sharedPrefId).append('.').append(key).append('=');
+                    final Object prefValue = prefEntry.getValue();
+                    result.append(sharedPrefId).append('.').append(prefEntry.getKey()).append('=');
                     result.append(prefValue == null ? "null" : prefValue.toString());
-                    result.append("\n");
+                    result.append('\n');
                 }
             }
             result.append('\n');
@@ -95,15 +99,14 @@ public static String collect(Context context) {
     /**
      * Checks if the key matches one of the patterns provided by the developer
      * to exclude some preferences from reports.
-     * 
-     * @param key
-     *            the name of the preference to be checked
+     *
+     * @param key the name of the preference to be checked
      * @return true if the key has to be excluded from reports.
      */
-    private static boolean filteredKey(String key) {
-        for (String regex : ACRA.getConfig().excludeMatchingSharedPreferencesKeys()) {
-            if(key.matches(regex)) {
-               return true; 
+    private boolean filteredKey(@NonNull String key) {
+        for (String regex : config.excludeMatchingSharedPreferencesKeys()) {
+            if (key.matches(regex)) {
+                return true;
             }
         }
         return false;
diff --git a/src/main/java/org/acra/collector/ThreadCollector.java b/src/main/java/org/acra/collector/ThreadCollector.java
index 64e78dc7..76d45d69 100644
--- a/src/main/java/org/acra/collector/ThreadCollector.java
+++ b/src/main/java/org/acra/collector/ThreadCollector.java
@@ -16,13 +16,17 @@
 
 package org.acra.collector;
 
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
 /**
  * Collects some data identifying a Thread, usually the Thread which crashed.
  * 
  * @author Kevin Gaudin
  * 
  */
-public class ThreadCollector {
+final class ThreadCollector {
+    private ThreadCollector(){}
 
     /**
      * Convenience method that collects some data identifying a Thread, usually the Thread which
@@ -31,15 +35,15 @@
      * @param t the thread
      * @return a string representation of the string including the id, name and priority of the thread.
      */
-    public static String collect(Thread t) {
-        StringBuilder result = new StringBuilder();
+    @NonNull
+    public static String collect(@Nullable Thread t) {
+        final StringBuilder result = new StringBuilder();
         if (t != null) {
-
-            result.append("id=").append(t.getId()).append("\n");
-            result.append("name=").append(t.getName()).append("\n");
-            result.append("priority=").append(t.getPriority()).append("\n");
+            result.append("id=").append(t.getId()).append('\n');
+            result.append("name=").append(t.getName()).append('\n');
+            result.append("priority=").append(t.getPriority()).append('\n');
             if (t.getThreadGroup() != null) {
-                result.append("groupName=").append(t.getThreadGroup().getName()).append("\n");
+                result.append("groupName=").append(t.getThreadGroup().getName()).append('\n');
             }
         } else {
             result.append("No broken thread, this might be a silent exception.");
diff --git a/src/main/java/org/acra/config/ACRAConfiguration.java b/src/main/java/org/acra/config/ACRAConfiguration.java
new file mode 100644
index 00000000..80c2e983
--- /dev/null
+++ b/src/main/java/org/acra/config/ACRAConfiguration.java
@@ -0,0 +1,426 @@
+/*
+ *  Copyright 2011 Kevin Gaudin
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.config;
+
+import android.support.annotation.DrawableRes;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.support.annotation.RawRes;
+import android.support.annotation.StringRes;
+import android.support.annotation.StyleRes;
+
+import org.acra.ReportField;
+import org.acra.ReportingInteractionMode;
+import org.acra.builder.ReportPrimer;
+import org.acra.collections.ImmutableList;
+import org.acra.dialog.BaseCrashReportDialog;
+import org.acra.security.KeyStoreFactory;
+import org.acra.sender.HttpSender.Method;
+import org.acra.sender.HttpSender.Type;
+import org.acra.sender.ReportSenderFactory;
+import org.acra.collections.ImmutableMap;
+import org.acra.collections.ImmutableSet;
+
+import java.io.Serializable;
+
+/**
+ * Represents the configuration that ACRA will use when handling crash reports.
+ *
+ * Use {@link ConfigurationBuilder} to programmatically construct an ACRAConfiguration.
+ */
+public final class ACRAConfiguration implements Serializable {
+
+    private final ImmutableSet<String> additionalDropBoxTags;
+    private final ImmutableSet<String> additionalSharedPreferences;
+    private final int connectionTimeout;
+    private final ImmutableSet<ReportField> reportContent;
+    private final boolean deleteUnapprovedReportsOnApplicationStart;
+    private final boolean deleteOldUnsentReportsOnApplicationStart;
+    private final int dropboxCollectionMinutes;
+    private final boolean alsoReportToAndroidFramework;
+    private final String formUri;
+    private final String formUriBasicAuthLogin;
+    private final String formUriBasicAuthPassword;
+    private final boolean includeDropBoxSystemTags;
+
+    private final ImmutableList<String> logcatArguments;
+    private final String mailTo;
+    private final ReportingInteractionMode reportingInteractionMode;
+    private final Class<? extends BaseCrashReportDialog> reportDialogClass;
+    private final Class<? extends ReportPrimer> reportPrimerClass;
+
+    @StringRes
+    private final int resDialogPositiveButtonText;
+    @StringRes
+    private final int resDialogNegativeButtonText;
+    @StringRes
+    private final int resDialogCommentPrompt;
+    @StringRes
+    private final int resDialogEmailPrompt;
+    @DrawableRes
+    private final int resDialogIcon;
+    @StringRes
+    private final int resDialogOkToast;
+    @StringRes
+    private final int resDialogText;
+    @StringRes
+    private final int resDialogTitle;
+    @StyleRes
+    private final int resDialogTheme;
+    @DrawableRes
+    private final int resNotifIcon;
+    @StringRes
+    private final int resNotifText;
+    @StringRes
+    private final int resNotifTickerText;
+    @StringRes
+    private final int resNotifTitle;
+    @StringRes
+    private final int resToastText;
+    private final int sharedPreferencesMode;
+    private final String sharedPreferencesName;
+    private final int socketTimeout;
+    private final boolean logcatFilterByPid;
+    private final boolean sendReportsInDevMode;
+
+    private final ImmutableSet<String> excludeMatchingSharedPreferencesKeys;
+    private final ImmutableSet<String> excludeMatchingSettingsKeys;
+    private final Class buildConfigClass;
+    private final String applicationLogFile;
+    private final int applicationLogFileLines;
+
+    private final Method httpMethod;
+    private final Type reportType;
+    private final ImmutableMap<String, String> httpHeaders;
+    private final Class<? extends KeyStoreFactory> keyStoreFactoryClass;
+    private final ImmutableSet<Class<? extends ReportSenderFactory>> reportSenderFactoryClasses;
+    @RawRes
+    private final int resCertificate;
+    private final String certificatePath;
+    private final String certificateType;
+    private final Class<? extends RetryPolicy> retryPolicyClass;
+
+    /**
+     * @param builder ConfigurationBuilder with which to initialise this {@link ACRAConfiguration}.
+     */
+    ACRAConfiguration(@NonNull ConfigurationBuilder builder) {
+        additionalDropBoxTags = new ImmutableSet<String>(builder.additionalDropBoxTags());
+        additionalSharedPreferences = new ImmutableSet<String>(builder.additionalSharedPreferences());
+        connectionTimeout = builder.connectionTimeout();
+        reportContent = new ImmutableSet<ReportField>(builder.reportContent());
+        deleteUnapprovedReportsOnApplicationStart = builder.deleteUnapprovedReportsOnApplicationStart();
+        deleteOldUnsentReportsOnApplicationStart = builder.deleteOldUnsentReportsOnApplicationStart();
+        dropboxCollectionMinutes = builder.dropboxCollectionMinutes();
+        alsoReportToAndroidFramework = builder.alsoReportToAndroidFramework();
+        formUri = builder.formUri();
+        formUriBasicAuthLogin = builder.formUriBasicAuthLogin();
+        formUriBasicAuthPassword = builder.formUriBasicAuthPassword();
+        includeDropBoxSystemTags = builder.includeDropBoxSystemTags();
+        logcatArguments = new ImmutableList<String>(builder.logcatArguments());
+        mailTo = builder.mailTo();
+        reportingInteractionMode = builder.reportingInteractionMode();
+        resDialogIcon = builder.resDialogIcon();
+        resDialogPositiveButtonText = builder.resDialogPositiveButtonText();
+        resDialogNegativeButtonText = builder.resDialogNegativeButtonText();
+        resDialogCommentPrompt = builder.resDialogCommentPrompt();
+        resDialogEmailPrompt = builder.resDialogEmailPrompt();
+        resDialogOkToast = builder.resDialogOkToast();
+        resDialogText = builder.resDialogText();
+        resDialogTitle = builder.resDialogTitle();
+        resDialogTheme = builder.resDialogTheme();
+        resNotifIcon = builder.resNotifIcon();
+        resNotifText = builder.resNotifText();
+        resNotifTickerText = builder.resNotifTickerText();
+        resNotifTitle = builder.resNotifTitle();
+        resToastText = builder.resToastText();
+        sharedPreferencesMode = builder.sharedPreferencesMode();
+        sharedPreferencesName = builder.sharedPreferencesName();
+        socketTimeout = builder.socketTimeout();
+        logcatFilterByPid = builder.logcatFilterByPid();
+        sendReportsInDevMode = builder.sendReportsInDevMode();
+        excludeMatchingSharedPreferencesKeys = new ImmutableSet<String>(builder.excludeMatchingSharedPreferencesKeys());
+        excludeMatchingSettingsKeys = new ImmutableSet<String>(builder.excludeMatchingSettingsKeys());
+        buildConfigClass = builder.buildConfigClass();
+        applicationLogFile = builder.applicationLogFile();
+        applicationLogFileLines = builder.applicationLogFileLines();
+        reportDialogClass = builder.reportDialogClass();
+        reportPrimerClass = builder.reportPrimerClass();
+        httpMethod = builder.httpMethod();
+        httpHeaders = new ImmutableMap<String, String>(builder.httpHeaders());
+        reportType = builder.reportType();
+        reportSenderFactoryClasses = new ImmutableSet<Class<? extends ReportSenderFactory>>(builder.reportSenderFactoryClasses());
+        keyStoreFactoryClass = builder.keyStoreFactoryClass();
+        resCertificate = builder.resCertificate();
+        certificatePath = builder.certificatePath();
+        certificateType = builder.certificateType();
+        retryPolicyClass = builder.retryPolicyClass();
+    }
+
+    /**
+     * Retrieve HTTP headers defined by the application developer. These should
+     * be added to requests sent by any third-party sender (over HTTP of
+     * course).
+     *
+     * @return A map associating http header names to their values.
+     */
+    @NonNull
+    public ImmutableMap<String, String> getHttpHeaders() {
+        return httpHeaders;
+    }
+
+    /**
+     * @return List of ReportField that ACRA will provide to the server.
+     */
+    @NonNull
+    public ImmutableSet<ReportField> getReportFields() {
+        return reportContent;
+    }
+
+    @NonNull
+    public ImmutableSet<String> additionalDropBoxTags() {
+        return additionalDropBoxTags;
+    }
+
+    @NonNull
+    public ImmutableSet<String> additionalSharedPreferences() {
+        return additionalSharedPreferences;
+    }
+
+    public int connectionTimeout() {
+        return connectionTimeout;
+    }
+
+    public boolean deleteUnapprovedReportsOnApplicationStart() {
+        return deleteUnapprovedReportsOnApplicationStart;
+    }
+
+    public boolean deleteOldUnsentReportsOnApplicationStart() {
+        return deleteOldUnsentReportsOnApplicationStart;
+    }
+
+    public int dropboxCollectionMinutes() {
+        return dropboxCollectionMinutes;
+    }
+
+    public boolean alsoReportToAndroidFramework() {
+        return alsoReportToAndroidFramework;
+    }
+
+    @Nullable
+    public String formUri() {
+        return formUri;
+    }
+
+    @Nullable
+    public String formUriBasicAuthLogin() {
+        return formUriBasicAuthLogin;
+    }
+
+    @Nullable
+    public String formUriBasicAuthPassword() {
+        return formUriBasicAuthPassword;
+    }
+
+    public boolean includeDropBoxSystemTags() {
+        return includeDropBoxSystemTags;
+    }
+
+    @NonNull
+    public ImmutableList<String> logcatArguments() {
+        return logcatArguments;
+    }
+
+    @Nullable
+    public String mailTo() {
+        return mailTo;
+    }
+
+    @NonNull
+    public ReportingInteractionMode mode() {
+        return reportingInteractionMode;
+    }
+
+    @StringRes
+    public int resDialogPositiveButtonText() {
+        return resDialogPositiveButtonText;
+    }
+
+    @StringRes
+    public int resDialogNegativeButtonText() {
+        return resDialogNegativeButtonText;
+    }
+
+    @StringRes
+    public int resDialogCommentPrompt() {
+        return resDialogCommentPrompt;
+    }
+
+    @StringRes
+    public int resDialogEmailPrompt() {
+        return resDialogEmailPrompt;
+    }
+
+    @DrawableRes
+    public int resDialogIcon() {
+        return resDialogIcon;
+    }
+
+    @StringRes
+    public int resDialogOkToast() {
+        return resDialogOkToast;
+    }
+
+    @StringRes
+    public int resDialogText() {
+        return resDialogText;
+    }
+
+    @StringRes
+    public int resDialogTitle() {
+        return resDialogTitle;
+    }
+
+    @StyleRes
+    public int resDialogTheme() {
+        return resDialogTheme;
+    }
+
+    @DrawableRes
+    public int resNotifIcon() {
+        return resNotifIcon;
+    }
+
+    @StringRes
+    public int resNotifText() {
+        return resNotifText;
+    }
+
+    @StringRes
+    public int resNotifTickerText() {
+        return resNotifTickerText;
+    }
+
+    @StringRes
+    public int resNotifTitle() {
+        return resNotifTitle;
+    }
+
+    @StringRes
+    public int resToastText() {
+        return resToastText;
+    }
+
+    public int sharedPreferencesMode() {
+        return sharedPreferencesMode;
+    }
+
+    @NonNull
+    public String sharedPreferencesName() {
+        return sharedPreferencesName;
+    }
+
+    public int socketTimeout() {
+        return socketTimeout;
+    }
+
+    public boolean logcatFilterByPid() {
+        return logcatFilterByPid;
+    }
+
+    public boolean sendReportsInDevMode() {
+        return sendReportsInDevMode;
+    }
+
+    @NonNull
+    public ImmutableSet<String> excludeMatchingSharedPreferencesKeys() {
+        return excludeMatchingSharedPreferencesKeys;
+    }
+
+    @NonNull
+    public ImmutableSet<String> excludeMatchingSettingsKeys() {
+        return excludeMatchingSettingsKeys;
+    }
+
+    /**
+     * Will return null if no value has been configured.
+     * It is up to clients to construct the recommended default value of context.getClass().getPackage().getName() + BuildConfig.class
+     *
+     * @return Class generated at compile time containing the build config for this application.
+     */
+    @NonNull
+    public Class buildConfigClass() {
+        return buildConfigClass;
+    }
+
+    @NonNull
+    public String applicationLogFile() {
+        return applicationLogFile;
+    }
+
+    public int applicationLogFileLines() {
+        return applicationLogFileLines;
+    }
+
+    @NonNull
+    public Class<? extends BaseCrashReportDialog> reportDialogClass() {
+        return reportDialogClass;
+    }
+
+    @NonNull
+    public Class<? extends ReportPrimer> reportPrimerClass() {
+        return reportPrimerClass;
+    }
+
+    @NonNull
+    public Method httpMethod() {
+        return httpMethod;
+    }
+
+    @NonNull
+    public Type reportType() {
+        return reportType;
+    }
+
+    @NonNull
+    public ImmutableSet<Class<? extends ReportSenderFactory>> reportSenderFactoryClasses() {
+        return reportSenderFactoryClasses;
+    }
+
+    @NonNull
+    public Class<? extends KeyStoreFactory> keyStoreFactoryClass() {
+        return keyStoreFactoryClass;
+    }
+
+    @RawRes
+    public int resCertificate() {
+        return resCertificate;
+    }
+
+    @NonNull
+    public String certificatePath() {
+        return certificatePath;
+    }
+
+    @NonNull
+    public String certificateType() {
+        return certificateType;
+    }
+
+    @NonNull
+    public Class<? extends RetryPolicy> retryPolicyClass() {
+        return retryPolicyClass;
+    }
+}
diff --git a/src/main/java/org/acra/ACRAConfigurationException.java b/src/main/java/org/acra/config/ACRAConfigurationException.java
similarity index 95%
rename from src/main/java/org/acra/ACRAConfigurationException.java
rename to src/main/java/org/acra/config/ACRAConfigurationException.java
index 55a27f3b..381546d7 100644
--- a/src/main/java/org/acra/ACRAConfigurationException.java
+++ b/src/main/java/org/acra/config/ACRAConfigurationException.java
@@ -1,30 +1,30 @@
-/*
- *  Copyright 2010 Emmanuel Astier & Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra;
-
-/**
- * A simple Exception used when required configuration items are missing.
- * 
- * @author Kevin Gaudin
- */
-public class ACRAConfigurationException extends Exception {
-
-    private static final long serialVersionUID = -7355339673505996110L;
-
-    public ACRAConfigurationException(String msg) {
-        super(msg);
-    }
-}
+/*
+ *  Copyright 2010 Emmanuel Astier & Kevin Gaudin
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.config;
+
+/**
+ * A simple Exception used when required configuration items are missing.
+ * 
+ * @author Kevin Gaudin
+ */
+public class ACRAConfigurationException extends Exception {
+
+    private static final long serialVersionUID = -7355339673505996110L;
+
+    public ACRAConfigurationException(String msg) {
+        super(msg);
+    }
+}
diff --git a/src/main/java/org/acra/config/ConfigurationBuilder.java b/src/main/java/org/acra/config/ConfigurationBuilder.java
new file mode 100644
index 00000000..bd0f1ba6
--- /dev/null
+++ b/src/main/java/org/acra/config/ConfigurationBuilder.java
@@ -0,0 +1,1224 @@
+/*
+ *  Copyright 2011 Kevin Gaudin
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.config;
+
+import android.app.Application;
+import android.support.annotation.DrawableRes;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.support.annotation.RawRes;
+import android.support.annotation.StringRes;
+import android.support.annotation.StyleRes;
+
+import org.acra.ACRA;
+import org.acra.ReportField;
+import org.acra.ReportingInteractionMode;
+import org.acra.annotation.ReportsCrashes;
+import org.acra.builder.NoOpReportPrimer;
+import org.acra.builder.ReportPrimer;
+import org.acra.dialog.BaseCrashReportDialog;
+import org.acra.dialog.CrashReportDialog;
+import org.acra.security.KeyStoreFactory;
+import org.acra.security.NoKeyStoreFactory;
+import org.acra.sender.DefaultReportSenderFactory;
+import org.acra.sender.HttpSender;
+import org.acra.sender.HttpSender.Method;
+import org.acra.sender.HttpSender.Type;
+import org.acra.sender.ReportSenderFactory;
+
+import java.lang.annotation.Annotation;
+import java.util.Arrays;
+import java.util.EnumMap;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.Map;
+import java.util.Set;
+
+import static org.acra.ACRA.LOG_TAG;
+import static org.acra.ACRAConstants.*;
+
+/**
+ * Builder responsible for programmatic construction of an {@link ACRAConfiguration}.
+ *
+ * {@link ACRAConfiguration} should be considered immutable and in the future will be.
+ *
+ * @since 4.8.1
+ */
+@SuppressWarnings("unused")
+public final class ConfigurationBuilder {
+
+    @Nullable
+    private final Class<? extends Annotation> annotationType;
+
+    private String[] additionalDropBoxTags;
+    private String[] additionalSharedPreferences;
+    private Integer connectionTimeout;
+    private ReportField[] customReportContent;
+    private final Map<ReportField, Boolean> reportContentChanges = new EnumMap<ReportField, Boolean>(ReportField.class);
+    private Boolean deleteUnapprovedReportsOnApplicationStart;
+    private Boolean deleteOldUnsentReportsOnApplicationStart;
+    private Integer dropboxCollectionMinutes;
+    private Boolean alsoReportToAndroidFramework;
+    private String formUri;
+    private String formUriBasicAuthLogin;
+    private String formUriBasicAuthPassword;
+    private Boolean includeDropBoxSystemTags;
+
+    private String[] logcatArguments;
+    private String mailTo;
+    private ReportingInteractionMode reportingInteractionMode;
+    private Class<? extends BaseCrashReportDialog> reportDialogClass;
+    private Class<? extends ReportPrimer> reportPrimerClass;
+
+    @StringRes private Integer resDialogPositiveButtonText;
+    @StringRes private Integer resDialogNegativeButtonText;
+    @StringRes private Integer resDialogCommentPrompt;
+    @StringRes  private Integer resDialogEmailPrompt;
+    @DrawableRes private Integer resDialogIcon;
+    @StringRes private Integer resDialogOkToast;
+    @StringRes private Integer resDialogText;
+    @StringRes private Integer resDialogTitle;
+    @StyleRes private Integer resDialogTheme;
+    @DrawableRes private Integer resNotifIcon;
+    @StringRes private Integer resNotifText;
+    @StringRes private Integer resNotifTickerText;
+    @StringRes private Integer resNotifTitle;
+    @StringRes private Integer resToastText;
+    private Integer sharedPreferencesMode;
+    private String sharedPreferencesName;
+    private Integer socketTimeout;
+    private Boolean logcatFilterByPid;
+    private Boolean sendReportsInDevMode;
+
+    private String[] excludeMatchingSharedPreferencesKeys;
+    private String[] excludeMatchingSettingsKeys;
+    private Class buildConfigClass;
+    private String applicationLogFile;
+    private Integer applicationLogFileLines;
+
+    private Method httpMethod;
+    private Type reportType;
+    private final Map<String, String> httpHeaders = new HashMap<String, String>();
+    private Class<? extends KeyStoreFactory> keyStoreFactoryClass;
+    private Class<? extends ReportSenderFactory>[] reportSenderFactoryClasses;
+    @RawRes private Integer resCertificate;
+    private String certificatePath;
+    private String certificateType;
+    private Class<? extends RetryPolicy> retryPolicyClass;
+
+
+    /**
+     * Constructs a ConfigurationBuilder that is prepopulated with any
+     * '@ReportCrashes' annotation declared on the Application class.
+     *
+     * @param app Current Application, from which any annotated config will be gleaned.
+     */
+    public ConfigurationBuilder(@NonNull Application app) {
+
+        // Populate with annotated config
+        final ReportsCrashes annotationConfig = app.getClass().getAnnotation(ReportsCrashes.class);
+
+        if (annotationConfig != null) {
+            annotationType = annotationConfig.annotationType();
+
+            additionalDropBoxTags = annotationConfig.additionalDropBoxTags();
+            additionalSharedPreferences = annotationConfig.additionalSharedPreferences();
+            connectionTimeout = annotationConfig.connectionTimeout();
+            customReportContent = annotationConfig.customReportContent();
+            deleteUnapprovedReportsOnApplicationStart = annotationConfig.deleteUnapprovedReportsOnApplicationStart();
+            deleteOldUnsentReportsOnApplicationStart = annotationConfig.deleteOldUnsentReportsOnApplicationStart();
+            dropboxCollectionMinutes = annotationConfig.dropboxCollectionMinutes();
+            alsoReportToAndroidFramework = annotationConfig.alsoReportToAndroidFramework();
+            formUri = annotationConfig.formUri();
+            formUriBasicAuthLogin = annotationConfig.formUriBasicAuthLogin();
+            formUriBasicAuthPassword = annotationConfig.formUriBasicAuthPassword();
+            includeDropBoxSystemTags = annotationConfig.includeDropBoxSystemTags();
+            logcatArguments = annotationConfig.logcatArguments();
+            mailTo = annotationConfig.mailTo();
+            reportingInteractionMode = annotationConfig.mode();
+            resDialogIcon = annotationConfig.resDialogIcon();
+            resDialogPositiveButtonText = annotationConfig.resDialogPositiveButtonText();
+            resDialogNegativeButtonText = annotationConfig.resDialogNegativeButtonText();
+            resDialogCommentPrompt = annotationConfig.resDialogCommentPrompt();
+            resDialogEmailPrompt = annotationConfig.resDialogEmailPrompt();
+            resDialogOkToast = annotationConfig.resDialogOkToast();
+            resDialogText = annotationConfig.resDialogText();
+            resDialogTitle = annotationConfig.resDialogTitle();
+            resDialogTheme = annotationConfig.resDialogTheme();
+            resNotifIcon = annotationConfig.resNotifIcon();
+            resNotifText = annotationConfig.resNotifText();
+            resNotifTickerText = annotationConfig.resNotifTickerText();
+            resNotifTitle = annotationConfig.resNotifTitle();
+            resToastText = annotationConfig.resToastText();
+            sharedPreferencesMode = annotationConfig.sharedPreferencesMode();
+            sharedPreferencesName = annotationConfig.sharedPreferencesName();
+            socketTimeout = annotationConfig.socketTimeout();
+            logcatFilterByPid = annotationConfig.logcatFilterByPid();
+            sendReportsInDevMode = annotationConfig.sendReportsInDevMode();
+            excludeMatchingSharedPreferencesKeys = annotationConfig.excludeMatchingSharedPreferencesKeys();
+            excludeMatchingSettingsKeys = annotationConfig.excludeMatchingSettingsKeys();
+            buildConfigClass = annotationConfig.buildConfigClass();
+            applicationLogFile = annotationConfig.applicationLogFile();
+            applicationLogFileLines = annotationConfig.applicationLogFileLines();
+            reportDialogClass = annotationConfig.reportDialogClass();
+            reportPrimerClass = annotationConfig.reportPrimerClass();
+            httpMethod = annotationConfig.httpMethod();
+            reportType = annotationConfig.reportType();
+            reportSenderFactoryClasses = annotationConfig.reportSenderFactoryClasses();
+            keyStoreFactoryClass = annotationConfig.keyStoreFactoryClass();
+            resCertificate = annotationConfig.resCertificate();
+            certificatePath = annotationConfig.certificatePath();
+            certificateType = annotationConfig.certificateType();
+            retryPolicyClass = annotationConfig.retryPolicyClass();
+        } else {
+            annotationType = null;
+        }
+    }
+
+    /**
+     * Builds the {@link ACRAConfiguration} which will be used to configure ACRA.
+     * <p>
+     * You can pass this {@link ConfigurationBuilder} to {@link ACRA#init(Application, ConfigurationBuilder)} and
+     * {@link ACRA#init(Application, ConfigurationBuilder)} will handle any Exception.
+     * </p>
+     * @return new ACRAConfiguration containing all the properties configured on this builder.
+     * @throws ACRAConfigurationException if the required values for the configured notification mode have not been provided.
+     */
+    @NonNull
+    public ACRAConfiguration build() throws ACRAConfigurationException {
+
+        switch (reportingInteractionMode()) {
+            case TOAST:
+                if (resToastText() == DEFAULT_RES_VALUE) {
+                    throw new ACRAConfigurationException("TOAST mode: you have to define the resToastText parameter in your application @ReportsCrashes() annotation.");
+                }
+                break;
+            case NOTIFICATION:
+                if (resNotifTickerText() == DEFAULT_RES_VALUE || resNotifTitle() == DEFAULT_RES_VALUE || resNotifText() == DEFAULT_RES_VALUE) {
+                    throw new ACRAConfigurationException("NOTIFICATION mode: you have to define at least the resNotifTickerText, resNotifTitle, resNotifText parameters in your application @ReportsCrashes() annotation.");
+                }
+                if (CrashReportDialog.class.equals(reportDialogClass()) && resDialogText() == DEFAULT_RES_VALUE) {
+                    throw new ACRAConfigurationException("NOTIFICATION mode: using the (default) CrashReportDialog requires you have to define the resDialogText parameter in your application @ReportsCrashes() annotation.");
+                }
+                break;
+            case DIALOG:
+                if (CrashReportDialog.class.equals(reportDialogClass()) && resDialogText() == DEFAULT_RES_VALUE) {
+                    throw new ACRAConfigurationException("DIALOG mode: using the (default) CrashReportDialog requires you to define the resDialogText parameter in your application @ReportsCrashes() annotation.");
+                }
+                break;
+            default:
+                break;
+        }
+
+        return new ACRAConfiguration(this);
+    }
+
+    /**
+     * Set custom HTTP headers to be sent by the provided {@link HttpSender}.
+     * This should be used also by third party senders.
+     *
+     * @param headers A map associating HTTP header names to their values.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setHttpHeaders(@NonNull Map<String, String> headers) {
+        this.httpHeaders.clear();
+        this.httpHeaders.putAll(headers);
+        return this;
+    }
+
+    /**
+     * @param additionalDropboxTags the additionalDropboxTags to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setAdditionalDropboxTags(@NonNull String... additionalDropboxTags) {
+        this.additionalDropBoxTags = additionalDropboxTags;
+        return this;
+    }
+
+    /**
+     * @param additionalSharedPreferences the additionalSharedPreferences to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setAdditionalSharedPreferences(@NonNull String... additionalSharedPreferences) {
+        this.additionalSharedPreferences = additionalSharedPreferences;
+        return this;
+    }
+
+    /**
+     * @param connectionTimeout the connectionTimeout to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setConnectionTimeout(int connectionTimeout) {
+        this.connectionTimeout = connectionTimeout;
+        return this;
+    }
+
+    /**
+     * @param customReportContent the customReportContent to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setCustomReportContent(@NonNull ReportField... customReportContent) {
+        this.customReportContent = customReportContent;
+        return this;
+    }
+
+    /**
+     * Use this if you want to keep the default configuration of reportContent, but set some fields explicitly.
+     *
+     * @param field  the field to set
+     * @param enable if this field should be reported
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setReportField(@NonNull ReportField field, boolean enable) {
+        this.reportContentChanges.put(field, enable);
+        return this;
+    }
+
+    /**
+     * @param deleteUnapprovedReportsOnApplicationStart the deleteUnapprovedReportsOnApplicationStart to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setDeleteUnapprovedReportsOnApplicationStart(boolean deleteUnapprovedReportsOnApplicationStart) {
+        this.deleteUnapprovedReportsOnApplicationStart = deleteUnapprovedReportsOnApplicationStart;
+        return this;
+    }
+
+    /**
+     * @param deleteOldUnsentReportsOnApplicationStart When to delete old (unsent) reports on startup.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setDeleteOldUnsentReportsOnApplicationStart(boolean deleteOldUnsentReportsOnApplicationStart) {
+        this.deleteOldUnsentReportsOnApplicationStart = deleteOldUnsentReportsOnApplicationStart;
+        return this;
+    }
+
+    /**
+     * @param dropboxCollectionMinutes the dropboxCollectionMinutes to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setDropboxCollectionMinutes(int dropboxCollectionMinutes) {
+        this.dropboxCollectionMinutes = dropboxCollectionMinutes;
+        return this;
+    }
+
+    /**
+     * @param alsoReportToAndroidFramework Whether to also report the failure to the Android framework.
+     *                                     NB this will cause the native force dialog dialog to be displayed
+     *                                     as well as any ACRA notification.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setAlsoReportToAndroidFramework(boolean alsoReportToAndroidFramework) {
+        this.alsoReportToAndroidFramework = alsoReportToAndroidFramework;
+        return this;
+    }
+
+    /**
+     * Modify the formUri of your backend server receiving reports.
+     *
+     * @param formUri formUri to set.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setFormUri(@Nullable String formUri) {
+        this.formUri = formUri;
+        return this;
+    }
+
+    /**
+     * @param formUriBasicAuthLogin the formUriBasicAuthLogin to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setFormUriBasicAuthLogin(@Nullable String formUriBasicAuthLogin) {
+        this.formUriBasicAuthLogin = formUriBasicAuthLogin;
+        return this;
+    }
+
+    /**
+     * @param formUriBasicAuthPassword the formUriBasicAuthPassword to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setFormUriBasicAuthPassword(@Nullable String formUriBasicAuthPassword) {
+        this.formUriBasicAuthPassword = formUriBasicAuthPassword;
+        return this;
+    }
+
+    /**
+     * @param includeDropboxSystemTags the includeDropboxSystemTags to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setIncludeDropboxSystemTags(boolean includeDropboxSystemTags) {
+        this.includeDropBoxSystemTags = includeDropboxSystemTags;
+        return this;
+    }
+
+    /**
+     * @param logcatArguments the logcatArguments to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setLogcatArguments(@NonNull String... logcatArguments) {
+        this.logcatArguments = logcatArguments;
+        return this;
+    }
+
+    /**
+     * Modify the mailTo of the mail account receiving reports.
+     *
+     * @param mailTo mailTo to set.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setMailTo(@Nullable String mailTo) {
+        this.mailTo = mailTo;
+        return this;
+    }
+
+    /**
+     * Change the current {@link ReportingInteractionMode}.
+     *
+     * @param mode ReportingInteractionMode to set.
+     * @return this instance
+     * @deprecated since 4.8.2 use {@link #setReportingInteractionMode(ReportingInteractionMode)} instead.
+     */
+    @NonNull
+    public ConfigurationBuilder setMode(@NonNull ReportingInteractionMode mode) {
+        this.reportingInteractionMode = mode;
+        return this;
+    }
+
+    /**
+     * Change the current {@link ReportingInteractionMode}.
+     *
+     * @param mode ReportingInteractionMode to set.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setReportingInteractionMode(@NonNull ReportingInteractionMode mode) {
+        this.reportingInteractionMode = mode;
+        return this;
+    }
+
+    @NonNull
+    public ConfigurationBuilder setResDialogPositiveButtonText(@StringRes int resId) {
+        resDialogPositiveButtonText = resId;
+        return this;
+    }
+
+    @NonNull
+    public ConfigurationBuilder setResDialogNegativeButtonText(@StringRes int resId) {
+        resDialogNegativeButtonText = resId;
+        return this;
+    }
+
+    @NonNull
+    public ConfigurationBuilder setReportDialogClass(@NonNull Class<? extends BaseCrashReportDialog> reportDialogClass) {
+        this.reportDialogClass = reportDialogClass;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resDialogCommentPrompt()} comes from an Android
+     * Library Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resDialogCommentPrompt()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResDialogCommentPrompt(@StringRes int resId) {
+        resDialogCommentPrompt = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resDialogEmailPrompt()} comes from an Android Library Project.
+     *
+     * @param resId The resource id, see
+     *              {@link ReportsCrashes#resDialogEmailPrompt()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResDialogEmailPrompt(@StringRes int resId) {
+        resDialogEmailPrompt = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resDialogIcon()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resDialogIcon()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResDialogIcon(@DrawableRes int resId) {
+        resDialogIcon = resId;
+        return this;
+    }
+
+    /**
+     * Use this method BEFORE if the id you wanted to give to
+     * {@link ReportsCrashes#resDialogOkToast()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resDialogOkToast()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResDialogOkToast(@StringRes int resId) {
+        resDialogOkToast = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resDialogText()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resDialogText()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResDialogText(@StringRes int resId) {
+        resDialogText = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resDialogTitle()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resDialogTitle()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResDialogTitle(@StringRes int resId) {
+        resDialogTitle = resId;
+        return this;
+    }
+
+    /**
+     * @param resId The resource id, see {@link ReportsCrashes#resDialogTheme()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResDialogTheme(@StyleRes int resId) {
+        resDialogTheme = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resNotifIcon()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resNotifIcon()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResNotifIcon(@DrawableRes int resId) {
+        resNotifIcon = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resNotifText()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resNotifText()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResNotifText(@StringRes int resId) {
+        resNotifText = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resNotifTickerText()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see
+     *              {@link ReportsCrashes#resNotifTickerText()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResNotifTickerText(@StringRes int resId) {
+        resNotifTickerText = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resNotifTitle()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resNotifTitle()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResNotifTitle(@StringRes int resId) {
+        resNotifTitle = resId;
+        return this;
+    }
+
+    /**
+     * Use this method if the id you wanted to give to
+     * {@link ReportsCrashes#resToastText()} comes from an Android Library
+     * Project.
+     *
+     * @param resId The resource id, see {@link ReportsCrashes#resToastText()}
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setResToastText(@StringRes int resId) {
+        resToastText = resId;
+        return this;
+    }
+
+    /**
+     * @param sharedPreferenceMode the sharedPreferenceMode to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setSharedPreferenceMode(int sharedPreferenceMode) {
+        this.sharedPreferencesMode = sharedPreferenceMode;
+        return this;
+    }
+
+    /**
+     * @param sharedPreferenceName the sharedPreferenceName to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setSharedPreferenceName(@NonNull String sharedPreferenceName) {
+        this.sharedPreferencesName = sharedPreferenceName;
+        return this;
+    }
+
+    /**
+     * @param socketTimeout the socketTimeout to set
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setSocketTimeout(int socketTimeout) {
+        this.socketTimeout = socketTimeout;
+        return this;
+    }
+
+    /**
+     * @param filterByPid true if you want to collect only logcat lines related to your
+     *                    application process.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setLogcatFilterByPid(boolean filterByPid) {
+        logcatFilterByPid = filterByPid;
+        return this;
+    }
+
+    /**
+     * @param sendReportsInDevMode false if you want to disable sending reports in development
+     *                             mode. Reports will be sent only on signed applications.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setSendReportsInDevMode(boolean sendReportsInDevMode) {
+        this.sendReportsInDevMode = sendReportsInDevMode;
+        return this;
+    }
+
+    /**
+     * @param sendReportsAtShutdown Ignored.
+     * @return this instance
+     * @deprecated since 4.8.3 no replacement. Now that we are using the SenderService in a separate process we always send at shutdown.
+     */
+    @NonNull
+    public ConfigurationBuilder setSendReportsAtShutdown(boolean sendReportsAtShutdown) {
+        return this;
+    }
+
+    /**
+     * @param excludeMatchingSharedPreferencesKeys an array of Strings containing regexp defining
+     *                                             SharedPreferences keys that should be excluded from the data
+     *                                             collection.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setExcludeMatchingSharedPreferencesKeys(@NonNull String... excludeMatchingSharedPreferencesKeys) {
+        this.excludeMatchingSharedPreferencesKeys = excludeMatchingSharedPreferencesKeys;
+        return this;
+    }
+
+    /**
+     * @param excludeMatchingSettingsKeys an array of Strings containing regexp defining
+     *                                    Settings.System, Settings.Secure and Settings.Global keys that
+     *                                    should be excluded from the data collection.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setExcludeMatchingSettingsKeys(@NonNull String... excludeMatchingSettingsKeys) {
+        this.excludeMatchingSettingsKeys = excludeMatchingSettingsKeys;
+        return this;
+    }
+
+    @NonNull
+    public ConfigurationBuilder setBuildConfigClass(@Nullable Class buildConfigClass) {
+        this.buildConfigClass = buildConfigClass;
+        return this;
+    }
+
+    /**
+     * @param applicationLogFile The path and file name of your application log file, to be
+     *                           used with {@link ReportField#APPLICATION_LOG}.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setApplicationLogFile(@NonNull String applicationLogFile) {
+        this.applicationLogFile = applicationLogFile;
+        return this;
+    }
+
+    /**
+     * @param applicationLogFileLines The number of lines of your application log to be collected,
+     *                                to be used with {@link ReportField#APPLICATION_LOG} and
+     *                                {@link ReportsCrashes#applicationLogFile()}.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setApplicationLogFileLines(int applicationLogFileLines) {
+        this.applicationLogFileLines = applicationLogFileLines;
+        return this;
+    }
+
+    /**
+     * @param httpMethod The method to be used to send data to the server.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setHttpMethod(@NonNull Method httpMethod) {
+        this.httpMethod = httpMethod;
+        return this;
+    }
+
+    /**
+     * @param type The type of content encoding to be used to send data to the
+     *             server.
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setReportType(@NonNull Type type) {
+        reportType = type;
+        return this;
+    }
+
+    /**
+     * @param keyStoreFactoryClass Set this to a factory class which creates a the keystore that contains the trusted certificates
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setKeyStoreFactoryClass(Class<?extends KeyStoreFactory> keyStoreFactoryClass) {
+        this.keyStoreFactoryClass = keyStoreFactoryClass;
+        return this;
+    }
+
+    /**
+     * @param resCertificate a raw resource of a custom certificate file
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setCertificate(@RawRes int resCertificate){
+        this.resCertificate = resCertificate;
+        return this;
+    }
+
+    /**
+     * @param certificatePath path to a custom trusted certificate. Must start with "asset://" if the file is in the assets folder
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setCertificate(@NonNull String certificatePath) {
+        this.certificatePath = certificatePath;
+        return this;
+    }
+
+    /**
+     * @param type custom certificate type
+     * @return this instance
+     */
+    @NonNull
+    public ConfigurationBuilder setCertificateType(@NonNull String type) {
+        this.certificateType = type;
+        return this;
+    }
+
+    @SafeVarargs
+    @NonNull
+    public final ConfigurationBuilder setReportSenderFactoryClasses(@NonNull Class<? extends ReportSenderFactory>... reportSenderFactoryClasses) {
+        this.reportSenderFactoryClasses = reportSenderFactoryClasses;
+        return this;
+    }
+
+    @NonNull
+    public ConfigurationBuilder setReportPrimerClass(@NonNull Class<? extends ReportPrimer> reportPrimerClass) {
+        this.reportPrimerClass = reportPrimerClass;
+        return this;
+    }
+
+    @NonNull
+    public ConfigurationBuilder setRetryPolicyClass(@NonNull Class<? extends RetryPolicy> retryPolicyClass) {
+        this.retryPolicyClass = retryPolicyClass;
+        return this;
+    }
+
+
+    // Getters - used to provide values and !DEFAULTS! to ACRConfiguration during construction
+
+    @NonNull
+    String[] additionalDropBoxTags() {
+        if (additionalDropBoxTags != null) {
+            return additionalDropBoxTags;
+        }
+        return new String[0];
+    }
+
+    @NonNull
+    String[] additionalSharedPreferences() {
+        if (additionalSharedPreferences != null) {
+            return additionalSharedPreferences;
+        }
+        return new String[0];
+    }
+
+    /**
+     * @deprecated since 4.8.1 no replacement.
+     */
+    @Nullable
+    Class<? extends Annotation> annotationType() {
+        return annotationType; // Why would this ever be needed?
+    }
+
+    int connectionTimeout() {
+        if (connectionTimeout != null) {
+            return connectionTimeout;
+        }
+        return DEFAULT_CONNECTION_TIMEOUT;
+    }
+
+    @NonNull
+    Set<ReportField> reportContent() {
+        final Set<ReportField> reportContent = new HashSet<ReportField>();
+        if (customReportContent != null && customReportContent.length != 0) {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Using custom Report Fields");
+            reportContent.addAll(Arrays.asList(customReportContent));
+        } else if (mailTo == null || DEFAULT_STRING_VALUE.equals(mailTo)) {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Using default Report Fields");
+            reportContent.addAll(Arrays.asList(DEFAULT_REPORT_FIELDS));
+        } else {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Using default Mail Report Fields");
+            reportContent.addAll(Arrays.asList(DEFAULT_MAIL_REPORT_FIELDS));
+        }
+
+        // Add or remove any extra fields.
+        for (Map.Entry<ReportField, Boolean> entry : reportContentChanges.entrySet()) {
+            if (entry.getValue()) {
+                reportContent.add(entry.getKey());
+            } else {
+                reportContent.remove(entry.getKey());
+            }
+        }
+        return reportContent;
+    }
+
+    boolean deleteUnapprovedReportsOnApplicationStart() {
+        if (deleteUnapprovedReportsOnApplicationStart != null) {
+            return deleteUnapprovedReportsOnApplicationStart;
+        }
+        return DEFAULT_DELETE_UNAPPROVED_REPORTS_ON_APPLICATION_START;
+    }
+
+    boolean deleteOldUnsentReportsOnApplicationStart() {
+        if (deleteOldUnsentReportsOnApplicationStart != null) {
+            return deleteOldUnsentReportsOnApplicationStart;
+        }
+        return DEFAULT_DELETE_OLD_UNSENT_REPORTS_ON_APPLICATION_START;
+    }
+
+    int dropboxCollectionMinutes() {
+        if (dropboxCollectionMinutes != null) {
+            return dropboxCollectionMinutes;
+        }
+        return DEFAULT_DROPBOX_COLLECTION_MINUTES;
+    }
+
+    boolean alsoReportToAndroidFramework() {
+        if (alsoReportToAndroidFramework != null) {
+            return alsoReportToAndroidFramework;
+        }
+        return DEFAULT_REPORT_TO_ANDROID_FRAMEWORK;
+    }
+
+    @NonNull
+    String formUri() {
+        if (formUri != null) {
+            return formUri;
+        }
+        return DEFAULT_STRING_VALUE;
+    }
+
+    @NonNull
+    String formUriBasicAuthLogin() {
+        if (formUriBasicAuthLogin != null) {
+            return formUriBasicAuthLogin;
+        }
+        return NULL_VALUE;
+    }
+
+    @NonNull
+    String formUriBasicAuthPassword() {
+        if (formUriBasicAuthPassword != null) {
+            return formUriBasicAuthPassword;
+        }
+        return NULL_VALUE;
+    }
+
+    boolean includeDropBoxSystemTags() {
+        if (includeDropBoxSystemTags != null) {
+            return includeDropBoxSystemTags;
+        }
+        return DEFAULT_INCLUDE_DROPBOX_SYSTEM_TAGS;
+    }
+
+    @NonNull
+    String[] logcatArguments() {
+        if (logcatArguments != null) {
+            return logcatArguments;
+        }
+        return new String[]{"-t", Integer.toString(DEFAULT_LOGCAT_LINES), "-v", "time"};
+    }
+
+    @NonNull
+    String mailTo() {
+        if (mailTo != null) {
+            return mailTo;
+        }
+        return DEFAULT_STRING_VALUE;
+    }
+
+    @NonNull
+    ReportingInteractionMode reportingInteractionMode() {
+        if (reportingInteractionMode != null) {
+            return reportingInteractionMode;
+        }
+        return ReportingInteractionMode.SILENT;
+    }
+
+    @StringRes
+    public int resDialogPositiveButtonText() {
+        if (resDialogPositiveButtonText != null) {
+            return resDialogPositiveButtonText;
+        }
+        return DEFAULT_DIALOG_POSITIVE_BUTTON_TEXT;
+    }
+
+    @StringRes
+    int resDialogNegativeButtonText() {
+        if (resDialogNegativeButtonText != null) {
+            return resDialogNegativeButtonText;
+        }
+        return DEFAULT_DIALOG_NEGATIVE_BUTTON_TEXT;
+    }
+
+    @StringRes
+    int resDialogCommentPrompt() {
+        if (resDialogCommentPrompt != null) {
+            return resDialogCommentPrompt;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @StringRes
+    int resDialogEmailPrompt() {
+        if (resDialogEmailPrompt != null) {
+            return resDialogEmailPrompt;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @DrawableRes
+    int resDialogIcon() {
+        if (resDialogIcon != null) {
+            return resDialogIcon;
+        }
+        return DEFAULT_DIALOG_ICON;
+    }
+
+    @StringRes
+    int resDialogOkToast() {
+        if (resDialogOkToast != null) {
+            return resDialogOkToast;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @StringRes
+    int resDialogText() {
+        if (resDialogText != null) {
+            return resDialogText;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @StringRes
+    int resDialogTitle() {
+        if (resDialogTitle != null) {
+            return resDialogTitle;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @StyleRes
+    int resDialogTheme() {
+        if (resDialogTheme != null) {
+            return resDialogTheme;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @DrawableRes
+    int resNotifIcon() {
+        if (resNotifIcon != null) {
+            return resNotifIcon;
+        }
+        return DEFAULT_NOTIFICATION_ICON;
+    }
+
+    @StringRes
+    int resNotifText() {
+        if (resNotifText != null) {
+            return resNotifText;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @StringRes
+    int resNotifTickerText() {
+        if (resNotifTickerText != null) {
+            return resNotifTickerText;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @StringRes
+    int resNotifTitle() {
+        if (resNotifTitle != null) {
+            return resNotifTitle;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @StringRes
+    int resToastText() {
+        if (resToastText != null) {
+            return resToastText;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    int sharedPreferencesMode() {
+        if (sharedPreferencesMode != null) {
+            return sharedPreferencesMode;
+        }
+        return DEFAULT_SHARED_PREFERENCES_MODE;
+    }
+
+    @NonNull
+    String sharedPreferencesName() {
+        if (sharedPreferencesName != null) {
+            return sharedPreferencesName;
+        }
+
+        return DEFAULT_STRING_VALUE;
+    }
+
+    int socketTimeout() {
+        if (socketTimeout != null) {
+            return socketTimeout;
+        }
+        return DEFAULT_SOCKET_TIMEOUT;
+    }
+
+    boolean logcatFilterByPid() {
+        if (logcatFilterByPid != null) {
+            return logcatFilterByPid;
+        }
+        return DEFAULT_LOGCAT_FILTER_BY_PID;
+    }
+
+    boolean sendReportsInDevMode() {
+        if (sendReportsInDevMode != null) {
+            return sendReportsInDevMode;
+        }
+        return DEFAULT_SEND_REPORTS_IN_DEV_MODE;
+    }
+
+    @NonNull
+    String[] excludeMatchingSharedPreferencesKeys() {
+        if (excludeMatchingSharedPreferencesKeys != null) {
+            return excludeMatchingSharedPreferencesKeys;
+        }
+        return new String[0];
+    }
+
+    @NonNull
+    String[] excludeMatchingSettingsKeys() {
+        if (excludeMatchingSettingsKeys != null) {
+            return excludeMatchingSettingsKeys;
+        }
+        return new String[0];
+    }
+
+    /**
+     * Will return {@link Object} if no value has been configured.
+     * It is up to clients to construct the recommended default value of context.getClass().getPackage().getName() + BuildConfig.class
+     */
+    @NonNull
+    Class buildConfigClass() {
+        if(buildConfigClass != null) {
+            return buildConfigClass;
+        }
+        return Object.class;
+    }
+
+    @NonNull
+    String applicationLogFile() {
+        if (applicationLogFile != null) {
+            return applicationLogFile;
+        }
+        return DEFAULT_APPLICATION_LOGFILE;
+    }
+
+    int applicationLogFileLines() {
+        if (applicationLogFileLines != null) {
+            return applicationLogFileLines;
+        }
+        return DEFAULT_APPLICATION_LOGFILE_LINES;
+    }
+
+    @NonNull
+    Class<? extends BaseCrashReportDialog> reportDialogClass() {
+        if (reportDialogClass != null) {
+            return reportDialogClass;
+        }
+        return CrashReportDialog.class;
+    }
+
+    @NonNull
+    Class<? extends ReportPrimer> reportPrimerClass() {
+        if (reportPrimerClass != null) {
+            return reportPrimerClass;
+        }
+        return NoOpReportPrimer.class;
+    }
+
+    @NonNull
+    Method httpMethod() {
+        if (httpMethod != null) {
+            return httpMethod;
+        }
+        return Method.POST;
+    }
+
+    @NonNull
+    Type reportType() {
+        if (reportType != null) {
+            return reportType;
+        }
+        return Type.FORM;
+    }
+
+    @NonNull
+    Class<? extends ReportSenderFactory>[] reportSenderFactoryClasses() {
+        if (reportSenderFactoryClasses != null) {
+            return reportSenderFactoryClasses;
+        }
+        //noinspection unchecked
+        return new Class[]{DefaultReportSenderFactory.class};
+    }
+
+    @NonNull
+    Class<? extends KeyStoreFactory> keyStoreFactoryClass() {
+        if(keyStoreFactoryClass != null) {
+            return keyStoreFactoryClass;
+        }
+        return NoKeyStoreFactory.class;
+    }
+
+    @RawRes
+    int resCertificate() {
+        if(resCertificate != null){
+            return resCertificate;
+        }
+        return DEFAULT_RES_VALUE;
+    }
+
+    @NonNull
+    String certificatePath() {
+        if(certificatePath != null){
+            return certificatePath;
+        }
+        return DEFAULT_STRING_VALUE;
+    }
+
+    @NonNull
+    String certificateType() {
+        if(certificateType != null){
+            return certificateType;
+        }
+        return DEFAULT_CERTIFICATE_TYPE;
+    }
+
+    @NonNull
+    Map<String, String> httpHeaders() {
+        return httpHeaders;
+    }
+
+    @NonNull
+    Class<? extends RetryPolicy> retryPolicyClass(){
+        if(retryPolicyClass != null){
+            return retryPolicyClass;
+        }
+        return DefaultRetryPolicy.class;
+    }
+}
diff --git a/src/main/java/org/acra/config/DefaultRetryPolicy.java b/src/main/java/org/acra/config/DefaultRetryPolicy.java
new file mode 100644
index 00000000..d03639cf
--- /dev/null
+++ b/src/main/java/org/acra/config/DefaultRetryPolicy.java
@@ -0,0 +1,33 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.config;
+
+import org.acra.sender.ReportSender;
+
+import java.util.List;
+
+/**
+ * Default {@link RetryPolicy}. Only resend if all senders failed.
+ *
+ * @author F43nd1r
+ * @since 4.9.1
+ */
+public class DefaultRetryPolicy implements RetryPolicy {
+    @Override
+    public boolean shouldRetrySend(List<ReportSender> senders, List<FailedSender> failedSenders) {
+        return (senders.size() == failedSenders.size()) && !senders.isEmpty();
+    }
+}
diff --git a/src/main/java/org/acra/config/RetryPolicy.java b/src/main/java/org/acra/config/RetryPolicy.java
new file mode 100644
index 00000000..b27b24ee
--- /dev/null
+++ b/src/main/java/org/acra/config/RetryPolicy.java
@@ -0,0 +1,56 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.config;
+
+import org.acra.sender.ReportSender;
+import org.acra.sender.ReportSenderException;
+
+import java.util.List;
+
+/**
+ * A policy which determines if a report should be resent.
+ *
+ * @author F43nd1r
+ * @since 4.9.1
+ */
+public interface RetryPolicy {
+
+    /**
+     * @param senders a list of all senders.
+     * @param failedSenders a list of all failed senders with the thrown exceptions.
+     * @return <code>true</code> if the request should be resent later, otherwise <code>false</code>.
+     */
+    boolean shouldRetrySend(List<ReportSender> senders, List<FailedSender> failedSenders);
+
+    class FailedSender {
+
+        private final ReportSender sender;
+        private final ReportSenderException exception;
+
+        public FailedSender(ReportSender sender, ReportSenderException exception) {
+            this.sender = sender;
+            this.exception = exception;
+        }
+
+        public ReportSender getSender() {
+            return sender;
+        }
+
+        public ReportSenderException getException() {
+            return exception;
+        }
+    }
+}
diff --git a/src/main/java/org/acra/dialog/BaseCrashReportDialog.java b/src/main/java/org/acra/dialog/BaseCrashReportDialog.java
new file mode 100644
index 00000000..2e4e29ac
--- /dev/null
+++ b/src/main/java/org/acra/dialog/BaseCrashReportDialog.java
@@ -0,0 +1,140 @@
+package org.acra.dialog;
+
+import android.app.Activity;
+import android.os.Bundle;
+import android.support.annotation.Nullable;
+import android.widget.Toast;
+
+import org.acra.ACRA;
+import org.acra.ACRAConstants;
+import org.acra.collector.CrashReportData;
+import org.acra.config.ACRAConfiguration;
+import org.acra.file.BulkReportDeleter;
+import org.acra.file.CrashReportPersister;
+import org.acra.sender.SenderServiceStarter;
+import org.acra.util.ToastSender;
+
+import java.io.File;
+import java.io.IOException;
+import java.io.Serializable;
+
+import static org.acra.ACRA.LOG_TAG;
+import static org.acra.ReportField.USER_COMMENT;
+import static org.acra.ReportField.USER_EMAIL;
+
+/**
+ * Activity which implements the base functionality for a CrashReportDialog.
+ *
+ * Activities which extend from this class can override init to create a custom view.
+ *
+ * The methods sendCrash(comment, userEmail) and cancelReports() can be used to send or cancel
+ * sending of reports respectively.
+ *
+ * This Activity will be instantiated with 3 (or 4) arguments:
+ * <ol>
+ * <li>{@link ACRAConstants#EXTRA_REPORT_FILE_NAME}</li>
+ * <li>{@link ACRAConstants#EXTRA_REPORT_EXCEPTION}</li>
+ * <li>{@link ACRAConstants#EXTRA_REPORT_CONFIG}</li>
+ * <li>{@link ACRAConstants#EXTRA_FORCE_CANCEL} (optional)</li>
+ * </ol>
+ */
+@SuppressWarnings({"WeakerAccess", "unused"})
+public abstract class BaseCrashReportDialog extends Activity {
+
+    private File reportFile;
+    private ACRAConfiguration config;
+    private Throwable exception;
+
+    /**
+     * NB if you were previously creating and showing your dialog in this method,
+     * you should move that code to {@link #init(Bundle)}.
+     *
+     * @param savedInstanceState    If the activity is being re-initialized after
+     *     previously being shut down then this Bundle contains the data it most
+     *     recently supplied in {@link #onSaveInstanceState}.  <b><i>Note: Otherwise it is null.</i></b>
+     */
+    @Override
+    protected final void onCreate(@Nullable Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+
+
+        if (ACRA.DEV_LOGGING) {
+            ACRA.log.d(LOG_TAG, "CrashReportDialog extras=" + getIntent().getExtras());
+        }
+
+        final Serializable sConfig = getIntent().getSerializableExtra(ACRAConstants.EXTRA_REPORT_CONFIG);
+        final Serializable sReportFile = getIntent().getSerializableExtra(ACRAConstants.EXTRA_REPORT_FILE);
+        final Serializable sException = getIntent().getSerializableExtra(ACRAConstants.EXTRA_REPORT_EXCEPTION);
+        final boolean forceCancel = getIntent().getBooleanExtra(ACRAConstants.EXTRA_FORCE_CANCEL, false);
+
+        if (forceCancel) {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Forced reports deletion.");
+            cancelReports();
+            finish();
+        } else if ((sConfig instanceof ACRAConfiguration) && (sReportFile instanceof File) && ((sException instanceof Throwable) || sException == null)) {
+            config = (ACRAConfiguration) sConfig;
+            reportFile = (File) sReportFile;
+            exception = (Throwable) sException;
+            init(savedInstanceState);
+        } else {
+            ACRA.log.w(LOG_TAG, "Illegal or incomplete call of BaseCrashReportDialog.");
+            finish();
+        }
+    }
+
+    /**
+     * Responsible for creating and showing the crash report dialog.
+     *
+     * @param savedInstanceState    If the activity is being re-initialized after
+     *     previously being shut down then this Bundle contains the data it most
+     *     recently supplied in {@link #onSaveInstanceState}.  <b><i>Note: Otherwise it is null.</i></b>
+     */
+    protected void init(@Nullable Bundle savedInstanceState) {
+    }
+
+
+    /**
+     * Cancel any pending crash reports.
+     */
+    protected final void cancelReports() {
+        new BulkReportDeleter(getApplicationContext()).deleteReports(false, 0);
+    }
+
+
+    /**
+     * Send crash report given user's comment and email address. If none should be empty strings
+     *
+     * @param comment   Comment (may be null) provided by the user.
+     * @param userEmail Email address (may be null) provided by the client.
+     */
+    protected final void sendCrash(@Nullable String comment, @Nullable String userEmail) {
+        final CrashReportPersister persister = new CrashReportPersister();
+        try {
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Add user comment to " + reportFile);
+            final CrashReportData crashData = persister.load(reportFile);
+            crashData.put(USER_COMMENT, comment == null ? "" : comment);
+            crashData.put(USER_EMAIL, userEmail == null ? "" : userEmail);
+            persister.store(crashData, reportFile);
+        } catch (IOException e) {
+            ACRA.log.w(LOG_TAG, "User comment not added: ", e);
+        }
+
+        // Start the report sending task
+        final SenderServiceStarter starter = new SenderServiceStarter(getApplicationContext(), config);
+        starter.startService(false, true);
+
+        // Optional Toast to thank the user
+        final int toastId = config.resDialogOkToast();
+        if (toastId != 0) {
+            ToastSender.sendToast(getApplicationContext(), toastId, Toast.LENGTH_LONG);
+        }
+    }
+
+    protected final ACRAConfiguration getConfig() {
+        return config;
+    }
+
+    protected final Throwable getException() {
+        return exception;
+    }
+}
diff --git a/src/main/java/org/acra/dialog/CrashReportDialog.java b/src/main/java/org/acra/dialog/CrashReportDialog.java
new file mode 100644
index 00000000..59da57a9
--- /dev/null
+++ b/src/main/java/org/acra/dialog/CrashReportDialog.java
@@ -0,0 +1,258 @@
+package org.acra.dialog;
+
+import android.app.AlertDialog;
+import android.content.DialogInterface;
+import android.content.SharedPreferences;
+import android.os.Bundle;
+import android.support.annotation.CallSuper;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.InputType;
+import android.view.View;
+import android.view.ViewGroup.LayoutParams;
+import android.widget.EditText;
+import android.widget.LinearLayout;
+import android.widget.ScrollView;
+import android.widget.TextView;
+
+import org.acra.ACRA;
+import org.acra.ACRAConstants;
+import org.acra.prefs.SharedPreferencesFactory;
+
+
+/**
+ * This is the dialog Activity used by ACRA to get authorization from the user
+ * to send reports. Requires android:launchMode="singleInstance" in your
+ * AndroidManifest to work properly.
+ **/
+@SuppressWarnings({"WeakerAccess", "unused"})
+public class CrashReportDialog extends BaseCrashReportDialog implements DialogInterface.OnClickListener {
+
+    private static final String STATE_EMAIL = "email";
+    private static final String STATE_COMMENT = "comment";
+    private static final int PADDING = 10;
+
+    private LinearLayout scrollable;
+    private EditText userCommentView;
+    private EditText userEmailView;
+    private SharedPreferencesFactory sharedPreferencesFactory;
+
+    private AlertDialog mDialog;
+
+    @CallSuper
+    @Override
+    protected void init(@Nullable Bundle savedInstanceState) {
+        scrollable = new LinearLayout(this);
+        scrollable.setOrientation(LinearLayout.VERTICAL);
+        sharedPreferencesFactory = new SharedPreferencesFactory(getApplicationContext(), getConfig());
+        final int themeResourceId = getConfig().resDialogTheme();
+        if(themeResourceId != ACRAConstants.DEFAULT_RES_VALUE) setTheme(themeResourceId);
+
+        buildAndShowDialog(savedInstanceState);
+    }
+
+    /**
+     * Build the dialog from the values in config
+     *
+     * @param savedInstanceState old state to restore
+     */
+    protected void buildAndShowDialog(@Nullable Bundle savedInstanceState) {
+        final AlertDialog.Builder dialogBuilder = new AlertDialog.Builder(this);
+        final int titleResourceId = getConfig().resDialogTitle();
+        if (titleResourceId != ACRAConstants.DEFAULT_RES_VALUE) {
+            dialogBuilder.setTitle(titleResourceId);
+        }
+        final int iconResourceId = getConfig().resDialogIcon();
+        if (iconResourceId != ACRAConstants.DEFAULT_RES_VALUE) {
+            dialogBuilder.setIcon(iconResourceId);
+        }
+        dialogBuilder.setView(buildCustomView(savedInstanceState))
+                .setPositiveButton(getText(getConfig().resDialogPositiveButtonText()), this)
+                .setNegativeButton(getText(getConfig().resDialogNegativeButtonText()), this);
+
+        mDialog = dialogBuilder.create();
+        mDialog.setCanceledOnTouchOutside(false);
+        mDialog.show();
+    }
+
+    @NonNull
+    protected View buildCustomView(@Nullable Bundle savedInstanceState) {
+        final ScrollView root = new ScrollView(this);
+        root.setPadding(PADDING, PADDING, PADDING, PADDING);
+        root.setLayoutParams(new LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT));
+        root.setFocusable(true);
+        root.setFocusableInTouchMode(true);
+        root.addView(scrollable);
+
+        addViewToDialog(getMainView());
+
+        // Add an optional prompt for user comments
+        final View comment = getCommentLabel();
+        if (comment != null) {
+            comment.setPadding(comment.getPaddingLeft(), PADDING, comment.getPaddingRight(), comment.getPaddingBottom());
+            addViewToDialog(comment);
+            String savedComment = null;
+            if (savedInstanceState != null) {
+                savedComment = savedInstanceState.getString(STATE_COMMENT);
+            }
+            userCommentView = getCommentPrompt(savedComment);
+            addViewToDialog(userCommentView);
+        }
+
+        // Add an optional user email field
+        final View email = getEmailLabel();
+        if (email != null) {
+            email.setPadding(email.getPaddingLeft(), PADDING, email.getPaddingRight(), email.getPaddingBottom());
+            addViewToDialog(email);
+            String savedEmail = null;
+            if (savedInstanceState != null) {
+                savedEmail = savedInstanceState.getString(STATE_EMAIL);
+            }
+            userEmailView = getEmailPrompt(savedEmail);
+            addViewToDialog(userEmailView);
+        }
+        return root;
+    }
+
+    /**
+     * adds a view to the end of the dialog
+     *
+     * @param v the view to add
+     */
+    protected final void addViewToDialog(@NonNull View v) {
+        scrollable.addView(v);
+    }
+
+    /**
+     * Creates a main view containing text of resDialogText, or nothing if not found
+     *
+     * @return the main view
+     */
+    @NonNull
+    protected View getMainView() {
+        final TextView text = new TextView(this);
+        final int dialogTextId = getConfig().resDialogText();
+        if (dialogTextId != ACRAConstants.DEFAULT_RES_VALUE) {
+            text.setText(getText(dialogTextId));
+        }
+        return text;
+    }
+
+    /**
+     * creates a comment label view with resDialogCommentPrompt as text
+     *
+     * @return the label or null if there is no resource
+     */
+    @Nullable
+    protected View getCommentLabel() {
+        final int commentPromptId = getConfig().resDialogCommentPrompt();
+        if (commentPromptId != ACRAConstants.DEFAULT_RES_VALUE) {
+            final TextView labelView = new TextView(this);
+            labelView.setText(getText(commentPromptId));
+            return labelView;
+        }
+        return null;
+    }
+
+    /**
+     * creates a comment prompt
+     *
+     * @param savedComment the content of the prompt (usually from a saved state)
+     * @return the comment prompt
+     */
+    @NonNull
+    protected EditText getCommentPrompt(@Nullable CharSequence savedComment) {
+        final EditText userCommentView = new EditText(this);
+        userCommentView.setLines(2);
+        if (savedComment != null) {
+            userCommentView.setText(savedComment);
+        }
+        return userCommentView;
+    }
+
+    /**
+     * creates a email label view with resDialogEmailPrompt as text
+     *
+     * @return the label or null if there is no resource
+     */
+    @Nullable
+    protected View getEmailLabel() {
+        final int emailPromptId = getConfig().resDialogEmailPrompt();
+        if (emailPromptId != ACRAConstants.DEFAULT_RES_VALUE) {
+            final TextView labelView = new TextView(this);
+            labelView.setText(getText(emailPromptId));
+            return labelView;
+        }
+        return null;
+    }
+
+    /**
+     * creates an email prompt
+     *
+     * @param savedEmail the content of the prompt (usually from a saved state or settings)
+     * @return the email prompt
+     */
+    @NonNull
+    protected EditText getEmailPrompt(@Nullable CharSequence savedEmail) {
+        final EditText userEmailView = new EditText(this);
+        userEmailView.setSingleLine();
+        userEmailView.setInputType(InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_EMAIL_ADDRESS);
+
+        if (savedEmail != null) {
+            userEmailView.setText(savedEmail);
+        } else {
+            final SharedPreferences prefs = sharedPreferencesFactory.create();
+            userEmailView.setText(prefs.getString(ACRA.PREF_USER_EMAIL_ADDRESS, ""));
+        }
+        return userEmailView;
+    }
+
+    @Override
+    public void onClick(DialogInterface dialog, int which) {
+        if (which == DialogInterface.BUTTON_POSITIVE) {
+            // Retrieve user comment
+            final String comment = userCommentView != null ? userCommentView.getText().toString() : "";
+
+            // Store the user email
+            final String userEmail;
+            final SharedPreferences prefs = sharedPreferencesFactory.create();
+            if (userEmailView != null) {
+                userEmail = userEmailView.getText().toString();
+                final SharedPreferences.Editor prefEditor = prefs.edit();
+                prefEditor.putString(ACRA.PREF_USER_EMAIL_ADDRESS, userEmail);
+                prefEditor.commit();
+            } else {
+                userEmail = prefs.getString(ACRA.PREF_USER_EMAIL_ADDRESS, "");
+            }
+            sendCrash(comment, userEmail);
+        } else {
+            cancelReports();
+        }
+
+        finish();
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see android.app.Activity#onSaveInstanceState(android.os.Bundle)
+     */
+    @CallSuper
+    @Override
+    protected void onSaveInstanceState(@NonNull Bundle outState) {
+        super.onSaveInstanceState(outState);
+        if (userCommentView != null && userCommentView.getText() != null) {
+            outState.putString(STATE_COMMENT, userCommentView.getText().toString());
+        }
+        if (userEmailView != null && userEmailView.getText() != null) {
+            outState.putString(STATE_EMAIL, userEmailView.getText().toString());
+        }
+    }
+
+    /**
+     * @return the AlertDialog displayed by this Activity
+     */
+    protected AlertDialog getDialog() {
+        return mDialog;
+    }
+}
\ No newline at end of file
diff --git a/src/main/java/org/acra/file/BulkReportDeleter.java b/src/main/java/org/acra/file/BulkReportDeleter.java
new file mode 100644
index 00000000..edc9b6b1
--- /dev/null
+++ b/src/main/java/org/acra/file/BulkReportDeleter.java
@@ -0,0 +1,40 @@
+package org.acra.file;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+
+import java.io.File;
+import java.util.Arrays;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Deletes unsent reports.
+ */
+public final class BulkReportDeleter {
+
+    @NonNull
+    private final ReportLocator reportLocator;
+
+    public BulkReportDeleter(@NonNull Context context) {
+        this.reportLocator = new ReportLocator(context);
+    }
+
+    /**
+     * @param approved  Whether to delete approved or unapproved reports.
+     * @param nrToKeep  Number of latest reports to keep.
+     */
+    public void deleteReports(boolean approved, int nrToKeep) {
+        final File[] files = approved ? reportLocator.getApprovedReports() : reportLocator.getUnapprovedReports();
+
+        Arrays.sort(files, new LastModifiedComparator());
+
+        for (int i = 0; i < files.length - nrToKeep; i++) {
+            if (!files[i].delete()) {
+                ACRA.log.w(LOG_TAG, "Could not delete report : " + files[i]);
+            }
+        }
+    }
+}
diff --git a/src/main/java/org/acra/CrashReportFileNameParser.java b/src/main/java/org/acra/file/CrashReportFileNameParser.java
similarity index 84%
rename from src/main/java/org/acra/CrashReportFileNameParser.java
rename to src/main/java/org/acra/file/CrashReportFileNameParser.java
index 609906d0..91b64642 100644
--- a/src/main/java/org/acra/CrashReportFileNameParser.java
+++ b/src/main/java/org/acra/file/CrashReportFileNameParser.java
@@ -1,52 +1,57 @@
-/*
- *  Copyright 2012 Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra;
-
-/**
- * Responsible for determining the state of a Crash Report based on its file name.
- * <p/>
- * @author William Ferguson
- * @since 4.3.0
- */
-final class CrashReportFileNameParser {
-
-    /**
-     * Guess that a report is silent from its file name.
-     *
-     * @param reportFileName    Name of the report to check whether it should be sent silently.
-     * @return True if the report has been declared explicitly silent using {@link ErrorReporter#handleSilentException(Throwable)}.
-     */
-    public boolean isSilent(String reportFileName) {
-        return reportFileName.contains(ACRAConstants.SILENT_SUFFIX);
-    }
-
-    /**
-     * Returns true if the report is considered as approved.
-     * <p>
-          This includes:
-     * </p>
-     * <ul>
-     * <li>Reports which were pending when the user agreed to send a report in the NOTIFICATION mode Dialog.</li>
-     * <li>Explicit silent reports</li>
-     * </ul>
-     *
-     * @param reportFileName    Name of report to check whether it is approved to be sent.
-     * @return True if a report can be sent.
-     */
-    public boolean isApproved(String reportFileName) {
-        return isSilent(reportFileName) || reportFileName.contains(ACRAConstants.APPROVED_SUFFIX);
-    }
-}
+/*
+ *  Copyright 2012 Kevin Gaudin
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.file;
+
+import android.support.annotation.NonNull;
+
+import org.acra.ACRAConstants;
+import org.acra.ErrorReporter;
+
+/**
+ * Responsible for determining the state of a Crash Report based on its file name.
+ *
+ * @author William Ferguson
+ * @since 4.3.0
+ */
+public final class CrashReportFileNameParser {
+
+    /**
+     * Guess that a report is silent from its file name.
+     *
+     * @param reportFileName    Name of the report to check whether it should be sent silently.
+     * @return True if the report has been declared explicitly silent using {@link ErrorReporter#handleSilentException(Throwable)}.
+     */
+    public boolean isSilent(@NonNull String reportFileName) {
+        return reportFileName.contains(ACRAConstants.SILENT_SUFFIX);
+    }
+
+    /**
+     * Returns true if the report is considered as approved.
+     * <p>
+          This includes:
+     * </p>
+     * <ul>
+     * <li>Reports which were pending when the user agreed to send a report in the NOTIFICATION mode Dialog.</li>
+     * <li>Explicit silent reports</li>
+     * </ul>
+     *
+     * @param reportFileName    Name of report to check whether it is approved to be sent.
+     * @return True if a report can be sent.
+     */
+    public boolean isApproved(@NonNull String reportFileName) {
+        return isSilent(reportFileName) || reportFileName.contains(ACRAConstants.APPROVED_SUFFIX);
+    }
+}
diff --git a/src/main/java/org/acra/file/CrashReportPersister.java b/src/main/java/org/acra/file/CrashReportPersister.java
new file mode 100644
index 00000000..3be7836e
--- /dev/null
+++ b/src/main/java/org/acra/file/CrashReportPersister.java
@@ -0,0 +1,340 @@
+/*
+ * java.util.Properties.java modified by Kevin Gaudin to allow usage of enums as keys.
+ *
+ *  Licensed to the Apache Software Foundation (ASF) under one or more
+ *  contributor license agreements.  See the NOTICE file distributed with
+ *  this work for additional information regarding copyright ownership.
+ *  The ASF licenses this file to You under the Apache License, Version 2.0
+ *  (the "License"); you may not use this file except in compliance with
+ *  the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+
+package org.acra.file;
+
+import android.support.annotation.NonNull;
+
+import org.acra.ACRAConstants;
+import org.acra.ReportField;
+import org.acra.util.IOUtils;
+import org.acra.collector.CrashReportData;
+
+import java.io.*;
+import java.util.Map;
+
+/**
+ * Stores a crash reports data with {@link org.acra.ReportField} enum values as keys.
+ * This is basically the source of {@link java.util.Properties} adapted to extend an
+ * EnumMap instead of Hashtable and with a few tweaks to avoid losing crazy
+ * amounts of android time in the generation of a date comment when storing to
+ * file.
+ */
+public final class CrashReportPersister {
+
+    private static final int NONE = 0, SLASH = 1, UNICODE = 2, CONTINUE = 3, KEY_DONE = 4, IGNORE = 5;
+    private static final String LINE_SEPARATOR = "\n";
+
+    /**
+     * Loads properties from the specified {@code InputStream}. The encoding is ISO8859-1.
+     *
+     * @param file  Report file from which to load the CrashData.
+     * @return CrashReportData read from the supplied InputStream.
+     * @throws java.io.IOException if error occurs during reading from the {@code InputStream}.
+     */
+    @NonNull
+    public CrashReportData load(@NonNull File file) throws IOException {
+
+        final InputStream in = new BufferedInputStream(new FileInputStream(file), ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES);
+        try {
+            return load(new InputStreamReader(in, "ISO8859-1")); //$NON-NLS-1$
+        } finally {
+            IOUtils.safeClose(in);
+        }
+    }
+
+    /**
+     * Stores the mappings in this Properties to the specified OutputStream,
+     * putting the specified comment at the beginning. The output from this
+     * method is suitable for being read by the load() method.
+     *
+     * @param crashData     CrashReportData to save.
+     * @param file          File into which to store the CrashReportData.
+     * @throws java.io.IOException if the CrashReportData could not be written to the OutputStream.
+     */
+    public void store(@NonNull CrashReportData crashData, @NonNull File file) throws IOException {
+
+        final OutputStreamWriter writer = new OutputStreamWriter(new FileOutputStream(file), "ISO8859_1"); //$NON-NLS-1$
+        try {
+            final StringBuilder buffer = new StringBuilder(200);
+
+            for (final Map.Entry<ReportField, String> entry : crashData.entrySet()) {
+                final String key = entry.getKey().toString();
+                dumpString(buffer, key, true);
+                buffer.append('=');
+                dumpString(buffer, entry.getValue(), false);
+                buffer.append(LINE_SEPARATOR);
+                writer.write(buffer.toString());
+                buffer.setLength(0);
+            }
+            writer.flush();
+        } finally {
+            IOUtils.safeClose(writer);
+        }
+    }
+
+    /**
+     * Loads properties from the specified InputStream. The properties are of
+     * the form <code>key=value</code>, one property per line. It may be not
+     * encode as 'ISO-8859-1'.The {@code Properties} file is interpreted
+     * according to the following rules:
+     * <ul>
+     * <li>Empty lines are ignored.</li>
+     * <li>Lines starting with either a "#" or a "!" are comment lines and are
+     * ignored.</li>
+     * <li>A backslash at the end of the line escapes the following newline
+     * character ("\r", "\n", "\r\n"). If there's a whitespace after the
+     * backslash it will just escape that whitespace instead of concatenating
+     * the lines. This does not apply to comment lines.</li>
+     * <li>A property line consists of the key, the space between the key and
+     * the value, and the value. The key goes up to the first whitespace, "=" or
+     * ":" that is not escaped. The space between the key and the value contains
+     * either one whitespace, one "=" or one ":" and any number of additional
+     * whitespaces before and after that character. The value starts with the
+     * first character after the space between the key and the value.</li>
+     * <li>Following escape sequences are recognized: "\ ", "\\", "\r", "\n",
+     * "\!", "\#", "\t", "\b", "\f", and "&#92;uXXXX" (unicode character).</li>
+     * </ul>
+     *
+     * @param reader    Reader from which to read the properties of this CrashReportData.
+     * @return CrashReportData read from the supplied Reader.
+     * @throws java.io.IOException if the properties could not be read.
+     * @since 1.6
+     */
+    @NonNull
+    private synchronized CrashReportData load(@NonNull Reader reader) throws IOException {
+        int mode = NONE, unicode = 0, count = 0;
+        char nextChar;
+        char[] buf = new char[40]; //TODO: consider using a list instead of manually increasing the size when needed
+        int offset = 0, keyLength = -1, intVal;
+        boolean firstChar = true;
+
+        final CrashReportData crashData = new CrashReportData();
+        final BufferedReader br = new BufferedReader(reader, ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES);
+        try {
+            while (true) {
+                intVal = br.read();
+                if (intVal == -1) {
+                    break;
+                }
+                nextChar = (char) intVal;
+
+                if (offset == buf.length) {
+                    final char[] newBuf = new char[buf.length * 2];
+                    System.arraycopy(buf, 0, newBuf, 0, offset);
+                    buf = newBuf;
+                }
+                if (mode == UNICODE) {
+                    final int digit = Character.digit(nextChar, 16);
+                    if (digit >= 0) {
+                        unicode = (unicode << 4) + digit;
+                        if (++count < 4) {
+                            continue;
+                        }
+                    } else if (count <= 4) {
+                        // luni.09=Invalid Unicode sequence: illegal character
+                        throw new IllegalArgumentException("luni.09");
+                    }
+                    mode = NONE;
+                    buf[offset++] = (char) unicode;
+                    if (nextChar != '\n' && nextChar != '\u0085') {
+                        continue;
+                    }
+                }
+                if (mode == SLASH) {
+                    mode = NONE;
+                    switch (nextChar) {
+                        case '\r':
+                            mode = CONTINUE; // Look for a following \n
+                            continue;
+                        case '\u0085':
+                        case '\n':
+                            mode = IGNORE; // Ignore whitespace on the next line
+                            continue;
+                        case 'b':
+                            nextChar = '\b';
+                            break;
+                        case 'f':
+                            nextChar = '\f';
+                            break;
+                        case 'n':
+                            nextChar = '\n';
+                            break;
+                        case 'r':
+                            nextChar = '\r';
+                            break;
+                        case 't':
+                            nextChar = '\t';
+                            break;
+                        case 'u':
+                            mode = UNICODE;
+                            unicode = count = 0;
+                            continue;
+                    }
+                } else {
+                    switch (nextChar) {
+                        case '#':
+                        case '!':
+                            if (firstChar) {
+                                while (true) {
+                                    intVal = br.read();
+                                    if (intVal == -1) {
+                                        break;
+                                    }
+                                    nextChar = (char) intVal; // & 0xff
+                                    // not
+                                    // required
+                                    if (nextChar == '\r' || nextChar == '\n' || nextChar == '\u0085') {
+                                        break;
+                                    }
+                                }
+                                continue;
+                            }
+                            break;
+                        case '\n':
+                            if (mode == CONTINUE) { // Part of a \r\n sequence
+                                mode = IGNORE; // Ignore whitespace on the next line
+                                continue;
+                            }
+                            // fall into the next case
+                        case '\u0085':
+                        case '\r':
+                            mode = NONE;
+                            firstChar = true;
+                            if (offset > 0 || (offset == 0 && keyLength == 0)) {
+                                if (keyLength == -1) {
+                                    keyLength = offset;
+                                }
+                                final String temp = new String(buf, 0, offset);
+                                crashData.put(Enum.valueOf(ReportField.class, temp.substring(0, keyLength)), temp.substring(keyLength));
+                            }
+                            keyLength = -1;
+                            offset = 0;
+                            continue;
+                        case '\\':
+                            if (mode == KEY_DONE) {
+                                keyLength = offset;
+                            }
+                            mode = SLASH;
+                            continue;
+                        case ':':
+                        case '=':
+                            if (keyLength == -1) { // if parsing the key
+                                mode = NONE;
+                                keyLength = offset;
+                                continue;
+                            }
+                            break;
+                    }
+                    if (Character.isWhitespace(nextChar)) {
+                        if (mode == CONTINUE) {
+                            mode = IGNORE;
+                        }
+                        // if key length == 0 or value length == 0
+                        if (offset == 0 || offset == keyLength || mode == IGNORE) {
+                            continue;
+                        }
+                        if (keyLength == -1) { // if parsing the key
+                            mode = KEY_DONE;
+                            continue;
+                        }
+                    }
+                    if (mode == IGNORE || mode == CONTINUE) {
+                        mode = NONE;
+                    }
+                }
+                firstChar = false;
+                if (mode == KEY_DONE) {
+                    keyLength = offset;
+                    mode = NONE;
+                }
+                buf[offset++] = nextChar;
+            }
+            if (mode == UNICODE && count <= 4) {
+                // luni.08=Invalid Unicode sequence: expected format \\uxxxx
+                throw new IllegalArgumentException("luni.08");
+            }
+            if (keyLength == -1 && offset > 0) {
+                keyLength = offset;
+            }
+            if (keyLength >= 0) {
+                final String temp = new String(buf, 0, offset);
+                final ReportField key = Enum.valueOf(ReportField.class, temp.substring(0, keyLength));
+                String value = temp.substring(keyLength);
+                if (mode == SLASH) {
+                    value += "\u0000";
+                }
+                crashData.put(key, value);
+            }
+
+            IOUtils.safeClose(reader);
+
+            return crashData;
+        } finally {
+            IOUtils.safeClose(br);
+        }
+    }
+
+    /**
+     * Constructs a new {@code Properties} object.
+     *
+     * @param buffer    StringBuilder to populate with the supplied property.
+     * @param string    String to append to the buffer.
+     * @param key       Whether the String is a key value or not.
+     */
+    private void dumpString(@NonNull StringBuilder buffer, @NonNull String string, boolean key) {
+        int i = 0;
+        if (!key && i < string.length() && string.charAt(i) == ' ') {
+            buffer.append("\\ "); //$NON-NLS-1$
+            i++;
+        }
+
+        for (; i < string.length(); i++) {
+            char ch = string.charAt(i);
+            switch (ch) {
+            case '\t':
+                buffer.append("\\t"); //$NON-NLS-1$
+                break;
+            case '\n':
+                buffer.append("\\n"); //$NON-NLS-1$
+                break;
+            case '\f':
+                buffer.append("\\f"); //$NON-NLS-1$
+                break;
+            case '\r':
+                buffer.append("\\r"); //$NON-NLS-1$
+                break;
+            default:
+                if ("\\#!=:".indexOf(ch) >= 0 || (key && ch == ' ')) {
+                    buffer.append('\\');
+                }
+                if (ch >= ' ' && ch <= '~') {
+                    buffer.append(ch);
+                } else {
+                    final String hex = Integer.toHexString(ch);
+                    buffer.append("\\u"); //$NON-NLS-1$
+                    for (int j = 0; j < 4 - hex.length(); j++) {
+                        buffer.append('0'); //$NON-NLS-1$
+                    }
+                    buffer.append(hex);
+                }
+            }
+        }
+    }
+}
diff --git a/src/main/java/org/acra/file/LastModifiedComparator.java b/src/main/java/org/acra/file/LastModifiedComparator.java
new file mode 100644
index 00000000..61dc9432
--- /dev/null
+++ b/src/main/java/org/acra/file/LastModifiedComparator.java
@@ -0,0 +1,16 @@
+package org.acra.file;
+
+import android.support.annotation.NonNull;
+
+import java.io.File;
+import java.util.Comparator;
+
+/**
+ * Orders files from oldest to newest based on their last modified date.
+ */
+final class LastModifiedComparator implements Comparator<File> {
+    @Override
+    public int compare(@NonNull File lhs, @NonNull File rhs) {
+        return (int) (lhs.lastModified() - rhs.lastModified());
+    }
+}
diff --git a/src/main/java/org/acra/file/ReportLocator.java b/src/main/java/org/acra/file/ReportLocator.java
new file mode 100644
index 00000000..838a145c
--- /dev/null
+++ b/src/main/java/org/acra/file/ReportLocator.java
@@ -0,0 +1,58 @@
+package org.acra.file;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import java.io.File;
+import java.util.Arrays;
+
+/**
+ * Locates crash reports.
+ *
+ * @author William Ferguson
+ * @since 4.8.0
+ */
+public final class ReportLocator {
+
+    // Folders under the app folder.
+    private static final String UNAPPROVED_FOLDER_NAME = "ACRA-unapproved";
+    private static final String APPROVED_FOLDER_NAME = "ACRA-approved";
+
+    private final Context context;
+
+    public ReportLocator(@NonNull Context context) {
+        this.context = context;
+    }
+
+    @NonNull
+    public File getUnapprovedFolder() {
+        return context.getDir(UNAPPROVED_FOLDER_NAME, Context.MODE_PRIVATE);
+    }
+
+    @NonNull
+    public File[] getUnapprovedReports() {
+        final File[] reports = getUnapprovedFolder().listFiles();
+        if (reports == null) {
+            return new File[0];
+        }
+        return reports;
+    }
+
+    @NonNull
+    public File getApprovedFolder() {
+        return context.getDir(APPROVED_FOLDER_NAME, Context.MODE_PRIVATE);
+    }
+
+    /**
+     * @return Approved reports sorted by creation time.
+     */
+    @NonNull
+    public File[] getApprovedReports() {
+        final File[] reports = getApprovedFolder().listFiles();
+        if (reports == null) {
+            return new File[0];
+        }
+        Arrays.sort(reports, new LastModifiedComparator());
+        return reports;
+    }
+}
diff --git a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksAdapter.java b/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksAdapter.java
deleted file mode 100644
index cb0762fa..00000000
--- a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksAdapter.java
+++ /dev/null
@@ -1,56 +0,0 @@
-/*
- * This source is part of the
- *      _____  ___   ____
- *  __ / / _ \/ _ | / __/___  _______ _
- * / // / , _/ __ |/ _/_/ _ \/ __/ _ `/
- * \___/_/|_/_/ |_/_/ (_)___/_/  \_, /
- *                              /___/
- * repository.
- *
- * Copyright (C) 2013 Benoit 'BoD' Lubek (BoD@JRAF.org)
- * Copyright (C) 2006 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.acra.jraf.android.util.activitylifecyclecallbackscompat;
-
-import android.app.Activity;
-import android.os.Bundle;
-
-/**
- * This adapter class provides empty implementations of the methods from {@link ActivityLifecycleCallbacksCompat}.
- * Any custom listener that cares only about a subset of the methods of this listener can simply subclass this
- * adapter class instead of implementing the interface directly.
- */
-public class ActivityLifecycleCallbacksAdapter implements ActivityLifecycleCallbacksCompat {
-    @Override
-    public void onActivityCreated(Activity activity, Bundle savedInstanceState) {}
-
-    @Override
-    public void onActivityStarted(Activity activity) {}
-
-    @Override
-    public void onActivityResumed(Activity activity) {}
-
-    @Override
-    public void onActivityPaused(Activity activity) {}
-
-    @Override
-    public void onActivityStopped(Activity activity) {}
-
-    @Override
-    public void onActivitySaveInstanceState(Activity activity, Bundle outState) {}
-
-    @Override
-    public void onActivityDestroyed(Activity activity) {}
-}
diff --git a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksCompat.java b/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksCompat.java
deleted file mode 100644
index 0d7f0df8..00000000
--- a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksCompat.java
+++ /dev/null
@@ -1,51 +0,0 @@
-/*
- * This source is part of the
- *      _____  ___   ____
- *  __ / / _ \/ _ | / __/___  _______ _
- * / // / , _/ __ |/ _/_/ _ \/ __/ _ `/
- * \___/_/|_/_/ |_/_/ (_)___/_/  \_, /
- *                              /___/
- * repository.
- *
- * Copyright (C) 2013 Benoit 'BoD' Lubek (BoD@JRAF.org)
- * Copyright (C) 2006 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.acra.jraf.android.util.activitylifecyclecallbackscompat;
-
-import android.app.Activity;
-import android.app.Application;
-import android.app.Application.ActivityLifecycleCallbacks;
-import android.os.Bundle;
-
-/**
- * Equivalent of {@link ActivityLifecycleCallbacks} to be used with
- * {@link ApplicationHelper#registerActivityLifecycleCallbacks(Application, ActivityLifecycleCallbacksCompat)} and
- * {@link ApplicationHelper#unregisterActivityLifecycleCallbacks(Application, ActivityLifecycleCallbacksCompat)}.
- */
-public interface ActivityLifecycleCallbacksCompat {
-    void onActivityCreated(Activity activity, Bundle savedInstanceState);
-
-    void onActivityStarted(Activity activity);
-
-    void onActivityResumed(Activity activity);
-
-    void onActivityPaused(Activity activity);
-
-    void onActivityStopped(Activity activity);
-
-    void onActivitySaveInstanceState(Activity activity, Bundle outState);
-
-    void onActivityDestroyed(Activity activity);
-}
diff --git a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksWrapper.java b/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksWrapper.java
deleted file mode 100644
index b1656acb..00000000
--- a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ActivityLifecycleCallbacksWrapper.java
+++ /dev/null
@@ -1,96 +0,0 @@
-/*
- * This source is part of the
- *      _____  ___   ____
- *  __ / / _ \/ _ | / __/___  _______ _
- * / // / , _/ __ |/ _/_/ _ \/ __/ _ `/
- * \___/_/|_/_/ |_/_/ (_)___/_/  \_, /
- *                              /___/
- * repository.
- *
- * Copyright (C) 2013 Benoit 'BoD' Lubek (BoD@JRAF.org)
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.acra.jraf.android.util.activitylifecyclecallbackscompat;
-
-import android.app.Activity;
-import android.app.Application.ActivityLifecycleCallbacks;
-import android.os.Bundle;
-
-/**
- * Wraps an {@link ActivityLifecycleCallbacksCompat} into an {@link ActivityLifecycleCallbacks}.
- */
-/* package */class ActivityLifecycleCallbacksWrapper implements ActivityLifecycleCallbacks {
-
-    private final ActivityLifecycleCallbacksCompat mCallback;
-
-    public ActivityLifecycleCallbacksWrapper(ActivityLifecycleCallbacksCompat callback) {
-        mCallback = callback;
-    }
-
-    @Override
-    public void onActivityCreated(Activity activity, Bundle savedInstanceState) {
-        mCallback.onActivityCreated(activity, savedInstanceState);
-    }
-
-    @Override
-    public void onActivityStarted(Activity activity) {
-        mCallback.onActivityStarted(activity);
-    }
-
-    @Override
-    public void onActivityResumed(Activity activity) {
-        mCallback.onActivityResumed(activity);
-    }
-
-    @Override
-    public void onActivityPaused(Activity activity) {
-        mCallback.onActivityPaused(activity);
-    }
-
-    @Override
-    public void onActivityStopped(Activity activity) {
-        mCallback.onActivityStopped(activity);
-    }
-
-    @Override
-    public void onActivitySaveInstanceState(Activity activity, Bundle outState) {
-        mCallback.onActivitySaveInstanceState(activity, outState);
-    }
-
-    @Override
-    public void onActivityDestroyed(Activity activity) {
-        mCallback.onActivityDestroyed(activity);
-    }
-
-    /**
-     * Compare the current wrapped callback with another object wrapped callback
-     */
-    @Override
-    public boolean equals(Object object) {
-        if( !(object instanceof ActivityLifecycleCallbacksWrapper) ) {
-            return false;
-        }
-        final ActivityLifecycleCallbacksWrapper that = (ActivityLifecycleCallbacksWrapper) object;
-        return null == mCallback ? null == that.mCallback : mCallback.equals( that.mCallback );
-    }
-
-    /**
-     *
-     * return wrapped callback object hashCode
-     */
-    @Override
-    public int hashCode() {
-        return null != mCallback ? mCallback.hashCode() : 0;
-    }
-}
diff --git a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ApplicationHelper.java b/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ApplicationHelper.java
deleted file mode 100644
index 5e42f949..00000000
--- a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/ApplicationHelper.java
+++ /dev/null
@@ -1,63 +0,0 @@
-/*
- * This source is part of the
- *      _____  ___   ____
- *  __ / / _ \/ _ | / __/___  _______ _
- * / // / , _/ __ |/ _/_/ _ \/ __/ _ `/
- * \___/_/|_/_/ |_/_/ (_)___/_/  \_, /
- *                              /___/
- * repository.
- *
- * Copyright (C) 2013 Benoit 'BoD' Lubek (BoD@JRAF.org)
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.acra.jraf.android.util.activitylifecyclecallbackscompat;
-
-import android.app.Activity;
-import android.app.Application;
-import android.app.Application.ActivityLifecycleCallbacks;
-
-/**
- * Helper for accessing {@link Application#registerActivityLifecycleCallbacks(ActivityLifecycleCallbacks)} and
- * {@link Application#unregisterActivityLifecycleCallbacks(ActivityLifecycleCallbacks)} introduced in API level 14 in a
- * backwards compatible fashion.<br>
- *
- * When running on API level 14 or above, the framework's implementations of these methods will be used.
- */
-public final class ApplicationHelper {
-
-    /**
-     * Registers a callback to be called following the life cycle of the application's {@link Activity activities}.
-     * 
-     * @param application The application with which to register the callback.
-     * @param callback The callback to register.
-     */
-    public static void registerActivityLifecycleCallbacks(Application application, ActivityLifecycleCallbacksCompat callback) {
-        application.registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacksWrapper(callback));
-    }
-
-
-    /*
-     * Unregister.
-     */
-
-    /**
-     * Unregisters a previously registered callback.
-     * 
-     * @param application The application with which to unregister the callback.
-     * @param callback The callback to unregister.
-     */
-    public void unregisterActivityLifecycleCallbacks(Application application, ActivityLifecycleCallbacksCompat callback) {
-        application.unregisterActivityLifecycleCallbacks(new ActivityLifecycleCallbacksWrapper(callback));
-    }
-}
diff --git a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/MainLifecycleDispatcher.java b/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/MainLifecycleDispatcher.java
deleted file mode 100644
index de1bb1ed..00000000
--- a/src/main/java/org/acra/jraf/android/util/activitylifecyclecallbackscompat/MainLifecycleDispatcher.java
+++ /dev/null
@@ -1,142 +0,0 @@
-/*
- * This source is part of the
- *      _____  ___   ____
- *  __ / / _ \/ _ | / __/___  _______ _
- * / // / , _/ __ |/ _/_/ _ \/ __/ _ `/
- * \___/_/|_/_/ |_/_/ (_)___/_/  \_, /
- *                              /___/
- * repository.
- *
- * Copyright (C) 2013 Benoit 'BoD' Lubek (BoD@JRAF.org)
- * Copyright (C) 2006 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.acra.jraf.android.util.activitylifecyclecallbackscompat;
-
-import java.util.ArrayList;
-
-import android.app.Activity;
-import android.app.Application;
-import android.app.Application.ActivityLifecycleCallbacks;
-import android.os.Bundle;
-
-/**
- * Keeps a list of {@link ActivityLifecycleCallbacksCompat}s that will be called following the life cycle of the application's {@link Activity activities}.
- * This class is used when the app is running on an older platform version that does not support
- * {@link Application#registerActivityLifecycleCallbacks(ActivityLifecycleCallbacks)} and
- * {@link Application#unregisterActivityLifecycleCallbacks(ActivityLifecycleCallbacks)}.
- */
-public class MainLifecycleDispatcher implements ActivityLifecycleCallbacksCompat {
-    private static final MainLifecycleDispatcher INSTANCE = new MainLifecycleDispatcher();
-
-    public static MainLifecycleDispatcher get() {
-        return INSTANCE;
-    }
-
-    private MainLifecycleDispatcher() {}
-
-    private ArrayList<ActivityLifecycleCallbacksCompat> mActivityLifecycleCallbacks = new ArrayList<ActivityLifecycleCallbacksCompat>();
-
-    /* package */void registerActivityLifecycleCallbacks(ActivityLifecycleCallbacksCompat callback) {
-        synchronized (mActivityLifecycleCallbacks) {
-            mActivityLifecycleCallbacks.add(callback);
-        }
-    }
-
-    /* package */void unregisterActivityLifecycleCallbacks(ActivityLifecycleCallbacksCompat callback) {
-        synchronized (mActivityLifecycleCallbacks) {
-            mActivityLifecycleCallbacks.remove(callback);
-        }
-    }
-
-    private Object[] collectActivityLifecycleCallbacks() {
-        Object[] callbacks = null;
-        synchronized (mActivityLifecycleCallbacks) {
-            if (mActivityLifecycleCallbacks.size() > 0) {
-                callbacks = mActivityLifecycleCallbacks.toArray();
-            }
-        }
-        return callbacks;
-    }
-
-    @Override
-    public void onActivityCreated(Activity activity, Bundle savedInstanceState) {
-        Object[] callbacks = collectActivityLifecycleCallbacks();
-        if (callbacks != null) {
-            for (Object callback : callbacks) {
-                ((ActivityLifecycleCallbacksCompat) callback).onActivityCreated(activity, savedInstanceState);
-            }
-        }
-    }
-
-    @Override
-    public void onActivityStarted(Activity activity) {
-        Object[] callbacks = collectActivityLifecycleCallbacks();
-        if (callbacks != null) {
-            for (Object callback : callbacks) {
-                ((ActivityLifecycleCallbacksCompat) callback).onActivityStarted(activity);
-            }
-        }
-    }
-
-    @Override
-    public void onActivityResumed(Activity activity) {
-        Object[] callbacks = collectActivityLifecycleCallbacks();
-        if (callbacks != null) {
-            for (Object callback : callbacks) {
-                ((ActivityLifecycleCallbacksCompat) callback).onActivityResumed(activity);
-            }
-        }
-    }
-
-    @Override
-    public void onActivityPaused(Activity activity) {
-        Object[] callbacks = collectActivityLifecycleCallbacks();
-        if (callbacks != null) {
-            for (Object callback : callbacks) {
-                ((ActivityLifecycleCallbacksCompat) callback).onActivityPaused(activity);
-            }
-        }
-    }
-
-    @Override
-    public void onActivityStopped(Activity activity) {
-        Object[] callbacks = collectActivityLifecycleCallbacks();
-        if (callbacks != null) {
-            for (Object callback : callbacks) {
-                ((ActivityLifecycleCallbacksCompat) callback).onActivityStopped(activity);
-            }
-        }
-    }
-
-    @Override
-    public void onActivitySaveInstanceState(Activity activity, Bundle outState) {
-        Object[] callbacks = collectActivityLifecycleCallbacks();
-        if (callbacks != null) {
-            for (Object callback : callbacks) {
-                ((ActivityLifecycleCallbacksCompat) callback).onActivitySaveInstanceState(activity, outState);
-            }
-        }
-    }
-
-    @Override
-    public void onActivityDestroyed(Activity activity) {
-        Object[] callbacks = collectActivityLifecycleCallbacks();
-        if (callbacks != null) {
-            for (Object callback : callbacks) {
-                ((ActivityLifecycleCallbacksCompat) callback).onActivityDestroyed(activity);
-            }
-        }
-    }
-}
diff --git a/src/main/java/org/acra/legacy/ReportMigrator.java b/src/main/java/org/acra/legacy/ReportMigrator.java
new file mode 100644
index 00000000..83a29059
--- /dev/null
+++ b/src/main/java/org/acra/legacy/ReportMigrator.java
@@ -0,0 +1,78 @@
+package org.acra.legacy;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+import org.acra.ACRAConstants;
+import org.acra.file.CrashReportFileNameParser;
+import org.acra.file.ReportLocator;
+
+import java.io.File;
+import java.io.FilenameFilter;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Migrates reports from the pre 4.8.0 location to the 4.8.0+ locations.
+ */
+public final class ReportMigrator {
+
+    private final Context context;
+    private final CrashReportFileNameParser fileNameParser = new CrashReportFileNameParser();
+    @NonNull
+    private final ReportLocator reportLocator;
+
+    public ReportMigrator(@NonNull Context context) {
+        this.context = context;
+        this.reportLocator = new ReportLocator(context);
+    }
+
+    public void migrate() {
+        ACRA.log.i(LOG_TAG, "Migrating unsent ACRA reports to new file locations");
+
+        final File[] reportFiles = getCrashReportFiles();
+
+        for (final File file : reportFiles) {
+            // Move it to unapproved or approved folders.
+            final String fileName = file.getName();
+            if (fileNameParser.isApproved(fileName)) {
+                if (file.renameTo(new File(reportLocator.getApprovedFolder(), fileName))) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Cold not migrate unsent ACRA crash report : " + fileName);
+                }
+            } else {
+                if (file.renameTo(new File(reportLocator.getUnapprovedFolder(), fileName))) {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Cold not migrate unsent ACRA crash report : " + fileName);
+                }
+            }
+        }
+        ACRA.log.i(LOG_TAG, "Migrated " + reportFiles.length + " unsent reports");
+    }
+
+    /**
+     * Returns an array containing the names of pending crash report files.
+     *
+     * @return an array containing the names of pending crash report files.
+     */
+    @NonNull
+    private File[] getCrashReportFiles() {
+        final File dir = context.getFilesDir();
+        if (dir == null) {
+            ACRA.log.w(LOG_TAG, "Application files directory does not exist! The application may not be installed correctly. Please try reinstalling.");
+            return new File[0];
+        }
+
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Looking for error files in " + dir.getAbsolutePath());
+
+        // Filter for ".stacktrace" files
+        final FilenameFilter filter = new FilenameFilter() {
+            @Override
+            public boolean accept(File dir, @NonNull String name) {
+                return name.endsWith(ACRAConstants.REPORTFILE_EXTENSION);
+            }
+        };
+        final File[] result = dir.listFiles(filter);
+        return (result == null) ? new File[0] : result;
+    }
+
+}
diff --git a/src/main/java/org/acra/log/ACRALog.java b/src/main/java/org/acra/log/ACRALog.java
index 482b4aba..1f70afd6 100644
--- a/src/main/java/org/acra/log/ACRALog.java
+++ b/src/main/java/org/acra/log/ACRALog.java
@@ -1,5 +1,7 @@
 package org.acra.log;
 
+import android.support.annotation.Nullable;
+
 /**
  * Responsible for providing ACRA classes with a platform neutral way of logging.
  * <p>
@@ -10,18 +12,19 @@
  * @since 4.3.0
  */
 public interface ACRALog {
-    public int v(java.lang.String tag, java.lang.String msg);
-    public int v(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
-    public int d(java.lang.String tag, java.lang.String msg);
-    public int d(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
-    public int i(java.lang.String tag, java.lang.String msg);
-    public int i(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
-    public int w(java.lang.String tag, java.lang.String msg);
-    public int w(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
+    int v(java.lang.String tag, java.lang.String msg);
+    int v(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
+    int d(java.lang.String tag, java.lang.String msg);
+    int d(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
+    int i(java.lang.String tag, java.lang.String msg);
+    int i(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
+    int w(java.lang.String tag, java.lang.String msg);
+    int w(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
     //public native  boolean isLoggable(java.lang.String tag, int level);
-    public int w(java.lang.String tag, java.lang.Throwable tr);
-    public int e(java.lang.String tag, java.lang.String msg);
-    public int e(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
-    public java.lang.String getStackTraceString(java.lang.Throwable tr);
+    int w(java.lang.String tag, java.lang.Throwable tr);
+    int e(java.lang.String tag, java.lang.String msg);
+    int e(java.lang.String tag, java.lang.String msg, java.lang.Throwable tr);
+    @Nullable
+    java.lang.String getStackTraceString(java.lang.Throwable tr);
     //public native  int println(int priority, java.lang.String tag, java.lang.String msg);
 }
diff --git a/src/main/java/org/acra/log/AndroidLogDelegate.java b/src/main/java/org/acra/log/AndroidLogDelegate.java
index bd2a366c..be95efa0 100644
--- a/src/main/java/org/acra/log/AndroidLogDelegate.java
+++ b/src/main/java/org/acra/log/AndroidLogDelegate.java
@@ -5,45 +5,57 @@
 
 /**
  * Responsible for delegating calls to the Android logging system.
- * <p/>
+ *
  * @author William Ferguson
  * @since 4.3.0
  */
 public final class AndroidLogDelegate implements ACRALog {
+    @Override
     public int v(String tag, String msg) {
         return Log.v(tag, msg);
     }
+    @Override
     public int v(String tag, String msg, Throwable tr) {
         return Log.v(tag, msg, tr);
     }
+    @Override
     public int d(String tag, String msg) {
         return Log.d(tag, msg);
     }
+    @Override
     public int d(String tag, String msg, Throwable tr) {
         return Log.d(tag, msg, tr);
     }
+    @Override
     public int i(String tag, String msg) {
         return Log.i(tag, msg);
     }
+    @Override
     public int i(String tag, String msg, Throwable tr) {
         return Log.i(tag, msg, tr);
     }
+    @Override
     public int w(String tag, String msg) {
         return Log.w(tag, msg);
     }
+    @Override
     public int w(String tag, String msg, Throwable tr) {
         return Log.w(tag, msg, tr);
     }
     //public native  boolean isLoggable(java.lang.String tag, int level);
+    @Override
     public int w(String tag, Throwable tr) {
         return Log.w(tag, tr);
     }
+    @Override
     public int e(String tag, String msg) {
         return Log.e(tag, msg);
     }
+    @Override
     public int e(String tag, String msg, Throwable tr) {
         return Log.e(tag, msg, tr);
     }
+    @Override
     public String getStackTraceString(Throwable tr) {
         return Log.getStackTraceString(tr);
     }
diff --git a/src/main/java/org/acra/log/HollowLog.java b/src/main/java/org/acra/log/HollowLog.java
index d5a93f50..94b2cb6c 100644
--- a/src/main/java/org/acra/log/HollowLog.java
+++ b/src/main/java/org/acra/log/HollowLog.java
@@ -1,9 +1,12 @@
 package org.acra.log;
 
+import android.support.annotation.Nullable;
+
 /**
  * Stub implementation of {@link org.acra.log.ACRALog}, quenches all logging.
  */
-public class HollowLog implements ACRALog {
+@SuppressWarnings("unused")
+public final class HollowLog implements ACRALog {
     @Override
     public int v(String tag, String msg) {
         return 0;
@@ -59,6 +62,7 @@ public int e(String tag, String msg, Throwable tr) {
         return 0;
     }
 
+    @Nullable
     @Override
     public String getStackTraceString(Throwable tr) {
         return null;
diff --git a/src/main/java/org/acra/prefs/PrefUtils.java b/src/main/java/org/acra/prefs/PrefUtils.java
new file mode 100644
index 00000000..1359c6b5
--- /dev/null
+++ b/src/main/java/org/acra/prefs/PrefUtils.java
@@ -0,0 +1,17 @@
+package org.acra.prefs;
+
+import android.content.SharedPreferences;
+import android.os.Build;
+import android.support.annotation.NonNull;
+
+public final class PrefUtils {
+    private PrefUtils(){}
+
+    public static void save(@NonNull SharedPreferences.Editor editor) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.GINGERBREAD) {
+            editor.apply();
+        } else {
+            editor.commit();
+        }
+    }
+}
diff --git a/src/main/java/org/acra/prefs/SharedPreferencesFactory.java b/src/main/java/org/acra/prefs/SharedPreferencesFactory.java
new file mode 100644
index 00000000..c9695c79
--- /dev/null
+++ b/src/main/java/org/acra/prefs/SharedPreferencesFactory.java
@@ -0,0 +1,44 @@
+package org.acra.prefs;
+
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.preference.PreferenceManager;
+import android.support.annotation.NonNull;
+
+import org.acra.annotation.ReportsCrashes;
+import org.acra.config.ACRAConfiguration;
+
+/**
+ * Responsible for creating a SharedPreferences instance which stores ACRA settings.
+ * <p>
+ * Retrieves the {@link SharedPreferences} instance where user adjustable
+ * settings for ACRA are stored. Default are the Application default
+ * SharedPreferences, but you can provide another SharedPreferences name
+ * with {@link ReportsCrashes#sharedPreferencesName()}.
+ * </p>
+ */
+public class SharedPreferencesFactory {
+
+    private final Context context;
+    private final ACRAConfiguration config;
+
+    public SharedPreferencesFactory(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        this.context = context;
+        this.config = config;
+    }
+
+    /**
+     * @return The Shared Preferences where ACRA will retrieve its user adjustable setting.
+     */
+    @NonNull
+    public SharedPreferences create() {
+        //noinspection ConstantConditions
+        if (context == null) {
+            throw new IllegalStateException("Cannot call ACRA.getACRASharedPreferences() before ACRA.init().");
+        } else if (!"".equals(config.sharedPreferencesName())) {
+            return context.getSharedPreferences(config.sharedPreferencesName(), config.sharedPreferencesMode());
+        } else {
+            return PreferenceManager.getDefaultSharedPreferences(context);
+        }
+    }
+}
diff --git a/src/main/java/org/acra/security/AssetKeyStoreFactory.java b/src/main/java/org/acra/security/AssetKeyStoreFactory.java
new file mode 100644
index 00000000..9f3779a6
--- /dev/null
+++ b/src/main/java/org/acra/security/AssetKeyStoreFactory.java
@@ -0,0 +1,57 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.security;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+
+import java.io.IOException;
+import java.io.InputStream;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * KeyStoreFactory for a certificate stored in an asset file
+ *
+ * @author F43nd1r
+ * @since 4.8.3
+ */
+final class AssetKeyStoreFactory extends BaseKeyStoreFactory {
+
+    private final String assetName;
+
+    /**
+     * creates a new KeyStoreFactory for the specified asset with a custom certificate type
+     * @param certificateType the certificate type
+     * @param assetName the asset
+     */
+    AssetKeyStoreFactory(String certificateType, String assetName) {
+        super(certificateType);
+        this.assetName = assetName;
+    }
+
+    @Override
+    public InputStream getInputStream(@NonNull Context context) {
+        try {
+            return context.getAssets().open(assetName);
+        } catch (IOException e) {
+            ACRA.log.e(LOG_TAG, "Could not open certificate in asset://"+assetName, e);
+        }
+        return null;
+    }
+}
diff --git a/src/main/java/org/acra/security/BaseKeyStoreFactory.java b/src/main/java/org/acra/security/BaseKeyStoreFactory.java
new file mode 100644
index 00000000..b51c9821
--- /dev/null
+++ b/src/main/java/org/acra/security/BaseKeyStoreFactory.java
@@ -0,0 +1,117 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.security;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import org.acra.ACRA;
+import org.acra.ACRAConstants;
+import org.acra.util.IOUtils;
+
+import java.io.BufferedInputStream;
+import java.io.IOException;
+import java.io.InputStream;
+import java.security.KeyStore;
+import java.security.KeyStoreException;
+import java.security.NoSuchAlgorithmException;
+import java.security.cert.Certificate;
+import java.security.cert.CertificateException;
+import java.security.cert.CertificateFactory;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Provides base KeyStoreFactory implementation
+ *
+ * @author F43nd1r
+ * @since 4.8.3
+ */
+@SuppressWarnings({"WeakerAccess", "unused"})
+public abstract class BaseKeyStoreFactory implements KeyStoreFactory {
+
+    public enum Type {
+        CERTIFICATE,
+        KEYSTORE
+    }
+
+    private final String certificateType;
+
+    /**
+     * creates a new KeyStoreFactory for the default certificate type {@link ACRAConstants#DEFAULT_CERTIFICATE_TYPE}
+     */
+    public BaseKeyStoreFactory() {
+        this(ACRAConstants.DEFAULT_CERTIFICATE_TYPE);
+    }
+
+    /**
+     * creates a new KeyStoreFactory with the specified certificate type
+     *
+     * @param certificateType the certificate type
+     */
+    public BaseKeyStoreFactory(String certificateType) {
+        this.certificateType = certificateType;
+    }
+
+    protected abstract InputStream getInputStream(@NonNull Context context);
+
+    protected String getKeyStoreType() {
+        return KeyStore.getDefaultType();
+    }
+
+    protected Type getStreamType() {
+        return Type.CERTIFICATE;
+    }
+
+    protected char[] getPassword() {
+        return null;
+    }
+
+    @Override
+    @Nullable
+    public final KeyStore create(@NonNull Context context) {
+        final InputStream inputStream = getInputStream(context);
+        if (inputStream != null) {
+            final BufferedInputStream bufferedInputStream = new BufferedInputStream(inputStream);
+            try {
+                final KeyStore keyStore = KeyStore.getInstance(getKeyStoreType());
+                switch (getStreamType()) {
+                    case CERTIFICATE:
+                        final CertificateFactory certificateFactory = CertificateFactory.getInstance(certificateType);
+                        final Certificate certificate = certificateFactory.generateCertificate(bufferedInputStream);
+                        keyStore.load(null, null);
+                        keyStore.setCertificateEntry("ca", certificate);
+                        break;
+                    case KEYSTORE:
+                        keyStore.load(bufferedInputStream, getPassword());
+                }
+                return keyStore;
+            } catch (CertificateException e) {
+                ACRA.log.e(LOG_TAG, "Could not load certificate", e);
+            } catch (KeyStoreException e) {
+                ACRA.log.e(LOG_TAG, "Could not load keystore", e);
+            } catch (NoSuchAlgorithmException e) {
+                ACRA.log.e(LOG_TAG, "Could not load keystore", e);
+            } catch (IOException e) {
+                ACRA.log.e(LOG_TAG, "Could not load keystore", e);
+            } finally {
+                IOUtils.safeClose(bufferedInputStream);
+            }
+        }
+        return null;
+    }
+}
diff --git a/src/main/java/org/acra/security/FileKeyStoreFactory.java b/src/main/java/org/acra/security/FileKeyStoreFactory.java
new file mode 100644
index 00000000..3aaa9d02
--- /dev/null
+++ b/src/main/java/org/acra/security/FileKeyStoreFactory.java
@@ -0,0 +1,58 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.security;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+
+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import java.io.InputStream;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * KeyStoreFactory for a certificate stored in a file
+ *
+ * @author F43nd1r
+ * @since 4.8.3
+ */
+final class FileKeyStoreFactory extends BaseKeyStoreFactory {
+
+    private final String filePath;
+
+    /**
+     * creates a new KeyStoreFactory for the specified file with a custom certificate type
+     * @param certificateType the certificate type
+     * @param filePath path to the file
+     */
+    FileKeyStoreFactory(String certificateType, String filePath) {
+        super(certificateType);
+        this.filePath = filePath;
+    }
+
+    @Override
+    public InputStream getInputStream(@NonNull Context context) {
+        try {
+            return new FileInputStream(filePath);
+        } catch (FileNotFoundException e) {
+            ACRA.log.e(LOG_TAG, "Could not find File "+filePath, e);
+        }
+        return null;
+    }
+}
diff --git a/src/main/java/org/acra/security/KeyStoreFactory.java b/src/main/java/org/acra/security/KeyStoreFactory.java
new file mode 100644
index 00000000..abd981c0
--- /dev/null
+++ b/src/main/java/org/acra/security/KeyStoreFactory.java
@@ -0,0 +1,34 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.security;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import java.security.KeyStore;
+
+/**
+ * The interface can be used to provide a KeyStore with certificates.
+ *
+ * @author F43nd1r
+ * @since 4.8.3
+ */
+public interface KeyStoreFactory {
+
+    @Nullable
+    KeyStore create(@NonNull Context context);
+}
diff --git a/src/main/java/org/acra/security/KeyStoreHelper.java b/src/main/java/org/acra/security/KeyStoreHelper.java
new file mode 100644
index 00000000..569b5b4e
--- /dev/null
+++ b/src/main/java/org/acra/security/KeyStoreHelper.java
@@ -0,0 +1,76 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.security;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import org.acra.ACRA;
+import org.acra.ACRAConstants;
+import org.acra.config.ACRAConfiguration;
+
+import java.security.KeyStore;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Helper to get a KeyStore from a configuration
+ *
+ * @author F43nd1r
+ * @since 4.9.0
+ */
+public final class KeyStoreHelper {
+    private static final String ASSET_PREFIX = "asset://";
+
+    private KeyStoreHelper() {
+    }
+
+    /**
+     * try to get the keystore
+     * @param context a context
+     * @param config the configuration
+     * @return the keystore, or null if none provided / failure
+     */
+    @Nullable
+    public static KeyStore getKeyStore(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        final Class<? extends KeyStoreFactory> keyStoreFactory = config.keyStoreFactoryClass();
+        KeyStore keyStore = null;
+        try {
+            keyStore = keyStoreFactory.newInstance().create(context);
+        } catch (InstantiationException e) {
+            ACRA.log.e(LOG_TAG, "Could not get keystore from factory", e);
+        } catch (IllegalAccessException e) {
+            ACRA.log.e(LOG_TAG, "Could not get keystore from factory", e);
+        }
+        if(keyStore == null) {
+            //either users factory did not create a keystore, or the configuration is default {@link NoKeyStoreFactory}
+            final int certificateRes = config.resCertificate();
+            final String certificatePath = config.certificatePath();
+            final String certificateType = config.certificateType();
+            if(certificateRes != ACRAConstants.DEFAULT_RES_VALUE){
+                keyStore = new ResourceKeyStoreFactory(certificateType, certificateRes).create(context);
+            }else if(!certificatePath.equals(ACRAConstants.DEFAULT_STRING_VALUE)){
+                if(certificatePath.startsWith(ASSET_PREFIX)) {
+                    keyStore = new AssetKeyStoreFactory(certificateType, certificatePath.substring(ASSET_PREFIX.length())).create(context);
+                } else {
+                    keyStore = new FileKeyStoreFactory(certificateType, certificatePath).create(context);
+                }
+            }
+        }
+        return keyStore;
+    }
+}
diff --git a/src/main/java/org/acra/security/NoKeyStoreFactory.java b/src/main/java/org/acra/security/NoKeyStoreFactory.java
new file mode 100644
index 00000000..da833424
--- /dev/null
+++ b/src/main/java/org/acra/security/NoKeyStoreFactory.java
@@ -0,0 +1,36 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.security;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
+import java.security.KeyStore;
+
+/**
+ * Default KeyStoreFactory. Does not provide any KeyStore
+ *
+ * @author F43nd1r
+ * @since 4.9.0
+ */
+public class NoKeyStoreFactory implements KeyStoreFactory {
+    @Nullable
+    @Override
+    public KeyStore create(@NonNull Context context) {
+        return null;
+    }
+}
diff --git a/src/main/java/org/acra/security/ResourceKeyStoreFactory.java b/src/main/java/org/acra/security/ResourceKeyStoreFactory.java
new file mode 100644
index 00000000..dc8f1344
--- /dev/null
+++ b/src/main/java/org/acra/security/ResourceKeyStoreFactory.java
@@ -0,0 +1,49 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.security;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.RawRes;
+
+import java.io.InputStream;
+
+/**
+ * KeyStoreFactory for a certificate stored in a raw resource
+ *
+ * @author F43nd1r
+ * @since 4.8.3
+ */
+final class ResourceKeyStoreFactory extends BaseKeyStoreFactory {
+
+    @RawRes
+    private final int rawRes;
+
+    /**
+     * creates a new KeyStoreFactory for the specified resource with a custom certificate type
+     * @param certificateType the certificate type
+     * @param rawRes raw resource id
+     */
+    ResourceKeyStoreFactory(String certificateType, @RawRes int rawRes) {
+        super(certificateType);
+        this.rawRes = rawRes;
+    }
+
+    @Override
+    public InputStream getInputStream(@NonNull Context context) {
+        return context.getResources().openRawResource(rawRes);
+    }
+}
diff --git a/src/main/java/org/acra/sender/DefaultReportSenderFactory.java b/src/main/java/org/acra/sender/DefaultReportSenderFactory.java
new file mode 100644
index 00000000..829d0be0
--- /dev/null
+++ b/src/main/java/org/acra/sender/DefaultReportSenderFactory.java
@@ -0,0 +1,49 @@
+package org.acra.sender;
+
+import android.Manifest;
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+import org.acra.config.ACRAConfiguration;
+import org.acra.util.PackageManagerWrapper;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Will send reports by email if the 'mailTo' parameter is configured,
+ * otherwise via HTTP if the 'formUri' parameter is configured and
+ * internet permission has been granted.
+ *
+ * If neither 'formUri' or 'mailTo' has been configured, then a NullSender will be returned.
+ */
+public final class DefaultReportSenderFactory implements ReportSenderFactory {
+
+    @NonNull
+    @Override
+    public ReportSender create(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        final PackageManagerWrapper pm = new PackageManagerWrapper(context);
+        if (!"".equals(config.mailTo())) {
+            // Try to send by mail. If a mailTo address is provided, do not add other senders.
+            ACRA.log.w(LOG_TAG, context.getPackageName() + " reports will be sent by email (if accepted by user).");
+            return new EmailIntentSenderFactory().create(context, config);
+        } else if (!pm.hasPermission(Manifest.permission.INTERNET)) {
+            // NB If the PackageManager has died then this will erroneously log
+            // the error that the App doesn't have Internet (even though it does).
+            // I think that is a small price to pay to ensure that ACRA doesn't
+            // crash if the PackageManager has died.
+            ACRA.log.e(LOG_TAG,
+                    context.getPackageName()
+                            + " should be granted permission "
+                            + Manifest.permission.INTERNET
+                            + " if you want your crash reports to be sent. If you don't want to add this permission to your application you can also enable sending reports by email. If this is your will then provide your email address in @AcraConfig(mailTo=\"your.account@domain.com\"");
+            return new NullSender();
+        } else if (config.formUri() != null && !"".equals(config.formUri())) {
+            // If formUri is set, instantiate a sender for a generic HTTP POST form with default mapping.
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, context.getPackageName() + " reports will be sent by Http.");
+            return new HttpSenderFactory().create(context, config);
+        } else {
+            return new NullSender();
+        }
+    }
+}
diff --git a/src/main/java/org/acra/sender/EmailIntentSender.java b/src/main/java/org/acra/sender/EmailIntentSender.java
index 78cb165c..2e774d6e 100644
--- a/src/main/java/org/acra/sender/EmailIntentSender.java
+++ b/src/main/java/org/acra/sender/EmailIntentSender.java
@@ -15,53 +15,58 @@
  */
 package org.acra.sender;
 
-import org.acra.ACRA;
+import android.content.Context;
+import android.content.Intent;
+import android.net.Uri;
+import android.support.annotation.NonNull;
+
 import org.acra.ACRAConstants;
-import org.acra.collector.CrashReportData;
 import org.acra.ReportField;
 import org.acra.annotation.ReportsCrashes;
+import org.acra.collector.CrashReportData;
+import org.acra.config.ACRAConfiguration;
+import org.acra.collections.ImmutableSet;
 
-import android.content.Context;
-import android.content.Intent;
-import android.net.Uri;
+import java.util.Set;
 
 /**
- * Send reports through an email intent. The user will be asked to chose his
- * preferred email client. Included report fields can be defined using
+ * Send reports through an email intent.
+ *
+ * The user will be asked to chose his preferred email client. Included report fields can be defined using
  * {@link org.acra.annotation.ReportsCrashes#customReportContent()}. Crash receiving mailbox has to be
  * defined with {@link ReportsCrashes#mailTo()}.
  */
 public class EmailIntentSender implements ReportSender {
 
-    private final Context mContext;
+    private final ACRAConfiguration config;
 
-    public EmailIntentSender(Context ctx) {
-        mContext = ctx;
+    public EmailIntentSender(@NonNull ACRAConfiguration config) {
+        this.config = config;
     }
 
     @Override
-    public void send(Context context, CrashReportData errorContent) throws ReportSenderException {
+    public void send(@NonNull Context context, @NonNull CrashReportData errorContent) throws ReportSenderException {
 
-        final String subject = mContext.getPackageName() + " Crash Report";
+        final String subject = context.getPackageName() + " Crash Report";
         final String body = buildBody(errorContent);
 
         final Intent emailIntent = new Intent(android.content.Intent.ACTION_SENDTO);
-        emailIntent.setData(Uri.fromParts("mailto", ACRA.getConfig().mailTo(), null));
+        emailIntent.setData(Uri.fromParts("mailto", config.mailTo(), null));
         emailIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
         emailIntent.putExtra(android.content.Intent.EXTRA_SUBJECT, subject);
         emailIntent.putExtra(android.content.Intent.EXTRA_TEXT, body);
-        mContext.startActivity(emailIntent);
+        context.startActivity(emailIntent);
     }
 
-    private String buildBody(CrashReportData errorContent) {
-        ReportField[] fields = ACRA.getConfig().customReportContent();
-        if(fields.length == 0) {
-            fields = ACRAConstants.DEFAULT_MAIL_REPORT_FIELDS;
+    private String buildBody(@NonNull CrashReportData errorContent) {
+        Set<ReportField> fields = config.getReportFields();
+        if(fields.isEmpty()) {
+            fields = new ImmutableSet<ReportField>(ACRAConstants.DEFAULT_MAIL_REPORT_FIELDS);
         }
 
         final StringBuilder builder = new StringBuilder();
         for (ReportField field : fields) {
-            builder.append(field.toString()).append("=");
+            builder.append(field.toString()).append('=');
             builder.append(errorContent.get(field));
             builder.append('\n');
         }
diff --git a/src/main/java/org/acra/sender/EmailIntentSenderFactory.java b/src/main/java/org/acra/sender/EmailIntentSenderFactory.java
new file mode 100644
index 00000000..6b23f66a
--- /dev/null
+++ b/src/main/java/org/acra/sender/EmailIntentSenderFactory.java
@@ -0,0 +1,18 @@
+package org.acra.sender;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.config.ACRAConfiguration;
+
+/**
+ * Constructs an {@link EmailIntentSender}.
+ */
+public final class EmailIntentSenderFactory implements ReportSenderFactory {
+
+    @NonNull
+    @Override
+    public ReportSender create(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        return new EmailIntentSender(config);
+    }
+}
diff --git a/src/main/java/org/acra/sender/HttpSender.java b/src/main/java/org/acra/sender/HttpSender.java
index d4164389..43564fb8 100644
--- a/src/main/java/org/acra/sender/HttpSender.java
+++ b/src/main/java/org/acra/sender/HttpSender.java
@@ -15,24 +15,28 @@
  */
 package org.acra.sender;
 
-import static org.acra.ACRA.LOG_TAG;
-
-import java.io.IOException;
-import java.net.URL;
-import java.util.HashMap;
-import java.util.Map;
-
 import android.content.Context;
+import android.net.Uri;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+
 import org.acra.ACRA;
-import org.acra.ACRAConfiguration;
 import org.acra.ACRAConstants;
 import org.acra.ReportField;
 import org.acra.annotation.ReportsCrashes;
 import org.acra.collector.CrashReportData;
+import org.acra.config.ACRAConfiguration;
 import org.acra.util.HttpRequest;
+import org.acra.collections.ImmutableSet;
 import org.acra.util.JSONReportBuilder.JSONReportException;
 
-import android.net.Uri;
+import java.io.IOException;
+import java.net.URL;
+import java.util.HashMap;
+import java.util.Map;
+import java.util.Set;
+
+import static org.acra.ACRA.LOG_TAG;
 
 /**
  * <p>
@@ -50,23 +54,8 @@
  * </p>
  * 
  * <pre>
- * &#64;ReportsCrashes(...)
- * public class myApplication extends Application {
- * 
- *     public void onCreate() {
- *         super.onCreate();
- *         ACRA.init(this);
- *         Map&lt;ReportField, String&gt; mapping = new HashMap&lt;ReportField, String&gt;();
- *         mapping.put(ReportField.APP_VERSION_CODE, &quot;myAppVerCode'); 
- *         mapping.put(ReportField.APP_VERSION_NAME, &quot;myAppVerName');
- *         //... 
- *         mapping.put(ReportField.USER_EMAIL, &quot;userEmail');
- *         // remove any default report sender
- *         ErrorReporter.getInstance().removeAllReportSenders();
- *         // create your own instance with your specific mapping
- *         ErrorReporter.getInstance().addReportSender(new ReportSender(&quot;http://my.domain.com/reports/receiver.py&quot;, mapping));
- *     }
- * }
+ * Just create and declare a {@link ReportSenderFactory} that constructs a mapping
+ * from each {@link ReportField} to another name.
  * </pre>
  * 
  */
@@ -90,6 +79,7 @@
          * @see <a href="http://www.w3.org/TR/html401/interact/forms.html#h-17.13.4">Form content types</a>
          */
         FORM {
+            @NonNull
             @Override
             public String getContentType() {
                 return "application/x-www-form-urlencoded";
@@ -99,29 +89,34 @@ public String getContentType() {
          * Send data as a structured JSON tree.
          */
         JSON {
+            @NonNull
             @Override
             public String getContentType() {
                 return "application/json";
             }
         };
 
+        @NonNull
         public abstract String getContentType();
     }
 
+    private final ACRAConfiguration config;
+    @Nullable
     private final Uri mFormUri;
     private final Map<ReportField, String> mMapping;
     private final Method mMethod;
     private final Type mType;
+    @Nullable
     private String mUsername;
+    @Nullable
     private String mPassword;
 
     /**
      * <p>
-     * Create a new HttpSender instance with its destination taken from
-     * {@link ACRA#getConfig()} dynamically. Configuration changes to the
-     * formUri are applied automatically.
+     * Create a new HttpSender instance with its destination taken from the supplied config.
      * </p>
-     * 
+     *
+     * @param config    AcraConfig declaring the
      * @param method
      *            HTTP {@link Method} to be used to send data. Currently only
      *            {@link Method#POST} and {@link Method#PUT} are available. If
@@ -140,13 +135,8 @@ public String getContentType() {
      *            parameters will be named with the result of
      *            mapping.get(ReportField.SOME_FIELD);
      */
-    public HttpSender(Method method, Type type, Map<ReportField, String> mapping) {
-        mMethod = method;
-        mFormUri = null;
-        mMapping = mapping;
-        mType = type;
-        mUsername = null;
-        mPassword = null;
+    public HttpSender(@NonNull ACRAConfiguration config, @NonNull Method method, @NonNull Type type, @Nullable Map<ReportField, String> mapping) {
+        this(config, method, type, null, mapping);
     }
 
     /**
@@ -154,7 +144,8 @@ public HttpSender(Method method, Type type, Map<ReportField, String> mapping) {
      * Create a new HttpPostSender instance with a fixed destination provided as
      * a parameter. Configuration changes to the formUri are not applied.
      * </p>
-     * 
+     *
+     * @param config    AcraConfig declaring the
      * @param method
      *            HTTP {@link Method} to be used to send data. Currently only
      *            {@link Method#POST} and {@link Method#PUT} are available. If
@@ -174,9 +165,10 @@ public HttpSender(Method method, Type type, Map<ReportField, String> mapping) {
      *            parameters will be named with the result of
      *            mapping.get(ReportField.SOME_FIELD);
      */
-    public HttpSender(Method method, Type type, String formUri, Map<ReportField, String> mapping) {
+    public HttpSender(@NonNull ACRAConfiguration config, @NonNull Method method, @NonNull Type type, @Nullable String formUri, @Nullable Map<ReportField, String> mapping) {
+        this.config = config;
         mMethod = method;
-        mFormUri = Uri.parse(formUri);
+        mFormUri = (formUri == null) ? null : Uri.parse(formUri);
         mMapping = mapping;
         mType = type;
         mUsername = null;
@@ -195,29 +187,27 @@ public HttpSender(Method method, Type type, String formUri, Map<ReportField, Str
      *            The password to set for HTTP Basic Auth.
      */
     @SuppressWarnings( "unused" )
-    public void setBasicAuth(String username, String password) {
+    public void setBasicAuth(@Nullable String username, @Nullable String password) {
         mUsername = username;
         mPassword = password;
     }    
 
     @Override
-    public void send(Context context, CrashReportData report) throws ReportSenderException {
+    public void send(@NonNull Context context, @NonNull CrashReportData report) throws ReportSenderException {
 
         try {
-            URL reportUrl = mFormUri == null ? new URL(ACRA.getConfig().formUri()) : new URL(mFormUri.toString());
-            ACRA.log.d(LOG_TAG, "Connect to " + reportUrl.toString());
+            URL reportUrl = mFormUri == null ? new URL(config.formUri()) : new URL(mFormUri.toString());
+            if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Connect to " + reportUrl.toString());
 
-            final String login = mUsername != null ? mUsername : ACRAConfiguration.isNull(ACRA.getConfig().formUriBasicAuthLogin()) ? null : ACRA
-                    .getConfig().formUriBasicAuthLogin();
-            final String password = mPassword != null ? mPassword : ACRAConfiguration.isNull(ACRA.getConfig().formUriBasicAuthPassword()) ? null : ACRA
-                    .getConfig().formUriBasicAuthPassword();
+            final String login = mUsername != null ? mUsername : isNull(config.formUriBasicAuthLogin()) ? null : config.formUriBasicAuthLogin();
+            final String password = mPassword != null ? mPassword : isNull(config.formUriBasicAuthPassword()) ? null : config.formUriBasicAuthPassword();
 
-            final HttpRequest request = new HttpRequest();
-            request.setConnectionTimeOut(ACRA.getConfig().connectionTimeout());
-            request.setSocketTimeOut(ACRA.getConfig().socketTimeout());
+            final HttpRequest request = new HttpRequest(config);
+            request.setConnectionTimeOut(config.connectionTimeout());
+            request.setSocketTimeOut(config.socketTimeout());
             request.setLogin(login);
             request.setPassword(password);
-            request.setHeaders(ACRA.getConfig().getHttpHeaders());
+            request.setHeaders(config.getHttpHeaders());
 
             // Generate report body depending on requested type
             final String reportAsString;
@@ -242,22 +232,23 @@ public void send(Context context, CrashReportData report) throws ReportSenderExc
             default:
                 throw new UnsupportedOperationException("Unknown method: " + mMethod.name());
             }
-            request.send(reportUrl, mMethod, reportAsString, mType);
+            request.send(context, reportUrl, mMethod, reportAsString, mType);
 
-        } catch (IOException e) {
-            throw new ReportSenderException("Error while sending " + ACRA.getConfig().reportType()
+        } catch (@NonNull IOException e) {
+            throw new ReportSenderException("Error while sending " + config.reportType()
                     + " report via Http " + mMethod.name(), e);
-        } catch (JSONReportException e) {
-            throw new ReportSenderException("Error while sending " + ACRA.getConfig().reportType()
+        } catch (@NonNull JSONReportException e) {
+            throw new ReportSenderException("Error while sending " + config.reportType()
                     + " report via Http " + mMethod.name(), e);
         }
     }
 
-    private Map<String, String> remap(Map<ReportField, String> report) {
+    @NonNull
+    private Map<String, String> remap(@NonNull Map<ReportField, String> report) {
 
-        ReportField[] fields = ACRA.getConfig().customReportContent();
-        if (fields.length == 0) {
-            fields = ACRAConstants.DEFAULT_REPORT_FIELDS;
+        Set<ReportField> fields = config.getReportFields();
+        if (fields.isEmpty()) {
+            fields = new ImmutableSet<ReportField>(ACRAConstants.DEFAULT_REPORT_FIELDS);
         }
 
         final Map<String, String> finalReport = new HashMap<String, String>(report.size());
@@ -271,4 +262,7 @@ public void send(Context context, CrashReportData report) throws ReportSenderExc
         return finalReport;
     }
 
+    private boolean isNull(@Nullable String aString) {
+        return aString == null || ACRAConstants.NULL_VALUE.equals(aString);
+    }
 }
\ No newline at end of file
diff --git a/src/main/java/org/acra/sender/HttpSenderFactory.java b/src/main/java/org/acra/sender/HttpSenderFactory.java
new file mode 100644
index 00000000..b0872635
--- /dev/null
+++ b/src/main/java/org/acra/sender/HttpSenderFactory.java
@@ -0,0 +1,18 @@
+package org.acra.sender;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.config.ACRAConfiguration;
+
+/**
+ * Constructs a {@link HttpSender} with no report field mappings.
+ */
+public final class HttpSenderFactory implements ReportSenderFactory {
+
+    @NonNull
+    @Override
+    public ReportSender create(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        return new HttpSender(config, config.httpMethod(), config.reportType(), null);
+    }
+}
diff --git a/src/main/java/org/acra/sender/NullSender.java b/src/main/java/org/acra/sender/NullSender.java
new file mode 100644
index 00000000..a3539c06
--- /dev/null
+++ b/src/main/java/org/acra/sender/NullSender.java
@@ -0,0 +1,19 @@
+package org.acra.sender;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+import org.acra.collector.CrashReportData;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Sends no report.
+ */
+final class NullSender implements ReportSender {
+    @Override
+    public void send(@NonNull Context context, @NonNull CrashReportData errorContent) throws ReportSenderException {
+        ACRA.log.w(LOG_TAG, context.getPackageName() + " reports will NOT be sent - no valid ReportSender is configured. Try setting 'formUri' or 'mailTo'");
+    }
+}
diff --git a/src/main/java/org/acra/sender/ReportDistributor.java b/src/main/java/org/acra/sender/ReportDistributor.java
new file mode 100644
index 00000000..01e59ff0
--- /dev/null
+++ b/src/main/java/org/acra/sender/ReportDistributor.java
@@ -0,0 +1,158 @@
+/*
+ *  Copyright 2012 Kevin Gaudin
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.sender;
+
+import android.content.Context;
+import android.content.pm.ApplicationInfo;
+import android.content.pm.PackageManager;
+import android.support.annotation.NonNull;
+import org.acra.ACRA;
+import org.acra.collector.CrashReportData;
+import org.acra.config.ACRAConfiguration;
+import org.acra.config.DefaultRetryPolicy;
+import org.acra.config.RetryPolicy;
+import org.acra.file.CrashReportPersister;
+
+import java.io.File;
+import java.io.IOException;
+import java.util.LinkedList;
+import java.util.List;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Distributes reports to all Senders.
+ *
+ * @author William Ferguson
+ * @since 4.8.0
+ */
+final class ReportDistributor {
+
+    private final Context context;
+    private final ACRAConfiguration config;
+    private final List<ReportSender> reportSenders;
+
+    /**
+     * Creates a new {@link ReportDistributor} to try sending pending reports.
+     *
+     * @param context               ApplicationContext in which the reports are being sent.
+     * @param config                Configuration to use while sending.
+     * @param reportSenders         List of ReportSender to use to send the crash reports.
+     */
+    ReportDistributor(@NonNull Context context, @NonNull ACRAConfiguration config, @NonNull List<ReportSender> reportSenders) {
+        this.context = context;
+        this.config = config;
+        this.reportSenders = reportSenders;
+    }
+
+    /**
+     * Send report via all senders.
+     *
+     * @param reportFile    Report to send.
+     */
+    public void distribute(@NonNull File reportFile) {
+
+        ACRA.log.i(LOG_TAG, "Sending report " + reportFile );
+        try {
+            final CrashReportPersister persister = new CrashReportPersister();
+            final CrashReportData previousCrashReport = persister.load(reportFile);
+            sendCrashReport(previousCrashReport);
+            deleteFile(reportFile);
+        } catch (RuntimeException e) {
+            ACRA.log.e(LOG_TAG, "Failed to send crash reports for " + reportFile, e);
+            deleteFile(reportFile);
+        } catch (IOException e) {
+            ACRA.log.e(LOG_TAG, "Failed to load crash report for " + reportFile, e);
+            deleteFile(reportFile);
+        } catch (ReportSenderException e) {
+            ACRA.log.e(LOG_TAG, "Failed to send crash report for " + reportFile, e);
+            // An issue occurred while sending this report but we can still try to
+            // send other reports. Report sending is limited by ACRAConstants.MAX_SEND_REPORTS
+            // so there's not much to fear about overloading a failing server.
+        }
+    }
+
+    /**
+     * Sends the report with all configured ReportSenders. If at least one
+     * sender completed its job, the report is considered as sent and will not
+     * be sent again for failing senders.
+     *
+     * @param errorContent  Crash data.
+     * @throws ReportSenderException if unable to send the crash report.
+     */
+    private void sendCrashReport(@NonNull CrashReportData errorContent) throws ReportSenderException {
+        if (!isDebuggable() || config.sendReportsInDevMode()) {
+            final List<RetryPolicy.FailedSender> failedSenders = new LinkedList<RetryPolicy.FailedSender>();
+            for (ReportSender sender : reportSenders) {
+                try {
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Sending report using " + sender.getClass().getName());
+                    sender.send(context, errorContent);
+                    if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Sent report using " + sender.getClass().getName());
+                } catch (ReportSenderException e) {
+                    failedSenders.add(new RetryPolicy.FailedSender(sender, e));
+                }
+            }
+
+            if (failedSenders.isEmpty()) {
+                if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Report was sent by all senders");
+            } else if (getRetryPolicy().shouldRetrySend(reportSenders, failedSenders)) {
+                final Throwable firstFailure = failedSenders.get(0).getException();
+                throw new ReportSenderException("Policy marked this task as incomplete. ACRA will try to send this report again.", firstFailure);
+            } else {
+                final StringBuilder builder = new StringBuilder("ReportSenders of classes [");
+                for (final RetryPolicy.FailedSender failedSender : failedSenders) {
+                    builder.append(failedSender.getSender().getClass().getName());
+                    builder.append(", ");
+                }
+                builder.append("] failed, but Policy marked this task as complete. ACRA will not send this report again.");
+                ACRA.log.w(LOG_TAG, builder.toString());
+            }
+        }
+    }
+
+    private RetryPolicy getRetryPolicy() {
+        try {
+            return config.retryPolicyClass().newInstance();
+        } catch (InstantiationException e) {
+            ACRA.log.e(LOG_TAG, "Failed to create policy instance of class " + config.retryPolicyClass().getName(), e);
+        } catch (IllegalAccessException e) {
+            ACRA.log.e(LOG_TAG, "Failed to create policy instance of class " + config.retryPolicyClass().getName(), e);
+        }
+
+        return new DefaultRetryPolicy();
+    }
+
+    private void deleteFile(@NonNull File file) {
+        final boolean deleted = file.delete();
+        if (!deleted) {
+            ACRA.log.w(LOG_TAG, "Could not delete error report : " + file);
+        }
+    }
+
+    /**
+     * Returns true if the application is debuggable.
+     *
+     * @return true if the application is debuggable.
+     */
+    private boolean isDebuggable() {
+        final PackageManager pm = context.getPackageManager();
+        try {
+            return (pm.getApplicationInfo(context.getPackageName(), 0).flags & ApplicationInfo.FLAG_DEBUGGABLE) > 0;
+        } catch (PackageManager.NameNotFoundException e) {
+            return false;
+        }
+    }
+}
diff --git a/src/main/java/org/acra/sender/ReportSender.java b/src/main/java/org/acra/sender/ReportSender.java
index 5271019c..06a56e62 100644
--- a/src/main/java/org/acra/sender/ReportSender.java
+++ b/src/main/java/org/acra/sender/ReportSender.java
@@ -16,35 +16,35 @@
 package org.acra.sender;
 
 import android.content.Context;
+import android.support.annotation.NonNull;
+
 import org.acra.collector.CrashReportData;
 
 /**
- * A simple interface for defining various crash report senders. You can reuse
- * {@link HttpSender} to send reports to your custom server-side report
+ * A simple interface for defining various crash report senders.
+ *
+ * You can reuse {@link HttpSender} to send reports to your custom server-side report
  * collection script even if you expect (or prefer) specific names for each
  * report field as {@link HttpSender#send(Context, CrashReportData)}
  * can take a {@code Map<ReportField, String>} as an input to convert each field name to
  * your preferred POST parameter name.
  * 
  * @author Kevin Gaudin
- * 
  */
 public interface ReportSender {
+
     /**
-     * Send crash report data. You don't have to take care of managing Threads,
-     * just implement what is necessary to handle the data. ACRA will use a
-     * specific Thread (not the UI Thread) to run your sender.
-     *
+     * Send crash report data.
      *
+     * Method will be called from the {@link SenderService}.
      *
      * @param context       Android Context in which to send the crash report.
-     * @param errorContent
-     *            Stores key/value pairs for each report field. A report field
-     *            is identified by a {@link org.acra.ReportField} enum value.
+     * @param errorContent  Stores key/value pairs for each report field.
+     *                      A report field is identified by a {@link org.acra.ReportField} enum value.
      * @throws ReportSenderException
      *             If anything goes fatally wrong during the handling of crash
      *             data, you can (should) throw a {@link ReportSenderException}
      *             with a custom message.
      */
-    public void send(Context context, CrashReportData errorContent) throws ReportSenderException;
+    void send(@NonNull Context context, @NonNull CrashReportData errorContent) throws ReportSenderException;
 }
diff --git a/src/main/java/org/acra/sender/ReportSenderException.java b/src/main/java/org/acra/sender/ReportSenderException.java
index b4c8cf44..54a7b000 100644
--- a/src/main/java/org/acra/sender/ReportSenderException.java
+++ b/src/main/java/org/acra/sender/ReportSenderException.java
@@ -16,7 +16,7 @@
 package org.acra.sender;
 
 /**
- * This exception is thrown when an error ocurred while sending crash data in a
+ * This exception is thrown when an error occurred while sending crash data in a
  * {@link ReportSender} implementation.
  * 
  * @author Kevin Gaudin
diff --git a/src/main/java/org/acra/sender/ReportSenderFactory.java b/src/main/java/org/acra/sender/ReportSenderFactory.java
new file mode 100644
index 00000000..122abb2e
--- /dev/null
+++ b/src/main/java/org/acra/sender/ReportSenderFactory.java
@@ -0,0 +1,25 @@
+package org.acra.sender;
+
+import android.content.Context;
+import android.support.annotation.NonNull;
+import org.acra.config.ACRAConfiguration;
+
+/**
+ * Factory for creating and configuring a {@link ReportSender} instance.
+ * Implementations must have a no argument constructor.
+ *
+ * Each configured ReportSenderFactory is created within the {@link SenderService}
+ * and is used to construct and configure a single {@link ReportSender}.
+ *
+ * Created by William on 4-JAN-2016.
+ */
+public interface ReportSenderFactory {
+
+    /**
+     * @param context   Application context.
+     * @param config    Configuration to use when sending reports.
+     * @return Fully configured instance of the relevant ReportSender.
+     */
+    @NonNull
+    ReportSender create(@NonNull Context context, @NonNull ACRAConfiguration config);
+}
diff --git a/src/main/java/org/acra/sender/SenderService.java b/src/main/java/org/acra/sender/SenderService.java
new file mode 100644
index 00000000..82424dd4
--- /dev/null
+++ b/src/main/java/org/acra/sender/SenderService.java
@@ -0,0 +1,109 @@
+package org.acra.sender;
+
+import android.app.IntentService;
+import android.content.Intent;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+import org.acra.ACRAConstants;
+import org.acra.config.ACRAConfiguration;
+import org.acra.file.CrashReportFileNameParser;
+import org.acra.file.ReportLocator;
+
+import java.io.File;
+import java.util.ArrayList;
+import java.util.List;
+
+import static org.acra.ACRA.LOG_TAG;
+
+public class SenderService extends IntentService {
+
+    public static final String EXTRA_ONLY_SEND_SILENT_REPORTS = "onlySendSilentReports";
+    public static final String EXTRA_APPROVE_REPORTS_FIRST = "approveReportsFirst";
+    public static final String EXTRA_REPORT_SENDER_FACTORIES = "reportSenderFactories";
+    public static final String EXTRA_ACRA_CONFIG = "acraConfig";
+
+    private final ReportLocator locator = new ReportLocator(this);
+
+    public SenderService() {
+        super("ACRA SenderService");
+    }
+
+    @Override
+    protected void onHandleIntent(@NonNull final Intent intent) {
+
+        final boolean onlySendSilentReports = intent.getBooleanExtra(EXTRA_ONLY_SEND_SILENT_REPORTS, false);
+        final boolean approveReportsFirst = intent.getBooleanExtra(EXTRA_APPROVE_REPORTS_FIRST, false);
+
+        //noinspection unchecked
+        final List<Class<? extends ReportSenderFactory>> senderFactoryClasses = (List<Class<? extends ReportSenderFactory>>) intent.getSerializableExtra(EXTRA_REPORT_SENDER_FACTORIES);
+
+        final ACRAConfiguration config = (ACRAConfiguration) intent.getSerializableExtra(EXTRA_ACRA_CONFIG);
+
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "About to start sending reports from SenderService");
+        try {
+            final List<ReportSender> senderInstances = getSenderInstances(config, senderFactoryClasses);
+
+            // Mark reports as approved
+            if (approveReportsFirst) {
+                markReportsAsApproved();
+            }
+
+            // Get approved reports
+            final File[] reports = locator.getApprovedReports();
+
+            final ReportDistributor reportDistributor = new ReportDistributor(this, config, senderInstances);
+
+            // Iterate over approved reports and send via all Senders.
+            int reportsSentCount = 0; // Use to rate limit sending
+            final CrashReportFileNameParser fileNameParser = new CrashReportFileNameParser();
+            for (final File report : reports) {
+                if (onlySendSilentReports && !fileNameParser.isSilent(report.getName())) {
+                    continue;
+                }
+
+                if (reportsSentCount >= ACRAConstants.MAX_SEND_REPORTS) {
+                    break; // send only a few reports to avoid overloading the network
+                }
+
+                reportDistributor.distribute(report);
+                reportsSentCount++;
+            }
+        } catch (Exception e) {
+            ACRA.log.e(LOG_TAG, "", e);
+        }
+
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Finished sending reports from SenderService");
+    }
+
+    @NonNull
+    private List<ReportSender> getSenderInstances(@NonNull ACRAConfiguration config, @NonNull List<Class<? extends ReportSenderFactory>> factoryClasses) {
+        final List<ReportSender> reportSenders = new ArrayList<ReportSender>();
+        for (final Class<? extends ReportSenderFactory> factoryClass : factoryClasses) {
+            try {
+                final ReportSenderFactory factory = factoryClass.newInstance();
+                final ReportSender sender = factory.create(this.getApplication(), config);
+                reportSenders.add(sender);
+            } catch (InstantiationException e) {
+                ACRA.log.w(LOG_TAG, "Could not construct ReportSender from " + factoryClass, e);
+            } catch (IllegalAccessException e) {
+                ACRA.log.w(LOG_TAG, "Could not construct ReportSender from " + factoryClass, e);
+            }
+        }
+        return reportSenders;
+    }
+
+    /**
+     * Flag all pending reports as "approved" by the user. These reports can be sent.
+     */
+    private void markReportsAsApproved() {
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Mark all pending reports as approved.");
+
+        for (File report : locator.getUnapprovedReports()) {
+            final File approvedReport = new File(locator.getApprovedFolder(), report.getName());
+            if (!report.renameTo(approvedReport)) {
+                ACRA.log.w(LOG_TAG, "Could not rename approved report from " + report + " to " + approvedReport);
+            }
+        }
+    }
+}
diff --git a/src/main/java/org/acra/sender/SenderServiceStarter.java b/src/main/java/org/acra/sender/SenderServiceStarter.java
new file mode 100644
index 00000000..71ee6dd2
--- /dev/null
+++ b/src/main/java/org/acra/sender/SenderServiceStarter.java
@@ -0,0 +1,44 @@
+package org.acra.sender;
+
+import android.content.Context;
+import android.content.Intent;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+import org.acra.config.ACRAConfiguration;
+
+import java.util.ArrayList;
+
+import static org.acra.ACRA.LOG_TAG;
+
+/**
+ * Starts the Service(Intent)Service to process and send pending reports.
+ */
+public class SenderServiceStarter {
+
+    private final Context context;
+    private final ACRAConfiguration config;
+
+    public SenderServiceStarter(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        this.context = context;
+        this.config = config;
+    }
+
+    /**
+     * Starts a Thread to start sending outstanding error reports.
+     *
+     * @param onlySendSilentReports If true then only send silent reports.
+     * @param approveReportsFirst   If true then approve unapproved reports first.
+     */
+    public void startService(boolean onlySendSilentReports, boolean approveReportsFirst) {
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "About to start SenderService");
+        final Intent intent = new Intent(context, SenderService.class);
+        intent.putExtra(SenderService.EXTRA_ONLY_SEND_SILENT_REPORTS, onlySendSilentReports);
+        intent.putExtra(SenderService.EXTRA_APPROVE_REPORTS_FIRST, approveReportsFirst);
+
+        intent.putExtra(SenderService.EXTRA_REPORT_SENDER_FACTORIES, new ArrayList<Class<? extends ReportSenderFactory>>(config.reportSenderFactoryClasses()));
+
+        intent.putExtra(SenderService.EXTRA_ACRA_CONFIG, config);
+        context.startService(intent);
+    }
+}
diff --git a/src/main/java/org/acra/util/ApplicationStartupProcessor.java b/src/main/java/org/acra/util/ApplicationStartupProcessor.java
new file mode 100644
index 00000000..f4814a4a
--- /dev/null
+++ b/src/main/java/org/acra/util/ApplicationStartupProcessor.java
@@ -0,0 +1,104 @@
+package org.acra.util;
+
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.content.pm.PackageInfo;
+import android.support.annotation.NonNull;
+import android.widget.Toast;
+import org.acra.ACRA;
+import org.acra.ReportingInteractionMode;
+import org.acra.config.ACRAConfiguration;
+import org.acra.file.BulkReportDeleter;
+import org.acra.file.CrashReportFileNameParser;
+import org.acra.file.ReportLocator;
+import org.acra.prefs.PrefUtils;
+import org.acra.prefs.SharedPreferencesFactory;
+import org.acra.sender.SenderServiceStarter;
+
+import java.io.File;
+
+/**
+ * Looks for any existing reports and starts sending them.
+ */
+public final class ApplicationStartupProcessor {
+
+    private final Context context;
+    private final ACRAConfiguration config;
+
+    public ApplicationStartupProcessor(@NonNull Context context, @NonNull ACRAConfiguration config) {
+        this.context = context;
+        this.config = config;
+    }
+
+    /**
+     * Delete any old unsent reports if this is a newer version of the app than when we last started.
+     */
+    public void deleteUnsentReportsFromOldAppVersion() {
+        final SharedPreferences prefs = new SharedPreferencesFactory(context, config).create();
+        final long lastVersionNr = prefs.getInt(ACRA.PREF_LAST_VERSION_NR, 0);
+        final int appVersion = getAppVersion();
+
+        if (appVersion > lastVersionNr) {
+            final BulkReportDeleter reportDeleter = new BulkReportDeleter(context);
+            reportDeleter.deleteReports(true, 0);
+            reportDeleter.deleteReports(false, 0);
+
+            final SharedPreferences.Editor prefsEditor = prefs.edit();
+            prefsEditor.putInt(ACRA.PREF_LAST_VERSION_NR, appVersion);
+            PrefUtils.save(prefsEditor);
+        }
+    }
+
+    /**
+     * Deletes all the unapproved reports except for the last one.
+     *
+     * NOTIFICATION or DIALOG mode require explicit approval by user.
+     * If latest notification/dialog has been ignored: neither accepted nor refused; they will accumulate.
+     * So destroy all unapproved reports bar the last one.
+     */
+    public void deleteAllUnapprovedReportsBarOne() {
+        new BulkReportDeleter(context).deleteReports(false, 1);
+    }
+
+    /**
+     * If ReportingInteractionMode == Toast and at least one non silent report then show a Toast.
+     * All approved reports will be sent.
+     */
+    public void sendApprovedReports() {
+
+        final ReportLocator reportLocator = new ReportLocator(context);
+        final File[] reportFiles = reportLocator.getApprovedReports();
+
+        if (reportFiles.length == 0) {
+            return; // There are no approved reports, so bail now.
+        }
+
+        if (config.mode() == ReportingInteractionMode.TOAST && hasNonSilentApprovedReports(reportFiles)) {
+            ToastSender.sendToast(context, config.resToastText(), Toast.LENGTH_LONG);
+        }
+
+        // Send the approved reports.
+        final SenderServiceStarter starter = new SenderServiceStarter(context, config);
+        starter.startService(false, false);
+
+    }
+
+    /**
+     * @return app version or 0 if PackageInfo was not available.
+     */
+    private int getAppVersion() {
+        final PackageManagerWrapper packageManagerWrapper = new PackageManagerWrapper(context);
+        final PackageInfo packageInfo = packageManagerWrapper.getPackageInfo();
+        return (packageInfo == null) ? 0 : packageInfo.versionCode;
+    }
+
+    private boolean hasNonSilentApprovedReports(File[] reportFiles) {
+        final CrashReportFileNameParser fileNameParser = new CrashReportFileNameParser();
+        for (final File file : reportFiles) {
+            if (!fileNameParser.isSilent(file.getName())) {
+                return true;
+            }
+        }
+        return false;
+    }
+}
diff --git a/src/main/java/org/acra/util/HttpRequest.java b/src/main/java/org/acra/util/HttpRequest.java
index 0df8a8c0..f34e16c0 100644
--- a/src/main/java/org/acra/util/HttpRequest.java
+++ b/src/main/java/org/acra/util/HttpRequest.java
@@ -5,14 +5,17 @@
  */
 package org.acra.util;
 
+import android.content.Context;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
 import android.util.Base64;
+
 import org.acra.ACRA;
+import org.acra.config.ACRAConfiguration;
+import org.acra.security.KeyStoreHelper;
 import org.acra.sender.HttpSender.Method;
 import org.acra.sender.HttpSender.Type;
 
-import javax.net.ssl.HttpsURLConnection;
-import javax.net.ssl.SSLContext;
-import javax.net.ssl.TrustManagerFactory;
 import java.io.BufferedOutputStream;
 import java.io.IOException;
 import java.io.OutputStream;
@@ -24,21 +27,42 @@
 import java.security.KeyStore;
 import java.util.Map;
 
+import javax.net.ssl.HttpsURLConnection;
+import javax.net.ssl.SSLContext;
+import javax.net.ssl.TrustManagerFactory;
+
+import ch.acra.acra.BuildConfig;
+
 import static org.acra.ACRA.LOG_TAG;
 
 public final class HttpRequest {
 
+    private static final String UTF8 = "UTF-8";
+    private static final int HTTP_SUCCESS = 200;
+    private static final int HTTP_REDIRECT = 300;
+    private static final int HTTP_CLIENT_ERROR = 400;
+    private static final int HTTP_UNAUTHORIZED = 401;
+    private static final int HTTP_FORBIDDEN = 403;
+    private static final int HTTP_METHOD_NOT_ALLOWED = 405;
+    private static final int HTTP_CONFLICT = 409;
+    private static final int MAX_HTTP_CODE = 600;
+
+    private final ACRAConfiguration config;
     private String login;
     private String password;
     private int connectionTimeOut = 3000;
     private int socketTimeOut = 3000;
-    private Map<String,String> headers;
-    
-    public void setLogin(String login) {
+    private Map<String, String> headers;
+
+    public HttpRequest(@NonNull ACRAConfiguration config) {
+        this.config = config;
+    }
+
+    public void setLogin(@Nullable String login) {
         this.login = login;
     }
 
-    public void setPassword(String password) {
+    public void setPassword(@Nullable String password) {
         this.password = password;
     }
 
@@ -50,19 +74,19 @@ public void setSocketTimeOut(int socketTimeOut) {
         this.socketTimeOut = socketTimeOut;
     }
 
-    public void setHeaders(Map<String,String> headers) {
-       this.headers = headers;
+    public void setHeaders(@Nullable Map<String, String> headers) {
+        this.headers = headers;
     }
 
-    
+
     /**
      * Posts to a URL.
-     * 
-     * @param url       URL to which to post.
-     * @param content   Map of parameters to post to a URL.
+     *
+     * @param url     URL to which to post.
+     * @param content Map of parameters to post to a URL.
      * @throws IOException if the data cannot be posted.
      */
-    public void send(URL url, Method method, String content, Type type) throws IOException {
+    public void send(@NonNull Context context, @NonNull URL url, @NonNull Method method, @NonNull String content, @NonNull Type type) throws IOException {
 
         final HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();
 
@@ -73,8 +97,8 @@ public void send(URL url, Method method, String content, Type type) throws IOExc
 
                 final String algorithm = TrustManagerFactory.getDefaultAlgorithm();
                 final TrustManagerFactory tmf = TrustManagerFactory.getInstance(algorithm);
+                final KeyStore keyStore = KeyStoreHelper.getKeyStore(context, config);
 
-                final KeyStore keyStore = ACRA.getConfig().keyStore();
                 tmf.init(keyStore);
 
                 final SSLContext sslContext = SSLContext.getInstance("TLS");
@@ -87,9 +111,9 @@ public void send(URL url, Method method, String content, Type type) throws IOExc
         }
 
         // Set Credentials
-        if ((login != null) && (password != null)) {
-            final String credentials = login + ":" + password;
-            final String encoded = new String(Base64.encode(credentials.getBytes("UTF-8"), Base64.DEFAULT), "UTF-8");
+        if (login != null && password != null) {
+            final String credentials = login + ':' + password;
+            final String encoded = new String(Base64.encode(credentials.getBytes(UTF8), Base64.NO_WRAP), UTF8);
             urlConnection.setRequestProperty("Authorization", "Basic " + encoded);
         }
 
@@ -97,19 +121,18 @@ public void send(URL url, Method method, String content, Type type) throws IOExc
         urlConnection.setReadTimeout(socketTimeOut);
 
         // Set Headers
-        urlConnection.setRequestProperty("User-Agent", "Android");
+        urlConnection.setRequestProperty("User-Agent", String.format("Android ACRA %1$s", BuildConfig.VERSION_NAME)); //sent ACRA version to server
         urlConnection.setRequestProperty("Accept",
                 "text/html,application/xml,application/json,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5");
         urlConnection.setRequestProperty("Content-Type", type.getContentType());
 
-        if(headers != null) {
-            for (final String header : headers.keySet()) {
-                final String value = headers.get(header);
-                urlConnection.setRequestProperty(header, value);
+        if (headers != null) {
+            for (final Map.Entry<String, String> header : headers.entrySet()) {
+                urlConnection.setRequestProperty(header.getKey(), header.getValue());
             }
         }
 
-        final byte[] contentAsBytes = content.getBytes("UTF-8");
+        final byte[] contentAsBytes = content.getBytes(UTF8);
 
         // write output - see http://developer.android.com/reference/java/net/HttpURLConnection.html
         urlConnection.setRequestMethod(method.name());
@@ -122,32 +145,42 @@ public void send(URL url, Method method, String content, Type type) throws IOExc
         urlConnection.connect();
 
         final OutputStream outputStream = new BufferedOutputStream(urlConnection.getOutputStream());
-        outputStream.write(contentAsBytes);
-        outputStream.flush();
-        outputStream.close();
+        try {
+            outputStream.write(contentAsBytes);
+            outputStream.flush();
+        } finally {
+            IOUtils.safeClose(outputStream);
+        }
 
-        ACRA.log.d(LOG_TAG,"Sending request to " + url);
-        if(ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Http " + method.name() + " content : ");
-        if(ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, content);
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Sending request to " + url);
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, "Http " + method.name() + " content : ");
+        if (ACRA.DEV_LOGGING) ACRA.log.d(LOG_TAG, content);
 
         final int responseCode = urlConnection.getResponseCode();
-        ACRA.log.d(LOG_TAG,"Request response : " + responseCode + " : " + urlConnection.getResponseMessage());
-        if ((responseCode >= 200) && (responseCode < 300)) {
+        if (ACRA.DEV_LOGGING)
+            ACRA.log.d(LOG_TAG, "Request response : " + responseCode + " : " + urlConnection.getResponseMessage());
+        if ((responseCode >= HTTP_SUCCESS) && (responseCode < HTTP_REDIRECT)) {
             // All is good
-            ACRA.log.d(LOG_TAG,"Request received by server");
-        } else if (responseCode == 403) {
+            ACRA.log.i(LOG_TAG, "Request received by server");
+        } else if (responseCode == HTTP_UNAUTHORIZED) {
+            //401 means the server rejected the authentication. The request must not be repeated. Discard it.
+            //This probably means that nothing can be sent with this configuration, maybe ACRA should disable itself after it?
+            ACRA.log.w(LOG_TAG, "401: Login validation error on server - request will be discarded");
+        } else if (responseCode == HTTP_FORBIDDEN) {
             // 403 is an explicit data validation refusal from the server. The request must not be repeated. Discard it.
-            ACRA.log.d(LOG_TAG, "Data validation error on server - request will be discarded");
-        } else if (responseCode == 409) {
+            ACRA.log.w(LOG_TAG, "403: Data validation error on server - request will be discarded");
+        } else if (responseCode == HTTP_METHOD_NOT_ALLOWED) {
+            //405 means the server doesn't allow this request method. The request must not be repeated. Discard it.
+            //This probably means that nothing can be sent with this configuration, maybe ACRA should disable itself after it?
+            ACRA.log.w(LOG_TAG, "405: Server rejected Http " + method + " - request will be discarded");
+        } else if (responseCode == HTTP_CONFLICT) {
             // 409 means that the report has been received already. So we can discard it.
-            ACRA.log.d(LOG_TAG, "Server has already received this post - request will be discarded");
-        } else if ((responseCode >= 400) && (responseCode < 600)) {
-            if (ACRA.DEV_LOGGING) {
-                ACRA.log.d(LOG_TAG, "Could not send ACRA Post");
-            }
+            ACRA.log.w(LOG_TAG, "409: Server has already received this post - request will be discarded");
+        } else if ((responseCode >= HTTP_CLIENT_ERROR) && (responseCode < MAX_HTTP_CODE)) {
+            ACRA.log.w(LOG_TAG, "Could not send ACRA Post responseCode=" + responseCode + " message=" + urlConnection.getResponseMessage());
             throw new IOException("Host returned error code " + responseCode);
         } else {
-            ACRA.log.w(LOG_TAG, "Could not send ACRA Post - request will be discarded");
+            ACRA.log.w(LOG_TAG, "Could not send ACRA Post - request will be discarded. responseCode=" + responseCode + " message=" + urlConnection.getResponseMessage());
         }
 
         urlConnection.disconnect();
@@ -155,25 +188,24 @@ public void send(URL url, Method method, String content, Type type) throws IOExc
 
     /**
      * Converts a Map of parameters into a URL encoded Sting.
-     * 
-     * @param parameters
-     *            Map of parameters to convert.
+     *
+     * @param parameters Map of parameters to convert.
      * @return URL encoded String representing the parameters.
-     * @throws UnsupportedEncodingException
-     *             if one of the parameters couldn't be converted to UTF-8.
+     * @throws UnsupportedEncodingException if one of the parameters couldn't be converted to UTF-8.
      */
-    public static String getParamsAsFormString(Map<?, ?> parameters) throws UnsupportedEncodingException {
+    @NonNull
+    public static String getParamsAsFormString(@NonNull Map<?, ?> parameters) throws UnsupportedEncodingException {
 
         final StringBuilder dataBfr = new StringBuilder();
-        for (final Object key : parameters.keySet()) {
+        for (final Map.Entry<?, ?> entry : parameters.entrySet()) {
             if (dataBfr.length() != 0) {
                 dataBfr.append('&');
             }
-            final Object preliminaryValue = parameters.get(key);
+            final Object preliminaryValue = entry.getValue();
             final Object value = (preliminaryValue == null) ? "" : preliminaryValue;
-            dataBfr.append(URLEncoder.encode(key.toString(), "UTF-8"));
+            dataBfr.append(URLEncoder.encode(entry.getKey().toString(), UTF8));
             dataBfr.append('=');
-            dataBfr.append(URLEncoder.encode(value.toString(), "UTF-8"));
+            dataBfr.append(URLEncoder.encode(value.toString(), UTF8));
         }
 
         return dataBfr.toString();
diff --git a/src/main/java/org/acra/util/IOUtils.java b/src/main/java/org/acra/util/IOUtils.java
new file mode 100644
index 00000000..de4b90b2
--- /dev/null
+++ b/src/main/java/org/acra/util/IOUtils.java
@@ -0,0 +1,131 @@
+/*
+ *  Copyright 2016
+ *
+ *  Licensed under the Apache License, Version 2.0 (the "License");
+ *  you may not use this file except in compliance with the License.
+ *  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.acra.util;
+
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
+import android.text.TextUtils;
+
+import com.android.internal.util.Predicate;
+
+import org.acra.ACRAConstants;
+import org.acra.collections.BoundedLinkedList;
+
+import java.io.BufferedReader;
+import java.io.Closeable;
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.util.LinkedList;
+import java.util.List;
+
+/**
+ * @author William Ferguson, F43nd1r
+ * @since 4.6.0
+ */
+public final class IOUtils {
+
+    private static final Predicate<String> DEFAULT_FILTER = new Predicate<String>() {
+        @Override
+        public boolean apply(String s) {
+            return true;
+        }
+    };
+    private static final int NO_LIMIT = -1;
+
+    private IOUtils() {
+    }
+
+
+    /**
+     * Closes a Closeable.
+     *
+     * @param closeable Closeable to close. If closeable is null then method just returns.
+     */
+    public static void safeClose(@Nullable Closeable closeable) {
+        if (closeable == null) return;
+
+        try {
+            closeable.close();
+        } catch (IOException ignored) {
+            // We made out best effort to release this resource. Nothing more we can do.
+        }
+    }
+
+    /**
+     * Reads an InputStream into a string
+     *
+     * @param input the stream
+     * @return the read string
+     * @throws IOException
+     */
+    @NonNull
+    public static String streamToString(@NonNull InputStream input) throws IOException {
+        return streamToString(input, DEFAULT_FILTER, NO_LIMIT);
+    }
+
+    /**
+     * Reads an InputStream into a string
+     *
+     * @param input  the stream
+     * @param filter should return false for lines which should be excluded
+     * @return the read string
+     * @throws IOException
+     */
+    @NonNull
+    public static String streamToString(@NonNull InputStream input, Predicate<String> filter) throws IOException {
+        return streamToString(input, filter, NO_LIMIT);
+    }
+
+    /**
+     * Reads an InputStream into a string
+     *
+     * @param input the stream
+     * @param limit the maximum number of lines to read (the last x lines are kept)
+     * @return the read string
+     * @throws IOException
+     */
+    @NonNull
+    public static String streamToString(@NonNull InputStream input, int limit) throws IOException {
+        return streamToString(input, DEFAULT_FILTER, limit);
+    }
+
+    /**
+     * Reads an InputStream into a string
+     *
+     * @param input  the stream
+     * @param filter should return false for lines which should be excluded
+     * @param limit the maximum number of lines to read (the last x lines are kept)
+     * @return the read string
+     * @throws IOException
+     */
+    @NonNull
+    public static String streamToString(@NonNull InputStream input, Predicate<String> filter, int limit) throws IOException {
+        final BufferedReader reader = new BufferedReader(new InputStreamReader(input), ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES);
+        try {
+            String line;
+            final List<String> buffer = limit == NO_LIMIT ? new LinkedList<String>() : new BoundedLinkedList<String>(limit);
+            while ((line = reader.readLine()) != null) {
+                if (filter.apply(line)) {
+                    buffer.add(line);
+                }
+            }
+            return TextUtils.join("\n", buffer);
+        } finally {
+            safeClose(reader);
+        }
+    }
+}
diff --git a/src/main/java/org/acra/util/Installation.java b/src/main/java/org/acra/util/Installation.java
index 16921f38..40ccb2e1 100644
--- a/src/main/java/org/acra/util/Installation.java
+++ b/src/main/java/org/acra/util/Installation.java
@@ -4,16 +4,17 @@
  */
 package org.acra.util;
 
+import android.content.Context;
+import android.support.annotation.NonNull;
+
+import org.acra.ACRA;
+
 import java.io.File;
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.RandomAccessFile;
 import java.util.UUID;
 
-import org.acra.ACRA;
-
-import android.content.Context;
-
 import static org.acra.ACRA.LOG_TAG;
 
 /**
@@ -27,12 +28,14 @@
  * android developers blog.</a>
  * </p>
  */
-public class Installation {
+public final class Installation {
+    private Installation(){}
 
     private static String sID;
     private static final String INSTALLATION = "ACRA-INSTALLATION";
 
-    public synchronized static String id(Context context) {
+    @NonNull
+    public static synchronized String id(@NonNull Context context) {
         if (sID == null) {
             final File installation = new File(context.getFilesDir(), INSTALLATION);
             try {
@@ -51,18 +54,19 @@ public synchronized static String id(Context context) {
         return sID;
     }
 
-    private static String readInstallationFile(File installation) throws IOException {
+    @NonNull
+    private static String readInstallationFile(@NonNull File installation) throws IOException {
         final RandomAccessFile f = new RandomAccessFile(installation, "r");
         final byte[] bytes = new byte[(int) f.length()];
         try {
             f.readFully(bytes);
         } finally {
-            f.close();
+            IOUtils.safeClose(f);
         }
         return new String(bytes);
     }
 
-    private static void writeInstallationFile(File installation) throws IOException {
+    private static void writeInstallationFile(@NonNull File installation) throws IOException {
         final FileOutputStream out = new FileOutputStream(installation);
         try {
             final String id = UUID.randomUUID().toString();
diff --git a/src/main/java/org/acra/util/JSONReportBuilder.java b/src/main/java/org/acra/util/JSONReportBuilder.java
index d0a19faa..c2129a30 100644
--- a/src/main/java/org/acra/util/JSONReportBuilder.java
+++ b/src/main/java/org/acra/util/JSONReportBuilder.java
@@ -1,24 +1,25 @@
 package org.acra.util;
 
-import java.io.BufferedReader;
-import java.io.IOException;
-import java.io.StringReader;
-import java.text.NumberFormat;
-import java.text.ParseException;
-import java.util.Locale;
+import android.support.annotation.NonNull;
 
 import org.acra.ACRA;
 import org.acra.ReportField;
-import org.acra.collector.CollectorUtil;
 import org.acra.collector.CrashReportData;
-import org.acra.sender.ReportSenderException;
 import org.json.JSONArray;
 import org.json.JSONException;
 import org.json.JSONObject;
 
+import java.io.BufferedReader;
+import java.io.IOException;
+import java.io.StringReader;
+import java.text.NumberFormat;
+import java.text.ParseException;
+import java.util.Locale;
+
 import static org.acra.ACRA.LOG_TAG;
 
-public class JSONReportBuilder {
+public final class JSONReportBuilder {
+    private JSONReportBuilder(){}
     /**
      * <p>
      * Create a JSONObject containing the whole report data with the most
@@ -64,27 +65,27 @@
      *            The ACRA report data structure.
      * @return A JSONObject containing all fields from the report converted to
      *         JSON.
-     * @throws ReportSenderException
      * @throws JSONReportException
      */
-    public static JSONObject buildJSONReport(CrashReportData errorContent) throws JSONReportException {
-        JSONObject jsonReport = new JSONObject();
+    @NonNull
+    public static JSONObject buildJSONReport(@NonNull CrashReportData errorContent) throws JSONReportException {
+        final JSONObject jsonReport = new JSONObject();
         BufferedReader reader = null;
         for (ReportField key : errorContent.keySet()) {
             try {
                 // Each ReportField can be identified as a substructure and not
                 // a simple String value.
                 if (key.containsKeyValuePairs()) {
-                    JSONObject subObject = new JSONObject();
-                    String strContent = errorContent.getProperty(key);
-                    reader = new BufferedReader(new StringReader(strContent), 1024);
-                    String line = null;
+                    final JSONObject subObject = new JSONObject();
+                    final String strContent = errorContent.getProperty(key);
+                    reader = new BufferedReader(new StringReader(strContent), 1024); //TODO: 1024 should be a constant. Use ACRAConstants.DEFAULT_BUFFER_SIZE_IN_BYTES ?
+                    String line;
                     try {
                         while ((line = reader.readLine()) != null) {
                             addJSONFromProperty(subObject, line);
                         }
                     } catch (IOException e) {
-                        ACRA.log.e(LOG_TAG, "Error while converting " + key.name() + " to JSON.", e);
+                        ACRA.log.w(LOG_TAG, "Error while converting " + key.name() + " to JSON.", e);
                     }
                     jsonReport.accumulate(key.name(), subObject);
                 } else {
@@ -94,7 +95,7 @@ public static JSONObject buildJSONReport(CrashReportData errorContent) throws JS
             } catch (JSONException e) {
                 throw new JSONReportException("Could not create JSON object for key " + key, e);
             } finally {
-            	CollectorUtil.safeClose(reader);
+            	IOUtils.safeClose(reader);
             }
         }
         return jsonReport;
@@ -138,39 +139,38 @@ public static JSONObject buildJSONReport(CrashReportData errorContent) throws JS
      *            A string containing "some.key.name=Any value"
      * @throws JSONException
      */
-    private static void addJSONFromProperty(JSONObject destination, String propertyString) throws JSONException {
-        int equalsIndex = propertyString.indexOf('=');
+    private static void addJSONFromProperty(@NonNull JSONObject destination, @NonNull String propertyString) throws JSONException {
+        final int equalsIndex = propertyString.indexOf('=');
         if (equalsIndex > 0) {
-            JSONObject finalObject = destination;
-            String currentKey = propertyString.substring(0, equalsIndex).trim();
-            String currentValue = propertyString.substring(equalsIndex + 1).trim();
+            final String currentKey = propertyString.substring(0, equalsIndex).trim();
+            final String currentValue = propertyString.substring(equalsIndex + 1).trim();
             Object value = guessType(currentValue);
             if(value instanceof String) {
                 value = ((String) value).replaceAll("\\\\n","\n");
             }
-            String[] splitKey = currentKey.split("\\.");
+            final String[] splitKey = currentKey.split("\\.");
             if (splitKey.length > 1) {
-                addJSONSubTree(finalObject, splitKey, value);
+                addJSONSubTree(destination, splitKey, value);
             } else {
-                finalObject.accumulate(currentKey, value);
+                destination.accumulate(currentKey, value);
             }
         } else {
             destination.put(propertyString.trim(), true);
         }
     }
 
-    private static Object guessType(String value) {
-        if (value.equalsIgnoreCase("true"))
+    @NonNull
+    private static Object guessType(@NonNull String value) {
+        if ("true".equalsIgnoreCase(value))
             return true;
-        if (value.equalsIgnoreCase("false"))
+        if ("false".equalsIgnoreCase(value))
             return false;
 
         if (value.matches("(?:^|\\s)([1-9](?:\\d*|(?:\\d{0,2})(?:,\\d{3})*)(?:\\.\\d*[1-9])?|0?\\.\\d*[1-9]|0)(?:\\s|$)")) {
-            NumberFormat format = NumberFormat.getInstance(Locale.US);
+            final NumberFormat format = NumberFormat.getInstance(Locale.US);
             try {
-                Number number = format.parse(value);
-                return number;
-            } catch (ParseException e) {
+                return format.parse(value);
+            } catch (ParseException ignored) {
                 // never mind
             }
         }
@@ -190,21 +190,21 @@ private static Object guessType(String value) {
      *            The value to be inserted.
      * @throws JSONException
      */
-    private static void addJSONSubTree(JSONObject destination, String[] keys, Object value) throws JSONException {
+    private static void addJSONSubTree(@NonNull JSONObject destination, @NonNull String[] keys, Object value) throws JSONException {
         for (int i = 0; i < keys.length; i++) {
-            String subKey = keys[i];
+            final String subKey = keys[i];
             if (i < keys.length - 1) {
                 JSONObject intermediate = null;
                 if (destination.isNull(subKey)) {
                     intermediate = new JSONObject();
                     destination.accumulate(subKey, intermediate);
                 } else {
-                    Object target = destination.get(subKey);
+                    final Object target = destination.get(subKey);
                     if (target instanceof JSONObject) {
                         intermediate = destination.getJSONObject(subKey);
                     } else if (target instanceof JSONArray) {
                         // Unexpected JSONArray, see issue #186
-                        JSONArray wildCard = destination.getJSONArray(subKey);
+                        final JSONArray wildCard = destination.getJSONArray(subKey);
                         for (int j = 0; j < wildCard.length(); j++) {
                             intermediate = wildCard.optJSONObject(j);
                             if (intermediate != null) {
@@ -215,7 +215,7 @@ private static void addJSONSubTree(JSONObject destination, String[] keys, Object
                     }
 
                     if (intermediate == null) {
-                        ACRA.log.e(LOG_TAG, "Unknown json subtree type, see issue #186");
+                        ACRA.log.w(LOG_TAG, "Unknown json subtree type, see issue #186");
                         // We should never get here, but if we do, drop this value to still send the report
                         return;
                     }
@@ -233,5 +233,5 @@ private static void addJSONSubTree(JSONObject destination, String[] keys, Object
         public JSONReportException(String message, Throwable e) {
             super(message, e);
         }
-    };
+    }
 }
diff --git a/src/main/java/org/acra/util/NaiveTrustManager.java b/src/main/java/org/acra/util/NaiveTrustManager.java
deleted file mode 100644
index 57746ecd..00000000
--- a/src/main/java/org/acra/util/NaiveTrustManager.java
+++ /dev/null
@@ -1,60 +0,0 @@
-/*
- *  Copyright 2010 Kevin Gaudin
- *
- *  Licensed under the Apache License, Version 2.0 (the "License");
- *  you may not use this file except in compliance with the License.
- *  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- *  Unless required by applicable law or agreed to in writing, software
- *  distributed under the License is distributed on an "AS IS" BASIS,
- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- *  See the License for the specific language governing permissions and
- *  limitations under the License.
- */
-package org.acra.util;
-
-import java.security.cert.CertificateException;
-import java.security.cert.X509Certificate;
-
-import javax.net.ssl.X509TrustManager;
-
-/**
- * Accepts any certificate, ideal for self-signed certificates.
- */
-class NaiveTrustManager implements X509TrustManager {
-    /*
-     * (non-Javadoc)
-     * 
-     * @see javax.net.ssl.X509TrustManager#getAcceptedIssuers()
-     */
-    @Override
-    public X509Certificate[] getAcceptedIssuers() {
-        return new X509Certificate[0];
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see
-     * javax.net.ssl.X509TrustManager#checkClientTrusted(java.security.cert.
-     * X509Certificate[], java.lang.String)
-     */
-    @Override
-    public void checkClientTrusted(X509Certificate[] x509CertificateArray,
-            String string) throws CertificateException {
-    }
-
-    /*
-     * (non-Javadoc)
-     * 
-     * @see
-     * javax.net.ssl.X509TrustManager#checkServerTrusted(java.security.cert.
-     * X509Certificate[], java.lang.String)
-     */
-    @Override
-    public void checkServerTrusted(X509Certificate[] x509CertificateArray,
-            String string) throws CertificateException {
-    }
-}
\ No newline at end of file
diff --git a/src/main/java/org/acra/util/PackageManagerWrapper.java b/src/main/java/org/acra/util/PackageManagerWrapper.java
index cb9ab87c..fc582d4b 100644
--- a/src/main/java/org/acra/util/PackageManagerWrapper.java
+++ b/src/main/java/org/acra/util/PackageManagerWrapper.java
@@ -1,13 +1,15 @@
 package org.acra.util;
 
-import static org.acra.ACRA.LOG_TAG;
-
 import android.content.Context;
 import android.content.pm.PackageInfo;
 import android.content.pm.PackageManager;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
 
 import org.acra.ACRA;
 
+import static org.acra.ACRA.LOG_TAG;
+
 /**
  * Responsible for wrapping calls to PackageManager to ensure that they always complete without throwing RuntimeExceptions.
  * <p>
@@ -28,7 +30,7 @@
 
     private final Context context;
 
-    public PackageManagerWrapper(Context context) {
+    public PackageManagerWrapper(@NonNull Context context) {
         this.context = context;
     }
 
@@ -36,7 +38,7 @@ public PackageManagerWrapper(Context context) {
      * @param permission    Manifest.permission to check whether it has been granted.
      * @return true if the permission has been granted to the app, false if it hasn't been granted or the PackageManager could not be contacted.
      */
-    public boolean hasPermission(String permission) {
+    public boolean hasPermission(@NonNull String permission) {
         final PackageManager pm = context.getPackageManager();
         if (pm == null) {
             return false;
@@ -54,6 +56,7 @@ public boolean hasPermission(String permission) {
     /**
      * @return PackageInfo for the current application or null if the PackageManager could not be contacted.
      */
+    @Nullable
     public PackageInfo getPackageInfo() {
         final PackageManager pm = context.getPackageManager();
         if (pm == null) {
@@ -63,7 +66,7 @@ public PackageInfo getPackageInfo() {
         try {
             return pm.getPackageInfo(context.getPackageName(), 0);
         } catch (PackageManager.NameNotFoundException e) {
-            ACRA.log.v(LOG_TAG, "Failed to find PackageInfo for current App : " + context.getPackageName());
+            ACRA.log.w(LOG_TAG, "Failed to find PackageInfo for current App : " + context.getPackageName());
             return null;
         } catch (RuntimeException e) {
             // To catch RuntimeException("Package manager has died") that can occur on some version of Android,
diff --git a/src/main/java/org/acra/util/ReflectionException.java b/src/main/java/org/acra/util/ReflectionException.java
deleted file mode 100644
index 16bb0e26..00000000
--- a/src/main/java/org/acra/util/ReflectionException.java
+++ /dev/null
@@ -1,11 +0,0 @@
-package org.acra.util;
-
-/**
- * Thrown when an error occurs during reflection.
- */
-public final class ReflectionException extends Exception  {
-
-    public ReflectionException(String msg, Throwable th) {
-        super(msg, th);
-    }
-}
diff --git a/src/main/java/org/acra/util/ReflectionHelper.java b/src/main/java/org/acra/util/ReflectionHelper.java
deleted file mode 100644
index 6463e309..00000000
--- a/src/main/java/org/acra/util/ReflectionHelper.java
+++ /dev/null
@@ -1,20 +0,0 @@
-package org.acra.util;
-
-/**
- * Helps to construct objects via reflection.
- */
-public final class ReflectionHelper {
-
-    public Object create(String className) throws ReflectionException {
-        try {
-            final Class clazz = Class.forName(className);
-            return clazz.newInstance();
-        } catch (ClassNotFoundException e) {
-            throw new ReflectionException("Could not find class : " + className, e);
-        } catch (InstantiationException e) {
-            throw new ReflectionException("Could not instantiate class : " + className, e);
-        } catch (IllegalAccessException e) {
-            throw new ReflectionException("Could not access class : " + className, e);
-        }
-    }
-}
diff --git a/src/main/java/org/acra/util/ReportUtils.java b/src/main/java/org/acra/util/ReportUtils.java
index 3aeb57c2..7579e74b 100644
--- a/src/main/java/org/acra/util/ReportUtils.java
+++ b/src/main/java/org/acra/util/ReportUtils.java
@@ -1,10 +1,12 @@
 package org.acra.util;
 
 import android.content.Context;
+import android.os.Build;
 import android.os.Environment;
 import android.os.StatFs;
+import android.support.annotation.NonNull;
+import android.support.annotation.Nullable;
 import android.telephony.TelephonyManager;
-import android.util.SparseArray;
 import org.acra.ACRA;
 import org.acra.ACRAConstants;
 
@@ -21,11 +23,12 @@
 
 /**
  * Responsible for providing base utilities used when constructing the report.
- * <p/>
+ *
  * @author William Ferguson
  * @since 4.3.0
  */
 public final class ReportUtils {
+    private ReportUtils(){}
 
     /**
      * Calculates the free memory of the device. This is based on an inspection of the filesystem, which in android
@@ -36,8 +39,17 @@
     public static long getAvailableInternalMemorySize() {
         final File path = Environment.getDataDirectory();
         final StatFs stat = new StatFs(path.getPath());
-        final long blockSize = stat.getBlockSize();
-        final long availableBlocks = stat.getAvailableBlocks();
+        final long blockSize;
+        final long availableBlocks;
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {
+            blockSize = stat.getBlockSizeLong();
+            availableBlocks = stat.getAvailableBlocksLong();
+        } else {
+            //noinspection deprecation
+            blockSize = stat.getBlockSize();
+            //noinspection deprecation
+            availableBlocks = stat.getAvailableBlocks();
+        }
         return availableBlocks * blockSize;
     }
 
@@ -50,18 +62,29 @@ public static long getAvailableInternalMemorySize() {
     public static long getTotalInternalMemorySize() {
         final File path = Environment.getDataDirectory();
         final StatFs stat = new StatFs(path.getPath());
-        final long blockSize = stat.getBlockSize();
-        final long totalBlocks = stat.getBlockCount();
+        final long blockSize;
+        final long totalBlocks;
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {
+            blockSize = stat.getBlockSizeLong();
+            totalBlocks = stat.getBlockCountLong();
+        }
+        else {
+            //noinspection deprecation
+            blockSize = stat.getBlockSize();
+            //noinspection deprecation
+            totalBlocks = stat.getBlockCount();
+        }
         return totalBlocks * blockSize;
     }
 
     /**
      * Returns the DeviceId according to the TelephonyManager.
      *
-     * @param context   Context for the application being reported.
+     * @param context Context for the application being reported.
      * @return Returns the DeviceId according to the TelephonyManager or null if there is no TelephonyManager.
      */
-    public static String getDeviceId(Context context) {
+    @Nullable
+    public static String getDeviceId(@NonNull Context context) {
         try {
             final TelephonyManager tm = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
             return tm.getDeviceId();
@@ -71,7 +94,8 @@ public static String getDeviceId(Context context) {
         }
     }
 
-    public static String getApplicationFilePath(Context context) {
+    @NonNull
+    public static String getApplicationFilePath(@NonNull Context context) {
         final File filesDir = context.getFilesDir();
         if (filesDir != null) {
             return filesDir.getAbsolutePath();
@@ -80,48 +104,21 @@ public static String getApplicationFilePath(Context context) {
         ACRA.log.w(LOG_TAG, "Couldn't retrieve ApplicationFilePath for : " + context.getPackageName());
         return "Couldn't retrieve ApplicationFilePath";
     }
-    
-    /**
-     * Utility method used for debugging purposes, writes the content of a SparseArray to a String.
-     * @param sparseArray
-     * @return "{ key1 => value1, key2 => value2, ...}"
-     */
-    public static String sparseArrayToString(SparseArray<?> sparseArray) {
-        StringBuilder result = new StringBuilder();
-        if (sparseArray == null) {
-            return "null";
-        }
-
-        result.append('{');
-        for (int i = 0; i < sparseArray.size(); i++) {
-            result.append(sparseArray.keyAt(i));
-            result.append(" => ");
-            if (sparseArray.valueAt(i) == null) {
-                result.append("null");
-            } else {
-                result.append(sparseArray.valueAt(i).toString());
-            }
-            if(i < sparseArray.size() - 1) {
-                result.append(", ");
-            }
-        }
-        result.append('}');
-        return result.toString();
-    }
 
+    @NonNull
     public static String getLocalIpAddress() {
-        StringBuilder result = new StringBuilder();
+        final StringBuilder result = new StringBuilder();
         boolean first = true;
         try {
-            for (Enumeration<NetworkInterface> en = NetworkInterface.getNetworkInterfaces(); en.hasMoreElements();) {
-                NetworkInterface intf = en.nextElement();
-                for (Enumeration<InetAddress> enumIpAddr = intf.getInetAddresses(); enumIpAddr.hasMoreElements();) {
-                    InetAddress inetAddress = enumIpAddr.nextElement();
+            for (Enumeration<NetworkInterface> en = NetworkInterface.getNetworkInterfaces(); en.hasMoreElements(); ) {
+                final NetworkInterface intf = en.nextElement();
+                for (Enumeration<InetAddress> enumIpAddr = intf.getInetAddresses(); enumIpAddr.hasMoreElements(); ) {
+                    final InetAddress inetAddress = enumIpAddr.nextElement();
                     if (!inetAddress.isLoopbackAddress()) {
-                        if(!first) {
+                        if (!first) {
                             result.append('\n');
                         }
-                        result.append(inetAddress.getHostAddress().toString());
+                        result.append(inetAddress.getHostAddress());
                         first = false;
                     }
                 }
@@ -132,9 +129,9 @@ public static String getLocalIpAddress() {
         return result.toString();
     }
 
-    public static String getTimeString(Calendar time)
-    {
-        SimpleDateFormat format = new SimpleDateFormat(ACRAConstants.DATE_TIME_FORMAT_STRING, Locale.ENGLISH);
+    @NonNull
+    public static String getTimeString(@NonNull Calendar time) {
+        final SimpleDateFormat format = new SimpleDateFormat(ACRAConstants.DATE_TIME_FORMAT_STRING, Locale.ENGLISH);
         return format.format(time.getTimeInMillis());
     }
 }
diff --git a/src/main/java/org/acra/util/ToastSender.java b/src/main/java/org/acra/util/ToastSender.java
index a8c952ae..d467207a 100644
--- a/src/main/java/org/acra/util/ToastSender.java
+++ b/src/main/java/org/acra/util/ToastSender.java
@@ -1,32 +1,36 @@
 package org.acra.util;
 
-import org.acra.ACRA;
-
 import android.content.Context;
+import android.support.annotation.IntRange;
+import android.support.annotation.NonNull;
+import android.support.annotation.StringRes;
 import android.widget.Toast;
 
+import org.acra.ACRA;
+
 import static org.acra.ACRA.LOG_TAG;
 
 /**
  * Responsible for sending Toasts under all circumstances.
- * <p/>
+ *
  * @author William Ferguson
  * @since 4.3.0
  */
 public final class ToastSender {
+    private ToastSender(){}
 
     /**
      * Sends a Toast and ensures that any Exception thrown during sending is handled.
      *
-     * @param context           Application context.
-     * @param toastResourceId   Id of the resource to send as the Toast message.
-     * @param toastLength       Length of the Toast.
+     * @param context         Application context.
+     * @param toastResourceId Id of the resource to send as the Toast message.
+     * @param toastLength     Length of the Toast.
      */
-    public static void sendToast(Context context, int toastResourceId, int toastLength) {
+    public static void sendToast(@NonNull Context context, @StringRes int toastResourceId, @IntRange(from = 0, to = 1) int toastLength) {
         try {
             Toast.makeText(context, toastResourceId, toastLength).show();
         } catch (RuntimeException e) {
-            ACRA.log.e(LOG_TAG, "Could not send crash Toast", e);
+            ACRA.log.w(LOG_TAG, "Could not send crash Toast", e);
         }
     }
 }
diff --git a/src/main/proguard/proguard.cfg b/src/main/proguard/proguard.cfg
new file mode 100644
index 00000000..5c4d5e30
--- /dev/null
+++ b/src/main/proguard/proguard.cfg
@@ -0,0 +1,19 @@
+#ACRA specifics
+# Restore some Source file names and restore approximate line numbers in the stack traces,
+# otherwise the stack traces are pretty useless
+-keepattributes SourceFile,LineNumberTable
+
+# ACRA needs "annotations" so add this...
+# Note: This may already be defined in the default "proguard-android-optimize.txt"
+# file in the SDK. If it is, then you don't need to duplicate it. See your
+# "project.properties" file to get the path to the default "proguard-android-optimize.txt".
+-keepattributes *Annotation*
+
+# Keep all the ACRA classes
+-keep class org.acra.** { *; }
+
+# Don't warn about removed methods from AppCompat
+-dontwarn android.support.v4.app.NotificationCompat*
+
+# These classes are constucted with reflection.
+-keep public class * implements org.acra.sender.ReportSenderFactory { public <methods>; }
diff --git a/src/test/java/org/acra/log/NonAndroidLog.java b/src/test/java/org/acra/log/NonAndroidLog.java
index dad35e3b..28f3f601 100644
--- a/src/test/java/org/acra/log/NonAndroidLog.java
+++ b/src/test/java/org/acra/log/NonAndroidLog.java
@@ -1,6 +1,8 @@
 package org.acra.log;
 
 
+import android.support.annotation.NonNull;
+
 import java.io.PrintStream;
 import java.io.PrintWriter;
 import java.io.StringWriter;
@@ -29,7 +31,7 @@
     /**
      * Any log that is output at level less that the supplied logLevel will be ignored.
      * <p>
-     *     The deault log level is {@link NonAndroidLog#VERBOSE}
+     *     The default log level is {@link NonAndroidLog#VERBOSE}
      * </p>
      *
      * @param logLevel LogLevel to use to filter log output.
@@ -45,7 +47,7 @@ public int v(String tag, String msg) {
         return 0;
     }
 
-    public int v(String tag, String msg, Throwable tr) {
+    public int v(String tag, String msg, @NonNull Throwable tr) {
         if (logLevel <= VERBOSE) {
             out.println(tag + " : " + msg);
             tr.printStackTrace(out);
@@ -60,7 +62,7 @@ public int d(String tag, String msg) {
         return 0;
     }
 
-    public int d(String tag, String msg, Throwable tr) {
+    public int d(String tag, String msg, @NonNull Throwable tr) {
         if (logLevel <= DEBUG) {
             out.println(tag + " : " + msg);
             tr.printStackTrace(out);
@@ -75,7 +77,7 @@ public int i(String tag, String msg) {
         return 0;
     }
 
-    public int i(String tag, String msg, Throwable tr) {
+    public int i(String tag, String msg, @NonNull Throwable tr) {
         if (logLevel <= INFO) {
             out.println(tag + " : " + msg);
             tr.printStackTrace(out);
@@ -90,7 +92,7 @@ public int w(String tag, String msg) {
         return 0;
     }
 
-    public int w(String tag, String msg, Throwable tr) {
+    public int w(String tag, String msg, @NonNull Throwable tr) {
         if (logLevel <= WARN) {
             out.println(tag + " : " + msg);
             tr.printStackTrace(out);
@@ -99,7 +101,7 @@ public int w(String tag, String msg, Throwable tr) {
     }
 
     //public native  boolean isLoggable(java.lang.String tag, int level);
-    public int w(String tag, Throwable tr) {
+    public int w(String tag, @NonNull Throwable tr) {
         if (logLevel <= WARN) {
             out.println(tag + " : ");
             tr.printStackTrace(out);
@@ -114,7 +116,7 @@ public int e(String tag, String msg) {
         return 0;
     }
 
-    public int e(String tag, String msg, Throwable tr) {
+    public int e(String tag, String msg, @NonNull Throwable tr) {
         if (logLevel <= ERROR) {
             out.println(tag + " : " + msg);
             tr.printStackTrace(out);
