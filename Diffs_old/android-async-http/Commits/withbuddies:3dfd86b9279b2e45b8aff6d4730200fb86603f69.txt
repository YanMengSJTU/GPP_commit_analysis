diff --git a/build.xml b/build.xml
index 387caedd..7ad0933e 100644
--- a/build.xml
+++ b/build.xml
@@ -92,7 +92,19 @@
     </target>
 
     <!-- Standard jar stuff -->
-    <property name="lib.dir" value="${sdk.dir}/platforms/${target}" />
+    <property environment="env"/>
+    <condition property="android.base" value="${sdk.dir}" else="${env.ANDROID_HOME}">
+      <isset property="sdk.dir" />
+    </condition>
+    <fail message="Please set either the sdk.dir property or the ANDROID_HOME environment variable to point to your Android SDK installation.">
+      <condition>
+        <not>
+          <available file="${android.base}" type="dir"/>
+        </not>
+      </condition>
+    </fail>
+
+    <property name="lib.dir" value="${android.base}/platforms/${target}" />
     <property name="build.dir" value="./build"/>
     <property name="classes.dir"  value="${build.dir}/classes"/>
     <buildnumber file="build.num" />
@@ -109,7 +121,7 @@
             sourcepath="gen:src"
             destdir="doc"
             packagenames="${package.packagename}"
-            linkoffline="http://d.android.com/reference ${sdk.dir}/docs/reference" 
+            linkoffline="http://d.android.com/reference ${android.base}/docs/reference" 
             additionalparam="-author  -version"
             />
     </target>
diff --git a/examples/TwitterRestClient.java b/examples/TwitterRestClient.java
index b204cbc2..e616c7bf 100644
--- a/examples/TwitterRestClient.java
+++ b/examples/TwitterRestClient.java
@@ -18,7 +18,6 @@ public static void get(String url, RequestParams params, AsyncHttpResponseHandle
     public static void post(String url, RequestParams params, AsyncHttpResponseHandler responseHandler) {
 //        client.get(getAbsoluteUrl(url), params, responseHandler);
         client.new Transaction().setParams(params).get(url, responseHandler);
-
     }
 
     private static String getAbsoluteUrl(String relativeUrl) {
diff --git a/project.properties b/project.properties
index f28bc833..616f300c 100644
--- a/project.properties
+++ b/project.properties
@@ -9,4 +9,4 @@
 
 android.library=true
 # Project target.
-target=android-15
+target=android-16
diff --git a/src/com/loopj/http/RetryHandler.java b/src/com/loopj/http/RetryHandler.java
index 897d9ade..12793f2f 100644
--- a/src/com/loopj/http/RetryHandler.java
+++ b/src/com/loopj/http/RetryHandler.java
@@ -63,7 +63,7 @@ public RetryHandler(int maxRetries) {
     }
 
     public boolean retryRequest(IOException exception, int executionCount, HttpContext context) {
-        boolean retry;
+        boolean retry = true;
 
         Boolean b = (Boolean) context.getAttribute(ExecutionContext.HTTP_REQ_SENT);
         boolean sent = (b != null && b.booleanValue());
@@ -80,16 +80,13 @@ public boolean retryRequest(IOException exception, int executionCount, HttpConte
         } else if (!sent) {
             // for most other errors, retry only if request hasn't been fully sent yet
             retry = true;
-        } else {
+        }
+
+        if(retry) {
             // resend all idempotent requests
-            HttpUriRequest currentReq = (HttpUriRequest) context.getAttribute(ExecutionContext.HTTP_REQUEST);
+            HttpUriRequest currentReq = (HttpUriRequest) context.getAttribute( ExecutionContext.HTTP_REQUEST );
             String requestType = currentReq.getMethod();
-            if(!requestType.equals("POST")) {
-                retry = true;
-            } else {
-                // otherwise do not retry
-                retry = false;
-            }
+            retry = !requestType.equals("POST");
         }
 
         if(retry) {
diff --git a/src/com/loopj/http/android/AndroidJsonResponseHandler.java b/src/com/loopj/http/android/AndroidJsonResponseHandler.java
index 605a96c0..e620d149 100644
--- a/src/com/loopj/http/android/AndroidJsonResponseHandler.java
+++ b/src/com/loopj/http/android/AndroidJsonResponseHandler.java
@@ -126,7 +126,7 @@ protected void handleSuccessJsonMessage(int statusCode, Object jsonResponse) {
         } else if(jsonResponse instanceof JSONArray) {
             onSuccess(statusCode, (JSONArray)jsonResponse);
         } else {
-            onFailure(new JSONException("Unexpected type " + jsonResponse.getClass().getName()));
+            onFailure(new JSONException("Unexpected type " + jsonResponse.getClass().getName()), (JSONObject)null);
         }
     }
 
