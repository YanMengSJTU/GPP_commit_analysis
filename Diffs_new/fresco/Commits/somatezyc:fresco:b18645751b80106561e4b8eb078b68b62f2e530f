diff --git a/imagepipeline/gradle.properties b/imagepipeline/gradle.properties
index 7e2cf6cff..51bb34337 100644
--- a/imagepipeline/gradle.properties
+++ b/imagepipeline/gradle.properties
@@ -2,4 +2,4 @@ POM_NAME=ImagePipeline
 POM_DESCRIPTION=The underlying image loading mechanism of the Fresco library
 POM_ARTIFACT_ID=imagepipeline
 POM_PACKAGING=aar
-
+ndk.path=E\:\\works\\tools\\android-ndk-r10d
diff --git a/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/ResizeAndRotateProducer.java b/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/ResizeAndRotateProducer.java
index 99ab1e000..951ed6c0a 100644
--- a/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/ResizeAndRotateProducer.java
+++ b/imagepipeline/src/main/java/com/facebook/imagepipeline/producers/ResizeAndRotateProducer.java
@@ -159,6 +159,7 @@ private void doTransform(
       mProducerContext.getListener().
           onProducerFinishWithSuccess(mProducerContext.getId(), PRODUCER_NAME, null);
       getConsumer().onNewResult(ret, isLast);
+        CloseableReference.closeSafely(ret.first);
     }
   }
 
diff --git a/samples/comparison/src/main/AndroidManifest.xml b/samples/comparison/src/main/AndroidManifest.xml
index 2305ca110..11e5d32cd 100644
--- a/samples/comparison/src/main/AndroidManifest.xml
+++ b/samples/comparison/src/main/AndroidManifest.xml
@@ -3,7 +3,7 @@
     package="com.facebook.samples.comparison" >
 
     <uses-permission android:name="android.permission.INTERNET" />
-
+    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
     <uses-sdk
         android:minSdkVersion="9"
         android:targetSdkVersion="21"
@@ -15,7 +15,7 @@
         android:label="@string/app_name"
         android:theme="@style/AppTheme" >
         <activity
-            android:name=".MainActivity"
+            android:name=".Main2Activity"
             android:label="@string/app_name" >
             <intent-filter>
                 <action android:name="android.intent.action.MAIN" />
diff --git a/samples/comparison/src/main/java/com/facebook/samples/comparison/Main2Activity.java b/samples/comparison/src/main/java/com/facebook/samples/comparison/Main2Activity.java
new file mode 100644
index 000000000..430901536
--- /dev/null
+++ b/samples/comparison/src/main/java/com/facebook/samples/comparison/Main2Activity.java
@@ -0,0 +1,64 @@
+package com.facebook.samples.comparison;
+
+import android.app.Activity;
+import android.os.Bundle;
+import android.os.Environment;
+import android.text.TextUtils;
+import android.util.Log;
+import android.widget.GridView;
+
+import com.facebook.common.logging.FLog;
+import com.facebook.drawee.backends.pipeline.Fresco;
+import com.facebook.samples.comparison.adapters.LocalImgsAdapter;
+
+import java.io.File;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * Created by zhangyanchao on 2015/6/9.
+ */
+public class Main2Activity extends Activity {
+
+    private GridView gridView;
+
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        setContentView(R.layout.activity_main2);
+        Fresco.initialize(this);
+        FLog.setMinimumLoggingLevel(FLog.VERBOSE);
+
+        this.gridView = (GridView) findViewById(R.id.imgs);
+        List<String> imgs = initData();
+        Log.d("aaaa", "imgs" + imgs);
+        if (imgs != null && imgs.size() > 0) {
+            LocalImgsAdapter adapter = new LocalImgsAdapter(this, imgs);
+            gridView.setAdapter(adapter);
+        }
+
+
+    }
+
+    private List<String> initData(){
+        String cameraPath =  Environment.getExternalStorageDirectory().getAbsolutePath()+"/DCIM/Camera/";
+        File cameraFolder = new File(cameraPath);
+
+        Log.d("aaaa", "cameraFolder=" + cameraFolder.getAbsolutePath());
+
+        if (!cameraFolder.exists()) {
+            return null;
+        }
+        List<String> imgsPath = new ArrayList<>();
+
+        String[] path = cameraFolder.list();
+        if (path != null && path.length > 0) {
+            for (int i = 0; i < path.length; i++) {
+                if (!TextUtils.isEmpty(path[i]) && (path[i].toLowerCase().endsWith(".png") || path[i].toLowerCase().endsWith(".jpg"))) {
+                    imgsPath.add(cameraPath+path[i]);
+                }
+            }
+        }
+        return  imgsPath;
+    }
+}
diff --git a/samples/comparison/src/main/java/com/facebook/samples/comparison/SquareImageView.java b/samples/comparison/src/main/java/com/facebook/samples/comparison/SquareImageView.java
new file mode 100644
index 000000000..fdaab1551
--- /dev/null
+++ b/samples/comparison/src/main/java/com/facebook/samples/comparison/SquareImageView.java
@@ -0,0 +1,32 @@
+package com.facebook.samples.comparison;
+
+import android.content.Context;
+import android.util.AttributeSet;
+
+import com.facebook.drawee.view.SimpleDraweeView;
+
+/**
+ * 方形图片,高和宽相同
+ * Created by zhangyanchao on 2015/3/31.
+ */
+public class SquareImageView extends SimpleDraweeView {
+
+
+    public SquareImageView(Context context) {
+        super(context);
+    }
+
+    public SquareImageView(Context context, AttributeSet attrs) {
+        super(context, attrs);
+    }
+
+    public SquareImageView(Context context, AttributeSet attrs, int defStyleAttr) {
+        super(context, attrs, defStyleAttr);
+    }
+
+    @Override
+    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
+        heightMeasureSpec = widthMeasureSpec;
+        super.onMeasure(widthMeasureSpec, heightMeasureSpec);
+    }
+}
diff --git a/samples/comparison/src/main/java/com/facebook/samples/comparison/adapters/LocalImgsAdapter.java b/samples/comparison/src/main/java/com/facebook/samples/comparison/adapters/LocalImgsAdapter.java
new file mode 100644
index 000000000..b8a30df45
--- /dev/null
+++ b/samples/comparison/src/main/java/com/facebook/samples/comparison/adapters/LocalImgsAdapter.java
@@ -0,0 +1,82 @@
+package com.facebook.samples.comparison.adapters;
+
+import android.app.Activity;
+import android.content.Context;
+import android.graphics.Point;
+import android.net.Uri;
+import android.text.TextUtils;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.BaseAdapter;
+
+import com.facebook.drawee.backends.pipeline.Fresco;
+import com.facebook.drawee.interfaces.DraweeController;
+import com.facebook.drawee.view.SimpleDraweeView;
+import com.facebook.imagepipeline.common.ResizeOptions;
+import com.facebook.imagepipeline.request.ImageRequest;
+import com.facebook.imagepipeline.request.ImageRequestBuilder;
+import com.facebook.samples.comparison.R;
+
+import java.util.List;
+
+/**
+ * 本地图片列表
+ */
+public class LocalImgsAdapter extends BaseAdapter {
+    private LayoutInflater inflater;
+
+    private List<String> imgs;
+    private int imgSize;
+
+    public LocalImgsAdapter(Context context, List<String> imgs) {
+        this.imgs = imgs;
+        this.inflater = LayoutInflater.from(context);
+    }
+
+
+    @Override
+    public int getCount() {
+        return imgs == null ? 0 : imgs.size();
+    }
+
+    @Override
+    public String getItem(int position) {//position = 0固定拍照位置
+        if (position >= 0 && imgs != null && imgs.size() > position) {
+            return imgs.get(position);
+        }
+        return null;
+    }
+
+    @Override
+    public long getItemId(int position) {
+        return 0;
+    }
+
+    @Override
+    public View getView(int position, View convertView, ViewGroup parent) {
+        if (convertView == null) {
+            convertView = inflater.inflate(R.layout.item_img, parent, false);
+        }
+            if (imgSize <= 0) {
+                Point p = new Point();
+                ((Activity)parent.getContext()).getWindowManager().getDefaultDisplay().getSize(p);
+                imgSize = p.x / 3;
+            }
+
+        String item = getItem(position);
+        if (item != null && !TextUtils.isEmpty(item)) {
+            ImageRequest request = ImageRequestBuilder.newBuilderWithSource(Uri.parse("file://" + item))
+                    .setResizeOptions(new ResizeOptions(imgSize,imgSize))
+                    .build();
+            DraweeController controller = Fresco.newDraweeControllerBuilder()
+                    .setOldController(((SimpleDraweeView) convertView).getController())
+                    .setImageRequest(request)
+                    .build();
+            ((SimpleDraweeView) convertView).setController(controller);
+        } else {
+            ((SimpleDraweeView) convertView).setImageURI(null);
+        }
+        return convertView;
+    }
+}
diff --git a/samples/comparison/src/main/res/layout/activity_main2.xml b/samples/comparison/src/main/res/layout/activity_main2.xml
new file mode 100644
index 000000000..ba9e5905e
--- /dev/null
+++ b/samples/comparison/src/main/res/layout/activity_main2.xml
@@ -0,0 +1,27 @@
+<LinearLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    android:orientation="vertical">
+
+  <TextView
+      android:layout_width="match_parent"
+      android:layout_height="wrap_content"
+      android:text="/DCIM/Camera"/>
+
+
+    <GridView
+        android:id="@+id/imgs"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"
+        android:fadingEdge="none"
+        android:gravity="fill"
+        android:listSelector="@android:color/transparent"
+        android:numColumns="3"
+        android:stretchMode="columnWidth"
+        android:verticalSpacing="0dp"
+        android:horizontalSpacing="0dp"
+        android:background="@android:color/black" />
+
+
+</LinearLayout>
diff --git a/samples/comparison/src/main/res/layout/item_img.xml b/samples/comparison/src/main/res/layout/item_img.xml
new file mode 100644
index 000000000..6cf2395f4
--- /dev/null
+++ b/samples/comparison/src/main/res/layout/item_img.xml
@@ -0,0 +1,7 @@
+<?xml version="1.0" encoding="utf-8"?>
+<com.facebook.samples.comparison.SquareImageView xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:fresco="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    fresco:actualImageScaleType="centerCrop"/>
+
