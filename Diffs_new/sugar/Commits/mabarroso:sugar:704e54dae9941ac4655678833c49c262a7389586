diff --git a/library/src/com/orm/util/SugarConfig.java b/library/src/com/orm/util/SugarConfig.java
index e7db7102..73432869 100644
--- a/library/src/com/orm/util/SugarConfig.java
+++ b/library/src/com/orm/util/SugarConfig.java
@@ -6,7 +6,6 @@
 import android.util.Log;
 
 import android.annotation.SuppressLint;
-import android.app.ActivityManager;
 import java.lang.reflect.Field;
 import java.util.Collections;
 import java.util.HashMap;
@@ -29,7 +28,7 @@ public static String getDatabaseName(Context context,
             databaseName = "Sugar.db";
         }
 
-        if (isTestEnviroment(context)) {
+        if (isTestEnviroment) {
             databaseName = "test" + databaseName;
         }
 
@@ -121,29 +120,17 @@ public static Boolean getMetaDataBoolean(Context context, String name) {
         return value;
     }
 
-    public static boolean isLibraryLoaded(Context context, String name) {
-        Boolean value = false;
+    public static Boolean isTestEnviroment(Context context) {
+        return (isClassLoaded(getDomainPackageName(context) + ".SugarTest"));
+    }
 
-        PackageManager pm = context.getPackageManager();
+    private static Boolean isClassLoaded(String name) {
         try {
-            String[] libraries = pm.getSystemSharedLibraryNames();
-
-            for (String library : libraries) {
-                if (library.equals(name)) {
-                    value = true;
-                    break;
-                }
-            }
-        } catch (Exception e) {
-            Log.d("sugar", "Couldn't find config value: " + name);
-            e.printStackTrace();
+            Class.forName(name);
+            Log.d("Sugar", "Found class: " + name);
+            return true;
+        } catch( ClassNotFoundException e ) {
+            return false;
         }
-
-        return value;
-    }
-
-    @SuppressLint("NewApi")
-    public static Boolean isTestEnviroment(Context context) {
-        return (ActivityManager.isRunningInTestHarness() || isLibraryLoaded(context, "android.test.runner"));
     }
 }
