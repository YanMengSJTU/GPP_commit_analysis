diff --git a/TMessagesProj/src/main/java/org/telegram/ui/Components/ChatActivityEnterView.java b/TMessagesProj/src/main/java/org/telegram/ui/Components/ChatActivityEnterView.java
index 76d4aa0f2..108e67865 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/Components/ChatActivityEnterView.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/Components/ChatActivityEnterView.java
@@ -3029,16 +3029,17 @@ private void updateBotButton() {
             if (botButton.getVisibility() != VISIBLE) {
                 botButton.setVisibility(VISIBLE);
             }
+            boolean botButtonShowed = botButton.getMeasuredHeight() != 0;
             if (botReplyMarkup != null) {
                 if (isPopupShowing() && currentPopupContentType == 1) {
-                    botButtonDrawable.setIcon(R.drawable.input_keyboard, isAttachedToWindow());
+                    botButtonDrawable.setIcon(R.drawable.input_keyboard, botButtonShowed);
                     botButton.setContentDescription(LocaleController.getString("AccDescrShowKeyboard", R.string.AccDescrShowKeyboard));
                 } else {
-                    botButtonDrawable.setIcon(R.drawable.input_bot2, isAttachedToWindow());
+                    botButtonDrawable.setIcon(R.drawable.input_bot2, botButtonShowed);
                     botButton.setContentDescription(LocaleController.getString("AccDescrBotKeyboard", R.string.AccDescrBotKeyboard));
                 }
             } else {
-                botButtonDrawable.setIcon(R.drawable.input_bot1, isAttachedToWindow());
+                botButtonDrawable.setIcon(R.drawable.input_bot1, botButtonShowed);
                 botButton.setContentDescription(LocaleController.getString("AccDescrBotCommands", R.string.AccDescrBotCommands));
             }
         } else {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/Components/ReplaceableIconDrawable.java b/TMessagesProj/src/main/java/org/telegram/ui/Components/ReplaceableIconDrawable.java
index 2433a3120..7a72ee90c 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/Components/ReplaceableIconDrawable.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/Components/ReplaceableIconDrawable.java
@@ -40,8 +40,8 @@ public void setIcon(@DrawableRes int resId, boolean animated) {
         if (currentResId == resId) {
             return;
         }
-        currentResId = resId;
         setIcon(ContextCompat.getDrawable(context, resId), animated);
+        currentResId = resId;
     }
 
     public void setIcon(Drawable drawable, boolean animated) {
@@ -56,6 +56,7 @@ public void setIcon(Drawable drawable, boolean animated) {
             return;
         }
 
+        currentResId = 0;
         outDrawable = currentDrawable;
         currentDrawable = drawable;
         currentDrawable.setColorFilter(colorFilter);
@@ -70,6 +71,7 @@ public void setIcon(Drawable drawable, boolean animated) {
         }
 
         if (!animated) {
+            progress = 1f;
             outDrawable = null;
             return;
         }
