diff --git a/TMessagesProj/jni/Android.mk b/TMessagesProj/jni/Android.mk
index 790309647..bb6e755ff 100755
--- a/TMessagesProj/jni/Android.mk
+++ b/TMessagesProj/jni/Android.mk
@@ -1,5 +1,7 @@
 LOCAL_PATH := $(call my-dir)
 
+include $(CLEAR_VARS)
+
 LOCAL_MODULE    := avutil 
 
 ifeq ($(TARGET_ARCH_ABI),armeabi-v7a)
diff --git a/TMessagesProj/jni/gifvideo.cpp b/TMessagesProj/jni/gifvideo.cpp
index c44e63187..7807fe4f3 100644
--- a/TMessagesProj/jni/gifvideo.cpp
+++ b/TMessagesProj/jni/gifvideo.cpp
@@ -147,8 +147,8 @@ jlong Java_org_telegram_ui_Components_AnimatedFileDrawable_createDecoder(JNIEnv
     if (open_codec_context(&info->video_stream_idx, &info->video_dec_ctx, info->fmt_ctx, AVMEDIA_TYPE_VIDEO) >= 0) {
         info->video_stream = info->fmt_ctx->streams[info->video_stream_idx];
     }
-
-    if (info->video_stream <= 0) {
+    
+    if (info->video_stream == nullptr) {
         LOGE("can't find video stream in the input, aborting %s", info->src);
         delete info;
         return 0;
diff --git a/TMessagesProj/jni/tgnet/ApiScheme.h b/TMessagesProj/jni/tgnet/ApiScheme.h
index 03bae5799..127e345c0 100644
--- a/TMessagesProj/jni/tgnet/ApiScheme.h
+++ b/TMessagesProj/jni/tgnet/ApiScheme.h
@@ -11,7 +11,6 @@
 
 #include <vector>
 #include <memory>
-#include <bits/unique_ptr.h>
 #include "TLObject.h"
 
 class ByteArray;
diff --git a/TMessagesProj/jni/tgnet/ConnectionsManager.h b/TMessagesProj/jni/tgnet/ConnectionsManager.h
index 05f7e6c84..983c61e32 100644
--- a/TMessagesProj/jni/tgnet/ConnectionsManager.h
+++ b/TMessagesProj/jni/tgnet/ConnectionsManager.h
@@ -15,7 +15,7 @@
 #include <sys/epoll.h>
 #include <map>
 #include <atomic>
-#include <bits/unique_ptr.h>
+#include <memory>
 #include "Defines.h"
 
 #ifdef ANDROID
diff --git a/TMessagesProj/jni/tgnet/Datacenter.h b/TMessagesProj/jni/tgnet/Datacenter.h
index 85ee3a992..224dc21a9 100644
--- a/TMessagesProj/jni/tgnet/Datacenter.h
+++ b/TMessagesProj/jni/tgnet/Datacenter.h
@@ -12,7 +12,7 @@
 #include <stdint.h>
 #include <vector>
 #include <map>
-#include <bits/unique_ptr.h>
+#include <memory>
 #include "Defines.h"
 
 class TL_future_salt;
diff --git a/TMessagesProj/jni/tgnet/Defines.h b/TMessagesProj/jni/tgnet/Defines.h
index c14003cfd..4a6380da8 100644
--- a/TMessagesProj/jni/tgnet/Defines.h
+++ b/TMessagesProj/jni/tgnet/Defines.h
@@ -12,7 +12,7 @@
 #include <functional>
 #include <list>
 #include <limits.h>
-#include <bits/unique_ptr.h>
+#include <memory>
 #include <sstream>
 #include <inttypes.h>
 #include "ByteArray.h"
diff --git a/TMessagesProj/jni/tgnet/MTProtoScheme.h b/TMessagesProj/jni/tgnet/MTProtoScheme.h
index c1611fedc..28998769d 100644
--- a/TMessagesProj/jni/tgnet/MTProtoScheme.h
+++ b/TMessagesProj/jni/tgnet/MTProtoScheme.h
@@ -12,7 +12,6 @@
 #include <vector>
 #include <memory>
 #include <map>
-#include <bits/unique_ptr.h>
 #include "TLObject.h"
 
 class ByteArray;
diff --git a/TMessagesProj/jni/tgnet/Request.h b/TMessagesProj/jni/tgnet/Request.h
index 45f3dcf2f..b1824bea7 100644
--- a/TMessagesProj/jni/tgnet/Request.h
+++ b/TMessagesProj/jni/tgnet/Request.h
@@ -11,7 +11,7 @@
 
 #include <stdint.h>
 #include <vector>
-#include <bits/unique_ptr.h>
+#include <memory>
 #include "Defines.h"
 
 #ifdef ANDROID
diff --git a/TMessagesProj/jni/utils.h b/TMessagesProj/jni/utils.h
index 34805a1d7..7674247f0 100644
--- a/TMessagesProj/jni/utils.h
+++ b/TMessagesProj/jni/utils.h
@@ -17,12 +17,20 @@
 #define LOGV(...)
 #endif
 
+#ifdef __cplusplus
+// Use std::min/std::max from <algorithm> rather than the macros used for C
+// since the macros will collide with things like numeric_limits::max.
+#include <algorithm>
+using std::min;
+using std::max;
+#else
 #ifndef max
 #define max(x, y) ((x) > (y)) ? (x) : (y)
 #endif
 #ifndef min
 #define min(x, y) ((x) < (y)) ? (x) : (y)
 #endif
+#endif
 
 void throwException(JNIEnv *env, char *format, ...);
 
