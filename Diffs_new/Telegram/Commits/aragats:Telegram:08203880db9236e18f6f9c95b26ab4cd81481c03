diff --git a/TMessagesProj/src/main/java/org/telegram/ui/PhotoViewer.java b/TMessagesProj/src/main/java/org/telegram/ui/PhotoViewer.java
index bd094b337..0506782bb 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/PhotoViewer.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/PhotoViewer.java
@@ -72,6 +72,7 @@
 import org.telegram.ui.Components.PhotoViewerCaptionEnterView;
 import org.telegram.ui.Components.SizeNotifierRelativeLayoutPhoto;
 import org.telegram.utils.Permissions;
+import org.telegram.utils.StringUtils;
 
 import java.io.File;
 import java.util.ArrayList;
@@ -658,12 +659,10 @@ public void onItemClick(int id) {
                     File f = null;
                     //TODO-aragats new. It is important do not save again from the internet but use saved in cache. // TOOD why jpg???
                     if (currentPost != null) {
-                        currentFileNames[0] = Utilities.MD5(currentPost.getImage().getUrl()) + ".jpg";
-                        f = new File(FileLoader.getInstance().getDirectory(FileLoader.MEDIA_DIR_CACHE), currentFileNames[0]);
-                        //in case of image is locale file and we do not have it in cache, because it is localy in mobile phone.
-                        if (!f.exists()) {
-                            f = new File(currentPost.getImage().getUrl());
+                        if (StringUtils.isEmpty(currentFileNames[0])) {
+                            currentFileNames[0] = Utilities.MD5(currentPost.getImage().getUrl()) + ".jpg";
                         }
+                        f = getCurrentFileByName(currentFileNames[0]);
                     }
 
                     if (f != null && f.exists()) {
@@ -1551,9 +1550,55 @@ private String getFileName(int index) {
         if (index < 0) {
             return null;
         }
+        if (index < imagesPostArr.size()) {
+            Post post = imagesPostArr.get(index);
+            if (post != null) {
+                return Utilities.MD5(post.getImage().getUrl()) + ".jpg";
+            }
+        }
         return null;
     }
 
+//    private String getFileName(int index) {
+//        if (index < 0) {
+//            return null;
+//        }
+//        if (!imagesArrLocations.isEmpty() || !imagesArr.isEmpty()) {
+//            if (!imagesArrLocations.isEmpty()) {
+//                if (index >= imagesArrLocations.size()) {
+//                    return null;
+//                }
+//                TLRPC.FileLocation location = imagesArrLocations.get(index);
+//                return location.volume_id + "_" + location.local_id + ".jpg";
+//            } else if (!imagesArr.isEmpty()) {
+//                if (index >= imagesArr.size()) {
+//                    return null;
+//                }
+//                return FileLoader.getMessageFileName(imagesArr.get(index).messageOwner);
+//            }
+//        } else if (!imagesArrLocals.isEmpty()) {
+//            if (index >= imagesArrLocals.size()) {
+//                return null;
+//            }
+//            Object object = imagesArrLocals.get(index);
+//            if (object instanceof MediaController.SearchImage) {
+//                MediaController.SearchImage searchImage = ((MediaController.SearchImage) object);
+//                if (searchImage.document != null) {
+//                    return FileLoader.getAttachFileName(searchImage.document);
+//                } else if (searchImage.type != 1 && searchImage.localUrl != null && searchImage.localUrl.length() > 0) {
+//                    File file = new File(searchImage.localUrl);
+//                    if (file.exists()) {
+//                        return file.getName();
+//                    } else {
+//                        searchImage.localUrl = "";
+//                    }
+//                }
+//                return Utilities.MD5(searchImage.imageUrl) + "." + ImageLoader.getHttpUrlExtension(searchImage.imageUrl, "jpg");
+//            }
+//        }
+//        return null;
+//    }
+
 
     private void updateSelectedCount() {
         if (placeProvider == null) {
@@ -1818,6 +1863,18 @@ private void setImageIndex(int index, boolean init) {
         }
     }
 
+    private File getCurrentFileByName(String currentFileName) {
+        if (StringUtils.isEmpty(currentFileName)) {
+            return null;
+        }
+        File f = new File(FileLoader.getInstance().getDirectory(FileLoader.MEDIA_DIR_CACHE), currentFileName);
+        //in case of image is locale file and we do not have it in cache, because it is localy in mobile phone.
+        if (!f.exists()) {
+            f = new File(currentPost.getImage().getUrl());
+        }
+        return f;
+    }
+
 
     private void setCurrentCaption(final CharSequence caption) {
         if (caption != null && caption.length() > 0) {
@@ -1857,12 +1914,16 @@ private void checkProgress(int a, boolean animated) {
                 index -= 1;
             }
             File f = null;
+            //TODO It is always null. So probably I need to delete it
             if (currentPathObject != null) {
                 f = new File(FileLoader.getInstance().getDirectory(FileLoader.MEDIA_DIR_DOCUMENT), currentFileNames[a]);
                 if (!f.exists()) {
                     f = new File(FileLoader.getInstance().getDirectory(FileLoader.MEDIA_DIR_CACHE), currentFileNames[a]);
                 }
             }
+            //Aragats my. Because I do nt use currentPathObject.
+            f = getCurrentFileByName(currentFileNames[0]);
+
             if (f != null && f.exists()) {
                 if (currentFileNames[a].endsWith("mp4")) {
                     radialProgressViews[a].setBackgroundState(3, animated);
