diff --git a/TMessagesProj/src/main/java/org/telegram/android/ImageLoader.java b/TMessagesProj/src/main/java/org/telegram/android/ImageLoader.java
index 1e9a454a7..164d6a22a 100644
--- a/TMessagesProj/src/main/java/org/telegram/android/ImageLoader.java
+++ b/TMessagesProj/src/main/java/org/telegram/android/ImageLoader.java
@@ -51,6 +51,7 @@
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.LinkedList;
+import java.util.NoSuchElementException;
 import java.util.concurrent.ConcurrentHashMap;
 
 public class ImageLoader {
@@ -1631,13 +1632,20 @@ private void runHttpTasks(boolean complete) {
             currentHttpTasksCount--;
         }
         while (currentHttpTasksCount < 1 && !httpTasks.isEmpty()) {
-            HttpImageTask task = httpTasks.poll();
-            if (android.os.Build.VERSION.SDK_INT >= 11) {
-                task.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, null, null, null);
-            } else {
-                task.execute(null, null, null);
+            HttpImageTask task;
+            try {
+                task = httpTasks.poll();
+                if(task != null) {
+                    if (android.os.Build.VERSION.SDK_INT >= 11) {
+                        task.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, null, null, null);
+                    } else {
+                        task.execute(null, null, null);
+                    }
+                    currentHttpTasksCount++;
+                }
             }
-            currentHttpTasksCount++;
+            catch (NoSuchElementException ex){}
+            catch (IllegalStateException ex2){}
         }
     }
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/Cells/DialogCell.java b/TMessagesProj/src/main/java/org/telegram/ui/Cells/DialogCell.java
index 849ee32ab..6a0ccf568 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/Cells/DialogCell.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/Cells/DialogCell.java
@@ -758,7 +758,10 @@ protected void onDraw(Canvas canvas) {
         if (messageLayout != null) {
             canvas.save();
             canvas.translate(messageLeft, messageTop);
-            messageLayout.draw(canvas);
+            try {
+                messageLayout.draw(canvas);
+            }
+            catch (IndexOutOfBoundsException ex){}
             canvas.restore();
         }
 
