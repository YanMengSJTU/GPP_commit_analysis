diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/MessagesController.java b/TMessagesProj/src/main/java/org/telegram/messenger/MessagesController.java
index 602fd664d..40da8029b 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/MessagesController.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/MessagesController.java
@@ -294,10 +294,16 @@ public void run() {
     private final Comparator<TLRPC.Dialog> dialogComparator = new Comparator<TLRPC.Dialog>() {
         @Override
         public int compare(TLRPC.Dialog dialog1, TLRPC.Dialog dialog2) {
+            boolean unmutedPrimary = mainPreferences.getBoolean("unmutedOnTop", false);
+
             if (dialog1 instanceof TLRPC.TL_dialogFolder && !(dialog2 instanceof TLRPC.TL_dialogFolder)) {
                 return -1;
             } else if (!(dialog1 instanceof TLRPC.TL_dialogFolder) && dialog2 instanceof TLRPC.TL_dialogFolder) {
                 return 1;
+            } else if (dialog1.folder_id != 0 && dialog2.folder_id == 0) {
+                return 1;
+            } else if (dialog1.folder_id == 0 && dialog2.folder_id != 0) {
+                return -1;
             } else if (!dialog1.pinned && dialog2.pinned) {
                 return 1;
             } else if (dialog1.pinned && !dialog2.pinned) {
@@ -315,6 +321,32 @@ public int compare(TLRPC.Dialog dialog1, TLRPC.Dialog dialog2) {
             int date1 = draftMessage != null && draftMessage.date >= dialog1.last_message_date ? draftMessage.date : dialog1.last_message_date;
             draftMessage = DataQuery.getInstance(currentAccount).getDraft(dialog2.id);
             int date2 = draftMessage != null && draftMessage.date >= dialog2.last_message_date ? draftMessage.date : dialog2.last_message_date;
+
+            if (unmutedPrimary) {
+                boolean mute1 = isDialogMuted(dialog1.id);
+                boolean mute2 = isDialogMuted(dialog2.id);
+                boolean unread1 = dialog1.unread_count > 0;
+                boolean unread2 = dialog2.unread_count > 0;
+
+                boolean newMention1 = unread1 && !mute1;
+                boolean newMention2 = unread2 && !mute2;
+
+                if (!newMention1 && newMention2) {
+                    return 1;
+                } else if (newMention1 && !newMention2) {
+                    return -1;
+                } else if (newMention1 && newMention2) {
+                    if (date1 < date2) {
+                        return 1;
+                    } else if (date1 > date2) {
+                        return -1;
+                    } else {
+                        return 0;
+                    }
+                }
+            }
+
+
             if (date1 < date2) {
                 return 1;
             } else if (date1 > date2) {
@@ -4294,6 +4326,7 @@ public void loadGlobalNotificationsSettings() {
                     }
                 }));
             }
+            sortDialogs(null);
         }
         if (!UserConfig.getInstance(currentAccount).notificationsSignUpSettingsLoaded) {
             loadSignUpNotificationsSettings();
@@ -5304,6 +5337,7 @@ private void applyDialogNotificationsSettings(long dialog_id, TLRPC.PeerNotifySe
         if (updated) {
             NotificationCenter.getInstance(currentAccount).postNotificationName(NotificationCenter.notificationsSettingsUpdated);
         }
+        sortDialogs(null);
     }
 
     private void applyDialogsNotificationsSettings(ArrayList<TLRPC.Dialog> dialogs) {
@@ -5347,6 +5381,7 @@ private void applyDialogsNotificationsSettings(ArrayList<TLRPC.Dialog> dialogs)
         if (editor != null) {
             editor.commit();
         }
+        sortDialogs(null);
     }
 
     public void reloadMentionsCountForChannels(final ArrayList<Integer> arrayList) {
@@ -9823,6 +9858,7 @@ public boolean processUpdateArray(ArrayList<TLRPC.Update> updates, final ArrayLi
                                 }
                             }
                         }
+                        sortDialogs(null);
                     } else if (baseUpdate instanceof TLRPC.TL_updateChannel) {
                         final TLRPC.TL_updateChannel update = (TLRPC.TL_updateChannel) baseUpdate;
                         TLRPC.Dialog dialog = dialogs_dict.get(-(long) update.channel_id);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ForkSettingsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ForkSettingsActivity.java
index 99d416e00..583bcb82c 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ForkSettingsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ForkSettingsActivity.java
@@ -54,6 +54,7 @@
     private int squareAvatarsRow;
     private int inappCameraRow;
     private int photoHasStickerRow;
+    private int unmutedOnTopRow;
 
     private int pinOrderRow;
 
@@ -67,6 +68,7 @@ public boolean onFragmentCreate() {
         squareAvatarsRow = rowCount++;
         inappCameraRow = rowCount++;
         photoHasStickerRow = rowCount++;
+        unmutedOnTopRow = rowCount++;
 
         pinOrderRow = rowCount++;
 
@@ -129,6 +131,9 @@ public boolean supportsPredictiveItemAnimations() {
                 if (view instanceof TextCheckCell) {
                     ((TextCheckCell) view).setChecked(SharedConfig.hasSticker);
                 }
+            } else if (position == unmutedOnTopRow) {
+                toggleGlobalMainSetting("unmutedOnTop", view, false);
+                MessagesController.getInstance(currentAccount).sortDialogs(null);
             } else if (position == pinOrderRow) {
                 presentFragment(new PinsOrderActivity());
             }
@@ -183,6 +188,10 @@ public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) {
                         String t = LocaleController.getString("PhotoHasSticker", R.string.PhotoHasSticker);
                         String info = LocaleController.getString("PhotoHasStickerInfo", R.string.PhotoHasStickerInfo);
                         textCell.setTextAndValueAndCheck(t, info, preferences.getBoolean("photoHasSticker", false), true, false);
+                    } else if (position == unmutedOnTopRow) {
+                        String t = LocaleController.getString("UnmutedOnTop", R.string.UnmutedOnTop);
+                        String info = LocaleController.getString("UnmutedOnTopInfo", R.string.UnmutedOnTopInfo);
+                        textCell.setTextAndValueAndCheck(t, info, preferences.getBoolean("unmutedOnTop", false), true, false);
                     }
                     break;
                 }
@@ -202,6 +211,7 @@ public boolean isEnabled(RecyclerView.ViewHolder holder) {
             boolean fork = position == squareAvatarsRow
                         || position == inappCameraRow
                         || position == photoHasStickerRow
+
                         || position == pinOrderRow;
             return fork;
         }
@@ -244,10 +254,10 @@ public int getItemViewType(int position) {
                 return 1;
             } else if (0 == 1) {
                 return 2;
-            } else if (position == squareAvatarsRow 
-                || position == inappCameraRow 
-                || position == photoHasStickerRow 
-                || position == pinOrderRow) {
+            } else if (position == squareAvatarsRow
+                || position == inappCameraRow
+                || position == unmutedOnTopRow
+                || position == photoHasStickerRow) {
                 return 3;
             } else if (position == sectionRow1) {
                 return 4;
