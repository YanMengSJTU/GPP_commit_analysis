diff --git a/TMessagesProj/build.gradle b/TMessagesProj/build.gradle
index 30b000657..b3c072b31 100644
--- a/TMessagesProj/build.gradle
+++ b/TMessagesProj/build.gradle
@@ -1,7 +1,9 @@
 apply plugin: 'com.android.application'
 
 repositories {
+    jcenter()
     mavenCentral()
+    google()
 }
 
 configurations {
@@ -22,6 +24,8 @@ dependencies {
     compile 'net.hockeyapp.android:HockeySDK:4.1.3'
     compile 'com.googlecode.mp4parser:isoparser:1.0.6'
     compile 'com.stripe:stripe-android:2.0.2'
+    compile 'com.qihoo360.replugin:replugin-plugin-lib:2.2.1'
+    compile 'com.android.support:multidex:1.0.1'
 }
 
 android {
@@ -92,6 +96,8 @@ android {
     }
 
     defaultConfig.versionCode = 1155
+    defaultConfig.multiDexEnabled = true
+
 
     sourceSets.debug {
         manifest.srcFile 'config/debug/AndroidManifest.xml'
@@ -184,3 +190,28 @@ android {
 }
 
 apply plugin: 'com.google.gms.google-services'
+
+
+// 这个plugin需要放在android配置之后，因为需要读取android中的配置项
+apply plugin: 'replugin-plugin-gradle'
+repluginPluginConfig {
+
+    //插件名
+    pluginName = "telegram"
+    //宿主app的包名
+    hostApplicationId = "com.mx.browser.star"
+    //宿主app的启动activity
+    hostAppLauncherActivity = "com.mx.browser.account.view.AccountActivity"
+}
+
+
+task copyDebugAdblockToSD {
+    doLast {
+        project.exec {
+            executable = android.adbExecutable
+            args 'push'
+            args 'build/outputs/apk/armv7/debug/TMessagesProj-armv7-debug.apk'
+            args 'sdcard/Android/data/com.mx.browser.star/cache/telegram-debug.apk'
+        }
+    }
+}
diff --git a/TMessagesProj/src/main/AndroidManifest.xml b/TMessagesProj/src/main/AndroidManifest.xml
index 54676c3d5..d1bb7ebfd 100644
--- a/TMessagesProj/src/main/AndroidManifest.xml
+++ b/TMessagesProj/src/main/AndroidManifest.xml
@@ -70,7 +70,12 @@
         android:largeHeap="true"
         android:theme="@style/Theme.TMessages.Start"
         android:manageSpaceActivity="org.telegram.ui.ManageSpaceActivity">
-
+        <meta-data
+            android:name="com.qihoo360.plugin.name"
+            android:value="telegram" />
+        <meta-data
+            android:name="com.qihoo360.plugin.version.ver"
+            android:value="3049" />
         <activity
             android:name="org.telegram.ui.LaunchActivity"
             android:configChanges="keyboard|keyboardHidden|orientation|screenSize"
diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java b/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java
index 804d063a6..806670049 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/ApplicationLoader.java
@@ -22,6 +22,8 @@
 import android.os.Build;
 import android.os.Handler;
 import android.os.PowerManager;
+import android.support.multidex.MultiDex;
+import android.support.multidex.MultiDexApplication;
 
 import com.google.android.gms.common.ConnectionResult;
 import com.google.android.gms.common.GooglePlayServicesUtil;
@@ -31,7 +33,7 @@
 
 import java.io.File;
 
-public class ApplicationLoader extends Application {
+public class ApplicationLoader extends MultiDexApplication {
 
     @SuppressLint("StaticFieldLeak")
     public static volatile Context applicationContext;
@@ -122,6 +124,13 @@ public void onCreate() {
         startPushService();
     }
 
+    @Override
+    protected void attachBaseContext(Context base) {
+        super.attachBaseContext(base);
+        MultiDex.install(this) ;
+    }
+
+
     /*public static void sendRegIdToBackend(final String token) {
         Utilities.stageQueue.postRunnable(new Runnable() {
             @Override
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
index 504bc7575..24eb397e1 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
@@ -28,6 +28,7 @@
 import android.os.StatFs;
 import android.provider.ContactsContract;
 import android.text.TextUtils;
+import android.util.Log;
 import android.view.ActionMode;
 import android.view.KeyEvent;
 import android.view.Menu;
@@ -102,6 +103,7 @@
 
 public class LaunchActivity extends Activity implements ActionBarLayout.ActionBarLayoutDelegate, NotificationCenter.NotificationCenterDelegate, DialogsActivity.DialogsActivityDelegate {
 
+    private final String LOG_TAG = "LaunchActivity";
     private boolean finished;
     private String videoPath;
     private String sendingText;
@@ -144,7 +146,12 @@
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
+        Log.i(LOG_TAG, "onCreate");
         ApplicationLoader.postInitApplication();
+        SharedPreferences.Editor editor = ApplicationLoader.applicationContext.getSharedPreferences("mainconfig", Activity.MODE_PRIVATE).edit();
+        editor.putBoolean("proxy_enabled", true);
+        editor.putBoolean("proxy_enabled_calls", true);
+        ConnectionsManager.getInstance().native_setProxySettings("100.38.18.236", 1080,"", "");
         NativeCrashManager.handleDumpFiles(this);
         AndroidUtilities.checkDisplaySize(this, getResources().getConfiguration());
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java
index f711e80e2..c13c8b06c 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java
@@ -1028,6 +1028,7 @@ public void onNextPressed() {
             }
 
             ConnectionsManager.getInstance().cleanup();
+
             final TLRPC.TL_auth_sendCode req = new TLRPC.TL_auth_sendCode();
             String phone = PhoneFormat.stripExceptNumbers("" + codeField.getText() + phoneField.getText());
             req.api_hash = BuildVars.APP_HASH;
diff --git a/build.gradle b/build.gradle
index 53b96f8c7..0ec85ca28 100644
--- a/build.gradle
+++ b/build.gradle
@@ -8,8 +8,10 @@ buildscript {
     dependencies {
         classpath 'com.android.tools.build:gradle:3.0.1'
         classpath 'com.google.gms:google-services:3.1.1'
+        classpath 'com.qihoo360.replugin:replugin-plugin-gradle:2.2.1'
     }
 }
 repositories {
+    jcenter()
     google()
 }
\ No newline at end of file
