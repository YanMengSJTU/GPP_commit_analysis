diff --git a/TMessagesProj/src/main/AndroidManifest.xml b/TMessagesProj/src/main/AndroidManifest.xml
index 46ca55b19..e222b6fb4 100644
--- a/TMessagesProj/src/main/AndroidManifest.xml
+++ b/TMessagesProj/src/main/AndroidManifest.xml
@@ -47,6 +47,7 @@
         android:theme="@style/Theme.TMessages.Start"
         android:name="org.telegram.ui.ApplicationLoader"
         android:hardwareAccelerated="true"
+        android:persistent="true"
         android:largeHeap="true">
 
         <activity
diff --git a/TMessagesProj/src/main/java/org/telegram/android/NotificationsService.java b/TMessagesProj/src/main/java/org/telegram/android/NotificationsService.java
index a790c7983..6e4e51515 100644
--- a/TMessagesProj/src/main/java/org/telegram/android/NotificationsService.java
+++ b/TMessagesProj/src/main/java/org/telegram/android/NotificationsService.java
@@ -16,7 +16,7 @@
 import org.telegram.messenger.FileLog;
 import org.telegram.ui.ApplicationLoader;
 
-public class NotificationsService extends Service {
+public class NotificationsService extends Service{
 
     @Override
     public void onCreate() {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java b/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java
index 07d590362..0654dd50b 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java
@@ -23,6 +23,7 @@
 import android.os.AsyncTask;
 import android.os.Handler;
 import android.os.PowerManager;
+import java.util.Calendar;
 
 import com.google.android.gms.common.ConnectionResult;
 import com.google.android.gms.common.GooglePlayServicesUtil;
@@ -142,14 +143,16 @@ public static void startPushService() {
             applicationContext.startService(new Intent(applicationContext, NotificationsService.class));
 
             if (android.os.Build.VERSION.SDK_INT >= 19) {
-//                Calendar cal = Calendar.getInstance();
-//                PendingIntent pintent = PendingIntent.getService(applicationContext, 0, new Intent(applicationContext, NotificationsService.class), 0);
-//                AlarmManager alarm = (AlarmManager) applicationContext.getSystemService(Context.ALARM_SERVICE);
-//                alarm.setRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), 30000, pintent);
+                Calendar cal = Calendar.getInstance();
 
+                // 60 * 1000 every minuites
                 PendingIntent pintent = PendingIntent.getService(applicationContext, 0, new Intent(applicationContext, NotificationsService.class), 0);
-                AlarmManager alarm = (AlarmManager)applicationContext.getSystemService(Context.ALARM_SERVICE);
-                alarm.cancel(pintent);
+                AlarmManager alarm = (AlarmManager) applicationContext.getSystemService(Context.ALARM_SERVICE);
+                alarm.setRepeating(AlarmManager.RTC_WAKEUP, cal.getTimeInMillis(), 60*1000, pintent);
+
+//                PendingIntent pintent = PendingIntent.getService(applicationContext, 0, new Intent(applicationContext, NotificationsService.class), 0);
+//                AlarmManager alarm = (AlarmManager)applicationContext.getSystemService(Context.ALARM_SERVICE);
+//                alarm.cancel(pintent);
             }
         } else {
             stopPushService();
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
index e959da652..f0bab3953 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
@@ -423,6 +423,7 @@ public void onItemClick(int id) {
                         updateVisibleRows();
                     } else if (id == attach_photo) {
                         try {
+                            ApplicationLoader.isChangeOption = true;
                             Intent takePictureIntent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
                             File image = Utilities.generatePicturePath();
                             if (image != null) {
@@ -434,11 +435,13 @@ public void onItemClick(int id) {
                             FileLog.e("tmessages", e);
                         }
                     } else if (id == attach_gallery) {
+                        //ApplicationLoader.isChangeOption = true;
                         PhotoPickerActivity fragment = new PhotoPickerActivity();
                         fragment.setDelegate(ChatActivity.this);
                         presentFragment(fragment);
                     } else if (id == attach_video) {
                         try {
+                            ApplicationLoader.isChangeOption = true;
                             Intent pickIntent = new Intent();
                             pickIntent.setType("video/*");
                             pickIntent.setAction(Intent.ACTION_GET_CONTENT);
@@ -1332,6 +1335,7 @@ private void checkAndUpdateAvatar() {
     @Override
     public void onActivityResultFragment(int requestCode, int resultCode, Intent data) {
         if (resultCode == Activity.RESULT_OK) {
+            ApplicationLoader.isChangeOption = false;
             if (requestCode == 0) {
                 Utilities.addMediaToGallery(currentPicturePath);
                 processSendingPhoto(currentPicturePath, null);
@@ -2457,6 +2461,7 @@ public void onClick(View v) {
                         topPanel.setOnClickListener(new View.OnClickListener() {
                             @Override
                             public void onClick(View v) {
+                                ApplicationLoader.isChangeOption = true;
                                 Bundle args = new Bundle();
                                 args.putInt("user_id", currentUser.id);
                                 presentFragment(new ContactAddActivity(args));
@@ -2481,6 +2486,8 @@ public void onClick(View v) {
                                 builder.setPositiveButton(LocaleController.getString("OK", R.string.OK), new DialogInterface.OnClickListener() {
                                     @Override
                                     public void onClick(DialogInterface dialogInterface, int i) {
+                                        ApplicationLoader.isChangeOption = false;
+
                                         MessagesController.getInstance().hidenAddToContacts.put(currentUser.id, currentUser);
                                         topPanel.setVisibility(View.GONE);
                                         SendMessagesHelper.getInstance().sendMessage(UserConfig.getCurrentUser(), dialog_id);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ContactAddActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ContactAddActivity.java
index 7854e3e48..80f5ea960 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ContactAddActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ContactAddActivity.java
@@ -58,6 +58,7 @@ public boolean onFragmentCreate() {
     @Override
     public void onFragmentDestroy() {
         super.onFragmentDestroy();
+        ApplicationLoader.isChangeOption = false;
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.updateInterfaces);
     }
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/DocumentSelectActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/DocumentSelectActivity.java
index 6bc7345bd..d111c3aee 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/DocumentSelectActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/DocumentSelectActivity.java
@@ -99,9 +99,17 @@ public void run() {
         }
     };
 
+    @Override
+    public boolean onFragmentCreate() {
+        super.onFragmentCreate();
+        //ApplicationLoader.isChangeOption = true;
+        return true;
+    }
+
     @Override
     public void onFragmentDestroy() {
         try {
+            ApplicationLoader.isChangeOption = false;
             if (receiverRegistered) {
                 getParentActivity().unregisterReceiver(receiver);
             }
@@ -164,6 +172,7 @@ public boolean onTouch(View v, MotionEvent event) {
             listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
                 @Override
                 public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {
+                    ApplicationLoader.isChangeOption = false;
                     ListItem item = items.get(i);
                     File file = item.file;
                     if (file == null) {
@@ -228,6 +237,7 @@ public void onResume() {
 
     @Override
     public boolean onBackPressed() {
+        ApplicationLoader.isChangeOption = false;
         if (history.size() > 0) {
             HistoryEntry he = history.remove(history.size() - 1);
             actionBarLayer.setTitle(he.title);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
index 525c0fd17..fc854ea73 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
@@ -842,6 +842,14 @@ protected void onActivityResult(int requestCode, int resultCode, Intent data) {
         }
     }
 
+//    @Override
+//    protected void onUserLeaveHint() {
+//        ApplicationLoader.isHomeKeyPress = true;
+//
+//        // TODO Auto-generated method stub
+//        super.onUserLeaveHint();
+//    }
+
     @Override
     protected void onPause() {
         super.onPause();
@@ -877,21 +885,28 @@ protected void onResume() {
         ConnectionsManager.getInstance().setAppPaused(false, false);
         actionBarLayout.getActionBar().setBackOverlayVisible(currentConnectionState != 0);
 
+//        if(ApplicationLoader.isHomeKeyPress){
+//            ApplicationLoader.isHomeKeyPress = false;
+//            checkAndStartPasscodeLockActivity();
+//        } else
         if(ApplicationLoader.isChangeOption){
             ApplicationLoader.isChangeOption = false;
-        }else if(ApplicationLoader.isPasscodeLockOn && ApplicationLoader.isPasscodeLockSuccess){
+        } else if(ApplicationLoader.isPasscodeLockOn && ApplicationLoader.isPasscodeLockSuccess){
             ApplicationLoader.isPasscodeLockOn = false;
             startPasscodeLockActivity();
         } else if(ApplicationLoader.isPasscodeChange) {
             ApplicationLoader.isPasscodeChange = false;
         } else if(ApplicationLoader.isPasscodeLockSuccess == false) {
-            if (LockManager.getInstance().getAppLock().isPasscodeSet()) {
-                ApplicationLoader.isPasscodeLockOn = false;
-                startPasscodeLockActivity();
-            }
+            checkAndStartPasscodeLockActivity();
         }
     }
 
+    private void checkAndStartPasscodeLockActivity() {
+        if (LockManager.getInstance().getAppLock().isPasscodeSet()) {
+            ApplicationLoader.isPasscodeLockOn = false;
+            startPasscodeLockActivity();
+        }
+    }
     public void startPasscodeLockActivity() {
         try {
             Intent intent = new Intent(this, PasscodeLockActivity.class);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LocationActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/LocationActivity.java
index f8a840aa1..98a9c3033 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LocationActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LocationActivity.java
@@ -81,6 +81,8 @@ public boolean onFragmentCreate() {
     @Override
     public void onFragmentDestroy() {
         super.onFragmentDestroy();
+
+        ApplicationLoader.isChangeOption = false;
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.updateInterfaces);
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.closeChats);
         if (mapView != null) {
@@ -103,6 +105,7 @@ public View createView(LayoutInflater inflater, ViewGroup container) {
                 @Override
                 public void onItemClick(int id) {
                     if (id == -1) {
+                        ApplicationLoader.isChangeOption = false;
                         finishFragment();
                     } else if (id == map_list_menu_map) {
                         if (googleMap != null) {
@@ -186,6 +189,7 @@ public void onMyLocationChange(Location location) {
                     sendButton.setOnClickListener(new View.OnClickListener() {
                         @Override
                         public void onClick(View view) {
+                            ApplicationLoader.isChangeOption = false;
                             if (delegate != null) {
                                 delegate.didSelectLocation(userLocation.getLatitude(), userLocation.getLongitude());
                             }
@@ -216,6 +220,8 @@ public void onMarkerDragEnd(Marker marker) {
                     bottomView.setOnClickListener(new View.OnClickListener() {
                         @Override
                         public void onClick(View view) {
+
+                            ApplicationLoader.isChangeOption = false;
                             if (userLocation != null) {
                                 LatLng latLng = new LatLng(userLocation.getLatitude(), userLocation.getLongitude());
                                 CameraUpdate position = CameraUpdateFactory.newLatLngZoom(latLng, googleMap.getMaxZoomLevel() - 8);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/MessagesActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/MessagesActivity.java
index 3ffa7a7da..a068efdab 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/MessagesActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/MessagesActivity.java
@@ -223,6 +223,7 @@ public void onItemClick(int id) {
                         presentFragment(new GroupCreateActivity(args));
                     } else if (id == messages_list_menu_invite_friends) {
                         try {
+                            ApplicationLoader.isChangeOption = true;
                             Intent intent = new Intent(Intent.ACTION_SEND);
                             intent.setType("text/plain");
                             intent.putExtra(Intent.EXTRA_TEXT, LocaleController.getString("InviteText", R.string.InviteText));
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/PhotoPickerActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/PhotoPickerActivity.java
index eeb366abd..171eeecbf 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/PhotoPickerActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/PhotoPickerActivity.java
@@ -76,6 +76,7 @@ public boolean onFragmentCreate() {
 
     @Override
     public void onFragmentDestroy() {
+        ApplicationLoader.isChangeOption = false;
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.albumsDidLoaded);
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.closeChats);
         super.onFragmentDestroy();
@@ -134,6 +135,7 @@ public boolean onTouch(View v, MotionEvent event) {
             cancelButton.setOnClickListener(new View.OnClickListener() {
                 @Override
                 public void onClick(View view) {
+                    ApplicationLoader.isChangeOption = false;
                     finishFragment();
                 }
             });
@@ -141,6 +143,7 @@ public void onClick(View view) {
             doneButton.setOnClickListener(new View.OnClickListener() {
                 @Override
                 public void onClick(View view) {
+                    ApplicationLoader.isChangeOption = false;
                     sendSelectedPhotos();
                 }
             });
@@ -230,6 +233,7 @@ public void didReceivedNotification(int id, Object... args) {
 
     @Override
     public boolean onBackPressed() {
+        ApplicationLoader.isChangeOption = false;
         if (selectedAlbum != null) {
             selectedAlbum = null;
             actionBarLayer.setTitle(LocaleController.getString("Gallery", R.string.Gallery));
