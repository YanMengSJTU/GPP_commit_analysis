diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ActionBar/ActionBarMenuItem.java b/TMessagesProj/src/main/java/org/telegram/ui/ActionBar/ActionBarMenuItem.java
index b039d2ece..42d5d50e0 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ActionBar/ActionBarMenuItem.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ActionBar/ActionBarMenuItem.java
@@ -239,6 +239,10 @@ private void createPopupLayout() {
         });
     }
 
+    public void setPopupLayoutBackgroundColor(int color) {
+        if (popupLayout != null) popupLayout.setBackgroundColor(color);
+    }
+
     public void addSubItem(View view, int width, int height) {
         createPopupLayout();
         popupLayout.addView(view, new LinearLayout.LayoutParams(width, height));
@@ -308,9 +312,14 @@ public TextView addSubItem(int id, CharSequence text) {
     }
 
     public ActionBarMenuSubItem addSubItem(int id, int icon, CharSequence text) {
+        return addSubItem(id, icon, text, defaultSubItemFactory);
+    }
+
+    public ActionBarMenuSubItem addSubItem(int id, int icon, CharSequence text,
+                                           Function<Context, ActionBarMenuSubItem> subItemFactory) {
         createPopupLayout();
 
-        ActionBarMenuSubItem cell = new ActionBarMenuSubItem(getContext());
+        ActionBarMenuSubItem cell = subItemFactory.apply(getContext());
         cell.setTextAndIcon(text, icon);
         cell.setMinimumWidth(AndroidUtilities.dp(196));
         cell.setTag(id);
@@ -462,6 +471,10 @@ public boolean toggleSearch(boolean openKeyboard) {
         }
     }
 
+    public boolean isSearchExpanded() {
+        return searchContainer.getVisibility() == VISIBLE;
+    }
+
     public void closeSubMenu() {
         if (popupWindow != null && popupWindow.isShowing()) {
             popupWindow.dismiss();
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
index 0e5bb04cb..45fe5519e 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
@@ -478,6 +478,10 @@
     private AnimatorSet scrimAnimatorSet;
     private ActionBarPopupWindow scrimPopupWindow;
 
+    private BackDrawable[] tabletBackDrawables = new BackDrawable[] {
+            new BackDrawable(false), new BackDrawable(true)
+    };
+
     private class UnreadCounterTextView extends TextView {
 
         private int currentCounter;
@@ -1369,6 +1373,9 @@ public void onItemClick(final int id) {
 
                 @Override
                 public void onSearchCollapse() {
+                    if (AndroidUtilities.isTablet()) {
+                        actionBar.setBackButtonDrawable(tabletBackDrawables[1]);
+                    }
                     searchCalendarButton.setVisibility(View.VISIBLE);
                     if (searchUserButton != null) {
                         searchUserButton.setVisibility(View.VISIBLE);
@@ -1411,6 +1418,9 @@ public void onSearchCollapse() {
 
                 @Override
                 public void onSearchExpand() {
+                    if (AndroidUtilities.isTablet()) {
+                        actionBar.setBackButtonDrawable(tabletBackDrawables[0]);
+                    }
                     if (!openSearchKeyboard) {
                         return;
                     }
@@ -11666,7 +11676,10 @@ private boolean fixLayoutInternal() {
                     ((ViewGroup) fragmentView).addView(fragmentContextView, LayoutHelper.createFrame(LayoutHelper.MATCH_PARENT, 39, Gravity.TOP | Gravity.LEFT, 0, -36, 0, 0));
                 }
             } else {
-                actionBar.setBackButtonDrawable(new BackDrawable(parentLayout == null || parentLayout.fragmentsStack.isEmpty() || parentLayout.fragmentsStack.get(0) == ChatActivity.this || parentLayout.fragmentsStack.size() == 1));
+                boolean close = parentLayout == null || parentLayout.fragmentsStack.size() <= 1 ||
+                        parentLayout.fragmentsStack.get(0) == ChatActivity.this;
+                close &= !searchItem.isSearchExpanded();
+                actionBar.setBackButtonDrawable(tabletBackDrawables[close ? 1 : 0]);
                 if (fragmentContextView != null && fragmentContextView.getParent() != null) {
                     fragmentView.setPadding(0, 0, 0, 0);
                     ((ViewGroup) fragmentView).removeView(fragmentContextView);
