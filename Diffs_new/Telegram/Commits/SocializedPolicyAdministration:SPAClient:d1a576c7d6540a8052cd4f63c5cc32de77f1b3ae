diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/SPAConfig.java b/TMessagesProj/src/main/java/org/telegram/messenger/SPAConfig.java
index 23fda3c65..a0cb40654 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/SPAConfig.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/SPAConfig.java
@@ -4,6 +4,7 @@
  * Created by zqguo on 2015/11/20.
  */
 public class SPAConfig {
-    public static String keyManager = "http://10.131.1.38:9000/getKeys/";
+    public static String keyManager = "http://10.131.1.38:8000/addKeys/";
     public static String resultMergeServer = "http://10.131.1.38/results/";
+    public static String SPA_PREFERENCE = "spaconfig";
 }
diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/SPAKeyManagerServer.java b/TMessagesProj/src/main/java/org/telegram/messenger/SPAKeyManagerServer.java
new file mode 100644
index 000000000..2046205b7
--- /dev/null
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/SPAKeyManagerServer.java
@@ -0,0 +1,35 @@
+package org.telegram.messenger;
+
+import android.app.Service;
+import android.content.Intent;
+import android.os.AsyncTask;
+import android.os.IBinder;
+import android.util.Log;
+
+import org.apache.http.HttpEntity;
+import org.apache.http.HttpResponse;
+import org.apache.http.client.ClientProtocolException;
+import org.apache.http.client.HttpClient;
+import org.apache.http.client.methods.HttpPost;
+import org.apache.http.entity.StringEntity;
+import org.apache.http.impl.client.DefaultHttpClient;
+import org.apache.http.util.EntityUtils;
+
+import java.io.IOException;
+
+/**
+ * Created by gzq on 15-11-23.
+ */
+public class SPAKeyManagerServer extends Service {
+
+    @Override
+    public IBinder onBind(Intent intent) {
+        // TODO
+        return null;
+    }
+
+    @Override
+    public int onStartCommand(Intent intent, int flags, int startId) {
+        return START_STICKY;
+    }
+}
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java
index 3ca3ba2c8..0f38107c0 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/SPASettingsActivity.java
@@ -80,8 +80,8 @@ public void onFragmentDestroy() {
 
     @Override
     public View createView(Context context) {
-        SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences("spaconfig", Activity.MODE_PRIVATE);
-        if (!preferences.contains("private_key")) {
+        final SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences(SPAConfig.SPA_PREFERENCE, Activity.MODE_PRIVATE);
+        if (!preferences.contains("paillier_n")) {
             RequestQueue queue = Volley.newRequestQueue(context);
             String url = SPAConfig.keyManager;
             // Request a string response from the provided URL.
@@ -89,8 +89,16 @@ public View createView(Context context) {
                     new Response.Listener<String>() {
                         @Override
                         public void onResponse(String response) {
-                            // Display the first 500 characters of the response string.
-                            Log.v("SPA", "Response is: "+ response);
+                            if (response.charAt(0) != '0' && response.charAt(0) != '1') {
+                            } else {
+                                String keys[] = response.split(" ");
+                                SharedPreferences.Editor editor = preferences.edit();
+                                editor.putString("paillier_lambda", keys[0]);
+                                editor.putString("paillier_mu", keys[1]);
+                                editor.putString("g", keys[2]);
+                                editor.putString("n", keys[3]);
+                                editor.putString("ope_key", keys[4]);
+                            }
                         }
                     }, new Response.ErrorListener() {
                 @Override
