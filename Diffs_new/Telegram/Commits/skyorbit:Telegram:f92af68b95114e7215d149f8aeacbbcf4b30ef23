diff --git a/TMessagesProj/build.gradle b/TMessagesProj/build.gradle
index cfd6c0c0b..ddb79c3ab 100644
--- a/TMessagesProj/build.gradle
+++ b/TMessagesProj/build.gradle
@@ -80,7 +80,7 @@ android {
     defaultConfig {
         minSdkVersion 8
         targetSdkVersion 19
-        versionCode 342
-        versionName "1.9.8"
+        versionCode 343
+        versionName "1.9.9"
     }
 }
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java b/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java
index 5639aea30..07d590362 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ApplicationLoader.java
@@ -68,6 +68,7 @@
     public static boolean isPasscodeLockSuccess = false;
     public static boolean isPasscodeLockOn = false;
     public static boolean isPasscodeChange = false;
+    public static boolean isChangeOption = false;
 
     public static void postInitApplication() {
         if (applicationInited) {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
index a044a0cea..d5e019f15 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
@@ -870,7 +870,9 @@ protected void onResume() {
         ConnectionsManager.getInstance().setAppPaused(false, false);
         actionBarLayout.getActionBar().setBackOverlayVisible(currentConnectionState != 0);
 
-        if(ApplicationLoader.isPasscodeLockOn && ApplicationLoader.isPasscodeLockSuccess){
+        if(ApplicationLoader.isChangeOption){
+            ApplicationLoader.isChangeOption = false;
+        }else if(ApplicationLoader.isPasscodeLockOn && ApplicationLoader.isPasscodeLockSuccess){
             ApplicationLoader.isPasscodeLockOn = false;
             startPasscodeLockActivity();
         } else if(ApplicationLoader.isPasscodeChange) {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/SettingsNotificationsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/SettingsNotificationsActivity.java
index 86362f1ee..941935229 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/SettingsNotificationsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/SettingsNotificationsActivity.java
@@ -202,6 +202,7 @@ public void onItemClick(AdapterView<?> adapterView, View view, final int i, long
                             tmpIntent.putExtra(RingtoneManager.EXTRA_RINGTONE_EXISTING_URI, currentSound);
                             startActivityForResult(tmpIntent, i);
                         } catch (Exception e) {
+                            ApplicationLoader.isChangeOption = true;
                             FileLog.e("tmessages", e);
                         }
                     } else if (i == resetNotificationsRow) {
@@ -453,42 +454,48 @@ public void run(TLObject response, TLRPC.TL_error error) {
     @Override
     public void onActivityResultFragment(int requestCode, int resultCode, Intent data) {
         if (resultCode == Activity.RESULT_OK) {
-            Uri ringtone = data.getParcelableExtra(RingtoneManager.EXTRA_RINGTONE_PICKED_URI);
-            String name = null;
-            if (ringtone != null) {
-                Ringtone rng = RingtoneManager.getRingtone(getParentActivity(), ringtone);
-                if (rng != null) {
-                    if(ringtone.equals(Settings.System.DEFAULT_NOTIFICATION_URI)) {
-                        name = LocaleController.getString("Default", R.string.Default);
-                    } else {
-                        name = rng.getTitle(getParentActivity());
+            ApplicationLoader.isChangeOption = true;
+            try {
+                Uri ringtone = data.getParcelableExtra(RingtoneManager.EXTRA_RINGTONE_PICKED_URI);
+                String name = null;
+                if (ringtone != null) {
+                    Ringtone rng = RingtoneManager.getRingtone(getParentActivity(), ringtone);
+                    if (rng != null) {
+                        if(ringtone.equals(Settings.System.DEFAULT_NOTIFICATION_URI)) {
+                            name = LocaleController.getString("Default", R.string.Default);
+                        } else {
+                            name = rng.getTitle(getParentActivity());
+                        }
+                        rng.stop();
                     }
-                    rng.stop();
                 }
-            }
 
-            SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences("Notifications", Activity.MODE_PRIVATE);
-            SharedPreferences.Editor editor = preferences.edit();
+                SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences("Notifications", Activity.MODE_PRIVATE);
+                SharedPreferences.Editor editor = preferences.edit();
 
-            if (requestCode == messageSoundRow) {
-                if (name != null && ringtone != null) {
-                    editor.putString("GlobalSound", name);
-                    editor.putString("GlobalSoundPath", ringtone.toString());
-                } else {
-                    editor.putString("GlobalSound", "NoSound");
-                    editor.putString("GlobalSoundPath", "NoSound");
-                }
-            } else if (requestCode == groupSoundRow) {
-                if (name != null && ringtone != null) {
-                    editor.putString("GroupSound", name);
-                    editor.putString("GroupSoundPath", ringtone.toString());
-                } else {
-                    editor.putString("GroupSound", "NoSound");
-                    editor.putString("GroupSoundPath", "NoSound");
+                if (requestCode == messageSoundRow) {
+                    if (name != null && ringtone != null) {
+                        editor.putString("GlobalSound", name);
+                        editor.putString("GlobalSoundPath", ringtone.toString());
+                    } else {
+                        editor.putString("GlobalSound", "NoSound");
+                        editor.putString("GlobalSoundPath", "NoSound");
+                    }
+                } else if (requestCode == groupSoundRow) {
+                    if (name != null && ringtone != null) {
+                        editor.putString("GroupSound", name);
+                        editor.putString("GroupSoundPath", ringtone.toString());
+                    } else {
+                        editor.putString("GroupSound", "NoSound");
+                        editor.putString("GroupSoundPath", "NoSound");
+                    }
                 }
+                editor.commit();
+                listView.invalidateViews();
+            } catch (Exception e){
+                ApplicationLoader.isChangeOption = true;
+                FileLog.e("tmessages", e);
             }
-            editor.commit();
-            listView.invalidateViews();
         }
     }
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/Views/ActionBar/BaseFragment.java b/TMessagesProj/src/main/java/org/telegram/ui/Views/ActionBar/BaseFragment.java
index 23668350b..dd2594b99 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/Views/ActionBar/BaseFragment.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/Views/ActionBar/BaseFragment.java
@@ -19,6 +19,7 @@
 
 import org.telegram.messenger.ConnectionsManager;
 import org.telegram.messenger.FileLog;
+import org.telegram.ui.ApplicationLoader;
 import org.telegramkr.messenger.R;
 
 public class BaseFragment {
@@ -204,10 +205,12 @@ protected void showAlertDialog(AlertDialog.Builder builder) {
         }
         try {
             if (visibleDialog != null) {
+                ApplicationLoader.isChangeOption = true;
                 visibleDialog.dismiss();
                 visibleDialog = null;
             }
         } catch (Exception e) {
+            ApplicationLoader.isChangeOption = true;
             FileLog.e("tmessages", e);
         }
         visibleDialog = builder.show();
@@ -215,6 +218,7 @@ protected void showAlertDialog(AlertDialog.Builder builder) {
         visibleDialog.setOnDismissListener(new DialogInterface.OnDismissListener() {
             @Override
             public void onDismiss(DialogInterface dialog) {
+                ApplicationLoader.isChangeOption = true;
                 visibleDialog = null;
                 onDialogDismiss();
             }
