diff --git a/TMessagesProj/src/main/java/com/teamjihu/ThemeManager.java b/TMessagesProj/src/main/java/com/teamjihu/ThemeManager.java
index 0b54b332e..554b0fee1 100644
--- a/TMessagesProj/src/main/java/com/teamjihu/ThemeManager.java
+++ b/TMessagesProj/src/main/java/com/teamjihu/ThemeManager.java
@@ -9,21 +9,50 @@
 import android.content.pm.PermissionInfo;
 import android.content.res.Resources;
 import android.graphics.drawable.Drawable;
+import android.content.Context;
+import android.content.SharedPreferences;
 
 public class ThemeManager {
 	private static final String CUSTOM_PERMISSION = "com.teamjihu.theme.telegram.v1";
     private static final String DEFAULT_THEME_PACKAGE = "org.telegram.messenger.phonethemeshop";
+    private static final String PREF_NAME = "THEME_PREF";
+    private static final String PREF_THEME_PACKAGE = "PREF_THEME_PACKAGE";
 	private PackageManager mPackageManager = null;
 	private String mCurrentTheme = null;
 	private Resources mCurrentThemeResource = null;
+    private Context mContext = null;
 	
-	public ThemeManager(PackageManager pm) {
-		mPackageManager = pm;
-        setCurrentTheme(DEFAULT_THEME_PACKAGE);
+	public ThemeManager(Context context) {
+        if(mContext != context) {
+            mContext = context;
+            mPackageManager = mContext.getPackageManager();
+        }
+
+        setTheme();
 	}
-	
-	
-	public void setCurrentTheme(String themePkgName) {
+
+    private void setTheme() {
+        String curTheme = getPreference(mContext, PREF_THEME_PACKAGE, DEFAULT_THEME_PACKAGE);
+        setCurrentTheme(curTheme);
+    }
+
+    public void applyTheme(String themePackageName) {
+        setPreference(mContext, PREF_THEME_PACKAGE, themePackageName);
+        setTheme();
+    }
+
+    private static String getPreference(Context context, String name, String defaultValue) {
+        SharedPreferences prefs = context.getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);
+        return prefs.getString(name, defaultValue);
+    }
+    private static void setPreference(Context context, String name, String data) {
+        SharedPreferences prefs = context.getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);
+        SharedPreferences.Editor editor = prefs.edit();
+        editor.putString(name, data);
+        editor.commit();
+    }
+
+	private void setCurrentTheme(String themePkgName) {
 		mCurrentTheme = themePkgName;
 		
 		try {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/SettingsThemeActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/SettingsThemeActivity.java
index 895c53760..2c6482c3f 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/SettingsThemeActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/SettingsThemeActivity.java
@@ -41,7 +41,7 @@ public void onItemClick(int id) {
             });
 
             fragmentView = inflater.inflate(R.layout.settings_theme_layout, container, false);
-            mThemeManager = new ThemeManager(getParentActivity().getPackageManager());
+            mThemeManager = new ThemeManager(getParentActivity());
             getThemeList();
         } else {
             ViewGroup parent = (ViewGroup)fragmentView.getParent();
