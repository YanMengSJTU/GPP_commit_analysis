diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/SendMessagesHelper.java b/TMessagesProj/src/main/java/org/telegram/messenger/SendMessagesHelper.java
index 0cdbd8c6c..498415784 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/SendMessagesHelper.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/SendMessagesHelper.java
@@ -3925,6 +3925,29 @@ public void run() {
         }).start();
     }
 
+    public static void prepareSendingLocation(final Location location, final long dialog_id) {
+        MessagesStorage.getInstance().getStorageQueue().postRunnable(new Runnable() {
+            @Override
+            public void run() {
+                Utilities.stageQueue.postRunnable(new Runnable() {
+                    @Override
+                    public void run() {
+                        AndroidUtilities.runOnUIThread(new Runnable() {
+                            @Override
+                            public void run() {
+                                TLRPC.TL_messageMediaGeo mediaGeo = new TLRPC.TL_messageMediaGeo();
+                                mediaGeo.geo = new TLRPC.TL_geoPoint();
+                                mediaGeo.geo.lat = location.getLatitude();
+                                mediaGeo.geo._long = location.getLongitude();
+                                SendMessagesHelper.getInstance().sendMessage(mediaGeo, dialog_id, null, null, null);
+                            }
+                        });
+                    }
+                });
+            }
+        });
+    }
+
     public static void prepareSendingPhoto(String imageFilePath, Uri imageUri, long dialog_id, MessageObject reply_to_msg, CharSequence caption, ArrayList<TLRPC.InputDocument> stickers, InputContentInfoCompat inputContent, int ttl) {
         SendingMediaInfo info = new SendingMediaInfo();
         info.path = imageFilePath;
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
index 149c9f8fa..6b8131cf6 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LaunchActivity.java
@@ -21,6 +21,7 @@
 import android.graphics.Point;
 import android.graphics.Shader;
 import android.graphics.drawable.BitmapDrawable;
+import android.location.Location;
 import android.net.Uri;
 import android.os.Build;
 import android.os.Bundle;
@@ -98,11 +99,17 @@
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
 
 public class LaunchActivity extends Activity implements ActionBarLayout.ActionBarLayoutDelegate, NotificationCenter.NotificationCenterDelegate, DialogsActivity.DialogsActivityDelegate {
 
     private boolean finished;
     private String videoPath;
+
+    final private Pattern r = Pattern.compile("geo: ?(-?\\d+\\.\\d+),(-?\\d+\\.\\d+)(,|\\?z=)(-?\\d+)");
+    private Location sendingLocation;
+
     private String sendingText;
     private ArrayList<SendMessagesHelper.SendingMediaInfo> photoPathsArray;
     private ArrayList<String> documentsPathsArray;
@@ -693,6 +700,7 @@ private boolean handleIntent(Intent intent, boolean isNew, boolean restore, bool
             photoPathsArray = null;
             videoPath = null;
             sendingText = null;
+            sendingLocation = null;
             documentsPathsArray = null;
             documentsOriginalPathsArray = null;
             documentsMimeType = null;
@@ -811,7 +819,12 @@ private boolean handleIntent(Intent intent, boolean isNew, boolean restore, bool
                             String subject = intent.getStringExtra(Intent.EXTRA_SUBJECT);
 
                             if (text != null && text.length() != 0) {
-                                if ((text.startsWith("http://") || text.startsWith("https://")) && subject != null && subject.length() != 0) {
+                                Matcher m = r.matcher(text);
+                                if (m.find()) {
+                                    sendingLocation = new Location("");
+                                    sendingLocation.setLatitude(Double.parseDouble(m.group(1)));
+                                    sendingLocation.setLongitude(Double.parseDouble(m.group(2)));
+                                } else if ((text.startsWith("http://") || text.startsWith("https://")) && subject != null && subject.length() != 0) {
                                     text = subject + "\n" + text;
                                 }
                                 sendingText = text;
@@ -864,7 +877,7 @@ private boolean handleIntent(Intent intent, boolean isNew, boolean restore, bool
                                         }
                                     }
                                 }
-                            } else if (sendingText == null) {
+                            } else if (sendingText == null && sendingLocation == null) {
                                 error = true;
                             }
                         }
@@ -1217,7 +1230,7 @@ public void didSelectLocation(TLRPC.MessageMedia location, int live) {
                     }));
                 }
                 pushOpened = false;
-            } else if (videoPath != null || photoPathsArray != null || sendingText != null || documentsPathsArray != null || contactsToSend != null || documentsUrisArray != null) {
+            } else if (videoPath != null || photoPathsArray != null || sendingText != null || sendingLocation != null || documentsPathsArray != null || contactsToSend != null || documentsUrisArray != null) {
                 if (!AndroidUtilities.isTablet()) {
                     NotificationCenter.getInstance().postNotificationName(NotificationCenter.closeChats);
                 }
@@ -1759,7 +1772,9 @@ public void didSelectDialogs(DialogsActivity dialogsFragment, ArrayList<Long> di
         if (sendingText != null) {
             SendMessagesHelper.prepareSendingText(sendingText, did);
         }
-
+        if (sendingLocation != null) {
+            SendMessagesHelper.prepareSendingLocation(sendingLocation, did);
+        }
         if (documentsPathsArray != null || documentsUrisArray != null) {
             SendMessagesHelper.prepareSendingDocuments(documentsPathsArray, documentsOriginalPathsArray, documentsUrisArray, documentsMimeType, did, null, null);
         }
@@ -1772,6 +1787,7 @@ public void didSelectDialogs(DialogsActivity dialogsFragment, ArrayList<Long> di
         photoPathsArray = null;
         videoPath = null;
         sendingText = null;
+        sendingLocation = null;
         documentsPathsArray = null;
         documentsOriginalPathsArray = null;
         contactsToSend = null;
