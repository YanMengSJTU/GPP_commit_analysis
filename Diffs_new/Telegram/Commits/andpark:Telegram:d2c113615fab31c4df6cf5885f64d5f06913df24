diff --git a/TMessagesProj/build.gradle b/TMessagesProj/build.gradle
index 90c70bc8c..e69d9a8e8 100644
--- a/TMessagesProj/build.gradle
+++ b/TMessagesProj/build.gradle
@@ -79,7 +79,7 @@ android {
     defaultConfig {
         minSdkVersion 8
         targetSdkVersion 19
-        versionCode 3
+        versionCode 4
         versionName '1.1'
     }
     productFlavors {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LoginActivityPhoneView.java b/TMessagesProj/src/main/java/org/telegram/ui/LoginActivityPhoneView.java
index d09b7a21f..3a33eacab 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LoginActivityPhoneView.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LoginActivityPhoneView.java
@@ -279,7 +279,12 @@ private String getPhoneNumber() {
         TelephonyManager systemService = (TelephonyManager)getContext().getSystemService(Context.TELEPHONY_SERVICE);
         phoneNumber = systemService.getLine1Number();
 
-        return ( phoneNumber.length() >= 10 ) ? ( phoneNumber.substring(phoneNumber.length() - 10, phoneNumber.length()) ) : "";
+        if ( phoneNumber == null )
+            return "";
+
+        phoneNumber = ( phoneNumber.length() >= 10 ) ? ( phoneNumber.substring(phoneNumber.length() - 10, phoneNumber.length()) ) : "";
+
+        return phoneNumber;
     }
 
     public void selectCountry(String name) {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/Views/ChatActivityEnterView.java b/TMessagesProj/src/main/java/org/telegram/ui/Views/ChatActivityEnterView.java
index 511a0412d..04102363d 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/Views/ChatActivityEnterView.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/Views/ChatActivityEnterView.java
@@ -587,7 +587,8 @@ private void showEmojiPopup(boolean show) {
             if (!keyboardVisible) {
                 if (sizeNotifierRelativeLayout != null) {
                     sizeNotifierRelativeLayout.setPadding(0, 0, 0, currentHeight);
-                    emojiButton.setImageResource(R.drawable.ic_msg_panel_hide);
+                    //emojiButton.setImageResource(R.drawable.ic_msg_panel_hide);
+                    emojiButton.setImageDrawable(themeManager.getDrawable("ic_msg_panel_hide", false));
                 }
                 return;
             }
