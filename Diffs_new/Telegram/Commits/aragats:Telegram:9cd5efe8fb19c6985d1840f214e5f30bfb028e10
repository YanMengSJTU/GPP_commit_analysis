diff --git a/TMessagesProj/src/main/java/org/telegram/android/MediaController.java b/TMessagesProj/src/main/java/org/telegram/android/MediaController.java
index 0f535a81d..256a12254 100644
--- a/TMessagesProj/src/main/java/org/telegram/android/MediaController.java
+++ b/TMessagesProj/src/main/java/org/telegram/android/MediaController.java
@@ -63,6 +63,7 @@
 public class MediaController implements NotificationCenter.NotificationCenterDelegate {
 
     private static RTree<Post, Geometry> rTree;
+    private static boolean rTreeloaded;
 
 
     public static int[] readArgs = new int[3];
@@ -749,7 +750,7 @@ public boolean canSaveToGallery() {
     //TODO why it is static
     //TODO what is it guid. I need guid in postNotification. I should pass this parameter in args to say to which activiy I send the notification, because many activities could subscribe to the same notification, but not all of them must receive the response
     public static void loadGeoTaggedGalleryPhotos(final int guid) {
-        if (rTree != null) {
+        if (rTree != null || isRTreeloaded()) {
             AndroidUtilities.runOnUIThread(new Runnable() {
                 @Override
                 public void run() {
@@ -828,6 +829,7 @@ public void run() {
 
     private static void setrTree(RTree<Post, Geometry> rTree) {
         MediaController.rTree = rTree;
+        rTreeloaded = true;
 
     }
 
@@ -1046,4 +1048,8 @@ public void saveBitmap(Image image) {
     public static RTree<Post, Geometry> getrTree() {
         return rTree;
     }
+
+    public static boolean isRTreeloaded() {
+        return rTreeloaded;
+    }
 }
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java
index 2220f5f69..d0b97f9d4 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java
@@ -777,6 +777,7 @@ public void onClick(DialogInterface dialogInterface, int i) {
                         emptyView.setVisibility(View.INVISIBLE);
                         postListView.setEmptyView(progressView);
                     } else {
+//                        postListView.setVisibility(View.INVISIBLE);
                         progressView.setVisibility(View.INVISIBLE);
                         if (searching && searchWas) {
                             emptyView.setVisibility(View.INVISIBLE);
@@ -814,17 +815,29 @@ public void onClick(DialogInterface dialogInterface, int i) {
         } else if (id == NotificationCenter.offlinePostsLoaded) {
             PostsController.getInstance().loadPosts(null, 0, Constants.POST_COUNT, true, offlineMode); // TODO why offlineMode is false /// aaa becaue different instances !!!
         } else if (id == NotificationCenter.switchToOfflineMode) {
-            MediaController.loadGeoTaggedGalleryPhotos(0);
             boolean force = false;
             if (!this.offlineMode) {
                 force = true;
+                if (!MediaController.isRTreeloaded()) {
+                    if (progressView != null && postListView != null) {
+                        progressView.setVisibility(View.VISIBLE);
+                        postListView.setVisibility(View.INVISIBLE);
+                    }
+                }
+                MediaController.loadGeoTaggedGalleryPhotos(0);
             }
+
+
             this.offlineMode = true;
 //            refreshPosts(force);
         } else if (id == NotificationCenter.switchToOnlineMode) {
             boolean force = false;
             if (this.offlineMode) {
                 force = true;
+                if (progressView != null && postListView != null) {
+                    progressView.setVisibility(View.VISIBLE);
+                    postListView.setVisibility(View.INVISIBLE);
+                }
             }
             this.offlineMode = false;
             refreshPosts(force);
diff --git a/TMessagesProj/src/main/java/ru/aragats/wgo/converter/vk/PhotoItemToPostConverter.java b/TMessagesProj/src/main/java/ru/aragats/wgo/converter/vk/PhotoItemToPostConverter.java
index 2a99a645b..e003b76db 100644
--- a/TMessagesProj/src/main/java/ru/aragats/wgo/converter/vk/PhotoItemToPostConverter.java
+++ b/TMessagesProj/src/main/java/ru/aragats/wgo/converter/vk/PhotoItemToPostConverter.java
@@ -1,5 +1,7 @@
 package ru.aragats.wgo.converter.vk;
 
+import org.telegram.utils.StringUtils;
+
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.List;
@@ -17,6 +19,7 @@
 public class PhotoItemToPostConverter extends AbstractConverter<PhotoItem, Post> {
     @Override
     public Post convertIntern(PhotoItem source) {
+        //TODO validate height width and url if we can not build Post then return null and exlude it from the post list.
         Post result = new Post();
         result.setId("" + source.getId());
         result.setCreatedDate(((long) source.getDate() * 1000));
@@ -43,7 +46,11 @@ public Post convertIntern(PhotoItem source) {
         Image image = new Image();
         image.setHeight(source.getHeight());
         image.setWidth(source.getWidth());
-        image.setUrl(source.getPhoto1280());
+        if(!StringUtils.isEmpty(source.getPhoto1280())) {
+            image.setUrl(source.getPhoto1280());
+        } else {
+            image.setUrl(source.getPhoto604());
+        }
         images.add(image);
 
 
