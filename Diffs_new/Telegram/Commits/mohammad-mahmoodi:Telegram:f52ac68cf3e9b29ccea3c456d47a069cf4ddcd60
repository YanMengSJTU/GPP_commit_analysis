diff --git a/TMessagesProj/build.gradle b/TMessagesProj/build.gradle
index deab16c7a..d4be4b36d 100644
--- a/TMessagesProj/build.gradle
+++ b/TMessagesProj/build.gradle
@@ -57,13 +57,12 @@ android {
     }
 
     signingConfigs {
-//        debug {
-//            storeFile file("config/release.keystore")
-//            storePassword RELEASE_STORE_PASSWORD
-//            keyAlias RELEASE_KEY_ALIAS
-//            keyPassword RELEASE_KEY_PASSWORD
-//        }
-
+        debug {
+            storeFile file('/debug.jks')
+            storePassword '12345678'
+            keyAlias 'key0'
+            keyPassword '12345678'
+        }
         release {
             storeFile file("config/release.keystore")
             storePassword RELEASE_STORE_PASSWORD
@@ -80,8 +79,8 @@ android {
 //            applicationIdSuffix ".beta"
             minifyEnabled true
             proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
+            signingConfig signingConfigs.debug
         }
-
         release {
             debuggable false
             jniDebuggable false
@@ -90,7 +89,6 @@ android {
             shrinkResources false
             proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
         }
-
         foss {
             debuggable false
             jniDebuggable false
diff --git a/TMessagesProj/jni/tgnet/Defines.h b/TMessagesProj/jni/tgnet/Defines.h
index c3639b6dc..c14003cfd 100644
--- a/TMessagesProj/jni/tgnet/Defines.h
+++ b/TMessagesProj/jni/tgnet/Defines.h
@@ -25,7 +25,7 @@
 #define DEFAULT_DATACENTER_ID INT_MAX
 #define DC_UPDATE_TIME 60 * 60
 #define TEMP_AUTH_KEY_EXPIRE_TIME 32 * 60 * 60
-#define PROXY_CONNECTIONS_COUNT 16
+#define PROXY_CONNECTIONS_COUNT 4
 #define DOWNLOAD_CONNECTIONS_COUNT 2
 #define UPLOAD_CONNECTIONS_COUNT 4
 #define CONNECTION_BACKGROUND_KEEP_TIME 10000
diff --git a/TMessagesProj/src/main/java/org/telegram/AutoProxy.java b/TMessagesProj/src/main/java/org/telegram/AutoProxy.java
index 3e1ed16f1..bc4c983a9 100644
--- a/TMessagesProj/src/main/java/org/telegram/AutoProxy.java
+++ b/TMessagesProj/src/main/java/org/telegram/AutoProxy.java
@@ -167,13 +167,15 @@ private void addProxy() {
             editor.putString("proxy_secret", secret);
             info = new SharedConfig.ProxyInfo(address, p, "", "", secret);
         }
-        editor.commit();
+      //  editor.commit();
 
-        SharedConfig.currentProxy = SharedConfig.addProxy(info);
+        SharedConfig.addProxy(info);
 
-        ConnectionsManager.setProxySettings(true, address, p, user, password, secret);
-        checkProxyList();
+//        SharedConfig.currentProxy = SharedConfig.addProxy(info);
+//
+//        ConnectionsManager.setProxySettings(true, address, p, user, password, secret);
         NotificationCenter.getGlobalInstance().postNotificationName(NotificationCenter.proxySettingsChanged);
+        checkProxyList();
 
     }
 
@@ -211,7 +213,7 @@ public void didReceivedNotification(int id, int account, Object... args) {
         }
     }
 
-    private long lastCheckInConnectionLost;
+    private long delayTimeInConnectionLost = 2000;
 
     private void updateCurrentConnectionState(int account) {
 
@@ -219,7 +221,9 @@ private void updateCurrentConnectionState(int account) {
         currentConnectionState = ConnectionsManager.getInstance(currentAccount).getConnectionState();
         if (currentConnectionState == ConnectionsManager.ConnectionStateWaitingForNetwork) {
 
+            delayTimeInConnectionLost = 2000;
         } else if (currentConnectionState == ConnectionsManager.ConnectionStateUpdating) {
+            delayTimeInConnectionLost = 2000 ;
 
         } else if (currentConnectionState == ConnectionsManager.ConnectionStateConnectingToProxy) {
 
@@ -227,11 +231,12 @@ private void updateCurrentConnectionState(int account) {
             handler.postDelayed(new Runnable() {
                 @Override
                 public void run() {
-                    //Do something after 100ms
+
                     if (currentConnectionState == ConnectionsManager.ConnectionStateConnectingToProxy) {
-                        currentPing = 10000;
                         checkProxyList();
-//                        handler.postDelayed(this,10000);
+                        handler.postDelayed(this,delayTimeInConnectionLost);
+                        if(delayTimeInConnectionLost < 60*1000*2)
+                        delayTimeInConnectionLost = delayTimeInConnectionLost +1000;
                         Log.d("tdroid", "ConnectionStateConnectingToProxy" + " checkProxyList ");
                     }
                 }
@@ -239,6 +244,9 @@ public void run() {
 
         } else if (currentConnectionState == ConnectionsManager.ConnectionStateConnecting) {
 
+            delayTimeInConnectionLost = 2000;
+        }else if (currentConnectionState == ConnectionsManager.ConnectionStateConnected) {
+            delayTimeInConnectionLost = 2000;
         }
 
     }
@@ -266,15 +274,33 @@ private void checkProxyList() {
         currentPing = 100000L;
         for (int a = 0, count = SharedConfig.proxyList.size(); a < count; a++) {
             final SharedConfig.ProxyInfo proxyInfo = SharedConfig.proxyList.get(a);
+
+//            if (proxyInfo.checking && SystemClock.elapsedRealtime() - proxyInfo.availableCheckTime >  10 * 1000) {
+//
+//                if (currentConnectionState!=ConnectionsManager.ConnectionStateWaitingForNetwork  && SharedConfig.proxyList.size() > MIN_PROXY_COUNT) {
+//                    SharedConfig.deleteProxy(proxyInfo);
+//                    count = SharedConfig.proxyList.size();
+//                    NotificationCenter.getGlobalInstance().postNotificationName(NotificationCenter.proxySettingsChanged);
+//                    Log.i("tdroid", "run: delete proxy manual 20s timeout");
+//
+//                }
+//
+//
+//            }
+
+
+
+
             if (proxyInfo.checking || SystemClock.elapsedRealtime() - proxyInfo.availableCheckTime < 2 * 60 * 1000) {
                 if (!proxyInfo.checking && proxyInfo.available) {
                     if (proxyInfo.ping < currentPing) {
                         SharedConfig.currentProxy = proxyInfo;
                         ConnectionsManager.setProxySettings(true, proxyInfo.address, proxyInfo.port, proxyInfo.username, proxyInfo.password, proxyInfo.secret);
+                        NotificationCenter.getGlobalInstance().postNotificationName(NotificationCenter.proxySettingsChanged);
                         currentPing = proxyInfo.ping;
                         Log.d("tdroid", "connect faster proxy");
                     }
-                } else if (!proxyInfo.checking && SharedConfig.proxyList.size() > MIN_PROXY_COUNT) {
+                } else if (!proxyInfo.checking && SharedConfig.proxyList.size() > MIN_PROXY_COUNT && !proxyInfo.available ) {
                     SharedConfig.deleteProxy(proxyInfo);
                     count = SharedConfig.proxyList.size();
                     Log.i("tdroid", "run: delete proxy ");
@@ -312,6 +338,8 @@ public void run() {
                                 }
                             }
                             NotificationCenter.getGlobalInstance().postNotificationName(NotificationCenter.proxyCheckDone, proxyInfo);
+                            NotificationCenter.getGlobalInstance().postNotificationName(NotificationCenter.proxySettingsChanged);
+
                         }
                     });
                 }
