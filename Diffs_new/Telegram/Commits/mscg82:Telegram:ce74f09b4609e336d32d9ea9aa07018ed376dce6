diff --git a/TMessagesProj/src/main/java/org/telegram/ui/Cells/ChatMessageCell.java b/TMessagesProj/src/main/java/org/telegram/ui/Cells/ChatMessageCell.java
index 9396d1aba..e56d0db0c 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/Cells/ChatMessageCell.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/Cells/ChatMessageCell.java
@@ -40,8 +40,8 @@ public boolean onTouchEvent(MotionEvent event) {
                 int x = (int)event.getX();
                 int y = (int)event.getY();
                 if (x >= textX && y >= textY && x <= textX + currentMessageObject.textWidth && y <= textY + currentMessageObject.textHeight) {
-                    y -= textY;
                     int blockNum = Math.max(0, y / currentMessageObject.blockHeight);
+                    y -= textY;
                     if (blockNum < currentMessageObject.textLayoutBlocks.size()) {
                         MessageObject.TextLayoutBlock block = currentMessageObject.textLayoutBlocks.get(blockNum);
                         x -= textX - (int)Math.ceil(block.textXOffset);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
index 2d17cddf1..99f7b76f6 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
@@ -753,6 +753,15 @@ public boolean onKey(View view, int i, KeyEvent keyEvent) {
                 }
             });
 
+            messsageEditText.setOnClickListener(new View.OnClickListener() {
+                @Override
+                public void onClick(View view) {
+                    if (emojiPopup != null && emojiPopup.isShowing()) {
+                        showEmojiPopup(false);
+                    }
+                }
+            });
+
             messsageEditText.setOnEditorActionListener(new TextView.OnEditorActionListener() {
                 @Override
                 public boolean onEditorAction(TextView textView, int i, KeyEvent keyEvent) {
