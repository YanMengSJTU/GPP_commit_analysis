diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/UserConfig.java b/TMessagesProj/src/main/java/org/telegram/messenger/UserConfig.java
index e17b045af..e564d0690 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/UserConfig.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/UserConfig.java
@@ -48,30 +48,25 @@ public static void saveConfig(boolean withFile, File oldFile) {
             try {
                 SharedPreferences preferences = ApplicationLoader.applicationContext.getSharedPreferences("userconfing", Context.MODE_PRIVATE);
                 SharedPreferences.Editor editor = preferences.edit();
-                if (currentUser != null) {
-                    editor.putBoolean("registeredForPush", registeredForPush);
-                    editor.putString("pushString", pushString);
-                    editor.putInt("lastSendMessageId", lastSendMessageId);
-                    editor.putInt("lastLocalId", lastLocalId);
-                    editor.putString("contactsHash", contactsHash);
-                    editor.putBoolean("saveIncomingPhotos", saveIncomingPhotos);
-                    if (withFile) {
-                        SerializedData data = new SerializedData();
-                        currentUser.serializeToStream(data);
-                        clientUserId = currentUser.id;
-                        clientActivated = true;
-                        String userString = Base64.encodeToString(data.toByteArray(), Base64.DEFAULT);
-                        editor.putString("user", userString);
-                    }
-                } else {
-                    editor.putBoolean("registeredForPush", registeredForPush);
-                    editor.putString("pushString", pushString);
-                    editor.putInt("lastSendMessageId", lastSendMessageId);
-                    editor.putInt("lastLocalId", lastLocalId);
-                    editor.putString("contactsHash", contactsHash);
-                    editor.putBoolean("saveIncomingPhotos", saveIncomingPhotos);
+                
+                editor.putBoolean("registeredForPush", registeredForPush);
+                editor.putString("pushString", pushString);
+                editor.putInt("lastSendMessageId", lastSendMessageId);
+                editor.putInt("lastLocalId", lastLocalId);
+                editor.putString("contactsHash", contactsHash);
+                editor.putBoolean("saveIncomingPhotos", saveIncomingPhotos);
+                
+                if (currentUser == null) {
                     editor.remove("user");
+                } else if (withFile) {
+                    SerializedData data = new SerializedData();
+                    currentUser.serializeToStream(data);
+                    clientUserId = currentUser.id;
+                    clientActivated = true;
+                    String userString = Base64.encodeToString(data.toByteArray(), Base64.DEFAULT);
+                    editor.putString("user", userString);
                 }
+                
                 editor.commit();
                 if (oldFile != null) {
                     oldFile.delete();
