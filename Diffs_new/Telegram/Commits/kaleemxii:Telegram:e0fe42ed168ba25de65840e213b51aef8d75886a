diff --git a/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java b/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java
index 78a779978..d0665f91a 100644
--- a/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java
+++ b/TMessagesProj/src/main/java/org/telegram/messenger/NotificationsController.java
@@ -86,14 +86,7 @@
     private boolean soundInLoaded;
     private boolean soundOutLoaded;
     private AlarmManager alarmManager;
-    public WidgetUpdateDelegate widgetUpdateDelegate = null;
-    public Context context = null;
-    public int[] appWidgetIds = null;
-    public AppWidgetManager appWidgetManager;
 
-    public interface WidgetUpdateDelegate {
-        public void updateWidget(Context context, int[] appWidgetIds, AppWidgetManager appWidgetManager);
-    }
 
     public NotificationsController() {
         notificationManager = NotificationManagerCompat.from(ApplicationLoader.applicationContext);
@@ -151,14 +144,6 @@ public static NotificationsController getInstance() {
         return localInstance;
     }
 
-    public void setUpdateWidgetDelegate(Context context, WidgetUpdateDelegate widgetDelegate, int[] appWidgetIds, AppWidgetManager appWidgetManager) {
-        if (appWidgetIds != null) {
-            this.context = context;
-            this.widgetUpdateDelegate = widgetDelegate;
-            this.appWidgetIds = appWidgetIds;
-            this.appWidgetManager = appWidgetManager;
-        }
-    }
 
     private static String getLauncherClassName(Context context) {
         try {
@@ -1165,11 +1150,9 @@ private void showOrUpdateNotification(boolean notifyAboutLast) {
     }
 
     private void updateMyWidget() {
-        //AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(ApplicationLoader.applicationContext);
-        //ComponentName componentName = new ComponentName(ApplicationLoader.applicationContext, TelegramMessageWidget.class);
-        //appWidgetManager.updateAppWidget(componentName, );
-        if (widgetUpdateDelegate != null && appWidgetIds != null)
-            widgetUpdateDelegate.updateWidget(context, appWidgetIds, appWidgetManager);
+        AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(ApplicationLoader.applicationContext);
+        TelegramMessageWidget.updateWidget(ApplicationLoader.applicationContext, appWidgetManager);
+
     }
 
     private void showOrUpdateNotification(boolean notifyAboutLast, boolean isButtonRequired, String leftBtnName, String rightBtnName) {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
index 49c622ebd..faf252146 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/ChatActivity.java
@@ -12,6 +12,7 @@
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.app.Dialog;
+import android.appwidget.AppWidgetManager;
 import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
@@ -571,6 +572,9 @@ public void onFragmentDestroy() {
         if (chatActivityEnterView != null) {
             chatActivityEnterView.onDestroy();
         }
+        TelegramMessageWidget.updateWidget(ApplicationLoader.applicationContext,
+                AppWidgetManager.getInstance(ApplicationLoader.applicationContext));
+
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.messagesDidLoaded);
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.emojiDidLoaded);
         NotificationCenter.getInstance().removeObserver(this, NotificationCenter.updateInterfaces);
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java
index aa7eeda64..c4041fc40 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java
@@ -634,7 +634,7 @@ public boolean onTouch(View v, MotionEvent event) {
         floatingButton = new ImageView(context);
         floatingButton.setVisibility(onlySelect ? View.GONE : View.VISIBLE);
         floatingButton.setScaleType(ImageView.ScaleType.CENTER);
-        floatingButton.setBackgroundResource(R.drawable.floating_button_drawable);
+        floatingButton.setBackgroundResource(R.drawable.floating_m);
         floatingButton.setImageResource(R.drawable.botcha);
         floatingButton.setPadding(5,5,5,5);
         if (Build.VERSION.SDK_INT >= 21) {
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java b/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java
index 7032597f3..39b4af7f8 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/TelegramMessageWidget.java
@@ -4,31 +4,39 @@
 import android.app.PendingIntent;
 import android.appwidget.AppWidgetManager;
 import android.appwidget.AppWidgetProvider;
+import android.content.ComponentName;
 import android.content.Context;
 import android.content.Intent;
 import android.net.Uri;
+import android.util.Log;
 import android.widget.RemoteViews;
 
+import org.telegram.messenger.ApplicationLoader;
 import org.telegram.messenger.NotificationsController;
 import org.telegram.messenger.R;
 import org.telegram.messenger.WidgetService;
 
+import java.util.Timer;
+import java.util.TimerTask;
+
 /**
  * Implementation of App Widget functionality.
  */
-public class TelegramMessageWidget extends AppWidgetProvider implements NotificationsController.WidgetUpdateDelegate {
-
+public class TelegramMessageWidget extends AppWidgetProvider {
 
+    Timer timer;
     @Override
     public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) {
         // There may be multiple widgets active, so update all of them
-        if (NotificationsController.getInstance().widgetUpdateDelegate == null) {
-            NotificationsController.getInstance().setUpdateWidgetDelegate(context,this, appWidgetIds,appWidgetManager);
-        }
+
         final int N = appWidgetIds.length;
         for (int i = 0; i < N; i++) {
             updateAppWidget(context, appWidgetManager, appWidgetIds[i]);
         }
+        super.onUpdate(context, appWidgetManager, appWidgetIds);
+
+        //timer = new Timer();
+        //timer.scheduleAtFixedRate(new WidgetTimer(context, appWidgetManager, appWidgetIds), 1, 1000);
     }
 
 //    @Override
@@ -66,13 +74,57 @@ static void updateAppWidget(Context context, AppWidgetManager appWidgetManager,
         views.setPendingIntentTemplate(R.id.widgetListView, contentIntent);
         views.setRemoteAdapter(R.id.widgetListView, svcIntent);
 
+        Log.d("Widget", "updateAppWidget");
         // Instruct the widget manager to update the widget
         appWidgetManager.updateAppWidget(appWidgetId, views);
     }
 
-    @Override
-    public void updateWidget(Context context, int[] appWidgetIds, AppWidgetManager appWidgetManager) {
-        this.onUpdate(context, appWidgetManager, appWidgetIds);
+//    private class WidgetTimer extends TimerTask {
+//
+//        private AppWidgetManager mAppWidgetManager;
+//        private RemoteViews mRemoteViews;
+//        private ComponentName mThisWidget;
+//        private int[] mAppWidgetIds;
+//        private Context mContext;
+//
+//        public WidgetTimer(Context context, AppWidgetManager appWidgetManager, int[]  appWidgetIds) {
+//
+//            this.mAppWidgetManager = appWidgetManager;
+//            this.mThisWidget = new ComponentName(context, TelegramMessageWidget.class);
+//            this.mAppWidgetIds = appWidgetIds;
+//            this.mContext = context;
+//            this.mRemoteViews = new RemoteViews(context.getPackageName(), R.layout.telegram_message_widget);
+//        }
+//
+//
+//        @SuppressLint("NewApi")
+//        @Override
+//        public void run() {
+//            //int N = mAppWidgetIds.length;
+//            Log.d("Widget", "timer run is called");
+//            //for (int i = 0; i < N; i++) {
+//
+//                mAppWidgetManager.notifyAppWidgetViewDataChanged(mAppWidgetIds[0], R.id.widgetListView);
+//                //updateAppWidget(mContext, mAppWidgetManager, mAppWidgetIds[i]);
+//        //    }
+//        }
+//    }
+
+//    @Override
+//    public void onDeleted(Context context, int[] appWidgetIds) {
+//        super.onDeleted(context, appWidgetIds);
+//        //Log.d("Widget", "timer cancellled");
+//        //timer.cancel();
+//    }
+
+    @SuppressLint("NewApi")
+    public static void updateWidget(Context context, AppWidgetManager appWidgetManager) {
+       int[] mAppWidgetIds = appWidgetManager.getAppWidgetIds(
+                new ComponentName(context, TelegramMessageWidget.class));
+        for (int i = 0; i < mAppWidgetIds.length; i++) {
+            appWidgetManager.notifyAppWidgetViewDataChanged(mAppWidgetIds[i], R.id.widgetListView);
+        }
+
     }
 }
 
