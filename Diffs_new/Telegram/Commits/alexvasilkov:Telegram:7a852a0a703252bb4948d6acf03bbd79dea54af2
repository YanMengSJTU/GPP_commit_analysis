diff --git a/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java
index 87278c673..44936e186 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/DialogsActivity.java
@@ -1945,7 +1945,19 @@ public void onResume() {
                         builder.setPositiveButton(LocaleController.getString("OK", R.string.OK), null);
                         showDialog(permissionDialog = builder.create());
                     } else {
-                        askForPermissons(true);
+                        if (Build.VERSION.SDK_INT >= 24) {
+                            askForPermissons(true);
+                        } else {
+                            parentLayout.getViewTreeObserver().addOnDrawListener(new ViewTreeObserver.OnDrawListener() {
+                                @Override
+                                public void onDraw() {
+                                    parentLayout.post(() -> {
+                                        parentLayout.getViewTreeObserver().removeOnDrawListener(this);
+                                        askForPermissons(true);
+                                    });
+                                }
+                            });
+                        }
                     }
                 }
             }
