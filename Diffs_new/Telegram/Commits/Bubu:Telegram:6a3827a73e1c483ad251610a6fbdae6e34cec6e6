diff --git a/TMessagesProj/src/main/java/org/telegram/tgnet/ConnectionsManager.java b/TMessagesProj/src/main/java/org/telegram/tgnet/ConnectionsManager.java
index 4a7e31eb6..a05dd980e 100644
--- a/TMessagesProj/src/main/java/org/telegram/tgnet/ConnectionsManager.java
+++ b/TMessagesProj/src/main/java/org/telegram/tgnet/ConnectionsManager.java
@@ -31,6 +31,7 @@
 import org.telegram.messenger.Utilities;
 
 import java.io.ByteArrayOutputStream;
+import java.io.IOException;
 import java.io.InputStream;
 import java.net.Inet4Address;
 import java.net.Inet6Address;
@@ -267,7 +268,7 @@ public void setUserId(int id) {
         native_setUserId(id);
     }
 
-    private void checkConnection() {
+    public void checkConnection() {
         native_setUseIpv6(useIpv6Address());
         native_setNetworkAvailable(isNetworkOnline(), getCurrentNetworkType());
     }
@@ -687,7 +688,13 @@ protected NativeByteBuffer doInBackground(Void... voids) {
                 httpConnection.setConnectTimeout(5000);
                 httpConnection.setReadTimeout(5000);
                 httpConnection.connect();
-                InputStream httpConnectionStream = httpConnection.getInputStream();
+                InputStream httpConnectionStream = null;
+                try {
+                    httpConnectionStream = httpConnection.getInputStream();
+                } catch (IOException e) {
+                    FileLog.d("TFOSS: Google Domain Fronting failed(DNS?)");
+                    return null;
+                }
 
                 ByteArrayOutputStream outbuf = new ByteArrayOutputStream();
 
@@ -771,7 +778,13 @@ protected NativeByteBuffer doInBackground(Void... voids) {
                 httpConnection.setConnectTimeout(5000);
                 httpConnection.setReadTimeout(5000);
                 httpConnection.connect();
-                InputStream httpConnectionStream = httpConnection.getInputStream();
+                InputStream httpConnectionStream = null;
+                try {
+                    httpConnectionStream = httpConnection.getInputStream();
+                } catch (IOException e) {
+                    FileLog.d("TFOSS: Google Domain Fronting failed(DC?)");
+                    return null;
+                }
 
                 ByteArrayOutputStream outbuf = new ByteArrayOutputStream();
 
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java
index f711e80e2..eb6ca1117 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/LoginActivity.java
@@ -10,6 +10,8 @@
 
 import android.Manifest;
 import android.animation.Animator;
+import android.animation.ObjectAnimator;
+import android.animation.StateListAnimator;
 import android.annotation.SuppressLint;
 import android.app.Activity;
 import android.app.Dialog;
@@ -576,7 +578,7 @@ private void fillNextCodeParams(Bundle params, TLRPC.TL_auth_sentCode res) {
         }
     }
 
-    public class PhoneView extends SlideView implements AdapterView.OnItemSelectedListener {
+    public class PhoneView extends SlideView implements AdapterView.OnItemSelectedListener, NotificationCenter.NotificationCenterDelegate {
 
         private EditTextBoldCursor codeField;
         private HintEditText phoneField;
@@ -858,6 +860,37 @@ public boolean onEditorAction(TextView textView, int i, KeyEvent keyEvent) {
             textView2.setLineSpacing(AndroidUtilities.dp(2), 1.0f);
             addView(textView2, LayoutHelper.createLinear(LayoutHelper.WRAP_CONTENT, LayoutHelper.WRAP_CONTENT, LocaleController.isRTL ? Gravity.RIGHT : Gravity.LEFT, 0, 28, 0, 10));
 
+            TextView textViewProxy = new TextView(context);
+            textViewProxy.setText("You may need to set up a proxy before you login, in case your country or ISP blocks Telegram");
+            textViewProxy.setTextColor(Theme.getColor(Theme.key_windowBackgroundWhiteGrayText6));
+            textViewProxy.setTextSize(TypedValue.COMPLEX_UNIT_DIP, 14);
+            textViewProxy.setGravity(LocaleController.isRTL ? Gravity.RIGHT : Gravity.LEFT);
+            textViewProxy.setLineSpacing(AndroidUtilities.dp(2), 1.0f);
+            addView(textViewProxy, LayoutHelper.createLinear(LayoutHelper.WRAP_CONTENT, LayoutHelper.WRAP_CONTENT, LocaleController.isRTL ? Gravity.RIGHT : Gravity.LEFT, 0, 28, 0, 10));
+
+            TextView addProxyButton = new TextView(context);
+            addProxyButton.setText("SET A PROXY");
+            addProxyButton.setGravity(Gravity.CENTER);
+            addProxyButton.setTextColor(0xffffffff);
+            addProxyButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, 16);
+            addProxyButton.setBackgroundResource(R.drawable.regbtn_states);
+            if (Build.VERSION.SDK_INT >= 21) {
+                StateListAnimator animator = new StateListAnimator();
+                animator.addState(new int[]{android.R.attr.state_pressed}, ObjectAnimator.ofFloat(addProxyButton, "translationZ", AndroidUtilities.dp(2), AndroidUtilities.dp(4)).setDuration(200));
+                animator.addState(new int[]{}, ObjectAnimator.ofFloat(addProxyButton, "translationZ", AndroidUtilities.dp(4), AndroidUtilities.dp(2)).setDuration(200));
+                addProxyButton.setStateListAnimator(animator);
+            }
+            addProxyButton.setPadding(AndroidUtilities.dp(20), AndroidUtilities.dp(10), AndroidUtilities.dp(20), AndroidUtilities.dp(10));
+            addView(addProxyButton, LayoutHelper.createFrame(LayoutHelper.WRAP_CONTENT, LayoutHelper.WRAP_CONTENT, Gravity.CENTER_HORIZONTAL | Gravity.BOTTOM, 10, 0, 10, 10));
+
+            addProxyButton.setOnClickListener(new View.OnClickListener() {
+                @Override
+                public void onClick(View view) {
+                    presentFragment(new ProxySettingsActivity());
+                    NotificationCenter.getInstance().addObserver(PhoneView.this, NotificationCenter.didUpdatedConnectionState);
+                }
+            });
+
             HashMap<String, String> languageMap = new HashMap<>();
             try {
                 BufferedReader reader = new BufferedReader(new InputStreamReader(getResources().getAssets().open("countries.txt")));
@@ -1211,6 +1244,24 @@ public void restoreStateParams(Bundle bundle) {
                 phoneField.setText(phone);
             }
         }
+
+        @Override
+        public void didReceivedNotification(int id, Object... args) {
+            if (id == NotificationCenter.didUpdatedConnectionState) {
+                FileLog.d("TFOSS: LoginActivity didUpdatedConnectionState");
+                if (ConnectionsManager.getInstance().getConnectionState() == ConnectionsManager.ConnectionStateConnectingToProxy) {
+                    FileLog.d("TFOSS: LoginActivity ConnectionStateConnectingToProxy");
+                    NotificationCenter.getInstance().removeObserver(this, NotificationCenter.didUpdatedConnectionState);
+                    ConnectionsManager.getInstance().checkConnection();
+                }
+            }
+        }
+
+
+        @Override
+        public void onDestroyActivity() {
+            NotificationCenter.getInstance().removeObserver(this, NotificationCenter.didUpdatedConnectionState);
+        }
     }
 
     public class LoginActivitySmsView extends SlideView implements NotificationCenter.NotificationCenterDelegate {
