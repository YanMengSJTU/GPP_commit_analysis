diff --git a/TMessagesProj/src/main/java/org/telegram/android/NotificationCenter.java b/TMessagesProj/src/main/java/org/telegram/android/NotificationCenter.java
index 1a810799b..7bad73671 100644
--- a/TMessagesProj/src/main/java/org/telegram/android/NotificationCenter.java
+++ b/TMessagesProj/src/main/java/org/telegram/android/NotificationCenter.java
@@ -29,6 +29,7 @@
     public static final int postsNeedReload = totalEvents++;
     public static final int postRequestFinished = totalEvents++;
     public static final int undefinedLocation = totalEvents++;
+    public static final int locationServiceDisabled = totalEvents++;
     public static final int newPostSaved = totalEvents++;
     public static final int postsRefresh = totalEvents++;
     public static final int offlinePostsLoaded = totalEvents++;
diff --git a/TMessagesProj/src/main/java/org/telegram/android/location/LocationManagerHelper.java b/TMessagesProj/src/main/java/org/telegram/android/location/LocationManagerHelper.java
index 064ee1979..ca582c7b8 100644
--- a/TMessagesProj/src/main/java/org/telegram/android/location/LocationManagerHelper.java
+++ b/TMessagesProj/src/main/java/org/telegram/android/location/LocationManagerHelper.java
@@ -97,6 +97,15 @@ public Location getLastLocation() {
         return l;
     }
 
+    public boolean isLocationServiceEnabled() {
+        LocationManager lm = (LocationManager) ApplicationLoader.applicationContext.getSystemService(Context.LOCATION_SERVICE);
+        return (lm.isProviderEnabled(LocationManager.GPS_PROVIDER) && lm.isProviderEnabled(LocationManager.NETWORK_PROVIDER));
+    }
+
+//    lm.isProviderEnabled(LocationManager.GPS_PROVIDER)
+//            lm.isProviderEnabled(LocationManager.NETWORK_PROVIDER);
+//    lm.isProviderEnabled(LocationManager.PASSIVE_PROVIDER);
+
     public Location getLastSavedLocation() {
         return lastSavedLocation;
     }
diff --git a/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java b/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java
index 0f74b9a6f..104417aec 100644
--- a/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java
+++ b/TMessagesProj/src/main/java/org/telegram/ui/PostsActivity.java
@@ -119,7 +119,7 @@
     private Runnable refreshProgressRun = new Runnable() {
         @Override
         public void run() {
-            if (PostsController.getInstance().isLoadingPosts()) {
+            if (PostsController.getInstance().isLoadingPosts() && swipeRefreshLayout != null) {
                 swipeRefreshLayout.setRefreshing(true);
             }
         }
@@ -235,6 +235,7 @@ public boolean onFragmentCreate() {
             NotificationCenter.getInstance().addObserver(this, NotificationCenter.offlinePostsLoaded);
             NotificationCenter.getInstance().addObserver(this, NotificationCenter.postsRefresh);
             NotificationCenter.getInstance().addObserver(this, NotificationCenter.undefinedLocation);
+            NotificationCenter.getInstance().addObserver(this, NotificationCenter.locationServiceDisabled);
             NotificationCenter.getInstance().addObserver(this, NotificationCenter.postRequestFinished);
             NotificationCenter.getInstance().addObserver(this, NotificationCenter.postsNeedReload);
             NotificationCenter.getInstance().addObserver(this, NotificationCenter.loadPostsError);
@@ -252,6 +253,9 @@ public boolean onFragmentCreate() {
             ContactsController.getInstance().checkInviteText();
             postsLoaded = true;
         }
+        if (!LocationManagerHelper.getInstance().isLocationServiceEnabled()) {
+            NotificationCenter.getInstance().postNotificationName(NotificationCenter.locationServiceDisabled);
+        }
         return true;
     }
 
@@ -265,6 +269,7 @@ public void onFragmentDestroy() {
             NotificationCenter.getInstance().removeObserver(this, NotificationCenter.offlinePostsLoaded);
             NotificationCenter.getInstance().removeObserver(this, NotificationCenter.postsRefresh);
             NotificationCenter.getInstance().removeObserver(this, NotificationCenter.undefinedLocation);
+            NotificationCenter.getInstance().removeObserver(this, NotificationCenter.locationServiceDisabled);
             NotificationCenter.getInstance().removeObserver(this, NotificationCenter.postRequestFinished);
             NotificationCenter.getInstance().removeObserver(this, NotificationCenter.postsNeedReload);
             NotificationCenter.getInstance().removeObserver(this, NotificationCenter.loadPostsError);
@@ -696,9 +701,15 @@ public void searchStateChanged(boolean search) {
         return fragmentView;
     }
 
+    @Override
+    public void onPause() {
+        LocationManagerHelper.getInstance().stopLocationListener();
+    }
+
     @Override
     public void onResume() {
         super.onResume();
+        LocationManagerHelper.getInstance().runLocationListener();
         if (postsAdapter != null) {
             postsAdapter.notifyDataSetChanged();
         }
@@ -737,7 +748,7 @@ public void didReceivedNotification(int id, Object... args) {
 //        }
         if (id == NotificationCenter.stopRefreshingView) {
             stopRefreshingProgressView();
-        } else if (id == NotificationCenter.undefinedLocation) {
+        } else if (id == NotificationCenter.locationServiceDisabled || id == NotificationCenter.undefinedLocation) {
 //            Toast.makeText(((Context) getParentActivity()), "Please, enable gps on your phone", Toast.LENGTH_SHORT).show();
             stopRefreshingProgressView();
             Activity context = getParentActivity();
@@ -1017,7 +1028,11 @@ private void startRefreshingProgressView() {
 
     private void stopRefreshingProgressView() {
         handler.removeCallbacks(refreshProgressRun);
-        swipeRefreshLayout.setRefreshing(false);
-
+        if (swipeRefreshLayout != null) {
+            swipeRefreshLayout.setRefreshing(false);
+        }
+        if (progressView != null) {
+            progressView.setVisibility(View.INVISIBLE);
+        }
     }
 }
