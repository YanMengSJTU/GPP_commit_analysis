diff --git a/TMessagesProj/src/main/java/io/bettergram/utils/RoundedCornersTransform.java b/TMessagesProj/src/main/java/io/bettergram/utils/RoundedCornersTransform.java
index 2ce5f3082..313a5d9be 100644
--- a/TMessagesProj/src/main/java/io/bettergram/utils/RoundedCornersTransform.java
+++ b/TMessagesProj/src/main/java/io/bettergram/utils/RoundedCornersTransform.java
@@ -28,7 +28,8 @@ public Bitmap transform(Bitmap source) {
             source.recycle();
         }
 
-        Bitmap bitmap = Bitmap.createBitmap(width, height, source.getConfig());
+        Bitmap.Config config = source.getConfig() != null ? source.getConfig() : Bitmap.Config.ARGB_8888;
+        Bitmap bitmap = Bitmap.createBitmap(width, height, config);
 
         Canvas canvas = new Canvas(bitmap);
         Paint paint = new Paint();
@@ -37,7 +38,7 @@ public Bitmap transform(Bitmap source) {
         paint.setAntiAlias(true);
 
         float r = Math.min(width, height) / 28f;
-        canvas.drawRoundRect(new RectF(0, 0, source.getWidth(), source.getHeight()), r, r, paint);
+        canvas.drawRoundRect(new RectF(0, 0, width, height), r, r, paint);
         squaredBitmap.recycle();
         return bitmap;
     }
