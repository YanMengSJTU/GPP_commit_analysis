diff --git a/java/dagger/internal/codegen/MapBindingExpression.java b/java/dagger/internal/codegen/MapBindingExpression.java
index 7dd426345..f9a50fbb2 100644
--- a/java/dagger/internal/codegen/MapBindingExpression.java
+++ b/java/dagger/internal/codegen/MapBindingExpression.java
@@ -157,8 +157,11 @@ private boolean isImmutableMapAvailable() {
   }
 
   private boolean isImmutableMapBuilderWithExpectedSizeAvailable() {
-    return methodsIn(elements.getTypeElement(ImmutableMap.class).getEnclosedElements())
-        .stream()
-        .anyMatch(method -> method.getSimpleName().contentEquals("builderWithExpectedSize"));
+    if (isImmutableMapAvailable()) {
+      return methodsIn(elements.getTypeElement(ImmutableMap.class).getEnclosedElements())
+          .stream()
+          .anyMatch(method -> method.getSimpleName().contentEquals("builderWithExpectedSize"));
+    }
+    return false;
   }
 }
