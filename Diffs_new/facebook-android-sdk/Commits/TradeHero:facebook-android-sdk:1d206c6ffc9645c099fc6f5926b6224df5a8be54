diff --git a/facebook/src/com/facebook/AppEventsLogger.java b/facebook/src/com/facebook/AppEventsLogger.java
index c1ccd1dea..c4f7ed61e 100644
--- a/facebook/src/com/facebook/AppEventsLogger.java
+++ b/facebook/src/com/facebook/AppEventsLogger.java
@@ -17,8 +17,8 @@
 package com.facebook;
 
 import android.app.Activity;
-import android.content.Context;
 import android.content.ComponentName;
+import android.content.Context;
 import android.content.Intent;
 import android.os.Bundle;
 import android.support.v4.content.LocalBroadcastManager;
@@ -33,9 +33,21 @@
 import org.json.JSONException;
 import org.json.JSONObject;
 
-import java.io.*;
+import java.io.BufferedInputStream;
+import java.io.BufferedOutputStream;
+import java.io.FileNotFoundException;
+import java.io.ObjectInputStream;
+import java.io.ObjectOutputStream;
+import java.io.Serializable;
+import java.io.UnsupportedEncodingException;
 import java.math.BigDecimal;
-import java.util.*;
+import java.util.ArrayList;
+import java.util.Currency;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.ScheduledThreadPoolExecutor;
 import java.util.concurrent.TimeUnit;
@@ -1184,15 +1196,13 @@ public AppEvent(
                 Bundle parameters,
                 boolean isImplicitlyLogged
         ) {
+            try {
+                validateIdentifier(eventName);
 
-            validateIdentifier(eventName);
-
-            this.name = eventName;
-
-            isImplicit = isImplicitlyLogged;
-            jsonObject = new JSONObject();
+                this.name = eventName;
+                isImplicit = isImplicitlyLogged;
+                jsonObject = new JSONObject();
 
-            try {
                 jsonObject.put("_eventName", eventName);
                 jsonObject.put("_logTime", System.currentTimeMillis() / 1000);
                 jsonObject.put("_ui", Utility.getActivityName(context));
@@ -1240,6 +1250,11 @@ public AppEvent(
                         "JSON encoding for app event failed: '%s'", jsonException.toString());
                 jsonObject = null;
 
+            } catch (FacebookException e) {
+                // If any of the above failed, just consider this an illegal event.
+                Logger.log(LoggingBehavior.APP_EVENTS, "AppEvents",
+                        "Invalid app event name or parameter:", e.toString());
+                jsonObject = null;
             }
         }
 
@@ -1261,7 +1276,7 @@ public JSONObject getJSONObject() {
         }
 
         // throw exception if not valid.
-        private void validateIdentifier(String identifier) {
+        private void validateIdentifier(String identifier) throws FacebookException {
 
             // Identifier should be 40 chars or less, and only have 0-9A-Za-z, underscore, hyphen, and space (but no
             // hyphen or space in the first position).
@@ -1296,7 +1311,6 @@ private void validateIdentifier(String identifier) {
                     );
                 }
             }
-
         }
 
         private static class SerializationProxyV1 implements Serializable {
diff --git a/facebook/src/com/facebook/BoltsMeasurementEventListener.java b/facebook/src/com/facebook/BoltsMeasurementEventListener.java
index 6e1d71039..b9a6e57cb 100644
--- a/facebook/src/com/facebook/BoltsMeasurementEventListener.java
+++ b/facebook/src/com/facebook/BoltsMeasurementEventListener.java
@@ -4,6 +4,7 @@
 import android.content.Context;
 import android.content.Intent;
 import android.content.IntentFilter;
+import android.os.Bundle;
 import android.support.v4.content.LocalBroadcastManager;
 
 public class BoltsMeasurementEventListener extends BroadcastReceiver {
@@ -51,6 +52,12 @@ protected void finalize() throws Throwable {
     public void onReceive(Context context, Intent intent) {
         AppEventsLogger appEventsLogger = AppEventsLogger.newLogger(context);
         String eventName = BOLTS_MEASUREMENT_EVENT_PREFIX + intent.getStringExtra(MEASUREMENT_EVENT_NAME_KEY);
-        appEventsLogger.logEvent(eventName, intent.getBundleExtra(MEASUREMENT_EVENT_ARGS_KEY));
+        Bundle eventArgs = intent.getBundleExtra(MEASUREMENT_EVENT_ARGS_KEY);
+        Bundle logData = new Bundle();
+        for(String key : eventArgs.keySet()) {
+           String safeKey = key.replaceAll("[^0-9a-zA-Z _-]", "-").replaceAll("^[ -]*", "").replaceAll("[ -]*$", "");
+           logData.putString(safeKey, (String)eventArgs.get(key));
+        }
+        appEventsLogger.logEvent(eventName, logData);
     }
 }
diff --git a/facebook/src/com/facebook/FacebookSdkVersion.java b/facebook/src/com/facebook/FacebookSdkVersion.java
index 06121fa31..47be1df96 100644
--- a/facebook/src/com/facebook/FacebookSdkVersion.java
+++ b/facebook/src/com/facebook/FacebookSdkVersion.java
@@ -17,5 +17,5 @@
 package com.facebook;
 
 final class FacebookSdkVersion {
-    public static final String BUILD = "3.18.0";
+    public static final String BUILD = "3.18.1";
 }
diff --git a/facebook/tests/src/com/facebook/AppEventsLoggerTests.java b/facebook/tests/src/com/facebook/AppEventsLoggerTests.java
index c8fef2457..203eb041e 100644
--- a/facebook/tests/src/com/facebook/AppEventsLoggerTests.java
+++ b/facebook/tests/src/com/facebook/AppEventsLoggerTests.java
@@ -18,6 +18,7 @@
 
 import android.content.Intent;
 import android.content.IntentFilter;
+import android.os.Bundle;
 import android.support.v4.content.LocalBroadcastManager;
 
 import java.io.FileInputStream;
@@ -54,6 +55,15 @@ public void run() {
             logger1.logEvent("an_event");
             logger2.logEvent("another_event");
 
+            // test illegal event name and event key, should not crash in non-debug environment.
+            logger1.logEvent("$illegal_event_name");
+            Bundle params = new Bundle();
+            params.putString("illegal%key", "good_value");
+            logger1.logEvent("legal_event_name", params);
+            char[] val = {'b', 'a', 'd'};
+            params.putCharArray("legal_key", val);
+            logger1.logEvent("legal_event",params);
+
             logger1.flush();
 
             waitForBroadcastReceiver.waitForExpectedCalls();
diff --git a/samples/RPSSample/src/com/facebook/samples/rps/MainActivity.java b/samples/RPSSample/src/com/facebook/samples/rps/MainActivity.java
index b26dd6489..f40594da7 100644
--- a/samples/RPSSample/src/com/facebook/samples/rps/MainActivity.java
+++ b/samples/RPSSample/src/com/facebook/samples/rps/MainActivity.java
@@ -29,9 +29,6 @@
 import bolts.AppLinks;
 import com.facebook.*;
 
-import java.util.regex.Matcher;
-import java.util.regex.Pattern;
-
 import static com.facebook.samples.rps.RpsGameUtils.INVALID_CHOICE;
 
 public class MainActivity extends FragmentActivity {
@@ -202,7 +199,7 @@ private boolean handleNativeLink() {
     }
 
     private int getAppLinkGesture(Intent intent) {
-      Uri targetURI = AppLinks.getTargetUrl(intent);
+      Uri targetURI = AppLinks.getTargetUrlFromInboundIntent(this, intent);
       if (targetURI == null) {
         return INVALID_CHOICE;
       }
